<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: se.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>se.h File Reference</h1>
<p>
<a href="../../d1/d4/se_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">_SECURITY_SUBJECT_CONTEXT</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d2/struct__INITIAL__PRIVILEGE__SET.html">_INITIAL_PRIVILEGE_SET</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">_ACCESS_STATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">_AUX_ACCESS_DATA</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/struct__SE__AUDITING__STATE.html">_SE_AUDITING_STATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/struct__SE__PROCESS__AUDIT__INFO.html">_SE_PROCESS_AUDIT_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d0/struct__SE__EXPORTS.html">_SE_EXPORTS</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a0">SE_DEFAULT_SECURITY_QUOTA</a>&nbsp;&nbsp;&nbsp;2048</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a1">TOKEN_HAS_TRAVERSE_PRIVILEGE</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a2">TOKEN_HAS_BACKUP_PRIVILEGE</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a3">TOKEN_HAS_RESTORE_PRIVILEGE</a>&nbsp;&nbsp;&nbsp;0x04</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a4">TOKEN_HAS_ADMIN_GROUP</a>&nbsp;&nbsp;&nbsp;0x08</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a5">TOKEN_IS_RESTRICTED</a>&nbsp;&nbsp;&nbsp;0x10</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a6">SE_BACKUP_PRIVILEGES_CHECKED</a>&nbsp;&nbsp;&nbsp;0x00000010</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a7">INITIAL_PRIVILEGE_COUNT</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a8">SeComputeDeniedAccesses</a>(GrantedAccess, DesiredAccess)&nbsp;&nbsp;&nbsp;((~(GrantedAccess)) &amp; (DesiredAccess) )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a9">SeComputeGrantedAccesses</a>(GrantedAccess, DesiredAccess)&nbsp;&nbsp;&nbsp;((GrantedAccess) &amp; (DesiredAccess) )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>(Sid)&nbsp;&nbsp;&nbsp;(8 + (4 * ((SID *)Sid)-&gt;SubAuthorityCount))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a11">SeSameToken</a>(TC1, TC2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a12">SeDeleteClientSecurity</a>(C)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">*++  <a href="#a12"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a13">SeStopImpersonatingClient</a>()&nbsp;&nbsp;&nbsp;PsRevertToSelf()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">*++  <a href="#a13"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a14">SeAssertMappedCanonicalAccess</a>(AccessMask)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a15">SeComputeSecurityQuota</a>(<a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a16">SeQuerySubjectContextToken</a>(SubjectContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a17">SeTokenObjectType</a>()&nbsp;&nbsp;&nbsp;(PVOID)<a class="el" href="../../d8/d3/tokenp_8h.html#a19">SepTokenObjectType</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a18">SeEnableAccessToExports</a>()</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d0/d5/se_8h.html#a200">_SECURITY_OPERATION_CODE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a19">SECURITY_OPERATION_CODE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d0/d5/se_8h.html#a200">_SECURITY_OPERATION_CODE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a20">PSECURITY_OPERATION_CODE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">_SECURITY_SUBJECT_CONTEXT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a21">SECURITY_SUBJECT_CONTEXT</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">_SECURITY_SUBJECT_CONTEXT</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a22">PSECURITY_SUBJECT_CONTEXT</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d2/struct__INITIAL__PRIVILEGE__SET.html">_INITIAL_PRIVILEGE_SET</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a23">INITIAL_PRIVILEGE_SET</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d2/struct__INITIAL__PRIVILEGE__SET.html">_INITIAL_PRIVILEGE_SET</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a24">PINITIAL_PRIVILEGE_SET</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">_ACCESS_STATE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a25">ACCESS_STATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">_ACCESS_STATE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a26">PACCESS_STATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">_AUX_ACCESS_DATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a27">AUX_ACCESS_DATA</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">_AUX_ACCESS_DATA</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a28">PAUX_ACCESS_DATA</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d0/struct__SE__AUDITING__STATE.html">_SE_AUDITING_STATE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a29">SE_AUDITING_STATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d0/struct__SE__AUDITING__STATE.html">_SE_AUDITING_STATE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a30">PSE_AUDITING_STATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d0/struct__SE__PROCESS__AUDIT__INFO.html">_SE_PROCESS_AUDIT_INFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a31">SE_PROCESS_AUDIT_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d0/struct__SE__PROCESS__AUDIT__INFO.html">_SE_PROCESS_AUDIT_INFO</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a32">PSE_PROCESS_AUDIT_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d0/struct__SE__EXPORTS.html">_SE_EXPORTS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a33">SE_EXPORTS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d0/struct__SE__EXPORTS.html">_SE_EXPORTS</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a34">PSE_EXPORTS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef NTSTATUS(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a35">PSE_LOGON_SESSION_TERMINATED_ROUTINE</a> )(IN PLUID LogonId)</td></tr>

<tr><td colspan=2><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a200">_SECURITY_OPERATION_CODE</a> { <a class="el" href="../../d0/d5/se_8h.html#a200a108">SetSecurityDescriptor</a>, 
<a class="el" href="../../d0/d5/se_8h.html#a200a109">QuerySecurityDescriptor</a>, 
<a class="el" href="../../d0/d5/se_8h.html#a200a110">DeleteSecurityDescriptor</a>, 
<a class="el" href="../../d0/d5/se_8h.html#a200a111">AssignSecurityDescriptor</a>
 }</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a112">SeInitSystem</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a113">SeSetSecurityAccessMask</a> (IN SECURITY_INFORMATION SecurityInformation, OUT PACCESS_MASK DesiredAccess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a114">SeQuerySecurityAccessMask</a> (IN SECURITY_INFORMATION SecurityInformation, OUT PACCESS_MASK DesiredAccess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a115">SeDefaultObjectMethod</a> (IN PVOID Object, IN <a class="el" href="../../d0/d5/se_8h.html#a19">SECURITY_OPERATION_CODE</a> OperationCode, IN PSECURITY_INFORMATION SecurityInformation, IN OUT PSECURITY_DESCRIPTOR SecurityDescriptor, IN OUT PULONG Length, IN OUT PSECURITY_DESCRIPTOR *ObjectsSecurityDescriptor, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN PGENERIC_MAPPING GenericMapping)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a116">SeCaptureSecurityDescriptor</a> (IN PSECURITY_DESCRIPTOR InputSecurityDescriptor, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN BOOLEAN ForceCapture, OUT PSECURITY_DESCRIPTOR *OutputSecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a117">SeReleaseSecurityDescriptor</a> (IN PSECURITY_DESCRIPTOR CapturedSecurityDescriptor, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN BOOLEAN ForceCapture)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a118">SeCaptureSubjectContext</a> (OUT <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a119">SeLockSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a120">SeUnlockSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a121">SeReleaseSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a122">SeCaptureSecurityQos</a> (IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a> OPTIONAL, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN PBOOLEAN SecurityQosPresent, IN PSECURITY_ADVANCED_QUALITY_OF_SERVICE CapturedSecurityQos)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a123">SeFreeCapturedSecurityQos</a> (IN PVOID <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a9">SecurityQos</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a124">SeCaptureSid</a> (IN PSID InputSid, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN PVOID CaptureBuffer OPTIONAL, IN ULONG CaptureBufferLength, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN BOOLEAN ForceCapture, OUT PSID *CapturedSid)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a125">SeReleaseSid</a> (IN PSID CapturedSid, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN BOOLEAN ForceCapture)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a126">SeCaptureAcl</a> (IN PACL InputAcl, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN PVOID CaptureBuffer OPTIONAL, IN ULONG CaptureBufferLength, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN BOOLEAN ForceCapture, OUT PACL *CapturedAcl, OUT PULONG AlignedAclSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a127">SeReleaseAcl</a> (IN PACL CapturedAcl, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN BOOLEAN ForceCapture)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a128">SeCaptureLuidAndAttributesArray</a> (IN PLUID_AND_ATTRIBUTES <a class="el" href="../../d2/d9/ps2_8c.html#a155">InputArray</a>, IN ULONG ArrayCount, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN PVOID CaptureBuffer OPTIONAL, IN ULONG CaptureBufferLength, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN BOOLEAN ForceCapture, OUT PLUID_AND_ATTRIBUTES *CapturedArray, OUT PULONG AlignedArraySize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a129">SeReleaseLuidAndAttributesArray</a> (IN PLUID_AND_ATTRIBUTES CapturedArray, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN BOOLEAN ForceCapture)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a130">SeCaptureSidAndAttributesArray</a> (IN PSID_AND_ATTRIBUTES <a class="el" href="../../d2/d9/ps2_8c.html#a155">InputArray</a>, IN ULONG ArrayCount, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN PVOID CaptureBuffer OPTIONAL, IN ULONG CaptureBufferLength, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN BOOLEAN ForceCapture, OUT PSID_AND_ATTRIBUTES *CapturedArray, OUT PULONG AlignedArraySize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a131">SeReleaseSidAndAttributesArray</a> (IN PSID_AND_ATTRIBUTES CapturedArray, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN BOOLEAN ForceCapture)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a132">SeAssignSecurity</a> (IN PSECURITY_DESCRIPTOR ParentDescriptor OPTIONAL, IN PSECURITY_DESCRIPTOR ExplicitDescriptor, OUT PSECURITY_DESCRIPTOR *NewDescriptor, IN BOOLEAN IsDirectoryObject, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext, IN PGENERIC_MAPPING GenericMapping, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a133">SeAssignSecurityEx</a> (IN PSECURITY_DESCRIPTOR ParentDescriptor OPTIONAL, IN PSECURITY_DESCRIPTOR ExplicitDescriptor OPTIONAL, OUT PSECURITY_DESCRIPTOR *NewDescriptor, IN GUID *ObjectType OPTIONAL, IN BOOLEAN IsDirectoryObject, IN ULONG AutoInheritFlags, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext, IN PGENERIC_MAPPING GenericMapping, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a134">SeDeassignSecurity</a> (IN OUT PSECURITY_DESCRIPTOR *SecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a135">SeAccessCheck</a> (IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext, IN BOOLEAN SubjectContextLocked, IN ACCESS_MASK DesiredAccess, IN ACCESS_MASK PreviouslyGrantedAccess, OUT PPRIVILEGE_SET *Privileges OPTIONAL, IN PGENERIC_MAPPING GenericMapping, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, OUT PACCESS_MASK GrantedAccess, OUT PNTSTATUS AccessStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a136">SeProxyAccessCheck</a> (IN PUNICODE_STRING Volume, IN PUNICODE_STRING RelativePath, IN BOOLEAN ContainerObject, IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext, IN BOOLEAN SubjectContextLocked, IN ACCESS_MASK DesiredAccess, IN ACCESS_MASK PreviouslyGrantedAccess, OUT PPRIVILEGE_SET *Privileges OPTIONAL, IN PGENERIC_MAPPING GenericMapping, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, OUT PACCESS_MASK GrantedAccess, OUT PNTSTATUS AccessStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a137">SePrivilegeCheck</a> (IN OUT PPRIVILEGE_SET RequiredPrivileges, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a138">SeFreePrivileges</a> (IN PPRIVILEGE_SET Privileges)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a139">SePrivilegePolicyCheck</a> (IN OUT PACCESS_MASK RemainingDesiredAccess, IN OUT PACCESS_MASK PreviouslyGrantedAccess, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext OPTIONAL, IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a> OPTIONAL, OUT PPRIVILEGE_SET *PrivilegeSet, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a140">SeGenerateMessage</a> (IN PSTRING ObjectName, IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>, IN ACCESS_MASK DesiredAccess, IN BOOLEAN AccessGranted, IN HANDLE AuditPort, IN HANDLE AlarmPort, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a141">SeOpenObjectAuditAlarm</a> (IN PUNICODE_STRING ObjectTypeName, IN PVOID Object OPTIONAL, IN PUNICODE_STRING AbsoluteObjectName OPTIONAL, IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState, IN BOOLEAN ObjectCreated, IN BOOLEAN AccessGranted, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, OUT PBOOLEAN GenerateOnClose)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a142">SeOpenObjectForDeleteAuditAlarm</a> (IN PUNICODE_STRING ObjectTypeName, IN PVOID Object OPTIONAL, IN PUNICODE_STRING AbsoluteObjectName OPTIONAL, IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState, IN BOOLEAN ObjectCreated, IN BOOLEAN AccessGranted, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode, OUT PBOOLEAN GenerateOnClose)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a143">SeDeleteObjectAuditAlarm</a> (IN PVOID Object, IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a144">SeCloseObjectAuditAlarm</a> (IN PVOID Object, IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>, IN BOOLEAN GenerateOnClose)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a145">SeTraverseAuditAlarm</a> (IN PLUID OperationID, IN PVOID DirectoryObject, IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext, IN BOOLEAN SubjectContextLocked, IN ACCESS_MASK TraverseAccess, IN PPRIVILEGE_SET Privileges OPTIONAL, IN BOOLEAN AccessGranted, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a146">SeCreateInstanceAuditAlarm</a> (IN PLUID OperationID OPTIONAL, IN PVOID Object, IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext, IN ACCESS_MASK DesiredAccess, IN PPRIVILEGE_SET Privileges OPTIONAL, IN BOOLEAN AccessGranted, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a147">SeCreateObjectAuditAlarm</a> (IN PLUID OperationID OPTIONAL, IN PVOID Object, IN PUNICODE_STRING ComponentName, IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext, IN ACCESS_MASK DesiredAccess, IN PPRIVILEGE_SET Privileges OPTIONAL, IN BOOLEAN AccessGranted, OUT PBOOLEAN AuditPerformed, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a148">SeObjectReferenceAuditAlarm</a> (IN PLUID OperationID OPTIONAL, IN PVOID Object, IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext, IN ACCESS_MASK DesiredAccess, IN PPRIVILEGE_SET Privileges OPTIONAL, IN BOOLEAN AccessGranted, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a149">SePrivilegeObjectAuditAlarm</a> (IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext, IN ACCESS_MASK DesiredAccess, IN PPRIVILEGE_SET Privileges, IN BOOLEAN AccessGranted, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a150">SeCheckPrivilegedObject</a> (LUID PrivilegeValue, HANDLE ObjectHandle, ACCESS_MASK DesiredAccess, <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a151">SeValidSecurityDescriptor</a> (IN ULONG Length, IN PSECURITY_DESCRIPTOR SecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a152">SeAuditHandleCreation</a> (IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState, IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PACCESS_TOKEN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a153">SeMakeSystemToken</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PACCESS_TOKEN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a154">SeMakeAnonymousLogonToken</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a155">SeGetTokenControlInformation</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>, OUT PTOKEN_CONTROL TokenControl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI TOKEN_TYPE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a156">SeTokenType</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>SECURITY_IMPERSONATION_LEVEL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a157">SeTokenImpersonationLevel</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a158">SeTokenIsAdmin</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a159">SeTokenIsRestricted</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a160">SeSubProcessToken</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> ParentProcess, OUT PACCESS_TOKEN *ChildToken)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a161">SeAssignPrimaryToken</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a162">SeDeassignPrimaryToken</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a163">SeExchangePrimaryToken</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN PACCESS_TOKEN NewAccessToken, OUT PACCESS_TOKEN *OldAccessToken)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a164">SeCopyClientToken</a> (IN PACCESS_TOKEN <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a11">ClientToken</a>, IN SECURITY_IMPERSONATION_LEVEL ImpersonationLevel, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, OUT PACCESS_TOKEN *DuplicateToken)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a165">SeFilterToken</a> (IN PACCESS_TOKEN ExistingToken, IN ULONG Flags, IN PTOKEN_GROUPS SidsToDisable OPTIONAL, IN PTOKEN_PRIVILEGES PrivilegesToDelete OPTIONAL, IN PTOKEN_GROUPS RestrictedSids OPTIONAL, OUT PACCESS_TOKEN *FilteredToken)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a166">SeQueryAuthenticationIdToken</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>, OUT PLUID AuthenticationId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a167">SeQuerySessionIdToken</a> (IN PACCESS_TOKEN, IN PULONG pSessionId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a168">SeSetSessionIdToken</a> (IN PACCESS_TOKEN, IN ULONG SessionId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a169">SeCreateClientSecurity</a> (IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> ClientThread, IN PSECURITY_QUALITY_OF_SERVICE ClientSecurityQos, IN BOOLEAN RemoteSession, OUT <a class="el" href="../../d8/d0/struct__SECURITY__CLIENT__CONTEXT.html">PSECURITY_CLIENT_CONTEXT</a> ClientContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a170">SeImpersonateClient</a> (IN <a class="el" href="../../d8/d0/struct__SECURITY__CLIENT__CONTEXT.html">PSECURITY_CLIENT_CONTEXT</a> ClientContext, IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> ServerThread OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a171">SeImpersonateClientEx</a> (IN <a class="el" href="../../d8/d0/struct__SECURITY__CLIENT__CONTEXT.html">PSECURITY_CLIENT_CONTEXT</a> ClientContext, IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> ServerThread OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a172">SeCreateClientSecurityFromSubjectContext</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext, IN PSECURITY_QUALITY_OF_SERVICE ClientSecurityQos, IN BOOLEAN ServerIsRemote, OUT <a class="el" href="../../d8/d0/struct__SECURITY__CLIENT__CONTEXT.html">PSECURITY_CLIENT_CONTEXT</a> ClientContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a173">SeCreateAccessState</a> (IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState, IN <a class="el" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a> AuxData, IN ACCESS_MASK DesiredAccess, IN PGENERIC_MAPPING GenericMapping)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a174">SeDeleteAccessState</a> (IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a175">SeUpdateClientSecurity</a> (IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> ClientThread, IN OUT <a class="el" href="../../d8/d0/struct__SECURITY__CLIENT__CONTEXT.html">PSECURITY_CLIENT_CONTEXT</a> ClientContext, OUT PBOOLEAN <a class="el" href="../../d8/d1/fdengine_8c.html#a8">ChangesMade</a>, OUT PBOOLEAN NewToken)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a176">SeRmInitPhase1</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a177">SeQuerySecurityDescriptorInfo</a> (IN PSECURITY_INFORMATION SecurityInformation, OUT PSECURITY_DESCRIPTOR SecurityDescriptor, IN OUT PULONG Length, IN PSECURITY_DESCRIPTOR *ObjectsSecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a178">SeSetSecurityDescriptorInfo</a> (IN PVOID Object OPTIONAL, IN PSECURITY_INFORMATION SecurityInformation, IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN OUT PSECURITY_DESCRIPTOR *ObjectsSecurityDescriptor, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN PGENERIC_MAPPING GenericMapping)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a179">SeSetSecurityDescriptorInfoEx</a> (IN PVOID Object OPTIONAL, IN PSECURITY_INFORMATION SecurityInformation, IN PSECURITY_DESCRIPTOR ModificationDescriptor, IN OUT PSECURITY_DESCRIPTOR *ObjectsSecurityDescriptor, IN ULONG AutoInheritFlags, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN PGENERIC_MAPPING GenericMapping)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a180">SeAppendPrivileges</a> (<a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState, PPRIVILEGE_SET Privileges)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a181">SeComputeQuotaInformationSize</a> (IN PSECURITY_DESCRIPTOR SecurityDescriptor, OUT PULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a182">SePrivilegedServiceAuditAlarm</a> (IN PUNICODE_STRING ServiceName, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext, IN PPRIVILEGE_SET Privileges, IN BOOLEAN AccessGranted)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a183">SeSinglePrivilegeCheck</a> (LUID PrivilegeValue, <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a184">SeCheckAuditPrivilege</a> (IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a185">SeAssignWorldSecurityDescriptor</a> (IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN OUT PULONG Length, IN PSECURITY_INFORMATION SecurityInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a186">SeFastTraverseCheck</a> (PSECURITY_DESCRIPTOR SecurityDescriptor, ACCESS_MASK TraverseAccess, <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> AccessMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a187">SeAuditingFileEvents</a> (IN BOOLEAN AccessGranted, IN PSECURITY_DESCRIPTOR SecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a188">SeAuditingFileOrGlobalEvents</a> (IN BOOLEAN AccessGranted, IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a189">SeAuditProcessCreation</a> (<a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Parent, PUNICODE_STRING ImageFileName)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a190">SeAuditProcessExit</a> (<a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a191">SeAuditHandleDuplication</a> (PVOID SourceHandle, PVOID NewHandle, <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> SourceProcess, <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> TargetProcess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a192">SeSetAccessStateGenericMapping</a> (<a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a> AccessState, PGENERIC_MAPPING GenericMapping)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a193">SeRegisterLogonSessionTerminatedRoutine</a> (IN <a class="el" href="../../d0/d5/se_8h.html#a35">PSE_LOGON_SESSION_TERMINATED_ROUTINE</a> CallbackRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a194">SeUnregisterLogonSessionTerminatedRoutine</a> (IN <a class="el" href="../../d0/d5/se_8h.html#a35">PSE_LOGON_SESSION_TERMINATED_ROUTINE</a> CallbackRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a195">SeMarkLogonSessionForTerminationNotification</a> (IN PLUID LogonId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a196">SeQueryInformationToken</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>, IN TOKEN_INFORMATION_CLASS TokenInformationClass, OUT PVOID *TokenInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a197">SeIsChildToken</a> (IN HANDLE <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>, OUT PBOOLEAN IsChild)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a198">SeIsChildTokenByPointer</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>, OUT PBOOLEAN IsChild)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a199">SeFastFilterToken</a> (IN PACCESS_TOKEN ExistingToken, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> RequestorMode, IN ULONG Flags, IN ULONG GroupCount, IN PSID_AND_ATTRIBUTES GroupsToDisable OPTIONAL, IN ULONG PrivilegeCount, IN PLUID_AND_ATTRIBUTES PrivilegesToDelete OPTIONAL, IN ULONG SidCount, IN PSID_AND_ATTRIBUTES RestrictedSids OPTIONAL, IN ULONG SidLength, OUT PACCESS_TOKEN *FilteredToken)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">_OBJECT_TYPE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a36">SepTokenObjectType</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI <a class="el" href="../../d2/d0/struct__SE__EXPORTS.html">PSE_EXPORTS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a37">SeExports</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a38">SeSystemAuthenticationId</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a39">SeAnonymousAuthenticationId</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>TOKEN_SOURCE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a40">SeSystemTokenSource</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a41">SeNullSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a42">SeWorldSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a43">SeLocalSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a44">SeCreatorOwnerSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a45">SeCreatorGroupSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a46">SeCreatorOwnerServerSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a47">SeCreatorGroupServerSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a48">SePrincipalSelfSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a49">SeNtAuthoritySid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a50">SeDialupSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a51">SeNetworkSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a52">SeBatchSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a53">SeInteractiveSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a54">SeLocalSystemSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a55">SeAuthenticatedUsersSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a56">SeAliasAdminsSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a57">SeRestrictedSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a58">SeAnonymousLogonSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a59">SeAliasUsersSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a60">SeAliasGuestsSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a61">SeAliasPowerUsersSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a62">SeAliasAccountOpsSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a63">SeAliasSystemOpsSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a64">SeAliasPrintOpsSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a65">SeAliasBackupOpsSid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PACCESS_TOKEN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a66">SeAnonymousLogonToken</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSECURITY_DESCRIPTOR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a67">SePublicDefaultSd</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSECURITY_DESCRIPTOR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a68">SePublicDefaultUnrestrictedSd</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSECURITY_DESCRIPTOR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a69">SePublicOpenSd</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSECURITY_DESCRIPTOR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a70">SePublicOpenUnrestrictedSd</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSECURITY_DESCRIPTOR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a71">SeSystemDefaultSd</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PSECURITY_DESCRIPTOR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a72">SeUnrestrictedSd</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PACL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a73">SePublicDefaultDacl</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PACL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a74">SePublicDefaultUnrestrictedDacl</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PACL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a75">SePublicOpenDacl</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PACL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a76">SePublicOpenUnrestrictedDacl</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PACL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a77">SeSystemDefaultDacl</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PACL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a78">SeUnrestrictedDacl</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a79">SeCreateTokenPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a80">SeAssignPrimaryTokenPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a81">SeLockMemoryPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a82">SeIncreaseQuotaPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a83">SeUnsolicitedInputPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a84">SeTcbPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a85">SeSecurityPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a86">SeTakeOwnershipPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a87">SeLoadDriverPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a88">SeCreatePagefilePrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a89">SeIncreaseBasePriorityPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a90">SeSystemProfilePrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a91">SeSystemtimePrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a92">SeProfileSingleProcessPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a93">SeCreatePermanentPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a94">SeBackupPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a95">SeRestorePrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a96">SeShutdownPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a97">SeDebugPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a98">SeAuditPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a99">SeSystemEnvironmentPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a100">SeChangeNotifyPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a101">SeRemoteShutdownPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a102">SeUndockPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a103">SeSyncAgentPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LUID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a104">SeEnableDelegationPrivilege</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d0/struct__SE__AUDITING__STATE.html">SE_AUDITING_STATE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a105">SeAuditingState</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a106">SeDetailedAuditing</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d5/se_8h.html#a107">SeSubsystemName</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a7" doxytag="se.h::INITIAL_PRIVILEGE_COUNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define INITIAL_PRIVILEGE_COUNT&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00147">147</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/seastate_8c-source.html#l00434">SeAppendPrivileges()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="se.h::SE_BACKUP_PRIVILEGES_CHECKED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SE_BACKUP_PRIVILEGES_CHECKED&nbsp;&nbsp;&nbsp;0x00000010          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00085">85</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/parse_8c-source.html#l02048">IopCheckBackupRestorePrivilege()</a>, and <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="se.h::SE_DEFAULT_SECURITY_QUOTA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SE_DEFAULT_SECURITY_QUOTA&nbsp;&nbsp;&nbsp;2048          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00062">62</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01861">ObpChargeQuotaForObject()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l01473">ObValidateSecurityQuota()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="se.h::SeAssertMappedCanonicalAccess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SeAssertMappedCanonicalAccess          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">AccessMask&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!( ( AccessMask ) &amp;                                       \
            ( GENERIC_READ        |                                  \
              GENERIC_WRITE       |                                  \
              GENERIC_EXECUTE     |                                  \
              GENERIC_ALL ))                                         \
          )
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00650">650</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, and <a class="el" href="../../d1/d3/accessck_8c-source.html#l01564">SepAccessCheck()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="se.h::SeComputeDeniedAccesses" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SeComputeDeniedAccesses          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">GrantedAccess,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>DesiredAccess&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((~(GrantedAccess)) &amp; (DesiredAccess) )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00480">480</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l02340">IoCheckDesiredAccess()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l02547">IoCheckFunctionAccess()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00038">NtSignalAndWaitForSingleObject()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00406">NtWaitForMultipleObjects()</a>, and <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="se.h::SeComputeGrantedAccesses" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SeComputeGrantedAccesses          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">GrantedAccess,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>DesiredAccess&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((GrantedAccess) &amp; (DesiredAccess) )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00515">515</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l02547">IoCheckFunctionAccess()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l08084">IopXxxControlFile()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00386">NtFlushBuffersFile()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00035">NtLockFile()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00458">NtUnlockFile()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00035">NtWriteFile()</a>, and <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00801">NtWriteFileGather()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="se.h::SeComputeSecurityQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SeComputeSecurityQuota          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                                                                  \
       ((( <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> ) * 2 )  &gt; <a class="code" href="../../d0/d5/se_8h.html#a0">SE_DEFAULT_SECURITY_QUOTA</a>) ?                \
                    (( <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> ) * 2 ) : <a class="code" href="../../d0/d5/se_8h.html#a0">SE_DEFAULT_SECURITY_QUOTA</a>        \
    )
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00676">676</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00248">ObpCaptureObjectCreateInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="se.h::SeDeleteClientSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SeDeleteClientSecurity          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">C&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                                           \
            <span class="keywordflow">if</span> (<a class="code" href="../../d0/d5/se_8h.html#a156">SeTokenType</a>((C)-&gt;ClientToken) == TokenPrimary) {               \
                <a class="code" href="../../d1/d9/ps_8h.html#a24">PsDereferencePrimaryToken</a>( (C)-&gt;ClientToken );                 \
            } <span class="keywordflow">else</span> {                                                           \
                <a class="code" href="../../d1/d9/ps_8h.html#a26">PsDereferenceImpersonationToken</a>( (C)-&gt;ClientToken );           \
            }                                                                  \
        }
</div></pre>*++ 
<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00612">612</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/cmapi_8c-source.html#l01901">CmLoadKey()</a>, <a class="el" href="../../d6/d3/kernel_2ddetrack_8c-source.html#l02042">FreeDdeConv()</a>, <a class="el" href="../../d2/d6/lpcpriv_8c-source.html#l00296">LpcpFreePortClientSecurity()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l10107">MESSAGECALL()</a>, and <a class="el" href="../../d0/d0/psimpers_8c-source.html#l00026">NtImpersonateThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="se.h::SeEnableAccessToExports" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SeEnableAccessToExports          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01589">1589</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00152">InitSecurity()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="se.h::SeLengthSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SeLengthSid          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Sid&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(8 + (4 * ((SID *)Sid)-&gt;SubAuthorityCount))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00540">540</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/cmse_8c-source.html#l01227">CmpHiveRootSecurityDescriptor()</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00299">CreateDAclToken()</a>, <a class="el" href="../../d5/d2/rtsetsec_8c-source.html#l00122">GenerateDescriptor()</a>, <a class="el" href="../../d6/d8/arcsec_8c-source.html#l00168">IopApplySystemPartitionProt()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02492">NtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02627">NtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d0/d3/tokenqry_8c-source.html#l00034">NtQueryInformationToken()</a>, <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00037">NtSetInformationToken()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">ObInitSystem()</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l01098">RtlAddCompoundAce()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01380">RtlCopySid()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01436">RtlCopySidAndAttributesArray()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00871">RtlEqualSid()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02165">RtlLengthSecurityDescriptor()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01350">RtlLengthSid()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02265">RtlLengthUsedSecurityDescriptor()</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l01242">RtlpAddKnownAce()</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l01405">RtlpAddKnownObjectAce()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l06520">RtlpConvertToAutoInheritSecurityObject()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l03880">RtlpCopyEffectiveAce()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l08588">RtlpCreateServerAcl()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d8/d0/rtlassig_8c-source.html#l00425">RtlpQuerySecurityDescriptor()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>, <a class="el" href="../../d5/d7/seurtl_8c-source.html#l00418">RtlQuerySecurityObject()</a>, <a class="el" href="../../d8/d0/rtlassig_8c-source.html#l00049">RtlSelfRelativeToAbsoluteSD()</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l00187">RtlValidAcl()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l11089">RtlValidRelativeSecurityDescriptor()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00529">SeAssignWorldSecurityDescriptor()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l02350">SeComputeQuotaInformationSize()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l01010">SeMakeAnonymousLogonToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l01099">SepAdjustGroups()</a>, <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00778">SepAppendDefaultDacl()</a>, <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00697">SepAppendPrimaryGroup()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00049">SepCreateImpersonationTokenDacl()</a>, <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00635">SepFreeDefaultDacl()</a>, <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00576">SepFreePrimaryGroup()</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>, <a class="el" href="../../d0/d3/tokenqry_8c-source.html#l01189">SeQueryInformationToken()</a>, <a class="el" href="../../d1/d5/semethod_8c-source.html#l00559">SeQuerySecurityDescriptorInfo()</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00060">SeRmInitPhase1()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l02414">SeValidSecurityDescriptor()</a>, <a class="el" href="../../d2/d0/ctsertl_8c-source.html#l00042">TestSeSid()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l03311">TestTokenSet()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="se.h::SeQuerySubjectContextToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SeQuerySubjectContextToken          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">SubjectContext&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>( ARGUMENT_PRESENT( ((<a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>) SubjectContext)-&gt;ClientToken) ? \
            ((<a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>) SubjectContext)-&gt;ClientToken : \
            ((<a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>) SubjectContext)-&gt;PrimaryToken )
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00732">732</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00532">NtSetUuidSeed()</a>, and <a class="el" href="../../d5/d4/seclient_8c-source.html#l00712">SeCreateClientSecurityFromSubjectContext()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="se.h::SeSameToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SeSameToken          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">TC1,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>TC2&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                                               \
        ((TC1)-&gt;TokenId.HighPart == (TC2)-&gt;TokenId.HighPart)               &amp;&amp; \
        ((TC1)-&gt;TokenId.LowPart  == (TC2)-&gt;TokenId.LowPart)                &amp;&amp; \
        (<a class="code" href="../../d8/d6/sertl_8c.html#a14">RtlEqualLuid</a>(&amp;(TC1)-&gt;AuthenticationId,&amp;(TC2)-&gt;AuthenticationId))     \
        )
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00577">577</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="se.h::SeStopImpersonatingClient" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SeStopImpersonatingClient          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;PsRevertToSelf()</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
*++ 
<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00647">647</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="se.h::SeTokenObjectType" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SeTokenObjectType          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(PVOID)<a class="el" href="../../d8/d3/tokenp_8h.html#a19">SepTokenObjectType</a></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01213">1213</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">PsAssignImpersonationToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01256">PspAssignPrimaryToken()</a>, and <a class="el" href="../../d0/d1/psquery_8c-source.html#l00366">PspSetPrimaryToken()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="se.h::TOKEN_HAS_ADMIN_GROUP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TOKEN_HAS_ADMIN_GROUP&nbsp;&nbsp;&nbsp;0x08          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00075">75</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00806">SepMakeTokenEffectiveOnly()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01041">SepRemoveDisabledGroupsAndPrivileges()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l00150">SeTokenIsAdmin()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="se.h::TOKEN_HAS_BACKUP_PRIVILEGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TOKEN_HAS_BACKUP_PRIVILEGE&nbsp;&nbsp;&nbsp;0x02          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00073">73</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/parse_8c-source.html#l02048">IopCheckBackupRestorePrivilege()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="se.h::TOKEN_HAS_RESTORE_PRIVILEGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TOKEN_HAS_RESTORE_PRIVILEGE&nbsp;&nbsp;&nbsp;0x04          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00074">74</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/parse_8c-source.html#l02048">IopCheckBackupRestorePrivilege()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="se.h::TOKEN_HAS_TRAVERSE_PRIVILEGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TOKEN_HAS_TRAVERSE_PRIVILEGE&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00072">72</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l01081">ObpLookupObjectName()</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00180">SeCreateAccessState()</a>, <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l00819">SepAdjustPrivileges()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, and <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01041">SepRemoveDisabledGroupsAndPrivileges()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="se.h::TOKEN_IS_RESTRICTED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TOKEN_IS_RESTRICTED&nbsp;&nbsp;&nbsp;0x10          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00076">76</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00778">ObpCheckTraverseAccess()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03796">SepTokenIsOwner()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l00181">SeTokenIsRestricted()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a25" doxytag="se.h::ACCESS_STATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">_ACCESS_STATE</a>  <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">ACCESS_STATE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d4/seastate_8c-source.html#l00180">SeCreateAccessState()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="se.h::AUX_ACCESS_DATA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">_AUX_ACCESS_DATA</a>  <a class="el" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">AUX_ACCESS_DATA</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="se.h::INITIAL_PRIVILEGE_SET" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d2/struct__INITIAL__PRIVILEGE__SET.html">_INITIAL_PRIVILEGE_SET</a>  <a class="el" href="../../d3/d2/struct__INITIAL__PRIVILEGE__SET.html">INITIAL_PRIVILEGE_SET</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="se.h::PACCESS_STATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">_ACCESS_STATE</a> * <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="se.h::PAUX_ACCESS_DATA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">_AUX_ACCESS_DATA</a> * <a class="el" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d0/obhandle_8c-source.html#l02160">ObpCreateHandle()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="se.h::PINITIAL_PRIVILEGE_SET" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d2/struct__INITIAL__PRIVILEGE__SET.html">_INITIAL_PRIVILEGE_SET</a> *  <a class="el" href="../../d3/d2/struct__INITIAL__PRIVILEGE__SET.html">PINITIAL_PRIVILEGE_SET</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="se.h::PSE_AUDITING_STATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d0/struct__SE__AUDITING__STATE.html">_SE_AUDITING_STATE</a> * <a class="el" href="../../d1/d0/struct__SE__AUDITING__STATE.html">PSE_AUDITING_STATE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="se.h::PSE_EXPORTS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d0/struct__SE__EXPORTS.html">_SE_EXPORTS</a> * <a class="el" href="../../d2/d0/struct__SE__EXPORTS.html">PSE_EXPORTS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="se.h::PSE_LOGON_SESSION_TERMINATED_ROUTINE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef NTSTATUS(* <a class="el" href="../../d0/d5/se_8h.html#a35">PSE_LOGON_SESSION_TERMINATED_ROUTINE</a>)(IN PLUID LogonId)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00434">434</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00849">SeRegisterLogonSessionTerminatedRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="se.h::PSE_PROCESS_AUDIT_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d0/struct__SE__PROCESS__AUDIT__INFO.html">_SE_PROCESS_AUDIT_INFO</a> * <a class="el" href="../../d3/d0/struct__SE__PROCESS__AUDIT__INFO.html">PSE_PROCESS_AUDIT_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d0/obinit_8c-source.html#l00759">ObAuditInheritedHandleProcedure()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="se.h::PSECURITY_OPERATION_CODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d0/d5/se_8h.html#a200">_SECURITY_OPERATION_CODE</a> * <a class="el" href="../../d0/d5/se_8h.html#a20">PSECURITY_OPERATION_CODE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="se.h::PSECURITY_SUBJECT_CONTEXT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">_SECURITY_SUBJECT_CONTEXT</a> * <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="se.h::SE_AUDITING_STATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d0/struct__SE__AUDITING__STATE.html">_SE_AUDITING_STATE</a>  <a class="el" href="../../d1/d0/struct__SE__AUDITING__STATE.html">SE_AUDITING_STATE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="se.h::SE_EXPORTS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d0/struct__SE__EXPORTS.html">_SE_EXPORTS</a>  <a class="el" href="../../d2/d0/struct__SE__EXPORTS.html">SE_EXPORTS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="se.h::SE_PROCESS_AUDIT_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d0/struct__SE__PROCESS__AUDIT__INFO.html">_SE_PROCESS_AUDIT_INFO</a>  <a class="el" href="../../d3/d0/struct__SE__PROCESS__AUDIT__INFO.html">SE_PROCESS_AUDIT_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d0/obinit_8c-source.html#l00815">ObInitProcess()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="se.h::SECURITY_OPERATION_CODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d0/d5/se_8h.html#a200">_SECURITY_OPERATION_CODE</a>  <a class="el" href="../../d0/d5/se_8h.html#a19">SECURITY_OPERATION_CODE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="se.h::SECURITY_SUBJECT_CONTEXT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">_SECURITY_SUBJECT_CONTEXT</a>  <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, and <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">SeSinglePrivilegeCheck()</a>.    </td>
  </tr>
</table>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="a200" doxytag="se.h::_SECURITY_OPERATION_CODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d0/d5/se_8h.html#a200">_SECURITY_OPERATION_CODE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a200a108" doxytag="SetSecurityDescriptor" ></a>SetSecurityDescriptor</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a200a109" doxytag="QuerySecurityDescriptor" ></a>QuerySecurityDescriptor</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a200a110" doxytag="DeleteSecurityDescriptor" ></a>DeleteSecurityDescriptor</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a200a111" doxytag="AssignSecurityDescriptor" ></a>AssignSecurityDescriptor</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l00043">43</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
<pre class="fragment"><div>00043                                       {
00044     <a class="code" href="../../d0/d5/se_8h.html#a200a108">SetSecurityDescriptor</a>,
00045     <a class="code" href="../../d0/d5/se_8h.html#a200a109">QuerySecurityDescriptor</a>,
00046     <a class="code" href="../../d0/d5/se_8h.html#a200a110">DeleteSecurityDescriptor</a>,
00047     <a class="code" href="../../d0/d5/se_8h.html#a200a111">AssignSecurityDescriptor</a>
00048     } <a class="code" href="../../d0/d5/se_8h.html#a19">SECURITY_OPERATION_CODE</a>, *<a class="code" href="../../d0/d5/se_8h.html#a20">PSECURITY_OPERATION_CODE</a>;
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a135" doxytag="se.h::SeAccessCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN SeAccessCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectSecurityContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContextLocked</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviouslyGrantedAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PPRIVILEGE_SET *Privileges&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>GrantedAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PNTSTATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">3323</a> of file <a class="el" href="../../d1/d3/accessck_8c-source.html">accessck.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d0/d5/se_8h.html#a22">PSECURITY_SUBJECT_CONTEXT</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00650">SeAssertMappedCanonicalAccess</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00115">SeLockSubjectContext()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l01564">SepAccessCheck()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00650">SepDumpSecurityDescriptor()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00995">SepDumpTokenInfo()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03796">SepTokenIsOwner()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00159">SeUnlockSubjectContext()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/cmse_8c-source.html#l00917">CmpCheckCreateAccess()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l01032">CmpCheckNotifyAccess()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00983">ObCheckCreateObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00392">ObCheckObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00602">ObpCheckObjectReference()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00778">ObpCheckTraverseAccess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00366">PspSetPrimaryToken()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03564">SeProxyAccessCheck()</a>, and <a class="el" href="../../d2/d5/tse_8c-source.html#l00503">TestAccessCheck()</a>.
<p>
<pre class="fragment"><div>03338                    :
03339 
03340     See module <span class="keyword">abstract</span>
03341 
03342     This routine MAY perform tests <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following
03343     privileges:
03344 
03345                 <a class="code" href="../../d0/d5/se_8h.html#a86">SeTakeOwnershipPrivilege</a>
03346                 <a class="code" href="../../d0/d5/se_8h.html#a85">SeSecurityPrivilege</a>
03347 
03348     depending upon <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> accesses being requested.
03349 
03350     This routine may also check to see <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner
03351     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object (to grant WRITE_DAC access).
03352 
03353 Arguments:
03354 
03355     SecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor protecting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03356          object being accessed
03357 
03358     SubjectSecurityContext - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject's captured security
03359          context
03360 
03361     SubjectContextLocked - Supplies a flag indiciating whether or not
03362         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user's subject context <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> locked, so that <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> does not have
03363         to be locked again.
03364 
03365     DesiredAccess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access mask that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> attempting to
03366          acquire
03367 
03368     PreviouslyGrantedAccess - Supplies any accesses that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user has
03369         already been granted, <span class="keywordflow">for</span> example, as a result of holding a
03370         privilege.
03371 
03372     Privileges - Supplies a pointer in which will be returned a privilege
03373         set indicating any privileges that were used as part of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03374         access validation.
03375 
03376     GenericMapping - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> generic mapping associated with <span class="keyword">this</span>
03377         object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
03378 
03379     AccessMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access mode to be used in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> check
03380 
03381     GrantedAccess - Pointer to a returned access mask indicatating <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03382          granted access
03383 
03384     AccessStatus - <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> value that may be returned indicating <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03385          <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> why access was denied.  Routines should avoid hardcoding a
03386          <span class="keywordflow">return</span> value of STATUS_ACCESS_DENIED so that a different value can
03387          be returned when mandatory access <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> implemented.
03388 
03389 
03390 Return Value:
03391 
03392     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allowed and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise
03393 
03394 --*/
03395 
03396 {
03397     BOOLEAN Success;
03398 
03399     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03400 
03401     <span class="keywordflow">if</span> (AccessMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
03402 
03403         <span class="keywordflow">if</span> (DesiredAccess &amp; MAXIMUM_ALLOWED) {
03404 
03405             <span class="comment">//</span>
03406             <span class="comment">// Give him:</span>
03407             <span class="comment">//   GenericAll</span>
03408             <span class="comment">//   Anything else he asked for</span>
03409             <span class="comment">//</span>
03410 
03411             *GrantedAccess = GenericMapping-&gt;GenericAll;
03412             *GrantedAccess |= (DesiredAccess &amp; ~MAXIMUM_ALLOWED);
03413             *GrantedAccess |= PreviouslyGrantedAccess;
03414 
03415         } <span class="keywordflow">else</span> {
03416 
03417             *GrantedAccess = DesiredAccess | PreviouslyGrantedAccess;
03418         }
03419         *AccessStatus = STATUS_SUCCESS;
03420         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03421     }
03422 
03423     <span class="comment">//</span>
03424     <span class="comment">// If the object doesn't have a security descriptor (and it's supposed</span>
03425     <span class="comment">// to), return access denied.</span>
03426     <span class="comment">//</span>
03427 
03428     <span class="keywordflow">if</span> ( SecurityDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03429 
03430        *AccessStatus = STATUS_ACCESS_DENIED;
03431        <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
03432 
03433     }
03434 
03435     <span class="comment">//</span>
03436     <span class="comment">// If we're impersonating a client, we have to be at impersonation level</span>
03437     <span class="comment">// of SecurityImpersonation or above.</span>
03438     <span class="comment">//</span>
03439 
03440     <span class="keywordflow">if</span> ( (SubjectSecurityContext-&gt;ClientToken != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
03441          (SubjectSecurityContext-&gt;ImpersonationLevel &lt; SecurityImpersonation)
03442        ) {
03443            *AccessStatus = STATUS_BAD_IMPERSONATION_LEVEL;
03444            <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
03445     }
03446 
03447     <span class="keywordflow">if</span> ( DesiredAccess == 0 ) {
03448 
03449         <span class="keywordflow">if</span> ( PreviouslyGrantedAccess == 0 ) {
03450             *AccessStatus = STATUS_ACCESS_DENIED;
03451             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
03452         }
03453 
03454         *GrantedAccess = PreviouslyGrantedAccess;
03455         *AccessStatus = STATUS_SUCCESS;
03456         *Privileges = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03457         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
03458 
03459     }
03460 
03461     <a class="code" href="../../d0/d5/se_8h.html#a14">SeAssertMappedCanonicalAccess</a>( DesiredAccess );
03462 
03463 
03464     <span class="comment">//</span>
03465     <span class="comment">// If the caller did not lock the subject context for us,</span>
03466     <span class="comment">// lock it here to keep lower level routines from having</span>
03467     <span class="comment">// to lock it.</span>
03468     <span class="comment">//</span>
03469 
03470     <span class="keywordflow">if</span> ( !SubjectContextLocked ) {
03471         <a class="code" href="../../d0/d8/subject_8c.html#a1">SeLockSubjectContext</a>( SubjectSecurityContext );
03472     }
03473 
03474     <span class="comment">//</span>
03475     <span class="comment">// If the user in the token is the owner of the object, we</span>
03476     <span class="comment">// must automatically grant ReadControl and WriteDac access</span>
03477     <span class="comment">// if desired.  If the DesiredAccess mask is empty after</span>
03478     <span class="comment">// these bits are turned off, we don't have to do any more</span>
03479     <span class="comment">// access checking (ref section 4, DSA ACL Arch)</span>
03480     <span class="comment">//</span>
03481 
03482     <span class="keywordflow">if</span> ( DesiredAccess &amp; (WRITE_DAC | READ_CONTROL | MAXIMUM_ALLOWED) ) {
03483 
03484         <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d6/sep_8h.html#a54">SepTokenIsOwner</a>(
03485                  <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( SubjectSecurityContext ),
03486                  SecurityDescriptor,
03487                  TRUE
03488                  ) ) {
03489 
03490             <span class="keywordflow">if</span> ( DesiredAccess &amp; MAXIMUM_ALLOWED ) {
03491 
03492                 PreviouslyGrantedAccess |= (WRITE_DAC | READ_CONTROL);
03493 
03494             } <span class="keywordflow">else</span> {
03495 
03496                 PreviouslyGrantedAccess |= (DesiredAccess &amp; (WRITE_DAC | READ_CONTROL));
03497             }
03498 
03499             DesiredAccess &amp;= ~(WRITE_DAC | READ_CONTROL);
03500         }
03501     }
03502 
03503     <span class="keywordflow">if</span> (DesiredAccess == 0) {
03504 
03505         <span class="keywordflow">if</span> ( !SubjectContextLocked ) {
03506             <a class="code" href="../../d0/d8/subject_8c.html#a2">SeUnlockSubjectContext</a>( SubjectSecurityContext );
03507         }
03508 
03509         *GrantedAccess = PreviouslyGrantedAccess;
03510         *AccessStatus = STATUS_SUCCESS;
03511         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
03512 
03513     } <span class="keywordflow">else</span> {
03514 
03515         <a class="code" href="../../d8/d3/tokenp_8h.html#a38">SepAccessCheck</a>(
03516                     SecurityDescriptor,
03517                     NULL,   <span class="comment">// No PrincipalSelfSid</span>
03518                     SubjectSecurityContext-&gt;PrimaryToken,
03519                     SubjectSecurityContext-&gt;ClientToken,
03520                     DesiredAccess,
03521                     NULL,   <span class="comment">// No object type list</span>
03522                     0,      <span class="comment">// No object type list</span>
03523                     GenericMapping,
03524                     PreviouslyGrantedAccess,
03525                     AccessMode,
03526                     GrantedAccess,
03527                     Privileges,
03528                     AccessStatus,
03529                     FALSE,   <span class="comment">// Don't return a list</span>
03530                     &amp;Success,
03531                     NULL
03532                     );
03533 <span class="preprocessor">#if DBG</span>
03534 <span class="preprocessor"></span>          <span class="keywordflow">if</span> (!Success &amp;&amp; SepShowAccessFail) {
03535               <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SE: Access check failed, DesiredAccess = 0x%x\n"</span>,
03536                 DesiredAccess);
03537               SepDumpSD = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03538               <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>(
03539                   SecurityDescriptor,
03540                   <span class="stringliteral">"Input to SeAccessCheck\n"</span>
03541                   );
03542               SepDumpSD = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03543               SepDumpToken = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03544               <a class="code" href="../../d6/d6/sep_8h.html#a59">SepDumpTokenInfo</a>( <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( SubjectSecurityContext ) );
03545               SepDumpToken = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03546           }
03547 <span class="preprocessor">#endif</span>
03548 <span class="preprocessor"></span>
03549         <span class="comment">//</span>
03550         <span class="comment">// If we locked it in this routine, unlock it before we</span>
03551         <span class="comment">// leave.</span>
03552         <span class="comment">//</span>
03553 
03554         <span class="keywordflow">if</span> ( !SubjectContextLocked ) {
03555             <a class="code" href="../../d0/d8/subject_8c.html#a2">SeUnlockSubjectContext</a>( SubjectSecurityContext );
03556         }
03557 
03558         <span class="keywordflow">return</span>( Success );
03559     }
03560 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a180" doxytag="se.h::SeAppendPrivileges" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeAppendPrivileges           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PPRIVILEGE_SET&nbsp;</td>
          <td class="mdname" nowrap> <em>Privileges</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/seastate_8c-source.html#l00434">434</a> of file <a class="el" href="../../d3/d4/seastate_8c-source.html">seastate.c</a>.
<p>
References <a class="el" href="../../d1/d4/se_8h-source.html#l00175">_ACCESS_STATE::AuxData</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00147">INITIAL_PRIVILEGE_COUNT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00168">_ACCESS_STATE::PrivilegesAllocated</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00258">_AUX_ACCESS_DATA::PrivilegesUsed</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00543">SepConcatenatePrivileges()</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00147">SepPrivilegeSetSize</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/parse_8c-source.html#l02048">IopCheckBackupRestorePrivilege()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00983">ObCheckCreateObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00392">ObCheckObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00778">ObpCheckTraverseAccess()</a>, and <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01232">ObpIncrementHandleCount()</a>.
<p>
<pre class="fragment"><div>00440                    :
00441 
00442     This routine takes a privilege set and adds <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege set
00443     imbedded in an <a class="code" href="../../d2/d5/struct__ACCESS__STATE.html">ACCESS_STATE</a> structure.
00444 
00445     An AccessState may contain up to three imbedded privileges.  To
00446     add more, <span class="keyword">this</span> routine will allocate a block of memory, copy
00447     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current privileges into <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>, and append <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> privilege
00448     to that block.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> bit <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> AccessState indicating that
00449     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilge set in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> structure points to <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
00450     memory and must be deallocated.
00451 
00452 Arguments:
00453 
00454     AccessState - The AccessState structure representing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
00455         access attempt.
00456 
00457     Privileges - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to a privilege set to be added.
00458 
00459 Return Value:
00460 
00461     STATUS_INSUFFICIENT_RESOURCES - an attempt to allocate <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> memory
00462         failed.
00463 
00464 --*/
00465 
00466 {
00467     ULONG NewPrivilegeSetSize;
00468     PPRIVILEGE_SET NewPrivilegeSet;
00469     <a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a> AuxData;
00470 
00471     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00472 
00473     AuxData = (<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a>)AccessState-&gt;<a class="code" href="../../d2/d5/struct__ACCESS__STATE.html#o11">AuxData</a>;
00474 
00475     <span class="keywordflow">if</span> (Privileges-&gt;PrivilegeCount + AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a>-&gt;PrivilegeCount &gt;
00476         <a class="code" href="../../d0/d5/se_8h.html#a7">INITIAL_PRIVILEGE_COUNT</a>) {
00477 
00478         <span class="comment">//</span>
00479         <span class="comment">// Compute the total size of the two privilege sets</span>
00480         <span class="comment">//</span>
00481 
00482         NewPrivilegeSetSize =  <a class="code" href="../../d6/d6/sep_8h.html#a6">SepPrivilegeSetSize</a>( Privileges ) +
00483                                <a class="code" href="../../d6/d6/sep_8h.html#a6">SepPrivilegeSetSize</a>( AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a> );
00484 
00485         NewPrivilegeSet = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, NewPrivilegeSetSize, 'rPeS' );
00486 
00487         <span class="keywordflow">if</span> (NewPrivilegeSet == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00488             <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
00489         }
00490 
00491 
00492         RtlCopyMemory(
00493             NewPrivilegeSet,
00494             AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a>,
00495             <a class="code" href="../../d6/d6/sep_8h.html#a6">SepPrivilegeSetSize</a>( AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a> )
00496             );
00497 
00498         <span class="comment">//</span>
00499         <span class="comment">// Note that this will adjust the privilege count in the</span>
00500         <span class="comment">// structure for us.</span>
00501         <span class="comment">//</span>
00502 
00503         <a class="code" href="../../d6/d6/sep_8h.html#a53">SepConcatenatePrivileges</a>(
00504             NewPrivilegeSet,
00505             NewPrivilegeSetSize,
00506             Privileges
00507             );
00508 
00509         <span class="keywordflow">if</span> (AccessState-&gt;<a class="code" href="../../d2/d5/struct__ACCESS__STATE.html#o4">PrivilegesAllocated</a>) {
00510             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a> );
00511         }
00512 
00513         AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a> = NewPrivilegeSet;
00514 
00515         <span class="comment">//</span>
00516         <span class="comment">// Mark that we've allocated memory for the privilege set,</span>
00517         <span class="comment">// so we know to free it when we're cleaning up.</span>
00518         <span class="comment">//</span>
00519 
00520         AccessState-&gt;<a class="code" href="../../d2/d5/struct__ACCESS__STATE.html#o4">PrivilegesAllocated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00521 
00522     } <span class="keywordflow">else</span> {
00523 
00524         <span class="comment">//</span>
00525         <span class="comment">// Note that this will adjust the privilege count in the</span>
00526         <span class="comment">// structure for us.</span>
00527         <span class="comment">//</span>
00528 
00529         <a class="code" href="../../d6/d6/sep_8h.html#a53">SepConcatenatePrivileges</a>(
00530             AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a>,
00531             <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d2/struct__INITIAL__PRIVILEGE__SET.html">INITIAL_PRIVILEGE_SET</a>),
00532             Privileges
00533             );
00534 
00535     }
00536 
00537     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00538 
00539 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a161" doxytag="se.h::SeAssignPrimaryToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeAssignPrimaryToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l00241">241</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00302">SeDeassignPrimaryToken()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01117">PspInitializeProcessSecurity()</a>.
<p>
<pre class="fragment"><div>00249                    :
00250 
00251     This function establishes a primary token <span class="keywordflow">for</span> a process.
00252 
00253 Arguments:
00254 
00255     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> primary token.
00256 
00257 Return Value:
00258 
00259     None.
00260 
00261 --*/
00262 
00263 {
00264 
00265     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00266         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00267 
00268     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>
00269         NewToken = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00270 
00271     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00272 
00273     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(NewToken-&gt;TokenType == TokenPrimary);
00274     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( !NewToken-&gt;TokenInUse );
00275 
00276 
00277     <span class="comment">//</span>
00278     <span class="comment">// Dereference the old token if there is one.</span>
00279     <span class="comment">//</span>
00280     <span class="comment">// Processes typically already have a token that must be</span>
00281     <span class="comment">// dereferenced.  There are two cases where this may not</span>
00282     <span class="comment">// be the situation.  First, during phase 0 system initialization,</span>
00283     <span class="comment">// the initial system process starts out without a token.  Second,</span>
00284     <span class="comment">// if an error occurs during process creation, we may be cleaning</span>
00285     <span class="comment">// up a process that hasn't yet had a primary token assigned.</span>
00286     <span class="comment">//</span>
00287 
00288     <span class="keywordflow">if</span> (Process-&gt;Token != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00289         <a class="code" href="../../d4/d3/token_8c.html#a8">SeDeassignPrimaryToken</a>( Process );
00290     }
00291 
00292 
00293     Process-&gt;Token=<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00294     NewToken-&gt;TokenInUse = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00295     <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(NewToken);
00296     <span class="keywordflow">return</span>;
00297 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a132" doxytag="se.h::SeAssignSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeAssignSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR ParentDescriptor&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>ExplicitDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname" nowrap> <em>NewDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>IsDirectoryObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00089">89</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00650">SepDumpSecurityDescriptor()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d1/cmparse2_8c-source.html#l00226">CmpDoCreateChild()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01574">ObAssignSecurity()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00360">TestAssignSecurity()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00101                    :
00102 
00103     This routine assumes privilege checking HAS NOT yet been performed
00104     and so will be performed by <span class="keyword">this</span> routine.
00105 
00106     This <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to build a security descriptor <span class="keywordflow">for</span> a <span class="keyword">new</span> object
00107     given <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of its parent directory and any originally
00108     requested security <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.  The <span class="keyword">final</span> security descriptor
00109     returned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller may contain a mix of information, some explicitly
00110     provided other from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object's parent.
00111 
00112 
00113     See <a class="code" href="../../d8/d6/sertl_8c.html#a76">RtlpNewSecurityObject</a> <span class="keywordflow">for</span> a descriptor of how <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> NewDescriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00114     built.
00115 
00116 
00117 Arguments:
00118 
00119     ParentDescriptor - Optionally supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00120         parent directory under which <span class="keyword">this</span> <span class="keyword">new</span> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being created.
00121 
00122     ExplicitDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security
00123         descriptor as specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be applied to
00124         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object.
00125 
00126     NewDescriptor - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> actual security descriptor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span>
00127         object that has been modified according to above rules.
00128 
00129     IsDirectoryObject - Specifies <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> itself a directory
00130         object.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a container of other
00131         objects.
00132 
00133     SubjectContext - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security context of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject creating <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00134         object. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to retrieve <span class="keywordflow">default</span> security information <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00135         <span class="keyword">new</span> object, such as <span class="keywordflow">default</span> owner, primary group, and discretionary
00136         access <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a>.
00137 
00138     GenericMapping - Supplies a pointer to an array of access mask values
00139         denoting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping between each generic right to non-generic rights.
00140 
00141     PoolType - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to use to when allocating a <span class="keyword">new</span>
00142         security descriptor.
00143 
00144 Return Value:
00145 
00146     STATUS_SUCCESS - indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation was successful.
00147 
00148     STATUS_INVALID_OWNER - The owner SID provided as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00149         target security descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not one <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> authorized
00150         to assign as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of an object.
00151 
00152     STATUS_PRIVILEGE_NOT_HELD - The caller does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege
00153         necessary to explicitly assign <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified system ACL.
00154         <a class="code" href="../../d0/d5/se_8h.html#a85">SeSecurityPrivilege</a> privilege <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to explicitly assign
00155         system ACLs to objects.
00156 --*/
00157 
00158 {
00159     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00160     ULONG AutoInherit = 0;
00161     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00162 
00163 <span class="preprocessor">#if DBG</span>
00164 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( ExplicitDescriptor) ) {
00165         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( ExplicitDescriptor,
00166                                    <span class="stringliteral">"\nSeAssignSecurity: Input security descriptor = \n"</span>
00167                                  );
00168     }
00169 
00170     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( ParentDescriptor )) {
00171         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( ParentDescriptor,
00172                                    <span class="stringliteral">"\nSeAssignSecurity: Parent security descriptor = \n"</span>
00173                                  );
00174     }
00175 <span class="preprocessor">#endif // DBG</span>
00176 <span class="preprocessor"></span>
00177     <span class="comment">//</span>
00178     <span class="comment">// If the Parent SD was created via AutoInheritance,</span>
00179     <span class="comment">//  and this object is being created with no explicit descriptor,</span>
00180     <span class="comment">//  then we can safely create this object as AutoInherit.</span>
00181     <span class="comment">//</span>
00182 
00183     <span class="keywordflow">if</span> ( ParentDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00184 
00185         <span class="keywordflow">if</span> ( (ExplicitDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00186               (((PISECURITY_DESCRIPTOR)ExplicitDescriptor)-&gt;Control &amp; SE_DACL_PRESENT) == 0 ) &amp;&amp;
00187              (((PISECURITY_DESCRIPTOR)ParentDescriptor)-&gt;Control &amp; SE_DACL_AUTO_INHERITED) != 0 ) {
00188             AutoInherit |= SEF_DACL_AUTO_INHERIT;
00189         }
00190 
00191         <span class="keywordflow">if</span> ( (ExplicitDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00192              (((PISECURITY_DESCRIPTOR)ExplicitDescriptor)-&gt;Control &amp; SE_SACL_PRESENT) == 0 ) &amp;&amp;
00193              (((PISECURITY_DESCRIPTOR)ParentDescriptor)-&gt;Control &amp; SE_SACL_AUTO_INHERITED) != 0 ) {
00194             AutoInherit |= SEF_SACL_AUTO_INHERIT;
00195         }
00196 
00197     }
00198 
00199 
00200     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a76">RtlpNewSecurityObject</a> (
00201                     ParentDescriptor OPTIONAL,
00202                     ExplicitDescriptor OPTIONAL,
00203                     NewDescriptor,
00204                     NULL,   <span class="comment">// No object type</span>
00205                     IsDirectoryObject,
00206                     AutoInherit,
00207                     (HANDLE) SubjectContext,
00208                     GenericMapping );
00209 
00210 <span class="preprocessor">#if DBG</span>
00211 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00212         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( *NewDescriptor,
00213                                    <span class="stringliteral">"SeAssignSecurity: Final security descriptor = \n"</span>
00214                                  );
00215     }
00216 <span class="preprocessor">#endif</span>
00217 <span class="preprocessor"></span>
00218     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00219 
00220 
00221     <span class="comment">// RtlpNewSecurityObject always uses PagedPool.</span>
00222     UNREFERENCED_PARAMETER( PagedPool );
00223 
00224 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a133" doxytag="se.h::SeAssignSecurityEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeAssignSecurityEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR ParentDescriptor&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR ExplicitDescriptor&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname" nowrap> <em>NewDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN GUID *ObjectType&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>IsDirectoryObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>AutoInheritFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00228">228</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00650">SepDumpSecurityDescriptor()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00242                    :
00243 
00244     This routine assumes privilege checking HAS NOT yet been performed
00245     and so will be performed by <span class="keyword">this</span> routine.
00246 
00247     This <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to build a security descriptor <span class="keywordflow">for</span> a <span class="keyword">new</span> object
00248     given <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of its parent directory and any originally
00249     requested security <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.  The <span class="keyword">final</span> security descriptor
00250     returned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller may contain a mix of information, some explicitly
00251     provided other from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object's parent.
00252 
00253 
00254     See <a class="code" href="../../d8/d6/sertl_8c.html#a76">RtlpNewSecurityObject</a> <span class="keywordflow">for</span> a descriptor of how <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> NewDescriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00255     built.
00256 
00257 
00258 Arguments:
00259 
00260     ParentDescriptor - Optionally supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00261         parent directory under which <span class="keyword">this</span> <span class="keyword">new</span> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being created.
00262 
00263     ExplicitDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security
00264         descriptor as specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be applied to
00265         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object.
00266 
00267     NewDescriptor - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> actual security descriptor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span>
00268         object that has been modified according to above rules.
00269 
00270     ObjectType - GUID of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> being created.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being
00271         created has no GUID associated with <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>, then <span class="keyword">this</span> argument <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00272         specified as <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>.
00273 
00274     IsDirectoryObject - Specifies <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> itself a directory
00275         object.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a container of other
00276         objects.
00277 
00278     AutoInheritFlags - Controls automatic inheritance of ACES from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Parent
00279         Descriptor.  Valid values are a bits mask of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> logical OR of
00280         one or more of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following bits:
00281 
00282         SEF_DACL_AUTO_INHERIT - If set, inherit ACEs from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00283             DACL ParentDescriptor are inherited to NewDescriptor in addition
00284             to any <span class="keyword">explicit</span> ACEs specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> CreatorDescriptor.
00285 
00286         SEF_SACL_AUTO_INHERIT - If set, inherit ACEs from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00287             SACL ParentDescriptor are inherited to NewDescriptor in addition
00288             to any <span class="keyword">explicit</span> ACEs specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> CreatorDescriptor.
00289 
00290         SEF_DEFAULT_DESCRIPTOR_FOR_OBJECT - If set, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> CreatorDescriptor
00291             <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> descriptor <span class="keywordflow">for</span> ObjectType.  As such, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00292             CreatorDescriptor will be ignored <span class="keywordflow">if</span> any ObjectType specific
00293             ACEs are inherited from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent.  If no such ACEs are inherited,
00294             <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> CreatorDescriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> handled as though <span class="keyword">this</span> flag were not
00295             specified.
00296 
00297         SEF_AVOID_PRIVILEGE_CHECK - If set, no privilege checking <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> done by <span class="keyword">this</span>
00298             routine.  This flag <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> useful <span class="keywordflow">while</span> implementing automatic inheritance
00299             to avoid checking privileges on each child updated.
00300 
00301     SubjectContext - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security context of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject creating <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00302         object. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to retrieve <span class="keywordflow">default</span> security information <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00303         <span class="keyword">new</span> object, such as <span class="keywordflow">default</span> owner, primary group, and discretionary
00304         access <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a>.
00305 
00306     GenericMapping - Supplies a pointer to an array of access mask values
00307         denoting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping between each generic right to non-generic rights.
00308 
00309     PoolType - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to use to when allocating a <span class="keyword">new</span>
00310         security descriptor.
00311 
00312 Return Value:
00313 
00314     STATUS_SUCCESS - indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation was successful.
00315 
00316     STATUS_INVALID_OWNER - The owner SID provided as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00317         target security descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not one <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> authorized
00318         to assign as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of an object.
00319 
00320     STATUS_PRIVILEGE_NOT_HELD - The caller does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege
00321         necessary to explicitly assign <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified system ACL.
00322         <a class="code" href="../../d0/d5/se_8h.html#a85">SeSecurityPrivilege</a> privilege <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to explicitly assign
00323         system ACLs to objects.
00324 --*/
00325 
00326 {
00327     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00328     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00329 
00330 <span class="preprocessor">#if DBG</span>
00331 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( ExplicitDescriptor) ) {
00332         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( ExplicitDescriptor,
00333                                    <span class="stringliteral">"\nSeAssignSecurityEx: Input security descriptor = \n"</span>
00334                                  );
00335     }
00336 
00337     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( ParentDescriptor )) {
00338         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( ParentDescriptor,
00339                                    <span class="stringliteral">"\nSeAssignSecurityEx: Parent security descriptor = \n"</span>
00340                                  );
00341     }
00342 <span class="preprocessor">#endif // DBG</span>
00343 <span class="preprocessor"></span>
00344 
00345     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a76">RtlpNewSecurityObject</a> (
00346                     ParentDescriptor OPTIONAL,
00347                     ExplicitDescriptor OPTIONAL,
00348                     NewDescriptor,
00349                     ObjectType,
00350                     IsDirectoryObject,
00351                     AutoInheritFlags,
00352                     (HANDLE) SubjectContext,
00353                     GenericMapping );
00354 
00355 <span class="preprocessor">#if DBG</span>
00356 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00357         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( *NewDescriptor,
00358                                    <span class="stringliteral">"SeAssignSecurityEx: Final security descriptor = \n"</span>
00359                                  );
00360     }
00361 <span class="preprocessor">#endif</span>
00362 <span class="preprocessor"></span>
00363     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00364 
00365 
00366     <span class="comment">// RtlpNewSecurityObject always uses PagedPool.</span>
00367     UNREFERENCED_PARAMETER( PagedPool );
00368 
00369 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a185" doxytag="se.h::SeAssignWorldSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeAssignWorldSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityInformation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00529">529</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02004">RtlCreateSecurityDescriptorRelative()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00540">SeLengthSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01609">SeWorldSid</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/objsup_8c-source.html#l00975">IopGetSetSecurityObject()</a>.
<p>
<pre class="fragment"><div>00537                    :
00538 
00539     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I/O system to properly initialize a
00540     security descriptor <span class="keywordflow">for</span> a FAT <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.  It will take a pointer to a
00541     buffer containing an emptry security descriptor, and create in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00542     buffer a <span class="keyword">self</span>-relative security descriptor with
00543 
00544         <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a8">WorldSid</a>,
00545 
00546         <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a8">WorldSid</a>.
00547 
00548     Thus, a FAT <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> accessable to all.
00549 
00550 Arguments:
00551 
00552     SecurityDescriptor - Supplies a pointer to a buffer in which will be
00553         created a <span class="keyword">self</span>-relative security descriptor as described above.
00554 
00555     Length - The length in bytes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> too
00556         small, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> will contain <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d0/d4/mrcf_8c.html#a3">minimum</a> size required upon <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>.
00557 
00558 
00559 Return Value:
00560 
00561     STATUS_BUFFER_TOO_SMALL - The buffer was not big enough to contain
00562         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested information.
00563 
00564 
00565 --*/
00566 
00567 {
00568 
00569     PCHAR Field;
00570     PCHAR Base;
00571     ULONG WorldSidLength;
00572     PISECURITY_DESCRIPTOR_RELATIVE ISecurityDescriptor;
00573     ULONG MinSize;
00574     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00575 
00576     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00577 
00578     <span class="keywordflow">if</span> ( !ARGUMENT_PRESENT( SecurityInformation )) {
00579 
00580         <span class="keywordflow">return</span>( STATUS_ACCESS_DENIED );
00581     }
00582 
00583     WorldSidLength = <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>( SeWorldSid );
00584 
00585     MinSize = <span class="keyword">sizeof</span>( SECURITY_DESCRIPTOR_RELATIVE ) + 2 * WorldSidLength;
00586 
00587     <span class="keywordflow">if</span> ( *Length &lt; MinSize ) {
00588 
00589         *Length = MinSize;
00590         <span class="keywordflow">return</span>( STATUS_BUFFER_TOO_SMALL );
00591     }
00592 
00593     *Length = MinSize;
00594 
00595     ISecurityDescriptor = (SECURITY_DESCRIPTOR_RELATIVE *)SecurityDescriptor;
00596 
00597     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a54">RtlCreateSecurityDescriptorRelative</a>( ISecurityDescriptor,
00598                                           SECURITY_DESCRIPTOR_REVISION );
00599 
00600     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00601         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00602     }
00603 
00604     Base = (PCHAR)(ISecurityDescriptor);
00605     Field =  Base + <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE);
00606 
00607     <span class="keywordflow">if</span> ( *SecurityInformation &amp; OWNER_SECURITY_INFORMATION ) {
00608 
00609         RtlCopyMemory( Field, SeWorldSid, WorldSidLength );
00610         ISecurityDescriptor-&gt;Owner = RtlPointerToOffset(Base,Field);
00611         Field += WorldSidLength;
00612     }
00613 
00614     <span class="keywordflow">if</span> ( *SecurityInformation &amp; GROUP_SECURITY_INFORMATION ) {
00615 
00616         RtlCopyMemory( Field, SeWorldSid, WorldSidLength );
00617         ISecurityDescriptor-&gt;Group = RtlPointerToOffset(Base,Field);
00618     }
00619 
00620     <span class="keywordflow">if</span> ( *SecurityInformation &amp; DACL_SECURITY_INFORMATION ) {
00621         RtlpSetControlBits( ISecurityDescriptor, SE_DACL_PRESENT );
00622     }
00623 
00624     <span class="keywordflow">if</span> ( *SecurityInformation &amp; SACL_SECURITY_INFORMATION ) {
00625         RtlpSetControlBits( ISecurityDescriptor, SE_SACL_PRESENT );
00626     }
00627 
00628     RtlpSetControlBits( ISecurityDescriptor, SE_SELF_RELATIVE );
00629 
00630     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00631 
00632 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a152" doxytag="se.h::SeAuditHandleCreation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeAuditHandleCreation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03736">3736</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00258">_AUX_ACCESS_DATA::PrivilegesUsed</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02306">PsGetCurrentProcessId()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00571">SepAdtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00125">SepAdtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01711">SeSubsystemName</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, and <a class="el" href="../../d0/d0/obhandle_8c-source.html#l02160">ObpCreateHandle()</a>.
<p>
<pre class="fragment"><div>03743                    :
03744 
03745     This function audits <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> creation of a handle.
03746 
03747     It will examine <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> AuditHandleCreation field in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed AccessState,
03748     which will indicate whether auditing was performed when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
03749     was found or created.
03750 
03751     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> necessary because object name decoding and handle
03752     allocation occur in widely separate places, preventing us from
03753     auditing everything at once.
03754 
03755 Arguments:
03756 
03757     AccessState - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> AccessState structure
03758         representing <span class="keyword">this</span> access attempt.
03759 
03760     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - The newly allocated handle value.
03761 
03762 Return Value:
03763 
03764     None.
03765 
03766 --*/
03767 
03768 {
03769     BOOLEAN AuditPerformed = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03770     <a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a> AuxData;
03771 
03772     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03773 
03774     AuxData = (<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a>)AccessState-&gt;AuxData;
03775 
03776     <span class="keywordflow">if</span> ( AccessState-&gt;GenerateAudit ) {
03777 
03778         <span class="keywordflow">if</span> ( AccessState-&gt;AuditPrivileges ) {
03779 
03780             AuditPerformed = <a class="code" href="../../d7/d6/sepaudit_8c.html#a9">SepAdtPrivilegeObjectAuditAlarm</a> (
03781                                  &amp;SeSubsystemName,
03782                                  Handle,
03783                                  (PTOKEN)AccessState-&gt;SubjectSecurityContext.ClientToken,
03784                                  (PTOKEN)AccessState-&gt;SubjectSecurityContext.PrimaryToken,
03785                                  &amp;AccessState-&gt;SubjectSecurityContext.ProcessAuditId,
03786                                  AccessState-&gt;PreviouslyGrantedAccess,
03787                                  AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a>,
03788                                  TRUE
03789                                  );
03790         } <span class="keywordflow">else</span> {
03791 
03792             AuditPerformed = <a class="code" href="../../d7/d6/sepaudit_8c.html#a11">SepAdtOpenObjectAuditAlarm</a> ( &amp;SeSubsystemName,
03793                                                           &amp;Handle,
03794                                                           &amp;AccessState-&gt;ObjectTypeName,
03795                                                           NULL,
03796                                                           &amp;AccessState-&gt;ObjectName,
03797                                                           AccessState-&gt;SubjectSecurityContext.ClientToken,
03798                                                           AccessState-&gt;SubjectSecurityContext.PrimaryToken,
03799                                                           AccessState-&gt;OriginalDesiredAccess,
03800                                                           AccessState-&gt;PreviouslyGrantedAccess,
03801                                                           &amp;AccessState-&gt;OperationID,
03802                                                           AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a>,
03803                                                           FALSE,
03804                                                           TRUE,
03805                                                           TRUE,
03806                                                           FALSE,
03807                                                           <a class="code" href="../../d1/d9/ps_8h.html#a152">PsGetCurrentProcessId</a>(),
03808                                                           AuditCategoryObjectAccess,
03809                                                           NULL,
03810                                                           0,
03811                                                           NULL );
03812         }
03813     }
03814 
03815     <span class="comment">//</span>
03816     <span class="comment">// If we generated an 'open' audit, make sure we generate a close</span>
03817     <span class="comment">//</span>
03818 
03819     AccessState-&gt;GenerateOnClose = AuditPerformed;
03820 
03821     <span class="keywordflow">return</span>;
03822 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a191" doxytag="se.h::SeAuditHandleDuplication" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeAuditHandleDuplication           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>NewHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceProcess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetProcess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02573">2573</a> of file <a class="el" href="../../d8/d5/sepaudit_8c-source.html">sepaudit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00814">PsProcessAuditId</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00051">SepSetParmTypeSid</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00059">SepSetParmTypeString</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00076">SepSetParmTypeUlong</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00176">SepTokenUserSid</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00196">SeReleaseSubjectContext()</a>, and <a class="el" href="../../d1/d4/se_8h-source.html#l01711">SeSubsystemName</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, and <a class="el" href="../../d1/d0/obinit_8c-source.html#l00759">ObAuditInheritedHandleProcedure()</a>.
<p>
<pre class="fragment"><div>02582                    :
02583 
02584     This routine generates a handle duplication audit.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> up to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller
02585     to determine <span class="keywordflow">if</span> <span class="keyword">this</span> routine should be called or not.
02586 
02587 Arguments:
02588 
02589     SourceHandle -  Original handle
02590 
02591     NewHandle - New handle
02592 
02593     SourceProcess - Process containing SourceHandle
02594 
02595     TargetProcess - Process containing NewHandle
02596 
02597 Return Value:
02598 
02599     None.
02600 
02601 --*/
02602 
02603 {
02604     SE_ADT_PARAMETER_ARRAY AuditParameters;
02605     <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext;
02606     PSID UserSid;
02607 
02608     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02609 
02610     <a class="code" href="../../d0/d8/subject_8c.html#a0">SeCaptureSubjectContext</a>( &amp;SubjectSecurityContext );
02611 
02612     UserSid = <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>( <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( &amp;SubjectSecurityContext ));
02613 
02614     RtlZeroMemory (
02615        (PVOID) &amp;AuditParameters,
02616        <span class="keyword">sizeof</span>( AuditParameters )
02617        );
02618 
02619 
02620     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( SeAdtParmTypeNone == 0 );
02621 
02622     AuditParameters.CategoryId = SE_CATEGID_DETAILED_TRACKING;
02623     AuditParameters.AuditId = SE_AUDITID_DUPLICATE_HANDLE;
02624     AuditParameters.ParameterCount = 0;
02625     AuditParameters.Type = EVENTLOG_AUDIT_SUCCESS;
02626 
02627     <a class="code" href="../../d7/d6/sepaudit_8c.html#a0">SepSetParmTypeSid</a>( AuditParameters, AuditParameters.ParameterCount, UserSid );
02628     AuditParameters.ParameterCount++;
02629 
02630     <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, &amp;SeSubsystemName );
02631     AuditParameters.ParameterCount++;
02632 
02633     <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)SourceHandle) );
02634     AuditParameters.ParameterCount++;
02635 
02636     <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)<a class="code" href="../../d1/d9/ps_8h.html#a25">PsProcessAuditId</a>( SourceProcess )));
02637     AuditParameters.ParameterCount++;
02638 
02639     <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)NewHandle) );
02640     AuditParameters.ParameterCount++;
02641 
02642     <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)<a class="code" href="../../d1/d9/ps_8h.html#a25">PsProcessAuditId</a>( TargetProcess )));
02643     AuditParameters.ParameterCount++;
02644 
02645 
02646     <a class="code" href="../../d0/d5/adtlog_8c.html#a0">SepAdtLogAuditRecord</a>( &amp;AuditParameters );
02647 
02648     <a class="code" href="../../d0/d8/subject_8c.html#a3">SeReleaseSubjectContext</a>( &amp;SubjectSecurityContext );
02649 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a187" doxytag="se.h::SeAuditingFileEvents" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN SeAuditingFileEvents           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04693">4693</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">SepAdtAuditThisEvent</a>.
<p>
<pre class="fragment"><div>04700                    :
04701 
04702     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be called by a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> system to quickly determine
04703     <span class="keywordflow">if</span> we are auditing <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> open events.  This allows <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> system
04704     to avoid <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> often considerable setup involved in generating an audit.
04705 
04706 Arguments:
04707 
04708     AccessGranted - Supplies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access attempt was successful
04709         or a <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>.
04710 
04711 Return Value:
04712 
04713     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a> - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> events of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> AccessGranted are being audited, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
04714         otherwise.
04715 
04716 --*/
04717 
04718 {
04719     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
04720 
04721     UNREFERENCED_PARAMETER( SecurityDescriptor );
04722 
04723     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryObjectAccess, &amp;AccessGranted ) );
04724 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a188" doxytag="se.h::SeAuditingFileOrGlobalEvents" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN SeAuditingFileOrGlobalEvents           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectSecurityContext</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04648">4648</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">SepAdtAuditThisEvent</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>04656                    :
04657 
04658     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be called by a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> system to quickly determine
04659     <span class="keywordflow">if</span> we are auditing <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> open events.  This allows <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> system
04660     to avoid <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> often considerable setup involved in generating an audit.
04661 
04662 Arguments:
04663 
04664     AccessGranted - Supplies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access attempt was successful
04665         or a <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>.
04666 
04667 Return Value:
04668 
04669     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a> - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> events of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> AccessGranted are being audited, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
04670         otherwise.
04671 
04672 --*/
04673 
04674 {
04675     PISECURITY_DESCRIPTOR ISecurityDescriptor = (PISECURITY_DESCRIPTOR) SecurityDescriptor;
04676 
04677     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
04678 
04679     <span class="keywordflow">if</span> ( ((<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( SubjectSecurityContext ))-&gt;AuditData != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04680         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
04681     }
04682 
04683     <span class="keywordflow">if</span> ( RtlpSaclAddrSecurityDescriptor( ISecurityDescriptor ) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
04684 
04685         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
04686     }
04687 
04688     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryObjectAccess, &amp;AccessGranted ) );
04689 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a189" doxytag="se.h::SeAuditProcessCreation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeAuditProcessCreation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Parent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ImageFileName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02466">2466</a> of file <a class="el" href="../../d8/d5/sepaudit_8c-source.html">sepaudit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00102">_SECURITY_SUBJECT_CONTEXT::PrimaryToken</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00088">SepSetParmTypeLogonId</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00051">SepSetParmTypeSid</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00059">SepSetParmTypeString</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00076">SepSetParmTypeUlong</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00183">SepTokenAuthenticationId</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00176">SepTokenUserSid</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00196">SeReleaseSubjectContext()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01711">SeSubsystemName</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>.
<p>
<pre class="fragment"><div>02473                    :
02474 
02475     Audits <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> creation of a process.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's responsibility
02476     to determine <span class="keywordflow">if</span> process auditing <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in progress.
02477 
02478 
02479 Arguments:
02480 
02481     Process - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> process object.
02482 
02483     Parent - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> creator (parent) process object.
02484     
02485     ImageFileName - the name of the image
02486 
02487 Return Value:
02488 
02489     None.
02490 
02491 --*/
02492 
02493 {
02494     ANSI_STRING Ansi;
02495     LUID UserAuthenticationId;
02496     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02497     PSID UserSid;
02498     <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext;
02499     SE_ADT_PARAMETER_ARRAY AuditParameters;
02500     
02501     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02502 
02503     <span class="keywordflow">if</span> ( ImageFileName == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
02504     {
02505         <span class="keywordflow">return</span> ;
02506     }
02507 
02508     <span class="comment">//</span>
02509     <span class="comment">// NtCreateProcess with no section will cause this to be NULL</span>
02510     <span class="comment">// fork() for posix will do this, or someone calling NtCreateProcess</span>
02511     <span class="comment">// directly.</span>
02512     <span class="comment">//</span>
02513 
02514     <span class="keywordflow">if</span> ( ImageFileName-&gt;Buffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
02515     {
02516         <span class="keywordflow">return</span>;
02517     }
02518 
02519     <a class="code" href="../../d0/d8/subject_8c.html#a0">SeCaptureSubjectContext</a>( &amp;SubjectSecurityContext );
02520 
02521     RtlZeroMemory (
02522        (PVOID) &amp;AuditParameters,
02523        <span class="keyword">sizeof</span>( AuditParameters )
02524        );
02525 
02526     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( SeAdtParmTypeNone == 0 );
02527 
02528     AuditParameters.CategoryId = SE_CATEGID_DETAILED_TRACKING;
02529     AuditParameters.AuditId = SE_AUDITID_PROCESS_CREATED;
02530     AuditParameters.ParameterCount = 0;
02531     AuditParameters.Type = EVENTLOG_AUDIT_SUCCESS;
02532 
02533     <span class="comment">//</span>
02534     <span class="comment">// Use the primary token here, because that's what's going to show up</span>
02535     <span class="comment">// when the created process exits.</span>
02536     <span class="comment">//</span>
02537 
02538     UserSid = <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>( SubjectSecurityContext.<a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html#o2">PrimaryToken</a> );
02539 
02540     UserAuthenticationId = <a class="code" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>( SubjectSecurityContext.<a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html#o2">PrimaryToken</a> );
02541 
02542     <span class="comment">//</span>
02543     <span class="comment">// Fill in the AuditParameters structure.</span>
02544     <span class="comment">//</span>
02545 
02546     <a class="code" href="../../d7/d6/sepaudit_8c.html#a0">SepSetParmTypeSid</a>( AuditParameters, AuditParameters.ParameterCount, UserSid );
02547     AuditParameters.ParameterCount++;
02548 
02549     <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, &amp;SeSubsystemName );
02550     AuditParameters.ParameterCount++;
02551 
02552     <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)Process) );
02553     AuditParameters.ParameterCount++;
02554 
02555     <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, ImageFileName );
02556     AuditParameters.ParameterCount++;
02557 
02558     <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)Parent) );
02559     AuditParameters.ParameterCount++;
02560 
02561     <a class="code" href="../../d7/d6/sepaudit_8c.html#a5">SepSetParmTypeLogonId</a>( AuditParameters, AuditParameters.ParameterCount, UserAuthenticationId );
02562     AuditParameters.ParameterCount++;
02563 
02564     <a class="code" href="../../d0/d5/adtlog_8c.html#a0">SepAdtLogAuditRecord</a>( &amp;AuditParameters );
02565 
02566     <a class="code" href="../../d0/d8/subject_8c.html#a3">SeReleaseSubjectContext</a>( &amp;SubjectSecurityContext );
02567 
02568     <span class="keywordflow">return</span>;
02569 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a190" doxytag="se.h::SeAuditProcessExit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeAuditProcessExit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Process</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02653">2653</a> of file <a class="el" href="../../d8/d5/sepaudit_8c-source.html">sepaudit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00814">PsProcessAuditId</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00088">SepSetParmTypeLogonId</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00051">SepSetParmTypeSid</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00059">SepSetParmTypeString</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00076">SepSetParmTypeUlong</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00183">SepTokenAuthenticationId</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00176">SepTokenUserSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01711">SeSubsystemName</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00207">_EPROCESS::Token</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01363">PspProcessDelete()</a>.
<p>
<pre class="fragment"><div>02658                    :
02659 
02660     Audits <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a> of a process.  The caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> responsible <span class="keywordflow">for</span>
02661     determining <span class="keywordflow">if</span> <span class="keyword">this</span> should be called.
02662 
02663 Arguments:
02664 
02665     Process - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process object that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> exiting.
02666 
02667 Return Value:
02668 
02669     None.
02670 
02671 --*/
02672 
02673 {
02674     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
02675     SE_ADT_PARAMETER_ARRAY AuditParameters;
02676     PSID UserSid;
02677     LUID LogonId;
02678 
02679     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02680 
02681     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o21">Token</a>;
02682 
02683     UserSid = <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>( Token );
02684     LogonId = <a class="code" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>( Token );
02685 
02686     RtlZeroMemory (
02687        (PVOID) &amp;AuditParameters,
02688        <span class="keyword">sizeof</span>( AuditParameters )
02689        );
02690 
02691 
02692     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( SeAdtParmTypeNone == 0 );
02693 
02694     AuditParameters.CategoryId = SE_CATEGID_DETAILED_TRACKING;
02695     AuditParameters.AuditId = SE_AUDITID_PROCESS_EXIT;
02696     AuditParameters.ParameterCount = 0;
02697     AuditParameters.Type = EVENTLOG_AUDIT_SUCCESS;
02698 
02699     <a class="code" href="../../d7/d6/sepaudit_8c.html#a0">SepSetParmTypeSid</a>( AuditParameters, AuditParameters.ParameterCount, UserSid );
02700     AuditParameters.ParameterCount++;
02701 
02702     <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, &amp;SeSubsystemName );
02703     AuditParameters.ParameterCount++;
02704 
02705     <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)<a class="code" href="../../d1/d9/ps_8h.html#a25">PsProcessAuditId</a>( Process )));
02706     AuditParameters.ParameterCount++;
02707 
02708     <a class="code" href="../../d7/d6/sepaudit_8c.html#a5">SepSetParmTypeLogonId</a>( AuditParameters, AuditParameters.ParameterCount, LogonId );
02709     AuditParameters.ParameterCount++;
02710 
02711     <a class="code" href="../../d0/d5/adtlog_8c.html#a0">SepAdtLogAuditRecord</a>( &amp;AuditParameters );
02712 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a126" doxytag="se.h::SeCaptureAcl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeCaptureAcl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACL&nbsp;</td>
          <td class="mdname" nowrap> <em>InputAcl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID CaptureBuffer&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CaptureBufferLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ForceCapture</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACL *&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedAcl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>AlignedAclSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01370">1370</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01287">ProbeAndReadUshort</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>, and <a class="el" href="../../d6/d5/sep_8c-source.html#l00036">SepCheckAcl()</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l01690">NtCreateToken()</a>, and <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00037">NtSetInformationToken()</a>.
<p>
<pre class="fragment"><div>01383                    :
01384 
01385     This routine probes and captures a copy of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified ACL.
01386     The ACL <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> either captured into a provided buffer, or <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
01387     allocated to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACL.
01388 
01389     Any ACL captured will have its structure validated.
01390 
01391 
01392     <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requestor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not kernel mode then
01393 
01394         probe and capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input ACL
01395 
01396     <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requstor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> kernel mode then
01397 
01398         <span class="keywordflow">if</span> force capture <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> then
01399 
01400             <span class="keywordflow">do</span> not probe <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input ACL, but <span class="keywordflow">do</span> capture <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>
01401 
01402         <span class="keywordflow">else</span>
01403 
01404             <span class="keywordflow">return</span> address of original, but don'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> copy
01405 
01406 Arguments:
01407 
01408     InputAcl - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACL to capture.  This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed
01409         to have been provided by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mode specified in RequestorMode.
01410 
01411     RequestorMode - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's access mode.
01412 
01413     CaptureBuffer - Specifies a buffer into which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACL <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be
01414         captured.  If <span class="keyword">this</span> parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not provided, <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> will be allocated
01415         to hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured data.
01416 
01417     CaptureBufferLength - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length, in bytes, of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> capture
01418         buffer.
01419 
01420     PoolType - Specifies which <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to allocate to capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01421         ACL into.  This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored <span class="keywordflow">if</span> CaptureBuffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> provided.
01422 
01423     ForceCapture - Specifies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACL should be captured even <span class="keywordflow">if</span>
01424         requestor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> kernel.
01425 
01426     CapturedAcl - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a pointer to an ACL.
01427         The pointer will be set to point to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured (or uncaptured) ACL.
01428 
01429     AlignedAclSize - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a ULONG to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length
01430         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACL rounded up to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next longword boundary.
01431 
01432 Return Value:
01433 
01434     STATUS_SUCCESS indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> capture was successful.
01435 
01436     STATUS_BUFFER_TOO_SMALL - indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer provided to capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACL
01437         into wasn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> large enough to hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACL.
01438 
01439     Any access violations encountered will be returned.
01440 
01441 --*/
01442 
01443 {
01444 
01445     ULONG AclSize;
01446 
01447     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01448 
01449     <span class="comment">//</span>
01450     <span class="comment">//  check if the requestors mode is kernel mode and we are not</span>
01451     <span class="comment">//  to force a capture.</span>
01452     <span class="comment">//</span>
01453 
01454     <span class="keywordflow">if</span> ((RequestorMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp; (ForceCapture == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
01455 
01456         <span class="comment">//</span>
01457         <span class="comment">//  We don't need to do any work and can simply</span>
01458         <span class="comment">//  return a pointer to the input ACL</span>
01459         <span class="comment">//</span>
01460 
01461         (*CapturedAcl) = InputAcl;
01462 
01463         <span class="keywordflow">return</span> STATUS_SUCCESS;
01464     }
01465 
01466 
01467     <span class="comment">//</span>
01468     <span class="comment">// Get the length needed to hold the ACL</span>
01469     <span class="comment">//</span>
01470 
01471     <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
01472 
01473         <span class="keywordflow">try</span> {
01474 
01475             AclSize = <a class="code" href="../../d5/d8/ex_8h.html#a16">ProbeAndReadUshort</a>( &amp;(InputAcl-&gt;AclSize) );
01476 
01477             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( InputAcl,
01478                           AclSize,
01479                           <span class="keyword">sizeof</span>(ULONG) );
01480 
01481         } except(EXCEPTION_EXECUTE_HANDLER) {
01482             <span class="keywordflow">return</span> GetExceptionCode();
01483         }
01484 
01485     } <span class="keywordflow">else</span> {
01486 
01487         AclSize = InputAcl-&gt;AclSize;
01488 
01489     }
01490 
01491     <span class="comment">//</span>
01492     <span class="comment">// If the passed pointer is non-null, it has better at least</span>
01493     <span class="comment">// point to a well formed ACL</span>
01494     <span class="comment">//</span>
01495 
01496     <span class="keywordflow">if</span> (AclSize &lt; <span class="keyword">sizeof</span>(ACL)) {
01497         <span class="keywordflow">return</span>( STATUS_INVALID_ACL );
01498     }
01499 
01500     (*AlignedAclSize) = (ULONG)LongAlignSize( AclSize );
01501 
01502 
01503     <span class="comment">//</span>
01504     <span class="comment">// If a buffer was provided, compare lengths.</span>
01505     <span class="comment">// Otherwise, allocate a buffer.</span>
01506     <span class="comment">//</span>
01507 
01508     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(CaptureBuffer)) {
01509 
01510         <span class="keywordflow">if</span> (AclSize &gt; CaptureBufferLength) {
01511             <span class="keywordflow">return</span> STATUS_BUFFER_TOO_SMALL;
01512         } <span class="keywordflow">else</span> {
01513 
01514             (*CapturedAcl) = CaptureBuffer;
01515         }
01516 
01517     } <span class="keywordflow">else</span> {
01518 
01519         (*CapturedAcl) = (PACL)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PoolType, AclSize, 'cAeS');
01520 
01521         <span class="keywordflow">if</span> ( *CapturedAcl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
01522             <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01523         }
01524 
01525     }
01526 
01527     <span class="comment">//</span>
01528     <span class="comment">// Now copy the ACL and validate it</span>
01529     <span class="comment">//</span>
01530 
01531     <span class="keywordflow">try</span> {
01532 
01533         RtlMoveMemory( (*CapturedAcl), InputAcl, AclSize );
01534 
01535     } except(EXCEPTION_EXECUTE_HANDLER) {
01536         <span class="keywordflow">if</span> (!ARGUMENT_PRESENT(CaptureBuffer)) {
01537             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( (*CapturedAcl) );
01538         }
01539 
01540         *CapturedAcl = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01541         <span class="keywordflow">return</span> GetExceptionCode();
01542     }
01543 
01544     <span class="keywordflow">if</span> ( (!<a class="code" href="../../d6/d6/sep_8h.html#a47">SepCheckAcl</a>( (*CapturedAcl), AclSize )) ) {
01545 
01546         <span class="keywordflow">if</span> (!ARGUMENT_PRESENT(CaptureBuffer)) {
01547             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( (*CapturedAcl) );
01548         }
01549 
01550         *CapturedAcl = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01551         <span class="keywordflow">return</span> STATUS_INVALID_ACL;
01552     }
01553 
01554     <span class="keywordflow">return</span> STATUS_SUCCESS;
01555 
01556 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a128" doxytag="se.h::SeCaptureLuidAndAttributesArray" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeCaptureLuidAndAttributesArray           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID_AND_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>InputArray</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ArrayCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID CaptureBuffer&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CaptureBufferLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ForceCapture</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLUID_AND_ATTRIBUTES *&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedArray</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>AlignedArraySize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01608">1608</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d1/aug98_2dll32_2getcrd_8c-source.html#l00087">InputArray</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>, and <a class="el" href="../../d7/d5/sep_8h-source.html#l00255">SEP_MAX_PRIVILEGE_COUNT</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l00046">NtAdjustPrivilegesToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l01690">NtCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01306">NtFilterToken()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00231">NtPrivilegeCheck()</a>, and <a class="el" href="../../d2/d0/psjob_8c-source.html#l02680">PspCaptureTokenFilter()</a>.
<p>
<pre class="fragment"><div>01622                    :
01623 
01624     This routine probes and captures a copy of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
01625     LUID_AND_ATTRIBUTES array.
01626 
01627     The array <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> either captured into a provided buffer, or <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
01628     allocated to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array.
01629 
01630 
01631     <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requestor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not kernel mode then
01632 
01633         probe and capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input array
01634 
01635     <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requstor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> kernel mode then
01636 
01637         <span class="keywordflow">if</span> force capture <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> then
01638 
01639             <span class="keywordflow">do</span> not probe <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input array, but <span class="keywordflow">do</span> capture <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>
01640 
01641         <span class="keywordflow">else</span>
01642 
01643             <span class="keywordflow">return</span> address of original, but don'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> copy
01644 
01645 Arguments:
01646 
01647     <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a77">InputArray</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array to capture.  This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed
01648         to have been provided by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mode specified in RequestorMode.
01649 
01650     ArrayCount - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of elements in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array to capture.
01651 
01652     RequestorMode - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's access mode.
01653 
01654     CaptureBuffer - Specifies a buffer into which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be
01655         captured.  If <span class="keyword">this</span> parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not provided, <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> will be allocated
01656         to hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured data.
01657 
01658     CaptureBufferLength - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length, in bytes, of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> capture
01659         buffer.
01660 
01661     PoolType - Specifies which <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to allocate to capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01662         array into.  This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored <span class="keywordflow">if</span> CaptureBuffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> provided.
01663 
01664     ForceCapture - Specifies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array should be captured even <span class="keywordflow">if</span>
01665         requestor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> kernel.
01666 
01667     CapturedArray - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a pointer to an array.
01668         The pointer will be set to point to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured (or uncaptured) array.
01669 
01670     AlignedArraySize - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a ULONG to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length
01671         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array rounded up to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next longword boundary.
01672 
01673 Return Value:
01674 
01675     STATUS_SUCCESS indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> capture was successful.
01676 
01677     STATUS_BUFFER_TOO_SMALL - indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer provided to capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array
01678         into wasn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> large enough to hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array.
01679 
01680     Any access violations encountered will be returned.
01681 
01682 --*/
01683 
01684 {
01685 
01686     ULONG ArraySize;
01687 
01688     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01689 
01690     <span class="comment">//</span>
01691     <span class="comment">// Make sure the array isn't empty</span>
01692     <span class="comment">//</span>
01693 
01694     <span class="keywordflow">if</span> (ArrayCount == 0) {
01695         (*CapturedArray) = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01696         (*AlignedArraySize) = 0;
01697         <span class="keywordflow">return</span> STATUS_SUCCESS;
01698     }
01699 
01700     <span class="comment">//</span>
01701     <span class="comment">// If there are too many LUIDs, return failure</span>
01702     <span class="comment">//</span>
01703 
01704     <span class="keywordflow">if</span> (ArrayCount &gt; <a class="code" href="../../d6/d6/sep_8h.html#a13">SEP_MAX_PRIVILEGE_COUNT</a>) {
01705         <span class="keywordflow">return</span>(STATUS_INVALID_PARAMETER);
01706     }
01707 
01708     <span class="comment">//</span>
01709     <span class="comment">//  check if the requestors mode is kernel mode and we are not</span>
01710     <span class="comment">//  to force a capture.</span>
01711     <span class="comment">//</span>
01712 
01713     <span class="keywordflow">if</span> ((RequestorMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp; (ForceCapture == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
01714 
01715         <span class="comment">//</span>
01716         <span class="comment">//  We don't need to do any work and can simply</span>
01717         <span class="comment">//  return a pointer to the input array</span>
01718         <span class="comment">//</span>
01719 
01720         (*CapturedArray) = <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a77">InputArray</a>;
01721 
01722         <span class="keywordflow">return</span> STATUS_SUCCESS;
01723     }
01724 
01725 
01726     <span class="comment">//</span>
01727     <span class="comment">// Get the length needed to hold the array</span>
01728     <span class="comment">//</span>
01729 
01730     ArraySize = ArrayCount * (ULONG)<span class="keyword">sizeof</span>(LUID_AND_ATTRIBUTES);
01731     (*AlignedArraySize) = (ULONG)LongAlignSize( ArraySize );
01732 
01733     <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
01734 
01735         <span class="keywordflow">try</span> {
01736 
01737 
01738             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( InputArray,
01739                           ArraySize,
01740                           <span class="keyword">sizeof</span>(ULONG) );
01741 
01742         } except(EXCEPTION_EXECUTE_HANDLER) {
01743             <span class="keywordflow">return</span> GetExceptionCode();
01744         }
01745 
01746     }
01747 
01748 
01749 
01750     <span class="comment">//</span>
01751     <span class="comment">// If a buffer was provided, compare lengths.</span>
01752     <span class="comment">// Otherwise, allocate a buffer.</span>
01753     <span class="comment">//</span>
01754 
01755     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(CaptureBuffer)) {
01756 
01757         <span class="keywordflow">if</span> (ArraySize &gt; CaptureBufferLength) {
01758             <span class="keywordflow">return</span> STATUS_BUFFER_TOO_SMALL;
01759         } <span class="keywordflow">else</span> {
01760 
01761             (*CapturedArray) = CaptureBuffer;
01762         }
01763 
01764     } <span class="keywordflow">else</span> {
01765 
01766         (*CapturedArray) =
01767             (PLUID_AND_ATTRIBUTES)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PoolType, ArraySize, 'uLeS');
01768 
01769         <span class="keywordflow">if</span> ( *CapturedArray == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
01770             <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01771         }
01772 
01773     }
01774 
01775     <span class="comment">//</span>
01776     <span class="comment">// Now copy the array</span>
01777     <span class="comment">//</span>
01778 
01779     <span class="keywordflow">try</span> {
01780 
01781         RtlMoveMemory( (*CapturedArray), InputArray, ArraySize );
01782 
01783     } except(EXCEPTION_EXECUTE_HANDLER) {
01784         <span class="keywordflow">if</span> (!ARGUMENT_PRESENT(CaptureBuffer)) {
01785             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( (*CapturedArray) );
01786         }
01787 
01788         <span class="keywordflow">return</span> GetExceptionCode();
01789     }
01790 
01791     <span class="keywordflow">return</span> STATUS_SUCCESS;
01792 
01793 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a116" doxytag="se.h::SeCaptureSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeCaptureSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>InputSecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ForceCapture</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputSecurityDescriptor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00053">53</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d0/d3/raise_8c-source.html#l00071">ExRaiseDatatypeMisalignment()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01261">ProbeAndReadUchar</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01287">ProbeAndReadUshort</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01030">RtlLengthRequiredSid()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00810">RtlValidSid()</a>, <a class="el" href="../../d6/d5/sep_8c-source.html#l00036">SepCheckAcl()</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l04679">IopGetRegistrySecurityWithFallback()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l08959">IopSetSecurityObjectFromRegistry()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02881">NtLoadKey2()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00046">NtSetSecurityObject()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l00891">NtUserCreateWindowStation()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00248">ObpCaptureObjectCreateInformation()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, and <a class="el" href="../../d2/d5/tse_8c-source.html#l00296">TestCaptureSecurityDescriptor()</a>.
<p>
<pre class="fragment"><div>00063                    :
00064 
00065     This routine probes and captures a copy of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor based
00066     upon <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following tests.
00067 
00068     <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requestor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not kernel mode then
00069 
00070         probe and capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input descriptor
00071         (<a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">self</span>-relative)
00072 
00073     <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requstor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> kernel mode then
00074 
00075         <span class="keywordflow">if</span> force capture <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> then
00076 
00077             <span class="keywordflow">do</span> not probe <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input descriptor, but <span class="keywordflow">do</span> capture <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
00078             (<a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">self</span>-relative)
00079 
00080         <span class="keywordflow">else</span>
00081 
00082             <span class="keywordflow">do</span> nothing
00083             (<a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> expected to be <span class="keyword">self</span>-relative)
00084 
00085 Arguments:
00086 
00087     InputSecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor to capture.
00088     This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed to have been provided by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mode specified
00089     in RequestorMode.
00090 
00091     RequestorMode - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's access mode.
00092 
00093     PoolType - Specifies which <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to allocate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured
00094         descriptor from
00095 
00096     ForceCapture - Specifies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input descriptor should always be
00097         captured
00098 
00099     OutputSecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00100         output security descriptor.  The captured descriptor will be
00101         <span class="keyword">self</span>-relative <a class="code" href="../../d8/d0/rtbatcr_8c.html#a8">format</a>.
00102 
00103 Return Value:
00104 
00105     STATUS_SUCCESS <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successful.
00106 
00107     STATUS_INVALID_SID - An SID within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
00108         a valid SID.
00109 
00110     STATUS_INVALID_ACL - An ACL within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
00111         a valid ACL.
00112 
00113     STATUS_UNKNOWN_REVISION - The revision level of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor
00114         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not one known to <span class="keyword">this</span> revision of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> capture routine.
00115 --*/
00116 
00117 {
00118     SECURITY_DESCRIPTOR Captured;
00119     SECURITY_DESCRIPTOR_RELATIVE *PIOutputSecurityDescriptor;
00120     PCHAR DescriptorOffset;
00121 
00122     ULONG SaclSize;
00123     ULONG NewSaclSize;
00124 
00125     ULONG DaclSize;
00126     ULONG NewDaclSize;
00127 
00128     ULONG OwnerSubAuthorityCount;
00129     ULONG OwnerSize;
00130     ULONG NewOwnerSize;
00131 
00132     ULONG GroupSubAuthorityCount;
00133     ULONG GroupSize;
00134     ULONG NewGroupSize;
00135 
00136     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00137 
00138     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00139 
00140     <span class="comment">//</span>
00141     <span class="comment">//  if the security descriptor is null then there is really nothing to</span>
00142     <span class="comment">//  capture</span>
00143     <span class="comment">//</span>
00144 
00145     <span class="keywordflow">if</span> (InputSecurityDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00146 
00147         (*OutputSecurityDescriptor) = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00148 
00149         <span class="keywordflow">return</span> STATUS_SUCCESS;
00150 
00151     }
00152 
00153     <span class="comment">//</span>
00154     <span class="comment">//  check if the requestors mode is kernel mode and we are not</span>
00155     <span class="comment">//  to force a capture</span>
00156     <span class="comment">//</span>
00157 
00158     <span class="keywordflow">if</span> ((RequestorMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp; (ForceCapture == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00159 
00160         <span class="comment">//</span>
00161         <span class="comment">//  Yes it is so we don't need to do any work and can simply</span>
00162         <span class="comment">//  return a pointer to the input descriptor</span>
00163         <span class="comment">//</span>
00164 
00165         (*OutputSecurityDescriptor) = InputSecurityDescriptor;
00166 
00167         <span class="keywordflow">return</span> STATUS_SUCCESS;
00168 
00169     }
00170 
00171 
00172     <span class="comment">//</span>
00173     <span class="comment">//  We need to probe and capture the descriptor.</span>
00174     <span class="comment">//  To do this we need to probe the main security descriptor record</span>
00175     <span class="comment">//  first.</span>
00176     <span class="comment">//</span>
00177 
00178     <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00179 
00180         <span class="comment">//</span>
00181         <span class="comment">// Capture of UserMode SecurityDescriptor.</span>
00182         <span class="comment">//</span>
00183 
00184         <span class="keywordflow">try</span> {
00185 
00186             <span class="comment">//</span>
00187             <span class="comment">// Probe the main record of the input SecurityDescriptor</span>
00188             <span class="comment">//</span>
00189 
00190             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( InputSecurityDescriptor,
00191                           <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE),
00192                           <span class="keyword">sizeof</span>(ULONG) );
00193 
00194             <span class="comment">//</span>
00195             <span class="comment">//  Capture the SecurityDescriptor main record.</span>
00196             <span class="comment">//</span>
00197 
00198             RtlCopyMemory( (&amp;Captured),
00199                           InputSecurityDescriptor,
00200                           <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE) );
00201 
00202             <span class="comment">//</span>
00203             <span class="comment">// Verify the alignment is correct for absolute case. This is</span>
00204             <span class="comment">// only needed when pointer are 64 bits.</span>
00205             <span class="comment">//</span>
00206 
00207             <span class="keywordflow">if</span> (!(Captured.Control &amp; SE_SELF_RELATIVE)) {
00208 
00209                <span class="keywordflow">if</span> ((ULONG_PTR) InputSecurityDescriptor &amp; (<span class="keyword">sizeof</span>(ULONG_PTR) - 1)) {
00210                    <a class="code" href="../../d5/d8/ex_8h.html#a304">ExRaiseDatatypeMisalignment</a>();
00211                }
00212             }
00213 
00214 
00215         } except(EXCEPTION_EXECUTE_HANDLER) {
00216             <span class="keywordflow">return</span> GetExceptionCode();
00217         }
00218 
00219     } <span class="keywordflow">else</span> {
00220 
00221         <span class="comment">//</span>
00222         <span class="comment">//  Force capture of kernel mode SecurityDescriptor.</span>
00223         <span class="comment">//</span>
00224         <span class="comment">//  Capture the SecurityDescriptor main record.</span>
00225         <span class="comment">//  It doesn't need probing because requestor mode is kernel.</span>
00226         <span class="comment">//</span>
00227 
00228         RtlCopyMemory( (&amp;Captured),
00229                       InputSecurityDescriptor,
00230                       <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE) );
00231 
00232     }
00233 
00234     <span class="comment">//</span>
00235     <span class="comment">// Make sure it is a revision we recognize</span>
00236     <span class="comment">//</span>
00237 
00238     <span class="keywordflow">if</span> (Captured.Revision != SECURITY_DESCRIPTOR_REVISION) {
00239        <span class="keywordflow">return</span> STATUS_UNKNOWN_REVISION;
00240     }
00241 
00242 
00243     <span class="comment">//</span>
00244     <span class="comment">// In case the input security descriptor is self-relative, change the</span>
00245     <span class="comment">// captured main record to appear as an absolute form so we can use</span>
00246     <span class="comment">// common code for both cases below.</span>
00247     <span class="comment">//</span>
00248     <span class="comment">// Note that the fields of Captured are left pointing to user</span>
00249     <span class="comment">// space addresses.  Treat them carefully.</span>
00250     <span class="comment">//</span>
00251 
00252     <span class="keywordflow">try</span> {
00253 
00254         Captured.Owner = RtlpOwnerAddrSecurityDescriptor(
00255             (SECURITY_DESCRIPTOR *)InputSecurityDescriptor
00256             );
00257         Captured.Group = RtlpGroupAddrSecurityDescriptor(
00258             (SECURITY_DESCRIPTOR *)InputSecurityDescriptor
00259             );
00260         Captured.Sacl  = RtlpSaclAddrSecurityDescriptor (
00261             (SECURITY_DESCRIPTOR *)InputSecurityDescriptor
00262             );
00263         Captured.Dacl  = RtlpDaclAddrSecurityDescriptor (
00264             (SECURITY_DESCRIPTOR *)InputSecurityDescriptor
00265             );
00266         Captured.Control &amp;= ~SE_SELF_RELATIVE;
00267 
00268     } except(EXCEPTION_EXECUTE_HANDLER) {
00269         <span class="keywordflow">return</span> GetExceptionCode();
00270     }
00271 
00272 
00273 
00274     <span class="comment">//</span>
00275     <span class="comment">//  Indicate the size we are going to need to allocate for the captured</span>
00276     <span class="comment">//  acls</span>
00277     <span class="comment">//</span>
00278 
00279     SaclSize = 0;
00280     DaclSize = 0;
00281 
00282     NewSaclSize = 0;
00283     NewDaclSize = 0;
00284     NewGroupSize = 0;
00285     NewOwnerSize = 0;
00286 
00287     <span class="comment">//</span>
00288     <span class="comment">//  Probe (if necessary) and capture each of the components of a</span>
00289     <span class="comment">//  SECURITY_DESCRIPTOR.</span>
00290     <span class="comment">//</span>
00291 
00292     <span class="comment">//</span>
00293     <span class="comment">//  System ACL first</span>
00294     <span class="comment">//</span>
00295 
00296     <span class="keywordflow">if</span> ((Captured.Control &amp; SE_SACL_PRESENT) &amp;&amp;
00297         (Captured.Sacl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ) {
00298 
00299         <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00300 
00301             <span class="keywordflow">try</span> {
00302                 SaclSize = <a class="code" href="../../d5/d8/ex_8h.html#a16">ProbeAndReadUshort</a>( &amp;(Captured.Sacl-&gt;AclSize) );
00303                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( Captured.Sacl,
00304                               SaclSize,
00305                               <span class="keyword">sizeof</span>(ULONG) );
00306             } except(EXCEPTION_EXECUTE_HANDLER) {
00307                 <span class="keywordflow">return</span> GetExceptionCode();
00308             }
00309 
00310         } <span class="keywordflow">else</span> {
00311 
00312             SaclSize = Captured.Sacl-&gt;AclSize;
00313 
00314         }
00315 
00316         NewSaclSize = (ULONG)LongAlignSize( SaclSize );
00317 
00318     } <span class="keywordflow">else</span> {
00319         <span class="comment">//</span>
00320         <span class="comment">// Force the SACL to null if the bit is off</span>
00321         <span class="comment">//</span>
00322         Captured.Sacl = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00323     }
00324 
00325     <span class="comment">//</span>
00326     <span class="comment">//  Discretionary ACL</span>
00327     <span class="comment">//</span>
00328 
00329     <span class="keywordflow">if</span> ((Captured.Control &amp; SE_DACL_PRESENT) &amp;&amp;
00330         (Captured.Dacl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ) {
00331 
00332         <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00333 
00334             <span class="keywordflow">try</span> {
00335                 DaclSize = <a class="code" href="../../d5/d8/ex_8h.html#a16">ProbeAndReadUshort</a>( &amp;(Captured.Dacl-&gt;AclSize) );
00336                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( Captured.Dacl,
00337                               DaclSize,
00338                               <span class="keyword">sizeof</span>(ULONG) );
00339             } except(EXCEPTION_EXECUTE_HANDLER) {
00340                 <span class="keywordflow">return</span> GetExceptionCode();
00341             }
00342 
00343         } <span class="keywordflow">else</span> {
00344 
00345             DaclSize = Captured.Dacl-&gt;AclSize;
00346 
00347         }
00348 
00349         NewDaclSize = (ULONG)LongAlignSize( DaclSize );
00350 
00351     } <span class="keywordflow">else</span> {
00352         <span class="comment">//</span>
00353         <span class="comment">// Force the DACL to null if it is not present</span>
00354         <span class="comment">//</span>
00355         Captured.Dacl = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00356     }
00357 
00358     <span class="comment">//</span>
00359     <span class="comment">//  Owner SID</span>
00360     <span class="comment">//</span>
00361 
00362     <span class="keywordflow">if</span> (Captured.Owner != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)  {
00363 
00364         <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00365 
00366             <span class="keywordflow">try</span> {
00367                 OwnerSubAuthorityCount =
00368                     <a class="code" href="../../d5/d8/ex_8h.html#a14">ProbeAndReadUchar</a>( &amp;(((SID *)(Captured.Owner))-&gt;SubAuthorityCount) );
00369                 OwnerSize = <a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>( OwnerSubAuthorityCount );
00370                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( Captured.Owner,
00371                               OwnerSize,
00372                               <span class="keyword">sizeof</span>(ULONG) );
00373             } except(EXCEPTION_EXECUTE_HANDLER) {
00374                 <span class="keywordflow">return</span> GetExceptionCode();
00375             }
00376 
00377         } <span class="keywordflow">else</span> {
00378 
00379             OwnerSubAuthorityCount = ((SID *)(Captured.Owner))-&gt;SubAuthorityCount;
00380             OwnerSize = <a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>( OwnerSubAuthorityCount );
00381 
00382         }
00383 
00384         NewOwnerSize = (ULONG)LongAlignSize( OwnerSize );
00385 
00386     }
00387 
00388     <span class="comment">//</span>
00389     <span class="comment">//  Group SID</span>
00390     <span class="comment">//</span>
00391 
00392     <span class="keywordflow">if</span> (Captured.Group != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)  {
00393 
00394         <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00395 
00396             <span class="keywordflow">try</span> {
00397                 GroupSubAuthorityCount =
00398                     <a class="code" href="../../d5/d8/ex_8h.html#a14">ProbeAndReadUchar</a>( &amp;(((SID *)(Captured.Group))-&gt;SubAuthorityCount) );
00399                 GroupSize = <a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>( GroupSubAuthorityCount );
00400                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( Captured.Group,
00401                               GroupSize,
00402                               <span class="keyword">sizeof</span>(ULONG) );
00403             } except(EXCEPTION_EXECUTE_HANDLER) {
00404                 <span class="keywordflow">return</span> GetExceptionCode();
00405             }
00406 
00407         } <span class="keywordflow">else</span> {
00408 
00409             GroupSubAuthorityCount = ((SID *)(Captured.Group))-&gt;SubAuthorityCount;
00410             GroupSize = <a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>( GroupSubAuthorityCount );
00411 
00412         }
00413 
00414         NewGroupSize = (ULONG)LongAlignSize( GroupSize );
00415 
00416     }
00417 
00418 
00419 
00420     <span class="comment">//</span>
00421     <span class="comment">//  Now allocate enough pool to hold the descriptor</span>
00422     <span class="comment">//</span>
00423 
00424     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE) +
00425            NewSaclSize +
00426            NewDaclSize +
00427            NewOwnerSize +
00428            NewGroupSize;
00429 
00430     (PIOutputSecurityDescriptor) = (SECURITY_DESCRIPTOR_RELATIVE *)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PoolType,
00431                                                                                  Size,
00432                                                                                  'cSeS' );
00433 
00434     <span class="keywordflow">if</span> ( PIOutputSecurityDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00435         <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
00436     }
00437 
00438     (*OutputSecurityDescriptor) = (PSECURITY_DESCRIPTOR)PIOutputSecurityDescriptor;
00439     DescriptorOffset = (PCHAR)(PIOutputSecurityDescriptor);
00440 
00441 
00442     <span class="comment">//</span>
00443     <span class="comment">//  Copy the main security descriptor record over</span>
00444     <span class="comment">//</span>
00445 
00446     RtlCopyMemory( DescriptorOffset,
00447                   &amp;Captured,
00448                   <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE) );
00449     DescriptorOffset += <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE);
00450 
00451     <span class="comment">//</span>
00452     <span class="comment">// Indicate the output descriptor is self-relative</span>
00453     <span class="comment">//</span>
00454 
00455     PIOutputSecurityDescriptor-&gt;Control |= SE_SELF_RELATIVE;
00456 
00457     <span class="comment">//</span>
00458     <span class="comment">//  If there is a System Acl, copy it over and set</span>
00459     <span class="comment">//  the output descriptor's offset to point to the newly captured copy.</span>
00460     <span class="comment">//</span>
00461 
00462     <span class="keywordflow">if</span> ((Captured.Control &amp; SE_SACL_PRESENT) &amp;&amp; (Captured.Sacl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00463 
00464 
00465         <span class="keywordflow">try</span> {
00466             RtlCopyMemory( DescriptorOffset,
00467                           Captured.Sacl,
00468                           SaclSize );
00469 
00470 
00471         } except(EXCEPTION_EXECUTE_HANDLER) {
00472             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( PIOutputSecurityDescriptor );
00473             <span class="keywordflow">return</span> GetExceptionCode();
00474         }
00475 
00476         <span class="keywordflow">if</span> ((RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp;
00477             (!<a class="code" href="../../d6/d6/sep_8h.html#a47">SepCheckAcl</a>( (PACL) DescriptorOffset, SaclSize )) ) {
00478 
00479             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( PIOutputSecurityDescriptor );
00480             <span class="keywordflow">return</span> STATUS_INVALID_ACL;
00481         }
00482 
00483         <span class="comment">//</span>
00484         <span class="comment">// Change pointer to offset</span>
00485         <span class="comment">//</span>
00486 
00487         PIOutputSecurityDescriptor-&gt;Sacl =
00488             RtlPointerToOffset( PIOutputSecurityDescriptor,
00489                                 DescriptorOffset,
00490                                 );
00491 
00492         ((PACL) DescriptorOffset)-&gt;AclSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) NewSaclSize;
00493         DescriptorOffset += NewSaclSize;
00494     } <span class="keywordflow">else</span> {
00495         PIOutputSecurityDescriptor-&gt;Sacl = 0;
00496     }
00497 
00498     <span class="comment">//</span>
00499     <span class="comment">//  If there is a Discretionary Acl, copy it over and set</span>
00500     <span class="comment">//  the output descriptor's offset to point to the newly captured copy.</span>
00501     <span class="comment">//</span>
00502 
00503     <span class="keywordflow">if</span> ((Captured.Control &amp; SE_DACL_PRESENT) &amp;&amp; (Captured.Dacl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00504 
00505 
00506         <span class="keywordflow">try</span> {
00507             RtlCopyMemory( DescriptorOffset,
00508                           Captured.Dacl,
00509                           DaclSize );
00510         } except(EXCEPTION_EXECUTE_HANDLER) {
00511             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( PIOutputSecurityDescriptor );
00512             <span class="keywordflow">return</span> GetExceptionCode();
00513         }
00514 
00515         <span class="keywordflow">if</span> ((RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp;
00516             (!<a class="code" href="../../d6/d6/sep_8h.html#a47">SepCheckAcl</a>( (PACL) DescriptorOffset, DaclSize )) ) {
00517 
00518             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( PIOutputSecurityDescriptor );
00519             <span class="keywordflow">return</span> STATUS_INVALID_ACL;
00520         }
00521 
00522         <span class="comment">//</span>
00523         <span class="comment">// Change pointer to offset</span>
00524         <span class="comment">//</span>
00525 
00526         PIOutputSecurityDescriptor-&gt;Dacl =
00527                    RtlPointerToOffset(
00528                         PIOutputSecurityDescriptor,
00529                         DescriptorOffset
00530                         );
00531 
00532         ((PACL) DescriptorOffset)-&gt;AclSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) NewDaclSize;
00533         DescriptorOffset += NewDaclSize;
00534     } <span class="keywordflow">else</span> {
00535         PIOutputSecurityDescriptor-&gt;Dacl = 0;
00536     }
00537 
00538     <span class="comment">//</span>
00539     <span class="comment">//  If there is an Owner SID, copy it over and set</span>
00540     <span class="comment">//  the output descriptor's offset to point to the newly captured copy.</span>
00541     <span class="comment">//</span>
00542 
00543     <span class="keywordflow">if</span> (Captured.Owner != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00544 
00545 
00546         <span class="keywordflow">try</span> {
00547             RtlCopyMemory( DescriptorOffset,
00548                           Captured.Owner,
00549                           OwnerSize );
00550             ((SID *) (DescriptorOffset))-&gt;SubAuthorityCount = (UCHAR) OwnerSubAuthorityCount;
00551 
00552         } except(EXCEPTION_EXECUTE_HANDLER) {
00553             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( PIOutputSecurityDescriptor );
00554             <span class="keywordflow">return</span> GetExceptionCode();
00555         }
00556 
00557         <span class="keywordflow">if</span> ((RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp;
00558             (!<a class="code" href="../../d8/d6/sertl_8c.html#a35">RtlValidSid</a>( (PSID) DescriptorOffset )) ) {
00559 
00560             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( PIOutputSecurityDescriptor );
00561             <span class="keywordflow">return</span> STATUS_INVALID_SID;
00562         }
00563 
00564         <span class="comment">//</span>
00565         <span class="comment">// Change pointer to offset</span>
00566         <span class="comment">//</span>
00567 
00568         PIOutputSecurityDescriptor-&gt;Owner =
00569                     RtlPointerToOffset(
00570                         PIOutputSecurityDescriptor,
00571                         DescriptorOffset
00572                         );
00573 
00574         DescriptorOffset += NewOwnerSize;
00575 
00576     } <span class="keywordflow">else</span> {
00577         PIOutputSecurityDescriptor-&gt;Owner = 0;
00578     }
00579 
00580     <span class="comment">//</span>
00581     <span class="comment">//  If there is a group SID, copy it over and set</span>
00582     <span class="comment">//  the output descriptor's offset to point to the newly captured copy.</span>
00583     <span class="comment">//</span>
00584 
00585     <span class="keywordflow">if</span> (Captured.Group != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00586 
00587 
00588         <span class="keywordflow">try</span> {
00589             RtlCopyMemory( DescriptorOffset,
00590                           Captured.Group,
00591                           GroupSize );
00592 
00593             ((SID *) DescriptorOffset)-&gt;SubAuthorityCount = (UCHAR) GroupSubAuthorityCount;
00594         } except(EXCEPTION_EXECUTE_HANDLER) {
00595             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( PIOutputSecurityDescriptor );
00596             <span class="keywordflow">return</span> GetExceptionCode();
00597         }
00598 
00599         <span class="keywordflow">if</span> ((RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp;
00600             (!<a class="code" href="../../d8/d6/sertl_8c.html#a35">RtlValidSid</a>( (PSID) DescriptorOffset )) ) {
00601 
00602             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( PIOutputSecurityDescriptor );
00603             <span class="keywordflow">return</span> STATUS_INVALID_SID;
00604         }
00605 
00606         <span class="comment">//</span>
00607         <span class="comment">// Change pointer to offset</span>
00608         <span class="comment">//</span>
00609 
00610         PIOutputSecurityDescriptor-&gt;Group =
00611                     RtlPointerToOffset(
00612                         PIOutputSecurityDescriptor,
00613                         DescriptorOffset
00614                         );
00615 
00616         DescriptorOffset += NewGroupSize;
00617     } <span class="keywordflow">else</span> {
00618         PIOutputSecurityDescriptor-&gt;Group = 0;
00619     }
00620 
00621     <span class="comment">//</span>
00622     <span class="comment">//  And return to our caller</span>
00623     <span class="comment">//</span>
00624 
00625     <span class="keywordflow">return</span> STATUS_SUCCESS;
00626 
00627 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a122" doxytag="se.h::SeCaptureSecurityQos" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeCaptureSecurityQos           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityQosPresent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_ADVANCED_QUALITY_OF_SERVICE&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedSecurityQos</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a124" doxytag="se.h::SeCaptureSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeCaptureSid           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>InputSid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID CaptureBuffer&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CaptureBufferLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ForceCapture</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSID *&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedSid</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01141">1141</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01261">ProbeAndReadUchar</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01030">RtlLengthRequiredSid()</a>, and <a class="el" href="../../d9/d5/sertl_8c-source.html#l00810">RtlValidSid()</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l01690">NtCreateToken()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>, <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00037">NtSetInformationToken()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>.
<p>
<pre class="fragment"><div>01152                    :
01153 
01154     This routine probes and captures a copy of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified SID.
01155     The SID <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> either captured into a provided buffer, or <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
01156     allocated to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID.
01157 
01158 
01159     <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requestor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not kernel mode then
01160 
01161         probe and capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input SID
01162 
01163     <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requstor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> kernel mode then
01164 
01165         <span class="keywordflow">if</span> force capture <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> then
01166 
01167             <span class="keywordflow">do</span> not probe <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input SID, but <span class="keywordflow">do</span> capture <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>
01168 
01169         <span class="keywordflow">else</span>
01170 
01171             <span class="keywordflow">return</span> address of original, but don'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> copy
01172 
01173 Arguments:
01174 
01175     InputSid - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID to capture.  This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed
01176         to have been provided by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mode specified in RequestorMode.
01177 
01178     RequestorMode - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's access mode.
01179 
01180     CaptureBuffer - Specifies a buffer into which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be
01181         captured.  If <span class="keyword">this</span> parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not provided, <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> will be allocated
01182         to hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured data.
01183 
01184     CaptureBufferLength - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length, in bytes, of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> capture
01185         buffer.
01186 
01187     PoolType - Specifies which <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to allocate to capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01188         SID into.  This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored <span class="keywordflow">if</span> CaptureBuffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> provided.
01189 
01190     ForceCapture - Specifies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID should be captured even <span class="keywordflow">if</span>
01191         requestor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> kernel.
01192 
01193     CapturedSid - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a pointer to an SID.
01194         The pointer will be set to point to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured (or uncaptured) SID.
01195 
01196     AlignedSidSize - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a ULONG to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length
01197         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID rounded up to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next longword boundary.
01198 
01199 Return Value:
01200 
01201     STATUS_SUCCESS indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> capture was successful.
01202 
01203     STATUS_BUFFER_TOO_SMALL - indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer provided to capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID
01204         into wasn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> large enough to hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID.
01205 
01206     Any access violations encountered will be returned.
01207 
01208 --*/
01209 
01210 {
01211 
01212 
01213 
01214     ULONG GetSidSubAuthorityCount;
01215     ULONG SidSize;
01216 
01217     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01218 
01219     <span class="comment">//</span>
01220     <span class="comment">//  check if the requestors mode is kernel mode and we are not</span>
01221     <span class="comment">//  to force a capture.</span>
01222     <span class="comment">//</span>
01223 
01224     <span class="keywordflow">if</span> ((RequestorMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp; (ForceCapture == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
01225 
01226         <span class="comment">//</span>
01227         <span class="comment">//  We don't need to do any work and can simply</span>
01228         <span class="comment">//  return a pointer to the input SID</span>
01229         <span class="comment">//</span>
01230 
01231         (*CapturedSid) = InputSid;
01232 
01233         <span class="keywordflow">return</span> STATUS_SUCCESS;
01234     }
01235 
01236 
01237     <span class="comment">//</span>
01238     <span class="comment">// Get the length needed to hold the SID</span>
01239     <span class="comment">//</span>
01240 
01241     <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
01242 
01243         <span class="keywordflow">try</span> {
01244             GetSidSubAuthorityCount =
01245                 <a class="code" href="../../d5/d8/ex_8h.html#a14">ProbeAndReadUchar</a>( &amp;(((SID *)(InputSid))-&gt;SubAuthorityCount) );
01246             SidSize = <a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>( GetSidSubAuthorityCount );
01247             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( InputSid,
01248                           SidSize,
01249                           <span class="keyword">sizeof</span>(ULONG) );
01250         } except(EXCEPTION_EXECUTE_HANDLER) {
01251             <span class="keywordflow">return</span> GetExceptionCode();
01252         }
01253 
01254     } <span class="keywordflow">else</span> {
01255 
01256         GetSidSubAuthorityCount = ((SID *)(InputSid))-&gt;SubAuthorityCount;
01257         SidSize = <a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>( GetSidSubAuthorityCount );
01258 
01259     }
01260 
01261 
01262     <span class="comment">//</span>
01263     <span class="comment">// If a buffer was provided, compare lengths.</span>
01264     <span class="comment">// Otherwise, allocate a buffer.</span>
01265     <span class="comment">//</span>
01266 
01267     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(CaptureBuffer)) {
01268 
01269         <span class="keywordflow">if</span> (SidSize &gt; CaptureBufferLength) {
01270             <span class="keywordflow">return</span> STATUS_BUFFER_TOO_SMALL;
01271         } <span class="keywordflow">else</span> {
01272 
01273             (*CapturedSid) = CaptureBuffer;
01274         }
01275 
01276     } <span class="keywordflow">else</span> {
01277 
01278         (*CapturedSid) = (PSID)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PoolType, SidSize, 'iSeS');
01279 
01280         <span class="keywordflow">if</span> ( *CapturedSid == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
01281             <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01282         }
01283 
01284     }
01285 
01286     <span class="comment">//</span>
01287     <span class="comment">// Now copy the SID and validate it</span>
01288     <span class="comment">//</span>
01289 
01290     <span class="keywordflow">try</span> {
01291 
01292         RtlMoveMemory( (*CapturedSid), InputSid, SidSize );
01293         ((SID *)(*CapturedSid))-&gt;SubAuthorityCount = (UCHAR) GetSidSubAuthorityCount;
01294 
01295     } except(EXCEPTION_EXECUTE_HANDLER) {
01296         <span class="keywordflow">if</span> (!ARGUMENT_PRESENT(CaptureBuffer)) {
01297             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( (*CapturedSid) );
01298             *CapturedSid = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01299         }
01300 
01301         <span class="keywordflow">return</span> GetExceptionCode();
01302     }
01303 
01304     <span class="keywordflow">if</span> ((!<a class="code" href="../../d8/d6/sertl_8c.html#a35">RtlValidSid</a>( (*CapturedSid) )) ) {
01305 
01306         <span class="keywordflow">if</span> (!ARGUMENT_PRESENT(CaptureBuffer)) {
01307             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( (*CapturedSid) );
01308             *CapturedSid = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01309         }
01310 
01311         <span class="keywordflow">return</span> STATUS_INVALID_SID;
01312     }
01313 
01314     <span class="keywordflow">return</span> STATUS_SUCCESS;
01315 
01316 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a130" doxytag="se.h::SeCaptureSidAndAttributesArray" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeCaptureSidAndAttributesArray           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSID_AND_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>InputArray</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ArrayCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID CaptureBuffer&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CaptureBufferLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ForceCapture</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSID_AND_ATTRIBUTES *&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedArray</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>AlignedArraySize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01850">1850</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d1/aug98_2dll32_2getcrd_8c-source.html#l00087">InputArray</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01261">ProbeAndReadUchar</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01030">RtlLengthRequiredSid()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01350">RtlLengthSid()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00810">RtlValidSid()</a>, and <a class="el" href="../../d7/d5/sep_8h-source.html#l00254">SEP_MAX_GROUP_COUNT</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l00432">NtAdjustGroupsToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l01690">NtCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01306">NtFilterToken()</a>, and <a class="el" href="../../d2/d0/psjob_8c-source.html#l02680">PspCaptureTokenFilter()</a>.
<p>
<pre class="fragment"><div>01864                    :
01865 
01866     This routine probes and captures a copy of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
01867     SID_AND_ATTRIBUTES array, along with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID values pointed
01868     to.
01869 
01870     The array <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> either captured into a provided buffer, or <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
01871     allocated to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array.
01872 
01873     The <a class="code" href="../../d8/d0/rtbatcr_8c.html#a8">format</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> an array of SID_AND_ATTRIBUTES
01874     data structures followed by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID values.  THIS MAY NOT BE THE CASE
01875     FOR <a class="code" href="../../d0/d2/genxx_8h.html#a22">KERNEL</a> <a class="code" href="../../d3/d6/nec98_8h.html#a17">MODE</a> UNLESS <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> FORCE CAPTURE IS SPECIFIED.
01876 
01877 
01878     <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requestor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not kernel mode then
01879 
01880         probe and capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input array
01881 
01882     <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requstor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> kernel mode then
01883 
01884         <span class="keywordflow">if</span> force capture <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span> then
01885 
01886             <span class="keywordflow">do</span> not probe <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input array, but <span class="keywordflow">do</span> capture <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>
01887 
01888         <span class="keywordflow">else</span>
01889 
01890             <span class="keywordflow">return</span> address of original, but don'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> copy
01891 
01892 Arguments:
01893 
01894     <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a77">InputArray</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array to capture.  This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed
01895         to have been provided by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mode specified in RequestorMode.
01896 
01897     ArrayCount - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of elements in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array to capture.
01898 
01899     RequestorMode - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's access mode.
01900 
01901     CaptureBuffer - Specifies a buffer into which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be
01902         captured.  If <span class="keyword">this</span> parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not provided, <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> will be allocated
01903         to hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured data.
01904 
01905     CaptureBufferLength - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length, in bytes, of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> capture
01906         buffer.
01907 
01908     PoolType - Specifies which <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to allocate to capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01909         array into.  This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored <span class="keywordflow">if</span> CaptureBuffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> provided.
01910 
01911     ForceCapture - Specifies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array should be captured even <span class="keywordflow">if</span>
01912         requestor mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> kernel.
01913 
01914     CapturedArray - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a pointer to an array.
01915         The pointer will be set to point to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured (or uncaptured) array.
01916 
01917     AlignedArraySize - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a ULONG to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length
01918         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array rounded up to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next longword boundary.
01919 
01920 Return Value:
01921 
01922     STATUS_SUCCESS indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> capture was successful.
01923 
01924     STATUS_BUFFER_TOO_SMALL - indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer provided to capture <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array
01925         into wasn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> large enough to hold <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array.
01926 
01927     Any access violations encountered will be returned.
01928 
01929 --*/
01930 
01931 {
01932 
01933 <span class="keyword">typedef</span> <span class="keyword">struct </span>_TEMP_ARRAY_ELEMENT {
01934     PISID  Sid;
01935     ULONG SidLength;
01936 } TEMP_ARRAY_ELEMENT;
01937 
01938 
01939     TEMP_ARRAY_ELEMENT *TempArray;
01940 
01941     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> CompletionStatus = STATUS_SUCCESS;
01942 
01943     ULONG ArraySize;
01944     ULONG AlignedLengthRequired;
01945 
01946     ULONG NextIndex;
01947 
01948     PSID_AND_ATTRIBUTES NextElement;
01949     PVOID NextBufferLocation;
01950 
01951     ULONG GetSidSubAuthorityCount;
01952     ULONG SidSize;
01953     ULONG AlignedSidSize;
01954 
01955     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01956 
01957     <span class="comment">//</span>
01958     <span class="comment">// Make sure the array isn't empty</span>
01959     <span class="comment">//</span>
01960 
01961     <span class="keywordflow">if</span> (ArrayCount == 0) {
01962         (*CapturedArray) = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01963         (*AlignedArraySize) = 0;
01964         <span class="keywordflow">return</span> STATUS_SUCCESS;
01965     }
01966 
01967     <span class="comment">//</span>
01968     <span class="comment">// Check there aren't too many SIDs</span>
01969     <span class="comment">//</span>
01970 
01971     <span class="keywordflow">if</span> (ArrayCount &gt; <a class="code" href="../../d6/d6/sep_8h.html#a12">SEP_MAX_GROUP_COUNT</a>) {
01972         <span class="keywordflow">return</span>(STATUS_INVALID_PARAMETER);
01973     }
01974     <span class="comment">//</span>
01975     <span class="comment">//  check if the requestor's mode is kernel mode and we are not</span>
01976     <span class="comment">//  to force a capture.</span>
01977     <span class="comment">//</span>
01978 
01979     <span class="keywordflow">if</span> ((RequestorMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp; (ForceCapture == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
01980 
01981         <span class="comment">//</span>
01982         <span class="comment">//  We don't need to do any work and can simply</span>
01983         <span class="comment">//  return a pointer to the input array</span>
01984         <span class="comment">//</span>
01985 
01986         (*CapturedArray) = <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a77">InputArray</a>;
01987 
01988         <span class="keywordflow">return</span> STATUS_SUCCESS;
01989     }
01990 
01991 
01992     <span class="comment">//</span>
01993     <span class="comment">// ---------- For RequestorMode == UserMode ----------------------</span>
01994     <span class="comment">//</span>
01995     <span class="comment">// the algorithm for capturing an SID_AND_ATTRIBUTES array is somewhat</span>
01996     <span class="comment">// convoluted to avoid problems that could occur if the data is</span>
01997     <span class="comment">// being changed while being captured.</span>
01998     <span class="comment">//</span>
01999     <span class="comment">// The algorithm uses two loops.</span>
02000     <span class="comment">//</span>
02001     <span class="comment">//    Allocate a temporary buffer to house the fixed length data.</span>
02002     <span class="comment">//</span>
02003     <span class="comment">//    1st loop:</span>
02004     <span class="comment">//          For each SID:</span>
02005     <span class="comment">//              Capture the Pointers to the SID and the length of the SID.</span>
02006     <span class="comment">//</span>
02007     <span class="comment">//    Allocate a buffer large enough to hold all of the data.</span>
02008     <span class="comment">//</span>
02009     <span class="comment">//    2nd loop:</span>
02010     <span class="comment">//          For each SID:</span>
02011     <span class="comment">//               Capture the Attributes.</span>
02012     <span class="comment">//               Capture the SID.</span>
02013     <span class="comment">//               Set the pointer to the SID.</span>
02014     <span class="comment">//</span>
02015     <span class="comment">//    Deallocate temporary buffer.</span>
02016     <span class="comment">//</span>
02017     <span class="comment">// ------------ For RequestorMode == KernelMode --------------------</span>
02018     <span class="comment">//</span>
02019     <span class="comment">// There is no need to capture the length and address of the SIDs</span>
02020     <span class="comment">// in the first loop (since the kernel can be trusted not to change</span>
02021     <span class="comment">// them while they are being copied.)  So for kernel mode, the first</span>
02022     <span class="comment">// loop just adds up the length needed.  Kernel mode, thus, avoids</span>
02023     <span class="comment">// having to allocate a temporary buffer.</span>
02024     <span class="comment">//</span>
02025 
02026     <span class="comment">//</span>
02027     <span class="comment">// Get the length needed to hold the array elements.</span>
02028     <span class="comment">//</span>
02029 
02030     ArraySize = ArrayCount * (ULONG)<span class="keyword">sizeof</span>(SID_AND_ATTRIBUTES);
02031     AlignedLengthRequired = (ULONG)LongAlignSize( ArraySize );
02032 
02033     <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
02034 
02035         <span class="comment">//</span>
02036         <span class="comment">// Allocate a temporary array to capture the array elements into</span>
02037         <span class="comment">//</span>
02038 
02039         TempArray =
02040             (TEMP_ARRAY_ELEMENT *)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PoolType, AlignedLengthRequired, 'aTeS');
02041 
02042         <span class="keywordflow">if</span> ( TempArray == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
02043             <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
02044         }
02045 
02046 
02047         <span class="keywordflow">try</span> {
02048 
02049             <span class="comment">//</span>
02050             <span class="comment">// Make sure we can read each SID_AND_ATTRIBUTE</span>
02051             <span class="comment">//</span>
02052 
02053             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( InputArray,
02054                           ArraySize,
02055                           <span class="keyword">sizeof</span>(ULONG) );
02056 
02057             <span class="comment">//</span>
02058             <span class="comment">// Probe and capture the length and address of each SID</span>
02059             <span class="comment">//</span>
02060 
02061             NextIndex = 0;
02062             <span class="keywordflow">while</span> (NextIndex &lt; ArrayCount) {
02063                 PSID TempSid;
02064 
02065                 TempSid = <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a77">InputArray</a>[NextIndex].Sid;
02066                 GetSidSubAuthorityCount =
02067                     <a class="code" href="../../d5/d8/ex_8h.html#a14">ProbeAndReadUchar</a>( &amp;((PISID)TempSid)-&gt;SubAuthorityCount);
02068 
02069                 <span class="keywordflow">if</span> (GetSidSubAuthorityCount &gt; SID_MAX_SUB_AUTHORITIES) {
02070                     CompletionStatus = STATUS_INVALID_SID;
02071                     <span class="keywordflow">break</span>;
02072                 }
02073 
02074                 TempArray[NextIndex].Sid = ((PISID)(TempSid));
02075                 TempArray[NextIndex].SidLength =
02076                     <a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>( GetSidSubAuthorityCount );
02077 
02078                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( TempArray[NextIndex].Sid,
02079                               TempArray[NextIndex].SidLength,
02080                               <span class="keyword">sizeof</span>(ULONG) );
02081 
02082                 AlignedLengthRequired +=
02083                     (ULONG)LongAlignSize( TempArray[NextIndex].SidLength );
02084 
02085                 NextIndex += 1;
02086 
02087             }  <span class="comment">//end while</span>
02088 
02089         } except(EXCEPTION_EXECUTE_HANDLER) {
02090 
02091             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( TempArray );
02092             <span class="keywordflow">return</span> GetExceptionCode();
02093         }
02094 
02095         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(CompletionStatus)) {
02096             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( TempArray );
02097             <span class="keywordflow">return</span>(CompletionStatus);
02098         }
02099 
02100     } <span class="keywordflow">else</span> {
02101 
02102         <span class="comment">//</span>
02103         <span class="comment">// No need to capture anything.</span>
02104         <span class="comment">// But, we do need to add up the lengths of the SIDs</span>
02105         <span class="comment">// so we can allocate a buffer (or check the size of one provided).</span>
02106         <span class="comment">//</span>
02107 
02108         NextIndex = 0;
02109 
02110         <span class="keywordflow">while</span> (NextIndex &lt; ArrayCount) {
02111 
02112             GetSidSubAuthorityCount =
02113                 ((PISID)(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a77">InputArray</a>[NextIndex].Sid))-&gt;SubAuthorityCount;
02114 
02115             AlignedLengthRequired +=
02116                 (ULONG)LongAlignSize(<a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>(GetSidSubAuthorityCount));
02117 
02118             NextIndex += 1;
02119 
02120         }  <span class="comment">//end while</span>
02121 
02122     }
02123 
02124 
02125     <span class="comment">//</span>
02126     <span class="comment">// Now we know how much memory we need.</span>
02127     <span class="comment">// Return this value in the output parameter.</span>
02128     <span class="comment">//</span>
02129 
02130     (*AlignedArraySize) = AlignedLengthRequired;
02131 
02132     <span class="comment">//</span>
02133     <span class="comment">// If a buffer was provided, make sure it is long enough.</span>
02134     <span class="comment">// Otherwise, allocate a buffer.</span>
02135     <span class="comment">//</span>
02136 
02137     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(CaptureBuffer)) {
02138 
02139         <span class="keywordflow">if</span> (AlignedLengthRequired &gt; CaptureBufferLength) {
02140 
02141             <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
02142                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( TempArray );
02143             }
02144 
02145             <span class="keywordflow">return</span> STATUS_BUFFER_TOO_SMALL;
02146 
02147         } <span class="keywordflow">else</span> {
02148 
02149             (*CapturedArray) = CaptureBuffer;
02150         }
02151 
02152     } <span class="keywordflow">else</span> {
02153 
02154         (*CapturedArray) =
02155             (PSID_AND_ATTRIBUTES)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PoolType, AlignedLengthRequired, 'aSeS');
02156 
02157         <span class="keywordflow">if</span> ( *CapturedArray == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
02158                 <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
02159                     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( TempArray );
02160                 }
02161             <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
02162         }
02163     }
02164 
02165 
02166     <span class="comment">//</span>
02167     <span class="comment">// Now copy everything.</span>
02168     <span class="comment">// This is done by copying all the SID_AND_ATTRIBUTES and then</span>
02169     <span class="comment">// copying each individual SID.</span>
02170     <span class="comment">//</span>
02171     <span class="comment">// All SIDs have already been probed for READ access.  We just</span>
02172     <span class="comment">// need to copy them.</span>
02173     <span class="comment">//</span>
02174     <span class="comment">//</span>
02175 
02176     <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
02177         <span class="keywordflow">try</span> {
02178 
02179             <span class="comment">//</span>
02180             <span class="comment">//  Copy the SID_AND_ATTRIBUTES array elements</span>
02181             <span class="comment">//  This really only sets the attributes, since we</span>
02182             <span class="comment">//  over-write the SID pointer field later on.</span>
02183             <span class="comment">//</span>
02184 
02185             NextBufferLocation = (*CapturedArray);
02186             RtlMoveMemory( NextBufferLocation, InputArray, ArraySize );
02187             NextBufferLocation = (PVOID)((ULONG_PTR)NextBufferLocation +
02188                                          (ULONG)LongAlignSize(ArraySize) );
02189 
02190             <span class="comment">//</span>
02191             <span class="comment">//  Now go through and copy each referenced SID.</span>
02192             <span class="comment">//  Validate each SID as it is copied.</span>
02193             <span class="comment">//</span>
02194 
02195             NextIndex = 0;
02196             NextElement = (*CapturedArray);
02197             <span class="keywordflow">while</span> (  (NextIndex &lt; ArrayCount) &amp;&amp;
02198                      (CompletionStatus == STATUS_SUCCESS) ) {
02199 
02200 
02201                 RtlMoveMemory( NextBufferLocation,
02202                     TempArray[NextIndex].Sid,
02203                     TempArray[NextIndex].SidLength );
02204 
02205 
02206                 NextElement[NextIndex].Sid = (PSID)NextBufferLocation;
02207                 NextBufferLocation =
02208                     (PVOID)((ULONG_PTR)NextBufferLocation +
02209                             (ULONG)LongAlignSize(TempArray[NextIndex].SidLength));
02210 
02211                 <span class="comment">//</span>
02212                 <span class="comment">// Verify the sid is valid and its length didn't change</span>
02213                 <span class="comment">//</span>
02214 
02215                 <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d6/sertl_8c.html#a35">RtlValidSid</a>(NextElement[NextIndex].Sid) ) {
02216                     CompletionStatus = STATUS_INVALID_SID;
02217                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a45">RtlLengthSid</a>(NextElement[NextIndex].Sid) != TempArray[NextIndex].SidLength) {
02218                     CompletionStatus = STATUS_INVALID_SID;
02219                 }
02220 
02221 
02222                 NextIndex += 1;
02223 
02224             }  <span class="comment">//end while</span>
02225 
02226 
02227         } except(EXCEPTION_EXECUTE_HANDLER) {
02228 
02229             <span class="keywordflow">if</span> (!ARGUMENT_PRESENT(CaptureBuffer)) {
02230                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( (*CapturedArray) );
02231             }
02232 
02233             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( TempArray );
02234 
02235             <span class="keywordflow">return</span> GetExceptionCode();
02236         }
02237     } <span class="keywordflow">else</span> {
02238 
02239         <span class="comment">//</span>
02240         <span class="comment">// Requestor mode is kernel mode -</span>
02241         <span class="comment">// don't need protection, probing, and validating</span>
02242         <span class="comment">//</span>
02243 
02244         <span class="comment">//</span>
02245         <span class="comment">//  Copy the SID_AND_ATTRIBUTES array elements</span>
02246         <span class="comment">//  This really only sets the attributes, since we</span>
02247         <span class="comment">//  over-write the SID pointer field later on.</span>
02248         <span class="comment">//</span>
02249 
02250         NextBufferLocation = (*CapturedArray);
02251         RtlMoveMemory( NextBufferLocation, InputArray, ArraySize );
02252         NextBufferLocation = (PVOID)( (ULONG_PTR)NextBufferLocation +
02253                                       (ULONG)LongAlignSize(ArraySize));
02254 
02255         <span class="comment">//</span>
02256         <span class="comment">//  Now go through and copy each referenced SID</span>
02257         <span class="comment">//</span>
02258 
02259         NextIndex = 0;
02260         NextElement = (*CapturedArray);
02261         <span class="keywordflow">while</span> (NextIndex &lt; ArrayCount) {
02262 
02263             GetSidSubAuthorityCount =
02264                 ((PISID)(NextElement[NextIndex].Sid))-&gt;SubAuthorityCount;
02265 
02266             RtlMoveMemory(
02267                 NextBufferLocation,
02268                 NextElement[NextIndex].Sid,
02269                 <a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>(GetSidSubAuthorityCount) );
02270                 SidSize = <a class="code" href="../../d8/d6/sertl_8c.html#a38">RtlLengthRequiredSid</a>( GetSidSubAuthorityCount );
02271                 AlignedSidSize = (ULONG)LongAlignSize(SidSize);
02272 
02273             NextElement[NextIndex].Sid = (PSID)NextBufferLocation;
02274 
02275             NextIndex += 1;
02276             NextBufferLocation = (PVOID)((ULONG_PTR)NextBufferLocation +
02277                                                    AlignedSidSize);
02278 
02279         }  <span class="comment">//end while</span>
02280 
02281     }
02282 
02283     <span class="keywordflow">if</span> (RequestorMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
02284         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( TempArray );
02285     }
02286 
02287     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT(CaptureBuffer) &amp;&amp; !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(CompletionStatus)) {
02288         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( (*CapturedArray) );
02289         *CapturedArray = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ;
02290     }
02291 
02292     <span class="keywordflow">return</span> CompletionStatus;
02293 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a118" doxytag="se.h::SeCaptureSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID SeCaptureSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SubjectContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">46</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00814">PsProcessAuditId</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00097">PsReferenceImpersonationToken()</a>, and <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00028">PsReferencePrimaryToken()</a>.
<p>
Referenced by <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01378">CmpNotifyChangeKey()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00593">IsPrivileged()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02492">NtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02627">NtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00731">NtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00406">NtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00532">NtSetUuidSeed()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02573">SeAuditHandleDuplication()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02466">SeAuditProcessCreation()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00504">SeCheckPrivilegedObject()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03826">SeCloseObjectAuditAlarm()</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00180">SeCreateAccessState()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03892">SeDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">SeSinglePrivilegeCheck()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00052                    :
00053 
00054     This routine takes a snapshot of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling thread's security
00055     context (locking tokens as necessary to <span class="keywordflow">do</span> so).  This function
00056     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> intended to support <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object manager and other components
00057     that utilize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference monitor's access validation,
00058     privilege test, and audit generation services.
00059 
00060     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> subject's security context should be captured before initiating
00061     access validation and should be released after audit messages
00062     are generated.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> necessary to provide a consistent security
00063     context to all those services.
00064 
00065     After calling access validation, privilege test, and audit generation
00066     services, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured context should be released as soon as possible
00067     <span class="keyword">using</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d0/d8/subject_8c.html#a3">SeReleaseSubjectContext</a>() service.
00068 
00069 Arguments:
00070 
00071     SubjectContext - Points to a <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> data structure
00072         to be filled in with a snapshot of the calling thread's security
00073         profile.
00074 
00075 Return Value:
00076 
00077     none.
00078 
00079 --*/
00080 
00081 {
00082 
00083     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> CurrentProcess;
00084 
00085     <span class="comment">//PVOID Objects[2];</span>
00086 
00087     BOOLEAN IgnoreCopyOnOpen;
00088     BOOLEAN IgnoreEffectiveOnly;
00089 
00090     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00091 
00092     CurrentProcess = <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>();
00093     SubjectContext-&gt;ProcessAuditId = <a class="code" href="../../d1/d9/ps_8h.html#a25">PsProcessAuditId</a>( CurrentProcess );
00094 
00095     <span class="comment">//</span>
00096     <span class="comment">// Get pointers to primary and impersonation tokens</span>
00097     <span class="comment">//</span>
00098 
00099     SubjectContext-&gt;ClientToken = <a class="code" href="../../d6/d5/ps_2security_8c.html#a1">PsReferenceImpersonationToken</a>(
00100                                       <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>(),
00101                                       &amp;IgnoreCopyOnOpen,
00102                                       &amp;IgnoreEffectiveOnly,
00103                                       &amp;(SubjectContext-&gt;ImpersonationLevel)
00104                                       );
00105 
00106     SubjectContext-&gt;PrimaryToken = <a class="code" href="../../d6/d5/ps_2security_8c.html#a0">PsReferencePrimaryToken</a>(CurrentProcess);
00107 
00108     <span class="keywordflow">return</span>;
00109 
00110 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a184" doxytag="se.h::SeCheckAuditPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SeCheckAuditPrivilege           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectSecurityContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00199">199</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01689">SeAuditPrivilege</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00038">SepPrivilegeCheck()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00989">SePrivilegedServiceAuditAlarm()</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02492">NtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02627">NtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00731">NtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00406">NtPrivilegeObjectAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>.
<p>
<pre class="fragment"><div>00205                    :
00206 
00207     This routine specifically searches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary token (rather than
00208     the effective token) of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling process <span class="keywordflow">for</span> <a class="code" href="../../d0/d5/se_8h.html#a98">SeAuditPrivilege</a>.
00209     In order to <span class="keywordflow">do</span> <span class="keyword">this</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> must call <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> underlying worker
00210     <a class="code" href="../../d8/d4/privileg_8c.html#a0">SepPrivilegeCheck</a> directly, to ensure that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> correct token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00211     searched
00212 
00213 Arguments:
00214 
00215     SubjectSecurityContext - The subject being examined.
00216 
00217     PreviousMode - The previous processor mode.
00218 
00219 Return Value:
00220 
00221     Returns <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject has <a class="code" href="../../d0/d5/se_8h.html#a98">SeAuditPrivilege</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise.
00222 
00223 --*/
00224 {
00225 
00226     PRIVILEGE_SET RequiredPrivileges;
00227     BOOLEAN AccessGranted;
00228 
00229     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00230 
00231     RequiredPrivileges.PrivilegeCount = 1;
00232     RequiredPrivileges.Control = PRIVILEGE_SET_ALL_NECESSARY;
00233     RequiredPrivileges.Privilege[0].Luid = <a class="code" href="../../d0/d5/se_8h.html#a98">SeAuditPrivilege</a>;
00234     RequiredPrivileges.Privilege[0].Attributes = 0;
00235 
00236     AccessGranted = <a class="code" href="../../d8/d3/tokenp_8h.html#a37">SepPrivilegeCheck</a>(
00237                         SubjectSecurityContext-&gt;PrimaryToken,     <span class="comment">// token</span>
00238                         RequiredPrivileges.Privilege,             <span class="comment">// privilege set</span>
00239                         RequiredPrivileges.PrivilegeCount,        <span class="comment">// privilege count</span>
00240                         PRIVILEGE_SET_ALL_NECESSARY,              <span class="comment">// privilege control</span>
00241                         PreviousMode                              <span class="comment">// previous mode</span>
00242                         );
00243 
00244     <span class="keywordflow">if</span> ( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ) {
00245 
00246         <a class="code" href="../../d3/d5/seaudit_8c.html#a15">SePrivilegedServiceAuditAlarm</a> (
00247             NULL,                              <span class="comment">// BUGWARNING need service name</span>
00248             SubjectSecurityContext,
00249             &amp;RequiredPrivileges,
00250             AccessGranted
00251             );
00252     }
00253 
00254     <span class="keywordflow">return</span>( AccessGranted );
00255 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a150" doxytag="se.h::SeCheckPrivilegedObject" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SeCheckPrivilegedObject           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LUID&nbsp;</td>
          <td class="mdname" nowrap> <em>PrivilegeValue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/privileg_8c-source.html#l00504">504</a> of file <a class="el" href="../../d9/d3/privileg_8c-source.html">privileg.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00158">SePrivilegeCheck()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00650">SePrivilegeObjectAuditAlarm()</a>, and <a class="el" href="../../d1/d7/subject_8c-source.html#l00196">SeReleaseSubjectContext()</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, and <a class="el" href="../../d0/d1/psquery_8c-source.html#l00366">PspSetPrimaryToken()</a>.
<p>
<pre class="fragment"><div>00513                    :
00514 
00515     This function will check <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed privilege value in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00516     current context, and generate audits as appropriate.
00517 
00518 Arguments:
00519 
00520     PrivilegeValue - The value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege being checked.
00521 
00522     Object - Specifies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being accessed.
00523 
00524     ObjectHandle - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object handle being used.
00525 
00526     DesiredAccess - The desired access mask, <span class="keywordflow">if</span> any
00527 
00528     PreviousMode - The previous processor mode
00529 
00530 
00531 Return Value:
00532 
00533     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The current subject has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired privilege.
00534 
00535     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - The current subject does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired privilege.
00536 --*/
00537 
00538 {
00539     BOOLEAN AccessGranted;
00540     PRIVILEGE_SET RequiredPrivileges;
00541     <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext;
00542 
00543     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00544 
00545     <span class="comment">//</span>
00546     <span class="comment">// Make sure the caller has the privilege to make this</span>
00547     <span class="comment">// call.</span>
00548     <span class="comment">//</span>
00549 
00550     RequiredPrivileges.PrivilegeCount = 1;
00551     RequiredPrivileges.Control = PRIVILEGE_SET_ALL_NECESSARY;
00552     RequiredPrivileges.Privilege[0].Luid = PrivilegeValue;
00553     RequiredPrivileges.Privilege[0].Attributes = 0;
00554 
00555     <a class="code" href="../../d0/d8/subject_8c.html#a0">SeCaptureSubjectContext</a>( &amp;SubjectSecurityContext );
00556 
00557     AccessGranted = <a class="code" href="../../d8/d4/privileg_8c.html#a1">SePrivilegeCheck</a>(
00558                         &amp;RequiredPrivileges,
00559                         &amp;SubjectSecurityContext,
00560                         PreviousMode
00561                         );
00562 
00563     <span class="keywordflow">if</span> ( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ) {
00564 
00565         <a class="code" href="../../d3/d5/seaudit_8c.html#a13">SePrivilegeObjectAuditAlarm</a>(
00566             ObjectHandle,
00567             &amp;SubjectSecurityContext,
00568             DesiredAccess,
00569             &amp;RequiredPrivileges,
00570             AccessGranted,
00571             PreviousMode
00572             );
00573 
00574     }
00575 
00576 
00577     <a class="code" href="../../d0/d8/subject_8c.html#a3">SeReleaseSubjectContext</a>( &amp;SubjectSecurityContext );
00578 
00579     <span class="keywordflow">return</span>( AccessGranted );
00580 
00581 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a144" doxytag="se.h::SeCloseObjectAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeCloseObjectAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateOnClose</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03826">3826</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01312">SepAdtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00183">SepTokenAuthenticationId</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00176">SepTokenUserSid</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00196">SeReleaseSubjectContext()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01711">SeSubsystemName</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>.
<p>
<pre class="fragment"><div>03834                    :
03835 
03836     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to generate audit and alarm messages when a handle
03837     to an object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> deleted.
03838 
03839     This routine may result in several messages being generated and sent to
03840     Port objects.  This may result in a significant latency before
03841     returning.  Design of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a> that must call <span class="keyword">this</span> routine must take
03842     <span class="keyword">this</span> potential latency into account.  This may have an impact on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03843     approach taken <span class="keywordflow">for</span> data structure mutex locking, <span class="keywordflow">for</span> example.
03844 
03845 Arguments:
03846 
03847     Object - Address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being accessed.  This value will not be
03848         used as a pointer (referenced).  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> necessary <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> to enter into
03849         log messages.
03850 
03851     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle value assigned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> open.
03852 
03853     GenerateOnClose - Is a <span class="keywordtype">boolean</span> value returned from a corresponding
03854         <a class="code" href="../../d3/d5/seaudit_8c.html#a23">SeOpenObjectAuditAlarm</a>() call when the object handle was created.
03855 
03856 Return Value:
03857 
03858     None.
03859 
03860 --*/
03861 
03862 {
03863     <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext;
03864     PSID UserSid;
03865     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03866 
03867     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03868 
03869     <span class="keywordflow">if</span> (GenerateOnClose) {
03870 
03871         <a class="code" href="../../d0/d8/subject_8c.html#a0">SeCaptureSubjectContext</a> ( &amp;SubjectSecurityContext );
03872 
03873         UserSid = <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>( EffectiveToken (&amp;SubjectSecurityContext));
03874 
03875 
03876         <a class="code" href="../../d7/d6/sepaudit_8c.html#a13">SepAdtCloseObjectAuditAlarm</a> (
03877             &amp;SeSubsystemName,
03878             (PVOID)Handle,
03879             Object,
03880             UserSid,
03881             <a class="code" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>( EffectiveToken (&amp;SubjectSecurityContext))
03882             );
03883 
03884         <a class="code" href="../../d0/d8/subject_8c.html#a3">SeReleaseSubjectContext</a> ( &amp;SubjectSecurityContext );
03885     }
03886 
03887     <span class="keywordflow">return</span>;
03888 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a181" doxytag="se.h::SeComputeQuotaInformationSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeComputeQuotaInformationSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l02350">2350</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00161">Dacl</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00160">Group</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00540">SeLengthSid</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00248">ObpCaptureObjectCreateInformation()</a>.
<p>
<pre class="fragment"><div>02357                    :
02358 
02359     This routine computes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> and DACL <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02360     passed security descriptor.
02361 
02362     This quantity will later be used in calculating <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> amount
02363     of quota to charge <span class="keywordflow">for</span> <span class="keyword">this</span> object.
02364 
02365 Arguments:
02366 
02367     SecurityDescriptor - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor
02368         to be examined.
02369 
02370     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size in bytes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sum of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> and <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>
02371         fields of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor.
02372 
02373 Return Value:
02374 
02375     STATUS_SUCCESS - The operation was successful.
02376 
02377     STATUS_INVALID_REVISION - The passed security descriptor was of
02378         an unknown revision.
02379 
02380 --*/
02381 
02382 {
02383     PISECURITY_DESCRIPTOR ISecurityDescriptor;
02384 
02385     PSID <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a>;
02386     PACL <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>;
02387 
02388     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02389 
02390     ISecurityDescriptor = (PISECURITY_DESCRIPTOR)SecurityDescriptor;
02391     *<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = 0;
02392 
02393     <span class="keywordflow">if</span> (ISecurityDescriptor-&gt;Revision != SECURITY_DESCRIPTOR_REVISION) {
02394         <span class="keywordflow">return</span>( STATUS_UNKNOWN_REVISION );
02395     }
02396 
02397     <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> = RtlpGroupAddrSecurityDescriptor( ISecurityDescriptor );
02398 
02399     <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> = RtlpDaclAddrSecurityDescriptor( ISecurityDescriptor );
02400 
02401     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02402         *<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> += (ULONG)LongAlignSize(<a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>( Group ));
02403     }
02404 
02405     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02406         *<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> += (ULONG)LongAlignSize(<a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>-&gt;AclSize);
02407     }
02408 
02409     <span class="keywordflow">return</span>( STATUS_SUCCESS );
02410 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a164" doxytag="se.h::SeCopyClientToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeCopyClientToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientToken</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SECURITY_IMPERSONATION_LEVEL&nbsp;</td>
          <td class="mdname" nowrap> <em>ImpersonationLevel</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACCESS_TOKEN *&nbsp;</td>
          <td class="mdname" nowrap> <em>DuplicateToken</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01227">1227</a> of file <a class="el" href="../../d7/d2/tokendup_8c-source.html">tokendup.c</a>.
<p>
References <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00039">ClientToken</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00362">SepDuplicateToken()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/seclient_8c-source.html#l00062">SepCreateClientSecurity()</a>.
<p>
<pre class="fragment"><div>01237                    :
01238 
01239     This routine copies a client's token as part of establishing a client
01240     context <span class="keywordflow">for</span> impersonation.
01241 
01242     The result will be an impersonation token.
01243 
01244     No handles to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> token are established.
01245 
01246     The token will be an exact duplicate of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source token.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01247     caller's responsibility to ensure an effective <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> copy of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token
01248     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> produced when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> opened, <span class="keywordflow">if</span> necessary.
01249 
01250 
01251 Arguments:
01252 
01253     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a16">ClientToken</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token to be duplicated.  This may be either
01254         a primary or impersonation token.
01255 
01256     ImpersonationLevel - The impersonation level to be assigned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span>
01257         token.
01258 
01259     RequestorMode - Mode to be assigned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner mode of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> token.
01260 
01261     DuplicateToken - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> duplicate token.
01262         The token has not yet been inserted into any object table.
01263         No exceptions are expected when tring to set <span class="keyword">this</span> OUT value.
01264 
01265 Return Value:
01266 
01267     STATUS_SUCCESS - The service successfully completed <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested
01268         operation.
01269 
01270 
01271 --*/
01272 {
01273     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01274     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
01275     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> NewToken;
01276 
01277     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01278 
01279     InitializeObjectAttributes(
01280         &amp;ObjectAttributes,
01281         NULL,
01282         0,
01283         NULL,
01284         NULL
01285         );
01286 
01287     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d3/tokenp_8h.html#a27">SepDuplicateToken</a>(
01288                  (PTOKEN)ClientToken,              <span class="comment">// ExistingToken</span>
01289                  &amp;ObjectAttributes,                <span class="comment">// ObjectAttributes</span>
01290                  FALSE,                            <span class="comment">// EffectiveOnly</span>
01291                  TokenImpersonation,               <span class="comment">// TokenType  (target)</span>
01292                  ImpersonationLevel,               <span class="comment">// ImpersonationLevel</span>
01293                  RequestorMode,                    <span class="comment">// RequestorMode</span>
01294                  &amp;NewToken                         <span class="comment">// DuplicateToken</span>
01295                  );
01296 
01297     (*DuplicateToken) = (PACCESS_TOKEN)NewToken;
01298 
01299     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01300 
01301 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a173" doxytag="se.h::SeCreateAccessState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeCreateAccessState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AuxData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/seastate_8c-source.html#l00180">180</a> of file <a class="el" href="../../d3/d4/seastate_8c-source.html">seastate.c</a>.
<p>
References <a class="el" href="../../d0/d5/se_8h.html#a25">ACCESS_STATE</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03024">ExAllocateLocallyUniqueId</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00027">GENERIC_ACCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l03381">RtlMapGenericMask()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, and <a class="el" href="../../d1/d4/se_8h-source.html#l00072">TOKEN_HAS_TRAVERSE_PRIVILEGE</a>.
<p>
Referenced by <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00555">AccessCheckObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d8/d0/psopen_8c-source.html#l00030">NtOpenProcess()</a>, <a class="el" href="../../d8/d0/psopen_8c-source.html#l00280">NtOpenThread()</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00095">ObOpenObjectByName()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00367">ObOpenObjectByPointer()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00844">ObReferenceObjectByName()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>.
<p>
<pre class="fragment"><div>00188                    :
00189 
00190     This routine initializes an <a class="code" href="../../d2/d5/struct__ACCESS__STATE.html">ACCESS_STATE</a> structure.  This consists
00191     of:
00192 
00193     - zeroing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire structure
00194 
00195     - mapping generic access types in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed DesiredAccess
00196     and putting <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> structure
00197 
00198     - <span class="stringliteral">"capturing"</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Subject Context, which must be held <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00199     duration of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access attempt (at least until auditing is performed).
00200 
00201     - Allocating an Operation <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>, which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> an LUID that will be used
00202     to associate different parts of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access attempt in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> audit
00203     log.
00204 
00205 Arguments:
00206 
00207     AccessState - a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> structure to be initialized.
00208 
00209     AuxData - Supplies a buffer big enough <span class="keywordflow">for</span> an AuxData structure
00210         so we don'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> have to allocate one.
00211 
00212     DesiredAccess - Access mask containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired access
00213 
00214     GenericMapping - Optionally supplies a pointer to a generic mapping
00215         that may be used to map any generic access requests that may
00216         have been passed in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DesiredAccess parameter.
00217 
00218         Note that <span class="keywordflow">if</span> <span class="keyword">this</span> parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not supplied, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> must be filled
00219         in at some later point.  The IO system does <span class="keyword">this</span> in <a class="code" href="../../d0/d6/iop_8h.html#a199">IopParseDevice</a>.
00220 
00221 Return Value:
00222 
00223     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a1">Error</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> attempt to allocate an LUID fails.
00224 
00225     Note that <span class="keyword">this</span> error may be safely ignored <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> known that all
00226     security checks will be performed with PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>.
00227     Know what you're doing <span class="keywordflow">if</span> you choose to ignore <span class="keyword">this</span>.
00228 
00229 --*/
00230 
00231 {
00232 
00233     ACCESS_MASK MappedAccessMask;
00234     PSECURITY_DESCRIPTOR InputSecurityDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00235 
00236     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00237 
00238     <span class="comment">//</span>
00239     <span class="comment">// Don't modify what he passed in</span>
00240     <span class="comment">//</span>
00241 
00242     MappedAccessMask = DesiredAccess;
00243 
00244     <span class="comment">//</span>
00245     <span class="comment">// Map generic access to object specific access iff generic access types</span>
00246     <span class="comment">// are specified and a generic access mapping table is provided.</span>
00247     <span class="comment">//</span>
00248 
00249     <span class="keywordflow">if</span> ( ((DesiredAccess &amp; <a class="code" href="../../d9/d0/obhandle_8c.html#a0">GENERIC_ACCESS</a>) != 0) &amp;&amp;
00250          ARGUMENT_PRESENT(GenericMapping) ) {
00251 
00252         <a class="code" href="../../d8/d6/sertl_8c.html#a70">RtlMapGenericMask</a>(
00253             &amp;MappedAccessMask,
00254             GenericMapping
00255             );
00256     }
00257 
00258     RtlZeroMemory(AccessState, <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d5/struct__ACCESS__STATE.html">ACCESS_STATE</a>));
00259 
00260     <span class="comment">//</span>
00261     <span class="comment">// Assume RtlZeroMemory has initialized these fields properly</span>
00262     <span class="comment">//</span>
00263 
00264     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( AccessState-&gt;SecurityDescriptor == NULL );
00265     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( AccessState-&gt;PrivilegesAllocated == FALSE );
00266 
00267     AccessState-&gt;AuxData = AuxData;
00268 
00269     <a class="code" href="../../d0/d8/subject_8c.html#a0">SeCaptureSubjectContext</a>(&amp;AccessState-&gt;SubjectSecurityContext);
00270 
00271     <span class="keywordflow">if</span> (((<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( &amp;AccessState-&gt;SubjectSecurityContext ))-&gt;TokenFlags &amp; <a class="code" href="../../d0/d5/se_8h.html#a1">TOKEN_HAS_TRAVERSE_PRIVILEGE</a> ) {
00272         AccessState-&gt;Flags = <a class="code" href="../../d0/d5/se_8h.html#a1">TOKEN_HAS_TRAVERSE_PRIVILEGE</a>;
00273     }
00274 
00275     AccessState-&gt;RemainingDesiredAccess = MappedAccessMask;
00276     AccessState-&gt;OriginalDesiredAccess = MappedAccessMask;
00277     AuxData-&gt;PrivilegesUsed = (PPRIVILEGE_SET)((ULONG_PTR)AccessState +
00278                               (FIELD_OFFSET(<a class="code" href="../../d2/d5/struct__ACCESS__STATE.html">ACCESS_STATE</a>, Privileges)));
00279 
00280     <a class="code" href="../../d5/d8/ex_8h.html#a79">ExAllocateLocallyUniqueId</a>(&amp;AccessState-&gt;OperationID);
00281 
00282     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(GenericMapping)) {
00283         AuxData-&gt;GenericMapping = *GenericMapping;
00284     }
00285 
00286     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00287 
00288 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a169" doxytag="se.h::SeCreateClientSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeCreateClientSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_QUALITY_OF_SERVICE&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientSecurityQos</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>RemoteSession</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d8/d0/struct__SECURITY__CLIENT__CONTEXT.html">PSECURITY_CLIENT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientContext</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/seclient_8c-source.html#l00209">209</a> of file <a class="el" href="../../d5/d4/seclient_8c-source.html">seclient.c</a>.
<p>
References <a class="el" href="../../d8/d6/uclient_8c-source.html#l00033">ClientThread()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00208">PsReferenceEffectiveToken()</a>, <a class="el" href="../../d5/d4/seclient_8c-source.html#l00062">SepCreateClientSecurity()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d9/d8/cmapi_8c-source.html#l01901">CmLoadKey()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l10107">MESSAGECALL()</a>, <a class="el" href="../../d0/d0/psimpers_8c-source.html#l00026">NtImpersonateThread()</a>, and <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>.
<p>
<pre class="fragment"><div>00218                    :
00219 
00220     This service initializes a context block to represent a client's
00221     security context.  This may simply result in a reference to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00222     client's token, or may cause <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client's token to be duplicated,
00223     depending upon <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security quality of service information specified.
00224 
00225                                NOTE
00226 
00227         The code in <span class="keyword">this</span> routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> optimized <span class="keywordflow">for</span> DYNAMIC context
00228         tracking.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> mode in which direct access to a
00229         caller's token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allowed, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mode expected to be used
00230         most often.  <a class="code" href="../../d7/d9/assign_8c.html#a3">STATIC</a> context tracking always requires <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00231         caller's token to be copied.
00232 
00233 
00234 Arguments:
00235 
00236     <a class="code" href="../../d7/d7/uclient_8c.html#a6">ClientThread</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client's thread.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to
00237         locate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client's security context (token).
00238 
00239     ClientSecurityQos - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security quality of service
00240         parameters specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client <span class="keywordflow">for</span> <span class="keyword">this</span> communication
00241         session.
00242 
00243     ServerIsRemote - Provides an indication as to whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> session
00244         <span class="keyword">this</span> context block <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being used <span class="keywordflow">for</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> an inter-system
00245         session or intra-system session.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> reconciled with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00246         impersonation level of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client thread's token (in <span class="keywordflow">case</span> the
00247         client has a client of his own that didn't specify delegation).
00248 
00249     ClientContext - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client security context block to be
00250         initialized.
00251 
00252 
00253 Return Value:
00254 
00255     STATUS_SUCCESS - The service completed successfully.
00256 
00257     STATUS_BAD_IMPERSONATION_LEVEL - The client <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently
00258         impersonating either an Anonymous or Identification level
00259         token, which can not be passed on <span class="keywordflow">for</span> use by another server.
00260         This status may also be returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security context
00261         block <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keywordflow">for</span> an inter-system communication session and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00262         client thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> impersonating a client of its own <span class="keyword">using</span>
00263         other than delegation impersonation level.
00264 
00265 
00266 --*/
00267 
00268 {
00269     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00270     PACCESS_TOKEN <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00271     TOKEN_TYPE TokenType;
00272     BOOLEAN ThreadEffectiveOnly;
00273     SECURITY_IMPERSONATION_LEVEL ImpersonationLevel;
00274     PACCESS_TOKEN DuplicateToken;
00275 
00276     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00277 
00278     <span class="comment">//</span>
00279     <span class="comment">// Gain access to the client thread's effective token</span>
00280     <span class="comment">//</span>
00281 
00282     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = <a class="code" href="../../d6/d5/ps_2security_8c.html#a2">PsReferenceEffectiveToken</a>(
00283                 ClientThread,
00284                 &amp;TokenType,
00285                 &amp;ThreadEffectiveOnly,
00286                 &amp;ImpersonationLevel
00287                 );
00288 
00289 
00290     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d5/seclient_8c.html#a0">SepCreateClientSecurity</a>(
00291                 Token,
00292                 ClientSecurityQos,
00293                 ServerIsRemote,
00294                 TokenType,
00295                 ThreadEffectiveOnly,
00296                 ImpersonationLevel,
00297                 ClientContext );
00298 
00299     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> ;
00300 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a172" doxytag="se.h::SeCreateClientSecurityFromSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeCreateClientSecurityFromSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_QUALITY_OF_SERVICE&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientSecurityQos</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ServerIsRemote</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d8/d0/struct__SECURITY__CLIENT__CONTEXT.html">PSECURITY_CLIENT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientContext</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/seclient_8c-source.html#l00712">712</a> of file <a class="el" href="../../d5/d4/seclient_8c-source.html">seclient.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d4/seclient_8c-source.html#l00062">SepCreateClientSecurity()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00732">SeQuerySubjectContextToken</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
<pre class="fragment"><div>00720                    :
00721 
00722     This service initializes a context block to represent a client's
00723     security context.  This may simply result in a reference to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00724     client's token, or may cause <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client's token to be duplicated,
00725     depending upon <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security quality of service information specified.
00726 
00727                                NOTE
00728 
00729         The code in <span class="keyword">this</span> routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> optimized <span class="keywordflow">for</span> DYNAMIC context
00730         tracking.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> mode in which direct access to a
00731         caller's token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allowed, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mode expected to be used
00732         most often.  <a class="code" href="../../d7/d9/assign_8c.html#a3">STATIC</a> context tracking always requires <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00733         caller's token to be copied.
00734 
00735 
00736 Arguments:
00737 
00738     SubjectContext - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SubjectContext that should serve
00739         as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> basis <span class="keywordflow">for</span> <span class="keyword">this</span> client context.
00740 
00741     ClientSecurityQos - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security quality of service
00742         parameters specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client <span class="keywordflow">for</span> <span class="keyword">this</span> communication
00743         session.
00744 
00745     ServerIsRemote - Provides an indication as to whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> session
00746         <span class="keyword">this</span> context block <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being used <span class="keywordflow">for</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> an inter-system
00747         session or intra-system session.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> reconciled with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00748         impersonation level of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client thread's token (in <span class="keywordflow">case</span> the
00749         client has a client of his own that didn't specify delegation).
00750 
00751     ClientContext - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client security context block to be
00752         initialized.
00753 
00754 
00755 Return Value:
00756 
00757     STATUS_SUCCESS - The service completed successfully.
00758 
00759     STATUS_BAD_IMPERSONATION_LEVEL - The client <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently
00760         impersonating either an Anonymous or Identification level
00761         token, which can not be passed on <span class="keywordflow">for</span> use by another server.
00762         This status may also be returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security context
00763         block <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keywordflow">for</span> an inter-system communication session and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00764         client thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> impersonating a client of its own <span class="keyword">using</span>
00765         other than delegation impersonation level.
00766 
00767 
00768 --*/
00769 
00770 {
00771     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00772     PACCESS_TOKEN <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00773     TOKEN_TYPE Type;
00774     BOOLEAN ThreadEffectiveOnly;
00775     SECURITY_IMPERSONATION_LEVEL ImpersonationLevel;
00776     PACCESS_TOKEN DuplicateToken;
00777 
00778     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00779 
00780     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = <a class="code" href="../../d0/d5/se_8h.html#a16">SeQuerySubjectContextToken</a>(
00781                 SubjectContext
00782                 );
00783 
00784     <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>( Token );
00785 
00786     <span class="keywordflow">if</span> ( SubjectContext-&gt;ClientToken )
00787     {
00788         Type = TokenImpersonation ;
00789     }
00790     <span class="keywordflow">else</span> 
00791     {
00792         Type = TokenPrimary ;
00793     }
00794 
00795     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d5/seclient_8c.html#a0">SepCreateClientSecurity</a>(
00796                 Token,
00797                 ClientSecurityQos,
00798                 ServerIsRemote,
00799                 Type,
00800                 FALSE,
00801                 SubjectContext-&gt;ImpersonationLevel,
00802                 ClientContext
00803                 );
00804 
00805     
00806     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> ;
00807 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a146" doxytag="se.h::SeCreateInstanceAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeCreateInstanceAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID OperationID&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectSecurityContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET Privileges&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a147" doxytag="se.h::SeCreateObjectAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeCreateObjectAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID OperationID&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ComponentName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectSecurityContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET Privileges&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AuditPerformed</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03538">3538</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d4/d2/tob_8c-source.html#l00048">DirectoryName</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">SepAdtAuditThisEvent</a>, <a class="el" href="../../d1/d5/adtp_8h.html#a22">SepAdtCreateObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03952">SepExamineSacl()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02324">SepQueryNameString()</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00183">SepTokenAuthenticationId</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00176">SepTokenUserSid</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/cmse_8c-source.html#l00917">CmpCheckCreateAccess()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l00983">ObCheckCreateObjectAccess()</a>.
<p>
<pre class="fragment"><div>03553                    :
03554 
03555     Audits <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> creation of an object in a directory.
03556 
03557 Arguments:
03558 
03559     OperationID - Optionally supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LUID representing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation
03560         <span class="keywordtype">id</span> <span class="keywordflow">for</span> <span class="keyword">this</span> operation.
03561 
03562     DirectoryObject - Provides a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> directory object being
03563         examined.
03564 
03565     ComponentName - Provides a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> string containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03566         relative name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being created.
03567 
03568     SecurityDescriptor - The security descriptor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed direcctory.
03569 
03570     SubjectSecurityContext - The current subject context.
03571 
03572     DesiredAccess - The desired access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> directory.
03573 
03574     Privileges - Returns any privileges that were used <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access attempt.
03575 
03576     AccessGranted - Returns whether or not <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was successful.
03577 
03578     AuditPerformed - Returns whether or not auditing was performed.
03579 
03580     AccessMode - The previous mode.
03581 
03582 Return Value:
03583 
03584     <span class="keywordflow">return</span>-value - <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> of conditions needed to <span class="keywordflow">return</span> value. - or -
03585     None.
03586 
03587 --*/
03588 
03589 {
03590     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03591 <span class="preprocessor">#if 0</span>
03592 <span class="preprocessor"></span>
03593     BOOLEAN GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03594     BOOLEAN GenerateAlarm = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03595     PUNICODE_STRING <a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>;
03596     POBJECT_NAME_INFORMATION ObjectNameInformation = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03597 
03598     UNREFERENCED_PARAMETER( DirectoryObject );
03599     UNREFERENCED_PARAMETER( Privileges );
03600 
03601     <span class="keywordflow">if</span> (AccessMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
03602         <span class="keywordflow">return</span>;
03603     }
03604 
03605     <span class="keywordflow">if</span> ( SecurityDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03606 
03607         <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryObjectAccess, &amp;AccessGranted )) {
03608 
03609             <a class="code" href="../../d6/d6/sep_8h.html#a62">SepExamineSacl</a>(
03610                 RtlpSaclAddrSecurityDescriptor( (PISECURITY_DESCRIPTOR)SecurityDescriptor ),
03611                 <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( SubjectSecurityContext ),
03612                 DesiredAccess,
03613                 AccessGranted,
03614                 &amp;GenerateAudit,
03615                 &amp;GenerateAlarm
03616                 );
03617 
03618             <span class="keywordflow">if</span> ( GenerateAudit || GenerateAlarm ) {
03619 
03620                 <span class="comment">//</span>
03621                 <span class="comment">// Call ob for the name of the directory.</span>
03622                 <span class="comment">//</span>
03623 
03624                 ObjectNameInformation = <a class="code" href="../../d7/d6/sepaudit_8c.html#a17">SepQueryNameString</a>( DirectoryObject );
03625 
03626                 <span class="keywordflow">if</span> ( ObjectNameInformation != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03627 
03628                     <a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a> = &amp;ObjectNameInformation-&gt;Name;
03629                 }
03630 
03631                 <a class="code" href="../../d1/d5/adtp_8h.html#a22">SepAdtCreateObjectAuditAlarm</a>(
03632                     OperationID,
03633                     DirectoryName,
03634                     ComponentName,
03635                     <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>(<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( SubjectSecurityContext )),
03636                     <a class="code" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>( <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( SubjectSecurityContext )),
03637                     DesiredAccess,
03638                     AccessGranted,
03639                     GenerateAudit,
03640                     GenerateAlarm
03641                     );
03642 
03643                 *AuditPerformed = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03644 
03645                 <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03646 
03647                     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( DirectoryName );
03648                 }
03649             }
03650         }
03651     }
03652 
03653 <span class="preprocessor">#endif</span>
03654 <span class="preprocessor"></span>
03655     <span class="keywordflow">return</span>;
03656 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a162" doxytag="se.h::SeDeassignPrimaryToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeDeassignPrimaryToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Process</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l00302">302</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>.
<p>
Referenced by <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01206">PspDeleteProcessSecurity()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l00241">SeAssignPrimaryToken()</a>.
<p>
<pre class="fragment"><div>00309                    :
00310 
00311     This function causes a process reference to a token to be
00312     dropped.
00313 
00314 Arguments:
00315 
00316     Process - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process whose primary token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no longer needed.
00317         This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> probably <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">case</span> at process deletion or when
00318         a primary token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being replaced.
00319 
00320 Return Value:
00321 
00322     None.
00323 
00324 --*/
00325 
00326 {
00327 
00328     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>
00329         OldToken = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)(Process-&gt;Token);
00330 
00331     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00332 
00333     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(OldToken-&gt;TokenType == TokenPrimary);
00334     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(OldToken-&gt;TokenInUse);
00335 
00336     OldToken-&gt;TokenInUse = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00337     <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( OldToken );
00338 
00339 
00340     <span class="keywordflow">return</span>;
00341 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a134" doxytag="se.h::SeDeassignSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeDeassignSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SecurityDescriptor</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00373">373</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d4/d1/cmparse2_8c-source.html#l00226">CmpDoCreateChild()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01574">ObAssignSecurity()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00379                    :
00380 
00381     This routine deallocates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory associated with a security descriptor
00382     that was assigned <span class="keyword">using</span> <a class="code" href="../../d0/d5/se_8h.html#a132">SeAssignSecurity</a>.
00383 
00384 
00385 Arguments:
00386 
00387     SecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security
00388         descriptor  being deleted.
00389 
00390 Return Value:
00391 
00392     STATUS_SUCCESS - The deallocation was successful.
00393 
00394 --*/
00395 
00396 {
00397     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00398 
00399     <span class="keywordflow">if</span> ((*SecurityDescriptor) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00400         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( (*SecurityDescriptor) );
00401     }
00402 
00403     <span class="comment">//</span>
00404     <span class="comment">//  And zero out the pointer to it for safety sake</span>
00405     <span class="comment">//</span>
00406 
00407     (*SecurityDescriptor) = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00408 
00409     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00410 
00411 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a115" doxytag="se.h::SeDefaultObjectMethod" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeDefaultObjectMethod           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/se_8h.html#a19">SECURITY_OPERATION_CODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OperationCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectsSecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d5/semethod_8c-source.html#l00195">195</a> of file <a class="el" href="../../d1/d5/semethod_8c-source.html">semethod.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d5/se_8h.html#a200a111">AssignSecurityDescriptor</a>, <a class="el" href="../../d0/d5/se_8h.html#a200a110">DeleteSecurityDescriptor</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01183">ObAssignObjectSecurityDescriptor()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01679">ObQuerySecurityDescriptorInfo()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01748">ObSetSecurityDescriptorInfo()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d0/d5/se_8h.html#a200a109">QuerySecurityDescriptor</a>, <a class="el" href="../../d1/d5/semethod_8c-source.html#l00920">SepDefaultDeleteMethod()</a>, and <a class="el" href="../../d0/d5/se_8h.html#a200a108">SetSecurityDescriptor</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00069">ObCreateObjectType()</a>, and <a class="el" href="../../d2/d5/tse_8c-source.html#l00205">TestDefaultObjectMethod()</a>.
<p>
<pre class="fragment"><div>00208                    :
00209 
00210     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> security method <span class="keywordflow">for</span> objects.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> responsible
00211     <span class="keywordflow">for</span> either retrieving, setting, and deleting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of
00212     an object.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not used to assign <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> original security descriptor
00213     to an object (use SeAssignSecurity <span class="keywordflow">for</span> that purpose).
00214 
00215 
00216     IT IS ASSUMED THAT THE OBJECT MANAGER HAS ALREADY DONE THE ACCESS
00217     VALIDATIONS NECESSARY TO ALLOW THE REQUESTED OPERATIONS TO BE PERFORMED.
00218 
00219 Arguments:
00220 
00221     Object - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being used.
00222 
00223     OperationCode - Indicates <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keywordflow">for</span> setting, querying, or
00224         deleting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object's security descriptor.
00225 
00226     SecurityInformation - Indicates which security information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being
00227         queried or set.  This argument <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">delete</span> operation.
00228 
00229     SecurityDescriptor - The meaning of <span class="keyword">this</span> parameter depends on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00230         OperationCode:
00231 
00232         <a class="code" href="../../d0/d5/se_8h.html#a200a109">QuerySecurityDescriptor</a> - For <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query operation <span class="keyword">this</span> supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00233             buffer to copy <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> descriptor into.  The security descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00234             assumed to have been probed up to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size passed in in Length.
00235             Since <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> still points into user space, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> must always be
00236             accessed in a <span class="keywordflow">try</span> clause in <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> should suddenly disappear.
00237 
00238         <a class="code" href="../../d0/d5/se_8h.html#a200a108">SetSecurityDescriptor</a> - For a set operation <span class="keyword">this</span> supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00239             security descriptor to copy into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.  The security
00240             descriptor must be captured before <span class="keyword">this</span> routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called.
00241 
00242         <a class="code" href="../../d0/d5/se_8h.html#a200a110">DeleteSecurityDescriptor</a> - It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored when deleting a security
00243             descriptor.
00244 
00245         <a class="code" href="../../d0/d5/se_8h.html#a200a111">AssignSecurityDescriptor</a> - For assign operations <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00246             security descriptor that will be assigned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.
00247             It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed to be in kernel space, and <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> therefore not
00248             probed or captured.
00249 
00250     CapturedLength - For <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query operation <span class="keyword">this</span> specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length, in
00251         bytes, of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor buffer, and upon <span class="keywordflow">return</span> contains
00252         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes needed to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> descriptor.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length
00253         needed <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> greater than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length supplied <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation will fail.
00254         It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> set and <span class="keyword">delete</span> operation.
00255 
00256         This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed to be captured and probed as appropriate.
00257 
00258     ObjectsSecurityDescriptor - For <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Set operation <span class="keyword">this</span> supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address
00259         of a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object's current security descriptor.  This routine
00260         will either modify <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor in place or allocate a <span class="keyword">new</span>
00261         security descriptor and use <span class="keyword">this</span> variable to indicate its <span class="keyword">new</span> location.
00262         For <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query operation <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> simply supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor
00263         being queried.  The caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> responsible <span class="keywordflow">for</span> freeing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> old security
00264         descriptor.
00265 
00266     PoolType - For <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> set operation <span class="keyword">this</span> specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to use <span class="keywordflow">if</span>
00267         a <span class="keyword">new</span> security descriptor needs to be allocated.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored
00268         in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> query and <span class="keyword">delete</span> operation.
00269 
00270         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping of generic to specific/standard access types <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object
00271         being accessed.  This mapping structure <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> expected to be safe to
00272         access (i.e., captured <span class="keywordflow">if</span> necessary) prior to be passed to <span class="keyword">this</span> routine.
00273 
00274 Return Value:
00275 
00276     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> - STATUS_SUCCESS <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successful and an
00277         appropriate error status otherwise.
00278 
00279 --*/
00280 
00281 {
00282     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00283 
00284     <span class="comment">//</span>
00285     <span class="comment">// If the object's security descriptor is null, then object is not</span>
00286     <span class="comment">// one that has security information associated with it.  Return</span>
00287     <span class="comment">// an error.</span>
00288     <span class="comment">//</span>
00289 
00290     <span class="comment">//</span>
00291     <span class="comment">//  Make sure the common parts of our input are proper</span>
00292     <span class="comment">//</span>
00293 
00294     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( (OperationCode == SetSecurityDescriptor) ||
00295             (OperationCode == QuerySecurityDescriptor) ||
00296             (OperationCode == AssignSecurityDescriptor) ||
00297             (OperationCode == DeleteSecurityDescriptor) );
00298 
00299     <span class="comment">//</span>
00300     <span class="comment">//  This routine simply cases off of the operation code to decide</span>
00301     <span class="comment">//  which support routine to call</span>
00302     <span class="comment">//</span>
00303 
00304     <span class="keywordflow">switch</span> (OperationCode) {
00305 
00306         <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/se_8h.html#a200a108">SetSecurityDescriptor</a>:
00307 
00308         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( (PoolType == PagedPool) || (PoolType == NonPagedPool) );
00309 
00310         <span class="keywordflow">return</span> <a class="code" href="../../d9/d1/obse_8c.html#a13">ObSetSecurityDescriptorInfo</a>( Object,
00311                                             SecurityInformation,
00312                                             SecurityDescriptor,
00313                                             ObjectsSecurityDescriptor,
00314                                             PoolType,
00315                                             GenericMapping
00316                                             );
00317 
00318 
00319 
00320     <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/se_8h.html#a200a109">QuerySecurityDescriptor</a>:
00321 
00322         <span class="comment">//</span>
00323         <span class="comment">//  check the rest of our input and call the default query security</span>
00324         <span class="comment">//  method</span>
00325         <span class="comment">//</span>
00326 
00327         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( CapturedLength != NULL );
00328 
00329         <span class="keywordflow">return</span> <a class="code" href="../../d9/d1/obse_8c.html#a12">ObQuerySecurityDescriptorInfo</a>( SecurityInformation,
00330                                               SecurityDescriptor,
00331                                               CapturedLength,
00332                                               ObjectsSecurityDescriptor );
00333 
00334     <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/se_8h.html#a200a110">DeleteSecurityDescriptor</a>:
00335 
00336         <span class="comment">//</span>
00337         <span class="comment">//  call the default delete security method</span>
00338         <span class="comment">//</span>
00339 
00340         <span class="keywordflow">return</span> <a class="code" href="../../d0/d6/semethod_8c.html#a0">SepDefaultDeleteMethod</a>( ObjectsSecurityDescriptor );
00341 
00342     <span class="keywordflow">case</span> <a class="code" href="../../d0/d5/se_8h.html#a200a111">AssignSecurityDescriptor</a>:
00343 
00344         <a class="code" href="../../d9/d1/obse_8c.html#a7">ObAssignObjectSecurityDescriptor</a>( Object, SecurityDescriptor, PoolType );
00345         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00346 
00347     <span class="keywordflow">default</span>:
00348 
00349         <span class="comment">//</span>
00350         <span class="comment">//  Bugcheck on any other operation code,  We won't get here if</span>
00351         <span class="comment">//  the earlier asserts are still checked.</span>
00352         <span class="comment">//</span>
00353 
00354         <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>( SECURITY_SYSTEM );
00355         <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00356 
00357     }
00358 
00359 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a174" doxytag="se.h::SeDeleteAccessState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID SeDeleteAccessState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>AccessState</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a143" doxytag="se.h::SeDeleteObjectAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeDeleteObjectAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03892">3892</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01465">SepAdtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00183">SepTokenAuthenticationId</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00176">SepTokenUserSid</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00196">SeReleaseSubjectContext()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01711">SeSubsystemName</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00411">NtDeleteKey()</a>, and <a class="el" href="../../d6/d9/obclose_8c-source.html#l00414">NtMakeTemporaryObject()</a>.
<p>
<pre class="fragment"><div>03899                    :
03900 
03901     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to generate audit and alarm messages when an object
03902     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> marked <span class="keywordflow">for</span> deletion.
03903 
03904     This routine may result in several messages being generated and sent to
03905     Port objects.  This may result in a significant latency before
03906     returning.  Design of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a> that must call <span class="keyword">this</span> routine must take
03907     <span class="keyword">this</span> potential latency into account.  This may have an impact on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03908     approach taken <span class="keywordflow">for</span> data structure mutex locking, <span class="keywordflow">for</span> example.
03909 
03910 Arguments:
03911 
03912     Object - Address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being accessed.  This value will not be
03913         used as a pointer (referenced).  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> necessary <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> to enter into
03914         log messages.
03915 
03916     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle value assigned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> open.
03917 
03918 Return Value:
03919 
03920     None.
03921 
03922 --*/
03923 
03924 {
03925     <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext;
03926     PSID UserSid;
03927     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03928 
03929     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03930 
03931     <a class="code" href="../../d0/d8/subject_8c.html#a0">SeCaptureSubjectContext</a> ( &amp;SubjectSecurityContext );
03932 
03933     UserSid = <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>( EffectiveToken (&amp;SubjectSecurityContext));
03934 
03935 
03936 
03937     <a class="code" href="../../d7/d6/sepaudit_8c.html#a14">SepAdtDeleteObjectAuditAlarm</a> (
03938         &amp;SeSubsystemName,
03939         (PVOID)Handle,
03940         Object,
03941         UserSid,
03942         <a class="code" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>( EffectiveToken (&amp;SubjectSecurityContext))
03943         );
03944 
03945     <a class="code" href="../../d0/d8/subject_8c.html#a3">SeReleaseSubjectContext</a> ( &amp;SubjectSecurityContext );
03946 
03947     <span class="keywordflow">return</span>;
03948 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a163" doxytag="se.h::SeExchangePrimaryToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeExchangePrimaryToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>NewAccessToken</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACCESS_TOKEN *&nbsp;</td>
          <td class="mdname" nowrap> <em>OldAccessToken</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l00346">346</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01256">PspAssignPrimaryToken()</a>.
<p>
<pre class="fragment"><div>00355                    :
00356 
00357     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to perform <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> portions of changing a primary
00358     token that reference <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> internals of token structures.
00359 
00360     The <span class="keyword">new</span> token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> checked to make sure <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not already in use.
00361 
00362     The
00363 
00364 
00365     !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
00366     !!!!!!!!       <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>        !!!!!!!!
00367     !!!!!!!!                                              !!!!!!!!
00368     !!!!!!!!  THIS ROUTINE MUST BE CALLED WITH THE GOBAL  !!!!!!!!
00369     !!!!!!!!  PROCESS SECURITY FIELDS <a class="code" href="../../d4/d2/struct__LOCK.html">LOCK</a> HELD           !!!!!!!!
00370     !!!!!!!!                                              !!!!!!!!
00371     !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
00372 
00373 Arguments:
00374 
00375     Process - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process whose primary token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being exchanged.
00376 
00377     NewAccessToken - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process's <span class="keyword">new</span> primary token.
00378 
00379     OldAccessToken - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process's current token.
00380         The caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> responsible <span class="keywordflow">for</span> dereferencing <span class="keyword">this</span> token when
00381         <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no longer needed.  This can'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> be done <span class="keywordflow">while</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process
00382         security locks are held.
00383 
00384 
00385 Return Value:
00386 
00387     STATUS_SUCCESS - Everything has been updated.
00388 
00389     STATUS_TOKEN_ALREADY_IN_USE - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> primary token can <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be used by a
00390         single process.  That <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>, each process must have its own primary
00391         token.  The token passed to  be assigned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00392         already in use as a primary token.
00393 
00394     STATUS_BAD_TOKEN_TYPE - The <span class="keyword">new</span> token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not a primary token.
00395 
00396 
00397 --*/
00398 
00399 {
00400     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00401         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00402 
00403     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>
00404         OldToken = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)(Process-&gt;Token);
00405 
00406     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>
00407         NewToken = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)NewAccessToken;
00408 
00409     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00410 
00411 
00412     <span class="comment">//</span>
00413     <span class="comment">// We need to access the security fields of both tokens.</span>
00414     <span class="comment">// Access to these fields is guarded by the global Process Security</span>
00415     <span class="comment">// fields lock.</span>
00416     <span class="comment">//</span>
00417 
00418     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(OldToken-&gt;TokenType == TokenPrimary);
00419     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(OldToken-&gt;TokenInUse);
00420 
00421 
00422     <span class="comment">//</span>
00423     <span class="comment">// Make sure the new token is a primary token...</span>
00424     <span class="comment">//</span>
00425 
00426     <span class="keywordflow">if</span> ( NewToken-&gt;TokenType != TokenPrimary ) {
00427         <span class="keywordflow">return</span>(STATUS_BAD_TOKEN_TYPE);
00428     }
00429 
00430     <span class="comment">//</span>
00431     <span class="comment">// and that it is not already in use...</span>
00432     <span class="comment">//</span>
00433 
00434     <span class="keywordflow">if</span> (NewToken-&gt;TokenInUse) {
00435         <span class="keywordflow">return</span>(STATUS_TOKEN_ALREADY_IN_USE);
00436     }
00437 
00438     <span class="comment">//</span>
00439     <span class="comment">// Ensure SessionId consistent for hydra</span>
00440     <span class="comment">//</span>
00441 
00442     NewToken-&gt;SessionId = OldToken-&gt;SessionId ;
00443 
00444 
00445 
00446     <span class="comment">//</span>
00447     <span class="comment">// Switch the tokens</span>
00448     <span class="comment">//</span>
00449 
00450     Process-&gt;Token=NewAccessToken;
00451     NewToken-&gt;TokenInUse = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00452     <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(NewToken);
00453 
00454     <span class="comment">//</span>
00455     <span class="comment">// Mark the token as "NOT USED"</span>
00456     <span class="comment">//</span>
00457 
00458     OldToken-&gt;TokenInUse = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00459 
00460     <span class="comment">//</span>
00461     <span class="comment">// Return the pointer to the old token.  The caller</span>
00462     <span class="comment">// is responsible for dereferencing it if they don't need it.</span>
00463     <span class="comment">//</span>
00464 
00465     (*OldAccessToken) = OldToken;
00466 
00467     <span class="keywordflow">return</span> (STATUS_SUCCESS);
00468 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a199" doxytag="se.h::SeFastFilterToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeFastFilterToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>ExistingToken</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>GroupCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID_AND_ATTRIBUTES GroupsToDisable&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PrivilegeCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLUID_AND_ATTRIBUTES PrivilegesToDelete&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SidCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID_AND_ATTRIBUTES RestrictedSids&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SidLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACCESS_TOKEN *&nbsp;</td>
          <td class="mdname" nowrap> <em>FilteredToken</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01859">1859</a> of file <a class="el" href="../../d7/d2/tokendup_8c-source.html">tokendup.c</a>.
<p>
References <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, and <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>.
<p>
Referenced by <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">PsAssignImpersonationToken()</a>, and <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00650">PsImpersonateClient()</a>.
<p>
<pre class="fragment"><div>01874                    :
01875 
01876     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a fast wrapper <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Ps code to filter a token
01877     <span class="keyword">inline</span> of an impersonate.
01878 
01879     This routine acquires a read lock on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token being filtered.
01880 
01881 Arguments:
01882 
01883     ExistingToken - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token to be duplicated.
01884 
01885     GroupCount - <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> of groups to disable
01886 
01887     GroupsToDisable - Contains a list of sids and attributes. All sids with
01888         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> USE_FOR_DENY_ONLY attribute that also exist in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token will
01889         cause <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> token to have that sid set with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> USE_FOR_DENY_ONLY
01890         attribute.
01891 
01892     PrivilegeCount - <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> of privileges to <span class="keyword">delete</span>
01893 
01894     PrivilegesToDelete - Privileges in <span class="keyword">this</span> list that are present in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01895         existing token will not exist in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">final</span> token. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> similar
01896         to duplicating a token effective <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> with these privileges set to
01897         disabled.
01898 
01899     SidCount - <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> of restricted sids to add.
01900 
01901     RestrictedSids - Contains a list of SIDs and attributes that will be
01902         stored in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RestrictedSids field of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> token. These SIDs
01903         are used after a normal access check to futher restrict access.
01904         The attributes of these groups are always SE_GROUP_MANDATORY |
01905         SE_GROUP_ENABLED | SE_GROUP_ENABLED_BY_DEFAULT. If there already
01906         exist RestrictedSids in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> original token, these sids will be
01907         appended.
01908 
01909     SidLength - Length of added restricted sids.
01910 
01911     FilteredToken - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> duplicate token.
01912         The token has not yet been inserted into any object table.
01913         No exceptions are expected when tring to set <span class="keyword">this</span> OUT value.
01914 
01915 Return Value:
01916 
01917     STATUS_SUCCESS - The service successfully completed <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested
01918         operation.
01919 
01920 
01921 --*/
01922 {
01923     <span class="keywordflow">return</span> <a class="code" href="../../d8/d3/tokenp_8h.html#a28">SepFilterToken</a>( (PTOKEN) ExistingToken,
01924                            RequestorMode,
01925                            Flags,
01926                            GroupCount,
01927                            GroupsToDisable,
01928                            PrivilegeCount,
01929                            PrivilegesToDelete,
01930                            SidCount,
01931                            RestrictedSids,
01932                            SidLength,
01933                            (PTOKEN *) FilteredToken );
01934 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a186" doxytag="se.h::SeFastTraverseCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SeFastTraverseCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>TraverseAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/accessck_8c-source.html#l03871">3871</a> of file <a class="el" href="../../d1/d3/accessck_8c-source.html">accessck.c</a>.
<p>
References <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00161">Dacl</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/rtdmpsec_8c-source.html#l00053">FirstAce</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d0/rtdmpsec_8c-source.html#l00059">NextAce</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00871">RtlEqualSid()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01609">SeWorldSid</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00778">ObpCheckTraverseAccess()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l01121">ObpProcessDosDeviceSymbolicLink()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l01748">ObSetSecurityDescriptorInfo()</a>.
<p>
<pre class="fragment"><div>03878                    :
03879 
03880     This routine will examine <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DACL of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed Security Descriptor
03881     to see <span class="keywordflow">if</span> WORLD has Traverse access.  If so, no further access checking
03882     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> necessary.
03883 
03884     Note that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SubjectContext <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client process does not have
03885     to be locked to make <span class="keyword">this</span> call, since <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> does not examine any data
03886     structures in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>.
03887 
03888 Arguments:
03889 
03890     SecurityDescriptor - The Security Descriptor protecting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> container
03891         object being traversed.
03892 
03893     TraverseAccess - Access mask describing Traverse access <span class="keywordflow">for</span> <span class="keyword">this</span>
03894         object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
03895 
03896     AccessMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access mode to be used in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> check
03897 
03898 
03899 Return Value:
03900 
03901     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - WORLD has Traverse access to <span class="keyword">this</span> container.  <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
03902     otherwise.
03903 
03904 --*/
03905 
03906 {
03907     PACL <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>;
03908     ULONG i;
03909     PVOID Ace;
03910     ULONG AceCount;
03911 
03912     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03913 
03914     <span class="keywordflow">if</span> ( AccessMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ) {
03915         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
03916     }
03917 
03918     <span class="keywordflow">if</span> (SecurityDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03919         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
03920     }
03921 
03922     <span class="comment">//</span>
03923     <span class="comment">// See if there is a valid DACL in the passed Security Descriptor.</span>
03924     <span class="comment">// No DACL, no security, all is granted.</span>
03925     <span class="comment">//</span>
03926 
03927     <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> = RtlpDaclAddrSecurityDescriptor( (PISECURITY_DESCRIPTOR)SecurityDescriptor );
03928 
03929     <span class="comment">//</span>
03930     <span class="comment">//  If the SE_DACL_PRESENT bit is not set, the object has no</span>
03931     <span class="comment">//  security, so all accesses are granted.</span>
03932     <span class="comment">//</span>
03933     <span class="comment">//  Also grant all access if the Dacl is NULL.</span>
03934     <span class="comment">//</span>
03935 
03936     <span class="keywordflow">if</span> ( !RtlpAreControlBitsSet(
03937             (PISECURITY_DESCRIPTOR)SecurityDescriptor, SE_DACL_PRESENT
03938             )
03939          || (<a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
03940 
03941         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03942     }
03943 
03944     <span class="comment">//</span>
03945     <span class="comment">// There is security on this object.  If the DACL is empty,</span>
03946     <span class="comment">// deny all access immediately</span>
03947     <span class="comment">//</span>
03948 
03949     <span class="keywordflow">if</span> ((AceCount = <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>-&gt;AceCount) == 0) {
03950 
03951         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
03952     }
03953 
03954     <span class="comment">//</span>
03955     <span class="comment">// There's stuff in the DACL, walk down the list and see</span>
03956     <span class="comment">// if WORLD has been granted TraverseAccess</span>
03957     <span class="comment">//</span>
03958 
03959     <span class="keywordflow">for</span> ( i = 0, Ace = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a1">FirstAce</a>( Dacl ) ;
03960           i &lt; AceCount  ;
03961           i++, Ace = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a2">NextAce</a>( Ace )
03962         ) {
03963 
03964         <span class="keywordflow">if</span> ( !(((PACE_HEADER)Ace)-&gt;AceFlags &amp; INHERIT_ONLY_ACE)) {
03965 
03966             <span class="keywordflow">if</span> ( (((PACE_HEADER)Ace)-&gt;AceType == ACCESS_ALLOWED_ACE_TYPE) ) {
03967 
03968                 <span class="keywordflow">if</span> ( (TraverseAccess &amp; ((PACCESS_ALLOWED_ACE)Ace)-&gt;Mask) ) {
03969 
03970                     <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>( SeWorldSid, &amp;((PACCESS_ALLOWED_ACE)Ace)-&gt;SidStart ) ) {
03971 
03972                         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
03973                     }
03974                 }
03975 
03976             } <span class="keywordflow">else</span> {
03977 
03978                 <span class="keywordflow">if</span> ( (((PACE_HEADER)Ace)-&gt;AceType == ACCESS_DENIED_ACE_TYPE) ) {
03979 
03980                     <span class="keywordflow">if</span> ( (TraverseAccess &amp; ((PACCESS_DENIED_ACE)Ace)-&gt;Mask) ) {
03981 
03982                         <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>( SeWorldSid, &amp;((PACCESS_DENIED_ACE)Ace)-&gt;SidStart ) ) {
03983 
03984                             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
03985                         }
03986                     }
03987                 }
03988             }
03989         }
03990     }
03991 
03992     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
03993 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a165" doxytag="se.h::SeFilterToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeFilterToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>ExistingToken</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PTOKEN_GROUPS SidsToDisable&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PTOKEN_PRIVILEGES PrivilegesToDelete&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PTOKEN_GROUPS RestrictedSids&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACCESS_TOKEN *&nbsp;</td>
          <td class="mdname" nowrap> <em>FilteredToken</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01634">1634</a> of file <a class="el" href="../../d7/d2/tokendup_8c-source.html">tokendup.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01212">SepTokenObjectType</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>01645                    :
01646 
01647     <a class="code" href="../../d4/d5/conimep_8h.html#a111">Create</a> a <span class="keyword">new</span> token that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a subset of an existing token.
01648 
01649 Arguments:
01650 
01651     ExistingToken - Is a  token already open <span class="keywordflow">for</span>
01652         TOKEN_DUPLICATE access.
01653 
01654     Flags - Flags indicating additional filtering. The flags may be:
01655 
01656                 DISABLE_ALL_GROUPS  - disable all groups in token
01657                 DELETE_ALL_PRIVILEGES - Disable all privileges
01658 
01659 
01660     SidsToDisable - Contains a list of sids and attributes. All sids with
01661         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> USE_FOR_DENY_ONLY attribute that also exist in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token will
01662         cause <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> token to have that sid set with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> USE_FOR_DENY_ONLY
01663         attribte.
01664 
01665     PrivilegesToDelete - Privileges in <span class="keyword">this</span> list that are present in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01666         existing token will not exist in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">final</span> token. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> similar
01667         to duplicating a token effective <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> with these privileges set to
01668         disabled.
01669 
01670     RestrictedSids - Contains a list of SIDs and attributes that will be
01671         stored in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RestrictedSids field of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> token. These SIDs
01672         are used after a normal access check to futher restrict access.
01673         The attributes of these groups are always SE_GROUP_MANDATORY |
01674         SE_GROUP_ENABLED | SE_GROUP_ENABLED_BY_DEFAULT. If there already
01675         exist RestrictedSids in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> original token, these sids will be
01676         appended.
01677 
01678     NewToken - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> newly created token.
01679 
01680 Return Value:
01681 
01682     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation was successful.
01683 
01684     STATUS_INVALID_PARAMETER - Indicates one or more of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parameter values
01685         was invalid.  This value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
01686         an impersonation token.
01687 
01688 
01689 --*/
01690 {
01691 
01692     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
01693     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> FilteredToken = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01694     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
01695     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01696     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01697 
01698     ULONG CapturedSidCount = 0;
01699     PSID_AND_ATTRIBUTES CapturedSids = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01700     ULONG CapturedSidsLength = 0;
01701 
01702     ULONG CapturedGroupCount = 0;
01703     PSID_AND_ATTRIBUTES CapturedGroups = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01704     ULONG CapturedGroupsLength = 0;
01705 
01706     ULONG CapturedPrivilegeCount = 0;
01707     PLUID_AND_ATTRIBUTES CapturedPrivileges = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01708     ULONG CapturedPrivilegesLength = 0;
01709 
01710     HANDLE LocalHandle;
01711 
01712     <a class="code" href="../../d3/d5/struct__OBJECT__HANDLE__INFORMATION.html">OBJECT_HANDLE_INFORMATION</a> HandleInformation;
01713     ACCESS_MASK EffectiveDesiredAccess;
01714 
01715     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01716 
01717     PreviousMode = KeGetPreviousMode();
01718 
01719     <span class="comment">//</span>
01720     <span class="comment">//  Probe parameters</span>
01721     <span class="comment">//</span>
01722 
01723     *NewToken = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01724 
01725 
01726     <span class="comment">//</span>
01727     <span class="comment">//  Capture Sids to remove</span>
01728     <span class="comment">//</span>
01729 
01730     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(SidsToDisable)) {
01731 
01732         CapturedGroupCount = SidsToDisable-&gt;GroupCount;
01733         CapturedGroups = SidsToDisable-&gt;Groups;
01734 
01735     }
01736 
01737     <span class="comment">//</span>
01738     <span class="comment">//  Capture PrivilegesToDelete</span>
01739     <span class="comment">//</span>
01740 
01741     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(PrivilegesToDelete)) {
01742 
01743         CapturedPrivilegeCount = PrivilegesToDelete-&gt;PrivilegeCount;
01744         CapturedPrivileges = PrivilegesToDelete-&gt;Privileges;
01745 
01746     }
01747 
01748     <span class="comment">//</span>
01749     <span class="comment">//  Capture Restricted Sids</span>
01750     <span class="comment">//</span>
01751 
01752     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(RestrictedSids)) {
01753 
01754         CapturedSidCount = RestrictedSids-&gt;GroupCount;
01755         CapturedSids = RestrictedSids-&gt;Groups;
01756 
01757         <span class="comment">//</span>
01758         <span class="comment">// Check that the attribtes are all zero for the restricted sids</span>
01759         <span class="comment">//</span>
01760 
01761         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; CapturedSidCount ; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++ ) {
01762             <span class="keywordflow">if</span> (CapturedSids[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Attributes != 0) {
01763                 <span class="keywordflow">return</span>(STATUS_INVALID_PARAMETER);
01764             }
01765         }
01766 
01767     }
01768 
01769 
01770 
01771     <span class="comment">//</span>
01772     <span class="comment">//  Check the handle's access to the existing token and get</span>
01773     <span class="comment">//  a pointer to that token.  Pick up the default desired</span>
01774     <span class="comment">//  access mask from the handle while we're at it.</span>
01775     <span class="comment">//</span>
01776 
01777     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>) ExistingToken;
01778 
01779 
01780 <span class="preprocessor">#ifdef TOKEN_DEBUG</span>
01781 <span class="preprocessor"></span>
01782 <span class="comment">//</span>
01783 <span class="comment">// Debug</span>
01784     <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( Token );
01785     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
01786     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
01787     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Token being filtered: \n"</span>);
01788     SepDumpToken( Token );
01789     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01790 <span class="comment">// Debug</span>
01791 <span class="comment">//</span>
01793 <span class="comment"></span><span class="preprocessor">#endif //TOKEN_DEBUG</span>
01794 <span class="preprocessor"></span>
01795 
01796     <span class="comment">//</span>
01797     <span class="comment">//  Filter the existing token</span>
01798     <span class="comment">//</span>
01799 
01800     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d3/tokenp_8h.html#a28">SepFilterToken</a>(
01801                  Token,
01802                  KernelMode,
01803                  Flags,
01804                  CapturedGroupCount,
01805                  CapturedGroups,
01806                  CapturedPrivilegeCount,
01807                  CapturedPrivileges,
01808                  CapturedSidCount,
01809                  CapturedSids,
01810                  CapturedSidsLength,
01811                  &amp;FilteredToken
01812                  );
01813 
01814 
01815     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01816 
01817         <span class="comment">//</span>
01818         <span class="comment">//  Insert the new token</span>
01819         <span class="comment">//</span>
01820 
01821         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d1/obinsert_8c.html#a0">ObInsertObject</a>( FilteredToken,
01822                                  NULL,
01823                                  0,
01824                                  0,
01825                                  (PVOID *)NULL,
01826                                  &amp;LocalHandle
01827                                  );
01828 
01829         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01830 <span class="preprocessor">#ifdef TOKEN_DEBUG</span>
01831 <span class="preprocessor"></span>            <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"SE: ObInsertObject failed (%x) for token at %x\n"</span>, Status, NewToken );
01832 <span class="preprocessor">#endif</span>
01833 <span class="preprocessor"></span>        } <span class="keywordflow">else</span> {
01834             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(
01835                         LocalHandle,
01836                         TOKEN_IMPERSONATE,
01837                         SepTokenObjectType,
01838                         KernelMode,
01839                         (PVOID * ) NewToken,
01840                         NULL                    <span class="comment">// granted acess</span>
01841                         );
01842 
01843             (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(LocalHandle);
01844 
01845         }
01846 
01847     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NewToken != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01848 <span class="preprocessor">#ifdef TOKEN_DEBUG</span>
01849 <span class="preprocessor"></span>        <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"SE: SepFilterToken failed (%x) but allocated token at %x\n"</span>, Status, NewToken );
01850 <span class="preprocessor">#endif</span>
01851 <span class="preprocessor"></span>    }
01852 
01853 
01854 
01855    <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01856 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a123" doxytag="se.h::SeFreeCapturedSecurityQos" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeFreeCapturedSecurityQos           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SecurityQos</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00910">910</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00037">SecurityQos</a>, and <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00737">SepFreeProxyData()</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l01690">NtCreateToken()</a>, and <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00046">NtDuplicateToken()</a>.
<p>
<pre class="fragment"><div>00916                    :
00917 
00918     This routine frees <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data associated with a captured <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a14">SecurityQos</a>
00919     structure.  It does not free <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> body of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> structure, just whatever
00920     its internal fields point to.
00921 
00922 Arguments:
00923 
00924     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a14">SecurityQos</a> - Points to a captured security QOS structure.
00925 
00926 Return Value:
00927 
00928     None.
00929 
00930 --*/
00931 
00932 {
00933     PSECURITY_ADVANCED_QUALITY_OF_SERVICE IAdvancedSecurityQos;
00934 
00935     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00936 
00937     IAdvancedSecurityQos = (PSECURITY_ADVANCED_QUALITY_OF_SERVICE)<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a14">SecurityQos</a>;
00938 
00939     <span class="keywordflow">if</span> (IAdvancedSecurityQos-&gt;Length == <span class="keyword">sizeof</span>( SECURITY_ADVANCED_QUALITY_OF_SERVICE )) {
00940 
00941         <span class="keywordflow">if</span> (IAdvancedSecurityQos-&gt;AuditData != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00942             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( IAdvancedSecurityQos-&gt;AuditData );
00943         }
00944 
00945         <a class="code" href="../../d6/d6/sep_8h.html#a74">SepFreeProxyData</a>( IAdvancedSecurityQos-&gt;ProxyData );
00946     }
00947 
00948     <span class="keywordflow">return</span>;
00949 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a138" doxytag="se.h::SeFreePrivileges" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID SeFreePrivileges           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PPRIVILEGE_SET&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Privileges</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/accessck_8c-source.html#l03294">3294</a> of file <a class="el" href="../../d1/d3/accessck_8c-source.html">accessck.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00983">ObCheckCreateObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00392">ObCheckObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00778">ObpCheckTraverseAccess()</a>, and <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>.
<p>
<pre class="fragment"><div>03300                    :
03301 
03302     This routine frees a privilege set returned by <a class="code" href="../../d0/d5/se_8h.html#a135">SeAccessCheck</a>.
03303 
03304 Arguments:
03305 
03306     Privileges - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege set to be freed.
03307 
03308 Return Value:
03309 
03310     None.
03311 
03312 --*/
03313 
03314 {
03315     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03316 
03317     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( Privileges );
03318 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a140" doxytag="se.h::SeGenerateMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeGenerateMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>AuditPort</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>AlarmPort</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a155" doxytag="se.h::SeGetTokenControlInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeGetTokenControlInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PTOKEN_CONTROL&nbsp;</td>
          <td class="mdname" nowrap> <em>TokenControl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l00475">475</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/seclient_8c-source.html#l00062">SepCreateClientSecurity()</a>.
<p>
<pre class="fragment"><div>00482                    :
00483 
00484     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> provided <span class="keywordflow">for</span> communication session layers, or
00485     any other executive component that needs to keep track of
00486     whether a caller's security context has changed between calls.
00487     Communication session layers will need to check <span class="keyword">this</span>, <span class="keywordflow">for</span> some
00488     security quality of service modes, to determine whether or not
00489     a server's security context needs to be updated to reflect
00490     changes in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client's security context.
00491 
00492     This routine will also be useful to communications subsystems
00493     that need to retrieve client' authentication information from
00494     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> local security authority in order to perform a remote
00495     authentication.
00496 
00497 
00498 Parameters:
00499 
00500     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token whose information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be retrieved.
00501 
00502     TokenControl - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a>
00503         information.
00504 
00505 Return Value:
00506 
00507     None.
00508 
00509 --*/
00510 
00511 {
00512     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00513 
00514     <span class="comment">//</span>
00515     <span class="comment">//  acquire exclusive access to the token</span>
00516     <span class="comment">//</span>
00517 
00518     <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( (PTOKEN)Token );
00519 
00520     <span class="comment">//</span>
00521     <span class="comment">//  Grab the data  and  run</span>
00522     <span class="comment">//</span>
00523 
00524     TokenControl-&gt;TokenId = ((<a class="code" href="../../d8/d1/struct__TOKEN.html">TOKEN</a> *)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>)-&gt;TokenId;
00525     TokenControl-&gt;AuthenticationId = ((<a class="code" href="../../d8/d1/struct__TOKEN.html">TOKEN</a> *)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>)-&gt;AuthenticationId;
00526     TokenControl-&gt;ModifiedId = ((<a class="code" href="../../d8/d1/struct__TOKEN.html">TOKEN</a> *)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>)-&gt;ModifiedId;
00527     TokenControl-&gt;TokenSource = ((<a class="code" href="../../d8/d1/struct__TOKEN.html">TOKEN</a> *)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>)-&gt;TokenSource;
00528 
00529     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( (PTOKEN)Token );
00530 
00531     <span class="keywordflow">return</span>;
00532 
00533 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a170" doxytag="se.h::SeImpersonateClient" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID SeImpersonateClient           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d8/d0/struct__SECURITY__CLIENT__CONTEXT.html">PSECURITY_CLIENT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> ServerThread&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/seclient_8c-source.html#l00593">593</a> of file <a class="el" href="../../d5/d4/seclient_8c-source.html">seclient.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d4/seclient_8c-source.html#l00636">SeImpersonateClientEx()</a>, <a class="el" href="../../d9/d0/userver_8c-source.html#l00173">ServerThread()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>00599                    :
00600 
00601     This service <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to cause <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling thread to impersonate a
00602     client.  The client security context in ClientContext <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed to
00603     be up to date.
00604 
00605 
00606 Arguments:
00607 
00608     ClientContext - Points to client security context block.
00609 
00610     <a class="code" href="../../d8/d1/userver_8c.html#a10">ServerThread</a> - (Optional) Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to
00611         impersonate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client.  If not specified, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00612         used.
00613 
00614 
00615 Return Value:
00616 
00617     None.
00618 
00619 
00620 --*/
00621 
00622 
00623 {
00624 
00625     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00626 
00627 <span class="preprocessor">#if DBG</span>
00628 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SE:  Obsolete call:  SeImpersonateClient\n"</span>);
00629 <span class="preprocessor">#endif</span>
00630 <span class="preprocessor"></span>
00631     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d4/d5/seclient_8c.html#a3">SeImpersonateClientEx</a>( ClientContext, ServerThread );
00632 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a171" doxytag="se.h::SeImpersonateClientEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeImpersonateClientEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d8/d0/struct__SECURITY__CLIENT__CONTEXT.html">PSECURITY_CLIENT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> ServerThread&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d4/seclient_8c-source.html#l00636">636</a> of file <a class="el" href="../../d5/d4/seclient_8c-source.html">seclient.c</a>.
<p>
References <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00650">PsImpersonateClient()</a>, <a class="el" href="../../d9/d0/userver_8c-source.html#l00173">ServerThread()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/kernel_2ddetrack_8c-source.html#l02256">_ImpersonateDdeClientWindow()</a>, <a class="el" href="../../d6/d2/cmworker_8c-source.html#l00115">CmpWorker()</a>, <a class="el" href="../../d2/d6/lpcpriv_8c-source.html#l00032">NtImpersonateClientOfPort()</a>, <a class="el" href="../../d0/d0/psimpers_8c-source.html#l00026">NtImpersonateThread()</a>, and <a class="el" href="../../d5/d4/seclient_8c-source.html#l00593">SeImpersonateClient()</a>.
<p>
<pre class="fragment"><div>00642                    :
00643 
00644     This service <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to cause <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling thread to impersonate a
00645     client.  The client security context in ClientContext <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed to
00646     be up to date.
00647 
00648 
00649 Arguments:
00650 
00651     ClientContext - Points to client security context block.
00652 
00653     <a class="code" href="../../d8/d1/userver_8c.html#a10">ServerThread</a> - (Optional) Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to
00654         impersonate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client.  If not specified, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00655         used.
00656 
00657 
00658 Return Value:
00659 
00660     None.
00661 
00662 
00663 --*/
00664 
00665 
00666 {
00667 
00668     BOOLEAN EffectiveValueToUse;
00669     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread;
00670     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> ;
00671 
00672     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00673 
00674     <span class="keywordflow">if</span> (ClientContext-&gt;DirectlyAccessClientToken) {
00675         EffectiveValueToUse = ClientContext-&gt;DirectAccessEffectiveOnly;
00676     } <span class="keywordflow">else</span> {
00677         EffectiveValueToUse = ClientContext-&gt;SecurityQos.EffectiveOnly;
00678     }
00679 
00680 
00681 
00682     <span class="comment">//</span>
00683     <span class="comment">// if a ServerThread wasn't specified, then default to the current</span>
00684     <span class="comment">// thread.</span>
00685     <span class="comment">//</span>
00686 
00687     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT(ServerThread)) {
00688         Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
00689     } <span class="keywordflow">else</span> {
00690         Thread = <a class="code" href="../../d8/d1/userver_8c.html#a10">ServerThread</a>;
00691     }
00692 
00693 
00694 
00695     <span class="comment">//</span>
00696     <span class="comment">// Assign the context to the calling thread</span>
00697     <span class="comment">//</span>
00698 
00699     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d5/ps_2security_8c.html#a6">PsImpersonateClient</a>( Thread,
00700                          ClientContext-&gt;ClientToken,
00701                          TRUE,
00702                          EffectiveValueToUse,
00703                          ClientContext-&gt;SecurityQos.ImpersonationLevel
00704                          );
00705 
00706     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> ;
00707 
00708 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a112" doxytag="se.h::SeInitSystem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SeInitSystem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d5/seinit_8c-source.html#l00041">41</a> of file <a class="el" href="../../d0/d5/seinit_8c-source.html">seinit.c</a>.
<p>
References <a class="el" href="../../d9/d0/init_8h-source.html#l00070">InitializationPhase</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d0/d5/seinit_8c-source.html#l00078">SepInitializationPhase0()</a>, and <a class="el" href="../../d0/d5/seinit_8c-source.html#l00184">SepInitializationPhase1()</a>.
<p>
<pre class="fragment"><div>00045                    :
00046 
00047     Perform security related system initialization <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a16">functions</a>.
00048 
00049 Arguments:
00050 
00051     None.
00052 
00053 Return Value:
00054 
00055     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - Initialization succeeded.
00056 
00057     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - Initialization failed.
00058 
00059 --*/
00060 
00061 {
00062     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00063 
00064     <span class="keywordflow">switch</span> ( <a class="code" href="../../d8/d1/init_8h.html#a21">InitializationPhase</a> ) {
00065 
00066     <span class="keywordflow">case</span> 0 :
00067         <span class="keywordflow">return</span> <a class="code" href="../../d6/d6/sep_8h.html#a36">SepInitializationPhase0</a>();
00068     <span class="keywordflow">case</span> 1 :
00069         <span class="keywordflow">return</span> <a class="code" href="../../d6/d6/sep_8h.html#a37">SepInitializationPhase1</a>();
00070     <span class="keywordflow">default</span>:
00071         <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(UNEXPECTED_INITIALIZATION_CALL);
00072     }
00073     <span class="keywordflow">return</span> 0; <span class="comment">// Bash compiler warning</span>
00074 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a197" doxytag="se.h::SeIsChildToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeIsChildToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>IsChild</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l02867">2867</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00508">IsChild()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00810">PsDereferencePrimaryToken</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00028">PsReferencePrimaryToken()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01824">RtlEqualLuid()</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01212">SepTokenObjectType</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>02873                    :
02874 
02875     This routine returns <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a child of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's
02876     process token. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> done by comparing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ParentTokenId field of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02877     supplied token to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TokenId field of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current subject
02878     context.
02879 
02880 Arguments:
02881 
02882     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> to check <span class="keywordflow">for</span> childhood
02883 
02884     <a class="code" href="../../d3/d9/client_2wow_8c.html#a18">IsChild</a> - Contains results of comparison.
02885 
02886         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The supplied token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a child of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's token
02887         <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>- The supplied token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not a child of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's token
02888 
02889 Returns:
02890 
02891     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> codes from any NT services called.
02892 
02893 --*/
02894 {
02895     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> CallerToken;
02896     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> SuppliedToken;
02897     LUID CallerTokenId;
02898     LUID SuppliedParentTokenId;
02899     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
02900 
02901     *<a class="code" href="../../d3/d9/client_2wow_8c.html#a18">IsChild</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02902 
02903     <span class="comment">//</span>
02904     <span class="comment">// Capture the caller's token and get the token id</span>
02905     <span class="comment">//</span>
02906 
02907     CallerToken = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>) <a class="code" href="../../d6/d5/ps_2security_8c.html#a0">PsReferencePrimaryToken</a>(<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>());
02908 
02909 
02910     <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( CallerToken );
02911 
02912     CallerTokenId = CallerToken-&gt;TokenId;
02913 
02914     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( CallerToken );
02915 
02916     <a class="code" href="../../d1/d9/ps_8h.html#a24">PsDereferencePrimaryToken</a>(CallerToken);
02917 
02918     <span class="comment">//</span>
02919     <span class="comment">// Reference the supplied token and get the parent token id.</span>
02920     <span class="comment">//</span>
02921 
02922     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(
02923                 Token,                   <span class="comment">// Handle</span>
02924                 0,                       <span class="comment">// DesiredAccess</span>
02925                 SepTokenObjectType,      <span class="comment">// ObjectType</span>
02926                 KeGetPreviousMode(),     <span class="comment">// AccessMode</span>
02927                 (PVOID *)&amp;SuppliedToken, <span class="comment">// Object</span>
02928                 NULL                     <span class="comment">// GrantedAccess</span>
02929                 );
02930 
02931     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status))
02932     {
02933         <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( SuppliedToken );
02934 
02935         SuppliedParentTokenId = SuppliedToken-&gt;ParentTokenId;
02936 
02937         <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( SuppliedToken );
02938 
02939         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(SuppliedToken);
02940 
02941         <span class="comment">//</span>
02942         <span class="comment">// Check to see if the supplied token's parent ID is the ID</span>
02943         <span class="comment">// of the caller.</span>
02944         <span class="comment">//</span>
02945 
02946         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a50">RtlEqualLuid</a>(
02947                 &amp;SuppliedParentTokenId,
02948                 &amp;CallerTokenId
02949                 )) {
02950 
02951             *<a class="code" href="../../d3/d9/client_2wow_8c.html#a18">IsChild</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02952         }
02953 
02954     }
02955     <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
02956 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a198" doxytag="se.h::SeIsChildTokenByPointer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeIsChildTokenByPointer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>IsChild</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l02960">2960</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00508">IsChild()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00810">PsDereferencePrimaryToken</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00028">PsReferencePrimaryToken()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01824">RtlEqualLuid()</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, and <a class="el" href="../../d0/d1/psquery_8c-source.html#l00366">PspSetPrimaryToken()</a>.
<p>
<pre class="fragment"><div>02966                    :
02967 
02968     This routine returns <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a child of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's
02969     token. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> done by comparing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ParentTokenId field of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied
02970     token to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TokenId field of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current subject context.
02971 
02972 Arguments:
02973 
02974     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> to check <span class="keywordflow">for</span> childhood
02975 
02976     <a class="code" href="../../d3/d9/client_2wow_8c.html#a18">IsChild</a> - Contains results of comparison.
02977 
02978         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The supplied token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a child of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's token
02979         <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>- The supplied token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not a child of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's token
02980 
02981 Returns:
02982 
02983     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> codes from any NT services called.
02984 
02985 --*/
02986 {
02987     <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext;
02988     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> CallerToken;
02989     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> SuppliedToken;
02990     LUID CallerTokenId;
02991     LUID SuppliedParentTokenId;
02992     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
02993 
02994     *<a class="code" href="../../d3/d9/client_2wow_8c.html#a18">IsChild</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02995 
02996     <span class="comment">//</span>
02997     <span class="comment">// Capture the caller's token and get the token id</span>
02998     <span class="comment">//</span>
02999 
03000     CallerToken = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>) <a class="code" href="../../d6/d5/ps_2security_8c.html#a0">PsReferencePrimaryToken</a>(<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>());
03001 
03002 
03003     <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( CallerToken );
03004 
03005     CallerTokenId = CallerToken-&gt;TokenId;
03006 
03007     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( CallerToken );
03008 
03009     <a class="code" href="../../d1/d9/ps_8h.html#a24">PsDereferencePrimaryToken</a>(CallerToken);
03010 
03011     SuppliedToken = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>) <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> ;
03012 
03013     <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( SuppliedToken );
03014 
03015     SuppliedParentTokenId = SuppliedToken-&gt;ParentTokenId;
03016 
03017     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( SuppliedToken );
03018 
03019     <span class="comment">//</span>
03020     <span class="comment">// Check to see if the supplied token's parent ID is the ID</span>
03021     <span class="comment">// of the caller.</span>
03022     <span class="comment">//</span>
03023 
03024     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a50">RtlEqualLuid</a>(
03025             &amp;SuppliedParentTokenId,
03026             &amp;CallerTokenId
03027             )) {
03028 
03029         *<a class="code" href="../../d3/d9/client_2wow_8c.html#a18">IsChild</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03030     }
03031 
03032 
03033 
03034     <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
03035 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a119" doxytag="se.h::SeLockSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID SeLockSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SubjectContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00115">115</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, and <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/cmse_8c-source.html#l00917">CmpCheckCreateAccess()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l01032">CmpCheckNotifyAccess()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00593">IsPrivileged()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00983">ObCheckCreateObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00392">ObCheckObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00602">ObpCheckObjectReference()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00778">ObpCheckTraverseAccess()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00529">SeQueryAuthenticationIdSubjectContext()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03429">SeTraverseAuditAlarm()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00121                    :
00122 
00123     Acquires READ LOCKS on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary and impersonation tokens
00124     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed SubjectContext.
00125 
00126     This call must be undone by a call to <a class="code" href="../../d0/d8/subject_8c.html#a2">SeUnlockSubjectContext</a>().
00127 
00128     No one outside of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SE component should need to acquire a
00129     write lock to a token.  Therefore there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no <span class="keyword">public</span> interface
00130     to <span class="keywordflow">do</span> <span class="keyword">this</span>.
00131 
00132 Arguments:
00133 
00134     SubjectContext - Points to a <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> data structure
00135         which points to a primary token and an optional impersonation token.
00136 
00137 Return Value:
00138 
00139     None
00140 
00141 --*/
00142 
00143 {
00144     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00145 
00146     <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>((PTOKEN)(SubjectContext-&gt;PrimaryToken));
00147 
00148     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(SubjectContext-&gt;ClientToken)) {
00149 
00150         <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>((PTOKEN)(SubjectContext-&gt;ClientToken));
00151     }
00152 
00153     <span class="keywordflow">return</span>;
00154 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a154" doxytag="se.h::SeMakeAnonymousLogonToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PACCESS_TOKEN SeMakeAnonymousLogonToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d5/seinit_8c-source.html#l00184">SepInitializationPhase1()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a153" doxytag="se.h::SeMakeSystemToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PACCESS_TOKEN SeMakeSystemToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l00536">536</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00152">NoExpiration</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00144">NormalGroupAttributes</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01183">ObAssignObjectSecurityDescriptor()</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00159">Owner</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00145">OwnerGroupAttributes</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d8/d0/rtlassig_8c-source.html#l00360">RtlAbsoluteToSelfRelativeSD()</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l01607">RtlAddAccessAllowedAce()</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l00099">RtlCreateAcl()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01945">RtlCreateSecurityDescriptor()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02543">RtlSetDaclSecurityDescriptor()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l03135">RtlSetGroupSecurityDescriptor()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02963">RtlSetOwnerSecurityDescriptor()</a>, <a class="el" href="../../d2/d1/time_8c-source.html#l00822">RtlTimeFieldsToTime()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01630">SeAliasAdminsSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01671">SeAssignPrimaryTokenPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01689">SeAuditPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01629">SeAuthenticatedUsersSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01685">SeBackupPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01691">SeChangeNotifyPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01679">SeCreatePagefilePrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01684">SeCreatePermanentPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01670">SeCreateTokenPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01688">SeDebugPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01680">SeIncreaseBasePriorityPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01673">SeIncreaseQuotaPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00540">SeLengthSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01678">SeLoadDriverPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01628">SeLocalSystemSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01672">SeLockMemoryPrivilege</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01683">SeProfileSingleProcessPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01686">SeRestorePrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01676">SeSecurityPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01687">SeShutdownPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01599">SeSystemAuthenticationId</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01662">SeSystemDefaultDacl</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01690">SeSystemEnvironmentPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01682">SeSystemtimePrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01602">SeSystemTokenSource</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01677">SeTakeOwnershipPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01675">SeTcbPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01693">SeUndockPrivilege</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01609">SeWorldSid</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d5/ttime_8c-source.html#l00046">TimeFields</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/seinit_8c-source.html#l00078">SepInitializationPhase0()</a>, and <a class="el" href="../../d2/d5/tse_8c-source.html#l00105">TestMakeSystemToken()</a>.
<p>
<pre class="fragment"><div>00540                    :
00541 
00542     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> provided <span class="keywordflow">for</span> use by executive components
00543     DURING SYSTEM INITIALIZATION ONLY.  It creates a token <span class="keywordflow">for</span>
00544     use by system components.
00545 
00546     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> system token has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following characteristics:
00547 
00548          - It has LOCAL_SYSTEM as its user <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>
00549 
00550          - It has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following groups with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> corresponding
00551            attributes:
00552 
00553                ADMINS_ALIAS      EnabledByDefault |
00554                                  Enabled          |
00555                                  <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a>
00556 
00557                WORLD             EnabledByDefault |
00558                                  Enabled          |
00559                                  Mandatory
00560 
00561                ADMINISTRATORS (alias)  Owner   (disabled)
00562 
00563                AUTHENTICATED_USER
00564                                 EnabledByDefault  |
00565                                 Enabled           |
00566                                 Mandatory
00567 
00568 
00569          - It has LOCAL_SYSTEM as its primary group.
00570 
00571          - It has the privileges shown in comments below.
00572 
00573 
00574          - It has protection that provides TOKEN_ALL_ACCESS to
00575            the LOCAL_SYSTEM ID.
00576 
00577 
00578          - It has a default ACL that grants GENERIC_ALL access
00579            to LOCAL_SYSTEM and GENERIC_EXECUTE to WORLD.
00580 
00581 
00582 Parameters:
00583 
00584     None.
00585 
00586 Return Value:
00587 
00588     Pointer to a system token.
00589 
00590 --*/
00591 
00592 {
00593     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00594 
00595     PVOID <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00596 
00597     SID_AND_ATTRIBUTES UserId;
00598     TOKEN_PRIMARY_GROUP PrimaryGroup;
00599     PSID_AND_ATTRIBUTES GroupIds;
00600     ULONG GroupIdsLength;
00601     LUID_AND_ATTRIBUTES Privileges[30];
00602     PACL TokenAcl;
00603     PSID <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a>;
00604     ULONG <a class="code" href="../../d6/d0/ctaccess_8c.html#a44">NormalGroupAttributes</a>;
00605     ULONG <a class="code" href="../../d6/d0/ctaccess_8c.html#a45">OwnerGroupAttributes</a>;
00606     ULONG Length;
00607     OBJECT_ATTRIBUTES TokenObjectAttributes;
00608     PSECURITY_DESCRIPTOR TokenSecurityDescriptor;
00609     ULONG BufferLength;
00610     PVOID <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00611 
00612     ULONG_PTR GroupIdsBuffer[128 * <span class="keyword">sizeof</span>(ULONG) / <span class="keyword">sizeof</span>(ULONG_PTR)];
00613 
00614     TIME_FIELDS <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>;
00615     LARGE_INTEGER <a class="code" href="../../d6/d0/ctaccess_8c.html#a49">NoExpiration</a>;
00616 
00617     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00618 
00619 
00620     <span class="comment">//</span>
00621     <span class="comment">// Make sure only one system token gets created.</span>
00622     <span class="comment">//</span>
00623 
00624 <span class="preprocessor">#if DBG</span>
00625 <span class="preprocessor"></span>    <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( !SystemTokenCreated );
00626     SystemTokenCreated = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00627 <span class="preprocessor">#endif //DBG</span>
00628 <span class="preprocessor"></span>
00629 
00630     <span class="comment">//</span>
00631     <span class="comment">// Set up expiration times</span>
00632     <span class="comment">//</span>
00633 
00634     <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>.Year = 3000;
00635     <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>.Month = 1;
00636     <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>.Day = 1;
00637     <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>.Hour = 1;
00638     <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>.Minute = 1;
00639     <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>.Second = 1;
00640     <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>.Milliseconds = 1;
00641     <a class="code" href="../../d6/d6/ttime_8c.html#a13">TimeFields</a>.Weekday = 1;
00642 
00643     <a class="code" href="../../d1/d2/time_8c.html#a28">RtlTimeFieldsToTime</a>( &amp;TimeFields, &amp;NoExpiration );
00644 
00645 
00646 <span class="comment">//    //</span>
00647 <span class="comment">//    //  The amount of memory used in the following is gross overkill, but</span>
00648 <span class="comment">//    //  it is freed up immediately after creating the token.</span>
00649 <span class="comment">//    //</span>
00650 <span class="comment">//</span>
00651 <span class="comment">//    GroupIds = (PSID_AND_ATTRIBUTES)ExAllocatePool( NonPagedPool, 512 );</span>
00652 
00653     GroupIds = (PSID_AND_ATTRIBUTES)GroupIdsBuffer;
00654 
00655 
00656     <span class="comment">//</span>
00657     <span class="comment">// Set up the attributes to be assigned to groups</span>
00658     <span class="comment">//</span>
00659 
00660     <a class="code" href="../../d6/d0/ctaccess_8c.html#a44">NormalGroupAttributes</a> =    (SE_GROUP_MANDATORY          |
00661                                 SE_GROUP_ENABLED_BY_DEFAULT |
00662                                 SE_GROUP_ENABLED
00663                                 );
00664 
00665     <a class="code" href="../../d6/d0/ctaccess_8c.html#a45">OwnerGroupAttributes</a>  =    (SE_GROUP_ENABLED_BY_DEFAULT |
00666                                 SE_GROUP_ENABLED            |
00667                                 SE_GROUP_OWNER
00668                                 );
00669 
00670     <span class="comment">//</span>
00671     <span class="comment">// Set up the user ID</span>
00672     <span class="comment">//</span>
00673 
00674     UserId.Sid = <a class="code" href="../../d0/d5/se_8h.html#a54">SeLocalSystemSid</a>;
00675     UserId.Attributes = 0;
00676 
00677     <span class="comment">//</span>
00678     <span class="comment">// Set up the groups</span>
00679     <span class="comment">//</span>
00680 
00681 
00682     GroupIds-&gt;Sid  = <a class="code" href="../../d0/d5/se_8h.html#a56">SeAliasAdminsSid</a>;
00683     (GroupIds+1)-&gt;Sid  = <a class="code" href="../../d0/d5/se_8h.html#a42">SeWorldSid</a>;
00684     (GroupIds+2)-&gt;Sid  = <a class="code" href="../../d0/d5/se_8h.html#a55">SeAuthenticatedUsersSid</a>;
00685 
00686     GroupIds-&gt;Attributes  = <a class="code" href="../../d6/d0/ctaccess_8c.html#a45">OwnerGroupAttributes</a>;
00687     (GroupIds+1)-&gt;Attributes  = <a class="code" href="../../d6/d0/ctaccess_8c.html#a44">NormalGroupAttributes</a>;
00688     (GroupIds+2)-&gt;Attributes  = <a class="code" href="../../d6/d0/ctaccess_8c.html#a44">NormalGroupAttributes</a>;
00689 
00690     GroupIdsLength = (ULONG)LongAlignSize(<a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>(GroupIds-&gt;Sid)) +
00691                      (ULONG)LongAlignSize(<a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>((GroupIds+1)-&gt;Sid)) +
00692                      (ULONG)LongAlignSize(<a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>((GroupIds+2)-&gt;Sid)) +
00693                      <span class="keyword">sizeof</span>(SID_AND_ATTRIBUTES);
00694 
00695     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( GroupIdsLength &lt;= 128 * <span class="keyword">sizeof</span>(ULONG) );
00696 
00697 
00698     <span class="comment">//</span>
00699     <span class="comment">// Privileges</span>
00700     <span class="comment">//</span>
00701 
00702     <span class="comment">//</span>
00703     <span class="comment">// The privileges in the system token are as follows:</span>
00704     <span class="comment">//</span>
00705     <span class="comment">//    Privilege Name                           Attributes</span>
00706     <span class="comment">//    --------------                           ----------</span>
00707     <span class="comment">//</span>
00708     <span class="comment">// SeTcbPrivilege                        enabled/enabled by default</span>
00709     <span class="comment">// SeCreateTokenPrivilege                DISabled/NOT enabled by default</span>
00710     <span class="comment">// SeTakeOwnershipPrivilege              DISabled/NOT enabled by default</span>
00711     <span class="comment">// SeCreatePagefilePrivilege             enabled/enabled by default</span>
00712     <span class="comment">// SeLockMemoryPrivilege                 enabled/enabled by default</span>
00713     <span class="comment">// SeAssignPrimaryTokenPrivilege         DISabled/NOT enabled by default</span>
00714     <span class="comment">// SeIncreaseQuotaPrivilege              DISabled/NOT enabled by default</span>
00715     <span class="comment">// SeIncreaseBasePriorityPrivilege       enabled/enabled by default</span>
00716     <span class="comment">// SeCreatePermanentPrivilege            enabled/enabled by default</span>
00717     <span class="comment">// SeDebugPrivilege                      enabled/enabled by default</span>
00718     <span class="comment">// SeAuditPrivilege                      enabled/enabled by default</span>
00719     <span class="comment">// SeSecurityPrivilege                   DISabled/NOT enabled by default</span>
00720     <span class="comment">// SeSystemEnvironmentPrivilege          DISabled/NOT enabled by default</span>
00721     <span class="comment">// SeChangeNotifyPrivilege               enabled/enabled by default</span>
00722     <span class="comment">// SeBackupPrivilege                     DISabled/NOT enabled by default</span>
00723     <span class="comment">// SeRestorePrivilege                    DISabled/NOT enabled by default</span>
00724     <span class="comment">// SeShutdownPrivilege                   DISabled/NOT enabled by default</span>
00725     <span class="comment">// SeLoadDriverPrivilege                 DISabled/NOT enabled by default</span>
00726     <span class="comment">// SeProfileSingleProcessPrivilege       enabled/enabled by default</span>
00727     <span class="comment">// SeSystemtimePrivilege                 DISabled/NOT enabled by default</span>
00728     <span class="comment">// SeUndockPrivilege                     DISabled/NOT enabled by default</span>
00729     <span class="comment">//</span>
00730     <span class="comment">// The following privileges are not present, and should never be present in</span>
00731     <span class="comment">// the local system token:</span>
00732     <span class="comment">//</span>
00733     <span class="comment">// SeRemoteShutdownPrivilege             no one can come in as local system</span>
00734     <span class="comment">// SeSyncAgentPrivilege                  only users specified by the admin can</span>
00735     <span class="comment">//                                       be sync agents</span>
00736     <span class="comment">// SeEnableDelegationPrivilege           only users specified by the admin can</span>
00737     <span class="comment">//                                       enable delegation on accounts.</span>
00738     <span class="comment">//</span>
00739 
00740     Privileges[0].Luid = <a class="code" href="../../d0/d5/se_8h.html#a84">SeTcbPrivilege</a>;
00741     Privileges[0].Attributes =
00742         (SE_PRIVILEGE_ENABLED_BY_DEFAULT |    <span class="comment">// Enabled by default</span>
00743          SE_PRIVILEGE_ENABLED);               <span class="comment">// Enabled</span>
00744 
00745     Privileges[1].Luid = <a class="code" href="../../d0/d5/se_8h.html#a79">SeCreateTokenPrivilege</a>;
00746     Privileges[1].Attributes = 0;     <span class="comment">// Only the LSA should enable this.</span>
00747 
00748     Privileges[2].Luid = <a class="code" href="../../d0/d5/se_8h.html#a86">SeTakeOwnershipPrivilege</a>;
00749     Privileges[2].Attributes = 0;
00750 
00751     Privileges[3].Luid = <a class="code" href="../../d0/d5/se_8h.html#a88">SeCreatePagefilePrivilege</a>;
00752     Privileges[3].Attributes =
00753         (SE_PRIVILEGE_ENABLED_BY_DEFAULT |    <span class="comment">// Enabled by default</span>
00754          SE_PRIVILEGE_ENABLED);               <span class="comment">// Enabled</span>
00755 
00756     Privileges[4].Luid = <a class="code" href="../../d0/d5/se_8h.html#a81">SeLockMemoryPrivilege</a>;
00757     Privileges[4].Attributes =
00758         (SE_PRIVILEGE_ENABLED_BY_DEFAULT |    <span class="comment">// Enabled by default</span>
00759          SE_PRIVILEGE_ENABLED);               <span class="comment">// Enabled</span>
00760 
00761     Privileges[5].Luid = <a class="code" href="../../d0/d5/se_8h.html#a80">SeAssignPrimaryTokenPrivilege</a>;
00762     Privileges[5].Attributes = 0;    <span class="comment">// disabled, not enabled by default</span>
00763 
00764     Privileges[6].Luid = <a class="code" href="../../d0/d5/se_8h.html#a82">SeIncreaseQuotaPrivilege</a>;
00765     Privileges[6].Attributes = 0;    <span class="comment">// disabled, not enabled by default</span>
00766 
00767     Privileges[7].Luid = <a class="code" href="../../d0/d5/se_8h.html#a89">SeIncreaseBasePriorityPrivilege</a>;
00768     Privileges[7].Attributes =
00769         (SE_PRIVILEGE_ENABLED_BY_DEFAULT |    <span class="comment">// Enabled by default</span>
00770          SE_PRIVILEGE_ENABLED);               <span class="comment">// Enabled</span>
00771 
00772     Privileges[8].Luid = <a class="code" href="../../d0/d5/se_8h.html#a93">SeCreatePermanentPrivilege</a>;
00773     Privileges[8].Attributes =
00774         (SE_PRIVILEGE_ENABLED_BY_DEFAULT |    <span class="comment">// Enabled by default</span>
00775          SE_PRIVILEGE_ENABLED);               <span class="comment">// Enabled</span>
00776 
00777     Privileges[9].Luid = <a class="code" href="../../d0/d5/se_8h.html#a97">SeDebugPrivilege</a>;
00778     Privileges[9].Attributes =
00779         (SE_PRIVILEGE_ENABLED_BY_DEFAULT |   <span class="comment">// Enabled by default</span>
00780          SE_PRIVILEGE_ENABLED);               <span class="comment">// Enabled</span>
00781 
00782     Privileges[10].Luid = <a class="code" href="../../d0/d5/se_8h.html#a98">SeAuditPrivilege</a>;
00783     Privileges[10].Attributes =
00784         (SE_PRIVILEGE_ENABLED_BY_DEFAULT |    <span class="comment">// Enabled by default</span>
00785          SE_PRIVILEGE_ENABLED);               <span class="comment">// Enabled</span>
00786 
00787     Privileges[11].Luid = <a class="code" href="../../d0/d5/se_8h.html#a85">SeSecurityPrivilege</a>;
00788     Privileges[11].Attributes = 0;    <span class="comment">// disabled, not enabled by default</span>
00789 
00790     Privileges[12].Luid = <a class="code" href="../../d0/d5/se_8h.html#a99">SeSystemEnvironmentPrivilege</a>;
00791     Privileges[12].Attributes = 0;    <span class="comment">// disabled, not enabled by default</span>
00792 
00793     Privileges[13].Luid = <a class="code" href="../../d0/d5/se_8h.html#a100">SeChangeNotifyPrivilege</a>;
00794     Privileges[13].Attributes =
00795         (SE_PRIVILEGE_ENABLED_BY_DEFAULT |    <span class="comment">// Enabled by default</span>
00796          SE_PRIVILEGE_ENABLED);               <span class="comment">// Enabled</span>
00797 
00798 
00799     Privileges[14].Luid = <a class="code" href="../../d0/d5/se_8h.html#a94">SeBackupPrivilege</a>;
00800     Privileges[14].Attributes = 0;    <span class="comment">// disabled, not enabled by default</span>
00801 
00802     Privileges[15].Luid = <a class="code" href="../../d0/d5/se_8h.html#a95">SeRestorePrivilege</a>;
00803     Privileges[15].Attributes = 0;    <span class="comment">// disabled, not enabled by default</span>
00804 
00805     Privileges[16].Luid = <a class="code" href="../../d0/d5/se_8h.html#a96">SeShutdownPrivilege</a>;
00806     Privileges[16].Attributes = 0;    <span class="comment">// disabled, not enabled by default</span>
00807 
00808     Privileges[17].Luid = <a class="code" href="../../d0/d5/se_8h.html#a87">SeLoadDriverPrivilege</a>;
00809     Privileges[17].Attributes = 0;    <span class="comment">// disabled, not enabled by default</span>
00810 
00811     Privileges[18].Luid = <a class="code" href="../../d0/d5/se_8h.html#a92">SeProfileSingleProcessPrivilege</a>;
00812     Privileges[18].Attributes =
00813         (SE_PRIVILEGE_ENABLED_BY_DEFAULT |    <span class="comment">// Enabled by default</span>
00814          SE_PRIVILEGE_ENABLED);               <span class="comment">// Enabled</span>
00815 
00816     Privileges[19].Luid = <a class="code" href="../../d0/d5/se_8h.html#a91">SeSystemtimePrivilege</a>;
00817     Privileges[19].Attributes = 0;    <span class="comment">// disabled, not enabled by default</span>
00818 
00819     Privileges[20].Luid = <a class="code" href="../../d0/d5/se_8h.html#a102">SeUndockPrivilege</a> ;
00820     Privileges[20].Attributes = 0 ;   <span class="comment">// disabled, not enabled by default</span>
00821 
00822     <span class="comment">//BEFORE ADDING ANOTHER PRIVILEGE ^^ HERE ^^ CHECK THE ARRAY BOUND</span>
00823     <span class="comment">//ALSO INCREMENT THE PRIVILEGE COUNT IN THE SepCreateToken() call</span>
00824 
00825 
00826     <span class="comment">//</span>
00827     <span class="comment">// Establish the primary group and default owner</span>
00828     <span class="comment">//</span>
00829 
00830     PrimaryGroup.PrimaryGroup = <a class="code" href="../../d0/d5/se_8h.html#a54">SeLocalSystemSid</a>;  <span class="comment">// Primary group</span>
00831     <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> = <a class="code" href="../../d0/d5/se_8h.html#a56">SeAliasAdminsSid</a>;                      <span class="comment">// Default owner</span>
00832 
00833 
00834 
00835 
00836 
00837     <span class="comment">//</span>
00838     <span class="comment">// Set up an ACL to protect token as well ...</span>
00839     <span class="comment">// give system full reign of terror.  This includes user-mode components</span>
00840     <span class="comment">// running as part of the system.</span>
00841     <span class="comment">//</span>
00842 
00843     Length = (ULONG)<span class="keyword">sizeof</span>(ACL) +
00844              ((ULONG)<span class="keyword">sizeof</span>(ACCESS_ALLOWED_ACE) - <span class="keyword">sizeof</span>(ULONG)) +
00845              <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>( SeLocalSystemSid ) ;
00846 
00847     TokenAcl = (PACL)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PagedPool, Length, 'cAeS');
00848 
00849     <span class="keywordflow">if</span> ( TokenAcl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00850 
00851         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ;
00852     }
00853 
00854     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d4/acledit_8c.html#a6">RtlCreateAcl</a>( TokenAcl, Length, ACL_REVISION2);
00855     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00856 
00857     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d4/acledit_8c.html#a16">RtlAddAccessAllowedAce</a> (
00858                  TokenAcl,
00859                  ACL_REVISION2,
00860                  TOKEN_ALL_ACCESS,
00861                  SeLocalSystemSid
00862                  );
00863     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00864 
00865     TokenSecurityDescriptor =
00866     (PSECURITY_DESCRIPTOR)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(
00867                               PagedPool,
00868                               <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR),
00869                               'dSeS'
00870                               );
00871 
00872     <span class="keywordflow">if</span> ( TokenSecurityDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00873 
00874         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( TokenAcl );
00875 
00876         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ;
00877     }
00878 
00879     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a53">RtlCreateSecurityDescriptor</a>(
00880                  TokenSecurityDescriptor,
00881                  SECURITY_DESCRIPTOR_REVISION
00882                  );
00883     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00884 
00885     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a60">RtlSetDaclSecurityDescriptor</a> (
00886                  TokenSecurityDescriptor,
00887                  TRUE,
00888                  TokenAcl,
00889                  FALSE
00890                  );
00891     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00892 
00893 
00894     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a64">RtlSetOwnerSecurityDescriptor</a> (
00895                  TokenSecurityDescriptor,
00896                  SeAliasAdminsSid,
00897                  FALSE <span class="comment">// Owner defaulted</span>
00898                  );
00899     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00900 
00901     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a66">RtlSetGroupSecurityDescriptor</a> (
00902                  TokenSecurityDescriptor,
00903                  SeAliasAdminsSid,
00904                  FALSE <span class="comment">// Group defaulted</span>
00905                  );
00906     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00907 
00908 
00909     <span class="comment">//</span>
00910     <span class="comment">// Create the system token</span>
00911     <span class="comment">//</span>
00912 
00913 <span class="preprocessor">#ifdef TOKEN_DEBUG</span>
00914 <span class="preprocessor"></span>
00915 <span class="comment">//</span>
00916 <span class="comment">// Debug</span>
00917     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n Creating system token...\n"</span>);
00918 <span class="comment">// Debug</span>
00919 <span class="comment">//</span>
00921 <span class="comment"></span><span class="preprocessor">#endif //TOKEN_DEBUG</span>
00922 <span class="preprocessor"></span>
00923     InitializeObjectAttributes(
00924         &amp;TokenObjectAttributes,
00925         NULL,
00926         0,
00927         NULL,
00928         TokenSecurityDescriptor
00929         );
00930 
00931 
00932 
00933     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(SeSystemDefaultDacl != NULL);
00934     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d3/token_8c.html#a17">SepCreateToken</a>(
00935                  (PHANDLE)&amp;Token,
00936                  KernelMode,
00937                  0,               <span class="comment">// No handle created for system token</span>
00938                  &amp;TokenObjectAttributes,
00939                  TokenPrimary,
00940                  (SECURITY_IMPERSONATION_LEVEL)0,
00941                  &amp;SeSystemAuthenticationId,
00942                  &amp;NoExpiration,
00943                  &amp;UserId,
00944                  3,                         <span class="comment">// GroupCount</span>
00945                  GroupIds,
00946                  GroupIdsLength,
00947                  21,                        <span class="comment">// privileges</span>
00948                  Privileges,
00949                  <span class="keyword">sizeof</span>(Privileges),
00950                  Owner,
00951                  PrimaryGroup.PrimaryGroup,
00952                  SeSystemDefaultDacl,
00953                  &amp;SeSystemTokenSource,
00954                  TRUE,                        <span class="comment">// System token</span>
00955                  NULL,
00956                  NULL
00957                  );
00958 
00959      <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00960 
00961     <span class="comment">//</span>
00962     <span class="comment">// Assign the security descriptor here, since we don't do it</span>
00963     <span class="comment">// in SepCreateToken for the System Token.</span>
00964     <span class="comment">//</span>
00965 
00966     BufferLength = Length +
00967                    <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE) +
00968                    2 * <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>(SeAliasAdminsSid);
00969 
00970     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> =  (PSECURITY_DESCRIPTOR)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool,
00971                                                            BufferLength,
00972                                                            'dSeS'
00973                                                            );
00974 
00975     <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> ) {
00976 
00977         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> =  <a class="code" href="../../d7/d1/rtlassig_8c.html#a4">RtlAbsoluteToSelfRelativeSD</a>( TokenSecurityDescriptor,
00978                                                Buffer,
00979                                                &amp;BufferLength
00980                                                );
00981         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00982 
00983         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> =  <a class="code" href="../../d9/d1/obse_8c.html#a7">ObAssignObjectSecurityDescriptor</a>( Token,
00984                                                     Buffer,
00985                                                     PagedPool
00986                                                     );
00987         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00988 
00989     } <span class="keywordflow">else</span> {
00990 
00991         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Token );
00992 
00993         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ;
00994 
00995     }
00996 
00997     <span class="comment">//</span>
00998     <span class="comment">// We can free the old one now.</span>
00999     <span class="comment">//</span>
01000 
01001     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( TokenAcl );
01002     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( TokenSecurityDescriptor );
01003 
01004     <span class="keywordflow">return</span>  (PACCESS_TOKEN)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
01005 
01006 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a195" doxytag="se.h::SeMarkLogonSessionForTerminationNotification" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeMarkLogonSessionForTerminationNotification           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>LogonId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00979">979</a> of file <a class="el" href="../../d0/d9/rmlogon_8c-source.html">rmlogon.c</a>.
<p>
References <a class="el" href="../../d2/d9/rmp_8h-source.html#l00131">_SEP_LOGON_SESSION_REFERENCES::Flags</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00129">_SEP_LOGON_SESSION_REFERENCES::LogonId</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00128">_SEP_LOGON_SESSION_REFERENCES::Next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01824">RtlEqualLuid()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00134">SEP_TERMINATION_NOTIFY</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00109">SepLogonSessionIndex</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00229">SepLogonSessions</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00060">SepRmAcquireDbWriteLock</a>, and <a class="el" href="../../d2/d9/rmp_8h-source.html#l00066">SepRmReleaseDbWriteLock</a>.
<p>
<pre class="fragment"><div>00985                    :
00986 
00987     <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a> systems that have registered <span class="keywordflow">for</span> logon-termination notification
00988     can mark logon sessions they are interested in <span class="keywordflow">for</span> callback by calling
00989     <span class="keyword">this</span> routine.
00990 
00991 Arguments:
00992 
00993     LogonId - The logon <span class="keywordtype">id</span> <span class="keywordflow">for</span> which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> system should be notified
00994         when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> logon session <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> terminated.
00995 
00996 Returns:
00997 
00998     Nothing.
00999 
01000 --*/
01001 
01002 {
01003 
01004     ULONG SessionArrayIndex;
01005     <a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a> Previous, Current;
01006 
01007     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01008 
01009     SessionArrayIndex = <a class="code" href="../../d9/d9/rmlogon_8c.html#a0">SepLogonSessionIndex</a>( LogonId );
01010 
01011     <span class="comment">//</span>
01012     <span class="comment">// Protect modification of reference monitor database</span>
01013     <span class="comment">//</span>
01014 
01015     <a class="code" href="../../d1/d0/rmp_8h.html#a3">SepRmAcquireDbWriteLock</a>();
01016 
01017 
01018     <span class="comment">//</span>
01019     <span class="comment">// Now walk the list for our logon session array hash index.</span>
01020     <span class="comment">//</span>
01021 
01022     Previous = (<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a>)
01023                ((PVOID)&amp;<a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a>[ SessionArrayIndex ]);
01024     Current = Previous-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
01025 
01026     <span class="keywordflow">while</span> (Current != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01027 
01028         <span class="comment">//</span>
01029         <span class="comment">// If we found it, decrement the reference count and return</span>
01030         <span class="comment">//</span>
01031 
01032         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a50">RtlEqualLuid</a>( LogonId, &amp;Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o1">LogonId</a>) ) {
01033             Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o3">Flags</a> |= <a class="code" href="../../d1/d0/rmp_8h.html#a8">SEP_TERMINATION_NOTIFY</a>;
01034             <span class="keywordflow">break</span>;
01035         }
01036 
01037         Previous = Current;
01038         Current = Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
01039     }
01040 
01041     <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
01042 
01043     <span class="keywordflow">return</span>( (Current != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ? STATUS_SUCCESS : STATUS_NOT_FOUND );
01044 
01045 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a148" doxytag="se.h::SeObjectReferenceAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeObjectReferenceAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID OperationID&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectSecurityContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET Privileges&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03660">3660</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">SepAdtAuditThisEvent</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01907">SepAdtObjectReferenceAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03952">SepExamineSacl()</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/obse_8c-source.html#l00602">ObpCheckObjectReference()</a>.
<p>
<pre class="fragment"><div>03673                    :
03674 
03675     description-of-function.
03676 
03677 Arguments:
03678 
03679     argument-name - Supplies | Returns description of argument.
03680     .
03681     .
03682 
03683 Return Value:
03684 
03685     <span class="keywordflow">return</span>-value - <a class="code" href="../../d4/d9/heapdbg_8c.html#a4">Description</a> of conditions needed to <span class="keywordflow">return</span> value. - or -
03686     None.
03687 
03688 --*/
03689 
03690 {
03691     BOOLEAN GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03692     BOOLEAN GenerateAlarm = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03693 
03694     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03695 
03696     <span class="keywordflow">if</span> (AccessMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
03697         <span class="keywordflow">return</span>;
03698     }
03699 
03700     <span class="keywordflow">if</span> ( SecurityDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03701 
03702         <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryDetailedTracking, &amp;AccessGranted )) {
03703 
03704             <a class="code" href="../../d6/d6/sep_8h.html#a62">SepExamineSacl</a>(
03705                 RtlpSaclAddrSecurityDescriptor( (PISECURITY_DESCRIPTOR)SecurityDescriptor ),
03706                 <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( SubjectSecurityContext ),
03707                 DesiredAccess,
03708                 AccessGranted,
03709                 &amp;GenerateAudit,
03710                 &amp;GenerateAlarm
03711                 );
03712 
03713             <span class="keywordflow">if</span> ( GenerateAudit || GenerateAlarm ) {
03714 
03715                 <a class="code" href="../../d7/d6/sepaudit_8c.html#a16">SepAdtObjectReferenceAuditAlarm</a>(
03716                     OperationID,
03717                     Object,
03718                     SubjectSecurityContext,
03719                     DesiredAccess,
03720                     Privileges,
03721                     AccessGranted,
03722                     GenerateAudit,
03723                     GenerateAlarm
03724                     );
03725             }
03726         }
03727     }
03728 
03729     <span class="keywordflow">return</span>;
03730 
03731 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a141" doxytag="se.h::SeOpenObjectAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID SeOpenObjectAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectTypeName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID Object&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING AbsoluteObjectName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectCreated</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateOnClose</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02765">2765</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00259">_AUX_ACCESS_DATA::GenericMapping</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00258">_AUX_ACCESS_DATA::PrivilegesUsed</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01763">RtlCopyUnicodeString()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l03381">RtlMapGenericMask()</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">SepAdtAuditThisEvent</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00571">SepAdtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03952">SepExamineSacl()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04587">SepFilterPrivilegeAudits()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02324">SepQueryNameString()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02400">SepQueryTypeString()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01711">SeSubsystemName</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l00392">ObCheckObjectAccess()</a>.
<p>
<pre class="fragment"><div>02778                    :
02779 
02780     <a class="code" href="../../d0/d5/se_8h.html#a141">SeOpenObjectAuditAlarm</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object manager that open objects
02781     to generate any necessary audit or alarm messages.  The open may be to
02782     existing objects or <span class="keywordflow">for</span> newly created objects.  No messages will be
02783     generated <span class="keywordflow">for</span> Kernel mode accesses.
02784 
02785     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to generate audit and alarm messages when an
02786     attempt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to open an object.
02787 
02788     This routine may result in several messages being generated and sent to
02789     Port objects.  This may result in a significant latency before
02790     returning.  Design of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a> that must call <span class="keyword">this</span> routine must take
02791     <span class="keyword">this</span> potential latency into account.  This may have an impact on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02792     approach taken <span class="keywordflow">for</span> data structure mutex locking, <span class="keywordflow">for</span> example.
02793 
02794 Arguments:
02795 
02796     ObjectTypeName - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of object being
02797         accessed.  This must be <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> same name provided to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02798         <a class="code" href="../../d4/d0/ob_8h.html#a67">ObCreateObjectType</a> service when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> was created.
02799 
02800     Object - Address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object accessed.  This value will not be used
02801         as a pointer (referenced).  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> necessary <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> to enter into log
02802         messages.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> open was not successful, then <span class="keyword">this</span> argument <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
02803         ignored.  Otherwise, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> must be provided.
02804 
02805     AbsoluteObjectName - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being accessed.
02806         If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object doesn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> have a name, then <span class="keyword">this</span> field <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> left null.
02807         Otherwise, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> must be provided.
02808 
02809     SecurityDescriptor - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02810         object being accessed.
02811 
02812     AccessState - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to an access state structure containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02813         subject context, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> remaining desired access types, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> granted
02814         access types, and optionally a privilege set to indicate which
02815         privileges were used to permit <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access.
02816 
02817     ObjectCreated - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> <span class="keywordtype">boolean</span> flag indicating whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access resulted
02818         in a <span class="keyword">new</span> object being created.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates an object
02819         was created, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> indicates an existing object was opened.
02820 
02821     AccessGranted - Indicates <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was granted or denied based on
02822         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access check or privilege check.
02823 
02824     AccessMode - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access mode used <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access check.  One
02825         of <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> or <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>.  Messages will not be generated by
02826         kernel mode accesses.
02827 
02828     GenerateOnClose - Points to a <span class="keywordtype">boolean</span> that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> audit
02829         generation routine and must be passed to <a class="code" href="../../d3/d5/seaudit_8c.html#a29">SeCloseObjectAuditAlarm</a>()
02830         when the object handle is closed.
02831 
02832 Return value:
02833 
02834     None.
02835 
02836 --*/
02837 {
02838     BOOLEAN GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02839     BOOLEAN GenerateAlarm = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02840     ACCESS_MASK RequestedAccess;
02841     POBJECT_NAME_INFORMATION ObjectNameInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02842     PUNICODE_STRING ObjectTypeNameInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02843     PUNICODE_STRING ObjectName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02844     PUNICODE_STRING LocalObjectTypeName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02845     PLUID PrimaryAuthenticationId = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02846     PLUID ClientAuthenticationId = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02847     BOOLEAN AuditPrivileges = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02848     BOOLEAN AuditPerformed;
02849     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
02850     ACCESS_MASK MappedGrantMask = (ACCESS_MASK)0;
02851     ACCESS_MASK MappedDenyMask = (ACCESS_MASK)0;
02852     <a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a> AuxData;
02853 
02854     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02855 
02856     <span class="keywordflow">if</span> ( AccessMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ) {
02857         <span class="keywordflow">return</span>;
02858     }
02859 
02860     AuxData = (<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a>)AccessState-&gt;AuxData;
02861 
02862     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( &amp;AccessState-&gt;SubjectSecurityContext );
02863 
02864     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuditData)) {
02865 
02866         MappedGrantMask = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuditData-&gt;GrantMask;
02867 
02868         <a class="code" href="../../d8/d6/sertl_8c.html#a70">RtlMapGenericMask</a>(
02869             &amp;MappedGrantMask,
02870             &amp;AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o1">GenericMapping</a>
02871             );
02872 
02873         MappedDenyMask = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuditData-&gt;DenyMask;
02874 
02875         <a class="code" href="../../d8/d6/sertl_8c.html#a70">RtlMapGenericMask</a>(
02876             &amp;MappedDenyMask,
02877             &amp;AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o1">GenericMapping</a>
02878             );
02879     }
02880 
02881     <span class="keywordflow">if</span> (SecurityDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02882 
02883         RequestedAccess = AccessState-&gt;RemainingDesiredAccess |
02884                           AccessState-&gt;PreviouslyGrantedAccess;
02885 
02886         <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryObjectAccess, &amp;AccessGranted )) {
02887 
02888             <span class="keywordflow">if</span> ( RequestedAccess &amp; (AccessGranted ? MappedGrantMask : MappedDenyMask)) {
02889 
02890                 GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02891 
02892             } <span class="keywordflow">else</span> {
02893 
02894                 <a class="code" href="../../d6/d6/sep_8h.html#a62">SepExamineSacl</a>(
02895                     RtlpSaclAddrSecurityDescriptor( (PISECURITY_DESCRIPTOR)SecurityDescriptor ),
02896                     Token,
02897                     RequestedAccess,
02898                     AccessGranted,
02899                     &amp;GenerateAudit,
02900                     &amp;GenerateAlarm
02901                     );
02902             }
02903 
02904             <span class="comment">//</span>
02905             <span class="comment">// Only generate an audit on close of we're auditing from SACL</span>
02906             <span class="comment">// settings.</span>
02907             <span class="comment">//</span>
02908 
02909             <span class="keywordflow">if</span> (GenerateAudit) {
02910                 *GenerateOnClose = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02911             }
02912         }
02913     }
02914 
02915     <span class="comment">//</span>
02916     <span class="comment">// If we don't generate an audit via the SACL, see if we need to generate</span>
02917     <span class="comment">// one for privilege use.</span>
02918     <span class="comment">//</span>
02919     <span class="comment">// Note that we only audit privileges successfully used to open objects,</span>
02920     <span class="comment">// so we don't care about a failed privilege use here.  Therefore, only</span>
02921     <span class="comment">// do this test of access has been granted.</span>
02922     <span class="comment">//</span>
02923 
02924     <span class="keywordflow">if</span> (!GenerateAudit &amp;&amp; (AccessGranted == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) {
02925 
02926         <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryPrivilegeUse, &amp;AccessGranted )) {
02927 
02928             <span class="keywordflow">if</span> ((AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
02929                 (AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a>-&gt;PrivilegeCount &gt; 0) ) {
02930 
02931                 <span class="comment">//</span>
02932                 <span class="comment">// Make sure these are actually privileges that we want to audit</span>
02933                 <span class="comment">//</span>
02934 
02935                 <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/sep_8h.html#a67">SepFilterPrivilegeAudits</a>( AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a> )) {
02936 
02937                     GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02938 
02939                     <span class="comment">//</span>
02940                     <span class="comment">// When we finally try to generate this audit, this flag</span>
02941                     <span class="comment">// will tell us that we need to audit the fact that we</span>
02942                     <span class="comment">// used a privilege, as opposed to audit due to the SACL.</span>
02943                     <span class="comment">//</span>
02944 
02945                     AccessState-&gt;AuditPrivileges = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02946                 }
02947             }
02948         }
02949     }
02950 
02951     <span class="comment">//</span>
02952     <span class="comment">// Set up either to generate an audit (if the access check has failed), or save</span>
02953     <span class="comment">// the stuff that we're going to audit later into the AccessState structure.</span>
02954     <span class="comment">//</span>
02955 
02956     <span class="keywordflow">if</span> (GenerateAudit || GenerateAlarm) {
02957 
02958         AccessState-&gt;GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02959 
02960         <span class="comment">//</span>
02961         <span class="comment">// Figure out what we've been passed, and obtain as much</span>
02962         <span class="comment">// missing information as possible.</span>
02963         <span class="comment">//</span>
02964 
02965         <span class="keywordflow">if</span> ( !ARGUMENT_PRESENT( AbsoluteObjectName )) {
02966 
02967             <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( Object )) {
02968 
02969                 ObjectNameInfo = <a class="code" href="../../d7/d6/sepaudit_8c.html#a17">SepQueryNameString</a>( Object  );
02970 
02971                 <span class="keywordflow">if</span> ( ObjectNameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
02972 
02973                     ObjectName = &amp;ObjectNameInfo-&gt;Name;
02974                 }
02975             }
02976 
02977         } <span class="keywordflow">else</span> {
02978 
02979             ObjectName = AbsoluteObjectName;
02980         }
02981 
02982         <span class="keywordflow">if</span> ( !ARGUMENT_PRESENT( ObjectTypeName )) {
02983 
02984             <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( Object )) {
02985 
02986                 ObjectTypeNameInfo = <a class="code" href="../../d7/d6/sepaudit_8c.html#a18">SepQueryTypeString</a>( Object );
02987 
02988                 <span class="keywordflow">if</span> ( ObjectTypeNameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
02989 
02990                     LocalObjectTypeName = ObjectTypeNameInfo;
02991                 }
02992             }
02993 
02994         } <span class="keywordflow">else</span> {
02995 
02996             LocalObjectTypeName = ObjectTypeName;
02997         }
02998 
02999         <span class="comment">//</span>
03000         <span class="comment">// If the access attempt failed, do the audit here.  If it succeeded,</span>
03001         <span class="comment">// we'll do the audit later, when the handle is allocated.</span>
03002         <span class="comment">//</span>
03003         <span class="comment">//</span>
03004 
03005         <span class="keywordflow">if</span> (!AccessGranted) {
03006 
03007             AuditPerformed = <a class="code" href="../../d7/d6/sepaudit_8c.html#a11">SepAdtOpenObjectAuditAlarm</a> ( &amp;SeSubsystemName,
03008                                                           NULL,
03009                                                           LocalObjectTypeName,
03010                                                           NULL,
03011                                                           ObjectName,
03012                                                           AccessState-&gt;SubjectSecurityContext.ClientToken,
03013                                                           AccessState-&gt;SubjectSecurityContext.PrimaryToken,
03014                                                           AccessState-&gt;OriginalDesiredAccess,
03015                                                           AccessState-&gt;PreviouslyGrantedAccess,
03016                                                           &amp;AccessState-&gt;OperationID,
03017                                                           AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a>,
03018                                                           FALSE,
03019                                                           FALSE,
03020                                                           TRUE,
03021                                                           FALSE,
03022                                                           AccessState-&gt;SubjectSecurityContext.ProcessAuditId,
03023                                                           AuditCategoryObjectAccess,
03024                                                           NULL,
03025                                                           0,
03026                                                           NULL );
03027         } <span class="keywordflow">else</span> {
03028 
03029             <span class="comment">//</span>
03030             <span class="comment">// Copy all the stuff we're going to need into the</span>
03031             <span class="comment">// AccessState and return.</span>
03032             <span class="comment">//</span>
03033 
03034             <span class="keywordflow">if</span> ( ObjectName != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03035 
03036                  <span class="keywordflow">if</span> ( AccessState-&gt;ObjectName.Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03037 
03038                      <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( AccessState-&gt;ObjectName.Buffer );
03039                      AccessState-&gt;ObjectName.Length = 0;
03040                      AccessState-&gt;ObjectName.MaximumLength = 0;
03041                  }
03042 
03043                 AccessState-&gt;ObjectName.Buffer = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool,ObjectName-&gt;MaximumLength );
03044                 <span class="keywordflow">if</span> (AccessState-&gt;ObjectName.Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03045 
03046                     AccessState-&gt;ObjectName.MaximumLength = ObjectName-&gt;MaximumLength;
03047                     <a class="code" href="../../d6/d6/nls_8c.html#a44">RtlCopyUnicodeString</a>( &amp;AccessState-&gt;ObjectName, ObjectName );
03048                 }
03049             }
03050 
03051             <span class="keywordflow">if</span> ( LocalObjectTypeName != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03052 
03053                  <span class="keywordflow">if</span> ( AccessState-&gt;ObjectTypeName.Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03054 
03055                      <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( AccessState-&gt;ObjectTypeName.Buffer );
03056                      AccessState-&gt;ObjectTypeName.Length = 0;
03057                      AccessState-&gt;ObjectTypeName.MaximumLength = 0;
03058                  }
03059 
03060                 AccessState-&gt;ObjectTypeName.Buffer = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, LocalObjectTypeName-&gt;MaximumLength );
03061                 <span class="keywordflow">if</span> (AccessState-&gt;ObjectTypeName.Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03062 
03063                     AccessState-&gt;ObjectTypeName.MaximumLength = LocalObjectTypeName-&gt;MaximumLength;
03064                     <a class="code" href="../../d6/d6/nls_8c.html#a44">RtlCopyUnicodeString</a>( &amp;AccessState-&gt;ObjectTypeName, LocalObjectTypeName );
03065                 }
03066             }
03067         }
03068 
03069         <span class="keywordflow">if</span> ( ObjectNameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03070 
03071             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( ObjectNameInfo );
03072         }
03073 
03074         <span class="keywordflow">if</span> ( ObjectTypeNameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03075 
03076             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( ObjectTypeNameInfo );
03077         }
03078     }
03079 
03080     <span class="keywordflow">return</span>;
03081 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a142" doxytag="se.h::SeOpenObjectForDeleteAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID SeOpenObjectForDeleteAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectTypeName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID Object&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING AbsoluteObjectName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectCreated</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateOnClose</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03085">3085</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00259">_AUX_ACCESS_DATA::GenericMapping</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00258">_AUX_ACCESS_DATA::PrivilegesUsed</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01763">RtlCopyUnicodeString()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l03381">RtlMapGenericMask()</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">SepAdtAuditThisEvent</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00571">SepAdtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01003">SepAdtOpenObjectForDeleteAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03952">SepExamineSacl()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04587">SepFilterPrivilegeAudits()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02324">SepQueryNameString()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02400">SepQueryTypeString()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01711">SeSubsystemName</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>03098                    :
03099 
03100     <a class="code" href="../../d0/d5/se_8h.html#a142">SeOpenObjectForDeleteAuditAlarm</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object manager that open
03101     objects to generate any necessary audit or alarm messages.  The open may
03102     be to existing objects or <span class="keywordflow">for</span> newly created objects.  No messages will be
03103     generated <span class="keywordflow">for</span> Kernel mode accesses.
03104 
03105     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to generate audit and alarm messages when an
03106     attempt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to open an object with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> intent to <span class="keyword">delete</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
03107     Specifically, <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used by <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> systems when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> flag
03108     FILE_DELETE_ON_CLOSE <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified.
03109 
03110     This routine may result in several messages being generated and sent to
03111     Port objects.  This may result in a significant latency before
03112     returning.  Design of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a> that must call <span class="keyword">this</span> routine must take
03113     <span class="keyword">this</span> potential latency into account.  This may have an impact on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03114     approach taken <span class="keywordflow">for</span> data structure mutex locking, <span class="keywordflow">for</span> example.
03115 
03116 Arguments:
03117 
03118     ObjectTypeName - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of object being
03119         accessed.  This must be <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> same name provided to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03120         <a class="code" href="../../d4/d0/ob_8h.html#a67">ObCreateObjectType</a> service when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> was created.
03121 
03122     Object - Address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object accessed.  This value will not be used
03123         as a pointer (referenced).  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> necessary <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> to enter into log
03124         messages.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> open was not successful, then <span class="keyword">this</span> argument <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
03125         ignored.  Otherwise, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> must be provided.
03126 
03127     AbsoluteObjectName - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being accessed.
03128         If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object doesn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> have a name, then <span class="keyword">this</span> field <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> left null.
03129         Otherwise, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> must be provided.
03130 
03131     SecurityDescriptor - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03132         object being accessed.
03133 
03134     AccessState - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to an access state structure containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03135         subject context, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> remaining desired access types, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> granted
03136         access types, and optionally a privilege set to indicate which
03137         privileges were used to permit <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access.
03138 
03139     ObjectCreated - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> <span class="keywordtype">boolean</span> flag indicating whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access resulted
03140         in a <span class="keyword">new</span> object being created.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates an object
03141         was created, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> indicates an existing object was opened.
03142 
03143     AccessGranted - Indicates <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was granted or denied based on
03144         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access check or privilege check.
03145 
03146     AccessMode - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access mode used <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access check.  One
03147         of <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> or <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>.  Messages will not be generated by
03148         kernel mode accesses.
03149 
03150     GenerateOnClose - Points to a <span class="keywordtype">boolean</span> that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> audit
03151         generation routine and must be passed to <a class="code" href="../../d3/d5/seaudit_8c.html#a29">SeCloseObjectAuditAlarm</a>()
03152         when the object handle is closed.
03153 
03154 Return value:
03155 
03156     None.
03157 
03158 --*/
03159 {
03160     BOOLEAN GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03161     BOOLEAN GenerateAlarm = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03162     ACCESS_MASK RequestedAccess;
03163     POBJECT_NAME_INFORMATION ObjectNameInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03164     PUNICODE_STRING ObjectTypeNameInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03165     PUNICODE_STRING ObjectName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03166     PUNICODE_STRING LocalObjectTypeName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03167     PLUID PrimaryAuthenticationId = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03168     PLUID ClientAuthenticationId = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03169     BOOLEAN AuditPrivileges = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03170     BOOLEAN AuditPerformed;
03171     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
03172     ACCESS_MASK MappedGrantMask = (ACCESS_MASK)0;
03173     ACCESS_MASK MappedDenyMask = (ACCESS_MASK)0;
03174     <a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a> AuxData;
03175 
03176     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03177 
03178     <span class="keywordflow">if</span> ( AccessMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ) {
03179         <span class="keywordflow">return</span>;
03180     }
03181 
03182     AuxData = (<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a>)AccessState-&gt;AuxData;
03183 
03184     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( &amp;AccessState-&gt;SubjectSecurityContext );
03185 
03186     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuditData)) {
03187 
03188         MappedGrantMask = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuditData-&gt;GrantMask;
03189 
03190         <a class="code" href="../../d8/d6/sertl_8c.html#a70">RtlMapGenericMask</a>(
03191             &amp;MappedGrantMask,
03192             &amp;AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o1">GenericMapping</a>
03193             );
03194 
03195         MappedDenyMask = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuditData-&gt;DenyMask;
03196 
03197         <a class="code" href="../../d8/d6/sertl_8c.html#a70">RtlMapGenericMask</a>(
03198             &amp;MappedDenyMask,
03199             &amp;AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o1">GenericMapping</a>
03200             );
03201     }
03202 
03203     <span class="keywordflow">if</span> (SecurityDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03204 
03205         RequestedAccess = AccessState-&gt;RemainingDesiredAccess |
03206                           AccessState-&gt;PreviouslyGrantedAccess;
03207 
03208         <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryObjectAccess, &amp;AccessGranted )) {
03209 
03210             <span class="keywordflow">if</span> ( RequestedAccess &amp; (AccessGranted ? MappedGrantMask : MappedDenyMask)) {
03211 
03212                 GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03213 
03214             } <span class="keywordflow">else</span> {
03215 
03216                 <a class="code" href="../../d6/d6/sep_8h.html#a62">SepExamineSacl</a>(
03217                     RtlpSaclAddrSecurityDescriptor( (PISECURITY_DESCRIPTOR)SecurityDescriptor ),
03218                     Token,
03219                     RequestedAccess,
03220                     AccessGranted,
03221                     &amp;GenerateAudit,
03222                     &amp;GenerateAlarm
03223                     );
03224             }
03225 
03226             <span class="comment">//</span>
03227             <span class="comment">// Only generate an audit on close of we're auditing from SACL</span>
03228             <span class="comment">// settings.</span>
03229             <span class="comment">//</span>
03230 
03231             <span class="keywordflow">if</span> (GenerateAudit) {
03232                 *GenerateOnClose = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03233             }
03234         }
03235     }
03236 
03237     <span class="comment">//</span>
03238     <span class="comment">// If we don't generate an audit via the SACL, see if we need to generate</span>
03239     <span class="comment">// one for privilege use.</span>
03240     <span class="comment">//</span>
03241     <span class="comment">// Note that we only audit privileges successfully used to open objects,</span>
03242     <span class="comment">// so we don't care about a failed privilege use here.  Therefore, only</span>
03243     <span class="comment">// do this test of access has been granted.</span>
03244     <span class="comment">//</span>
03245 
03246     <span class="keywordflow">if</span> (!GenerateAudit &amp;&amp; (AccessGranted == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) {
03247 
03248         <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryPrivilegeUse, &amp;AccessGranted )) {
03249 
03250             <span class="keywordflow">if</span> ((AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
03251                 (AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a>-&gt;PrivilegeCount &gt; 0) ) {
03252 
03253                 <span class="comment">//</span>
03254                 <span class="comment">// Make sure these are actually privileges that we want to audit</span>
03255                 <span class="comment">//</span>
03256 
03257                 <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/sep_8h.html#a67">SepFilterPrivilegeAudits</a>( AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a> )) {
03258 
03259                     GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03260 
03261                     <span class="comment">//</span>
03262                     <span class="comment">// When we finally try to generate this audit, this flag</span>
03263                     <span class="comment">// will tell us that we need to audit the fact that we</span>
03264                     <span class="comment">// used a privilege, as opposed to audit due to the SACL.</span>
03265                     <span class="comment">//</span>
03266 
03267                     AccessState-&gt;AuditPrivileges = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03268                 }
03269             }
03270         }
03271     }
03272 
03273     <span class="comment">//</span>
03274     <span class="comment">// Set up either to generate an audit (if the access check has failed), or save</span>
03275     <span class="comment">// the stuff that we're going to audit later into the AccessState structure.</span>
03276     <span class="comment">//</span>
03277 
03278     <span class="keywordflow">if</span> (GenerateAudit || GenerateAlarm) {
03279 
03280         AccessState-&gt;GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03281 
03282         <span class="comment">//</span>
03283         <span class="comment">// Figure out what we've been passed, and obtain as much</span>
03284         <span class="comment">// missing information as possible.</span>
03285         <span class="comment">//</span>
03286 
03287         <span class="keywordflow">if</span> ( !ARGUMENT_PRESENT( AbsoluteObjectName )) {
03288 
03289             <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( Object )) {
03290 
03291                 ObjectNameInfo = <a class="code" href="../../d7/d6/sepaudit_8c.html#a17">SepQueryNameString</a>( Object  );
03292 
03293                 <span class="keywordflow">if</span> ( ObjectNameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03294 
03295                     ObjectName = &amp;ObjectNameInfo-&gt;Name;
03296                 }
03297             }
03298 
03299         } <span class="keywordflow">else</span> {
03300 
03301             ObjectName = AbsoluteObjectName;
03302         }
03303 
03304         <span class="keywordflow">if</span> ( !ARGUMENT_PRESENT( ObjectTypeName )) {
03305 
03306             <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( Object )) {
03307 
03308                 ObjectTypeNameInfo = <a class="code" href="../../d7/d6/sepaudit_8c.html#a18">SepQueryTypeString</a>( Object );
03309 
03310                 <span class="keywordflow">if</span> ( ObjectTypeNameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03311 
03312                     LocalObjectTypeName = ObjectTypeNameInfo;
03313                 }
03314             }
03315 
03316         } <span class="keywordflow">else</span> {
03317 
03318             LocalObjectTypeName = ObjectTypeName;
03319         }
03320 
03321         <span class="comment">//</span>
03322         <span class="comment">// If the access attempt failed, do the audit here.  If it succeeded,</span>
03323         <span class="comment">// we'll do the audit later, when the handle is allocated.</span>
03324         <span class="comment">//</span>
03325         <span class="comment">//</span>
03326 
03327         <span class="keywordflow">if</span> (!AccessGranted) {
03328 
03329             AuditPerformed = <a class="code" href="../../d7/d6/sepaudit_8c.html#a11">SepAdtOpenObjectAuditAlarm</a> ( &amp;SeSubsystemName,
03330                                                           NULL,
03331                                                           LocalObjectTypeName,
03332                                                           NULL,
03333                                                           ObjectName,
03334                                                           AccessState-&gt;SubjectSecurityContext.ClientToken,
03335                                                           AccessState-&gt;SubjectSecurityContext.PrimaryToken,
03336                                                           AccessState-&gt;OriginalDesiredAccess,
03337                                                           AccessState-&gt;PreviouslyGrantedAccess,
03338                                                           &amp;AccessState-&gt;OperationID,
03339                                                           AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a>,
03340                                                           FALSE,
03341                                                           FALSE,
03342                                                           TRUE,
03343                                                           FALSE,
03344                                                           AccessState-&gt;SubjectSecurityContext.ProcessAuditId,
03345                                                           AuditCategoryObjectAccess,
03346                                                           NULL,
03347                                                           0,
03348                                                           NULL );
03349         } <span class="keywordflow">else</span> {
03350 
03351             <span class="comment">//</span>
03352             <span class="comment">// Generate the delete audit first</span>
03353             <span class="comment">//</span>
03354 
03355             <a class="code" href="../../d7/d6/sepaudit_8c.html#a12">SepAdtOpenObjectForDeleteAuditAlarm</a> ( &amp;SeSubsystemName,
03356                                                   NULL,
03357                                                   LocalObjectTypeName,
03358                                                   NULL,
03359                                                   ObjectName,
03360                                                   AccessState-&gt;SubjectSecurityContext.ClientToken,
03361                                                   AccessState-&gt;SubjectSecurityContext.PrimaryToken,
03362                                                   AccessState-&gt;OriginalDesiredAccess,
03363                                                   AccessState-&gt;PreviouslyGrantedAccess,
03364                                                   &amp;AccessState-&gt;OperationID,
03365                                                   AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o0">PrivilegesUsed</a>,
03366                                                   FALSE,
03367                                                   TRUE,
03368                                                   TRUE,
03369                                                   FALSE,
03370                                                   AccessState-&gt;SubjectSecurityContext.ProcessAuditId );
03371 
03372             <span class="comment">//</span>
03373             <span class="comment">// Copy all the stuff we're going to need into the</span>
03374             <span class="comment">// AccessState and return.</span>
03375             <span class="comment">//</span>
03376 
03377             <span class="keywordflow">if</span> ( ObjectName != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03378 
03379                  <span class="keywordflow">if</span> ( AccessState-&gt;ObjectName.Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03380 
03381                      <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( AccessState-&gt;ObjectName.Buffer );
03382                      AccessState-&gt;ObjectName.Length = 0;
03383                      AccessState-&gt;ObjectName.MaximumLength = 0;
03384                  }
03385 
03386                 AccessState-&gt;ObjectName.Buffer = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool,ObjectName-&gt;MaximumLength );
03387                 <span class="keywordflow">if</span> (AccessState-&gt;ObjectName.Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03388 
03389                     AccessState-&gt;ObjectName.MaximumLength = ObjectName-&gt;MaximumLength;
03390                     <a class="code" href="../../d6/d6/nls_8c.html#a44">RtlCopyUnicodeString</a>( &amp;AccessState-&gt;ObjectName, ObjectName );
03391                 }
03392             }
03393 
03394             <span class="keywordflow">if</span> ( LocalObjectTypeName != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03395 
03396                  <span class="keywordflow">if</span> ( AccessState-&gt;ObjectTypeName.Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03397 
03398                      <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( AccessState-&gt;ObjectTypeName.Buffer );
03399                      AccessState-&gt;ObjectTypeName.Length = 0;
03400                      AccessState-&gt;ObjectTypeName.MaximumLength = 0;
03401                  }
03402 
03403                 AccessState-&gt;ObjectTypeName.Buffer = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, LocalObjectTypeName-&gt;MaximumLength );
03404                 <span class="keywordflow">if</span> (AccessState-&gt;ObjectTypeName.Buffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03405 
03406                     AccessState-&gt;ObjectTypeName.MaximumLength = LocalObjectTypeName-&gt;MaximumLength;
03407                     <a class="code" href="../../d6/d6/nls_8c.html#a44">RtlCopyUnicodeString</a>( &amp;AccessState-&gt;ObjectTypeName, LocalObjectTypeName );
03408                 }
03409             }
03410         }
03411 
03412         <span class="keywordflow">if</span> ( ObjectNameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03413 
03414             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( ObjectNameInfo );
03415         }
03416 
03417         <span class="keywordflow">if</span> ( ObjectTypeNameInfo != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03418 
03419             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( ObjectTypeNameInfo );
03420         }
03421     }
03422 
03423     <span class="keywordflow">return</span>;
03424 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a137" doxytag="se.h::SePrivilegeCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN SePrivilegeCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PPRIVILEGE_SET&nbsp;</td>
          <td class="mdname" nowrap> <em>RequiredPrivileges</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectSecurityContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/privileg_8c-source.html#l00158">158</a> of file <a class="el" href="../../d9/d3/privileg_8c-source.html">privileg.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00038">SepPrivilegeCheck()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/parse_8c-source.html#l02048">IopCheckBackupRestorePrivilege()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00593">IsPrivileged()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01232">ObpIncrementHandleCount()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00504">SeCheckPrivilegedObject()</a>, and <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">SeSinglePrivilegeCheck()</a>.
<p>
<pre class="fragment"><div>00165                    :
00166 
00167     This routine checks to see <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00168     privileges.
00169 
00170 Arguments:
00171 
00172     RequiredPrivileges - Points to a set of privileges.  The subject's
00173         security context <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be checked to see which of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00174         privileges are present.  The results will be indicated in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00175         attributes associated with each privilege.  Note that
00176         flags in <span class="keyword">this</span> parameter indicate whether all <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privileges listed
00177         are needed, or any of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privileges.
00178 
00179     SubjectSecurityContext - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject's captured security
00180         context.
00181 
00182     AccessMode - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access mode to use <span class="keywordflow">for</span> access check.  One of
00183         <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> or <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> kernel, then all privileges
00184         will be marked as being possessed by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject, and successful
00185         completion status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00186 
00187 
00188 Return Value:
00189 
00190     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> all specified privileges are held by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject,
00191     otherwise <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>.
00192 
00193 
00194 --*/
00195 
00196 {
00197     BOOLEAN <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00198 
00199     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00200 
00201     <span class="comment">//</span>
00202     <span class="comment">// If we're impersonating a client, we have to be at impersonation level</span>
00203     <span class="comment">// of SecurityImpersonation or above.</span>
00204     <span class="comment">//</span>
00205 
00206     <span class="keywordflow">if</span> ( (SubjectSecurityContext-&gt;ClientToken != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00207          (SubjectSecurityContext-&gt;ImpersonationLevel &lt; SecurityImpersonation)
00208        ) {
00209 
00210            <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00211     }
00212 
00213     <span class="comment">//</span>
00214     <span class="comment">// SepPrivilegeCheck locks the passed token for read access</span>
00215     <span class="comment">//</span>
00216 
00217     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d3/tokenp_8h.html#a37">SepPrivilegeCheck</a>(
00218                  <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( SubjectSecurityContext ),
00219                  RequiredPrivileges-&gt;Privilege,
00220                  RequiredPrivileges-&gt;PrivilegeCount,
00221                  RequiredPrivileges-&gt;Control,
00222                  AccessMode
00223                  );
00224 
00225     <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00226 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a182" doxytag="se.h::SePrivilegedServiceAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SePrivilegedServiceAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ServiceName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectSecurityContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET&nbsp;</td>
          <td class="mdname" nowrap> <em>Privileges</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00989">989</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00871">RtlEqualSid()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01628">SeLocalSystemSid</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">SepAdtAuditThisEvent</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00346">SepAdtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04587">SepFilterPrivilegeAudits()</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00176">SepTokenUserSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01711">SeSubsystemName</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01232">ObpIncrementHandleCount()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00199">SeCheckAuditPrivilege()</a>, and <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">SeSinglePrivilegeCheck()</a>.
<p>
<pre class="fragment"><div>00997                    :
00998 
00999     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be called whenever a privileged system service
01000     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> attempted.  It should be called immediately after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege
01001     check regardless of whether or not <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> test succeeds.
01002 
01003 Arguments:
01004 
01005     ServiceName - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privileged system service.
01006 
01007     SubjectSecurityContext - The subject security context representing
01008         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system service.
01009 
01010     Privileges - Supplies a privilge set containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege(s)
01011         required for the access.
01012 
01013     AccessGranted - Supplies the results of the privilege test.
01014 
01015 Return Value:
01016 
01017     None.
01018 
01019 --*/
01020 
01021 {
01022     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
01023 
01024     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01025 
01026     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryPrivilegeUse, &amp;AccessGranted ) &amp;&amp;
01027          <a class="code" href="../../d6/d6/sep_8h.html#a67">SepFilterPrivilegeAudits</a>( Privileges )) {
01028 
01029         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( SubjectSecurityContext );
01030 
01031         <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>( SeLocalSystemSid, <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>( Token ))) {
01032             <span class="keywordflow">return</span>;
01033         }
01034 
01035         <a class="code" href="../../d7/d6/sepaudit_8c.html#a10">SepAdtPrivilegedServiceAuditAlarm</a> (
01036             &amp;SeSubsystemName,
01037             ServiceName,
01038             SubjectSecurityContext-&gt;ClientToken,
01039             SubjectSecurityContext-&gt;PrimaryToken,
01040             Privileges,
01041             AccessGranted
01042             );
01043     }
01044 
01045     <span class="keywordflow">return</span>;
01046 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a149" doxytag="se.h::SePrivilegeObjectAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID SePrivilegeObjectAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectSecurityContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET&nbsp;</td>
          <td class="mdname" nowrap> <em>Privileges</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00650">650</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00125">SepAdtPrivilegeObjectAuditAlarm()</a>, and <a class="el" href="../../d1/d4/se_8h-source.html#l01711">SeSubsystemName</a>.
<p>
Referenced by <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00593">IsPrivileged()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l02160">ObpCreateHandle()</a>, and <a class="el" href="../../d9/d3/privileg_8c-source.html#l00504">SeCheckPrivilegedObject()</a>.
<p>
<pre class="fragment"><div>00661                    :
00662 
00663     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used by object methods that perform privileged
00664     operations to generate audit and alarm messages related to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> use
00665     of privileges, or attempts to use privileges.
00666 
00667 Arguments:
00668 
00669     Object - Address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object accessed.  This value will not be
00670     used as a pointer (referenced).  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> necessary <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> to enter
00671     into log messages.
00672 
00673     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> - Provides <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle value assigned <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> open.
00674 
00675     SecurityDescriptor - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00676     object being accessed.
00677 
00678     SubjectSecurityContext - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured security
00679     context of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject attempting to open <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.
00680 
00681     DesiredAccess - The desired access mask.  This mask must have been
00682     previously mapped to contain no generic accesses.
00683 
00684     Privileges - Points to a set of privileges required <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access
00685     attempt.  Those privileges that were held by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject are
00686     marked <span class="keyword">using</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> UsedForAccess flag of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> PRIVILEGE_ATTRIBUTES
00687     associated with each privilege.
00688 
00689     AccessGranted - Indicates whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was granted or
00690     denied.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was allowed.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a>
00691     value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was denied.
00692 
00693     AccessMode - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access mode used <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access check.
00694     Messages will not be generated by kernel mode accesses.
00695 
00696 Return Value:
00697 
00698     None.
00699 
00700 --*/
00701 
00702 {
00703     BOOLEAN AuditPerformed;
00704 
00705     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00706 
00707     <span class="keywordflow">if</span> (AccessMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00708 
00709         AuditPerformed = <a class="code" href="../../d7/d6/sepaudit_8c.html#a9">SepAdtPrivilegeObjectAuditAlarm</a> (
00710                              &amp;SeSubsystemName,
00711                              Handle,
00712                              SubjectSecurityContext-&gt;ClientToken,
00713                              SubjectSecurityContext-&gt;PrimaryToken,
00714                              SubjectSecurityContext-&gt;ProcessAuditId,
00715                              DesiredAccess,
00716                              Privileges,
00717                              AccessGranted
00718                              );
00719     }
00720 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a139" doxytag="se.h::SePrivilegePolicyCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SePrivilegePolicyCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>RemainingDesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviouslyGrantedAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PPRIVILEGE_SET *&nbsp;</td>
          <td class="mdname" nowrap> <em>PrivilegeSet</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a136" doxytag="se.h::SeProxyAccessCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SeProxyAccessCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>Volume</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>RelativePath</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ContainerObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectSecurityContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContextLocked</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviouslyGrantedAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PPRIVILEGE_SET *Privileges&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>GrantedAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PNTSTATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d3/accessck_8c-source.html#l03564">3564</a> of file <a class="el" href="../../d1/d3/accessck_8c-source.html">accessck.c</a>.
<p>
References <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>.
<p>
<pre class="fragment"><div>03582                    :
03583 
03584 
03585 Arguments:
03586 
03587     Volume - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> volume information of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> being opened.
03588 
03589     RelativePath - The volume-relative <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> being opened.  The full <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03590         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RelativePath appended to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Volume string.
03591 
03592     ContainerObject - Indicates <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to a container object (TRUE), or a leaf object (FALSE).
03593 
03594     SecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor protecting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03595          object being accessed
03596 
03597     SubjectSecurityContext - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject's captured security
03598          context
03599 
03600     SubjectContextLocked - Supplies a flag indiciating whether or not
03601         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user's subject context <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> locked, so that <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> does not have
03602         to be locked again.
03603 
03604     DesiredAccess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access mask that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> attempting to
03605          acquire
03606 
03607     PreviouslyGrantedAccess - Supplies any accesses that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user has
03608         already been granted, <span class="keywordflow">for</span> example, as a result of holding a
03609         privilege.
03610 
03611     Privileges - Supplies a pointer in which will be returned a privilege
03612         set indicating any privileges that were used as part of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03613         access validation.
03614 
03615     GenericMapping - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> generic mapping associated with <span class="keyword">this</span>
03616         object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
03617 
03618     AccessMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access mode to be used in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> check
03619 
03620     GrantedAccess - Pointer to a returned access mask indicatating <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03621          granted access
03622 
03623     AccessStatus - <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> value that may be returned indicating <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03624          <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> why access was denied.  Routines should avoid hardcoding a
03625          <span class="keywordflow">return</span> value of STATUS_ACCESS_DENIED so that a different value can
03626          be returned when mandatory access <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> implemented.
03627 
03628 
03629 Return Value:
03630 
03631     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allowed and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise
03632 
03633 --*/
03634 
03635 {
03636     <span class="keywordflow">return</span> <a class="code" href="../../d0/d4/accessck_8c.html#a18">SeAccessCheck</a> (
03637                 SecurityDescriptor,
03638                 SubjectSecurityContext,
03639                 SubjectContextLocked,
03640                 DesiredAccess,
03641                 PreviouslyGrantedAccess,
03642                 Privileges,
03643                 GenericMapping,
03644                 AccessMode,
03645                 GrantedAccess,
03646                 AccessStatus
03647                );
03648 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a166" doxytag="se.h::SeQueryAuthenticationIdToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeQueryAuthenticationIdToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLUID&nbsp;</td>
          <td class="mdname" nowrap> <em>AuthenticationId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/tokenqry_8c-source.html#l01152">1152</a> of file <a class="el" href="../../d0/d3/tokenqry_8c-source.html">tokenqry.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/queue_8c-source.html#l00222">CheckAllowForeground()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00050">GetProcessLuid()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00532">NtSetUuidSeed()</a>, and <a class="el" href="../../d1/d7/subject_8c-source.html#l00529">SeQueryAuthenticationIdSubjectContext()</a>.
<p>
<pre class="fragment"><div>01160                    :
01161 
01162     Retrieve authentication <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token.
01163 
01164 Arguments:
01165 
01166     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Referenced pointer to a token.
01167 
01168     AutenticationId - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token's authentication <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>.
01169 
01170 Return Value:
01171 
01172     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation was successful.
01173 
01174     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> expected status.
01175 
01176 --*/
01177 {
01178     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01179 
01180     <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( ((PTOKEN)Token) );
01181     (*AuthenticationId) = ((<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>)-&gt;AuthenticationId;
01182     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( ((PTOKEN)Token) );
01183     <span class="keywordflow">return</span>(STATUS_SUCCESS);
01184 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a196" doxytag="se.h::SeQueryInformationToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeQueryInformationToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN TOKEN_INFORMATION_CLASS&nbsp;</td>
          <td class="mdname" nowrap> <em>TokenInformationClass</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>TokenInformation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/tokenqry_8c-source.html#l01189">1189</a> of file <a class="el" href="../../d0/d3/tokenqry_8c-source.html">tokenqry.c</a>.
<p>
References <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00226">ANYSIZE_ARRAY</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01896">RtlCopyLuidAndAttributesArray()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01380">RtlCopySid()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01436">RtlCopySidAndAttributesArray()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00540">SeLengthSid</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00413">SepAcquireTokenReadLock</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>, <a class="el" href="../../d0/d3/tokenqry_8c-source.html#l01763">SeQuerySessionIdToken()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>.
<p>
<pre class="fragment"><div>01198                    :
01199 
01200     Retrieve information about a specified token.
01201 
01202 Arguments:
01203 
01204     TokenHandle - Provides a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token to operate on.
01205 
01206     TokenInformationClass - The token information <span class="keyword">class </span>about which
01207         to retrieve information.
01208 
01209     TokenInformation - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested information.
01210         The actual structures returned are dependent upon <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information
01211         class requested, as defined in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> TokenInformationClass parameter
01212         description.
01213 
01214         TokenInformation Format By Information Class:
01215 
01216            TokenUser =&gt; TOKEN_USER data structure.  TOKEN_QUERY
01217            access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to retrieve this information about a
01218            token.
01219 
01220            TokenGroups =&gt; TOKEN_GROUPS data structure.  TOKEN_QUERY
01221            access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to retrieve this information about a
01222            token.
01223 
01224            TokenPrivileges =&gt; TOKEN_PRIVILEGES data structure.
01225            TOKEN_QUERY access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to retrieve this information
01226            about a token.
01227 
01228            TokenOwner =&gt; TOKEN_OWNER data structure.  TOKEN_QUERY
01229            access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to retrieve this information about a
01230            token.
01231 
01232            TokenPrimaryGroup =&gt; TOKEN_PRIMARY_GROUP data structure.
01233            TOKEN_QUERY access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to retrieve this information
01234            about a token.
01235 
01236            TokenDefaultDacl =&gt; TOKEN_DEFAULT_DACL data structure.
01237            TOKEN_QUERY access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to retrieve this information
01238            about a token.
01239 
01240            TokenSource =&gt; TOKEN_SOURCE data structure.
01241            TOKEN_QUERY_SOURCE access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to retrieve this
01242            information about a token.
01243 
01244            TokenType =&gt; TOKEN_TYPE data structure.
01245            TOKEN_QUERY access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to retrieve this information
01246            about a token.
01247 
01248            TokenStatistics =&gt; TOKEN_STATISTICS data structure.
01249            TOKEN_QUERY access <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to retrieve this
01250            information about a token.
01251 
01252 Return Value:
01253 
01254     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation was successful.
01255 
01256 --*/
01257 {
01258 
01259     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01260 
01261     ULONG RequiredLength;
01262     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01263 
01264     PSID PSid;
01265     PACL PAcl;
01266 
01267     PVOID Ignore;
01268     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)AccessToken;
01269 
01270     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01271 
01272     <span class="comment">//</span>
01273     <span class="comment">// Case on information class.</span>
01274     <span class="comment">//</span>
01275 
01276     <span class="keywordflow">switch</span> ( TokenInformationClass ) {
01277 
01278         <span class="keywordflow">case</span> TokenUser:
01279             {
01280                 PTOKEN_USER LocalUser;
01281 
01282                 <span class="comment">//</span>
01283                 <span class="comment">//  Gain exclusive access to the token.</span>
01284                 <span class="comment">//</span>
01285 
01286                 <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( Token );
01287 
01288                 <span class="comment">//</span>
01289                 <span class="comment">// Return the length required now in case not enough buffer</span>
01290                 <span class="comment">// was provided by the caller and we have to return an error.</span>
01291                 <span class="comment">//</span>
01292 
01293                 RequiredLength = <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>( <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroups[0].Sid) +
01294                                  (ULONG)<span class="keyword">sizeof</span>( TOKEN_USER );
01295 
01296                 LocalUser = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, RequiredLength );
01297 
01298                 <span class="keywordflow">if</span> (LocalUser == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01299                     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01300                     <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01301                 }
01302 
01303                 <span class="comment">//</span>
01304                 <span class="comment">// Return the user SID</span>
01305                 <span class="comment">//</span>
01306                 <span class="comment">//  Put SID immediately following TOKEN_USER data structure</span>
01307                 <span class="comment">//</span>
01308 
01309                 PSid = (PSID)( (ULONG_PTR)LocalUser + (ULONG)<span class="keyword">sizeof</span>(TOKEN_USER) );
01310 
01311                 <a class="code" href="../../d8/d6/sertl_8c.html#a47">RtlCopySidAndAttributesArray</a>(
01312                     1,
01313                     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroups,
01314                     RequiredLength,
01315                     &amp;(LocalUser-&gt;User),
01316                     PSid,
01317                     ((PSID *)&amp;Ignore),
01318                     ((PULONG)&amp;Ignore)
01319                     );
01320 
01321                 <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01322                 *TokenInformation = LocalUser;
01323                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01324             }
01325 
01326 
01327         <span class="keywordflow">case</span> TokenGroups:
01328             {
01329                 PTOKEN_GROUPS LocalGroups;
01330 
01331                 <span class="comment">//</span>
01332                 <span class="comment">//  Gain exclusive access to the token.</span>
01333                 <span class="comment">//</span>
01334 
01335                 <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( Token );
01336 
01337                 <span class="comment">//</span>
01338                 <span class="comment">// Figure out how much space is needed to return the group SIDs.</span>
01339                 <span class="comment">// That's the size of TOKEN_GROUPS (without any array entries)</span>
01340                 <span class="comment">// plus the size of an SID_AND_ATTRIBUTES times the number of groups.</span>
01341                 <span class="comment">// The number of groups is Token-&gt;UserAndGroups-1 (since the count</span>
01342                 <span class="comment">// includes the user ID).  Then the lengths of each individual group</span>
01343                 <span class="comment">// must be added.</span>
01344                 <span class="comment">//</span>
01345 
01346                 RequiredLength = (ULONG)<span class="keyword">sizeof</span>(TOKEN_GROUPS) +
01347                                  ((<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroupCount - <a class="code" href="../../d5/d4/acpitabl_8h.html#a44">ANYSIZE_ARRAY</a> - 1) *
01348                                  ((ULONG)<span class="keyword">sizeof</span>(SID_AND_ATTRIBUTES)) );
01349 
01350                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 1;
01351                 <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroupCount) {
01352 
01353                     RequiredLength += <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>( <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroups[Index].Sid );
01354 
01355                     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1;
01356 
01357                 } <span class="comment">// endwhile</span>
01358 
01359                 LocalGroups = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, RequiredLength );
01360 
01361                 <span class="keywordflow">if</span> (LocalGroups == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01362                     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01363                     <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01364                 }
01365 
01366                 <span class="comment">//</span>
01367                 <span class="comment">// Now copy the groups.</span>
01368                 <span class="comment">//</span>
01369 
01370                 LocalGroups-&gt;GroupCount = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroupCount - 1;
01371 
01372                 PSid = (PSID)( (ULONG_PTR)LocalGroups +
01373                                (ULONG)<span class="keyword">sizeof</span>(TOKEN_GROUPS) +
01374                                (   (<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroupCount - <a class="code" href="../../d5/d4/acpitabl_8h.html#a44">ANYSIZE_ARRAY</a> - 1) *
01375                                    (ULONG)<span class="keyword">sizeof</span>(SID_AND_ATTRIBUTES) )
01376                              );
01377 
01378                 <a class="code" href="../../d8/d6/sertl_8c.html#a47">RtlCopySidAndAttributesArray</a>(
01379                     (ULONG)(<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroupCount - 1),
01380                     &amp;(<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroups[1]),
01381                     RequiredLength,
01382                     LocalGroups-&gt;Groups,
01383                     PSid,
01384                     ((PSID *)&amp;Ignore),
01385                     ((PULONG)&amp;Ignore)
01386                     );
01387 
01388                 <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01389                 *TokenInformation = LocalGroups;
01390                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01391             }
01392 
01393 
01394         <span class="keywordflow">case</span> TokenPrivileges:
01395             {
01396                 PTOKEN_PRIVILEGES LocalPrivileges;
01397 
01398                 <span class="comment">//</span>
01399                 <span class="comment">//  Gain exclusive access to the token to prevent changes</span>
01400                 <span class="comment">//  from occuring to the privileges.</span>
01401                 <span class="comment">//</span>
01402 
01403                 <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( Token );
01404 
01405                 <span class="comment">//</span>
01406                 <span class="comment">// Return the length required now in case not enough buffer</span>
01407                 <span class="comment">// was provided by the caller and we have to return an error.</span>
01408                 <span class="comment">//</span>
01409 
01410                 RequiredLength = (ULONG)<span class="keyword">sizeof</span>(TOKEN_PRIVILEGES) +
01411                                  ((<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;PrivilegeCount - <a class="code" href="../../d5/d4/acpitabl_8h.html#a44">ANYSIZE_ARRAY</a>) *
01412                                  ((ULONG)<span class="keyword">sizeof</span>(LUID_AND_ATTRIBUTES)) );
01413 
01414                 LocalPrivileges = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, RequiredLength );
01415 
01416                 <span class="keywordflow">if</span> (LocalPrivileges == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01417                     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01418                     <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01419                 }
01420 
01421                 <span class="comment">//</span>
01422                 <span class="comment">// Return the token privileges.</span>
01423                 <span class="comment">//</span>
01424 
01425                 LocalPrivileges-&gt;PrivilegeCount = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;PrivilegeCount;
01426 
01427                 <a class="code" href="../../d8/d6/sertl_8c.html#a52">RtlCopyLuidAndAttributesArray</a>(
01428                     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;PrivilegeCount,
01429                     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;Privileges,
01430                     LocalPrivileges-&gt;Privileges
01431                     );
01432 
01433                 <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01434                 *TokenInformation = LocalPrivileges;
01435                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01436             }
01437 
01438 
01439         <span class="keywordflow">case</span> TokenOwner:
01440             {
01441                 PTOKEN_OWNER LocalOwner;
01442 
01443                 <span class="comment">//</span>
01444                 <span class="comment">//  Gain exclusive access to the token to prevent changes</span>
01445                 <span class="comment">//  from occuring to the owner.</span>
01446                 <span class="comment">//</span>
01447 
01448                 <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( Token );
01449 
01450                 <span class="comment">//</span>
01451                 <span class="comment">// Return the length required now in case not enough buffer</span>
01452                 <span class="comment">// was provided by the caller and we have to return an error.</span>
01453                 <span class="comment">//</span>
01454 
01455                 PSid = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroups[<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DefaultOwnerIndex].Sid;
01456                 RequiredLength = (ULONG)<span class="keyword">sizeof</span>(TOKEN_OWNER) +
01457                                  <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>( PSid );
01458 
01459                 LocalOwner = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, RequiredLength );
01460 
01461                 <span class="keywordflow">if</span> (LocalOwner == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01462                     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01463                     <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01464                 }
01465 
01466                 <span class="comment">//</span>
01467                 <span class="comment">// Return the owner SID</span>
01468                 <span class="comment">//</span>
01469 
01470                 PSid = (PSID)((ULONG_PTR)LocalOwner +
01471                               (ULONG)<span class="keyword">sizeof</span>(TOKEN_OWNER));
01472 
01473                 LocalOwner-&gt;Owner = PSid;
01474 
01475                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a46">RtlCopySid</a>(
01476                              (RequiredLength - (ULONG)<span class="keyword">sizeof</span>(TOKEN_OWNER)),
01477                              PSid,
01478                              <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroups[<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DefaultOwnerIndex].Sid
01479                              );
01480 
01481                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
01482 
01483                 <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01484                 *TokenInformation = LocalOwner;
01485                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01486             }
01487 
01488 
01489         <span class="keywordflow">case</span> TokenPrimaryGroup:
01490             {
01491                 PTOKEN_PRIMARY_GROUP LocalPrimaryGroup;
01492 
01493                 <span class="comment">//</span>
01494                 <span class="comment">//  Gain exclusive access to the token to prevent changes</span>
01495                 <span class="comment">//  from occuring to the owner.</span>
01496                 <span class="comment">//</span>
01497 
01498                 <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( Token );
01499 
01500                 <span class="comment">//</span>
01501                 <span class="comment">// Return the length required now in case not enough buffer</span>
01502                 <span class="comment">// was provided by the caller and we have to return an error.</span>
01503                 <span class="comment">//</span>
01504 
01505                 RequiredLength = (ULONG)<span class="keyword">sizeof</span>(TOKEN_PRIMARY_GROUP) +
01506                                  <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>( <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;PrimaryGroup );
01507 
01508                 LocalPrimaryGroup = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, RequiredLength );
01509 
01510                 <span class="keywordflow">if</span> (LocalPrimaryGroup == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01511                     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01512                     <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01513                 }
01514 
01515                 <span class="comment">//</span>
01516                 <span class="comment">// Return the primary group SID</span>
01517                 <span class="comment">//</span>
01518 
01519                 PSid = (PSID)((ULONG_PTR)LocalPrimaryGroup +
01520                               (ULONG)<span class="keyword">sizeof</span>(TOKEN_PRIMARY_GROUP));
01521 
01522                 LocalPrimaryGroup-&gt;PrimaryGroup = PSid;
01523 
01524                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a46">RtlCopySid</a>( (RequiredLength - (ULONG)<span class="keyword">sizeof</span>(TOKEN_PRIMARY_GROUP)),
01525                                      PSid,
01526                                      <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;PrimaryGroup
01527                                      );
01528 
01529                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
01530 
01531                 <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01532                 *TokenInformation = LocalPrimaryGroup;
01533                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01534             }
01535 
01536 
01537         <span class="keywordflow">case</span> TokenDefaultDacl:
01538             {
01539                 PTOKEN_DEFAULT_DACL LocalDefaultDacl;
01540 
01541                 <span class="comment">//</span>
01542                 <span class="comment">//  Gain exclusive access to the token to prevent changes</span>
01543                 <span class="comment">//  from occuring to the owner.</span>
01544                 <span class="comment">//</span>
01545 
01546                 <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( Token );
01547 
01548                 <span class="comment">//</span>
01549                 <span class="comment">// Return the length required now in case not enough buffer</span>
01550                 <span class="comment">// was provided by the caller and we have to return an error.</span>
01551                 <span class="comment">//</span>
01552 
01553                 RequiredLength = (ULONG)<span class="keyword">sizeof</span>(TOKEN_DEFAULT_DACL);
01554 
01555                 <span class="keywordflow">if</span> (ARGUMENT_PRESENT(<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DefaultDacl)) {
01556 
01557                     RequiredLength += <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DefaultDacl-&gt;AclSize;
01558                 }
01559 
01560                 LocalDefaultDacl = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, RequiredLength );
01561 
01562                 <span class="keywordflow">if</span> (LocalDefaultDacl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01563                     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01564                     <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01565                 }
01566 
01567                 <span class="comment">//</span>
01568                 <span class="comment">// Return the default Dacl</span>
01569                 <span class="comment">//</span>
01570 
01571                 PAcl = (PACL)((ULONG_PTR)LocalDefaultDacl +
01572                               (ULONG)<span class="keyword">sizeof</span>(TOKEN_DEFAULT_DACL));
01573 
01574                 <span class="keywordflow">if</span> (ARGUMENT_PRESENT(<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DefaultDacl)) {
01575 
01576                     LocalDefaultDacl-&gt;DefaultDacl = PAcl;
01577 
01578                     RtlCopyMemory( (PVOID)PAcl,
01579                                    (PVOID)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DefaultDacl,
01580                                    <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DefaultDacl-&gt;AclSize
01581                                    );
01582                 } <span class="keywordflow">else</span> {
01583 
01584                     LocalDefaultDacl-&gt;DefaultDacl = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01585                 }
01586 
01587                 <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01588                 *TokenInformation = LocalDefaultDacl;
01589                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01590             }
01591 
01592 
01593         <span class="keywordflow">case</span> TokenSource:
01594             {
01595                 PTOKEN_SOURCE LocalSource;
01596 
01597                 <span class="comment">//</span>
01598                 <span class="comment">// The type of a token can not be changed, so</span>
01599                 <span class="comment">// exclusive access to the token is not necessary.</span>
01600                 <span class="comment">//</span>
01601 
01602                 <span class="comment">//</span>
01603                 <span class="comment">// Return the length required now in case not enough buffer</span>
01604                 <span class="comment">// was provided by the caller and we have to return an error.</span>
01605                 <span class="comment">//</span>
01606 
01607                 RequiredLength = (ULONG) <span class="keyword">sizeof</span>(TOKEN_SOURCE);
01608 
01609                 LocalSource = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, RequiredLength );
01610 
01611                 <span class="keywordflow">if</span> (LocalSource == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01612                     <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01613                 }
01614 
01615                 <span class="comment">//</span>
01616                 <span class="comment">// Return the token source</span>
01617                 <span class="comment">//</span>
01618 
01619                 (*LocalSource) = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;TokenSource;
01620                 *TokenInformation = LocalSource;
01621 
01622                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01623             }
01624 
01625 
01626         <span class="keywordflow">case</span> TokenType:
01627             {
01628                 PTOKEN_TYPE LocalType;
01629 
01630                 <span class="comment">//</span>
01631                 <span class="comment">// The type of a token can not be changed, so</span>
01632                 <span class="comment">// exclusive access to the token is not necessary.</span>
01633                 <span class="comment">//</span>
01634 
01635                 <span class="comment">//</span>
01636                 <span class="comment">// Return the length required now in case not enough buffer</span>
01637                 <span class="comment">// was provided by the caller and we have to return an error.</span>
01638                 <span class="comment">//</span>
01639 
01640                 RequiredLength = (ULONG) <span class="keyword">sizeof</span>(TOKEN_TYPE);
01641 
01642                 LocalType = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, RequiredLength );
01643 
01644                 <span class="keywordflow">if</span> (LocalType == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01645                     <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01646                 }
01647 
01648                 <span class="comment">//</span>
01649                 <span class="comment">// Return the token type</span>
01650                 <span class="comment">//</span>
01651 
01652                 (*LocalType) = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;TokenType;
01653                 *TokenInformation = LocalType;
01654                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01655             }
01656 
01657 
01658         <span class="keywordflow">case</span> TokenImpersonationLevel:
01659             {
01660                 PSECURITY_IMPERSONATION_LEVEL LocalImpersonationLevel;
01661 
01662                 <span class="comment">//</span>
01663                 <span class="comment">// The impersonation level of a token can not be changed, so</span>
01664                 <span class="comment">// exclusive access to the token is not necessary.</span>
01665                 <span class="comment">//</span>
01666 
01667                 <span class="comment">//</span>
01668                 <span class="comment">//  Make sure the token is an appropriate type to be retrieving</span>
01669                 <span class="comment">//  the impersonation level from.</span>
01670                 <span class="comment">//</span>
01671 
01672                 <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;TokenType != TokenImpersonation) {
01673 
01674                     <span class="keywordflow">return</span> STATUS_INVALID_INFO_CLASS;
01675                 }
01676 
01677                 <span class="comment">//</span>
01678                 <span class="comment">// Return the length required now in case not enough buffer</span>
01679                 <span class="comment">// was provided by the caller and we have to return an error.</span>
01680                 <span class="comment">//</span>
01681 
01682                 RequiredLength = (ULONG) <span class="keyword">sizeof</span>(SECURITY_IMPERSONATION_LEVEL);
01683 
01684                 LocalImpersonationLevel = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, RequiredLength );
01685 
01686                 <span class="keywordflow">if</span> (LocalImpersonationLevel == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01687                     <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01688                 }
01689 
01690                 <span class="comment">//</span>
01691                 <span class="comment">// Return the impersonation level</span>
01692                 <span class="comment">//</span>
01693 
01694                 (*LocalImpersonationLevel) = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;ImpersonationLevel;
01695                 *TokenInformation = LocalImpersonationLevel;
01696                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01697             }
01698 
01699 
01700         <span class="keywordflow">case</span> TokenStatistics:
01701             {
01702                 PTOKEN_STATISTICS LocalStatistics;
01703 
01704                 <span class="comment">//</span>
01705                 <span class="comment">//  Gain exclusive access to the token.</span>
01706                 <span class="comment">//</span>
01707 
01708                 <a class="code" href="../../d8/d3/tokenp_8h.html#a6">SepAcquireTokenReadLock</a>( Token );
01709 
01710                 <span class="comment">//</span>
01711                 <span class="comment">// Return the length required now in case not enough buffer</span>
01712                 <span class="comment">// was provided by the caller and we have to return an error.</span>
01713                 <span class="comment">//</span>
01714 
01715                 RequiredLength = (ULONG)<span class="keyword">sizeof</span>( TOKEN_STATISTICS );
01716 
01717                 LocalStatistics = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, RequiredLength );
01718 
01719                 <span class="keywordflow">if</span> (LocalStatistics == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01720                     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01721                     <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
01722                 }
01723 
01724                 <span class="comment">//</span>
01725                 <span class="comment">// Return the statistics</span>
01726                 <span class="comment">//</span>
01727 
01728                 LocalStatistics-&gt;TokenId            = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;TokenId;
01729                 LocalStatistics-&gt;AuthenticationId   = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;AuthenticationId;
01730                 LocalStatistics-&gt;ExpirationTime     = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;ExpirationTime;
01731                 LocalStatistics-&gt;TokenType          = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;TokenType;
01732                 LocalStatistics-&gt;ImpersonationLevel = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;ImpersonationLevel;
01733                 LocalStatistics-&gt;DynamicCharged     = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DynamicCharged;
01734                 LocalStatistics-&gt;DynamicAvailable   = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;DynamicAvailable;
01735                 LocalStatistics-&gt;GroupCount         = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;UserAndGroupCount-1;
01736                 LocalStatistics-&gt;PrivilegeCount     = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;PrivilegeCount;
01737                 LocalStatistics-&gt;ModifiedId         = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>-&gt;ModifiedId;
01738 
01739                 <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>( Token );
01740                 *TokenInformation = LocalStatistics;
01741                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01742             }
01743 
01744     <span class="keywordflow">case</span> TokenSessionId:
01745 
01746         <span class="comment">/*</span>
01747 <span class="comment">         * Get SessionId for the token</span>
01748 <span class="comment">         */</span>
01749         <a class="code" href="../../d9/d3/tokenqry_8c.html#a3">SeQuerySessionIdToken</a>( (PACCESS_TOKEN)Token,
01750                              (PULONG)TokenInformation );
01751 
01752         <span class="keywordflow">return</span>( STATUS_SUCCESS );
01753 
01754     <span class="keywordflow">default</span>:
01755 
01756         <span class="keywordflow">return</span> STATUS_INVALID_INFO_CLASS;
01757     }
01758 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a114" doxytag="se.h::SeQuerySecurityAccessMask" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeQuerySecurityAccessMask           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN SECURITY_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d5/semethod_8c-source.html#l00138">138</a> of file <a class="el" href="../../d1/d5/semethod_8c-source.html">semethod.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l02547">IoCheckFunctionAccess()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l00255">NtQuerySecurityObject()</a>.
<p>
<pre class="fragment"><div>00145                    :
00146 
00147     This routine builds an access mask representing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> accesses necessary
00148     to query <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object security information specified in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00149     SecurityInformation parameter.  While <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not difficult to determine
00150     <span class="keyword">this</span> information, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> use of a single routine to generate <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> will ensure
00151     minimal impact when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security information associated with an object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00152     extended in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> future (to include mandatory access control information).
00153 
00154 Arguments:
00155 
00156     SecurityInformation - Identifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object's security information to be
00157         queried.
00158 
00159     DesiredAccess - Points to an access mask to be set to represent <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00160         accesses necessary to query <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information specified in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00161         SecurityInformation parameter.
00162 
00163 Return Value:
00164 
00165     None.
00166 
00167 --*/
00168 
00169 {
00170     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00171 
00172     <span class="comment">//</span>
00173     <span class="comment">// Figure out accesses needed to perform the indicated operation(s).</span>
00174     <span class="comment">//</span>
00175 
00176     (*DesiredAccess) = 0;
00177 
00178     <span class="keywordflow">if</span> ((SecurityInformation &amp; OWNER_SECURITY_INFORMATION) ||
00179         (SecurityInformation &amp; GROUP_SECURITY_INFORMATION) ||
00180         (SecurityInformation &amp; DACL_SECURITY_INFORMATION)) {
00181         (*DesiredAccess) |= READ_CONTROL;
00182     }
00183 
00184     <span class="keywordflow">if</span> ((SecurityInformation &amp; SACL_SECURITY_INFORMATION)) {
00185         (*DesiredAccess) |= ACCESS_SYSTEM_SECURITY;
00186     }
00187 
00188     <span class="keywordflow">return</span>;
00189 
00190 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a177" doxytag="se.h::SeQuerySecurityDescriptorInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeQuerySecurityDescriptorInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectsSecurityDescriptor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d5/semethod_8c-source.html#l00559">559</a> of file <a class="el" href="../../d1/d5/semethod_8c-source.html">semethod.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l00167">LongAlignPtr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02004">RtlCreateSecurityDescriptorRelative()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00540">SeLengthSid</a>, and <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/cmse_8c-source.html#l00847">CmpQuerySecurityDescriptorInfo()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00975">IopGetSetSecurityObject()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l01679">ObQuerySecurityDescriptorInfo()</a>.
<p>
<pre class="fragment"><div>00568                    :
00569 
00570     This routine will extract <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired information from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00571     passed security descriptor and <span class="keywordflow">return</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information in
00572     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed buffer as a security descriptor in <span class="keyword">self</span>-relative
00573     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a8">format</a>.
00574 
00575 Arguments:
00576 
00577     SecurityInformation - Specifies what information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being queried.
00578 
00579     SecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer to output <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested
00580         information into.
00581 
00582         This buffer has been probed <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size indicated by
00583         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Length parameter.  Since <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> still points into user space,
00584         <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> must always be accessed in a <span class="keywordflow">try</span> clause.
00585 
00586     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a variable containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of
00587         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor buffer.  Upon <span class="keywordflow">return</span> <span class="keyword">this</span> variable will
00588         contain <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length needed to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested information.
00589 
00590     ObjectsSecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a pointer to
00591         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> objects security descriptor.  The passed security descriptor
00592         must be in <span class="keyword">self</span>-relative <a class="code" href="../../d8/d0/rtbatcr_8c.html#a8">format</a>.
00593 
00594 Return Value:
00595 
00596     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> - STATUS_SUCCESS <span class="keywordflow">if</span> successful and an appropriate error value
00597         otherwise
00598 
00599 --*/
00600 
00601 {
00602     ULONG BufferLength;
00603 
00604     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00605     ULONG OwnerLength;
00606     ULONG GroupLength;
00607     ULONG DaclLength;
00608     ULONG SaclLength;
00609     PUCHAR NextFree;
00610     SECURITY_DESCRIPTOR IObjectSecurity;
00611 
00612     <span class="comment">//</span>
00613     <span class="comment">// Note that IObjectSecurity is not a pointer to a pointer</span>
00614     <span class="comment">// like ObjectsSecurityDescriptor is.</span>
00615     <span class="comment">//</span>
00616 
00617     SECURITY_DESCRIPTOR_RELATIVE *ISecurityDescriptor = SecurityDescriptor;
00618 
00619     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00620 
00621     <span class="comment">//</span>
00622     <span class="comment">//  We will be accessing user memory throughout this routine,</span>
00623     <span class="comment">//  therefore do everything in a try-except clause.</span>
00624     <span class="comment">//</span>
00625 
00626     <span class="keywordflow">try</span> {
00627 
00628         BufferLength = *Length;
00629 
00630         <span class="comment">//</span>
00631         <span class="comment">//  Check if the object's descriptor is null, and if it is then</span>
00632         <span class="comment">//  we only need to return a blank security descriptor record</span>
00633         <span class="comment">//</span>
00634 
00635         <span class="keywordflow">if</span> (*ObjectsSecurityDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00636 
00637             *Length = <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE);
00638 
00639             <span class="comment">//</span>
00640             <span class="comment">//  Now make sure it's large enough for the security descriptor</span>
00641             <span class="comment">//  record</span>
00642             <span class="comment">//</span>
00643 
00644             <span class="keywordflow">if</span> (BufferLength &lt; <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE)) {
00645 
00646                 <span class="keywordflow">return</span> STATUS_BUFFER_TOO_SMALL;
00647 
00648             }
00649 
00650             <span class="comment">//</span>
00651             <span class="comment">//  It's large enough to make a blank security descriptor record</span>
00652             <span class="comment">//</span>
00653             <span class="comment">//  Note that this parameter has been probed for write by the</span>
00654             <span class="comment">//  object manager, however, we still have to be careful when</span>
00655             <span class="comment">//  writing to it.</span>
00656             <span class="comment">//</span>
00657 
00658             <span class="comment">//</span>
00659             <span class="comment">// We do not have to probe this here, because the object</span>
00660             <span class="comment">// manager has probed it for length=BufferLength, which we</span>
00661             <span class="comment">// know at this point is at least as large as a security</span>
00662             <span class="comment">// descriptor.</span>
00663             <span class="comment">//</span>
00664 
00665             <a class="code" href="../../d8/d6/sertl_8c.html#a54">RtlCreateSecurityDescriptorRelative</a>( SecurityDescriptor,
00666                                                  SECURITY_DESCRIPTOR_REVISION );
00667 
00668             <span class="comment">//</span>
00669             <span class="comment">// Mark it as self-relative</span>
00670             <span class="comment">//</span>
00671 
00672             RtlpSetControlBits( ISecurityDescriptor, SE_SELF_RELATIVE );
00673 
00674             <span class="comment">//</span>
00675             <span class="comment">//  And return to our caller</span>
00676             <span class="comment">//</span>
00677 
00678             <span class="keywordflow">return</span> STATUS_SUCCESS;
00679 
00680         }
00681 
00682         <span class="comment">//</span>
00683         <span class="comment">// Create an absolute format SD on the stack pointing into</span>
00684         <span class="comment">// user space to simplify the following code</span>
00685         <span class="comment">//</span>
00686 
00687         RtlCopyMemory( (&amp;IObjectSecurity),
00688                       *ObjectsSecurityDescriptor,
00689                       <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE) );
00690 
00691         IObjectSecurity.Owner = RtlpOwnerAddrSecurityDescriptor(
00692                     (SECURITY_DESCRIPTOR *) *ObjectsSecurityDescriptor );
00693         IObjectSecurity.Group = RtlpGroupAddrSecurityDescriptor(
00694                     (SECURITY_DESCRIPTOR *) *ObjectsSecurityDescriptor );
00695         IObjectSecurity.Dacl = RtlpDaclAddrSecurityDescriptor(
00696                     (SECURITY_DESCRIPTOR *) *ObjectsSecurityDescriptor );
00697         IObjectSecurity.Sacl = RtlpSaclAddrSecurityDescriptor(
00698                     (SECURITY_DESCRIPTOR *) *ObjectsSecurityDescriptor );
00699 
00700         IObjectSecurity.Control &amp;= ~SE_SELF_RELATIVE;
00701 
00702         <span class="comment">//</span>
00703         <span class="comment">//  This is not a blank descriptor so we need to determine the size</span>
00704         <span class="comment">//  needed to store the requested information.  It is the size of the</span>
00705         <span class="comment">//  descriptor record plus the size of each requested component.</span>
00706         <span class="comment">//</span>
00707 
00708         <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE);
00709 
00710         <span class="keywordflow">if</span> ( (((*SecurityInformation) &amp; OWNER_SECURITY_INFORMATION)) &amp;&amp;
00711              (IObjectSecurity.Owner != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ) {
00712 
00713             OwnerLength = <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>( IObjectSecurity.Owner );
00714             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> += (ULONG)LongAlignSize(OwnerLength);
00715 
00716         }
00717 
00718         <span class="keywordflow">if</span> ( (((*SecurityInformation) &amp; GROUP_SECURITY_INFORMATION)) &amp;&amp;
00719              (IObjectSecurity.Group != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ) {
00720 
00721             GroupLength = <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>( IObjectSecurity.Group );
00722             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> += (ULONG)LongAlignSize(GroupLength);
00723 
00724         }
00725 
00726         <span class="keywordflow">if</span> ( (((*SecurityInformation) &amp; DACL_SECURITY_INFORMATION)) &amp;&amp;
00727              (IObjectSecurity.Control &amp; SE_DACL_PRESENT) &amp;&amp;
00728              (IObjectSecurity.Dacl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ) {
00729 
00730 
00731             DaclLength = (ULONG)LongAlignSize((IObjectSecurity.Dacl)-&gt;AclSize);
00732             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> += DaclLength;
00733 
00734         }
00735 
00736         <span class="keywordflow">if</span> ( (((*SecurityInformation) &amp; SACL_SECURITY_INFORMATION)) &amp;&amp;
00737              (IObjectSecurity.Control &amp; SE_SACL_PRESENT) &amp;&amp;
00738              (IObjectSecurity.Sacl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ) {
00739 
00740             SaclLength = (ULONG)LongAlignSize((IObjectSecurity.Sacl)-&gt;AclSize);
00741             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> += SaclLength;
00742 
00743         }
00744 
00745         <span class="comment">//</span>
00746         <span class="comment">//  Tell the caller how much space this will require</span>
00747         <span class="comment">//  (whether we actually fit or not)</span>
00748         <span class="comment">//</span>
00749 
00750         *Length = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00751 
00752         <span class="comment">//</span>
00753         <span class="comment">//  Now make sure the size is less than or equal to the length</span>
00754         <span class="comment">//  we were passed</span>
00755         <span class="comment">//</span>
00756 
00757         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> &gt; BufferLength) {
00758 
00759             <span class="keywordflow">return</span> STATUS_BUFFER_TOO_SMALL;
00760 
00761         }
00762 
00763         <span class="comment">//</span>
00764         <span class="comment">//  The length is fine.</span>
00765         <span class="comment">//</span>
00766         <span class="comment">//  Fill in the length and flags part of the security descriptor.</span>
00767         <span class="comment">//  The real addresses of each acl will be filled in later when we</span>
00768         <span class="comment">//  copy the ACLs over.</span>
00769         <span class="comment">//</span>
00770         <span class="comment">//  Note that we only set a flag in the descriptor if the information</span>
00771         <span class="comment">//  was requested, which is a simple copy of the requested information</span>
00772         <span class="comment">//  input variable</span>
00773         <span class="comment">//</span>
00774         <span class="comment">//  The output buffer has already been probed to the passed size,</span>
00775         <span class="comment">//  so we can just write to it.</span>
00776         <span class="comment">//</span>
00777 
00778         <a class="code" href="../../d8/d6/sertl_8c.html#a54">RtlCreateSecurityDescriptorRelative</a>( SecurityDescriptor,
00779                                              SECURITY_DESCRIPTOR_REVISION );
00780 
00781         <span class="comment">//</span>
00782         <span class="comment">// Mark the returned Security Descriptor as being in</span>
00783         <span class="comment">// self-relative format</span>
00784         <span class="comment">//</span>
00785 
00786         RtlpSetControlBits( ISecurityDescriptor, SE_SELF_RELATIVE );
00787 
00788         <span class="comment">//</span>
00789         <span class="comment">//  NextFree is used to point to the next free spot in the</span>
00790         <span class="comment">//  returned security descriptor.</span>
00791         <span class="comment">//</span>
00792 
00793         NextFree = <a class="code" href="../../d3/d8/udfprocs_8h.html#a27">LongAlignPtr</a>((PUCHAR)SecurityDescriptor +
00794                                         <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE));
00795 
00796         <span class="comment">//</span>
00797         <span class="comment">//  Copy the Owner SID if necessary and update the NextFree pointer,</span>
00798         <span class="comment">//  keeping it longword aligned.</span>
00799         <span class="comment">//</span>
00800 
00801         <span class="keywordflow">if</span> ( ((*SecurityInformation) &amp; OWNER_SECURITY_INFORMATION) &amp;&amp;
00802              ((IObjectSecurity.Owner) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ) {
00803 
00804                 RtlMoveMemory( NextFree,
00805                                IObjectSecurity.Owner,
00806                                OwnerLength );
00807 
00808                 ISecurityDescriptor-&gt;Owner = (ULONG)((PUCHAR)NextFree - (PUCHAR)SecurityDescriptor);
00809 
00810                 RtlpPropagateControlBits(
00811                     ISecurityDescriptor,
00812                     &amp;IObjectSecurity,
00813                     SE_OWNER_DEFAULTED
00814                     );
00815 
00816                 NextFree += (ULONG)LongAlignSize(OwnerLength);
00817 
00818         }
00819 
00820 
00821         <span class="comment">//</span>
00822         <span class="comment">//  Copy the Group SID if necessary and update the NextFree pointer,</span>
00823         <span class="comment">//  keeping it longword aligned.</span>
00824         <span class="comment">//</span>
00825 
00826         <span class="keywordflow">if</span> ( ((*SecurityInformation) &amp; GROUP_SECURITY_INFORMATION) &amp;&amp;
00827              (IObjectSecurity.Group != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ) {
00828 
00829                 RtlMoveMemory( NextFree,
00830                                IObjectSecurity.Group,
00831                                GroupLength );
00832 
00833                 ISecurityDescriptor-&gt;Group = (ULONG)((PUCHAR)NextFree - (PUCHAR)SecurityDescriptor);
00834 
00835                 RtlpPropagateControlBits(
00836                     ISecurityDescriptor,
00837                     &amp;IObjectSecurity,
00838                     SE_GROUP_DEFAULTED
00839                     );
00840 
00841                 NextFree += (ULONG)LongAlignSize(GroupLength);
00842 
00843         }
00844 
00845 
00846         <span class="comment">//</span>
00847         <span class="comment">//  Set discretionary acl information if requested.</span>
00848         <span class="comment">//  If not set in object's security,</span>
00849         <span class="comment">//  then everything is already set properly.</span>
00850         <span class="comment">//</span>
00851 
00852         <span class="keywordflow">if</span> ( (*SecurityInformation) &amp; DACL_SECURITY_INFORMATION) {
00853 
00854             RtlpPropagateControlBits(
00855                 ISecurityDescriptor,
00856                 &amp;IObjectSecurity,
00857                 SE_DACL_PRESENT | SE_DACL_DEFAULTED | SE_DACL_PROTECTED | SE_DACL_AUTO_INHERITED
00858                 );
00859 
00860             <span class="comment">//</span>
00861             <span class="comment">// Copy the acl if non-null  and update the NextFree pointer,</span>
00862             <span class="comment">// keeping it longword aligned.</span>
00863             <span class="comment">//</span>
00864 
00865             <span class="keywordflow">if</span> ( (IObjectSecurity.Control &amp; SE_DACL_PRESENT) != 0 &amp;&amp;
00866                  IObjectSecurity.Dacl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00867 
00868                 RtlMoveMemory( NextFree,
00869                                IObjectSecurity.Dacl,
00870                                (IObjectSecurity.Dacl)-&gt;AclSize );
00871 
00872                 ISecurityDescriptor-&gt;Dacl = (ULONG)((PUCHAR)NextFree - (PUCHAR)SecurityDescriptor);
00873 
00874                 NextFree += DaclLength;
00875 
00876             }
00877         }
00878 
00879 
00880         <span class="comment">//</span>
00881         <span class="comment">//  Set system acl information if requested.</span>
00882         <span class="comment">//  If not set in object's security,</span>
00883         <span class="comment">//  then everything is already set properly.</span>
00884         <span class="comment">//</span>
00885 
00886         <span class="keywordflow">if</span> ( (*SecurityInformation) &amp; SACL_SECURITY_INFORMATION) {
00887 
00888             RtlpPropagateControlBits(
00889                 ISecurityDescriptor,
00890                 &amp;IObjectSecurity,
00891                 SE_SACL_PRESENT | SE_SACL_DEFAULTED | SE_SACL_PROTECTED | SE_SACL_AUTO_INHERITED
00892                 );
00893 
00894             <span class="comment">//</span>
00895             <span class="comment">// Copy the acl if non-null  and update the NextFree pointer,</span>
00896             <span class="comment">// keeping it longword aligned.</span>
00897             <span class="comment">//</span>
00898             <span class="keywordflow">if</span> ( (IObjectSecurity.Control &amp; SE_SACL_PRESENT) != 0 &amp;&amp;
00899                  IObjectSecurity.Sacl != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00900 
00901                 RtlMoveMemory( NextFree,
00902                                IObjectSecurity.Sacl,
00903                                (IObjectSecurity.Sacl)-&gt;AclSize );
00904 
00905                 ISecurityDescriptor-&gt;Sacl = (ULONG)((PUCHAR)NextFree - (PUCHAR)SecurityDescriptor);
00906 
00907             }
00908         }
00909 
00910     } except(EXCEPTION_EXECUTE_HANDLER) {
00911         <span class="keywordflow">return</span>(GetExceptionCode());
00912     }
00913 
00914     <span class="keywordflow">return</span> STATUS_SUCCESS;
00915 
00916 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a167" doxytag="se.h::SeQuerySessionIdToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeQuerySessionIdToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN&nbsp;</td>
          <td class="mdname" nowrap> <em>PACCESS_TOKEN</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>pSessionId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a193" doxytag="se.h::SeRegisterLogonSessionTerminatedRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeRegisterLogonSessionTerminatedRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d5/se_8h.html#a35">PSE_LOGON_SESSION_TERMINATED_ROUTINE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CallbackRoutine</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00849">849</a> of file <a class="el" href="../../d0/d9/rmlogon_8c-source.html">rmlogon.c</a>.
<p>
References <a class="el" href="../../d2/d9/rmp_8h-source.html#l00147">_SEP_LOGON_SESSION_TERMINATED_NOTIFICATION::CallbackRoutine</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00146">_SEP_LOGON_SESSION_TERMINATED_NOTIFICATION::Next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00434">PSE_LOGON_SESSION_TERMINATED_ROUTINE</a>, <a class="el" href="../../d1/d0/rmp_8h.html#a17">PSEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00038">SeFileSystemNotifyRoutinesHead</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00060">SepRmAcquireDbWriteLock</a>, and <a class="el" href="../../d2/d9/rmp_8h-source.html#l00066">SepRmReleaseDbWriteLock</a>.
<p>
<pre class="fragment"><div>00855                    :
00856 
00857     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> systems that are interested in being
00858     notified when a logon session <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being deleted.
00859 
00860 Arguments:
00861 
00862     CallbackRoutine - Address of routine to call back when a logon session
00863         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being deleted.
00864 
00865 Return Value:
00866 
00867     STATUS_SUCCESS - Successfully registered routine
00868 
00869     STATUS_INVALID_PARAMETER - CallbackRoutine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00870 
00871     STATUS_INSUFFICIENT_RESOURCE - Unable to allocate list entry.
00872 
00873 --*/
00874 
00875 {
00876     <a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">PSEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a> NewCallback;
00877 
00878     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00879 
00880     <span class="keywordflow">if</span> (CallbackRoutine == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00881         <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00882     }
00883 
00884     NewCallback = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(
00885                         PagedPool,
00886                         <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a>),
00887                         'SFeS');
00888 
00889     <span class="keywordflow">if</span> (NewCallback == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00890         <span class="keywordflow">return</span>( STATUS_INSUFFICIENT_RESOURCES );
00891     }
00892 
00893     <a class="code" href="../../d1/d0/rmp_8h.html#a3">SepRmAcquireDbWriteLock</a>();
00894 
00895     NewCallback-&gt;<a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html#o0">Next</a> = <a class="code" href="../../d9/d9/rmlogon_8c.html#a1">SeFileSystemNotifyRoutinesHead</a>.<a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html#o0">Next</a>;
00896 
00897     NewCallback-&gt;<a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html#o1">CallbackRoutine</a> = CallbackRoutine;
00898 
00899     <a class="code" href="../../d9/d9/rmlogon_8c.html#a1">SeFileSystemNotifyRoutinesHead</a>.<a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html#o0">Next</a> = NewCallback;
00900 
00901     <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00902 
00903     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00904 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a127" doxytag="se.h::SeReleaseAcl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeReleaseAcl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACL&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedAcl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ForceCapture</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01560">1560</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l01690">NtCreateToken()</a>, and <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00037">NtSetInformationToken()</a>.
<p>
<pre class="fragment"><div>01568                    :
01569 
01570     This routine releases a previously captured ACL.
01571 
01572     This routine should NOT be called <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACL was captured into a
01573     provided CaptureBuffer (see SeCaptureAcl).
01574 
01575 Arguments:
01576 
01577     CapturedAcl - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACL to release.
01578 
01579     RequestorMode - The processor mode specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACL was captured.
01580 
01581     ForceCapture - The ForceCapture value specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACL was
01582         captured.
01583 
01584 Return Value:
01585 
01586     None.
01587 
01588 --*/
01589 
01590 {
01591     <span class="comment">//</span>
01592     <span class="comment">// We only have something to deallocate if the requestor was user</span>
01593     <span class="comment">// mode or kernel mode requesting ForceCapture.</span>
01594     <span class="comment">//</span>
01595 
01596     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01597 
01598     <span class="keywordflow">if</span> ( ((RequestorMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp; (ForceCapture == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) ||
01599           (RequestorMode == <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> ) ) {
01600 
01601         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(CapturedAcl);
01602 
01603     }
01604 
01605 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a129" doxytag="se.h::SeReleaseLuidAndAttributesArray" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeReleaseLuidAndAttributesArray           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID_AND_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedArray</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ForceCapture</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01797">1797</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l00046">NtAdjustPrivilegesToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l01690">NtCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01306">NtFilterToken()</a>, and <a class="el" href="../../d9/d3/privileg_8c-source.html#l00231">NtPrivilegeCheck()</a>.
<p>
<pre class="fragment"><div>01805                    :
01806 
01807     This routine releases a previously captured array of LUID_AND_ATTRIBUTES.
01808 
01809     This routine should NOT be called <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array was captured into a
01810     provided CaptureBuffer (see SeCaptureLuidAndAttributesArray).
01811 
01812 Arguments:
01813 
01814     CapturedArray - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array to release.
01815 
01816     RequestorMode - The processor mode specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array was captured.
01817 
01818     ForceCapture - The ForceCapture value specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array was
01819         captured.
01820 
01821 Return Value:
01822 
01823     None.
01824 
01825 --*/
01826 
01827 {
01828     <span class="comment">//</span>
01829     <span class="comment">// We only have something to deallocate if the requestor was user</span>
01830     <span class="comment">// mode or kernel mode requesting ForceCapture.</span>
01831     <span class="comment">//</span>
01832 
01833     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01834 
01835     <span class="keywordflow">if</span> ( ((RequestorMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp; (ForceCapture == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) ||
01836           (RequestorMode == <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> )) {
01837         <span class="comment">//</span>
01838         <span class="comment">// the capture routine returns success with a null pointer for zero elements.</span>
01839         <span class="comment">//</span>
01840         <span class="keywordflow">if</span> (CapturedArray != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01841            <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(CapturedArray);
01842 
01843     }
01844 
01845     <span class="keywordflow">return</span>;
01846 
01847 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a117" doxytag="se.h::SeReleaseSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID SeReleaseSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedSecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ForceCapture</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00631">631</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l08959">IopSetSecurityObjectFromRegistry()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00046">NtSetSecurityObject()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l00891">NtUserCreateWindowStation()</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>.
<p>
<pre class="fragment"><div>00639                    :
00640 
00641     This routine releases a previously captured security descriptor.
00642     Only
00643 
00644 Arguments:
00645 
00646     CapturedSecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor to release.
00647 
00648     RequestorMode - The processor mode specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> descriptor was
00649         captured.
00650 
00651     ForceCapture - The ForceCapture value specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> descriptor was
00652         captured.
00653 
00654 Return Value:
00655 
00656     None.
00657 
00658 --*/
00659 
00660 {
00661     <span class="comment">//</span>
00662     <span class="comment">// We only have something to deallocate if the requestor was user</span>
00663     <span class="comment">// mode or kernel mode requesting ForceCapture.</span>
00664     <span class="comment">//</span>
00665 
00666     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00667 
00668     <span class="keywordflow">if</span> ( ((RequestorMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp; (ForceCapture == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) ||
00669           (RequestorMode == <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> ) ) {
00670         <span class="keywordflow">if</span> ( CapturedSecurityDescriptor ) {
00671             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(CapturedSecurityDescriptor);
00672             }
00673     }
00674 
00675     <span class="keywordflow">return</span>;
00676 
00677 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a125" doxytag="se.h::SeReleaseSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeReleaseSid           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedSid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ForceCapture</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01320">1320</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l01690">NtCreateToken()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>, <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00037">NtSetInformationToken()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>.
<p>
<pre class="fragment"><div>01328                    :
01329 
01330     This routine releases a previously captured SID.
01331 
01332     This routine should NOT be called <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID was captured into a
01333     provided CaptureBuffer (see SeCaptureSid).
01334 
01335 Arguments:
01336 
01337     CapturedSid - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID to release.
01338 
01339     RequestorMode - The processor mode specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID was captured.
01340 
01341     ForceCapture - The ForceCapture value specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SID was
01342         captured.
01343 
01344 Return Value:
01345 
01346     None.
01347 
01348 --*/
01349 
01350 {
01351     <span class="comment">//</span>
01352     <span class="comment">// We only have something to deallocate if the requestor was user</span>
01353     <span class="comment">// mode or kernel mode requesting ForceCapture.</span>
01354     <span class="comment">//</span>
01355 
01356     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01357 
01358     <span class="keywordflow">if</span> ( ((RequestorMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp; (ForceCapture == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) ||
01359           (RequestorMode == <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> ) ) {
01360 
01361         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(CapturedSid);
01362 
01363     }
01364 
01365     <span class="keywordflow">return</span>;
01366 
01367 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a131" doxytag="se.h::SeReleaseSidAndAttributesArray" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeReleaseSidAndAttributesArray           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSID_AND_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedArray</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>RequestorMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ForceCapture</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l02297">2297</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l00432">NtAdjustGroupsToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l01690">NtCreateToken()</a>, and <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01306">NtFilterToken()</a>.
<p>
<pre class="fragment"><div>02305                    :
02306 
02307     This routine releases a previously captured array of SID_AND_ATTRIBUTES.
02308 
02309     This routine should NOT be called <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array was captured into a
02310     provided CaptureBuffer (see SeCaptureSidAndAttributesArray).
02311 
02312 Arguments:
02313 
02314     CapturedArray - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array to release.
02315 
02316     RequestorMode - The processor mode specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array was captured.
02317 
02318     ForceCapture - The ForceCapture value specified when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array was
02319         captured.
02320 
02321 Return Value:
02322 
02323     None.
02324 
02325 --*/
02326 
02327 {
02328     <span class="comment">//</span>
02329     <span class="comment">// We only have something to deallocate if the requestor was user</span>
02330     <span class="comment">// mode or kernel mode requesting ForceCapture.</span>
02331     <span class="comment">//</span>
02332 
02333     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02334 
02335     <span class="keywordflow">if</span> ( ((RequestorMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp; (ForceCapture == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) ||
02336           (RequestorMode == <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> ) ) {
02337 
02338         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(CapturedArray);
02339 
02340     }
02341 
02342     <span class="keywordflow">return</span>;
02343 
02344 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a121" doxytag="se.h::SeReleaseSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID SeReleaseSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SubjectContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00196">196</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00840">PsDereferenceImpersonationToken</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00810">PsDereferencePrimaryToken</a>.
<p>
Referenced by <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01235">CmpFlushNotify()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02555">FsRtlCancelNotify()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l01795">FsRtlNotifyCleanup()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00547">FsRtlNotifyFullChangeDirectory()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00593">IsPrivileged()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02492">NtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02627">NtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00731">NtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00406">NtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00532">NtSetUuidSeed()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02573">SeAuditHandleDuplication()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02466">SeAuditProcessCreation()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00504">SeCheckPrivilegedObject()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03826">SeCloseObjectAuditAlarm()</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00348">SeDeleteAccessState()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03892">SeDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">SeSinglePrivilegeCheck()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00203                    :
00204 
00205     This routine releases a subject security context previously captured by
00206     <a class="code" href="../../d0/d8/subject_8c.html#a0">SeCaptureSubjectContext</a>().
00207 
00208 Arguments:
00209 
00210     SubjectContext - Points to a <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> data structure
00211         containing a subject's previously captured security context.
00212 
00213 Return Value:
00214 
00215     none.
00216 
00217 --*/
00218 
00219 {
00220     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00221 
00222     <a class="code" href="../../d1/d9/ps_8h.html#a24">PsDereferencePrimaryToken</a>( SubjectContext-&gt;PrimaryToken );
00223     SubjectContext-&gt;PrimaryToken = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00224 
00225 
00226     <a class="code" href="../../d1/d9/ps_8h.html#a26">PsDereferenceImpersonationToken</a>( SubjectContext-&gt;ClientToken );
00227     SubjectContext-&gt;ClientToken = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00228 
00229     <span class="keywordflow">return</span>;
00230 
00231 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a176" doxytag="se.h::SeRmInitPhase1" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SeRmInitPhase1           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00060">60</a> of file <a class="el" href="../../d1/d9/rmmain_8c-source.html">rmmain.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00084">_SEP_RM_STATE::LsaInitEventHandle</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00175">PsCreateSystemThread()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00087">_SEP_RM_STATE::RmCommandPortHandle</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l01607">RtlAddAccessAllowedAce()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00082">RtlAnsiStringToUnicodeString()</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l00099">RtlCreateAcl()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01945">RtlCreateSecurityDescriptor()</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01215">RtlFreeUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00056">RtlInitString()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00540">SeLengthSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01628">SeLocalSystemSid</a>, <a class="el" href="../../d1/d0/rmp_8h.html#a11">SEP_RM_CONNECT_INFO</a>, <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00425">SepAdtInitializeAuditingOptions()</a>, <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00242">SepAdtInitializeCrashOnFail()</a>, <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00329">SepAdtInitializePrivilegeAuditing()</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00309">SepRmCommandServerThread()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00227">SepRmState</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00086">_SEP_RM_STATE::SepRmThreadHandle</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00065                    :
00066 
00067     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by Phase 1 System Initialization to initialize
00068     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Security Reference Monitor.  Note that initialization of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00069     Reference Monitor Global State has already been performed in Phase 0
00070     initialization to allow access validation <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a> to operate without
00071     having to check that Reference Monitor Initialization <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> complete.
00072 
00073     The steps listed below are performed in <span class="keyword">this</span> routine.  The remainder
00074     of Reference Monitor initialization requires <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA subsystem to have run,
00075     so that initialization <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> performed in a separate thread (the RM Command
00076     Server Thread, see below), so that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> present thread can create <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00077     Session <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a79">Manager</a> which execs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA.
00078 
00079     o <a class="code" href="../../d4/d5/conimep_8h.html#a111">Create</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Reference Monitor Command LPC port.  The LSA subsystem sends
00080       commands (e.g. turn on auditing) which change <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Reference Monitor
00081       Global State.
00082     o <a class="code" href="../../d4/d5/conimep_8h.html#a111">Create</a> an <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> <span class="keywordflow">for</span> use in synchronizing with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA subsystem.  The
00083       LSA will signal <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> event when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> portion of LSA initialization upon
00084       with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Reference Monitor depends <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> complete.  The Reference Monitor
00085       uses another LPC port, called <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA Command Port to send commands
00086       to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA, so <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RM must know that <span class="keyword">this</span> port has been created before
00087       trying to connect to <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
00088     o <a class="code" href="../../d4/d5/conimep_8h.html#a111">Create</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Reference Monitor Command <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a22">Server</a> Thread.  This thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00089       a permanent thread of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> System Init process that fields <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Reference
00090       Monitor State Change commands described above.
00091 
00092 
00093 Arguments:
00094 
00095     None.
00096 
00097 Return Value:
00098 
00099     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> Rm Initialization (Phase 1) succeeded, else FALSE
00100 
00101 --*/
00102 
00103 {
00104     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00105     STRING RmCommandPortName;
00106     UNICODE_STRING UnicodeRmCommandPortName;
00107     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00108     STRING LsaInitEventName;
00109     UNICODE_STRING UnicodeLsaInitEventName;
00110     OBJECT_ATTRIBUTES LsaInitEventObjectAttributes;
00111     SECURITY_DESCRIPTOR LsaInitEventSecurityDescriptor;
00112     ULONG AclSize;
00113 
00114     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00115 
00116     <span class="comment">//</span>
00117     <span class="comment">// Create an LPC port called the Reference Monitor Command Port.</span>
00118     <span class="comment">// This will be used by the LSA to send commands to the Reference</span>
00119     <span class="comment">// Monitor to update its state data.</span>
00120     <span class="comment">//</span>
00121 
00122     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;RmCommandPortName, <span class="stringliteral">"\\SeRmCommandPort"</span> );
00123     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(
00124                  &amp;UnicodeRmCommandPortName,
00125                  &amp;RmCommandPortName,
00126                  TRUE );  <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00127     InitializeObjectAttributes(
00128         &amp;ObjectAttributes,
00129         &amp;UnicodeRmCommandPortName,
00130         0,
00131         NULL,
00132         NULL
00133         );
00134 
00135     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCreatePort(
00136                  &amp;<a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o3">RmCommandPortHandle</a>,
00137                  &amp;ObjectAttributes,
00138                  <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">SEP_RM_CONNECT_INFO</a>),
00139                  <span class="keyword">sizeof</span>(RM_COMMAND_MESSAGE),
00140                  <span class="keyword">sizeof</span>(RM_COMMAND_MESSAGE) * 32
00141                  );
00142     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>( &amp;UnicodeRmCommandPortName );
00143 
00144     <span class="keywordflow">if</span>( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
00145 
00146         KdPrint((<span class="stringliteral">"Security: Rm Create Command Port failed 0x%lx\n"</span>, Status));
00147         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00148     }
00149 
00150     <span class="comment">//</span>
00151     <span class="comment">// Prepare to create an event for synchronizing with the LSA.</span>
00152     <span class="comment">// First, build the Security Descriptor for the Init Event Object</span>
00153     <span class="comment">//</span>
00154 
00155     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a53">RtlCreateSecurityDescriptor</a>(
00156                  &amp;LsaInitEventSecurityDescriptor,
00157                  SECURITY_DESCRIPTOR_REVISION
00158                  );
00159 
00160     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00161 
00162         KdPrint((<span class="stringliteral">"Security:  Creating Lsa Init Event Desc failed 0x%lx\n"</span>,
00163                   Status));
00164         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00165     }
00166 
00167     <span class="comment">//</span>
00168     <span class="comment">// Allocate a temporary buffer from the paged pool.  It is a fatal</span>
00169     <span class="comment">// system error if the allocation fails since security cannot be</span>
00170     <span class="comment">// enabled.</span>
00171     <span class="comment">//</span>
00172 
00173     AclSize = <span class="keyword">sizeof</span>(ACL) +
00174               <span class="keyword">sizeof</span>(ACCESS_ALLOWED_ACE) +
00175               <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>(SeLocalSystemSid);
00176     LsaInitEventSecurityDescriptor.Dacl =
00177         <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(PagedPool, AclSize, 'cAeS');
00178 
00179     <span class="keywordflow">if</span> (LsaInitEventSecurityDescriptor.Dacl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00180 
00181         KdPrint((<span class="stringliteral">"Security LSA:  Insufficient resources to initialize\n"</span>));
00182         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00183     }
00184 
00185     <span class="comment">//</span>
00186     <span class="comment">// Now create the Discretionary ACL within the Security Descriptor</span>
00187     <span class="comment">//</span>
00188 
00189     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d4/acledit_8c.html#a6">RtlCreateAcl</a>(
00190                  LsaInitEventSecurityDescriptor.Dacl,
00191                  AclSize,
00192                  ACL_REVISION2
00193                  );
00194 
00195     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00196 
00197         KdPrint((<span class="stringliteral">"Security:  Creating Lsa Init Event Dacl failed 0x%lx\n"</span>,
00198                   Status));
00199         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00200     }
00201 
00202     <span class="comment">//</span>
00203     <span class="comment">// Now add an ACE giving GENERIC_ALL access to the User ID</span>
00204     <span class="comment">//</span>
00205 
00206     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d4/acledit_8c.html#a16">RtlAddAccessAllowedAce</a>(
00207                  LsaInitEventSecurityDescriptor.Dacl,
00208                  ACL_REVISION2,
00209                  GENERIC_ALL,
00210                  SeLocalSystemSid
00211                  );
00212 
00213     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00214 
00215         KdPrint((<span class="stringliteral">"Security:  Adding Lsa Init Event ACE failed 0x%lx\n"</span>,
00216                   Status));
00217         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00218     }
00219 
00220     <span class="comment">//</span>
00221     <span class="comment">// Set up the Object Attributes for the Lsa Initialization Event</span>
00222     <span class="comment">//</span>
00223 
00224     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( &amp;LsaInitEventName, <span class="stringliteral">"\\SeLsaInitEvent"</span> );
00225     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(
00226                  &amp;UnicodeLsaInitEventName,
00227                  &amp;LsaInitEventName,
00228                  TRUE );  <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00229     InitializeObjectAttributes(
00230         &amp;LsaInitEventObjectAttributes,
00231         &amp;UnicodeLsaInitEventName,
00232         0,
00233         NULL,
00234         &amp;LsaInitEventSecurityDescriptor
00235         );
00236 
00237     <span class="comment">//</span>
00238     <span class="comment">// Create an event for use in synchronizing with the LSA.  The LSA will</span>
00239     <span class="comment">// signal this event when LSA initialization has reached the point</span>
00240     <span class="comment">// where the LSA's Reference Monitor Server Port has been created.</span>
00241     <span class="comment">//</span>
00242 
00243     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCreateEvent(
00244                  &amp;(<a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o0">LsaInitEventHandle</a>),
00245                  EVENT_MODIFY_STATE,
00246                  &amp;LsaInitEventObjectAttributes,
00247                  NotificationEvent,
00248                  FALSE);
00249 
00250     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>( &amp;UnicodeLsaInitEventName );
00251 
00252     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00253 
00254         KdPrint((<span class="stringliteral">"Security: LSA init event creation failed.0x%xl\n"</span>,
00255             Status));
00256         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00257     }
00258 
00259     <span class="comment">//</span>
00260     <span class="comment">// Deallocate the pool memory used for the Init Event DACL</span>
00261     <span class="comment">//</span>
00262 
00263     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( LsaInitEventSecurityDescriptor.Dacl );
00264 
00265     <span class="comment">//</span>
00266     <span class="comment">// Create a permanent thread of the Sysinit Process, called the</span>
00267     <span class="comment">// Reference Monitor Server Thread.  This thread is dedicated to</span>
00268     <span class="comment">// receiving Reference Monitor commands and dispatching them.</span>
00269     <span class="comment">//</span>
00270 
00271     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/ps_2create_8c.html#a11">PsCreateSystemThread</a>(
00272                  &amp;<a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o2">SepRmThreadHandle</a>,
00273                  THREAD_GET_CONTEXT |
00274                  THREAD_SET_CONTEXT |
00275                  THREAD_SET_INFORMATION,
00276                  NULL,
00277                  NULL,
00278                  NULL,
00279                  SepRmCommandServerThread,
00280                  NULL
00281                  );
00282 
00283     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00284 
00285         KdPrint((<span class="stringliteral">"Security: Rm Server Thread creation failed 0x%lx\n"</span>, Status));
00286         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00287     }
00288 
00289     <span class="comment">//</span>
00290     <span class="comment">// Initialize data from the registry.  This must go here because all other</span>
00291     <span class="comment">// Se initialization takes place before the registry is initialized.</span>
00292     <span class="comment">//</span>
00293 
00294     <a class="code" href="../../d6/d6/sep_8h.html#a71">SepAdtInitializeCrashOnFail</a>();
00295     <a class="code" href="../../d6/d6/sep_8h.html#a72">SepAdtInitializePrivilegeAuditing</a>();
00296     <a class="code" href="../../d1/d5/adtp_8h.html#a35">SepAdtInitializeAuditingOptions</a>();
00297     
00298     <span class="comment">//</span>
00299     <span class="comment">// Reference Monitor initialization is successful if we get to here.</span>
00300     <span class="comment">//</span>
00301 
00302     ZwClose( <a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o2">SepRmThreadHandle</a> );
00303     <a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o2">SepRmThreadHandle</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00304     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00305 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a192" doxytag="se.h::SeSetAccessStateGenericMapping" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeSetAccessStateGenericMapping           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d5/struct__ACCESS__STATE.html">PACCESS_STATE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/seastate_8c-source.html#l00396">396</a> of file <a class="el" href="../../d3/d4/seastate_8c-source.html">seastate.c</a>.
<p>
References <a class="el" href="../../d1/d4/se_8h-source.html#l00175">_ACCESS_STATE::AuxData</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00259">_AUX_ACCESS_DATA::GenericMapping</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>.
<p>
<pre class="fragment"><div>00403                    :
00404 
00405     This routine sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> GenericMapping field in an AccessState structure.
00406     It must be called before access validation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> performed <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> GenericMapping
00407     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not passed in when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> AccessState structure <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> created.
00408 
00409 Arguments:
00410 
00411     AccessState - a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d5/struct__ACCESS__STATE.html">ACCESS_STATE</a> structure to be modified.
00412 
00413     GenericMapping - a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> GenericMapping to be copied into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> AccessState.
00414 
00415 Return Value:
00416 
00417 
00418 --*/
00419 {
00420     <a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a> AuxData;
00421 
00422     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00423 
00424     AuxData = (<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html">PAUX_ACCESS_DATA</a>)AccessState-&gt;<a class="code" href="../../d2/d5/struct__ACCESS__STATE.html#o11">AuxData</a>;
00425 
00426     AuxData-&gt;<a class="code" href="../../d5/d2/struct__AUX__ACCESS__DATA.html#o1">GenericMapping</a> = *GenericMapping;
00427 
00428     <span class="keywordflow">return</span>;
00429 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a113" doxytag="se.h::SeSetSecurityAccessMask" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeSetSecurityAccessMask           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN SECURITY_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d5/semethod_8c-source.html#l00078">78</a> of file <a class="el" href="../../d1/d5/semethod_8c-source.html">semethod.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l02547">IoCheckFunctionAccess()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l00046">NtSetSecurityObject()</a>.
<p>
<pre class="fragment"><div>00085                    :
00086 
00087     This routine builds an access mask representing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> accesses necessary
00088     to set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object security information specified in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SecurityInformation
00089     parameter.  While <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not difficult to determine <span class="keyword">this</span> information,
00090     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> use of a single routine to generate <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> will ensure minimal impact
00091     when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security information associated with an object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> extended in
00092     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> future (to include mandatory access control information).
00093 
00094 Arguments:
00095 
00096     SecurityInformation - Identifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object's security information to be
00097         modified.
00098 
00099     DesiredAccess - Points to an access mask to be set to represent <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00100         accesses necessary to modify <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information specified in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00101         SecurityInformation parameter.
00102 
00103 Return Value:
00104 
00105     None.
00106 
00107 --*/
00108 
00109 {
00110 
00111     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00112 
00113     <span class="comment">//</span>
00114     <span class="comment">// Figure out accesses needed to perform the indicated operation(s).</span>
00115     <span class="comment">//</span>
00116 
00117     (*DesiredAccess) = 0;
00118 
00119     <span class="keywordflow">if</span> ((SecurityInformation &amp; OWNER_SECURITY_INFORMATION) ||
00120         (SecurityInformation &amp; GROUP_SECURITY_INFORMATION)   ) {
00121         (*DesiredAccess) |= WRITE_OWNER;
00122     }
00123 
00124     <span class="keywordflow">if</span> (SecurityInformation &amp; DACL_SECURITY_INFORMATION) {
00125         (*DesiredAccess) |= WRITE_DAC;
00126     }
00127 
00128     <span class="keywordflow">if</span> (SecurityInformation &amp; SACL_SECURITY_INFORMATION) {
00129         (*DesiredAccess) |= ACCESS_SYSTEM_SECURITY;
00130     }
00131 
00132     <span class="keywordflow">return</span>;
00133 
00134 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a178" doxytag="se.h::SeSetSecurityDescriptorInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeSetSecurityDescriptorInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID Object&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectsSecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d5/semethod_8c-source.html#l00365">365</a> of file <a class="el" href="../../d1/d5/semethod_8c-source.html">semethod.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/cmse_8c-source.html#l00397">CmpSetSecurityDescriptorInfo()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00877">IopSetDeviceSecurityDescriptors()</a>, and <a class="el" href="../../d0/d1/obse_8c-source.html#l01748">ObSetSecurityDescriptorInfo()</a>.
<p>
<pre class="fragment"><div>00376                    :
00377 
00378     This routine will set an object's security descriptor.  The input
00379     security descriptor must be previously captured.
00380 
00381 Arguments:
00382 
00383     Object - Optionally supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object whose security <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00384         being adjusted.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to update security quota
00385         information.
00386 
00387     SecurityInformation - Indicates which security information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00388         to be applied to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.  The value(s) to be assigned are
00389         passed in the SecurityDescriptor parameter.
00390 
00391     ModificationDescriptor - Supplies the input security descriptor to be
00392         applied to the object.  The caller of this routine is expected
00393         to probe and capture the passed security descriptor before calling
00394         and release it after calling.
00395 
00396     ObjectsSecurityDescriptor - Supplies the address of a pointer to
00397         the objects security descriptor that is going to be altered by
00398         this procedure.  This structure must be deallocated by the caller.
00399 
00400     PoolType - Specifies the type of pool to allocate for the objects
00401         security descriptor.
00402 
00403     GenericMapping - This argument provides the mapping of generic to
00404         specific/standard access types for the object being accessed.
00405         This mapping structure is expected to be safe to access
00406         (i.e., captured if necessary) prior to be passed to this routine.
00407 
00408 Return Value:
00409 
00410     NTSTATUS - STATUS_SUCCESS if successful and an appropriate error
00411         value otherwise.
00412 
00413 --*/
00414 
00415 {
00416 
00417 
00418 
00419     <span class="comment">//</span>
00420     <span class="comment">// Make sure the object already has a security descriptor.</span>
00421     <span class="comment">// Objects that 'may' have security descriptors 'must' have security</span>
00422     <span class="comment">// descriptors.  If this one doesn't already have one, then we can't</span>
00423     <span class="comment">// assign one to it.</span>
00424     <span class="comment">//</span>
00425 
00426     <span class="keywordflow">if</span> ((*ObjectsSecurityDescriptor) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00427         <span class="keywordflow">return</span>(STATUS_NO_SECURITY_ON_OBJECT);
00428     }
00429 
00430 
00431     <span class="comment">//</span>
00432     <span class="comment">// Pass this call to the common Rtlp routine.</span>
00433     <span class="comment">//</span>
00434 
00435     <span class="keywordflow">return</span> <a class="code" href="../../d8/d6/sertl_8c.html#a77">RtlpSetSecurityObject</a> (
00436                     Object,
00437                     *SecurityInformation,
00438                     ModificationDescriptor,
00439                     ObjectsSecurityDescriptor,
00440                     0,  <span class="comment">// No Auto Inheritance</span>
00441                     PoolType,
00442                     GenericMapping,
00443                     NULL ); <span class="comment">// No Token</span>
00444 
00445 
00446 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a179" doxytag="se.h::SeSetSecurityDescriptorInfoEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeSetSecurityDescriptorInfoEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID Object&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>ModificationDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectsSecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>AutoInheritFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d5/semethod_8c-source.html#l00452">452</a> of file <a class="el" href="../../d1/d5/semethod_8c-source.html">semethod.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>.
<p>
<pre class="fragment"><div>00464                    :
00465 
00466     This routine will set an object's security descriptor.  The input
00467     security descriptor must be previously captured.
00468 
00469 Arguments:
00470 
00471     Object - Optionally supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object whose security <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00472         being adjusted.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to update security quota
00473         information.
00474 
00475     SecurityInformation - Indicates which security information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00476         to be applied to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.  The value(s) to be assigned are
00477         passed in the SecurityDescriptor parameter.
00478 
00479     ModificationDescriptor - Supplies the input security descriptor to be
00480         applied to the object.  The caller of this routine is expected
00481         to probe and capture the passed security descriptor before calling
00482         and release it after calling.
00483 
00484     ObjectsSecurityDescriptor - Supplies the address of a pointer to
00485         the objects security descriptor that is going to be altered by
00486         this procedure.  This structure must be deallocated by the caller.
00487 
00488     AutoInheritFlags - Controls automatic inheritance of ACES.
00489         Valid values are a bits mask of the logical OR of
00490         one or more of the following bits:
00491 
00492         SEF_DACL_AUTO_INHERIT - If set, inherited ACEs from the
00493             DACL in the ObjectsSecurityDescriptor are preserved and inherited ACEs from
00494             the ModificationDescriptor are ignored. Inherited ACEs are not supposed
00495             to be modified; so preserving them across this call is appropriate.
00496             If a protected server does not itself implement auto inheritance, it should
00497             not set this bit.  The caller of the protected server may implement
00498             auto inheritance and my indeed be modifying inherited ACEs.
00499 
00500         SEF_SACL_AUTO_INHERIT - If set, inherited ACEs from the
00501             SACL in the ObjectsSecurityDescriptor are preserved and inherited ACEs from
00502             the ModificationDescriptor are ignored. Inherited ACEs are not supposed
00503             to be modified; so preserving them across this call is appropriate.
00504             If a protected server does not itself implement auto inheritance, it should
00505             not set this bit.  The caller of the protected server may implement
00506             auto inheritance and my indeed be modifying inherited ACEs.
00507 
00508     PoolType - Specifies the type of pool to allocate for the objects
00509         security descriptor.
00510 
00511     GenericMapping - This argument provides the mapping of generic to
00512         specific/standard access types for the object being accessed.
00513         This mapping structure is expected to be safe to access
00514         (i.e., captured if necessary) prior to be passed to this routine.
00515 
00516 Return Value:
00517 
00518     NTSTATUS - STATUS_SUCCESS if successful and an appropriate error
00519         value otherwise.
00520 
00521 --*/
00522 
00523 {
00524 
00525 
00526 
00527     <span class="comment">//</span>
00528     <span class="comment">// Make sure the object already has a security descriptor.</span>
00529     <span class="comment">// Objects that 'may' have security descriptors 'must' have security</span>
00530     <span class="comment">// descriptors.  If this one doesn't already have one, then we can't</span>
00531     <span class="comment">// assign one to it.</span>
00532     <span class="comment">//</span>
00533 
00534     <span class="keywordflow">if</span> ((*ObjectsSecurityDescriptor) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00535         <span class="keywordflow">return</span>(STATUS_NO_SECURITY_ON_OBJECT);
00536     }
00537 
00538 
00539     <span class="comment">//</span>
00540     <span class="comment">// Pass this call to the common Rtlp routine.</span>
00541     <span class="comment">//</span>
00542 
00543     <span class="keywordflow">return</span> <a class="code" href="../../d8/d6/sertl_8c.html#a77">RtlpSetSecurityObject</a> (
00544                     Object,
00545                     *SecurityInformation,
00546                     ModificationDescriptor,
00547                     ObjectsSecurityDescriptor,
00548                     AutoInheritFlags,
00549                     PoolType,
00550                     GenericMapping,
00551                     NULL ); <span class="comment">// No Token</span>
00552 
00553 
00554 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a168" doxytag="se.h::SeSetSessionIdToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeSetSessionIdToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN&nbsp;</td>
          <td class="mdname" nowrap> <em>PACCESS_TOKEN</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SessionId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a183" doxytag="se.h::SeSinglePrivilegeCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN SeSinglePrivilegeCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LUID&nbsp;</td>
          <td class="mdname" nowrap> <em>PrivilegeValue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d3/privileg_8c-source.html#l00436">436</a> of file <a class="el" href="../../d9/d3/privileg_8c-source.html">privileg.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, <a class="el" href="../../d0/d5/se_8h.html#a21">SECURITY_SUBJECT_CONTEXT</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00158">SePrivilegeCheck()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00989">SePrivilegedServiceAuditAlarm()</a>, and <a class="el" href="../../d1/d7/subject_8c-source.html#l00196">SeReleaseSubjectContext()</a>.
<p>
Referenced by <a class="el" href="../../d3/d1/cmparse_8c-source.html#l00963">CmpDoOpen()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l00731">CmpRefreshHive()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00349">ExpRaiseHardError()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l00970">NtAllocateUserPhysicalPages()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l00297">NtCreatePagingFile()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00199">NtCreateProfile()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00035">NtLoadDriver()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02881">NtLoadKey2()</a>, <a class="el" href="../../d4/d4/lockvm_8c-source.html#l00033">NtLockVirtualMemory()</a>, <a class="el" href="../../d8/d0/psopen_8c-source.html#l00030">NtOpenProcess()</a>, <a class="el" href="../../d8/d0/psopen_8c-source.html#l00280">NtOpenThread()</a>, <a class="el" href="../../d6/d7/sysenv_8c-source.html#l00045">NtQuerySystemEnvironmentValue()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00941">NtQuerySystemInformation()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03336">NtReplaceKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02348">NtRestoreKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02471">NtSaveKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02559">NtSaveMergedKeys()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00886">NtSetDefaultHardErrorPort()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00037">NtSetInformationToken()</a>, <a class="el" href="../../d6/d7/sysenv_8c-source.html#l00305">NtSetSystemEnvironmentValue()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, <a class="el" href="../../d3/d2/dbgctrl_8c-source.html#l00036">NtSystemDebugControl()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00244">NtUnloadDriver()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03093">NtUnloadKey()</a>, <a class="el" href="../../d4/d4/lockvm_8c-source.html#l00605">NtUnlockVirtualMemory()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00055">ObCreateObject()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01211">PspSetQuotaLimits()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00381">SepValidOwnerSubjectContext()</a>, and <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01271">UdfInvalidateVolumes()</a>.
<p>
<pre class="fragment"><div>00443                    :
00444 
00445     This function will check <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed privilege value in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00446     current context.
00447 
00448 Arguments:
00449 
00450     PrivilegeValue - The value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege being checked.
00451 
00452 
00453 Return Value:
00454 
00455     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The current subject has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired privilege.
00456 
00457     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - The current subject does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired privilege.
00458 --*/
00459 
00460 {
00461     BOOLEAN AccessGranted;
00462     PRIVILEGE_SET RequiredPrivileges;
00463     <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext;
00464 
00465     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00466 
00467     <span class="comment">//</span>
00468     <span class="comment">// Make sure the caller has the privilege to make this</span>
00469     <span class="comment">// call.</span>
00470     <span class="comment">//</span>
00471 
00472     RequiredPrivileges.PrivilegeCount = 1;
00473     RequiredPrivileges.Control = PRIVILEGE_SET_ALL_NECESSARY;
00474     RequiredPrivileges.Privilege[0].Luid = PrivilegeValue;
00475     RequiredPrivileges.Privilege[0].Attributes = 0;
00476 
00477     <a class="code" href="../../d0/d8/subject_8c.html#a0">SeCaptureSubjectContext</a>( &amp;SubjectSecurityContext );
00478 
00479     AccessGranted = <a class="code" href="../../d8/d4/privileg_8c.html#a1">SePrivilegeCheck</a>(
00480                         &amp;RequiredPrivileges,
00481                         &amp;SubjectSecurityContext,
00482                         PreviousMode
00483                         );
00484 
00485     <span class="keywordflow">if</span> ( PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a> ) {
00486 
00487         <a class="code" href="../../d3/d5/seaudit_8c.html#a15">SePrivilegedServiceAuditAlarm</a> (
00488             NULL,                              <span class="comment">// BUGWARNING need service name</span>
00489             &amp;SubjectSecurityContext,
00490             &amp;RequiredPrivileges,
00491             AccessGranted
00492             );
00493     }
00494 
00495 
00496     <a class="code" href="../../d0/d8/subject_8c.html#a3">SeReleaseSubjectContext</a>( &amp;SubjectSecurityContext );
00497 
00498     <span class="keywordflow">return</span>( AccessGranted );
00499 
00500 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a160" doxytag="se.h::SeSubProcessToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeSubProcessToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ParentProcess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACCESS_TOKEN *&nbsp;</td>
          <td class="mdname" nowrap> <em>ChildToken</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l01327">1327</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00130">PrimaryTokenAttributes</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00810">PsDereferencePrimaryToken</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00028">PsReferencePrimaryToken()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00362">SepDuplicateToken()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01117">PspInitializeProcessSecurity()</a>.
<p>
<pre class="fragment"><div>01334                    :
01335 
01336     This routine makes a token <span class="keywordflow">for</span> a sub-process that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a duplicate
01337     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent process's token.
01338 
01339 
01340 
01341 Parameters:
01342 
01343     ParentProcess - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent process object.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used
01344         to locate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent process's primary token, and <span class="keywordflow">for</span> logging
01345         purposes.
01346 
01347     ChildToken - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> child process's token.
01348 
01349 Return Value:
01350 
01351     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sub-process's token has been created
01352         successfully.
01353 
01354     Other status values may be returned from memory allocation or object
01355     creation services used and typically indicate insufficient resources
01356     or quota on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requestor's part.
01357 
01358 
01359 
01360 --*/
01361 
01362 {
01363 
01364     <span class="comment">//</span>
01365     <span class="comment">//  NOTE:  THIS ROUTINE CAN BE MADE MUCH MORE EFFICIENT.</span>
01366     <span class="comment">//         IT IS DONE IN A BRUTE FORCE FASHION FOR THE LARGE_INTEGER</span>
01367     <span class="comment">//         BEING TO GET THINGS UP AND RUNNING.</span>
01368     <span class="comment">//</span>
01369     <span class="comment">//         THE PERFORMANCE OF THIS ROUTINE DIRECTLY IMPACTS</span>
01370     <span class="comment">//         THE PERFORMANCE OF SUB-PROCESS CREATION.</span>
01371     <span class="comment">//</span>
01372 
01373 
01374     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
01375     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> ParentToken;
01376     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> NewToken;
01377     HANDLE NewTokenHandle;
01378     OBJECT_ATTRIBUTES <a class="code" href="../../d6/d0/ctaccess_8c.html#a33">PrimaryTokenAttributes</a>;
01379 
01380     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> InsertedToken;
01381 
01382     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01383     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> IgnoreStatus;
01384 
01385     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01386 
01387     PreviousMode = KeGetPreviousMode();
01388 
01389     InitializeObjectAttributes(
01390         &amp;PrimaryTokenAttributes,
01391         NULL,
01392         0,
01393         NULL,
01394         NULL
01395         );
01396 
01397 <span class="preprocessor">#ifdef TOKEN_DEBUG</span>
01398 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\nCreating sub-process token...\n"</span>);
01399     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Parent token address = 0x%lx\n"</span>, ParentProcess-&gt;Token);
01400 <span class="preprocessor">#endif //TOKEN_DEBUG</span>
01401 <span class="preprocessor"></span>
01402     ParentToken = (<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)<a class="code" href="../../d6/d5/ps_2security_8c.html#a0">PsReferencePrimaryToken</a>( ParentProcess );
01403 
01404     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d3/tokenp_8h.html#a27">SepDuplicateToken</a>(
01405                 ParentToken,                         <span class="comment">// ExistingToken</span>
01406                 &amp;PrimaryTokenAttributes,             <span class="comment">// ObjectAttributes</span>
01407                 FALSE,                               <span class="comment">// EffectiveOnly</span>
01408                 TokenPrimary,                        <span class="comment">// TokenType</span>
01409                 (SECURITY_IMPERSONATION_LEVEL)0,     <span class="comment">// ImpersonationLevel</span>
01410                 KernelMode,                          <span class="comment">// RequestorMode</span>
01411                 &amp;NewToken                            <span class="comment">// NewToken</span>
01412                 );
01413 
01414     <a class="code" href="../../d1/d9/ps_8h.html#a24">PsDereferencePrimaryToken</a>( (PACCESS_TOKEN)ParentToken );
01415 
01416     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01417 
01418         <span class="comment">//</span>
01419         <span class="comment">// Insert the new token object, up its ref count, and then</span>
01420         <span class="comment">// delete the new handle.</span>
01421         <span class="comment">//</span>
01422 
01423         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d1/obinsert_8c.html#a0">ObInsertObject</a>(
01424                      NewToken,
01425                      NULL,
01426                      0,
01427                      1,             <span class="comment">// ObjectPointerBias</span>
01428                      (PVOID *)&amp;InsertedToken,
01429                      &amp;NewTokenHandle
01430                      );
01431 
01432         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01433 
01434             *ChildToken = InsertedToken;
01435             InsertedToken-&gt;TokenInUse = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01436             IgnoreStatus = ZwClose( NewTokenHandle );
01437 
01438             <span class="comment">//</span>
01439             <span class="comment">// At this point, either the token has a reference</span>
01440             <span class="comment">// outstanding (and no handles), or the reference</span>
01441             <span class="comment">// failed.  If the reference failed, the status will</span>
01442             <span class="comment">// be returned indicating why.</span>
01443             <span class="comment">//</span>
01444 
01445         } <span class="keywordflow">else</span> {
01446 
01447             <span class="comment">//</span>
01448             <span class="comment">// ObInsertObject dereferences the passed object if it</span>
01449             <span class="comment">// fails, so we don't have to do any cleanup on NewToken</span>
01450             <span class="comment">// here.</span>
01451             <span class="comment">//</span>
01452         }
01453     }
01454 
01455     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01456 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a157" doxytag="se.h::SeTokenImpersonationLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> SECURITY_IMPERSONATION_LEVEL SeTokenImpersonationLevel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Token</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l00211">211</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">PsAssignImpersonationToken()</a>.
<p>
<pre class="fragment"><div>00217                    :
00218 
00219     This function returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> impersonation level of a token.  The token
00220     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed to be a TokenImpersonation <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> token.
00221 
00222 
00223 Arguments:
00224 
00225     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token whose impersonation level <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be returned.
00226 
00227 Return Value:
00228 
00229     The token's impersonation level.
00230 
00231 --*/
00232 
00233 {
00234     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00235 
00236     <span class="keywordflow">return</span> ((<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>)-&gt;ImpersonationLevel;
00237 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a158" doxytag="se.h::SeTokenIsAdmin" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN SeTokenIsAdmin           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Token</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l00150">150</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d1/d4/se_8h-source.html#l00075">TOKEN_HAS_ADMIN_GROUP</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l00266">NtAssignProcessToJobObject()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">PsAssignImpersonationToken()</a>, and <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00650">PsImpersonateClient()</a>.
<p>
<pre class="fragment"><div>00156                    :
00157 
00158     Returns <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a member of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> local admin group.
00159 
00160 Arguments:
00161 
00162     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token.
00163 
00164 Return Value:
00165 
00166     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> local admin group
00167     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - no admin.
00168 
00169 --*/
00170 
00171 {
00172     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00173 
00174     <span class="keywordflow">return</span> ((((<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>)-&gt;TokenFlags &amp; <a class="code" href="../../d0/d5/se_8h.html#a4">TOKEN_HAS_ADMIN_GROUP</a>) != 0 );
00175 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a159" doxytag="se.h::SeTokenIsRestricted" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN SeTokenIsRestricted           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Token</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l00181">181</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d1/d4/se_8h-source.html#l00076">TOKEN_IS_RESTRICTED</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/ex_8c-source.html#l00095">IsRestricted()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">PsAssignImpersonationToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00650">PsImpersonateClient()</a>, and <a class="el" href="../../d1/d3/accessck_8c-source.html#l01564">SepAccessCheck()</a>.
<p>
<pre class="fragment"><div>00187                    :
00188 
00189     Returns <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a restricted token.
00190 
00191 Arguments:
00192 
00193     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token.
00194 
00195 Return Value:
00196 
00197     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> contains restricted sids
00198     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - no admin.
00199 
00200 --*/
00201 
00202 {
00203     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00204 
00205     <span class="keywordflow">return</span> ((((<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>)-&gt;TokenFlags &amp; <a class="code" href="../../d0/d5/se_8h.html#a5">TOKEN_IS_RESTRICTED</a>) != 0 );
00206 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a156" doxytag="se.h::SeTokenType" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI TOKEN_TYPE SeTokenType           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Token</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d5/d2/token_8c-source.html#l00118">118</a> of file <a class="el" href="../../d5/d2/token_8c-source.html">token.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">PsAssignImpersonationToken()</a>.
<p>
<pre class="fragment"><div>00124                    :
00125 
00126     This function returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of an instance of a token (TokenPrimary,
00127     or TokenImpersonation).
00128 
00129 
00130 Arguments:
00131 
00132     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token whose <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be returned.
00133 
00134 Return Value:
00135 
00136     The token's <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
00137 
00138 --*/
00139 
00140 {
00141     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00142 
00143     <span class="keywordflow">return</span> (((<a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a>)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>)-&gt;TokenType);
00144 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a145" doxytag="se.h::SeTraverseAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SeTraverseAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID&nbsp;</td>
          <td class="mdname" nowrap> <em>OperationID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>DirectoryObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectSecurityContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContextLocked</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>TraverseAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET Privileges&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03429">3429</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d1/d4/se_8h-source.html#l00297">_SE_AUDITING_STATE::AuditOnFailure</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00296">_SE_AUDITING_STATE::AuditOnSuccess</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00165">EffectiveToken</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01702">SeAuditingState</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00115">SeLockSubjectContext()</a>, <a class="el" href="../../d1/d5/adtp_8h.html#a20">SepAdtTraverseAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03952">SepExamineSacl()</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00183">SepTokenAuthenticationId</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00176">SepTokenUserSid</a>, and <a class="el" href="../../d1/d7/subject_8c-source.html#l00159">SeUnlockSubjectContext()</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>.
<p>
<pre class="fragment"><div>03442                    :
03443 
03444     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to audit directory traverse operations
03445     specifically.  It should be called by parse procedures as they traverse
03446     directories as part of their operation.
03447 
03448 Arguments:
03449 
03450     OperationID - LUID identifying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation in progress
03451 
03452     DirectoryObject - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> directory being traversed.
03453 
03454     SecurityDescriptor - The security descriptor (<span class="keywordflow">if</span> any) attached to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03455         directory being traversed.
03456 
03457     SubjectSecurityContext - Security context of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client.
03458 
03459     SubjectContextLocked - Supplies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SubjectContext <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> locked
03460         <span class="keywordflow">for</span> shared access.
03461 
03462     TraverseAccess - Mask to indicate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> traverse access <span class="keywordflow">for</span> <span class="keyword">this</span> object
03463         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
03464 
03465     Privileges - Optional parameter to indicate any privilges that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
03466         subject may have used to gain access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.
03467 
03468     AccessGranted - Indicates <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was granted or denied based on
03469         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access check or privilege check.
03470 
03471     AccessMode - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access mode used <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access check.  One
03472         of <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a> or <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>.  Messages will not be generated by
03473         kernel mode accesses.
03474 
03475 Return value:
03476 
03477     None.
03478 
03479 --*/
03480 
03481 {
03482     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03483 
03484 <span class="preprocessor">#if 0</span>
03485 <span class="preprocessor"></span>    BOOLEAN GenerateAudit = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03486     BOOLEAN GenerateAlarm = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03487 
03488     <span class="keywordflow">if</span> (AccessMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
03489         <span class="keywordflow">return</span>;
03490     }
03491 
03492     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/se_8h.html#a105">SeAuditingState</a>[AuditEventTraverse].<a class="code" href="../../d1/d0/struct__SE__AUDITING__STATE.html#o0">AuditOnSuccess</a> &amp;&amp; AccessGranted) ||
03493          <a class="code" href="../../d0/d5/se_8h.html#a105">SeAuditingState</a>[AuditEventTraverse].<a class="code" href="../../d1/d0/struct__SE__AUDITING__STATE.html#o1">AuditOnFailure</a> &amp;&amp; !AccessGranted) {
03494 
03495         <span class="keywordflow">if</span> ( SecurityDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
03496 
03497             <span class="keywordflow">if</span> ( !SubjectContextLocked ) {
03498                 <a class="code" href="../../d0/d8/subject_8c.html#a1">SeLockSubjectContext</a>( SubjectSecurityContext );
03499             }
03500 
03501             <a class="code" href="../../d6/d6/sep_8h.html#a62">SepExamineSacl</a>(
03502                 RtlpSaclAddrSecurityDescriptor( (PISECURITY_DESCRIPTOR)SecurityDescriptor ),
03503                 <a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( SubjectSecurityContext ),
03504                 TraverseAccess,
03505                 AccessGranted,
03506                 &amp;GenerateAudit,
03507                 &amp;GenerateAlarm
03508                 );
03509 
03510             <span class="keywordflow">if</span> (GenerateAudit || GenerateAlarm) {
03511 
03512                 <a class="code" href="../../d1/d5/adtp_8h.html#a20">SepAdtTraverseAuditAlarm</a>(
03513                     OperationID,
03514                     DirectoryObject,
03515                     <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>(<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( SubjectSecurityContext )),
03516                     <a class="code" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>(<a class="code" href="../../d6/d6/sep_8h.html#a7">EffectiveToken</a>( SubjectSecurityContext )),
03517                     TraverseAccess,
03518                     Privileges,
03519                     AccessGranted,
03520                     GenerateAudit,
03521                     GenerateAlarm
03522                     );
03523             }
03524 
03525             <span class="keywordflow">if</span> ( !SubjectContextLocked ) {
03526                 <a class="code" href="../../d0/d8/subject_8c.html#a2">SeUnlockSubjectContext</a>( SubjectSecurityContext );
03527             }
03528         }
03529     }
03530 
03531 <span class="preprocessor">#endif</span>
03532 <span class="preprocessor"></span>
03533     <span class="keywordflow">return</span>;
03534 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a120" doxytag="se.h::SeUnlockSubjectContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID SeUnlockSubjectContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SubjectContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d7/subject_8c-source.html#l00159">159</a> of file <a class="el" href="../../d1/d7/subject_8c-source.html">subject.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, and <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00419">SepReleaseTokenReadLock</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/cmse_8c-source.html#l00917">CmpCheckCreateAccess()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l01032">CmpCheckNotifyAccess()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00593">IsPrivileged()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00983">ObCheckCreateObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00392">ObCheckObjectAccess()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00602">ObpCheckObjectReference()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l00778">ObpCheckTraverseAccess()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00529">SeQueryAuthenticationIdSubjectContext()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03429">SeTraverseAuditAlarm()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00165                    :
00166 
00167     Releases <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> read locks on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token(s) in the passed SubjectContext.
00168 
00169 Arguments:
00170 
00171     SubjectContext - Points to a <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> data structure
00172         which points to a primary token and an optional impersonation token.
00173 
00174 Return Value:
00175 
00176     None
00177 
00178 --*/
00179 
00180 {
00181     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00182 
00183     <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>((PTOKEN)(SubjectContext-&gt;PrimaryToken));
00184 
00185     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(SubjectContext-&gt;ClientToken)) {
00186 
00187         <a class="code" href="../../d8/d3/tokenp_8h.html#a8">SepReleaseTokenReadLock</a>((PTOKEN)(SubjectContext-&gt;ClientToken));
00188     }
00189 
00190 
00191 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a194" doxytag="se.h::SeUnregisterLogonSessionTerminatedRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS SeUnregisterLogonSessionTerminatedRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d5/se_8h.html#a35">PSE_LOGON_SESSION_TERMINATED_ROUTINE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CallbackRoutine</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00908">908</a> of file <a class="el" href="../../d0/d9/rmlogon_8c-source.html">rmlogon.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00146">_SEP_LOGON_SESSION_TERMINATED_NOTIFICATION::Next</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00038">SeFileSystemNotifyRoutinesHead</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00060">SepRmAcquireDbWriteLock</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00066">SepRmReleaseDbWriteLock</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00914                    :
00915 
00916     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dual of <a class="code" href="../../d0/d5/se_8h.html#a193">SeRegisterLogonSessionTerminatedRoutine</a>. <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a> System
00917     *MUST* call <span class="keyword">this</span> before <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> unloaded.
00918 
00919 Arguments:
00920 
00921     CallbackRoutine - Address of routine that was originally passed in to
00922         <a class="code" href="../../d0/d5/se_8h.html#a193">SeRegisterLogonSessionTerminatedRoutine</a>.
00923 
00924 Return Value:
00925 
00926     STATUS_SUCCESS - Successfully removed callback routine
00927 
00928     STATUS_INVALID_PARAMETER - CallbackRoutine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00929 
00930     STATUS_NOT_FOUND - Didn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> find and entry <span class="keywordflow">for</span> CallbackRoutine
00931 
00932 --*/
00933 {
00934     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00935     <a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">PSEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a> PreviousEntry;
00936     <a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">PSEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a> NotifyEntry;
00937 
00938     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00939 
00940     <span class="keywordflow">if</span> (CallbackRoutine == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00941         <span class="keywordflow">return</span>( STATUS_INVALID_PARAMETER );
00942     }
00943 
00944     <a class="code" href="../../d1/d0/rmp_8h.html#a3">SepRmAcquireDbWriteLock</a>();
00945 
00946     <span class="keywordflow">for</span> (PreviousEntry = &amp;<a class="code" href="../../d9/d9/rmlogon_8c.html#a1">SeFileSystemNotifyRoutinesHead</a>,
00947             NotifyEntry = <a class="code" href="../../d9/d9/rmlogon_8c.html#a1">SeFileSystemNotifyRoutinesHead</a>.<a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html#o0">Next</a>;
00948                 NotifyEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00949                     PreviousEntry = NotifyEntry,
00950                         NotifyEntry = NotifyEntry-&gt;<a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html#o0">Next</a>) {
00951 
00952          <span class="keywordflow">if</span> (NotifyEntry-&gt;CallbackRoutine == CallbackRoutine)
00953              <span class="keywordflow">break</span>;
00954 
00955     }
00956 
00957     <span class="keywordflow">if</span> (NotifyEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00958 
00959         PreviousEntry-&gt;<a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html#o0">Next</a> = NotifyEntry-&gt;<a class="code" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html#o0">Next</a>;
00960 
00961         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( NotifyEntry );
00962 
00963         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00964 
00965     } <span class="keywordflow">else</span> {
00966 
00967         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NOT_FOUND;
00968 
00969     }
00970 
00971     <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00972 
00973     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00974 
00975 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a175" doxytag="se.h::SeUpdateClientSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeUpdateClientSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d8/d0/struct__SECURITY__CLIENT__CONTEXT.html">PSECURITY_CLIENT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ChangesMade</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>NewToken</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a151" doxytag="se.h::SeValidSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI BOOLEAN SeValidSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l02414">2414</a> of file <a class="el" href="../../d3/d4/se_2capture_8c-source.html">se/capture.c</a>.
<p>
References <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00161">Dacl</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l00056">LongAligned</a>, <a class="el" href="../../d3/d3/acledit_8c-source.html#l00187">RtlValidAcl()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00540">SeLengthSid</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d3/d9/cmchek2_8c-source.html#l00034">CmpValidateHiveSecurityDescriptors()</a>.
<p>
<pre class="fragment"><div>02421                    :
02422 
02423     Validates a security descriptor <span class="keywordflow">for</span> structural correctness.  The idea <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to make
02424     sure that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor may be passed to other kernel callers, without
02425     fear that they're going to choke <span class="keywordflow">while</span> manipulating <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
02426 
02427     This routine does not enforce policy (e.g., ACL/ACE revision information).  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
02428     entirely possible <span class="keywordflow">for</span> a security descriptor to be approved by <span class="keyword">this</span> routine, <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a>
02429     to be later found to be invalid by some later routine.
02430 
02431     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> designed to be used by callers who have a security descriptor in
02432     kernel memory.  Callers wishing to validate a security descriptor passed from user
02433     mode should call <a class="code" href="../../d8/d6/sertl_8c.html#a55">RtlValidSecurityDescriptor</a>.
02434 
02435 Arguments:
02436 
02437     Length - Length in bytes of passed Security Descriptor.
02438 
02439     SecurityDescriptor - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Security Descriptor (in kernel memory) to be
02440         validatated.
02441 
02442 Return Value:
02443 
02444     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - The passed security descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> correctly structured
02445     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - The passed security descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> badly formed
02446 
02447 --*/
02448 
02449 {
02450     PISECURITY_DESCRIPTOR_RELATIVE ISecurityDescriptor =
02451         (PISECURITY_DESCRIPTOR_RELATIVE)SecurityDescriptor;
02452     PISID OwnerSid;
02453     PISID GroupSid;
02454     PACE_HEADER Ace;
02455     PISID Sid;
02456     PISID Sid2;
02457     PACL <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>;
02458     PACL Sacl;
02459     ULONG i;
02460 
02461     <span class="keywordflow">if</span> (Length &lt; <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE)) {
02462         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02463     }
02464 
02465     <span class="comment">//</span>
02466     <span class="comment">// Check the revision information.</span>
02467     <span class="comment">//</span>
02468 
02469     <span class="keywordflow">if</span> (ISecurityDescriptor-&gt;Revision != SECURITY_DESCRIPTOR_REVISION) {
02470         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02471     }
02472 
02473     <span class="comment">//</span>
02474     <span class="comment">// Make sure the passed SecurityDescriptor is in self-relative form</span>
02475     <span class="comment">//</span>
02476 
02477     <span class="keywordflow">if</span> (!(ISecurityDescriptor-&gt;Control &amp; SE_SELF_RELATIVE)) {
02478         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02479     }
02480 
02481     <span class="comment">//</span>
02482     <span class="comment">// Check the owner.  A valid SecurityDescriptor must have an owner.</span>
02483     <span class="comment">// It must also be long aligned.</span>
02484     <span class="comment">//</span>
02485 
02486     <span class="keywordflow">if</span> ((ISecurityDescriptor-&gt;Owner == 0) ||
02487         (!<a class="code" href="../../d2/d4/acledit_8c.html#a2">LongAligned</a>((PVOID)(ULONG_PTR)(ULONG)ISecurityDescriptor-&gt;Owner)) ||
02488         (ISecurityDescriptor-&gt;Owner &gt; Length) ||
02489         (Length - ISecurityDescriptor-&gt;Owner &lt; <span class="keyword">sizeof</span>(SID))) {
02490 
02491         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02492     }
02493 
02494     <span class="comment">//</span>
02495     <span class="comment">// It is safe to reference the owner's SubAuthorityCount, compute the</span>
02496     <span class="comment">// expected length of the SID</span>
02497     <span class="comment">//</span>
02498 
02499     OwnerSid = (PSID)RtlOffsetToPointer( ISecurityDescriptor, ISecurityDescriptor-&gt;Owner );
02500 
02501     <span class="keywordflow">if</span> (OwnerSid-&gt;Revision != SID_REVISION) {
02502         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02503     }
02504 
02505     <span class="keywordflow">if</span> (OwnerSid-&gt;SubAuthorityCount &gt; SID_MAX_SUB_AUTHORITIES) {
02506         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02507     }
02508 
02509     <span class="keywordflow">if</span> (Length - ISecurityDescriptor-&gt;Owner &lt; (ULONG) <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>(OwnerSid)) {
02510         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02511     }
02512 
02513     <span class="comment">//</span>
02514     <span class="comment">// The owner appears to be a structurally valid SID that lies within</span>
02515     <span class="comment">// the bounds of the security descriptor.  Do the same for the Group</span>
02516     <span class="comment">// if there is one.</span>
02517     <span class="comment">//</span>
02518 
02519     <span class="keywordflow">if</span> (ISecurityDescriptor-&gt;Group != 0) {
02520 
02521         <span class="comment">//</span>
02522         <span class="comment">// Check alignment</span>
02523         <span class="comment">//</span>
02524 
02525         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d4/acledit_8c.html#a2">LongAligned</a>( (PVOID)(ULONG_PTR)(ULONG)ISecurityDescriptor-&gt;Group)) {
02526             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02527         }
02528 
02529         <span class="keywordflow">if</span> (ISecurityDescriptor-&gt;Group &gt; Length) {
02530             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02531         }
02532 
02533         <span class="keywordflow">if</span> (Length - ISecurityDescriptor-&gt;Group &lt; <span class="keyword">sizeof</span> (SID)) {
02534             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02535         }
02536 
02537         <span class="comment">//</span>
02538         <span class="comment">// It is safe to reference the Group's SubAuthorityCount, compute the</span>
02539         <span class="comment">// expected length of the SID</span>
02540         <span class="comment">//</span>
02541 
02542         GroupSid = (PSID)RtlOffsetToPointer( ISecurityDescriptor, ISecurityDescriptor-&gt;Group );
02543 
02544         <span class="keywordflow">if</span> (GroupSid-&gt;Revision != SID_REVISION) {
02545             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02546         }
02547 
02548         <span class="keywordflow">if</span> (GroupSid-&gt;SubAuthorityCount &gt; SID_MAX_SUB_AUTHORITIES) {
02549             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02550         }
02551 
02552         <span class="keywordflow">if</span> (Length - ISecurityDescriptor-&gt;Group &lt; (ULONG) <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>(GroupSid)) {
02553             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02554         }
02555     }
02556 
02557     <span class="comment">//</span>
02558     <span class="comment">// Validate the DACL.  A structurally valid SecurityDescriptor may not necessarily</span>
02559     <span class="comment">// have a DACL.</span>
02560     <span class="comment">//</span>
02561 
02562     <span class="keywordflow">if</span> (ISecurityDescriptor-&gt;Dacl != 0) {
02563 
02564         <span class="comment">//</span>
02565         <span class="comment">// Check alignment</span>
02566         <span class="comment">//</span>
02567 
02568         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d4/acledit_8c.html#a2">LongAligned</a>( (PVOID)(ULONG_PTR)(ULONG)ISecurityDescriptor-&gt;Dacl)) {
02569             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02570         }
02571 
02572         <span class="comment">//</span>
02573         <span class="comment">// Make sure the DACL structure is within the bounds of the security descriptor.</span>
02574         <span class="comment">//</span>
02575 
02576         <span class="keywordflow">if</span> ((ISecurityDescriptor-&gt;Dacl &gt; Length) ||
02577             (Length - ISecurityDescriptor-&gt;Dacl &lt; <span class="keyword">sizeof</span>(ACL))) {
02578             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02579         }
02580 
02581         <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> = (PACL) RtlOffsetToPointer( ISecurityDescriptor, ISecurityDescriptor-&gt;Dacl );
02582 
02583 
02584         <span class="comment">//</span>
02585         <span class="comment">// Make sure the DACL length fits within the bounds of the security descriptor.</span>
02586         <span class="comment">//</span>
02587 
02588         <span class="keywordflow">if</span> (Length - ISecurityDescriptor-&gt;Dacl &lt; <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>-&gt;AclSize) {
02589             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02590         }
02591 
02592         <span class="comment">//</span>
02593         <span class="comment">// Make sure the ACL is structurally valid.</span>
02594         <span class="comment">//</span>
02595 
02596         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d4/acledit_8c.html#a7">RtlValidAcl</a>( Dacl )) {
02597             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02598         }
02599     }
02600 
02601     <span class="comment">//</span>
02602     <span class="comment">// Validate the SACL.  A structurally valid SecurityDescriptor may not</span>
02603     <span class="comment">// have a SACL.</span>
02604     <span class="comment">//</span>
02605 
02606     <span class="keywordflow">if</span> (ISecurityDescriptor-&gt;Sacl != 0) {
02607 
02608         <span class="comment">//</span>
02609         <span class="comment">// Check alignment</span>
02610         <span class="comment">//</span>
02611 
02612         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d4/acledit_8c.html#a2">LongAligned</a>( (PVOID)(ULONG_PTR)(ULONG)ISecurityDescriptor-&gt;Sacl)) {
02613             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02614         }
02615 
02616         <span class="comment">//</span>
02617         <span class="comment">// Make sure the SACL structure is within the bounds of the security descriptor.</span>
02618         <span class="comment">//</span>
02619 
02620         <span class="keywordflow">if</span> ((ISecurityDescriptor-&gt;Sacl &gt; Length) ||
02621             (Length - ISecurityDescriptor-&gt;Sacl &lt; <span class="keyword">sizeof</span>(ACL))) {
02622             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02623         }
02624 
02625         <span class="comment">//</span>
02626         <span class="comment">// Make sure the Sacl structure is within the bounds of the security descriptor.</span>
02627         <span class="comment">//</span>
02628 
02629         Sacl = (PACL)RtlOffsetToPointer( ISecurityDescriptor, ISecurityDescriptor-&gt;Sacl );
02630 
02631 
02632         <span class="keywordflow">if</span> (Length - ISecurityDescriptor-&gt;Sacl &lt; Sacl-&gt;AclSize) {
02633             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02634         }
02635 
02636         <span class="comment">//</span>
02637         <span class="comment">// Make sure the ACL is structurally valid.</span>
02638         <span class="comment">//</span>
02639 
02640         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d4/acledit_8c.html#a7">RtlValidAcl</a>( Sacl )) {
02641             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02642         }
02643     }
02644 
02645     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
02646 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a62" doxytag="se.h::SeAliasAccountOpsSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a24">SeAliasAccountOpsSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01636">1636</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a56" doxytag="se.h::SeAliasAdminsSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a19">SeAliasAdminsSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01630">1630</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d8/arcsec_8c-source.html#l00168">IopApplySystemPartitionProt()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12098">IopCreateDefaultDeviceSecurityDescriptor()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l08501">IopOpenDeviceParametersSubkey()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l01545">ObpGetDosDevicesProtection()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l01010">SeMakeAnonymousLogonToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00049">SepCreateImpersonationTokenDacl()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d0/d5/seinit_8c-source.html#l00184">SepInitializationPhase1()</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00806">SepMakeTokenEffectiveOnly()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01041">SepRemoveDisabledGroupsAndPrivileges()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a65" doxytag="se.h::SeAliasBackupOpsSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a27">SeAliasBackupOpsSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01639">1639</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a60" doxytag="se.h::SeAliasGuestsSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a22">SeAliasGuestsSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01634">1634</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a61" doxytag="se.h::SeAliasPowerUsersSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a23">SeAliasPowerUsersSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01635">1635</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a64" doxytag="se.h::SeAliasPrintOpsSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a26">SeAliasPrintOpsSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01638">1638</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a63" doxytag="se.h::SeAliasSystemOpsSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a25">SeAliasSystemOpsSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01637">1637</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a59" doxytag="se.h::SeAliasUsersSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a21">SeAliasUsersSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01633">1633</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="se.h::SeAnonymousAuthenticationId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a2">SeAnonymousAuthenticationId</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01600">1600</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l01010">SeMakeAnonymousLogonToken()</a>, and <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">SepRmDbInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a58" doxytag="se.h::SeAnonymousLogonSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a28">SeAnonymousLogonSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01632">1632</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l01010">SeMakeAnonymousLogonToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a66" doxytag="se.h::SeAnonymousLogonToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PACCESS_TOKEN <a class="el" href="../../d8/d5/seglobal_8c.html#a29">SeAnonymousLogonToken</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01645">1645</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l03038">NtImpersonateAnonymousToken()</a>, and <a class="el" href="../../d0/d5/seinit_8c-source.html#l00184">SepInitializationPhase1()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a80" doxytag="se.h::SeAssignPrimaryTokenPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a51">SeAssignPrimaryTokenPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01671">1671</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00366">PspSetPrimaryToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a105" doxytag="se.h::SeAuditingState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d0/struct__SE__AUDITING__STATE.html">SE_AUDITING_STATE</a> <a class="el" href="../../d8/d5/seglobal_8c.html#a88">SeAuditingState</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01702">1702</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/rmaudit_8c-source.html#l00051">SepRmSetAuditEventWrkr()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03429">SeTraverseAuditAlarm()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a98" doxytag="se.h::SeAuditPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a69">SeAuditPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01689">1689</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00199">SeCheckAuditPrivilege()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a55" doxytag="se.h::SeAuthenticatedUsersSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a18">SeAuthenticatedUsersSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01629">1629</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a94" doxytag="se.h::SeBackupPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a65">SeBackupPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01685">1685</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d1/cmparse_8c-source.html#l00963">CmpDoOpen()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l02048">IopCheckBackupRestorePrivilege()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02471">NtSaveKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02559">NtSaveMergedKeys()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="se.h::SeBatchSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a13">SeBatchSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01626">1626</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">SepSidTranslation()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a100" doxytag="se.h::SeChangeNotifyPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a71">SeChangeNotifyPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01691">1691</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l00819">SepAdjustPrivileges()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01041">SepRemoveDisabledGroupsAndPrivileges()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a88" doxytag="se.h::SeCreatePagefilePrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a59">SeCreatePagefilePrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01679">1679</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/modwrite_8c-source.html#l00297">NtCreatePagingFile()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00941">NtQuerySystemInformation()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a93" doxytag="se.h::SeCreatePermanentPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a64">SeCreatePermanentPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01684">1684</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00055">ObCreateObject()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a79" doxytag="se.h::SeCreateTokenPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a50">SeCreateTokenPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01670">1670</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="se.h::SeCreatorGroupServerSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a8">SeCreatorGroupServerSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01614">1614</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">SepSidTranslation()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="se.h::SeCreatorGroupSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a7">SeCreatorGroupSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01612">1612</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">SepSidTranslation()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="se.h::SeCreatorOwnerServerSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a9">SeCreatorOwnerServerSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01613">1613</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">SepSidTranslation()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="se.h::SeCreatorOwnerSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a6">SeCreatorOwnerSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01611">1611</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/obinit_8c-source.html#l01545">ObpGetDosDevicesProtection()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">SepSidTranslation()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a97" doxytag="se.h::SeDebugPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a68">SeDebugPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01688">1688</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/psopen_8c-source.html#l00030">NtOpenProcess()</a>, <a class="el" href="../../d8/d0/psopen_8c-source.html#l00280">NtOpenThread()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, <a class="el" href="../../d3/d2/dbgctrl_8c-source.html#l00036">NtSystemDebugControl()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a106" doxytag="se.h::SeDetailedAuditing" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d8/d5/seglobal_8c.html#a92">SeDetailedAuditing</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01709">1709</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00815">ObInitProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01363">PspProcessDelete()</a>, and <a class="el" href="../../d8/d8/rmaudit_8c-source.html#l00051">SepRmSetAuditEventWrkr()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a50" doxytag="se.h::SeDialupSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a11">SeDialupSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01624">1624</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a104" doxytag="se.h::SeEnableDelegationPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a75">SeEnableDelegationPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01695">1695</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="se.h::SeExports" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI <a class="el" href="../../d2/d0/struct__SE__EXPORTS.html">PSE_EXPORTS</a> <a class="el" href="../../d8/d5/seglobal_8c.html#a76">SeExports</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01590">1590</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00152">InitSecurity()</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l00551">SmbTraceStart()</a>, <a class="el" href="../../d3/d6/service_8c-source.html#l00025">xxxConnectService()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a89" doxytag="se.h::SeIncreaseBasePriorityPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a60">SeIncreaseBasePriorityPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01680">1680</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a82" doxytag="se.h::SeIncreaseQuotaPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a53">SeIncreaseQuotaPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01673">1673</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01211">PspSetQuotaLimits()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a53" doxytag="se.h::SeInteractiveSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a14">SeInteractiveSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01627">1627</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">SepSidTranslation()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a87" doxytag="se.h::SeLoadDriverPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a58">SeLoadDriverPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01678">1678</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00035">NtLoadDriver()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00244">NtUnloadDriver()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="se.h::SeLocalSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a5">SeLocalSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01610">1610</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">SepSidTranslation()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a54" doxytag="se.h::SeLocalSystemSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a17">SeLocalSystemSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01628">1628</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d8/arcsec_8c-source.html#l00168">IopApplySystemPartitionProt()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l01545">ObpGetDosDevicesProtection()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02717">SepAdtGenerateDiscardAudit()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00125">SepAdtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00049">SepCreateImpersonationTokenDacl()</a>, <a class="el" href="../../d0/d5/seinit_8c-source.html#l00184">SepInitializationPhase1()</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00989">SePrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">SepSidTranslation()</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>, and <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00060">SeRmInitPhase1()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a81" doxytag="se.h::SeLockMemoryPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a52">SeLockMemoryPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01672">1672</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/physical_8c-source.html#l00970">NtAllocateUserPhysicalPages()</a>, <a class="el" href="../../d4/d4/lockvm_8c-source.html#l00033">NtLockVirtualMemory()</a>, <a class="el" href="../../d4/d4/lockvm_8c-source.html#l00605">NtUnlockVirtualMemory()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a51" doxytag="se.h::SeNetworkSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a12">SeNetworkSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01625">1625</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">SepSidTranslation()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a49" doxytag="se.h::SeNtAuthoritySid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a10">SeNtAuthoritySid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01622">1622</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="se.h::SeNullSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a3">SeNullSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01608">1608</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="se.h::SePrincipalSelfSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a16">SePrincipalSelfSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01615">1615</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00933">SepSidInSidAndAttributes()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l00733">SepSidInToken()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l00856">SepSidInTokenEx()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a92" doxytag="se.h::SeProfileSingleProcessPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a63">SeProfileSingleProcessPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01683">1683</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="se.h::SepTokenObjectType" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">_OBJECT_TYPE</a>* <a class="el" href="../../d8/d3/tokenp_8h.html#a19">SepTokenObjectType</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01212">1212</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l00432">NtAdjustGroupsToken()</a>, <a class="el" href="../../d6/d2/tokenadj_8c-source.html#l00046">NtAdjustPrivilegesToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00046">NtDuplicateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01306">NtFilterToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l03038">NtImpersonateAnonymousToken()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00178">NtOpenProcessToken()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00458">NtOpenThreadToken()</a>, <a class="el" href="../../d9/d3/privileg_8c-source.html#l00231">NtPrivilegeCheck()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00731">NtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00406">NtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d0/d3/tokenqry_8c-source.html#l00034">NtQueryInformationToken()</a>, <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00037">NtSetInformationToken()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01634">SeFilterToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02867">SeIsChildToken()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00362">SepDuplicateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l01460">SepTokenInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a73" doxytag="se.h::SePublicDefaultDacl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PACL <a class="el" href="../../d8/d5/seglobal_8c.html#a42">SePublicDefaultDacl</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01658">1658</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a67" doxytag="se.h::SePublicDefaultSd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSECURITY_DESCRIPTOR <a class="el" href="../../d8/d5/seglobal_8c.html#a30">SePublicDefaultSd</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01651">1651</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00101">ExpInitializeCallbacks()</a>, <a class="el" href="../../d0/d5/seinit_8c-source.html#l00184">SepInitializationPhase1()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a74" doxytag="se.h::SePublicDefaultUnrestrictedDacl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PACL <a class="el" href="../../d8/d5/seglobal_8c.html#a43">SePublicDefaultUnrestrictedDacl</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01659">1659</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12098">IopCreateDefaultDeviceSecurityDescriptor()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">ObInitSystem()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a68" doxytag="se.h::SePublicDefaultUnrestrictedSd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSECURITY_DESCRIPTOR <a class="el" href="../../d8/d5/seglobal_8c.html#a32">SePublicDefaultUnrestrictedSd</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01652">1652</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05675">IoCreateSymbolicLink()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">ObInitSystem()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a75" doxytag="se.h::SePublicOpenDacl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PACL <a class="el" href="../../d8/d5/seglobal_8c.html#a44">SePublicOpenDacl</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01660">1660</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a69" doxytag="se.h::SePublicOpenSd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSECURITY_DESCRIPTOR <a class="el" href="../../d8/d5/seglobal_8c.html#a36">SePublicOpenSd</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01653">1653</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a76" doxytag="se.h::SePublicOpenUnrestrictedDacl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PACL <a class="el" href="../../d8/d5/seglobal_8c.html#a45">SePublicOpenUnrestrictedDacl</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01661">1661</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12098">IopCreateDefaultDeviceSecurityDescriptor()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a70" doxytag="se.h::SePublicOpenUnrestrictedSd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSECURITY_DESCRIPTOR <a class="el" href="../../d8/d5/seglobal_8c.html#a34">SePublicOpenUnrestrictedSd</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01654">1654</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a101" doxytag="se.h::SeRemoteShutdownPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a72">SeRemoteShutdownPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01692">1692</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a95" doxytag="se.h::SeRestorePrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a66">SeRestorePrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01686">1686</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d1/cmparse_8c-source.html#l00963">CmpDoOpen()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l02048">IopCheckBackupRestorePrivilege()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02881">NtLoadKey2()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03336">NtReplaceKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02348">NtRestoreKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03093">NtUnloadKey()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00381">SepValidOwnerSubjectContext()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a57" doxytag="se.h::SeRestrictedSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a20">SeRestrictedSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01631">1631</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00049">SepCreateImpersonationTokenDacl()</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a85" doxytag="se.h::SeSecurityPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a56">SeSecurityPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01676">1676</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01232">ObpIncrementHandleCount()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l01564">SepAccessCheck()</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l01019">SepInitializePrivilegeSets()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03652">SePrivilegePolicyCheck()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a96" doxytag="se.h::SeShutdownPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a67">SeShutdownPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01687">1687</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00349">ExpRaiseHardError()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a107" doxytag="se.h::SeSubsystemName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d8/d5/seglobal_8c.html#a93">SeSubsystemName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01711">1711</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03736">SeAuditHandleCreation()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02573">SeAuditHandleDuplication()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02466">SeAuditProcessCreation()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02653">SeAuditProcessExit()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03826">SeCloseObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03892">SeDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02765">SeOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03085">SeOpenObjectForDeleteAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02717">SepAdtGenerateDiscardAudit()</a>, <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00085">SepAdtInitializePhase1()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01907">SepAdtObjectReferenceAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00346">SepAdtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00989">SePrivilegedServiceAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00650">SePrivilegeObjectAuditAlarm()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a103" doxytag="se.h::SeSyncAgentPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a74">SeSyncAgentPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01694">1694</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="se.h::SeSystemAuthenticationId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a1">SeSystemAuthenticationId</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01599">1599</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">SepRmDbInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a77" doxytag="se.h::SeSystemDefaultDacl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PACL <a class="el" href="../../d8/d5/seglobal_8c.html#a46">SeSystemDefaultDacl</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01662">1662</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a71" doxytag="se.h::SeSystemDefaultSd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSECURITY_DESCRIPTOR <a class="el" href="../../d8/d5/seglobal_8c.html#a38">SeSystemDefaultSd</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01655">1655</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a99" doxytag="se.h::SeSystemEnvironmentPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a70">SeSystemEnvironmentPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01690">1690</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/sysenv_8c-source.html#l00045">NtQuerySystemEnvironmentValue()</a>, <a class="el" href="../../d6/d7/sysenv_8c-source.html#l00305">NtSetSystemEnvironmentValue()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a90" doxytag="se.h::SeSystemProfilePrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a61">SeSystemProfilePrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01681">1681</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00199">NtCreateProfile()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a91" doxytag="se.h::SeSystemtimePrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a62">SeSystemtimePrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01682">1682</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="se.h::SeSystemTokenSource" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> TOKEN_SOURCE <a class="el" href="../../d8/d5/seglobal_8c.html#a0">SeSystemTokenSource</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01602">1602</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l01010">SeMakeAnonymousLogonToken()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a86" doxytag="se.h::SeTakeOwnershipPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a57">SeTakeOwnershipPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01677">1677</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l01564">SepAccessCheck()</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l01019">SepInitializePrivilegeSets()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03652">SePrivilegePolicyCheck()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a84" doxytag="se.h::SeTcbPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a55">SeTcbPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01675">1675</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l00731">CmpRefreshHive()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00886">NtSetDefaultHardErrorPort()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d1/d3/tokenset_8c-source.html#l00037">NtSetInformationToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00143">SepSinglePrivilegeCheck()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a102" doxytag="se.h::SeUndockPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a73">SeUndockPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01693">1693</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a78" doxytag="se.h::SeUnrestrictedDacl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PACL <a class="el" href="../../d8/d5/seglobal_8c.html#a47">SeUnrestrictedDacl</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01663">1663</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a72" doxytag="se.h::SeUnrestrictedSd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSECURITY_DESCRIPTOR <a class="el" href="../../d8/d5/seglobal_8c.html#a40">SeUnrestrictedSd</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01656">1656</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a83" doxytag="se.h::SeUnsolicitedInputPrivilege" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LUID <a class="el" href="../../d8/d5/seglobal_8c.html#a54">SeUnsolicitedInputPrivilege</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01674">1674</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="se.h::SeWorldSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PSID <a class="el" href="../../d8/d5/seglobal_8c.html#a4">SeWorldSid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/se_8h-source.html#l01609">1609</a> of file <a class="el" href="../../d1/d4/se_8h-source.html">se.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12098">IopCreateDefaultDeviceSecurityDescriptor()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">ObInitSystem()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l01545">ObpGetDosDevicesProtection()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00529">SeAssignWorldSecurityDescriptor()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03871">SeFastTraverseCheck()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l01010">SeMakeAnonymousLogonToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d0/d5/seinit_8c-source.html#l00184">SepInitializationPhase1()</a>, <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00651">SepInitSystemDacls()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">SepSidTranslation()</a>, and <a class="el" href="../../d9/d4/seglobal_8c-source.html#l00307">SepVariableInitialization()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:33 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
