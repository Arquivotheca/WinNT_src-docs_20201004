<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: cmdata.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>cmdata.h</h1><a href="../../d9/d0/cmdata_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1999  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    cmdata.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module contains data structures used by the </span>
00012 <span class="comment">    configuration manager.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Dragos C. Sambotin (dragoss) 13-Jan-99</span>
00017 <span class="comment"></span>
00018 <span class="comment">Revision History:</span>
00019 <span class="comment"></span>
00020 <span class="comment">--*/</span>
00021 
00022 <span class="preprocessor">#ifndef __CM_DATA__</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define __CM_DATA__</span>
00024 <span class="preprocessor"></span>
00025 <span class="comment">// \nt\private\ntos\inc\hivedata.h</span>
00026 <span class="preprocessor">#include "<a class="code" href="../../d0/d1/hivedata_8h.html">hivedata.h</a>"</span>
00027 
00028 
00029 <span class="comment">//</span>
00030 <span class="comment">// Limits on lengths of names, all in BYTES, all INCLUDING nulls.</span>
00031 <span class="comment">//</span>
00032 
<a name="l00033"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a0">00033</a> <span class="preprocessor">#define MAX_KEY_PATH_LENGTH         65535       </span>
<a name="l00034"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a1">00034</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_KEY_NAME_LENGTH         512         // allow for 256 unicode, as promise</span>
<a name="l00035"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a2">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_FRIENDLY_NAME_LENGTH    160         // allow for 80  unicode chars in FriendlyNames</span>
<a name="l00036"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a3">00036</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_KEY_VALUE_NAME_LENGTH   32767       // 32k - sanity limit for value name</span>
00037 <span class="preprocessor"></span>
00038 
00039 <span class="comment">//</span>
00040 <span class="comment">// ----- Control structures, object manager structures ------</span>
00041 <span class="comment">//</span>
00042 
00043 
00044 <span class="comment">//</span>
00045 <span class="comment">// CM_KEY_CONTROL_BLOCK</span>
00046 <span class="comment">//</span>
00047 <span class="comment">// One key control block exists for each open key.  All of the key objects</span>
00048 <span class="comment">// (open instances) for the key refer to the key control block.</span>
00049 <span class="comment">//</span>
00050 
00051 
<a name="l00052"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a52">00052</a> <span class="keyword">typedef</span> ULONG <a class="code" href="../../d9/d0/cmdata_8h.html#a52">HASH_VALUE</a>;
00053 
<a name="l00054"></a><a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html">00054</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html">_CM_KEY_HASH</a> {
<a name="l00055"></a><a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html#o0">00055</a>     ULONG   <a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html#o0">ConvKey</a>;
<a name="l00056"></a><a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html#o1">00056</a>     <span class="keyword">struct </span><a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html">_CM_KEY_HASH</a> *<a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html#o1">NextHash</a>;
<a name="l00057"></a><a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html#o2">00057</a>     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>     <a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html#o2">KeyHive</a>;                         <span class="comment">// Hive containing CM_KEY_NODE</span>
<a name="l00058"></a><a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html#o3">00058</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html#o3">KeyCell</a>;                        <span class="comment">// Cell containing CM_KEY_NODE</span>
00059 } <a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html">CM_KEY_HASH</a>, *<a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html">PCM_KEY_HASH</a>;
00060 
00061 <span class="preprocessor">#ifdef CM_DEBUG_KCB</span>
00062 <span class="preprocessor"></span><span class="preprocessor">#define KCB_SIGNATURE 'bKmC'</span>
00063 <span class="preprocessor"></span>
00064 <span class="preprocessor">#define SET_KCB_SIGNATURE(_kcb_,_sig_) (_kcb_)-&gt;Signature = (_sig_)</span>
00065 <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_KCB(_kcb_) ASSERT((_kcb_)-&gt;Signature == KCB_SIGNATURE)</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_KEY_HASH(_keyhash_) ASSERT_KCB(CONTAINING_RECORD((_keyhash_), CM_KEY_CONTROL_BLOCK, KeyHash))</span>
00067 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00068"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a4">00068</a> <span class="preprocessor"></span><span class="preprocessor">#define SET_KCB_SIGNATURE(_kcb_,_sig_)</span>
<a name="l00069"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a5">00069</a> <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_KCB(_kcb_)</span>
<a name="l00070"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a6">00070</a> <span class="preprocessor"></span><span class="preprocessor">#define ASSERT_KEY_HASH(_keyhash_)</span>
00071 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00072 <span class="preprocessor"></span>
00073 
00074 
00075 <span class="comment">//</span>
00076 <span class="comment">// The registry is a large data structure that has had poor locality.</span>
00077 <span class="comment">// To improve performance without changing the on disk structure, we</span>
00078 <span class="comment">// cache the frequently used registry data to minimize reference on</span>
00079 <span class="comment">// registry data.</span>
00080 <span class="comment">//</span>
00081 <span class="comment">// A KCB (Key Control Block) is the core structure for registry cache.</span>
00082 <span class="comment">// It uses HashValue for quick cache lookup and contains the most</span>
00083 <span class="comment">// frequently used data in a key node.</span>
00084 <span class="comment">//</span>
00085 <span class="comment">// It contains the most frequently used data in a key node:</span>
00086 <span class="comment">// Security, Flags, and Value index.</span>
00087 <span class="comment">//</span>
00088 <span class="comment">// A KCB may also contains additional information</span>
00089 <span class="comment">// (which are cached lazily) about its subkeys, value nodes and values' data.</span>
00090 <span class="comment">//</span>
00091 <span class="comment">// The subkey information is distinquished by ExtFlags.  See CM_KCB_* below.</span>
00092 <span class="comment">// The value nodes and data are distinguished by a bit in the vairable.</span>
00093 <span class="comment">// See CMP_IS_CELL_CACHED.</span>
00094 <span class="comment">//</span>
00095 <span class="comment">// Caches for value data will be created during query process, the cached</span>
00096 <span class="comment">// structure is shown as the following picture.  The structure is almost</span>
00097 <span class="comment">// the same as the registry structure</span>
00098 <span class="comment">// except they are pointers to the allocation instead of offset index on hive.</span>
00099 <span class="comment">//</span>
00100 <span class="comment">// To minimize the name string storage space KCB's,  we do not store the complete</span>
00101 <span class="comment">// path name of the key in the kcb, instead, we implemented the tree structure</span>
00102 <span class="comment">// (like the registry hive structure) to share name prefix.</span>
00103 <span class="comment">// Also, knowing that there are lots of keys sharing same names,</span>
00104 <span class="comment">// we create NameBlock strucuture so KCB's of same names</span>
00105 <span class="comment">// can share the NameBlock.  NameBlock is compressed.</span>
00106 <span class="comment">//</span>
00107 <span class="comment">// Meanings when the following bits are set in ExtFlags:</span>
00108 <span class="comment">// 1. The following bits are used for Parse and are for</span>
00109 <span class="comment">//    non-symbolic keys.  Also, at most one bit can be set at any given time.</span>
00110 <span class="comment">//    CM_KCB_KEY_NON_EXIST : This key is a fake key (no such key in the hive).</span>
00111 <span class="comment">//    CM_KCB_NO_SUBKEY     : This key is has no subkey.</span>
00112 <span class="comment">//    CM_KCB_SUBKEY_ONE    : This key has only one subkey and IndexHint is</span>
00113 <span class="comment">//                           the first four characters of this subkey.</span>
00114 <span class="comment">//    CM_KCB_SUBKEY_HINT   : This key has the first four characters of all</span>
00115 <span class="comment">//                           its subkeys (buffer pointed by IndexHint).</span>
00116 <span class="comment">//</span>
00117 <span class="comment">// 2. CM_KCB_SYM_LINK_FOUND: This bit is only for symbolic keys.  It</span>
00118 <span class="comment">//                           indicates that the symbolic link has been</span>
00119 <span class="comment">//                           resolved and the KCB for the link is pointed to</span>
00120 <span class="comment">//                           by ValueCache.RealKcb.</span>
00121 <span class="comment">//                           In this case, the Value Index of this key is no longer</span>
00122 <span class="comment">//                           available in the KCB.  (We hardly query the value</span>
00123 <span class="comment">//                           of a symbolic link key other than finding the path</span>
00124 <span class="comment">//                           of the real key anyway).</span>
00125 <span class="comment">//</span>
00126 <span class="comment">// 3. CM_KCB_NO_DELAY_CLOSE: This bit is only used for non-symbolic keys and is</span>
00127 <span class="comment">//                           independent of bits on item 1. When set, it indicates that</span>
00128 <span class="comment">//                           key should not be kept in delay close when the refererence</span>
00129 <span class="comment">//                           count goes to zero.</span>
00130 <span class="comment">//                           This is for the case when a key has no open handles but</span>
00131 <span class="comment">//                           still has subkeys in the cache.</span>
00132 <span class="comment">//                           When its last subkey is kicked out of cache, we do not</span>
00133 <span class="comment">//                           want to keep this key around.</span>
00134 <span class="comment">//                           This is done so CmpSearchForOpenSubKeysInCachen can clean</span>
00135 <span class="comment">//                           up the cache properly before a key can be unloaded.</span>
00136 <span class="comment">//</span>
00137 <span class="comment">//</span>
00138 <span class="comment">//   KCB</span>
00139 <span class="comment">//   +-------------------+</span>
00140 <span class="comment">//   | ...               |      (Typical case)</span>
00141 <span class="comment">//   +-------------------+      Value Index</span>
00142 <span class="comment">//   | ValueCache        |  +--&gt;+---------+         Value Key (with small data)</span>
00143 <span class="comment">//   +  +----------------+  |   |        o---------&gt;+-----------+</span>
00144 <span class="comment">//   |  | ValueList     o---+   +---------+         | ....      |</span>
00145 <span class="comment">//   |  +---- Union -----|      |         |         +-----------+</span>
00146 <span class="comment">//   |  | RealKcb       o---+   +---------+         | Data (S)  |</span>
00147 <span class="comment">//   |  +----------------|  |   |         |         +-----------+</span>
00148 <span class="comment">//   |                   |  |   +---------+</span>
00149 <span class="comment">//   |                   |  |   |         |</span>
00150 <span class="comment">//   |                   |  |   +---------+         Value Key (with large data)</span>
00151 <span class="comment">//   |                   |  |   |        o---------&gt;+-----------+</span>
00152 <span class="comment">//   |                   |  |   +---------+         | ...       |</span>
00153 <span class="comment">//   |                   |  |   |         |         +-----------+</span>
00154 <span class="comment">//   |                   |  |   +---------+         | Data (L) o------+</span>
00155 <span class="comment">//   |                   |  |                       +-----------+     |</span>
00156 <span class="comment">//   |                   |  |                       |           | &lt;---+ (Append at the end of Value Node)</span>
00157 <span class="comment">//   |                   |  |                       |           |</span>
00158 <span class="comment">//   |                   |  |                       |           |</span>
00159 <span class="comment">//   |                   |  |                       +-----------+</span>
00160 <span class="comment">//   |                   |  |</span>
00161 <span class="comment">//   |                   |  |   KCB (Symbolic link key, CM_KCB_SYM_LINK_FOUND set).</span>
00162 <span class="comment">//   |                   |  +--&gt;+---------+</span>
00163 <span class="comment">//   |                   |      |         |</span>
00164 <span class="comment">//   |                   |      |         |</span>
00165 <span class="comment">//   |                   |      |         |</span>
00166 <span class="comment">//   |                   |      |         |</span>
00167 <span class="comment">//   |                   |      |         |</span>
00168 <span class="comment">//   |                   |      +---------+</span>
00169 <span class="comment">//   |                   |</span>
00170 <span class="comment">//   | ...               |</span>
00171 <span class="comment">//   +-------------------+      Index Hint</span>
00172 <span class="comment">//   | IndexHint        o------&gt;+---------+</span>
00173 <span class="comment">//   +-------------------+      | 4 char  |</span>
00174 <span class="comment">//   |                   |      +---------+</span>
00175 <span class="comment">//   |                   |      | 4 char  |</span>
00176 <span class="comment">//   +-------------------+      +---------+</span>
00177 <span class="comment">//   |                   |      (CM_KCB_SUBKEY_HINT)</span>
00178 <span class="comment">//   |                   |</span>
00179 <span class="comment">//   |                   |</span>
00180 <span class="comment">//   +-------------------+                 Name Block</span>
00181 <span class="comment">//   | NameBlock        o-----------------&gt;+----------+</span>
00182 <span class="comment">//   +-------------------+                 |          |</span>
00183 <span class="comment">//                                         +----------+</span>
00184 <span class="comment">//</span>
00185 <span class="comment">//</span>
00186 <span class="comment">// The TotalLevels is used for quick comparison for notification and cache lookup.</span>
00187 <span class="comment">//</span>
00188 <span class="comment">// *** MP Synchronization ***</span>
00189 <span class="comment">// The KCB lock is held for any write to KCB unless the registry is locked exclusively.</span>
00190 <span class="comment">// KCB is also locked while reading fields that can be modified by another thread</span>
00191 <span class="comment">// during a read operation, i.e., when the registry lock is held shared.</span>
00192 <span class="comment">//</span>
00193 <span class="comment">// The fields are the follows: ExtFlags, ValueCache, IndexInfo, IndexHint, or NameHint.</span>
00194 <span class="comment">//</span>
00195 <span class="comment">// Reading of other entries in the KCB does not need to hold the KCB lock since</span>
00196 <span class="comment">// these entries will not change for any registry read operation.  When there</span>
00197 <span class="comment">// are changes to these entries, registry must be locked exclusively.</span>
00198 <span class="comment">//</span>
00199 <span class="comment">// NOTE: the KCB size is 56 bytes now, plus the pool header of 8 bytes,</span>
00200 <span class="comment">//       it fits into a 64byte allocation.  Think carefully if you want to</span>
00201 <span class="comment">//       enlarge the data structure.  Also, watch it if the pool allocation code changes.</span>
00202 <span class="comment">//</span>
00203 <span class="comment">//       The RefCount in KCB is the number of open handles plus the number of cached subkeys.</span>
00204 <span class="comment">//       We can change this by having a RefCount and a CachedSubKeyCount.  To not grow the</span>
00205 <span class="comment">//       structure size, we can merge the boolean Delete into ExtFlags.</span>
00206 
<a name="l00207"></a><a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html">00207</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html">_CM_NAME_HASH</a> {
<a name="l00208"></a><a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html#o0">00208</a>     ULONG   <a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html#o0">ConvKey</a>;
<a name="l00209"></a><a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html#o1">00209</a>     <span class="keyword">struct </span><a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html">_CM_NAME_HASH</a> *<a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html#o1">NextHash</a>;
<a name="l00210"></a><a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html#o2">00210</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>  <a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html#o2">NameLength</a>;      <span class="comment">// Length of string value</span>
<a name="l00211"></a><a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html#o3">00211</a>     WCHAR   <a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html#o3">Name</a>[1] ;      <span class="comment">// The actual string value</span>
00212 } <a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html">CM_NAME_HASH</a>, *<a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html">PCM_NAME_HASH</a>;
00213 
<a name="l00214"></a><a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html">00214</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html">_CM_NAME_CONTROL_BLOCK</a> {
<a name="l00215"></a><a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o0">00215</a>     BOOLEAN     <a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o0">Compressed</a>;       <span class="comment">// Flags to indicate which extension we have.</span>
<a name="l00216"></a><a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o1">00216</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o1">RefCount</a>;
00217     <span class="keyword">union </span>{
<a name="l00218"></a><a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o2">00218</a>         <a class="code" href="../../d1/d6/struct__CM__NAME__HASH.html">CM_NAME_HASH</a>             <a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o2">NameHash</a>;
00219         <span class="keyword">struct </span>{
<a name="l00220"></a><a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o3">00220</a>             ULONG   <a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o3">ConvKey</a>;
<a name="l00221"></a><a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o4">00221</a>             <span class="keyword">struct </span><a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html">_CM_KEY_HASH</a> *<a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o4">NextHash</a>;
<a name="l00222"></a><a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o5">00222</a>             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>  <a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o5">NameLength</a>;      <span class="comment">// Length of string value</span>
<a name="l00223"></a><a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o6">00223</a>             WCHAR   <a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html#o6">Name</a>[1] ;      <span class="comment">// The actual string value</span>
00224         };
00225     };
00226 } <a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html">CM_NAME_CONTROL_BLOCK</a>, *<a class="code" href="../../d8/d5/struct__CM__NAME__CONTROL__BLOCK.html">PCM_NAME_CONTROL_BLOCK</a>;
00227 
<a name="l00228"></a><a class="code" href="../../d3/d4/struct__CM__INDEX__HINT__BLOCK.html">00228</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d4/struct__CM__INDEX__HINT__BLOCK.html">_CM_INDEX_HINT_BLOCK</a> {
<a name="l00229"></a><a class="code" href="../../d3/d4/struct__CM__INDEX__HINT__BLOCK.html#o0">00229</a>     ULONG   <a class="code" href="../../d3/d4/struct__CM__INDEX__HINT__BLOCK.html#o0">Count</a>;
<a name="l00230"></a><a class="code" href="../../d3/d4/struct__CM__INDEX__HINT__BLOCK.html#o1">00230</a>     UCHAR   <a class="code" href="../../d3/d4/struct__CM__INDEX__HINT__BLOCK.html#o1">NameHint</a>[1];
00231 } <a class="code" href="../../d3/d4/struct__CM__INDEX__HINT__BLOCK.html">CM_INDEX_HINT_BLOCK</a>, *<a class="code" href="../../d3/d4/struct__CM__INDEX__HINT__BLOCK.html">PCM_INDEX_HINT_BLOCK</a>;
00232 
<a name="l00233"></a><a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html">00233</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html">_CACHED_CHILD_LIST</a> {
<a name="l00234"></a><a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html#o0">00234</a>     ULONG       <a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html#o0">Count</a>;                  <span class="comment">// 0 for empty list</span>
00235     <span class="keyword">union </span>{
<a name="l00236"></a><a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html#o1">00236</a>         ULONG_PTR   <a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html#o1">ValueList</a>;
<a name="l00237"></a><a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html#o2">00237</a>         <span class="keyword">struct </span><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">_CM_KEY_CONTROL_BLOCK</a> *<a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html#o2">RealKcb</a>;
00238     };
00239 } <a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html">CACHED_CHILD_LIST</a>, *<a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html">PCACHED_CHILD_LIST</a>;
00240 
00241 <span class="comment">//</span>
00242 <span class="comment">// Define the HINT Length used</span>
00243 <span class="comment">//</span>
<a name="l00244"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a7">00244</a> <span class="preprocessor">#define CM_SUBKEY_HINT_LENGTH   4</span>
<a name="l00245"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a8">00245</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_MAX_CACHE_HINT_SIZE 14</span>
00246 <span class="preprocessor"></span>
00247 <span class="comment">//</span>
00248 <span class="comment">// Bits used in the ExtFlags in KCB.</span>
00249 <span class="comment">//</span>
00250 
<a name="l00251"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a9">00251</a> <span class="preprocessor">#define CM_KCB_NO_SUBKEY        0x0001      // This key has no subkeys</span>
<a name="l00252"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a10">00252</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_KCB_SUBKEY_ONE       0x0002      // This key has only one subkey and the</span>
00253 <span class="preprocessor"></span>                                            <span class="comment">// first 4 char</span>
00254                                             <span class="comment">//</span>
<a name="l00255"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a11">00255</a> <span class="preprocessor">#define CM_KCB_SUBKEY_HINT      0x0004</span>
<a name="l00256"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a12">00256</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_KCB_SYM_LINK_FOUND   0x0008</span>
<a name="l00257"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a13">00257</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_KCB_KEY_NON_EXIST    0x0010</span>
<a name="l00258"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a14">00258</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_KCB_NO_DELAY_CLOSE   0x0020</span>
00259 <span class="preprocessor"></span>
<a name="l00260"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a15">00260</a> <span class="preprocessor">#define CM_KCB_CACHE_MASK (CM_KCB_NO_SUBKEY | \</span>
00261 <span class="preprocessor">                           CM_KCB_KEY_NON_EXIST | \</span>
00262 <span class="preprocessor">                           CM_KCB_SUBKEY_ONE | \</span>
00263 <span class="preprocessor">                           CM_KCB_SUBKEY_HINT)</span>
00264 <span class="preprocessor"></span>
00265 
<a name="l00266"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a16">00266</a> <span class="preprocessor">#define KCB_TO_KEYBODY_LINK</span>
00267 <span class="preprocessor"></span>
<a name="l00268"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">00268</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">_CM_KEY_CONTROL_BLOCK</a> {
00269 <span class="preprocessor">#ifdef CM_DEBUG_KCB</span>
00270 <span class="preprocessor"></span>    ULONG                       Signature;
00271 <span class="preprocessor">#endif</span>
<a name="l00272"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o0">00272</a> <span class="preprocessor"></span>    BOOLEAN                     <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o0">Delete</a>;
<a name="l00273"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o1">00273</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>                      <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o1">RefCount</a>;
00274     <span class="keyword">union </span>{
<a name="l00275"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o2">00275</a>         <a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html">CM_KEY_HASH</a>             <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o2">KeyHash</a>;
00276         <span class="keyword">struct </span>{
<a name="l00277"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o3">00277</a>             ULONG               <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o3">ConvKey</a>;
<a name="l00278"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o4">00278</a>             <span class="keyword">struct </span><a class="code" href="../../d0/d5/struct__CM__KEY__HASH.html">_CM_KEY_HASH</a> *<a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o4">NextHash</a>;
<a name="l00279"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o5">00279</a>             <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>              <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o5">KeyHive</a>;        <span class="comment">// Hive containing CM_KEY_NODE</span>
<a name="l00280"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o6">00280</a>             <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>         <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o6">KeyCell</a>;         <span class="comment">// Cell containing CM_KEY_NODE</span>
00281         };
00282     };
<a name="l00283"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o7">00283</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>                      <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o7">ExtFlags</a>;       <span class="comment">// Flags to indicate which extension we have.</span>
<a name="l00284"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o8">00284</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>                      <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o8">Flags</a>;          <span class="comment">// Same Flags as KeyNode</span>
<a name="l00285"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o9">00285</a>     <span class="keyword">struct </span><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">_CM_KEY_CONTROL_BLOCK</a> *<a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o9">ParentKcb</a>;
<a name="l00286"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o10">00286</a>     <a class="code" href="../../d9/d0/cmdata_8h.html#a58">PCM_NAME_CONTROL_BLOCK</a>      <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o10">NameBlock</a>;
<a name="l00287"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o11">00287</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>                 <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o11">Security</a>;
<a name="l00288"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o12">00288</a>     <span class="keyword">struct </span><a class="code" href="../../d5/d6/struct__CACHED__CHILD__LIST.html">_CACHED_CHILD_LIST</a>   ValueCache;
00289     <span class="keyword">union </span>{
<a name="l00290"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o13">00290</a>         <a class="code" href="../../d9/d0/cmdata_8h.html#a60">PCM_INDEX_HINT_BLOCK</a>    IndexHint;                          <span class="comment">// CM_KCB_SUBKEY_HINT</span>
<a name="l00291"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o14">00291</a>         UCHAR                   NameHint[<a class="code" href="../../d9/d0/cmdata_8h.html#a7">CM_SUBKEY_HINT_LENGTH</a>];    <span class="comment">// CM_KCB_SUBKEY_ONE</span>
00292     };
<a name="l00293"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o15">00293</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o15">DelayedCloseIndex</a>;
<a name="l00294"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o16">00294</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o16">TotalLevels</a>;
<a name="l00295"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o17">00295</a>     <span class="keyword">struct </span><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">_CM_KEY_NODE</a>         *<a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o17">KeyNode</a>;       <span class="comment">// pointer to CM_KEY_NODE</span>
00296 <span class="preprocessor">#ifdef KCB_TO_KEYBODY_LINK</span>
<a name="l00297"></a><a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o18">00297</a> <span class="preprocessor"></span>    LIST_ENTRY                  <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html#o18">KeyBodyListHead</a>; <span class="comment">// head of the list with all key_nodes using this kcb </span>
00298 <span class="preprocessor">#endif</span>
00299 <span class="preprocessor"></span>} <a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">CM_KEY_CONTROL_BLOCK</a>, *<a class="code" href="../../d5/d4/struct__CM__KEY__CONTROL__BLOCK.html">PCM_KEY_CONTROL_BLOCK</a>;
00300 
00301 
00302 <span class="comment">//</span>
00303 <span class="comment">// ----- Structures used to implement registry hierarchy -----</span>
00304 <span class="comment">//</span>
00305 
<a name="l00306"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a103">00306</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d9/d0/cmdata_8h.html#a103">_NODE_TYPE</a> {
00307     <a class="code" href="../../d9/d0/cmdata_8h.html#a103a95">KeyBodyNode</a>,
00308     <a class="code" href="../../d9/d0/cmdata_8h.html#a103a96">KeyValueNode</a>
00309 } <a class="code" href="../../d9/d0/cmdata_8h.html#a65">NODE_TYPE</a>;
00310 
00311 
<a name="l00312"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a104">00312</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d9/d0/cmdata_8h.html#a104">_CMP_COPY_TYPE</a> {
00313     <a class="code" href="../../d9/d0/cmdata_8h.html#a104a97">Copy</a>,
00314     <a class="code" href="../../d9/d0/cmdata_8h.html#a104a98">Sync</a>,
00315     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a91">Merge</a>
00316 } <a class="code" href="../../d9/d0/cmdata_8h.html#a66">CMP_COPY_TYPE</a>;
00317 
<a name="l00318"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a105">00318</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d9/d0/cmdata_8h.html#a105">_SUBKEY_SEARCH_TYPE</a> {
00319     <a class="code" href="../../d9/d0/cmdata_8h.html#a105a100">SearchIfExist</a>,
00320     <a class="code" href="../../d9/d0/cmdata_8h.html#a105a101">SearchAndDeref</a>,
00321     <a class="code" href="../../d9/d0/cmdata_8h.html#a105a102">SearchAndCount</a>
00322 } <a class="code" href="../../d9/d0/cmdata_8h.html#a67">SUBKEY_SEARCH_TYPE</a>;
00323 
00324 <span class="comment">//</span>
00325 <span class="comment">// ChildList</span>
00326 <span class="comment">//</span>
00327 <span class="comment">//      NOTE:   CHILD_LIST structures are normally refered to</span>
00328 <span class="comment">//              with HCELL_INDEX, not PCHILD_LIST vars.</span>
00329 <span class="comment">//</span>
00330 
<a name="l00331"></a><a class="code" href="../../d7/d9/struct__CHILD__LIST.html">00331</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d9/struct__CHILD__LIST.html">_CHILD_LIST</a> {
<a name="l00332"></a><a class="code" href="../../d7/d9/struct__CHILD__LIST.html#o0">00332</a>     ULONG       <a class="code" href="../../d7/d9/struct__CHILD__LIST.html#o0">Count</a>;                  <span class="comment">// 0 for empty list</span>
<a name="l00333"></a><a class="code" href="../../d7/d9/struct__CHILD__LIST.html#o1">00333</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d7/d9/struct__CHILD__LIST.html#o1">List</a>;
00334 } <a class="code" href="../../d7/d9/struct__CHILD__LIST.html">CHILD_LIST</a>, *<a class="code" href="../../d7/d9/struct__CHILD__LIST.html">PCHILD_LIST</a>;
00335 
00336 <span class="comment">//</span>
00337 <span class="comment">// CM_KEY_REFERENCE</span>
00338 <span class="comment">//</span>
00339 
<a name="l00340"></a><a class="code" href="../../d5/d5/struct__CM__KEY__REFERENCE.html">00340</a> <span class="keyword">typedef</span> <span class="keyword">struct  </span><a class="code" href="../../d5/d5/struct__CM__KEY__REFERENCE.html">_CM_KEY_REFERENCE</a> {
<a name="l00341"></a><a class="code" href="../../d5/d5/struct__CM__KEY__REFERENCE.html#o0">00341</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d5/d5/struct__CM__KEY__REFERENCE.html#o0">KeyCell</a>;
<a name="l00342"></a><a class="code" href="../../d5/d5/struct__CM__KEY__REFERENCE.html#o1">00342</a>     <a class="code" href="../../d7/d7/struct__HHIVE.html">PHHIVE</a>      <a class="code" href="../../d5/d5/struct__CM__KEY__REFERENCE.html#o1">KeyHive</a>;
00343 } <a class="code" href="../../d5/d5/struct__CM__KEY__REFERENCE.html">CM_KEY_REFERENCE</a> , *<a class="code" href="../../d5/d5/struct__CM__KEY__REFERENCE.html">PCM_KEY_REFERENCE</a>;
00344 
00345 <span class="comment">//</span>
00346 <span class="comment">// ----- CM_KEY_INDEX -----</span>
00347 <span class="comment">//</span>
00348 <span class="comment">// A leaf index may be one of two types. The "old" CM_KEY_INDEX type is used for</span>
00349 <span class="comment">// hives circa NT3.1, 3.5, and 3.51. NT4.0 introduces the newer CM_KEY_FAST_INDEX</span>
00350 <span class="comment">// which is used for all leaf indexes that have less than CM_MAX_FAST_INDEX leaves.</span>
00351 <span class="comment">//</span>
00352 <span class="comment">// The main advantage of the fast index is that the first four characters of the</span>
00353 <span class="comment">// names are stored within the index itself. This almost always saves us from having</span>
00354 <span class="comment">// to fault in a number of unneccessary pages when searching for a given key.</span>
00355 <span class="comment">//</span>
00356 <span class="comment">// The main disadvantage is that each subkey requires twice as much storage. One dword</span>
00357 <span class="comment">// for the HCELL_INDEX and one dword to hold the first four characters of the subkey</span>
00358 <span class="comment">// name. If one of the first four characters in the subkey name is a unicode character</span>
00359 <span class="comment">// where the high byte is non-zero, the actual subkey must be examined to determine the</span>
00360 <span class="comment">// name.</span>
00361 <span class="comment">//</span>
00362 <span class="comment">// Hive version 1 &amp; 2 do not support the fast index. Version 3 adds support for the</span>
00363 <span class="comment">// fast index. All hives that are newly created on a V3-capable system are therefore</span>
00364 <span class="comment">// unreadable on V1 &amp; 2 systems.</span>
00365 <span class="comment">//</span>
00366 <span class="comment">// N.B. There is code in cmindex.c that relies on the Signature and Count fields of</span>
00367 <span class="comment">//      CM_KEY_INDEX and CM_KEY_FAST_INDEX being at the same offset in the structure!</span>
00368 
<a name="l00369"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a17">00369</a> <span class="preprocessor">#define UseFastIndex(Hive) ((Hive)-&gt;Version&gt;=3)</span>
00370 <span class="preprocessor"></span>
<a name="l00371"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a18">00371</a> <span class="preprocessor">#define CM_KEY_INDEX_ROOT   0x6972      // ir</span>
<a name="l00372"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a19">00372</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_KEY_INDEX_LEAF   0x696c      // il</span>
<a name="l00373"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a20">00373</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_KEY_FAST_LEAF    0x666c      // fl</span>
00374 <span class="preprocessor"></span>
<a name="l00375"></a><a class="code" href="../../d2/d4/struct__CM__INDEX.html">00375</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d4/struct__CM__INDEX.html">_CM_INDEX</a> {
<a name="l00376"></a><a class="code" href="../../d2/d4/struct__CM__INDEX.html#o0">00376</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d2/d4/struct__CM__INDEX.html#o0">Cell</a>;
<a name="l00377"></a><a class="code" href="../../d2/d4/struct__CM__INDEX.html#o1">00377</a>     UCHAR <a class="code" href="../../d2/d4/struct__CM__INDEX.html#o1">NameHint</a>[4];                  <span class="comment">// upcased first four chars of name</span>
00378 } <a class="code" href="../../d2/d4/struct__CM__INDEX.html">CM_INDEX</a>, *<a class="code" href="../../d2/d4/struct__CM__INDEX.html">PCM_INDEX</a>;
00379 
<a name="l00380"></a><a class="code" href="../../d9/d4/struct__CM__KEY__FAST__INDEX.html">00380</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d4/struct__CM__KEY__FAST__INDEX.html">_CM_KEY_FAST_INDEX</a> {
<a name="l00381"></a><a class="code" href="../../d9/d4/struct__CM__KEY__FAST__INDEX.html#o0">00381</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d9/d4/struct__CM__KEY__FAST__INDEX.html#o0">Signature</a>;              <span class="comment">// also type selector</span>
<a name="l00382"></a><a class="code" href="../../d9/d4/struct__CM__KEY__FAST__INDEX.html#o1">00382</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d9/d4/struct__CM__KEY__FAST__INDEX.html#o1">Count</a>;
<a name="l00383"></a><a class="code" href="../../d9/d4/struct__CM__KEY__FAST__INDEX.html#o2">00383</a>     <a class="code" href="../../d2/d4/struct__CM__INDEX.html">CM_INDEX</a>    <a class="code" href="../../d9/d4/struct__CM__KEY__FAST__INDEX.html#o2">List</a>[1];                <span class="comment">// Variable sized array</span>
00384 } <a class="code" href="../../d9/d4/struct__CM__KEY__FAST__INDEX.html">CM_KEY_FAST_INDEX</a>, *<a class="code" href="../../d9/d4/struct__CM__KEY__FAST__INDEX.html">PCM_KEY_FAST_INDEX</a>;
00385 
<a name="l00386"></a><a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html">00386</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html">_CM_KEY_INDEX</a> {
<a name="l00387"></a><a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o0">00387</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o0">Signature</a>;              <span class="comment">// also type selector</span>
<a name="l00388"></a><a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o1">00388</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o1">Count</a>;
<a name="l00389"></a><a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o2">00389</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html#o2">List</a>[1];                <span class="comment">// Variable sized array</span>
00390 } <a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html">CM_KEY_INDEX</a>, *<a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html">PCM_KEY_INDEX</a>;
00391 
00392 <span class="comment">//</span>
00393 <span class="comment">// Allow index to grow to size that will cause allocation of exactly</span>
00394 <span class="comment">// one logical block.  Works out to be 1013 entries.</span>
00395 <span class="comment">//</span>
<a name="l00396"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a21">00396</a> <span class="preprocessor">#define CM_MAX_INDEX                                                        \</span>
00397 <span class="preprocessor"> ( (HBLOCK_SIZE-                                                             \</span>
00398 <span class="preprocessor">    (sizeof(HBIN)+FIELD_OFFSET(HCELL,u)+FIELD_OFFSET(CM_KEY_INDEX,List))) /  \</span>
00399 <span class="preprocessor">    sizeof(HCELL_INDEX) )</span>
00400 <span class="preprocessor"></span>
<a name="l00401"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a22">00401</a> <span class="preprocessor">#define CM_MAX_LEAF_SIZE ((sizeof(HCELL_INDEX)*CM_MAX_INDEX) + \</span>
00402 <span class="preprocessor">                          (FIELD_OFFSET(CM_KEY_INDEX, List)))</span>
00403 <span class="preprocessor"></span>
00404 <span class="comment">//</span>
00405 <span class="comment">// Allow index to grow to size that will cause allocation of exactly</span>
00406 <span class="comment">// one logical block.  Works out to be approx. 500 entries.</span>
00407 <span class="comment">//</span>
<a name="l00408"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a23">00408</a> <span class="preprocessor">#define CM_MAX_FAST_INDEX                                                    \</span>
00409 <span class="preprocessor"> ( (HBLOCK_SIZE-                                                             \</span>
00410 <span class="preprocessor">    (sizeof(HBIN)+FIELD_OFFSET(HCELL,u)+FIELD_OFFSET(CM_KEY_FAST_INDEX,List))) /  \</span>
00411 <span class="preprocessor">    sizeof(CM_INDEX) )</span>
00412 <span class="preprocessor"></span>
<a name="l00413"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a24">00413</a> <span class="preprocessor">#define CM_MAX_FAST_LEAF_SIZE ((sizeof(CM_INDEX)*CM_MAX_FAST_INDEX) + \</span>
00414 <span class="preprocessor">                          (FIELD_OFFSET(CM_KEY_FAST_INDEX, List)))</span>
00415 <span class="preprocessor"></span>
00416 
00417 
00418 <span class="comment">//</span>
00419 <span class="comment">// ----- CM_KEY_NODE -----</span>
00420 <span class="comment">//</span>
00421 
<a name="l00422"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a25">00422</a> <span class="preprocessor">#define CM_KEY_NODE_SIGNATURE     0x6b6e           // "kn"</span>
<a name="l00423"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a26">00423</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_LINK_NODE_SIGNATURE     0x6b6c          // "kl"</span>
00424 <span class="preprocessor"></span>
<a name="l00425"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a27">00425</a> <span class="preprocessor">#define KEY_VOLATILE        0x0001      // This key (and all its children)</span>
00426 <span class="preprocessor"></span>                                        <span class="comment">// is volatile.</span>
00427 
<a name="l00428"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a28">00428</a> <span class="preprocessor">#define KEY_HIVE_EXIT       0x0002      // This key marks a bounary to another</span>
00429 <span class="preprocessor"></span>                                        <span class="comment">// hive (sort of a link).  The null</span>
00430                                         <span class="comment">// value entry contains the hive</span>
00431                                         <span class="comment">// and hive index of the root of the</span>
00432                                         <span class="comment">// child hive.</span>
00433 
<a name="l00434"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a29">00434</a> <span class="preprocessor">#define KEY_HIVE_ENTRY      0x0004      // This key is the root of a particular</span>
00435 <span class="preprocessor"></span>                                        <span class="comment">// hive.</span>
00436 
<a name="l00437"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a30">00437</a> <span class="preprocessor">#define KEY_NO_DELETE       0x0008      // This key cannot be deleted, period.</span>
00438 <span class="preprocessor"></span>
<a name="l00439"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a31">00439</a> <span class="preprocessor">#define KEY_SYM_LINK        0x0010      // This key is really a symbolic link.</span>
<a name="l00440"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a32">00440</a> <span class="preprocessor"></span><span class="preprocessor">#define KEY_COMP_NAME       0x0020      // The name for this key is stored in a</span>
00441 <span class="preprocessor"></span>                                        <span class="comment">// compressed form.</span>
<a name="l00442"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a33">00442</a> <span class="preprocessor">#define KEY_PREDEF_HANDLE   0x0040      // There is no real key backing this,</span>
00443 <span class="preprocessor"></span>                                        <span class="comment">// return the predefined handle.</span>
00444                                         <span class="comment">// Predefined handles are stashed in</span>
00445                                         <span class="comment">// ValueList.Count.</span>
00446 
00447 <span class="preprocessor">#pragma pack(4)</span>
<a name="l00448"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">00448</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">_CM_KEY_NODE</a> {
<a name="l00449"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o0">00449</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o0">Signature</a>;
<a name="l00450"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o1">00450</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o1">Flags</a>;
<a name="l00451"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o2">00451</a>     LARGE_INTEGER <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o2">LastWriteTime</a>;
<a name="l00452"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o3">00452</a>     ULONG       <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o3">Spare</a>;                  <span class="comment">// used to be TitleIndex</span>
<a name="l00453"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o4">00453</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o4">Parent</a>;
<a name="l00454"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o5">00454</a>     ULONG       <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o5">SubKeyCounts</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a5">HTYPE_COUNT</a>];  <span class="comment">// Stable and Volatile</span>
00455     <span class="keyword">union </span>{
00456         <span class="keyword">struct </span>{
<a name="l00457"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o6">00457</a>             <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o6">SubKeyLists</a>[<a class="code" href="../../d0/d1/hivedata_8h.html#a5">HTYPE_COUNT</a>];   <span class="comment">// Stable and Volatile</span>
<a name="l00458"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o7">00458</a>             <a class="code" href="../../d7/d9/struct__CHILD__LIST.html">CHILD_LIST</a>  <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o7">ValueList</a>;
00459         };
<a name="l00460"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o8">00460</a>         <a class="code" href="../../d5/d5/struct__CM__KEY__REFERENCE.html">CM_KEY_REFERENCE</a>    <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o8">ChildHiveReference</a>;
00461     };
00462 
<a name="l00463"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o9">00463</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o9">Security</a>;
<a name="l00464"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o10">00464</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o10">Class</a>;
<a name="l00465"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o11">00465</a>     ULONG       <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o11">MaxNameLen</a>;
<a name="l00466"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o12">00466</a>     ULONG       <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o12">MaxClassLen</a>;
<a name="l00467"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o13">00467</a>     ULONG       <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o13">MaxValueNameLen</a>;
<a name="l00468"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o14">00468</a>     ULONG       <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o14">MaxValueDataLen</a>;
00469 
<a name="l00470"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o15">00470</a>     ULONG       <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o15">WorkVar</a>;                <span class="comment">// WARNING: This DWORD is used</span>
00471                                         <span class="comment">//          by the system at run</span>
00472                                         <span class="comment">//          time, do attempt to</span>
00473                                         <span class="comment">//          store user data in it.</span>
00474 
<a name="l00475"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o16">00475</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o16">NameLength</a>;
<a name="l00476"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o17">00476</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o17">ClassLength</a>;
<a name="l00477"></a><a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o18">00477</a>     WCHAR       <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html#o18">Name</a>[1];                <span class="comment">// Variable sized array</span>
00478 } <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">CM_KEY_NODE</a>, *<a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">PCM_KEY_NODE</a>;
00479 <span class="preprocessor">#pragma pack()</span>
00480 <span class="preprocessor"></span>
00481 <span class="comment">//</span>
00482 <span class="comment">// ----- CM_KEY_VALUE -----</span>
00483 <span class="comment">//</span>
00484 
<a name="l00485"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a34">00485</a> <span class="preprocessor">#define CM_KEY_VALUE_SIGNATURE    0x6b76          // "kv"</span>
00486 <span class="preprocessor"></span>
<a name="l00487"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a35">00487</a> <span class="preprocessor">#define CM_KEY_VALUE_SPECIAL_SIZE   0x80000000       // 2 gig</span>
00488 <span class="preprocessor"></span>
<a name="l00489"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a36">00489</a> <span class="preprocessor">#define CM_KEY_VALUE_SMALL          4</span>
00490 <span class="preprocessor"></span>
<a name="l00491"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a37">00491</a> <span class="preprocessor">#define VALUE_COMP_NAME 0x0001              // The name for this value is stored in a</span>
00492 <span class="preprocessor"></span>                                            <span class="comment">// compressed form.</span>
00493 
<a name="l00494"></a><a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">00494</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">_CM_KEY_VALUE</a> {
<a name="l00495"></a><a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o0">00495</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o0">Signature</a>;
<a name="l00496"></a><a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o1">00496</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o1">NameLength</a>;
<a name="l00497"></a><a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o2">00497</a>     ULONG       <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o2">DataLength</a>;
<a name="l00498"></a><a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o3">00498</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o3">Data</a>;
<a name="l00499"></a><a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o4">00499</a>     ULONG       <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o4">Type</a>;
<a name="l00500"></a><a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o5">00500</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o5">Flags</a>;                      <span class="comment">// Used to be TitleIndex</span>
<a name="l00501"></a><a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o6">00501</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o6">Spare</a>;                      <span class="comment">// Used to be TitleIndex</span>
<a name="l00502"></a><a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o7">00502</a>     WCHAR       <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html#o7">Name</a>[1];                    <span class="comment">// Variable sized array</span>
00503 } <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">CM_KEY_VALUE</a>, *<a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">PCM_KEY_VALUE</a>;
00504 
00505 <span class="comment">//</span>
00506 <span class="comment">// realsize is set to real size, returns TRUE if small, else FALSE</span>
00507 <span class="comment">//</span>
<a name="l00508"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a38">00508</a> <span class="preprocessor">#define CmpIsHKeyValueSmall(realsize, size)                   \</span>
00509 <span class="preprocessor">        ((size &gt;= CM_KEY_VALUE_SPECIAL_SIZE) ?                       \</span>
00510 <span class="preprocessor">        ((realsize) = size - CM_KEY_VALUE_SPECIAL_SIZE, TRUE) :       \</span>
00511 <span class="preprocessor">        ((realsize) = size, FALSE))</span>
00512 <span class="preprocessor"></span>
00513 <span class="comment">//</span>
00514 <span class="comment">// ----- CM_KEY_SECURITY -----</span>
00515 <span class="comment">//</span>
00516 
<a name="l00517"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a39">00517</a> <span class="preprocessor">#define CM_KEY_SECURITY_SIGNATURE 0x6b73              // "ks"</span>
00518 <span class="preprocessor"></span>
<a name="l00519"></a><a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html">00519</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html">_CM_KEY_SECURITY</a> {
<a name="l00520"></a><a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o0">00520</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>                  <a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o0">Signature</a>;
<a name="l00521"></a><a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o1">00521</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>                  <a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o1">Reserved</a>;
<a name="l00522"></a><a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o2">00522</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>             <a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o2">Flink</a>;
<a name="l00523"></a><a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o3">00523</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>             <a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o3">Blink</a>;
<a name="l00524"></a><a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o4">00524</a>     ULONG                   <a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o4">ReferenceCount</a>;
<a name="l00525"></a><a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o5">00525</a>     ULONG                   <a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o5">DescriptorLength</a>;
<a name="l00526"></a><a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o6">00526</a>     SECURITY_DESCRIPTOR_RELATIVE     <a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html#o6">Descriptor</a>;         <span class="comment">// Variable length</span>
00527 } <a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html">CM_KEY_SECURITY</a>, *<a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html">PCM_KEY_SECURITY</a>;
00528 
00529 <span class="comment">//</span>
00530 <span class="comment">// ----- CELL_DATA -----</span>
00531 <span class="comment">//</span>
00532 <span class="comment">// Union of types of data that could be in a cell</span>
00533 <span class="comment">//</span>
00534 
<a name="l00535"></a><a class="code" href="../../d4/d9/struct__CELL__DATA.html">00535</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d9/struct__CELL__DATA.html">_CELL_DATA</a> {
<a name="l00536"></a><a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html">00536</a>     <span class="keyword">union </span><a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html">_u</a> {
<a name="l00537"></a><a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">00537</a>         <a class="code" href="../../d2/d5/struct__CM__KEY__NODE.html">CM_KEY_NODE</a>      <a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o0">KeyNode</a>;
<a name="l00538"></a><a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o1">00538</a>         <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">CM_KEY_VALUE</a>     <a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o1">KeyValue</a>;
<a name="l00539"></a><a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o2">00539</a>         <a class="code" href="../../d6/d5/struct__CM__KEY__SECURITY.html">CM_KEY_SECURITY</a>  <a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o2">KeySecurity</a>;    <span class="comment">// Variable security descriptor length</span>
<a name="l00540"></a><a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o3">00540</a>         <a class="code" href="../../d1/d5/struct__CM__KEY__INDEX.html">CM_KEY_INDEX</a>     <a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o3">KeyIndex</a>;       <span class="comment">// Variable sized structure</span>
<a name="l00541"></a><a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o4">00541</a>         <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a>      <a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o4">KeyList</a>[1];     <span class="comment">// Variable sized array</span>
<a name="l00542"></a><a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o5">00542</a>         WCHAR            <a class="code" href="../../d5/d9/union__CELL__DATA_1_1__u.html#o5">KeyString</a>[1];   <span class="comment">// Variable sized array</span>
00543     } <a class="code" href="../../d4/d9/struct__CELL__DATA.html#o0">u</a>;
00544 } <a class="code" href="../../d4/d9/struct__CELL__DATA.html">CELL_DATA</a>, *<a class="code" href="../../d4/d9/struct__CELL__DATA.html">PCELL_DATA</a>;
00545 
00546 
00547 <span class="comment">//</span>
00548 <span class="comment">// Unions for KEY_INFORMATION, KEY_VALUE_INFORMATION</span>
00549 <span class="comment">//</span>
00550 
<a name="l00551"></a><a class="code" href="../../d5/d6/union__KEY__INFORMATION.html">00551</a> <span class="keyword">typedef</span> <span class="keyword">union </span><a class="code" href="../../d5/d6/union__KEY__INFORMATION.html">_KEY_INFORMATION</a> {
<a name="l00552"></a><a class="code" href="../../d5/d6/union__KEY__INFORMATION.html#o0">00552</a>     KEY_BASIC_INFORMATION   <a class="code" href="../../d5/d6/union__KEY__INFORMATION.html#o0">KeyBasicInformation</a>;
<a name="l00553"></a><a class="code" href="../../d5/d6/union__KEY__INFORMATION.html#o1">00553</a>     KEY_NODE_INFORMATION    <a class="code" href="../../d5/d6/union__KEY__INFORMATION.html#o1">KeyNodeInformation</a>;
<a name="l00554"></a><a class="code" href="../../d5/d6/union__KEY__INFORMATION.html#o2">00554</a>     KEY_FULL_INFORMATION    <a class="code" href="../../d5/d6/union__KEY__INFORMATION.html#o2">KeyFullInformation</a>;
<a name="l00555"></a><a class="code" href="../../d5/d6/union__KEY__INFORMATION.html#o3">00555</a>     KEY_NAME_INFORMATION    <a class="code" href="../../d5/d6/union__KEY__INFORMATION.html#o3">KeyNameInformation</a>;
00556 } <a class="code" href="../../d5/d6/union__KEY__INFORMATION.html">KEY_INFORMATION</a>, *<a class="code" href="../../d5/d6/union__KEY__INFORMATION.html">PKEY_INFORMATION</a>;
00557 
<a name="l00558"></a><a class="code" href="../../d7/d6/union__KEY__VALUE__INFORMATION.html">00558</a> <span class="keyword">typedef</span> <span class="keyword">union </span><a class="code" href="../../d7/d6/union__KEY__VALUE__INFORMATION.html">_KEY_VALUE_INFORMATION</a> {
<a name="l00559"></a><a class="code" href="../../d7/d6/union__KEY__VALUE__INFORMATION.html#o0">00559</a>     KEY_VALUE_BASIC_INFORMATION <a class="code" href="../../d7/d6/union__KEY__VALUE__INFORMATION.html#o0">KeyValueBasicInformation</a>;
<a name="l00560"></a><a class="code" href="../../d7/d6/union__KEY__VALUE__INFORMATION.html#o1">00560</a>     KEY_VALUE_FULL_INFORMATION  <a class="code" href="../../d7/d6/union__KEY__VALUE__INFORMATION.html#o1">KeyValueFullInformation</a>;
<a name="l00561"></a><a class="code" href="../../d7/d6/union__KEY__VALUE__INFORMATION.html#o2">00561</a>     KEY_VALUE_PARTIAL_INFORMATION <a class="code" href="../../d7/d6/union__KEY__VALUE__INFORMATION.html#o2">KeyValuePartialInformation</a>;
<a name="l00562"></a><a class="code" href="../../d7/d6/union__KEY__VALUE__INFORMATION.html#o3">00562</a>     KEY_VALUE_PARTIAL_INFORMATION_ALIGN64 <a class="code" href="../../d7/d6/union__KEY__VALUE__INFORMATION.html#o3">KeyValuePartialInformationAlign64</a>;
00563 } <a class="code" href="../../d7/d6/union__KEY__VALUE__INFORMATION.html">KEY_VALUE_INFORMATION</a>, *<a class="code" href="../../d7/d6/union__KEY__VALUE__INFORMATION.html">PKEY_VALUE_INFORMATION</a>;
00564 
00565 
00566 
00567 <span class="comment">//</span>
00568 <span class="comment">// ----- CACHED_DATA -----</span>
00569 <span class="comment">//</span>
00570 <span class="comment">// When values are not cached, List in ValueCache is the Hive cell index to the value list.</span>
00571 <span class="comment">// When they are cached, List will be pointer to the allocation.  We distinguish them by</span>
00572 <span class="comment">// marking the lowest bit in the variable to indicate it is a cached allocation.</span>
00573 <span class="comment">//</span>
00574 <span class="comment">// Note that the cell index for value list</span>
00575 <span class="comment">// is stored in the cached allocation.  It is not used now but may be in further performance</span>
00576 <span class="comment">// optimization.</span>
00577 <span class="comment">//</span>
00578 <span class="comment">// When value key and vaule data are cached, there is only one allocation for both.</span>
00579 <span class="comment">// Value data is appended that the end of value key.  DataCacheType indicates</span>
00580 <span class="comment">// whether data is cached and ValueKeySize tells how big is the value key (so</span>
00581 <span class="comment">// we can calculate the address of cached value data)</span>
00582 <span class="comment">//</span>
00583 <span class="comment">//</span>
00584 
<a name="l00585"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a40">00585</a> <span class="preprocessor">#define CM_CACHE_DATA_NOT_CACHED 0</span>
<a name="l00586"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a41">00586</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_CACHE_DATA_CACHED     1</span>
<a name="l00587"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a42">00587</a> <span class="preprocessor"></span><span class="preprocessor">#define CM_CACHE_DATA_TOO_BIG    2</span>
<a name="l00588"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a43">00588</a> <span class="preprocessor"></span><span class="preprocessor">#define MAXIMUM_CACHED_DATA   2048  // Maximum data size to be cached.</span>
00589 <span class="preprocessor"></span>
<a name="l00590"></a><a class="code" href="../../d3/d3/struct__CM__CACHED__VALUE__INDEX.html">00590</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d3/struct__CM__CACHED__VALUE__INDEX.html">_CM_CACHED_VALUE_INDEX</a> {
<a name="l00591"></a><a class="code" href="../../d3/d3/struct__CM__CACHED__VALUE__INDEX.html#o0">00591</a>     <a class="code" href="../../d0/d1/hivedata_8h.html#a49">HCELL_INDEX</a> <a class="code" href="../../d3/d3/struct__CM__CACHED__VALUE__INDEX.html#o0">CellIndex</a>;
00592     <span class="keyword">union </span>{
<a name="l00593"></a><a class="code" href="../../d3/d3/struct__CM__CACHED__VALUE__INDEX.html#o1">00593</a>         <a class="code" href="../../d4/d9/struct__CELL__DATA.html">CELL_DATA</a>        <a class="code" href="../../d3/d3/struct__CM__CACHED__VALUE__INDEX.html#o1">CellData</a>;
<a name="l00594"></a><a class="code" href="../../d3/d3/struct__CM__CACHED__VALUE__INDEX.html#o2">00594</a>         ULONG_PTR        <a class="code" href="../../d3/d3/struct__CM__CACHED__VALUE__INDEX.html#o2">List</a>[1];
00595     } Data;
00596 } <a class="code" href="../../d3/d3/struct__CM__CACHED__VALUE__INDEX.html">CM_CACHED_VALUE_INDEX</a>, *<a class="code" href="../../d3/d3/struct__CM__CACHED__VALUE__INDEX.html">PCM_CACHED_VALUE_INDEX</a>; <span class="comment">// This is only used as a pointer.</span>
00597 
<a name="l00598"></a><a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html">00598</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html">_CM_CACHED_VALUE</a> {
<a name="l00599"></a><a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html#o0">00599</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html#o0">DataCacheType</a>;
<a name="l00600"></a><a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html#o1">00600</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html#o1">ValueKeySize</a>;
<a name="l00601"></a><a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html#o2">00601</a>     <a class="code" href="../../d7/d5/struct__CM__KEY__VALUE.html">CM_KEY_VALUE</a>  <a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html#o2">KeyValue</a>;
00602 } <a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html">CM_CACHED_VALUE</a>, *<a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html">PCM_CACHED_VALUE</a>; <span class="comment">// This is only used as a pointer.</span>
00603 
<a name="l00604"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a94">00604</a> <span class="keyword">typedef</span> <a class="code" href="../../d9/d0/cmdata_8h.html#a93">PCM_CACHED_VALUE</a> *<a class="code" href="../../d2/d3/struct__CM__CACHED__VALUE.html">PPCM_CACHED_VALUE</a>;
00605 
<a name="l00606"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a44">00606</a> <span class="preprocessor">#define CMP_CELL_CACHED_MASK  1</span>
00607 <span class="preprocessor"></span>
<a name="l00608"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a45">00608</a> <span class="preprocessor">#define CMP_IS_CELL_CACHED(Cell) (((ULONG_PTR) (Cell) &amp; CMP_CELL_CACHED_MASK) &amp;&amp; ((Cell) != (ULONG_PTR) HCELL_NIL))</span>
<a name="l00609"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a46">00609</a> <span class="preprocessor"></span><span class="preprocessor">#define CMP_GET_CACHED_ADDRESS(Cell) (((ULONG_PTR) (Cell)) &amp; ~CMP_CELL_CACHED_MASK)</span>
<a name="l00610"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a47">00610</a> <span class="preprocessor"></span><span class="preprocessor">#define CMP_GET_CACHED_CELLDATA(Cell) (&amp;(((PCM_CACHED_VALUE_INDEX)(((ULONG_PTR) (Cell)) &amp; ~CMP_CELL_CACHED_MASK))-&gt;Data.CellData))</span>
<a name="l00611"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a48">00611</a> <span class="preprocessor"></span><span class="preprocessor">#define CMP_GET_CACHED_KEYVALUE(Cell) (&amp;(((PCM_CACHED_VALUE)(((ULONG_PTR) (Cell)) &amp; ~CMP_CELL_CACHED_MASK))-&gt;KeyValue))</span>
<a name="l00612"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a49">00612</a> <span class="preprocessor"></span><span class="preprocessor">#define CMP_GET_CACHED_CELL(Cell) (((PCM_CACHED_ENTRY)(((ULONG_PTR) (Cell)) &amp; ~CMP_CELL_CACHED_MASK))-&gt;CellIndex)</span>
<a name="l00613"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a50">00613</a> <span class="preprocessor"></span><span class="preprocessor">#define CMP_MARK_CELL_CACHED(Cell) (((ULONG_PTR) (Cell)) | CMP_CELL_CACHED_MASK)</span>
00614 <span class="preprocessor"></span>
<a name="l00615"></a><a class="code" href="../../d9/d0/cmdata_8h.html#a51">00615</a> <span class="preprocessor">#define CMP_GET_CACHED_CELL_INDEX(Cell) (PtrToUlong((PVOID) (Cell)))</span>
00616 <span class="preprocessor"></span>
00617 
00618 <span class="preprocessor">#endif //__CM_DATA__</span>
00619 <span class="preprocessor"></span>
00620 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:27 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
