<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ki.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ki.h File Reference</h1><code>#include "<a class="el" href="../../d0/d8/ntos_8h-source.html">ntos.h</a>"</code><br>
<code>#include "stdio.h"</code><br>
<code>#include "stdlib.h"</code><br>
<code>#include "zwapi.h"</code><br>

<p>
<a href="../../d1/d9/ki_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/struct__KAPC__RECORD.html">_KAPC_RECORD</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d0/structADJUST__INTERRUPT__TIME__CONTEXT.html">ADJUST_INTERRUPT_TIME_CONTEXT</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a0">ALERT_INCREMENT</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a1">BALANCE_INCREMENT</a>&nbsp;&nbsp;&nbsp;10</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a2">RESUME_INCREMENT</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a3">TIMER_EXPIRE_INCREMENT</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a4">TIME_CRITICAL_PRIORITY_BOUND</a>&nbsp;&nbsp;&nbsp;14</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a5">NIL</a>&nbsp;&nbsp;&nbsp;(PVOID)NULL</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a6">ClearMember</a>(Member, Set)&nbsp;&nbsp;&nbsp;Set = Set &amp; (~(1 &lt;&lt; (Member)))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a7">SetMember</a>(Member, Set)&nbsp;&nbsp;&nbsp;Set = Set | (1 &lt;&lt; (Member))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a8">FindFirstSetLeftMember</a>(Set, Member)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a9">KiLockApcQueue</a>(Thread, OldIrql)&nbsp;&nbsp;&nbsp;*(OldIrql) = KeAcquireSpinLockRaiseToSynch(&amp;(Thread)-&gt;ApcQueueLock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a10">KiUnlockApcQueue</a>(Thread, OldIrql)&nbsp;&nbsp;&nbsp;KeReleaseSpinLock(&amp;(Thread)-&gt;ApcQueueLock, (OldIrql))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a11">KiLockContextSwap</a>(OldIrql)&nbsp;&nbsp;&nbsp;*(OldIrql) = KeAcquireSpinLockRaiseToSynch(&amp;<a class="el" href="../../d0/d0/ki_8h.html#a40">KiContextSwapLock</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a12">KiUnlockContextSwap</a>(OldIrql)&nbsp;&nbsp;&nbsp;KeReleaseSpinLock(&amp;<a class="el" href="../../d0/d0/ki_8h.html#a40">KiContextSwapLock</a>, (OldIrql))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a13">KiQueuedSpinLockContext</a>(<a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>)&nbsp;&nbsp;&nbsp;(&amp;(KeGetCurrentPrcb()-&gt;LockQueue[<a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>]))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a14">KiBoostPriorityThread</a>(Thread, Increment)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a15">KiInsertWaitList</a>(_WaitMode, _Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a16">IPI_APC</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a17">IPI_DPC</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a18">IPI_FREEZE</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a19">IPI_PACKET_READY</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a20">IPI_SYNCH_REQUEST</a>&nbsp;&nbsp;&nbsp;0x10</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a21">IPI_INSTRUMENT_COUNT</a>(a, b)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a22">KiRemoveTreeTimer</a>(Timer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a23">KiRequestApcInterrupt</a>(Processor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a24">KiRequestDispatchInterrupt</a>(Processor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a25">KiWaitSatisfyAny</a>(_Object_, _Thread_)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a26">KiWaitSatisfyMutant</a>(_Object_, _Thread_)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a27">KiWaitSatisfyOther</a>(_Object_)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a28">KiEnableAlignmentExceptions</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a29">KiDisableAlignmentExceptions</a>()</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d5/struct__KAPC__RECORD.html">_KAPC_RECORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a30">KAPC_RECORD</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d5/struct__KAPC__RECORD.html">_KAPC_RECORD</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a31">PKAPC_RECORD</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a32">KIPI_REQUEST</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef ULONG_PTR(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a33">PKIPI_BROADCAST_WORKER</a> )(IN ULONG_PTR Argument)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a34">PADJUST_INTERRUPT_TIME_CONTEXT</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a> (IN KIRQL OldIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a85">KiTryToAcquireQueuedSpinLock</a> (IN <a class="el" href="../../d0/d8/struct__KSPIN__LOCK__QUEUE.html">PKSPIN_LOCK_QUEUE</a> QueuedLock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a86">ExpInitializeExecutive</a> (IN ULONG Number, IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a> LoaderBlock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a87">KiChannelInitialization</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a88">KiRundownChannel</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a89">KiIpiGenericCall</a> (IN <a class="el" href="../../d0/d0/ki_8h.html#a33">PKIPI_BROADCAST_WORKER</a> BroadcastFunction, IN ULONG_PTR Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a90">KiIpiSend</a> (IN KAFFINITY TargetProcessors, IN <a class="el" href="../../d0/d0/ki_8h.html#a32">KIPI_REQUEST</a> Request)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a> (IN KAFFINITY TargetProcessors, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a55">PKIPI_WORKER</a> WorkerFunction, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a92">KiIpiServiceRoutine</a> (IN struct _KTRAP_FRAME *TrapFrame, IN struct _KEXCEPTION_FRAME *ExceptionFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a94">KiIpiStallOnPacketTargets</a> (KAFFINITY TargetSet)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a95">KiActivateWaiterQueue</a> (IN <a class="el" href="../../d7/d7/struct__KQUEUE.html">PRKQUEUE</a> Queue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a96">KiAdjustInterruptTime</a> (IN LONGLONG TimeDelta)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a97">KiApcInterrupt</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a98">KiCallUserMode</a> (IN PVOID *OutputBuffer, IN PULONG OutputLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a99">KiCalibrateTimeAdjustment</a> (<a class="el" href="../../d0/d0/ki_8h.html#a34">PADJUST_INTERRUPT_TIME_CONTEXT</a> Adjust)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a100">KiChainedDispatch</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a101">KiComputeReciprocal</a> (IN LONG Divisor, OUT PCCHAR Shift)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a102">KiComputeTimerTableIndex</a> (IN LARGE_INTEGER Interval, IN LARGE_INTEGER CurrentCount, IN <a class="el" href="../../d3/d8/struct__KTIMER.html">PRKTIMER</a> Timer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PLARGE_INTEGER FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a103">KiComputeWaitInterval</a> (IN PLARGE_INTEGER OriginalTime, IN PLARGE_INTEGER DueTime, IN OUT PLARGE_INTEGER NewTime)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a104">KiContinue</a> (IN PCONTEXT ContextRecord, IN PKEXCEPTION_FRAME ExceptionFrame, IN PKTRAP_FRAME TrapFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a105">KiDeliverApc</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode, IN PKEXCEPTION_FRAME ExceptionFrame, IN PKTRAP_FRAME TrapFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a106">KiDisableInterrupts</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a107">KiRestoreInterrupts</a> (IN BOOLEAN Enable)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a108">KiDispatchException</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN PKEXCEPTION_FRAME ExceptionFrame, IN PKTRAP_FRAME TrapFrame, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode, IN BOOLEAN FirstChance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d9/ke_8h.html#a408">KCONTINUE_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a109">KiSetDebugProcessor</a> (IN PKTRAP_FRAME TrapFrame, IN PKEXCEPTION_FRAME ExceptionFrame, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a110">KiCopyInformation</a> (IN OUT PEXCEPTION_RECORD ExceptionRecord1, IN PEXCEPTION_RECORD ExceptionRecord2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a111">KiDispatchInterrupt</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a112">KiFindReadyThread</a> (IN ULONG Processor, KPRIORITY LowPriority)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a113">KiFloatingDispatch</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb</a> (IN BOOLEAN Invalid, IN PVOID Virtual)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a115">KiFlushMultipleTb</a> (IN BOOLEAN Invalid, IN PVOID *Virtual, IN ULONG <a class="el" href="../../d6/d0/cmdat_8c.html#a5">Count</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a116">KiGetUserModeStackAddress</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a117">KiInitializeContextThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread, IN <a class="el" href="../../d4/d9/ke_8h.html#a67">PKSYSTEM_ROUTINE</a> SystemRoutine, IN <a class="el" href="../../d4/d9/ke_8h.html#a66">PKSTART_ROUTINE</a> StartRoutine OPTIONAL, IN PVOID StartContext OPTIONAL, IN PCONTEXT ContextFrame OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a118">KiInitializeKernel</a> (IN <a class="el" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process, IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread, IN PVOID IdleStack, IN PKPRCB Prcb, IN CCHAR Number, IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a> LoaderBlock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a119">KiInitSystem</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a120">KiInitMachineDependent</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a121">KiInitializeUserApc</a> (IN PKEXCEPTION_FRAME ExceptionFrame, IN PKTRAP_FRAME TrapFrame, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> NormalRoutine, IN PVOID NormalContext, IN PVOID SystemArgument1, IN PVOID SystemArgument2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a122">KiInsertQueue</a> (IN <a class="el" href="../../d7/d7/struct__KQUEUE.html">PRKQUEUE</a> Queue, IN PLIST_ENTRY Entry, IN BOOLEAN Head)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a123">KiInsertQueueApc</a> (IN <a class="el" href="../../d1/d5/struct__KAPC.html">PKAPC</a> Apc, IN KPRIORITY Increment)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a124">KiInsertTreeTimer</a> (IN <a class="el" href="../../d3/d8/struct__KTIMER.html">PRKTIMER</a> Timer, IN LARGE_INTEGER Interval)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a125">KiInterruptDispatch</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a126">KiInterruptDispatchRaise</a> (IN <a class="el" href="../../d0/d7/struct__KINTERRUPT.html">PKINTERRUPT</a> Interrupt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a127">KiInterruptDispatchSame</a> (IN <a class="el" href="../../d0/d7/struct__KINTERRUPT.html">PKINTERRUPT</a> Interrupt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KIRQL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a128">KiLockDeviceQueue</a> (IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a> DeviceQueue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a129">KiPassiveRelease</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a130">KiRaiseException</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN PCONTEXT ContextRecord, IN PKEXCEPTION_FRAME ExceptionFrame, IN PKTRAP_FRAME TrapFrame, IN BOOLEAN FirstChance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a131">KiReadyThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LOGICAL FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a132">KiReinsertTreeTimer</a> (IN <a class="el" href="../../d3/d8/struct__KTIMER.html">PRKTIMER</a> Timer, IN ULARGE_INTEGER DueTime)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a133">KiSelectNextThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a134">KiSetSystemTime</a> (IN PLARGE_INTEGER NewTime, OUT PLARGE_INTEGER OldTime)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a135">KiSuspendNop</a> (IN struct <a class="el" href="../../d1/d5/struct__KAPC.html">_KAPC</a> *Apc, IN OUT <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> *NormalRoutine, IN OUT PVOID *NormalContext, IN OUT PVOID *SystemArgument1, IN OUT PVOID *SystemArgument2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a136">KiSuspendThread</a> (IN PVOID NormalContext, IN PVOID SystemArgument1, IN PVOID SystemArgument2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a137">KiSwapProcess</a> (IN <a class="el" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> NewProcess, IN <a class="el" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> OldProcess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG_PTR FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a138">KiSwapThread</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a139">KiThreadStartup</a> (IN PVOID StartContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a140">KiTimerExpiration</a> (IN <a class="el" href="../../d1/d6/struct__KDPC.html">PKDPC</a> Dpc, IN PVOID DeferredContext, IN PVOID SystemArgument1, IN PVOID SystemArgument2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a141">KiTimerListExpire</a> (IN PLIST_ENTRY ExpiredListHead, IN KIRQL OldIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a142">KiUnexpectedInterrupt</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a143">KiUnlockDeviceQueue</a> (IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a> DeviceQueue, IN KIRQL OldIrql)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a144">KiUnwaitThread</a> (IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread, IN LONG_PTR WaitStatus, IN KPRIORITY Increment)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a145">KiUserApcDispatcher</a> (IN PVOID NormalContext, IN PVOID SystemArgument1, IN PVOID SystemArgument2, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> NormalRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a146">KiUserExceptionDispatcher</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN PCONTEXT ContextFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a147">KiWaitSatisfyAll</a> (IN <a class="el" href="../../d4/d8/struct__KWAIT__BLOCK.html">PRKWAIT_BLOCK</a> WaitBlock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a148">KiWaitTest</a> (IN PVOID Object, IN KPRIORITY Increment)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a149">KiFreezeTargetExecution</a> (IN PKTRAP_FRAME TrapFrame, IN PKEXCEPTION_FRAME ExceptionFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a150">KiPollFreezeExecution</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a151">KiSaveProcessorState</a> (IN PKTRAP_FRAME TrapFrame, IN PKEXCEPTION_FRAME ExceptionFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a152">KiSaveProcessorControlState</a> (IN PKPROCESSOR_STATE ProcessorState)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a153">KiRestoreProcessorState</a> (IN PKTRAP_FRAME TrapFrame, IN PKEXCEPTION_FRAME ExceptionFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a154">KiRestoreProcessorControlState</a> (IN PKPROCESSOR_STATE ProcessorState)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a155">KiTryToAcquireSpinLock</a> (IN PKSPIN_LOCK SpinLock)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a35">KiQuantumEnd</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a36">KiDmaIoCoherency</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a37">KiMaximumDpcQueueDepth</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a38">KiMinimumDpcRate</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a39">KiAdjustDpcThreshold</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a40">KiContextSwapLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d9/ke_8h.html#a64">PKDEBUG_ROUTINE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a41">KiDebugRoutine</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d9/ke_8h.html#a65">PKDEBUG_SWITCH_ROUTINE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a42">KiDebugSwitchRoutine</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a43">KiDispatcherLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a44">KiDispatcherReadyListHead</a> [MAXIMUM_PRIORITY]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a45">KiFindFirstSetLeft</a> [256]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html">CALL_PERFORMANCE_DATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a46">KiFlushSingleCallData</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a47">KiHardwareTrigger</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KAFFINITY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a48">KiIdleSummary</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a49">KiFindLeftNibbleBitTable</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d6/struct__KEVENT.html">KEVENT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a50">KiSwapEvent</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a51">KiProcessInSwapListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a52">KiProcessOutSwapListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a53">KiStackInSwapListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a54">KiProfileSourceListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a55">KiProfileAlignmentFixup</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a56">KiProfileAlignmentFixupInterval</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a57">KiProfileAlignmentFixupCount</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a58">KiProfileInterval</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a59">KiProfileListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a60">KiProfileLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a61">KiReadySummary</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a62">KiArgumentTable</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a63">KiServiceLimit</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a64">KiServiceTable</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html">CALL_PERFORMANCE_DATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a65">KiSetEventCallData</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a66">KiTickOffset</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a67">KiTimeIncrementReciprocal</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a68">KiTimeIncrementShiftCount</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a69">KiTimerTableListHead</a> [TIMER_TABLE_SIZE]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KAFFINITY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a70">KiTimeProcessor</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d6/struct__KDPC.html">KDPC</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a71">KiTimerExpireDpc</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a72">KiFreezeExecutionLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a73">KiSlavesStartExecution</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d9/ke_8h.html#a120">PSWAP_CONTEXT_NOTIFY_ROUTINE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a74">KiSwapContextNotifyRoutine</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d9/ke_8h.html#a121">PTHREAD_SELECT_NOTIFY_ROUTINE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a75">KiThreadSelectNotifyRoutine</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d9/ke_8h.html#a122">PTIME_UPDATE_NOTIFY_ROUTINE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a76">KiTimeUpdateNotifyRoutine</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a77">KiWaitInListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a78">KiWaitOutListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html">CALL_PERFORMANCE_DATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a79">KiWaitSingleCallData</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a80">KiEnableTimerWatchdog</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a81">KiFreezeLockBackup</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a82">KiFreezeFlag</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>volatile ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/ki_8h.html#a83">KiSuspendState</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="ki.h::ALERT_INCREMENT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ALERT_INCREMENT&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00035">35</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00365">KeAlertResumeThread()</a>, and <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00281">KeAlertThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ki.h::BALANCE_INCREMENT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BALANCE_INCREMENT&nbsp;&nbsp;&nbsp;10          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00036">36</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/procobj_8c-source.html#l00405">KeDetachProcess()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01996">KeTerminateThread()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00512">KeUnstackDetachProcess()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00955">KiAttachProcess()</a>, and <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ki.h::ClearMember" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ClearMember          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Member,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Set&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;Set = Set &amp; (~(1 &lt;&lt; (Member)))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00058">58</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>, <a class="el" href="../../d0/d8/i386_2gdtsup_8c-source.html#l00117">KeI386SetGdtSelector()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01302">KeSetAffinityThread()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00391">KeThawExecution()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00095">KiFindReadyThread()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00644">KiFlushForwardProgressTbBuffer()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00595">KiInvalidateForwardProgressTbBuffer()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00732">KiScanReadyQueues()</a>, and <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00576">KiSetPriorityThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ki.h::FindFirstSetLeftMember" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FindFirstSetLeftMember          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Set,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Member&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                          \
    ULONG _Bit;                                                        \
    ULONG _Mask;                                                       \
    ULONG _Offset = 16;                                                \
    <span class="keywordflow">if</span> ((_Mask = Set &gt;&gt; 16) == 0) {                                    \
        _Offset = 0;                                                   \
        _Mask = Set;                                                   \
    }                                                                  \
    <span class="keywordflow">if</span> (_Mask &gt;&gt; 8) {                                                  \
        _Offset += 8;                                                  \
    }                                                                  \
    <span class="keywordflow">if</span> ((_Bit = Set &gt;&gt; _Offset) &amp; 0xf0) {                              \
        _Bit &gt;&gt;= 4;                                                    \
        _Offset += 4;                                                  \
    }                                                                  \
    *(Member) = <a class="code" href="../../d5/d9/kernldat_8c.html#a45">KiFindLeftNibbleBitTable</a>[_Bit] + _Offset;              \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00068">68</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00095">KiFindReadyThread()</a>, and <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="ki.h::IPI_APC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IPI_APC&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00279">279</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00196">KiIpiProcessRequests()</a>, and <a class="el" href="../../d5/d0/genmips_8c-source.html#l00130">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="ki.h::IPI_DPC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IPI_DPC&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00280">280</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d0/dpcobj_8c-source.html#l00089">KeInsertQueueDpc()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00196">KiIpiProcessRequests()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>, and <a class="el" href="../../d5/d0/genmips_8c-source.html#l00130">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="ki.h::IPI_FREEZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IPI_FREEZE&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00281">281</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>, <a class="el" href="../../d9/d5/alpha_2ipi_8c-source.html#l00130">KiIpiServiceRoutine()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00538">KiPollFreezeExecution()</a>, and <a class="el" href="../../d5/d0/genmips_8c-source.html#l00130">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="ki.h::IPI_INSTRUMENT_COUNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IPI_INSTRUMENT_COUNT          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>b&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00303">303</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00086">KeFlushEntireTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00231">KeFlushMultipleTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00420">KeFlushSingleTb()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00071">KeSweepDcache()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00202">KeSweepIcache()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00188">KiFlushEntireTbTarget()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00508">KiFlushIoBuffersTarget()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00353">KiFlushMultipleTbTarget()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00589">KiFlushSingleTbSynchronous()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00535">KiFlushSingleTbTarget()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00156">KiSweepDcacheTarget()</a>, and <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00287">KiSweepIcacheTarget()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="ki.h::IPI_PACKET_READY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IPI_PACKET_READY&nbsp;&nbsp;&nbsp;8          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00282">282</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d0/genmips_8c-source.html#l00130">main()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="ki.h::IPI_SYNCH_REQUEST" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IPI_SYNCH_REQUEST&nbsp;&nbsp;&nbsp;0x10          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00283">283</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="ki.h::KiBoostPriorityThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiBoostPriorityThread          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Thread,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Increment&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{              \
    KPRIORITY NewPriority;                                      \
    <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;                                          \
                                                                \
    <span class="keywordflow">if</span> ((Thread)-&gt;Priority &lt; LOW_REALTIME_PRIORITY) {           \
        <span class="keywordflow">if</span> ((Thread)-&gt;PriorityDecrement == 0) {                 \
            NewPriority = (Thread)-&gt;BasePriority + (<a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a>); \
            <span class="keywordflow">if</span> (NewPriority &gt; (Thread)-&gt;Priority) {             \
                <span class="keywordflow">if</span> (NewPriority &gt;= LOW_REALTIME_PRIORITY) {     \
                    NewPriority = LOW_REALTIME_PRIORITY - 1;    \
                }                                               \
                                                                \
                Process = (Thread)-&gt;ApcState.Process;           \
                (Thread)-&gt;Quantum = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a>;     \
                <a class="code" href="../../d4/d9/ke_8h.html#a353">KiSetPriorityThread</a>((Thread), NewPriority);     \
            }                                                   \
        }                                                       \
    }                                                           \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00179">179</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01257">Ke386VdmInsertQueueApc()</a>, and <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00459">KeBoostPriorityThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="ki.h::KiDisableAlignmentExceptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiDisableAlignmentExceptions          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01095">1095</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d7/profobj_8c-source.html#l00520">KeStopProfile()</a>, <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>, and <a class="el" href="../../d1/d7/profobj_8c-source.html#l00724">KiStopProfileInterrupt()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="ki.h::KiEnableAlignmentExceptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiEnableAlignmentExceptions          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01094">1094</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d7/profobj_8c-source.html#l00289">KeStartProfile()</a>, and <a class="el" href="../../d1/d7/profobj_8c-source.html#l00772">KiStartProfileInterrupt()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="ki.h::KiInsertWaitList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiInsertWaitList          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_WaitMode,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>_Thread&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                  \
    PLIST_ENTRY _ListHead;                                      \
    _ListHead = &amp;<a class="code" href="../../d5/d9/kernldat_8c.html#a61">KiWaitInListHead</a>;                              \
    <span class="keywordflow">if</span> (((_WaitMode) == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) ||                          \
        ((_Thread)-&gt;EnableStackSwap == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) ||                \
        ((_Thread)-&gt;Priority &gt;= (LOW_REALTIME_PRIORITY + 9))) { \
        _ListHead = &amp;<a class="code" href="../../d5/d9/kernldat_8c.html#a62">KiWaitOutListHead</a>;                         \
    }                                                           \
    InsertTailList(_ListHead, &amp;(_Thread)-&gt;WaitListEntry);       \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00225">225</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/wait_8c-source.html#l00140">KeDelayExecutionThread()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00238">KeRemoveQueue()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00395">KeWaitForMultipleObjects()</a>, and <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ki.h::KiLockApcQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiLockApcQueue          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Thread,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OldIrql&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;*(OldIrql) = KeAcquireSpinLockRaiseToSynch(&amp;(Thread)-&gt;ApcQueueLock)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00094">94</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00030">KiDeliverApc()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ki.h::KiLockContextSwap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiLockContextSwap          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OldIrql&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;*(OldIrql) = KeAcquireSpinLockRaiseToSynch(&amp;<a class="el" href="../../d0/d0/ki_8h.html#a40">KiContextSwapLock</a>)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00128">128</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00318">Ke386IoSetAccessProcess()</a>, <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00235">Ke386QueryIoAccessMap()</a>, <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00255">Ke386SetDescriptorProcess()</a>, <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00080">Ke386SetIoAccessMap()</a>, <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00063">Ke386SetLdtProcess()</a>, <a class="el" href="../../d9/d3/vdmint21_8c-source.html#l00064">Ke386SetVdmInterruptHandler()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00086">KeFlushEntireTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00231">KeFlushMultipleTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00587">KeFlushMultipleTb64()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00420">KeFlushSingleTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00797">KeFlushSingleTb64()</a>, <a class="el" href="../../d3/d5/ia64_2iopm_8c-source.html#l00048">KeIA32SetIoAccessMap()</a>, <a class="el" href="../../d1/d4/i386_2flush_8c-source.html#l00187">KeInvalidateAllCaches()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00955">KiAttachProcess()</a>, <a class="el" href="../../d9/d3/mtrr_8c-source.html#l01112">KiCompleteEffectiveRangeChange()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00589">KiFlushSingleTbSynchronous()</a>, <a class="el" href="../../d0/d3/pat_8c-source.html#l00119">KiInitializePAT()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00057">PspReaper()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ki.h::KiQueuedSpinLockContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiQueuedSpinLockContext          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(&amp;(KeGetCurrentPrcb()-&gt;LockQueue[<a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>]))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00149">149</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d8/kernlini_8c-source.html#l00246">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="ki.h::KiRemoveTreeTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiRemoveTreeTimer          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Timer&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(Timer)-&gt;Header.Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;          \
    RemoveEntryList(&amp;(Timer)-&gt;TimerListEntry)
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00755">755</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00157">KeCancelTimer()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00335">KeSetSystemTime()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00285">KeSetTimerEx()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00710">KiInsertQueue()</a>, <a class="el" href="../../d6/d1/timersup_8c-source.html#l00185">KiInsertTimerTable()</a>, <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00333">KiTimerListExpire()</a>, and <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00031">KiUnwaitThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="ki.h::KiRequestApcInterrupt" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiRequestApcInterrupt          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Processor&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><span class="keywordflow">if</span> (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number == (CCHAR)Processor) { \
        <a class="code" href="../../d9/d4/intsupc_8c.html#a3">KiRequestSoftwareInterrupt</a>(APC_LEVEL);            \
    } <span class="keywordflow">else</span> {                                              \
        <a class="code" href="../../d9/d3/mpipi_8c.html#a5">KiIpiSend</a>((KAFFINITY)(1 &lt;&lt; Processor), IPI_APC);  \
    }
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00767">767</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00223">KiInsertQueueApc()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="ki.h::KiRequestDispatchInterrupt" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiRequestDispatchInterrupt          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Processor&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><span class="keywordflow">if</span> (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;Number != (CCHAR)Processor) { \
        <a class="code" href="../../d9/d3/mpipi_8c.html#a5">KiIpiSend</a>((KAFFINITY)(1 &lt;&lt; Processor), IPI_DPC);  \
    }
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00782">782</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01302">KeSetAffinityThread()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>, and <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00576">KiSetPriorityThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ki.h::KiUnlockApcQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiUnlockApcQueue          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Thread,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OldIrql&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;KeReleaseSpinLock(&amp;(Thread)-&gt;ApcQueueLock, (OldIrql))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00101">101</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00030">KiDeliverApc()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ki.h::KiUnlockContextSwap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiUnlockContextSwap          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OldIrql&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;KeReleaseSpinLock(&amp;<a class="el" href="../../d0/d0/ki_8h.html#a40">KiContextSwapLock</a>, (OldIrql))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00131">131</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00318">Ke386IoSetAccessProcess()</a>, <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00235">Ke386QueryIoAccessMap()</a>, <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00255">Ke386SetDescriptorProcess()</a>, <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00080">Ke386SetIoAccessMap()</a>, <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00063">Ke386SetLdtProcess()</a>, <a class="el" href="../../d9/d3/vdmint21_8c-source.html#l00064">Ke386SetVdmInterruptHandler()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00086">KeFlushEntireTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00231">KeFlushMultipleTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00587">KeFlushMultipleTb64()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00420">KeFlushSingleTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00797">KeFlushSingleTb64()</a>, <a class="el" href="../../d3/d5/ia64_2iopm_8c-source.html#l00048">KeIA32SetIoAccessMap()</a>, <a class="el" href="../../d1/d4/i386_2flush_8c-source.html#l00187">KeInvalidateAllCaches()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00955">KiAttachProcess()</a>, <a class="el" href="../../d9/d3/mtrr_8c-source.html#l01112">KiCompleteEffectiveRangeChange()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00589">KiFlushSingleTbSynchronous()</a>, <a class="el" href="../../d0/d3/pat_8c-source.html#l00119">KiInitializePAT()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00057">PspReaper()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="ki.h::KiWaitSatisfyAny" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiWaitSatisfyAny          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_Object_,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>_Thread_&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                               \
    <span class="keywordflow">if</span> (((_Object_)-&gt;Header.Type &amp; <a class="code" href="../../d4/d9/ke_8h.html#a12">DISPATCHER_OBJECT_TYPE_MASK</a>) == <a class="code" href="../../d4/d9/ke_8h.html#a402a158">EventSynchronizationObject</a>) { \
        (_Object_)-&gt;Header.SignalState = 0;                                  \
                                                                             \
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((_Object_)-&gt;Header.Type == <a class="code" href="../../d4/d9/ke_8h.html#a402a162">SemaphoreObject</a>) {                 \
        (_Object_)-&gt;Header.SignalState -= 1;                                 \
                                                                             \
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((_Object_)-&gt;Header.Type == <a class="code" href="../../d4/d9/ke_8h.html#a402a159">MutantObject</a>) {                    \
        (_Object_)-&gt;Header.SignalState -= 1;                                 \
        <span class="keywordflow">if</span> ((_Object_)-&gt;Header.SignalState == 0) {                           \
            (_Thread_)-&gt;KernelApcDisable -= (_Object_)-&gt;ApcDisable;          \
            (_Object_)-&gt;OwnerThread = (_Thread_);                            \
            <span class="keywordflow">if</span> ((_Object_)-&gt;Abandoned == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {                             \
                (_Object_)-&gt;Abandoned = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;                               \
                (_Thread_)-&gt;WaitStatus = STATUS_ABANDONED;                   \
            }                                                                \
                                                                             \
            InsertHeadList((_Thread_)-&gt;MutantListHead.Blink,                 \
                           &amp;(_Object_)-&gt;MutantListEntry);                    \
        }                                                                    \
    }                                                                        \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00913">913</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00228">KiWaitSatisfyAll()</a>, and <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="ki.h::KiWaitSatisfyMutant" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiWaitSatisfyMutant          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_Object_,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>_Thread_&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                            \
    (_Object_)-&gt;Header.SignalState -= 1;                                     \
    <span class="keywordflow">if</span> ((_Object_)-&gt;Header.SignalState == 0) {                               \
        (_Thread_)-&gt;KernelApcDisable -= (_Object_)-&gt;ApcDisable;              \
        (_Object_)-&gt;OwnerThread = (_Thread_);                                \
        <span class="keywordflow">if</span> ((_Object_)-&gt;Abandoned == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {                                 \
            (_Object_)-&gt;Abandoned = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;                                   \
            (_Thread_)-&gt;WaitStatus = STATUS_ABANDONED;                       \
        }                                                                    \
                                                                             \
        InsertHeadList((_Thread_)-&gt;MutantListHead.Blink,                     \
                       &amp;(_Object_)-&gt;MutantListEntry);                        \
    }                                                                        \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00960">960</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/wait_8c-source.html#l00395">KeWaitForMultipleObjects()</a>, and <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="ki.h::KiWaitSatisfyOther" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define KiWaitSatisfyOther          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_Object_&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                                       \
    <span class="keywordflow">if</span> (((_Object_)-&gt;Header.Type &amp; <a class="code" href="../../d4/d9/ke_8h.html#a12">DISPATCHER_OBJECT_TYPE_MASK</a>) == <a class="code" href="../../d4/d9/ke_8h.html#a402a158">EventSynchronizationObject</a>) { \
        (_Object_)-&gt;Header.SignalState = 0;                                  \
                                                                             \
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((_Object_)-&gt;Header.Type == <a class="code" href="../../d4/d9/ke_8h.html#a402a162">SemaphoreObject</a>) {                 \
        (_Object_)-&gt;Header.SignalState -= 1;                                 \
                                                                             \
    }                                                                        \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00997">997</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/wait_8c-source.html#l00395">KeWaitForMultipleObjects()</a>, and <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ki.h::NIL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NIL&nbsp;&nbsp;&nbsp;(PVOID)NULL          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00050">50</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/apcobj_8c-source.html#l00039">KeInitializeApc()</a>, <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>, and <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ki.h::RESUME_INCREMENT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define RESUME_INCREMENT&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00037">37</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00365">KeAlertResumeThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00688">KeForceResumeThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00757">KeFreezeAllThreads()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01079">KeResumeThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01912">KeSuspendThread()</a>, and <a class="el" href="../../d0/d1/thredobj_8c-source.html#l02190">KeThawAllThreads()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ki.h::SetMember" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SetMember          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Member,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Set&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;Set = Set | (1 &lt;&lt; (Member))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00065">65</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00479">KiSelectNextThread()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00576">KiSetPriorityThread()</a>, <a class="el" href="../../d5/d0/genmips_8c-source.html#l00130">main()</a>, and <a class="el" href="../../d7/d0/yield_8c-source.html#l00029">NtYieldExecution()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ki.h::TIME_CRITICAL_PRIORITY_BOUND" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TIME_CRITICAL_PRIORITY_BOUND&nbsp;&nbsp;&nbsp;14          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00044">44</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/wait_8c-source.html#l00079">KiAdjustQuantumThread()</a>, and <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00031">KiUnwaitThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ki.h::TIMER_EXPIRE_INCREMENT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TIMER_EXPIRE_INCREMENT&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00038">38</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00285">KeSetTimerEx()</a>, and <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00333">KiTimerListExpire()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a30" doxytag="ki.h::KAPC_RECORD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d5/struct__KAPC__RECORD.html">_KAPC_RECORD</a>  <a class="el" href="../../d2/d5/struct__KAPC__RECORD.html">KAPC_RECORD</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d9/d6/i386_2apcuser_8c-source.html#l00029">KiInitializeUserApc()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="ki.h::KIPI_REQUEST" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef ULONG <a class="el" href="../../d0/d0/ki_8h.html#a32">KIPI_REQUEST</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00289">289</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="ki.h::PADJUST_INTERRUPT_TIME_CONTEXT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef   * <a class="el" href="../../d0/d0/ki_8h.html#a34">PADJUST_INTERRUPT_TIME_CONTEXT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="ki.h::PKAPC_RECORD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d5/struct__KAPC__RECORD.html">_KAPC_RECORD</a> * <a class="el" href="../../d2/d5/struct__KAPC__RECORD.html">PKAPC_RECORD</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="ki.h::PKIPI_BROADCAST_WORKER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef ULONG_PTR(* <a class="el" href="../../d0/d0/ki_8h.html#a33">PKIPI_BROADCAST_WORKER</a>)(IN ULONG_PTR Argument)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l00293">293</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00544">KiAdjustInterruptTime()</a>, <a class="el" href="../../d7/d8/kernlini_8c-source.html#l01691">KiInitMachineDependent()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00040">KiIpiGenericCall()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00132">KiIpiGenericCallTarget()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00787">KiSyncMC_Drain()</a>, and <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00885">KiSyncPrefetchVisible()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a86" doxytag="ki.h::ExpInitializeExecutive" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExpInitializeExecutive           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LoaderBlock</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a95" doxytag="ki.h::KiActivateWaiterQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL KiActivateWaiterQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d7/struct__KQUEUE.html">PRKQUEUE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Queue</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00649">649</a> of file <a class="el" href="../../d9/d2/queueobj_8c-source.html">queueobj.c</a>.
<p>
References <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00031">KiUnwaitThread()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00281">_KWAIT_BLOCK::Thread</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/wait_8c-source.html#l00140">KeDelayExecutionThread()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00238">KeRemoveQueue()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01996">KeTerminateThread()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00395">KeWaitForMultipleObjects()</a>, and <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>.
<p>
<pre class="fragment"><div>00655                    :
00656 
00657     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> about to enter a
00658     wait state and <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently processing a queue entry. The current
00659     number of threads processign entries <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queue <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> decrement and
00660     an attempt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to activate another thread <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current count
00661     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> less than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> maximum count, there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a waiting thread, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00662     queue <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not empty.
00663 
00664 Arguments:
00665 
00666     Queue - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> event.
00667 
00668 Return Value:
00669 
00670     None.
00671 
00672 --*/
00673 
00674 {
00675 
00676     PRLIST_ENTRY Entry;
00677     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread;
00678     <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">PRKWAIT_BLOCK</a> WaitBlock;
00679     PRLIST_ENTRY WaitEntry;
00680 
00681     <span class="comment">//</span>
00682     <span class="comment">// Decrement the current count of active threads and check if another</span>
00683     <span class="comment">// thread can be activated. If the current number of active threads is</span>
00684     <span class="comment">// less than the target maximum number of threads, there is a entry in</span>
00685     <span class="comment">// in the queue, and a thread is waiting, then remove the entry from the</span>
00686     <span class="comment">// queue, decrement the number of entries in the queue, and unwait the</span>
00687     <span class="comment">// respectiive thread.</span>
00688     <span class="comment">//</span>
00689 
00690     Queue-&gt;CurrentCount -= 1;
00691     <span class="keywordflow">if</span> (Queue-&gt;CurrentCount &lt; Queue-&gt;MaximumCount) {
00692         Entry = Queue-&gt;EntryListHead.Flink;
00693         WaitEntry = Queue-&gt;Header.WaitListHead.Blink;
00694         <span class="keywordflow">if</span> ((Entry != &amp;Queue-&gt;EntryListHead) &amp;&amp;
00695             (WaitEntry != &amp;Queue-&gt;Header.WaitListHead)) {
00696             RemoveEntryList(Entry);
00697             Entry-&gt;Flink = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00698             Queue-&gt;Header.SignalState -= 1;
00699             WaitBlock = CONTAINING_RECORD(WaitEntry, <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">KWAIT_BLOCK</a>, WaitListEntry);
00700             Thread = WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o1">Thread</a>;
00701             <a class="code" href="../../d2/d7/waitsup_8c.html#a0">KiUnwaitThread</a>(Thread, (LONG_PTR)Entry, 0);
00702         }
00703     }
00704 
00705     <span class="keywordflow">return</span>;
00706 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a96" doxytag="ki.h::KiAdjustInterruptTime" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiAdjustInterruptTime           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LONGLONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TimeDelta</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00544">544</a> of file <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html">ke/miscc.c</a>.
<p>
References <a class="el" href="../../d1/d9/ki_8h-source.html#l00430">ADJUST_INTERRUPT_TIME_CONTEXT::Adjustment</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00434">ADJUST_INTERRUPT_TIME_CONTEXT::Barrier</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00433">ADJUST_INTERRUPT_TIME_CONTEXT::HalNumber</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02776">KeNumberProcessors</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00592">KiCalibrateTimeAdjustment()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00040">KiIpiGenericCall()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00432">ADJUST_INTERRUPT_TIME_CONTEXT::KiNumber</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00293">PKIPI_BROADCAST_WORKER</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00335">KeSetSystemTime()</a>, and <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00078">KeStartAllProcessors()</a>.
<p>
<pre class="fragment"><div>00549                    :
00550 
00551     This function moves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> physical interrupt time of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system
00552     foreward by TimeDelta after a system wake has occurred.
00553 
00554 Arguments:
00555 
00556     TimeDelta - amount of time to bump foreward interrupt time, tick
00557                 count and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> perforamnce counter in 100ns units
00558 
00559 Return Value:
00560 
00561     None.
00562 
00563 --*/
00564 {
00565     <a class="code" href="../../d7/d0/structADJUST__INTERRUPT__TIME__CONTEXT.html">ADJUST_INTERRUPT_TIME_CONTEXT</a> Adjust;
00566 
00567     <span class="comment">//</span>
00568     <span class="comment">// Can only move time foreward</span>
00569     <span class="comment">//</span>
00570 
00571     <span class="keywordflow">if</span> (TimeDelta &lt; 0) {
00572 
00573         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00574 
00575     } <span class="keywordflow">else</span> {
00576 
00577         Adjust.<a class="code" href="../../d7/d0/structADJUST__INTERRUPT__TIME__CONTEXT.html#o2">KiNumber</a> = <a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>;
00578         Adjust.<a class="code" href="../../d7/d0/structADJUST__INTERRUPT__TIME__CONTEXT.html#o3">HalNumber</a> = <a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>;
00579         Adjust.<a class="code" href="../../d7/d0/structADJUST__INTERRUPT__TIME__CONTEXT.html#o0">Adjustment</a> = (ULONGLONG) TimeDelta;
00580         Adjust.<a class="code" href="../../d7/d0/structADJUST__INTERRUPT__TIME__CONTEXT.html#o4">Barrier</a> = 1;
00581 
00582         <a class="code" href="../../d2/d1/xipi_8c.html#a1">KiIpiGenericCall</a> (
00583             (PKIPI_BROADCAST_WORKER) KiCalibrateTimeAdjustment,
00584             (ULONG_PTR)(&amp;Adjust)
00585         );
00586 
00587         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00588     }
00589 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a97" doxytag="ki.h::KiApcInterrupt" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiApcInterrupt           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a99" doxytag="ki.h::KiCalibrateTimeAdjustment" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiCalibrateTimeAdjustment           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d0/ki_8h.html#a34">PADJUST_INTERRUPT_TIME_CONTEXT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Adjust</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00592">592</a> of file <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html">ke/miscc.c</a>.
<p>
References <a class="el" href="../../d2/d7/hal_8h.html#a171">HalCalibratePerformanceCounter()</a>, <a class="el" href="../../d5/d0/dpcobj_8c-source.html#l00089">KeInsertQueueDpc()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02769">KeInterruptTimeBias</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02774">KeMaximumIncrement</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00122">KeQueryInterruptTime()</a>, <a class="el" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter()</a>, <a class="el" href="../../d5/d0/dpcobj_8c-source.html#l00272">KeRemoveQueueDpc()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02797">KeTickCount</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02813">KeTimeIncrement</a>, <a class="el" href="../../d0/d0/ki_8h.html#a106">KiDisableInterrupts()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00538">KiPollFreezeExecution()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a107">KiRestoreInterrupts()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l01139">KiTickOffset</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00497">KiTimerExpireDpc</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d0/largeic_8c-source.html#l00040">RtlExtendedLargeIntegerDivide()</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00094">TIMER_TABLE_SIZE</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00544">KiAdjustInterruptTime()</a>.
<p>
<pre class="fragment"><div>00597                    :
00598 
00599     Worker function <span class="keywordflow">for</span> <a class="code" href="../../d0/d0/ki_8h.html#a96">KiAdjustInterruptTime</a> to calibrate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00600     adjustment of time on all processors.
00601 
00602 Arguments:
00603 
00604     Adjust - context structure <span class="keywordflow">for</span> operation
00605 
00606 Return Value:
00607 
00608     None.
00609 
00610 --*/
00611 {
00612     BOOLEAN             Enable;
00613     LARGE_INTEGER       InterruptTime;
00614     LARGE_INTEGER       SetTime;
00615     LARGE_INTEGER       PerfFreq;
00616     ULARGE_INTEGER      li;
00617     LARGE_INTEGER       NewTickCount;
00618     ULONG               NewTickOffset;
00619     ULONG               cl, divisor;
00620 
00621     <span class="comment">//</span>
00622     <span class="comment">// As each processor arrives, subtract one off the remaining processor</span>
00623     <span class="comment">// count.  If this is the last processor to arrive compute the time</span>
00624     <span class="comment">// change, and signal all processor when to applied the performance</span>
00625     <span class="comment">// counter change.</span>
00626     <span class="comment">//</span>
00627 
00628     <span class="keywordflow">if</span> (InterlockedDecrement((PLONG) &amp;Adjust-&gt;KiNumber)) {
00629 
00630         Enable = <a class="code" href="../../d0/d0/ki_8h.html#a106">KiDisableInterrupts</a>();
00631 
00632         <span class="comment">//</span>
00633         <span class="comment">// It is possible to deadlock here if one or more of the</span>
00634         <span class="comment">// other processors gets and processes a freeze request</span>
00635         <span class="comment">// while this processor has interrupts disabled.  Poll</span>
00636         <span class="comment">// for IPI_FREEZE requests until all processors are known</span>
00637         <span class="comment">// to be in this code and hence wont be requesting a </span>
00638         <span class="comment">// freeze.</span>
00639         <span class="comment">//</span>
00640 
00641         <span class="keywordflow">do</span> {
00642             <a class="code" href="../../d0/d0/ki_8h.html#a150">KiPollFreezeExecution</a>();
00643         } <span class="keywordflow">while</span> (Adjust-&gt;KiNumber != (ULONG)-1);
00644 
00645         <span class="comment">//</span>
00646         <span class="comment">// Wait to perform the time set</span>
00647         <span class="comment">//</span>
00648 
00649         <span class="keywordflow">while</span> (Adjust-&gt;Barrier) ;
00650 
00651     } <span class="keywordflow">else</span> {
00652 
00653         <span class="comment">//</span>
00654         <span class="comment">// Set timer expiration dpc to scan the timer queues once</span>
00655         <span class="comment">// for any expired timers</span>
00656         <span class="comment">//</span>
00657 
00658         <a class="code" href="../../d4/d1/dpcobj_8c.html#a3">KeRemoveQueueDpc</a> (&amp;KiTimerExpireDpc);
00659         <a class="code" href="../../d4/d1/dpcobj_8c.html#a2">KeInsertQueueDpc</a> (&amp;KiTimerExpireDpc, (PVOID) TIMER_TABLE_SIZE, NULL);
00660 
00661         <span class="comment">//</span>
00662         <span class="comment">// Disable interrupts and indicate that this processor is now</span>
00663         <span class="comment">// in final portion of this code.</span>
00664         <span class="comment">//</span>
00665 
00666         Enable = <a class="code" href="../../d0/d0/ki_8h.html#a106">KiDisableInterrupts</a>();
00667         InterlockedDecrement((PLONG) &amp;Adjust-&gt;KiNumber);
00668 
00669         <span class="comment">//</span>
00670         <span class="comment">// Get the current times</span>
00671         <span class="comment">//</span>
00672 
00673         <a class="code" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter</a> (&amp;PerfFreq);
00674         InterruptTime.QuadPart = <a class="code" href="../../d7/d0/ke_2miscc_8c.html#a2">KeQueryInterruptTime</a>() + Adjust-&gt;Adjustment;
00675         SetTime.QuadPart = InterruptTime.QuadPart + <a class="code" href="../../d4/d9/ke_8h.html#a153">KeTimeIncrement</a> / 2;
00676 
00677         <span class="comment">//</span>
00678         <span class="comment">// Compute performance counter for current SetTime</span>
00679         <span class="comment">//</span>
00680 
00681         <span class="comment">//</span>
00682         <span class="comment">// Multiply SetTime * PerfCount and obtain 96bit result</span>
00683         <span class="comment">// in cl, li.LowPart, li.HighPart.  Then divide the 96bit</span>
00684         <span class="comment">// result by 10,000,000 to get new performance counter value.</span>
00685         <span class="comment">//</span>
00686 
00687         li.QuadPart = RtlEnlargedUnsignedMultiply (
00688                             (ULONG) SetTime.LowPart,
00689                             (ULONG) PerfFreq.LowPart
00690                             ).QuadPart;
00691 
00692         cl = li.LowPart;
00693         li.QuadPart = li.HighPart +
00694                       RtlEnlargedUnsignedMultiply (
00695                             (ULONG) SetTime.LowPart,
00696                             (ULONG) PerfFreq.HighPart
00697                             ).QuadPart;
00698 
00699         li.QuadPart = li.QuadPart +
00700                       RtlEnlargedUnsignedMultiply (
00701                             (ULONG) SetTime.HighPart,
00702                             (ULONG) PerfFreq.LowPart
00703                             ).QuadPart;
00704 
00705         li.HighPart = li.HighPart + SetTime.HighPart * PerfFreq.HighPart;
00706 
00707         divisor = 10000000;
00708         Adjust-&gt;NewCount.HighPart =
00709             RtlEnlargedUnsignedDivide (
00710                 li,
00711                 divisor,
00712                 &amp;li.HighPart
00713                 );
00714 
00715         li.LowPart = cl;
00716         Adjust-&gt;NewCount.LowPart =
00717             RtlEnlargedUnsignedDivide (
00718                 li,
00719                 divisor,
00720                 NULL
00721                 );
00722 
00723         <span class="comment">//</span>
00724         <span class="comment">// Compute tick count and tick offset for current InterruptTime</span>
00725         <span class="comment">//</span>
00726 
00727         NewTickCount = <a class="code" href="../../d0/d1/largeic_8c.html#a0">RtlExtendedLargeIntegerDivide</a>(
00728                             InterruptTime,
00729                             KeMaximumIncrement,
00730                             &amp;NewTickOffset
00731                             );
00732 
00733         <span class="comment">//</span>
00734         <span class="comment">// Apply changes to InterruptTime, TickCount, TickOffset, and the</span>
00735         <span class="comment">// performance counter</span>
00736         <span class="comment">//</span>
00737 
00738         <a class="code" href="../../d0/d0/ki_8h.html#a66">KiTickOffset</a> = <a class="code" href="../../d4/d9/ke_8h.html#a131">KeMaximumIncrement</a> - NewTickOffset;
00739         <a class="code" href="../../d4/d9/ke_8h.html#a126">KeInterruptTimeBias</a> += Adjust-&gt;Adjustment;
00740         SharedUserData-&gt;TickCountLow = NewTickCount.LowPart;
00741 
00742 <span class="preprocessor">#if defined(_WIN64)</span>
00743 <span class="preprocessor"></span>
00744         <a class="code" href="../../d4/d9/ke_8h.html#a147">KeTickCount</a> = NewTickCount.QuadPart;
00745         SharedUserData-&gt;InterruptHigh2Time = InterruptTime.HighPart;
00746         SharedUserData-&gt;InterruptTime = InterruptTime.QuadPart;
00747 
00748 <span class="preprocessor">#elif defined(ALPHA)</span>
00749 <span class="preprocessor"></span>
00750         <a class="code" href="../../d4/d9/ke_8h.html#a147">KeTickCount</a> = NewTickCount.QuadPart;
00751         SharedUserData-&gt;InterruptTime = InterruptTime.QuadPart;
00752 
00753 <span class="preprocessor">#else</span>
00754 <span class="preprocessor"></span>        <a class="code" href="../../d4/d9/ke_8h.html#a147">KeTickCount</a>.High2Time = NewTickCount.HighPart;
00755         <a class="code" href="../../d4/d9/ke_8h.html#a147">KeTickCount</a>.LowPart   = NewTickCount.LowPart;
00756         <a class="code" href="../../d4/d9/ke_8h.html#a147">KeTickCount</a>.High1Time = NewTickCount.HighPart;
00757 
00758         SharedUserData-&gt;InterruptTime.High2Time = InterruptTime.HighPart;
00759         SharedUserData-&gt;InterruptTime.LowPart   = InterruptTime.LowPart;
00760         SharedUserData-&gt;InterruptTime.High1Time = InterruptTime.HighPart;
00761 <span class="preprocessor">#endif</span>
00762 <span class="preprocessor"></span>
00763         <span class="comment">//</span>
00764         <span class="comment">// Apply the performance counter change</span>
00765         <span class="comment">//</span>
00766 
00767         Adjust-&gt;Barrier = 0;
00768     }
00769 
00770     <a class="code" href="../../d2/d7/hal_8h.html#a171">HalCalibratePerformanceCounter</a> (
00771         (<span class="keyword">volatile</span> PLONG) &amp;Adjust-&gt;HalNumber,
00772         (ULONGLONG) Adjust-&gt;NewCount.QuadPart
00773         );
00774 
00775     <a class="code" href="../../d0/d0/ki_8h.html#a107">KiRestoreInterrupts</a>(Enable);
00776 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a98" doxytag="ki.h::KiCallUserMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS KiCallUserMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>OutputLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02838">KdpGetVersion()</a>, and <a class="el" href="../../d4/d3/ke_2alpha_2callback_8c-source.html#l00028">KeUserModeCallback()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a100" doxytag="ki.h::KiChainedDispatch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiChainedDispatch           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00154">KeConnectInterrupt()</a>, <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00298">KeDisconnectInterrupt()</a>, and <a class="el" href="../../d5/d3/i386_2intobj_8c-source.html#l00558">KiGetVectorInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a87" doxytag="ki.h::KiChannelInitialization" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiChannelInitialization           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00041">KeInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a101" doxytag="ki.h::KiComputeReciprocal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER KiComputeReciprocal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Divisor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Shift</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00237">237</a> of file <a class="el" href="../../d3/d9/kiinit_8c-source.html">kiinit.c</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.
<p>
<pre class="fragment"><div>00244                    :
00245 
00246     This function computes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> large integer reciprocal of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00247     value.
00248 
00249 Arguments:
00250 
00251     Divisor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value <span class="keywordflow">for</span> which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> large integer reciprocal <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00252         computed.
00253 
00254     Shift - Supplies a pointer to a variable that receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> computed
00255         shift count.
00256 
00257 Return Value:
00258 
00259     The large integer reciprocal <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> fucntion value.
00260 
00261 --*/
00262 
00263 {
00264 
00265     LARGE_INTEGER Fraction;
00266     LONG NumberBits;
00267     LONG Remainder;
00268 
00269     <span class="comment">//</span>
00270     <span class="comment">// Compute the large integer reciprocal of the specified value.</span>
00271     <span class="comment">//</span>
00272 
00273     NumberBits = 0;
00274     Remainder = 1;
00275     Fraction.LowPart = 0;
00276     Fraction.HighPart = 0;
00277     <span class="keywordflow">while</span> (Fraction.HighPart &gt;= 0) {
00278         NumberBits += 1;
00279         Fraction.HighPart = (Fraction.HighPart &lt;&lt; 1) | (Fraction.LowPart &gt;&gt; 31);
00280         Fraction.LowPart &lt;&lt;= 1;
00281         Remainder &lt;&lt;= 1;
00282         <span class="keywordflow">if</span> (Remainder &gt;= Divisor) {
00283             Remainder -= Divisor;
00284             Fraction.LowPart |= 1;
00285         }
00286     }
00287 
00288     <span class="keywordflow">if</span> (Remainder != 0) {
00289         <span class="keywordflow">if</span> ((Fraction.LowPart == 0xffffffff) &amp;&amp; (Fraction.HighPart == 0xffffffff)) {
00290             Fraction.LowPart = 0;
00291             Fraction.HighPart = 0x80000000;
00292             NumberBits -= 1;
00293 
00294         } <span class="keywordflow">else</span> {
00295             <span class="keywordflow">if</span> (Fraction.LowPart == 0xffffffff) {
00296                 Fraction.LowPart = 0;
00297                 Fraction.HighPart += 1;
00298 
00299             } <span class="keywordflow">else</span> {
00300                 Fraction.LowPart += 1;
00301             }
00302         }
00303     }
00304 
00305     <span class="comment">//</span>
00306     <span class="comment">// Compute the shift count value and return the reciprocal fraction.</span>
00307     <span class="comment">//</span>
00308 
00309     *Shift = (CCHAR)(NumberBits - 64);
00310     <span class="keywordflow">return</span> Fraction;
00311 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a102" doxytag="ki.h::KiComputeTimerTableIndex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG KiComputeTimerTableIndex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>Interval</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>CurrentCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d3/d8/struct__KTIMER.html">PRKTIMER</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Timer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d1/timersup_8c-source.html#l00185">KiInsertTimerTable()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a103" doxytag="ki.h::KiComputeWaitInterval" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PLARGE_INTEGER FASTCALL KiComputeWaitInterval           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>OriginalTime</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>DueTime</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>NewTime</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d6/wait_8c-source.html#l01175">1175</a> of file <a class="el" href="../../d2/d6/wait_8c-source.html">wait.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/wait_8c-source.html#l00140">KeDelayExecutionThread()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00238">KeRemoveQueue()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00395">KeWaitForMultipleObjects()</a>, and <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>.
<p>
<pre class="fragment"><div>01183                    :
01184 
01185     This function recomputes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> wait interval after a thread has been
01186     awakened to deliver a kernel APC.
01187 
01188 Arguments:
01189 
01190     OriginalTime - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> original timeout value.
01191 
01192     DueTime - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous due time.
01193 
01194     NewTime - Supplies a pointer to a variable that receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01195         recomputed wait interval.
01196 
01197 Return Value:
01198 
01199     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> time <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
01200 
01201 --*/
01202 
01203 {
01204 
01205     <span class="comment">//</span>
01206     <span class="comment">// If the original wait time was absolute, then return the same</span>
01207     <span class="comment">// absolute time. Otherwise, reduce the wait time remaining before</span>
01208     <span class="comment">// the time delay expires.</span>
01209     <span class="comment">//</span>
01210 
01211     <span class="keywordflow">if</span> (OriginalTime-&gt;QuadPart &gt;= 0) {
01212         <span class="keywordflow">return</span> OriginalTime;
01213 
01214     } <span class="keywordflow">else</span> {
01215         KiQueryInterruptTime(NewTime);
01216         NewTime-&gt;QuadPart -= DueTime-&gt;QuadPart;
01217         <span class="keywordflow">return</span> NewTime;
01218     }
01219 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a104" doxytag="ki.h::KiContinue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS KiContinue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/raisexcp_8c-source.html#l00099">99</a> of file <a class="el" href="../../d6/d3/raisexcp_8c-source.html">raisexcp.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00230">KeContextToKframes()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d6/d3/raisexcp_8c-source.html#l00037">KiContinuePreviousModeUser()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00107                    :
00108 
00109     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to copy <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified context frame to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00110     specified exception and trap frames <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">continue</span> system service.
00111 
00112 Arguments:
00113 
00114     ContextRecord - Supplies a pointer to a context record.
00115 
00116     ExceptionFrame - Supplies a pointer to an exception frame.
00117 
00118     TrapFrame - Supplies a pointer to a trap frame.
00119 
00120 Return Value:
00121 
00122     STATUS_ACCESS_VIOLATION <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context record <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not readable
00123         from user mode.
00124 
00125     STATUS_DATATYPE_MISALIGNMENT <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context record <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
00126         properly aligned.
00127 
00128     STATUS_SUCCESS <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context frame <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> copied successfully
00129         to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified exception and trap frames.
00130 
00131 --*/
00132 
00133 {
00134     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00135     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00136     KIRQL OldIrql;
00137     BOOLEAN IrqlChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00138 
00139     <span class="comment">//</span>
00140     <span class="comment">// Synchronize with other context operations.</span>
00141     <span class="comment">//</span>
00142 
00143     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00144     <span class="keywordflow">if</span> (KeGetCurrentIrql() &lt; <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) {
00145 
00146         <span class="comment">//</span>
00147         <span class="comment">// To support try-except and ExRaiseStatus in device driver code we</span>
00148         <span class="comment">// need to check if we are already at raised level.</span>
00149         <span class="comment">//</span>
00150 
00151         IrqlChanged = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00152         <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(APC_LEVEL, &amp;OldIrql);
00153     }
00154 
00155     <span class="comment">//</span>
00156     <span class="comment">// Establish an exception handler and probe and capture the specified</span>
00157     <span class="comment">// context record if the previous mode is user. If the probe or copy</span>
00158     <span class="comment">// fails, then return the exception code as the function value. Else</span>
00159     <span class="comment">// copy the context record to the specified exception and trap frames,</span>
00160     <span class="comment">// and return success as the function value.</span>
00161     <span class="comment">//</span>
00162 
00163     <span class="keywordflow">try</span> {
00164 
00165         <span class="comment">//</span>
00166         <span class="comment">// Get the previous processor mode. If the previous processor mode is</span>
00167         <span class="comment">// user, then probe and copy the specified context record.</span>
00168         <span class="comment">//</span>
00169 
00170         PreviousMode = KeGetPreviousMode();
00171         <span class="keywordflow">if</span> (PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00172             <a class="code" href="../../d5/d4/raisexcp_8c.html#a0">KiContinuePreviousModeUser</a>(ContextRecord,
00173                                        ExceptionFrame,
00174                                        TrapFrame,
00175                                        PreviousMode);
00176         } <span class="keywordflow">else</span> {
00177 
00178             <span class="comment">//</span>
00179             <span class="comment">// Move information from the context record to the exception</span>
00180             <span class="comment">// and trap frames.</span>
00181             <span class="comment">//</span>
00182 
00183             <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a10">KeContextToKframes</a>(TrapFrame,
00184                                ExceptionFrame,
00185                                ContextRecord,
00186                                ContextRecord-&gt;ContextFlags,
00187                                PreviousMode);
00188         }
00189 
00190     <span class="comment">//</span>
00191     <span class="comment">// If an exception occurs during the probe or copy of the context</span>
00192     <span class="comment">// record, then always handle the exception and return the exception</span>
00193     <span class="comment">// code as the status value.</span>
00194     <span class="comment">//</span>
00195 
00196     } except(EXCEPTION_EXECUTE_HANDLER) {
00197         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00198     }
00199 
00200     <span class="keywordflow">if</span> (IrqlChanged) {
00201         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a> (OldIrql);
00202     }
00203 
00204     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00205 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a110" doxytag="ki.h::KiCopyInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG KiCopyInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html#l00984">984</a> of file <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html">alpha/exceptn.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00309">Ki386CheckDelayedNpxTrap()</a>, <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html#l00412">KiDispatchException()</a>, <a class="el" href="../../d3/d1/byteem_8c-source.html#l00049">KiEmulateByteWord()</a>, <a class="el" href="../../d8/d4/ppc_2alignem_8c-source.html#l00754">KiEmulateDcbz()</a>, <a class="el" href="../../d2/d3/alpha_2floatem_8c-source.html#l00296">KiEmulateFloating()</a>, <a class="el" href="../../d5/d4/alpha_2alignem_8c-source.html#l00160">KiEmulateReference()</a>, and <a class="el" href="../../d8/d6/alpha_2apcuser_8c-source.html#l00033">KiInitializeUserApc()</a>.
<p>
<pre class="fragment"><div>00991                    :
00992 
00993     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called from an exception filter to copy <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception
00994     information from one exception record to another when an exception occurs.
00995 
00996 Arguments:
00997 
00998     ExceptionRecord1 - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> destination exception record.
00999 
01000     ExceptionRecord2 - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source exception record.
01001 
01002 Return Value:
01003 
01004     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
01005 
01006 --*/
01007 
01008 {
01009 
01010     <span class="comment">//</span>
01011     <span class="comment">// Copy one exception record to another and return value that causes</span>
01012     <span class="comment">// an exception handler to be executed.</span>
01013     <span class="comment">//</span>
01014 
01015     RtlMoveMemory((PVOID)ExceptionRecord1,
01016                   (PVOID)ExceptionRecord2,
01017                   <span class="keyword">sizeof</span>(EXCEPTION_RECORD));
01018 
01019     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>;
01020 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a105" doxytag="ki.h::KiDeliverApc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiDeliverApc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00030">30</a> of file <a class="el" href="../../d7/d6/apcsup_8c-source.html">apcsup.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00243">_KAPC_STATE::ApcListHead</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00254">_KAPC::Inserted</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00596">_KTHREAD::KernelApcDisable</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00245">_KAPC_STATE::KernelApcInProgress</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00246">_KAPC_STATE::KernelApcPending</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00241">_KAPC::KernelRoutine</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l02121">KeTestAlertThread()</a>, <a class="el" href="../../d2/d7/ppc_2apcuser_8c-source.html#l00034">KiInitializeUserApc()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00094">KiLockApcQueue</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00101">KiUnlockApcQueue</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00244">_KAPC::NormalContext</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00243">_KAPC::NormalRoutine</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00204">PKKERNEL_ROUTINE</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00196">PKNORMAL_ROUTINE</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00250">_KAPC::SystemArgument1</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00251">_KAPC::SystemArgument2</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00247">_KAPC_STATE::UserApcPending</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/intsupc_8c-source.html#l00032">KiDispatchSoftwareInterrupt()</a>.
<p>
<pre class="fragment"><div>00038                    :
00039 
00040     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC interrupt code and when one or
00041     more of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC pending flags are set at system <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a> and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous
00042     IRQL <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> zero. All special kernel APC's are delivered first, followed
00043     by normal kernel APC's <span class="keywordflow">if</span> one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not already in progress, and finally
00044     <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user APC queue <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not empty, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user APC pending flag <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set,
00045     and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> user, then a user APC <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> delivered. On entry
00046     to <span class="keyword">this</span> routine IRQL <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set to <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>.
00047 
00048     N.B. The exception frame and trap frame addresses are <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> guaranteed
00049          to be valid <span class="keywordflow">if</span>, and <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> <span class="keywordflow">if</span>, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> user.
00050 
00051 Arguments:
00052 
00053     PreviousMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous processor mode.
00054 
00055     ExceptionFrame - Supplies a pointer to an exception frame.
00056 
00057     TrapFrame - Supplies a pointer to a trap frame.
00058 
00059 Return Value:
00060 
00061     None.
00062 
00063 --*/
00064 
00065 {
00066 
00067     <a class="code" href="../../d1/d5/struct__KAPC.html">PKAPC</a> Apc;
00068     <a class="code" href="../../d0/d9/ntosdef_8h.html#a42">PKKERNEL_ROUTINE</a> KernelRoutine;
00069     PLIST_ENTRY NextEntry;
00070     PVOID NormalContext;
00071     <a class="code" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> NormalRoutine;
00072     KIRQL OldIrql;
00073     PVOID SystemArgument1;
00074     PVOID SystemArgument2;
00075     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
00076 
00077     <span class="comment">//</span>
00078     <span class="comment">// Raise IRQL to dispatcher level and lock the APC queue.</span>
00079     <span class="comment">//</span>
00080 
00081     Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00082     <a class="code" href="../../d0/d0/ki_8h.html#a9">KiLockApcQueue</a>(Thread, &amp;OldIrql);
00083 
00084     <span class="comment">//</span>
00085     <span class="comment">// Get address of current thread object, clear kernel APC pending, and</span>
00086     <span class="comment">// check if any kernel mode APC's can be delivered.</span>
00087     <span class="comment">//</span>
00088 
00089     Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o3">KernelApcPending</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00090     <span class="keywordflow">while</span> (IsListEmpty(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o0">ApcListHead</a>[KernelMode]) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00091         NextEntry = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o0">ApcListHead</a>[<a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>].Flink;
00092         Apc = CONTAINING_RECORD(NextEntry, <a class="code" href="../../d1/d5/struct__KAPC.html">KAPC</a>, ApcListEntry);
00093         KernelRoutine = Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o5">KernelRoutine</a>;
00094         NormalRoutine = Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o7">NormalRoutine</a>;
00095         NormalContext = Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o8">NormalContext</a>;
00096         SystemArgument1 = Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o9">SystemArgument1</a>;
00097         SystemArgument2 = Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o10">SystemArgument2</a>;
00098         <span class="keywordflow">if</span> (NormalRoutine == (<a class="code" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00099 
00100             <span class="comment">//</span>
00101             <span class="comment">// First entry in the kernel APC queue is a special kernel APC.</span>
00102             <span class="comment">// Remove the entry from the APC queue, set its inserted state</span>
00103             <span class="comment">// to FALSE, release dispatcher database lock, and call the kernel</span>
00104             <span class="comment">// routine. On return raise IRQL to dispatcher level and lock</span>
00105             <span class="comment">// dispatcher database lock.</span>
00106             <span class="comment">//</span>
00107 
00108             RemoveEntryList(NextEntry);
00109             Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o13">Inserted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00110             <a class="code" href="../../d0/d0/ki_8h.html#a10">KiUnlockApcQueue</a>(Thread, OldIrql);
00111             (KernelRoutine)(Apc, &amp;NormalRoutine, &amp;NormalContext,
00112                             &amp;SystemArgument1, &amp;SystemArgument2);
00113 
00114 <span class="preprocessor">#if DBG</span>
00115 <span class="preprocessor"></span>
00116                 <span class="keywordflow">if</span> (KeGetCurrentIrql() != OldIrql) {
00117                     <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(IRQL_UNEXPECTED_VALUE,
00118                                  KeGetCurrentIrql() &lt;&lt; 16 | OldIrql &lt;&lt; 8,
00119                                  (ULONG_PTR)KernelRoutine,
00120                                  (ULONG_PTR)Apc,
00121                                  (ULONG_PTR)NormalRoutine);
00122                 }
00123 
00124 <span class="preprocessor">#endif</span>
00125 <span class="preprocessor"></span>
00126             <a class="code" href="../../d0/d0/ki_8h.html#a9">KiLockApcQueue</a>(Thread, &amp;OldIrql);
00127 
00128         } <span class="keywordflow">else</span> {
00129 
00130             <span class="comment">//</span>
00131             <span class="comment">// First entry in the kernel APC queue is a normal kernel APC.</span>
00132             <span class="comment">// If there is not a normal kernel APC in progress and kernel</span>
00133             <span class="comment">// APC's are not disabled, then remove the entry from the APC</span>
00134             <span class="comment">// queue, set its inserted state to FALSE, release the APC queue</span>
00135             <span class="comment">// lock, call the specified kernel routine, set kernel APC in</span>
00136             <span class="comment">// progress, lower the IRQL to zero, and call the normal kernel</span>
00137             <span class="comment">// APC routine. On return raise IRQL to dispatcher level, lock</span>
00138             <span class="comment">// the APC queue, and clear kernel APC in progress.</span>
00139             <span class="comment">//</span>
00140 
00141             <span class="keywordflow">if</span> ((Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o2">KernelApcInProgress</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp;
00142                (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o30">KernelApcDisable</a> == 0)) {
00143                 RemoveEntryList(NextEntry);
00144                 Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o13">Inserted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00145                 <a class="code" href="../../d0/d0/ki_8h.html#a10">KiUnlockApcQueue</a>(Thread, OldIrql);
00146                 (KernelRoutine)(Apc, &amp;NormalRoutine, &amp;NormalContext,
00147                                 &amp;SystemArgument1, &amp;SystemArgument2);
00148 
00149 <span class="preprocessor">#if DBG</span>
00150 <span class="preprocessor"></span>
00151                 <span class="keywordflow">if</span> (KeGetCurrentIrql() != OldIrql) {
00152                     <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(IRQL_UNEXPECTED_VALUE,
00153                                  KeGetCurrentIrql() &lt;&lt; 16 | OldIrql &lt;&lt; 8 | 1,
00154                                  (ULONG_PTR)KernelRoutine,
00155                                  (ULONG_PTR)Apc,
00156                                  (ULONG_PTR)NormalRoutine);
00157                 }
00158 
00159 <span class="preprocessor">#endif</span>
00160 <span class="preprocessor"></span>
00161                 <span class="keywordflow">if</span> (NormalRoutine != (<a class="code" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00162                     Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o2">KernelApcInProgress</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00163                     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(0);
00164                     (NormalRoutine)(NormalContext, SystemArgument1,
00165                                     SystemArgument2);
00166                     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(APC_LEVEL, &amp;OldIrql);
00167                 }
00168 
00169                 <a class="code" href="../../d0/d0/ki_8h.html#a9">KiLockApcQueue</a>(Thread, &amp;OldIrql);
00170                 Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o2">KernelApcInProgress</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00171 
00172             } <span class="keywordflow">else</span> {
00173                 <a class="code" href="../../d0/d0/ki_8h.html#a10">KiUnlockApcQueue</a>(Thread, OldIrql);
00174                 <span class="keywordflow">return</span>;
00175             }
00176         }
00177     }
00178 
00179     <span class="comment">//</span>
00180     <span class="comment">// Kernel APC queue is empty. If the previous mode is user, user APC</span>
00181     <span class="comment">// pending is set, and the user APC queue is not empty, then remove</span>
00182     <span class="comment">// the first entry from the user APC queue, set its inserted state to</span>
00183     <span class="comment">// FALSE, clear user APC pending, release the dispatcher database lock,</span>
00184     <span class="comment">// and call the specified kernel routine. If the normal routine address</span>
00185     <span class="comment">// is not NULL on return from the kernel routine, then initialize the</span>
00186     <span class="comment">// user mode APC context and return. Otherwise, check to determine if</span>
00187     <span class="comment">// another user mode APC can be processed.</span>
00188     <span class="comment">//</span>
00189 
00190     <span class="keywordflow">if</span> ((IsListEmpty(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o0">ApcListHead</a>[UserMode]) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp;
00191        (PreviousMode == <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>) &amp;&amp; (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o4">UserApcPending</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) {
00192         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o4">UserApcPending</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00193         NextEntry = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o0">ApcListHead</a>[<a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>].Flink;
00194         Apc = CONTAINING_RECORD(NextEntry, <a class="code" href="../../d1/d5/struct__KAPC.html">KAPC</a>, ApcListEntry);
00195         KernelRoutine = Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o5">KernelRoutine</a>;
00196         NormalRoutine = Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o7">NormalRoutine</a>;
00197         NormalContext = Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o8">NormalContext</a>;
00198         SystemArgument1 = Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o9">SystemArgument1</a>;
00199         SystemArgument2 = Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o10">SystemArgument2</a>;
00200         RemoveEntryList(NextEntry);
00201         Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o13">Inserted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00202         <a class="code" href="../../d0/d0/ki_8h.html#a10">KiUnlockApcQueue</a>(Thread, OldIrql);
00203         (KernelRoutine)(Apc, &amp;NormalRoutine, &amp;NormalContext,
00204                         &amp;SystemArgument1, &amp;SystemArgument2);
00205 
00206         <span class="keywordflow">if</span> (NormalRoutine == (<a class="code" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00207             <a class="code" href="../../d9/d1/thredobj_8c.html#a27">KeTestAlertThread</a>(UserMode);
00208 
00209         } <span class="keywordflow">else</span> {
00210             <a class="code" href="../../d1/d8/ppc_2apcuser_8c.html#a1">KiInitializeUserApc</a>(ExceptionFrame, TrapFrame, NormalRoutine,
00211                                 NormalContext, SystemArgument1, SystemArgument2);
00212         }
00213 
00214     } <span class="keywordflow">else</span> {
00215         <a class="code" href="../../d0/d0/ki_8h.html#a10">KiUnlockApcQueue</a>(Thread, OldIrql);
00216     }
00217 
00218     <span class="keywordflow">return</span>;
00219 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a106" doxytag="ki.h::KiDisableInterrupts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiDisableInterrupts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00093">KdPollBreakIn()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l01015">KeEnterKernelDebugger()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00592">KiCalibrateTimeAdjustment()</a>, <a class="el" href="../../d0/d4/intsupc_8c-source.html#l00098">KiCheckForSoftwareInterrupt()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00220">KiFreezeTargetExecution()</a>, <a class="el" href="../../d7/d8/kernlini_8c-source.html#l02460">KiI386PentiumLockErrataFixup()</a>, <a class="el" href="../../d9/d3/mtrr_8c-source.html#l01796">KiLoadMTRR()</a>, and <a class="el" href="../../d0/d3/pat_8c-source.html#l00289">KiLoadPAT()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a108" doxytag="ki.h::KiDispatchException" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiDispatchException           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>FirstChance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html#l00412">412</a> of file <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html">alpha/exceptn.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00239">CONTEXT_FULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00014">DATA_BUS_ERROR</a>, <a class="el" href="../../d7/d2/dbgkport_8c-source.html#l00099">DbgkForwardException()</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d2/d8/mips_2exceptn_8c-source.html#l00036">DIVIDE_BREAKPOINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d8/mips_2exceptn_8c-source.html#l00035">KDDEBUG_BREAKPOINT</a>, <a class="el" href="../../d4/d8/4_2ia64_2kdtrap_8c-source.html#l00329">KdIsThisAKdTrap()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00081">KeContextFromKframes()</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00230">KeContextToKframes()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d2/d8/mips_2exceptn_8c-source.html#l00044">KERNEL_BREAKPOINT_INSTRUCTION</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02810">KeUserExceptionDispatcher</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00886">KiCopyInformation()</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00437">KiDebugRoutine</a>, <a class="el" href="../../d3/d1/byteem_8c-source.html#l00049">KiEmulateByteWord()</a>, <a class="el" href="../../d8/d4/ppc_2alignem_8c-source.html#l00754">KiEmulateDcbz()</a>, <a class="el" href="../../d8/d4/ppc_2alignem_8c-source.html#l00255">KiEmulateReference()</a>, <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html#l00077">KiEnableAlignmentFaultExceptions</a>, <a class="el" href="../../d9/d4/trigger_8c-source.html#l00079">KiFloatingException()</a>, <a class="el" href="../../d1/d1/alpha_2buserror_8c-source.html#l00031">KiMachineCheck()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00025">KMODE_EXCEPTION_NOT_HANDLED</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d4/probe_8c-source.html#l00034">ProbeForWrite()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00098">RtlDispatchException()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00066">UDIVIDE_BREAKPOINT</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00309">Ki386CheckDelayedNpxTrap()</a>, <a class="el" href="../../d8/d6/alpha_2apcuser_8c-source.html#l00033">KiInitializeUserApc()</a>, and <a class="el" href="../../d6/d3/raisexcp_8c-source.html#l00208">KiRaiseException()</a>.
<p>
<pre class="fragment"><div>00422                    :
00423 
00424     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to dispatch an exception to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> proper mode and
00425     to cause <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception dispatcher to be called.
00426 
00427     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a data misalignment, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> user, <span class="keyword">this</span>
00428     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first chance <span class="keywordflow">for</span> handling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread
00429     has enabled automatic alignment fixup, then an attempt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to emulate
00430     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unaligned reference. Data misalignment exceptions are never emulated
00431     <span class="keywordflow">for</span> kernel mode.
00432 
00433     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a floating not implemented exception, then an attempt
00434     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to emulate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> floating operation. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> an
00435     arithmetic exception, then an attempt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to convert <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> imprecise
00436     exception into a precise exception, and then emulate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> floating
00437     operation in order to obtain <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> proper IEEE results and exceptions.
00438     Floating exceptions are never emulated <span class="keywordflow">for</span> kernel mode.
00439 
00440     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> neither a data misalignment nor a floating point
00441     exception and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous mode <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> kernel, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception
00442     dispatcher <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called directly to process <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception. Otherwise <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00443     exception record, exception frame, and trap frame contents are copied
00444     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user mode stack. The contents of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception frame and trap
00445     are then modified such that when <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned, execution will
00446     commence in user mode in a routine which will call <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception
00447     dispatcher.
00448 
00449 Arguments:
00450 
00451     ExceptionRecord - Supplies a pointer to an exception record.
00452 
00453     ExceptionFrame - Supplies a pointer to an exception frame.
00454 
00455     TrapFrame - Supplies a pointer to a trap frame.
00456 
00457     PreviousMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous processor mode.
00458 
00459     FirstChance - Supplies a <span class="keywordtype">boolean</span> variable that specifies whether <span class="keyword">this</span>
00460         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first (TRUE) or second (FALSE) time that this exception has
00461         been processed.
00462 
00463 Return Value:
00464 
00465     None.
00466 
00467 --*/
00468 
00469 {
00470 
00471     CONTEXT ContextFrame;
00472     EXCEPTION_RECORD ExceptionRecord1;
00473     PEXC_SUM ExceptionSummary;
00474     LONG Length;
00475     ULONG SoftFpcr;
00476     ULONGLONG UserStack1;
00477     ULONGLONG UserStack2;
00478 
00479     <span class="comment">//</span>
00480     <span class="comment">// If the exception is an illegal instruction exception, then check for</span>
00481     <span class="comment">// a byte/word instruction that should be emulated.</span>
00482     <span class="comment">//</span>
00483     <span class="comment">// N.B. The exception code STATUS_ILLEGAL_INSTRUCTION may be converted</span>
00484     <span class="comment">//      into STATUS_DATATYPE_MISALIGNMENT in the case of unaligned word</span>
00485     <span class="comment">//      access.</span>
00486     <span class="comment">//</span>
00487 
00488     <span class="keywordflow">if</span> (ExceptionRecord-&gt;ExceptionCode == STATUS_ILLEGAL_INSTRUCTION) {
00489         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/byteem_8c.html#a2">KiEmulateByteWord</a>(ExceptionRecord,
00490                               ExceptionFrame,
00491                               TrapFrame) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00492             <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;KeByteWordEmulationCount += 1;
00493             <span class="keywordflow">goto</span> Handled2;
00494         }
00495     }
00496 
00497 <span class="preprocessor">#if DBG</span>
00498 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (KiBreakOnAlignmentFault != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00499 
00500         <span class="keywordflow">if</span> (ExceptionRecord-&gt;ExceptionCode == STATUS_DATATYPE_MISALIGNMENT) {
00501 
00502             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"KI: Alignment fault exr = %p Pc = %p Address = %p\n"</span>,
00503                      ExceptionRecord,
00504                      ExceptionRecord-&gt;ExceptionAddress,
00505                      ExceptionRecord-&gt;ExceptionInformation[2]);
00506     
00507             DbgBreakPoint();
00508         }
00509     }
00510 <span class="preprocessor">#endif</span>
00511 <span class="preprocessor"></span>
00512     <span class="comment">//</span>
00513     <span class="comment">// If the exception is a data misalignment, the previous mode was user,</span>
00514     <span class="comment">// this is the first chance for handling the exception, and the current</span>
00515     <span class="comment">// thread has enabled automatic alignment fixup, then attempt to emulate</span>
00516     <span class="comment">// the unaligned reference.</span>
00517     <span class="comment">//</span>
00518 
00519     <span class="keywordflow">if</span> ((ExceptionRecord-&gt;ExceptionCode == STATUS_DATATYPE_MISALIGNMENT) &amp;&amp;
00520         (FirstChance != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00521 
00522 <span class="preprocessor">#if DBG</span>
00523 <span class="preprocessor"></span>
00524         <span class="comment">//</span>
00525         <span class="comment">// Count alignment faults by mode and display them at intervals.</span>
00526         <span class="comment">//</span>
00527 
00528         <span class="keywordflow">if</span> (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00529             KiKernelFixupCount += 1;
00530             <span class="keywordflow">if</span> ((KiKernelFixupCount &amp; KiKernelFixupMask) == 0) {
00531                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"KI: Kernel Fixup: Pid=0x%.3lx, Pc=%.16p, Address=%.16p ... Total=%ld\n"</span>,
00532                          <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;UniqueProcessId,
00533                          ExceptionRecord-&gt;ExceptionAddress,
00534                          ExceptionRecord-&gt;ExceptionInformation[2],
00535                          KiKernelFixupCount);
00536             }
00537 
00538         } <span class="keywordflow">else</span> {
00539             KiUserFixupCount += 1;
00540             <span class="keywordflow">if</span> ((KiUserFixupCount &amp; KiUserFixupMask) == 0) {
00541                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"KI: User  Fixup: Pid=0x%.3lx, Pc=%.16p, Address=%.16p ... Total=%ld\n"</span>,
00542                          <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;UniqueProcessId,
00543                          ExceptionRecord-&gt;ExceptionAddress,
00544                          ExceptionRecord-&gt;ExceptionInformation[2],
00545                          KiUserFixupCount);
00546             }
00547         }
00548 
00549 <span class="preprocessor">#endif</span>
00550 <span class="preprocessor"></span>
00551         <span class="comment">//</span>
00552         <span class="comment">// If alignment fault exceptions are not enabled, then no exception</span>
00553         <span class="comment">// should be raised and the data reference should be emulated.</span>
00554         <span class="comment">//</span>
00555         <span class="comment">// We will emulate the reference if</span>
00556         <span class="comment">//      KiEnableAlignmentFaultExceptions == 0 (always fix up all faults, the default)</span>
00557         <span class="comment">// OR   The thread has explicitly enabled alignment fixups</span>
00558         <span class="comment">// OR   KiEnableAlignmentFaultExceptions == 2 and the process is not being debugged</span>
00559         <span class="comment">//</span>
00560 
00561         <span class="keywordflow">if</span> ( (<a class="code" href="../../d8/d8/alpha_2exceptn_8c.html#a1">KiEnableAlignmentFaultExceptions</a> == 0) ||
00562 
00563              ((<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;AutoAlignment != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) ||
00564               (<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>()-&gt;ApcState.Process-&gt;AutoAlignment != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) ||
00565 
00566              (((<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;DebugPort == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>)) &amp;&amp;
00567               (<a class="code" href="../../d8/d8/alpha_2exceptn_8c.html#a1">KiEnableAlignmentFaultExceptions</a> == 2)) ) {
00568 
00569             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d5/ppc_2alignem_8c.html#a18">KiEmulateReference</a>(ExceptionRecord,
00570                                    ExceptionFrame,
00571                                    TrapFrame,
00572                                    FALSE) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00573                 <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;KeAlignmentFixupCount += 1;
00574                 <span class="keywordflow">goto</span> Handled2;
00575             }
00576         }
00577     }
00578 
00579     <span class="comment">//</span>
00580     <span class="comment">// If the exception is a data bus error then a machine check has</span>
00581     <span class="comment">// been trapped by the PALcode. The error will be forwarded to the</span>
00582     <span class="comment">// HAL eventually for logging or handling. If the handler returns</span>
00583     <span class="comment">// it is assumed that the HAL successfully handled the error and</span>
00584     <span class="comment">// execution may resume.</span>
00585     <span class="comment">//</span>
00586     <span class="comment">// N.B. A special exception code is used to signal a data bus error.</span>
00587     <span class="comment">//      This code is equivalent to the bug check code merged with a</span>
00588     <span class="comment">//      reserved facility code and the reserved bit set.</span>
00589     <span class="comment">//</span>
00590 
00591     <span class="keywordflow">if</span> (ExceptionRecord-&gt;ExceptionCode == (<a class="code" href="../../d6/d7/halmips_8h.html#a2">DATA_BUS_ERROR</a> | 0xdfff0000)) {
00592         <a class="code" href="../../d8/d8/alpha_2exceptn_8c.html#a2">KiMachineCheck</a>(ExceptionRecord, ExceptionFrame, TrapFrame);
00593         <span class="keywordflow">goto</span> Handled2;
00594     }
00595 
00596     <span class="comment">//</span>
00597     <span class="comment">// Initialize the copy of the software FPCR. The proper value is set</span>
00598     <span class="comment">// if a floating emulation operation is performed. Case on arithmetic</span>
00599     <span class="comment">// exception codes that require special handling by the kernel.</span>
00600     <span class="comment">//</span>
00601 
00602     SoftFpcr = 0;
00603     <span class="keywordflow">switch</span> (ExceptionRecord-&gt;ExceptionCode) {
00604 
00605         <span class="comment">//</span>
00606         <span class="comment">// If the exception is a gentrap, then attempt to translate the</span>
00607         <span class="comment">// Alpha specific gentrap value to a status code value. This</span>
00608         <span class="comment">// exception is a precise trap.</span>
00609         <span class="comment">//</span>
00610         <span class="comment">// N.B. STATUS_ALPHA_GENTRAP is a pseudo status code generated by</span>
00611         <span class="comment">//      PALcode when a callpal gentrap is executed. The status is</span>
00612         <span class="comment">//      visible in user mode only when the gentrap code value is</span>
00613         <span class="comment">//      unrecognized.</span>
00614         <span class="comment">//</span>
00615 
00616     <span class="keywordflow">case</span> STATUS_ALPHA_GENTRAP :
00617         <span class="keywordflow">switch</span> (ExceptionRecord-&gt;ExceptionInformation[0]) {
00618         <span class="keywordflow">case</span> GENTRAP_INTEGER_OVERFLOW :
00619             ExceptionRecord-&gt;ExceptionCode = STATUS_INTEGER_OVERFLOW;
00620             <span class="keywordflow">break</span>;
00621 
00622         <span class="keywordflow">case</span> GENTRAP_INTEGER_DIVIDE_BY_ZERO :
00623             ExceptionRecord-&gt;ExceptionCode = STATUS_INTEGER_DIVIDE_BY_ZERO;
00624             <span class="keywordflow">break</span>;
00625 
00626         <span class="keywordflow">case</span> GENTRAP_FLOATING_OVERFLOW :
00627             ExceptionRecord-&gt;ExceptionCode = STATUS_FLOAT_OVERFLOW;
00628             <span class="keywordflow">break</span>;
00629 
00630         <span class="keywordflow">case</span> GENTRAP_FLOATING_DIVIDE_BY_ZERO :
00631             ExceptionRecord-&gt;ExceptionCode = STATUS_FLOAT_DIVIDE_BY_ZERO;
00632             <span class="keywordflow">break</span>;
00633 
00634         <span class="keywordflow">case</span> GENTRAP_FLOATING_UNDERFLOW :
00635             ExceptionRecord-&gt;ExceptionCode = STATUS_FLOAT_UNDERFLOW;
00636             <span class="keywordflow">break</span>;
00637 
00638         <span class="keywordflow">case</span> GENTRAP_FLOATING_INVALID_OPERAND :
00639             ExceptionRecord-&gt;ExceptionCode = STATUS_FLOAT_INVALID_OPERATION;
00640             <span class="keywordflow">break</span>;
00641 
00642         <span class="keywordflow">case</span> GENTRAP_FLOATING_INEXACT_RESULT :
00643             ExceptionRecord-&gt;ExceptionCode = STATUS_FLOAT_INEXACT_RESULT;
00644             <span class="keywordflow">break</span>;
00645         }
00646         <span class="keywordflow">break</span>;
00647 
00648         <span class="comment">//</span>
00649         <span class="comment">// If the exception is an unimplemented floating operation, then</span>
00650         <span class="comment">// PALcode has detected a subsetted floating point operation. These</span>
00651         <span class="comment">// include attempts to use round to plus or minus infinity rounding</span>
00652         <span class="comment">// modes on EV4. This exception is a fault.</span>
00653         <span class="comment">//</span>
00654         <span class="comment">// If the previous mode was user, an attempt is made to emulate the</span>
00655         <span class="comment">// operation. If the emulation is successful, the continuation</span>
00656         <span class="comment">// address is incremented to the next instruction.</span>
00657         <span class="comment">//</span>
00658         <span class="comment">// N.B. STATUS_ALPHA_FLOATING_NOT_IMPLEMENTED is a pseudo status code</span>
00659         <span class="comment">//      generated by PALcode. The status is never visible outside of</span>
00660         <span class="comment">//      this handler because the floating emulation routine converts</span>
00661         <span class="comment">//      the status code to the proper floating status value.</span>
00662         <span class="comment">//</span>
00663 
00664     <span class="keywordflow">case</span> STATUS_ALPHA_FLOATING_NOT_IMPLEMENTED :
00665         <span class="keywordflow">if</span> (PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00666             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/trigger_8c.html#a11">KiFloatingException</a>(ExceptionRecord,
00667                                     ExceptionFrame,
00668                                     TrapFrame,
00669                                     FALSE,
00670                                     &amp;SoftFpcr) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00671                 TrapFrame-&gt;Fir += 4;
00672                 <span class="keywordflow">goto</span> Handled2;
00673             }
00674 
00675         } <span class="keywordflow">else</span> {
00676             ExceptionRecord-&gt;ExceptionCode = STATUS_ILLEGAL_INSTRUCTION;
00677         }
00678 
00679         <span class="keywordflow">break</span>;
00680 
00681         <span class="comment">//</span>
00682         <span class="comment">// If the exception is an arithmetic exception, then one or more</span>
00683         <span class="comment">// integer overflow or floating point traps has occurred. This</span>
00684         <span class="comment">// exception is an imprecise (asynchronous) trap. Attempt to locate </span>
00685         <span class="comment">// the original trapping instruction and emulate the instruction.</span>
00686         <span class="comment">//</span>
00687         <span class="comment">// N.B. STATUS_ALPHA_ARITHMETIC_EXCEPTION is a pseudo status code</span>
00688         <span class="comment">//      generated by PALcode. The status is never visible outside of</span>
00689         <span class="comment">//      this handler because the floating emulation routine converts</span>
00690         <span class="comment">//      the status code to the proper floating status value.</span>
00691         <span class="comment">//</span>
00692 
00693     <span class="keywordflow">case</span> STATUS_ALPHA_ARITHMETIC_EXCEPTION :
00694         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/trigger_8c.html#a11">KiFloatingException</a>(ExceptionRecord,
00695                                 ExceptionFrame,
00696                                 TrapFrame,
00697                                 TRUE,
00698                                 &amp;SoftFpcr) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00699             <span class="keywordflow">goto</span> Handled2;
00700         }
00701         <span class="keywordflow">break</span>;
00702     }
00703 
00704     <span class="comment">//</span>
00705     <span class="comment">// Move machine state from trap and exception frames to a context frame,</span>
00706     <span class="comment">// and increment the number of exceptions dispatched.</span>
00707     <span class="comment">//</span>
00708     <span class="comment">// Explicitly set the value of the software FPCR in the context frame</span>
00709     <span class="comment">// (because it is not a hardware register and thus not present in the</span>
00710     <span class="comment">// trap or exception frames).</span>
00711     <span class="comment">//</span>
00712 
00713     ContextFrame.ContextFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a152">CONTEXT_FULL</a>;
00714     <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a9">KeContextFromKframes</a>(TrapFrame, ExceptionFrame, &amp;ContextFrame);
00715     <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;KeExceptionDispatchCount += 1;
00716     ContextFrame.SoftFpcr = (ULONGLONG)SoftFpcr;
00717 
00718     <span class="comment">//</span>
00719     <span class="comment">// Select the method of handling the exception based on the previous mode.</span>
00720     <span class="comment">//</span>
00721 
00722     <span class="keywordflow">if</span> (PreviousMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00723 
00724         <span class="comment">//</span>
00725         <span class="comment">// If the kernel debugger is active, the exception is a breakpoint,</span>
00726         <span class="comment">// the breakpoint is handled by the kernel debugger, and this is the</span>
00727         <span class="comment">// first chance, then give the kernel debugger a chance to handle</span>
00728         <span class="comment">// the exception.</span>
00729         <span class="comment">//</span>
00730 
00731         <span class="keywordflow">if</span> ((FirstChance != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp; (<a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00732            (ExceptionRecord-&gt;ExceptionCode == STATUS_BREAKPOINT) &amp;&amp;
00733            (<a class="code" href="../../d3/d9/4_2ia64_2kdtrap_8c.html#a1">KdIsThisAKdTrap</a>(ExceptionRecord,
00734                             &amp;ContextFrame,
00735                             KernelMode) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp;
00736 
00737            (((<a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a>) (TrapFrame,
00738                                ExceptionFrame,
00739                                ExceptionRecord,
00740                                &amp;ContextFrame,
00741                                <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>,
00742                                <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00743 
00744             <span class="keywordflow">goto</span> Handled1;
00745         }
00746 
00747 
00748         <span class="comment">//</span>
00749         <span class="comment">// Previous mode was kernel.</span>
00750         <span class="comment">//</span>
00751         <span class="comment">// If this is the first chance, then attempt to dispatch the exception</span>
00752         <span class="comment">// to a frame based handler. If the exception is handled, then continue</span>
00753         <span class="comment">// execution.</span>
00754         <span class="comment">//</span>
00755         <span class="comment">// If this is the second chance or the exception is not handled,</span>
00756         <span class="comment">// then if the kernel debugger is active, then give the kernel</span>
00757         <span class="comment">// debugger a second chance to handle the exception. If the kernel</span>
00758         <span class="comment">// debugger handles the exception, then continue execution. Otherwise</span>
00759         <span class="comment">// bug check.</span>
00760         <span class="comment">//</span>
00761 
00762         <span class="keywordflow">if</span> (FirstChance != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00763 
00764             <span class="comment">//</span>
00765             <span class="comment">// This is the first chance to handle the exception.</span>
00766             <span class="comment">//</span>
00767 
00768             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a7">RtlDispatchException</a>(ExceptionRecord, &amp;ContextFrame) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00769                 <span class="keywordflow">goto</span> Handled1;
00770             }
00771         }
00772 
00773         <span class="comment">//</span>
00774         <span class="comment">// This is the second chance to handle the exception.</span>
00775         <span class="comment">//</span>
00776 
00777         <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00778            (((<a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a>) (TrapFrame,
00779                                ExceptionFrame,
00780                                ExceptionRecord,
00781                                &amp;ContextFrame,
00782                                PreviousMode,
00783                                    <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00784 
00785             <span class="keywordflow">goto</span> Handled1;
00786         }
00787 
00788         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(KMODE_EXCEPTION_NOT_HANDLED,
00789                      ExceptionRecord-&gt;ExceptionCode,
00790                      (ULONG_PTR)ExceptionRecord-&gt;ExceptionAddress,
00791                      ExceptionRecord-&gt;ExceptionInformation[0],
00792                      ExceptionRecord-&gt;ExceptionInformation[1]);
00793 
00794     } <span class="keywordflow">else</span> {
00795 
00796         <span class="comment">//</span>
00797         <span class="comment">// If the kernel debugger is active, the exception is a breakpoint,</span>
00798         <span class="comment">// the breakpoint is handled by the kernel debugger, and this is the</span>
00799         <span class="comment">// first chance, then give the kernel debugger a chance to handle</span>
00800         <span class="comment">// the exception.</span>
00801         <span class="comment">//</span>
00802 
00803         <span class="keywordflow">if</span> ((FirstChance != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp;
00804             (<a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00805             (ExceptionRecord-&gt;ExceptionCode == STATUS_BREAKPOINT) &amp;&amp;
00806             (<a class="code" href="../../d3/d9/4_2ia64_2kdtrap_8c.html#a1">KdIsThisAKdTrap</a>(ExceptionRecord,
00807                              &amp;ContextFrame,
00808                              UserMode) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) &amp;&amp;
00809 
00810             ((<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;DebugPort == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00811              ((<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;DebugPort != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00812               (ExceptionRecord-&gt;ExceptionInformation[0] !=
00813                                             DEBUG_STOP_BREAKPOINT)))) {
00814 
00815               <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d7/kdp_8h.html#a24">KiDebugRoutine</a>) (TrapFrame,
00816                                      ExceptionFrame,
00817                                      ExceptionRecord,
00818                                      &amp;ContextFrame,
00819                                      <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>,
00820                                      <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00821 
00822                      <span class="keywordflow">goto</span> Handled1;
00823               }
00824         }
00825 
00826         <span class="comment">//</span>
00827         <span class="comment">// Previous mode was user.</span>
00828         <span class="comment">//</span>
00829         <span class="comment">// If this is the first chance and the current process has a debugger</span>
00830         <span class="comment">// port, then send a message to the debugger port and wait for a reply.</span>
00831         <span class="comment">// If the debugger handles the exception, then continue execution. Otherwise</span>
00832         <span class="comment">// transfer the exception information to the user stack, transition to</span>
00833         <span class="comment">// user mode, and attempt to dispatch the exception to a frame based</span>
00834         <span class="comment">// handler. If a frame based handler handles the exception, then continue</span>
00835         <span class="comment">// execution. Otherwise, execute the raise exception system service</span>
00836         <span class="comment">// which will call this routine a second time to process the exception.</span>
00837         <span class="comment">//</span>
00838         <span class="comment">// If this is the second chance and the current process has a debugger</span>
00839         <span class="comment">// port, then send a message to the debugger port and wait for a reply.</span>
00840         <span class="comment">// If the debugger handles the exception, then continue execution. Otherwise</span>
00841         <span class="comment">// if the current process has a subsystem port, then send a message to</span>
00842         <span class="comment">// the subsystem port and wait for a reply. If the subsystem handles the</span>
00843         <span class="comment">// exception, then continue execution. Otherwise terminate the thread.</span>
00844         <span class="comment">//</span>
00845 
00846         <span class="keywordflow">if</span> (FirstChance != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00847 
00848             <span class="comment">//</span>
00849             <span class="comment">// This is the first chance to handle the exception.</span>
00850             <span class="comment">//</span>
00851 
00852             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d3/dbgk_8h.html#a5">DbgkForwardException</a>(ExceptionRecord, TRUE, FALSE)) {
00853                 <span class="keywordflow">goto</span> Handled2;
00854             }
00855 
00856             <span class="comment">//</span>
00857             <span class="comment">// Transfer exception information to the user stack, transition</span>
00858             <span class="comment">// to user mode, and attempt to dispatch the exception to a frame</span>
00859             <span class="comment">// based handler.</span>
00860             <span class="comment">//</span>
00861 
00862         repeat:
00863             <span class="keywordflow">try</span> {
00864 
00865                 <span class="comment">//</span>
00866                 <span class="comment">// Compute length of exception record and new aligned stack</span>
00867                 <span class="comment">// address.</span>
00868                 <span class="comment">//</span>
00869 
00870                 Length = (<span class="keyword">sizeof</span>(EXCEPTION_RECORD) + 15) &amp; (~15);
00871                 UserStack1 = (ContextFrame.IntSp &amp; ~((ULONG_PTR)15)) - Length;
00872 
00873                 <span class="comment">//</span>
00874                 <span class="comment">// Probe user stack area for writability and then transfer the</span>
00875                 <span class="comment">// exception record to the user stack area.</span>
00876                 <span class="comment">//</span>
00877 
00878                 <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>((PCHAR)UserStack1, Length, <span class="keyword">sizeof</span>(QUAD));
00879                 RtlMoveMemory((PVOID)UserStack1, ExceptionRecord, Length);
00880 
00881                 <span class="comment">//</span>
00882                 <span class="comment">// Compute length of context record and new aligned user stack</span>
00883                 <span class="comment">// pointer.</span>
00884                 <span class="comment">//</span>
00885 
00886                 Length = (<span class="keyword">sizeof</span>(CONTEXT) + 15) &amp; (~15);
00887                 UserStack2 = UserStack1 - Length;
00888 
00889                 <span class="comment">//</span>
00890                 <span class="comment">// Probe user stack area for writability and then transfer the</span>
00891                 <span class="comment">// context record to the user stack.</span>
00892                 <span class="comment">//</span>
00893 
00894                 <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>((PCHAR)UserStack2, Length, <span class="keyword">sizeof</span>(QUAD));
00895                 RtlMoveMemory((PVOID)UserStack2, &amp;ContextFrame, <span class="keyword">sizeof</span>(CONTEXT));
00896 
00897                 <span class="comment">//</span>
00898                 <span class="comment">// Set address of exception record, context record, and the</span>
00899                 <span class="comment">// and the new stack pointer in the current trap frame.</span>
00900                 <span class="comment">//</span>
00901 
00902                 TrapFrame-&gt;IntSp = UserStack2;
00903                 TrapFrame-&gt;IntFp = UserStack2;
00904                 ExceptionFrame-&gt;IntS0 = UserStack1;
00905                 ExceptionFrame-&gt;IntS1 = UserStack2;
00906 
00907                 <span class="comment">//</span>
00908                 <span class="comment">// Set the address of the exception routine that will call the</span>
00909                 <span class="comment">// exception dispatcher and then return to the trap handler.</span>
00910                 <span class="comment">// The trap handler will restore the exception and trap frame</span>
00911                 <span class="comment">// context and continue execution in the routine that will</span>
00912                 <span class="comment">// call the exception dispatcher.</span>
00913                 <span class="comment">//</span>
00914 
00915                 TrapFrame-&gt;Fir = (ULONGLONG)(LONG_PTR)<a class="code" href="../../d4/d9/ke_8h.html#a150">KeUserExceptionDispatcher</a>;
00916                 <span class="keywordflow">return</span>;
00917 
00918             <span class="comment">//</span>
00919             <span class="comment">// If an exception occurs, then copy the new exception information</span>
00920             <span class="comment">// to an exception record and handle the exception.</span>
00921             <span class="comment">//</span>
00922 
00923             } except (<a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a12">KiCopyInformation</a>(&amp;ExceptionRecord1,
00924                                (GetExceptionInformation())-&gt;ExceptionRecord)) {
00925 
00926                 <span class="comment">//</span>
00927                 <span class="comment">// If the exception is a stack overflow, then attempt</span>
00928                 <span class="comment">// to raise the stack overflow exception. Otherwise,</span>
00929                 <span class="comment">// the user's stack is not accessible, or is misaligned,</span>
00930                 <span class="comment">// and second chance processing is performed.</span>
00931                 <span class="comment">//</span>
00932 
00933                 <span class="keywordflow">if</span> (ExceptionRecord1.ExceptionCode == STATUS_STACK_OVERFLOW) {
00934                     ExceptionRecord1.ExceptionAddress = ExceptionRecord-&gt;ExceptionAddress;
00935                     RtlMoveMemory((PVOID)ExceptionRecord,
00936                                   &amp;ExceptionRecord1, <span class="keyword">sizeof</span>(EXCEPTION_RECORD));
00937                     <span class="keywordflow">goto</span> repeat;
00938                 }
00939             }
00940         }
00941 
00942         <span class="comment">//</span>
00943         <span class="comment">// This is the second chance to handle the exception.</span>
00944         <span class="comment">//</span>
00945 
00946         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d3/dbgk_8h.html#a5">DbgkForwardException</a>(ExceptionRecord, TRUE, TRUE)) {
00947             <span class="keywordflow">goto</span> Handled2;
00948 
00949         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d4/d3/dbgk_8h.html#a5">DbgkForwardException</a>(ExceptionRecord, FALSE, TRUE)) {
00950             <span class="keywordflow">goto</span> Handled2;
00951 
00952         } <span class="keywordflow">else</span> {
00953             ZwTerminateProcess(NtCurrentProcess(), ExceptionRecord-&gt;ExceptionCode);
00954             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(KMODE_EXCEPTION_NOT_HANDLED,
00955                          ExceptionRecord-&gt;ExceptionCode,
00956                          (ULONG_PTR)ExceptionRecord-&gt;ExceptionAddress,
00957                          ExceptionRecord-&gt;ExceptionInformation[0],
00958                          ExceptionRecord-&gt;ExceptionInformation[1]);
00959 
00960         }
00961     }
00962 
00963     <span class="comment">//</span>
00964     <span class="comment">// Move machine state from context frame to trap and exception frames and</span>
00965     <span class="comment">// then return to continue execution with the restored state.</span>
00966     <span class="comment">//</span>
00967 
00968 Handled1:
00969     <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a10">KeContextToKframes</a>(TrapFrame, ExceptionFrame, &amp;ContextFrame,
00970                        ContextFrame.ContextFlags, PreviousMode);
00971 
00972     <span class="comment">//</span>
00973     <span class="comment">// Exception was handled by the debugger or the associated subsystem</span>
00974     <span class="comment">// and state was modified, if necessary, using the get state and set</span>
00975     <span class="comment">// state capabilities. Therefore the context frame does not need to</span>
00976     <span class="comment">// be transferred to the trap and exception frames.</span>
00977     <span class="comment">//</span>
00978 
00979 Handled2:
00980     <span class="keywordflow">return</span>;
00981 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a111" doxytag="ki.h::KiDispatchInterrupt" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiDispatchInterrupt           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d4/intsupc_8c-source.html#l00032">KiDispatchSoftwareInterrupt()</a>, and <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a112" doxytag="ki.h::KiFindReadyThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> FASTCALL KiFindReadyThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Processor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>KPRIORITY&nbsp;</td>
          <td class="mdname" nowrap> <em>LowPriority</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a113" doxytag="ki.h::KiFloatingDispatch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFloatingDispatch           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00154">KeConnectInterrupt()</a>, <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00298">KeDisconnectInterrupt()</a>, and <a class="el" href="../../d5/d3/i386_2intobj_8c-source.html#l00558">KiGetVectorInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a115" doxytag="ki.h::KiFlushMultipleTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushMultipleTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Count</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00231">KeFlushMultipleTb()</a>, and <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00353">KiFlushMultipleTbTarget()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a114" doxytag="ki.h::KiFlushSingleTb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL KiFlushSingleTb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Invalid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Virtual</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00240">KeFlushMultipleTb()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00428">KeFlushSingleTb()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00589">KiFlushSingleTbSynchronous()</a>, <a class="el" href="../../d5/d0/xxflshtb_8c-source.html#l00747">KiFlushSingleTbTarget()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00368">KiFlushTargetMultipleTb()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00546">KiFlushTargetSingleTb()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00703">KiFlushTargetSingleTbSynchronous()</a>, <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html#l00182">MmDbgReleaseAddress()</a>, <a class="el" href="../../d4/d5/mips_2debugsup_8c-source.html#l00245">MmDbgTranslatePhysicalAddress()</a>, <a class="el" href="../../d2/d5/i386_2debugsup_8c-source.html#l00298">MmDbgTranslatePhysicalAddress64()</a>, <a class="el" href="../../d0/d5/alpha_2debugsup_8c-source.html#l00070">MmDbgWriteCheck()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l07197">MmMapMemoryDumpMdl()</a>, and <a class="el" href="../../d6/d5/iosup_8c-source.html#l07270">MmReleaseDumpAddresses()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a149" doxytag="ki.h::KiFreezeTargetExecution" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFreezeTargetExecution           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00220">220</a> of file <a class="el" href="../../d0/d4/ke_2debug_8c-source.html">ke/debug.c</a>.
<p>
References <a class="el" href="../../d4/d9/ke_8h.html#a408a226">ContinueError</a>, <a class="el" href="../../d4/d9/ke_8h.html#a408a229">ContinueNextProcessor</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00039">FREEZE_ACTIVE</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00030">FrozenState</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00091">HIGH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00353">KCONTINUE_STATUS</a>, <a class="el" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d1/d6/kdp_8h-source.html#l00438">KiDebugSwitchRoutine</a>, <a class="el" href="../../d0/d0/ki_8h.html#a106">KiDisableInterrupts()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00049">KiFreezeOwner</a>, <a class="el" href="../../d0/d0/ki_8h.html#a107">KiRestoreInterrupts()</a>, <a class="el" href="../../d0/d6/ppc_2ipi_8c-source.html#l00046">KiRestoreProcessorState()</a>, <a class="el" href="../../d0/d6/ppc_2ipi_8c-source.html#l00104">KiSaveProcessorState()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00033">RUNNING</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00034">TARGET_FROZEN</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d5/alpha_2ipi_8c-source.html#l00130">KiIpiServiceRoutine()</a>, and <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00538">KiPollFreezeExecution()</a>.
<p>
<pre class="fragment"><div>00227                    :
00228 
00229     This function freezes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> execution of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current running processor.
00230     If a trapframe <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> supplied to current state <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> saved into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> prcb
00231     <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debugger.
00232 
00233 Arguments:
00234 
00235     TrapFrame - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> trap frame that describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00236         trap.
00237 
00238     ExceptionFrame - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception frame that
00239         describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> trap.
00240 
00241 Return Value:
00242 
00243     None.
00244 
00245 --*/
00246 
00247 {
00248 
00249 <span class="preprocessor">#if !defined(NT_UP)</span>
00250 <span class="preprocessor"></span>
00251     KIRQL OldIrql;
00252     PKPRCB Prcb;
00253     BOOLEAN Enable;
00254     <a class="code" href="../../d4/d9/ke_8h.html#a408">KCONTINUE_STATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00255     EXCEPTION_RECORD ExceptionRecord;
00256 
00257     Enable = <a class="code" href="../../d0/d0/ki_8h.html#a106">KiDisableInterrupts</a>();
00258     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(HIGH_LEVEL, &amp;OldIrql);
00259 
00260     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00261     Prcb-&gt;IpiFrozen = <a class="code" href="../../d9/d4/ke_2debug_8c.html#a3">TARGET_FROZEN</a>;
00262     Prcb-&gt;SkipTick  = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00263 
00264     <span class="keywordflow">if</span> (TrapFrame != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00265         <a class="code" href="../../d9/d6/ppc_2ipi_8c.html#a3">KiSaveProcessorState</a>(TrapFrame, ExceptionFrame);
00266     }
00267 
00268     <span class="comment">//</span>
00269     <span class="comment">// Sweep the data cache in case this is a system crash and the bug</span>
00270     <span class="comment">// check code is attempting to write a crash dump file.</span>
00271     <span class="comment">//</span>
00272 
00273     KeSweepCurrentDcache();
00274 
00275     <span class="comment">//</span>
00276     <span class="comment">//  Wait for person requesting us to freeze to</span>
00277     <span class="comment">//  clear our frozen flag</span>
00278     <span class="comment">//</span>
00279 
00280     <span class="keywordflow">while</span> (<a class="code" href="../../d9/d4/ke_2debug_8c.html#a1">FrozenState</a>(Prcb-&gt;IpiFrozen) == <a class="code" href="../../d9/d4/ke_2debug_8c.html#a3">TARGET_FROZEN</a>) {
00281         <span class="keywordflow">if</span> (Prcb-&gt;IpiFrozen &amp; <a class="code" href="../../d9/d4/ke_2debug_8c.html#a6">FREEZE_ACTIVE</a>) {
00282 
00283             <span class="comment">//</span>
00284             <span class="comment">// This processor has been made the active processor</span>
00285             <span class="comment">//</span>
00286             <span class="keywordflow">if</span> (TrapFrame) {
00287                 RtlZeroMemory (&amp;ExceptionRecord, <span class="keyword">sizeof</span> ExceptionRecord);
00288                 ExceptionRecord.ExceptionCode = STATUS_WAKE_SYSTEM_DEBUGGER;
00289                 ExceptionRecord.ExceptionRecord  = &amp;ExceptionRecord;
00290                 ExceptionRecord.ExceptionAddress =
00291                     (PVOID)CONTEXT_TO_PROGRAM_COUNTER (&amp;Prcb-&gt;ProcessorState.ContextFrame);
00292 
00293                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d0/d7/kdp_8h.html#a25">KiDebugSwitchRoutine</a>) (
00294                             &amp;ExceptionRecord,
00295                             &amp;Prcb-&gt;ProcessorState.ContextFrame,
00296                             <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00297                             );
00298 
00299             } <span class="keywordflow">else</span> {
00300                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d9/ke_8h.html#a408a226">ContinueError</a>;
00301             }
00302 
00303             <span class="comment">//</span>
00304             <span class="comment">// If status is anything other then, continue with next</span>
00305             <span class="comment">// processor then reselect master</span>
00306             <span class="comment">//</span>
00307 
00308             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d4/d9/ke_8h.html#a408a229">ContinueNextProcessor</a>) {
00309                 Prcb-&gt;IpiFrozen &amp;= ~<a class="code" href="../../d9/d4/ke_2debug_8c.html#a6">FREEZE_ACTIVE</a>;
00310                 <a class="code" href="../../d9/d4/ke_2debug_8c.html#a8">KiFreezeOwner</a>-&gt;IpiFrozen |= <a class="code" href="../../d9/d4/ke_2debug_8c.html#a6">FREEZE_ACTIVE</a>;
00311             }
00312         }
00313         KeYieldProcessor();
00314     }
00315 
00316     <span class="keywordflow">if</span> (TrapFrame != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00317         <a class="code" href="../../d9/d6/ppc_2ipi_8c.html#a2">KiRestoreProcessorState</a>(TrapFrame, ExceptionFrame);
00318     }
00319 
00320     Prcb-&gt;IpiFrozen = <a class="code" href="../../d9/d4/ke_2debug_8c.html#a2">RUNNING</a>;
00321 
00322     <a class="code" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb</a>();
00323     KeSweepCurrentIcache();
00324 
00325     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00326     <a class="code" href="../../d0/d0/ki_8h.html#a107">KiRestoreInterrupts</a>(Enable);
00327 <span class="preprocessor">#endif      // !define(NT_UP)</span>
00328 <span class="preprocessor"></span>
00329     <span class="keywordflow">return</span>;
00330 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a116" doxytag="ki.h::KiGetUserModeStackAddress" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PULONG KiGetUserModeStackAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d3/ke_2i386_2callback_8c-source.html#l00028">KeUserModeCallback()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a117" doxytag="ki.h::KiInitializeContextThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiInitializeContextThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d9/ke_8h.html#a67">PKSYSTEM_ROUTINE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d9/ke_8h.html#a66">PKSTART_ROUTINE</a> StartRoutine&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID StartContext&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT ContextFrame&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/i386_2thredini_8c-source.html#l00071">71</a> of file <a class="el" href="../../d6/d0/i386_2thredini_8c-source.html">i386/thredini.c</a>.
<p>
References <a class="el" href="../../d4/d0/threads_8h-source.html#l00266">Context2</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00240">CONTEXT_CONTROL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00241">CONTEXT_FLOATING_POINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00230">KeContextToKframes()</a>, <a class="el" href="../../d6/d2/i386_8h-source.html#l02695">KeI386FxsrPresent</a>, <a class="el" href="../../d6/d2/i386_8h-source.html#l02694">KeI386NpxPresent</a>, <a class="el" href="../../d0/d8/i386_2exceptn_8c-source.html#l00046">KeI386XMMIPresent</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d0/d0/ki_8h.html#a139">KiThreadStartup()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d2/ppcdef_8h-source.html#l00079">PASSIVE_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
<pre class="fragment"><div>00081                    :
00082 
00083     This function initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> machine dependent context of a thread object.
00084 
00085     N.B. This function does not check <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> accessibility of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context record.
00086          It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller of <span class="keyword">this</span> routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> either prepared to
00087          handle access violations or has probed and copied <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context record
00088          as appropriate.
00089 
00090 Arguments:
00091 
00092     Thread - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00093 
00094     SystemRoutine - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system function that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be
00095         called when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> first scheduled <span class="keywordflow">for</span> execution.
00096 
00097     StartRoutine - Supplies an optional pointer to a function that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be
00098         called after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system has finished initializing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread. This
00099         parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a system thread and will
00100         execute totally in kernel mode.
00101 
00102     StartContext - Supplies an optional pointer to an arbitrary data structure
00103         which will be passed to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> StartRoutine as a parameter. This
00104         parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a system thread and will
00105         execute totally in kernel mode.
00106 
00107     ContextFrame - Supplies an optional pointer a context frame which contains
00108         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initial user mode state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread. This parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified
00109         <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a user thread and will execute in user mode. If <span class="keyword">this</span>
00110         parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Teb parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored.
00111 
00112 Return Value:
00113 
00114     None.
00115 
00116 --*/
00117 
00118 {
00119     PFX_SAVE_AREA NpxFrame;
00120     PKSWITCHFRAME SwitchFrame;
00121     PKTRAP_FRAME TrFrame;
00122     PULONG PSystemRoutine;
00123     PULONG PStartRoutine;
00124     PULONG PStartContext;
00125     PULONG PUserContextFlag;
00126     ULONG  ContextFlags;
00127     CONTEXT <a class="code" href="../../d3/d1/threads_8h.html#a108">Context2</a>;
00128     PCONTEXT ContextFrame2 = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00129     PFXSAVE_FORMAT   PFxSaveArea;
00130 
00131     <span class="comment">//</span>
00132     <span class="comment">// If a context frame is specified, then initialize a trap frame and</span>
00133     <span class="comment">// and an exception frame with the specified user mode context.</span>
00134     <span class="comment">//</span>
00135 
00136     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(ContextFrame)) {
00137 
00138         RtlMoveMemory(&amp;Context2, ContextFrame, <span class="keyword">sizeof</span>(CONTEXT));
00139         ContextFrame2 = &amp;<a class="code" href="../../d3/d1/threads_8h.html#a108">Context2</a>;
00140         ContextFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a153">CONTEXT_CONTROL</a>;
00141 
00142         <span class="comment">//</span>
00143         <span class="comment">// The 80387 save area is at the very base of the kernel stack.</span>
00144         <span class="comment">//</span>
00145 
00146         NpxFrame = (PFX_SAVE_AREA)(((ULONG)(Thread-&gt;InitialStack) -
00147                     <span class="keyword">sizeof</span>(FX_SAVE_AREA)));
00148 
00149         <span class="comment">//</span>
00150         <span class="comment">// Load up an initial NPX state.</span>
00151         <span class="comment">//</span>
00152 
00153         <span class="keywordflow">if</span> (<a class="code" href="../../d9/d8/i386_2exceptn_8c.html#a9">KeI386XMMIPresent</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00154             PFxSaveArea = (PFXSAVE_FORMAT)ContextFrame2-&gt;ExtendedRegisters;
00155     
00156             PFxSaveArea-&gt;ControlWord   = 0x27f;  <span class="comment">// like fpinit but 64bit mode</span>
00157             PFxSaveArea-&gt;StatusWord    = 0;
00158             PFxSaveArea-&gt;TagWord       = 0;
00159             PFxSaveArea-&gt;ErrorOffset   = 0;
00160             PFxSaveArea-&gt;ErrorSelector = 0;
00161             PFxSaveArea-&gt;DataOffset    = 0;
00162             PFxSaveArea-&gt;DataSelector  = 0;
00163             PFxSaveArea-&gt;MXCsr         = 0x1f80; <span class="comment">// mask all the exceptions</span>
00164         } <span class="keywordflow">else</span> {
00165             ContextFrame2-&gt;FloatSave.ControlWord   = 0x27f;  <span class="comment">// like fpinit but 64bit mode</span>
00166             ContextFrame2-&gt;FloatSave.StatusWord    = 0;
00167             ContextFrame2-&gt;FloatSave.TagWord       = 0xffff;
00168             ContextFrame2-&gt;FloatSave.ErrorOffset   = 0;
00169             ContextFrame2-&gt;FloatSave.ErrorSelector = 0;
00170             ContextFrame2-&gt;FloatSave.DataOffset    = 0;
00171             ContextFrame2-&gt;FloatSave.DataSelector  = 0;
00172         }
00173 
00174 
00175         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d3/i386_8h.html#a23">KeI386NpxPresent</a>) {
00176             ContextFrame2-&gt;FloatSave.Cr0NpxState = 0;
00177             NpxFrame-&gt;Cr0NpxState = 0;
00178             NpxFrame-&gt;NpxSavedCpu = 0;
00179             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d8/i386_2exceptn_8c.html#a9">KeI386XMMIPresent</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00180                 ContextFlags |= CONTEXT_EXTENDED_REGISTERS;
00181             } <span class="keywordflow">else</span> {
00182                 ContextFlags |= <a class="code" href="../../d6/d7/halmips_8h.html#a154">CONTEXT_FLOATING_POINT</a>;
00183             }
00184 
00185             <span class="comment">//</span>
00186             <span class="comment">// Threads NPX state is not in the coprocessor.</span>
00187             <span class="comment">//</span>
00188 
00189             Thread-&gt;NpxState = NPX_STATE_NOT_LOADED;
00190             Thread-&gt;NpxIrql = <a class="code" href="../../d1/d3/ppcdef_8h.html#a21">PASSIVE_LEVEL</a>;
00191 
00192         } <span class="keywordflow">else</span> {
00193             NpxFrame-&gt;Cr0NpxState = CR0_EM;
00194 
00195             <span class="comment">//</span>
00196             <span class="comment">// Threads NPX state is not in the coprocessor.</span>
00197             <span class="comment">// In the emulator case, do not set the CR0_EM bit as their</span>
00198             <span class="comment">// emulators may not want exceptions on FWAIT instructions.</span>
00199             <span class="comment">//</span>
00200 
00201             Thread-&gt;NpxState = NPX_STATE_NOT_LOADED &amp; ~CR0_MP;
00202         }
00203 
00204         <span class="comment">//</span>
00205         <span class="comment">// Force debug registers off.  They won't work anyway from an</span>
00206         <span class="comment">// initial frame, debuggers must set a hard breakpoint in the target</span>
00207         <span class="comment">//</span>
00208 
00209         ContextFrame2-&gt;Dr0 = 0;
00210         ContextFrame2-&gt;Dr1 = 0;
00211         ContextFrame2-&gt;Dr2 = 0;
00212         ContextFrame2-&gt;Dr3 = 0;
00213         ContextFrame2-&gt;Dr6 = 0;
00214         ContextFrame2-&gt;Dr7 = 0;
00215         ContextFrame2-&gt;ContextFlags &amp;= ~(CONTEXT_DEBUG_REGISTERS);
00216 <span class="preprocessor">#if 0</span>
00217 <span class="preprocessor"></span>        <span class="comment">//</span>
00218         <span class="comment">// If AutoAlignment is FALSE, we want to set the Alignment Check bit</span>
00219         <span class="comment">// in Eflags, so we will get alignment faults.</span>
00220         <span class="comment">//</span>
00221 
00222         <span class="keywordflow">if</span> (Thread-&gt;AutoAlignment == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00223             ContextFrame2-&gt;EFlags |= EFLAGS_ALIGN_CHECK;
00224         }
00225 <span class="preprocessor">#endif</span>
00226 <span class="preprocessor"></span>        <span class="comment">//</span>
00227         <span class="comment">// If the thread is set</span>
00228 
00229         TrFrame = (PKTRAP_FRAME)(((ULONG)NpxFrame - KTRAP_FRAME_LENGTH));
00230 
00231         <span class="comment">//  Space for arguments to KiThreadStartup.  Order is important,</span>
00232         <span class="comment">//  Since args are passed on stack through KiThreadStartup to</span>
00233         <span class="comment">//  PStartRoutine with PStartContext as an argument.</span>
00234 
00235         PUserContextFlag = (PULONG)TrFrame - 1;
00236         PStartContext = PUserContextFlag - 1;
00237         PStartRoutine = PStartContext - 1;
00238         PSystemRoutine = PStartRoutine - 1;
00239 
00240         SwitchFrame = (PKSWITCHFRAME)((PUCHAR)PSystemRoutine -
00241                                     <span class="keyword">sizeof</span>(KSWITCHFRAME));
00242 
00243         <span class="comment">//</span>
00244         <span class="comment">// Copy information from the specified context frame to the trap and</span>
00245         <span class="comment">// exception frames.</span>
00246         <span class="comment">//</span>
00247 
00248         <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a10">KeContextToKframes</a>(TrFrame, NULL, ContextFrame2,
00249                            ContextFrame2-&gt;ContextFlags | ContextFlags,
00250                            UserMode);
00251 
00252         TrFrame-&gt;HardwareSegSs |= RPL_MASK;
00253         TrFrame-&gt;SegDs |= RPL_MASK;
00254         TrFrame-&gt;SegEs |= RPL_MASK;
00255 
00256 <span class="preprocessor">#if DBG</span>
00257 <span class="preprocessor"></span>        TrFrame-&gt;DbgArgMark = 0xBADB0D00;
00258 <span class="preprocessor">#endif</span>
00259 <span class="preprocessor"></span>
00260         <span class="comment">//</span>
00261         <span class="comment">// Tell KiThreadStartup that a user context is present.</span>
00262         <span class="comment">//</span>
00263 
00264         *PUserContextFlag = 1;
00265 
00266 
00267         <span class="comment">//</span>
00268         <span class="comment">// Initialize the kernel mode ExceptionList pointer</span>
00269         <span class="comment">//</span>
00270 
00271         TrFrame-&gt;ExceptionList = EXCEPTION_CHAIN_END;
00272 
00273         <span class="comment">//</span>
00274         <span class="comment">// Initialize the saved previous processor mode.</span>
00275         <span class="comment">//</span>
00276 
00277         TrFrame-&gt;PreviousPreviousMode = <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>;
00278 
00279         <span class="comment">//</span>
00280         <span class="comment">// Set the previous mode in thread object to user.</span>
00281         <span class="comment">//</span>
00282 
00283         Thread-&gt;PreviousMode = <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>;
00284 
00285 
00286     } <span class="keywordflow">else</span> {
00287 
00288         <span class="comment">//</span>
00289         <span class="comment">// Dummy floating save area.  Kernel threads don't have or use</span>
00290         <span class="comment">// the floating point - the dummy save area is make the stacks</span>
00291         <span class="comment">// consistent.</span>
00292         <span class="comment">//</span>
00293 
00294         NpxFrame = (PFX_SAVE_AREA)(((ULONG)(Thread-&gt;InitialStack) -
00295                     <span class="keyword">sizeof</span>(FX_SAVE_AREA)));
00296 
00297         <span class="comment">//</span>
00298         <span class="comment">// Load up an initial NPX state.</span>
00299         <span class="comment">//</span>
00300         RtlZeroMemory((PVOID)NpxFrame, <span class="keyword">sizeof</span>(FX_SAVE_AREA));
00301 
00302         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d3/i386_8h.html#a24">KeI386FxsrPresent</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00303             NpxFrame-&gt;U.FxArea.ControlWord = 0x27f;<span class="comment">//like fpinit but 64bit mode</span>
00304             NpxFrame-&gt;U.FxArea.MXCsr       = 0x1f80;<span class="comment">// mask all the exceptions</span>
00305         } <span class="keywordflow">else</span> {
00306             NpxFrame-&gt;U.FnArea.ControlWord  = 0x27f;<span class="comment">//like fpinit but 64bit mode</span>
00307             NpxFrame-&gt;U.FnArea.TagWord      = 0xffff;
00308         }
00309 
00310         <span class="comment">//</span>
00311         <span class="comment">// Threads NPX state is not in the coprocessor.</span>
00312         <span class="comment">//</span>
00313 
00314         Thread-&gt;NpxState = NPX_STATE_NOT_LOADED;
00315 
00316         <span class="comment">//</span>
00317         <span class="comment">//  Space for arguments to KiThreadStartup.</span>
00318         <span class="comment">//  Order of fields in the switchframe is important,</span>
00319         <span class="comment">//  Since args are passed on stack through KiThreadStartup to</span>
00320         <span class="comment">//  PStartRoutine with PStartContext as an argument.</span>
00321         <span class="comment">//</span>
00322 
00323         PUserContextFlag = (PULONG)((ULONG)NpxFrame) - 1;
00324 
00325         PStartContext = PUserContextFlag - 1;
00326         PStartRoutine = PStartContext - 1;
00327         PSystemRoutine = PStartRoutine - 1;
00328 
00329         SwitchFrame = (PKSWITCHFRAME)((PUCHAR)PSystemRoutine -
00330                                         <span class="keyword">sizeof</span>(KSWITCHFRAME));
00331 
00332 
00333         <span class="comment">//</span>
00334         <span class="comment">// Tell KiThreadStartup that a user context is NOT present.</span>
00335         <span class="comment">//</span>
00336 
00337         *PUserContextFlag = 0;
00338 
00339 
00340         <span class="comment">//</span>
00341         <span class="comment">// Set the previous mode in thread object to kernel.</span>
00342         <span class="comment">//</span>
00343 
00344         Thread-&gt;PreviousMode = <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>;
00345     }
00346 
00347     <span class="comment">//</span>
00348     <span class="comment">//  Set up thread start parameters.</span>
00349     <span class="comment">//  (UserContextFlag set above)</span>
00350     <span class="comment">//</span>
00351 
00352     *PStartContext = (ULONG)StartContext;
00353     *PStartRoutine = (ULONG)StartRoutine;
00354     *PSystemRoutine = (ULONG)SystemRoutine;
00355 
00356 
00357     <span class="comment">//</span>
00358     <span class="comment">//  Set up switch frame.  Assume the thread doesn't use the 80387;</span>
00359     <span class="comment">//  if it ever does (and there is one), these flags will get reset.</span>
00360     <span class="comment">//  Each thread starts with these same flags set, regardless of</span>
00361     <span class="comment">//  whether the hardware exists or not.</span>
00362     <span class="comment">//</span>
00363 
00364     SwitchFrame-&gt;RetAddr = (ULONG)<a class="code" href="../../d0/d0/ki_8h.html#a139">KiThreadStartup</a>;
00365 
00366     SwitchFrame-&gt;Eflags = EFLAGS_INTERRUPT_MASK;
00367 
00368 <span class="preprocessor">#if 0</span>
00369 <span class="preprocessor"></span>    <span class="comment">//</span>
00370     <span class="comment">// If AutoAlignment is FALSE, we want to set the Alignment Check bit</span>
00371     <span class="comment">// in Eflags, so we will get alignment faults.</span>
00372     <span class="comment">//</span>
00373 
00374     <span class="keywordflow">if</span> (Thread-&gt;AutoAlignment == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00375         SwitchFrame-&gt;Eflags |= EFLAGS_ALIGN_CHECK;
00376     }
00377 <span class="preprocessor">#endif</span>
00378 <span class="preprocessor"></span>
00379     SwitchFrame-&gt;ExceptionList = (ULONG)(EXCEPTION_CHAIN_END);
00380 
00381     <span class="comment">//</span>
00382     <span class="comment">// Set the initial kernel stack pointer.</span>
00383     <span class="comment">//</span>
00384 
00385 <span class="comment">//DbgPrint("KiInitializeContextThread Thread %08x  SwitchFrame %08x\n", Thread, SwitchFrame);</span>
00386 <span class="comment">//DbgPrint("PSystemRoutine %08x  PStartRoutine %08x  PStartContext %08x\n", *PSystemRoutine, *PStartRoutine, *PStartContext);</span>
00387 
00388     Thread-&gt;KernelStack = (PVOID)SwitchFrame;
00389     <span class="keywordflow">return</span>;
00390 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a118" doxytag="ki.h::KiInitializeKernel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiInitializeKernel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>IdleStack</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKPRCB&nbsp;</td>
          <td class="mdname" nowrap> <em>Prcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN CCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Number</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LoaderBlock</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">65</a> of file <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html">alpha/initkr.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00869">_BOOT_STATUS::BootFinished</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01359">_RESTART_BLOCK::BootStatus</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00029">CcMasterSpinLock</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00075">CcVacbSpinLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00041">DBG_STATUS_CONTROL_C</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02496">DMA_READ_DCACHE_INVALIDATE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02498">DMA_WRITE_DCACHE_SNOOP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d0/d0/ki_8h.html#a86">ExpInitializeExecutive()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d7/hal_8h.html#a196">HalInitializeProcessor()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00091">HIGH_LEVEL</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d6/d5/4_2kdinit_8c-source.html#l00072">KdInitSystem()</a>, <a class="el" href="../../d8/d5/4_2kdlock_8c-source.html#l00093">KdPollBreakIn()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02780">KeFeatureBits</a>, <a class="el" href="../../d4/d9/ke_8h.html#a374">KeFlushCurrentTb()</a>, <a class="el" href="../../d5/d0/dpcobj_8c-source.html#l00039">KeInitializeDpc()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00063">KeInitializeProcess()</a>, <a class="el" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00043">KeInitializeThread()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02773">KeLoaderBlock</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02774">KeMaximumIncrement</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02776">KeNumberProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02777">KeProcessorArchitecture</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02778">KeProcessorLevel</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02779">KeProcessorRevision</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01838">KeSetPriorityThread()</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00127">KiAdjustDpcThreshold</a>, <a class="el" href="../../d0/d0/ki_8h.html#a97">KiApcInterrupt()</a>, <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00237">KiComputeReciprocal()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l01113">KiContextSwapLock</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l01095">KiDisableAlignmentExceptions</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00332">KiDispatcherLock</a>, <a class="el" href="../../d0/d0/ki_8h.html#a111">KiDispatchInterrupt()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00301">KiDmaIoCoherency</a>, <a class="el" href="../../d6/d9/kernlini_8c.html#a43">KiGetFeatureBits()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00044">KiIdleSummary</a>, <a class="el" href="../../d1/d2/ppc_2initkr_8c-source.html#l00062">KiInitExceptionFilter()</a>, <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00125">KiMaximumDpcQueueDepth</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00126">KiMinimumDpcRate</a>, <a class="el" href="../../d0/d0/ki_8h.html#a129">KiPassiveRelease()</a>, <a class="el" href="../../d1/d2/ppc_2initkr_8c-source.html#l00705">KiPhase0SyncIoMap()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>, <a class="el" href="../../d0/d0/ki_8h.html#a35">KiQuantumEnd</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00505">KiTimeIncrementReciprocal</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00512">KiTimeIncrementShiftCount</a>, <a class="el" href="../../d0/d0/ki_8h.html#a142">KiUnexpectedInterrupt()</a>, <a class="el" href="../../d0/d9/ntosdef_8h.html#a75a63">LockQueueContextSwapLock</a>, <a class="el" href="../../d0/d9/ntosdef_8h.html#a75a62">LockQueueDispatcherLock</a>, <a class="el" href="../../d0/d9/ntosdef_8h.html#a75a67">LockQueueMasterLock</a>, <a class="el" href="../../d0/d9/ntosdef_8h.html#a75a64">LockQueuePfnLock</a>, <a class="el" href="../../d0/d9/ntosdef_8h.html#a75a65">LockQueueSystemSpaceLock</a>, <a class="el" href="../../d0/d9/ntosdef_8h.html#a75a66">LockQueueVacbLock</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l01420">MAXIMUM_PROCESSORS</a>, <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00039">MmPfnLock</a>, <a class="el" href="../../d5/d3/alpha_2splocks_8c-source.html#l00072">MmSystemSpaceLock</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00050">NIL</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00600">PAGE_SHIFT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d2/d2/ppcdef_8h-source.html#l00079">PASSIVE_LEVEL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00601">PDI_SHIFT</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00266">PKDEFERRED_ROUTINE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00367">PKSTART_ROUTINE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00379">PKSYSTEM_ROUTINE</a>, <a class="el" href="../../d1/d2/po_8h.html#a57">PoInitializePrcb()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00177">PRCB_MAJOR_VERSION</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00176">PRCB_MINOR_VERSION</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a193">Running</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00065">SetMember</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00076                    :
00077 
00078     This function gains <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system has been bootstrapped and
00079     before <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system has been initialized. Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to initialize
00080     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel data structures, initialize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> idle thread and process objects,
00081     initialize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> block, call <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> executive initialization
00082     routine, and then <span class="keywordflow">return</span> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system startup routine. This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00083     also called to initialize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor specific structures when a <span class="keyword">new</span>
00084     processor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> brought on line.
00085 
00086 Arguments:
00087 
00088     Process - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> process <span class="keywordflow">for</span>
00089         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified processor.
00090 
00091     Thread - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread <span class="keywordflow">for</span>
00092         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified processor.
00093 
00094     IdleStack - Supplies a pointer <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> real kernel stack <span class="keywordflow">for</span>
00095         idle thread on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified processor.
00096 
00097     Prcb - Supplies a pointer to a processor <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> block <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00098         processor.
00099 
00100     Number - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being
00101         initialized.
00102 
00103     LoaderBlock - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> loader parameter block.
00104 
00105 Return Value:
00106 
00107     None.
00108 
00109 --*/
00110 
00111 {
00112 
00113     UCHAR DataByte;
00114     ULONG DataLong;
00115     LONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00116     KIRQL OldIrql;
00117     PKPCR Pcr = PCR;
00118     <span class="keyword">struct </span><a class="code" href="../../d5/d4/struct__RESTART__BLOCK.html">_RESTART_BLOCK</a> *RestartBlock;
00119 
00120     <span class="comment">//</span>
00121     <span class="comment">// Save the address of the loader parameter block.</span>
00122     <span class="comment">//</span>
00123 
00124     <a class="code" href="../../d4/d9/ke_8h.html#a130">KeLoaderBlock</a> = LoaderBlock;
00125 
00126     <span class="comment">//</span>
00127     <span class="comment">// Set the appropriate member in the active processors set.</span>
00128     <span class="comment">//</span>
00129 
00130     <a class="code" href="../../d0/d0/ki_8h.html#a7">SetMember</a>(Number, KeActiveProcessors);
00131 
00132     <span class="comment">//</span>
00133     <span class="comment">// Set the number of processors based on the maximum of the current</span>
00134     <span class="comment">// number of processors and the current processor number.</span>
00135     <span class="comment">//</span>
00136 
00137     <span class="keywordflow">if</span> ((Number + 1) &gt; <a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>) {
00138         <a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a> = Number + 1;
00139     }
00140 
00141     <span class="comment">//</span>
00142     <span class="comment">// Set the maximum address space number to the minimum of all maximum</span>
00143     <span class="comment">// address space numbers passed via the loader block.</span>
00144     <span class="comment">//</span>
00145 
00146     <span class="keywordflow">if</span> (Number == 0) {
00147         KiMaximumAsn = LoaderBlock-&gt;u.Alpha.MaximumAddressSpaceNumber;
00148 
00149     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (KiMaximumAsn &gt; LoaderBlock-&gt;u.Alpha.MaximumAddressSpaceNumber) {
00150         KiMaximumAsn = LoaderBlock-&gt;u.Alpha.MaximumAddressSpaceNumber;
00151     }
00152 
00153     <span class="comment">//</span>
00154     <span class="comment">// Initialize the passive release, APC, and DPC interrupt vectors.</span>
00155     <span class="comment">//</span>
00156 
00157     Pcr-&gt;InterruptRoutine[0] = <a class="code" href="../../d0/d0/ki_8h.html#a129">KiPassiveRelease</a>;
00158     Pcr-&gt;InterruptRoutine[<a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>] = <a class="code" href="../../d0/d0/ki_8h.html#a97">KiApcInterrupt</a>;
00159     Pcr-&gt;InterruptRoutine[<a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>] = <a class="code" href="../../d0/d0/ki_8h.html#a111">KiDispatchInterrupt</a>;
00160     Pcr-&gt;ReservedVectors =
00161         (1 &lt;&lt; <a class="code" href="../../d1/d3/ppcdef_8h.html#a21">PASSIVE_LEVEL</a>) | (1 &lt;&lt; <a class="code" href="../../d6/d7/halmips_8h.html#a52">APC_LEVEL</a>) | (1 &lt;&lt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>);
00162 
00163     <span class="comment">//</span>
00164     <span class="comment">// Initialize the processor id fields in the PCR.</span>
00165     <span class="comment">//</span>
00166 
00167     Pcr-&gt;Number = Number;
00168     Pcr-&gt;SetMember = 1 &lt;&lt; Number;
00169     Pcr-&gt;NotMember = ~Pcr-&gt;SetMember;
00170 
00171     <span class="comment">//</span>
00172     <span class="comment">// Initialize the processor block.</span>
00173     <span class="comment">//</span>
00174 
00175     Prcb-&gt;MinorVersion = <a class="code" href="../../d6/d7/halmips_8h.html#a101">PRCB_MINOR_VERSION</a>;
00176     Prcb-&gt;MajorVersion = <a class="code" href="../../d6/d7/halmips_8h.html#a102">PRCB_MAJOR_VERSION</a>;
00177     Prcb-&gt;BuildType = 0;
00178 
00179 <span class="preprocessor">#if DBG</span>
00180 <span class="preprocessor"></span>
00181     Prcb-&gt;BuildType |= PRCB_BUILD_DEBUG;
00182 
00183 <span class="preprocessor">#endif</span>
00184 <span class="preprocessor"></span>
00185 <span class="preprocessor">#ifdef NT_UP</span>
00186 <span class="preprocessor"></span>
00187     Prcb-&gt;BuildType |= PRCB_BUILD_UNIPROCESSOR;
00188 
00189 <span class="preprocessor">#endif</span>
00190 <span class="preprocessor"></span>
00191     Prcb-&gt;CurrentThread = Thread;
00192     Prcb-&gt;NextThread = (<a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00193     Prcb-&gt;IdleThread = Thread;
00194     Prcb-&gt;Number = Number;
00195     Prcb-&gt;SetMember = 1 &lt;&lt; Number;
00196 
00197     <a class="code" href="../../d4/d1/dpcobj_8c.html#a1">KeInitializeDpc</a>(&amp;Prcb-&gt;QuantumEndDpc,
00198                     (PKDEFERRED_ROUTINE)KiQuantumEnd,
00199                     NIL);
00200 
00201     <span class="comment">//</span>
00202     <span class="comment">// initialize the per processor lock queue entry for implemented locks.</span>
00203     <span class="comment">//</span>
00204 
00205 <span class="preprocessor">#if !defined(NT_UP)</span>
00206 <span class="preprocessor"></span>
00207     Prcb-&gt;LockQueue[<a class="code" href="../../d0/d9/ntosdef_8h.html#a75a62">LockQueueDispatcherLock</a>].Next = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00208     Prcb-&gt;LockQueue[<a class="code" href="../../d0/d9/ntosdef_8h.html#a75a62">LockQueueDispatcherLock</a>].Lock = &amp;<a class="code" href="../../d5/d9/kernldat_8c.html#a38">KiDispatcherLock</a>;
00209     Prcb-&gt;LockQueue[<a class="code" href="../../d0/d9/ntosdef_8h.html#a75a63">LockQueueContextSwapLock</a>].Next = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00210     Prcb-&gt;LockQueue[<a class="code" href="../../d0/d9/ntosdef_8h.html#a75a63">LockQueueContextSwapLock</a>].Lock = &amp;<a class="code" href="../../d0/d0/ki_8h.html#a40">KiContextSwapLock</a>;
00211     Prcb-&gt;LockQueue[<a class="code" href="../../d0/d9/ntosdef_8h.html#a75a64">LockQueuePfnLock</a>].Next = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00212     Prcb-&gt;LockQueue[<a class="code" href="../../d0/d9/ntosdef_8h.html#a75a64">LockQueuePfnLock</a>].Lock = &amp;<a class="code" href="../../d7/d2/alpha_2initkr_8c.html#a2">MmPfnLock</a>;
00213     Prcb-&gt;LockQueue[<a class="code" href="../../d0/d9/ntosdef_8h.html#a75a65">LockQueueSystemSpaceLock</a>].Next = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00214     Prcb-&gt;LockQueue[<a class="code" href="../../d0/d9/ntosdef_8h.html#a75a65">LockQueueSystemSpaceLock</a>].Lock = &amp;<a class="code" href="../../d4/d4/alpha_2splocks_8c.html#a15">MmSystemSpaceLock</a>;
00215     Prcb-&gt;LockQueue[<a class="code" href="../../d0/d9/ntosdef_8h.html#a75a67">LockQueueMasterLock</a>].Next = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00216     Prcb-&gt;LockQueue[<a class="code" href="../../d0/d9/ntosdef_8h.html#a75a67">LockQueueMasterLock</a>].Lock = &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a0">CcMasterSpinLock</a>;
00217     Prcb-&gt;LockQueue[<a class="code" href="../../d0/d9/ntosdef_8h.html#a75a66">LockQueueVacbLock</a>].Next = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00218     Prcb-&gt;LockQueue[<a class="code" href="../../d0/d9/ntosdef_8h.html#a75a66">LockQueueVacbLock</a>].Lock = &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a18">CcVacbSpinLock</a>;
00219 
00220 <span class="preprocessor">#endif</span>
00221 <span class="preprocessor"></span>
00222     <span class="comment">//</span>
00223     <span class="comment">// Set address of PCR in PRCB.</span>
00224     <span class="comment">//</span>
00225 
00226     Prcb-&gt;Pcr = Pcr;
00227 
00228     <span class="comment">//</span>
00229     <span class="comment">// Initialize the interprocessor communication packet.</span>
00230     <span class="comment">//</span>
00231 
00232 <span class="preprocessor">#if !defined(NT_UP)</span>
00233 <span class="preprocessor"></span>
00234     Prcb-&gt;TargetSet = 0;
00235     Prcb-&gt;WorkerRoutine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00236     Prcb-&gt;RequestSummary = 0;
00237     Prcb-&gt;IpiFrozen = 0;
00238 
00239 <span class="preprocessor">#if NT_INST</span>
00240 <span class="preprocessor"></span>
00241     Prcb-&gt;IpiCounts = &amp;KiIpiCounts[Number];
00242 
00243 <span class="preprocessor">#endif //NT_INST</span>
00244 <span class="preprocessor"></span>
00245 <span class="preprocessor">#endif //NT_UP</span>
00246 <span class="preprocessor"></span>
00247     Prcb-&gt;MaximumDpcQueueDepth = <a class="code" href="../../d8/d0/cmdat3_8c.html#a64">KiMaximumDpcQueueDepth</a>;
00248     Prcb-&gt;MinimumDpcRate = <a class="code" href="../../d8/d0/cmdat3_8c.html#a65">KiMinimumDpcRate</a>;
00249     Prcb-&gt;AdjustDpcThreshold = <a class="code" href="../../d8/d0/cmdat3_8c.html#a66">KiAdjustDpcThreshold</a>;
00250 
00251     <span class="comment">//</span>
00252     <span class="comment">// Initialize DPC listhead and lock.</span>
00253     <span class="comment">//</span>
00254 
00255     InitializeListHead(&amp;Prcb-&gt;DpcListHead);
00256     <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>(&amp;Prcb-&gt;DpcLock);
00257 
00258     <span class="comment">//</span>
00259     <span class="comment">// Set address of processor block.</span>
00260     <span class="comment">//</span>
00261 
00262     <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[Number] = Prcb;
00263 
00264     <span class="comment">//</span>
00265     <span class="comment">// Set address of process object in thread object.</span>
00266     <span class="comment">//</span>
00267 
00268     Thread-&gt;ApcState.Process = Process;
00269 
00270     <span class="comment">//</span>
00271     <span class="comment">// Set the appropriate member in the active processors set.</span>
00272     <span class="comment">//</span>
00273 
00274     <a class="code" href="../../d0/d0/ki_8h.html#a7">SetMember</a>( Number, KeActiveProcessors );
00275 
00276     <span class="comment">//</span>
00277     <span class="comment">// Set the number of processors based on the maximum of the current</span>
00278     <span class="comment">// number of processors and the current processor number.</span>
00279     <span class="comment">//</span>
00280 
00281     <span class="keywordflow">if</span>( (Number+1) &gt; <a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a> ){
00282         <a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a> = Number + 1;
00283     }
00284 
00285     <span class="comment">//</span>
00286     <span class="comment">// Initialize processors PowerState</span>
00287     <span class="comment">//</span>
00288 
00289     <a class="code" href="../../d1/d2/po_8h.html#a57">PoInitializePrcb</a> (Prcb);
00290 
00291     <span class="comment">//</span>
00292     <span class="comment">// Set global processor architecture, level and revision.  The</span>
00293     <span class="comment">// latter two are the least common denominator on an MP system.</span>
00294     <span class="comment">//</span>
00295 
00296 <span class="preprocessor">#ifdef _AXP64_</span>
00297 <span class="preprocessor"></span>    <a class="code" href="../../d4/d9/ke_8h.html#a134">KeProcessorArchitecture</a> = PROCESSOR_ARCHITECTURE_ALPHA64;
00298 <span class="preprocessor">#else</span>
00299 <span class="preprocessor"></span>    <a class="code" href="../../d4/d9/ke_8h.html#a134">KeProcessorArchitecture</a> = PROCESSOR_ARCHITECTURE_ALPHA;
00300 <span class="preprocessor">#endif</span>
00301 <span class="preprocessor"></span>
00302     <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d9/ke_8h.html#a135">KeProcessorLevel</a> == 0) ||
00303         (<a class="code" href="../../d4/d9/ke_8h.html#a135">KeProcessorLevel</a> &gt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Pcr-&gt;ProcessorType)) {
00304         <a class="code" href="../../d4/d9/ke_8h.html#a135">KeProcessorLevel</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Pcr-&gt;ProcessorType;
00305     }
00306 
00307     <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d9/ke_8h.html#a136">KeProcessorRevision</a> == 0) ||
00308         (<a class="code" href="../../d4/d9/ke_8h.html#a136">KeProcessorRevision</a> &gt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Pcr-&gt;ProcessorRevision)) {
00309         <a class="code" href="../../d4/d9/ke_8h.html#a136">KeProcessorRevision</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Pcr-&gt;ProcessorRevision;
00310     }
00311 
00312     <span class="comment">//</span>
00313     <span class="comment">// Initialize all interrupt vectors to transfer control to the unexpected</span>
00314     <span class="comment">// interrupt routine.</span>
00315     <span class="comment">//</span>
00316     <span class="comment">// N.B. This interrupt object is never actually "connected" to an interrupt</span>
00317     <span class="comment">//      vector via KeConnectInterrupt. It is initialized and then connected</span>
00318     <span class="comment">//      by simply storing the address of the dispatch code in the interrupt</span>
00319     <span class="comment">//      vector.</span>
00320     <span class="comment">//</span>
00321 
00322     <span class="keywordflow">if</span> (Number == 0) {
00323 
00324         <a class="code" href="../../d4/d9/ke_8h.html#a137">KeFeatureBits</a> = <a class="code" href="../../d6/d9/kernlini_8c.html#a43">KiGetFeatureBits</a>();
00325 
00326         <span class="comment">//</span>
00327         <span class="comment">// Initial the address of the interrupt dispatch routine.</span>
00328         <span class="comment">//</span>
00329 
00330         KxUnexpectedInterrupt.DispatchAddress = <a class="code" href="../../d0/d0/ki_8h.html#a142">KiUnexpectedInterrupt</a>;
00331 
00332         <span class="comment">//</span>
00333         <span class="comment">// Initialize the context swap spinlock.</span>
00334         <span class="comment">//</span>
00335 
00336         <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>(&amp;KiContextSwapLock);
00337 
00338         <span class="comment">//</span>
00339         <span class="comment">// Copy the interrupt dispatch code template into the interrupt object</span>
00340         <span class="comment">// and flush the dcache on all processors that the current thread can</span>
00341         <span class="comment">// run on to ensure that the code is actually in memory.</span>
00342         <span class="comment">//</span>
00343 
00344         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; DISPATCH_LENGTH; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00345             KxUnexpectedInterrupt.DispatchCode[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = KiInterruptTemplate[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00346         }
00347 
00348         <span class="comment">//</span>
00349         <span class="comment">// Sweep the instruction cache on the current processor.</span>
00350         <span class="comment">//</span>
00351 
00352         KiImb();
00353 
00354     } <span class="keywordflow">else</span> {
00355 
00356         <span class="comment">//</span>
00357         <span class="comment">// Mask off feature bits that are not supported on all processors.</span>
00358         <span class="comment">//</span>
00359 
00360         <a class="code" href="../../d4/d9/ke_8h.html#a137">KeFeatureBits</a> &amp;= <a class="code" href="../../d6/d9/kernlini_8c.html#a43">KiGetFeatureBits</a>();
00361     }
00362 
00363     <span class="comment">//</span>
00364     <span class="comment">// Update processor features</span>
00365     <span class="comment">//</span>
00366 
00367     SharedUserData-&gt;ProcessorFeatures[PF_ALPHA_BYTE_INSTRUCTIONS] =
00368         (<a class="code" href="../../d4/d9/ke_8h.html#a137">KeFeatureBits</a> &amp; KF_BYTE) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00369 
00370     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>+1; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; MAXIMUM_VECTOR; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00371         Pcr-&gt;InterruptRoutine[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] =  (PKINTERRUPT_ROUTINE)(&amp;KxUnexpectedInterrupt.DispatchCode);
00372     }
00373 
00374     <span class="comment">//</span>
00375     <span class="comment">// Raise IRQL to APC level.</span>
00376     <span class="comment">//</span>
00377 
00378     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(APC_LEVEL, &amp;OldIrql);
00379 
00380     <span class="comment">//</span>
00381     <span class="comment">// If the initial processor is being initialized, then initialize the</span>
00382     <span class="comment">// per system data structures.</span>
00383     <span class="comment">//</span>
00384 
00385     <span class="keywordflow">if</span> (Number == 0) {
00386 
00387         <span class="comment">//</span>
00388         <span class="comment">// Initialize the address of the restart block for the boot master.</span>
00389         <span class="comment">//</span>
00390 
00391         Prcb-&gt;RestartBlock = SYSTEM_BLOCK-&gt;RestartBlock;
00392 
00393         <span class="comment">//</span>
00394         <span class="comment">// Initialize the kernel debugger if enabled by the load options.</span>
00395         <span class="comment">//</span>
00396 
00397         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/4_2kdinit_8c.html#a4">KdInitSystem</a>(LoaderBlock, FALSE) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00398             <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(PHASE0_INITIALIZATION_FAILED);
00399         }
00400 
00401 <span class="preprocessor">#if DBG</span>
00402 <span class="preprocessor"></span>
00403         <span class="comment">//</span>
00404         <span class="comment">// Allow a breakin to the kernel debugger if one is pending.</span>
00405         <span class="comment">//</span>
00406 
00407         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d6/4_2kdlock_8c.html#a2">KdPollBreakIn</a>() != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>){
00408             DbgBreakPointWithStatus(DBG_STATUS_CONTROL_C);
00409         }
00410 
00411 <span class="preprocessor">#endif //DBG</span>
00412 <span class="preprocessor"></span>
00413         <span class="comment">//</span>
00414         <span class="comment">// Initialize processor block array.</span>
00415         <span class="comment">//</span>
00416 
00417         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 1; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; <a class="code" href="../../d9/d5/ndismain_8h.html#a183">MAXIMUM_PROCESSORS</a>; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00418             <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] = (PKPRCB)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00419         }
00420 
00421         <span class="comment">//</span>
00422         <span class="comment">// Initialize default DMA coherency value for Alpha.</span>
00423         <span class="comment">//</span>
00424 
00425         <a class="code" href="../../d5/d9/kernldat_8c.html#a34">KiDmaIoCoherency</a> = <a class="code" href="../../d4/d9/ke_8h.html#a40">DMA_READ_DCACHE_INVALIDATE</a> | <a class="code" href="../../d4/d9/ke_8h.html#a42">DMA_WRITE_DCACHE_SNOOP</a>;
00426 
00427         <span class="comment">//</span>
00428         <span class="comment">// Perform architecture independent initialization.</span>
00429         <span class="comment">//</span>
00430 
00431         <a class="code" href="../../d2/d0/kiinit_8c.html#a1">KiInitSystem</a>();
00432 
00433         <span class="comment">//</span>
00434         <span class="comment">// Initialize idle thread process object and then set:</span>
00435         <span class="comment">//</span>
00436         <span class="comment">//      1. all the quantum values to the maximum possible.</span>
00437         <span class="comment">//      2. the process in the balance set.</span>
00438         <span class="comment">//      3. the active processor mask to the specified processor.</span>
00439         <span class="comment">//</span>
00440 
00441         <a class="code" href="../../d3/d5/procobj_8c.html#a3">KeInitializeProcess</a>(Process,
00442                             (KPRIORITY)0,
00443                             (KAFFINITY)(0xffffffff),
00444                             (PULONG_PTR)PDE_SELFMAP,
00445                             FALSE);
00446 
00447         Process-&gt;ThreadQuantum = MAXCHAR;
00448     }
00449 
00450     <span class="comment">//</span>
00451     <span class="comment">// Initialize idle thread object and then set:</span>
00452     <span class="comment">//</span>
00453     <span class="comment">//      1. the initial kernel stack to the specified idle stack.</span>
00454     <span class="comment">//      2. the next processor number to the specified processor.</span>
00455     <span class="comment">//      3. the thread priority to the highest possible value.</span>
00456     <span class="comment">//      4. the state of the thread to running.</span>
00457     <span class="comment">//      5. the thread affinity to the specified processor.</span>
00458     <span class="comment">//      6. the specified processor member in the process active processors</span>
00459     <span class="comment">//          set.</span>
00460     <span class="comment">//</span>
00461 
00462     <a class="code" href="../../d9/d1/thredobj_8c.html#a1">KeInitializeThread</a>(Thread,
00463                        (PVOID)((ULONG_PTR)IdleStack - PAGE_SIZE),
00464                        (PKSYSTEM_ROUTINE)NULL,
00465                        (PKSTART_ROUTINE)NULL,
00466                        (PVOID)NULL,
00467                        (PCONTEXT)NULL,
00468                        (PVOID)NULL,
00469                        Process);
00470 
00471     Thread-&gt;InitialStack = IdleStack;
00472     Thread-&gt;StackBase = IdleStack;
00473     Thread-&gt;StackLimit = (PVOID)((ULONG_PTR)IdleStack - KERNEL_STACK_SIZE);
00474     Thread-&gt;NextProcessor = Number;
00475     Thread-&gt;Priority = HIGH_PRIORITY;
00476     Thread-&gt;State = <a class="code" href="../../d4/d9/ke_8h.html#a406a193">Running</a>;
00477     Thread-&gt;Affinity = (KAFFINITY)(1 &lt;&lt; Number);
00478     Thread-&gt;WaitIrql = <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>;
00479 
00480     <span class="comment">//</span>
00481     <span class="comment">// If the current processor is the boot master then set the appropriate</span>
00482     <span class="comment">// bit in the active summary of the idle process.</span>
00483     <span class="comment">//</span>
00484 
00485     <span class="keywordflow">if</span> (Number == 0) {
00486         <a class="code" href="../../d0/d0/ki_8h.html#a7">SetMember</a>(Number, Process-&gt;ActiveProcessors);
00487     }
00488 
00489     <span class="comment">//</span>
00490     <span class="comment">// call the executive initialization routine.</span>
00491     <span class="comment">//</span>
00492 
00493     <span class="keywordflow">try</span> {
00494         <a class="code" href="../../d0/d0/ki_8h.html#a86">ExpInitializeExecutive</a>(Number, LoaderBlock);
00495 
00496     } except(<a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(PHASE0_EXCEPTION,
00497                           (ULONG)GetExceptionCode(),
00498                           (ULONG_PTR)GetExceptionInformation(),
00499                           0,0), EXCEPTION_EXECUTE_HANDLER) {
00500         ; <span class="comment">// should never get here</span>
00501     }
00502 
00503     <span class="comment">//</span>
00504     <span class="comment">// If the initial processor is being initialized, then compute the</span>
00505     <span class="comment">// timer table reciprocal value and reset the PRCB values for</span>
00506     <span class="comment">// the controllable DPC behavior in order to reflect any registry</span>
00507     <span class="comment">// overrides.</span>
00508     <span class="comment">//</span>
00509 
00510     <span class="keywordflow">if</span> (Number == 0) {
00511         <a class="code" href="../../d5/d9/kernldat_8c.html#a59">KiTimeIncrementReciprocal</a> = <a class="code" href="../../d2/d0/kiinit_8c.html#a2">KiComputeReciprocal</a>((LONG)KeMaximumIncrement,
00512                                                         &amp;KiTimeIncrementShiftCount);
00513 
00514         Prcb-&gt;MaximumDpcQueueDepth = <a class="code" href="../../d8/d0/cmdat3_8c.html#a64">KiMaximumDpcQueueDepth</a>;
00515         Prcb-&gt;MinimumDpcRate = <a class="code" href="../../d8/d0/cmdat3_8c.html#a65">KiMinimumDpcRate</a>;
00516         Prcb-&gt;AdjustDpcThreshold = <a class="code" href="../../d8/d0/cmdat3_8c.html#a66">KiAdjustDpcThreshold</a>;
00517     }
00518 
00519     <span class="comment">//</span>
00520     <span class="comment">// Try to enable automatic PAL code fixups on this processor.</span>
00521     <span class="comment">// This must be done after the configuration values are read</span>
00522     <span class="comment">// out of the registry in ExpInitializeExecutive.</span>
00523     <span class="comment">//</span>
00524 
00525     <a class="code" href="../../d0/d0/ki_8h.html#a29">KiDisableAlignmentExceptions</a>();
00526 
00527     <span class="comment">//</span>
00528     <span class="comment">//</span>
00529     <span class="comment">// Raise IRQL to dispatch level and set the priority of the idle thread</span>
00530     <span class="comment">// to zero. This will have the effect of immediately causing the phase</span>
00531     <span class="comment">// one initialization thread to get scheduled for execution. The idle</span>
00532     <span class="comment">// thread priority is then set to the lowest realtime priority.</span>
00533     <span class="comment">//</span>
00534 
00535     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(DISPATCH_LEVEL, &amp;OldIrql);
00536     <a class="code" href="../../d9/d1/thredobj_8c.html#a24">KeSetPriorityThread</a>(Thread, (KPRIORITY)0);
00537     Thread-&gt;Priority = LOW_REALTIME_PRIORITY;
00538 
00539     <span class="comment">//</span>
00540     <span class="comment">// Raise IRQL to the highest level.</span>
00541     <span class="comment">//</span>
00542 
00543     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(HIGH_LEVEL, &amp;OldIrql);
00544 
00545     <span class="comment">//</span>
00546     <span class="comment">// If a restart block exists for the current processor then set boot</span>
00547     <span class="comment">// completed.</span>
00548     <span class="comment">//</span>
00549 
00550 <span class="preprocessor">#if !defined(NT_UP)</span>
00551 <span class="preprocessor"></span>
00552     RestartBlock = Prcb-&gt;RestartBlock;
00553     <span class="keywordflow">if</span> (RestartBlock != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00554         RestartBlock-&gt;BootStatus.BootFinished = 1;
00555     }
00556 
00557     <span class="comment">//</span>
00558     <span class="comment">// If the current processor is a secondary processor and a thread has</span>
00559     <span class="comment">// not been selected for execution, then set the appropriate bit in the</span>
00560     <span class="comment">// idle summary.</span>
00561     <span class="comment">//</span>
00562 
00563     <span class="keywordflow">if</span> ((Number != 0) &amp;&amp; (Prcb-&gt;NextThread == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00564         <a class="code" href="../../d0/d0/ki_8h.html#a7">SetMember</a>(Number, KiIdleSummary);
00565     }
00566 
00567 <span class="preprocessor">#endif //NT_UP</span>
00568 <span class="preprocessor"></span>
00569     <span class="keywordflow">return</span>;
00570 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a121" doxytag="ki.h::KiInitializeUserApc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiInitializeUserApc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d6/alpha_2apcuser_8c-source.html#l00033">33</a> of file <a class="el" href="../../d8/d6/alpha_2apcuser_8c-source.html">alpha/apcuser.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00239">CONTEXT_FULL</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00081">KeContextFromKframes()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02808">KeUserApcDispatcher</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00886">KiCopyInformation()</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00373">KiDispatchException()</a>, <a class="el" href="../../d0/d4/probe_8c-source.html#l00034">ProbeForWrite()</a>, <a class="el" href="../../d8/d9/psctxppc_8c-source.html#l00027">STK_MIN_FRAME</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00030">KiDeliverApc()</a>.
<p>
<pre class="fragment"><div>00044                    :
00045 
00046     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to initialize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context <span class="keywordflow">for</span> a user mode APC.
00047 
00048 Arguments:
00049 
00050     ExceptionFrame - Supplies a pointer to an exception frame.
00051 
00052     TrapFrame - Supplies a pointer to a trap frame.
00053 
00054     NormalRoutine - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user mode APC routine.
00055 
00056     NormalContext - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user context <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC
00057         routine.
00058 
00059     SystemArgument1 - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first system supplied value.
00060 
00061     SystemArgument2 - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> second system supplied value.
00062 
00063 Return Value:
00064 
00065     None.
00066 
00067 --*/
00068 
00069 {
00070 
00071     CONTEXT ContextRecord;
00072     EXCEPTION_RECORD ExceptionRecord;
00073     LONG_PTR Length;
00074     ULONG_PTR UserStack;
00075 
00076     <span class="comment">//</span>
00077     <span class="comment">// Move the user mode state from the trap and exception frames to the</span>
00078     <span class="comment">// context frame.</span>
00079     <span class="comment">//</span>
00080 
00081     ContextRecord.ContextFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a152">CONTEXT_FULL</a>;
00082     <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a9">KeContextFromKframes</a>(TrapFrame, ExceptionFrame, &amp;ContextRecord);
00083 
00084     <span class="comment">//</span>
00085     <span class="comment">// Transfer the context information to the user stack, initialize the</span>
00086     <span class="comment">// APC routine parameters, and modify the trap frame so execution will</span>
00087     <span class="comment">// continue in user mode at the user mode APC dispatch routine.</span>
00088     <span class="comment">//</span>
00089 
00090     <span class="keywordflow">try</span> {
00091 
00092         <span class="comment">//</span>
00093         <span class="comment">// Compute length of context record and new aligned user stack pointer.</span>
00094         <span class="comment">//</span>
00095 
00096         Length = (<span class="keyword">sizeof</span>(CONTEXT) + 15) &amp; (~15);
00097         UserStack = ((ULONG_PTR)ContextRecord.IntSp &amp; (~15)) - Length;
00098 
00099         <span class="comment">//</span>
00100         <span class="comment">// Probe user stack area for writeability and then transfer the</span>
00101         <span class="comment">// context record to the user stack.</span>
00102         <span class="comment">//</span>
00103 
00104         <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>((PVOID)UserStack, (ULONG)Length, <span class="keyword">sizeof</span>(QUAD));
00105         RtlMoveMemory((PVOID)UserStack, &amp;ContextRecord, <span class="keyword">sizeof</span>(CONTEXT));
00106 
00107         <span class="comment">//</span>
00108         <span class="comment">// Set the address of the user APC routine, the APC parameters, the</span>
00109         <span class="comment">// new frame pointer, and the new stack pointer in the current trap</span>
00110         <span class="comment">// frame. Set the continuation address so control will be transferred</span>
00111         <span class="comment">// to the user APC dispatcher.</span>
00112         <span class="comment">//</span>
00113         <span class="comment">// N.B. It is not possible to pass 64 bit arguments to the routine.</span>
00114         <span class="comment">// N.B. ULONG becomes canonical longword with (ULONGLONG)(LONG) cast.</span>
00115         <span class="comment">//</span>
00116         <span class="comment">//</span>
00117 
00118         TrapFrame-&gt;IntSp = (ULONGLONG)(LONG_PTR)UserStack;
00119         TrapFrame-&gt;IntFp = (ULONGLONG)(LONG_PTR)UserStack;
00120         TrapFrame-&gt;IntA0 = (ULONGLONG)(LONG_PTR)NormalContext;
00121         TrapFrame-&gt;IntA1 = (ULONGLONG)(LONG_PTR)SystemArgument1;
00122         TrapFrame-&gt;IntA2 = (ULONGLONG)(LONG_PTR)SystemArgument2;
00123         TrapFrame-&gt;IntA3 = (ULONGLONG)(LONG_PTR)NormalRoutine;
00124         TrapFrame-&gt;Fir = (ULONGLONG)(LONG_PTR)<a class="code" href="../../d4/d9/ke_8h.html#a148">KeUserApcDispatcher</a>;
00125 
00126     <span class="comment">//</span>
00127     <span class="comment">// If an exception occurs, then copy the exception information to an</span>
00128     <span class="comment">// exception record and handle the exception.</span>
00129     <span class="comment">//</span>
00130 
00131     } except (<a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a12">KiCopyInformation</a>(&amp;ExceptionRecord,
00132                                 (GetExceptionInformation())-&gt;ExceptionRecord)) {
00133 
00134         <span class="comment">//</span>
00135         <span class="comment">// Set the address of the exception to the current program address</span>
00136         <span class="comment">// and raise the exception by calling the exception dispatcher.</span>
00137         <span class="comment">//</span>
00138 
00139         ExceptionRecord.ExceptionAddress = (PVOID)(TrapFrame-&gt;Fir);
00140         <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a11">KiDispatchException</a>(&amp;ExceptionRecord,
00141                             ExceptionFrame,
00142                             TrapFrame,
00143                             UserMode,
00144                             TRUE);
00145     }
00146 
00147     <span class="keywordflow">return</span>;
00148 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a120" doxytag="ki.h::KiInitMachineDependent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiInitMachineDependent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00041">KeInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a119" doxytag="ki.h::KiInitSystem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiInitSystem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">96</a> of file <a class="el" href="../../d3/d9/kiinit_8c-source.html">kiinit.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00319">_KSERVICE_TABLE_DESCRIPTOR::Base</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00320">_KSERVICE_TABLE_DESCRIPTOR::Count</a>, <a class="el" href="../../d0/d4/callperf_8c-source.html#l00028">ExInitializeCallData()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02770">KeBugCheckCallbackListHead</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02771">KeBugCheckCallbackLock</a>, <a class="el" href="../../d5/d0/dpcobj_8c-source.html#l00039">KeInitializeDpc()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01066">KeInitializeEvent</a>, <a class="el" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02794">KeServiceDescriptorTable</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02795">KeServiceDescriptorTableShadow</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l01135">KiArgumentTable</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00036">KiDispatcherReadyListHead</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l01119">KiFlushSingleCallData</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00428">KiProcessInSwapListHead</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00435">KiProcessOutSwapListHead</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00484">KiProfileListHead</a>, <a class="el" href="../../d5/d3/alpha_2splocks_8c-source.html#l00066">KiProfileLock</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00451">KiProfileSourceListHead</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l01136">KiServiceLimit</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l01137">KiServiceTable</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l01138">KiSetEventCallData</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00444">KiStackInSwapListHead</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00421">KiSwapEvent</a>, <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00217">KiTimerExpiration()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00497">KiTimerExpireDpc</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00059">KiTimerTableListHead</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00519">KiWaitInListHead</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00527">KiWaitOutListHead</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l01152">KiWaitSingleCallData</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00321">_KSERVICE_TABLE_DESCRIPTOR::Limit</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00050">NIL</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00325">_KSERVICE_TABLE_DESCRIPTOR::Number</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00301">NUMBER_SERVICE_TABLES</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00266">PKDEFERRED_ROUTINE</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00094">TIMER_TABLE_SIZE</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.
<p>
<pre class="fragment"><div>00102                    :
00103 
00104     This function initializes architecture independent kernel structures.
00105 
00106 Arguments:
00107 
00108     None.
00109 
00110 Return Value:
00111 
00112     None.
00113 
00114 --*/
00115 
00116 {
00117 
00118     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00119 
00120     <span class="comment">//</span>
00121     <span class="comment">// Initialize dispatcher ready queue listheads.</span>
00122     <span class="comment">//</span>
00123 
00124     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; MAXIMUM_PRIORITY; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00125         InitializeListHead(&amp;KiDispatcherReadyListHead[Index]);
00126     }
00127 
00128     <span class="comment">//</span>
00129     <span class="comment">// Initialize bug check callback listhead and spinlock.</span>
00130     <span class="comment">//</span>
00131 
00132     InitializeListHead(&amp;KeBugCheckCallbackListHead);
00133     <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>(&amp;KeBugCheckCallbackLock);
00134 
00135     <span class="comment">//</span>
00136     <span class="comment">// Initialize the timer expiration DPC object.</span>
00137     <span class="comment">//</span>
00138 
00139     <a class="code" href="../../d4/d1/dpcobj_8c.html#a1">KeInitializeDpc</a>(&amp;KiTimerExpireDpc,
00140                     (PKDEFERRED_ROUTINE)KiTimerExpiration, NIL);
00141 
00142     <span class="comment">//</span>
00143     <span class="comment">// Initialize the profile listhead and profile locks</span>
00144     <span class="comment">//</span>
00145 
00146     <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>(&amp;KiProfileLock);
00147     InitializeListHead(&amp;KiProfileListHead);
00148 
00149     <span class="comment">//</span>
00150     <span class="comment">// Initialize the active profile source listhead.</span>
00151     <span class="comment">//</span>
00152 
00153     InitializeListHead(&amp;KiProfileSourceListHead);
00154 
00155     <span class="comment">//</span>
00156     <span class="comment">// Initialize the timer table, the timer completion listhead, and the</span>
00157     <span class="comment">// timer completion DPC.</span>
00158     <span class="comment">//</span>
00159 
00160     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; <a class="code" href="../../d4/d9/ke_8h.html#a10">TIMER_TABLE_SIZE</a>; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00161         InitializeListHead(&amp;KiTimerTableListHead[Index]);
00162     }
00163 
00164     <span class="comment">//</span>
00165     <span class="comment">// Initialize the swap event, the process inswap listhead, the</span>
00166     <span class="comment">// process outswap listhead, the kernel stack inswap listhead,</span>
00167     <span class="comment">// the wait in listhead, and the wait out listhead.</span>
00168     <span class="comment">//</span>
00169 
00170     <a class="code" href="../../d4/d9/ke_8h.html#a20">KeInitializeEvent</a>(&amp;KiSwapEvent,
00171                       SynchronizationEvent,
00172                       FALSE);
00173 
00174     InitializeListHead(&amp;KiProcessInSwapListHead);
00175     InitializeListHead(&amp;KiProcessOutSwapListHead);
00176     InitializeListHead(&amp;KiStackInSwapListHead);
00177     InitializeListHead(&amp;KiWaitInListHead);
00178     InitializeListHead(&amp;KiWaitOutListHead);
00179 
00180     <span class="comment">//</span>
00181     <span class="comment">// Initialize the system service descriptor table.</span>
00182     <span class="comment">//</span>
00183 
00184     <a class="code" href="../../d4/d9/ke_8h.html#a145">KeServiceDescriptorTable</a>[0].<a class="code" href="../../d9/d7/struct__KSERVICE__TABLE__DESCRIPTOR.html#o0">Base</a> = &amp;<a class="code" href="../../d0/d0/ki_8h.html#a64">KiServiceTable</a>[0];
00185     <a class="code" href="../../d4/d9/ke_8h.html#a145">KeServiceDescriptorTable</a>[0].<a class="code" href="../../d9/d7/struct__KSERVICE__TABLE__DESCRIPTOR.html#o1">Count</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00186     <a class="code" href="../../d4/d9/ke_8h.html#a145">KeServiceDescriptorTable</a>[0].<a class="code" href="../../d9/d7/struct__KSERVICE__TABLE__DESCRIPTOR.html#o2">Limit</a> = <a class="code" href="../../d0/d0/ki_8h.html#a63">KiServiceLimit</a>;
00187 <span class="preprocessor">#if defined(_IA64_)</span>
00188 <span class="preprocessor"></span>
00189     <span class="comment">//</span>
00190     <span class="comment">// The global pointer associated with the table base is</span>
00191     <span class="comment">// placed just before the service table.</span>
00192     <span class="comment">//</span>
00193 
00194     <a class="code" href="../../d4/d9/ke_8h.html#a145">KeServiceDescriptorTable</a>[0].TableBaseGpOffset =
00195         (LONG)(*(<a class="code" href="../../d0/d0/ki_8h.html#a64">KiServiceTable</a>-1) - (ULONG_PTR)<a class="code" href="../../d0/d0/ki_8h.html#a64">KiServiceTable</a>);
00196 <span class="preprocessor">#endif</span>
00197 <span class="preprocessor"></span>    <a class="code" href="../../d4/d9/ke_8h.html#a145">KeServiceDescriptorTable</a>[0].<a class="code" href="../../d9/d7/struct__KSERVICE__TABLE__DESCRIPTOR.html#o3">Number</a> = &amp;<a class="code" href="../../d0/d0/ki_8h.html#a62">KiArgumentTable</a>[0];
00198     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 1; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; <a class="code" href="../../d4/d9/ke_8h.html#a13">NUMBER_SERVICE_TABLES</a>; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00199         <a class="code" href="../../d4/d9/ke_8h.html#a145">KeServiceDescriptorTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d9/d7/struct__KSERVICE__TABLE__DESCRIPTOR.html#o2">Limit</a> = 0;
00200     }
00201 
00202     <span class="comment">//</span>
00203     <span class="comment">// Copy the system service descriptor table to the shadow table</span>
00204     <span class="comment">// which is used to record the Win32 system services.</span>
00205     <span class="comment">//</span>
00206 
00207     RtlCopyMemory(KeServiceDescriptorTableShadow,
00208                   KeServiceDescriptorTable,
00209                   <span class="keyword">sizeof</span>(KeServiceDescriptorTable));
00210 
00211     <span class="comment">//</span>
00212     <span class="comment">// Initialize call performance data structures.</span>
00213     <span class="comment">//</span>
00214 
00215 <span class="preprocessor">#if defined(_COLLECT_FLUSH_SINGLE_CALLDATA_)</span>
00216 <span class="preprocessor"></span>
00217     <a class="code" href="../../d5/d8/ex_8h.html#a209">ExInitializeCallData</a>(&amp;KiFlushSingleCallData);
00218 
00219 <span class="preprocessor">#endif</span>
00220 <span class="preprocessor"></span>
00221 <span class="preprocessor">#if defined(_COLLECT_SET_EVENT_CALLDATA_)</span>
00222 <span class="preprocessor"></span>
00223     <a class="code" href="../../d5/d8/ex_8h.html#a209">ExInitializeCallData</a>(&amp;KiSetEventCallData);
00224 
00225 <span class="preprocessor">#endif</span>
00226 <span class="preprocessor"></span>
00227 <span class="preprocessor">#if defined(_COLLECT_WAIT_SINGLE_CALLDATA_)</span>
00228 <span class="preprocessor"></span>
00229     <a class="code" href="../../d5/d8/ex_8h.html#a209">ExInitializeCallData</a>(&amp;KiWaitSingleCallData);
00230 
00231 <span class="preprocessor">#endif</span>
00232 <span class="preprocessor"></span>
00233     <span class="keywordflow">return</span>;
00234 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a122" doxytag="ki.h::KiInsertQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG FASTCALL KiInsertQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d7/struct__KQUEUE.html">PRKQUEUE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Queue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLIST_ENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>Entry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Head</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00710">710</a> of file <a class="el" href="../../d9/d2/queueobj_8c-source.html">queueobj.c</a>.
<p>
References <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00033">ASSERT_QUEUE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00522">_KTIMER::Header</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00261">_DISPATCHER_HEADER::Inserted</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00755">KiRemoveTreeTimer</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00612">_KTHREAD::Queue</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00281">_KWAIT_BLOCK::Thread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00614">_KTHREAD::Timer</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00588">_KTHREAD::WaitListEntry</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00586">_KTHREAD::WaitReason</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00582">_KTHREAD::WaitStatus</a>, and <a class="el" href="../../d4/d9/ke_8h.html#a407a213">WrQueue</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00181">KeInsertHeadQueue()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00124">KeInsertQueue()</a>, and <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01996">KeTerminateThread()</a>.
<p>
<pre class="fragment"><div>00718                    :
00719 
00720     This function inserts <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified entry in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queue object entry
00721     list and attempts to satisfy <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> wait of a single waiter.
00722 
00723     N.B. The wait discipline <span class="keywordflow">for</span> Queue object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> LIFO.
00724 
00725 Arguments:
00726 
00727     Queue - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> Queue.
00728 
00729     Entry - Supplies a pointer to a list entry that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> inserted in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00730         queue object entry list.
00731 
00732     Head - Supplies a <span class="keywordtype">boolean</span> value that determines whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queue
00733         entry <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> inserted at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> head or tail of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queue <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> can
00734         not be immediately dispatched.
00735 
00736 Return Value:
00737 
00738     The previous signal state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Queue object.
00739 
00740 --*/
00741 
00742 {
00743 
00744     LONG OldState;
00745     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread;
00746     <a class="code" href="../../d3/d8/struct__KTIMER.html">PKTIMER</a> Timer;
00747     <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">PKWAIT_BLOCK</a> WaitBlock;
00748     PLIST_ENTRY WaitEntry;
00749 
00750     <a class="code" href="../../d8/d3/queueobj_8c.html#a0">ASSERT_QUEUE</a>(Queue);
00751 
00752     <span class="comment">//</span>
00753     <span class="comment">// Capture the current signal state of queue object and check if there</span>
00754     <span class="comment">// is a thread waiting on the queue object, the current number of active</span>
00755     <span class="comment">// threads is less than the target number of threads, and the wait reason</span>
00756     <span class="comment">// of the current thread is not queue wait or the wait queue is not the</span>
00757     <span class="comment">// same queue as the insertion queue. If these conditions are satisfied,</span>
00758     <span class="comment">// then satisfy the thread wait and pass the thread the address of the</span>
00759     <span class="comment">// queue entry as the wait status. Otherwise, set the state of the queue</span>
00760     <span class="comment">// object to signaled and insert the specified entry in the queue object</span>
00761     <span class="comment">// entry list.</span>
00762     <span class="comment">//</span>
00763 
00764     OldState = Queue-&gt;Header.SignalState;
00765     Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00766     WaitEntry = Queue-&gt;Header.WaitListHead.Blink;
00767     <span class="keywordflow">if</span> ((WaitEntry != &amp;Queue-&gt;Header.WaitListHead) &amp;&amp;
00768         (Queue-&gt;CurrentCount &lt; Queue-&gt;MaximumCount) &amp;&amp;
00769         ((Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o37">Queue</a> != Queue) ||
00770         (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o20">WaitReason</a> != <a class="code" href="../../d4/d9/ke_8h.html#a407a213">WrQueue</a>))) {
00771 
00772         <span class="comment">//</span>
00773         <span class="comment">// Remove the last wait block from the wait list and get the address</span>
00774         <span class="comment">// of the waiting thread object.</span>
00775         <span class="comment">//</span>
00776 
00777         RemoveEntryList(WaitEntry);
00778         WaitBlock = CONTAINING_RECORD(WaitEntry, <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">KWAIT_BLOCK</a>, WaitListEntry);
00779         Thread = WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o1">Thread</a>;
00780 
00781         <span class="comment">//</span>
00782         <span class="comment">// Set the wait completion status, remove the thread from its wait</span>
00783         <span class="comment">// list, increment the number of active threads, and clear the wait</span>
00784         <span class="comment">// reason.</span>
00785         <span class="comment">//</span>
00786 
00787         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o16">WaitStatus</a> = (LONG_PTR)Entry;
00788         RemoveEntryList(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o22">WaitListEntry</a>);
00789         Queue-&gt;CurrentCount += 1;
00790         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o20">WaitReason</a> = 0;
00791 
00792         <span class="comment">//</span>
00793         <span class="comment">// If thread timer is still active, then cancel thread timer.</span>
00794         <span class="comment">//</span>
00795 
00796         Timer = &amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o39">Timer</a>;
00797         <span class="keywordflow">if</span> (Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o3">Inserted</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00798             <a class="code" href="../../d0/d0/ki_8h.html#a22">KiRemoveTreeTimer</a>(Timer);
00799         }
00800 
00801         <span class="comment">//</span>
00802         <span class="comment">// Ready the thread for execution.</span>
00803         <span class="comment">//</span>
00804 
00805         <a class="code" href="../../d0/d2/thredsup_8c.html#a3">KiReadyThread</a>(Thread);
00806 
00807     } <span class="keywordflow">else</span> {
00808         Queue-&gt;Header.SignalState += 1;
00809         <span class="keywordflow">if</span> (Head != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00810             InsertHeadList(&amp;Queue-&gt;EntryListHead, Entry);
00811 
00812         } <span class="keywordflow">else</span> {
00813             InsertTailList(&amp;Queue-&gt;EntryListHead, Entry);
00814         }
00815     }
00816 
00817     <span class="keywordflow">return</span> OldState;
00818 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a123" doxytag="ki.h::KiInsertQueueApc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FASTCALL KiInsertQueueApc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d5/struct__KAPC.html">PKAPC</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Apc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KPRIORITY&nbsp;</td>
          <td class="mdname" nowrap> <em>Increment</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00223">223</a> of file <a class="el" href="../../d7/d6/apcsup_8c-source.html">apcsup.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00657">_KTHREAD::Alertable</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00243">_KAPC_STATE::ApcListHead</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00613">_KTHREAD::ApcQueueLock</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00658">_KTHREAD::ApcStateIndex</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00638">_KTHREAD::ApcStatePointer</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/rtl_2random_8c-source.html#l00032">Increment</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00596">_KTHREAD::KernelApcDisable</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00245">_KAPC_STATE::KernelApcInProgress</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00246">_KAPC_STATE::KernelApcPending</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00767">KiRequestApcInterrupt</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00031">KiUnwaitThread()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00626">_KTHREAD::NextProcessor</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00243">_KAPC::NormalRoutine</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00603">PsExitSpecialApc()</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a193">Running</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00569">_KTHREAD::State</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00247">_KAPC_STATE::UserApcPending</a>, <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a196">Waiting</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00583">_KTHREAD::WaitIrql</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00584">_KTHREAD::WaitMode</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01257">Ke386VdmInsertQueueApc()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00757">KeFreezeAllThreads()</a>, <a class="el" href="../../d6/d6/apcobj_8c-source.html#l00217">KeInsertQueueApc()</a>, and <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01912">KeSuspendThread()</a>.
<p>
<pre class="fragment"><div>00230                    :
00231 
00232     This function inserts an APC object into a thread's APC queue. The address
00233     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread object, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC queue, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of APC are all derived
00234     from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC object. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already in an APC queue, then
00235     no opertion <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> performed and a function value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned. Else
00236     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> inserted in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified APC queue, its inserted state <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set
00237     to <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, and a function value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned. The APC will actually
00238     be delivered when proper enabling conditions exist.
00239 
00240 Arguments:
00241 
00242     Apc - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> APC.
00243 
00244     <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> priority increment that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be applied <span class="keywordflow">if</span>
00245         queuing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC causes a thread wait to be satisfied.
00246 
00247 Return Value:
00248 
00249     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> APC object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already in an APC queue, then a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00250     returned. Else a value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00251 
00252 --*/
00253 
00254 {
00255 
00256     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> ApcMode;
00257     <a class="code" href="../../d1/d5/struct__KAPC.html">PKAPC</a> ApcEntry;
00258     <a class="code" href="../../d3/d5/struct__KAPC__STATE.html">PKAPC_STATE</a> ApcState;
00259     BOOLEAN Inserted;
00260     PLIST_ENTRY ListEntry;
00261     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
00262 
00263     <span class="comment">//</span>
00264     <span class="comment">// If the APC object is already in an APC queue, then set inserted to</span>
00265     <span class="comment">// FALSE. Else insert the APC object in the proper queue, set the APC</span>
00266     <span class="comment">// inserted state to TRUE, check to determine if the APC should be delivered</span>
00267     <span class="comment">// immediately, and set inserted to TRUE.</span>
00268     <span class="comment">//</span>
00269     <span class="comment">// For multiprocessor performance, the following code utilizes the fact</span>
00270     <span class="comment">// that kernel APC disable count is incremented before checking whether</span>
00271     <span class="comment">// the kernel APC queue is nonempty.</span>
00272     <span class="comment">//</span>
00273     <span class="comment">// See KeLeaveCriticalRegion().</span>
00274     <span class="comment">//</span>
00275 
00276     Thread = Apc-&gt;Thread;
00277     KiAcquireSpinLock(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o38">ApcQueueLock</a>);
00278     <span class="keywordflow">if</span> (Apc-&gt;Inserted) {
00279         Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00280 
00281     } <span class="keywordflow">else</span> {
00282         ApcState = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o49">ApcStatePointer</a>[Apc-&gt;ApcStateIndex];
00283 
00284         <span class="comment">//</span>
00285         <span class="comment">// Insert the APC after all other special APC entries selected by</span>
00286         <span class="comment">// the processor mode if the normal routine value is null. Else</span>
00287         <span class="comment">// insert the APC object at the tail of the APC queue selected by</span>
00288         <span class="comment">// the processor mode unless the APC mode is user and the address</span>
00289         <span class="comment">// of the special APC routine is exit thread, in which case insert</span>
00290         <span class="comment">// the APC at the front of the list and set user APC pending.</span>
00291         <span class="comment">//</span>
00292 
00293         ApcMode = Apc-&gt;ApcMode;
00294         <span class="keywordflow">if</span> (Apc-&gt;NormalRoutine != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00295             <span class="keywordflow">if</span> ((ApcMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) &amp;&amp; (Apc-&gt;KernelRoutine == <a class="code" href="../../d1/d9/ps_8h.html#a117">PsExitSpecialApc</a>)) {
00296                 Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o4">UserApcPending</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00297                 InsertHeadList(&amp;ApcState-&gt;<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o0">ApcListHead</a>[ApcMode],
00298                                &amp;Apc-&gt;ApcListEntry);
00299 
00300             } <span class="keywordflow">else</span> {
00301                 InsertTailList(&amp;ApcState-&gt;<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o0">ApcListHead</a>[ApcMode],
00302                                &amp;Apc-&gt;ApcListEntry);
00303             }
00304 
00305         } <span class="keywordflow">else</span> {
00306             ListEntry = ApcState-&gt;<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o0">ApcListHead</a>[ApcMode].Flink;
00307             <span class="keywordflow">while</span> (ListEntry != &amp;ApcState-&gt;<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o0">ApcListHead</a>[ApcMode]) {
00308                 ApcEntry = CONTAINING_RECORD(ListEntry, <a class="code" href="../../d1/d5/struct__KAPC.html">KAPC</a>, ApcListEntry);
00309                 <span class="keywordflow">if</span> (ApcEntry-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o7">NormalRoutine</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00310                     <span class="keywordflow">break</span>;
00311                 }
00312 
00313                 ListEntry = ListEntry-&gt;Flink;
00314             }
00315 
00316             ListEntry = ListEntry-&gt;Blink;
00317             InsertHeadList(ListEntry, &amp;Apc-&gt;ApcListEntry);
00318         }
00319 
00320         Apc-&gt;Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00321 
00322         <span class="comment">//</span>
00323         <span class="comment">// If the APC index from the APC object matches the APC Index of</span>
00324         <span class="comment">// the thread, then check to determine if the APC should interrupt</span>
00325         <span class="comment">// thread execution or sequence the thread out of a wait state.</span>
00326         <span class="comment">//</span>
00327 
00328         <span class="keywordflow">if</span> (Apc-&gt;ApcStateIndex == Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o58">ApcStateIndex</a>) {
00329 
00330             <span class="comment">//</span>
00331             <span class="comment">// If the processor mode of the APC is kernel, then check if</span>
00332             <span class="comment">// the APC should either interrupt the thread or sequence the</span>
00333             <span class="comment">// thread out of a Waiting state. Else check if the APC should</span>
00334             <span class="comment">// sequence the thread out of an alertable Waiting state.</span>
00335             <span class="comment">//</span>
00336 
00337             <span class="keywordflow">if</span> (ApcMode == <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00338                 Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o3">KernelApcPending</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00339                 <span class="keywordflow">if</span> (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o8">State</a> == <a class="code" href="../../d4/d9/ke_8h.html#a406a193">Running</a>) {
00340                     <a class="code" href="../../d0/d0/ki_8h.html#a23">KiRequestApcInterrupt</a>(Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o45">NextProcessor</a>);
00341 
00342                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o8">State</a> == <a class="code" href="../../d4/d9/ke_8h.html#a406a196">Waiting</a>) &amp;&amp;
00343                           (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o17">WaitIrql</a> == 0) &amp;&amp;
00344                           ((Apc-&gt;NormalRoutine == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00345                           ((Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o30">KernelApcDisable</a> == 0) &amp;&amp;
00346                           (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o2">KernelApcInProgress</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)))) {
00347                     <a class="code" href="../../d2/d7/waitsup_8c.html#a0">KiUnwaitThread</a>(Thread, STATUS_KERNEL_APC, Increment);
00348                 }
00349 
00350             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o8">State</a> == <a class="code" href="../../d4/d9/ke_8h.html#a406a196">Waiting</a>) &amp;&amp;
00351                       (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o18">WaitMode</a> == <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>) &amp;&amp;
00352                       (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o57">Alertable</a>)) {
00353                 Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o4">UserApcPending</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00354                 <a class="code" href="../../d2/d7/waitsup_8c.html#a0">KiUnwaitThread</a>(Thread, STATUS_USER_APC, Increment);
00355             }
00356         }
00357 
00358         Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00359     }
00360 
00361     <span class="comment">//</span>
00362     <span class="comment">// Unlock the APC queue lock, and return whether the APC object was</span>
00363     <span class="comment">// inserted in an APC queue.</span>
00364     <span class="comment">//</span>
00365 
00366     KiReleaseSpinLock(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o38">ApcQueueLock</a>);
00367     <span class="keywordflow">return</span> Inserted;
00368 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a124" doxytag="ki.h::KiInsertTreeTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL FASTCALL KiInsertTreeTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d8/struct__KTIMER.html">PRKTIMER</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Timer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>Interval</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/timersup_8c-source.html#l00042">42</a> of file <a class="el" href="../../d6/d1/timersup_8c-source.html">timersup.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d1/timersup_8c-source.html#l00185">KiInsertTimerTable()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/wait_8c-source.html#l00140">KeDelayExecutionThread()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00238">KeRemoveQueue()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00285">KeSetTimerEx()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00395">KeWaitForMultipleObjects()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, and <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00333">KiTimerListExpire()</a>.
<p>
<pre class="fragment"><div>00049                    :
00050 
00051     This function inserts a timer object in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> timer queue.
00052 
00053     N.B. This routine assumes that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dispatcher data lock has been acquired.
00054 
00055 Arguments:
00056 
00057     Timer - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> timer.
00058 
00059     Interval - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> absolute or relative time at which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> time
00060         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to expire.
00061 
00062 Return Value:
00063 
00064     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> timer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> inserted in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> timer tree, than a value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00065     returned. Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00066 
00067 --*/
00068 
00069 {
00070 
00071     LARGE_INTEGER CurrentTime;
00072     LARGE_INTEGER SystemTime;
00073     LARGE_INTEGER TimeDifference;
00074 
00075     <span class="comment">//</span>
00076     <span class="comment">// Clear the signal state of timer if the timer period is zero and set</span>
00077     <span class="comment">// the inserted state to TRUE.</span>
00078     <span class="comment">//</span>
00079 
00080     Timer-&gt;Header.Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00081     Timer-&gt;Header.Absolute = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00082     <span class="keywordflow">if</span> (Timer-&gt;Period == 0) {
00083         Timer-&gt;Header.SignalState = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00084     }
00085 
00086     <span class="comment">//</span>
00087     <span class="comment">// If the specified interval is not a relative time (i.e., is an absolute</span>
00088     <span class="comment">// time), then convert it to relative time.</span>
00089     <span class="comment">//</span>
00090 
00091     <span class="keywordflow">if</span> (Interval.HighPart &gt;= 0) {
00092         KiQuerySystemTime(&amp;SystemTime);
00093         TimeDifference.QuadPart = SystemTime.QuadPart - Interval.QuadPart;
00094 
00095         <span class="comment">//</span>
00096         <span class="comment">// If the resultant relative time is greater than or equal to zero,</span>
00097         <span class="comment">// then the timer has already expired.</span>
00098         <span class="comment">//</span>
00099 
00100         <span class="keywordflow">if</span> (TimeDifference.HighPart &gt;= 0) {
00101             Timer-&gt;Header.SignalState = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00102             Timer-&gt;Header.Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00103             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00104         }
00105 
00106         Interval = TimeDifference;
00107         Timer-&gt;Header.Absolute = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00108     }
00109 
00110     <span class="comment">//</span>
00111     <span class="comment">// Get the current interrupt time, insert the timer in the timer table,</span>
00112     <span class="comment">// and return the inserted state.</span>
00113     <span class="comment">//</span>
00114 
00115     KiQueryInterruptTime(&amp;CurrentTime);
00116     <span class="keywordflow">return</span> <a class="code" href="../../d5/d2/timersup_8c.html#a0">KiInsertTimerTable</a>(Interval, CurrentTime, Timer);
00117 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a125" doxytag="ki.h::KiInterruptDispatch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiInterruptDispatch           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d3/i386_2intobj_8c-source.html#l00558">KiGetVectorInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a126" doxytag="ki.h::KiInterruptDispatchRaise" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiInterruptDispatchRaise           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d7/struct__KINTERRUPT.html">PKINTERRUPT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Interrupt</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00154">KeConnectInterrupt()</a>, and <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00298">KeDisconnectInterrupt()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a127" doxytag="ki.h::KiInterruptDispatchSame" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiInterruptDispatchSame           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d7/struct__KINTERRUPT.html">PKINTERRUPT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Interrupt</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00154">KeConnectInterrupt()</a>, and <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00298">KeDisconnectInterrupt()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a89" doxytag="ki.h::KiIpiGenericCall" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG_PTR KiIpiGenericCall           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d0/ki_8h.html#a33">PKIPI_BROADCAST_WORKER</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>BroadcastFunction</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/xipi_8c-source.html#l00040">40</a> of file <a class="el" href="../../d3/d0/xipi_8c-source.html">xipi.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00132">KiIpiGenericCallTarget()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00293">PKIPI_BROADCAST_WORKER</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01088">KeI386VdmInitialize()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00223">KeSetIntervalProfile()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00544">KiAdjustInterruptTime()</a>, <a class="el" href="../../d7/d8/kernlini_8c-source.html#l01691">KiInitMachineDependent()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00787">KiSyncMC_Drain()</a>, and <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00885">KiSyncPrefetchVisible()</a>.
<p>
<pre class="fragment"><div>00047                    :
00048 
00049     This function executes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified function on every processor in
00050     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration in a synchronous manner, i.e., <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function
00051     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executed on each target in series with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> execution of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source
00052     processor.
00053 
00054 Arguments:
00055 
00056     BroadcastFunction - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of function that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executed
00057         on each of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target processors.
00058 
00059     Context - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context parameter that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> passed
00060         to each function.
00061 
00062 Return Value:
00063 
00064     The value returned by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified function on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source processor
00065     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value.
00066 
00067 --*/
00068 
00069 {
00070 
00071     KIRQL OldIrql;
00072     ULONG_PTR <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00073     KAFFINITY TargetProcessors;
00074 
00075     <span class="comment">//</span>
00076     <span class="comment">// Raise IRQL to the higher of the current level and synchronization</span>
00077     <span class="comment">// level to avoid a possible context switch.</span>
00078     <span class="comment">//</span>
00079 
00080     <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>((KIRQL)(<a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(KiSynchIrql, KeGetCurrentIrql())), &amp;OldIrql);
00081 
00082     <span class="comment">//</span>
00083     <span class="comment">// Initialize the broadcast packet, compute the set of target processors,</span>
00084     <span class="comment">// and sent the packet to the target processors for execution.</span>
00085     <span class="comment">//</span>
00086 
00087 <span class="preprocessor">#if !defined(NT_UP)</span>
00088 <span class="preprocessor"></span>
00089     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; ~<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;SetMember;
00090     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00091         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00092                         KiIpiGenericCallTarget,
00093                         (PVOID)BroadcastFunction,
00094                         (PVOID)Context,
00095                         NULL);
00096     }
00097 
00098 <span class="preprocessor">#endif</span>
00099 <span class="preprocessor"></span>
00100     <span class="comment">//</span>
00101     <span class="comment">// Execute function of source processor and capture return status.</span>
00102     <span class="comment">//</span>
00103 
00104     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = BroadcastFunction(Context);
00105 
00106     <span class="comment">//</span>
00107     <span class="comment">// Wait until all of the target processors have finished capturing the</span>
00108     <span class="comment">// function parameters.</span>
00109     <span class="comment">//</span>
00110 
00111 <span class="preprocessor">#if !defined(NT_UP)</span>
00112 <span class="preprocessor"></span>
00113     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00114         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00115     }
00116 
00117 <span class="preprocessor">#endif</span>
00118 <span class="preprocessor"></span>
00119     <span class="comment">//</span>
00120     <span class="comment">// Lower IRQL to its previous level and return the function execution</span>
00121     <span class="comment">// status.</span>
00122     <span class="comment">//</span>
00123 
00124     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00125     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00126 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a90" doxytag="ki.h::KiIpiSend" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL KiIpiSend           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KAFFINITY&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d0/ki_8h.html#a32">KIPI_REQUEST</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Request</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00253">253</a> of file <a class="el" href="../../d0/d3/mpipi_8c-source.html">mpipi.c</a>.
<p>
References <a class="el" href="../../d2/d7/hal_8h.html#a198">HalRequestIpi()</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>, <a class="el" href="../../d5/d0/dpcobj_8c-source.html#l00089">KeInsertQueueDpc()</a>, and <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>.
<p>
<pre class="fragment"><div>00260                    :
00261 
00262     This routine requests <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified operation on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target set of
00263     processors.
00264 
00265 Arguments:
00266 
00267     TargetProcessors (a0) - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> set of processors on which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00268         specified operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be executed.
00269 
00270     IpiRequest (a1) - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request operation mask.
00271 
00272 Return Value:
00273 
00274     None.
00275 
00276 --*/
00277 
00278 {
00279 <span class="preprocessor">#if !defined(NT_UP)</span>
00280 <span class="preprocessor"></span>    ULONG RequestSummary;
00281     KAFFINITY NextProcessors;
00282     ULONG Next;
00283 
00284     <span class="comment">//</span>
00285     <span class="comment">// Loop through the target processors and send the packet to the specified</span>
00286     <span class="comment">// recipients.</span>
00287     <span class="comment">//</span>
00288 
00289     NextProcessors = TargetProcessors;
00290     Next = 0;
00291 
00292     <span class="keywordflow">while</span> (NextProcessors != 0) {
00293 
00294         <span class="keywordflow">if</span> ((NextProcessors &amp; 1) != 0) {
00295 
00296             <span class="keywordflow">do</span> {
00297             
00298                 RequestSummary = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[Next]-&gt;RequestSummary;
00299 
00300             } <span class="keywordflow">while</span>(InterlockedCompareExchange(
00301                 (PLONG) &amp;KiProcessorBlock[Next]-&gt;RequestSummary, 
00302                 (LONG) (RequestSummary | IpiRequest),
00303                 (LONG) RequestSummary) != (LONG) RequestSummary);  
00304         }
00305 
00306         NextProcessors = NextProcessors &gt;&gt; 1;
00307         
00308         Next = Next + 1;
00309 
00310     }
00311     <a class="code" href="../../d2/d7/hal_8h.html#a198">HalRequestIpi</a> (TargetProcessors);
00312 <span class="preprocessor">#endif</span>
00313 <span class="preprocessor"></span>
00314     <span class="keywordflow">return</span>;
00315 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a91" doxytag="ki.h::KiIpiSendPacket" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiIpiSendPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KAFFINITY&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a55">PKIPI_WORKER</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>WorkerFunction</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">319</a> of file <a class="el" href="../../d0/d3/mpipi_8c-source.html">mpipi.c</a>.
<p>
References <a class="el" href="../../d2/d7/hal_8h.html#a198">HalRequestIpi()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00318">Ke386IoSetAccessProcess()</a>, <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00080">Ke386SetIoAccessMap()</a>, <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00063">Ke386SetLdtProcess()</a>, <a class="el" href="../../d9/d3/vdmint21_8c-source.html#l00064">Ke386SetVdmInterruptHandler()</a>, <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00074">KeChangeColorPage()</a>, <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00543">KeDetachSessionSpace()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00086">KeFlushEntireTb()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00374">KeFlushIoBuffers()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00231">KeFlushMultipleTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00587">KeFlushMultipleTb64()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00420">KeFlushSingleTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00797">KeFlushSingleTb64()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00289">KeStartProfile()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00520">KeStopProfile()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00453">KeSweepCacheRange()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00071">KeSweepDcache()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00674">KeSweepDcacheRange()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00202">KeSweepIcache()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00559">KeSweepIcacheRange()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00561">KeSynchronizeMemoryAccess()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00733">KiGetNewRid()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00040">KiIpiGenericCall()</a>, and <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00122">KiSyncNewRegionId()</a>.
<p>
<pre class="fragment"><div>00329                    :
00330 
00331     This routine executes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified worker function on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00332     set of processors.
00333 
00334 Arguments:
00335 
00336     TargetProcessors (a0) - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> set of processors on which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00337         specified operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be executed.
00338 
00339     WorkerFunction (a1) - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> worker function.
00340 
00341     Parameter1 - Parameter3 (a2, a3, 4 * 4(sp)) - Supplies worker
00342         function specific parameters.
00343 
00344 Return Value:
00345 
00346     None.
00347 
00348 --*/
00349 {
00350 <span class="preprocessor">#if !defined(NT_UP)</span>
00351 <span class="preprocessor"></span>    PKPRCB Prcb;
00352     KAFFINITY NextProcessors;
00353     ULONG Next;
00354 
00355     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00356     Prcb-&gt;TargetSet = TargetProcessors;
00357     Prcb-&gt;WorkerRoutine = WorkerFunction;
00358     Prcb-&gt;CurrentPacket[0] = Parameter1;
00359     Prcb-&gt;CurrentPacket[1] = Parameter2;
00360     Prcb-&gt;CurrentPacket[2] = Parameter3;
00361 
00362     <span class="comment">//</span>
00363     <span class="comment">// synchronize memory access</span>
00364     <span class="comment">// </span>
00365 
00366     __mf();
00367     
00368     <span class="comment">//</span>
00369     <span class="comment">// Loop through the target processors and send the packet to the specified</span>
00370     <span class="comment">// recipients.</span>
00371     <span class="comment">//</span>
00372 
00373     NextProcessors = TargetProcessors;
00374     Next = 0;
00375 
00376     <span class="keywordflow">while</span> (NextProcessors != 0) {
00377 
00378         <span class="keywordflow">if</span> ((NextProcessors &amp; 1) != 0) {
00379             
00380             <span class="keywordflow">while</span>(InterlockedCompareExchangePointer(
00381                 (PVOID)&amp;KiProcessorBlock[Next]-&gt;SignalDone, 
00382                 (PVOID)Prcb,
00383                 (PVOID)0) != (PVOID)0);
00384 
00385         }
00386             
00387         NextProcessors = NextProcessors &gt;&gt; 1;
00388         
00389         Next = Next + 1;
00390 
00391     }
00392     <a class="code" href="../../d2/d7/hal_8h.html#a198">HalRequestIpi</a> (TargetProcessors);
00393 <span class="preprocessor">#endif    </span>
00394 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a92" doxytag="ki.h::KiIpiServiceRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiIpiServiceRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN struct _KTRAP_FRAME *&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN struct _KEXCEPTION_FRAME *&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a93" doxytag="ki.h::KiIpiSignalPacketDone" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL KiIpiSignalPacketDone           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SignalDone</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d9/d3/vdmint21_8c-source.html#l00194">Ki386LoadTargetInt21Entry()</a>, <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00221">Ki386LoadTargetLdtr()</a>, <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00164">KiChangeColorPageTarget()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00188">KiFlushEntireTbTarget()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00508">KiFlushIoBuffersTarget()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00353">KiFlushMultipleTbTarget()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00733">KiFlushMultipleTbTarget64()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00535">KiFlushSingleTbTarget()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00932">KiFlushSingleTbTarget64()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00202">KiFlushTargetEntireTb()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00368">KiFlushTargetMultipleTb()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00546">KiFlushTargetSingleTb()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00132">KiIpiGenericCallTarget()</a>, <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00413">KiLoadIopmOffset()</a>, <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00188">KiSetIoMap()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00772">KiStartProfileInterrupt()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00724">KiStopProfileInterrupt()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00156">KiSweepDcacheTarget()</a>, <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00588">KiSweepIcacheRangeTarget()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00287">KiSweepIcacheTarget()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00103">KiSyncCacheTarget()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00651">KiSynchronizeMemoryAccessTarget()</a>, <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00041">KiSyncNewRegionIdTarget()</a>, and <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00468">KiSyncSessionTarget()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a94" doxytag="ki.h::KiIpiStallOnPacketTargets" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiIpiStallOnPacketTargets           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">KAFFINITY&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TargetSet</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">182</a> of file <a class="el" href="../../d3/d0/xipi_8c-source.html">xipi.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, and <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00318">Ke386IoSetAccessProcess()</a>, <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00255">Ke386SetDescriptorProcess()</a>, <a class="el" href="../../d2/d5/i386_2iopm_8c-source.html#l00080">Ke386SetIoAccessMap()</a>, <a class="el" href="../../d5/d2/i386_2ldtsup_8c-source.html#l00063">Ke386SetLdtProcess()</a>, <a class="el" href="../../d9/d3/vdmint21_8c-source.html#l00064">Ke386SetVdmInterruptHandler()</a>, <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00074">KeChangeColorPage()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00086">KeFlushEntireTb()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00374">KeFlushIoBuffers()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00231">KeFlushMultipleTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00587">KeFlushMultipleTb64()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00420">KeFlushSingleTb()</a>, <a class="el" href="../../d8/d4/alpha_2flushtb_8c-source.html#l00797">KeFlushSingleTb64()</a>, <a class="el" href="../../d1/d4/i386_2flush_8c-source.html#l00187">KeInvalidateAllCaches()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00289">KeStartProfile()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00520">KeStopProfile()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00453">KeSweepCacheRange()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00071">KeSweepDcache()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00674">KeSweepDcacheRange()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00202">KeSweepIcache()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00559">KeSweepIcacheRange()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00561">KeSynchronizeMemoryAccess()</a>, <a class="el" href="../../d9/d3/mtrr_8c-source.html#l01112">KiCompleteEffectiveRangeChange()</a>, <a class="el" href="../../d9/d4/i386_2flushtb_8c-source.html#l00589">KiFlushSingleTbSynchronous()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00733">KiGetNewRid()</a>, <a class="el" href="../../d0/d3/pat_8c-source.html#l00119">KiInitializePAT()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00040">KiIpiGenericCall()</a>, and <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00122">KiSyncNewRegionId()</a>.
<p>
<pre class="fragment"><div>00188                    :
00189 
00190     This function waits until <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified set of processors have signaled
00191     their completion of a requested function.
00192 
00193     N.B. The exact protocol used between <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target of an
00194          interprocessor request <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified. Minimally <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source
00195          must construct an appropriate packet and send <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> packet to a set
00196          of specified targets. Each target receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> packet
00197          address as an argument, and minimally must clear <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> packet address
00198          when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mutually agreed upon protocol allows. The target has three
00199          options:
00200 
00201          1. Capture necessary information, release <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source by clearing
00202             <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> packet address, execute <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request in parallel with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00203             source, and <span class="keywordflow">return</span> from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> interrupt.
00204 
00205          2. Execute <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request in series with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source, release <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00206             source by clearing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> packet address, and <span class="keywordflow">return</span> from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00207             interrupt.
00208 
00209          3. Execute <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request in series with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source, release <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00210             source, wait <span class="keywordflow">for</span> a reply from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source based on a packet
00211             parameter, and <span class="keywordflow">return</span> from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> interrupt.
00212 
00213     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> provided to enable <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source to synchronize with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00214     target <span class="keywordflow">for</span> cases 2 and 3 above.
00215 
00216     N.B. There <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no support <span class="keywordflow">for</span> method 3 above.
00217 
00218 Arguments:
00219 
00220     TargetSet - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target set of IPI processors.
00221 
00222 Return Value:
00223 
00224     None.
00225 
00226 --*/
00227 
00228 {
00229 
00230     PKPRCB Prcb;
00231 
00232     <span class="comment">//</span>
00233     <span class="comment">// Wait until the target set of processors is zero in the current</span>
00234     <span class="comment">// processor's packet.</span>
00235     <span class="comment">//</span>
00236 
00237     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00238     <span class="keywordflow">while</span> (Prcb-&gt;TargetSet != 0) {
00239         KeYieldProcessor();
00240     }
00241 
00242     <span class="comment">//</span>
00243     <span class="comment">// If the target set is equal to the entire set of processors, then</span>
00244     <span class="comment">// update the memory barrier time stamp.</span>
00245     <span class="comment">//</span>
00246 
00247 <span class="preprocessor">#if defined(_ALPHA_)</span>
00248 <span class="preprocessor"></span>
00249     <span class="keywordflow">if</span> ((TargetSet | PCR-&gt;SetMember ) == <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a>) {
00250         InterlockedIncrement(&amp;KiMbTimeStamp);
00251     }
00252 
00253 <span class="preprocessor">#endif</span>
00254 <span class="preprocessor"></span>
00255     <span class="keywordflow">return</span>;
00256 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a128" doxytag="ki.h::KiLockDeviceQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KIRQL KiLockDeviceQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DeviceQueue</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a129" doxytag="ki.h::KiPassiveRelease" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiPassiveRelease           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a150" doxytag="ki.h::KiPollFreezeExecution" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiPollFreezeExecution           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00538">538</a> of file <a class="el" href="../../d0/d4/ke_2debug_8c-source.html">ke/debug.c</a>.
<p>
References <a class="el" href="../../d1/d9/ki_8h-source.html#l00281">IPI_FREEZE</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00220">KiFreezeTargetExecution()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00592">KiCalibrateTimeAdjustment()</a>.
<p>
<pre class="fragment"><div>00544                    :
00545 
00546     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called from code that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> spinning with interrupts
00547     disabled, waiting <span class="keywordflow">for</span> something to happen, when there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> some
00548     (possibly extremely small) chance that that thing will not happen
00549     because a system freeze has been initiated.
00550 
00551     N.B. Interrupts are disabled.
00552 
00553 Arguments:
00554 
00555     None.
00556 
00557 Return Value:
00558 
00559     None.
00560 
00561 --*/
00562 
00563 {
00564     <span class="comment">//</span>
00565     <span class="comment">// Check to see if a freeze is pending for this processor.</span>
00566     <span class="comment">//</span>
00567 
00568     PKPRCB Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00569 
00570     <span class="keywordflow">if</span> ((Prcb-&gt;RequestSummary &amp; <a class="code" href="../../d0/d0/ki_8h.html#a18">IPI_FREEZE</a>) != 0) {
00571 
00572         <span class="comment">//</span>
00573         <span class="comment">// Clear the freeze request and freeze this processor.</span>
00574         <span class="comment">//</span>
00575 
00576         InterlockedExchangeAdd((PLONG)&amp;Prcb-&gt;RequestSummary, -(IPI_FREEZE));
00577         <a class="code" href="../../d0/d0/ki_8h.html#a149">KiFreezeTargetExecution</a>(NULL, NULL);
00578 
00579     } <span class="keywordflow">else</span> {
00580 
00581         <span class="comment">//</span>
00582         <span class="comment">// No freeze pending, assume this processor is spinning.</span>
00583         <span class="comment">//</span>
00584 
00585         KeYieldProcessor();
00586     }
00587 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a130" doxytag="ki.h::KiRaiseException" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS KiRaiseException           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>FirstChance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/raisexcp_8c-source.html#l00208">208</a> of file <a class="el" href="../../d6/d3/raisexcp_8c-source.html">raisexcp.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00230">KeContextToKframes()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00373">KiDispatchException()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, and <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>.
<p>
<pre class="fragment"><div>00218                    :
00219 
00220     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to raise an exception. The exception can be
00221     raised as a first or second chance exception.
00222 
00223 Arguments:
00224 
00225     ExceptionRecord - Supplies a pointer to an exception record.
00226 
00227     ContextRecord - Supplies a pointer to a context record.
00228 
00229     ExceptionFrame - Supplies a pointer to an exception frame.
00230 
00231     TrapFrame - Supplies a pointer to a trap frame.
00232 
00233     FirstChance - Supplies a <span class="keywordtype">boolean</span> value that specifies whether <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00234         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first (TRUE) or second (FALSE) chance for the exception.
00235 
00236 Return Value:
00237 
00238     STATUS_ACCESS_VIOLATION is returned if either the exception or the context
00239         record is not readable from user mode.
00240 
00241     STATUS_DATATYPE_MISALIGNMENT is returned if the exception record or the
00242         context record are not properly aligned.
00243 
00244     STATUS_INVALID_PARAMETER is returned if the number of exception parameters
00245         is greater than the maximum allowable number of exception parameters.
00246 
00247     STATUS_SUCCESS is returned if the exception is dispatched and handled.
00248 
00249 --*/
00250 
00251 {
00252 
00253     CONTEXT ContextRecord2;
00254     EXCEPTION_RECORD ExceptionRecord2;
00255     ULONG Length;
00256     ULONG Params;
00257     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00258 
00259     <span class="comment">//</span>
00260     <span class="comment">// Establish an exception handler and probe the specified exception and</span>
00261     <span class="comment">// context records for read accessibility. If the probe fails, then</span>
00262     <span class="comment">// return the exception code as the service status. Else call the exception</span>
00263     <span class="comment">// dispatcher to dispatch the exception.</span>
00264     <span class="comment">//</span>
00265 
00266     <span class="keywordflow">try</span> {
00267 
00268         <span class="comment">//</span>
00269         <span class="comment">// Get the previous processor mode. If the previous processor mode</span>
00270         <span class="comment">// is user, then probe and copy the specified exception and context</span>
00271         <span class="comment">// records.</span>
00272         <span class="comment">//</span>
00273 
00274         PreviousMode = KeGetPreviousMode();
00275         <span class="keywordflow">if</span> (PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00276             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(ContextRecord, <span class="keyword">sizeof</span>(CONTEXT), CONTEXT_ALIGN);
00277             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(ExceptionRecord,
00278                          FIELD_OFFSET (EXCEPTION_RECORD, NumberParameters) +
00279                          <span class="keyword">sizeof</span> (ExceptionRecord-&gt;NumberParameters), <span class="keyword">sizeof</span>(ULONG));
00280             Params = ExceptionRecord-&gt;NumberParameters;
00281             <span class="keywordflow">if</span> (Params &gt; EXCEPTION_MAXIMUM_PARAMETERS) {
00282                 <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00283             }
00284 
00285             <span class="comment">//</span>
00286             <span class="comment">// The exception record structure is defined unlike others with trailing</span>
00287             <span class="comment">// information as being its maximum size rather than just a single trailing</span>
00288             <span class="comment">// element.</span>
00289             <span class="comment">//</span>
00290             Length = (<span class="keyword">sizeof</span>(EXCEPTION_RECORD) -
00291                      ((EXCEPTION_MAXIMUM_PARAMETERS - Params) *
00292                      <span class="keyword">sizeof</span>(ExceptionRecord-&gt;ExceptionInformation[0])));
00293 
00294             <span class="comment">//</span>
00295             <span class="comment">// The structure is currently less that 64k so we don't really need this probe.</span>
00296             <span class="comment">//</span>
00297             <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(ExceptionRecord, Length, <span class="keyword">sizeof</span>(ULONG));
00298 
00299             <span class="comment">//</span>
00300             <span class="comment">// Copy the exception and context record to local storage so an</span>
00301             <span class="comment">// access violation cannot occur during exception dispatching.</span>
00302             <span class="comment">//</span>
00303 
00304             RtlMoveMemory(&amp;ContextRecord2, ContextRecord, <span class="keyword">sizeof</span>(CONTEXT));
00305             RtlMoveMemory(&amp;ExceptionRecord2, ExceptionRecord, Length);
00306             ContextRecord = &amp;ContextRecord2;
00307             ExceptionRecord = &amp;ExceptionRecord2;
00308             <span class="comment">//</span>
00309             <span class="comment">// The number of parameters might have changed after we validated but before we</span>
00310             <span class="comment">// copied the structure. Fix this up as lower levels might not like this.</span>
00311             <span class="comment">//</span>
00312             ExceptionRecord-&gt;NumberParameters = Params;            
00313         }
00314 
00315     <span class="comment">//</span>
00316     <span class="comment">// If an exception occurs during the probe of the exception or context</span>
00317     <span class="comment">// record, then always handle the exception and return the exception code</span>
00318     <span class="comment">// as the status value.</span>
00319     <span class="comment">//</span>
00320 
00321     } except(EXCEPTION_EXECUTE_HANDLER) {
00322         <span class="keywordflow">return</span> GetExceptionCode();
00323     }
00324 
00325     <span class="comment">//</span>
00326     <span class="comment">// Move information from the context record to the exception and</span>
00327     <span class="comment">// trap frames.</span>
00328     <span class="comment">//</span>
00329 
00330     <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a10">KeContextToKframes</a>(TrapFrame,
00331                        ExceptionFrame,
00332                        ContextRecord,
00333                        ContextRecord-&gt;ContextFlags,
00334                        PreviousMode);
00335 
00336     <span class="comment">//</span>
00337     <span class="comment">// Make sure the reserved bit is clear in the exception code and</span>
00338     <span class="comment">// perform exception dispatching.</span>
00339     <span class="comment">//</span>
00340     <span class="comment">// N.B. The reserved bit is used to differentiate internally gerarated</span>
00341     <span class="comment">//      codes from codes generated by application programs.</span>
00342     <span class="comment">//</span>
00343 
00344     ExceptionRecord-&gt;ExceptionCode &amp;= 0xefffffff;
00345     <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a11">KiDispatchException</a>(ExceptionRecord,
00346                         ExceptionFrame,
00347                         TrapFrame,
00348                         PreviousMode,
00349                         FirstChance);
00350 
00351     <span class="keywordflow">return</span> STATUS_SUCCESS;
00352 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a131" doxytag="ki.h::KiReadyThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL KiReadyThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">270</a> of file <a class="el" href="../../d1/d1/thredsup_8c-source.html">thredsup.c</a>.
<p>
References <a class="el" href="../../d1/d9/ki_8h-source.html#l00036">BALANCE_INCREMENT</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00058">ClearMember</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00034">FASTCALL</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00068">FindFirstSetLeftMember</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00413">_KEVENT::Header</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00280">IPI_DPC</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00036">KiDispatcherReadyListHead</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00044">KiIdleSummary</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00044">KiIncrementSwitchCounter</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00253">KiIpiSend()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00428">KiProcessInSwapListHead</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00052">KiReadySummary</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00782">KiRequestDispatchInterrupt</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00444">KiStackInSwapListHead</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00421">KiSwapEvent</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d1/po_8h-source.html#l00459">PoSleepingSummary</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00623">_KTHREAD::Preempted</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00574">_KTHREAD::Priority</a>, <a class="el" href="../../d4/d9/ke_8h.html#a405a186">ProcessInMemory</a>, <a class="el" href="../../d4/d9/ke_8h.html#a405a188">ProcessInTransition</a>, <a class="el" href="../../d4/d9/ke_8h.html#a405a187">ProcessOutOfMemory</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a192">Ready</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00762">_KPROCESS::ReadyListHead</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00065">SetMember</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00262">_DISPATCHER_HEADER::SignalState</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00767">_KPROCESS::StackCount</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00771">_KPROCESS::State</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00763">_KPROCESS::SwapListEntry</a>, <a class="el" href="../../d4/d9/ke_8h.html#a406a197">Transition</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00263">_DISPATCHER_HEADER::WaitListHead</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/wait_8c-source.html#l00140">KeDelayExecutionThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01025">KeReadyThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01302">KeSetAffinityThread()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00955">KiAttachProcess()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00710">KiInsertQueue()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00431">KiInSwapKernelStacks()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00483">KiInSwapProcesses()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00644">KiOutSwapProcesses()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00732">KiScanReadyQueues()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00576">KiSetPriorityThread()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00031">KiUnwaitThread()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00525">NtReplyWaitSendChannel()</a>, and <a class="el" href="../../d5/d5/channel_8c-source.html#l00807">NtSendWaitReplyChannel()</a>.
<p>
<pre class="fragment"><div>00276                    :
00277 
00278     This function readies a thread <span class="keywordflow">for</span> execution and attempts to immediately
00279     dispatch <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <span class="keywordflow">for</span> execution by preempting another lower priority
00280     thread. If a thread can be preempted, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread enters
00281     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> standby state and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target processor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> requested to dispatch. If
00282     another thread cannot be preempted, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> inserted
00283     either at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> head or tail of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dispatcher ready selected by its priority
00284     acccording to whether <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> was preempted or not.
00285 
00286 Arguments:
00287 
00288     Thread - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00289 
00290 Return Value:
00291 
00292     None.
00293 
00294 --*/
00295 
00296 {
00297 
00298     PRKPRCB Prcb;
00299     BOOLEAN Preempted;
00300     KPRIORITY Priority;
00301     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PRKPROCESS</a> Process;
00302     ULONG Processor;
00303     KPRIORITY ThreadPriority;
00304     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread1;
00305     KAFFINITY IdleSet;
00306 
00307     <span class="comment">//</span>
00308     <span class="comment">// Save value of thread's preempted flag, set thread preempted FALSE,</span>
00309     <span class="comment">// capture the thread priority, and set clear the read wait time.</span>
00310     <span class="comment">//</span>
00311 
00312     Preempted = Thread-&gt;Preempted;
00313     Thread-&gt;Preempted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00314     ThreadPriority = Thread-&gt;Priority;
00315     Thread-&gt;WaitTime = KiQueryLowTickCount();
00316 
00317     <span class="comment">//</span>
00318     <span class="comment">// If the thread's process is not in memory, then insert the thread in</span>
00319     <span class="comment">// the process ready queue and inswap the process.</span>
00320     <span class="comment">//</span>
00321 
00322     Process = Thread-&gt;ApcState.Process;
00323     <span class="keywordflow">if</span> (Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o15">State</a> != <a class="code" href="../../d4/d9/ke_8h.html#a405a186">ProcessInMemory</a>) {
00324         Thread-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o15">State</a> = <a class="code" href="../../d4/d9/ke_8h.html#a406a192">Ready</a>;
00325         Thread-&gt;ProcessReadyQueue = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00326         InsertTailList(&amp;Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o6">ReadyListHead</a>, &amp;Thread-&gt;WaitListEntry);
00327         <span class="keywordflow">if</span> (Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o15">State</a> == <a class="code" href="../../d4/d9/ke_8h.html#a405a187">ProcessOutOfMemory</a>) {
00328             Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o15">State</a> = <a class="code" href="../../d4/d9/ke_8h.html#a405a188">ProcessInTransition</a>;
00329             InsertTailList(&amp;KiProcessInSwapListHead, &amp;Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o7">SwapListEntry</a>);
00330             <a class="code" href="../../d5/d9/kernldat_8c.html#a47">KiSwapEvent</a>.<a class="code" href="../../d2/d6/struct__KEVENT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o4">SignalState</a> = 1;
00331             <span class="keywordflow">if</span> (IsListEmpty(&amp;<a class="code" href="../../d5/d9/kernldat_8c.html#a47">KiSwapEvent</a>.<a class="code" href="../../d2/d6/struct__KEVENT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o5">WaitListHead</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00332                 <a class="code" href="../../d2/d7/waitsup_8c.html#a3">KiWaitTest</a>(&amp;KiSwapEvent, BALANCE_INCREMENT);
00333             }
00334         }
00335 
00336         <span class="keywordflow">return</span>;
00337 
00338     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Thread-&gt;KernelStackResident == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00339 
00340         <span class="comment">//</span>
00341         <span class="comment">// The thread's kernel stack is not resident. Increment the process</span>
00342         <span class="comment">// stack count, set the state of the thread to transition, insert</span>
00343         <span class="comment">// the thread in the kernel stack inswap list, and set the kernel</span>
00344         <span class="comment">// stack inswap event.</span>
00345         <span class="comment">//</span>
00346 
00347         Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o11">StackCount</a> += 1;
00348         Thread-&gt;State = <a class="code" href="../../d4/d9/ke_8h.html#a406a197">Transition</a>;
00349         InsertTailList(&amp;KiStackInSwapListHead, &amp;Thread-&gt;WaitListEntry);
00350         <a class="code" href="../../d5/d9/kernldat_8c.html#a47">KiSwapEvent</a>.<a class="code" href="../../d2/d6/struct__KEVENT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o4">SignalState</a> = 1;
00351         <span class="keywordflow">if</span> (IsListEmpty(&amp;<a class="code" href="../../d5/d9/kernldat_8c.html#a47">KiSwapEvent</a>.<a class="code" href="../../d2/d6/struct__KEVENT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o5">WaitListHead</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00352             <a class="code" href="../../d2/d7/waitsup_8c.html#a3">KiWaitTest</a>(&amp;KiSwapEvent, BALANCE_INCREMENT);
00353         }
00354 
00355         <span class="keywordflow">return</span>;
00356 
00357     } <span class="keywordflow">else</span> {
00358 
00359         <span class="comment">//</span>
00360         <span class="comment">// If there is an idle processor, then schedule the thread on an</span>
00361         <span class="comment">// idle processor giving preference to the processor the thread</span>
00362         <span class="comment">// last ran on. Otherwise, try to preempt either a thread in the</span>
00363         <span class="comment">// standby or running state.</span>
00364         <span class="comment">//</span>
00365 
00366 <span class="preprocessor">#if defined(NT_UP)</span>
00367 <span class="preprocessor"></span>
00368         Prcb = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[0];
00369         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/kernldat_8c.html#a1">KiIdleSummary</a> != 0) {
00370             <a class="code" href="../../d5/d9/kernldat_8c.html#a1">KiIdleSummary</a> = 0;
00371             <a class="code" href="../../d0/d2/thredsup_8c.html#a0">KiIncrementSwitchCounter</a>(IdleLast);
00372             Prcb-&gt;NextThread = Thread;
00373             Thread-&gt;State = <a class="code" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>;
00374 
00375 <span class="preprocessor">#else</span>
00376 <span class="preprocessor"></span>
00377         IdleSet = <a class="code" href="../../d5/d9/kernldat_8c.html#a1">KiIdleSummary</a> &amp; Thread-&gt;Affinity;
00378         <span class="keywordflow">if</span> (IdleSet != 0) {
00379             Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00380             Processor = Thread-&gt;IdealProcessor;
00381             <span class="keywordflow">if</span> ((IdleSet &amp; (1 &lt;&lt; Processor)) == 0) {
00382                 Processor = Thread-&gt;NextProcessor;
00383                 <span class="keywordflow">if</span> ((IdleSet &amp; (1 &lt;&lt; Processor)) == 0) {
00384                     <span class="keywordflow">if</span> ((IdleSet &amp; Prcb-&gt;SetMember) == 0) {
00385                         <a class="code" href="../../d0/d0/ki_8h.html#a8">FindFirstSetLeftMember</a>(IdleSet, &amp;Processor);
00386                         <a class="code" href="../../d0/d2/thredsup_8c.html#a0">KiIncrementSwitchCounter</a>(IdleAny);
00387 
00388                     } <span class="keywordflow">else</span> {
00389                         Processor = Prcb-&gt;Number;
00390                         <a class="code" href="../../d0/d2/thredsup_8c.html#a0">KiIncrementSwitchCounter</a>(IdleCurrent);
00391                     }
00392 
00393                 } <span class="keywordflow">else</span> {
00394                     <a class="code" href="../../d0/d2/thredsup_8c.html#a0">KiIncrementSwitchCounter</a>(IdleLast);
00395                 }
00396 
00397             } <span class="keywordflow">else</span> {
00398                 <a class="code" href="../../d0/d2/thredsup_8c.html#a0">KiIncrementSwitchCounter</a>(IdleIdeal);
00399             }
00400 
00401             Thread-&gt;NextProcessor = (CCHAR)Processor;
00402             <a class="code" href="../../d0/d0/ki_8h.html#a6">ClearMember</a>(Processor, KiIdleSummary);
00403             <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[Processor]-&gt;NextThread = Thread;
00404             Thread-&gt;State = <a class="code" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>;
00405 
00406             <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d2/po_8h.html#a50">PoSleepingSummary</a> &amp; (1 &lt;&lt; Processor)) &amp;&amp;
00407                  Processor != (ULONG) Prcb-&gt;Number) {
00408                 <a class="code" href="../../d0/d0/ki_8h.html#a90">KiIpiSend</a>(1 &lt;&lt; Processor, IPI_DPC);
00409             }
00410 <span class="preprocessor">#endif</span>
00411 <span class="preprocessor"></span>
00412             <span class="keywordflow">return</span>;
00413 
00414         } <span class="keywordflow">else</span> {
00415 
00416 <span class="preprocessor">#if !defined(NT_UP)</span>
00417 <span class="preprocessor"></span>
00418             Processor = Thread-&gt;IdealProcessor;
00419             <span class="keywordflow">if</span> ((Thread-&gt;Affinity &amp; (1 &lt;&lt; Processor)) == 0) {
00420                 Processor = Thread-&gt;NextProcessor;
00421                 <span class="keywordflow">if</span> ((Thread-&gt;Affinity &amp; (1 &lt;&lt; Processor)) == 0) {
00422                     <a class="code" href="../../d0/d0/ki_8h.html#a8">FindFirstSetLeftMember</a>(Thread-&gt;Affinity, &amp;Processor);
00423                 }
00424             }
00425 
00426             Thread-&gt;NextProcessor = (CCHAR)Processor;
00427             Prcb = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[Processor];
00428 
00429 <span class="preprocessor">#endif</span>
00430 <span class="preprocessor"></span>
00431             <span class="keywordflow">if</span> (Prcb-&gt;NextThread != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00432                 Thread1 = Prcb-&gt;NextThread;
00433                 <span class="keywordflow">if</span> (ThreadPriority &gt; Thread1-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o13">Priority</a>) {
00434                     Thread1-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o42">Preempted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00435                     Prcb-&gt;NextThread = Thread;
00436                     Thread-&gt;State = <a class="code" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>;
00437                     <a class="code" href="../../d0/d2/thredsup_8c.html#a3">KiReadyThread</a>(Thread1);
00438                     <a class="code" href="../../d0/d2/thredsup_8c.html#a0">KiIncrementSwitchCounter</a>(PreemptLast);
00439                     <span class="keywordflow">return</span>;
00440                 }
00441 
00442             } <span class="keywordflow">else</span> {
00443                 Thread1 = Prcb-&gt;CurrentThread;
00444                 <span class="keywordflow">if</span> (ThreadPriority &gt; Thread1-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o13">Priority</a>) {
00445                     Thread1-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o42">Preempted</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00446                     Prcb-&gt;NextThread = Thread;
00447                     Thread-&gt;State = <a class="code" href="../../d4/d9/ke_8h.html#a406a194">Standby</a>;
00448                     <a class="code" href="../../d0/d0/ki_8h.html#a24">KiRequestDispatchInterrupt</a>(Thread-&gt;NextProcessor);
00449                     <a class="code" href="../../d0/d2/thredsup_8c.html#a0">KiIncrementSwitchCounter</a>(PreemptLast);
00450                     <span class="keywordflow">return</span>;
00451                 }
00452             }
00453         }
00454     }
00455 
00456     <span class="comment">//</span>
00457     <span class="comment">// No thread can be preempted. Insert the thread in the dispatcher</span>
00458     <span class="comment">// queue selected by its priority. If the thread was preempted and</span>
00459     <span class="comment">// runs at a realtime priority level, then insert the thread at the</span>
00460     <span class="comment">// front of the queue. Else insert the thread at the tail of the queue.</span>
00461     <span class="comment">//</span>
00462 
00463     Thread-&gt;State = <a class="code" href="../../d4/d9/ke_8h.html#a406a192">Ready</a>;
00464     <span class="keywordflow">if</span> (Preempted != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00465         InsertHeadList(&amp;KiDispatcherReadyListHead[ThreadPriority],
00466                        &amp;Thread-&gt;WaitListEntry);
00467 
00468     } <span class="keywordflow">else</span> {
00469         InsertTailList(&amp;KiDispatcherReadyListHead[ThreadPriority],
00470                        &amp;Thread-&gt;WaitListEntry);
00471     }
00472 
00473     <a class="code" href="../../d0/d0/ki_8h.html#a7">SetMember</a>(ThreadPriority, KiReadySummary);
00474     <span class="keywordflow">return</span>;
00475 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a132" doxytag="ki.h::KiReinsertTreeTimer" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL FASTCALL KiReinsertTreeTimer           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d8/struct__KTIMER.html">PRKTIMER</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Timer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>DueTime</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/timersup_8c-source.html#l00121">121</a> of file <a class="el" href="../../d6/d1/timersup_8c-source.html">timersup.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d1/timersup_8c-source.html#l00185">KiInsertTimerTable()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00335">KeSetSystemTime()</a>.
<p>
<pre class="fragment"><div>00128                    :
00129 
00130     This function reinserts a timer object in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> timer queue.
00131 
00132     N.B. This routine assumes that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dispatcher data lock has been acquired.
00133 
00134 Arguments:
00135 
00136     Timer - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> timer.
00137 
00138     DueTime - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> absolute time <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> timer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to expire.
00139 
00140 Return Value:
00141 
00142     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> timer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> inserted in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> timer tree, than a value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00143     returned. Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00144 
00145 --*/
00146 
00147 {
00148 
00149     LARGE_INTEGER CurrentTime;
00150     LARGE_INTEGER Interval;
00151 
00152     <span class="comment">//</span>
00153     <span class="comment">// Clear the signal state of timer if the timer period is zero and set</span>
00154     <span class="comment">// the inserted state to TRUE.</span>
00155     <span class="comment">//</span>
00156 
00157     Timer-&gt;Header.Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00158     <span class="keywordflow">if</span> (Timer-&gt;Period == 0) {
00159         Timer-&gt;Header.SignalState = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00160     }
00161 
00162     <span class="comment">//</span>
00163     <span class="comment">// Compute the interval between the current time and the due time.</span>
00164     <span class="comment">// If the resultant relative time is greater than or equal to zero,</span>
00165     <span class="comment">// then the timer has already expired.</span>
00166     <span class="comment">//</span>
00167 
00168     KiQueryInterruptTime(&amp;CurrentTime);
00169     Interval.QuadPart = CurrentTime.QuadPart - DueTime.QuadPart;
00170     <span class="keywordflow">if</span> (Interval.QuadPart &gt;= 0) {
00171         Timer-&gt;Header.SignalState = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00172         Timer-&gt;Header.Inserted = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00173         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00174     }
00175 
00176     <span class="comment">//</span>
00177     <span class="comment">// Insert the timer in the timer table and return the inserted state.</span>
00178     <span class="comment">//</span>
00179 
00180     <span class="keywordflow">return</span> <a class="code" href="../../d5/d2/timersup_8c.html#a0">KiInsertTimerTable</a>(Interval, CurrentTime, Timer);
00181 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a107" doxytag="ki.h::KiRestoreInterrupts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiRestoreInterrupts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Enable</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00093">KdPollBreakIn()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00391">KeThawExecution()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00592">KiCalibrateTimeAdjustment()</a>, <a class="el" href="../../d0/d4/intsupc_8c-source.html#l00098">KiCheckForSoftwareInterrupt()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00220">KiFreezeTargetExecution()</a>, <a class="el" href="../../d7/d8/kernlini_8c-source.html#l02460">KiI386PentiumLockErrataFixup()</a>, <a class="el" href="../../d9/d3/mtrr_8c-source.html#l01796">KiLoadMTRR()</a>, and <a class="el" href="../../d0/d3/pat_8c-source.html#l00289">KiLoadPAT()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a154" doxytag="ki.h::KiRestoreProcessorControlState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiRestoreProcessorControlState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKPROCESSOR_STATE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ProcessorState</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a153" doxytag="ki.h::KiRestoreProcessorState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiRestoreProcessorState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d5/alpha_2ipi_8c-source.html#l00031">31</a> of file <a class="el" href="../../d9/d5/alpha_2ipi_8c-source.html">alpha/ipi.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00239">CONTEXT_FULL</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00230">KeContextToKframes()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, and <a class="el" href="../../d9/d6/ppc_2ipi_8c.html#a0">KiRestoreProcessorControlState()</a>.
<p>
Referenced by <a class="el" href="../../d0/d8/mips_2kdtrap_8c-source.html#l00079">KdpTrap()</a>, and <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00220">KiFreezeTargetExecution()</a>.
<p>
<pre class="fragment"><div>00038                    :
00039 
00040     This function moves processor <span class="keyword">register</span> state from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
00041     processor context structure in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor block to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00042     specified trap and exception frames.
00043 
00044 Arguments:
00045 
00046     TrapFrame - Supplies a pointer to a trap frame.
00047 
00048     ExceptionFrame - Supplies a pointer to an exception frame.
00049 
00050 Return Value:
00051 
00052     None.
00053 
00054 --*/
00055 
00056 {
00057 
00058     PKPRCB Prcb;
00059 
00060     <span class="comment">//</span>
00061     <span class="comment">// Get the address of the current processor block and move the</span>
00062     <span class="comment">// specified register state from the processor context structure</span>
00063     <span class="comment">// to the specified trap and exception frames</span>
00064     <span class="comment">//</span>
00065 
00066 <span class="preprocessor">#if !defined(NT_UP)</span>
00067 <span class="preprocessor"></span>
00068     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00069     <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a10">KeContextToKframes</a>(TrapFrame,
00070                        ExceptionFrame,
00071                        &amp;Prcb-&gt;ProcessorState.ContextFrame,
00072                        CONTEXT_FULL,
00073                        KernelMode);
00074 
00075 <span class="preprocessor">#endif</span>
00076 <span class="preprocessor"></span>
00077     <span class="keywordflow">return</span>;
00078 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a88" doxytag="ki.h::KiRundownChannel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiRundownChannel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01218">KeRundownThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a152" doxytag="ki.h::KiSaveProcessorControlState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSaveProcessorControlState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKPROCESSOR_STATE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ProcessorState</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/xxmpipi_8c-source.html#l00124">124</a> of file <a class="el" href="../../d6/d0/xxmpipi_8c-source.html">xxmpipi.c</a>.
<p>
<pre class="fragment"><div>00130                    :
00131 
00132     This routine saves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor's <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> state <span class="keywordflow">for</span> debugger.
00133 
00134 Arguments:
00135 
00136     ProcessorState (a0) - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor state.
00137 
00138 Return Value:
00139 
00140     None.
00141 
00142 --*/
00143 
00144 {
00145 
00146     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00147 
00148     <span class="comment">//</span>
00149     <span class="comment">// Read Tb entries and store in the processor state structure.</span>
00150     <span class="comment">//</span>
00151 
00152     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; KeNumberTbEntries; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00153         KiReadEntryTb(Index, &amp;ProcessorState-&gt;TbEntry[Index]);
00154     }
00155 
00156     <span class="keywordflow">return</span>;
00157 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a151" doxytag="ki.h::KiSaveProcessorState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSaveProcessorState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d5/alpha_2ipi_8c-source.html#l00081">81</a> of file <a class="el" href="../../d9/d5/alpha_2ipi_8c-source.html">alpha/ipi.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00239">CONTEXT_FULL</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00081">KeContextFromKframes()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, and <a class="el" href="../../d6/d0/xxmpipi_8c-source.html#l00124">KiSaveProcessorControlState()</a>.
<p>
Referenced by <a class="el" href="../../d0/d8/mips_2kdtrap_8c-source.html#l00079">KdpTrap()</a>, and <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00220">KiFreezeTargetExecution()</a>.
<p>
<pre class="fragment"><div>00088                    :
00089 
00090     This function moves processor <span class="keyword">register</span> state from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified trap
00091     and exception frames to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor context structure in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current
00092     processor block.
00093 
00094 Arguments:
00095 
00096     TrapFrame - Supplies a pointer to a trap frame.
00097 
00098     ExceptionFrame - Supplies a pointer to an exception frame.
00099 
00100 Return Value:
00101 
00102     None.
00103 
00104 --*/
00105 
00106 {
00107 
00108     PKPRCB Prcb;
00109 
00110     <span class="comment">//</span>
00111     <span class="comment">// Get the address of the current processor block and move the</span>
00112     <span class="comment">// specified register state from specified trap and exception</span>
00113     <span class="comment">// frames to the current processor context structure.</span>
00114     <span class="comment">//</span>
00115 
00116 <span class="preprocessor">#if !defined(NT_UP)</span>
00117 <span class="preprocessor"></span>
00118     Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00119     Prcb-&gt;ProcessorState.ContextFrame.ContextFlags = <a class="code" href="../../d6/d7/halmips_8h.html#a152">CONTEXT_FULL</a>;
00120     <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a9">KeContextFromKframes</a>(TrapFrame,
00121                          ExceptionFrame,
00122                          &amp;Prcb-&gt;ProcessorState.ContextFrame);
00123 
00124 <span class="preprocessor">#endif</span>
00125 <span class="preprocessor"></span>
00126     <span class="keywordflow">return</span>;
00127 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a133" doxytag="ki.h::KiSelectNextThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> FASTCALL KiSelectNextThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Thread</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00479">479</a> of file <a class="el" href="../../d1/d1/thredsup_8c-source.html">thredsup.c</a>.
<p>
References <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00095">KiFindReadyThread()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00044">KiIdleSummary</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00044">KiIncrementSwitchCounter</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02782">KiProcessorBlock</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00626">_KTHREAD::NextProcessor</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d1/d9/ki_8h-source.html#l00065">SetMember</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01153">KeRevertToUserAffinityThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01302">KeSetAffinityThread()</a>, and <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01467">KeSetSystemAffinityThread()</a>.
<p>
<pre class="fragment"><div>00485                    :
00486 
00487     This function selects <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next thread to run on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00488     specified thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> running on. If a thread cannot be found, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00489     idle thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> selected.
00490 
00491 Arguments:
00492 
00493     Thread - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00494 
00495 Return Value:
00496 
00497     The address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> selected thread object.
00498 
00499 --*/
00500 
00501 {
00502 
00503     PRKPRCB Prcb;
00504     ULONG Processor;
00505     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread1;
00506 
00507     <span class="comment">//</span>
00508     <span class="comment">// Get the processor number and the address of the processor control block.</span>
00509     <span class="comment">//</span>
00510 
00511 <span class="preprocessor">#if !defined(NT_UP)</span>
00512 <span class="preprocessor"></span>
00513     Processor = Thread-&gt;NextProcessor;
00514     Prcb = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[Processor];
00515 
00516 <span class="preprocessor">#else</span>
00517 <span class="preprocessor"></span>
00518     Prcb = <a class="code" href="../../d4/d9/ke_8h.html#a139">KiProcessorBlock</a>[0];
00519 
00520 <span class="preprocessor">#endif</span>
00521 <span class="preprocessor"></span>
00522     <span class="comment">//</span>
00523     <span class="comment">// If a thread has already been selected to run on the specified processor,</span>
00524     <span class="comment">// then return that thread as the selected thread.</span>
00525     <span class="comment">//</span>
00526 
00527     <span class="keywordflow">if</span> ((Thread1 = Prcb-&gt;NextThread) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00528         Prcb-&gt;NextThread = (<a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00529 
00530     } <span class="keywordflow">else</span> {
00531 
00532         <span class="comment">//</span>
00533         <span class="comment">// Attempt to find a ready thread to run.</span>
00534         <span class="comment">//</span>
00535 
00536 <span class="preprocessor">#if !defined(NT_UP)</span>
00537 <span class="preprocessor"></span>
00538         Thread1 = <a class="code" href="../../d0/d2/thredsup_8c.html#a2">KiFindReadyThread</a>(Processor, 0);
00539 
00540 <span class="preprocessor">#else</span>
00541 <span class="preprocessor"></span>
00542         Thread1 = <a class="code" href="../../d0/d2/thredsup_8c.html#a2">KiFindReadyThread</a>(0, 0);
00543 
00544 <span class="preprocessor">#endif</span>
00545 <span class="preprocessor"></span>
00546         <span class="comment">//</span>
00547         <span class="comment">// If a thread was not found, then select the idle thread and</span>
00548         <span class="comment">// set the processor member in the idle summary.</span>
00549         <span class="comment">//</span>
00550 
00551         <span class="keywordflow">if</span> (Thread1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00552             <a class="code" href="../../d0/d2/thredsup_8c.html#a0">KiIncrementSwitchCounter</a>(SwitchToIdle);
00553             Thread1 = Prcb-&gt;IdleThread;
00554 
00555 <span class="preprocessor">#if !defined(NT_UP)</span>
00556 <span class="preprocessor"></span>
00557             <a class="code" href="../../d0/d0/ki_8h.html#a7">SetMember</a>(Processor, KiIdleSummary);
00558 
00559 <span class="preprocessor">#else</span>
00560 <span class="preprocessor"></span>            <a class="code" href="../../d5/d9/kernldat_8c.html#a1">KiIdleSummary</a> = 1;
00561 
00562 <span class="preprocessor">#endif</span>
00563 <span class="preprocessor"></span>
00564         }
00565     }
00566 
00567     <span class="comment">//</span>
00568     <span class="comment">// Return address of selected thread object.</span>
00569     <span class="comment">//</span>
00570 
00571     <span class="keywordflow">return</span> Thread1;
00572 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a109" doxytag="ki.h::KiSetDebugProcessor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d9/ke_8h.html#a408">KCONTINUE_STATUS</a> KiSetDebugProcessor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PreviousMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a134" doxytag="ki.h::KiSetSystemTime" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSetSystemTime           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>NewTime</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>OldTime</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a135" doxytag="ki.h::KiSuspendNop" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSuspendNop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN struct <a class="el" href="../../d1/d5/struct__KAPC.html">_KAPC</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Apc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00043">KeInitializeThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a136" doxytag="ki.h::KiSuspendThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSuspendThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00770">770</a> of file <a class="el" href="../../d1/d1/thredsup_8c-source.html">thredsup.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00243">_KAPC_STATE::ApcListHead</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00241">_KAPC::KernelRoutine</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00603">PsExitSpecialApc()</a>, <a class="el" href="../../d4/d9/ke_8h.html#a407a203">Suspended</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00669">_KTHREAD::SuspendSemaphore</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00247">_KAPC_STATE::UserApcPending</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00043">KeInitializeThread()</a>.
<p>
<pre class="fragment"><div>00778                    :
00779 
00780     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel routine <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> builtin suspend APC of a
00781     thread. It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executed in kernel mode as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> result of queuing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> builtin
00782     suspend APC and suspends thread execution by <a class="code" href="../../d4/d9/ke_8h.html#a406a196">Waiting</a> nonalerable on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00783     thread's builtin suspend semaphore. When <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> resumed, execution
00784     of thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> continued by simply returning.
00785 
00786 Arguments:
00787 
00788     Apc - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> APC.
00789 
00790 Return Value:
00791 
00792     None.
00793 
00794 --*/
00795 
00796 {
00797 
00798     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread;
00799     <a class="code" href="../../d1/d5/struct__KAPC.html">PKAPC</a> Apc;
00800 
00801     <span class="comment">//</span>
00802     <span class="comment">// Get the address of the current thread object and Wait nonalertable on</span>
00803     <span class="comment">// the thread's builtin suspend semaphore.</span>
00804     <span class="comment">//</span>
00805 
00806     Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00807 
00808     <span class="comment">//</span>
00809     <span class="comment">// See if the thread is exiting. If the thread has the user-mode exit</span>
00810     <span class="comment">// APC in it's queue, KeForceResumeThread has been called, but it might</span>
00811     <span class="comment">// have been called just before KeSuspendThread. Account for the race here</span>
00812     <span class="comment">// by testing for the exit APC. During exit, we queue the user-mode exit APC</span>
00813     <span class="comment">// and set UserApcPending from the kernel-mode exit APC, then we call</span>
00814     <span class="comment">// KeForceResumeThread.</span>
00815     <span class="comment">//</span>
00816 
00817     <span class="keywordflow">if</span> ( Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o4">UserApcPending</a> ) {
00818         Apc = CONTAINING_RECORD((Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o0">ApcListHead</a>[UserMode].Flink), <a class="code" href="../../d1/d5/struct__KAPC.html">KAPC</a>, ApcListEntry);
00819         <span class="keywordflow">if</span> ( Apc-&gt;<a class="code" href="../../d1/d5/struct__KAPC.html#o5">KernelRoutine</a> == <a class="code" href="../../d1/d9/ps_8h.html#a117">PsExitSpecialApc</a> ) {
00820             <span class="keywordflow">return</span>;
00821         }
00822     }
00823     <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o63">SuspendSemaphore</a>,
00824                           Suspended,
00825                           KernelMode,
00826                           FALSE,
00827                           (PLARGE_INTEGER)NULL);
00828 
00829 }
<span class="preprocessor">#if 0</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a137" doxytag="ki.h::KiSwapProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiSwapProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>NewProcess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OldProcess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d4/procobj_8c-source.html#l00405">KeDetachProcess()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00512">KeUnstackDetachProcess()</a>, and <a class="el" href="../../d4/d4/procobj_8c-source.html#l00955">KiAttachProcess()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a138" doxytag="ki.h::KiSwapThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG_PTR FASTCALL KiSwapThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d2/d6/wait_8c-source.html#l00140">KeDelayExecutionThread()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00238">KeRemoveQueue()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01996">KeTerminateThread()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00395">KeWaitForMultipleObjects()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00955">KiAttachProcess()</a>, and <a class="el" href="../../d7/d0/yield_8c-source.html#l00029">NtYieldExecution()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a139" doxytag="ki.h::KiThreadStartup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiThreadStartup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>StartContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00057">KiInitializeContextThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a140" doxytag="ki.h::KiTimerExpiration" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiTimerExpiration           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d6/struct__KDPC.html">PKDPC</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00217">217</a> of file <a class="el" href="../../d6/d0/dpcsup_8c-source.html">dpcsup.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00523">_KTIMER::DueTime</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02776">KeNumberProcessors</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00333">KiTimerListExpire()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00059">KiTimerTableListHead</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00094">TIMER_TABLE_SIZE</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00524">_KTIMER::TimerListEntry</a>.
<p>
Referenced by <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>.
<p>
<pre class="fragment"><div>00226                    :
00227 
00228     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> clock interupt routine discovers that
00229     a timer has expired.
00230 
00231 Arguments:
00232 
00233     TimerDpc - Supplies a pointer to a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> DPC.
00234 
00235     DeferredContext - Not used.
00236 
00237     SystemArgument1 - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting timer table index value to
00238         use <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> timer table scan.
00239 
00240     SystemArgument2 - Not used.
00241 
00242 Return Value:
00243 
00244     None.
00245 
00246 --*/
00247 
00248 {
00249     ULARGE_INTEGER CurrentTime;
00250     LIST_ENTRY ExpiredListHead;
00251     LONG HandLimit;
00252     LONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00253     PLIST_ENTRY ListHead;
00254     PLIST_ENTRY NextEntry;
00255     KIRQL OldIrql;
00256     <a class="code" href="../../d3/d8/struct__KTIMER.html">PKTIMER</a> Timer;
00257 
00258     <span class="comment">//</span>
00259     <span class="comment">// Acquire the dispatcher database lock and read the current interrupt</span>
00260     <span class="comment">// time to determine which timers have expired.</span>
00261     <span class="comment">//</span>
00262 
00263     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00264     KiQueryInterruptTime((PLARGE_INTEGER)&amp;CurrentTime);
00265 
00266     <span class="comment">//</span>
00267     <span class="comment">// If the timer table has not wrapped, then start with the specified</span>
00268     <span class="comment">// timer table index value, and scan for timer entries that have expired.</span>
00269     <span class="comment">// Otherwise, start with the first entry in the timer table and scan the</span>
00270     <span class="comment">// entire table for timer entries that have expired.</span>
00271     <span class="comment">//</span>
00272     <span class="comment">// N.B. This later condition exists when DPC processing is blocked for a</span>
00273     <span class="comment">//      period longer than one round trip throught the timer table.</span>
00274     <span class="comment">//</span>
00275 
00276     HandLimit = (LONG)KiQueryLowTickCount();
00277     <span class="keywordflow">if</span> (((ULONG)(HandLimit - PtrToLong(SystemArgument1))) &gt;= <a class="code" href="../../d4/d9/ke_8h.html#a10">TIMER_TABLE_SIZE</a>) {
00278         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = - 1;
00279         HandLimit = <a class="code" href="../../d4/d9/ke_8h.html#a10">TIMER_TABLE_SIZE</a> - 1;
00280 
00281     } <span class="keywordflow">else</span> {
00282         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = (PtrToLong(SystemArgument1) - 1) &amp; (<a class="code" href="../../d4/d9/ke_8h.html#a10">TIMER_TABLE_SIZE</a> - 1);
00283         HandLimit &amp;= (<a class="code" href="../../d4/d9/ke_8h.html#a10">TIMER_TABLE_SIZE</a> - 1);
00284     }
00285 
00286     InitializeListHead(&amp;ExpiredListHead);
00287     <span class="keywordflow">do</span> {
00288         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> + 1) &amp; (<a class="code" href="../../d4/d9/ke_8h.html#a10">TIMER_TABLE_SIZE</a> - 1);
00289         ListHead = &amp;<a class="code" href="../../d5/d9/kernldat_8c.html#a3">KiTimerTableListHead</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00290         NextEntry = ListHead-&gt;Flink;
00291         <span class="keywordflow">while</span> (NextEntry != ListHead) {
00292             Timer = CONTAINING_RECORD(NextEntry, <a class="code" href="../../d3/d8/struct__KTIMER.html">KTIMER</a>, TimerListEntry);
00293             <span class="keywordflow">if</span> (Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o1">DueTime</a>.QuadPart &lt;= CurrentTime.QuadPart) {
00294 
00295                 <span class="comment">//</span>
00296                 <span class="comment">// The next timer in the current timer list has expired.</span>
00297                 <span class="comment">// Remove the entry from the timer list and insert the</span>
00298                 <span class="comment">// timer in the expired list.</span>
00299                 <span class="comment">//</span>
00300 
00301                 RemoveEntryList(&amp;Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o2">TimerListEntry</a>);
00302                 InsertTailList(&amp;ExpiredListHead, &amp;Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o2">TimerListEntry</a>);
00303                 NextEntry = ListHead-&gt;Flink;
00304 
00305             } <span class="keywordflow">else</span> {
00306                 <span class="keywordflow">break</span>;
00307             }
00308         }
00309 
00310     } <span class="keywordflow">while</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> != HandLimit);
00311 
00312 <span class="preprocessor">#if DBG</span>
00313 <span class="preprocessor"></span>
00314     <span class="keywordflow">if</span> ((PtrToUlong(SystemArgument2) == 0) &amp;&amp; (<a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a> == 1)) {
00315         KiCheckTimerTable(CurrentTime);
00316     }
00317 
00318 <span class="preprocessor">#endif</span>
00319 <span class="preprocessor"></span>
00320     <span class="comment">//</span>
00321     <span class="comment">// Process the expired timer list.</span>
00322     <span class="comment">//</span>
00323     <span class="comment">// N.B. The following function returns with the dispatcher database</span>
00324     <span class="comment">//      unlocked.</span>
00325     <span class="comment">//</span>
00326 
00327     <a class="code" href="../../d0/d0/ki_8h.html#a141">KiTimerListExpire</a>(&amp;ExpiredListHead, OldIrql);
00328     <span class="keywordflow">return</span>;
00329 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a141" doxytag="ki.h::KiTimerListExpire" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL KiTimerListExpire           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLIST_ENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>ExpiredListHead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>OldIrql</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00333">333</a> of file <a class="el" href="../../d6/d0/dpcsup_8c-source.html">dpcsup.c</a>.
<p>
References <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00038">_DPC_ENTRY::Context</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00051">Count</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00337">_KDPC::DeferredContext</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00336">_KDPC::DeferredRoutine</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00036">_DPC_ENTRY::Dpc</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00525">_KTIMER::Dpc</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00522">_KTIMER::Header</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d5/d0/dpcobj_8c-source.html#l00089">KeInsertQueueDpc()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d6/d1/timersup_8c-source.html#l00042">KiInsertTreeTimer()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00755">KiRemoveTreeTimer</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>, <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00033">MAXIMUM_DPC_LIST_SIZE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l01420">MAXIMUM_PROCESSORS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00333">_KDPC::Number</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00526">_KTIMER::Period</a>, <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00037">_DPC_ENTRY::Routine</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00262">_DISPATCHER_HEADER::SignalState</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00038">TIMER_EXPIRE_INCREMENT</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00263">_DISPATCHER_HEADER::WaitListHead</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00335">KeSetSystemTime()</a>, and <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00217">KiTimerExpiration()</a>.
<p>
<pre class="fragment"><div>00340                    :
00341 
00342     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called to process a list of timers that have expired.
00343 
00344     N.B. This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dispatcher database locked and
00345         returns with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dispatcher database unlocked.
00346 
00347 Arguments:
00348 
00349     ExpiredListHead - Supplies a pointer to a list of timers that have
00350         expired.
00351 
00352     OldIrql - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> previous IRQL.
00353 
00354 Return Value:
00355 
00356     None.
00357 
00358 --*/
00359 
00360 {
00361 
00362     LONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00363     <a class="code" href="../../d1/d6/struct__KDPC.html">PKDPC</a> Dpc;
00364     <a class="code" href="../../d6/d8/struct__DPC__ENTRY.html">DPC_ENTRY</a> DpcList[<a class="code" href="../../d5/d1/dpcsup_8c.html#a0">MAXIMUM_DPC_LIST_SIZE</a>];
00365     LONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00366     LARGE_INTEGER Interval;
00367     KIRQL OldIrql1;
00368     LARGE_INTEGER SystemTime;
00369     <a class="code" href="../../d3/d8/struct__KTIMER.html">PKTIMER</a> Timer;
00370 
00371     <span class="comment">//</span>
00372     <span class="comment">// Capture the timer expiration time.</span>
00373     <span class="comment">//</span>
00374 
00375     KiQuerySystemTime(&amp;SystemTime);
00376 
00377     <span class="comment">//</span>
00378     <span class="comment">// Remove the next timer from the expired timer list, set the state of</span>
00379     <span class="comment">// the timer to signaled, reinsert the timer in the timer tree if it is</span>
00380     <span class="comment">// periodic, and optionally call the DPC routine if one is specified.</span>
00381     <span class="comment">//</span>
00382 
00383 RestartScan:
00384     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 0;
00385     <span class="keywordflow">while</span> (ExpiredListHead-&gt;Flink != ExpiredListHead) {
00386         Timer = CONTAINING_RECORD(ExpiredListHead-&gt;Flink, <a class="code" href="../../d3/d8/struct__KTIMER.html">KTIMER</a>, TimerListEntry);
00387         <a class="code" href="../../d0/d0/ki_8h.html#a22">KiRemoveTreeTimer</a>(Timer);
00388         Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o4">SignalState</a> = 1;
00389         <span class="keywordflow">if</span> (IsListEmpty(&amp;Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o5">WaitListHead</a>) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00390             <a class="code" href="../../d2/d7/waitsup_8c.html#a3">KiWaitTest</a>(Timer, TIMER_EXPIRE_INCREMENT);
00391         }
00392 
00393         <span class="comment">//</span>
00394         <span class="comment">// If the timer is periodic, then compute the next interval time</span>
00395         <span class="comment">// and reinsert the timer in the timer tree.</span>
00396         <span class="comment">//</span>
00397         <span class="comment">// N.B. Even though the timer insertion is relative, it can still</span>
00398         <span class="comment">//      fail if the period of the timer elapses in between computing</span>
00399         <span class="comment">//      the time and inserting the timer in the table. If this happens,</span>
00400         <span class="comment">//      try again.</span>
00401         <span class="comment">//</span>
00402         <span class="keywordflow">if</span> (Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o4">Period</a> != 0) {
00403             Interval.QuadPart = Int32x32To64(Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o4">Period</a>, - 10 * 1000);
00404             <span class="keywordflow">while</span> (!<a class="code" href="../../d5/d2/timersup_8c.html#a1">KiInsertTreeTimer</a>(Timer, Interval)) {
00405                 ;
00406             }
00407         }
00408 
00409         <span class="keywordflow">if</span> (Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o3">Dpc</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00410             Dpc = Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o3">Dpc</a>;
00411 
00412             <span class="comment">//</span>
00413             <span class="comment">// If the DPC is explicitly targeted to another processor, then</span>
00414             <span class="comment">// queue the DPC to the target processor. Otherwise, capture the</span>
00415             <span class="comment">// DPC parameters for execution on the current processor.</span>
00416             <span class="comment">//</span>
00417 
00418 <span class="preprocessor">#if defined(NT_UP)</span>
00419 <span class="preprocessor"></span>
00420             DpcList[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>].<a class="code" href="../../d6/d8/struct__DPC__ENTRY.html#o0">Dpc</a> = Dpc;
00421             DpcList[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>].<a class="code" href="../../d6/d8/struct__DPC__ENTRY.html#o1">Routine</a> = Dpc-&gt;<a class="code" href="../../d1/d6/struct__KDPC.html#o4">DeferredRoutine</a>;
00422             DpcList[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>].<a class="code" href="../../d6/d8/struct__DPC__ENTRY.html#o2">Context</a> = Dpc-&gt;<a class="code" href="../../d1/d6/struct__KDPC.html#o5">DeferredContext</a>;
00423             <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> += 1;
00424             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> == <a class="code" href="../../d5/d1/dpcsup_8c.html#a0">MAXIMUM_DPC_LIST_SIZE</a>) {
00425                 <span class="keywordflow">break</span>;
00426             }
00427 
00428 <span class="preprocessor">#else</span>
00429 <span class="preprocessor"></span>
00430             <span class="keywordflow">if</span> ((Dpc-&gt;<a class="code" href="../../d1/d6/struct__KDPC.html#o1">Number</a> &gt;= <a class="code" href="../../d9/d5/ndismain_8h.html#a183">MAXIMUM_PROCESSORS</a>) &amp;&amp;
00431                 (((ULONG)Dpc-&gt;<a class="code" href="../../d1/d6/struct__KDPC.html#o1">Number</a> - <a class="code" href="../../d9/d5/ndismain_8h.html#a183">MAXIMUM_PROCESSORS</a>) != (ULONG)KeGetCurrentProcessorNumber())) {
00432                 <a class="code" href="../../d4/d1/dpcobj_8c.html#a2">KeInsertQueueDpc</a>(Dpc,
00433                                  ULongToPtr(SystemTime.LowPart),
00434                                  ULongToPtr(SystemTime.HighPart));
00435 
00436             } <span class="keywordflow">else</span> {
00437                 DpcList[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>].<a class="code" href="../../d6/d8/struct__DPC__ENTRY.html#o0">Dpc</a> = Dpc;
00438                 DpcList[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>].<a class="code" href="../../d6/d8/struct__DPC__ENTRY.html#o1">Routine</a> = Dpc-&gt;<a class="code" href="../../d1/d6/struct__KDPC.html#o4">DeferredRoutine</a>;
00439                 DpcList[<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>].<a class="code" href="../../d6/d8/struct__DPC__ENTRY.html#o2">Context</a> = Dpc-&gt;<a class="code" href="../../d1/d6/struct__KDPC.html#o5">DeferredContext</a>;
00440                 <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> += 1;
00441                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> == <a class="code" href="../../d5/d1/dpcsup_8c.html#a0">MAXIMUM_DPC_LIST_SIZE</a>) {
00442                     <span class="keywordflow">break</span>;
00443                 }
00444             }
00445 
00446 <span class="preprocessor">#endif</span>
00447 <span class="preprocessor"></span>
00448         }
00449     }
00450 
00451     <span class="comment">//</span>
00452     <span class="comment">// Unlock the dispacher database and process DPC list entries.</span>
00453     <span class="comment">//</span>
00454 
00455     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> != 0) {
00456         <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(DISPATCH_LEVEL);
00457         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0;
00458         <span class="keywordflow">do</span> {
00459 
00460 <span class="preprocessor">#if DBG &amp;&amp; (defined(i386) || defined(ALPHA))</span>
00461 <span class="preprocessor"></span>
00462             <span class="comment">//</span>
00463             <span class="comment">// Reset the dpc tick count. If the tick count handler,</span>
00464             <span class="comment">// which increments this value, detects that it has crossed</span>
00465             <span class="comment">// a certain threshold, a breakpoint will be generated.</span>
00466             <span class="comment">//</span>
00467 
00468             <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>()-&gt;DebugDpcTime = 0;
00469 <span class="preprocessor">#endif</span>
00470 <span class="preprocessor"></span>
00471             (DpcList[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d6/d8/struct__DPC__ENTRY.html#o1">Routine</a>)(DpcList[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d6/d8/struct__DPC__ENTRY.html#o0">Dpc</a>,
00472                                      DpcList[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].<a class="code" href="../../d6/d8/struct__DPC__ENTRY.html#o2">Context</a>,
00473                                      ULongToPtr(SystemTime.LowPart),
00474                                      ULongToPtr(SystemTime.HighPart));
00475 
00476 
00477             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1;
00478         } <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
00479 
00480         <span class="comment">//</span>
00481         <span class="comment">// If processing of the expired timer list was terminated because</span>
00482         <span class="comment">// the DPC List was full, then process any remaining entries.</span>
00483         <span class="comment">//</span>
00484 
00485         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> == <a class="code" href="../../d5/d1/dpcsup_8c.html#a0">MAXIMUM_DPC_LIST_SIZE</a>) {
00486             <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql1);
00487             <span class="keywordflow">goto</span> RestartScan;
00488         }
00489 
00490         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00491 
00492     } <span class="keywordflow">else</span> {
00493         <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00494     }
00495 
00496     <span class="keywordflow">return</span>;
00497 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a85" doxytag="ki.h::KiTryToAcquireQueuedSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LOGICAL FASTCALL KiTryToAcquireQueuedSpinLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d8/struct__KSPIN__LOCK__QUEUE.html">PKSPIN_LOCK_QUEUE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>QueuedLock</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d7/d8/kernlini_8c-source.html#l00246">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a155" doxytag="ki.h::KiTryToAcquireSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiTryToAcquireSpinLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKSPIN_LOCK&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SpinLock</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00303">KdEnterDebugger()</a>, <a class="el" href="../../d5/d5/kdinit_8c-source.html#l00379">KdLogDbgPrint()</a>, <a class="el" href="../../d7/d5/kdlock_8c-source.html#l00093">KdPollBreakIn()</a>, and <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a142" doxytag="ki.h::KiUnexpectedInterrupt" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiUnexpectedInterrupt           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a143" doxytag="ki.h::KiUnlockDeviceQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiUnlockDeviceQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d5/struct__KDEVICE__QUEUE.html">PKDEVICE_QUEUE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>DeviceQueue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>OldIrql</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a84" doxytag="ki.h::KiUnlockDispatcherDatabase" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL KiUnlockDispatcherDatabase           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN KIRQL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>OldIrql</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l01097">ExpCheckForWorker()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02683">ExpFindCurrentThread()</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01437">Ke386VdmClearApcObject()</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01257">Ke386VdmInsertQueueApc()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00365">KeAlertResumeThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00281">KeAlertThread()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00166">KeAttachProcess()</a>, <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00413">KeAttachSessionSpace()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00142">KeBalanceSetManager()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00154">KeBoostCurrentThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00459">KeBoostPriorityThread()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00157">KeCancelTimer()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00467">KeCheckForTimer()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00515">KeConfineThread()</a>, <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00154">KeConnectInterrupt()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00140">KeDelayExecutionThread()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00405">KeDetachProcess()</a>, <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00543">KeDetachSessionSpace()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00574">KeDisableApcQueuingThread()</a>, <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00364">KeDisableSessionSharing()</a>, <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00298">KeDisconnectInterrupt()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00631">KeEnableApcQueuingThread()</a>, <a class="el" href="../../d8/d5/ke_2ia64_2region_8c-source.html#l00315">KeEnableSessionSharing()</a>, <a class="el" href="../../d6/d6/apcobj_8c-source.html#l00138">KeFlushQueueApc()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00228">KeForceAttachProcess()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00688">KeForceResumeThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00757">KeFreezeAllThreads()</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00040">KeInitializeMutant()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00043">KeInitializeThread()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00181">KeInsertHeadQueue()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00124">KeInsertQueue()</a>, <a class="el" href="../../d6/d6/apcobj_8c-source.html#l00217">KeInsertQueueApc()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00167">KePulseEvent()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00904">KeQueryBasePriorityThread()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00410">KeQueryTimerDueTime()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01025">KeReadyThread()</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00178">KeReleaseMutant()</a>, <a class="el" href="../../d2/d5/semphobj_8c-source.html#l00118">KeReleaseSemaphore()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00238">KeRemoveQueue()</a>, <a class="el" href="../../d6/d6/apcobj_8c-source.html#l00291">KeRemoveQueueApc()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00285">KeResetEvent()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01079">KeResumeThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01153">KeRevertToUserAffinityThread()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00570">KeRundownQueue()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01218">KeRundownThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01302">KeSetAffinityThread()</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00208">KeSetAutoAlignmentProcess()</a>, <a class="el" href="../../d5/d0/alpha_2thredini_8c-source.html#l00269">KeSetAutoAlignmentThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01532">KeSetBasePriorityThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01674">KeSetDisableBoostThread()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00458">KeSetEventBoostPriority()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01735">KeSetIdealProcessorThread()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00738">KeSetPriorityProcess()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01838">KeSetPriorityThread()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00656">KeSetProcess()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01467">KeSetSystemAffinityThread()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00335">KeSetSystemTime()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00285">KeSetTimerEx()</a>, <a class="el" href="../../d7/d8/kernlini_8c-source.html#l02008">KeSetup80387OrEmulate()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00324">KeStackAttachProcess()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01912">KeSuspendThread()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00322">KeSwapProcessOrStack()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l02121">KeTestAlertThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l02190">KeThawAllThreads()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00512">KeUnstackDetachProcess()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00395">KeWaitForMultipleObjects()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00955">KiAttachProcess()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00431">KiInSwapKernelStacks()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00483">KiInSwapProcesses()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00544">KiOutSwapKernelStacks()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00644">KiOutSwapProcesses()</a>, <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00043">KiQuantumEnd()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00732">KiScanReadyQueues()</a>, <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00333">KiTimerListExpire()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00525">NtReplyWaitSendChannel()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00807">NtSendWaitReplyChannel()</a>, <a class="el" href="../../d7/d0/yield_8c-source.html#l00029">NtYieldExecution()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00057">PspReaper()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a144" doxytag="ki.h::KiUnwaitThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL KiUnwaitThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitStatus</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KPRIORITY&nbsp;</td>
          <td class="mdname" nowrap> <em>Increment</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00031">31</a> of file <a class="el" href="../../d3/d6/waitsup_8c-source.html">waitsup.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00768">_KPROCESS::BasePriority</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00500">_KQUEUE::CurrentCount</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00522">_KTIMER::Header</a>, <a class="el" href="../../d7/d3/rtl_2random_8c-source.html#l00032">Increment</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00261">_DISPATCHER_HEADER::Inserted</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00755">KiRemoveTreeTimer</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00043">MEMORY_PRIORITY_FOREGROUND</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00283">_KWAIT_BLOCK::NextWaitBlock</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/ke_8h.html#a91">PKQUEUE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00573">PsPrioritySeperation</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00769">_KPROCESS::ThreadQuantum</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00044">TIME_CRITICAL_PRIORITY_BOUND</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00029">WAIT_QUANTUM_DECREMENT</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00280">_KWAIT_BLOCK::WaitListEntry</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00365">KeAlertResumeThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00281">KeAlertThread()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00458">KeSetEventBoostPriority()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00649">KiActivateWaiterQueue()</a>, <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00223">KiInsertQueueApc()</a>, and <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>.
<p>
<pre class="fragment"><div>00039                    :
00040 
00041     This function unwaits a thread, sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread's wait completion status,
00042     calculates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread's <span class="keyword">new</span> priority, and readies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <span class="keywordflow">for</span> execution.
00043 
00044 Arguments:
00045 
00046     Thread - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> thread.
00047 
00048     WaitStatus - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> wait completion status.
00049 
00050     <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> priority increment that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be applied to
00051         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread's priority.
00052 
00053 Return Value:
00054 
00055     None.
00056 
00057 --*/
00058 
00059 {
00060 
00061     KPRIORITY NewPriority;
00062     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00063     <a class="code" href="../../d7/d7/struct__KQUEUE.html">PKQUEUE</a> Queue;
00064     <a class="code" href="../../d3/d8/struct__KTIMER.html">PKTIMER</a> Timer;
00065     <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">PRKWAIT_BLOCK</a> WaitBlock;
00066 
00067     <span class="comment">//</span>
00068     <span class="comment">// Set wait completion status, remove wait blocks from object wait</span>
00069     <span class="comment">// lists, and remove thread from wait list.</span>
00070     <span class="comment">//</span>
00071 
00072     Thread-&gt;WaitStatus |= WaitStatus;
00073     WaitBlock = Thread-&gt;WaitBlockList;
00074     <span class="keywordflow">do</span> {
00075         RemoveEntryList(&amp;WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o0">WaitListEntry</a>);
00076         WaitBlock = WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o3">NextWaitBlock</a>;
00077     } <span class="keywordflow">while</span> (WaitBlock != Thread-&gt;WaitBlockList);
00078 
00079     RemoveEntryList(&amp;Thread-&gt;WaitListEntry);
00080 
00081     <span class="comment">//</span>
00082     <span class="comment">// If thread timer is still active, then cancel thread timer.</span>
00083     <span class="comment">//</span>
00084 
00085     Timer = &amp;Thread-&gt;Timer;
00086     <span class="keywordflow">if</span> (Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o3">Inserted</a> != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00087         <a class="code" href="../../d0/d0/ki_8h.html#a22">KiRemoveTreeTimer</a>(Timer);
00088     }
00089 
00090     <span class="comment">//</span>
00091     <span class="comment">// If the thread is processing a queue entry, then increment the</span>
00092     <span class="comment">// count of currently active threads.</span>
00093     <span class="comment">//</span>
00094 
00095     Queue = Thread-&gt;Queue;
00096     <span class="keywordflow">if</span> (Queue != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00097         Queue-&gt;<a class="code" href="../../d7/d7/struct__KQUEUE.html#o2">CurrentCount</a> += 1;
00098     }
00099 
00100     <span class="comment">//</span>
00101     <span class="comment">// If the thread runs at a realtime priority level, then reset the</span>
00102     <span class="comment">// thread quantum. Otherwise, compute the next thread priority and</span>
00103     <span class="comment">// charge the thread for the wait operation.</span>
00104     <span class="comment">//</span>
00105 
00106     Process = Thread-&gt;ApcState.Process;
00107     <span class="keywordflow">if</span> (Thread-&gt;Priority &lt; LOW_REALTIME_PRIORITY) {
00108         <span class="keywordflow">if</span> ((Thread-&gt;PriorityDecrement == 0) &amp;&amp;
00109             (Thread-&gt;DisableBoost == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00110             NewPriority = Thread-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o12">BasePriority</a> + <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a>;
00111             <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)Process)-&gt;Vm.MemoryPriority == <a class="code" href="../../d1/d9/ps_8h.html#a3">MEMORY_PRIORITY_FOREGROUND</a>) {
00112                 NewPriority += <a class="code" href="../../d1/d9/ps_8h.html#a47">PsPrioritySeperation</a>;
00113             }
00114 
00115             <span class="keywordflow">if</span> (NewPriority &gt; Thread-&gt;Priority) {
00116                 <span class="keywordflow">if</span> (NewPriority &gt;= LOW_REALTIME_PRIORITY) {
00117                     Thread-&gt;Priority = LOW_REALTIME_PRIORITY - 1;
00118 
00119                 } <span class="keywordflow">else</span> {
00120                     Thread-&gt;Priority = (SCHAR)NewPriority;
00121                 }
00122             }
00123         }
00124 
00125         <span class="keywordflow">if</span> (Thread-&gt;BasePriority &gt;= <a class="code" href="../../d0/d0/ki_8h.html#a4">TIME_CRITICAL_PRIORITY_BOUND</a>) {
00126             Thread-&gt;Quantum = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a>;
00127 
00128         } <span class="keywordflow">else</span> {
00129             Thread-&gt;Quantum -= <a class="code" href="../../d4/d9/ke_8h.html#a1">WAIT_QUANTUM_DECREMENT</a>;
00130             <span class="keywordflow">if</span> (Thread-&gt;Quantum &lt;= 0) {
00131                 Thread-&gt;Quantum = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a>;
00132                 Thread-&gt;Priority -= (Thread-&gt;PriorityDecrement + 1);
00133                 <span class="keywordflow">if</span> (Thread-&gt;Priority &lt; Thread-&gt;BasePriority) {
00134                     Thread-&gt;Priority = Thread-&gt;BasePriority;
00135                 }
00136 
00137                 Thread-&gt;PriorityDecrement = 0;
00138             }
00139         }
00140 
00141     } <span class="keywordflow">else</span> {
00142         Thread-&gt;Quantum = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a>;
00143     }
00144 
00145     <span class="comment">//</span>
00146     <span class="comment">// Reready the thread for execution.</span>
00147     <span class="comment">//</span>
00148 
00149     <a class="code" href="../../d0/d2/thredsup_8c.html#a3">KiReadyThread</a>(Thread);
00150     <span class="keywordflow">return</span>;
00151 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a145" doxytag="ki.h::KiUserApcDispatcher" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiUserApcDispatcher           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a146" doxytag="ki.h::KiUserExceptionDispatcher" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiUserExceptionDispatcher           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a147" doxytag="ki.h::KiWaitSatisfyAll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL KiWaitSatisfyAll           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d8/struct__KWAIT__BLOCK.html">PRKWAIT_BLOCK</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>WaitBlock</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00228">228</a> of file <a class="el" href="../../d3/d6/waitsup_8c-source.html">waitsup.c</a>.
<p>
References <a class="el" href="../../d1/d9/ki_8h-source.html#l00913">KiWaitSatisfyAny</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00283">_KWAIT_BLOCK::NextWaitBlock</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00282">_KWAIT_BLOCK::Object</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00281">_KWAIT_BLOCK::Thread</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00284">_KWAIT_BLOCK::WaitKey</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/wait_8c-source.html#l00395">KeWaitForMultipleObjects()</a>, and <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>.
<p>
<pre class="fragment"><div>00234                    :
00235 
00236     This function satisfies a wait all and performs any side effects that
00237     are necessary.
00238 
00239 Arguments:
00240 
00241     WaitBlock - Supplies a pointer to a wait block.
00242 
00243 Return Value:
00244 
00245     None.
00246 
00247 --*/
00248 
00249 {
00250 
00251     <a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTANT</a> Object;
00252     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread;
00253     <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">PRKWAIT_BLOCK</a> WaitBlock1;
00254 
00255     <span class="comment">//</span>
00256     <span class="comment">// If the wait type was WaitAny, then perform neccessary side effects on</span>
00257     <span class="comment">// the object specified by the wait block. Else perform necessary side</span>
00258     <span class="comment">// effects on all the objects that were involved in the wait operation.</span>
00259     <span class="comment">//</span>
00260 
00261     WaitBlock1 = WaitBlock;
00262     Thread = WaitBlock1-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o1">Thread</a>;
00263     <span class="keywordflow">do</span> {
00264         <span class="keywordflow">if</span> (WaitBlock1-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o4">WaitKey</a> != (CSHORT)STATUS_TIMEOUT) {
00265             Object = (<a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTANT</a>)WaitBlock1-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o2">Object</a>;
00266             <a class="code" href="../../d0/d0/ki_8h.html#a25">KiWaitSatisfyAny</a>(Object, Thread);
00267         }
00268 
00269         WaitBlock1 = WaitBlock1-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o3">NextWaitBlock</a>;
00270     } <span class="keywordflow">while</span> (WaitBlock1 != WaitBlock);
00271 
00272     <span class="keywordflow">return</span>;
00273 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a148" doxytag="ki.h::KiWaitTest" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL KiWaitTest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KPRIORITY&nbsp;</td>
          <td class="mdname" nowrap> <em>Increment</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">277</a> of file <a class="el" href="../../d3/d6/waitsup_8c-source.html">waitsup.c</a>.
<p>
References <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00086">Event()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00485">_KMUTANT::Header</a>, <a class="el" href="../../d7/d3/rtl_2random_8c-source.html#l00032">Increment</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00031">KiUnwaitThread()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00228">KiWaitSatisfyAll()</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00913">KiWaitSatisfyAny</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a159">MutantObject</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00283">_KWAIT_BLOCK::NextWaitBlock</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00282">_KWAIT_BLOCK::Object</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00487">_KMUTANT::OwnerThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00262">_DISPATCHER_HEADER::SignalState</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00281">_KWAIT_BLOCK::Thread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00258">_DISPATCHER_HEADER::Type</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00284">_KWAIT_BLOCK::WaitKey</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00285">_KWAIT_BLOCK::WaitType</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00365">KeAlertResumeThread()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00405">KeDetachProcess()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l00688">KeForceResumeThread()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00167">KePulseEvent()</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00178">KeReleaseMutant()</a>, <a class="el" href="../../d2/d5/semphobj_8c-source.html#l00118">KeReleaseSemaphore()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01079">KeResumeThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01218">KeRundownThread()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00656">KeSetProcess()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00285">KeSetTimerEx()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01996">KeTerminateThread()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l02190">KeThawAllThreads()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00512">KeUnstackDetachProcess()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00955">KiAttachProcess()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>, and <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00333">KiTimerListExpire()</a>.
<p>
<pre class="fragment"><div>00284                    :
00285 
00286     This function tests <span class="keywordflow">if</span> a wait can be satisfied when an object attains
00287     a state of signaled. If a wait can be satisfied, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject thread
00288     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> unwaited with a completion status that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> WaitKey of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> wait
00289     block from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object wait list. As many waits as possible are satisfied.
00290 
00291 Arguments:
00292 
00293     Object - Supplies a pointer to a dispatcher object.
00294 
00295 Return Value:
00296 
00297     None.
00298 
00299 --*/
00300 
00301 {
00302 
00303     <a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a> <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a>;
00304     PLIST_ENTRY ListHead;
00305     <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">PRKWAIT_BLOCK</a> NextBlock;
00306     <a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTANT</a> Mutant;
00307     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread;
00308     <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">PRKWAIT_BLOCK</a> WaitBlock;
00309     PLIST_ENTRY WaitEntry;
00310 
00311     <span class="comment">//</span>
00312     <span class="comment">// As long as the signal state of the specified object is Signaled and</span>
00313     <span class="comment">// there are waiters in the object wait list, then try to satisfy a wait.</span>
00314     <span class="comment">//</span>
00315 
00316     <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> = (<a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a>)Object;
00317     ListHead = &amp;<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a>-&gt;Header.WaitListHead;
00318     WaitEntry = ListHead-&gt;Flink;
00319     <span class="keywordflow">while</span> ((<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a>-&gt;Header.SignalState &gt; 0) &amp;&amp;
00320            (WaitEntry != ListHead)) {
00321         WaitBlock = CONTAINING_RECORD(WaitEntry, <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">KWAIT_BLOCK</a>, WaitListEntry);
00322         Thread = WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o1">Thread</a>;
00323         <span class="keywordflow">if</span> (WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o5">WaitType</a> != WaitAny) {
00324 
00325             <span class="comment">//</span>
00326             <span class="comment">// The wait type is wait all - if all the objects are in</span>
00327             <span class="comment">// a Signaled state, then satisfy the wait.</span>
00328             <span class="comment">//</span>
00329 
00330             NextBlock = WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o3">NextWaitBlock</a>;
00331             <span class="keywordflow">while</span> (NextBlock != WaitBlock) {
00332                 <span class="keywordflow">if</span> (NextBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o4">WaitKey</a> != (CSHORT)(STATUS_TIMEOUT)) {
00333                     Mutant = (<a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTANT</a>)NextBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o2">Object</a>;
00334                     <span class="keywordflow">if</span> ((Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o0">Type</a> == <a class="code" href="../../d4/d9/ke_8h.html#a402a159">MutantObject</a>) &amp;&amp;
00335                         (Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o4">SignalState</a> &lt;= 0) &amp;&amp;
00336                         (Thread == Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o2">OwnerThread</a>)) {
00337                         <span class="keywordflow">goto</span> next;
00338 
00339                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o4">SignalState</a> &lt;= 0) {
00340                         <span class="keywordflow">goto</span> scan;
00341                     }
00342                 }
00343 
00344             next:
00345                 NextBlock = NextBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o3">NextWaitBlock</a>;
00346             }
00347 
00348             <span class="comment">//</span>
00349             <span class="comment">// All objects associated with the wait are in the Signaled</span>
00350             <span class="comment">// state - satisfy the wait.</span>
00351             <span class="comment">//</span>
00352 
00353             WaitEntry = WaitEntry-&gt;Blink;
00354             <a class="code" href="../../d2/d7/waitsup_8c.html#a2">KiWaitSatisfyAll</a>(WaitBlock);
00355 
00356         } <span class="keywordflow">else</span> {
00357 
00358             <span class="comment">//</span>
00359             <span class="comment">// The wait type is wait any - satisfy the wait.</span>
00360             <span class="comment">//</span>
00361 
00362             WaitEntry = WaitEntry-&gt;Blink;
00363             <a class="code" href="../../d0/d0/ki_8h.html#a25">KiWaitSatisfyAny</a>((<a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTANT</a>)Event, Thread);
00364         }
00365 
00366         <a class="code" href="../../d2/d7/waitsup_8c.html#a0">KiUnwaitThread</a>(Thread, (NTSTATUS)WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o4">WaitKey</a>, Increment);
00367 
00368     scan:
00369         WaitEntry = WaitEntry-&gt;Flink;
00370     }
00371 
00372     <span class="keywordflow">return</span>;
00373 }
}
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a39" doxytag="ki.h::KiAdjustDpcThreshold" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d0/ki_8h.html#a39">KiAdjustDpcThreshold</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01112">1112</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a62" doxytag="ki.h::KiArgumentTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR <a class="el" href="../../d0/d0/ki_8h.html#a62">KiArgumentTable</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01135">1135</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="ki.h::KiContextSwapLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d0/d0/ki_8h.html#a40">KiContextSwapLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01113">1113</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="ki.h::KiDebugRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d9/ke_8h.html#a64">PKDEBUG_ROUTINE</a> <a class="el" href="../../d0/d0/ki_8h.html#a41">KiDebugRoutine</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01114">1114</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="ki.h::KiDebugSwitchRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d9/ke_8h.html#a65">PKDEBUG_SWITCH_ROUTINE</a> <a class="el" href="../../d0/d0/ki_8h.html#a42">KiDebugSwitchRoutine</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01115">1115</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="ki.h::KiDispatcherLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d0/d0/ki_8h.html#a43">KiDispatcherLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01116">1116</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="ki.h::KiDispatcherReadyListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d0/d0/ki_8h.html#a44">KiDispatcherReadyListHead</a>[MAXIMUM_PRIORITY]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01117">1117</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01302">KeSetAffinityThread()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00095">KiFindReadyThread()</a>, <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00732">KiScanReadyQueues()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00576">KiSetPriorityThread()</a>, and <a class="el" href="../../d7/d0/yield_8c-source.html#l00029">NtYieldExecution()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="ki.h::KiDmaIoCoherency" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d0/ki_8h.html#a36">KiDmaIoCoherency</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01109">1109</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00374">KeFlushIoBuffers()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00239">KeSetDmaIoCoherency()</a>, and <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a80" doxytag="ki.h::KiEnableTimerWatchdog" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d0/ki_8h.html#a80">KiEnableTimerWatchdog</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01153">1153</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="ki.h::KiFindFirstSetLeft" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CCHAR <a class="el" href="../../d0/d0/ki_8h.html#a45">KiFindFirstSetLeft</a>[256]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01118">1118</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a49" doxytag="ki.h::KiFindLeftNibbleBitTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR <a class="el" href="../../d0/d0/ki_8h.html#a49">KiFindLeftNibbleBitTable</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01122">1122</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="ki.h::KiFlushSingleCallData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html">CALL_PERFORMANCE_DATA</a> <a class="el" href="../../d0/d0/ki_8h.html#a46">KiFlushSingleCallData</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01119">1119</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d5/ppc_2flushtb_8c-source.html#l00188">KeFlushSingleTb()</a>, and <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a72" doxytag="ki.h::KiFreezeExecutionLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d0/d0/ki_8h.html#a72">KiFreezeExecutionLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01145">1145</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a82" doxytag="ki.h::KiFreezeFlag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d0/ki_8h.html#a82">KiFreezeFlag</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01234">1234</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00303">KdEnterDebugger()</a>, <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00055">KeFreezeExecution()</a>, and <a class="el" href="../../d0/d4/ke_2debug_8c-source.html#l00391">KeThawExecution()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a81" doxytag="ki.h::KiFreezeLockBackup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d0/d0/ki_8h.html#a81">KiFreezeLockBackup</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01233">1233</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="ki.h::KiHardwareTrigger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG_PTR <a class="el" href="../../d0/d0/ki_8h.html#a47">KiHardwareTrigger</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01120">1120</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="ki.h::KiIdleSummary" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KAFFINITY <a class="el" href="../../d0/d0/ki_8h.html#a48">KiIdleSummary</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01121">1121</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>, and <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00479">KiSelectNextThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="ki.h::KiMaximumDpcQueueDepth" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d0/ki_8h.html#a37">KiMaximumDpcQueueDepth</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01110">1110</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="ki.h::KiMinimumDpcRate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d0/ki_8h.html#a38">KiMinimumDpcRate</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01111">1111</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a51" doxytag="ki.h::KiProcessInSwapListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d0/d0/ki_8h.html#a51">KiProcessInSwapListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01124">1124</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00322">KeSwapProcessOrStack()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00955">KiAttachProcess()</a>, <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00483">KiInSwapProcesses()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00644">KiOutSwapProcesses()</a>, and <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="ki.h::KiProcessOutSwapListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d0/d0/ki_8h.html#a52">KiProcessOutSwapListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01125">1125</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/procobj_8c-source.html#l00405">KeDetachProcess()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00322">KeSwapProcessOrStack()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01996">KeTerminateThread()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00512">KeUnstackDetachProcess()</a>, <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00544">KiOutSwapKernelStacks()</a>, and <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00644">KiOutSwapProcesses()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a55" doxytag="ki.h::KiProfileAlignmentFixup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d0/d0/ki_8h.html#a55">KiProfileAlignmentFixup</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01128">1128</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d7/profobj_8c-source.html#l00289">KeStartProfile()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00520">KeStopProfile()</a>, and <a class="el" href="../../d5/d4/alpha_2alignem_8c-source.html#l00160">KiEmulateReference()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a57" doxytag="ki.h::KiProfileAlignmentFixupCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d0/ki_8h.html#a57">KiProfileAlignmentFixupCount</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01130">1130</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/alpha_2alignem_8c-source.html#l00160">KiEmulateReference()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a56" doxytag="ki.h::KiProfileAlignmentFixupInterval" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d0/ki_8h.html#a56">KiProfileAlignmentFixupInterval</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01129">1129</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d7/profobj_8c-source.html#l00163">KeQueryIntervalProfile()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00223">KeSetIntervalProfile()</a>, and <a class="el" href="../../d5/d4/alpha_2alignem_8c-source.html#l00160">KiEmulateReference()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a58" doxytag="ki.h::KiProfileInterval" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d0/ki_8h.html#a58">KiProfileInterval</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01131">1131</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d7/profobj_8c-source.html#l00163">KeQueryIntervalProfile()</a>, and <a class="el" href="../../d1/d7/profobj_8c-source.html#l00223">KeSetIntervalProfile()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a59" doxytag="ki.h::KiProfileListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d0/d0/ki_8h.html#a59">KiProfileListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01132">1132</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/clock_8c-source.html#l00401">KeProfileInterruptWithSource()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00289">KeStartProfile()</a>, and <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a60" doxytag="ki.h::KiProfileLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d0/d0/ki_8h.html#a60">KiProfileLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01133">1133</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a54" doxytag="ki.h::KiProfileSourceListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d0/d0/ki_8h.html#a54">KiProfileSourceListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01127">1127</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d7/profobj_8c-source.html#l00289">KeStartProfile()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00520">KeStopProfile()</a>, and <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="ki.h::KiQuantumEnd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> KiQuantumEnd(VOID)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a61" doxytag="ki.h::KiReadySummary" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d0/ki_8h.html#a61">KiReadySummary</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01134">1134</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01302">KeSetAffinityThread()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00095">KiFindReadyThread()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00732">KiScanReadyQueues()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00576">KiSetPriorityThread()</a>, and <a class="el" href="../../d7/d0/yield_8c-source.html#l00029">NtYieldExecution()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a63" doxytag="ki.h::KiServiceLimit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d0/ki_8h.html#a63">KiServiceLimit</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01136">1136</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a64" doxytag="ki.h::KiServiceTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG_PTR <a class="el" href="../../d0/d0/ki_8h.html#a64">KiServiceTable</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01137">1137</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a65" doxytag="ki.h::KiSetEventCallData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html">CALL_PERFORMANCE_DATA</a> <a class="el" href="../../d0/d0/ki_8h.html#a65">KiSetEventCallData</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01138">1138</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, and <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a73" doxytag="ki.h::KiSlavesStartExecution" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d0/d0/ki_8h.html#a73">KiSlavesStartExecution</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01146">1146</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a53" doxytag="ki.h::KiStackInSwapListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d0/d0/ki_8h.html#a53">KiStackInSwapListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01126">1126</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00322">KeSwapProcessOrStack()</a>, <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00431">KiInSwapKernelStacks()</a>, and <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a83" doxytag="ki.h::KiSuspendState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> volatile ULONG <a class="el" href="../../d0/d0/ki_8h.html#a83">KiSuspendState</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01235">1235</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a74" doxytag="ki.h::KiSwapContextNotifyRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d9/ke_8h.html#a120">PSWAP_CONTEXT_NOTIFY_ROUTINE</a> <a class="el" href="../../d0/d0/ki_8h.html#a74">KiSwapContextNotifyRoutine</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01147">1147</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00909">KeSetSwapContextNotifyRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a50" doxytag="ki.h::KiSwapEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d6/struct__KEVENT.html">KEVENT</a> <a class="el" href="../../d0/d0/ki_8h.html#a50">KiSwapEvent</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01123">1123</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00142">KeBalanceSetManager()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00405">KeDetachProcess()</a>, <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00322">KeSwapProcessOrStack()</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01996">KeTerminateThread()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00512">KeUnstackDetachProcess()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00955">KiAttachProcess()</a>, <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>, and <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00270">KiReadyThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a75" doxytag="ki.h::KiThreadSelectNotifyRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d9/ke_8h.html#a121">PTHREAD_SELECT_NOTIFY_ROUTINE</a> <a class="el" href="../../d0/d0/ki_8h.html#a75">KiThreadSelectNotifyRoutine</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01148">1148</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00940">KeSetThreadSelectNotifyRoutine()</a>, and <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00095">KiFindReadyThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a66" doxytag="ki.h::KiTickOffset" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d0/ki_8h.html#a66">KiTickOffset</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01139">1139</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00779">KeSetTimeIncrement()</a>, <a class="el" href="../../d2/d8/clock_8c-source.html#l00122">KeUpdateSystemTime()</a>, and <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00592">KiCalibrateTimeAdjustment()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a67" doxytag="ki.h::KiTimeIncrementReciprocal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER <a class="el" href="../../d0/d0/ki_8h.html#a67">KiTimeIncrementReciprocal</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01140">1140</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a68" doxytag="ki.h::KiTimeIncrementShiftCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CCHAR <a class="el" href="../../d0/d0/ki_8h.html#a68">KiTimeIncrementShiftCount</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01141">1141</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00065">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a70" doxytag="ki.h::KiTimeProcessor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KAFFINITY <a class="el" href="../../d0/d0/ki_8h.html#a70">KiTimeProcessor</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01143">1143</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a71" doxytag="ki.h::KiTimerExpireDpc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d6/struct__KDPC.html">KDPC</a> <a class="el" href="../../d0/d0/ki_8h.html#a71">KiTimerExpireDpc</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01144">1144</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00592">KiCalibrateTimeAdjustment()</a>, <a class="el" href="../../d2/d8/clock_8c-source.html#l00038">KiChkTimerExpireSysDpc()</a>, and <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a69" doxytag="ki.h::KiTimerTableListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d0/d0/ki_8h.html#a69">KiTimerTableListHead</a>[TIMER_TABLE_SIZE]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01142">1142</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00467">KeCheckForTimer()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00335">KeSetSystemTime()</a>, <a class="el" href="../../d2/d8/clock_8c-source.html#l00038">KiChkTimerExpireSysDpc()</a>, <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>, <a class="el" href="../../d6/d1/timersup_8c-source.html#l00185">KiInsertTimerTable()</a>, <a class="el" href="../../d6/d0/dpcsup_8c-source.html#l00217">KiTimerExpiration()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l03020">VerifierKeInitializeTimerEx()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a76" doxytag="ki.h::KiTimeUpdateNotifyRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d9/ke_8h.html#a122">PTIME_UPDATE_NOTIFY_ROUTINE</a> <a class="el" href="../../d0/d0/ki_8h.html#a76">KiTimeUpdateNotifyRoutine</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01149">1149</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00972">KeSetTimeUpdateNotifyRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a77" doxytag="ki.h::KiWaitInListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d0/d0/ki_8h.html#a77">KiWaitInListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01150">1150</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>, and <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00544">KiOutSwapKernelStacks()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a78" doxytag="ki.h::KiWaitOutListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d0/d0/ki_8h.html#a78">KiWaitOutListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01151">1151</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>, and <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00544">KiOutSwapKernelStacks()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a79" doxytag="ki.h::KiWaitSingleCallData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d6/struct__CALL__PERFORMANCE__DATA.html">CALL_PERFORMANCE_DATA</a> <a class="el" href="../../d0/d0/ki_8h.html#a79">KiWaitSingleCallData</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/ki_8h-source.html#l01152">1152</a> of file <a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, and <a class="el" href="../../d3/d9/kiinit_8c-source.html#l00096">KiInitSystem()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:29 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
