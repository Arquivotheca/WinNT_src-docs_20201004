<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: miscutil.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>miscutil.c</h1><a href="../../d9/d0/miscutil_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************************************************************\</span>
00002 <span class="comment">* Module Name: minmax.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* Misc util functions</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* 10-25-90 MikeHar      Ported from Windows.</span>
00009 <span class="comment">* 14-Feb-1991 mikeke    Added Revalidation code (None)</span>
00010 <span class="comment">\****************************************************************************/</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="../../d0/d4/w32_2ntuser_2kernel_2precomp_8h.html">precomp.h</a>"</span>
00013 <span class="preprocessor">#pragma hdrstop</span>
00014 <span class="preprocessor"></span>
00015 
<a name="l00016"></a><a class="code" href="../../d4/d1/userk_8h.html#a1745">00016</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d1/userk_8h.html#a1745">ZapActiveAndFocus</a>(VOID)
00017 {
00018    <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq;
00019 
00020    <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>);
00021    <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o7">spwndFocus</a>);
00022 }
00023 
<a name="l00024"></a><a class="code" href="../../d4/d1/userk_8h.html#a1744">00024</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d1/userk_8h.html#a1744">SetDialogPointer</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, LONG_PTR lPtr) {
00025 
00026     <span class="keywordflow">if</span> ((pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o10">cbwndExtra</a> &lt; DLGWINDOWEXTRA)
00027             || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a569">WFSERVERSIDEPROC</a>)
00028             || (<a class="code" href="../../d4/d1/userk_8h.html#a16">PpiCurrent</a>() != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;ppi)) {
00029         RIPMSG1(RIP_WARNING, <span class="stringliteral">"SetDialogPointer: Unexpected pwnd:%#p"</span>, pwnd);
00030         <span class="keywordflow">return</span>;
00031     }
00032 
00033     ((<a class="code" href="../../d4/d5/struct__DIALOG.html">PDIALOG</a>)pwnd)-&gt;pdlg = (<a class="code" href="../../d2/d6/struct__DLG.html">PDLG</a>)lPtr;
00034 
00035     <span class="keywordflow">if</span> (lPtr == 0) {
00036         pwnd-&gt;fnid |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a226">FNID_CLEANEDUP_BIT</a>;
00037         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a567">WFDIALOGWINDOW</a>);
00038     } <span class="keywordflow">else</span> {
00039         <span class="keywordflow">if</span> (pwnd-&gt;fnid == 0) {
00040             pwnd-&gt;fnid = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a203">FNID_DIALOG</a>;
00041         }
00042         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a567">WFDIALOGWINDOW</a>);
00043     }
00044 
00045 
00046 }
00047 
<a name="l00048"></a><a class="code" href="../../d4/d1/userk_8h.html#a1747">00048</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1747">_SetProgmanWindow</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd) {
00049 
00050     <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">PDESKTOPINFO</a> pdeskinfo = <a class="code" href="../../d4/d1/userk_8h.html#a256">GETDESKINFO</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>());
00051 
00052     <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00053         <span class="comment">// Fail the call if another shell window exists</span>
00054         <span class="keywordflow">if</span> (pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o9">spwndProgman</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00055             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00056     }
00057 
00058     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o9">spwndProgman</a>, pwnd);
00059 
00060     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00061 }
00062 
<a name="l00063"></a><a class="code" href="../../d4/d1/userk_8h.html#a1748">00063</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1748">_SetTaskmanWindow</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd) {
00064 
00065     <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">PDESKTOPINFO</a> pdeskinfo = <a class="code" href="../../d4/d1/userk_8h.html#a256">GETDESKINFO</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>());
00066 
00067     <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00068         <span class="comment">// Fail the call if another shell window exists</span>
00069         <span class="keywordflow">if</span> (pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o8">spwndTaskman</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00070             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00071     }
00072 
00073     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o8">spwndTaskman</a>, pwnd);
00074 
00075     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00076 }
00077 
00078 <span class="comment">/***************************************************************************\</span>
00079 <span class="comment">*</span>
00080 <span class="comment">*  SetShellWindow()</span>
00081 <span class="comment">*</span>
00082 <span class="comment">*  Returns true if shell window is successfully set.  Note that we return</span>
00083 <span class="comment">*  FALSE if a shell window already exists.  I.E., this works on a first</span>
00084 <span class="comment">*  come, first serve basis.</span>
00085 <span class="comment">*</span>
00086 <span class="comment">*  We also do NOT allow child windows to be shell windows.  Other than that,</span>
00087 <span class="comment">*  it's up to the caller to size her window appropriately.</span>
00088 <span class="comment">*</span>
00089 <span class="comment">*  The pwndBkGnd is provided for the explorer shell.  Since the shellwnd</span>
00090 <span class="comment">*  and the window which does the drawing of background wallpapers are</span>
00091 <span class="comment">*  different, we need to provide means by which we can draw directly on</span>
00092 <span class="comment">*  the background window during hung-app drawing.  The pwnd and pwndBkGnd</span>
00093 <span class="comment">*  will be identical if called through the SetShellWindow() api.</span>
00094 <span class="comment">*</span>
00095 <span class="comment">*</span>
00096 <span class="comment">\***************************************************************************/</span>
<a name="l00097"></a><a class="code" href="../../d4/d1/userk_8h.html#a1746">00097</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1746">xxxSetShellWindow</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndBkGnd)
00098 {
00099     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>  ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00100     <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">PDESKTOPINFO</a> pdeskinfo = <a class="code" href="../../d4/d1/userk_8h.html#a256">GETDESKINFO</a>(ptiCurrent);
00101 
00102     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a> ppiShellProcess;
00103 
00104     UserAssert(pwnd);
00105 
00106     <span class="comment">/*</span>
00107 <span class="comment">     * Fail the call if another shell window exists</span>
00108 <span class="comment">     */</span>
00109     <span class="keywordflow">if</span> (pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o5">spwndShell</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00110         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00111 
00112     <span class="comment">/*</span>
00113 <span class="comment">     * The shell window must be</span>
00114 <span class="comment">     *      (1) Top-level</span>
00115 <span class="comment">     *      (2) Unowned</span>
00116 <span class="comment">     *      (3) Not topmost</span>
00117 <span class="comment">     */</span>
00118     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)             ||
00119             (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00120             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a615">WEFTOPMOST</a>)) {
00121 
00122         RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxSetShellWindow: Invalid type of window"</span>);
00123         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00124     }
00125 
00126     <span class="comment">/*</span>
00127 <span class="comment">     * Chicago has a totally different input model which has special code</span>
00128 <span class="comment">     * that checks for Ctrl-Esc and sends it to the shell.  We can get</span>
00129 <span class="comment">     * the same functionality, without totally re-writing our input model</span>
00130 <span class="comment">     * by just automatically installing the Ctrl-Esc as a hotkey for the</span>
00131 <span class="comment">     * shell window.  The hotkey delivery code has a special case which</span>
00132 <span class="comment">     * turns this into a WM_SYSCOMMAND message instead of a WM_HOTKEY</span>
00133 <span class="comment">     * message.</span>
00134 <span class="comment">     *</span>
00135 <span class="comment">     * We don't both checking for failure.  Somebody could already have</span>
00136 <span class="comment">     * a Ctrl-Esc handler installed.</span>
00137 <span class="comment">     */</span>
00138     <a class="code" href="../../d4/d1/userk_8h.html#a1660">_RegisterHotKey</a>(pwnd,SC_TASKLIST,MOD_CONTROL,VK_ESCAPE);
00139 
00140     <span class="comment">/*</span>
00141 <span class="comment">     * This is the shell window wright.</span>
00142 <span class="comment">     * So get the process id for the shell.</span>
00143 <span class="comment">     */</span>
00144     ppiShellProcess = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;ppi;
00145 
00146     <span class="comment">/*</span>
00147 <span class="comment">     * Set the shell process id to the desktop only if it's the first instance</span>
00148 <span class="comment">     */</span>
00149     <span class="keywordflow">if</span> ((ppiShellProcess != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o6">ppiShellProcess</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00150         pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o6">ppiShellProcess</a> = ppiShellProcess;
00151     }
00152 
00153     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o5">spwndShell</a>, pwnd);
00154     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o7">spwndBkGnd</a>, pwndBkGnd);
00155 
00156     <span class="comment">/*</span>
00157 <span class="comment">     * Push window to bottom of stack.</span>
00158 <span class="comment">     */</span>
00159     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o5">spwndShell</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a589">WFBOTTOMMOST</a>);
00160     <a class="code" href="../../d4/d1/userk_8h.html#a1615">xxxSetWindowPos</a>(pdeskinfo-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o5">spwndShell</a>,
00161                     <a class="code" href="../../d4/d1/userk_8h.html#a453">PWND_BOTTOM</a>,
00162                     0,
00163                     0,
00164                     0,
00165                     0,
00166                     SWP_NOMOVE | SWP_NOSIZE | SWP_NOACTIVATE);
00167 
00168     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00169 }
00170 
00171 
00172 
00173 
00174 <span class="comment">/***************************************************************************\</span>
00175 <span class="comment">* _InitPwSB()</span>
00176 <span class="comment">*</span>
00177 <span class="comment">* History:</span>
00178 <span class="comment">* 10-23-90 MikeHar Ported from WaWaWaWindows.</span>
00179 <span class="comment">* 11-28-90 JimA    Changed to int *</span>
00180 <span class="comment">* 01-21-91 IanJa   Prefix '_' denoting exported function (although not API)</span>
00181 <span class="comment">\***************************************************************************/</span>
00182 
<a name="l00183"></a><a class="code" href="../../d4/d1/userk_8h.html#a1566">00183</a> <a class="code" href="../../d5/d5/structtagSBINFO.html">PSBINFO</a> <a class="code" href="../../d4/d1/userk_8h.html#a1566">_InitPwSB</a>(
00184     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00185 {
00186     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a>) {
00187 
00188         <span class="comment">/*</span>
00189 <span class="comment">         * If memory is already allocated, don't bother to do it again.</span>
00190 <span class="comment">         */</span>
00191         <span class="keywordflow">return</span> pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a>;
00192     }
00193 
00194     pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a> = (<a class="code" href="../../d5/d5/structtagSBINFO.html">PSBINFO</a>)<a class="code" href="../../d4/d1/userk_8h.html#a1020">DesktopAlloc</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk,
00195                                           <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d5/structtagSBINFO.html">SBINFO</a>),
00196                                           <a class="code" href="../../d4/d1/userk_8h.html#a307">DTAG_SBINFO</a>);
00197 
00198     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00199 
00200         <span class="comment">/*</span>
00201 <span class="comment">         *  rgw[0] = 0;  */</span>  <span class="comment">/* LPTR zeros all 6 words</span>
00202 <span class="comment">         */</span>
00203 
00204         <span class="comment">/*</span>
00205 <span class="comment">         *  rgw[1] = 0;</span>
00206 <span class="comment">         */</span>
00207 
00208         <span class="comment">/*</span>
00209 <span class="comment">         *  rgw[3] = 0;</span>
00210 <span class="comment">         */</span>
00211 
00212         <span class="comment">/*</span>
00213 <span class="comment">         *  rgw[4] = 0;</span>
00214 <span class="comment">         */</span>
00215         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a>-&gt;<a class="code" href="../../d5/d5/structtagSBINFO.html#o2">Vert</a>.<a class="code" href="../../d4/d5/structtagSBDATA.html#o1">posMax</a> = 100;
00216         pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a>-&gt;<a class="code" href="../../d5/d5/structtagSBINFO.html#o1">Horz</a>.<a class="code" href="../../d4/d5/structtagSBDATA.html#o1">posMax</a> = 100;
00217     }
00218 
00219     <span class="keywordflow">return</span> pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a>;
00220 }
00221 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
