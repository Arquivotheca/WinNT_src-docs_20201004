<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: poolhack.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>poolhack.c File Reference</h1><code>#include "<a class="el" href="../../d5/d9/exp_8h-source.html">exp.h</a>"</code><br>
<code>#include "<a class="el" href="../../d5/d7/mi_8h-source.html">..\mm\mi.h</a>"</code><br>

<p>
<a href="../../d6/d1/poolhack_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/struct__POOL__LIST__HEAD.html">_POOL_LIST_HEAD</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">_POOL_DESCRIPTOR</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d8/struct__POOL__HEADER.html">_POOL_HEADER</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a0">POOL_PAGE_SIZE</a>&nbsp;&nbsp;&nbsp;0x1000</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a1">POOL_LOG_PAGE</a>&nbsp;&nbsp;&nbsp;12</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a2">POOL_LIST_HEADS</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a3">POOL_LOG_MIN</a>&nbsp;&nbsp;&nbsp;(POOL_LOG_PAGE - POOL_LIST_HEADS + 1)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a4">POOL_MIN_ROUND</a>&nbsp;&nbsp;&nbsp;( (1&lt;&lt;POOL_LOG_MIN) - 1 )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a5">PAGE_ALIGNED</a>(p)&nbsp;&nbsp;&nbsp;(!(((ULONG)p) &amp; (POOL_PAGE_SIZE - 1)))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>&nbsp;&nbsp;&nbsp;sizeof(<a class="el" href="../../d5/d8/struct__POOL__HEADER.html">POOL_HEADER</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a7">POOL_BUDDY_MAX</a>&nbsp;&nbsp;&nbsp;(POOL_PAGE_SIZE - POOL_OVERHEAD)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a8">LOCK_POOL</a>(Lock, PoolType, LockHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a9">UNLOCK_POOL</a>(Lock, PoolType, LockHandle, Wait)</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d9/struct__POOL__LIST__HEAD.html">_POOL_LIST_HEAD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a11">POOL_LIST_HEAD</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d9/struct__POOL__LIST__HEAD.html">POOL_LIST_HEAD</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a12">PPOOL_LIST_HEAD</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">_POOL_DESCRIPTOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a13">POOL_DESCRIPTOR</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">POOL_DESCRIPTOR</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a14">PPOOL_DESCRIPTOR</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d8/struct__POOL__HEADER.html">_POOL_HEADER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a15">POOL_HEADER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d8/struct__POOL__HEADER.html">POOL_HEADER</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a16">PPOOL_HEADER</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a26">AllocatePoolInternal</a> (IN <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a> PoolDesc, IN LONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a27">DeallocatePoolInternal</a> (IN <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a> PoolDesc, IN <a class="el" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a> Entry)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PLIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a28">ExpInterlockedTryAllocatePool</a> (IN PLIST_ENTRY List, IN KSPIN_LOCK Lock, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN LONG SizeOffset)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KIRQL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a29">ExLockPool</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a30">ExUnlockPool</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN KIRQL LockHandle, IN BOOLEAN Wait)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a31">InitializePool</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN ULONG Threshold)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a32">ExAllocatePool</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN ULONG NumberOfBytes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a33">ExpAllocatePoolWithQuotaHandler</a> (IN NTSTATUS ExceptionCode, IN PVOID PoolAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a34">ExAllocatePoolWithQuota</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN ULONG NumberOfBytes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a35">ExFreePool</a> (IN PVOID P)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a36">DumpPool</a> (IN PSZ s, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> pt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a37">CheckPool</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a38">DumpAllocatedPool</a> (IN ULONG DumpOrFlush)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a39">ExQueryPoolUsage</a> (OUT PULONG PagedPoolPages, OUT PULONG NonPagedPoolPages)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d1/bench_8h.html#a8">CHAR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a10">PoolIndexTable</a> [128]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">POOL_DESCRIPTOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a17">NonPagedPoolDescriptor</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">POOL_DESCRIPTOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a18">PagedPoolDescriptor</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">POOL_DESCRIPTOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a19">NonPagedPoolDescriptorMS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">POOL_DESCRIPTOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a20">PagedPoolDescriptorMS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a21">NonPagedPoolLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d7/struct__KMUTANT.html">KMUTEX</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a22">PagedPoolLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a23">PoolVector</a> [MaxPoolType]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a24">BasePoolTypeTable</a> [MaxPoolType]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/poolhack_8c.html#a25">MustSucceedPoolTable</a> [MaxPoolType]</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a8" doxytag="poolhack.c::LOCK_POOL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LOCK_POOL          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Lock,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PoolType,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LockHandle&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                                                                         \
        <span class="keywordflow">if</span> ( (PoolType) == (<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>) || (PoolType) == <a class="code" href="../../d5/d8/ex_8h.html#a329a175">NonPagedPoolMustSucceed</a> ) {                                 \
            <a class="code" href="../../d4/d9/ke_8h.html#a37">KeAcquireSpinLock</a>((PKSPIN_LOCK)Lock,&amp;LockHandle);                 \
        } <span class="keywordflow">else</span> {                                                              \
            <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(APC_LEVEL,&amp;LockHandle);                               \
            <a class="code" href="../../d6/d3/cmwraper_8c.html#a20">KeWaitForSingleObject</a>(                                            \
                Lock,                                                         \
                PoolAllocation,                                               \
                KernelMode,                                                   \
                FALSE,                                                        \
                NULL                                                          \
                );                                                            \
        }                                                                     \
    }
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00173">173</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="poolhack.c::PAGE_ALIGNED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PAGE_ALIGNED          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">p&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(!(((ULONG)p) &amp; (POOL_PAGE_SIZE - 1)))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00071">71</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00694">ExAllocatePoolWithQuota()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02607">ExAllocatePoolWithQuotaTag()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l03892">ExFreePoolSanityChecks()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02760">ExFreePoolWithTag()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l03328">ExQueryPoolBlockSize()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01976">VerifierFreeTrackedPool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="poolhack.c::POOL_BUDDY_MAX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POOL_BUDDY_MAX&nbsp;&nbsp;&nbsp;(POOL_PAGE_SIZE - POOL_OVERHEAD)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00117">117</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l01104">ExAllocatePoolWithTag()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00993">ExAllocatePoolWithTagPriority()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l05852">MmCreateMdl()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01614">ViPostPoolAllocation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="poolhack.c::POOL_LIST_HEADS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POOL_LIST_HEADS&nbsp;&nbsp;&nbsp;8          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00068">68</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00786">AllocatePoolInternal()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01400">CheckPool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01351">DumpPool()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l01104">ExAllocatePoolWithTag()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00609">ExpInitializePoolDescriptor()</a>, and <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00325">InitializePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="poolhack.c::POOL_LOG_MIN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POOL_LOG_MIN&nbsp;&nbsp;&nbsp;(POOL_LOG_PAGE - POOL_LIST_HEADS + 1)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00069">69</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00786">AllocatePoolInternal()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01400">CheckPool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01177">DeallocatePoolInternal()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01351">DumpPool()</a>, and <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="poolhack.c::POOL_LOG_PAGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POOL_LOG_PAGE&nbsp;&nbsp;&nbsp;12          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00067">67</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="poolhack.c::POOL_MIN_ROUND" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POOL_MIN_ROUND&nbsp;&nbsp;&nbsp;( (1&lt;&lt;POOL_LOG_MIN) - 1 )          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00070">70</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="poolhack.c::POOL_OVERHEAD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POOL_OVERHEAD&nbsp;&nbsp;&nbsp;sizeof(<a class="el" href="../../d5/d8/struct__POOL__HEADER.html">POOL_HEADER</a>)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00116">116</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00786">AllocatePoolInternal()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01400">CheckPool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01177">DeallocatePoolInternal()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01351">DumpPool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00694">ExAllocatePoolWithQuota()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02607">ExAllocatePoolWithQuotaTag()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l01104">ExAllocatePoolWithTag()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l03892">ExFreePoolSanityChecks()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02760">ExFreePoolWithTag()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l03328">ExQueryPoolBlockSize()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l03480">ExReturnPoolQuota()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00677">InitializePool()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l03472">MiAllocateSpecialPool()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l03742">MmFreeSpecialPool()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l02927">MmQuerySpecialPoolBlockSize()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l01976">VerifierFreeTrackedPool()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01614">ViPostPoolAllocation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="poolhack.c::POOL_PAGE_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define POOL_PAGE_SIZE&nbsp;&nbsp;&nbsp;0x1000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00066">66</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01400">CheckPool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01177">DeallocatePoolInternal()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01351">DumpPool()</a>, and <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00677">InitializePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="poolhack.c::UNLOCK_POOL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UNLOCK_POOL          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Lock,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PoolType,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LockHandle,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Wait&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                                                                       \
        <span class="keywordflow">if</span> ( PoolType == <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a> || (PoolType) == <a class="code" href="../../d5/d8/ex_8h.html#a329a175">NonPagedPoolMustSucceed</a> ) {                                   \
            <a class="code" href="../../d4/d9/ke_8h.html#a359">KeReleaseSpinLock</a>(                                              \
                Lock,                                                       \
                (KIRQL)LockHandle                                           \
                );                                                          \
        } <span class="keywordflow">else</span> {                                                            \
            <a class="code" href="../../d6/d3/cmwraper_8c.html#a19">KeReleaseMutex</a>((<a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTEX</a>)Lock,Wait);                             \
            <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(LockHandle);                                        \
        }                                                                   \
    }
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00248">248</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a13" doxytag="poolhack.c::POOL_DESCRIPTOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">_POOL_DESCRIPTOR</a>  <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">POOL_DESCRIPTOR</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="poolhack.c::POOL_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d8/struct__POOL__HEADER.html">_POOL_HEADER</a>  <a class="el" href="../../d5/d8/struct__POOL__HEADER.html">POOL_HEADER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00677">InitializePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="poolhack.c::POOL_LIST_HEAD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d9/struct__POOL__LIST__HEAD.html">_POOL_LIST_HEAD</a>  <a class="el" href="../../d0/d9/struct__POOL__LIST__HEAD.html">POOL_LIST_HEAD</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="poolhack.c::PPOOL_DESCRIPTOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">POOL_DESCRIPTOR</a>* <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00102">102</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01400">CheckPool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01467">DumpAllocatedPool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01351">DumpPool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01493">ExQueryPoolUsage()</a>, and <a class="el" href="../../d2/d5/allocpag_8c-source.html#l04222">MiInitializeSessionPool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="poolhack.c::PPOOL_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d5/d8/struct__POOL__HEADER.html">POOL_HEADER</a>* <a class="el" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00114">114</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00786">AllocatePoolInternal()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01400">CheckPool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01177">DeallocatePoolInternal()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01351">DumpPool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00694">ExAllocatePoolWithQuota()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l01104">ExAllocatePoolWithTag()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, and <a class="el" href="../../d2/d5/allocpag_8c-source.html#l02927">MmQuerySpecialPoolBlockSize()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="poolhack.c::PPOOL_LIST_HEAD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d0/d9/struct__POOL__LIST__HEAD.html">POOL_LIST_HEAD</a>* <a class="el" href="../../d0/d9/struct__POOL__LIST__HEAD.html">PPOOL_LIST_HEAD</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00093">93</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00786">AllocatePoolInternal()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01400">CheckPool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01467">DumpAllocatedPool()</a>, and <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01351">DumpPool()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a26" doxytag="poolhack.c::AllocatePoolInternal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a> AllocatePoolInternal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolDesc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Index</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00786">786</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00133">BasePoolTypeTable</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00091">_POOL_LIST_HEAD::ListHead</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00105">_POOL_HEADER::LogAllocationSize</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00807">MiAllocatePoolPages()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00140">MustSucceedPoolTable</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00068">POOL_LIST_HEADS</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00069">POOL_LOG_MIN</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00116">POOL_OVERHEAD</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00106">_POOL_HEADER::PoolType</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00114">PPOOL_HEADER</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00093">PPOOL_LIST_HEAD</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00112">_POOL_HEADER::ProcessBilled</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>.
<p>
<pre class="fragment"><div>00793                    :
00794 
00795     This function implements <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> guts of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> binary buddy <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
00796     allocator.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a recursive function.  It assumes that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller
00797     (<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>) chose <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> correct <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> descriptor, and that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00798     allocation should be satisfied from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> binary buddy allocator.
00799 
00800     The binary buddy allocator calculates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> smallest block size that
00801     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a power of two and that can be used to satisfy <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request.  If
00802     there are no blocks available of <span class="keyword">this</span> size, then a block of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next
00803     larger block size <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allocated and split in half.  One piece <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00804     placed back into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> other piece <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to satisfy
00805     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocator reaches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> paged sized block list,
00806     and nothing <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> there, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page aligned <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocator <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called.
00807     The page <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> added to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> binary buddy <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>...
00808 
00809 Arguments:
00810 
00811     PoolDesc - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> descriptor to use to
00812                satisfy <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request.
00813 
00814     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> descriptor list head array
00815             that should satisfy an allocation.
00816 
00817 Return Value:
00818 
00819     Non-Null - Returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocated <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> header.  Before
00820                <span class="keyword">this</span> can be returned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller of <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a> or
00821                <a class="code" href="../../d5/d5/cc_8h.html#a11">ExAllocatePoolWithQuota</a>, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value must be adjusted
00822                (incremented) to account <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> 64bit binary buddy <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
00823                overhead.
00824 
00825 --*/
00826 
00827 {
00828     LONG Log2N,ShiftedN;
00829     <a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a> Entry,Buddy;
00830     <a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html">PPOOL_LIST_HEAD</a> PoolListHead;
00831 
00832 <span class="preprocessor">#if defined(TRACE_ALLOC) || defined (DEADBEEF)</span>
00833 <span class="preprocessor"></span>    PULONG BadFood;
00834 <span class="preprocessor">#endif // TRACE_ALLOC</span>
00835 <span class="preprocessor"></span>
00836     Log2N = <a class="code" href="../../d5/d2/poolhack_8c.html#a3">POOL_LOG_MIN</a> + <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00837     ShiftedN = 1 &lt;&lt; Log2N;
00838 
00839     PoolListHead = &amp;PoolDesc-&gt;ListHeads[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00840 
00841     <span class="comment">//</span>
00842     <span class="comment">// this is the correct list head.  See if anything is on the</span>
00843     <span class="comment">// list if so, delink and mark as allocated.  Otherwise,</span>
00844     <span class="comment">// recurse and split.</span>
00845     <span class="comment">//</span>
00846 
00847     <span class="keywordflow">if</span> ( !IsListEmpty(&amp;PoolListHead-&gt;<a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html#o2">ListHead</a>) ) {
00848 
00849         <span class="comment">//</span>
00850         <span class="comment">// list has an entry, so grab it</span>
00851         <span class="comment">//</span>
00852 
00853         Entry = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)RemoveHeadList(
00854                                 &amp;PoolListHead-&gt;<a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html#o2">ListHead</a>);
00855 
00856 <span class="preprocessor">#if defined(TRACE_ALLOC) || defined (DEADBEEF)</span>
00857 <span class="preprocessor"></span>        BadFood = (PULONG)Entry;
00858         *BadFood = 0xBAADF00D;
00859         *(BadFood+1) = 0xBAADF00D;
00860 <span class="preprocessor">#endif // TRACE_ALLOC</span>
00861 <span class="preprocessor"></span>
00862         Entry = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>) ((PCH)Entry - <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
00863 
00864         <span class="comment">//</span>
00865         <span class="comment">// allocated entries have a size field set and pool type set</span>
00866         <span class="comment">//</span>
00867 
00868         Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Log2N;
00869         Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o1">PoolType</a> = PoolDesc-&gt;PoolType;
00870         Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o2">ProcessBilled</a> = (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00871 
00872         <span class="keywordflow">return</span> (PVOID)Entry;
00873 
00874     } <span class="keywordflow">else</span> {
00875 
00876         <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> != (<a class="code" href="../../d5/d2/poolhack_8c.html#a2">POOL_LIST_HEADS</a> - 1) ) {
00877 
00878             <span class="comment">//</span>
00879             <span class="comment">// This is the right list head, but since it is empty</span>
00880             <span class="comment">// must recurse.  Allocate from the next highest entry.</span>
00881             <span class="comment">// The resulting entry is then split in half.  One half</span>
00882             <span class="comment">// is marked as free and added to the list.  The other</span>
00883             <span class="comment">// half is returned</span>
00884             <span class="comment">//</span>
00885 
00886             Entry = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)<a class="code" href="../../d5/d2/poolhack_8c.html#a26">AllocatePoolInternal</a>(PoolDesc,Index+1);
00887 
00888             <span class="keywordflow">if</span> ( !Entry ) {
00889                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00890             }
00891 
00892 <span class="preprocessor">#if defined(TRACE_ALLOC) || defined (DEADBEEF)</span>
00893 <span class="preprocessor"></span>            BadFood = (PULONG)((PCH)Entry + <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
00894             *BadFood = 0xBAADF00D;
00895             *(BadFood+1) = 0xBAADF00D;
00896 <span class="preprocessor">#endif // TRACE_ALLOC</span>
00897 <span class="preprocessor"></span>
00898             Buddy = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)((PCH)Entry + ShiftedN);
00899 
00900             <span class="comment">//</span>
00901             <span class="comment">// mark buddy as free and entry as allocated</span>
00902             <span class="comment">//</span>
00903 
00904             Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) Log2N;
00905             Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o1">PoolType</a> = PoolDesc-&gt;PoolType;
00906             Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o2">ProcessBilled</a> = (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00907 
00908             Buddy-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a> = 0;
00909             Buddy-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o1">PoolType</a> = <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00910             Buddy-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o2">ProcessBilled</a> = (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00911 
00912             InsertTailList(
00913                &amp;PoolListHead-&gt;<a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html#o2">ListHead</a>,
00914                (PLIST_ENTRY)(((PCH)Buddy + POOL_OVERHEAD))
00915                );
00916 
00917             <span class="keywordflow">return</span> (PVOID)Entry;
00918 
00919         } <span class="keywordflow">else</span> {
00920 
00921             <span class="comment">//</span>
00922             <span class="comment">// Need to call page allocator for a page to add to the pool</span>
00923             <span class="comment">//</span>
00924 
00925             Entry = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)<a class="code" href="../../d1/d6/allocpag_8c.html#a54">MiAllocatePoolPages</a> (
00926                                             BasePoolTypeTable[PoolDesc-&gt;PoolType],
00927                                             PAGE_SIZE
00928                                             );
00929 
00930             <span class="keywordflow">if</span> ( !Entry ) {
00931                 <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d2/poolhack_8c.html#a25">MustSucceedPoolTable</a>[PoolDesc-&gt;PoolType] ) {
00932                     Entry = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)<a class="code" href="../../d1/d6/allocpag_8c.html#a54">MiAllocatePoolPages</a> (
00933                                             PoolDesc-&gt;PoolType,
00934                                             PAGE_SIZE
00935                                             );
00936                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Entry);
00937                 } <span class="keywordflow">else</span> {
00938                     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00939                 }
00940             }
00941 
00942             Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) Log2N;
00943             Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o1">PoolType</a> = PoolDesc-&gt;PoolType;
00944             Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o2">ProcessBilled</a> = (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00945 
00946 <span class="preprocessor">#if defined(TRACE_ALLOC) || defined (DEADBEEF)</span>
00947 <span class="preprocessor"></span>            {
00948                 PULONG NewPool;
00949                 ULONG LongCount;
00950 
00951                 NewPool = (PULONG) ((PCH)Entry + <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
00952                 LongCount = (1 &lt;&lt; Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a>) &gt;&gt; 2;
00953                 LongCount -= (<a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>&gt;&gt;2);
00954 
00955                 <span class="keywordflow">while</span>(LongCount--) {
00956                     *NewPool++ = 0xBAADF00D;
00957                 }
00958             }
00959 <span class="preprocessor">#endif //TRACE_ALLOC</span>
00960 <span class="preprocessor"></span>
00961             PoolDesc-&gt;TotalPages++;
00962 
00963             <span class="keywordflow">return</span> (PVOID)Entry;
00964 
00965         }
00966     }
00967 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="poolhack.c::CheckPool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CheckPool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01400">1400</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00091">_POOL_LIST_HEAD::ListHead</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00105">_POOL_HEADER::LogAllocationSize</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00437">MmDeterminePoolType()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00106">pd</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00068">POOL_LIST_HEADS</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00069">POOL_LOG_MIN</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00116">POOL_OVERHEAD</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00066">POOL_PAGE_SIZE</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00106">_POOL_HEADER::PoolType</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00451">PoolVector</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00102">PPOOL_DESCRIPTOR</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00114">PPOOL_HEADER</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00093">PPOOL_LIST_HEAD</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01401 {
01402     <a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a> <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>;
01403     <a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a> ph,bph;
01404     <a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html">PPOOL_LIST_HEAD</a> plh;
01405     PLIST_ENTRY lh,next,lh2,next2;
01406     BOOLEAN buddyinlist;
01407     LONG i,j;
01408     ULONG size;
01409 
01410     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a> = <a class="code" href="../../d2/d2/ex_2pool_8c.html#a54">PoolVector</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>];
01411 
01412     <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>-&gt;PoolType != <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a> ) {
01413         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"pd = %8lx\n"</span>, pd);
01414         <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(0x70000001);
01415     }
01416 
01417     <span class="keywordflow">if</span> ( (LONG) <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>-&gt;TotalPages &lt; 0 ) {
01418         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"pd = %8lx\n"</span>, pd);
01419         <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(0x70000002);
01420     }
01421 
01422     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d5/d2/poolhack_8c.html#a2">POOL_LIST_HEADS</a>; i++ ) {
01423         plh = &amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>-&gt;ListHeads[i];
01424         size = (1 &lt;&lt; (i + <a class="code" href="../../d5/d2/poolhack_8c.html#a3">POOL_LOG_MIN</a>));
01425 
01426         <span class="keywordflow">if</span> ( !IsListEmpty(&amp;plh-&gt;<a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html#o2">ListHead</a>) ) {
01427 
01428             lh = &amp;plh-&gt;<a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html#o2">ListHead</a>;
01429             next = lh-&gt;Flink;
01430             <span class="keywordflow">while</span> ( next != lh ) {
01431                 ph = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)((PCH)next - <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
01432 
01433                 <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d6/allocpag_8c.html#a48">MmDeterminePoolType</a>(ph) != <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a> ) {
01434                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"ph = %8lx\n"</span>, ph);
01435                     <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(0x70000004);
01436                 }
01437                 <span class="keywordflow">if</span> ( size != <a class="code" href="../../d5/d2/poolhack_8c.html#a0">POOL_PAGE_SIZE</a> ) {
01438                     bph = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)((ULONG)ph ^ size);
01439                     <span class="keywordflow">if</span> ( bph-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a> == 0 &amp;&amp;
01440                          bph-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o1">PoolType</a> == i ) {
01441                         lh2 = &amp;plh-&gt;<a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html#o2">ListHead</a>;
01442                         next2 = lh2-&gt;Flink;
01443                         buddyinlist = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01444                         <span class="keywordflow">while</span> ( next2 != lh2 ) {
01445                             ph = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)((PCH)next - <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
01446                             <span class="keywordflow">if</span> ( bph == ph ) {
01447                                 buddyinlist = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01448                             }
01449                             next2 = next2-&gt;Flink;
01450                         }
01451                         <span class="keywordflow">if</span> ( !buddyinlist ) {
01452                             <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(0x70000005);
01453                         }
01454                     }
01455                 }
01456                 <span class="keywordflow">if</span> ( next == next-&gt;Flink ) {
01457                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"next = %8lx\n"</span>, next);
01458                     <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(0x70000006);
01459                 }
01460                 next = next-&gt;Flink;
01461             }
01462         }
01463 
01464     }
01465 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="poolhack.c::DeallocatePoolInternal" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DeallocatePoolInternal           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolDesc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Entry</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01177">1177</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00105">_POOL_HEADER::LogAllocationSize</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l01778">MiFreePoolPages()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00069">POOL_LOG_MIN</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00116">POOL_OVERHEAD</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00066">POOL_PAGE_SIZE</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00106">_POOL_HEADER::PoolType</a>, and <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00114">PPOOL_HEADER</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>.
<p>
<pre class="fragment"><div>01184                    :
01185 
01186     This function implements <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> guts of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> binary buddy <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
01187     deallocator.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a recursive function.  It assumes that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01188     caller (ExFreePool) chose the correct pool descriptor, and that
01189     the deallocation should be done using the binary buddy deallocator.
01190 
01191     The binary buddy deallocator automatically collapses adjacent free
01192     blocks of the same size into a single free block of the next larger
01193     size.  This is a recursive operation.  This does not occur on a
01194     deallocation of a page sized block.  If a page sized block is being
01195     deallocated, then the pool descriptor's threshold is examined.  If
01196     the deallocation would cause the threshold to be exceeded, the page
01197     sized block is returned to the page aligned pool allocator.
01198 
01199 Arguments:
01200 
01201     PoolDesc - Supplies the address of the pool descriptor to use to
01202                satisfy the request.
01203 
01204     Entry - Supplies the address of the pool header of the block of pool
01205             being deallocated.
01206 
01207 Return Value:
01208 
01209     None.
01210 
01211 --*/
01212 
01213 {
01214     <a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a> Buddy,Base;
01215     LONG index;
01216     ULONG EntrySize;
01217 
01218     <span class="comment">//</span>
01219     <span class="comment">// Locate buddy of Entry being deallocated.  Page size entries have no</span>
01220     <span class="comment">// buddy</span>
01221     <span class="comment">//</span>
01222 
01223 
01224     index = Entry-&gt;LogAllocationSize - <a class="code" href="../../d5/d2/poolhack_8c.html#a3">POOL_LOG_MIN</a>;
01225 
01226     EntrySize = (1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a> &lt;&lt; Entry-&gt;LogAllocationSize);
01227 
01228     <span class="keywordflow">if</span> ( EntrySize &lt; <a class="code" href="../../d5/d2/poolhack_8c.html#a0">POOL_PAGE_SIZE</a> ) {
01229 
01230         <span class="comment">//</span>
01231         <span class="comment">// buddy of Entry is LogAllocationSize bytes from Entry rounded</span>
01232         <span class="comment">// down on a 2*LogAllocationSize boundry</span>
01233         <span class="comment">//</span>
01234 
01235         Buddy = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)((ULONG)Entry ^ EntrySize);
01236 
01237         <span class="comment">//</span>
01238         <span class="comment">// see if buddy is free.  If so, then join buddy and Entry and</span>
01239         <span class="comment">// deallocate the joined Entry</span>
01240         <span class="comment">//</span>
01241 
01242         <span class="keywordflow">if</span> ( Buddy-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a> == 0 &amp;&amp;
01243              Buddy-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o1">PoolType</a> == index ) {
01244 
01245             <span class="comment">//</span>
01246             <span class="comment">// buddy is free.  Figure out which Entry is the base.</span>
01247             <span class="comment">// Convert the size of the base to next larger size and</span>
01248             <span class="comment">// deallocate the new Entry</span>
01249             <span class="comment">//</span>
01250 
01251             Base = ((ULONG)Entry &amp; EntrySize) ? Buddy : Entry;
01252 
01253             RemoveEntryList((PLIST_ENTRY)((PCH)Buddy + POOL_OVERHEAD));
01254 
01255             <span class="comment">//</span>
01256             <span class="comment">// Update statistics for buddy's list head.</span>
01257             <span class="comment">//</span>
01258 
01259             PoolDesc-&gt;ListHeads[index].CurrentFreeLength--;
01260 
01261             <span class="comment">//</span>
01262             <span class="comment">// mark base as allocated as next size Entry and then deallocate it</span>
01263             <span class="comment">//</span>
01264 
01265             Base-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a> = Entry-&gt;LogAllocationSize + 1;
01266 
01267             <a class="code" href="../../d5/d2/poolhack_8c.html#a27">DeallocatePoolInternal</a>(PoolDesc,Base);
01268 
01269         } <span class="keywordflow">else</span> {
01270 
01271             <span class="comment">//</span>
01272             <span class="comment">// Buddy is not free, so just mark Entry as free and return to</span>
01273             <span class="comment">// appropriate list head</span>
01274             <span class="comment">//</span>
01275 
01276 <span class="preprocessor">#if defined(TRACE_ALLOC) || defined (DEADBEEF)</span>
01277 <span class="preprocessor"></span>            {
01278                 PULONG OldPool;
01279                 ULONG LongCount;
01280 
01281                 OldPool = (PULONG)((PCH)Entry + <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
01282                 LongCount = EntrySize &gt;&gt; 2;
01283                 LongCount -= (<a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>&gt;&gt;2);
01284 
01285                 <span class="keywordflow">while</span>(LongCount--) {
01286                     *OldPool++ = 0xBAADF00D;
01287                 }
01288             }
01289 <span class="preprocessor">#endif //TRACE_ALLOC</span>
01290 <span class="preprocessor"></span>
01291             InsertTailList(
01292                 &amp;PoolDesc-&gt;ListHeads[index].ListHead,
01293                 (PLIST_ENTRY)((PCH)Entry + POOL_OVERHEAD)
01294                 );
01295 
01296             PoolDesc-&gt;ListHeads[index].CurrentFreeLength++;
01297 
01298             Entry-&gt;LogAllocationSize = 0;
01299             Entry-&gt;PoolType = index;
01300         }
01301 
01302     } <span class="keywordflow">else</span> {
01303 
01304         <span class="comment">//</span>
01305         <span class="comment">// Page Sized Entry.  Check threshold.  If deallocating Entry</span>
01306         <span class="comment">// would cross threshold then give back the page.  Otherwise put</span>
01307         <span class="comment">// it on the free list</span>
01308         <span class="comment">//</span>
01309 
01310         <span class="keywordflow">if</span> ( PoolDesc-&gt;ListHeads[index].CurrentFreeLength == PoolDesc-&gt;Threshold ) {
01311 
01312             <a class="code" href="../../d1/d6/allocpag_8c.html#a55">MiFreePoolPages</a> (Entry);
01313 
01314         } <span class="keywordflow">else</span> {
01315 
01316             <span class="comment">//</span>
01317             <span class="comment">// so just mark Entry as free and return to appropriate list head</span>
01318             <span class="comment">//</span>
01319 
01320 <span class="preprocessor">#if defined(TRACE_ALLOC) || defined (DEADBEEF)</span>
01321 <span class="preprocessor"></span>            {
01322                 PULONG OldPool;
01323                 ULONG LongCount;
01324 
01325                 OldPool = (PULONG)((PCH)Entry + <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
01326                 LongCount = EntrySize &gt;&gt; 2;
01327                 LongCount -= (<a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>&gt;&gt;2);
01328 
01329                 <span class="keywordflow">while</span>(LongCount--) {
01330                     *OldPool++ = 0xBAADF00D;
01331                 }
01332             }
01333 <span class="preprocessor">#endif //TRACE_ALLOC</span>
01334 <span class="preprocessor"></span>
01335             InsertTailList(
01336                 &amp;PoolDesc-&gt;ListHeads[index].ListHead,
01337                 (PLIST_ENTRY)((PCH)Entry + POOL_OVERHEAD)
01338                 );
01339 
01340             PoolDesc-&gt;ListHeads[index].CurrentFreeLength++;
01341 
01342             Entry-&gt;LogAllocationSize = 0;
01343             Entry-&gt;PoolType = index;
01344 
01345         }
01346     }
01347 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="poolhack.c::DumpAllocatedPool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DumpAllocatedPool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DumpOrFlush</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01467">1467</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a180">MaxPoolType</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00106">pd</a>, <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00102">PPOOL_DESCRIPTOR</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00093">PPOOL_LIST_HEAD</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>01470 {
01471     <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> MiFlushUnusedSections( VOID );
01472     <a class="code" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> pt;
01473     ULONG PoolUsage[<a class="code" href="../../d5/d8/ex_8h.html#a329a180">MaxPoolType</a>];
01474     ULONG PoolFree[<a class="code" href="../../d5/d8/ex_8h.html#a329a180">MaxPoolType</a>];
01475 
01476     <a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a> <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>;
01477     <a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html">PPOOL_LIST_HEAD</a> plh;
01478     PLIST_ENTRY lh,next;
01479     LONG i,j,k;
01480     ULONG size;
01481 
01482     <span class="keywordflow">if</span> ( DumpOrFlush ) {
01483         MiFlushUnusedSections();
01484         <span class="keywordflow">return</span>;
01485     }
01486 
01487     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a> (<span class="stringliteral">"PoolHack does not work with POOL command\n"</span>);
01488 
01489     <span class="keywordflow">return</span>;
01490 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="poolhack.c::DumpPool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DumpPool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSZ&nbsp;</td>
          <td class="mdname" nowrap> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pt</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01351">1351</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00089">_POOL_LIST_HEAD::CurrentFreeLength</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00091">_POOL_LIST_HEAD::ListHead</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00105">_POOL_HEADER::LogAllocationSize</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00106">pd</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00068">POOL_LIST_HEADS</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00069">POOL_LOG_MIN</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00116">POOL_OVERHEAD</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00066">POOL_PAGE_SIZE</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00106">_POOL_HEADER::PoolType</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00451">PoolVector</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00102">PPOOL_DESCRIPTOR</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00114">PPOOL_HEADER</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00093">PPOOL_LIST_HEAD</a>, and <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00112">_POOL_HEADER::ProcessBilled</a>.
<p>
<pre class="fragment"><div>01355 {
01356     <a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a> <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>;
01357     <a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a> ph,bph;
01358     <a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html">PPOOL_LIST_HEAD</a> plh;
01359     PLIST_ENTRY lh,next;
01360     LONG i;
01361     ULONG size;
01362 
01363     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a> = <a class="code" href="../../d2/d2/ex_2pool_8c.html#a54">PoolVector</a>[pt];
01364 
01365     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n\n%s\n"</span>,s);
01366 
01367     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"PoolType: 0x%lx\n"</span>,(ULONG)<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>-&gt;PoolType);
01368     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TotalPages: 0x%lx\n"</span>,<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>-&gt;TotalPages);
01369     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Threshold: 0x%lx\n"</span>,<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>-&gt;Threshold);
01370     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d5/d2/poolhack_8c.html#a2">POOL_LIST_HEADS</a>; i++ ) {
01371         plh = &amp;<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>-&gt;ListHeads[i];
01372         size = (1 &lt;&lt; (i + <a class="code" href="../../d5/d2/poolhack_8c.html#a3">POOL_LOG_MIN</a>));
01373         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\npd_list_head[0x%lx] size 0x%lx\n"</span>,i,size);
01374         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\tCurrentFreeLength 0x%lx\n"</span>,plh-&gt;<a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html#o0">CurrentFreeLength</a>);
01375         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\t&amp;ListHead 0x%lx\n"</span>,&amp;plh-&gt;<a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html#o2">ListHead</a>);
01376         lh = &amp;plh-&gt;<a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html#o2">ListHead</a>;
01377         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\t\tpFlink 0x%lx\n"</span>,lh-&gt;Flink);
01378         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\t\tpBlink 0x%lx\n"</span>,lh-&gt;Blink);
01379         next = lh-&gt;Flink;
01380         <span class="keywordflow">while</span> ( next != lh ) {
01381             ph = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)((PCH)next - <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
01382             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\t\t\tpool header at 0x%lx list 0x%lx\n"</span>,ph,next);
01383             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\t\t\tLogAllocationSize 0x%lx 0x%lx\n"</span>,(ULONG)ph-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a>,(ULONG)(1&lt;&lt;ph-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a>));
01384             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\t\t\tPoolType 0x%lx\n"</span>,(ULONG)ph-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o1">PoolType</a>);
01385             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\t\t\tProcessBilled 0x%lx\n"</span>,ph-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o2">ProcessBilled</a>);
01386             <span class="keywordflow">if</span> ( size != <a class="code" href="../../d5/d2/poolhack_8c.html#a0">POOL_PAGE_SIZE</a> ) {
01387                 bph = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)((ULONG)ph ^ size);
01388                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\t\t\t\tBuddy pool header at 0x%lx\n"</span>,bph);
01389                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\t\t\t\tBuddy LogAllocationSize 0x%lx 0x%lx\n"</span>,(ULONG)bph-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a>,(ULONG)(1&lt;&lt;bph-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a>));
01390                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\t\t\t\tBuddy PoolType 0x%lx\n"</span>,(ULONG)bph-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o1">PoolType</a>);
01391                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\t\t\t\tBuddy ProcessBilled 0x%lx\n"</span>,bph-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o2">ProcessBilled</a>);
01392             }
01393             next = next-&gt;Flink;
01394         }
01395     }
01396 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="poolhack.c::ExAllocatePool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID ExAllocatePool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">413</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00786">AllocatePoolInternal()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00133">BasePoolTypeTable</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d2/d5/semphobj_8c-source.html#l00118">KeReleaseSemaphore()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00100">_POOL_DESCRIPTOR::ListHeads</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00492">LOCK_POOL</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00125">_POOL_DESCRIPTOR::LockAddress</a>, <a class="el" href="../../d0/d9/ntosdef_8h.html#a75a64">LockQueuePfnLock</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00105">_POOL_HEADER::LogAllocationSize</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00807">MiAllocatePoolPages()</a>, <a class="el" href="../../d9/d7/alpha_2mialpha_8h-source.html#l01842">MiGetVirtualAddressMappedByPte</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l03398">MiInitializePfn()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l01395">MiRemoveAnyPage()</a>, <a class="el" href="../../d1/d8/sysptes_8c-source.html#l00524">MiReserveSystemPtes()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00134">MmAvailablePages</a>, <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00039">MmPfnLock</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00140">MustSucceedPoolTable</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00117">POOL_BUDDY_MAX</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00069">POOL_LOG_MIN</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00070">POOL_MIN_ROUND</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00116">POOL_OVERHEAD</a>, <a class="el" href="../../d4/d9/ke_8h.html#a407a201">PoolAllocation</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00073">PoolIndexTable</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00106">_POOL_HEADER::PoolType</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00451">PoolVector</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00102">PPOOL_DESCRIPTOR</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00114">PPOOL_HEADER</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00112">_POOL_HEADER::ProcessBilled</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d4/d8/mi_8h.html#a1003a769">SystemPteSpace</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d4/struct__MMPTE.html#o8">_MMPTE::u</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00551">UNLOCK_POOL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d5/d1/datalpha_8c-source.html#l00038">ValidKernelPte</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>00420                    :
00421 
00422     This function allocates a block of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> and
00423     returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocated block.  This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to
00424     access both <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page-aligned pools, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> binary buddy (less than
00425     a page) pools.
00426 
00427     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes specifies a size that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> too large to be
00428     satisfied by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate binary buddy <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page-aligned
00429     <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocator <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used.  The allocated block will be page-aligned
00430     and a page-sized multiple.
00431 
00432     Otherwise, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate binary buddy <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used.  The allocated
00433     block will be 64-bit aligned, but will not be page aligned.  The
00434     binary buddy allocator calculates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> smallest block size that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a
00435     power of two and that can be used to satisfy <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request.  If there
00436     are no blocks available of <span class="keyword">this</span> size, then a block of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next
00437     larger block size <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allocated and split in half.  One piece <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00438     placed back into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> other piece <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to satisfy
00439     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocator reaches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> paged-sized block list,
00440     and nothing <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> there, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page-aligned <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocator <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called.
00441     The page <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> added to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> binary buddy <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>...
00442 
00443 Arguments:
00444 
00445     PoolType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> to allocate.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>
00446         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="stringliteral">"MustSucceed"</span> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> types, then <span class="keyword">this</span> call will
00447         always succeed and <span class="keywordflow">return</span> a pointer to allocated <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>.
00448         Otherwise, <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system can not allocate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested amount
00449         of memory a <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00450 
00451     NumberOfBytes - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes to allocate.
00452 
00453 Return Value:
00454 
00455     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - The PoolType <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="stringliteral">"MustSucceed"</span> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> types, and
00456         not enough <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> exists to satisfy <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request.
00457 
00458     NON-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - Returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocated <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>.
00459 
00460 --*/
00461 
00462 {
00463     <a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a> Entry;
00464     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> CurrentProcess;
00465     KIRQL LockHandle;
00466     <a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a> PoolDesc;
00467     PVOID <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>;
00468     LONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00469     PVOID Block;
00470 
00471     KIRQL OldIrql;
00472     <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> PointerPte;
00473     ULONG PageFrameIndex;
00474     <a class="code" href="../../d2/d4/struct__MMPTE.html">MMPTE</a> TempPte;
00475     BOOLEAN ReleaseSpinLock = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00476 
00477 <span class="preprocessor">#if defined(TRACE_ALLOC) || defined (DEADBEEF)</span>
00478 <span class="preprocessor"></span>
00479     PULONG BadFood;
00480 <span class="preprocessor">#endif //TRACE_ALLOC</span>
00481 <span class="preprocessor"></span>
00482 <span class="preprocessor">#ifdef TRACE_ALLOC</span>
00483 <span class="preprocessor"></span>    PULONG xFp, xPrevFp, xR1, xPrevR1, xPrevPrevR1;
00484 
00485     xFp = RtlpGetFramePointer();
00486     xR1 = (PULONG)*(xFp+1);
00487     xPrevFp = (PULONG)*xFp;
00488     xPrevR1 = (PULONG)*(xPrevFp+1);
00489     xPrevFp = (PULONG)*xPrevFp;
00490     xPrevPrevR1 = (PULONG)*(xPrevFp+1);
00491 
00492 <span class="preprocessor">#endif // TRACE_ALLOC</span>
00493 <span class="preprocessor"></span>
00494 
00495 
00496     PoolDesc = <a class="code" href="../../d2/d2/ex_2pool_8c.html#a54">PoolVector</a>[PoolType];
00497     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a> = PoolDesc-&gt;<a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html#o3">LockAddress</a>;
00498 
00499     <span class="keywordflow">if</span> (NumberOfBytes &gt; <a class="code" href="../../d5/d2/poolhack_8c.html#a7">POOL_BUDDY_MAX</a>) {
00500 
00501         <a class="code" href="../../d2/d2/ex_2pool_8c.html#a33">LOCK_POOL</a>(Lock,PoolType,LockHandle);
00502 
00503         Entry = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)<a class="code" href="../../d1/d6/allocpag_8c.html#a54">MiAllocatePoolPages</a> (
00504                                         BasePoolTypeTable[PoolType],
00505                                         NumberOfBytes
00506                                         );
00507         <span class="keywordflow">if</span> ( !Entry &amp;&amp; <a class="code" href="../../d5/d2/poolhack_8c.html#a25">MustSucceedPoolTable</a>[PoolType] ) {
00508             Entry = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)<a class="code" href="../../d1/d6/allocpag_8c.html#a54">MiAllocatePoolPages</a> (
00509                                             PoolType,
00510                                             NumberOfBytes
00511                                             );
00512         }
00513         <a class="code" href="../../d2/d2/ex_2pool_8c.html#a35">UNLOCK_POOL</a>(Lock,PoolType,LockHandle,FALSE);
00514 
00515         <span class="keywordflow">return</span> Entry;
00516     }
00517 
00518     <span class="keywordflow">if</span> (KeGetCurrentIrql() &gt;= 2) {
00519         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"allocating pool at irql &gt;= 2\n"</span>);
00520         ReleaseSpinLock = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00521 
00522     } <span class="keywordflow">else</span> {
00523         KeAcquireQueuedSpinLock(LockQueuePfnLock);
00524     }
00525 
00526     PointerPte = <a class="code" href="../../d0/d9/sysptes_8c.html#a25">MiReserveSystemPtes</a> (2, SystemPteSpace, 0, 0, TRUE);
00527 
00528             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (MmAvailablePages &gt; 0);
00529             PageFrameIndex = <a class="code" href="../../d7/d5/pfnlist_8c.html#a15">MiRemoveAnyPage</a> ();
00530             TempPte = <a class="code" href="../../d4/d2/datalpha_8c.html#a2">ValidKernelPte</a>;
00531             TempPte.<a class="code" href="../../d2/d4/struct__MMPTE.html#o8">u</a>.Hard.PageFrameNumber = PageFrameIndex;
00532             *PointerPte = TempPte;
00533             <a class="code" href="../../d8/d2/pagfault_8c.html#a22">MiInitializePfn</a> (PageFrameIndex, PointerPte, 1L, 1);
00534 
00535     <span class="keywordflow">if</span> (ReleaseSpinLock) {
00536         <a class="code" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock</a> ( &amp;MmPfnLock, OldIrql );
00537     }
00538 
00539     Entry = (PVOID)<a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a161">MiGetVirtualAddressMappedByPte</a> (PointerPte);
00540 
00541     Entry = (PVOID)(((ULONG)Entry + (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - (NumberOfBytes))) &amp;
00542             0xfffffff8<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00543 
00544     <span class="keywordflow">return</span> Entry;
00545 
00546 
00547     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = ( (NumberOfBytes+<a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>+<a class="code" href="../../d5/d2/poolhack_8c.html#a4">POOL_MIN_ROUND</a>) &gt;&gt; <a class="code" href="../../d5/d2/poolhack_8c.html#a3">POOL_LOG_MIN</a>) - 1;
00548 
00549     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d5/d2/poolhack_8c.html#a10">PoolIndexTable</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00550 
00551     <a class="code" href="../../d2/d2/ex_2pool_8c.html#a33">LOCK_POOL</a>(Lock,PoolType,LockHandle);
00552 
00553     <span class="keywordflow">if</span> ( !IsListEmpty(&amp;PoolDesc-&gt;<a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html#o4">ListHeads</a>[Index].<a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html#o2">ListHead</a>) ) {
00554 
00555         Block = RemoveHeadList(&amp;PoolDesc-&gt;<a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html#o4">ListHeads</a>[Index].<a class="code" href="../../d0/d9/struct__POOL__LIST__HEAD.html#o2">ListHead</a>);
00556         Entry = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>) ((PCH)Block - <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
00557         Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o2">ProcessBilled</a> = (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00558         Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d5/d2/poolhack_8c.html#a3">POOL_LOG_MIN</a> + <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00559         Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o1">PoolType</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)PoolType;
00560 <span class="preprocessor">#if defined(TRACE_ALLOC) || defined (DEADBEEF)</span>
00561 <span class="preprocessor"></span>        BadFood = (PULONG)Block;
00562         *BadFood = 0xBAADF00D;
00563         *(BadFood+1) = 0xBAADF00D;
00564 <span class="preprocessor">#endif // TRACE_ALLOC</span>
00565 <span class="preprocessor"></span>
00566     } <span class="keywordflow">else</span> {
00567 
00568         Entry = <a class="code" href="../../d5/d2/poolhack_8c.html#a26">AllocatePoolInternal</a>(PoolDesc,Index);
00569 
00570         <span class="keywordflow">if</span> ( !Entry ) {
00571 <span class="preprocessor">#if DBG</span>
00572 <span class="preprocessor"></span>            <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"EX: ExAllocatePool returning NULL\n"</span>);
00573             DbgBreakPoint();
00574 <span class="preprocessor">#endif // DBG</span>
00575 <span class="preprocessor"></span>            <a class="code" href="../../d2/d2/ex_2pool_8c.html#a35">UNLOCK_POOL</a>(Lock,PoolType,LockHandle,FALSE);
00576             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00577         }
00578     }
00579 
00580     <a class="code" href="../../d2/d2/ex_2pool_8c.html#a35">UNLOCK_POOL</a>(Lock,PoolType,LockHandle,FALSE);
00581 
00582 <span class="preprocessor">#ifdef TRACE_ALLOC</span>
00583 <span class="preprocessor"></span>        {
00584                 KIRQL xIrql;
00585 
00586                 <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(APC_LEVEL, &amp;xIrql);
00587 
00588                 <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>(
00589                     &amp;TracePoolLock,
00590                     PoolAllocation,
00591                     KernelMode,
00592                     FALSE,
00593                     NULL
00594                     );
00595 
00596                 InsertTailList(&amp;TracePoolListHead[PoolType],&amp;Entry-&gt;TraceLinks);
00597 
00598                 Entry-&gt;xR1 = xR1;
00599                 Entry-&gt;xPrevR1 = xPrevR1;
00600                 Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o2">ProcessBilled</a> = (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)xPrevPrevR1;
00601 
00602                 <span class="comment">//Entry-&gt;ProcessBilled = (PEPROCESS)NextAllocTrace;</span>
00603 
00604                 AllocTrace[NextAllocTrace].BufferAddress = (PCH)Entry + <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>;
00605                 AllocTrace[NextAllocTrace].Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
00606                 AllocTrace[NextAllocTrace].xR1 = xR1;
00607                 AllocTrace[NextAllocTrace++].xPrevR1 = xPrevR1;
00608                 <span class="keywordflow">if</span> ( NextAllocTrace &gt;= MAXTRACE ) {
00609                     NextAllocTrace = 0;
00610                 }
00611 
00612 
00613                 (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d1/d6/semphobj_8c.html#a3">KeReleaseSemaphore</a>(
00614                             &amp;TracePoolLock,
00615                             0L,
00616                             1L,
00617                             FALSE
00618                             );
00619                 <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(xIrql);
00620 
00621         }
00622 <span class="preprocessor">#endif // TRACE_ALLOC</span>
00623 <span class="preprocessor"></span>
00624 <span class="preprocessor">#if defined(TRACE_ALLOC) || defined (DEADBEEF)</span>
00625 <span class="preprocessor"></span>    {
00626         PULONG NewPool;
00627         ULONG LongCount;
00628 
00629         Block = (PULONG)((PCH)Entry + <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
00630         NewPool = (PULONG) ((PCH)Entry + <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
00631         LongCount = (1 &lt;&lt; Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a>) &gt;&gt; 2;
00632         LongCount -= (<a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>&gt;&gt;2);
00633 
00634         <span class="keywordflow">while</span>(LongCount--) {
00635             <span class="keywordflow">if</span> ( *NewPool != 0xBAADF00D ) {
00636                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"ExAllocatePool: No BAADF00D Block %lx at %lx\n"</span>,
00637                     Block,
00638                     NewPool
00639                     );
00640                 <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(0xBADF00D2);
00641             }
00642             *NewPool++ = 0xDEADBEEF;
00643         }
00644     }
00645 <span class="preprocessor">#endif //TRACE_ALLOC</span>
00646 <span class="preprocessor"></span>
00647     <span class="keywordflow">return</span> ((PCH)Entry + <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
00648 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="poolhack.c::ExAllocatePoolWithQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID ExAllocatePoolWithQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfBytes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00694">694</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00133">BasePoolTypeTable</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00651">ExpAllocatePoolWithQuotaHandler()</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00105">_POOL_HEADER::LogAllocationSize</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00071">PAGE_ALIGNED</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00116">POOL_OVERHEAD</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00114">PPOOL_HEADER</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00112">_POOL_HEADER::ProcessBilled</a>, <a class="el" href="../../d1/d1/psquota_8c-source.html#l00246">PsChargePoolQuota()</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>.
<p>
<pre class="fragment"><div>00701                    :
00702 
00703     This function allocates a block of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>,
00704     returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocated block, and <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> binary buddy
00705     allocator was used to satisfy <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request, charges <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00706     current process.  This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to access both <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00707     page-aligned pools, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> binary buddy.
00708 
00709     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes specifies a size that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> too large to be
00710     satisfied by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate binary buddy <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00711     page-aligned <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocator <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used.  The allocated block will be
00712     page-aligned and a page-sized multiple.  No quota <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> charged to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00713     current process <span class="keywordflow">if</span> <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">case</span>.
00714 
00715     Otherwise, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate binary buddy <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used.  The allocated
00716     block will be 64-bit aligned, but will not be page aligned.  After
00717     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocation completes, an attempt will be <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to charge <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
00718     quota (of the appropriate type) to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process object.  If
00719     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> quota charge succeeds, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> block's header <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> adjusted
00720     to point to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process.  The process object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
00721     dereferenced until <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> deallocated and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate
00722     amount of quota <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process.  Otherwise, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00723     deallocated, a <span class="stringliteral">"quota exceeded"</span> condition <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> raised.
00724 
00725 Arguments:
00726 
00727     PoolType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> to allocate.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>
00728         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="stringliteral">"MustSucceed"</span> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> types and sufficient quota
00729         exists, then <span class="keyword">this</span> call will always succeed and <span class="keywordflow">return</span> a pointer
00730         to allocated <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>.  Otherwise, <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system can not allocate
00731         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested amount of memory a STATUS_INSUFFICIENT_RESOURCES
00732         status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> raised.
00733 
00734     NumberOfBytes - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes to allocate.
00735 
00736 Return Value:
00737 
00738     NON-<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> - Returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocated <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>.
00739 
00740     Unspecified - If insuffient quota exists to complete <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
00741         allocation, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">return</span> value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> unspecified.
00742 
00743 --*/
00744 
00745 {
00746     PVOID p;
00747     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process;
00748     <a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a> Entry;
00749     ULONG AllocationSize;
00750 
00751     p = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PoolType,NumberOfBytes);
00752 
00753 
00754 <span class="preprocessor">#ifndef TRACE_ALLOC</span>
00755 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( p &amp;&amp; !<a class="code" href="../../d5/d2/poolhack_8c.html#a5">PAGE_ALIGNED</a>(p) ) {
00756 
00757         Entry = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)((PCH)p - <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
00758 
00759         Process = <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>();
00760 
00761         <span class="comment">//</span>
00762         <span class="comment">// Catch exception and back out allocation if necessary</span>
00763         <span class="comment">//</span>
00764 
00765         <span class="keywordflow">try</span> {
00766 
00767             <a class="code" href="../../d0/d2/psquota_8c.html#a2">PsChargePoolQuota</a>(Process,BasePoolTypeTable[PoolType],(1 &lt;&lt; Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a>));
00768             <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(Process);
00769             Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o2">ProcessBilled</a> = Process;
00770 
00771         } except ( <a class="code" href="../../d5/d2/poolhack_8c.html#a33">ExpAllocatePoolWithQuotaHandler</a>(GetExceptionCode(),p)) {
00772             <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(GetExceptionCode());
00773         }
00774 
00775     } <span class="keywordflow">else</span> {
00776         <span class="keywordflow">if</span> ( !p ) {
00777             <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>(STATUS_INSUFFICIENT_RESOURCES);
00778         }
00779     }
00780 <span class="preprocessor">#endif // TRACE_ALLOC</span>
00781 <span class="preprocessor"></span>
00782     <span class="keywordflow">return</span> p;
00783 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="poolhack.c::ExFreePool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExFreePool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>P</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">970</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00133">BasePoolTypeTable</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01177">DeallocatePoolInternal()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00122">HBLOCK_SIZE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02007">KeAcquireSpinLock</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d2/d5/semphobj_8c-source.html#l00118">KeReleaseSemaphore()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d4/d4/ppc_2flush_8c-source.html#l00220">KeSweepDcache()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00492">LOCK_POOL</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00125">_POOL_DESCRIPTOR::LockAddress</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00105">_POOL_HEADER::LogAllocationSize</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a180">MaxPoolType</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l00769">MI_PFN_ELEMENT</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l02757">MiDecrementShareCountOnly</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l01778">MiFreePoolPages()</a>, <a class="el" href="../../d9/d7/alpha_2mialpha_8h-source.html#l01671">MiGetPteAddress</a>, <a class="el" href="../../d1/d8/sysptes_8c-source.html#l01354">MiReleaseSystemPtes()</a>, <a class="el" href="../../d9/d7/alpha_2mialpha_8h-source.html#l00107">MM_EMPTY_LIST</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00437">MmDeterminePoolType()</a>, <a class="el" href="../../d8/d1/alpha_2initkr_8c-source.html#l00039">MmPfnLock</a>, <a class="el" href="../../d4/d6/freevm_8c-source.html#l00066">NtFreeVirtualMemory()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00071">PAGE_ALIGNED</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00116">POOL_OVERHEAD</a>, <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>, <a class="el" href="../../d4/d9/ke_8h.html#a407a201">PoolAllocation</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00106">_POOL_HEADER::PoolType</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00451">PoolVector</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00102">PPOOL_DESCRIPTOR</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00114">PPOOL_HEADER</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00112">_POOL_HEADER::ProcessBilled</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d1/d1/psquota_8c-source.html#l00356">PsReturnPoolQuota()</a>, <a class="el" href="../../d5/d7/mi_8h-source.html#l01281">_MMPFN::PteAddress</a>, <a class="el" href="../../d4/d8/mi_8h.html#a1003a769">SystemPteSpace</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d4/struct__MMPTE.html#o8">_MMPTE::u</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00551">UNLOCK_POOL</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, and <a class="el" href="../../d5/d1/datalpha_8c-source.html#l00030">ZeroPte</a>.
<p>
Referenced by <a class="el" href="../../d9/d7/arbiter_8c-source.html#l03028">ArbAddOrdering()</a>, <a class="el" href="../../d9/d7/arbiter_8c-source.html#l01622">ArbBuildAssignmentOrdering()</a>, <a class="el" href="../../d9/d7/arbiter_8c-source.html#l00469">ArbDeleteArbiterInstance()</a>, <a class="el" href="../../d9/d7/arbiter_8c-source.html#l03350">ArbFreeOrderingList()</a>, <a class="el" href="../../d9/d7/arbiter_8c-source.html#l00192">ArbInitializeArbiterInstance()</a>, <a class="el" href="../../d9/d7/arbiter_8c-source.html#l00786">ArbpBuildAllocationStack()</a>, <a class="el" href="../../d9/d7/arbiter_8c-source.html#l02824">ArbpGetRegistryValue()</a>, <a class="el" href="../../d9/d7/arbiter_8c-source.html#l03120">ArbPruneOrdering()</a>, <a class="el" href="../../d9/d7/arbiter_8c-source.html#l03695">ArbQueryConflict()</a>, <a class="el" href="../../d1/d7/dir_8c-source.html#l00057">BuildQueryDirectoryIrp()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05694">CcDeallocateBcb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02626">CcDeleteMbcb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02044">CcDrainVacbLevelZone()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l02099">CcPostDeferredWrites()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l01000">CcUnpinData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l01142">CcUnpinDataForThread()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>, <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l02394">CmDeleteKeyRecursive()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00293">CmInitSystem1()</a>, <a class="el" href="../../d7/d0/cmhvlist_8c-source.html#l00042">CmpAddToHiveFileList()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03883">CmpAllocatePostBlock()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l01392">CmpAppendStringToMultiSz()</a>, <a class="el" href="../../d9/d1/cmsubs_8c-source.html#l00568">CmpCleanUpKcbValueCache()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03262">CmpCloneControlSet()</a>, <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l01869">CmpCloneHwProfile()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01832">CmpCloseInfFile()</a>, <a class="el" href="../../d3/d2/cmtrecpy_8c-source.html#l00127">CmpCopySyncTree()</a>, <a class="el" href="../../d3/d2/cmtrecpy_8c-source.html#l00251">CmpCopySyncTree2()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01165">CmpCreateRegistryRoot()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01900">CmpDelayedDerefKeys()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l01490">CmpDestroyTemporaryHive()</a>, <a class="el" href="../../d6/d2/cmworker_8c-source.html#l00518">CmpDiskFullWarningWorker()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l02173">CmpFindACPITable()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l02430">CmpFindRSDTTable()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01235">CmpFlushNotify()</a>, <a class="el" href="../../d8/d2/cmwrapr_8c-source.html#l00186">CmpFree()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01495">CmpFreeLineList()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03764">CmpFreePostBlock()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01558">CmpFreeSectionList()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l01439">CmpFreeValueList()</a>, <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l00076">CmpGetAcpiProfileInformation()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l02635">CmpGetRegistryValue()</a>, <a class="el" href="../../d3/d1/cmparse_8c-source.html#l01476">CmpGetSymbolicLink()</a>, <a class="el" href="../../d0/d2/cmsubs2_8c-source.html#l00403">CmpGetValueDataFromCache()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l01227">CmpHiveRootSecurityDescriptor()</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00087">CmpInitializeHardwareConfiguration()</a>, <a class="el" href="../../d9/d0/cminit_8c-source.html#l00471">CmpInitializeHive()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00726">CmpInitializeHiveList()</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00465">CmpInitializeMachineDependentConfiguration()</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00458">CmpInitializeRegistryNode()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02022">CmpInitializeSystemHive()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l00484">CmpLoadHiveVolatile()</a>, <a class="el" href="../../d3/d2/cmtrecpy_8c-source.html#l01150">CmpMergeKeyValues()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03603">CmpNameFromAttributes()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01378">CmpNotifyChangeKey()</a>, <a class="el" href="../../d9/d0/cminit_8c-source.html#l00046">CmpOpenHiveFiles()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l01264">CmpOpenRegKey()</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00744">CmpParseInfBuffer()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00487">CmpPostNotify()</a>, <a class="el" href="../../d9/d9/geninst_8c-source.html#l00776">CmpProcessBitRegLine()</a>, <a class="el" href="../../d6/d0/cmgquota_8c-source.html#l00166">CmpQuotaWarningWorker()</a>, <a class="el" href="../../d7/d0/cmhvlist_8c-source.html#l00188">CmpRemoveFromHiveFileList()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03458">CmpSaveBootControlSet()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l01261">CmpSaveKeyByFileCopy()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l00397">CmpSetSecurityDescriptorInfo()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l01383">CmpSetValueKeyExisting()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01545">CmpSetVersionData()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l04077">CmpValidateAlternate()</a>, <a class="el" href="../../d6/d2/cmworker_8c-source.html#l00115">CmpWorker()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l02293">CmReplaceKey()</a>, <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l00805">CmSetAcpiHwProfile()</a>, <a class="el" href="../../d9/d8/cmapi_8c-source.html#l02079">CmUnloadKey()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01955">ComPortDBAdd()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00211">DbgkCreateThread()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00136">DbgkpSectionHandleToFileHandle()</a>, <a class="el" href="../../d5/d9/tex_8c-source.html#l01468">DoPoolTest()</a>, <a class="el" href="../../d7/d7/fsvga_8c-source.html#l00053">DriverEntry()</a>, <a class="el" href="../../d6/d9/pnpeisa_8c-source.html#l00059">EisaBuildEisaDeviceNode()</a>, <a class="el" href="../../d6/d9/pnpeisa_8c-source.html#l00201">EisaGetEisaDevicesResources()</a>, <a class="el" href="../../d5/d4/logger_8c-source.html#l00062">ExCreateDebugLogTag()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02005">ExDeleteResourceLite()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02995">ExLockUserBuffer()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01475">ExpAllocateHandleTable()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01825">ExpAllocateHandleTableEntry()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02502">ExpAllocatePoolWithQuotaHandler()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02683">ExpFindCurrentThread()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01667">ExpFreeHandleTable()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l04104">ExpGetPoolTagInfo()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00145">ExpProfileDelete()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l04328">ExpQueryLegacyDriverInformation()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00064">ExpSystemErrorHandler()</a>, <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00378">ExRegisterCallback()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l03048">ExUnlockUserBuffer()</a>, <a class="el" href="../../d3/d3/ex_2callback_8c-source.html#l00479">ExUnregisterCallback()</a>, <a class="el" href="../../d6/d0/fat__rec_8c-source.html#l00043">FatRecFsControl()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00454">FindPathForDevice()</a>, <a class="el" href="../../d3/d1/drawscrn_8c-source.html#l00489">FsgWriteToFrameBuffer()</a>, <a class="el" href="../../d7/d6/fs__rec_8c-source.html#l00539">FsRecUnload()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02852">FsRtlAddLargeEntry()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01221">FsRtlAllocateOplock()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02555">FsRtlCancelNotify()</a>, <a class="el" href="../../d6/d8/unc_8c-source.html#l00418">FsRtlDeregisterUncProvider()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00255">FsRtlFreeTunnelNode()</a>, <a class="el" href="../../d5/d7/fsrtlpc_8c-source.html#l00323">FsRtlGetCompatibilityModeValue()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l01371">FsRtlGetTunnelParameterValue()</a>, <a class="el" href="../../d2/d2/dbcsname_8c-source.html#l00771">FsRtlIsDbcsInExpression()</a>, <a class="el" href="../../d5/d4/name_8c-source.html#l00482">FsRtlIsNameInExpressionPrivate()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l01795">FsRtlNotifyCleanup()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02000">FsRtlNotifyCompleteIrp()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00547">FsRtlNotifyFullChangeDirectory()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00973">FsRtlNotifyFullReportChange()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00426">FsRtlNotifyUninitializeSync()</a>, <a class="el" href="../../d6/d8/unc_8c-source.html#l00104">FsRtlpRegisterProviderWithMUP()</a>, <a class="el" href="../../d6/d8/unc_8c-source.html#l00247">FsRtlRegisterUncProvider()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l03623">FsRtlRemoveAndCompleteWaitIrp()</a>, <a class="el" href="../../d5/d4/stackovf_8c-source.html#l00294">FsRtlStackOverflowRead()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00743">FsRtlTruncateLargeMcb()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00670">FsRtlUninitializeLargeMcb()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l00413">FsRtlUninitializeOplock()</a>, <a class="el" href="../../d7/d7/fsvga_8c-source.html#l00858">FsVgaServiceParameters()</a>, <a class="el" href="../../d7/d7/fsvga_8c-source.html#l01429">FsVgaWriteToFrameBuffer()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00326">GetNextReparseVolumePath()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l03735">HalpGetFullGeometry()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00851">HalpNextMountLetter()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l01078">HalpSetMountLetter()</a>, <a class="el" href="../../d1/d1/hivesync_8c-source.html#l01885">HvpDiscardBins()</a>, <a class="el" href="../../d1/d1/hivesync_8c-source.html#l00775">HvpDoWriteHive()</a>, <a class="el" href="../../d7/d0/hiveload_8c-source.html#l00311">HvpReadFileImageAndBuildMap()</a>, <a class="el" href="../../d7/d0/hiveload_8c-source.html#l00847">HvpRecoverData()</a>, <a class="el" href="../../d1/d1/hivesync_8c-source.html#l01025">HvpWriteLog()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l01322">InitCreateUserCrit()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l00328">IoAllocateDriverObjectExtension()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l01552">IoBuildDeviceIoControlRequest()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l03665">IoConnectInterrupt()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l04073">IoCreateDevice()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l04502">IoCreateFile()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l05951">IoDeleteDevice()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l06364">IoDisconnectInterrupt()</a>, <a class="el" href="../../d8/d4/ioerr_8c-source.html#l00414">IoepFreeErrStack()</a>, <a class="el" href="../../d8/d4/ioerr_8c-source.html#l01200">IoepGetErrCaseDB()</a>, <a class="el" href="../../d8/d4/ioerr_8c-source.html#l00039">IoepInitErrLog()</a>, <a class="el" href="../../d8/d4/ioerr_8c-source.html#l00255">IoepLogErr()</a>, <a class="el" href="../../d5/d4/ioeapi_8c-source.html#l00647">IoErrFreeSavedData()</a>, <a class="el" href="../../d5/d4/ioeapi_8c-source.html#l00452">IoErrGetErrData()</a>, <a class="el" href="../../d5/d4/ioeapi_8c-source.html#l00238">IoErrPropagateErrLog()</a>, <a class="el" href="../../d5/d4/ioeapi_8c-source.html#l00305">IoErrTerminateErrLog()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l01300">IoFreeDumpStack()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l06744">IoFreeMdl()</a>, <a class="el" href="../../d5/d0/pnppower_8c-source.html#l00352">IoFreePoDeviceNotifyList()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00924">IoFreeWorkItem()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l11641">IoGetBootDiskInformation()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l04946">IoGetDeviceInterfaceAlias()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l00373">IoGetDeviceProperty()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09712">IoGetLegacyVetoList()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l00270">IoInitSystem()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l07705">IoIsValidNameGraftingBuffer()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l00810">IoOpenDeviceRegistryKey()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l00720">IopAllocateResources()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l00383">IopApcHardError()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09357">IopAppendLegacyVeto()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l00546">IopAppendStringToValueKey()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l02209">IopApplyFunctionToServiceInstances()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01844">IopApplyFunctionToSubKeys()</a>, <a class="el" href="../../d6/d8/arcsec_8c-source.html#l00168">IopApplySystemPartitionProt()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l05016">IopArbitrateDeviceResources()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l02034">IopBuildCmResourceList()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l02525">IopCallDriverAddDevice()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l03165">IopCallDriverAddDeviceQueryRoutine()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l04759">IopChangeDeviceObjectFromRegistryProperties()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l00978">IopCheckDependencies()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l03933">IopChildToRootTranslation()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l01019">IopCompleteRequest()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l00657">IopCompleteUnloadOrDelete()</a>, <a class="el" href="../../d7/d0/pnprlist_8c-source.html#l00286">IopCompressRelationList()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l09157">IopCopyBootLogRegistryToFile()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l01047">IopCreateArcNames()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l06801">IopCreateCmResourceList()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l00091">IopCreateMadeupNode()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l01771">IopDeallocateApc()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00187">IopDelayedRemoveWorker()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00769">IopDeleteDevice()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00698">IopDeleteDriver()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00417">IopDeleteFile()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l05453">IopDeleteLegacyKey()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00232">IopDeleteLockedDeviceNode()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l06037">IopDeleteSessionSymLinks()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06600">IopDereferenceNotify()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00180">IopDereferenceVpbAndFree()</a>, <a class="el" href="../../d5/d6/devnode_8c-source.html#l00297">IopDestroyDeviceNode()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l00307">IopDeviceActionWorker()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l03759">IopDeviceObjectFromDeviceInstance()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l01496">IopDeviceRelationsComplete()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l01370">IopDeviceStartComplete()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09866">IopDoDeferredSetInterfaceState()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l08130">IopDoNameTransmogrify()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l02779">IopDriverLoadingFailed()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l01821">IopDropIrp()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l06528">IopDuplicateDetection()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01163">IopEnumerateDevice()</a>, <a class="el" href="../../d8/d6/errorlog_8c-source.html#l00660">IopErrorLogDpc()</a>, <a class="el" href="../../d8/d6/errorlog_8c-source.html#l00088">IopErrorLogThread()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l01934">IopExceptionCleanup()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l01028">IopExecuteHardwareProfileChange()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l04592">IopFilterResourceRequirementsList()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l05668">IopFreeAllocatedUnicodeString()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l02536">IopFreeBuffer()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l04252">IopFreeDCB()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02223">IopFreeGroupTree()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l06641">IopFreeIrp()</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00797">IopFreeMiniPacket()</a>, <a class="el" href="../../d5/d0/pnppower_8c-source.html#l00321">IopFreePoDeviceNotifyListHead()</a>, <a class="el" href="../../d7/d0/pnprlist_8c-source.html#l00709">IopFreeRelationList()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l01922">IopFreeReqAlternative()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l01948">IopFreeReqList()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l01988">IopFreeResourceRequirementsForAssignTable()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l02740">IopFreeUnicodeStringList()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l04425">IopGetBusTypeGuidIndex()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01477">IopGetDeviceInstanceCsConfigFlags()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l02707">IopGetDeviceInterfaces()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l04081">IopGetDeviceResourcesFromRegistry()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l01411">IopGetDriverDeviceList()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02072">IopGetDriverNameFromKeyNode()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l04120">IopGetDriverTagPriority()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l00384">IopGetDumpStack()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l05334">IopGetGroupOrderIndex()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09565">IopGetLegacyVetoListDrivers()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l04610">IopGetRegistryDwordWithFallback()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02462">IopGetRegistryKeyInformation()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l04679">IopGetRegistrySecurityWithFallback()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02546">IopGetRegistryValue()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l08036">IopGetRelatedTargetDevice()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l01066">IopGetResourceRequirementsForAssignTable()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00680">IopGetRootDevices()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01591">IopGetServiceInstanceCsConfigFlags()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l01454">IopGetServiceType()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02977">IopHardErrorThread()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00465">IopHardwareProfileCommitRemovedDock()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00160">IopHardwareProfileMarkDock()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02327">IopInitializeBootDrivers()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l04580">IopInitializeDCB()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00879">IopInitializeDeviceInstanceKey()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>, <a class="el" href="../../d2/d7/report_8c-source.html#l00066">IopInitializeResourceMap()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l03146">IopInitializeSystemDrivers()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06387">IopInvalidateDeviceStateWorker()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l03181">IopIsAnyDeviceInstanceEnabled()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l03443">IopIsDeviceInstanceEnabled()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l01572">IopIsFirmwareMapperDevicePresent()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l02286">IopIsReportedAlready()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l06180">IopLegacyResourceAllocation()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l04654">IopLoadBootFilterDriver()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l03200">IopLoadDriver()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l00954">IopLoadDumpDriver()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l04169">IopLoadUnloadDriver()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l01891">IopMakeGloballyUniqueId()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09221">IoPnPDeliverServicePowerNotification()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l08501">IopOpenDeviceParametersSubkey()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l00753">IopPrepareDriverLoading()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l01185">IopProcessAssignResources()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l01417">IopProcessCompletedEject()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l04000">IopProcessCriticalDeviceRoutine()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l05954">IopProcessDeferredRegistrations()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01538">IopProcessNewDeviceNode()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l05109">IopProcessNewProfileWorker()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00917">IopProcessRelation()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09922">IopProcessSetInterfaceState()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l08336">IopQueryConflictListInternal()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l02262">IopQueryDeviceResources()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l03395">IopQueryDockRemovalInterface()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l02793">IopQueryLegacyBusInformation()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l01811">IopQueryName()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l02885">IopQueryPnpBusInformation()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l04589">IopQueryRebalance()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l02617">IopQueryResourceHandlerInterface()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l05617">IopRaiseHardError()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l05841">IopRaiseInformationalHardError()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l04283">IopReadDeviceConfiguration()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l04379">IopReadDumpRegistry()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l03491">IopRealloc()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l07470">IopReallocateResources()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l05215">IopRebalance()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l02474">IopReleaseFilteredBootResources()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l07383">IopReleaseResources()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l04414">IopRemoveDeviceInterfaces()</a>, <a class="el" href="../../d7/d0/pnprlist_8c-source.html#l01013">IopRemoveIndirectRelationsFromList()</a>, <a class="el" href="../../d7/d0/pnprlist_8c-source.html#l01090">IopRemoveRelationFromList()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l00449">IopRemoveStringFromValueKey()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06242">IopReportTargetDeviceChangeAsyncWorker()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01520">IopRequestDeviceEjectWorker()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l07291">IopReserveBootResources()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l07198">IopReserveBootResourcesInternal()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l06996">IopReserveLegacyBootResources()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l02467">IopResizeBuffer()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l05777">IopRestartDeviceNode()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l05660">IopRestoreResourcesInternal()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l08822">IopSafebootDriverLoad()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l00931">IopServiceInstanceToDeviceInstance()</a>, <a class="el" href="../../d5/d5/netboot_8c-source.html#l04017">IopSetDefaultGateway()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00877">IopSetDeviceSecurityDescriptors()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06326">IopSetEaOrQuotaInformationFile()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l08959">IopSetSecurityObjectFromRegistry()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l00994">IopStartAndEnumerateDevice()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06870">IopStartApcHardError()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l01740">IopStartDriverDevices()</a>, <a class="el" href="../../d5/d5/netboot_8c-source.html#l00770">IopStartNetworkForRemoteBoot()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06926">IopSynchronousApiServiceTail()</a>, <a class="el" href="../../d5/d5/netboot_8c-source.html#l04458">IopTCPSetInformationEx()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l07272">IopTrackLink()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l04129">IopTranslateAndAdjustReqDesc()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00191">IopUncacheInterfaceInformation()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l01755">IopUnloadAttachedDriver()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l04140">IopUnregisterDeviceInterface()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00862">IopUpdateHardwareProfile()</a>, <a class="el" href="../../d3/d2/io_2query_8c-source.html#l00070">IoQueryDeviceDescription()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l08909">IoRaiseInformationalHardError()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l07495">IoRegisterPlugPlayNotification()</a>, <a class="el" href="../../d8/d6/io_2remlock_8c-source.html#l00394">IoReleaseRemoveLockAndWaitEx()</a>, <a class="el" href="../../d8/d6/io_2remlock_8c-source.html#l00244">IoReleaseRemoveLockEx()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01548">IoReportDetectedDevice()</a>, <a class="el" href="../../d2/d7/report_8c-source.html#l00469">IoReportResourceUsageInternal()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l10359">IoShutdownSystem()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l11178">IoUnregisterFsRegistrationChange()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l05829">IoUnregisterPlugPlayNotification()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l11239">IoUnregisterShutdownNotification()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l02499">IovpInternalCompleteAfterWait()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l02555">IovpInternalDeferredCompletion()</a>, <a class="el" href="../../d9/d7/hashirp_8c-source.html#l00744">IovpProtectedIrpMakeUntouchable()</a>, <a class="el" href="../../d6/d6/sessnirp_8c-source.html#l00152">IovpSessionDataDereference()</a>, <a class="el" href="../../d8/d3/flunkirp_8c-source.html#l01392">IovpThrowChaffAtStartedPdoStack()</a>, <a class="el" href="../../d9/d7/hashirp_8c-source.html#l00232">IovpTrackingDataFree()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l11556">IoWriteErrorLogEntry()</a>, <a class="el" href="../../d5/d7/udfs__rec_8c-source.html#l00157">IsUdfsVolume()</a>, <a class="el" href="../../d4/d0/biosc_8c-source.html#l00060">Ke386CallBios()</a>, <a class="el" href="../../d3/d9/ke_2i386_2misc_8c-source.html#l00366">KeRestoreFloatingPointState()</a>, <a class="el" href="../../d6/d0/i386_2thredini_8c-source.html#l00454">KeSetAutoAlignmentThread()</a>, <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00078">KeStartAllProcessors()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00289">KeStartProfile()</a>, <a class="el" href="../../d1/d7/profobj_8c-source.html#l00520">KeStopProfile()</a>, <a class="el" href="../../d9/d3/mtrr_8c-source.html#l00992">KiAddRange()</a>, <a class="el" href="../../d9/d3/mtrr_8c-source.html#l01112">KiCompleteEffectiveRangeChange()</a>, <a class="el" href="../../d9/d3/mtrr_8c-source.html#l00275">KiInitializeMTRR()</a>, <a class="el" href="../../d9/d6/lfs_2strucsup_8c-source.html#l00402">LfsDeallocateLbcb()</a>, <a class="el" href="../../d9/d6/lfs_2strucsup_8c-source.html#l00518">LfsDeallocateLcb()</a>, <a class="el" href="../../d9/d6/lfs_2strucsup_8c-source.html#l00188">LfsDeallocateLfcb()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l01063">LfsDeleteLogHandle()</a>, <a class="el" href="../../d8/d9/rstrtsup_8c-source.html#l00036">LfsWriteLfsRestart()</a>, <a class="el" href="../../d4/d6/lpcqueue_8c-source.html#l00104">LpcpDestroyPortQueue()</a>, <a class="el" href="../../d4/d6/lpcqueue_8c-source.html#l00397">LpcpExtendPortZone()</a>, <a class="el" href="../../d4/d6/lpcqueue_8c-source.html#l00287">LpcpInitializePortZone()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01803">MapperAdjustResourceList()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00658">MapperCallback()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01600">MapperConstructRootEnumTree()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01549">MapperFreeList()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01091">MapperMarkKey()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00535">MapperPeripheralCallback()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l02060">MapperPhantomizeDetectedComPorts()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l04107">MiAllocateContiguousMemory()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l03326">MiBuildImportsForBootDrivers()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l02313">MiCleanPhysicalProcessPages()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02693">MiClearImports()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l00100">MiCloneProcessAddressSpace()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l03553">MiCreateDataFileMap()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l01424">MiCreateImageFileMap()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l04018">MiCreatePagingFileMap()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l04202">MiCreatePebOrTeb()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l01745">MiDecrementCloneBlockReference()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l03822">MiDereferenceImports()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00603">MiDereferenceSegmentThread()</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00758">MiDoPoolCopy()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l04569">MiFindContiguousMemory()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l02487">MiFlushEventCounter()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l04301">MiFlushInPageSupportBlock()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l01041">MiFreeMdlTracker()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l04478">MiFreeSessionPoolBitMaps()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l04071">MiFreeSessionSpaceMap()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l04152">MiGetInPageSupportBlock()</a>, <a class="el" href="../../d6/d2/queryvm_8c-source.html#l00890">MiGetWorkingSetInfo()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l06591">MiInitializeLoadedModuleList()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l03757">MiInsertInSystemSpace()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l02785">MiMapLockedPagesInUserSpace()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l02256">MiMapViewOfDataSection()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l01567">MiMapViewOfImageSection()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l01028">MiMapViewOfPhysicalSection()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l02641">MiPhysicalViewRemover()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l01859">MiReleaseDeadPteTrackers()</a>, <a class="el" href="../../d5/d8/umapview_8c-source.html#l00265">MiRemoveMappedView()</a>, <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00256">MiRemoveVad()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l03953">MiResolveImageReferences()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00768">MiSectionInitialization()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00191">MiSegmentDelete()</a>, <a class="el" href="../../d5/d6/sessload_8c-source.html#l00461">MiSessionRemoveImage()</a>, <a class="el" href="../../d5/d6/sessload_8c-source.html#l00802">MiSessionWideDereferenceImage()</a>, <a class="el" href="../../d5/d6/sessload_8c-source.html#l00683">MiSessionWideInsertImageAddress()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l04464">MiSnapThunk()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03253">MiUnmapLockedPagesInUserSpace()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03982">MiVerifierCheckThunks()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03625">MiVerifyingDriverUnloading()</a>, <a class="el" href="../../d0/d3/dynmem_8c-source.html#l00043">MmAddPhysicalMemory()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03846">MmAddVerifierThunks()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l04270">MmAllocatePagesForMdl()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l06717">MmCallDllInitialize()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l01695">MmCleanProcessAddressSpace()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l00390">MmCreateSection()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l04843">MmDeleteTeb()</a>, <a class="el" href="../../d9/d9/extsect_8c-source.html#l00201">MmExtendSection()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l05372">MmFreeContiguousMemory()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l05414">MmFreeContiguousMemorySpecifyCache()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l01721">MmGetFileNameForSection()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l00911">MmInitializeProcessAddressSpace()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l02058">MmMapLockedPagesSpecifyCache()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l07516">MmMapVideoDisplay()</a>, <a class="el" href="../../d0/d3/dynmem_8c-source.html#l00437">MmRemovePhysicalMemory()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l04177">MmSecureVirtualMemory()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02896">MmUnloadSystemImage()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l07751">MmUnmapVideoDisplay()</a>, <a class="el" href="../../d5/d8/umapview_8c-source.html#l00090">MmUnmapViewOfSection()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l04614">MmUnsecureVirtualMemory()</a>, <a class="el" href="../../d7/d7/exatom_8c-source.html#l00045">NtAddAtom()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l00970">NtAllocateUserPhysicalPages()</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l00075">NtAllocateVirtualMemory()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02492">NtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l00297">NtCreatePagingFile()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02627">NtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d7/d7/exatom_8c-source.html#l00152">NtFindAtom()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00386">NtFlushBuffersFile()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l01624">NtFreeUserPhysicalPages()</a>, <a class="el" href="../../d4/d6/freevm_8c-source.html#l00066">NtFreeVirtualMemory()</a>, <a class="el" href="../../d3/d7/ntfs__rec_8c-source.html#l00042">NtfsRecFsControl()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00035">NtLoadDriver()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02881">NtLoadKey2()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l00085">NtMapUserPhysicalPages()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l00498">NtMapUserPhysicalPagesScatter()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00458">NtOpenThreadToken()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00731">NtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00406">NtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l00229">NtQueryDirectoryObject()</a>, <a class="el" href="../../d8/d1/qsea_8c-source.html#l00035">NtQueryEaFile()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00101">NtQueryInformationFile()</a>, <a class="el" href="../../d1/d2/qsquota_8c-source.html#l00035">NtQueryQuotaInformationFile()</a>, <a class="el" href="../../d6/d7/sysenv_8c-source.html#l00045">NtQuerySystemEnvironmentValue()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00037">NtQueryVolumeInformationFile()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00056">NtQueueApcThread()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00532">NtRaiseHardError()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00730">NtReadFileScatter()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03336">NtReplaceKey()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>, <a class="el" href="../../d8/d1/qsea_8c-source.html#l00652">NtSetEaFile()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00849">NtSetInformationFile()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l01235">NtSetLdtEntries()</a>, <a class="el" href="../../d6/d7/sysenv_8c-source.html#l00305">NtSetSystemEnvironmentValue()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02672">NtSetValueKey()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00492">NtSetVolumeInformationFile()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00517">NtStartProfile()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00680">NtStopProfile()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00244">NtUnloadDriver()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00458">NtUnlockFile()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00406">NtWaitForMultipleObjects()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00801">NtWriteFileGather()</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00069">ObCreateObjectType()</a>, <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00416">ObDereferenceDeviceMap()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01258">ObGetObjectSecurity()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00438">ObpCaptureObjectName()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l01009">ObpDeleteDirectoryEntry()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01497">ObpDeleteNameCheck()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00904">ObpDeleteSymbolicLink()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00759">ObpDestroySecurityDescriptorHeader()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l01805">ObpFreeDosDevicesProtection()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l01098">ObpFreeObject()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00663">ObpFreeObjectNameBuffer()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00118">ObpInitSecurityDescriptorCache()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00908">ObpInsertHandleCount()</a>, <a class="el" href="../../d9/d0/obsdata_8c-source.html#l00297">ObpLogSecurityDescriptor()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l01081">ObpLookupObjectName()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l00501">ObpParseSymbolicLink()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l01121">ObpProcessDosDeviceSymbolicLink()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01370">ObpRemoveObjectRoutine()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01418">ObReleaseObjectSecurity()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01748">ObSetSecurityDescriptorInfo()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00225">OpenDeviceReparseIndex()</a>, <a class="el" href="../../d3/d2/io_2query_8c-source.html#l00223">pIoQueryBusDescription()</a>, <a class="el" href="../../d3/d2/io_2query_8c-source.html#l00565">pIoQueryDeviceDescription()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02089">PnPBiosCopyDeviceParamKey()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02663">PnPBiosCopyIoDecode()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01725">PnPBiosEliminateDupes()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02956">PnPBiosFreeDevNodeInfo()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00399">PnPBiosGetBiosInfo()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l03008">PnPBiosMapper()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01126">PnPBiosTranslateInfo()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02289">PnPBiosWriteInfo()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00788">PnPCheckFixedIoOverrideDecodes()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00603">PsExitSpecialApc()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00730">Psp386CreateVdmIoListHead()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00477">Psp386InstallIoHandler()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02210">PspApplyJobLimitsToProcessSet()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02680">PspCaptureTokenFilter()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l01202">PspDeleteLdt()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01436">PspDeleteThreadSecurity()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00203">PspDeleteVdmObjects()</a>, <a class="el" href="../../d1/d1/psquota_8c-source.html#l00494">PspDereferenceQuota()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00631">PspExitNormalApc()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00636">PspJobDelete()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00580">PspNullSpecialApc()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01363">PspProcessDelete()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00040">PspQueueApcSpecialApc()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00503">PspSetLdtInformation()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00308">PspSetLdtSize()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01211">PspSetQuotaLimits()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00160">PspTerminateThreadByPointer()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01800">PspUserThreadStartup()</a>, <a class="el" href="../../d1/d1/psquota_8c-source.html#l00174">PsReturnSharedPoolQuota()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00149">QueryDeviceNameForPath()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00094">QuerySymbolicLink()</a>, <a class="el" href="../../d5/d6/rtl_2regutil_8c-source.html#l00679">RtlpAllocDeallocQueryBuffer()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l06266">RtlpComputeMergedAcl()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l07461">RtlpConvertAclToAutoInherit()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l06520">RtlpConvertToAutoInheritSecurityObject()</a>, <a class="el" href="../../d1/d9/rtl_2atom_8c-source.html#l00042">RtlpFreeAtom()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l05153">RtlpInheritAcl()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l10195">RtlpSetSecurityObject()</a>, <a class="el" href="../../d9/d6/rtl_2remlock_8c-source.html#l00204">RtlReleaseRemoveLock()</a>, <a class="el" href="../../d9/d6/rtl_2remlock_8c-source.html#l00328">RtlReleaseRemoveLockAndWait()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00580">RtlVolumeDeviceToDosName()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l02704">SeAccessCheckByType()</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00434">SeAppendPrivileges()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01370">SeCaptureAcl()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01608">SeCaptureLuidAndAttributesArray()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l00144">SeCaptureObjectTypeList()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00053">SeCaptureSecurityDescriptor()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00953">SeCaptureSecurityQos()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01141">SeCaptureSid()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01850">SeCaptureSidAndAttributesArray()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03538">SeCreateObjectAuditAlarm()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00373">SeDeassignSecurity()</a>, <a class="el" href="../../d3/d4/seastate_8c-source.html#l00348">SeDeleteAccessState()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l00353">SeFreeCapturedObjectTypeList()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00910">SeFreeCapturedSecurityQos()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03294">SeFreePrivileges()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l01010">SeMakeAnonymousLogonToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02765">SeOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03085">SeOpenObjectForDeleteAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00117">SepAdtInitializeBounds()</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01907">SepAdtObjectReferenceAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00571">SepAdtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00681">SepCopyProxyData()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00541">SepCreateLogonSessionTrack()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00655">SepDeleteLogonSessionTrack()</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00738">SepDequeueWorkItem()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00384">SepDeReferenceLogonSession()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00362">SepDuplicateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00370">SepFreeCapturedString()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00737">SepFreeProxyData()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00777">SepInformLsaOfDeletedLogon()</a>, <a class="el" href="../../d0/d5/seinit_8c-source.html#l00184">SepInitializationPhase1()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l01107">SepNotifyFileSystems()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00773">SepProbeAndCaptureQosData()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00259">SepProbeAndCaptureString_U()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02324">SepQueryNameString()</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00907">SepRmCallLsa()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02156">SepTokenDeleteMethod()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01560">SeReleaseAcl()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01797">SeReleaseLuidAndAttributesArray()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00631">SeReleaseSecurityDescriptor()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l01320">SeReleaseSid()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l02297">SeReleaseSidAndAttributesArray()</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00060">SeRmInitPhase1()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00908">SeUnregisterLogonSessionTerminatedRoutine()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l01456">SmbTraceCompleteRdr()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l01242">SmbTraceCompleteSrv()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l01760">SmbTraceDeferredDereferenceHeap()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l01949">SmbTraceEmptyQueue()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l00438">SmbTraceInitialize()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l00509">SmbTraceTerminate()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l02020">SmbTraceThreadEntry()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00296">TestCaptureSecurityDescriptor()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00205">TestDefaultObjectMethod()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00105">TestMakeSystemToken()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00131">TestTokenCopy()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00177">TestTokenSize()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l04446">UdfDeallocateTable()</a>, <a class="el" href="../../d3/d5/allocsup_8c-source.html#l00309">UdfDeletePcb()</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l00453">UdfFreePool()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l00809">UdfNormalizeFileNames()</a>, <a class="el" href="../../d6/d3/prefxsup_8c-source.html#l00256">UdfRemovePrefix()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00477">UdfUpdateVcbPhase0()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01235">VdmpDelayInterrupt()</a>, <a class="el" href="../../d8/d3/vdminit_8c-source.html#l00019">VdmpInitialize()</a>, <a class="el" href="../../d4/d3/vdm_2vdm_8c-source.html#l00087">VdmQueryDirectoryFile()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02129">VerifierFreePool()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l01233">ViReservePoolAllocation()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l00773">Win32KDriverUnload()</a>, <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l00097">Win32kNtUserCleanup()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00190">xHalExamineMBR()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00382">xHalGetPartialGeometry()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l01243">xHalIoAssignDriveLetters()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l03486">xHalIoClearPartitionTable()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l01739">xHalIoReadPartitionTable()</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l02485">xHalIoSetPartitionInformation()</a>, and <a class="el" href="../../d8/d1/drivesup_8c-source.html#l02879">xHalIoWritePartitionTable()</a>.
<p>
<pre class="fragment"><div>00976                    :
00977 
00978     This function deallocates a block of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>.  This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to
00979     deallocate to both <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page aligned pools, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> binary buddy
00980     (less than a page) pools.
00981 
00982     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> block being deallocated <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> page-aligned, then
00983     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page-aliged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> deallocator <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used.
00984 
00985     Otherwise, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> binary buddy <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> deallocator <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used.  Deallocation
00986     looks at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocated block's <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> header to determine <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
00987     <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> and block size being deallocated.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> was allocated
00988     <span class="keyword">using</span> <a class="code" href="../../d5/d5/cc_8h.html#a11">ExAllocatePoolWithQuota</a>, then after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> deallocation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00989     complete, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate process's <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> adjusted to reflect
00990     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> deallocation, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> dereferenced.
00991 
00992 Arguments:
00993 
00994     P - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> block of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> being deallocated.
00995 
00996 Return Value:
00997 
00998     None.
00999 
01000 --*/
01001 
01002 {
01003     <a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a> Entry;
01004     <a class="code" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType;
01005     KIRQL LockHandle;
01006     PVOID <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>;
01007     <a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a> PoolDesc;
01008 
01009     KIRQL OldIrql;
01010     BOOLEAN ReleaseSpinLock = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01011     <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> PointerPte;
01012     <a class="code" href="../../d4/d3/struct__MMPFN.html">PMMPFN</a> Pfn1;
01013 
01014 <span class="preprocessor">#ifdef TRACE_ALLOC</span>
01015 <span class="preprocessor"></span>
01016     PULONG xFp, xPrevFp, xR1, xPrevR1;
01017 
01018     xFp = RtlpGetFramePointer();
01019     xR1 = (PULONG)*(xFp+1);
01020     xPrevFp = (PULONG)*xFp;
01021     xPrevR1 = (PULONG)*(xPrevFp+1);
01022 
01023 <span class="preprocessor">#endif // TRACE_ALLOC</span>
01024 <span class="preprocessor"></span>
01025     <span class="comment">//</span>
01026     <span class="comment">// If Entry is page aligned, then call page aligned pool</span>
01027     <span class="comment">//</span>
01028 
01029     <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d2/poolhack_8c.html#a5">PAGE_ALIGNED</a>(P) ) {
01030 
01031         PoolType = <a class="code" href="../../d1/d6/allocpag_8c.html#a48">MmDeterminePoolType</a>(P);
01032 
01033         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a> = <a class="code" href="../../d2/d2/ex_2pool_8c.html#a54">PoolVector</a>[PoolType]-&gt;<a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html#o3">LockAddress</a>;
01034 
01035         <a class="code" href="../../d2/d2/ex_2pool_8c.html#a33">LOCK_POOL</a>(Lock,PoolType,LockHandle);
01036         <a class="code" href="../../d1/d6/allocpag_8c.html#a55">MiFreePoolPages</a> (P);
01037         <a class="code" href="../../d2/d2/ex_2pool_8c.html#a35">UNLOCK_POOL</a>(Lock,PoolType,LockHandle,FALSE);
01038         <span class="keywordflow">return</span>;
01039     }
01040 
01041     PointerPte = <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a153">MiGetPteAddress</a> (P);
01042 
01043     <span class="keywordflow">if</span> (PointerPte-&gt;<a class="code" href="../../d2/d4/struct__MMPTE.html#o8">u</a>.Hard.Valid == 0) {
01044         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"bad pool deallocation\n"</span>);
01045         <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a> (12345);
01046     }
01047 
01048     <span class="keywordflow">if</span> (KeGetCurrentIrql() &gt;= 2) {
01049         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"deallocating pool at irql &gt;= 2\n"</span>);
01050         ReleaseSpinLock = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01051     } <span class="keywordflow">else</span> {
01052         <a class="code" href="../../d4/d9/ke_8h.html#a37">KeAcquireSpinLock</a> ( &amp;MmPfnLock, &amp;OldIrql);
01053     }
01054 
01055     <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a6">KeSweepDcache</a>(TRUE);
01056 
01057     Pfn1 = <a class="code" href="../../d4/d8/mi_8h.html#a111">MI_PFN_ELEMENT</a> (PointerPte-&gt;<a class="code" href="../../d2/d4/struct__MMPTE.html#o8">u</a>.Hard.PageFrameNumber);
01058     Pfn1-&gt;<a class="code" href="../../d4/d3/struct__MMPFN.html#o6">PteAddress</a> = (<a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a>)<a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>;
01059     <a class="code" href="../../d4/d8/mi_8h.html#a241">MiDecrementShareCountOnly</a> (PointerPte-&gt;<a class="code" href="../../d2/d4/struct__MMPTE.html#o8">u</a>.Hard.PageFrameNumber);
01060     *PointerPte = <a class="code" href="../../d4/d2/datalpha_8c.html#a0">ZeroPte</a>;
01061     <a class="code" href="../../d0/d9/sysptes_8c.html#a26">MiReleaseSystemPtes</a> (PointerPte, 2, SystemPteSpace);
01062     <span class="comment">//</span>
01063     <span class="comment">// BUGBUG Fix for MP.</span>
01064     <span class="comment">//</span>
01065     <a class="code" href="../../d0/d0/ki_8h.html#a114">KiFlushSingleTb</a> (P,TRUE);
01066     <span class="keywordflow">if</span> (ReleaseSpinLock) {
01067         <a class="code" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock</a> ( &amp;MmPfnLock, OldIrql );
01068     }
01069     <span class="keywordflow">return</span>;
01070 
01071     Entry = (<a class="code" href="../../d5/d8/struct__POOL__HEADER.html">PPOOL_HEADER</a>)((PCH)P - <a class="code" href="../../d5/d2/poolhack_8c.html#a6">POOL_OVERHEAD</a>);
01072 
01073     PoolType = Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o1">PoolType</a>;
01074 
01075     PoolDesc = <a class="code" href="../../d2/d2/ex_2pool_8c.html#a54">PoolVector</a>[PoolType];
01076     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a> = PoolDesc-&gt;<a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html#o3">LockAddress</a>;
01077 
01078     <span class="comment">//</span>
01079     <span class="comment">// Sanity Check pool header</span>
01080     <span class="comment">//</span>
01081 
01082     <span class="keywordflow">if</span> ( (Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a> == 0) || (Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o1">PoolType</a> &gt;= <a class="code" href="../../d5/d8/ex_8h.html#a329a180">MaxPoolType</a>) ) {
01083         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Invalid pool header 0x%lx 0x%lx\n"</span>,P,*(PULONG)P);
01084         <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(BAD_POOL_HEADER);
01085         <span class="keywordflow">return</span>;
01086     }
01087 
01088     <span class="keywordflow">if</span> ( (ULONG)P &amp; 0x0000000f != 8 ) {
01089         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Misaligned Deallocation 0x%lx\n"</span>,P);
01090         <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(BAD_POOL_HEADER);
01091         <span class="keywordflow">return</span>;
01092     }
01093 
01094 <span class="preprocessor">#ifdef TRACE_ALLOC</span>
01095 <span class="preprocessor"></span>    {
01096         KIRQL xIrql;
01097         PLIST_ENTRY Next, Target;
01098         BOOLEAN Found;
01099 
01100         <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(APC_LEVEL, &amp;xIrql);
01101 
01102         <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>(
01103             &amp;TracePoolLock,
01104             PoolAllocation,
01105             KernelMode,
01106             FALSE,
01107             NULL
01108             );
01109 
01110         Found = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01111         Target = &amp;Entry-&gt;TraceLinks;
01112         Next = TracePoolListHead[PoolType].Flink;
01113         <span class="keywordflow">while</span>( Next != &amp;TracePoolListHead[PoolType] ){
01114             <span class="keywordflow">if</span> ( Next == Target ) {
01115 
01116                 RemoveEntryList(&amp;Entry-&gt;TraceLinks);
01117                 Found = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01118                 <span class="keywordflow">break</span>;
01119             }
01120             Next = Next-&gt;Flink;
01121         }
01122 
01123         <span class="keywordflow">if</span> ( !Found ) {
01124             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Block Not in Allocated Pool List 0x%lx\n"</span>,P);
01125             <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(BAD_POOL_HEADER);
01126             <span class="keywordflow">return</span>;
01127         }
01128 
01129         DeallocTrace[NextDeallocTrace].BufferAddress = P;
01130         DeallocTrace[NextDeallocTrace].Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
01131         DeallocTrace[NextDeallocTrace].xR1 = xR1;
01132         DeallocTrace[NextDeallocTrace++].xPrevR1 = xPrevR1;
01133         <span class="keywordflow">if</span> ( NextDeallocTrace &gt;= MAXTRACE ) {
01134             NextDeallocTrace = 0;
01135         }
01136 
01137         (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d1/d6/semphobj_8c.html#a3">KeReleaseSemaphore</a>(
01138                     &amp;TracePoolLock,
01139                     0L,
01140                     1L,
01141                     FALSE
01142                     );
01143         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(xIrql);
01144 
01145     }
01146 <span class="preprocessor">#endif // TRACE_ALLOC</span>
01147 <span class="preprocessor"></span>
01148 <span class="preprocessor">#ifndef TRACE_ALLOC</span>
01149 <span class="preprocessor"></span>
01150     <span class="comment">//</span>
01151     <span class="comment">// Check ProcessBilled flag to see if quota was charged on</span>
01152     <span class="comment">// this allocation</span>
01153     <span class="comment">//</span>
01154 
01155     <span class="keywordflow">if</span> ( Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o2">ProcessBilled</a> ) {
01156 
01157         <a class="code" href="../../d0/d2/psquota_8c.html#a3">PsReturnPoolQuota</a>(
01158             Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o2">ProcessBilled</a>,
01159             BasePoolTypeTable[PoolType],
01160             (1 &lt;&lt; Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o0">LogAllocationSize</a>)
01161             );
01162 
01163         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(Entry-&gt;<a class="code" href="../../d5/d8/struct__POOL__HEADER.html#o2">ProcessBilled</a>);
01164 
01165     }
01166 <span class="preprocessor">#endif // TRACE_ALLOC</span>
01167 <span class="preprocessor"></span>
01168     <a class="code" href="../../d2/d2/ex_2pool_8c.html#a33">LOCK_POOL</a>(Lock,PoolType,LockHandle);
01169 
01170     <a class="code" href="../../d5/d2/poolhack_8c.html#a27">DeallocatePoolInternal</a>(PoolDesc,Entry);
01171 
01172     <a class="code" href="../../d2/d2/ex_2pool_8c.html#a35">UNLOCK_POOL</a>(Lock,PoolType,LockHandle,FALSE);
01173 
01174 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="poolhack.c::ExLockPool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KIRQL ExLockPool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PoolType</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00190">190</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00050">BASE_POOL_TYPE_MASK</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02007">KeAcquireSpinLock</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00125">_POOL_DESCRIPTOR::LockAddress</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00440">NonPagedPoolDescriptor</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a175">NonPagedPoolMustSucceed</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d4/d9/ke_8h.html#a407a201">PoolAllocation</a>, and <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00451">PoolVector</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/allocpag_8c-source.html#l04569">MiFindContiguousMemory()</a>.
<p>
<pre class="fragment"><div>00196                    :
00197 
00198     This function locks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> specified by <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
00199 
00200 Arguments:
00201 
00202     PoolType - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> that should be locked.
00203 
00204 Return Value:
00205 
00206     Opaque - Returns a lock handle that must be returned in a subsequent
00207              call to <a class="code" href="../../d2/d2/ex_2pool_8c.html#a72">ExUnlockPool</a>.
00208 
00209 --*/
00210 
00211 {
00212 
00213     KIRQL Irql;
00214 
00215     <span class="keywordflow">if</span> ( PoolType == <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a> || PoolType == <a class="code" href="../../d5/d8/ex_8h.html#a329a175">NonPagedPoolMustSucceed</a> ) {
00216 
00217         <span class="comment">//</span>
00218         <span class="comment">// Spin Lock locking</span>
00219         <span class="comment">//</span>
00220 
00221         <a class="code" href="../../d4/d9/ke_8h.html#a37">KeAcquireSpinLock</a>((PKSPIN_LOCK)PoolVector[PoolType]-&gt;LockAddress, &amp;Irql);
00222         <span class="keywordflow">return</span> Irql;
00223     } <span class="keywordflow">else</span> {
00224 
00225         <span class="comment">//</span>
00226         <span class="comment">// Mutex Locking</span>
00227         <span class="comment">//</span>
00228 
00229         <a class="code" href="../../d9/d5/verifier_8c.html#a116">KeRaiseIrql</a>(APC_LEVEL, &amp;Irql);
00230 
00231         <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>(
00232             PoolVector[PoolType]-&gt;LockAddress,
00233             PoolAllocation,
00234             KernelMode,
00235             FALSE,
00236             NULL
00237             );
00238 
00239         <span class="keywordflow">return</span> Irql;
00240     }
00241 
00242 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="poolhack.c::ExpAllocatePoolWithQuotaHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG ExpAllocatePoolWithQuotaHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NTSTATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolAddress</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00651">651</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00056">EXCEPTION_CONTINUE_SEARCH</a>, and <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00694">ExAllocatePoolWithQuota()</a>, and <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02607">ExAllocatePoolWithQuotaTag()</a>.
<p>
<pre class="fragment"><div>00658                    :
00659 
00660     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called when an exception occurs in <a class="code" href="../../d6/d3/cmwraper_8c.html#a26">ExFreePool</a>
00661     <span class="keywordflow">while</span> quota <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being charged to a process.
00662 
00663     Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to deallocate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> block and <span class="keywordflow">continue</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> search
00664     <span class="keywordflow">for</span> an exception handler.
00665 
00666 Arguments:
00667 
00668     ExceptionCode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception code that caused <span class="keyword">this</span>
00669         function to be entered.
00670 
00671     PoolAddress - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> block that needs to be
00672         deallocated.
00673 
00674 Return Value:
00675 
00676     <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a> - The exception should be propagated to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00677         caller of <a class="code" href="../../d5/d5/cc_8h.html#a11">ExAllocatePoolWithQuota</a>.
00678 
00679 --*/
00680 
00681 {
00682     <span class="keywordflow">if</span> ( PoolAddress ) {
00683         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ExceptionCode == STATUS_QUOTA_EXCEEDED);
00684         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(PoolAddress);
00685     } <span class="keywordflow">else</span> {
00686         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(ExceptionCode == STATUS_INSUFFICIENT_RESOURCES);
00687     }
00688     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>;
00689 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="poolhack.c::ExpInterlockedTryAllocatePool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PLIST_ENTRY ExpInterlockedTryAllocatePool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLIST_ENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>List</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KSPIN_LOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>Lock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SizeOffset</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="poolhack.c::ExQueryPoolUsage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExQueryPoolUsage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PagedPoolPages</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NonPagedPoolPages</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l01493">1493</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a175">NonPagedPoolMustSucceed</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00106">pd</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00451">PoolVector</a>, and <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00102">PPOOL_DESCRIPTOR</a>.
<p>
<pre class="fragment"><div>01497 {
01498     <a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a> <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>;
01499 
01500     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a> = <a class="code" href="../../d2/d2/ex_2pool_8c.html#a54">PoolVector</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>];
01501     *PagedPoolPages = <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>-&gt;TotalPages;
01502     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a> = <a class="code" href="../../d2/d2/ex_2pool_8c.html#a54">PoolVector</a>[PagedPoolMustSucceed];
01503     *PagedPoolPages += <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>-&gt;TotalPages;
01504 
01505     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a> = <a class="code" href="../../d2/d2/ex_2pool_8c.html#a54">PoolVector</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>];
01506     *NonPagedPoolPages = <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>-&gt;TotalPages;
01507     <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a> = <a class="code" href="../../d2/d2/ex_2pool_8c.html#a54">PoolVector</a>[<a class="code" href="../../d5/d8/ex_8h.html#a329a175">NonPagedPoolMustSucceed</a>];
01508     *NonPagedPoolPages += <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a26">pd</a>-&gt;TotalPages;
01509 
01510 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="poolhack.c::ExUnlockPool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExUnlockPool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>LockHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Wait</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00262">262</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00310">KeReleaseMutex()</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a175">NonPagedPoolMustSucceed</a>, and <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00451">PoolVector</a>.
<p>
<pre class="fragment"><div>00270                    :
00271 
00272     This function unlocks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> specified by <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value
00273     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Wait parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keyword">true</span>, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>'s lock <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> released
00274     <span class="keyword">using</span> <span class="stringliteral">"wait == true"</span>.
00275 
00276 
00277 Arguments:
00278 
00279     PoolType - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> that should be unlocked.
00280 
00281     LockHandle - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lock handle from a previous call to
00282                  <a class="code" href="../../d2/d2/ex_2pool_8c.html#a71">ExLockPool</a>.
00283 
00284     Wait - Supplies a <span class="keywordtype">boolean</span> value that signifies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call to
00285            <a class="code" href="../../d2/d2/ex_2pool_8c.html#a72">ExUnlockPool</a> will be immediately followed by a call to one of
00286            <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel Wait <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a16">functions</a>.
00287 
00288 Return Value:
00289 
00290     None.
00291 
00292 --*/
00293 
00294 {
00295 
00296     <span class="keywordflow">if</span> ( PoolType == <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a> || (PoolType) == <a class="code" href="../../d5/d8/ex_8h.html#a329a175">NonPagedPoolMustSucceed</a> ) {
00297 
00298         <span class="comment">//</span>
00299         <span class="comment">// Spin Lock locking</span>
00300         <span class="comment">//</span>
00301 
00302         <a class="code" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock</a>(
00303             (PKSPIN_LOCK)PoolVector[PoolType]-&gt;LockAddress,
00304             LockHandle
00305             );
00306 
00307     } <span class="keywordflow">else</span> {
00308 
00309         <span class="comment">//</span>
00310         <span class="comment">// Mutex Locking</span>
00311         <span class="comment">//</span>
00312 
00313         <a class="code" href="../../d3/d5/mutntobj_8c.html#a5">KeReleaseMutex</a>((<a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTEX</a>)PoolVector[PoolType]-&gt;LockAddress,Wait);
00314 
00315         <span class="comment">//</span>
00316         <span class="comment">// This could be a problem if wait == true is specified !</span>
00317         <span class="comment">//</span>
00318 
00319         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(LockHandle);
00320     }
00321 
00322 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="poolhack.c::InitializePool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializePool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Threshold</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
DBG<p>
DBG 
<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00325">325</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00089">_POOL_LIST_HEAD::CurrentFreeLength</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00367">ExInitializeFastMutex</a>, <a class="el" href="../../d4/d2/pool_8h.html#a35">ExpInitializePoolDescriptor()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02000">ExpInsertPoolTracker()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00429">ExpNumberOfPagedPools</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00452">ExpPagedPoolDescriptor</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00463">ExpTaggedPoolLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00099">KeInitializeMutex()</a>, <a class="el" href="../../d2/d5/semphobj_8c-source.html#l00039">KeInitializeSemaphore()</a>, <a class="el" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00100">_POOL_DESCRIPTOR::ListHeads</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00125">_POOL_DESCRIPTOR::LockAddress</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00345">MAX_BIGPAGE_TABLE</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00807">MiAllocatePoolPages()</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00052">MUST_SUCCEED_POOL_TYPE_MASK</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00140">MustSucceedPoolTable</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00440">NonPagedPoolDescriptor</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00441">NonPagedPoolDescriptorMS</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00454">NonPagedPoolLock</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a175">NonPagedPoolMustSucceed</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00370">NtGlobalFlag</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00119">PagedPoolDescriptor</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00120">PagedPoolDescriptorMS</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00123">PagedPoolLock</a>, <a class="el" href="../../d5/d2/poolhack_8c.html#a15">POOL_HEADER</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00068">POOL_LIST_HEADS</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00116">POOL_OVERHEAD</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00066">POOL_PAGE_SIZE</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00214">POOL_SMALLEST_BLOCK</a>, <a class="el" href="../../d4/d2/pool_8h.html#a33">POOL_TRACKER_BIG_PAGES</a>, <a class="el" href="../../d4/d2/pool_8h.html#a30">POOL_TRACKER_TABLE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00356">PoolBigPageTable</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00358">PoolBigPageTableHash</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00357">PoolBigPageTableSize</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00352">PoolTrackTable</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00354">PoolTrackTableMask</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00353">PoolTrackTableSize</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00118">_POOL_DESCRIPTOR::PoolType</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00451">PoolVector</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l00117">ROUND_TO_PAGES</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d5/d1/pool_8h-source.html#l00124">_POOL_DESCRIPTOR::Threshold</a>, and <a class="el" href="../../d5/d1/pool_8h-source.html#l00122">_POOL_DESCRIPTOR::TotalPages</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/mminit_8c-source.html#l02184">MiBuildPagedPool()</a>, and <a class="el" href="../../d3/d0/inialpha_8c-source.html#l00041">MiInitMachineDependent()</a>.
<p>
<pre class="fragment"><div>00332                    :
00333 
00334     This <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> initializes a <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> descriptor <span class="keywordflow">for</span> a binary buddy <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>
00335     <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.  Once initialized, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> may be used <span class="keywordflow">for</span> allocation and
00336     deallocation.
00337 
00338     This function should be called once <span class="keywordflow">for</span> each base <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> during
00339     system initialization.
00340 
00341     Each <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> descriptor contains an array of list heads <span class="keywordflow">for</span> free
00342     blocks.  Each list head holds blocks of a particular size.  One list
00343     head contains page-sized blocks.  The other list heads contain 1/2-
00344     page-sized blocks, 1/4-page-sized blocks....  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> threshold <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00345     associated with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page-sized list head.  The number of free blocks
00346     on <span class="keyword">this</span> list will not grow past <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified threshold.  When a
00347     deallocation occurs that would cause <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> threshold to be exceeded,
00348     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page-aliged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocator.
00349 
00350 Arguments:
00351 
00352     PoolType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> being initialized (e.g.
00353                nonpaged pool, paged <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>...).
00354 
00355     Threshold - Supplies the threshold value <span class="keywordflow">for</span> the specified <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a>.
00356 
00357 Return Value:
00358 
00359     None.
00360 
00361 --*/
00362 
00363 {
00364     <span class="keywordtype">int</span> i;
00365     POOL_TYPE BasePoolType, MustSucceedPoolType;
00366 
00367     if ( MustSucceedPoolTable[PoolType] ) {
00368         <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(PHASE0_INITIALIZATION_FAILED);
00369     }
00370 
00371     <span class="keywordflow">if</span> (PoolType == NonPagedPool) {
00372 
00373         BasePoolType = NonPagedPool;
00374         MustSucceedPoolType = NonPagedPoolMustSucceed;
00375 
00376         <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>(&amp;<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;StatisticsLock);
00377         <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>(&amp;NonPagedPoolLock);
00378         <a class="code" href="../../d2/d2/ex_2pool_8c.html#a52">NonPagedPoolDescriptor</a>.<a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html#o3">LockAddress</a> = (PVOID)&amp;NonPagedPoolLock;
00379         <a class="code" href="../../d2/d2/ex_2pool_8c.html#a53">NonPagedPoolDescriptorMS</a>.<a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html#o3">LockAddress</a> = (PVOID)&amp;NonPagedPoolLock;
00380 
00381         <a class="code" href="../../d4/d9/ke_8h.html#a288">KeInitializeMutex</a>(&amp;PagedPoolLock,MUTEX_LEVEL_EX_PAGED_POOL);
00382         <a class="code" href="../../d5/d2/poolhack_8c.html#a18">PagedPoolDescriptor</a>.<a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html#o3">LockAddress</a> = (PVOID)&amp;PagedPoolLock;
00383         <a class="code" href="../../d5/d2/poolhack_8c.html#a20">PagedPoolDescriptorMS</a>.<a class="code" href="../../d4/d8/struct__POOL__DESCRIPTOR.html#o3">LockAddress</a> = (PVOID)&amp;PagedPoolLock;
00384 
00385 #ifdef TRACE_ALLOC
00386 
00387         <a class="code" href="../../d4/d9/ke_8h.html#a296">KeInitializeSemaphore</a>(&amp;TracePoolLock,1L,1L);
00388         InitializeListHead(&amp;TracePoolListHead[NonPagedPool]);
00389         InitializeListHead(&amp;TracePoolListHead[PagedPool]);
00390 
00391 #endif <span class="comment">// TRACE_ALLOC</span>
00392     } <span class="keywordflow">else</span> {
00393         BasePoolType = PagedPool;
00394         MustSucceedPoolType = PagedPoolMustSucceed;
00395     }
00396 
00397     PoolVector[BasePoolType]-&gt;TotalPages = 0;
00398     PoolVector[BasePoolType]-&gt;Threshold = Threshold;
00399     PoolVector[BasePoolType]-&gt;PoolType = BasePoolType;
00400     PoolVector[MustSucceedPoolType]-&gt;TotalPages = 0;
00401     PoolVector[MustSucceedPoolType]-&gt;Threshold = 0;
00402     PoolVector[MustSucceedPoolType]-&gt;PoolType = MustSucceedPoolType;
00403     <span class="keywordflow">for</span> (i=0; i&lt;POOL_LIST_HEADS ;i++ ) {
00404         InitializeListHead(&amp;PoolVector[BasePoolType]-&gt;ListHeads[i].ListHead);
00405         PoolVector[BasePoolType]-&gt;ListHeads[i].CurrentFreeLength = 0;
00406         InitializeListHead(&amp;PoolVector[MustSucceedPoolType]-&gt;ListHeads[i].ListHead);
00407         PoolVector[MustSucceedPoolType]-&gt;ListHeads[i].CurrentFreeLength = 0;
00408     }
00409     <span class="keywordflow">return</span>;
00410 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a24" doxytag="poolhack.c::BasePoolTypeTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> <a class="el" href="../../d5/d2/poolhack_8c.html#a24">BasePoolTypeTable</a>[MaxPoolType]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,
    <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>,
    <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,
    <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>
    }
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00133">133</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00786">AllocatePoolInternal()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00694">ExAllocatePoolWithQuota()</a>, and <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="poolhack.c::MustSucceedPoolTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d5/d2/poolhack_8c.html#a25">MustSucceedPoolTable</a>[MaxPoolType]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
    <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
    <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
    }
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00140">140</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00786">AllocatePoolInternal()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>, and <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00325">InitializePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="poolhack.c::NonPagedPoolDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">POOL_DESCRIPTOR</a> <a class="el" href="../../d5/d6/iosup_8c.html#a16">NonPagedPoolDescriptor</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00119">119</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="poolhack.c::NonPagedPoolDescriptorMS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">POOL_DESCRIPTOR</a> <a class="el" href="../../d5/d2/poolhack_8c.html#a19">NonPagedPoolDescriptorMS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00120">120</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="poolhack.c::NonPagedPoolLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d5/d2/poolhack_8c.html#a21">NonPagedPoolLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00122">122</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l01104">ExAllocatePoolWithTag()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00565">ExUnlockPool()</a>, and <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00677">InitializePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="poolhack.c::PagedPoolDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">POOL_DESCRIPTOR</a> <a class="el" href="../../d5/d2/poolhack_8c.html#a18">PagedPoolDescriptor</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00119">119</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00325">InitializePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="poolhack.c::PagedPoolDescriptorMS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">POOL_DESCRIPTOR</a> <a class="el" href="../../d5/d2/poolhack_8c.html#a20">PagedPoolDescriptorMS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00120">120</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00325">InitializePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="poolhack.c::PagedPoolLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d7/struct__KMUTANT.html">KMUTEX</a> <a class="el" href="../../d5/d2/poolhack_8c.html#a22">PagedPoolLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00123">123</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00325">InitializePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="poolhack.c::PoolIndexTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d1/bench_8h.html#a8">CHAR</a> <a class="el" href="../../d5/d2/poolhack_8c.html#a10">PoolIndexTable</a>[128]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> { 0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,
                             5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,
                             6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
                             6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
                             7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
                             7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
                             7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
                             7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
                           }
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00073">73</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="poolhack.c::PoolVector" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d8/struct__POOL__DESCRIPTOR.html">PPOOL_DESCRIPTOR</a> <a class="el" href="../../d5/d2/poolhack_8c.html#a23">PoolVector</a>[MaxPoolType]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    &amp;<a class="code" href="../../d2/d2/ex_2pool_8c.html#a52">NonPagedPoolDescriptor</a>,
    &amp;<a class="code" href="../../d5/d2/poolhack_8c.html#a18">PagedPoolDescriptor</a>,
    &amp;<a class="code" href="../../d2/d2/ex_2pool_8c.html#a53">NonPagedPoolDescriptorMS</a>,
    &amp;<a class="code" href="../../d5/d2/poolhack_8c.html#a20">PagedPoolDescriptorMS</a>
    }
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00126">126</a> of file <a class="el" href="../../d6/d1/poolhack_8c-source.html">poolhack.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:17 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
