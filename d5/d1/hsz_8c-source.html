<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: hsz.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>hsz.c</h1><a href="../../d4/d2/hsz_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: hsz.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* HSZ.C - DDEML String handle functions</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 10-28-91 Sanfords Created</span>
00010 <span class="comment">\***************************************************************************/</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00013 <span class="preprocessor">#pragma hdrstop</span>
00014 <span class="preprocessor"></span>
00015 <span class="comment">/***************************************************************************\</span>
00016 <span class="comment">* DdeCreateStringHandle (DDEML API)</span>
00017 <span class="comment">*</span>
00018 <span class="comment">* Description:</span>
00019 <span class="comment">* Create an HSZ from a string.</span>
00020 <span class="comment">*</span>
00021 <span class="comment">* History:</span>
00022 <span class="comment">* 11-1-91 sanfords Created.</span>
00023 <span class="comment">\***************************************************************************/</span>
<a name="l00024"></a><a class="code" href="../../d4/d2/hsz_8c.html#a0">00024</a> HSZ <a class="code" href="../../d4/d2/hsz_8c.html#a0">DdeCreateStringHandleA</a>(
00025 DWORD idInst,
00026 LPCSTR psz,
00027 <span class="keywordtype">int</span> iCodePage)
00028 {
00029     <span class="keywordflow">if</span> (iCodePage == 0) {
00030         iCodePage = CP_WINANSI;
00031     }
00032     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d2/hsz_8c.html#a2">InternalDdeCreateStringHandle</a>(idInst, (PVOID)psz, iCodePage));
00033 }
00034 
00035 
<a name="l00036"></a><a class="code" href="../../d4/d2/hsz_8c.html#a1">00036</a> HSZ <a class="code" href="../../d4/d2/hsz_8c.html#a1">DdeCreateStringHandleW</a>(
00037 DWORD idInst,
00038 LPCWSTR psz,
00039 <span class="keywordtype">int</span> iCodePage)
00040 {
00041     <span class="keywordflow">if</span> (iCodePage == 0) {
00042         iCodePage = CP_WINUNICODE;
00043     }
00044     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d2/hsz_8c.html#a2">InternalDdeCreateStringHandle</a>(idInst, (PVOID)psz, iCodePage));
00045 }
00046 
00047 
00048 
<a name="l00049"></a><a class="code" href="../../d4/d2/hsz_8c.html#a2">00049</a> HSZ <a class="code" href="../../d4/d2/hsz_8c.html#a2">InternalDdeCreateStringHandle</a>(
00050 DWORD idInst,
00051 PVOID psz,
00052 <span class="keywordtype">int</span> iCodePage)
00053 {
00054     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii;
00055     HSZ hszRet = 0;
00056     <span class="keywordtype">int</span> cb;
00057     WCHAR szw[256];
00058 
00059     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00060 
00061     pcii = <a class="code" href="../../d0/d4/instance_8c.html#a7">ValidateInstance</a>((HANDLE)LongToHandle( idInst ));
00062     <span class="keywordflow">if</span> (pcii == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00063         <a class="code" href="../../d3/d8/handles_8c.html#a14">BestSetLastDDEMLError</a>(DMLERR_INVALIDPARAMETER);
00064         <span class="keywordflow">goto</span> Exit;
00065     }
00066 
00067     <span class="keywordflow">switch</span> (iCodePage) {
00068     <span class="keywordflow">case</span> CP_WINANSI:
00069         <span class="keywordflow">if</span> (*(LPSTR)psz == <span class="charliteral">'\0'</span>) {
00070             <span class="keywordflow">goto</span> Exit;
00071         }
00072         hszRet = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(AddAtomA((LPSTR)psz));
00073         <span class="keywordflow">break</span>;
00074 
00075     <span class="keywordflow">default</span>:
00076 
00077         <span class="comment">/*</span>
00078 <span class="comment">         * Convert psz to unicode and fall through.</span>
00079 <span class="comment">         */</span>
00080         cb = <span class="keyword">sizeof</span>(szw) /  <span class="keyword">sizeof</span>(WCHAR);
00081 <span class="preprocessor">#ifdef LATER</span>
00082 <span class="preprocessor"></span>        MultiByteToWideChar((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)iCodePage, MB_PRECOMPOSED,
00083                             (LPSTR)psz, -1, szw, cb);
00084 <span class="preprocessor">#endif</span>
00085 <span class="preprocessor"></span>        psz = &amp;szw[0];
00086 
00087 
00088     <span class="keywordflow">case</span> CP_WINUNICODE:
00089         <span class="keywordflow">if</span> (*(LPWSTR)psz == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>) {
00090             <span class="keywordflow">goto</span> Exit;
00091         }
00092         hszRet = <a class="code" href="../../d0/d4/ddemlcli_8h.html#a14">NORMAL_HSZ_FROM_LATOM</a>(AddAtomW((LPWSTR)psz));
00093         <span class="keywordflow">break</span>;
00094     }
00095     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a3">MONHSZ</a>(pcii, hszRet, MH_CREATE);
00096 
00097 Exit:
00098     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00099     <span class="keywordflow">return</span> (hszRet);
00100 }
00101 
00102 
00103 
00104 <span class="comment">/***************************************************************************\</span>
00105 <span class="comment">* DdeQueryString (DDEML API)</span>
00106 <span class="comment">*</span>
00107 <span class="comment">* Description:</span>
00108 <span class="comment">* Recall the string associated with an HSZ.</span>
00109 <span class="comment">*</span>
00110 <span class="comment">* History:</span>
00111 <span class="comment">* 11-1-91 sanfords Created.</span>
00112 <span class="comment">\***************************************************************************/</span>
<a name="l00113"></a><a class="code" href="../../d4/d2/hsz_8c.html#a3">00113</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d4/d2/hsz_8c.html#a3">DdeQueryStringA</a>(
00114 DWORD idInst,
00115 HSZ hsz,
00116 LPSTR psz,
00117 DWORD cchMax,
00118 INT iCodePage)
00119 {
00120     <span class="keywordflow">if</span> (iCodePage == 0) {
00121         iCodePage = CP_WINANSI;
00122     }
00123     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d2/hsz_8c.html#a5">InternalDdeQueryString</a>(idInst, hsz, psz, cchMax, iCodePage));
00124 }
00125 
00126 
<a name="l00127"></a><a class="code" href="../../d4/d2/hsz_8c.html#a4">00127</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d4/d2/hsz_8c.html#a4">DdeQueryStringW</a>(
00128 DWORD idInst,
00129 HSZ hsz,
00130 LPWSTR psz,
00131 DWORD cchMax,
00132 INT iCodePage)
00133 {
00134     <span class="keywordflow">if</span> (iCodePage == 0) {
00135         iCodePage = CP_WINUNICODE;
00136     }
00137     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d2/hsz_8c.html#a5">InternalDdeQueryString</a>(idInst, hsz, psz, cchMax * <span class="keyword">sizeof</span>(WCHAR), iCodePage));
00138 }
00139 
00140 
<a name="l00141"></a><a class="code" href="../../d4/d2/hsz_8c.html#a5">00141</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d4/d2/hsz_8c.html#a5">InternalDdeQueryString</a>(
00142 DWORD idInst,
00143 HSZ hsz,
00144 PVOID psz,
00145 DWORD cbMax,
00146 INT iCodePage)
00147 {
00148     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii;
00149     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRet = 0;
00150     WCHAR szw[256];
00151 <span class="comment">// BOOL fDefUsed; // LATER</span>
00152 
00153     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00154 
00155     pcii = <a class="code" href="../../d0/d4/instance_8c.html#a7">ValidateInstance</a>((HANDLE)LongToHandle( idInst ));
00156     <span class="keywordflow">if</span> (pcii == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00157         <a class="code" href="../../d3/d8/handles_8c.html#a14">BestSetLastDDEMLError</a>(DMLERR_INVALIDPARAMETER);
00158         <span class="keywordflow">goto</span> Exit;
00159     }
00160 
00161     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d2/hsz_8c.html#a9">ValidateHSZ</a>(hsz) == <a class="code" href="../../d0/d4/ddemlcli_8h.html#a10">HSZT_INVALID</a>) {
00162         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_INVALIDPARAMETER);
00163         <span class="keywordflow">goto</span> Exit;
00164     }
00165 
00166     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a13">LATOM_FROM_HSZ</a>(hsz) == 0) {
00167         <span class="keywordflow">if</span> (iCodePage == CP_WINUNICODE) {
00168             <span class="keywordflow">if</span> (psz != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00169                 *(LPWSTR)psz = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00170             }
00171             dwRet = <span class="keyword">sizeof</span>(WCHAR);
00172             <span class="keywordflow">goto</span> Exit;
00173         } <span class="keywordflow">else</span> {
00174             <span class="keywordflow">if</span> (psz != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00175                 *(LPSTR)psz = <span class="charliteral">'\0'</span>;
00176             }
00177             dwRet = <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>);
00178             <span class="keywordflow">goto</span> Exit;
00179         }
00180     }
00181 
00182     <span class="keywordflow">if</span> (psz == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00183         cbMax = <span class="keyword">sizeof</span>(szw);
00184         psz = (PVOID)szw;
00185     }
00186 
00187     <span class="keywordflow">switch</span> (iCodePage) {
00188     <span class="keywordflow">case</span> CP_WINANSI:
00189         dwRet = GetAtomNameA(<a class="code" href="../../d0/d4/ddemlcli_8h.html#a13">LATOM_FROM_HSZ</a>(hsz), psz, cbMax);
00190         <span class="keywordflow">break</span>;
00191 
00192     <span class="keywordflow">default</span>:
00193         dwRet = GetAtomNameW(<a class="code" href="../../d0/d4/ddemlcli_8h.html#a13">LATOM_FROM_HSZ</a>(hsz), (LPWSTR)psz, cbMax / <span class="keyword">sizeof</span>(WCHAR));
00194         <span class="keywordflow">if</span> (iCodePage != CP_WINUNICODE) {
00195 
00196             <span class="comment">/*</span>
00197 <span class="comment">             * convert psz to the appropriate codepage and count the</span>
00198 <span class="comment">             * characters(ie BYTES for DBCS!) to alter dwRet.</span>
00199 <span class="comment">             */</span>
00200 <span class="preprocessor">#ifdef LATER</span>
00201 <span class="preprocessor"></span>            <span class="comment">// Does this routine work in place? (i.e. input and output buffer the same).</span>
00202             WideCharToMultiByte((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)iCodePage, 0, szw,
00203                     <span class="keyword">sizeof</span>(szw) /  <span class="keyword">sizeof</span>(WCHAR),
00204                     (LPSTR)psz, cbMax, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, &amp;fDefUsed);
00205 <span class="preprocessor">#endif</span>
00206 <span class="preprocessor"></span>            dwRet = cbMax + 1;
00207         }
00208         <span class="keywordflow">break</span>;
00209     }
00210 
00211 Exit:
00212     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00213     <span class="keywordflow">return</span> (dwRet);
00214 }
00215 
00216 
00217 
00218 <span class="comment">/***************************************************************************\</span>
00219 <span class="comment">* DdeFreeStringHandle (DDEML API)</span>
00220 <span class="comment">*</span>
00221 <span class="comment">* Description:</span>
00222 <span class="comment">* Decrement the use count of an HSZ.</span>
00223 <span class="comment">*</span>
00224 <span class="comment">* History:</span>
00225 <span class="comment">* 11-1-91 sanfords Created.</span>
00226 <span class="comment">\***************************************************************************/</span>
<a name="l00227"></a><a class="code" href="../../d4/d2/hsz_8c.html#a6">00227</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/hsz_8c.html#a6">DdeFreeStringHandle</a>(
00228 DWORD idInst,
00229 HSZ hsz)
00230 {
00231     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii;
00232     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00233 
00234     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00235 
00236     pcii = <a class="code" href="../../d0/d4/instance_8c.html#a7">ValidateInstance</a>((HANDLE)LongToHandle( idInst ));
00237     <span class="keywordflow">if</span> (pcii == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00238         <a class="code" href="../../d3/d8/handles_8c.html#a14">BestSetLastDDEMLError</a>(DMLERR_INVALIDPARAMETER);
00239         <span class="keywordflow">goto</span> Exit;
00240     }
00241 
00242     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d2/hsz_8c.html#a9">ValidateHSZ</a>(hsz) == <a class="code" href="../../d0/d4/ddemlcli_8h.html#a10">HSZT_INVALID</a>) {
00243         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_INVALIDPARAMETER);
00244         <span class="keywordflow">goto</span> Exit;
00245     }
00246 
00247     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a3">MONHSZ</a>(pcii, hsz, MH_DELETE);
00248     fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00249     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a13">LATOM_FROM_HSZ</a>(hsz) != 0) {
00250         <span class="keywordflow">if</span> (DeleteAtom(<a class="code" href="../../d0/d4/ddemlcli_8h.html#a13">LATOM_FROM_HSZ</a>(hsz))) {
00251             <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_INVALIDPARAMETER);
00252             fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00253         }
00254     }
00255 
00256 Exit:
00257     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00258     <span class="keywordflow">return</span> (fRet);
00259 }
00260 
00261 
00262 
00263 <span class="comment">/***************************************************************************\</span>
00264 <span class="comment">* DdeKeepStringHandle (DDEML API)</span>
00265 <span class="comment">*</span>
00266 <span class="comment">* Description:</span>
00267 <span class="comment">* Increments the use count of an HSZ.</span>
00268 <span class="comment">*</span>
00269 <span class="comment">* History:</span>
00270 <span class="comment">* 11-1-91 sanfords Created.</span>
00271 <span class="comment">\***************************************************************************/</span>
<a name="l00272"></a><a class="code" href="../../d4/d2/hsz_8c.html#a7">00272</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/hsz_8c.html#a7">DdeKeepStringHandle</a>(
00273 DWORD idInst,
00274 HSZ hsz)
00275 {
00276     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">PCL_INSTANCE_INFO</a> pcii;
00277     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00278 
00279     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a6">EnterDDECrit</a>;
00280 
00281     pcii = <a class="code" href="../../d0/d4/instance_8c.html#a7">ValidateInstance</a>((HANDLE)LongToHandle( idInst ));
00282     <span class="keywordflow">if</span> (pcii == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00283         <a class="code" href="../../d3/d8/handles_8c.html#a14">BestSetLastDDEMLError</a>(DMLERR_INVALIDPARAMETER);
00284         <span class="keywordflow">goto</span> Exit;
00285     }
00286 
00287     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d2/hsz_8c.html#a9">ValidateHSZ</a>(hsz) == <a class="code" href="../../d0/d4/ddemlcli_8h.html#a10">HSZT_INVALID</a>) {
00288         <a class="code" href="../../d0/d4/instance_8c.html#a8">SetLastDDEMLError</a>(pcii, DMLERR_INVALIDPARAMETER);
00289         <span class="keywordflow">goto</span> Exit;
00290     }
00291 
00292     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a13">LATOM_FROM_HSZ</a>(hsz) == 0) {
00293         fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00294         <span class="keywordflow">goto</span> Exit;
00295     }
00296     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a3">MONHSZ</a>(pcii, hsz, MH_KEEP);
00297     fRet = <a class="code" href="../../d4/d2/hsz_8c.html#a15">IncLocalAtomCount</a>(<a class="code" href="../../d0/d4/ddemlcli_8h.html#a13">LATOM_FROM_HSZ</a>(hsz)) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00298 
00299 Exit:
00300     <a class="code" href="../../d0/d4/ddemlcli_8h.html#a7">LeaveDDECrit</a>;
00301     <span class="keywordflow">return</span> (fRet);
00302 }
00303 
00304 
00305 
00306 <span class="comment">/***************************************************************************\</span>
00307 <span class="comment">* DdeCmpStringHandles (DDEML API)</span>
00308 <span class="comment">*</span>
00309 <span class="comment">* Description:</span>
00310 <span class="comment">* Useless comparison of hszs. Provided for case sensitivity expandability.</span>
00311 <span class="comment">* Direct comparison of hszs would be a case sensitive comparison while</span>
00312 <span class="comment">* using this function would be case-insensitive. For now both ways are ==.</span>
00313 <span class="comment">*</span>
00314 <span class="comment">* History:</span>
00315 <span class="comment">* 11-1-91 sanfords Created.</span>
00316 <span class="comment">\***************************************************************************/</span>
<a name="l00317"></a><a class="code" href="../../d4/d2/hsz_8c.html#a8">00317</a> <span class="keywordtype">int</span> <a class="code" href="../../d4/d2/hsz_8c.html#a8">DdeCmpStringHandles</a>(
00318 HSZ hsz1,
00319 HSZ hsz2)
00320 {
00321     <span class="keywordflow">if</span> (hsz2 &gt; hsz1) {
00322         <span class="keywordflow">return</span> (-1);
00323     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hsz2 &lt; hsz1) {
00324         <span class="keywordflow">return</span> (1);
00325     } <span class="keywordflow">else</span> {
00326         <span class="keywordflow">return</span> (0);
00327     }
00328 }
00329 
00330 
00331 <span class="comment">/***************************************************************************\</span>
00332 <span class="comment">* ValidateHSZ</span>
00333 <span class="comment">*</span>
00334 <span class="comment">* Description:</span>
00335 <span class="comment">* Verifies the probability of a reasonable hsz</span>
00336 <span class="comment">*</span>
00337 <span class="comment">* History:</span>
00338 <span class="comment">* 11-1-91 sanfords Created.</span>
00339 <span class="comment">\***************************************************************************/</span>
<a name="l00340"></a><a class="code" href="../../d4/d2/hsz_8c.html#a9">00340</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d4/d2/hsz_8c.html#a9">ValidateHSZ</a>(
00341 HSZ hsz)
00342 {
00343     <span class="keywordflow">if</span> (hsz == 0) {
00344         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a11">HSZT_NORMAL</a>);
00345     }
00346     <span class="keywordflow">if</span> (LOWORD((ULONG_PTR)hsz) &lt; 0xC000) {
00347         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a10">HSZT_INVALID</a>);
00348     }
00349     <span class="keywordflow">if</span> (HIWORD((ULONG_PTR)hsz) == 0) {
00350         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a11">HSZT_NORMAL</a>);
00351     }
00352     <span class="keywordflow">if</span> (HIWORD((ULONG_PTR)hsz) == 1) {
00353         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a12">HSZT_INST_SPECIFIC</a>);
00354     }
00355     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a10">HSZT_INVALID</a>);
00356 }
00357 
00358 <span class="comment">/***************************************************************************\</span>
00359 <span class="comment">* MakeInstSpecificAtom</span>
00360 <span class="comment">*</span>
00361 <span class="comment">* Description:</span>
00362 <span class="comment">* Creates a new atom that has hwnd imbeded into it.</span>
00363 <span class="comment">*</span>
00364 <span class="comment">* History:</span>
00365 <span class="comment">* 11-1-91 sanfords Created.</span>
00366 <span class="comment">\***************************************************************************/</span>
<a name="l00367"></a><a class="code" href="../../d4/d2/hsz_8c.html#a10">00367</a> <a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a> <a class="code" href="../../d4/d2/hsz_8c.html#a10">MakeInstSpecificAtom</a>(
00368 LATOM la,
00369 HWND hwnd)
00370 {
00371     WCHAR sz[256];
00372     LPWSTR psz;
00373 
00374     <span class="keywordflow">if</span> (GetAtomName(la, sz, 256) == 0) {
00375         <span class="keywordflow">return</span> (0);
00376     }
00377 <span class="preprocessor">#ifdef UNICODE</span>
00378 <span class="preprocessor"></span>    psz = sz + wcslen(sz);
00379 <span class="preprocessor">#else</span>
00380 <span class="preprocessor"></span>    psz = sz + <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(sz);
00381 <span class="preprocessor">#endif</span>
00382 <span class="preprocessor"></span>    wsprintf(psz, TEXT(<span class="stringliteral">"(%#p)"</span>), hwnd);
00383     la = AddAtom(sz);
00384     <span class="keywordflow">return</span> (la);
00385 }
00386 
00387 
00388 
00389 <span class="comment">/***************************************************************************\</span>
00390 <span class="comment">* ParseInstSpecificAtom</span>
00391 <span class="comment">*</span>
00392 <span class="comment">* Description:</span>
00393 <span class="comment">* Extracts the hwnd value out of the atom.</span>
00394 <span class="comment">*</span>
00395 <span class="comment">* History:</span>
00396 <span class="comment">* 11-1-91 sanfords Created.</span>
00397 <span class="comment">\***************************************************************************/</span>
<a name="l00398"></a><a class="code" href="../../d4/d2/hsz_8c.html#a11">00398</a> HWND <a class="code" href="../../d4/d2/hsz_8c.html#a11">ParseInstSpecificAtom</a>(
00399 LATOM la,
00400 LATOM *plaNormal)
00401 {
00402     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> sz[256];
00403     LPSTR pszHwnd;
00404     HWND hwnd;
00405 
00406     <span class="comment">/*</span>
00407 <span class="comment">     * LATER- NEED TO MAKE THIS UNICODE BASED WHEN WE GET A SCANF WE CAN USE</span>
00408 <span class="comment">     */</span>
00409     <span class="keywordflow">if</span> (GetAtomNameA(la, sz, 256) == 0) {
00410         <span class="keywordflow">return</span> (0);
00411     }
00412     pszHwnd = strrchr(sz, <span class="charliteral">'('</span>);
00413     <span class="keywordflow">if</span> (pszHwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00414         <span class="keywordflow">return</span> (0);
00415     }
00416     <span class="keywordflow">if</span> (sscanf(pszHwnd, <span class="stringliteral">"(%#p)"</span>, &amp;hwnd) != 1) {
00417         <span class="keywordflow">return</span> (0);
00418     }
00419     <span class="keywordflow">if</span> (plaNormal != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00420         *pszHwnd = <span class="charliteral">'\0'</span>;
00421         *plaNormal = AddAtomA(sz);
00422     }
00423     <span class="keywordflow">return</span> (hwnd);
00424 }
00425 
00426 
00427 
00428 
00429 <span class="comment">/***************************************************************************\</span>
00430 <span class="comment">* LocalToGlobalAtom</span>
00431 <span class="comment">*</span>
00432 <span class="comment">* Description:</span>
00433 <span class="comment">* Converts a Local Atom to a Global Atom</span>
00434 <span class="comment">*</span>
00435 <span class="comment">* History:</span>
00436 <span class="comment">* 12-1-91 sanfords Created.</span>
00437 <span class="comment">\***************************************************************************/</span>
<a name="l00438"></a><a class="code" href="../../d4/d2/hsz_8c.html#a12">00438</a> <a class="code" href="../../d0/d4/ddemlcli_8h.html#a52">GATOM</a> <a class="code" href="../../d4/d2/hsz_8c.html#a12">LocalToGlobalAtom</a>(
00439 LATOM la)
00440 {
00441     WCHAR sz[256];
00442 
00443     <span class="keywordflow">if</span> (la == 0) {
00444         <span class="keywordflow">return</span> (0);
00445     }
00446     <span class="keywordflow">if</span> (GetAtomName((ATOM)la, sz, 256) == 0) {
00447         RIPMSG0(RIP_WARNING, <span class="stringliteral">"LocalToGlobalAtom out of memory"</span>);
00448         <span class="keywordflow">return</span> (0);
00449     }
00450     <span class="keywordflow">return</span> ((<a class="code" href="../../d0/d4/ddemlcli_8h.html#a52">GATOM</a>)GlobalAddAtom(sz));
00451 }
00452 
00453 
00454 
00455 <span class="comment">/***************************************************************************\</span>
00456 <span class="comment">* GlobalToLocalAtom</span>
00457 <span class="comment">*</span>
00458 <span class="comment">* Description:</span>
00459 <span class="comment">* Converts a Global Atom to a Local Atom</span>
00460 <span class="comment">*</span>
00461 <span class="comment">* History:</span>
00462 <span class="comment">* 12-1-91 sanfords Created.</span>
00463 <span class="comment">\***************************************************************************/</span>
<a name="l00464"></a><a class="code" href="../../d4/d2/hsz_8c.html#a13">00464</a> <a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a> <a class="code" href="../../d4/d2/hsz_8c.html#a13">GlobalToLocalAtom</a>(
00465 GATOM ga)
00466 {
00467     WCHAR sz[256];
00468 
00469     <span class="keywordflow">if</span> (ga == 0) {
00470         <span class="keywordflow">return</span> (0);
00471     }
00472     <span class="keywordflow">if</span> (GlobalGetAtomName((ATOM)ga, sz, 256) == 0) {
00473         RIPMSG0(RIP_WARNING, <span class="stringliteral">"GlobalToLocalAtom out of memory"</span>);
00474         <span class="keywordflow">return</span> (0);
00475     }
00476     <span class="keywordflow">return</span> ((<a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a>)AddAtom(sz));
00477 }
00478 
00479 
00480 <span class="comment">/***************************************************************************\</span>
00481 <span class="comment">* IncGlobalAtomCount</span>
00482 <span class="comment">*</span>
00483 <span class="comment">* Description:</span>
00484 <span class="comment">* Duplicates an atom.</span>
00485 <span class="comment">*</span>
00486 <span class="comment">*</span>
00487 <span class="comment">* History:</span>
00488 <span class="comment">* 1-22-91 sanfords Created.</span>
00489 <span class="comment">\***************************************************************************/</span>
<a name="l00490"></a><a class="code" href="../../d4/d2/hsz_8c.html#a14">00490</a> <a class="code" href="../../d0/d4/ddemlcli_8h.html#a52">GATOM</a> <a class="code" href="../../d4/d2/hsz_8c.html#a14">IncGlobalAtomCount</a>(
00491 GATOM ga)
00492 {
00493     WCHAR sz[256];
00494 
00495     <span class="keywordflow">if</span> (ga == 0) {
00496         <span class="keywordflow">return</span> (0);
00497     }
00498     <span class="keywordflow">if</span> (GlobalGetAtomName(ga, sz, 256) == 0) {
00499         RIPMSG0(RIP_WARNING, <span class="stringliteral">"IncGlobalAtomCount out of memory"</span>);
00500         <span class="keywordflow">return</span> (0);
00501     }
00502     <span class="keywordflow">return</span> ((<a class="code" href="../../d0/d4/ddemlcli_8h.html#a52">GATOM</a>)GlobalAddAtom(sz));
00503 }
00504 
00505 
00506 <span class="comment">/***************************************************************************\</span>
00507 <span class="comment">* IncGlobalAtomCount</span>
00508 <span class="comment">*</span>
00509 <span class="comment">* Description:</span>
00510 <span class="comment">* Duplicates an atom.</span>
00511 <span class="comment">*</span>
00512 <span class="comment">*</span>
00513 <span class="comment">* History:</span>
00514 <span class="comment">* 1-22-91 sanfords Created.</span>
00515 <span class="comment">\***************************************************************************/</span>
<a name="l00516"></a><a class="code" href="../../d4/d2/hsz_8c.html#a15">00516</a> <a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a> <a class="code" href="../../d4/d2/hsz_8c.html#a15">IncLocalAtomCount</a>(
00517 LATOM la)
00518 {
00519     WCHAR sz[256];
00520 
00521     <span class="keywordflow">if</span> (la == 0) {
00522         <span class="keywordflow">return</span> (0);
00523     }
00524     <span class="keywordflow">if</span> (GetAtomName(la, sz, 256) == 0) {
00525         RIPMSG0(RIP_WARNING, <span class="stringliteral">"IncLocalAtomCount out of memory"</span>);
00526         <span class="keywordflow">return</span> (0);
00527     }
00528     <span class="keywordflow">return</span> ((<a class="code" href="../../d0/d4/ddemlcli_8h.html#a51">LATOM</a>)AddAtom(sz));
00529 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:18 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
