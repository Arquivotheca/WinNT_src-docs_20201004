<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: fekbd.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>fekbd.c</h1><a href="../../d4/d2/fekbd_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: fekbd.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* OEM-specific tables and routines for FarEast keyboards.</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00010 <span class="comment">\***************************************************************************/</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="../../d0/d4/w32_2ntuser_2kernel_2precomp_8h.html">precomp.h</a>"</span>
00013 <span class="preprocessor">#pragma hdrstop</span>
00014 <span class="preprocessor"></span>
00015 <span class="comment">/*</span>
00016 <span class="comment"> * This macro will clear Virtual key code.</span>
00017 <span class="comment"> */</span>
<a name="l00018"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a0">00018</a> <span class="preprocessor">#define NLS_CLEAR_VK(Vk)  \</span>
00019 <span class="preprocessor">    ((Vk) &amp;= (KBDEXT|KBDMULTIVK|KBDSPECIAL|KBDNUMPAD|KBDBREAK))</span>
00020 <span class="preprocessor"></span>
00021 <span class="comment">/*</span>
00022 <span class="comment"> * This macro will clear Virtual key code and 'make'/'break' bit.</span>
00023 <span class="comment"> */</span>
<a name="l00024"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a1">00024</a> <span class="preprocessor">#define NLS_CLEAR_VK_AND_ATTR(Vk) \</span>
00025 <span class="preprocessor">    ((Vk) &amp;= (KBDEXT|KBDMULTIVK|KBDSPECIAL|KBDNUMPAD))</span>
00026 <span class="preprocessor"></span>
00027 <span class="comment">/*</span>
00028 <span class="comment"> * VK_DBE_xxx tables.</span>
00029 <span class="comment"> */</span>
<a name="l00030"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a9">00030</a> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a9">NlsAlphaNumMode</a>[] = {VK_DBE_ALPHANUMERIC,VK_DBE_HIRAGANA,VK_DBE_KATAKANA,0};
<a name="l00031"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a10">00031</a> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a10">NlsSbcsDbcsMode</a>[] = {VK_DBE_SBCSCHAR,VK_DBE_DBCSCHAR,0};
<a name="l00032"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a11">00032</a> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a11">NlsRomanMode</a>[] = {VK_DBE_NOROMAN,VK_DBE_ROMAN,0};
<a name="l00033"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a12">00033</a> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a12">NlsCodeInputMode</a>[] = {VK_DBE_NOCODEINPUT,VK_DBE_CODEINPUT,0};
00034 
00035 <span class="comment">/*</span>
00036 <span class="comment"> * Modifiers for generate NLS Virtual Key.</span>
00037 <span class="comment"> */</span>
<a name="l00038"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a13">00038</a> VK_TO_BIT <a class="code" href="../../d4/d2/fekbd_8c.html#a13">aVkToBits_NLSKBD</a>[] = {
00039     { VK_SHIFT,   KBDSHIFT},
00040     { VK_CONTROL, KBDCTRL},
00041     { VK_MENU,    KBDALT},
00042     { 0,          0}
00043 };
00044 
<a name="l00045"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a14">00045</a> MODIFIERS <a class="code" href="../../d4/d2/fekbd_8c.html#a14">Modifiers_NLSKBD</a> = {
00046     &amp;<a class="code" href="../../d4/d2/fekbd_8c.html#a13">aVkToBits_NLSKBD</a>[0],
00047     7,
00048     {
00049         0,  <span class="comment">// modifier keys (VK modification number 0)</span>
00050         1,  <span class="comment">// modifier keys (VK modification number 1)</span>
00051         2,  <span class="comment">// modifier keys (VK modification number 2)</span>
00052         3,  <span class="comment">// modifier keys (VK modification number 3)</span>
00053         4,  <span class="comment">// modifier keys (VK modification number 4)</span>
00054         5,  <span class="comment">// modifier keys (VK modification number 5)</span>
00055         6,  <span class="comment">// modifier keys (VK modification number 6)</span>
00056         7,  <span class="comment">// modifier keys (VK modification number 7)</span>
00057     }
00058 };
00059 
00060 <span class="comment">/*</span>
00061 <span class="comment"> * For PC-9800 Series configuration.</span>
00062 <span class="comment"> */</span>
<a name="l00063"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a2">00063</a> <span class="preprocessor">#define GEN_KANA_AWARE 0x1 // Switch generation for VK_END/VK_HELP based on Kana On/Off.</span>
<a name="l00064"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a3">00064</a> <span class="preprocessor"></span><span class="preprocessor">#define GEN_VK_END     0x2 // Generate VK_END, otherwise VK_HELP.</span>
<a name="l00065"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a4">00065</a> <span class="preprocessor"></span><span class="preprocessor">#define GEN_VK_HOME    0x4 // Generate VK_HOME, otherwise VK_CLEAR.</span>
00066 <span class="preprocessor"></span>
<a name="l00067"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a5">00067</a> <span class="preprocessor">#define IS_KANA_AWARE()   (fNlsKbdConfiguration &amp; GEN_KANA_AWARE)</span>
<a name="l00068"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a6">00068</a> <span class="preprocessor"></span><span class="preprocessor">#define IS_SEND_VK_END()  (fNlsKbdConfiguration &amp; GEN_VK_END)</span>
<a name="l00069"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a7">00069</a> <span class="preprocessor"></span><span class="preprocessor">#define IS_SEND_VK_HOME() (fNlsKbdConfiguration &amp; GEN_VK_HOME)</span>
00070 <span class="preprocessor"></span>
<a name="l00071"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a15">00071</a> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a15">fNlsKbdConfiguration</a> = <a class="code" href="../../d4/d2/fekbd_8c.html#a2">GEN_KANA_AWARE</a> | <a class="code" href="../../d4/d2/fekbd_8c.html#a3">GEN_VK_END</a> | <a class="code" href="../../d4/d2/fekbd_8c.html#a4">GEN_VK_HOME</a>;
00072 
00073 <span class="comment">/***************************************************************************\</span>
00074 <span class="comment">* NlsTestKeyStateToggle()</span>
00075 <span class="comment">*</span>
00076 <span class="comment">* History:</span>
00077 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00078 <span class="comment">\***************************************************************************/</span>
00079 
<a name="l00080"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a18">00080</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(BYTE Vk)
00081 {
00082     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>) {
00083         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a840">TestKeyStateToggle</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>,Vk));
00084     } <span class="keywordflow">else</span> {
00085         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a846">TestAsyncKeyStateToggle</a>(Vk));
00086     }
00087 }
00088 
00089 <span class="comment">/***************************************************************************\</span>
00090 <span class="comment">* NlsSetKeyStateToggle(BYTE Vk)</span>
00091 <span class="comment">*</span>
00092 <span class="comment">* History:</span>
00093 <span class="comment">* 27-09-96 hideyukn       Created.</span>
00094 <span class="comment">\***************************************************************************/</span>
00095 
<a name="l00096"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a19">00096</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a19">NlsSetKeyStateToggle</a>(BYTE Vk)
00097 {
00098     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>)
00099         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a841">SetKeyStateToggle</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>,Vk);
00100     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a847">SetAsyncKeyStateToggle</a>(Vk);
00101 }
00102 
00103 <span class="comment">/***************************************************************************\</span>
00104 <span class="comment">* NlsClearKeyStateToggle()</span>
00105 <span class="comment">*</span>
00106 <span class="comment">* History:</span>
00107 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00108 <span class="comment">\***************************************************************************/</span>
00109 
<a name="l00110"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a20">00110</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a20">NlsClearKeyStateToggle</a>(BYTE Vk)
00111 {
00112     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>)
00113         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a842">ClearKeyStateToggle</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>,Vk);
00114     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a848">ClearAsyncKeyStateToggle</a>(Vk);
00115 }
00116 
00117 <span class="comment">/***************************************************************************\</span>
00118 <span class="comment">* NlsGetCurrentInputMode()</span>
00119 <span class="comment">*</span>
00120 <span class="comment">* History:</span>
00121 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00122 <span class="comment">\***************************************************************************/</span>
00123 
<a name="l00124"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a21">00124</a> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a21">NlsGetCurrentInputMode</a>(BYTE *QueryMode)
00125 {
00126     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *VkTable = QueryMode;
00127     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> VkDefault;
00128     <span class="comment">/*</span>
00129 <span class="comment">     * Get VkDefault, we will return this, if no bit is toggled.</span>
00130 <span class="comment">     */</span>
00131     VkDefault = *VkTable;
00132 
00133     <span class="keywordflow">while</span> (*VkTable) {
00134         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(*VkTable)) {
00135             <span class="keywordflow">return</span> *VkTable;
00136         }
00137         VkTable++;
00138     }
00139 
00140     <span class="comment">/* Something error */</span>
00141     <span class="keywordflow">return</span> VkDefault;
00142 }
00143 
00144 <span class="comment">/***************************************************************************\</span>
00145 <span class="comment">* NlsNullProc() - nothing to do</span>
00146 <span class="comment">*</span>
00147 <span class="comment">* History:</span>
00148 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00149 <span class="comment">\***************************************************************************/</span>
00150 
<a name="l00151"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a22">00151</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a22">NlsNullProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00152 {
00153     UNREFERENCED_PARAMETER(pKe);
00154     UNREFERENCED_PARAMETER(dwExtraInfo);
00155     UNREFERENCED_PARAMETER(dwParam);
00156 
00157     <span class="comment">/*</span>
00158 <span class="comment">     * Actually we should not get here...</span>
00159 <span class="comment">     */</span>
00160     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00161 }
00162 
00163 <span class="comment">/***************************************************************************\</span>
00164 <span class="comment">* NlsSendBaseVk() - nothing to do</span>
00165 <span class="comment">*</span>
00166 <span class="comment">* History:</span>
00167 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00168 <span class="comment">\***************************************************************************/</span>
00169 
<a name="l00170"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a23">00170</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a23">NlsSendBaseVk</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00171 {
00172     UNREFERENCED_PARAMETER(pKe);
00173     UNREFERENCED_PARAMETER(dwExtraInfo);
00174     UNREFERENCED_PARAMETER(dwParam);
00175 
00176     <span class="comment">/*</span>
00177 <span class="comment">     * We don't need to modify Original data.</span>
00178 <span class="comment">     */</span>
00179     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00180 }
00181 
00182 <span class="comment">/***************************************************************************\</span>
00183 <span class="comment">* NlsSendParamVk() - Replace original message with parameter</span>
00184 <span class="comment">*</span>
00185 <span class="comment">* History:</span>
00186 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00187 <span class="comment">\***************************************************************************/</span>
00188 
<a name="l00189"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a24">00189</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a24">NlsSendParamVk</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00190 {
00191     UNREFERENCED_PARAMETER(dwExtraInfo);
00192 
00193     <span class="comment">/*</span>
00194 <span class="comment">     * Clear Virtual code.</span>
00195 <span class="comment">     */</span>
00196     <a class="code" href="../../d4/d2/fekbd_8c.html#a0">NLS_CLEAR_VK</a>(pKe-&gt;usFlaggedVk);
00197     <span class="comment">/*</span>
00198 <span class="comment">     * Set parameter as new VK key.</span>
00199 <span class="comment">     */</span>
00200     pKe-&gt;usFlaggedVk |= (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)dwParam;
00201     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00202 }
00203 
00204 <span class="comment">/***************************************************************************\</span>
00205 <span class="comment">* NlsLapseProc() - Lapse handle (Locale dependent)</span>
00206 <span class="comment">*</span>
00207 <span class="comment">* History:</span>
00208 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00209 <span class="comment">\***************************************************************************/</span>
00210 
<a name="l00211"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a25">00211</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a25">NlsLapseProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00212 {
00213     UNREFERENCED_PARAMETER(pKe);
00214     UNREFERENCED_PARAMETER(dwExtraInfo);
00215     UNREFERENCED_PARAMETER(dwParam);
00216 
00217     <span class="comment">/*</span>
00218 <span class="comment">     * Just throw away this event.</span>
00219 <span class="comment">     */</span>
00220     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00221 }
00222 
00223 <span class="comment">/***************************************************************************\</span>
00224 <span class="comment">* AlphanumericModeProc() - handle special case Alphanumeric key</span>
00225 <span class="comment">*</span>
00226 <span class="comment">* History:</span>
00227 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00228 <span class="comment">\***************************************************************************/</span>
00229 
<a name="l00230"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a26">00230</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a26">NlsAlphanumericModeProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00231 {
00232     <span class="keywordflow">if</span> (!(pKe-&gt;usFlaggedVk &amp; KBDBREAK)) {
00233         <span class="comment">/*</span>
00234 <span class="comment">         * We are in 'make' sequence.</span>
00235 <span class="comment">         */</span>
00236         <span class="comment">/*</span>
00237 <span class="comment">         * Clear Virtual code.</span>
00238 <span class="comment">         */</span>
00239         <a class="code" href="../../d4/d2/fekbd_8c.html#a0">NLS_CLEAR_VK</a>(pKe-&gt;usFlaggedVk);
00240 
00241         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(VK_DBE_ALPHANUMERIC)) {
00242             <span class="comment">/*</span>
00243 <span class="comment">             * Query current mode.</span>
00244 <span class="comment">             */</span>
00245             <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> CurrentMode = <a class="code" href="../../d4/d2/fekbd_8c.html#a21">NlsGetCurrentInputMode</a>(<a class="code" href="../../d4/d2/fekbd_8c.html#a9">NlsAlphaNumMode</a>);
00246             <span class="comment">/*</span>
00247 <span class="comment">             * Off toggle for previous key mode.</span>
00248 <span class="comment">             */</span>
00249             <a class="code" href="../../d4/d2/fekbd_8c.html#a20">NlsClearKeyStateToggle</a>(CurrentMode);
00250             <span class="comment">/*</span>
00251 <span class="comment">             * We are not in 'AlphaNumeric' mode, before enter 'AlphaNumeric'</span>
00252 <span class="comment">             * mode, we should send 'break' for previous key mode.</span>
00253 <span class="comment">             */</span>
00254             <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(pKe-&gt;usFlaggedVk | CurrentMode | KBDBREAK),
00255                       pKe-&gt;bScanCode, pKe-&gt;dwTime, dwExtraInfo, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00256         }
00257         <span class="comment">/*</span>
00258 <span class="comment">         * Switch to 'AlphaNumeric' mode.</span>
00259 <span class="comment">         */</span>
00260         pKe-&gt;usFlaggedVk |= VK_DBE_ALPHANUMERIC;
00261 
00262         <span class="comment">/*</span>
00263 <span class="comment">         * Call i/o control.</span>
00264 <span class="comment">         */</span>
00265         <span class="keywordflow">if</span> ((!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a231">gdwIMEOpenStatus</a>) &amp;&amp; <a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(VK_KANA)) {
00266             <a class="code" href="../../d4/d1/userk_8h.html#a2106">NlsKbdSendIMEProc</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, IME_CMODE_KATAKANA);
00267         }
00268     } <span class="keywordflow">else</span> {
00269         <span class="keywordflow">return</span> <a class="code" href="../../d4/d2/fekbd_8c.html#a25">NlsLapseProc</a>(pKe,dwExtraInfo,dwParam);
00270     }
00271     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00272 }
00273 
00274 <span class="comment">/***************************************************************************\</span>
00275 <span class="comment">* KatakanaModeProc() - handle special case Katakana key</span>
00276 <span class="comment">*</span>
00277 <span class="comment">* History:</span>
00278 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00279 <span class="comment">\***************************************************************************/</span>
00280 
<a name="l00281"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a27">00281</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a27">NlsKatakanaModeProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00282 {
00283     <span class="keywordflow">if</span> (!(pKe-&gt;usFlaggedVk &amp; KBDBREAK)) {
00284         <span class="comment">/*</span>
00285 <span class="comment">         * We are in 'make' sequence.</span>
00286 <span class="comment">         */</span>
00287         <span class="comment">/*</span>
00288 <span class="comment">         * Clear Virtual code.</span>
00289 <span class="comment">         */</span>
00290         <a class="code" href="../../d4/d2/fekbd_8c.html#a0">NLS_CLEAR_VK</a>(pKe-&gt;usFlaggedVk);
00291 
00292         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(VK_DBE_KATAKANA)) {
00293             <span class="comment">/*</span>
00294 <span class="comment">             * Query current mode.</span>
00295 <span class="comment">             */</span>
00296             <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> CurrentMode = <a class="code" href="../../d4/d2/fekbd_8c.html#a21">NlsGetCurrentInputMode</a>(<a class="code" href="../../d4/d2/fekbd_8c.html#a9">NlsAlphaNumMode</a>);
00297             <span class="comment">/*</span>
00298 <span class="comment">             * Off toggle for previous key mode.</span>
00299 <span class="comment">             */</span>
00300             <a class="code" href="../../d4/d2/fekbd_8c.html#a20">NlsClearKeyStateToggle</a>(CurrentMode);
00301             <span class="comment">/*</span>
00302 <span class="comment">             * We are not in 'Katakana' mode, yet. Before enter 'Katakana'</span>
00303 <span class="comment">             * mode, we should make 'break key' for previous mode.</span>
00304 <span class="comment">             */</span>
00305             <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(pKe-&gt;usFlaggedVk | CurrentMode | KBDBREAK),
00306                        pKe-&gt;bScanCode, pKe-&gt;dwTime, dwExtraInfo, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00307         }
00308         <span class="comment">/*</span>
00309 <span class="comment">         * Switch to 'Katakana' mode.</span>
00310 <span class="comment">         */</span>
00311         pKe-&gt;usFlaggedVk |= VK_DBE_KATAKANA;
00312 
00313         <span class="comment">/*</span>
00314 <span class="comment">         * Call i/o control.</span>
00315 <span class="comment">         */</span>
00316         <span class="keywordflow">if</span> ((!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a231">gdwIMEOpenStatus</a>) &amp;&amp; (!(<a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(VK_KANA)))) {
00317             <a class="code" href="../../d4/d1/userk_8h.html#a2106">NlsKbdSendIMEProc</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, IME_CMODE_ALPHANUMERIC);
00318         }
00319     } <span class="keywordflow">else</span> {
00320         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d2/fekbd_8c.html#a25">NlsLapseProc</a>(pKe,dwExtraInfo,dwParam));
00321     }
00322     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00323 }
00324 
00325 <span class="comment">/***************************************************************************\</span>
00326 <span class="comment">* HiraganaModeProc() - handle special case Hiragana key (Locale dependent)</span>
00327 <span class="comment">*</span>
00328 <span class="comment">* History:</span>
00329 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00330 <span class="comment">\***************************************************************************/</span>
00331 
<a name="l00332"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a28">00332</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a28">NlsHiraganaModeProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00333 {
00334     <span class="keywordflow">if</span> (!(pKe-&gt;usFlaggedVk &amp; KBDBREAK)) {
00335         <span class="comment">/*</span>
00336 <span class="comment">         * We are in 'make' sequence.</span>
00337 <span class="comment">         */</span>
00338         <span class="comment">/*</span>
00339 <span class="comment">         * Clear Virtual code.</span>
00340 <span class="comment">         */</span>
00341         <a class="code" href="../../d4/d2/fekbd_8c.html#a0">NLS_CLEAR_VK</a>(pKe-&gt;usFlaggedVk);
00342 
00343         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(VK_DBE_HIRAGANA)) {
00344             <span class="comment">/*</span>
00345 <span class="comment">             * Query current mode.</span>
00346 <span class="comment">             */</span>
00347             <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> CurrentMode = <a class="code" href="../../d4/d2/fekbd_8c.html#a21">NlsGetCurrentInputMode</a>(<a class="code" href="../../d4/d2/fekbd_8c.html#a9">NlsAlphaNumMode</a>);
00348             <span class="comment">/*</span>
00349 <span class="comment">             * Off toggle for previous key mode.</span>
00350 <span class="comment">             */</span>
00351             <a class="code" href="../../d4/d2/fekbd_8c.html#a20">NlsClearKeyStateToggle</a>(CurrentMode);
00352             <span class="comment">/*</span>
00353 <span class="comment">             * We are not in 'Hiragana' mode, yet. Before enter 'Hiragana'</span>
00354 <span class="comment">             * mode, we should make 'break key' for previous key.</span>
00355 <span class="comment">             */</span>
00356             <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(pKe-&gt;usFlaggedVk | CurrentMode | KBDBREAK),
00357                       pKe-&gt;bScanCode, pKe-&gt;dwTime, dwExtraInfo, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00358         }
00359         <span class="comment">/*</span>
00360 <span class="comment">         * Switch to 'Hiragana' mode.</span>
00361 <span class="comment">         */</span>
00362         pKe-&gt;usFlaggedVk |= VK_DBE_HIRAGANA;
00363 
00364         <span class="comment">/*</span>
00365 <span class="comment">         * Call i/o control.</span>
00366 <span class="comment">         */</span>
00367         <span class="keywordflow">if</span> ((!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a231">gdwIMEOpenStatus</a>) &amp;&amp; (!(<a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(VK_KANA)))) {
00368             <a class="code" href="../../d4/d1/userk_8h.html#a2106">NlsKbdSendIMEProc</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, IME_CMODE_ALPHANUMERIC);
00369         }
00370     } <span class="keywordflow">else</span> {
00371         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d2/fekbd_8c.html#a25">NlsLapseProc</a>(pKe,dwExtraInfo,dwParam));
00372     }
00373     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00374 }
00375 
00376 <span class="comment">/***************************************************************************\</span>
00377 <span class="comment">* SbcsDbcsToggleProc() - handle special case SBCS/DBCS key</span>
00378 <span class="comment">*</span>
00379 <span class="comment">* History:</span>
00380 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00381 <span class="comment">\***************************************************************************/</span>
00382 
<a name="l00383"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a29">00383</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a29">NlsSbcsDbcsToggleProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00384 {
00385     <span class="keywordflow">if</span> (!(pKe-&gt;usFlaggedVk &amp; KBDBREAK)) {
00386         <span class="comment">/*</span>
00387 <span class="comment">         * We are in 'make' sequence.</span>
00388 <span class="comment">         */</span>
00389         <span class="comment">/*</span>
00390 <span class="comment">         * Query current 'Sbcs'/'Dbcs' mode.</span>
00391 <span class="comment">         */</span>
00392         <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> CurrentMode = <a class="code" href="../../d4/d2/fekbd_8c.html#a21">NlsGetCurrentInputMode</a>(<a class="code" href="../../d4/d2/fekbd_8c.html#a10">NlsSbcsDbcsMode</a>);
00393         <span class="comment">/*</span>
00394 <span class="comment">         * Clear Virtual code.</span>
00395 <span class="comment">         */</span>
00396         <a class="code" href="../../d4/d2/fekbd_8c.html#a0">NLS_CLEAR_VK</a>(pKe-&gt;usFlaggedVk);
00397         <span class="comment">/*</span>
00398 <span class="comment">         * Off toggle for previous key mode.</span>
00399 <span class="comment">         */</span>
00400         <a class="code" href="../../d4/d2/fekbd_8c.html#a20">NlsClearKeyStateToggle</a>(CurrentMode);
00401 
00402         <span class="keywordflow">switch</span> (CurrentMode) {
00403         <span class="keywordflow">case</span> VK_DBE_SBCSCHAR:
00404             <span class="comment">/*</span>
00405 <span class="comment">             * We are in 'SbcsChar' mode, let us send 'break key' for that.</span>
00406 <span class="comment">             */</span>
00407             <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(pKe-&gt;usFlaggedVk|VK_DBE_SBCSCHAR|KBDBREAK),
00408                       pKe-&gt;bScanCode, pKe-&gt;dwTime, dwExtraInfo, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00409             <span class="comment">/*</span>
00410 <span class="comment">             * Then, switch to 'DbcsChar' mode.</span>
00411 <span class="comment">             */</span>
00412             pKe-&gt;usFlaggedVk |= VK_DBE_DBCSCHAR;
00413             <span class="keywordflow">break</span>;
00414         <span class="keywordflow">case</span> VK_DBE_DBCSCHAR:
00415             <span class="comment">/*</span>
00416 <span class="comment">             * We are in 'DbcsChar' mode, let us send 'break key' for that.</span>
00417 <span class="comment">             */</span>
00418             <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(pKe-&gt;usFlaggedVk|VK_DBE_DBCSCHAR|KBDBREAK),
00419                       pKe-&gt;bScanCode, pKe-&gt;dwTime, dwExtraInfo, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00420             <span class="comment">/*</span>
00421 <span class="comment">             * Then, switch to 'SbcsChar' mode.</span>
00422 <span class="comment">             */</span>
00423             pKe-&gt;usFlaggedVk |= VK_DBE_SBCSCHAR;
00424             <span class="keywordflow">break</span>;
00425         }
00426     } <span class="keywordflow">else</span> {
00427         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d2/fekbd_8c.html#a25">NlsLapseProc</a>(pKe,dwExtraInfo,dwParam));
00428     }
00429     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00430 }
00431 
00432 <span class="comment">/***************************************************************************\</span>
00433 <span class="comment">* RomanToggleProc() - handle special case Roman key (Locale dependent)</span>
00434 <span class="comment">*</span>
00435 <span class="comment">* History:</span>
00436 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00437 <span class="comment">\***************************************************************************/</span>
00438 
<a name="l00439"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a30">00439</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a30">NlsRomanToggleProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00440 {
00441     <span class="keywordflow">if</span> (!(pKe-&gt;usFlaggedVk &amp; KBDBREAK)) {
00442         <span class="comment">/*</span>
00443 <span class="comment">         * We are in 'make' sequence.</span>
00444 <span class="comment">         */</span>
00445         <span class="comment">/*</span>
00446 <span class="comment">         * Query current 'Roman'/'NoRoman' mode.</span>
00447 <span class="comment">         */</span>
00448         <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> CurrentMode = <a class="code" href="../../d4/d2/fekbd_8c.html#a21">NlsGetCurrentInputMode</a>(<a class="code" href="../../d4/d2/fekbd_8c.html#a11">NlsRomanMode</a>);
00449         <span class="comment">/*</span>
00450 <span class="comment">         * Clear Virtual code.</span>
00451 <span class="comment">         */</span>
00452         <a class="code" href="../../d4/d2/fekbd_8c.html#a0">NLS_CLEAR_VK</a>(pKe-&gt;usFlaggedVk);
00453         <span class="comment">/*</span>
00454 <span class="comment">         * Off toggle for previous key mode.</span>
00455 <span class="comment">         */</span>
00456         <a class="code" href="../../d4/d2/fekbd_8c.html#a20">NlsClearKeyStateToggle</a>(CurrentMode);
00457 
00458         <span class="keywordflow">switch</span> (CurrentMode) {
00459             <span class="keywordflow">case</span> VK_DBE_NOROMAN:
00460                 <span class="comment">/*</span>
00461 <span class="comment">                 * We are in 'NoRoman' mode, let us send 'break key' for that.</span>
00462 <span class="comment">                 */</span>
00463                 <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(pKe-&gt;usFlaggedVk|VK_DBE_NOROMAN|KBDBREAK),
00464                           pKe-&gt;bScanCode, pKe-&gt;dwTime, dwExtraInfo, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00465                 <span class="comment">/*</span>
00466 <span class="comment">                 * Then, switch to 'Roman' mode.</span>
00467 <span class="comment">                 */</span>
00468                 pKe-&gt;usFlaggedVk |= VK_DBE_ROMAN;
00469                 <span class="keywordflow">break</span>;
00470             <span class="keywordflow">case</span> VK_DBE_ROMAN:
00471                 <span class="comment">/*</span>
00472 <span class="comment">                 * We are in 'Roman' mode, let us send 'break key' for that.</span>
00473 <span class="comment">                 */</span>
00474                 <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(pKe-&gt;usFlaggedVk|VK_DBE_ROMAN|KBDBREAK),
00475                           pKe-&gt;bScanCode, pKe-&gt;dwTime, dwExtraInfo, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00476                 <span class="comment">/*</span>
00477 <span class="comment">                 * Then, switch to 'NoRoman' mode.</span>
00478 <span class="comment">                 */</span>
00479                 pKe-&gt;usFlaggedVk |= VK_DBE_NOROMAN;
00480                 <span class="keywordflow">break</span>;
00481         }
00482     } <span class="keywordflow">else</span> {
00483         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d2/fekbd_8c.html#a25">NlsLapseProc</a>(pKe,dwExtraInfo,dwParam));
00484     }
00485     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00486 }
00487 
00488 <span class="comment">/***************************************************************************\</span>
00489 <span class="comment">* CodeInputToggleProc() - handle special case Code Input key</span>
00490 <span class="comment">*</span>
00491 <span class="comment">* History:</span>
00492 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00493 <span class="comment">\***************************************************************************/</span>
00494 
<a name="l00495"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a31">00495</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a31">NlsCodeInputToggleProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00496 {
00497     <span class="keywordflow">if</span> (!(pKe-&gt;usFlaggedVk &amp; KBDBREAK)) {
00498         <span class="comment">/*</span>
00499 <span class="comment">         * We are in 'make' sequence.</span>
00500 <span class="comment">         */</span>
00501         <span class="comment">/*</span>
00502 <span class="comment">         * Query current 'CodeInput'/'NoCodeInput' mode.</span>
00503 <span class="comment">         */</span>
00504         <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> CurrentMode = <a class="code" href="../../d4/d2/fekbd_8c.html#a21">NlsGetCurrentInputMode</a>(<a class="code" href="../../d4/d2/fekbd_8c.html#a12">NlsCodeInputMode</a>);
00505         <span class="comment">/*</span>
00506 <span class="comment">         * Clear Virtual code.</span>
00507 <span class="comment">         */</span>
00508         <a class="code" href="../../d4/d2/fekbd_8c.html#a0">NLS_CLEAR_VK</a>(pKe-&gt;usFlaggedVk);
00509         <span class="comment">/*</span>
00510 <span class="comment">         * Off toggle for previous key mode.</span>
00511 <span class="comment">         */</span>
00512         <a class="code" href="../../d4/d2/fekbd_8c.html#a20">NlsClearKeyStateToggle</a>(CurrentMode);
00513 
00514         <span class="keywordflow">switch</span> (CurrentMode) {
00515             <span class="keywordflow">case</span> VK_DBE_NOCODEINPUT:
00516                 <span class="comment">/*</span>
00517 <span class="comment">                 * We are in 'NoCodeInput' mode, let us send 'break key' for that.</span>
00518 <span class="comment">                 */</span>
00519                 <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(pKe-&gt;usFlaggedVk|VK_DBE_NOCODEINPUT|KBDBREAK),
00520                           pKe-&gt;bScanCode, pKe-&gt;dwTime, dwExtraInfo, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00521                 <span class="comment">/*</span>
00522 <span class="comment">                 * Then, switch to 'CodeInput' mode.</span>
00523 <span class="comment">                 */</span>
00524                 pKe-&gt;usFlaggedVk |= VK_DBE_CODEINPUT;
00525                 <span class="keywordflow">break</span>;
00526             <span class="keywordflow">case</span> VK_DBE_CODEINPUT:
00527                 <span class="comment">/*</span>
00528 <span class="comment">                 * We are in 'CodeInput' mode, let us send 'break key' for that.</span>
00529 <span class="comment">                 */</span>
00530                 <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(pKe-&gt;usFlaggedVk|VK_DBE_CODEINPUT|KBDBREAK),
00531                           pKe-&gt;bScanCode, pKe-&gt;dwTime, dwExtraInfo, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00532                 <span class="comment">/*</span>
00533 <span class="comment">                 * Then, switch to 'NoCodeInput' mode.</span>
00534 <span class="comment">                 */</span>
00535                 pKe-&gt;usFlaggedVk |= VK_DBE_NOCODEINPUT;
00536                 <span class="keywordflow">break</span>;
00537         }
00538     } <span class="keywordflow">else</span> {
00539         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d2/fekbd_8c.html#a25">NlsLapseProc</a>(pKe,dwExtraInfo,dwParam));
00540     }
00541     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00542 }
00543 
00544 <span class="comment">/***************************************************************************\</span>
00545 <span class="comment">* KanaToggleProc() - handle special case Kana key (Locale dependent)</span>
00546 <span class="comment">*</span>
00547 <span class="comment">* History:</span>
00548 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00549 <span class="comment">\***************************************************************************/</span>
00550 
<a name="l00551"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a32">00551</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a32">NlsKanaModeToggleProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00552 {
00553     <span class="comment">/*</span>
00554 <span class="comment">     * Check this is 'make' or 'break'.</span>
00555 <span class="comment">     */</span>
00556     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bMake = !(pKe-&gt;usFlaggedVk &amp; KBDBREAK);
00557     <span class="comment">/*</span>
00558 <span class="comment">     * Check we are in 'kana' mode or not.</span>
00559 <span class="comment">     */</span>
00560     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bKana = <a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(VK_KANA);
00561     <span class="comment">/*</span>
00562 <span class="comment">     * Clear virtual code and key attributes.</span>
00563 <span class="comment">     */</span>
00564     <a class="code" href="../../d4/d2/fekbd_8c.html#a1">NLS_CLEAR_VK_AND_ATTR</a>(pKe-&gt;usFlaggedVk);
00565 
00566     <span class="keywordflow">if</span> (bMake) {
00567         <span class="comment">/*</span>
00568 <span class="comment">         * We are in 'make' sequence.</span>
00569 <span class="comment">         */</span>
00570         <span class="keywordflow">if</span> (bKana) {
00571             <span class="comment">/*</span>
00572 <span class="comment">             * Make 'break' for VK_KANA.</span>
00573 <span class="comment">             */</span>
00574             pKe-&gt;usFlaggedVk |= (VK_KANA|KBDBREAK);
00575         } <span class="keywordflow">else</span> {
00576             <span class="comment">/*</span>
00577 <span class="comment">             * Not yet in 'kana' mode, Let generate 'make' for VK_KANA...</span>
00578 <span class="comment">             */</span>
00579             pKe-&gt;usFlaggedVk |= VK_KANA;
00580         }
00581         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00582     } <span class="keywordflow">else</span> {
00583         <span class="comment">/*</span>
00584 <span class="comment">         * We will keep 'down' &amp; 'toggled' in 'kana' mode,</span>
00585 <span class="comment">         * then don't need to generate 'break' for VK_KANA.</span>
00586 <span class="comment">         * when next time generate 'make' for this, we will generate</span>
00587 <span class="comment">         * 'break' for this.</span>
00588 <span class="comment">         */</span>
00589         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d2/fekbd_8c.html#a25">NlsLapseProc</a>(pKe,dwExtraInfo,dwParam));
00590     }
00591 }
00592 
00593 <span class="comment">/**********************************************************************\</span>
00594 <span class="comment">* NlsHelpOrEndProc()</span>
00595 <span class="comment">*</span>
00596 <span class="comment">* History:</span>
00597 <span class="comment">* 26-09-96 hideyukn       Ported from NEC code.</span>
00598 <span class="comment">\**********************************************************************/</span>
00599 
<a name="l00600"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a33">00600</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a33">NlsHelpOrEndProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00601 {
00602     UNREFERENCED_PARAMETER(dwExtraInfo);
00603     UNREFERENCED_PARAMETER(dwParam);
00604 
00605     <span class="keywordflow">if</span> (!(pKe-&gt;usFlaggedVk &amp; KBDNUMPAD)) {
00606         <span class="comment">/*</span>
00607 <span class="comment">         * Clear Virtual code.</span>
00608 <span class="comment">         */</span>
00609         <a class="code" href="../../d4/d2/fekbd_8c.html#a0">NLS_CLEAR_VK</a>(pKe-&gt;usFlaggedVk);
00610 
00611         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d2/fekbd_8c.html#a5">IS_KANA_AWARE</a>()) {
00612             <span class="comment">/*</span>
00613 <span class="comment">             * We don't care 'kana' status. just check VK_END or VK_HELP.</span>
00614 <span class="comment">             */</span>
00615             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d2/fekbd_8c.html#a6">IS_SEND_VK_END</a>()) {
00616                 pKe-&gt;usFlaggedVk |= VK_END;
00617             } <span class="keywordflow">else</span> {
00618                 pKe-&gt;usFlaggedVk |= VK_HELP;
00619             }
00620         } <span class="keywordflow">else</span> {
00621             <span class="comment">/*</span>
00622 <span class="comment">             * We care 'kana' status.</span>
00623 <span class="comment">             */</span>
00624             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d2/fekbd_8c.html#a6">IS_SEND_VK_END</a>()) {
00625                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(VK_KANA)) {
00626                     pKe-&gt;usFlaggedVk |= VK_HELP;
00627                 } <span class="keywordflow">else</span> {
00628                     pKe-&gt;usFlaggedVk |= VK_END;
00629                 }
00630             } <span class="keywordflow">else</span> {
00631                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(VK_KANA)) {
00632                     pKe-&gt;usFlaggedVk |= VK_END;
00633                 } <span class="keywordflow">else</span> {
00634                     pKe-&gt;usFlaggedVk |= VK_HELP;
00635                 }
00636             }
00637         }
00638     }
00639     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00640 }
00641 
00642 <span class="comment">/**********************************************************************\</span>
00643 <span class="comment">* NlsHelpOrEndProc()</span>
00644 <span class="comment">*</span>
00645 <span class="comment">* History:</span>
00646 <span class="comment">* 26-09-96 hideyukn       Ported from NEC code.</span>
00647 <span class="comment">\**********************************************************************/</span>
00648 
<a name="l00649"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a34">00649</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a34">NlsHomeOrClearProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00650 {
00651     UNREFERENCED_PARAMETER(dwExtraInfo);
00652     UNREFERENCED_PARAMETER(dwParam);
00653 
00654     <span class="keywordflow">if</span> (!(pKe-&gt;usFlaggedVk &amp; KBDNUMPAD)) {
00655         <span class="comment">/*</span>
00656 <span class="comment">         * Clear virtual code.</span>
00657 <span class="comment">         */</span>
00658         <a class="code" href="../../d4/d2/fekbd_8c.html#a0">NLS_CLEAR_VK</a>(pKe-&gt;usFlaggedVk);
00659 
00660         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d2/fekbd_8c.html#a7">IS_SEND_VK_HOME</a>()) {
00661             pKe-&gt;usFlaggedVk |= VK_HOME;
00662         } <span class="keywordflow">else</span> {
00663             pKe-&gt;usFlaggedVk |= VK_CLEAR;
00664         }
00665     }
00666     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00667 }
00668 
00669 <span class="comment">/**********************************************************************\</span>
00670 <span class="comment">* NlsNumpadModeProc()</span>
00671 <span class="comment">*</span>
00672 <span class="comment">* History:</span>
00673 <span class="comment">* 26-09-96 hideyukn       Ported from NEC code.</span>
00674 <span class="comment">\**********************************************************************/</span>
00675 
<a name="l00676"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a35">00676</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a35">NlsNumpadModeProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00677 {
00678     <span class="comment">/*</span>
00679 <span class="comment">     * Get current Virtual key.</span>
00680 <span class="comment">     */</span>
00681     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> Vk = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(pKe-&gt;usFlaggedVk);
00682 
00683     UNREFERENCED_PARAMETER(dwExtraInfo);
00684     UNREFERENCED_PARAMETER(dwParam);
00685 
00686     <span class="keywordflow">if</span>(!<a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(VK_NUMLOCK)) {
00687         <span class="comment">/*</span>
00688 <span class="comment">         * Clear virtual code.</span>
00689 <span class="comment">         */</span>
00690         <a class="code" href="../../d4/d2/fekbd_8c.html#a0">NLS_CLEAR_VK</a>(pKe-&gt;usFlaggedVk);
00691 
00692         <span class="keywordflow">switch</span> (Vk) {
00693         <span class="keywordflow">case</span> VK_NUMPAD0:
00694              pKe-&gt;usFlaggedVk |= VK_INSERT;
00695              <span class="keywordflow">break</span>;
00696         <span class="keywordflow">case</span> VK_NUMPAD1:
00697              pKe-&gt;usFlaggedVk |= VK_END;
00698              <span class="keywordflow">break</span>;
00699         <span class="keywordflow">case</span> VK_NUMPAD2:
00700              pKe-&gt;usFlaggedVk |= VK_DOWN;
00701              <span class="keywordflow">break</span>;
00702         <span class="keywordflow">case</span> VK_NUMPAD3:
00703              pKe-&gt;usFlaggedVk |= VK_NEXT;
00704              <span class="keywordflow">break</span>;
00705         <span class="keywordflow">case</span> VK_NUMPAD4:
00706              pKe-&gt;usFlaggedVk |= VK_LEFT;
00707              <span class="keywordflow">break</span>;
00708         <span class="keywordflow">case</span> VK_NUMPAD5:
00709              pKe-&gt;usFlaggedVk |= VK_CLEAR;
00710              <span class="keywordflow">break</span>;
00711         <span class="keywordflow">case</span> VK_NUMPAD6:
00712              pKe-&gt;usFlaggedVk |= VK_RIGHT;
00713              <span class="keywordflow">break</span>;
00714         <span class="keywordflow">case</span> VK_NUMPAD7:
00715              pKe-&gt;usFlaggedVk |= VK_HOME;
00716              <span class="keywordflow">break</span>;
00717         <span class="keywordflow">case</span> VK_NUMPAD8:
00718              pKe-&gt;usFlaggedVk |= VK_UP;
00719              <span class="keywordflow">break</span>;
00720         <span class="keywordflow">case</span> VK_NUMPAD9:
00721              pKe-&gt;usFlaggedVk |= VK_PRIOR;
00722              <span class="keywordflow">break</span>;
00723         <span class="keywordflow">case</span> VK_DECIMAL:
00724              pKe-&gt;usFlaggedVk |= VK_DELETE;
00725              <span class="keywordflow">break</span>;
00726         }
00727 
00728     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a579">TestRawKeyDown</a>(VK_SHIFT)) {
00729         <span class="comment">/*</span>
00730 <span class="comment">         * Clear virtual code.</span>
00731 <span class="comment">         */</span>
00732         <a class="code" href="../../d4/d2/fekbd_8c.html#a0">NLS_CLEAR_VK</a>(pKe-&gt;usFlaggedVk);
00733 
00734         <span class="keywordflow">switch</span> (Vk) {
00735         <span class="keywordflow">case</span> VK_NUMPAD0:
00736              pKe-&gt;usFlaggedVk |= VK_INSERT;
00737              <span class="keywordflow">break</span>;
00738         <span class="keywordflow">case</span> VK_NUMPAD1:
00739              pKe-&gt;usFlaggedVk |= VK_END;
00740              <span class="keywordflow">break</span>;
00741         <span class="keywordflow">case</span> VK_NUMPAD2:
00742              pKe-&gt;usFlaggedVk |= VK_DOWN;
00743              <span class="keywordflow">break</span>;
00744         <span class="keywordflow">case</span> VK_NUMPAD3:
00745              pKe-&gt;usFlaggedVk |= VK_NEXT;
00746              <span class="keywordflow">break</span>;
00747         <span class="keywordflow">case</span> VK_NUMPAD4:
00748              pKe-&gt;usFlaggedVk |= VK_LEFT;
00749              <span class="keywordflow">break</span>;
00750         <span class="keywordflow">case</span> VK_NUMPAD5:
00751              pKe-&gt;usFlaggedVk |= VK_CLEAR;
00752              <span class="keywordflow">break</span>;
00753         <span class="keywordflow">case</span> VK_NUMPAD6:
00754              pKe-&gt;usFlaggedVk |= VK_RIGHT;
00755              <span class="keywordflow">break</span>;
00756         <span class="keywordflow">case</span> VK_NUMPAD7:
00757              pKe-&gt;usFlaggedVk |= VK_HOME;
00758              <span class="keywordflow">break</span>;
00759         <span class="keywordflow">case</span> VK_NUMPAD8:
00760              pKe-&gt;usFlaggedVk |= VK_UP;
00761              <span class="keywordflow">break</span>;
00762         <span class="keywordflow">case</span> VK_NUMPAD9:
00763              pKe-&gt;usFlaggedVk |= VK_PRIOR;
00764              <span class="keywordflow">break</span>;
00765         <span class="keywordflow">case</span> VK_DECIMAL:
00766              pKe-&gt;usFlaggedVk |= VK_DELETE;
00767              <span class="keywordflow">break</span>;
00768         }
00769     } <span class="keywordflow">else</span> {
00770         <span class="comment">/*</span>
00771 <span class="comment">         * Otherwise, just pass through...</span>
00772 <span class="comment">         */</span>
00773     }
00774     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00775 }
00776 
00777 <span class="comment">/**********************************************************************\</span>
00778 <span class="comment">* NlsKanaEventProc() - Fujitsu FMV oyayubi shift keyboard use only.</span>
00779 <span class="comment">*</span>
00780 <span class="comment">* History:</span>
00781 <span class="comment">* 10-10-96 v-kazuta       Created.</span>
00782 <span class="comment">\**********************************************************************/</span>
<a name="l00783"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a36">00783</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a36">NlsKanaEventProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00784 {
00785     UNREFERENCED_PARAMETER(dwExtraInfo);
00786     <span class="comment">/*</span>
00787 <span class="comment">     * Clear Virtual code.</span>
00788 <span class="comment">     */</span>
00789     <a class="code" href="../../d4/d2/fekbd_8c.html#a0">NLS_CLEAR_VK</a>(pKe-&gt;usFlaggedVk);
00790 
00791     <span class="comment">/*</span>
00792 <span class="comment">     * Set parameter as new VK key.</span>
00793 <span class="comment">     */</span>
00794     pKe-&gt;usFlaggedVk |= (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)dwParam;
00795 
00796     <span class="comment">/*</span>
00797 <span class="comment">     * Send notification to kernel mode keyboard driver.</span>
00798 <span class="comment">     */</span>
00799     <span class="keywordflow">if</span> (!(pKe-&gt;usFlaggedVk &amp; KBDBREAK)) {
00800         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(VK_KANA)) {
00801             <span class="comment">/*</span>
00802 <span class="comment">             * Call i/o control.</span>
00803 <span class="comment">             */</span>
00804             <a class="code" href="../../d4/d1/userk_8h.html#a2106">NlsKbdSendIMEProc</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, IME_CMODE_ALPHANUMERIC);
00805         } <span class="keywordflow">else</span> {
00806             <span class="comment">/*</span>
00807 <span class="comment">             * Call i/o control.</span>
00808 <span class="comment">             */</span>
00809             <a class="code" href="../../d4/d1/userk_8h.html#a2106">NlsKbdSendIMEProc</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, IME_CMODE_KATAKANA);
00810         }
00811     }
00812     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00813 }
00814 
00815 <span class="comment">/**********************************************************************\</span>
00816 <span class="comment">* NlsConvOrNonConvProc() - Fujitsu FMV oyayubi shift keyboard only.</span>
00817 <span class="comment">*</span>
00818 <span class="comment">* History:</span>
00819 <span class="comment">* 10-10-96 v-kazuta       Created.</span>
00820 <span class="comment">\**********************************************************************/</span>
<a name="l00821"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a37">00821</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a37">NlsConvOrNonConvProc</a>(PKE pKe, ULONG_PTR dwExtraInfo, ULONG dwParam)
00822 {
00823     UNREFERENCED_PARAMETER(pKe);
00824     UNREFERENCED_PARAMETER(dwExtraInfo);
00825     UNREFERENCED_PARAMETER(dwParam);
00826     <span class="comment">/*</span>
00827 <span class="comment">     *</span>
00828 <span class="comment">     */</span>
00829     <span class="keywordflow">if</span> ((!<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a231">gdwIMEOpenStatus</a>) &amp;&amp; (!(<a class="code" href="../../d4/d2/fekbd_8c.html#a18">NlsTestKeyStateToggle</a>(VK_KANA)))) {
00830         <a class="code" href="../../d4/d1/userk_8h.html#a2106">NlsKbdSendIMEProc</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, IME_CMODE_ALPHANUMERIC);
00831     }
00832     <span class="comment">/*</span>
00833 <span class="comment">     * We don't need to modify Original data.</span>
00834 <span class="comment">     */</span>
00835     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00836 }
00837 
00838 <span class="comment">/**********************************************************************\</span>
00839 <span class="comment">* Index to function body dispatcher table</span>
00840 <span class="comment">*</span>
00841 <span class="comment">* History:</span>
00842 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00843 <span class="comment">\**********************************************************************/</span>
00844 
<a name="l00845"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a16">00845</a> NLSKEPROC <a class="code" href="../../d4/d2/fekbd_8c.html#a16">aNLSKEProc</a>[] = {
00846     <a class="code" href="../../d4/d2/fekbd_8c.html#a22">NlsNullProc</a>,             <span class="comment">// KBDNLS_NULL (Invalid function)</span>
00847     <a class="code" href="../../d4/d2/fekbd_8c.html#a25">NlsLapseProc</a>,            <span class="comment">// KBDNLS_NOEVENT (Drop keyevent)</span>
00848     <a class="code" href="../../d4/d2/fekbd_8c.html#a23">NlsSendBaseVk</a>,           <span class="comment">// KBDNLS_SEND_BASE_VK (Send Base VK_xxx)</span>
00849     <a class="code" href="../../d4/d2/fekbd_8c.html#a24">NlsSendParamVk</a>,          <span class="comment">// KBDNLS_SEND_PARAM_VK (Send Parameter VK_xxx)</span>
00850     <a class="code" href="../../d4/d2/fekbd_8c.html#a32">NlsKanaModeToggleProc</a>,   <span class="comment">// KBDNLS_KANAMODE (VK_KANA (Special case))</span>
00851     <a class="code" href="../../d4/d2/fekbd_8c.html#a26">NlsAlphanumericModeProc</a>, <span class="comment">// KBDNLS_ALPHANUM (VK_DBE_ALPHANUMERIC)</span>
00852     <a class="code" href="../../d4/d2/fekbd_8c.html#a28">NlsHiraganaModeProc</a>,     <span class="comment">// KBDNLS_HIRAGANA (VK_DBE_HIRAGANA)</span>
00853     <a class="code" href="../../d4/d2/fekbd_8c.html#a27">NlsKatakanaModeProc</a>,     <span class="comment">// KBDNLS_KATAKANA (VK_DBE_KATAKANA)</span>
00854     <a class="code" href="../../d4/d2/fekbd_8c.html#a29">NlsSbcsDbcsToggleProc</a>,   <span class="comment">// KBDNLS_SBCSDBCS (VK_DBE_SBCSCHAR/VK_DBE_DBCSCHAR)</span>
00855     <a class="code" href="../../d4/d2/fekbd_8c.html#a30">NlsRomanToggleProc</a>,      <span class="comment">// KBDNLS_ROMAN (VK_DBE_ROMAN/VK_DBE_NOROMAN)</span>
00856     <a class="code" href="../../d4/d2/fekbd_8c.html#a31">NlsCodeInputToggleProc</a>,  <span class="comment">// KBDNLS_CODEINPUT (VK_DBE_CODEINPUT/VK_DBE_NOCODEINPUT)</span>
00857     <a class="code" href="../../d4/d2/fekbd_8c.html#a33">NlsHelpOrEndProc</a>,        <span class="comment">// KBDNLS_HELP_OR_END (VK_HELP or VK_END)     [NEC PC-9800 Only]</span>
00858     <a class="code" href="../../d4/d2/fekbd_8c.html#a34">NlsHomeOrClearProc</a>,      <span class="comment">// KBDNLS_HOME_OR_CLEAR (VK_HOME or VK_CLEAR) [NEC PC-9800 Only]</span>
00859     <a class="code" href="../../d4/d2/fekbd_8c.html#a35">NlsNumpadModeProc</a>,       <span class="comment">// KBDNLS_NUMPAD (VK_xxx for Numpad)          [NEC PC-9800 Only]</span>
00860     <a class="code" href="../../d4/d2/fekbd_8c.html#a36">NlsKanaEventProc</a>,        <span class="comment">// KBDNLS_KANAEVENT (VK_KANA) [Fujitsu FMV oyayubi Only]</span>
00861     <a class="code" href="../../d4/d2/fekbd_8c.html#a37">NlsConvOrNonConvProc</a>,    <span class="comment">// KBDNLS_CONV_OR_NONCONV (VK_CONVERT and VK_NONCONVERT) [Fujitsu FMV oyayubi Only]</span>
00862 };
00863 
<a name="l00864"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a38">00864</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a38">GenerateNlsVkKey</a>(PVK_F pVkToF, WORD nMod, PKE pKe, ULONG_PTR dwExtraInfo)
00865 {
00866     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>  iFuncIndex;
00867     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwParam;
00868 
00869     iFuncIndex = pVkToF-&gt;NLSFEProc[nMod].NLSFEProcIndex;
00870     dwParam = pVkToF-&gt;NLSFEProc[nMod].NLSFEProcParam;
00871 
00872     <span class="keywordflow">return</span>((<a class="code" href="../../d4/d2/fekbd_8c.html#a16">aNLSKEProc</a>[iFuncIndex])(pKe, dwExtraInfo, dwParam));
00873 }
00874 
<a name="l00875"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a39">00875</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a39">GenerateNlsVkAltKey</a>(PVK_F pVkToF, WORD nMod, PKE pKe, ULONG_PTR dwExtraInfo)
00876 {
00877     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>  iFuncIndex;
00878     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwParam;
00879 
00880     iFuncIndex = pVkToF-&gt;NLSFEProcAlt[nMod].NLSFEProcIndex;
00881     dwParam = pVkToF-&gt;NLSFEProcAlt[nMod].NLSFEProcParam;
00882 
00883     <span class="keywordflow">return</span>((<a class="code" href="../../d4/d2/fekbd_8c.html#a16">aNLSKEProc</a>[iFuncIndex])(pKe,dwExtraInfo,dwParam));
00884 }
00885 
00886 <span class="comment">/***************************************************************************\</span>
00887 <span class="comment">* KbdNlsFuncTypeDummy() - KBDNLS_FUNC_TYPE_NULL</span>
00888 <span class="comment">*</span>
00889 <span class="comment">* History:</span>
00890 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00891 <span class="comment">\***************************************************************************/</span>
00892 
<a name="l00893"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a40">00893</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a40">KbdNlsFuncTypeDummy</a>(PVK_F pVkToF, PKE pKe, ULONG_PTR dwExtraInfo)
00894 {
00895     UNREFERENCED_PARAMETER(pVkToF);
00896     UNREFERENCED_PARAMETER(pKe);
00897     UNREFERENCED_PARAMETER(dwExtraInfo);
00898 
00899     <span class="comment">/*</span>
00900 <span class="comment">     * We don't need to modify Original data.</span>
00901 <span class="comment">     */</span>
00902     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00903 }
00904 
00905 <span class="comment">/***************************************************************************\</span>
00906 <span class="comment">* KbdNlsFuncTypeNormal - KBDNLS_FUNC_TYPE_NORMAL</span>
00907 <span class="comment">*</span>
00908 <span class="comment">* History:</span>
00909 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00910 <span class="comment">\***************************************************************************/</span>
00911 
<a name="l00912"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a41">00912</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a41">KbdNlsFuncTypeNormal</a>(PVK_F pVkToF, PKE pKe, ULONG_PTR dwExtraInfo)
00913 {
00914     WORD nMod;
00915 
00916     <span class="keywordflow">if</span> (pKe == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00917         <span class="comment">/*</span>
00918 <span class="comment">         * Clear state and deactivate this key processor</span>
00919 <span class="comment">         */</span>
00920         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00921     }
00922 
00923     nMod = <a class="code" href="../../d3/d1/xlate_8c.html#a2">GetModificationNumber</a>(&amp;<a class="code" href="../../d4/d2/fekbd_8c.html#a14">Modifiers_NLSKBD</a>,
00924                                  <a class="code" href="../../d3/d1/xlate_8c.html#a1">GetModifierBits</a>(&amp;<a class="code" href="../../d4/d2/fekbd_8c.html#a14">Modifiers_NLSKBD</a>,
00925                                                  <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a224">gafRawKeyState</a>));
00926 
00927     <span class="keywordflow">if</span> (nMod != SHFT_INVALID) {
00928         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d2/fekbd_8c.html#a38">GenerateNlsVkKey</a>(pVkToF, nMod, pKe, dwExtraInfo));
00929     }
00930     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00931 }
00932 
00933 <span class="comment">/***************************************************************************\</span>
00934 <span class="comment">* KbdNlsFuncTypeAlt - KBDNLS_FUNC_TYPE_ALT</span>
00935 <span class="comment">*</span>
00936 <span class="comment">* History:</span>
00937 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00938 <span class="comment">\***************************************************************************/</span>
00939 
<a name="l00940"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a42">00940</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a42">KbdNlsFuncTypeAlt</a>(PVK_F pVkToF, PKE pKe, ULONG_PTR dwExtraInfo)
00941 {
00942     WORD nMod;
00943     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00944 
00945     <span class="keywordflow">if</span> (pKe == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00946         <span class="comment">/*</span>
00947 <span class="comment">         * Clear state and deactivate this key processor</span>
00948 <span class="comment">         */</span>
00949         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00950     }
00951 
00952     nMod = <a class="code" href="../../d3/d1/xlate_8c.html#a2">GetModificationNumber</a>(&amp;<a class="code" href="../../d4/d2/fekbd_8c.html#a14">Modifiers_NLSKBD</a>,
00953                                  <a class="code" href="../../d3/d1/xlate_8c.html#a1">GetModifierBits</a>(&amp;<a class="code" href="../../d4/d2/fekbd_8c.html#a14">Modifiers_NLSKBD</a>,
00954                                                  <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a224">gafRawKeyState</a>));
00955 
00956     <span class="keywordflow">if</span> (nMod != SHFT_INVALID) {
00957         <span class="keywordflow">if</span> (!(pKe-&gt;usFlaggedVk &amp; KBDBREAK)) {
00958             <span class="keywordflow">if</span> (pVkToF-&gt;NLSFEProcCurrent == KBDNLS_INDEX_ALT) {
00959                 fRet = <a class="code" href="../../d4/d2/fekbd_8c.html#a39">GenerateNlsVkAltKey</a>(pVkToF, nMod, pKe, dwExtraInfo);
00960             } <span class="keywordflow">else</span> {
00961                 fRet = <a class="code" href="../../d4/d2/fekbd_8c.html#a38">GenerateNlsVkKey</a>(pVkToF, nMod, pKe, dwExtraInfo);
00962             }
00963             <span class="keywordflow">if</span> (pVkToF-&gt;NLSFEProcSwitch &amp; (1 &lt;&lt; nMod)) {
00964                 TAGMSG0(DBGTAG_IMM, <span class="stringliteral">"USERKM:FEKBD Switching Alt table\n"</span>);
00965                 <span class="comment">/*</span>
00966 <span class="comment">                 * Switch to "alt".</span>
00967 <span class="comment">                 */</span>
00968                 pVkToF-&gt;NLSFEProcCurrent = KBDNLS_INDEX_ALT;
00969             }
00970         } <span class="keywordflow">else</span> {
00971             <span class="keywordflow">if</span> (pVkToF-&gt;NLSFEProcCurrent == KBDNLS_INDEX_ALT) {
00972                 fRet = <a class="code" href="../../d4/d2/fekbd_8c.html#a39">GenerateNlsVkAltKey</a>(pVkToF, nMod, pKe, dwExtraInfo);
00973                 <span class="comment">/*</span>
00974 <span class="comment">                 * Back to "normal"</span>
00975 <span class="comment">                 */</span>
00976                 pVkToF-&gt;NLSFEProcCurrent = KBDNLS_INDEX_NORMAL;
00977             } <span class="keywordflow">else</span> {
00978                 fRet = <a class="code" href="../../d4/d2/fekbd_8c.html#a38">GenerateNlsVkKey</a>(pVkToF, nMod, pKe, dwExtraInfo);
00979             }
00980         }
00981     }
00982     <span class="keywordflow">return</span> fRet;
00983 }
00984 
00985 <span class="comment">/***************************************************************************\</span>
00986 <span class="comment">* KENLSProcs()</span>
00987 <span class="comment">*</span>
00988 <span class="comment">* History:</span>
00989 <span class="comment">* 16-07-96 hideyukn       Created.</span>
00990 <span class="comment">\***************************************************************************/</span>
00991 
<a name="l00992"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a17">00992</a> NLSVKFPROC <a class="code" href="../../d4/d2/fekbd_8c.html#a17">aNLSVKFProc</a>[] = {
00993     <a class="code" href="../../d4/d2/fekbd_8c.html#a40">KbdNlsFuncTypeDummy</a>,  <span class="comment">// KBDNLS_INDEX_NULL     0</span>
00994     <a class="code" href="../../d4/d2/fekbd_8c.html#a41">KbdNlsFuncTypeNormal</a>, <span class="comment">// KBDNLS_INDEX_NORMAL   1</span>
00995     <a class="code" href="../../d4/d2/fekbd_8c.html#a42">KbdNlsFuncTypeAlt</a>     <span class="comment">// KBDNLS_INDEX_ALT      2</span>
00996 };
00997 
00998 <span class="comment">/*</span>
00999 <span class="comment"> * Returning FALSE means the Key Event has been deleted by a special-case</span>
01000 <span class="comment"> * KeyEvent processor.</span>
01001 <span class="comment"> * Returning TRUE means the Key Event should be passed on (although it may</span>
01002 <span class="comment"> * have been altered.</span>
01003 <span class="comment"> */</span>
<a name="l01004"></a><a class="code" href="../../d4/d1/userk_8h.html#a1038">01004</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1038">xxxKENLSProcs</a>(PKE pKe, ULONG_PTR dwExtraInfo)
01005 {
01006 
01007     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
01008 
01009     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a72">gpKbdNlsTbl</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01010         PVK_F pVkToF = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a72">gpKbdNlsTbl</a>-&gt;pVkToF;
01011         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  iNumVk = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a72">gpKbdNlsTbl</a>-&gt;NumOfVkToF;
01012 
01013         <span class="keywordflow">while</span>(iNumVk) {
01014             <span class="keywordflow">if</span> (pVkToF[iNumVk-1].Vk == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(pKe-&gt;usFlaggedVk)) {
01015                 <span class="keywordflow">return</span>((<a class="code" href="../../d4/d2/fekbd_8c.html#a17">aNLSVKFProc</a>[pVkToF[iNumVk-1].NLSFEProcType])
01016                                     (&amp;(pVkToF[iNumVk-1]),pKe,dwExtraInfo));
01017             }
01018             iNumVk--;
01019         }
01020     }
01021     <span class="comment">/*</span>
01022 <span class="comment">     * Other special Key Event processors</span>
01023 <span class="comment">     */</span>
01024     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01025 }
01026 
01027 <span class="comment">/***************************************************************************\</span>
01028 <span class="comment">* NlsKbdSendIMENotification()</span>
01029 <span class="comment">*</span>
01030 <span class="comment">* History:</span>
01031 <span class="comment">* 10-09-96 hideyukn       Created.</span>
01032 <span class="comment">\***************************************************************************/</span>
01033 
<a name="l01034"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a44">01034</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a44">NlsKbdSendIMENotification</a>(DWORD dwImeOpen, DWORD dwImeConversion)
01035 {
01036     PKBDNLSTABLES       pKbdNlsTable = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a72">gpKbdNlsTbl</a>;
01037 
01038     <span class="keywordflow">if</span> (pKbdNlsTable == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01039         <span class="comment">/*</span>
01040 <span class="comment">         * 'Active' layout driver does not have NLSKBD table.</span>
01041 <span class="comment">         */</span>
01042         <span class="keywordflow">return</span>;
01043     }
01044 
01045     <span class="comment">/*</span>
01046 <span class="comment">     * Let us send notification to kernel mode keyboard driver, if nessesary.</span>
01047 <span class="comment">     */</span>
01048     <span class="keywordflow">if</span> ((pKbdNlsTable-&gt;LayoutInformation) &amp; NLSKBD_INFO_SEND_IME_NOTIFICATION) {
01049         <a class="code" href="../../d5/d3/structtagDEVICEINFO.html">PDEVICEINFO</a> pDeviceInfo;
01050 
01051         <span class="comment">/*</span>
01052 <span class="comment">         * Fill up the KEYBOARD_IME_STATUS structure.</span>
01053 <span class="comment">         */</span>
01054         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a221">gKbdImeStatus</a>.UnitId      = 0;
01055         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a221">gKbdImeStatus</a>.ImeOpen     = dwImeOpen;
01056         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a221">gKbdImeStatus</a>.ImeConvMode = dwImeConversion;
01057 
01058         <a class="code" href="../../d4/d1/userk_8h.html#a2065">EnterDeviceInfoListCrit</a>();
01059         <a class="code" href="../../d4/d1/userk_8h.html#a160">BEGINATOMICDEVICEINFOLISTCHECK</a>();
01060         <span class="keywordflow">for</span> (pDeviceInfo = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a205">gpDeviceInfoList</a>; pDeviceInfo; pDeviceInfo = pDeviceInfo-&gt;pNext) {
01061             <span class="keywordflow">if</span> ((pDeviceInfo-&gt;type == <a class="code" href="../../d4/d1/userk_8h.html#a176">DEVICE_TYPE_KEYBOARD</a>) &amp;&amp; (pDeviceInfo-&gt;handle)) {
01062                 <a class="code" href="../../d4/d1/userk_8h.html#a992">RequestDeviceChange</a>(pDeviceInfo, <a class="code" href="../../d4/d1/userk_8h.html#a182">GDIAF_IME_STATUS</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01063             }
01064         }
01065         <a class="code" href="../../d4/d1/userk_8h.html#a164">ENDATOMICDEVICEINFOLISTCHECK</a>();
01066         <a class="code" href="../../d4/d1/userk_8h.html#a2066">LeaveDeviceInfoListCrit</a>();
01067     }
01068     <span class="keywordflow">return</span>;
01069 }
01070 
<a name="l01071"></a><a class="code" href="../../d4/d1/userk_8h.html#a2106">01071</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d1/userk_8h.html#a2106">NlsKbdSendIMEProc</a>(DWORD dwImeOpen, DWORD dwImeConversion)
01072 {
01073     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp;
01074         (!(<a class="code" href="../../d6/d3/queue_8c.html#a36">GetAppImeCompatFlags</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>) &amp; IMECOMPAT_HYDRACLIENT))) {
01075         <a class="code" href="../../d4/d2/fekbd_8c.html#a44">NlsKbdSendIMENotification</a>(dwImeOpen, dwImeConversion);
01076     }
01077 }
01078 
01079 <span class="comment">/*</span>
01080 <span class="comment"> * Compatibility for Windows NT 3.xx and Windows 3.x for NEC PC-9800 Series</span>
01081 <span class="comment"> */</span>
<a name="l01082"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a8">01082</a> <span class="preprocessor">#define NLSKBD_CONFIG_PATH \</span>
01083 <span class="preprocessor">        L"WOW\\keyboard"</span>
01084 <span class="preprocessor"></span>
01085 <span class="comment">/***************************************************************************\</span>
01086 <span class="comment">* NlsKbdInitializePerSystem()</span>
01087 <span class="comment">*</span>
01088 <span class="comment">* History:</span>
01089 <span class="comment">* 26-09-96 hideyukn       Created.</span>
01090 <span class="comment">\***************************************************************************/</span>
01091 
<a name="l01092"></a><a class="code" href="../../d4/d2/fekbd_8c.html#a46">01092</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d2/fekbd_8c.html#a46">NlsKbdInitializePerSystem</a>(VOID)
01093 {
01094     RTL_QUERY_REGISTRY_TABLE QueryTable[4];
01095 
01096     UNICODE_STRING <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a3">EndString</a>, HelpString;
01097     UNICODE_STRING YesString, <a class="code" href="../../d3/d6/kernel_2sendmsg_8c.html#a4">NoString</a>;
01098     UNICODE_STRING HomeString, ClearString;
01099 
01100     UNICODE_STRING HelpKeyString;
01101     UNICODE_STRING KanaHelpString;
01102     UNICODE_STRING ClearKeyString;
01103 
01104     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
01105 
01106     <span class="comment">//</span>
01107     <span class="comment">// Set default VK_DBE_xxx status.</span>
01108     <span class="comment">//</span>
01109     <span class="comment">//</span>
01110     <span class="comment">// AlphaNumeric input mode.</span>
01111     <span class="comment">//</span>
01112     <a class="code" href="../../d4/d2/fekbd_8c.html#a19">NlsSetKeyStateToggle</a>(VK_DBE_ALPHANUMERIC);
01113     <span class="comment">//</span>
01114     <span class="comment">// Single byte character input mode.</span>
01115     <span class="comment">//</span>
01116     <a class="code" href="../../d4/d2/fekbd_8c.html#a19">NlsSetKeyStateToggle</a>(VK_DBE_SBCSCHAR);
01117     <span class="comment">//</span>
01118     <span class="comment">// No roman input mode.</span>
01119     <span class="comment">//</span>
01120     <a class="code" href="../../d4/d2/fekbd_8c.html#a19">NlsSetKeyStateToggle</a>(VK_DBE_NOROMAN);
01121     <span class="comment">//</span>
01122     <span class="comment">// No code input mode.</span>
01123     <span class="comment">//</span>
01124     <a class="code" href="../../d4/d2/fekbd_8c.html#a19">NlsSetKeyStateToggle</a>(VK_DBE_NOCODEINPUT);
01125 
01126     <span class="comment">//</span>
01127     <span class="comment">// From Here, below code is for compatibility for Windows NT 3.xx</span>
01128     <span class="comment">// for NEC PC-9800 verion.</span>
01129     <span class="comment">//</span>
01130 
01131     <span class="comment">//</span>
01132     <span class="comment">// Initialize default strings.</span>
01133     <span class="comment">//</span>
01134     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a3">EndString</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"end"</span>);
01135     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;HelpString,<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"help"</span>);
01136 
01137     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;YesString,<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"yes"</span>);
01138     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;<a class="code" href="../../d3/d6/kernel_2sendmsg_8c.html#a4">NoString</a>, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"no"</span>);
01139 
01140     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;HomeString, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"home"</span>);
01141     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;ClearString,<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"clear"</span>);
01142 
01143     <span class="comment">//</span>
01144     <span class="comment">// Initialize recieve buffer.</span>
01145     <span class="comment">//</span>
01146     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;HelpKeyString,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01147     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;KanaHelpString,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01148     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;ClearKeyString,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01149 
01150     <span class="comment">//</span>
01151     <span class="comment">// Initalize query tables.</span>
01152     <span class="comment">//</span>
01153     <span class="comment">// ValueName : "helpkey"</span>
01154     <span class="comment">// ValueData : if "end" VK_END, otherwise VK_HELP</span>
01155     <span class="comment">//</span>
01156     QueryTable[0].QueryRoutine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01157     QueryTable[0].Flags = RTL_QUERY_REGISTRY_DIRECT;
01158     QueryTable[0].Name = (PWSTR) <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"helpkey"</span>,
01159     QueryTable[0].EntryContext = (PVOID) &amp;HelpKeyString;
01160     QueryTable[0].DefaultType = REG_SZ;
01161     QueryTable[0].DefaultData = &amp;<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a3">EndString</a>;
01162     QueryTable[0].DefaultLength = 0;
01163 
01164     <span class="comment">//</span>
01165     <span class="comment">// ValueName : "KanaHelpKey"</span>
01166     <span class="comment">// ValueData : if "yes" if kana on switch VK_HELP and VK_END</span>
01167     <span class="comment">//</span>
01168     QueryTable[1].QueryRoutine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01169     QueryTable[1].Flags = RTL_QUERY_REGISTRY_DIRECT;
01170     QueryTable[1].Name = (PWSTR) <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"KanaHelpKey"</span>,
01171     QueryTable[1].EntryContext = (PVOID) &amp;KanaHelpString;
01172     QueryTable[1].DefaultType = REG_SZ;
01173     QueryTable[1].DefaultData = &amp;YesString;
01174     QueryTable[1].DefaultLength = 0;
01175 
01176     <span class="comment">//</span>
01177     <span class="comment">// ValueName : "clrkey"</span>
01178     <span class="comment">// ValueData : if "home" VK_HOME, otherwise VK_CLEAR</span>
01179     <span class="comment">//</span>
01180     QueryTable[2].QueryRoutine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01181     QueryTable[2].Flags = RTL_QUERY_REGISTRY_DIRECT;
01182     QueryTable[2].Name = (PWSTR) <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"clrkey"</span>,
01183     QueryTable[2].EntryContext = (PVOID) &amp;ClearKeyString;
01184     QueryTable[2].DefaultType = REG_SZ;
01185     QueryTable[2].DefaultData = &amp;HomeString;
01186     QueryTable[2].DefaultLength = 0;
01187 
01188     QueryTable[3].QueryRoutine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01189     QueryTable[3].Flags = 0;
01190     QueryTable[3].Name = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01191 
01192     status = <a class="code" href="../../d4/d7/rtl_2regutil_8c.html#a19">RtlQueryRegistryValues</a>(
01193                  RTL_REGISTRY_WINDOWS_NT,
01194                  <a class="code" href="../../d4/d2/fekbd_8c.html#a8">NLSKBD_CONFIG_PATH</a>,
01195                  QueryTable, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01196 
01197     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01198         RIPMSG1(RIP_WARNING, <span class="stringliteral">"FEKBD:RtlQueryRegistryValues fails (%x)\n"</span>, status);
01199         <span class="keywordflow">return</span>;
01200     }
01201 
01202     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a42">RtlEqualUnicodeString</a>(&amp;HelpKeyString,&amp;HelpString,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) {
01203         <span class="comment">/*</span>
01204 <span class="comment">         * Generate VK_HELP, when NLSKBD_HELP_OR_END is called.</span>
01205 <span class="comment">         */</span>
01206         <a class="code" href="../../d4/d2/fekbd_8c.html#a15">fNlsKbdConfiguration</a> &amp;= ~<a class="code" href="../../d4/d2/fekbd_8c.html#a3">GEN_VK_END</a>;
01207     }
01208 
01209     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a42">RtlEqualUnicodeString</a>(&amp;KanaHelpString,&amp;<a class="code" href="../../d3/d6/kernel_2sendmsg_8c.html#a4">NoString</a>,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) {
01210         <span class="comment">/*</span>
01211 <span class="comment">         * In case of "yes":</span>
01212 <span class="comment">         * If 'kana' is on, when NLSKBD_HELP_OR_END is called, switch VK_END and VK_HELP.</span>
01213 <span class="comment">         * Else, in case of "no":</span>
01214 <span class="comment">         * Doesn't generate by 'kana' toggle state.</span>
01215 <span class="comment">         */</span>
01216         <a class="code" href="../../d4/d2/fekbd_8c.html#a15">fNlsKbdConfiguration</a> &amp;= ~<a class="code" href="../../d4/d2/fekbd_8c.html#a2">GEN_KANA_AWARE</a>;
01217     }
01218 
01219     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a42">RtlEqualUnicodeString</a>(&amp;ClearKeyString,&amp;ClearString,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>)) {
01220         <span class="comment">/*</span>
01221 <span class="comment">         * Generate VK_CLEAR, when KBDNLS_HOME_OR_CLEAR is called.</span>
01222 <span class="comment">         */</span>
01223         <a class="code" href="../../d4/d2/fekbd_8c.html#a15">fNlsKbdConfiguration</a> &amp;= ~<a class="code" href="../../d4/d2/fekbd_8c.html#a4">GEN_VK_HOME</a>;
01224     }
01225 
01226     <span class="keywordflow">return</span>;
01227 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:00 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
