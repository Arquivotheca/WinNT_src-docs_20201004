<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: rtmisc1.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>rtmisc1.c</h1><a href="../../d4/d2/rtmisc1_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    rtmisc1.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    NT level registry api test program #1, basic non-error paths.</span>
00012 <span class="comment"></span>
00013 <span class="comment">    Test open, create, setvalue, queryvalue, enumeratekey, enumeratevalue,</span>
00014 <span class="comment">    querykey.</span>
00015 <span class="comment"></span>
00016 <span class="comment">Author:</span>
00017 <span class="comment"></span>
00018 <span class="comment">    Bryan Willman (bryanwi)  19-Nov-91</span>
00019 <span class="comment"></span>
00020 <span class="comment">Revision History:</span>
00021 <span class="comment"></span>
00022 <span class="comment">--*/</span>
00023 
00024 <span class="preprocessor">#include "<a class="code" href="../../d1/d2/cmp_8h.html">cmp.h</a>"</span>
00025 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00026 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00027 <span class="preprocessor">#include &lt;string.h&gt;</span>
00028 
00029 <span class="comment">//</span>
00030 <span class="comment">//  NOTE:   This version of the test operations on \REGISTRY\MACHINE\TEST\*,</span>
00031 <span class="comment">//          which is the TEST hive.  This hive will not exist in production</span>
00032 <span class="comment">//          systems, so the test will have to change.</span>
00033 <span class="comment">//</span>
00034 
00035 
00036 <span class="keywordtype">void</span> __cdecl <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>(<span class="keywordtype">int</span>, <span class="keywordtype">char</span> *);
00037 
00038 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00039 <a class="code" href="../../d4/d2/rtmisc1_8c.html#a7">NameClassAndTitle</a>(
00040     KEY_NODE_INFORMATION    *NodeInformation,
00041     UNICODE_STRING          ClassName,
00042     ULONG                   TitleIndex,
00043     UNICODE_STRING          KeyName,
00044     LARGE_INTEGER           CompTime,
00045     BOOLEAN                 Strong,         <span class="comment">// time must be &gt;= CompTime</span>
00046     PUCHAR                  TestName
00047     );
00048 
00049 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00050 <a class="code" href="../../d4/d2/rtmisc1_8c.html#a8">expectstring</a>(
00051     PWSTR   expected,
00052     ULONG   expectedlength,
00053     PWSTR   actual,
00054     ULONG   actuallength
00055     );
00056 
00057 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00058 <a class="code" href="../../d4/d2/rtmisc1_8c.html#a9">expecttime</a>(
00059     LARGE_INTEGER   ExpectTime,
00060     LARGE_INTEGER   ActualTime
00061     );
00062 
00063 
<a name="l00064"></a><a class="code" href="../../d4/d2/rtmisc1_8c.html#a0">00064</a> <span class="preprocessor">#define TITLE_INDEX_1   122259</span>
<a name="l00065"></a><a class="code" href="../../d4/d2/rtmisc1_8c.html#a1">00065</a> <span class="preprocessor"></span><span class="preprocessor">#define TITLE_INDEX_2   120858</span>
<a name="l00066"></a><a class="code" href="../../d4/d2/rtmisc1_8c.html#a2">00066</a> <span class="preprocessor"></span><span class="preprocessor">#define TITLE_INDEX_3   120159</span>
<a name="l00067"></a><a class="code" href="../../d4/d2/rtmisc1_8c.html#a3">00067</a> <span class="preprocessor"></span><span class="preprocessor">#define TYPE_1          666</span>
<a name="l00068"></a><a class="code" href="../../d4/d2/rtmisc1_8c.html#a4">00068</a> <span class="preprocessor"></span><span class="preprocessor">#define TYPE_2          1066</span>
00069 <span class="preprocessor"></span>
00070 
<a name="l00071"></a><a class="code" href="../../d4/d2/rtmisc1_8c.html#a5">00071</a> ULONG           <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a> = 0;
00072 
00073 
00074 <span class="keywordtype">void</span>
<a name="l00075"></a><a class="code" href="../../d8/d0/rtbatcr_8c.html#a12">00075</a> __cdecl <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>(<span class="keywordtype">int</span>, <span class="keywordtype">char</span> *)
00076 {
00077     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00078     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00079     UNICODE_STRING  <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00080     UNICODE_STRING  KeyName2;
00081     UNICODE_STRING  ClassName;
00082     UNICODE_STRING  ClassName2;
00083     UNICODE_STRING  <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00084     UNICODE_STRING  ValueName2;
00085     HANDLE          BaseHandle;
00086     HANDLE          Testhand1;
00087     ULONG           Disposition;
00088     LARGE_INTEGER   CompTime;
00089     ULONG           buffer[100];
00090     ULONG           bufsize = <span class="keyword">sizeof</span>(ULONG) * 100;
00091     PKEY_NODE_INFORMATION NodeInformation;
00092     PKEY_VALUE_FULL_INFORMATION KeyValueInformation;
00093     PKEY_VALUE_BASIC_INFORMATION KeyValueBasic;
00094     ULONG           ResultLength;
00095     PUCHAR          datastring = <span class="stringliteral">"Some simple ascii data for use as a value"</span>;
00096     PUCHAR          datastring2 = <span class="stringliteral">"Some more not so simple data $#"</span>;
00097     ULONG           expected;
00098     PVOID           tp;
00099 
00100 
00101     printf(<span class="stringliteral">"rtmisc1: starting\n"</span>);
00102 
00103     NodeInformation = (PKEY_NODE_INFORMATION)&amp;(buffer[0]);
00104     KeyValueInformation = (PKEY_VALUE_FULL_INFORMATION)&amp;(buffer[0]);
00105     KeyValueBasic = (PKEY_VALUE_BASIC_INFORMATION)&amp;(buffer[0]);
00106 
00107     <span class="comment">//</span>
00108     <span class="comment">// t0: Perform all operations against a base node, open it here.</span>
00109     <span class="comment">//</span>
00110 
00111     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00112         &amp;<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>,
00113         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\REGISTRY\\MACHINE\\TEST"</span>
00114         );
00115 
00116     InitializeObjectAttributes(
00117         &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00118         &amp;<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>,
00119         0,
00120         (HANDLE)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00121         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00122         );
00123     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Attributes |= OBJ_CASE_INSENSITIVE;
00124 
00125     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(
00126                 &amp;BaseHandle,
00127                 MAXIMUM_ALLOWED,
00128                 &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00129                 );
00130     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00131         printf(<span class="stringliteral">"rtmisc1: t0: %08lx\n"</span>, status);
00132         <span class="keywordflow">goto</span> punt;
00133     }
00134 
00135 
00136     <span class="comment">//</span>
00137     <span class="comment">// t1: Create a key with class and title index</span>
00138     <span class="comment">//</span>
00139 
00140     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00141         &amp;ClassName,
00142         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"t1 Class Name"</span>
00143         );
00144 
00145     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00146         &amp;<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>,
00147         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"first_test_node"</span>
00148         );
00149 
00150     InitializeObjectAttributes(
00151         &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00152         &amp;<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>,
00153         0,
00154         BaseHandle,
00155         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00156         );
00157     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Attributes |= OBJ_CASE_INSENSITIVE;
00158 
00159     NtQuerySystemTime(&amp;CompTime);
00160 
00161 <span class="comment">//  printf("ClassName@%08lx  KeyName@%08lx\n",</span>
00162 <span class="comment">//          ClassName.Buffer, KeyName.Buffer);</span>
00163 
00164     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(
00165                 &amp;Testhand1,
00166                 MAXIMUM_ALLOWED,
00167                 &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00168                 <a class="code" href="../../d4/d2/rtmisc1_8c.html#a0">TITLE_INDEX_1</a>,
00169                 &amp;ClassName,
00170                 0,
00171                 &amp;Disposition
00172                 );
00173     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00174         printf(<span class="stringliteral">"rtmisc1: t1: %08lx\n"</span>, status);
00175         <span class="keywordflow">goto</span> punt;
00176     }
00177 
00178     <span class="keywordflow">if</span> (Disposition != REG_CREATED_NEW_KEY) {
00179         printf(<span class="stringliteral">"rtmisc1: t1a: got old key, expected to create new one\n"</span>);
00180         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00181     }
00182 
00183     <span class="comment">//</span>
00184     <span class="comment">// t2: See if we can get data back, and if it makes sense</span>
00185     <span class="comment">//</span>
00186 
00187     RtlZeroMemory(NodeInformation, bufsize);
00188     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a24">NtQueryKey</a>(
00189                 Testhand1,
00190                 KeyNodeInformation,
00191                 NodeInformation,
00192                 bufsize,
00193                 &amp;ResultLength
00194                 );
00195     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00196         printf(<span class="stringliteral">"rtmisc1: t2a: %08lx\n"</span>, status);
00197         <span class="keywordflow">goto</span> punt;
00198     }
00199     <span class="keywordflow">if</span> (ResultLength != 80) {
00200         printf(<span class="stringliteral">"rtmisc1: t2i: expect 80, ResultLength = %d\n"</span>, ResultLength);
00201         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00202     }
00203 
00204 
00205     <a class="code" href="../../d4/d2/rtmisc1_8c.html#a7">NameClassAndTitle</a>(
00206         NodeInformation,
00207         ClassName,
00208         <a class="code" href="../../d4/d2/rtmisc1_8c.html#a0">TITLE_INDEX_1</a>,
00209         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>,
00210         CompTime,
00211         <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,          <span class="comment">// time must be &gt;= CompTime</span>
00212         <span class="stringliteral">"rtmisc1: t2b: "</span>
00213         );
00214     CompTime = NodeInformation-&gt;LastWriteTime;
00215 
00216     status = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Testhand1);
00217     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00218         printf(<span class="stringliteral">"rtmisc1: t2c: %08lx\n"</span>);
00219         <span class="keywordflow">goto</span> punt;
00220     }
00221 
00222 
00223     <span class="comment">//</span>
00224     <span class="comment">// t3: Reopen the key with create, see if data still there.</span>
00225     <span class="comment">//</span>
00226 
00227     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(
00228                 &amp;Testhand1,
00229                 MAXIMUM_ALLOWED,
00230                 &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00231                 <a class="code" href="../../d4/d2/rtmisc1_8c.html#a0">TITLE_INDEX_1</a>,
00232                 &amp;ClassName,
00233                 0,
00234                 &amp;Disposition
00235                 );
00236     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00237         printf(<span class="stringliteral">"rtmisc1: t3: %08lx\n"</span>, status);
00238         <span class="keywordflow">goto</span> punt;
00239     }
00240 
00241     <span class="keywordflow">if</span> (Disposition != REG_OPENED_EXISTING_KEY) {
00242         printf(<span class="stringliteral">"rtmisc1: t3a failure\n"</span>);
00243         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00244     }
00245 
00246     RtlZeroMemory(NodeInformation, bufsize);
00247     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a24">NtQueryKey</a>(
00248                 Testhand1,
00249                 KeyNodeInformation,
00250                 NodeInformation,
00251                 bufsize,
00252                 &amp;ResultLength
00253                 );
00254     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00255         printf(<span class="stringliteral">"rtmisc1: t3b: %08lx\n"</span>, status);
00256         <span class="keywordflow">goto</span> punt;
00257     }
00258 
00259     <a class="code" href="../../d4/d2/rtmisc1_8c.html#a7">NameClassAndTitle</a>(
00260         NodeInformation,
00261         ClassName,
00262         <a class="code" href="../../d4/d2/rtmisc1_8c.html#a0">TITLE_INDEX_1</a>,
00263         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>,
00264         CompTime,
00265         <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,          <span class="comment">// time must be &gt;= CompTime</span>
00266         <span class="stringliteral">"rtmisc1: t3c: "</span>
00267         );
00268 
00269     status = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Testhand1);
00270     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00271         printf(<span class="stringliteral">"rtmisc1: t3d: %08lx\n"</span>);
00272         <span class="keywordflow">goto</span> punt;
00273     }
00274 
00275 
00276     <span class="comment">//</span>
00277     <span class="comment">// t4: Reopen the key with open, see if data still there.</span>
00278     <span class="comment">//</span>
00279 
00280     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(
00281                 &amp;Testhand1,
00282                 MAXIMUM_ALLOWED,
00283                 &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>
00284                 );
00285     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00286         printf(<span class="stringliteral">"rtmisc1: t4: %08lx\n"</span>, status);
00287         <span class="keywordflow">goto</span> punt;
00288     }
00289 
00290     RtlZeroMemory(NodeInformation, bufsize);
00291     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a24">NtQueryKey</a>(
00292                 Testhand1,
00293                 KeyNodeInformation,
00294                 NodeInformation,
00295                 bufsize,
00296                 &amp;ResultLength
00297                 );
00298     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00299         printf(<span class="stringliteral">"rtmisc1: t4a: %08lx\n"</span>, status);
00300         <span class="keywordflow">goto</span> punt;
00301     }
00302 
00303     <a class="code" href="../../d4/d2/rtmisc1_8c.html#a7">NameClassAndTitle</a>(
00304         NodeInformation,
00305         ClassName,
00306         <a class="code" href="../../d4/d2/rtmisc1_8c.html#a0">TITLE_INDEX_1</a>,
00307         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>,
00308         CompTime,
00309         <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,          <span class="comment">// time must be &gt;= CompTime</span>
00310         <span class="stringliteral">"rtmisc1: t4b: "</span>
00311         );
00312 
00313 <span class="comment">//  status = NtClose(Testhand1);</span>
00314 <span class="comment">//  if (!NT_SUCCESS(status)) {</span>
00315 <span class="comment">//      printf("rtmisc1: t4c: %08lx\n");</span>
00316 <span class="comment">//      exit(1);</span>
00317 <span class="comment">//  }</span>
00318 
00319 
00320     <span class="comment">//</span>
00321     <span class="comment">// t5: Create a value</span>
00322     <span class="comment">//</span>
00323 
00324     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00325         &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00326         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"the very first value stored in the registry"</span>
00327         );
00328 
00329 
00330     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(
00331                 Testhand1,
00332                 &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00333                 <a class="code" href="../../d4/d2/rtmisc1_8c.html#a1">TITLE_INDEX_2</a>,
00334                 <a class="code" href="../../d4/d2/rtmisc1_8c.html#a3">TYPE_1</a>,
00335                 datastring,
00336                 <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(datastring)+1
00337                 );
00338     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00339         printf(<span class="stringliteral">"rtmisc1: t5: %08lx\n"</span>, status);
00340         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00341     }
00342 
00343 
00344     <span class="comment">//</span>
00345     <span class="comment">// t6: Read the value back</span>
00346     <span class="comment">//</span>
00347 
00348     RtlZeroMemory(KeyValueInformation, bufsize);
00349     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00350                 Testhand1,
00351                 &amp;<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00352                 KeyValueFullInformation,
00353                 KeyValueInformation,
00354                 bufsize,
00355                 &amp;ResultLength
00356                 );
00357     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00358         printf(<span class="stringliteral">"rtmisc1: t6: %08lx\n"</span>, status);
00359         <span class="keywordflow">goto</span> punt;
00360     }
00361     expected = FIELD_OFFSET(KEY_VALUE_FULL_INFORMATION, <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>) +
00362                     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length + <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(datastring) + 1;
00363     <span class="keywordflow">if</span> (ResultLength != expected) {
00364         printf(<span class="stringliteral">"rtmisc1: t6a: expected = %08lx actual = %08lx"</span>,
00365                 expected, ResultLength);
00366         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00367     }
00368 
00369     <span class="keywordflow">if</span> ( (KeyValueInformation-&gt;TitleIndex != <a class="code" href="../../d4/d2/rtmisc1_8c.html#a1">TITLE_INDEX_2</a>)         ||
00370          (KeyValueInformation-&gt;Type != <a class="code" href="../../d4/d2/rtmisc1_8c.html#a3">TYPE_1</a>)                      ||
00371          (KeyValueInformation-&gt;NameLength != <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length)      ||
00372          (KeyValueInformation-&gt;DataLength != <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(datastring)+1))
00373     {
00374         printf(<span class="stringliteral">"rtmisc1: t6b: wrong description data\n"</span>);
00375         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00376     }
00377 
00378 
00379     tp = (PWSTR)&amp;(KeyValueInformation-&gt;Name[0]);
00380     <span class="keywordflow">if</span> (wcsncmp(<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Buffer, tp, (<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length/<span class="keyword">sizeof</span>(WCHAR))) != 0) {
00381         printf(<span class="stringliteral">"rtmisc1: t6c: wrong name\n"</span>);
00382         <a class="code" href="../../d4/d2/rtmisc1_8c.html#a8">expectstring</a>(
00383             <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Buffer,
00384             (<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length/<span class="keyword">sizeof</span>(WCHAR)),
00385             (PWSTR)&amp;(KeyValueInformation-&gt;Name[0]),
00386             (KeyValueInformation-&gt;NameLength/<span class="keyword">sizeof</span>(WCHAR))
00387             );
00388         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00389     }
00390 
00391 
00392     tp = (PUCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset;
00393     <span class="keywordflow">if</span> (strcmp(tp, datastring) != 0) {
00394         printf(<span class="stringliteral">"rtmisc1: t6d: wrong data\n"</span>);
00395         printf(<span class="stringliteral">"expected '%s', got '%s'\n"</span>, datastring, tp);
00396         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00397     }
00398 
00399     <span class="comment">//</span>
00400     <span class="comment">// t7: Create a second value</span>
00401     <span class="comment">//</span>
00402 
00403     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00404         &amp;ValueName2,
00405         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"the second value stored in the registry"</span>
00406         );
00407 
00408 
00409     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(
00410                 Testhand1,
00411                 &amp;ValueName2,
00412                 <a class="code" href="../../d4/d2/rtmisc1_8c.html#a2">TITLE_INDEX_3</a>,
00413                 <a class="code" href="../../d4/d2/rtmisc1_8c.html#a4">TYPE_2</a>,
00414                 datastring2,
00415                 <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(datastring2)+1
00416                 );
00417     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00418         printf(<span class="stringliteral">"rtmisc1: t7: %08lx\n"</span>, status);
00419         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00420     }
00421 
00422     <span class="comment">//</span>
00423     <span class="comment">// t8: Read the second value back (short form)</span>
00424     <span class="comment">//</span>
00425 
00426     RtlZeroMemory(KeyValueBasic, bufsize);
00427     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00428                 Testhand1,
00429                 &amp;ValueName2,
00430                 KeyValueBasicInformation,
00431                 KeyValueBasic,
00432                 bufsize,
00433                 &amp;ResultLength
00434                 );
00435     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00436         printf(<span class="stringliteral">"rtmisc1: t8: %08lx\n"</span>, status);
00437         <span class="keywordflow">goto</span> punt;
00438     }
00439 
00440     expected = FIELD_OFFSET(KEY_VALUE_BASIC_INFORMATION, <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>) +
00441                     ValueName2.Length;
00442     <span class="keywordflow">if</span> (ResultLength != expected) {
00443         printf(<span class="stringliteral">"rtmisc1: t8a: expected = %08lx actual = %08lx"</span>,
00444                 expected, ResultLength);
00445         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00446     }
00447 
00448     <span class="keywordflow">if</span> ( (KeyValueBasic-&gt;TitleIndex != <a class="code" href="../../d4/d2/rtmisc1_8c.html#a2">TITLE_INDEX_3</a>)         ||
00449          (KeyValueBasic-&gt;Type != <a class="code" href="../../d4/d2/rtmisc1_8c.html#a4">TYPE_2</a>)                      ||
00450          (KeyValueBasic-&gt;NameLength != ValueName2.Length))
00451     {
00452         printf(<span class="stringliteral">"rtmisc1: t8b: wrong description data\n"</span>);
00453         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00454     }
00455 
00456 
00457     tp = (PWSTR)&amp;(KeyValueBasic-&gt;Name[0]);
00458     <span class="keywordflow">if</span> (wcsncmp(ValueName2.Buffer, tp, (ValueName2.Length/<span class="keyword">sizeof</span>(WCHAR))) != 0) {
00459         printf(<span class="stringliteral">"rtmisc1: t8c: wrong name\n"</span>);
00460         <a class="code" href="../../d4/d2/rtmisc1_8c.html#a8">expectstring</a>(
00461             ValueName2.Buffer,
00462             (ValueName2.Length/<span class="keyword">sizeof</span>(WCHAR)),
00463             (PWSTR)&amp;(KeyValueBasic-&gt;Name[0]),
00464             (KeyValueBasic-&gt;NameLength/<span class="keyword">sizeof</span>(WCHAR))
00465             );
00466         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00467     }
00468 
00469 
00470     <span class="comment">//</span>
00471     <span class="comment">// t9: Enumerate the values (short form)</span>
00472     <span class="comment">//</span>
00473 
00474     RtlZeroMemory(KeyValueBasic, bufsize);
00475     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a18">NtEnumerateValueKey</a>(
00476                 Testhand1,
00477                 0,              <span class="comment">// Index</span>
00478                 KeyValueBasicInformation,
00479                 KeyValueBasic,
00480                 bufsize,
00481                 &amp;ResultLength
00482                 );
00483     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00484         printf(<span class="stringliteral">"rtmisc1: t9: %08lx\n"</span>, status);
00485         <span class="keywordflow">goto</span> punt;
00486     }
00487 
00488     expected = FIELD_OFFSET(KEY_VALUE_BASIC_INFORMATION, <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>) +
00489                     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length;
00490     <span class="keywordflow">if</span> (ResultLength != expected) {
00491         printf(<span class="stringliteral">"rtmisc1: t9a: expected = %08lx actual = %08lx"</span>,
00492                 expected, ResultLength);
00493         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00494     }
00495 
00496     <span class="keywordflow">if</span> (KeyValueBasic-&gt;NameLength != <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length)
00497     {
00498         printf(<span class="stringliteral">"rtmisc1: t9b: wrong description data\n"</span>);
00499         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00500     }
00501 
00502 
00503     tp = (PWSTR)&amp;(KeyValueBasic-&gt;Name[0]);
00504     <span class="keywordflow">if</span> (wcsncmp(<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Buffer, tp, (<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length/<span class="keyword">sizeof</span>(WCHAR))) != 0) {
00505         printf(<span class="stringliteral">"rtmisc1: t9c: wrong name\n"</span>);
00506         <a class="code" href="../../d4/d2/rtmisc1_8c.html#a8">expectstring</a>(
00507             <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Buffer,
00508             (<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length/<span class="keyword">sizeof</span>(WCHAR)),
00509             (PWSTR)&amp;(KeyValueBasic-&gt;Name[0]),
00510             (KeyValueBasic-&gt;NameLength/<span class="keyword">sizeof</span>(WCHAR))
00511             );
00512         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00513     }
00514 
00515     RtlZeroMemory(KeyValueBasic, bufsize);
00516     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a18">NtEnumerateValueKey</a>(
00517                 Testhand1,
00518                 1,              <span class="comment">// Index</span>
00519                 KeyValueBasicInformation,
00520                 KeyValueBasic,
00521                 bufsize,
00522                 &amp;ResultLength
00523                 );
00524     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00525         printf(<span class="stringliteral">"rtmisc1: t9d: %08lx\n"</span>, status);
00526         <span class="keywordflow">goto</span> punt;
00527     }
00528 
00529     expected = FIELD_OFFSET(KEY_VALUE_BASIC_INFORMATION, <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>) +
00530                     ValueName2.Length;
00531     <span class="keywordflow">if</span> (ResultLength != expected) {
00532         printf(<span class="stringliteral">"rtmisc1: t9e: expected = %08lx actual = %08lx"</span>,
00533                 expected, ResultLength);
00534         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00535     }
00536 
00537     <span class="keywordflow">if</span> (KeyValueBasic-&gt;NameLength != ValueName2.Length)
00538     {
00539         printf(<span class="stringliteral">"rtmisc1: t9f: wrong description data\n"</span>);
00540         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00541     }
00542 
00543 
00544     tp = (PWSTR)&amp;(KeyValueBasic-&gt;Name[0]);
00545     <span class="keywordflow">if</span> (wcsncmp(ValueName2.Buffer, tp, (ValueName2.Length/<span class="keyword">sizeof</span>(WCHAR))) != 0) {
00546         printf(<span class="stringliteral">"rtmisc1: t9g: wrong name\n"</span>);
00547         <a class="code" href="../../d4/d2/rtmisc1_8c.html#a8">expectstring</a>(
00548             ValueName2.Buffer,
00549             (ValueName2.Length/<span class="keyword">sizeof</span>(WCHAR)),
00550             (PWSTR)&amp;(KeyValueBasic-&gt;Name[0]),
00551             (KeyValueBasic-&gt;NameLength/<span class="keyword">sizeof</span>(WCHAR))
00552             );
00553         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00554     }
00555 
00556     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a18">NtEnumerateValueKey</a>(
00557                 Testhand1,
00558                 2,              <span class="comment">// Index</span>
00559                 KeyValueBasicInformation,
00560                 KeyValueBasic,
00561                 bufsize,
00562                 &amp;ResultLength
00563                 );
00564     <span class="keywordflow">if</span> (status != STATUS_NO_MORE_ENTRIES) {
00565         printf(<span class="stringliteral">"rtmisc1: t9h: %08lx\n"</span>, status);
00566         <span class="keywordflow">goto</span> punt;
00567     }
00568 
00569     <span class="comment">//</span>
00570     <span class="comment">// t10: create a second subkey and ennumerate the subkeys</span>
00571     <span class="comment">//</span>
00572 
00573     status = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Testhand1);
00574     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00575         printf(<span class="stringliteral">"rtmisc1: t10a: %08lx\n"</span>, status);
00576         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00577     }
00578 
00579     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00580         &amp;ClassName2,
00581         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"t2 Class Name"</span>
00582         );
00583 
00584     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00585         &amp;KeyName2,
00586         <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"second_test_node"</span>
00587         );
00588 
00589     InitializeObjectAttributes(
00590         &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00591         &amp;KeyName2,
00592         0,
00593         BaseHandle,
00594         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00595         );
00596     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>.Attributes |= OBJ_CASE_INSENSITIVE;
00597 
00598     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(
00599                 &amp;Testhand1,
00600                 MAXIMUM_ALLOWED,
00601                 &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>,
00602                 <a class="code" href="../../d4/d2/rtmisc1_8c.html#a1">TITLE_INDEX_2</a>,
00603                 &amp;ClassName2,
00604                 0,
00605                 &amp;Disposition
00606                 );
00607     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00608         printf(<span class="stringliteral">"rtmisc1: t10b: %08lx\n"</span>, status);
00609         <span class="keywordflow">goto</span> punt;
00610     }
00611 
00612     <span class="keywordflow">if</span> (Disposition != REG_CREATED_NEW_KEY) {
00613         printf(<span class="stringliteral">"rtmisc1: t10c: got old key, expected to create new one\n"</span>);
00614         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00615     }
00616 
00617     <span class="comment">//</span>
00618     <span class="comment">// See if we can get data back, and if it makes sense</span>
00619     <span class="comment">//</span>
00620 
00621     RtlZeroMemory(NodeInformation, bufsize);
00622     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a24">NtQueryKey</a>(
00623                 Testhand1,
00624                 KeyNodeInformation,
00625                 NodeInformation,
00626                 bufsize,
00627                 &amp;ResultLength
00628                 );
00629     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00630         printf(<span class="stringliteral">"rtmisc1: t10d: %08lx\n"</span>, status);
00631         <span class="keywordflow">goto</span> punt;
00632     }
00633     CompTime = NodeInformation-&gt;LastWriteTime;
00634 
00635 
00636     <a class="code" href="../../d4/d2/rtmisc1_8c.html#a7">NameClassAndTitle</a>(
00637         NodeInformation,
00638         ClassName2,
00639         <a class="code" href="../../d4/d2/rtmisc1_8c.html#a1">TITLE_INDEX_2</a>,
00640         KeyName2,
00641         CompTime,
00642         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00643         <span class="stringliteral">"rtmisc1: t10e: "</span>
00644         );
00645 
00646     status = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Testhand1);
00647     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00648         printf(<span class="stringliteral">"rtmisc1: t10f: %08lx\n"</span>);
00649         <span class="keywordflow">goto</span> punt;
00650     }
00651 
00652 
00653     RtlZeroMemory(NodeInformation, bufsize);
00654     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a17">NtEnumerateKey</a>(
00655                 BaseHandle,
00656                 0,
00657                 KeyNodeInformation,
00658                 NodeInformation,
00659                 bufsize,
00660                 &amp;ResultLength
00661                 );
00662     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00663         printf(<span class="stringliteral">"rtmisc1: t10g: %08lx\n"</span>, status);
00664         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00665     }
00666     CompTime = NodeInformation-&gt;LastWriteTime;
00667 
00668     <a class="code" href="../../d4/d2/rtmisc1_8c.html#a7">NameClassAndTitle</a>(
00669         NodeInformation,
00670         ClassName,
00671         <a class="code" href="../../d4/d2/rtmisc1_8c.html#a0">TITLE_INDEX_1</a>,
00672         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>,
00673         CompTime,
00674         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00675         <span class="stringliteral">"rtmisc1: t10h: "</span>
00676         );
00677 
00678 
00679     RtlZeroMemory(NodeInformation, bufsize);
00680     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a17">NtEnumerateKey</a>(
00681                 BaseHandle,
00682                 1,
00683                 KeyNodeInformation,
00684                 NodeInformation,
00685                 bufsize,
00686                 &amp;ResultLength
00687                 );
00688     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00689         printf(<span class="stringliteral">"rtmisc1: t10i: %08lx\n"</span>, status);
00690         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00691     }
00692     CompTime = NodeInformation-&gt;LastWriteTime;
00693 
00694     <a class="code" href="../../d4/d2/rtmisc1_8c.html#a7">NameClassAndTitle</a>(
00695         NodeInformation,
00696         ClassName2,
00697         <a class="code" href="../../d4/d2/rtmisc1_8c.html#a1">TITLE_INDEX_2</a>,
00698         KeyName2,
00699         CompTime,
00700         <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00701         <span class="stringliteral">"rtmisc1: t10j: "</span>
00702         );
00703 
00704 
00705     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a17">NtEnumerateKey</a>(
00706                 BaseHandle,
00707                 2,
00708                 KeyNodeInformation,
00709                 NodeInformation,
00710                 bufsize,
00711                 &amp;ResultLength
00712                 );
00713     <span class="keywordflow">if</span> (status != STATUS_NO_MORE_ENTRIES) {
00714         printf(<span class="stringliteral">"rtmisc1: t10k: %08lx\n"</span>, status);
00715         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00716     }
00717 
00718     <span class="comment">//</span>
00719     <span class="comment">// Summary report</span>
00720     <span class="comment">//</span>
00721 
00722     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>) {
00723         printf(<span class="stringliteral">"rtmisc1: success"</span>);
00724         <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(0);
00725     } <span class="keywordflow">else</span> {
00726         printf(<span class="stringliteral">"rtmisc1: failed, %d failures\n"</span>, <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>);
00727         <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(1);
00728     }
00729 
00730 punt:
00731     <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00732     printf(<span class="stringliteral">"rtmisc1: failed, %d failures\n"</span>, <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>);
00733     <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(1);
00734 }
00735 
00736 
00737 
00738 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00739"></a><a class="code" href="../../d4/d2/rtmisc1_8c.html#a7">00739</a> <a class="code" href="../../d4/d2/rtmisc1_8c.html#a7">NameClassAndTitle</a>(
00740     KEY_NODE_INFORMATION    *NodeInformation,
00741     UNICODE_STRING          ClassName,
00742     ULONG                   TitleIndex,
00743     UNICODE_STRING          KeyName,
00744     LARGE_INTEGER           CompTime,
00745     BOOLEAN                 Strong,         <span class="comment">// time must be &gt;= CompTime</span>
00746     PUCHAR                  TestName
00747     )
00748 {
00749     PWSTR   p;
00750 
00751     <span class="keywordflow">if</span> (Strong) {
00752 
00753         <span class="comment">//</span>
00754         <span class="comment">// require exact match</span>
00755         <span class="comment">//</span>
00756 
00757         <span class="keywordflow">if</span> ((CompTime.HighPart != NodeInformation-&gt;LastWriteTime.HighPart) ||
00758             (CompTime.LowPart != NodeInformation-&gt;LastWriteTime.LowPart))
00759         {
00760             printf(<span class="stringliteral">"%s Wrong time (a)\n"</span>, TestName);
00761             <a class="code" href="../../d4/d2/rtmisc1_8c.html#a9">expecttime</a>(CompTime, NodeInformation-&gt;LastWriteTime);
00762             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00763         }
00764 
00765 
00766     } <span class="keywordflow">else</span> {
00767 
00768         <span class="comment">//</span>
00769         <span class="comment">// &gt;= will do</span>
00770         <span class="comment">//</span>
00771 
00772         <span class="keywordflow">if</span> ( (CompTime.HighPart &gt; NodeInformation-&gt;LastWriteTime.HighPart) ||
00773              ((CompTime.HighPart == NodeInformation-&gt;LastWriteTime.HighPart) &amp;&amp;
00774               (CompTime.LowPart &gt; NodeInformation-&gt;LastWriteTime.LowPart)) )
00775         {
00776             printf(<span class="stringliteral">"%s Wrong time (b)\n"</span>, TestName);
00777             <a class="code" href="../../d4/d2/rtmisc1_8c.html#a9">expecttime</a>(CompTime, NodeInformation-&gt;LastWriteTime);
00778             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00779         }
00780     }
00781 
00782 
00783     p = (PWSTR)((PUCHAR)NodeInformation + NodeInformation-&gt;ClassOffset);
00784     <span class="keywordflow">if</span> ( (NodeInformation-&gt;ClassLength != ClassName.Length) ||
00785          (wcsncmp(ClassName.Buffer, p, (ClassName.Length/<span class="keyword">sizeof</span>(WCHAR))) != 0))
00786     {
00787         printf(<span class="stringliteral">"%s wrong class name\n"</span>, TestName);
00788         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00789     }
00790 
00791     <span class="keywordflow">if</span> (NodeInformation-&gt;TitleIndex != TitleIndex) {
00792         printf(<span class="stringliteral">"%s wrong title index\n"</span>, TestName);
00793         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00794     }
00795 
00796     p = (PWSTR)(&amp;(NodeInformation-&gt;Name[0]));
00797     <span class="keywordflow">if</span> ( (NodeInformation-&gt;NameLength != <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Length) ||
00798          (wcsncmp(<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Buffer, p, (<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Length/<span class="keyword">sizeof</span>(WCHAR))) != 0))
00799     {
00800         printf(<span class="stringliteral">"%s wrong name\n"</span>, TestName);
00801         <a class="code" href="../../d4/d2/rtmisc1_8c.html#a8">expectstring</a>(
00802             <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Buffer,
00803             (<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>.Length/<span class="keyword">sizeof</span>(WCHAR)),
00804             (PWSTR)&amp;(NodeInformation-&gt;Name[0]),
00805             (NodeInformation-&gt;NameLength/<span class="keyword">sizeof</span>(WCHAR))
00806             );
00807         <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>++;
00808     }
00809 }
00810 
00811 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00812"></a><a class="code" href="../../d4/d2/rtmisc1_8c.html#a9">00812</a> <a class="code" href="../../d4/d2/rtmisc1_8c.html#a9">expecttime</a>(
00813     LARGE_INTEGER   ExpectTime,
00814     LARGE_INTEGER   ActualTime
00815     )
00816 {
00817     printf(<span class="stringliteral">"Expected %08lx%08lx\n"</span>, ExpectTime.HighPart, ExpectTime.LowPart);
00818     printf(<span class="stringliteral">"Got      %08lx%08lx\n"</span>, ActualTime.HighPart, ActualTime.LowPart);
00819     <span class="keywordflow">return</span>;
00820 }
00821 
00822 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00823"></a><a class="code" href="../../d4/d2/rtmisc1_8c.html#a8">00823</a> <a class="code" href="../../d4/d2/rtmisc1_8c.html#a8">expectstring</a>(
00824     PWSTR   expected,
00825     ULONG   expectedlength,
00826     PWSTR   actual,
00827     ULONG   actuallength
00828     )
00829 {
00830     ULONG   i;
00831 
00832     printf(<span class="stringliteral">"Expected Len %d Str = '"</span>, expectedlength);
00833     <span class="keywordflow">for</span> (i = 0; i &lt; expectedlength; i++) {
00834         printf(<span class="stringliteral">"%c"</span>, (UCHAR)(expected[i]));
00835     }
00836     printf(<span class="stringliteral">"'\n"</span>);
00837 
00838     printf(<span class="stringliteral">"Got Len %d Str = '"</span>, actuallength);
00839     <span class="keywordflow">for</span> (i = 0; i &lt; actuallength; i++) {
00840         printf(<span class="stringliteral">"%c"</span>, (UCHAR)(actual[i]));
00841     }
00842     printf(<span class="stringliteral">"'\n"</span>);
00843     <span class="keywordflow">return</span>;
00844 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:41 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
