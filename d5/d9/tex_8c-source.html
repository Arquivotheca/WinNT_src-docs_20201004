<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: tex.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>tex.c</h1><a href="../../d4/d0/tex_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    tex.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    Test program for the EX subcomponent of the NTOS project</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Steve Wood (stevewo) 31-Mar-1989</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">--*/</span>
00020 
00021 <span class="preprocessor">#include "<a class="code" href="../../d4/d0/exp_8h.html">exp.h</a>"</span>
00022 <span class="comment">//#include "zwapi.h"</span>
00023 <span class="preprocessor">#include &lt;version.h&gt;</span>
00024 <span class="preprocessor">#include &lt;string.h&gt;</span>
00025 
<a name="l00026"></a><a class="code" href="../../d4/d0/tex_8c.html#a0">00026</a> <span class="preprocessor">#define DumpPool(x, y)</span>
00027 <span class="preprocessor"></span>
00028 BOOLEAN
00029 <a class="code" href="../../d4/d0/tex_8c.html#a24">ExTest</a> (
00030     VOID
00031     );
00032 
<a name="l00033"></a><a class="code" href="../../d4/d0/tex_8c.html#a2">00033</a> <a class="code" href="../../d8/d1/init_8h.html#a19">PTESTFCN</a> <a class="code" href="../../d4/d0/tex_8c.html#a2">TestFunction</a> = <a class="code" href="../../d4/d0/tex_8c.html#a24">ExTest</a>;
00034 
00035 <span class="preprocessor">#ifndef MIPS</span>
00036 <span class="preprocessor"></span>
<a name="l00037"></a><a class="code" href="../../d4/d0/tex_8c.html#a3">00037</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a3">TestEvent</a> = 0;
<a name="l00038"></a><a class="code" href="../../d4/d0/tex_8c.html#a4">00038</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a4">TestHandle</a> = 0;
<a name="l00039"></a><a class="code" href="../../d4/d0/tex_8c.html#a5">00039</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a5">TestInfo</a> = 0;
<a name="l00040"></a><a class="code" href="../../d4/d0/tex_8c.html#a6">00040</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a6">TestLuid</a> = 0;
<a name="l00041"></a><a class="code" href="../../d4/d0/tex_8c.html#a7">00041</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a7">TestMemory</a> = 0;
<a name="l00042"></a><a class="code" href="../../d4/d0/tex_8c.html#a8">00042</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a8">TestParty</a> = 0;
<a name="l00043"></a><a class="code" href="../../d4/d0/tex_8c.html#a9">00043</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a9">TestPool</a> = 0;
<a name="l00044"></a><a class="code" href="../../d4/d0/tex_8c.html#a10">00044</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a10">TestResource</a> = 0;
<a name="l00045"></a><a class="code" href="../../d4/d0/tex_8c.html#a11">00045</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a11">TestBitMap</a> = 0;
<a name="l00046"></a><a class="code" href="../../d4/d0/tex_8c.html#a12">00046</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a12">TestSemaphore</a> = 0;
<a name="l00047"></a><a class="code" href="../../d4/d0/tex_8c.html#a13">00047</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a13">TestTimer</a> = 0;
<a name="l00048"></a><a class="code" href="../../d4/d0/tex_8c.html#a14">00048</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a14">TestZone</a> = 0;
<a name="l00049"></a><a class="code" href="../../d4/d0/tex_8c.html#a15">00049</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a15">TestMutant</a> = 0;
<a name="l00050"></a><a class="code" href="../../d4/d0/tex_8c.html#a16">00050</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a16">TestException</a> = 0;
00051 
00052 <span class="preprocessor">#else</span>
00053 <span class="preprocessor"></span>
00054 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a3">TestEvent</a> = 1;
00055 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a4">TestHandle</a> = 0;
00056 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a5">TestInfo</a> = 0;
00057 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a6">TestLuid</a> = 0;
00058 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a7">TestMemory</a> = 0;
00059 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a8">TestParty</a> = 0;
00060 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a9">TestPool</a> = 0;
00061 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a10">TestResource</a> = 0;
00062 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a11">TestBitMap</a> = 0;
00063 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a12">TestSemaphore</a> = 2;
00064 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a13">TestTimer</a> = 3;
00065 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a14">TestZone</a> = 0;
00066 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a15">TestMutant</a> = 4;
00067 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d4/d0/tex_8c.html#a16">TestException</a> = 0;
00068 
00069 <span class="preprocessor">#endif // MIPS</span>
00070 <span class="preprocessor"></span>
00071 BOOLEAN
<a name="l00072"></a><a class="code" href="../../d4/d0/tex_8c.html#a25">00072</a> <a class="code" href="../../d4/d0/tex_8c.html#a25">DoEventTest</a>(
00073     )
00074 {
00075     ULONG DesiredAccess = EVENT_ALL_ACCESS;
00076     EVENT_BASIC_INFORMATION EventInformation;
00077     HANDLE Handle1;
00078     HANDLE Handle1c;
00079     HANDLE Handle2;
00080     HANDLE Handle2c;
00081     ULONG Length;
00082     UNICODE_STRING Name1;
00083     UNICODE_STRING Name2;
00084     OBJECT_ATTRIBUTES Object1Attributes;
00085     OBJECT_ATTRIBUTES Object2Attributes;
00086     LONG State;
00087     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00088 
00089     <span class="comment">//</span>
00090     <span class="comment">// Announce start of event test.</span>
00091     <span class="comment">//</span>
00092 
00093     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** Start of Event Test **\n"</span>);
00094 
00095     <span class="comment">//</span>
00096     <span class="comment">// Initialize strings and fill in object attributes structures.</span>
00097     <span class="comment">//</span>
00098 
00099     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name1, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a> <span class="stringliteral">"\\Event1"</span>);
00100     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name2, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a> <span class="stringliteral">"\\Event2"</span>);
00101     InitializeObjectAttributes(&amp;Object1Attributes, &amp;Name1, 0, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00102     InitializeObjectAttributes(&amp;Object2Attributes, &amp;Name2, 0, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00103 
00104     <span class="comment">//</span>
00105     <span class="comment">// Create event 1.</span>
00106     <span class="comment">//</span>
00107 
00108     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCreateEvent(&amp;Handle1c, DesiredAccess, &amp;Object1Attributes,
00109                            NotificationEvent, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00110     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00111         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - create event 1 failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00112     }
00113 
00114     <span class="comment">//</span>
00115     <span class="comment">// Open event 1.</span>
00116     <span class="comment">//</span>
00117 
00118     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenEvent(&amp;Handle1, DesiredAccess, &amp;Object1Attributes);
00119     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00120         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - open event 1 failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00121     }
00122 
00123     <span class="comment">//</span>
00124     <span class="comment">// Query event 1.</span>
00125     <span class="comment">//</span>
00126 
00127     EventInformation.EventState = 0;
00128     Length = 0;
00129     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryEvent(Handle1, EventBasicInformation,
00130                           (PVOID)&amp;EventInformation, <span class="keyword">sizeof</span>(EVENT_BASIC_INFORMATION),
00131                           &amp;Length);
00132     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00133         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - query event 1 failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00134     }
00135     <span class="keywordflow">if</span> (EventInformation.EventType != NotificationEvent) {
00136         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - query event 1 wrong event type\n"</span>);
00137     }
00138     <span class="keywordflow">if</span> (EventInformation.EventState == 0) {
00139         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - query event 1 current state wrong\n"</span>);
00140     }
00141     <span class="keywordflow">if</span> (Length != <span class="keyword">sizeof</span>(EVENT_BASIC_INFORMATION)) {
00142         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - query event 1 return length wrong\n"</span>);
00143     }
00144 
00145     <span class="comment">//</span>
00146     <span class="comment">// Pulse event 1.</span>
00147     <span class="comment">//</span>
00148 
00149     State = 0;
00150     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwPulseEvent(Handle1, &amp;State);
00151     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00152         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - pulse event 1 failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00153     }
00154     <span class="keywordflow">if</span> (State == 0) {
00155         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - pulse event 1 previous state wrong\n"</span>);
00156     }
00157 
00158     <span class="comment">//</span>
00159     <span class="comment">// Set event 1.</span>
00160     <span class="comment">//</span>
00161 
00162     State = 1;
00163     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwSetEvent(Handle1, &amp;State);
00164     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00165         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - set event 1 failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00166     }
00167     <span class="keywordflow">if</span> (State == 1) {
00168         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - set event 1 previous state wrong\n"</span>);
00169     }
00170 
00171     <span class="comment">//</span>
00172     <span class="comment">// Wait on event 1.</span>
00173     <span class="comment">//</span>
00174 
00175     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwWaitForSingleObject(Handle1, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00176     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00177         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - wait event 1 failed\n"</span>);
00178     }
00179 
00180     <span class="comment">//</span>
00181     <span class="comment">// Reset event 1.</span>
00182     <span class="comment">//</span>
00183 
00184     State = 0;
00185     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwResetEvent(Handle1, &amp;State);
00186     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00187         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - reset event 1 failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00188     }
00189     <span class="keywordflow">if</span> (State == 0) {
00190         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - reset event 1 previous state wrong\n"</span>);
00191     }
00192 
00193     <span class="comment">//</span>
00194     <span class="comment">// Create event 2.</span>
00195     <span class="comment">//</span>
00196 
00197     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCreateEvent(&amp;Handle2c, DesiredAccess, &amp;Object2Attributes,
00198                            NotificationEvent, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00199     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00200         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - create event 2 failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00201     }
00202 
00203     <span class="comment">//</span>
00204     <span class="comment">// Open event 2.</span>
00205     <span class="comment">//</span>
00206 
00207     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenEvent(&amp;Handle2, DesiredAccess, &amp;Object2Attributes);
00208     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00209         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - open event 2 failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00210     }
00211 
00212     <span class="comment">//</span>
00213     <span class="comment">// Query event 2.</span>
00214     <span class="comment">//</span>
00215 
00216     EventInformation.EventState = 1;
00217     Length = 0;
00218     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryEvent(Handle2, EventBasicInformation,
00219                           (PVOID)&amp;EventInformation, <span class="keyword">sizeof</span>(EVENT_BASIC_INFORMATION),
00220                           &amp;Length);
00221     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00222         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - query event 2 failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00223     }
00224     <span class="keywordflow">if</span> (EventInformation.EventType != NotificationEvent) {
00225         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - query event 2 wrong event type\n"</span>);
00226     }
00227     <span class="keywordflow">if</span> (EventInformation.EventState == 1) {
00228         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - query event 2 current state wrong\n"</span>);
00229     }
00230     <span class="keywordflow">if</span> (Length != <span class="keyword">sizeof</span>(EVENT_BASIC_INFORMATION)) {
00231         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - query event 2 return length wrong\n"</span>);
00232     }
00233 
00234     <span class="comment">//</span>
00235     <span class="comment">// Pulse event 2.</span>
00236     <span class="comment">//</span>
00237 
00238     State = 1;
00239     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwPulseEvent(Handle2, &amp;State);
00240     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00241         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - pulse event 2 failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00242     }
00243     <span class="keywordflow">if</span> (State == 1) {
00244         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - pulse event 2 previous state wrong\n"</span>);
00245     }
00246 
00247     <span class="comment">//</span>
00248     <span class="comment">// Set event 2.</span>
00249     <span class="comment">//</span>
00250 
00251     State = 1;
00252     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwSetEvent(Handle2, &amp;State);
00253     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00254         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - set event 2 failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00255     }
00256     <span class="keywordflow">if</span> (State == 1) {
00257         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - set event 2 previous state wrong\n"</span>);
00258     }
00259 
00260     <span class="comment">//</span>
00261     <span class="comment">// Wait on event 2.</span>
00262     <span class="comment">//</span>
00263 
00264     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwWaitForSingleObject(Handle2, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00265     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00266         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - wait event 2 failed\n"</span>);
00267     }
00268 
00269     <span class="comment">//</span>
00270     <span class="comment">// Reset event 2.</span>
00271     <span class="comment">//</span>
00272 
00273     State = 0;
00274     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwResetEvent(Handle2, &amp;State);
00275     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00276         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - reset event 2 failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00277     }
00278     <span class="keywordflow">if</span> (State == 0) {
00279         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - reset event 2 previous state wrong\n"</span>);
00280     }
00281 
00282     <span class="comment">//</span>
00283     <span class="comment">// Close all handles.</span>
00284     <span class="comment">//</span>
00285 
00286     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle1);
00287     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00288         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - event 1 close failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00289     }
00290     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle1c);
00291     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00292         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - event 1c close failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00293     }
00294     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle2);
00295     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00296         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - event 2 close failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00297     }
00298     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle2c);
00299     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00300         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Event test - event 2c close failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00301     }
00302 
00303     <span class="comment">//</span>
00304     <span class="comment">// Announce end of event test.</span>
00305     <span class="comment">//</span>
00306 
00307     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** End of Event Test **\n"</span>);
00308     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00309 }
00310 
00311 BOOLEAN
<a name="l00312"></a><a class="code" href="../../d4/d0/tex_8c.html#a26">00312</a> <a class="code" href="../../d4/d0/tex_8c.html#a26">DoExceptionTest</a>(
00313     )
00314 
00315 {
00316 <span class="preprocessor">#ifndef  i386</span>
00317 <span class="preprocessor"></span>    <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00318 
00319     <span class="comment">//</span>
00320     <span class="comment">// Announce start of system service exception test.</span>
00321     <span class="comment">//</span>
00322 
00323     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** Start of System Service Exception Test **\n"</span>);
00324 
00325     <span class="comment">//</span>
00326     <span class="comment">// Eventually this should have a test case for each system service that</span>
00327     <span class="comment">// has input of output arguments which are addressed by pointers. The</span>
00328     <span class="comment">// intent of this test is to make sure that each service correctly</span>
00329     <span class="comment">// handles access violations.</span>
00330     <span class="comment">//</span>
00331 
00332     <span class="comment">//</span>
00333     <span class="comment">// Query system time test.</span>
00334     <span class="comment">//</span>
00335 
00336     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQuerySystemTime((PLARGE_INTEGER)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00337     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_ACCESS_VIOLATION) {
00338         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Exception test - NtQuerySystemTime failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00339     }
00340 
00341     <span class="comment">//</span>
00342     <span class="comment">// Set system time test.</span>
00343     <span class="comment">//</span>
00344 
00345     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwSetSystemTime((PLARGE_INTEGER)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, (PLARGE_INTEGER)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00346     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_ACCESS_VIOLATION) {
00347         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Exception test - NtSetSystemTime failed, status = %lx\n"</span>, <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00348     }
00349 
00350     <span class="comment">//</span>
00351     <span class="comment">// Announce end of system service exception test.</span>
00352     <span class="comment">//</span>
00353 
00354     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** End of System Service Exception Test **\n"</span>);
00355 <span class="preprocessor">#else</span>
00356 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** Skip System Service Exception Test for 386 **\n"</span>);
00357 <span class="preprocessor">#endif  // i386</span>
00358 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00359 }
00360 
00361 BOOLEAN
<a name="l00362"></a><a class="code" href="../../d4/d0/tex_8c.html#a27">00362</a> <a class="code" href="../../d4/d0/tex_8c.html#a27">DoMutantTest</a>(
00363     )
00364 {
00365 
00366     LONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00367     ULONG DesiredAccess = MUTANT_ALL_ACCESS;
00368     HANDLE Handle1;
00369     HANDLE Handle1c;
00370     HANDLE Handle2;
00371     HANDLE Handle2c;
00372     ULONG Length;
00373     STRING Name1;
00374     STRING Name2;
00375     OBJECT_ATTRIBUTES Object1Attributes;
00376     OBJECT_ATTRIBUTES Object2Attributes;
00377     MUTANT_BASIC_INFORMATION MutantInformation;
00378     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00379 
00380     <span class="comment">//</span>
00381     <span class="comment">// Announce start of mutant test.</span>
00382     <span class="comment">//</span>
00383 
00384     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** Start of Mutant Test **\n"</span>);
00385 
00386     <span class="comment">//</span>
00387     <span class="comment">// Initialize strings and fill in object attributes structures.</span>
00388     <span class="comment">//</span>
00389 
00390     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name1, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\Mutant1"</span>);
00391     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name2, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\Mutant2"</span>);
00392     InitializeObjectAttributes(&amp;Object1Attributes,&amp;Name1,0,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00393     InitializeObjectAttributes(&amp;Object2Attributes,&amp;Name2,0,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00394 
00395     <span class="comment">//</span>
00396     <span class="comment">// Create mutant 1.</span>
00397     <span class="comment">//</span>
00398 
00399     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCreateMutant(&amp;Handle1c, DesiredAccess, &amp;Object1Attributes,
00400                             <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00401     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00402         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - create mutant 1 failed, status = %lx\n"</span>,
00403                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00404     }
00405 
00406     <span class="comment">//</span>
00407     <span class="comment">// Open mutant 1.</span>
00408     <span class="comment">//</span>
00409 
00410     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenMutant(&amp;Handle1, DesiredAccess, &amp;Object1Attributes);
00411     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00412         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - open mutant 1 failed, status = %lx\n"</span>,
00413                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00414     }
00415 
00416     <span class="comment">//</span>
00417     <span class="comment">// Query mutant 1.</span>
00418     <span class="comment">//</span>
00419 
00420     MutantInformation.CurrentCount = 10;
00421     MutantInformation.AbandonedState = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00422     Length = 0;
00423     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryMutant(Handle1, MutantBasicInformation,
00424                            (PVOID)&amp;MutantInformation,
00425                            <span class="keyword">sizeof</span>(MUTANT_BASIC_INFORMATION), &amp;Length);
00426     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00427         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - query mutant 1 failed, status = %lx\n"</span>,
00428                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00429     }
00430     <span class="keywordflow">if</span> (MutantInformation.CurrentCount != 1) {
00431         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - query mutant 1 current count wrong\n"</span>);
00432     }
00433     <span class="keywordflow">if</span> (MutantInformation.AbandonedState != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00434         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - query mutant 1 abandoned state wrong\n"</span>);
00435     }
00436     <span class="keywordflow">if</span> (Length != <span class="keyword">sizeof</span>(MUTANT_BASIC_INFORMATION)) {
00437         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - query mutant 1 return length wrong\n"</span>);
00438     }
00439 
00440     <span class="comment">//</span>
00441     <span class="comment">// Acquire mutant 1.</span>
00442     <span class="comment">//</span>
00443 
00444     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwWaitForSingleObject(Handle1, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00445     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00446         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - wait mutant 1 failed, status = %lx\n"</span>,
00447                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00448     }
00449 
00450     <span class="comment">//</span>
00451     <span class="comment">// Release mutant 1.</span>
00452     <span class="comment">//</span>
00453 
00454     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 100;
00455     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwReleaseMutant(Handle1, &amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
00456     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00457         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - release mutant 1 failed, status = %lx\n"</span>,
00458                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00459     }
00460     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> != 0) {
00461         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - release mutant 1 previous count wrong\n"</span>);
00462     }
00463 
00464     <span class="comment">//</span>
00465     <span class="comment">// Create mutant 2.</span>
00466     <span class="comment">//</span>
00467 
00468     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCreateMutant(&amp;Handle2c, DesiredAccess, &amp;Object2Attributes,
00469                             <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00470     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00471         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - create mutant 2 failed, status = %lx\n"</span>,
00472                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00473     }
00474 
00475     <span class="comment">//</span>
00476     <span class="comment">// Open mutant 2.</span>
00477     <span class="comment">//</span>
00478 
00479     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenMutant(&amp;Handle2, DesiredAccess, &amp;Object2Attributes);
00480     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00481         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - open mutant 2 failed, status = %lx\n"</span>,
00482                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00483     }
00484 
00485     <span class="comment">//</span>
00486     <span class="comment">// Acquire mutant 2.</span>
00487     <span class="comment">//</span>
00488 
00489     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwWaitForSingleObject(Handle2, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00490     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00491         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - wait mutant 2 failed, status = %lx\n"</span>,
00492                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00493     }
00494 
00495     <span class="comment">//</span>
00496     <span class="comment">// Query mutant 2.</span>
00497     <span class="comment">//</span>
00498 
00499     MutantInformation.CurrentCount = 20;
00500     MutantInformation.AbandonedState = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00501     Length = 0;
00502     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryMutant(Handle2, MutantBasicInformation,
00503                           (PVOID)&amp;MutantInformation,
00504                           <span class="keyword">sizeof</span>(MUTANT_BASIC_INFORMATION), &amp;Length);
00505     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00506         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - query mutant 2 failed, status = %lx\n"</span>,
00507                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00508     }
00509     <span class="keywordflow">if</span> (MutantInformation.CurrentCount != 0) {
00510         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - query mutant 2 current count wrong\n"</span>);
00511     }
00512     <span class="keywordflow">if</span> (MutantInformation.AbandonedState != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00513         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - query mutant 2 abandoned state wrong\n"</span>);
00514     }
00515     <span class="keywordflow">if</span> (Length != <span class="keyword">sizeof</span>(MUTANT_BASIC_INFORMATION)) {
00516         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - query mutant 2 return length wrong\n"</span>);
00517     }
00518 
00519     <span class="comment">//</span>
00520     <span class="comment">// Acquire mutant 2.</span>
00521     <span class="comment">//</span>
00522 
00523     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwWaitForSingleObject(Handle2, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00524     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00525         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - wait mutant 2 failed, status = %lx\n"</span>,
00526                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00527     }
00528 
00529     <span class="comment">//</span>
00530     <span class="comment">// Release mutant 2.</span>
00531     <span class="comment">//</span>
00532 
00533     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 100;
00534     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwReleaseMutant(Handle2, &amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
00535     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00536         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - release mutant 2 failed, status = %lx\n"</span>,
00537                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00538     }
00539     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> != - 1) {
00540         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - release mutant 2 previous count wrong\n"</span>);
00541     }
00542 
00543     <span class="comment">//</span>
00544     <span class="comment">// Release mutant 2.</span>
00545     <span class="comment">//</span>
00546 
00547     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 100;
00548     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwReleaseMutant(Handle2, &amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
00549     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00550         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - release mutant 2 failed, status = %lx\n"</span>,
00551                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00552     }
00553     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> != 0) {
00554         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - release mutant 2 previous count wrong\n"</span>);
00555     }
00556 
00557     <span class="comment">//</span>
00558     <span class="comment">// Close all handles.</span>
00559     <span class="comment">//</span>
00560 
00561     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle1);
00562     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00563         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - mutant 1 close failed, status = %lx\n"</span>,
00564                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00565     }
00566     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle1c);
00567     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00568         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - mutant 1c close failed, status = %lx\n"</span>,
00569                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00570     }
00571     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle2);
00572     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00573         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - mutant 2 close failed, status = %lx\n"</span>,
00574                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00575     }
00576     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle2c);
00577     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00578         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Mutant test - mutant 2c close failed, status = %lx\n"</span>,
00579                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00580     }
00581 
00582     <span class="comment">//</span>
00583     <span class="comment">// Announce end of mutant test.</span>
00584     <span class="comment">//</span>
00585 
00586     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** End of Mutant Test **\n"</span>);
00587     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00588 }
00589 
00590 BOOLEAN
<a name="l00591"></a><a class="code" href="../../d4/d0/tex_8c.html#a28">00591</a> <a class="code" href="../../d4/d0/tex_8c.html#a28">DoSemaphoreTest</a>(
00592     )
00593 {
00594 
00595     LONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
00596     ULONG DesiredAccess = SEMAPHORE_ALL_ACCESS;
00597     HANDLE Handle1;
00598     HANDLE Handle1c;
00599     HANDLE Handle2;
00600     HANDLE Handle2c;
00601     ULONG Length;
00602     STRING Name1;
00603     STRING Name2;
00604     OBJECT_ATTRIBUTES Object1Attributes;
00605     OBJECT_ATTRIBUTES Object2Attributes;
00606     SEMAPHORE_BASIC_INFORMATION SemaphoreInformation;
00607     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00608 
00609     <span class="comment">//</span>
00610     <span class="comment">// Announce start of semaphore test.</span>
00611     <span class="comment">//</span>
00612 
00613     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** Start of Semaphore Test **\n"</span>);
00614 
00615     <span class="comment">//</span>
00616     <span class="comment">// Initialize strings and fill in object attributes structures.</span>
00617     <span class="comment">//</span>
00618 
00619     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name1, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\Semaphore1"</span>);
00620     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name2, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\Semaphore2"</span>);
00621     InitializeObjectAttributes(&amp;Object1Attributes,&amp;Name1,0,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00622     InitializeObjectAttributes(&amp;Object2Attributes,&amp;Name2,0,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00623 
00624     <span class="comment">//</span>
00625     <span class="comment">// Create semaphore 1.</span>
00626     <span class="comment">//</span>
00627 
00628     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCreateSemaphore(&amp;Handle1c, DesiredAccess, &amp;Object1Attributes,
00629                                0, 10);
00630     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00631         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - create semaphore 1 failed, status = %lx\n"</span>,
00632                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00633     }
00634 
00635     <span class="comment">//</span>
00636     <span class="comment">// Open semaphore 1.</span>
00637     <span class="comment">//</span>
00638 
00639     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenSemaphore(&amp;Handle1, DesiredAccess, &amp;Object1Attributes);
00640     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00641         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - open semaphore 1 failed, status = %lx\n"</span>,
00642                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00643     }
00644 
00645     <span class="comment">//</span>
00646     <span class="comment">// Query semaphore 1.</span>
00647     <span class="comment">//</span>
00648 
00649     SemaphoreInformation.CurrentCount = 10;
00650     SemaphoreInformation.MaximumCount = 0;
00651     Length = 0;
00652     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQuerySemaphore(Handle1, SemaphoreBasicInformation,
00653                           (PVOID)&amp;SemaphoreInformation,
00654                           <span class="keyword">sizeof</span>(SEMAPHORE_BASIC_INFORMATION), &amp;Length);
00655     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00656         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - query semaphore 1 failed, status = %lx\n"</span>,
00657                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00658     }
00659     <span class="keywordflow">if</span> (SemaphoreInformation.CurrentCount != 0) {
00660         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - query semaphore 1 current count wrong\n"</span>);
00661     }
00662     <span class="keywordflow">if</span> (SemaphoreInformation.MaximumCount != 10) {
00663         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - query semaphore 1 maximum count wrong\n"</span>);
00664     }
00665     <span class="keywordflow">if</span> (Length != <span class="keyword">sizeof</span>(SEMAPHORE_BASIC_INFORMATION)) {
00666         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - query semaphore 1 return length wrong\n"</span>);
00667     }
00668 
00669     <span class="comment">//</span>
00670     <span class="comment">// Release semaphore 1.</span>
00671     <span class="comment">//</span>
00672 
00673     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 100;
00674     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwReleaseSemaphore(Handle1, 2, &amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
00675     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00676         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - release semaphore 1 failed, status = %lx\n"</span>,
00677                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00678     }
00679     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> != 0) {
00680         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - release semaphore 1 previous count wrong\n"</span>);
00681     }
00682 
00683     <span class="comment">//</span>
00684     <span class="comment">// Release semaphore 1.</span>
00685     <span class="comment">//</span>
00686 
00687     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 100;
00688     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwReleaseSemaphore(Handle1, 5, &amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
00689     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00690         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - release semaphore 1 failed, status = %lx\n"</span>,
00691                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00692     }
00693     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> != 2) {
00694         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - release semaphore 1 previous count wrong\n"</span>);
00695     }
00696 
00697     <span class="comment">//</span>
00698     <span class="comment">// Create semaphore 2.</span>
00699     <span class="comment">//</span>
00700 
00701     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCreateSemaphore(&amp;Handle2c, DesiredAccess, &amp;Object2Attributes,
00702                                5, 20);
00703     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00704         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - create semaphore 2 failed, status = %lx\n"</span>,
00705                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00706     }
00707 
00708     <span class="comment">//</span>
00709     <span class="comment">// Open semaphore 2.</span>
00710     <span class="comment">//</span>
00711 
00712     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenSemaphore(&amp;Handle2, DesiredAccess, &amp;Object2Attributes);
00713     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00714         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - open semaphore 2 failed, status = %lx\n"</span>,
00715                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00716     }
00717 
00718     <span class="comment">//</span>
00719     <span class="comment">// Query semaphore 2.</span>
00720     <span class="comment">//</span>
00721 
00722     SemaphoreInformation.CurrentCount = 20;
00723     SemaphoreInformation.MaximumCount = 5;
00724     Length = 0;
00725     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQuerySemaphore(Handle2, SemaphoreBasicInformation,
00726                           (PVOID)&amp;SemaphoreInformation,
00727                           <span class="keyword">sizeof</span>(SEMAPHORE_BASIC_INFORMATION), &amp;Length);
00728     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00729         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - query semaphore 2 failed, status = %lx\n"</span>,
00730                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00731     }
00732     <span class="keywordflow">if</span> (SemaphoreInformation.CurrentCount != 5) {
00733         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - query semaphore 2 current count wrong\n"</span>);
00734     }
00735     <span class="keywordflow">if</span> (SemaphoreInformation.MaximumCount != 20) {
00736         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - query semaphore 2 maximum count wrong\n"</span>);
00737     }
00738     <span class="keywordflow">if</span> (Length != <span class="keyword">sizeof</span>(SEMAPHORE_BASIC_INFORMATION)) {
00739         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - query semaphore 2 return length wrong\n"</span>);
00740     }
00741 
00742     <span class="comment">//</span>
00743     <span class="comment">// Release semaphore 2.</span>
00744     <span class="comment">//</span>
00745 
00746     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 100;
00747     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwReleaseSemaphore(Handle2, 3, &amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
00748     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00749         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - release semaphore 2 failed, status = %lx\n"</span>,
00750                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00751     }
00752     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> != 5) {
00753         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - release semaphore 2 previous count wrong\n"</span>);
00754     }
00755 
00756     <span class="comment">//</span>
00757     <span class="comment">// Release semaphore 2.</span>
00758     <span class="comment">//</span>
00759 
00760     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = 100;
00761     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwReleaseSemaphore(Handle2, 5, &amp;<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>);
00762     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00763         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - release semaphore 2 failed, status = %lx\n"</span>,
00764                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00765     }
00766     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> != 8) {
00767         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - release semaphore 2 previous count wrong\n"</span>);
00768     }
00769 
00770     <span class="comment">//</span>
00771     <span class="comment">// Close all handles.</span>
00772     <span class="comment">//</span>
00773 
00774     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle1);
00775     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00776         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - semaphore 1 close failed, status = %lx\n"</span>,
00777                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00778     }
00779     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle1c);
00780     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00781         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - semaphore 1c close failed, status = %lx\n"</span>,
00782                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00783     }
00784     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle2);
00785     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00786         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - semaphore 2 close failed, status = %lx\n"</span>,
00787                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00788     }
00789     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle2c);
00790     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00791         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Semaphore test - semaphore 2c close failed, status = %lx\n"</span>,
00792                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00793     }
00794 
00795     <span class="comment">//</span>
00796     <span class="comment">// Announce end of semaphore test.</span>
00797     <span class="comment">//</span>
00798 
00799     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** End of Semaphore Test **\n"</span>);
00800     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00801 }
00802 
00803 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00804"></a><a class="code" href="../../d4/d0/tex_8c.html#a29">00804</a> <a class="code" href="../../d4/d0/tex_8c.html#a29">TimerApcRoutine</a> (
00805     IN PVOID TimerContext,
00806     IN ULONG TimerLowValue,
00807     IN LONG TimerHighValue
00808     )
00809 
00810 {
00811 
00812     *((PBOOLEAN)TimerContext) = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00813     <span class="keywordflow">return</span>;
00814 }
00815 
00816 BOOLEAN
<a name="l00817"></a><a class="code" href="../../d4/d0/tex_8c.html#a30">00817</a> <a class="code" href="../../d4/d0/tex_8c.html#a30">DoTimerTest</a> (
00818     )
00819 
00820 {
00821 
00822     BOOLEAN ApcHappened;
00823     BOOLEAN CurrentState;
00824     ULONG DesiredAccess = TIMER_ALL_ACCESS;
00825     LARGE_INTEGER DueTime;
00826     HANDLE Handle1;
00827     HANDLE Handle1c;
00828     HANDLE Handle2;
00829     HANDLE Handle2c;
00830     ULONG Length;
00831     STRING Name1;
00832     STRING Name2;
00833     OBJECT_ATTRIBUTES Object1Attributes;
00834     OBJECT_ATTRIBUTES Object2Attributes;
00835     BOOLEAN PreviousState;
00836     TIMER_BASIC_INFORMATION TimerInformation;
00837     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00838 
00839     <span class="comment">//</span>
00840     <span class="comment">// Announce start of timer test.</span>
00841     <span class="comment">//</span>
00842 
00843     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** Start of Timer Test **\n"</span>);
00844 
00845     <span class="comment">//</span>
00846     <span class="comment">// Initialize strings and fill in object attributes structures.</span>
00847     <span class="comment">//</span>
00848 
00849     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name1, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\Timer1"</span>);
00850     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;Name2, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\Timer2"</span>);
00851     InitializeObjectAttributes(&amp;Object1Attributes,&amp;Name1,0,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00852     InitializeObjectAttributes(&amp;Object2Attributes,&amp;Name2,0,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00853 
00854     <span class="comment">//</span>
00855     <span class="comment">// Create timer 1.</span>
00856     <span class="comment">//</span>
00857 
00858     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCreateTimer(&amp;Handle1c, DesiredAccess, &amp;Object1Attributes);
00859     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00860         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - create timer 1 failed, status = %lx\n"</span>,
00861                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00862     }
00863 
00864     <span class="comment">//</span>
00865     <span class="comment">// Open timer 1.</span>
00866     <span class="comment">//</span>
00867 
00868     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenTimer(&amp;Handle1, DesiredAccess, &amp;Object1Attributes);
00869     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00870         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - open timer 1 failed, status = %lx\n"</span>,
00871                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00872     }
00873 
00874     <span class="comment">//</span>
00875     <span class="comment">// Query timer 1.</span>
00876     <span class="comment">//</span>
00877 
00878     TimerInformation.TimerState = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00879     Length = 0;
00880     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryTimer(Handle1, TimerBasicInformation,
00881                           (PVOID)&amp;TimerInformation,
00882                           <span class="keyword">sizeof</span>(TIMER_BASIC_INFORMATION), &amp;Length);
00883     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
00884         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - query timer 1 failed, status = %lx\n"</span>,
00885                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00886     }
00887     <span class="keywordflow">if</span> (TimerInformation.TimerState) {
00888         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - query timer 1 state wrong\n"</span>);
00889     }
00890     <span class="keywordflow">if</span> (Length != <span class="keyword">sizeof</span>(TIMER_BASIC_INFORMATION)) {
00891         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - query timer 1 return length wrong\n"</span>);
00892     }
00893 
00894     <span class="comment">//</span>
00895     <span class="comment">// Set timer 1 and then cancel timer 1.</span>
00896     <span class="comment">//</span>
00897 
00898     DueTime.LowPart = -100000;
00899     DueTime.HighPart = -1;
00900     PreviousState = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00901     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwSetTimer(Handle1, &amp;DueTime, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, &amp;PreviousState);
00902     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00903         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - set timer 1 failed, status = %lx\n"</span>,
00904                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00905     }
00906     <span class="keywordflow">if</span> (PreviousState) {
00907         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - set timer 1 previous state wrong\n"</span>);
00908     }
00909     CurrentState = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00910     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCancelTimer(Handle1, &amp;CurrentState);
00911     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00912         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - cancel timer 1 failed, status = %lx\n"</span>,
00913                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00914     }
00915     <span class="keywordflow">if</span> (CurrentState) {
00916         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - cancel timer 1 current state wrong\n"</span>);
00917     }
00918 
00919     <span class="comment">//</span>
00920     <span class="comment">// Set timer 1, wait for timer to expire, and then cancel timer 1.</span>
00921     <span class="comment">//</span>
00922 
00923     DueTime.LowPart = -5;
00924     DueTime.HighPart = -1;
00925     PreviousState = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00926     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwSetTimer(Handle1, &amp;DueTime, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, &amp;PreviousState);
00927     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00928         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - set timer 1 failed, status = %lx\n"</span>,
00929                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00930     }
00931     <span class="keywordflow">if</span> (PreviousState) {
00932         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - set timer 1 previous state wrong\n"</span>);
00933     }
00934     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwWaitForSingleObject(Handle1, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00935     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00936         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - wait timer 1 failed, status = %lx\n"</span>,
00937                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00938     }
00939     CurrentState = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00940     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCancelTimer(Handle1, &amp;CurrentState);
00941     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00942         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - cancel timer 1 failed, status = %lx\n"</span>,
00943                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00944     }
00945     <span class="keywordflow">if</span> (!CurrentState) {
00946         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - cancel timer 1 current state wrong\n"</span>);
00947     }
00948 
00949     <span class="comment">//</span>
00950     <span class="comment">// Set timer 1 with APC, then cancel timer 1.</span>
00951     <span class="comment">//</span>
00952 
00953     ApcHappened = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00954     DueTime.LowPart = -100000;
00955     DueTime.HighPart = -1;
00956     PreviousState = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00957     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwSetTimer(Handle1, &amp;DueTime, <a class="code" href="../../d4/d0/tex_8c.html#a29">TimerApcRoutine</a>, &amp;ApcHappened,
00958                         &amp;PreviousState);
00959     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00960         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - set timer 1 failed, status = %lx\n"</span>,
00961                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00962     }
00963     <span class="keywordflow">if</span> (!PreviousState) {
00964         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - set timer 1 previous state wrong\n"</span>);
00965     }
00966     CurrentState = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00967     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCancelTimer(Handle1, &amp;CurrentState);
00968     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00969         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - cancel timer 1 failed, status = %lx\n"</span>,
00970                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00971     }
00972     <span class="keywordflow">if</span> (CurrentState) {
00973         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - cancel timer 1 current state wrong\n"</span>);
00974     }
00975     <span class="keywordflow">if</span> (ApcHappened) {
00976         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - cancel timer 1 APC happened state wrong\n"</span>);
00977     }
00978 
00979     <span class="comment">//</span>
00980     <span class="comment">// Set timer 1 with APC, set timer again with APC, wait for timer, then</span>
00981     <span class="comment">// cancel timer 1.</span>
00982     <span class="comment">//</span>
00983 
00984     ApcHappened = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00985     DueTime.LowPart = -100000;
00986     DueTime.HighPart = -1;
00987     PreviousState = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00988     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwSetTimer(Handle1, &amp;DueTime, <a class="code" href="../../d4/d0/tex_8c.html#a29">TimerApcRoutine</a>, &amp;ApcHappened,
00989                         &amp;PreviousState);
00990     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
00991         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - set timer 1 failed, status = %lx\n"</span>,
00992                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00993     }
00994     <span class="keywordflow">if</span> (PreviousState) {
00995         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - set timer 1 previous state wrong\n"</span>);
00996     }
00997     DueTime.LowPart = -5;
00998     DueTime.HighPart = -1;
00999     PreviousState = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01000     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwSetTimer(Handle1, &amp;DueTime, <a class="code" href="../../d4/d0/tex_8c.html#a29">TimerApcRoutine</a>, &amp;ApcHappened,
01001                         &amp;PreviousState);
01002     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01003         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - set timer 1 failed, status = %lx\n"</span>,
01004                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01005     }
01006     <span class="keywordflow">if</span> (PreviousState) {
01007         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - set timer 1 previous state wrong\n"</span>);
01008     }
01009     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwWaitForSingleObject(Handle1, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01010     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01011         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - wait timer 1 failed, status = %lx\n"</span>,
01012                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01013     }
01014     CurrentState = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01015     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCancelTimer(Handle1, &amp;CurrentState);
01016     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01017         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - cancel timer 1 failed, status = %lx\n"</span>,
01018                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01019     }
01020     <span class="keywordflow">if</span> (!CurrentState) {
01021         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - cancel timer 1 current state wrong\n"</span>);
01022     }
01023     <span class="keywordflow">if</span> (!ApcHappened) {
01024         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - cancel timer 1 APC happened state wrong\n"</span>);
01025     }
01026 
01027     <span class="comment">//</span>
01028     <span class="comment">// Create timer 2.</span>
01029     <span class="comment">//</span>
01030 
01031     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCreateTimer(&amp;Handle2c, DesiredAccess, &amp;Object2Attributes);
01032     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
01033         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - create timer 2 failed, status = %lx\n"</span>,
01034                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01035     }
01036 
01037     <span class="comment">//</span>
01038     <span class="comment">// Open timer 2.</span>
01039     <span class="comment">//</span>
01040 
01041     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenTimer(&amp;Handle2, DesiredAccess, &amp;Object2Attributes);
01042     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
01043         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - open timer 2 failed, status = %lx\n"</span>,
01044                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01045     }
01046 
01047     <span class="comment">//</span>
01048     <span class="comment">// Query timer 2.</span>
01049     <span class="comment">//</span>
01050 
01051     TimerInformation.TimerState = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01052     Length = 0;
01053     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQueryTimer(Handle2, TimerBasicInformation,
01054                           (PVOID)&amp;TimerInformation,
01055                           <span class="keyword">sizeof</span>(TIMER_BASIC_INFORMATION), &amp;Length);
01056     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
01057         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - query timer 2 failed, status = %lx\n"</span>,
01058                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01059     }
01060     <span class="keywordflow">if</span> (TimerInformation.TimerState) {
01061         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - query timer 2 state wrong\n"</span>);
01062     }
01063     <span class="keywordflow">if</span> (Length != <span class="keyword">sizeof</span>(TIMER_BASIC_INFORMATION)) {
01064         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - query timer 2 return length wrong\n"</span>);
01065     }
01066 
01067     <span class="comment">//</span>
01068     <span class="comment">// Close all handles.</span>
01069     <span class="comment">//</span>
01070 
01071     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle1);
01072     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
01073         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - timer 1 close failed, status = %lx\n"</span>,
01074                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01075     }
01076     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle1c);
01077     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
01078         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - timer 1c close failed, status = %lx\n"</span>,
01079                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01080     }
01081     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle2);
01082     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
01083         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - timer 2 close failed, status = %lx\n"</span>,
01084                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01085     }
01086     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(Handle2c);
01087     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> &lt; 0) {
01088         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Timer test - timer 2c close failed, status = %lx\n"</span>,
01089                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01090     }
01091 
01092     <span class="comment">//</span>
01093     <span class="comment">// Announce end of timer test.</span>
01094     <span class="comment">//</span>
01095 
01096     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** End of Timer Test **\n"</span>);
01097     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01098 }
01099 
01100 BOOLEAN
<a name="l01101"></a><a class="code" href="../../d4/d0/tex_8c.html#a31">01101</a> <a class="code" href="../../d4/d0/tex_8c.html#a31">TestDupHandle1</a>(
01102     IN PVOID HandleTableEntry
01103     )
01104 {
01105     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Dupping %lx\n"</span>, HandleTableEntry );
01106     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01107 }
01108 
01109 BOOLEAN
<a name="l01110"></a><a class="code" href="../../d4/d0/tex_8c.html#a32">01110</a> <a class="code" href="../../d4/d0/tex_8c.html#a32">TestDupHandle4</a>(
01111     IN PVOID HandleTableEntry
01112     )
01113 {
01114     PULONG p = (PULONG)HandleTableEntry;
01115     ULONG i;
01116 
01117     <span class="keywordflow">if</span> (!((*p&gt;&gt;4) % 4)) {
01118         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01119         }
01120 
01121     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Dupping "</span> );
01122     <span class="keywordflow">for</span> (i=0; i&lt;4; i++) {
01123         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"  %lx"</span>, *p++ );
01124         }
01125     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"\n"</span> );
01126     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01127 }
01128 
01129 BOOLEAN
<a name="l01130"></a><a class="code" href="../../d4/d0/tex_8c.html#a33">01130</a> <a class="code" href="../../d4/d0/tex_8c.html#a33">TestEnumHandle1</a>(
01131     IN PVOID HandleTableEntry,
01132     IN PVOID EnumParameter
01133     )
01134 {
01135     <span class="keywordflow">if</span> (EnumParameter == HandleTableEntry) {
01136         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01137         }
01138     <span class="keywordflow">else</span> {
01139         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01140         }
01141 }
01142 
01143 BOOLEAN
<a name="l01144"></a><a class="code" href="../../d4/d0/tex_8c.html#a34">01144</a> <a class="code" href="../../d4/d0/tex_8c.html#a34">TestEnumHandle4</a>(
01145     IN PVOID HandleTableEntry,
01146     IN PVOID EnumParameter
01147     )
01148 {
01149     <span class="keywordflow">if</span> (EnumParameter == (PVOID)*(PULONG)HandleTableEntry) {
01150         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01151         }
01152     <span class="keywordflow">else</span> {
01153         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01154         }
01155 }
01156 
<a name="l01157"></a><a class="code" href="../../d4/d0/tex_8c.html#a1">01157</a> <span class="preprocessor">#define HANDLE_TEST_SIZE    30</span>
01158 <span class="preprocessor"></span>
01159 BOOLEAN
<a name="l01160"></a><a class="code" href="../../d4/d0/tex_8c.html#a35">01160</a> <a class="code" href="../../d4/d0/tex_8c.html#a35">DoHandleTest</a>( <span class="keywordtype">void</span> )
01161 {
01162     PVOID HandleTable1;
01163     PVOID HandleTable4;
01164     PVOID HandleTable1a;
01165     PVOID HandleTable4a;
01166     HANDLE HandlesForTable1[ <a class="code" href="../../d4/d0/tex_8c.html#a1">HANDLE_TEST_SIZE</a> ];
01167     HANDLE HandlesForTable4[ <a class="code" href="../../d4/d0/tex_8c.html#a1">HANDLE_TEST_SIZE</a> ];
01168     HANDLE h;
01169     PULONG HandleValue;
01170     BOOLEAN LockFlag;
01171     ULONG i, v[4];
01172 
01173     HandleTable1 = <a class="code" href="../../d5/d8/ex_8h.html#a290">ExCreateHandleTable</a>( (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>, MUTEX_LEVEL_PS_CID_TABLE, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01174     HandleTable4 = <a class="code" href="../../d5/d8/ex_8h.html#a290">ExCreateHandleTable</a>( (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 16<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>, 8<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>, 2<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>, MUTEX_LEVEL_OB_TABLE, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01175 
01176     ExDumpHandleTable( (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, HandleTable1, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01177     ExDumpHandleTable( (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, HandleTable4, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01178 
01179     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d4/d0/tex_8c.html#a1">HANDLE_TEST_SIZE</a>; i++) {
01180         v[0] = (i+1) &lt;&lt; 4;
01181         v[1] = (i+1) &lt;&lt; 3;
01182         v[2] = (i+1) &lt;&lt; 2;
01183         v[3] = (i+1) &lt;&lt; 1;
01184 
01185         HandlesForTable1[ i ] = <a class="code" href="../../d5/d8/ex_8h.html#a296">ExCreateHandle</a>( HandleTable1, (PVOID)(v[0]) );
01186         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"HandleTable1: %lx =&gt; %lx\n"</span>, HandlesForTable1[ i ], v[0] );
01187         HandlesForTable4[ i ] = <a class="code" href="../../d5/d8/ex_8h.html#a296">ExCreateHandle</a>( HandleTable4, (PVOID)(&amp;v[0]) );
01188         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"HandleTable4: %lx =&gt; %lx\n"</span>, HandlesForTable4[ i ], v[0] );
01189         }
01190 
01191     ExDumpHandleTable( HandleTable1, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01192     ExDumpHandleTable( HandleTable4, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01193 
01194     <span class="keywordflow">for</span> (i=0; i&lt;=<a class="code" href="../../d4/d0/tex_8c.html#a1">HANDLE_TEST_SIZE</a>; i++) {
01195         v[0] = (i+1) &lt;&lt; 4;
01196         v[1] = (i+1) &lt;&lt; 3;
01197         v[2] = (i+1) &lt;&lt; 2;
01198         v[3] = (i+1) &lt;&lt; 1;
01199 
01200         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/ex_8h.html#a293">ExEnumHandleTable</a>( HandleTable1, <a class="code" href="../../d4/d0/tex_8c.html#a33">TestEnumHandle1</a>, (PVOID)(v[0]), &amp;h )) {
01201             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"HandleTable1: Found: %lx &lt;= %lx\n"</span>, v[0], h );
01202             }
01203         <span class="keywordflow">else</span> {
01204             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"HandleTable1: %lx not found\n"</span>, v[0] );
01205             }
01206 
01207         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d8/ex_8h.html#a293">ExEnumHandleTable</a>( HandleTable4, <a class="code" href="../../d4/d0/tex_8c.html#a34">TestEnumHandle4</a>, (PVOID)(v[0]), &amp;h )) {
01208             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"HandleTable4: Found: %lx &lt;= %lx\n"</span>, v[0], h );
01209             }
01210         <span class="keywordflow">else</span> {
01211             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"HandleTable4: %lx not found\n"</span>, v[0] );
01212             }
01213         }
01214 
01215     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d4/d0/tex_8c.html#a1">HANDLE_TEST_SIZE</a>; i++) {
01216         LockFlag = <a class="code" href="../../d5/d8/ex_8h.html#a299">ExMapHandleToPointer</a>( HandleTable1,
01217                                          HandlesForTable1[ i ],
01218                                          (PVOID)&amp;HandleValue
01219                                        );
01220 
01221         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"HandleTable1: %lx =&gt; %lx\n"</span>,
01222                  HandlesForTable1[ i ], HandleValue
01223                );
01224         ExUnlockHandleTable( HandleTable1, LockFlag );
01225 
01226         LockFlag = <a class="code" href="../../d5/d8/ex_8h.html#a299">ExMapHandleToPointer</a>( HandleTable4,
01227                                          HandlesForTable4[ i ],
01228                                          (PVOID)&amp;HandleValue
01229                                        );
01230         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"HandleTable4: %lx =&gt; %lx\n"</span>,
01231                  HandlesForTable4[ i ], *HandleValue
01232                );
01233         ExUnlockHandleTable( HandleTable4, LockFlag );
01234         }
01235 
01236     HandleTable1a = <a class="code" href="../../d5/d8/ex_8h.html#a294">ExDupHandleTable</a>( (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, HandleTable1, <a class="code" href="../../d4/d0/tex_8c.html#a31">TestDupHandle1</a> );
01237     HandleTable4a = <a class="code" href="../../d5/d8/ex_8h.html#a294">ExDupHandleTable</a>( (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, HandleTable4, <a class="code" href="../../d4/d0/tex_8c.html#a32">TestDupHandle4</a> );
01238 
01239     ExDumpHandleTable( HandleTable1a, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01240     ExDumpHandleTable( HandleTable4a, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01241 
01242     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d4/d0/tex_8c.html#a1">HANDLE_TEST_SIZE</a>; i++) {
01243         <a class="code" href="../../d5/d8/ex_8h.html#a297">ExDestroyHandle</a>( HandleTable1, HandlesForTable1[ i ] );
01244         <a class="code" href="../../d5/d8/ex_8h.html#a297">ExDestroyHandle</a>( HandleTable4, HandlesForTable4[ i ] );
01245         }
01246 
01247     ExDumpHandleTable( HandleTable1, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01248     ExDumpHandleTable( HandleTable4, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01249 
01250     <a class="code" href="../../d5/d8/ex_8h.html#a292">ExDestroyHandleTable</a>( HandleTable1, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01251     <a class="code" href="../../d5/d8/ex_8h.html#a292">ExDestroyHandleTable</a>( HandleTable4, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01252 
01253     <a class="code" href="../../d5/d8/ex_8h.html#a292">ExDestroyHandleTable</a>( HandleTable1a, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01254     <a class="code" href="../../d5/d8/ex_8h.html#a292">ExDestroyHandleTable</a>( HandleTable4a, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01255 
01256     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01257 }
01258 
01259 BOOLEAN
<a name="l01260"></a><a class="code" href="../../d4/d0/tex_8c.html#a36">01260</a> <a class="code" href="../../d4/d0/tex_8c.html#a36">DoInfoTest</a>( <span class="keywordtype">void</span> )
01261 {
01262     BOOLEAN Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01263     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01264     SYSTEM_BASIC_INFORMATION BasicInfo;
01265     SYSTEM_PROCESSOR_INFORMATION ProcessorInfo;
01266     ULONG ReturnedLength;
01267 
01268     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** Start of System Information Test **\n"</span>);
01269     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwQuerySystemInformation( SystemBasicInformation,
01270                                        (PVOID)&amp;BasicInfo,
01271                                        <span class="keyword">sizeof</span>( BasicInfo ),
01272                                        &amp;ReturnedLength
01273                                      );
01274     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
01275         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQuerySystemInformation returns:\n"</span> );
01276         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    Number of Processors: %ld\n"</span>,
01277                  BasicInfo.NumberOfProcessors
01278                );
01279         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    OEM Machine Id: %lx\n"</span>,
01280                  BasicInfo.OemMachineId
01281                );
01282         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    Timer Resolution: %ld microseconds\n"</span>,
01283                  BasicInfo.TimerResolutionInMicroSeconds
01284                );
01285         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    Page Size: %ld   Allocation Granularity: %ld\n"</span>,
01286                  BasicInfo.PageSize,
01287                  BasicInfo.AllocationGranularity
01288                );
01289         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"    User Mode Address Range: 0x%08lx &lt;-&gt; 0x%08lx\n"</span>,
01290                  BasicInfo.MinimumUserModeAddress,
01291                  BasicInfo.MaximumUserModeAddress
01292                );
01293         }
01294     <span class="keywordflow">else</span> {
01295         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"NtQuerySystemInformation failed.  Status == %X\n"</span>,
01296                  <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>
01297                );
01298         }
01299 
01300     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** End of System Information Test **\n"</span>);
01301     <span class="keywordflow">return</span>( Result );
01302 }
01303 
01304 BOOLEAN
<a name="l01305"></a><a class="code" href="../../d4/d0/tex_8c.html#a37">01305</a> <a class="code" href="../../d4/d0/tex_8c.html#a37">DoLuidTest</a>( <span class="keywordtype">void</span> )
01306 {
01307     BOOLEAN Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01308     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01309 
01310     LUID FirstLuid;
01311     LUID SecondLuid;
01312 
01313     FirstLuid.LowPart = 0;
01314     FirstLuid.HighPart = 0;
01315 
01316     SecondLuid.LowPart = 0;
01317     SecondLuid.HighPart = 0;
01318 
01319     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** Start of Locally Unique ID Test **\n"</span>);
01320 
01321 
01322 
01323     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwAllocateLocallyUniqueId( &amp;FirstLuid );
01324 
01325     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
01326         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"First Luid Allocation Error.\n"</span> );
01327         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01328     }
01329 
01330     <span class="keywordflow">if</span> (LiLeqZero( FirstLuid )) {
01331         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"First Luid Allocation Failed - Bad Value.\n"</span> );
01332         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01333     }
01334 
01335 
01336 
01337     <span class="keywordflow">if</span> (Result) {
01338 
01339         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwAllocateLocallyUniqueId( &amp;SecondLuid );
01340 
01341         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
01342             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Second Luid Allocation Error.\n"</span> );
01343             Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01344         }
01345 
01346         <span class="keywordflow">if</span> (LiLeqZero( SecondLuid )) {
01347             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Second Luid Allocation Failed - Bad Value.\n"</span> );
01348             Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01349         }
01350 
01351         <span class="keywordflow">if</span> (LiLeq( FirstLuid, SecondLuid )) {
01352             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"Second Luid Allocation Failed - Not larger than first value.\n"</span> );
01353             Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01354         }
01355 
01356     }
01357 
01358 
01359     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** End of Locally Unique ID Test **\n"</span>);
01360     <span class="keywordflow">return</span>( Result );
01361 }
01362 
<a name="l01363"></a><a class="code" href="../../d4/d0/tex_8c.html#a17">01363</a> <span class="keywordtype">char</span> <a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>[ 128 ];
<a name="l01364"></a><a class="code" href="../../d4/d0/tex_8c.html#a18">01364</a> <span class="keywordtype">char</span> <a class="code" href="../../d4/d0/tex_8c.html#a18">TestString1</a>[] = <span class="stringliteral">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"</span>;
<a name="l01365"></a><a class="code" href="../../d4/d0/tex_8c.html#a19">01365</a> <span class="keywordtype">char</span> <a class="code" href="../../d4/d0/tex_8c.html#a19">TestString2</a>[] = <span class="stringliteral">"123456789012345678901234567890123456789012345678901234567890"</span>;
<a name="l01366"></a><a class="code" href="../../d4/d0/tex_8c.html#a20">01366</a> <span class="keywordtype">char</span> <a class="code" href="../../d4/d0/tex_8c.html#a20">MemoryTestBuffer2</a>[ 128 ];
01367 
01368 BOOLEAN
<a name="l01369"></a><a class="code" href="../../d4/d0/tex_8c.html#a38">01369</a> <a class="code" href="../../d4/d0/tex_8c.html#a38">DoMemoryTest</a>( <span class="keywordtype">void</span> )
01370 {
01371     LONG i,j,k;
01372     BOOLEAN Result;
01373 
01374     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** Start of Memory Test **\n"</span>);
01375 
01376     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01377     strcpy( <a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>, <a class="code" href="../../d4/d0/tex_8c.html#a18">TestString1</a> );
01378     <span class="keywordflow">for</span> (i=15; i&gt;=0; i--) {
01379         <a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>[16] = 0xFF;
01380         RtlZeroMemory( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>[i], 16-i );
01381         <span class="keywordflow">if</span> (strncmp( <a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>, <a class="code" href="../../d4/d0/tex_8c.html#a18">TestString1</a>, i ) || <a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>[i] || !<a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>[16]) {
01382             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"*** failed *** - RtlZeroMemory( %s, %ld )\n"</span>,
01383                      <a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>, 16-i );
01384             Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01385             }
01386         }
01387 
01388     <span class="keywordflow">for</span> (k = 0; k &lt; 8; k++) {
01389         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"k = %d, j = "</span>,k);
01390         <span class="keywordflow">for</span> (j = 0; j &lt; 8; j++) {
01391             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" %d "</span>,j);
01392             <span class="keywordflow">for</span> (i=0; i&lt;26; i++) {
01393                 RtlZeroMemory( <a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>, (ULONG)<span class="keyword">sizeof</span>( <a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a> ) );
01394                 RtlMoveMemory( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>[j], &amp;<a class="code" href="../../d4/d0/tex_8c.html#a19">TestString2</a>[k], i );
01395                 <span class="keywordflow">if</span> (strncmp( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>[j], &amp;<a class="code" href="../../d4/d0/tex_8c.html#a19">TestString2</a>[k], i ) || <a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>[j+i]) {
01396                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"*** failed *** - RtlMoveMemory( %s, %s, %ld )\n"</span>,
01397                              &amp;<a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>[j], <a class="code" href="../../d4/d0/tex_8c.html#a19">TestString2</a>, i );
01398                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01399                     }
01400                 }
01401             }
01402         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
01403         }
01404 
01405     <span class="keywordflow">for</span> (k = 0; k &lt; 8; k++) {
01406         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"k = %d, j = "</span>,k);
01407         <span class="keywordflow">for</span> (j = 0; j &lt; 8; j++) {
01408             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" %d "</span>,j);
01409             <span class="keywordflow">for</span> (i=0; i&lt;26; i++) {
01410                 RtlZeroMemory( <a class="code" href="../../d4/d0/tex_8c.html#a20">MemoryTestBuffer2</a>, (ULONG)<span class="keyword">sizeof</span>( <a class="code" href="../../d4/d0/tex_8c.html#a20">MemoryTestBuffer2</a> ) );
01411                 RtlMoveMemory( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a20">MemoryTestBuffer2</a>[j], &amp;<a class="code" href="../../d4/d0/tex_8c.html#a19">TestString2</a>[k], i );
01412                 <span class="keywordflow">if</span> (strncmp( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a20">MemoryTestBuffer2</a>[j], &amp;<a class="code" href="../../d4/d0/tex_8c.html#a19">TestString2</a>[k], i ) || <a class="code" href="../../d4/d0/tex_8c.html#a20">MemoryTestBuffer2</a>[j+i]) {
01413                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"*** failed *** - RtlMoveMemory( %s, %s, %ld )\n"</span>,
01414                              &amp;<a class="code" href="../../d4/d0/tex_8c.html#a20">MemoryTestBuffer2</a>[j], <a class="code" href="../../d4/d0/tex_8c.html#a19">TestString2</a>, i );
01415                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01416                     }
01417                 }
01418             }
01419         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
01420         }
01421 
01422     <span class="keywordflow">for</span> (k = 0; k &lt; 8; k++) {
01423         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"k = %d, j = "</span>,k);
01424         <span class="keywordflow">for</span> (j = 0; j &lt; 8; j++) {
01425             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" %d "</span>,j);
01426             <span class="keywordflow">for</span> (i=0; i&lt;26; i++) {
01427                 strcpy( <a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>, <a class="code" href="../../d4/d0/tex_8c.html#a18">TestString1</a> );
01428                 RtlMoveMemory( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>[j], &amp;<a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>[k], i );
01429                 <span class="keywordflow">if</span> (strncmp( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a17">MemoryTestBuffer1</a>[j], &amp;<a class="code" href="../../d4/d0/tex_8c.html#a18">TestString1</a>[k], i )) {
01430                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"*** failed *** - RtlMoveMemory( %s, %s, %ld )\n"</span>,
01431                              &amp;<a class="code" href="../../d4/d0/tex_8c.html#a20">MemoryTestBuffer2</a>[j], <a class="code" href="../../d4/d0/tex_8c.html#a19">TestString2</a>, i );
01432                     Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01433                     }
01434                 }
01435             }
01436         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
01437         }
01438 
01439     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** End of Memory Test **\n"</span>);
01440 
01441     <span class="keywordflow">return</span>( Result );
01442 }
01443 
01444 BOOLEAN
<a name="l01445"></a><a class="code" href="../../d4/d0/tex_8c.html#a39">01445</a> <a class="code" href="../../d4/d0/tex_8c.html#a39">DoPartyTest</a>( <span class="keywordtype">void</span> )
01446 {
01447     BOOLEAN Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01448     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01449     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
01450     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
01451 
01452     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** Start of Party By Number Test **\n"</span>);
01453 
01454     NtPartyByNumber( 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11 );
01455     InitializeObjectAttributes( &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01456     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwCreateEvent( &amp;<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>,
01457                             EVENT_ALL_ACCESS,
01458                             &amp;<a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>, NotificationEvent ,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01459     NtPartyByNumber( PARTY_DUMP_OBJECT_BY_HANDLE, <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01460     ZwClose( <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> );
01461     NtPartyByNumber( PARTY_DUMP_OBJECT_BY_HANDLE, <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> );
01462 
01463     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" ** End of Party By Number Test **\n"</span>);
01464     <span class="keywordflow">return</span>( Result );
01465 }
01466 
01467 BOOLEAN
<a name="l01468"></a><a class="code" href="../../d4/d0/tex_8c.html#a40">01468</a> <a class="code" href="../../d4/d0/tex_8c.html#a40">DoPoolTest</a>( <span class="keywordtype">void</span> )
01469 {
01470     PVOID p,p0,p1,p2,p3;
01471 
01472     p = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,4000<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01473     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 4000 byte Allocation"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01474     p = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,2000<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01475     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 2000 byte Allocation"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01476     p = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,2000<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01477     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 2000 byte Allocation"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01478 
01479     p0 = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,24<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01480     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 24 byte Allocation p0"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01481     p1 = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,24<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01482     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 24 byte Allocation p1"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01483     p2 = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,24<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01484     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 24 byte Allocation p2"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01485     p3 = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,24<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01486     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 24 byte Allocation p3"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01487 
01488     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(p1);
01489     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 24 byte Deallocation p1"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01490     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(p3);
01491     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 24 byte Deallocation p3"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01492     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(p2);
01493     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 24 byte Deallocation p2"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01494     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(p0);
01495     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 24 byte Deallocation p0"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01496 
01497     p0 = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,120<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01498     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 120 byte Allocation p0"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01499     p1 = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,24<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01500     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 24 byte Allocation p1"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01501     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(p1);
01502     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 24 byte Deallocation p1"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01503     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(p0);
01504     <a class="code" href="../../d4/d0/tex_8c.html#a0">DumpPool</a>(<span class="stringliteral">"After 120 byte Deallocation p0"</span>,<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>);
01505 
01506     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01507 }
01508 
01509 BOOLEAN
<a name="l01510"></a><a class="code" href="../../d4/d0/tex_8c.html#a41">01510</a> <a class="code" href="../../d4/d0/tex_8c.html#a41">DoZoneTest</a>( <span class="keywordtype">void</span> )
01511 {
01512     PULONG p1,p2;
01513     <a class="code" href="../../d0/d0/struct__ZONE__HEADER.html">PZONE_HEADER</a> z;
01514     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
01515     PVOID b1, b2, b3, b4, b5;
01516 
01517     z = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,(ULONG)<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d0/struct__ZONE__HEADER.html">ZONE_HEADER</a>));
01518     p1 = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,2048<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01519     p2 = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>,1024<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01520     st = <a class="code" href="../../d5/d8/ex_8h.html#a263">ExInitializeZone</a>(z,512<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>,p1,2048<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01521     ExDumpZone(z);
01522 
01523     b1 = <a class="code" href="../../d5/d8/ex_8h.html#a56">ExAllocateFromZone</a>(z);
01524     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"b1 = 0x%lx\n"</span>,b1);
01525     ExDumpZone(z);
01526 
01527     b2 = <a class="code" href="../../d5/d8/ex_8h.html#a56">ExAllocateFromZone</a>(z);
01528     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"b2 = 0x%lx\n"</span>,b2);
01529     ExDumpZone(z);
01530 
01531     b3 = <a class="code" href="../../d5/d8/ex_8h.html#a56">ExAllocateFromZone</a>(z);
01532     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"b3 = 0x%lx\n"</span>,b3);
01533     ExDumpZone(z);
01534 
01535     b4 = <a class="code" href="../../d5/d8/ex_8h.html#a56">ExAllocateFromZone</a>(z);
01536     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"b4 = 0x%lx\n"</span>,b4);
01537     ExDumpZone(z);
01538 
01539     b5 = <a class="code" href="../../d5/d8/ex_8h.html#a56">ExAllocateFromZone</a>(z);
01540     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"b5 = 0x%lx\n"</span>,b5);
01541     ExDumpZone(z);
01542 
01543     <a class="code" href="../../d5/d8/ex_8h.html#a57">ExFreeToZone</a>(z,b4);
01544     ExDumpZone(z);
01545 
01546     <a class="code" href="../../d5/d8/ex_8h.html#a57">ExFreeToZone</a>(z,b3);
01547     ExDumpZone(z);
01548 
01549     <a class="code" href="../../d5/d8/ex_8h.html#a57">ExFreeToZone</a>(z,b2);
01550     ExDumpZone(z);
01551 
01552     <a class="code" href="../../d5/d8/ex_8h.html#a57">ExFreeToZone</a>(z,b1);
01553     ExDumpZone(z);
01554 
01555     st = <a class="code" href="../../d5/d8/ex_8h.html#a264">ExExtendZone</a>(z,p2,1024<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
01556     ExDumpZone(z);
01557 
01558     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01559 }
01560 
<a name="l01561"></a><a class="code" href="../../d4/d0/tex_8c.html#a21">01561</a> <a class="code" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>;
<a name="l01562"></a><a class="code" href="../../d4/d0/tex_8c.html#a22">01562</a> ULONG <a class="code" href="../../d4/d0/tex_8c.html#a22">ResourceCount</a>;
<a name="l01563"></a><a class="code" href="../../d4/d0/tex_8c.html#a23">01563</a> <a class="code" href="../../d8/d7/struct__KSEMAPHORE.html">KSEMAPHORE</a> <a class="code" href="../../d4/d0/tex_8c.html#a23">ResourceSemaphore</a>;
01564 PVOID <a class="code" href="../../d4/d0/tex_8c.html#a42">ExDumpResource</a>( IN <a class="code" href="../../d6/d4/struct__ERESOURCE.html">PERESOURCE</a> Resource );
01565 
01566 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01567"></a><a class="code" href="../../d4/d0/tex_8c.html#a43">01567</a> <a class="code" href="../../d4/d0/tex_8c.html#a43">Reader</a> (
01568     IN PVOID StartContext
01569     )
01570 {
01571     LARGE_INTEGER <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>;
01572 
01573     <span class="comment">//KeSetPriorityThread( &amp;PsGetCurrentThread()-&gt;Tcb, 2 );</span>
01574 
01575     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Starting Reader %lx...\n"</span>, StartContext);
01576 
01577     <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>.LowPart = -(1+(ULONG)StartContext);
01578     <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>.HighPart = -1;
01579 
01580     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01581 
01582         (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d8/ex_8h.html#a69">ExAcquireResourceShared</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01583 
01584         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%lx with shared access\n"</span>, StartContext);
01585 
01586         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/tex_8c.html#a22">ResourceCount</a> &gt;= 10) {
01587             <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>);
01588             <span class="keywordflow">break</span>;
01589         }
01590 
01591         <a class="code" href="../../d1/d7/wait_8c.html#a2">KeDelayExecutionThread</a> ( <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, &amp;<a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>);
01592 
01593         <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>);
01594 
01595         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%lx released shared access\n"</span>, StartContext);
01596 
01597         <a class="code" href="../../d1/d7/wait_8c.html#a2">KeDelayExecutionThread</a> ( <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, &amp;<a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>);
01598     }
01599 
01600     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Reader %lx exiting\n"</span>, StartContext);
01601 
01602     <a class="code" href="../../d1/d6/semphobj_8c.html#a3">KeReleaseSemaphore</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a23">ResourceSemaphore</a>, 0, 1, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01603 }
01604 
01605 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01606"></a><a class="code" href="../../d4/d0/tex_8c.html#a44">01606</a> <a class="code" href="../../d4/d0/tex_8c.html#a44">Writer</a> (
01607     IN PVOID StartContext
01608     )
01609 {
01610     LARGE_INTEGER <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>;
01611 
01612     <span class="comment">//KeSetPriorityThread( &amp;PsGetCurrentThread()-&gt;Tcb, 3 );</span>
01613 
01614     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Starting Writer %lx...\n"</span>, StartContext);
01615 
01616     <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>.LowPart = -(1+(ULONG)StartContext);
01617     <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>.HighPart = -1;
01618 
01619     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01620 
01621         (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d8/ex_8h.html#a70">ExAcquireResourceExclusive</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01622 
01623         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%lx with Exclusive access\n"</span>, StartContext);
01624 
01625         <a class="code" href="../../d4/d0/tex_8c.html#a22">ResourceCount</a> += 1;
01626         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/tex_8c.html#a22">ResourceCount</a> &gt;= 10) {
01627             <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>);
01628             <span class="keywordflow">break</span>;
01629         }
01630 
01631         <a class="code" href="../../d1/d7/wait_8c.html#a2">KeDelayExecutionThread</a> ( <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, &amp;<a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>);
01632 
01633         <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>);
01634 
01635         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%lx released Exclusive access\n"</span>, StartContext);
01636 
01637         <a class="code" href="../../d1/d7/wait_8c.html#a2">KeDelayExecutionThread</a> ( <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, &amp;<a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>);
01638     }
01639 
01640     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Writer %lx exiting\n"</span>, StartContext);
01641 
01642     <a class="code" href="../../d1/d6/semphobj_8c.html#a3">KeReleaseSemaphore</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a23">ResourceSemaphore</a>, 0, 1, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01643 }
01644 
01645 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01646"></a><a class="code" href="../../d4/d0/tex_8c.html#a45">01646</a> <a class="code" href="../../d4/d0/tex_8c.html#a45">ReaderTurnedWriter</a> (
01647     IN PVOID StartContext
01648     )
01649 {
01650     LARGE_INTEGER <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>;
01651 
01652     <span class="comment">//KeSetPriorityThread( &amp;PsGetCurrentThread()-&gt;Tcb, 4 );</span>
01653 
01654     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Starting Reader turned Writer %lx\n"</span>, StartContext);
01655 
01656     <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>.LowPart = -(1+(ULONG)StartContext);
01657     <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>.HighPart = -1;
01658 
01659     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01660 
01661         (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d8/ex_8h.html#a69">ExAcquireResourceShared</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01662 
01663         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%lx with shared access\n"</span>, StartContext);
01664 
01665         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/tex_8c.html#a22">ResourceCount</a> &gt;= 10) {
01666             <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>);
01667             <span class="keywordflow">break</span>;
01668         }
01669 
01670         <a class="code" href="../../d1/d7/wait_8c.html#a2">KeDelayExecutionThread</a> ( <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, &amp;<a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>);
01671 
01672         ExConvertSharedToExclusive(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>);
01673 
01674         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%lx Shared turned Exclusive access\n"</span>, StartContext);
01675 
01676         <a class="code" href="../../d4/d0/tex_8c.html#a22">ResourceCount</a> += 1;
01677         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/tex_8c.html#a22">ResourceCount</a> &gt;= 10) {
01678             <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>);
01679             <span class="keywordflow">break</span>;
01680         }
01681 
01682         <a class="code" href="../../d1/d7/wait_8c.html#a2">KeDelayExecutionThread</a> ( <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, &amp;<a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>);
01683 
01684         <a class="code" href="../../d5/d8/ex_8h.html#a72">ExConvertExclusiveToShared</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>);
01685 
01686         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%lx Exclusive turned Shared access\n"</span>, StartContext);
01687 
01688         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d0/tex_8c.html#a22">ResourceCount</a> &gt;= 10) {
01689             <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>);
01690             <span class="keywordflow">break</span>;
01691         }
01692 
01693         <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>);
01694 
01695         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%lx release Shared access\n"</span>, StartContext);
01696 
01697         <a class="code" href="../../d1/d7/wait_8c.html#a2">KeDelayExecutionThread</a> ( <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, &amp;<a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>);
01698     }
01699 
01700     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Reader turned Writer %lx exiting\n"</span>, StartContext);
01701 
01702     <a class="code" href="../../d1/d6/semphobj_8c.html#a3">KeReleaseSemaphore</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a23">ResourceSemaphore</a>, 0, 1, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01703 }
01704 
01705 BOOLEAN
<a name="l01706"></a><a class="code" href="../../d4/d0/tex_8c.html#a46">01706</a> <a class="code" href="../../d4/d0/tex_8c.html#a46">DoResourceTest</a>( <span class="keywordtype">void</span> )
01707 {
01708     HANDLE Handles[32];
01709     ULONG i;
01710 
01711     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Start DoResourceTest...\n"</span>);
01712 
01713     <a class="code" href="../../d5/d8/ex_8h.html#a68">ExInitializeResource</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>);
01714     <a class="code" href="../../d4/d0/tex_8c.html#a22">ResourceCount</a> = 0;
01715 
01716     <a class="code" href="../../d1/d6/semphobj_8c.html#a1">KeInitializeSemaphore</a>(&amp;<a class="code" href="../../d4/d0/tex_8c.html#a23">ResourceSemaphore</a>, 0, MAXLONG);
01717 
01718     <span class="keywordflow">for</span> (i = 0; i &lt; 4; i += 1) {
01719 
01720         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d2/d8/ps_2create_8c.html#a11">PsCreateSystemThread</a>(&amp;Handles[i],
01721                                           0,
01722                                           <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01723                                           0,
01724                                           <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01725                                           <a class="code" href="../../d4/d0/tex_8c.html#a43">Reader</a>,
01726                                           (PVOID)i))) {
01727 
01728             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Create system thread error %8lx\n"</span>, i);
01729         }
01730 
01731     }
01732 
01733     <span class="keywordflow">for</span> (i = 4; i &lt; 6; i += 1) {
01734 
01735         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d2/d8/ps_2create_8c.html#a11">PsCreateSystemThread</a>(&amp;Handles[i],
01736                                           0,
01737                                           <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01738                                           0,
01739                                           <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01740                                           <a class="code" href="../../d4/d0/tex_8c.html#a44">Writer</a>,
01741                                           (PVOID)i))) {
01742 
01743             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Create system thread error %8lx\n"</span>, i);
01744         }
01745 
01746     }
01747 
01748     <span class="keywordflow">for</span> (i = 6; i &lt; 8; i += 1) {
01749 
01750         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d2/d8/ps_2create_8c.html#a11">PsCreateSystemThread</a>(&amp;Handles[i],
01751                                           0,
01752                                           <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01753                                           0,
01754                                           <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01755                                           <a class="code" href="../../d4/d0/tex_8c.html#a45">ReaderTurnedWriter</a>,
01756                                           (PVOID)i))) {
01757 
01758             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Create system thread error %8lx\n"</span>, i);
01759         }
01760 
01761     }
01762 
01763     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DoResourceTest wait for everyone to complete...\n"</span>);
01764 
01765     <span class="keywordflow">for</span> (i = 0; i &lt; 8; i += 1) {
01766 
01767         <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>( &amp;<a class="code" href="../../d4/d0/tex_8c.html#a23">ResourceSemaphore</a>,
01768                                <a class="code" href="../../d6/d7/halmips_8h.html#a455">Executive</a>,
01769                                <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>,
01770                                <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
01771                                <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01772 
01773     }
01774 
01775     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DoResourceTest Done\n"</span>);
01776 
01777     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01778 }
01779 
01780 BOOLEAN
<a name="l01781"></a><a class="code" href="../../d4/d0/tex_8c.html#a47">01781</a> <a class="code" href="../../d4/d0/tex_8c.html#a47">DoBitMapTest</a>( <span class="keywordtype">void</span> )
01782 {
01783     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
01784     PRTL_BITMAP <a class="code" href="../../d2/d1/structBitMap.html">BitMap</a>;
01785 
01786     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Start DoBitMapTest...\n"</span>);
01787 
01788     <span class="comment">//</span>
01789     <span class="comment">//  First create a new bitmap</span>
01790     <span class="comment">//</span>
01791 
01792     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = <span class="keyword">sizeof</span>(RTL_BITMAP) + (((2048*8 + 31) / 32) * 4);
01793     <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a> = (PRTL_BITMAP)(<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> ));
01794     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a26">RtlInitializeBitMap</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, (PULONG)(<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>+1), 2048*8 );
01795 
01796     <span class="comment">//</span>
01797     <span class="comment">//  &gt;&gt;&gt;&gt; Test setting bits</span>
01798     <span class="comment">//</span>
01799 
01800     <span class="comment">//</span>
01801     <span class="comment">//  Now clear all bits</span>
01802     <span class="comment">//</span>
01803 
01804     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a27">RtlClearAllBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a> );
01805 
01806     <span class="comment">//</span>
01807     <span class="comment">//  Now set some bit patterns, and test them</span>
01808     <span class="comment">//</span>
01809 
01810     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>,   0,  1 );
01811     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>,  63,  1 );
01812     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>,  65, 30 );
01813     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 127,  2 );
01814     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 191, 34 );
01815 
01816     <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[0] != 0x00000001) ||
01817         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[1] != 0x80000000) ||
01818         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[2] != 0x7ffffffe) ||
01819         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[3] != 0x80000000) ||
01820         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[4] != 0x00000001) ||
01821         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[5] != 0x80000000) ||
01822         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[6] != 0xffffffff) ||
01823         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[7] != 0x00000001)) {
01824 
01825         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlSetBits Error\n"</span>);
01826         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01827     }
01828 
01829     <span class="comment">//</span>
01830     <span class="comment">//  Now test some RtlFindClearBitsAndSet</span>
01831     <span class="comment">//</span>
01832 
01833     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a28">RtlSetAllBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a> );
01834 
01835     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 +  10*32,  1 );
01836     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 5 +  11*32,  1 );
01837     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 7 +  12*32,  1 );
01838 
01839     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 +  13*32,  9 );
01840     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 4 +  14*32,  9 );
01841     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 7 +  15*32,  9 );
01842 
01843     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 +  16*32, 10 );
01844     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 4 +  17*32, 10 );
01845     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 6 +  18*32, 10 );
01846     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 7 +  19*32, 10 );
01847 
01848     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 + 110*32, 14 );
01849     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1 + 111*32, 14 );
01850     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 2 + 112*32, 14 );
01851 
01852     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 + 113*32, 15 );
01853     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1 + 114*32, 15 );
01854     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 2 + 115*32, 15 );
01855 
01856 <span class="comment">//    {</span>
01857 <span class="comment">//        ULONG i;</span>
01858 <span class="comment">//        for (i = 0; i &lt; 16; i++) {</span>
01859 <span class="comment">//            DbgPrint("%2d: %08lx\n", i, BitMap-&gt;Buffer[i]);</span>
01860 <span class="comment">//        }</span>
01861 <span class="comment">//    }</span>
01862 
01863     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 15, 0) != 0 + 113*32) {
01864         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  0 + 113*32\n"</span>);
01865         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01866     }
01867     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 15, 0) != 1 + 114*32) {
01868         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  1 + 114*32\n"</span>);
01869         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01870     }
01871     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 15, 0) != 2 + 115*32) {
01872         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  2 + 115*32\n"</span>);
01873         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01874     }
01875 
01876     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 14, 0) != 0 + 110*32) {
01877         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  0 + 110*32\n"</span>);
01878         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01879     }
01880     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 14, 0) != 1 + 111*32) {
01881         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  1 + 111*32\n"</span>);
01882         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01883     }
01884     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 14, 0) != 2 + 112*32) {
01885         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  2 + 112*32\n"</span>);
01886         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01887     }
01888 
01889     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 10, 0) != 0 + 16*32) {
01890         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  0 + 16*32\n"</span>);
01891         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01892     }
01893     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 10, 0) != 4 + 17*32) {
01894         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  4 + 17*32\n"</span>);
01895         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01896     }
01897     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 10, 0) != 6 + 18*32) {
01898         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  6 + 18*32\n"</span>);
01899         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01900     }
01901     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 10, 0) != 7 + 19*32) {
01902         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  7 + 19*32\n"</span>);
01903         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01904     }
01905 
01906     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 9, 0) != 0 + 13*32) {
01907         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error 0 + 13*32\n"</span>);
01908         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01909     }
01910     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 9, 0) != 4 + 14*32) {
01911         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error 4 + 14*32\n"</span>);
01912         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01913     }
01914     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 9, 0) != 7 + 15*32) {
01915         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error 7 + 15*32\n"</span>);
01916         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01917     }
01918 
01919     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1, 0) != 0 + 10*32) {
01920         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error 0 + 10*32\n"</span>);
01921         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01922     }
01923     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1, 0) != 5 + 11*32) {
01924         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error 5 + 11*32\n"</span>);
01925         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01926     }
01927     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1, 0) != 7 + 12*32) {
01928         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error 7 + 12*32\n"</span>);
01929         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01930     }
01931 
01932     <span class="comment">//</span>
01933     <span class="comment">//  Now test some RtlFindClearBitsAndSet</span>
01934     <span class="comment">//</span>
01935 
01936     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a28">RtlSetAllBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a> );
01937 
01938     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 +  0*32,  1 );
01939     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 5 +  1*32,  1 );
01940     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 7 +  2*32,  1 );
01941 
01942     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 +  3*32,  9 );
01943     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 4 +  4*32,  9 );
01944     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 7 +  5*32,  9 );
01945 
01946     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 +  6*32, 10 );
01947     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 4 +  7*32, 10 );
01948     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 6 +  8*32, 10 );
01949     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 7 +  9*32, 10 );
01950 
01951     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 + 10*32, 14 );
01952     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1 + 11*32, 14 );
01953     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 2 + 12*32, 14 );
01954 
01955     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 + 13*32, 15 );
01956     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1 + 14*32, 15 );
01957     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 2 + 15*32, 15 );
01958 
01959 <span class="comment">//    {</span>
01960 <span class="comment">//        ULONG i;</span>
01961 <span class="comment">//        for (i = 0; i &lt; 16; i++) {</span>
01962 <span class="comment">//            DbgPrint("%2d: %08lx\n", i, BitMap-&gt;Buffer[i]);</span>
01963 <span class="comment">//        }</span>
01964 <span class="comment">//    }</span>
01965 
01966     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 15, 0) != 0 + 13*32) {
01967         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  0 + 13*32\n"</span>);
01968         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01969     }
01970     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 15, 0) != 1 + 14*32) {
01971         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  1 + 14*32\n"</span>);
01972         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01973     }
01974     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 15, 0) != 2 + 15*32) {
01975         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  2 + 15*32\n"</span>);
01976         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01977     }
01978 
01979     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 14, 0) != 0 + 10*32) {
01980         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  0 + 10*32\n"</span>);
01981         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01982     }
01983     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 14, 0) != 1 + 11*32) {
01984         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  1 + 11*32\n"</span>);
01985         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01986     }
01987     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 14, 0) != 2 + 12*32) {
01988         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  2 + 12*32\n"</span>);
01989         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01990     }
01991 
01992     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 10, 0) != 0 + 6*32) {
01993         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  0 + 6*32\n"</span>);
01994         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01995     }
01996     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 10, 0) != 4 + 7*32) {
01997         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  4 + 7*32\n"</span>);
01998         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01999     }
02000     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 10, 0) != 6 + 8*32) {
02001         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  6 + 8*32\n"</span>);
02002         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02003     }
02004     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 10, 0) != 7 + 9*32) {
02005         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error  7 + 9*32\n"</span>);
02006         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02007     }
02008 
02009     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 9, 0) != 0 + 3*32) {
02010         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error 0 + 3*32\n"</span>);
02011         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02012     }
02013     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 9, 0) != 4 + 4*32) {
02014         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error 4 + 4*32\n"</span>);
02015         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02016     }
02017     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 9, 0) != 7 + 5*32) {
02018         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error 7 + 5*32\n"</span>);
02019         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02020     }
02021 
02022     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1, 0) != 0 + 0*32) {
02023         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error 0 + 0*32\n"</span>);
02024         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02025     }
02026     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1, 0) != 5 + 1*32) {
02027         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error 5 + 1*32\n"</span>);
02028         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02029     }
02030     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a31">RtlFindClearBitsAndSet</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1, 0) != 7 + 2*32) {
02031         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindClearBitsAndSet Error 7 + 2*32\n"</span>);
02032         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02033     }
02034 
02035     <span class="comment">//</span>
02036     <span class="comment">//  &gt;&gt;&gt;&gt; Test clearing bits</span>
02037     <span class="comment">//</span>
02038 
02039     <span class="comment">//</span>
02040     <span class="comment">//  Now clear all bits</span>
02041     <span class="comment">//</span>
02042 
02043     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a28">RtlSetAllBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a> );
02044 
02045     <span class="comment">//</span>
02046     <span class="comment">//  Now set some bit patterns, and test them</span>
02047     <span class="comment">//</span>
02048 
02049     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>,   0,  1 );
02050     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>,  63,  1 );
02051     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>,  65, 30 );
02052     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 127,  2 );
02053     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a33">RtlClearBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 191, 34 );
02054 
02055     <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[0] != ~0x00000001) ||
02056         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[1] != ~0x80000000) ||
02057         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[2] != ~0x7ffffffe) ||
02058         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[3] != ~0x80000000) ||
02059         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[4] != ~0x00000001) ||
02060         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[5] != ~0x80000000) ||
02061         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[6] != ~0xffffffff) ||
02062         (<a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[7] != ~0x00000001)) {
02063 
02064         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlClearBits Error\n"</span>);
02065         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02066     }
02067 
02068     <span class="comment">//</span>
02069     <span class="comment">//  Now test some RtlFindSetBitsAndClear</span>
02070     <span class="comment">//</span>
02071 
02072     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a27">RtlClearAllBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a> );
02073 
02074     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 +  0*32,  1 );
02075     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 5 +  1*32,  1 );
02076     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 7 +  2*32,  1 );
02077 
02078     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 +  3*32,  9 );
02079     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 4 +  4*32,  9 );
02080     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 7 +  5*32,  9 );
02081 
02082     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 +  6*32, 10 );
02083     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 4 +  7*32, 10 );
02084     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 6 +  8*32, 10 );
02085     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 7 +  9*32, 10 );
02086 
02087     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 + 10*32, 14 );
02088     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1 + 11*32, 14 );
02089     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 2 + 12*32, 14 );
02090 
02091     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 0 + 13*32, 15 );
02092     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1 + 14*32, 15 );
02093     <a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a34">RtlSetBits</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 2 + 15*32, 15 );
02094 
02095     {
02096         ULONG i;
02097         <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++) {
02098             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%2d: %08lx\n"</span>, i, <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>-&gt;Buffer[i]);
02099         }
02100     }
02101 
02102     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 15, 0) != 0 + 13*32) {
02103         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error  0 + 13*32\n"</span>);
02104         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02105     }
02106     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 15, 0) != 1 + 14*32) {
02107         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error  1 + 14*32\n"</span>);
02108         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02109     }
02110     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 15, 0) != 2 + 15*32) {
02111         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error  2 + 15*32\n"</span>);
02112         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02113     }
02114 
02115     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 14, 0) != 0 + 10*32) {
02116         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error  0 + 10*32\n"</span>);
02117         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02118     }
02119     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 14, 0) != 1 + 11*32) {
02120         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error  1 + 11*32\n"</span>);
02121         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02122     }
02123     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 14, 0) != 2 + 12*32) {
02124         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error  2 + 12*32\n"</span>);
02125         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02126     }
02127 
02128     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 10, 0) != 0 + 6*32) {
02129         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error  0 + 6*32\n"</span>);
02130         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02131     }
02132     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 10, 0) != 4 + 7*32) {
02133         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error  4 + 7*32\n"</span>);
02134         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02135     }
02136     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 10, 0) != 6 + 8*32) {
02137         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error  6 + 8*32\n"</span>);
02138         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02139     }
02140     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 10, 0) != 7 + 9*32) {
02141         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error  7 + 9*32\n"</span>);
02142         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02143     }
02144 
02145     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 9, 0) != 0 + 3*32) {
02146         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error 0 + 3*32\n"</span>);
02147         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02148     }
02149     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 9, 0) != 4 + 4*32) {
02150         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error 4 + 4*32\n"</span>);
02151         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02152     }
02153     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 9, 0) != 7 + 5*32) {
02154         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error 7 + 5*32\n"</span>);
02155         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02156     }
02157 
02158     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1, 0) != 0 + 0*32) {
02159         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error 0 + 0*32\n"</span>);
02160         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02161     }
02162     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1, 0) != 5 + 1*32) {
02163         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error 5 + 1*32\n"</span>);
02164         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02165     }
02166     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/rtl_2bitmap_8c.html#a32">RtlFindSetBitsAndClear</a>( <a class="code" href="../../d8/d9/tbitmap_8c.html#a2">BitMap</a>, 1, 0) != 7 + 2*32) {
02167         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"RtlFindSetBitsAndClear Error 7 + 2*32\n"</span>);
02168         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02169     }
02170 
02171     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DoBitMapTest Done.\n"</span>);
02172 
02173     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02174 }
02175 
02176 BOOLEAN
<a name="l02177"></a><a class="code" href="../../d4/d0/tex_8c.html#a24">02177</a> <a class="code" href="../../d4/d0/tex_8c.html#a24">ExTest</a> (
02178     VOID
02179     )
02180 
02181 {
02182 
02183     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> i;
02184 
02185     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"In extest\n"</span> );
02186     <span class="keywordflow">for</span> (i=1; i&lt;16; i++) {
02187         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a3">TestEvent</a>)
02188             <a class="code" href="../../d4/d0/tex_8c.html#a25">DoEventTest</a>();
02189         <span class="keywordflow">else</span>
02190         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a4">TestHandle</a>)
02191             <a class="code" href="../../d4/d0/tex_8c.html#a35">DoHandleTest</a>();
02192         <span class="keywordflow">else</span>
02193         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a5">TestInfo</a>)
02194             <a class="code" href="../../d4/d0/tex_8c.html#a36">DoInfoTest</a>();
02195         <span class="keywordflow">else</span>
02196         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a6">TestLuid</a>) {
02197             <a class="code" href="../../d4/d0/tex_8c.html#a37">DoLuidTest</a>();
02198             }
02199         <span class="keywordflow">else</span>
02200         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a7">TestMemory</a>) {
02201             <a class="code" href="../../d4/d0/tex_8c.html#a38">DoMemoryTest</a>();
02202             }
02203         <span class="keywordflow">else</span>
02204         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a8">TestParty</a>)
02205             <a class="code" href="../../d4/d0/tex_8c.html#a39">DoPartyTest</a>();
02206         <span class="keywordflow">else</span>
02207         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a9">TestPool</a>)
02208             <a class="code" href="../../d4/d0/tex_8c.html#a40">DoPoolTest</a>();
02209         <span class="keywordflow">else</span>
02210         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a10">TestResource</a>)
02211             <a class="code" href="../../d4/d0/tex_8c.html#a46">DoResourceTest</a>();
02212         <span class="keywordflow">else</span>
02213         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a11">TestBitMap</a>)
02214             <a class="code" href="../../d4/d0/tex_8c.html#a47">DoBitMapTest</a>();
02215         <span class="keywordflow">else</span>
02216         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a12">TestSemaphore</a>)
02217             <a class="code" href="../../d4/d0/tex_8c.html#a28">DoSemaphoreTest</a>();
02218         <span class="keywordflow">else</span>
02219         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a13">TestTimer</a>)
02220             <a class="code" href="../../d4/d0/tex_8c.html#a30">DoTimerTest</a>();
02221         <span class="keywordflow">else</span>
02222         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a14">TestZone</a>)
02223             <a class="code" href="../../d4/d0/tex_8c.html#a41">DoZoneTest</a>();
02224         <span class="keywordflow">else</span>
02225         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a15">TestMutant</a>)
02226             <a class="code" href="../../d4/d0/tex_8c.html#a27">DoMutantTest</a>();
02227         <span class="keywordflow">else</span>
02228         <span class="keywordflow">if</span> (i == <a class="code" href="../../d4/d0/tex_8c.html#a16">TestException</a>)
02229             <a class="code" href="../../d4/d0/tex_8c.html#a26">DoExceptionTest</a>();
02230         }
02231 
02232     <a class="code" href="../../d4/d0/tex_8c.html#a2">TestFunction</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;    <span class="comment">// Invoke the CLI</span>
02233     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02234 }
02235 <span class="preprocessor">#ifndef MIPS</span>
02236 <span class="preprocessor"></span>
02237 <span class="keywordtype">int</span>
02238 _CDECL
<a name="l02239"></a><a class="code" href="../../d4/d0/tex_8c.html#a48">02239</a> <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>(
02240     <span class="keywordtype">int</span> argc,
02241     <span class="keywordtype">char</span> *argv[]
02242     )
02243 {
02244 <span class="preprocessor">#ifdef SIMULATOR</span>
02245 <span class="preprocessor"></span>    <span class="keywordtype">char</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>, *s;
02246     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> i;
02247 
02248     i = 1;
02249     <span class="keywordflow">if</span> (argc &gt; 1 ) {
02250         <span class="keywordflow">while</span> (--argc) {
02251             s = *++argv;
02252             <span class="keywordflow">while</span> ((<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = *s++) != <span class="charliteral">'\0'</span>) {
02253                 <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>) {
02254                 <span class="keywordflow">case</span> <span class="charliteral">'B'</span>:
02255                 <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:
02256                     <a class="code" href="../../d4/d0/tex_8c.html#a11">TestBitMap</a> = i++;
02257                     <span class="keywordflow">break</span>;
02258 
02259                 <span class="keywordflow">case</span> <span class="charliteral">'C'</span>:
02260                 <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
02261                     <a class="code" href="../../d4/d0/tex_8c.html#a16">TestException</a> = i++;
02262                     <span class="keywordflow">break</span>;
02263 
02264                 <span class="keywordflow">case</span> <span class="charliteral">'E'</span>:
02265                 <span class="keywordflow">case</span> <span class="charliteral">'e'</span>:
02266                     <a class="code" href="../../d4/d0/tex_8c.html#a3">TestEvent</a> = i++;
02267                     <span class="keywordflow">break</span>;
02268 
02269                 <span class="keywordflow">case</span> <span class="charliteral">'H'</span>:
02270                 <span class="keywordflow">case</span> <span class="charliteral">'h'</span>:
02271                     <a class="code" href="../../d4/d0/tex_8c.html#a4">TestHandle</a> = i++;
02272                     <span class="keywordflow">break</span>;
02273 
02274                 <span class="keywordflow">case</span> <span class="charliteral">'I'</span>:
02275                 <span class="keywordflow">case</span> <span class="charliteral">'i'</span>:
02276                     <a class="code" href="../../d4/d0/tex_8c.html#a5">TestInfo</a> = i++;
02277                     <span class="keywordflow">break</span>;
02278 
02279                 <span class="keywordflow">case</span> <span class="charliteral">'L'</span>:
02280                 <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
02281                     <a class="code" href="../../d4/d0/tex_8c.html#a6">TestLuid</a> = i++;
02282                     <span class="keywordflow">break</span>;
02283 
02284                 <span class="keywordflow">case</span> <span class="charliteral">'M'</span>:
02285                 <span class="keywordflow">case</span> <span class="charliteral">'m'</span>:
02286                     <a class="code" href="../../d4/d0/tex_8c.html#a7">TestMemory</a> = i++;
02287                     <span class="keywordflow">break</span>;
02288 
02289                 <span class="keywordflow">case</span> <span class="charliteral">'P'</span>:
02290                 <span class="keywordflow">case</span> <span class="charliteral">'p'</span>:
02291                     <a class="code" href="../../d4/d0/tex_8c.html#a9">TestPool</a> = i++;
02292                     <span class="keywordflow">break</span>;
02293 
02294                 <span class="keywordflow">case</span> <span class="charliteral">'R'</span>:
02295                 <span class="keywordflow">case</span> <span class="charliteral">'r'</span>:
02296                     <a class="code" href="../../d4/d0/tex_8c.html#a10">TestResource</a> = i++;
02297                     <span class="keywordflow">break</span>;
02298 
02299                 <span class="keywordflow">case</span> <span class="charliteral">'S'</span>:
02300                 <span class="keywordflow">case</span> <span class="charliteral">'s'</span>:
02301                     <a class="code" href="../../d4/d0/tex_8c.html#a12">TestSemaphore</a> = i++;
02302                     <span class="keywordflow">break</span>;
02303 
02304                 <span class="keywordflow">case</span> <span class="charliteral">'T'</span>:
02305                 <span class="keywordflow">case</span> <span class="charliteral">'t'</span>:
02306                     <a class="code" href="../../d4/d0/tex_8c.html#a13">TestTimer</a> = i++;
02307                     <span class="keywordflow">break</span>;
02308 
02309                 <span class="keywordflow">case</span> <span class="charliteral">'X'</span>:
02310                 <span class="keywordflow">case</span> <span class="charliteral">'x'</span>:
02311                     <a class="code" href="../../d4/d0/tex_8c.html#a15">TestMutant</a> = i++;
02312                     <span class="keywordflow">break</span>;
02313 
02314                 <span class="keywordflow">case</span> <span class="charliteral">'Z'</span>:
02315                 <span class="keywordflow">case</span> <span class="charliteral">'z'</span>:
02316                     <a class="code" href="../../d4/d0/tex_8c.html#a14">TestZone</a> = i++;
02317                     <span class="keywordflow">break</span>;
02318 
02319                 <span class="keywordflow">default</span>:
02320                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"tex: invalid test code - '%s'"</span>, *argv );
02321                     <span class="keywordflow">break</span>;
02322                 }
02323             }
02324         }
02325     } <span class="keywordflow">else</span> {
02326         <span class="keywordflow">if</span> (!strcmp( <span class="stringliteral">"DAVEC"</span>, szVerUser )) {
02327             <a class="code" href="../../d4/d0/tex_8c.html#a3">TestEvent</a> = 1;
02328             <a class="code" href="../../d4/d0/tex_8c.html#a12">TestSemaphore</a> = 2;
02329             <a class="code" href="../../d4/d0/tex_8c.html#a13">TestTimer</a> = 3;
02330             <a class="code" href="../../d4/d0/tex_8c.html#a15">TestMutant</a> = 4;
02331             <a class="code" href="../../d4/d0/tex_8c.html#a16">TestException</a> = 5;
02332         }
02333         <span class="keywordflow">else</span>
02334         <span class="keywordflow">if</span> (!strcmp( <span class="stringliteral">"MARKL"</span>, szVerUser )) {
02335             <a class="code" href="../../d4/d0/tex_8c.html#a9">TestPool</a> = 1;
02336             <a class="code" href="../../d4/d0/tex_8c.html#a14">TestZone</a> = 2;
02337         }
02338         <span class="keywordflow">else</span>
02339         <span class="keywordflow">if</span> (!strcmp( <span class="stringliteral">"STEVEWO"</span>, szVerUser )) {
02340             <a class="code" href="../../d4/d0/tex_8c.html#a5">TestInfo</a> = 1;
02341             <a class="code" href="../../d4/d0/tex_8c.html#a8">TestParty</a> = 2;
02342             <a class="code" href="../../d4/d0/tex_8c.html#a7">TestMemory</a> = 3;
02343             <a class="code" href="../../d4/d0/tex_8c.html#a4">TestHandle</a> = 4;
02344         }
02345         <span class="keywordflow">else</span>
02346         <span class="keywordflow">if</span> (!strcmp( <span class="stringliteral">"GARYKI"</span>, szVerUser )) {
02347             <a class="code" href="../../d4/d0/tex_8c.html#a10">TestResource</a> = 1;
02348             <a class="code" href="../../d4/d0/tex_8c.html#a7">TestMemory</a> = 2;
02349             <a class="code" href="../../d4/d0/tex_8c.html#a11">TestBitMap</a> = 3;
02350         }
02351         <span class="keywordflow">else</span>
02352         <span class="keywordflow">if</span> (!strcmp( <span class="stringliteral">"JIMK"</span>, szVerUser )) {
02353             <a class="code" href="../../d4/d0/tex_8c.html#a6">TestLuid</a> = 1;
02354         }
02355         <span class="keywordflow">else</span> {
02356             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"*** Warning *** - %s is an unauthorized user of tex\n"</span>,
02357                      szVerUser
02358                    );
02359         }
02360     }
02361 <span class="preprocessor">#else</span>
02362 <span class="preprocessor"></span>    <a class="code" href="../../d4/d0/tex_8c.html#a3">TestEvent</a> = 1;
02363     <a class="code" href="../../d4/d0/tex_8c.html#a12">TestSemaphore</a> = 2;
02364     <a class="code" href="../../d4/d0/tex_8c.html#a13">TestTimer</a> = 3;
02365     <a class="code" href="../../d4/d0/tex_8c.html#a15">TestMutant</a> = 4;
02366     <a class="code" href="../../d4/d0/tex_8c.html#a16">TestException</a> = 5;
02367 <span class="preprocessor">#endif // SIMULATOR</span>
02368 <span class="preprocessor"></span>
02369     <a class="code" href="../../d4/d0/tex_8c.html#a2">TestFunction</a> = extest;
02370     <a class="code" href="../../d8/d1/init_8h.html#a22">KiSystemStartup</a>();
02371     <span class="keywordflow">return</span> 0;
02372 }
02373 <span class="preprocessor">#endif // MIPS</span>
02374 <span class="preprocessor"></span>
02375 <span class="keywordtype">void</span>
<a name="l02376"></a><a class="code" href="../../d4/d0/tex_8c.html#a49">02376</a> <a class="code" href="../../d4/d0/tex_8c.html#a49">oops</a>()
02377 {
02378     <a class="code" href="../../d2/d2/timer_8c.html#a10">ExTimerRundown</a>();
02379 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:57 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
