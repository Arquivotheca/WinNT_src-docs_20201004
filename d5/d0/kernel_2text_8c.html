<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: kernel/text.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>text.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d6/d9/kernel_2text_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d0/kernel_2text_8c.html#a0">_TextOutW</a> (HDC hdc, int x, int y, LPCWSTR lp, UINT cc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d0/kernel_2text_8c.html#a1">xxxPSMTextOut</a> (HDC hdc, int xLeft, int yTop, LPWSTR lpsz, int cch, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="kernel/text.c::_TextOutW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _TextOutW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>y</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>cc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l01201">1201</a> of file <a class="el" href="../../d0/d6/kernel_2server_8c-source.html">kernel/server.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d6/d9/kernel_2text_8c-source.html#l00041">xxxPSMTextOut()</a>.
<p>
<pre class="fragment"><div>01207 {
01208     <span class="keywordflow">return</span> GreExtTextOutW(hdc, x, y, 0, NULL, (LPWSTR)lp, cc, NULL);
01209 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="kernel/text.c::xxxPSMTextOut" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxPSMTextOut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>xLeft</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>yTop</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpsz</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cch</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d9/kernel_2text_8c-source.html#l00041">41</a> of file <a class="el" href="../../d6/d9/kernel_2text_8c-source.html">kernel/text.c</a>.
<p>
References <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l01187">_GetTextMetricsW()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l01201">_TextOutW()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03529">CALL_LPK</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d6/d1/rtl_2drawtext_8c-source.html#l00806">GetPrefixCount()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00059">PtiCurrentShared</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00027">SetRect()</a>, and <a class="el" href="../../d4/d1/userk_8h.html#a1409">xxxClientPSMTextOut()</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/rtl_2drawtext_8c-source.html#l01090">DT_InitDrawTextInfo()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l02082">xxxDrawMenuBarUnderlines()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00565">xxxDrawMenuItemText()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00954">xxxRealDrawMenuItem()</a>.
<p>
<pre class="fragment"><div>00048 {
00049     <span class="keywordtype">int</span> cx;
00050     LONG textsize, result;
00051     <span class="comment">/*</span>
00052 <span class="comment">     * In the kernel we have a limited amount of stack. So it should be a stack</span>
00053 <span class="comment">     * variable in user mode and static in kernel mode where it is thread safe</span>
00054 <span class="comment">     * since we are in the crit section.</span>
00055 <span class="comment">     */</span>
00056     <span class="keyword">static</span> WCHAR achWorkBuffer[255];
00057     WCHAR *pchOut = achWorkBuffer;
00058     TEXTMETRICW textMetric;
00059     SIZE size;
00060     RECT rc;
00061     COLORREF color;
00062     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>();
00063 
00064     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(ptiCurrent)) {
00065         <span class="comment">/*</span>
00066 <span class="comment">         * A user mode LPK is installed for layout and shaping.</span>
00067 <span class="comment">         * Perform callback and return.</span>
00068 <span class="comment">         */</span>
00069         UNICODE_STRING ustrStr;
00070 
00071         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;ustrStr, lpsz);
00072         <a class="code" href="../../d4/d1/userk_8h.html#a1409">xxxClientPSMTextOut</a>(hdc, xLeft, yTop, &amp;ustrStr, cch, dwFlags);
00073         <span class="keywordflow">return</span>;
00074     }
00075 
00076     <span class="keywordflow">if</span> (cch &gt; <span class="keyword">sizeof</span>(achWorkBuffer)/<span class="keyword">sizeof</span>(WCHAR)) {
00077         pchOut = (WCHAR*)UserAllocPool((cch+1) * <span class="keyword">sizeof</span>(WCHAR), TAG_RTL);
00078         <span class="keywordflow">if</span> (pchOut == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00079             <span class="keywordflow">return</span>;
00080     }
00081 
00082     result = <a class="code" href="../../d5/d2/rtl_2drawtext_8c.html#a39">GetPrefixCount</a>(lpsz, cch, pchOut, cch);
00083 
00084     <span class="keywordflow">if</span> (!(<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; DT_PREFIXONLY)) {
00085         <a class="code" href="../../d5/d0/kernel_2text_8c.html#a0">_TextOutW</a>(hdc, xLeft, yTop, pchOut, cch - HIWORD(result));
00086     }
00087 
00088     <span class="comment">/*</span>
00089 <span class="comment">     * Any true prefix characters to underline?</span>
00090 <span class="comment">     */</span>
00091     <span class="keywordflow">if</span> (LOWORD(result) == 0xFFFF || <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; DT_HIDEPREFIX) {
00092         <span class="keywordflow">if</span> (pchOut != achWorkBuffer)
00093             UserFreePool(pchOut);
00094         <span class="keywordflow">return</span>;
00095     }
00096 
00097     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1933">_GetTextMetricsW</a>(hdc, &amp;textMetric)) {
00098         textMetric.tmOverhang = 0;
00099         textMetric.tmAscent = 0;
00100     }
00101 
00102     <span class="comment">/*</span>
00103 <span class="comment">     * For proportional fonts, find starting point of underline.</span>
00104 <span class="comment">     */</span>
00105     <span class="keywordflow">if</span> (LOWORD(result) != 0) {
00106 
00107         <span class="comment">/*</span>
00108 <span class="comment">         * How far in does underline start (if not at 0th byte.).</span>
00109 <span class="comment">         */</span>
00110         GreGetTextExtentW(hdc, (LPWSTR)pchOut, LOWORD(result), &amp;size, GGTE_WIN3_EXTENT);
00111         xLeft += size.cx;
00112 
00113         <span class="comment">/*</span>
00114 <span class="comment">         * Adjust starting point of underline if not at first char and there is</span>
00115 <span class="comment">         * an overhang.  (Italics or bold fonts.)</span>
00116 <span class="comment">         */</span>
00117         xLeft = xLeft - textMetric.tmOverhang;
00118     }
00119 
00120     <span class="comment">/*</span>
00121 <span class="comment">     * Adjust for proportional font when setting the length of the underline and</span>
00122 <span class="comment">     * height of text.</span>
00123 <span class="comment">     */</span>
00124     GreGetTextExtentW(hdc, (LPWSTR)(pchOut + LOWORD(result)), 1, &amp;size, GGTE_WIN3_EXTENT);
00125     textsize = size.cx;
00126 
00127     <span class="comment">/*</span>
00128 <span class="comment">     * Find the width of the underline character.  Just subtract out the overhang</span>
00129 <span class="comment">     * divided by two so that we look better with italic fonts.  This is not</span>
00130 <span class="comment">     * going to effect embolded fonts since their overhang is 1.</span>
00131 <span class="comment">     */</span>
00132     cx = LOWORD(textsize) - textMetric.tmOverhang / 2;
00133 
00134     <span class="comment">/*</span>
00135 <span class="comment">     * Get height of text so that underline is at bottom.</span>
00136 <span class="comment">     */</span>
00137     yTop += textMetric.tmAscent + 1;
00138 
00139     <span class="comment">/*</span>
00140 <span class="comment">     * Draw the underline using the foreground color.</span>
00141 <span class="comment">     */</span>
00142     <a class="code" href="../../d3/d6/rect_8c.html#a1">SetRect</a>(&amp;rc, xLeft, yTop, xLeft+cx, yTop+1);
00143     color = GreSetBkColor(hdc, GreGetTextColor(hdc));
00144     GreExtTextOutW(hdc, xLeft, yTop, ETO_OPAQUE, &amp;rc, TEXT(<span class="stringliteral">""</span>), 0, NULL);
00145     GreSetBkColor(hdc, color);
00146 
00147     <span class="keywordflow">if</span> (pchOut != achWorkBuffer) {
00148         UserFreePool(pchOut);
00149     }
00150 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:44 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
