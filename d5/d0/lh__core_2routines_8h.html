<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: lh_core/routines.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>routines.h File Reference</h1>
<p>
<a href="../../d6/d9/lh__core_2routines_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d0/lh__core_2routines_8h.html#a0">UWE</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d0/lh__core_2routines_8h.html#a1">CalcGridPoints4Cube</a> (long theCubeSize, long inputDim, long *theGridPoints, long *theGridBits)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d0/lh__core_2routines_8h.html#a2">MakeCube</a> (long inputDim, long *thePtrSize, CUBE_DATA_TYPE *theCube, long *theBits)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d0/lh__core_2routines_8h.html#a3">MakeCMColorCube</a> (long inputDim, long *theCubeSize, CUBE_DATA_TYPE *aHdlPtr, long *theBits)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d0/lh__core_2routines_8h.html#a4">MakeCube16</a> (long inputDim, long *theCubeSize, CUBE_DATA_TYPE *theCube, long *theBits, long *theExtraSize)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="lh_core/routines.h::UWE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UWE&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d9/lh__core_2routines_8h-source.html#l00042">42</a> of file <a class="el" href="../../d6/d9/lh__core_2routines_8h-source.html">lh_core/routines.h</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1" doxytag="lh_core/routines.h::CalcGridPoints4Cube" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a> CalcGridPoints4Cube           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">long&nbsp;</td>
          <td class="mdname" nowrap> <em>theCubeSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>inputDim</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long *&nbsp;</td>
          <td class="mdname" nowrap> <em>theGridPoints</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long *&nbsp;</td>
          <td class="mdname" nowrap> <em>theGridBits</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/lh__core_2routines_8c-source.html#l00035">35</a> of file <a class="el" href="../../d4/d9/lh__core_2routines_8c-source.html">lh_core/routines.c</a>.
<p>
<pre class="fragment"><div>00039 {
00040         <span class="keywordtype">long</span>                    aSize,needBits,theSize;
00041         <span class="keyword">register</span> <span class="keywordtype">long</span>   loop,gridPoints;
00042         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00043 
00044         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"CalcGridPoints4Cube"</span>)
00045         
00046         if( inputDim &gt; 8 ) 
00047         {
00048                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a>;
00049                 <span class="keywordflow">goto</span> CleanupAndExit;
00050         }
00051         aSize = theCubeSize / inputDim;
00052         needBits=0;
00053         <span class="keywordflow">do</span>
00054         {
00055                 needBits++;
00056                 gridPoints = (1&lt;&lt;needBits);
00057                 theSize = gridPoints;
00058                 <span class="keywordflow">for</span>( loop=1; loop&lt;inputDim; ++loop)
00059                         theSize *= gridPoints;
00060         } <span class="keywordflow">while</span>( aSize &gt;= theSize );
00061         needBits--;
00062         <span class="keywordflow">if</span>( needBits &lt;= 0 ) 
00063         {
00064                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a>;
00065                 <span class="keywordflow">goto</span> CleanupAndExit;
00066         }
00067         *theGridBits = needBits;
00068         *theGridPoints = (1&lt;&lt;needBits);
00069 CleanupAndExit:
00070         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"CalcGridPoints4Cube"</span>)
00071         return err;
00072 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="lh_core/routines.h::MakeCMColorCube" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a> MakeCMColorCube           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">long&nbsp;</td>
          <td class="mdname" nowrap> <em>inputDim</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long *&nbsp;</td>
          <td class="mdname" nowrap> <em>theCubeSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>CUBE_DATA_TYPE *&nbsp;</td>
          <td class="mdname" nowrap> <em>aHdlPtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long *&nbsp;</td>
          <td class="mdname" nowrap> <em>theBits</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/lh__core_2routines_8c-source.html#l00312">312</a> of file <a class="el" href="../../d4/d9/lh__core_2routines_8c-source.html">lh_core/routines.c</a>.
<p>
<pre class="fragment"><div>00316 {
00317         <span class="keywordtype">long</span>    needBits,theSize;
00318         <span class="keywordtype">long</span>    i,gridPoints;
00319         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>   err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00320         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>  *cube = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
00321         <span class="keyword">register</span> <span class="keywordtype">long</span> aMaxVal;
00322         <span class="keyword">register</span> <span class="keywordtype">long</span> aShift;
00323         <span class="keywordtype">long</span>              aRound;
00324         
00325         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"MakeCMColorCube"</span>)
00326         
00327         err = CalcGridPoints4Cube(*theCubeSize, inputDim, &amp;gridPoints, &amp;needBits);
00328         if (err)
00329                 goto CleanupAndExit;
00330                 
00331         theSize = gridPoints;
00332         for( i=1; i&lt;inputDim; ++i)theSize *= gridPoints;
00333 
00334         if( inputDim &gt; 4 ) 
00335         {
00336                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a>;
00337                 <span class="keywordflow">goto</span> CleanupAndExit;
00338         }
00339         *theCubeSize = theSize * inputDim;
00340         <span class="keywordflow">if</span>( inputDim != 4 )
00341                 *theCubeSize = theSize * 4;
00342                 
00343         *aHdlPtr = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(*theCubeSize*2, &amp;err);
00344         <span class="keywordflow">if</span> (err != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>) 
00345                 <span class="keywordflow">goto</span> CleanupAndExit;
00346         
00347         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>( *aHdlPtr );
00348         cube = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>( *aHdlPtr );
00349         aMaxVal = (1&lt;&lt;(30-needBits))-1; <span class="comment">/* Normierung auf 0xffff*/</span>
00350         aMaxVal = aMaxVal / ( gridPoints -1 );
00351         aShift = 30 - needBits - 16;
00352         aRound = 0;<span class="comment">/*(1&lt;&lt;(aShift-1))-1;*/</span>
00353         <span class="keywordflow">if</span>( inputDim == 1 )
00354         {
00355                 <span class="keywordflow">for</span>( i=0; i&lt;gridPoints; ++i){
00356                                         *cube++ = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(( aMaxVal * i + aRound) &gt;&gt; aShift); 
00357                                         *cube++ = 0; 
00358                                         *cube++ = 0; 
00359                                         *cube++ = 0; 
00360                 }
00361         }
00362         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( inputDim == 2)
00363         {
00364                 <span class="keyword">register</span> <span class="keywordtype">long</span>  j;
00365                 <span class="keyword">register</span> <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> aI;
00366                 <span class="keywordflow">for</span>( i=0; i&lt;gridPoints; ++i){
00367                         aI = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(( aMaxVal * i + aRound ) &gt;&gt; aShift);
00368                         <span class="keywordflow">for</span>( j=0; j&lt;gridPoints; ++j){
00369                                         *cube++ = aI; 
00370                                         *cube++ = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(( aMaxVal * j + aRound ) &gt;&gt; aShift); 
00371                                         *cube++ = 0; 
00372                                         *cube++ = 0; 
00373                         }
00374                 }
00375         }
00376         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( inputDim == 3)
00377         {
00378                 <span class="keyword">register</span> <span class="keywordtype">long</span>  j,k;
00379                 <span class="keyword">register</span> <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> aI, aJ;
00380                 <span class="keywordflow">for</span>( i=0; i&lt;gridPoints; ++i){
00381                         aI = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(( aMaxVal * i + aRound ) &gt;&gt; aShift);
00382                         <span class="keywordflow">for</span>( j=0; j&lt;gridPoints; ++j){
00383                                 aJ = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(( aMaxVal * j + aRound ) &gt;&gt; aShift);
00384                                 <span class="keywordflow">for</span>( k=0; k&lt;gridPoints; ++k){
00385                                         *cube++ = aI; 
00386                                         *cube++ = aJ; 
00387                                         *cube++ = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(( aMaxVal * k + aRound ) &gt;&gt; aShift); 
00388                                         *cube++ = 0; 
00389                                 }
00390                         }
00391                 }
00392         }
00393         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( inputDim == 4){
00394                 <span class="keyword">register</span> <span class="keywordtype">long</span>  j,k,l;
00395                 <span class="keyword">register</span> <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> aI, aJ,aK;
00396                 <span class="keywordflow">for</span>( i=0; i&lt;gridPoints; ++i){
00397                         aI = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(( aMaxVal * i + aRound ) &gt;&gt; aShift);
00398                         <span class="keywordflow">for</span>( j=0; j&lt;gridPoints; ++j){
00399                                 aJ = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(( aMaxVal * j + aRound ) &gt;&gt; aShift);
00400                                 <span class="keywordflow">for</span>( k=0; k&lt;gridPoints; ++k){
00401                                         aK = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(( aMaxVal * k + aRound ) &gt;&gt; aShift);
00402                                         <span class="keywordflow">for</span>( l=0; l&lt;gridPoints; ++l){
00403                                                 *cube++ = aI; 
00404                                                 *cube++ = aJ; 
00405                                                 *cube++ = aK; 
00406                                                 *cube++ = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(( aMaxVal * l + aRound ) &gt;&gt; aShift); 
00407                                         }
00408                                 }
00409                         }
00410                 }
00411         }
00412         <span class="keywordflow">else</span>
00413         {
00414                 *aHdlPtr = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(*aHdlPtr);
00415                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a>;
00416                 <span class="keywordflow">goto</span> CleanupAndExit;
00417         }
00418         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(*aHdlPtr);
00419         *theBits = needBits;
00420 CleanupAndExit:
00421         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"MakeCMColorCube"</span>)
00422         return err;
00423 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="lh_core/routines.h::MakeCube" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a> MakeCube           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">long&nbsp;</td>
          <td class="mdname" nowrap> <em>inputDim</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long *&nbsp;</td>
          <td class="mdname" nowrap> <em>thePtrSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>CUBE_DATA_TYPE *&nbsp;</td>
          <td class="mdname" nowrap> <em>theCube</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long *&nbsp;</td>
          <td class="mdname" nowrap> <em>theBits</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/lh__core_2routines_8c-source.html#l00075">75</a> of file <a class="el" href="../../d4/d9/lh__core_2routines_8c-source.html">lh_core/routines.c</a>.
<p>
<pre class="fragment"><div>00079 {
00080         <span class="keywordtype">long</span>                    needBits,theSize;
00081         <span class="keywordtype">long</span>                    i,gridPoints;
00082         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00083         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>                   *cube = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
00084         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a2">CUBE_DATA_TYPE</a>  tempCube;
00085         <span class="comment">/*</span>
00086 <span class="comment">        long DivisionReplace[]={ 0,0,7,255, 6,85, 12,4663, 4,17, 15,33693, 12,4145, 14,16449,</span>
00087 <span class="comment">                                                         0, 1, 9,511, 10,1021, 11,2041, 12,4081, 13,8161, 14,16321, 15,32641, 16,65281};        </span>
00088 <span class="comment">        */</span>
00089         
00090         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"MakeCube"</span>)
00091         err = CalcGridPoints4Cube(*theCubeSize, inputDim, &amp;gridPoints, &amp;needBits);
00092         if (err)
00093                 goto CleanupAndExit;
00094                 
00095         theSize = gridPoints;
00096         for( i=1; i&lt;inputDim; ++i)
00097                 theSize *= gridPoints;
00098 
00099         *theCubeSize = theSize * inputDim;
00100         tempCube = ALLOC_DATA(theSize * inputDim, &amp;err);
00101         if (err != noErr) 
00102                 goto CleanupAndExit;
00103         LOCK_DATA(tempCube);
00104         cube = (UINT8*)DATA_2_PTR(tempCube);
00105 
00106         if( inputDim == 3)
00107         {
00108                 <span class="keyword">register</span> <span class="keywordtype">long</span>  aShift;
00109                 <span class="keyword">register</span> <span class="keywordtype">long</span>  j,k;
00110                 <span class="keyword">register</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> aI, aJ;
00111                 aShift = (8 - needBits) ;
00112                 <span class="comment">/*</span>
00113 <span class="comment">                aShift = DivisionReplace[2*needBits] - (8 - needBits) ;</span>
00114 <span class="comment">                if( aShift &lt; 0 ){</span>
00115 <span class="comment">                        aFactor = DivisionReplace[2*needBits+1]*(1&lt;&lt;(-aShift));</span>
00116 <span class="comment">                        aShift = 0;</span>
00117 <span class="comment">                }</span>
00118 <span class="comment">                else aFactor = DivisionReplace[2*needBits+1];</span>
00119 <span class="comment">                */</span>
00120                 <span class="keywordflow">for</span>( i=0; i&lt;gridPoints; ++i){
00121                         aI = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)(i&lt;&lt; aShift);
00122                         <span class="keywordflow">for</span>( j=0; j&lt;gridPoints; ++j){
00123                                 aJ = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)(j&lt;&lt; aShift);
00124                                 <span class="keywordflow">for</span>( k=0; k&lt;gridPoints; ++k){
00125                                         *cube++ = aI; 
00126                                         *cube++ = aJ; 
00127                                         *cube++ =(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)(k&lt;&lt; aShift); 
00128                                 }
00129                         }
00130                 }
00131         }
00132         <span class="keywordflow">else</span>
00133         {
00134                 <a class="code" href="../../d4/d0/w98_2lh__core_2routines_8c.html#a3">SetValues</a>( 0, inputDim, needBits, &amp;cube );
00135         }
00136         *theBits = needBits;
00137         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(tempCube);
00138         *theCube = tempCube;
00139 CleanupAndExit:
00140         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"MakeCube"</span>)
00141         return err;
00142 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="lh_core/routines.h::MakeCube16" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a> MakeCube16           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">long&nbsp;</td>
          <td class="mdname" nowrap> <em>inputDim</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long *&nbsp;</td>
          <td class="mdname" nowrap> <em>theCubeSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>CUBE_DATA_TYPE *&nbsp;</td>
          <td class="mdname" nowrap> <em>theCube</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long *&nbsp;</td>
          <td class="mdname" nowrap> <em>theBits</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long *&nbsp;</td>
          <td class="mdname" nowrap> <em>theExtraSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/lh__core_2routines_8c-source.html#l00147">147</a> of file <a class="el" href="../../d4/d9/lh__core_2routines_8c-source.html">lh_core/routines.c</a>.
<p>
<pre class="fragment"><div>00152 {
00153         <span class="keywordtype">long</span>                    needBits,theSize,aExtraSize;
00154         <span class="keywordtype">long</span>                    i,gridPoints;
00155         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00156         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  *cube = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
00157         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a2">CUBE_DATA_TYPE</a>  tempCube;
00158         
00159         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"MakeCube16"</span>)
00160         <span class="comment">/*</span>
00161 <span class="comment">                long DivisionReplace[]={ 0,0,7,255, 6,85, 12,4663, 4,17, 15,33693, 12,4145, 14,16449,</span>
00162 <span class="comment">                                                         0, 1, 9,511, 10,1021, 11,2041, 12,4081, 13,8161, 14,16321, 15,32641, 16,65281};</span>
00163 <span class="comment">        */</span>
00164         err = CalcGridPoints4Cube(*theCubeSize, inputDim, &amp;gridPoints, &amp;needBits);
00165         if (err)
00166                 goto CleanupAndExit;
00167                 
00168         theSize = 1;
00169         aExtraSize = 1;
00170         for( i=0; i&lt;(inputDim-1); ++i){ <span class="comment">/* Extra Size for Interpolation */</span>
00171                 theSize *= gridPoints;
00172                 aExtraSize += theSize;
00173         }
00174         
00175 <span class="preprocessor">#ifdef ALLOW_MMX</span>
00176 <span class="preprocessor"></span>        aExtraSize++;   <span class="comment">/* +1 for MMX 4 Byte access */</span>
00177 <span class="preprocessor">#endif</span>
00178 <span class="preprocessor"></span>    theSize *= gridPoints;
00179         
00180         *theExtraSize = aExtraSize;
00181         *theCubeSize = theSize * inputDim;
00182         tempCube = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>( (theSize+aExtraSize) * inputDim*2, &amp;err);
00183         <span class="keywordflow">if</span> (err != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>) 
00184                 <span class="keywordflow">goto</span> CleanupAndExit;
00185         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(tempCube);
00186         cube = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(tempCube);
00187 
00188         <span class="keywordflow">if</span>( inputDim == 3)
00189         {
00190                 <span class="keyword">register</span> <span class="keywordtype">long</span>  aShift;
00191                 <span class="keyword">register</span> <span class="keywordtype">long</span>  j,k;
00192                 <span class="keyword">register</span> <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> aI, aJ, aK;
00193                 aShift = (16 - needBits) ;
00194                 <span class="comment">/*</span>
00195 <span class="comment">                aShift = DivisionReplace[2*needBits] - (8 - needBits) ;</span>
00196 <span class="comment">                if( aShift &lt; 0 ){</span>
00197 <span class="comment">                        aFactor = DivisionReplace[2*needBits+1]*(1&lt;&lt;(-aShift));</span>
00198 <span class="comment">                        aShift = 0;</span>
00199 <span class="comment">                }</span>
00200 <span class="comment">                else aFactor = DivisionReplace[2*needBits+1];</span>
00201 <span class="comment">                */</span>
00202                 <span class="keywordflow">for</span>( i=0; i&lt;gridPoints; ++i){
00203                         aI = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(i&lt;&lt; aShift);
00204                         aI |= aI &gt;&gt; needBits;
00205                         aI |= aI &gt;&gt; (2*needBits);
00206                         aI |= aI &gt;&gt; (4*needBits);
00207                         <span class="keywordflow">for</span>( j=0; j&lt;gridPoints; ++j){
00208                                 aJ = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(j&lt;&lt; aShift);
00209                                 aJ |= aJ &gt;&gt; needBits;
00210                                 aJ |= aJ &gt;&gt; (2*needBits);
00211                                 aJ |= aJ &gt;&gt; (4*needBits);
00212                                 <span class="keywordflow">for</span>( k=0; k&lt;gridPoints; ++k){
00213                                         *cube++ = aI; 
00214                                         *cube++ = aJ;
00215                                         aK = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(k&lt;&lt; aShift);
00216                                         aK |= aK &gt;&gt; needBits;
00217                                         aK |= aK &gt;&gt; (2*needBits);
00218                                         aK |= aK &gt;&gt; (4*needBits);
00219                                         *cube++ = aK; 
00220                                 }
00221                         }
00222                 }
00223         }
00224         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( inputDim == 4)
00225         {
00226                 <span class="keyword">register</span> <span class="keywordtype">long</span>  aShift;
00227                 <span class="keyword">register</span> <span class="keywordtype">long</span>  j,k,l;
00228                 <span class="keyword">register</span> <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> aI, aJ, aK, aL;
00229                 aShift = (16 - needBits) ;
00230                 <span class="comment">/*</span>
00231 <span class="comment">                aShift = DivisionReplace[2*needBits] - (8 - needBits) ;</span>
00232 <span class="comment">                if( aShift &lt; 0 ){</span>
00233 <span class="comment">                        aFactor = DivisionReplace[2*needBits+1]*(1&lt;&lt;(-aShift));</span>
00234 <span class="comment">                        aShift = 0;</span>
00235 <span class="comment">                }</span>
00236 <span class="comment">                else aFactor = DivisionReplace[2*needBits+1];</span>
00237 <span class="comment">                */</span>
00238                 <span class="keywordflow">for</span>( i=0; i&lt;gridPoints; ++i){
00239                         aI = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(i&lt;&lt; aShift);
00240                         aI |= aI &gt;&gt; needBits;
00241                         aI |= aI &gt;&gt; (2*needBits);
00242                         aI |= aI &gt;&gt; (4*needBits);
00243                         <span class="keywordflow">for</span>( j=0; j&lt;gridPoints; ++j){
00244                                 aJ = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(j&lt;&lt; aShift);
00245                                 aJ |= aJ &gt;&gt; needBits;
00246                                 aJ |= aJ &gt;&gt; (2*needBits);
00247                                 aJ |= aJ &gt;&gt; (4*needBits);
00248                                 <span class="keywordflow">for</span>( k=0; k&lt;gridPoints; ++k){
00249                                         aK = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(k&lt;&lt; aShift);
00250                                         aK |= aK &gt;&gt; needBits;
00251                                         aK |= aK &gt;&gt; (2*needBits);
00252                                         aK |= aK &gt;&gt; (4*needBits);
00253                                         <span class="keywordflow">for</span>( l=0; l&lt;gridPoints; ++l){
00254                                                 *cube++ = aI; 
00255                                                 *cube++ = aJ;
00256                                                 *cube++ = aK;
00257                                                 aL = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)(l&lt;&lt; aShift);
00258                                                 aL |= aL &gt;&gt; needBits;
00259                                                 aL |= aL &gt;&gt; (2*needBits);
00260                                                 aL |= aL &gt;&gt; (4*needBits);
00261                                                 *cube++ = aL; 
00262                                         }
00263                                 }
00264                         }
00265                 }
00266         }
00267         <span class="keywordflow">else</span>
00268         {
00269                 <a class="code" href="../../d4/d0/w98_2lh__core_2routines_8c.html#a6">SetValues16</a>( 0, inputDim, needBits, &amp;cube );
00270         }
00271         *theBits = needBits;
00272         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(tempCube);
00273         *theCube = tempCube;
00274 CleanupAndExit:
00275         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"MakeCube16"</span>)
00276         return err;
00277 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:30 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
