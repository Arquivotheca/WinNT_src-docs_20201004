<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: class2.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>class2.h</h1><a href="../../d4/d7/class2_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    class.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    These are the structures and defines that are used in the</span>
00012 <span class="comment">    SCSI class drivers.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Mike Glass (mglass)</span>
00017 <span class="comment">    Jeff Havens (jhavens)</span>
00018 <span class="comment"></span>
00019 <span class="comment">Revision History:</span>
00020 <span class="comment"></span>
00021 <span class="comment">--*/</span>
00022 
00023 <span class="preprocessor">#ifndef _CLASS_</span>
00024 <span class="preprocessor"></span>
00025 <span class="preprocessor">#include &lt;ntdddisk.h&gt;</span>
00026 <span class="preprocessor">#include &lt;ntddcdrm.h&gt;</span>
00027 <span class="preprocessor">#include &lt;ntddtape.h&gt;</span>
00028 <span class="preprocessor">#include "ntddscsi.h"</span>
00029 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00030 
00031 <span class="preprocessor">#if DBG</span>
00032 <span class="preprocessor"></span>
00033 <span class="preprocessor">#define DebugPrint(x) ScsiDebugPrint x</span>
00034 <span class="preprocessor"></span>
00035 <span class="preprocessor">#else</span>
00036 <span class="preprocessor"></span>
<a name="l00037"></a><a class="code" href="../../d4/d7/class2_8h.html#a0">00037</a> <span class="preprocessor">#define DebugPrint(x)</span>
00038 <span class="preprocessor"></span>
00039 <span class="preprocessor">#endif // DBG</span>
00040 <span class="preprocessor"></span>
00041 <span class="preprocessor">#ifdef POOL_TAGGING</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#undef ExAllocatePool</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#undef ExAllocatePoolWithQuota</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define ExAllocatePool(a,b) ExAllocatePoolWithTag(a,b,'HscS')</span>
00045 <span class="preprocessor"></span><span class="preprocessor">#define ExAllocatePoolWithQuota(a,b) ExAllocatePoolWithQuotaTag(a,b,'HscS')</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00047 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="../../d4/d7/class2_8h.html#a1">00048</a> <span class="preprocessor">#define MAXIMUM_RETRIES 4</span>
00049 <span class="preprocessor"></span>
00050 <span class="keyword">struct </span><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html">_CLASS_INIT_DATA</a>;
00051 
00052 <span class="keyword">typedef</span>
00053 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00054"></a><a class="code" href="../../d4/d7/class2_8h.html#a7">00054</a> (*PCLASS_ERROR) (
00055     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00056     IN PSCSI_REQUEST_BLOCK Srb,
00057     IN OUT <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> *<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>,
00058     IN OUT BOOLEAN *Retry
00059     );
00060 
00061 <span class="keyword">typedef</span>
00062 BOOLEAN
<a name="l00063"></a><a class="code" href="../../d4/d7/class2_8h.html#a8">00063</a> (*PCLASS_DEVICE_CALLBACK) (
00064     IN PINQUIRYDATA
00065     );
00066 
00067 <span class="keyword">typedef</span>
00068 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00069"></a><a class="code" href="../../d4/d7/class2_8h.html#a9">00069</a> (*PCLASS_READ_WRITE) (
00070     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00071     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a>
00072     );
00073 
00074 <span class="keyword">typedef</span>
00075 BOOLEAN
<a name="l00076"></a><a class="code" href="../../d4/d7/class2_8h.html#a10">00076</a> (*PCLASS_FIND_DEVICES) (
00077     IN <a class="code" href="../../d4/d9/struct__DRIVER__OBJECT.html">PDRIVER_OBJECT</a> DriverObject,
00078     IN PUNICODE_STRING RegistryPath,
00079     IN <span class="keyword">struct </span><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html">_CLASS_INIT_DATA</a> *InitializationData,
00080     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PortDeviceObject,
00081     IN ULONG PortNumber
00082     );
00083 
00084 <span class="keyword">typedef</span>
00085 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00086"></a><a class="code" href="../../d4/d7/class2_8h.html#a11">00086</a> (*PCLASS_DEVICE_CONTROL) (
00087     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00088     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a>
00089     );
00090 
00091 <span class="keyword">typedef</span>
00092 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00093"></a><a class="code" href="../../d4/d7/class2_8h.html#a12">00093</a> (*PCLASS_SHUTDOWN_FLUSH) (
00094     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00095     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a>
00096     );
00097 
00098 <span class="keyword">typedef</span>
00099 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00100"></a><a class="code" href="../../d4/d7/class2_8h.html#a13">00100</a> (*PCLASS_CREATE_CLOSE) (
00101     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00102     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> <a class="code" href="../../d0/d6/iop_8h.html#a35">Irp</a>
00103     );
00104 
<a name="l00105"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html">00105</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html">_CLASS_INIT_DATA</a> {
00106 
00107     <span class="comment">//</span>
00108     <span class="comment">// This structure size - version checking.</span>
00109     <span class="comment">//</span>
00110 
<a name="l00111"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o0">00111</a>     ULONG <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o0">InitializationDataSize</a>;
00112 
00113     <span class="comment">//</span>
00114     <span class="comment">// Bytes needed by the class driver</span>
00115     <span class="comment">// for it's extension.</span>
00116     <span class="comment">//</span>
00117 
<a name="l00118"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o1">00118</a>     ULONG <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o1">DeviceExtensionSize</a>;
00119 
<a name="l00120"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o2">00120</a>     DEVICE_TYPE <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o2">DeviceType</a>;
00121 
00122     <span class="comment">//</span>
00123     <span class="comment">// Device Characteristics flags</span>
00124     <span class="comment">//  eg.:</span>
00125     <span class="comment">//</span>
00126     <span class="comment">//  FILE_REMOVABLE_MEDIA</span>
00127     <span class="comment">//  FILE_READ_ONLY_DEVICE</span>
00128     <span class="comment">//  FILE_FLOPPY_DISKETTE</span>
00129     <span class="comment">//  FILE_WRITE_ONCE_MEDIA</span>
00130     <span class="comment">//  FILE_REMOTE_DEVICE</span>
00131     <span class="comment">//  FILE_DEVICE_IS_MOUNTED</span>
00132     <span class="comment">//  FILE_VIRTUAL_VOLUME</span>
00133     <span class="comment">//</span>
00134 
<a name="l00135"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o3">00135</a>     ULONG <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o3">DeviceCharacteristics</a>;
00136 
00137     <span class="comment">//</span>
00138     <span class="comment">// Device-specific driver routines</span>
00139     <span class="comment">//</span>
00140 
<a name="l00141"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o4">00141</a>     <a class="code" href="../../d3/d7/class_8h.html#a2">PCLASS_ERROR</a>           <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o4">ClassError</a>;
<a name="l00142"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o5">00142</a>     <a class="code" href="../../d4/d7/class2_8h.html#a9">PCLASS_READ_WRITE</a>      <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o5">ClassReadWriteVerification</a>;
<a name="l00143"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o6">00143</a>     <a class="code" href="../../d4/d7/class2_8h.html#a8">PCLASS_DEVICE_CALLBACK</a> <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o6">ClassFindDeviceCallBack</a>;
<a name="l00144"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o7">00144</a>     <a class="code" href="../../d4/d7/class2_8h.html#a10">PCLASS_FIND_DEVICES</a>    <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o7">ClassFindDevices</a>;
<a name="l00145"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o8">00145</a>     <a class="code" href="../../d4/d7/class2_8h.html#a11">PCLASS_DEVICE_CONTROL</a>  <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o8">ClassDeviceControl</a>;
<a name="l00146"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o9">00146</a>     <a class="code" href="../../d4/d7/class2_8h.html#a12">PCLASS_SHUTDOWN_FLUSH</a>  <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o9">ClassShutdownFlush</a>;
<a name="l00147"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o10">00147</a>     <a class="code" href="../../d4/d7/class2_8h.html#a13">PCLASS_CREATE_CLOSE</a>    <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o10">ClassCreateClose</a>;
<a name="l00148"></a><a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o11">00148</a>     <a class="code" href="../../d0/d5/io_8h.html#a288">PDRIVER_STARTIO</a>        <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html#o11">ClassStartIo</a>;
00149 
00150 } <a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html">CLASS_INIT_DATA</a>, *<a class="code" href="../../d9/d9/struct__CLASS__INIT__DATA.html">PCLASS_INIT_DATA</a>;
00151 
00152 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">_DEVICE_EXTENSION</a> {
00153 
00154     <span class="comment">//</span>
00155     <span class="comment">// Back pointer to device object</span>
00156     <span class="comment">//</span>
00157 
00158     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject;
00159 
00160     <span class="comment">//</span>
00161     <span class="comment">// Pointer to port device object</span>
00162     <span class="comment">//</span>
00163 
<a name="l00164"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o4">00164</a>     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PortDeviceObject;
00165 
00166     <span class="comment">//</span>
00167     <span class="comment">// Length of partition in bytes</span>
00168     <span class="comment">//</span>
00169 
<a name="l00170"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o5">00170</a>     LARGE_INTEGER <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o5">PartitionLength</a>;
00171 
00172     <span class="comment">//</span>
00173     <span class="comment">// Number of bytes before start of partition</span>
00174     <span class="comment">//</span>
00175 
<a name="l00176"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o6">00176</a>     LARGE_INTEGER <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o6">StartingOffset</a>;
00177 
00178     <span class="comment">//</span>
00179     <span class="comment">// Bytes to skew all requests, since DM Driver has been placed on an IDE drive.</span>
00180     <span class="comment">//</span>
00181 
<a name="l00182"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o7">00182</a>     ULONG <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o7">DMByteSkew</a>;
00183 
00184     <span class="comment">//</span>
00185     <span class="comment">// Sectors to skew all requests.</span>
00186     <span class="comment">//</span>
00187 
<a name="l00188"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o8">00188</a>     ULONG <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o8">DMSkew</a>;
00189 
00190     <span class="comment">//</span>
00191     <span class="comment">// Flag to indicate whether DM driver has been located on an IDE drive.</span>
00192     <span class="comment">//</span>
00193 
<a name="l00194"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o9">00194</a>     BOOLEAN <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o9">DMActive</a>;
00195 
00196     <span class="comment">//</span>
00197     <span class="comment">// Class driver routines</span>
00198     <span class="comment">//</span>
00199 
<a name="l00200"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o10">00200</a>     <a class="code" href="../../d3/d7/class_8h.html#a2">PCLASS_ERROR</a> <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o10">ClassError</a>;
<a name="l00201"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o30">00201</a>     <a class="code" href="../../d4/d7/class2_8h.html#a9">PCLASS_READ_WRITE</a> <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o30">ClassReadWriteVerification</a>;
<a name="l00202"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o31">00202</a>     <a class="code" href="../../d4/d7/class2_8h.html#a10">PCLASS_FIND_DEVICES</a> <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o31">ClassFindDevices</a>;
<a name="l00203"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o32">00203</a>     <a class="code" href="../../d4/d7/class2_8h.html#a11">PCLASS_DEVICE_CONTROL</a> <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o32">ClassDeviceControl</a>;
<a name="l00204"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o33">00204</a>     <a class="code" href="../../d4/d7/class2_8h.html#a12">PCLASS_SHUTDOWN_FLUSH</a> <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o33">ClassShutdownFlush</a>;
<a name="l00205"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o34">00205</a>     <a class="code" href="../../d4/d7/class2_8h.html#a13">PCLASS_CREATE_CLOSE</a> <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o34">ClassCreateClose</a>;
<a name="l00206"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o35">00206</a>     <a class="code" href="../../d0/d5/io_8h.html#a288">PDRIVER_STARTIO</a>     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o35">ClassStartIo</a>;
00207 
00208     <span class="comment">//</span>
00209     <span class="comment">// SCSI port driver capabilities</span>
00210     <span class="comment">//</span>
00211 
<a name="l00212"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o11">00212</a>     PIO_SCSI_CAPABILITIES <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o11">PortCapabilities</a>;
00213 
00214     <span class="comment">//</span>
00215     <span class="comment">// Buffer for drive parameters returned in IO device control.</span>
00216     <span class="comment">//</span>
00217 
<a name="l00218"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o12">00218</a>     PDISK_GEOMETRY <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o12">DiskGeometry</a>;
00219 
00220     <span class="comment">//</span>
00221     <span class="comment">// Back pointer to device object of physical device</span>
00222     <span class="comment">// If this is equal to DeviceObject then this is the physical device</span>
00223     <span class="comment">//</span>
00224 
<a name="l00225"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o13">00225</a>     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o13">PhysicalDevice</a>;
00226 
00227     <span class="comment">//</span>
00228     <span class="comment">// Request Sense Buffer</span>
00229     <span class="comment">//</span>
00230 
<a name="l00231"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o14">00231</a>     PSENSE_DATA <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o14">SenseData</a>;
00232 
00233     <span class="comment">//</span>
00234     <span class="comment">// Request timeout in seconds;</span>
00235     <span class="comment">//</span>
00236 
<a name="l00237"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o15">00237</a>     ULONG <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o15">TimeOutValue</a>;
00238 
00239     <span class="comment">//</span>
00240     <span class="comment">// System device number</span>
00241     <span class="comment">//</span>
00242 
<a name="l00243"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o16">00243</a>     ULONG <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o16">DeviceNumber</a>;
00244 
00245     <span class="comment">//</span>
00246     <span class="comment">// Add default Srb Flags.</span>
00247     <span class="comment">//</span>
00248 
<a name="l00249"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o17">00249</a>     ULONG <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o17">SrbFlags</a>;
00250 
00251     <span class="comment">//</span>
00252     <span class="comment">// Total number of SCSI protocol errors on the device.</span>
00253     <span class="comment">//</span>
00254 
<a name="l00255"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o18">00255</a>     ULONG <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o18">ErrorCount</a>;
00256 
00257     <span class="comment">//</span>
00258     <span class="comment">// Spinlock for split requests</span>
00259     <span class="comment">//</span>
00260 
<a name="l00261"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o19">00261</a>     KSPIN_LOCK <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o19">SplitRequestSpinLock</a>;
00262 
00263     <span class="comment">//</span>
00264     <span class="comment">// Lookaside listhead for srbs.</span>
00265     <span class="comment">//</span>
00266 
<a name="l00267"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o36">00267</a>     <a class="code" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">NPAGED_LOOKASIDE_LIST</a> <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o36">SrbLookasideListHead</a>;
00268 
00269     <span class="comment">//</span>
00270     <span class="comment">// Lock count for removable media.</span>
00271     <span class="comment">//</span>
00272 
<a name="l00273"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o22">00273</a>     LONG <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o22">LockCount</a>;
00274 
00275     <span class="comment">//</span>
00276     <span class="comment">// Scsi port number</span>
00277     <span class="comment">//</span>
00278 
<a name="l00279"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o23">00279</a>     UCHAR <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o23">PortNumber</a>;
00280 
00281     <span class="comment">//</span>
00282     <span class="comment">// SCSI path id</span>
00283     <span class="comment">//</span>
00284 
<a name="l00285"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o24">00285</a>     UCHAR <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o24">PathId</a>;
00286 
00287     <span class="comment">//</span>
00288     <span class="comment">// SCSI bus target id</span>
00289     <span class="comment">//</span>
00290 
<a name="l00291"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o25">00291</a>     UCHAR <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o25">TargetId</a>;
00292 
00293     <span class="comment">//</span>
00294     <span class="comment">// SCSI bus logical unit number</span>
00295     <span class="comment">//</span>
00296 
<a name="l00297"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o26">00297</a>     UCHAR <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o26">Lun</a>;
00298 
00299     <span class="comment">//</span>
00300     <span class="comment">// Log2 of sector size</span>
00301     <span class="comment">//</span>
00302 
<a name="l00303"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o27">00303</a>     UCHAR <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o27">SectorShift</a>;
<a name="l00304"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o37">00304</a>     UCHAR   <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o37">ReservedByte</a>;
00305 
00306     <span class="comment">//</span>
00307     <span class="comment">// Values for the flags are below.</span>
00308     <span class="comment">//</span>
00309 
<a name="l00310"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o38">00310</a>     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>  <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o38">DeviceFlags</a>;
00311 
00312     <span class="comment">//</span>
00313     <span class="comment">// Pointer to the media change event.  If MediaChange is TRUE, then</span>
00314     <span class="comment">// this event is to be signaled on all media change check conditions.</span>
00315     <span class="comment">// If MediaChangeNoMedia is true then we've already determined that there</span>
00316     <span class="comment">// isn't any media in the drive so we shouldn't signal the event again</span>
00317     <span class="comment">//</span>
00318 
<a name="l00319"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o39">00319</a>     <a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a> <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o39">MediaChangeEvent</a>;
<a name="l00320"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o40">00320</a>     HANDLE  <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o40">MediaChangeEventHandle</a>;
<a name="l00321"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o41">00321</a>     BOOLEAN <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o41">MediaChangeNoMedia</a>;
00322 
00323     <span class="comment">//</span>
00324     <span class="comment">// Count of media changes.  This field is only valid for the root partition</span>
00325     <span class="comment">// (ie. if PhysicalDevice == NULL).</span>
00326     <span class="comment">//</span>
00327 
<a name="l00328"></a><a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o42">00328</a>     ULONG <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o42">MediaChangeCount</a>;
00329 
00330 
00331 } <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">DEVICE_EXTENSION</a>, *<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a>;
00332 
00333 <span class="comment">//</span>
00334 <span class="comment">// Indicates that the device has write caching enabled.</span>
00335 <span class="comment">//</span>
00336 
<a name="l00337"></a><a class="code" href="../../d4/d7/class2_8h.html#a2">00337</a> <span class="preprocessor">#define DEV_WRITE_CACHE     0x00000001</span>
00338 <span class="preprocessor"></span>
00339 
00340 <span class="comment">//</span>
00341 <span class="comment">// Build SCSI 1 or SCSI 2 CDBs</span>
00342 <span class="comment">//</span>
00343 
<a name="l00344"></a><a class="code" href="../../d4/d7/class2_8h.html#a3">00344</a> <span class="preprocessor">#define DEV_USE_SCSI1       0x00000002</span>
00345 <span class="preprocessor"></span>
00346 <span class="comment">//</span>
00347 <span class="comment">// Indicates whether is is safe to send StartUnit commands</span>
00348 <span class="comment">// to this device. It will only be off for some removeable devices.</span>
00349 <span class="comment">//</span>
00350 
<a name="l00351"></a><a class="code" href="../../d4/d7/class2_8h.html#a4">00351</a> <span class="preprocessor">#define DEV_SAFE_START_UNIT 0x00000004</span>
00352 <span class="preprocessor"></span>
00353 <span class="comment">//</span>
00354 <span class="comment">// Indicates whether it is unsafe to send SCSIOP_MECHANISM_STATUS commands to</span>
00355 <span class="comment">// this device.  Some devices don't like these 12 byte commands</span>
00356 <span class="comment">//</span>
00357 
<a name="l00358"></a><a class="code" href="../../d4/d7/class2_8h.html#a5">00358</a> <span class="preprocessor">#define DEV_NO_12BYTE_CDB 0x00000008</span>
00359 <span class="preprocessor"></span>
00360 <span class="comment">//</span>
00361 <span class="comment">// Define context structure for asynchronous completions.</span>
00362 <span class="comment">//</span>
00363 
00364 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d8/struct__COMPLETION__CONTEXT.html">_COMPLETION_CONTEXT</a> {
<a name="l00365"></a><a class="code" href="../../d0/d8/struct__COMPLETION__CONTEXT.html#o0">00365</a>     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject;
<a name="l00366"></a><a class="code" href="../../d0/d8/struct__COMPLETION__CONTEXT.html#o1">00366</a>     SCSI_REQUEST_BLOCK Srb;
00367 }<a class="code" href="../../d0/d8/struct__COMPLETION__CONTEXT.html">COMPLETION_CONTEXT</a>, *<a class="code" href="../../d0/d8/struct__COMPLETION__CONTEXT.html">PCOMPLETION_CONTEXT</a>;
00368 
00369 <span class="preprocessor">#ifndef _NTDDK_</span>
<a name="l00370"></a><a class="code" href="../../d4/d7/class2_8h.html#a6">00370</a> <span class="preprocessor"></span><span class="preprocessor">#define SCSIPORT_API DECLSPEC_IMPORT</span>
00371 <span class="preprocessor"></span><span class="preprocessor">#else</span>
00372 <span class="preprocessor"></span><span class="preprocessor">#define SCSIPORT_API</span>
00373 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00374 <span class="preprocessor"></span>
00375 <span class="comment">//</span>
00376 <span class="comment">// Class dll routines called by class drivers</span>
00377 <span class="comment">//</span>
00378 
00379 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00380 ULONG
00381 <a class="code" href="../../d4/d7/class2_8h.html#a20">ScsiClassInitialize</a>(
00382     IN  PVOID            Argument1,
00383     IN  PVOID            Argument2,
00384     IN  PCLASS_INIT_DATA InitializationData
00385     );
00386 
00387 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00388 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00389 <a class="code" href="../../d4/d7/class2_8h.html#a21">ScsiClassCreateDeviceObject</a>(
00390     IN <a class="code" href="../../d4/d9/struct__DRIVER__OBJECT.html">PDRIVER_OBJECT</a> DriverObject,
00391     IN PCCHAR ObjectNameBuffer,
00392     IN OPTIONAL <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PhysicalDeviceObject,
00393     IN OUT <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> *DeviceObject,
00394     IN PCLASS_INIT_DATA InitializationData
00395     );
00396 
00397 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00398 ULONG
00399 <a class="code" href="../../d4/d7/class2_8h.html#a22">ScsiClassFindUnclaimedDevices</a>(
00400     IN PCLASS_INIT_DATA InitializationData,
00401     IN PSCSI_ADAPTER_BUS_INFO  AdapterInformation
00402     );
00403 
00404 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00405 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00406 <a class="code" href="../../d4/d7/class2_8h.html#a23">ScsiClassGetCapabilities</a>(
00407     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PortDeviceObject,
00408     OUT PIO_SCSI_CAPABILITIES *PortCapabilities
00409     );
00410 
00411 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00412 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00413 <a class="code" href="../../d4/d7/class2_8h.html#a24">ScsiClassGetInquiryData</a>(
00414     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PortDeviceObject,
00415     IN PSCSI_ADAPTER_BUS_INFO *ConfigInfo
00416     );
00417 
00418 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00419 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00420 <a class="code" href="../../d4/d7/class2_8h.html#a25">ScsiClassReadDriveCapacity</a>(
00421     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00422     );
00423 
00424 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00425 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00426 <a class="code" href="../../d4/d7/class2_8h.html#a26">ScsiClassReleaseQueue</a>(
00427     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject
00428     );
00429 
00430 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00431 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00432 <a class="code" href="../../d4/d7/class2_8h.html#a27">ScsiClassRemoveDevice</a>(
00433     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PortDeviceObject,
00434     IN UCHAR PathId,
00435     IN UCHAR TargetId,
00436     IN UCHAR Lun
00437     );
00438 
00439 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00440 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00441 <a class="code" href="../../d4/d7/class2_8h.html#a28">ScsiClassAsynchronousCompletion</a>(
00442     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00443     <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
00444     PVOID Context
00445     );
00446 
00447 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00448 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00449 <a class="code" href="../../d4/d7/class2_8h.html#a29">ScsiClassSplitRequest</a>(
00450     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00451     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
00452     IN ULONG MaximumBytes
00453     );
00454 
00455 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00456 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00457 <a class="code" href="../../d4/d7/class2_8h.html#a30">ScsiClassDeviceControl</a>(
00458     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00459     <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
00460     );
00461 
00462 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00463 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00464 <a class="code" href="../../d4/d7/class2_8h.html#a31">ScsiClassIoComplete</a>(
00465     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00466     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
00467     IN PVOID Context
00468     );
00469 
00470 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00471 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00472 <a class="code" href="../../d4/d7/class2_8h.html#a32">ScsiClassCheckVerifyComplete</a>(
00473     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00474     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
00475     IN PVOID Context
00476     );
00477 
00478 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00479 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00480 <a class="code" href="../../d4/d7/class2_8h.html#a33">ScsiClassIoCompleteAssociated</a>(
00481     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00482     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
00483     IN PVOID Context
00484     );
00485 
00486 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00487 BOOLEAN
00488 <a class="code" href="../../d4/d7/class2_8h.html#a34">ScsiClassInterpretSenseInfo</a>(
00489     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00490     IN PSCSI_REQUEST_BLOCK Srb,
00491     IN UCHAR MajorFunctionCode,
00492     IN ULONG IoDeviceCode,
00493     IN ULONG RetryCount,
00494     OUT NTSTATUS *Status
00495     );
00496 
00497 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00498 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00499 <a class="code" href="../../d4/d7/class2_8h.html#a35">ScsiClassSendSrbSynchronous</a>(
00500         <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00501         PSCSI_REQUEST_BLOCK Srb,
00502         PVOID BufferAddress,
00503         ULONG BufferLength,
00504         BOOLEAN WriteToDevice
00505         );
00506 
00507 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00508 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00509 <a class="code" href="../../d4/d7/class2_8h.html#a36">ScsiClassSendSrbAsynchronous</a>(
00510         <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00511         PSCSI_REQUEST_BLOCK Srb,
00512         <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp,
00513         PVOID BufferAddress,
00514         ULONG BufferLength,
00515         BOOLEAN WriteToDevice
00516         );
00517 
00518 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00519 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00520 <a class="code" href="../../d4/d7/class2_8h.html#a37">ScsiClassBuildRequest</a>(
00521     <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00522     <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
00523     );
00524 
00525 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00526 ULONG
00527 <a class="code" href="../../d4/d7/class2_8h.html#a38">ScsiClassModeSense</a>(
00528     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00529     IN PCHAR ModeSenseBuffer,
00530     IN ULONG Length,
00531     IN UCHAR PageMode
00532     );
00533 
00534 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00535 BOOLEAN
00536 <a class="code" href="../../d4/d7/class2_8h.html#a39">ScsiClassModeSelect</a>(
00537     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00538     IN PCHAR ModeSelectBuffer,
00539     IN ULONG Length,
00540     IN BOOLEAN SavePage
00541     );
00542 
00543 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00544 PVOID
00545 <a class="code" href="../../d4/d7/class2_8h.html#a40">ScsiClassFindModePage</a>(
00546     IN PCHAR ModeSenseBuffer,
00547     IN ULONG Length,
00548     IN UCHAR PageMode,
00549     IN BOOLEAN Use6Byte
00550     );
00551 
00552 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00553 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00554 <a class="code" href="../../d4/d7/class2_8h.html#a41">ScsiClassClaimDevice</a>(
00555     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> PortDeviceObject,
00556     IN PSCSI_INQUIRY_DATA LunInfo,
00557     IN BOOLEAN Release,
00558     OUT <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> *NewPortDeviceObject OPTIONAL
00559     );
00560 
00561 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00562 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00563 <a class="code" href="../../d4/d7/class2_8h.html#a42">ScsiClassInternalIoControl</a> (
00564     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00565     IN <a class="code" href="../../d0/d2/struct__IRP.html">PIRP</a> Irp
00566     );
00567 
00568 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00569 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00570 <a class="code" href="../../d4/d7/class2_8h.html#a43">ScsiClassInitializeSrbLookasideList</a>(
00571     IN PDEVICE_EXTENSION DeviceExtension,
00572     IN ULONG NumberElements
00573     );
00574 
00575 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00576 ULONG
00577 <a class="code" href="../../d4/d7/class2_8h.html#a44">ScsiClassQueryTimeOutRegistryValue</a>(
00578     IN PUNICODE_STRING RegistryPath
00579     );
00580 
00581 <a class="code" href="../../d4/d7/class2_8h.html#a6">SCSIPORT_API</a>
00582 BOOLEAN
00583 <a class="code" href="../../d4/d7/class2_8h.html#a45">ScsiClassIsFloppyDevice</a>(
00584     IN <a class="code" href="../../d8/d4/struct__DEVICE__OBJECT.html">PDEVICE_OBJECT</a> DeviceObject,
00585     IN PSCSI_INQUIRY_DATA LunInfo
00586     );
00587 
00588 <span class="preprocessor">#endif </span><span class="comment">/* _CLASS_ */</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
