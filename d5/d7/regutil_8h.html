<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: regutil.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>regutil.h File Reference</h1><code>#include &lt;nt.h&gt;</code><br>
<code>#include &lt;ntrtl.h&gt;</code><br>
<code>#include &lt;nturtl.h&gt;</code><br>
<code>#include &lt;windows.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &lt;ctype.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;fcntl.h&gt;</code><br>
<code>#include &lt;malloc.h&gt;</code><br>
<code>#include &lt;sys\types.h&gt;</code><br>
<code>#include &lt;sys\stat.h&gt;</code><br>

<p>
<a href="../../d6/d6/regutil_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">_REG_UNICODE_FILE</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a0">VALUE_BUFFER_SIZE</a>&nbsp;&nbsp;&nbsp;(4096 * 100)</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">_REG_UNICODE_FILE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a1">REG_UNICODE_FILE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">_REG_UNICODE_FILE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a2">PREG_UNICODE_FILE</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a5">RegInitialize</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a6">RegReadBinaryFile</a> (IN PUNICODE_STRING <a class="el" href="../../d8/d1/hivestat_8c.html#a9">FileName</a>, OUT PVOID *<a class="el" href="../../d2/d7/regtest_8c.html#a1">ValueBuffer</a>, OUT PULONG ValueLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a7">RegLoadAsciiFileAsUnicode</a> (IN PUNICODE_STRING <a class="el" href="../../d8/d1/hivestat_8c.html#a9">FileName</a>, OUT <a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">PREG_UNICODE_FILE</a> UnicodeFile)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a8">RegGetNextLine</a> (IN OUT <a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">PREG_UNICODE_FILE</a> UnicodeFile, OUT PULONG IndentAmount, OUT PWSTR *FirstEqual)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a9">RegGetKeyValue</a> (IN PUNICODE_STRING KeyValue, IN OUT <a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">PREG_UNICODE_FILE</a> UnicodeFile, OUT PULONG ValueType, OUT PVOID *<a class="el" href="../../d2/d7/regtest_8c.html#a1">ValueBuffer</a>, OUT PULONG ValueLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a10">RegGetMultiString</a> (IN OUT PUNICODE_STRING ValueString, OUT PUNICODE_STRING MultiString)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a11">RegDumpKeyValue</a> (FILE *fh, PKEY_VALUE_FULL_INFORMATION KeyValueInformation, ULONG IndentLevel)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a12">RegInitializeSecurity</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a13">RegCreateSecurity</a> (IN PUNICODE_STRING <a class="el" href="../../d4/d9/heapdbg_8c.html#a4">Description</a>, OUT PSECURITY_DESCRIPTOR SecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a14">RegDestroySecurity</a> (IN PSECURITY_DESCRIPTOR SecurityDescriptor)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a3">DebugOutput</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/regutil_8h.html#a4">SummaryOutput</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="regutil.h::VALUE_BUFFER_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VALUE_BUFFER_SIZE&nbsp;&nbsp;&nbsp;(4096 * 100)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d6/regutil_8h-source.html#l00039">39</a> of file <a class="el" href="../../d6/d6/regutil_8h-source.html">regutil.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/hivedmp_8c-source.html#l00074">main()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a2" doxytag="regutil.h::PREG_UNICODE_FILE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">_REG_UNICODE_FILE</a> * <a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">PREG_UNICODE_FILE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00259">RegLoadAsciiFileAsUnicode()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="regutil.h::REG_UNICODE_FILE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">_REG_UNICODE_FILE</a>  <a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">REG_UNICODE_FILE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00068">RegReadMultiSzFile()</a>, and <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00031">RiInitializeRegistryFromAsciiFile()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a13" doxytag="regutil.h::RegCreateSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN RegCreateSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>Description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="regutil.h::RegDestroySecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RegDestroySecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SecurityDescriptor</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="regutil.h::RegDumpKeyValue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void RegDumpKeyValue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">FILE *&nbsp;</td>
          <td class="mdname" nowrap> <em>fh</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PKEY_VALUE_FULL_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyValueInformation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>IndentLevel</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00555">555</a> of file <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html">config/utils/regutil.c</a>.
<p>
References <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d6/d6/regutil_8h-source.html#l00067">SummaryOutput</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/hivedmp_8c-source.html#l00238">DumpValues()</a>.
<p>
<pre class="fragment"><div>00560 {
00561     PULONG p;
00562     PWSTR pw, pw1;
00563     ULONG i, j, k, m, cbPrefix;
00564     UNICODE_STRING <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00565     PUCHAR pbyte;
00566 
00567     cbPrefix = fprintf( fh, <span class="stringliteral">"%.*s"</span>,
00568                         IndentLevel,
00569                         <span class="stringliteral">"                                                                                  "</span>
00570                       );
00571     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Buffer = (PWSTR)&amp;(KeyValueInformation-&gt;Name[0]);
00572     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)KeyValueInformation-&gt;NameLength;
00573     <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)KeyValueInformation-&gt;NameLength;
00574 
00575     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>.Length) {
00576         cbPrefix += fprintf( fh, <span class="stringliteral">"%wZ "</span>, &amp;ValueName );
00577         }
00578     cbPrefix += fprintf( fh, <span class="stringliteral">"= "</span> );
00579 
00580     <span class="keywordflow">if</span> (KeyValueInformation-&gt;DataLength == 0) {
00581         fprintf( fh, <span class="stringliteral">" [no data] \n"</span>);
00582         <span class="keywordflow">return</span>;
00583     }
00584 
00585     <span class="keywordflow">switch</span>( KeyValueInformation-&gt;Type ) {
00586     <span class="keywordflow">case</span> REG_SZ:
00587     <span class="keywordflow">case</span> REG_EXPAND_SZ:
00588 
00589         <span class="keywordflow">if</span> (KeyValueInformation-&gt;Type == REG_EXPAND_SZ) {
00590             cbPrefix += fprintf( fh, <span class="stringliteral">"REG_EXPAND_SZ "</span> );
00591         }
00592         pw = (PWSTR)((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset);
00593         *(PWSTR)((PCHAR)pw + KeyValueInformation-&gt;DataLength) = UNICODE_NULL;
00594         i = 0;
00595         <span class="keywordflow">while</span> (*pw) {
00596             <span class="keywordflow">if</span> ((cbPrefix + wcslen(pw)) &gt; 80) {
00597                 pw1 = pw;
00598                 <span class="keywordflow">while</span> (*pw1 &amp;&amp; *pw1 &gt; <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00599                     pw1++;
00600                 }
00601 
00602                 <span class="keywordflow">if</span> (*pw1) {
00603                     *pw1++ = UNICODE_NULL;
00604                     <span class="keywordflow">while</span> (*pw1 &amp;&amp; *pw1 &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00605                         pw1++;
00606                     }
00607                 }
00608             } <span class="keywordflow">else</span> {
00609                 pw1 = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00610             }
00611             <span class="keywordflow">if</span> (i &gt; 0) {
00612                 fprintf( fh, <span class="stringliteral">" \\\n%.*s"</span>,
00613                          cbPrefix,
00614                          <span class="stringliteral">"                                                                                  "</span>
00615                        );
00616             }
00617 
00618             fprintf( fh, <span class="stringliteral">"%ws"</span>, pw );
00619             <span class="keywordflow">if</span> (!pw1) {
00620                 <span class="keywordflow">break</span>;
00621                 }
00622             i++;
00623             pw = pw1;
00624         }
00625         <span class="keywordflow">break</span>;
00626 
00627     <span class="keywordflow">case</span> REG_BINARY:
00628         fprintf( fh, <span class="stringliteral">"REG_BINARY 0x%08lx"</span>, KeyValueInformation-&gt;DataLength );
00629         p = (PULONG)((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset);
00630         i = (KeyValueInformation-&gt;DataLength + 3) / <span class="keyword">sizeof</span>( ULONG );
00631         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7/regutil_8h.html#a4">SummaryOutput</a> || i &lt;= 8) {
00632             <span class="keywordflow">for</span> (j=0; j&lt;i; j++) {
00633                 <span class="keywordflow">if</span> ((j % 8) == 0) {
00634                     fprintf( fh, <span class="stringliteral">"\n%.*s"</span>,
00635                              IndentLevel+4,
00636                              <span class="stringliteral">"                                                                                  "</span>
00637                            );
00638                     }
00639 
00640                 fprintf( fh, <span class="stringliteral">"0x%08lx  "</span>, *p++ );
00641                 }
00642             }
00643         <span class="keywordflow">else</span> {
00644             fprintf( fh, <span class="stringliteral">" *** value display suppressed ***"</span> );
00645             }
00646         fprintf( fh, <span class="stringliteral">"\n"</span> );
00647         <span class="keywordflow">break</span>;
00648 
00649 <span class="comment">//  case REG_DWORD_LITTLE_ENDIAN:</span>
00650     <span class="keywordflow">case</span> REG_DWORD:
00651         fprintf( fh, <span class="stringliteral">"REG_DWORD 0x%08lx"</span>,
00652                  *((PULONG)((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset))
00653                );
00654         <span class="keywordflow">break</span>;
00655 
00656     <span class="keywordflow">case</span> REG_DWORD_BIG_ENDIAN:
00657         fprintf( fh, <span class="stringliteral">"REG_DWORD_BIG_ENDIAN 0x%08lx"</span>,
00658                  *((PULONG)((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset))
00659                );
00660         <span class="keywordflow">break</span>;
00661 
00662     <span class="keywordflow">case</span> REG_LINK:
00663         fprintf( fh, <span class="stringliteral">"REG_LINK %ws"</span>,
00664                  ((PWSTR)((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset))
00665                );
00666         <span class="keywordflow">break</span>;
00667 
00668     <span class="keywordflow">case</span> REG_MULTI_SZ:
00669         cbPrefix += fprintf( fh, <span class="stringliteral">"REG_MULTI_SZ "</span> );
00670         pw = (PWSTR)((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset);
00671         i  = 0;
00672         <span class="keywordflow">if</span> (*pw)
00673         <span class="keywordflow">while</span> (i &lt; ((KeyValueInformation-&gt;DataLength-1) / <span class="keyword">sizeof</span>(WCHAR))) {
00674             <span class="keywordflow">if</span> (i &gt; 0) {
00675                 fprintf( fh, <span class="stringliteral">" \\\n%.*s"</span>,
00676                          cbPrefix,
00677                          <span class="stringliteral">"                                                                                  "</span>
00678                        );
00679             }
00680             fprintf(fh, <span class="stringliteral">"\"%ws\" "</span>,pw+i);
00681             <span class="keywordflow">do</span> {
00682                 ++i;
00683             } <span class="keywordflow">while</span> ( pw[i] != UNICODE_NULL );
00684             ++i;
00685         }
00686         <span class="keywordflow">break</span>;
00687 
00688     <span class="keywordflow">case</span> REG_RESOURCE_LIST:
00689     <span class="keywordflow">case</span> REG_FULL_RESOURCE_DESCRIPTOR:
00690         {
00691         PCM_RESOURCE_LIST ResourceList = ((PCM_RESOURCE_LIST)((PCHAR)KeyValueInformation +
00692                                           KeyValueInformation-&gt;DataOffset));
00693         PCM_FULL_RESOURCE_DESCRIPTOR FullDescriptor;
00694         PCM_PARTIAL_RESOURCE_DESCRIPTOR PartialResourceDescriptor;
00695         ULONG k, l, count;
00696         PWSTR TypeName;
00697         PWSTR FlagName;
00698         ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = KeyValueInformation-&gt;DataLength;
00699 
00700         <span class="keywordflow">if</span> (KeyValueInformation-&gt;Type == REG_RESOURCE_LIST) {
00701 
00702             fprintf( fh, <span class="stringliteral">"   REG_RESOURCE_LIST\n"</span>);
00703 
00704             fprintf( fh, <span class="stringliteral">"%.*sNumber of Full resource Descriptors = %d"</span>,
00705                      IndentLevel,
00706                      <span class="stringliteral">"                                                                                  "</span>,
00707                      ResourceList-&gt;Count
00708                    );
00709 
00710              count = ResourceList-&gt;Count;
00711              FullDescriptor = &amp;ResourceList-&gt;List[0];
00712 
00713         } <span class="keywordflow">else</span> {
00714 
00715             fprintf( fh, <span class="stringliteral">"   REG_FULL_RESOURCE_DESCRIPTOR\n"</span>);
00716             count = 1;
00717             FullDescriptor = ((PCM_FULL_RESOURCE_DESCRIPTOR)
00718                 ((PCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset));
00719 
00720         }
00721 
00722         <span class="keywordflow">for</span> (i=0; i&lt; count; i++) {
00723 
00724             fprintf( fh, <span class="stringliteral">"\n%.*sPartial List number %d\n"</span>,
00725                      IndentLevel+4,
00726                      <span class="stringliteral">"                                                                                  "</span>,
00727                      i
00728                    );
00729 
00730             <span class="keywordflow">switch</span>(FullDescriptor-&gt;InterfaceType) {
00731 
00732             <span class="keywordflow">case</span> Internal:      TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Internal"</span>;         <span class="keywordflow">break</span>;
00733             <span class="keywordflow">case</span> Isa:           TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Isa"</span>;              <span class="keywordflow">break</span>;
00734             <span class="keywordflow">case</span> Eisa:          TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Eisa"</span>;             <span class="keywordflow">break</span>;
00735             <span class="keywordflow">case</span> MicroChannel:  TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MicroChannel"</span>;     <span class="keywordflow">break</span>;
00736             <span class="keywordflow">case</span> TurboChannel:  TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"TurboChannel"</span>;     <span class="keywordflow">break</span>;
00737             <span class="keywordflow">case</span> PCIBus:        TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PCI"</span>;              <span class="keywordflow">break</span>;
00738             <span class="keywordflow">case</span> VMEBus:        TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"VME"</span>;              <span class="keywordflow">break</span>;
00739             <span class="keywordflow">case</span> NuBus:         TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"NuBus"</span>;            <span class="keywordflow">break</span>;
00740             <span class="keywordflow">case</span> PCMCIABus:     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PCMCIA"</span>;           <span class="keywordflow">break</span>;
00741             <span class="keywordflow">case</span> CBus:          TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CBUS"</span>;             <span class="keywordflow">break</span>;
00742             <span class="keywordflow">case</span> MPIBus:        TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MPI"</span>;              <span class="keywordflow">break</span>;
00743 
00744             <span class="keywordflow">default</span>:
00745                 TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***invalid bus type***"</span>;
00746                 <span class="keywordflow">break</span>;
00747             }
00748 
00749             fprintf( fh, <span class="stringliteral">"%.*sINTERFACE_TYPE %ws\n"</span>,
00750                      IndentLevel+8,
00751                      <span class="stringliteral">"                                                                                  "</span>,
00752                      TypeName
00753                    );
00754 
00755             fprintf( fh, <span class="stringliteral">"%.*sBUS_NUMBER  %d\n"</span>,
00756                      IndentLevel+8,
00757                      <span class="stringliteral">"                                                                                  "</span>,
00758                      FullDescriptor-&gt;BusNumber
00759                    );
00760 
00761             <span class="comment">//</span>
00762             <span class="comment">// This is a basic test to see if the data format is right.</span>
00763             <span class="comment">// We know at least some video resource list are bogus ...</span>
00764             <span class="comment">//</span>
00765 
00766             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> &lt; FullDescriptor-&gt;PartialResourceList.Count *
00767                          <span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_DESCRIPTOR) ) {
00768 
00769                 fprintf( fh, <span class="stringliteral">"\n%.*s *** !!! Invalid ResourceList !!! *** \n"</span>,
00770                          IndentLevel+8,
00771                          <span class="stringliteral">"                                                                                  "</span>,
00772                          i
00773                        );
00774 
00775                 <span class="keywordflow">break</span>;
00776             }
00777 
00778             <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> -= FullDescriptor-&gt;PartialResourceList.Count *
00779                          <span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_DESCRIPTOR);
00780 
00781 
00782 
00783             <span class="keywordflow">for</span> (j=0; j&lt;FullDescriptor-&gt;PartialResourceList.Count; j++) {
00784 
00785                 fprintf( fh, <span class="stringliteral">"%.*sDescriptor number %d\n"</span>,
00786                          IndentLevel+12,
00787                          <span class="stringliteral">"                                                                                  "</span>,
00788                          j
00789                        );
00790 
00791                 PartialResourceDescriptor =
00792             &amp;(FullDescriptor-&gt;PartialResourceList.PartialDescriptors[j]);
00793 
00794                 <span class="keywordflow">switch</span>(PartialResourceDescriptor-&gt;ShareDisposition) {
00795 
00796                 <span class="keywordflow">case</span> CmResourceShareUndetermined:
00797                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CmResourceShareUndetermined"</span>;
00798                     <span class="keywordflow">break</span>;
00799                 <span class="keywordflow">case</span> CmResourceShareDeviceExclusive:
00800                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CmResourceDeviceExclusive"</span>;
00801                     <span class="keywordflow">break</span>;
00802                 <span class="keywordflow">case</span> CmResourceShareDriverExclusive:
00803                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CmResourceDriverExclusive"</span>;
00804                     <span class="keywordflow">break</span>;
00805                 <span class="keywordflow">case</span> CmResourceShareShared:
00806                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CmResourceShared"</span>;
00807                     <span class="keywordflow">break</span>;
00808                 <span class="keywordflow">default</span>:
00809                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***invalid share disposition***"</span>;
00810                     <span class="keywordflow">break</span>;
00811                 }
00812 
00813                 fprintf( fh, <span class="stringliteral">"%.*sShare Disposition %ws\n"</span>,
00814                          IndentLevel+12,
00815                          <span class="stringliteral">"                                                                                  "</span>,
00816                          TypeName
00817                        );
00818 
00819                 FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***invalid Flags"</span>;
00820 
00821                 <span class="keywordflow">switch</span>(PartialResourceDescriptor-&gt;Type) {
00822 
00823                 <span class="keywordflow">case</span> CmResourceTypeNull:
00824                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"NULL"</span>;
00825                     FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***Unused"</span>;
00826                     <span class="keywordflow">break</span>;
00827                 <span class="keywordflow">case</span> CmResourceTypePort:
00828                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"PORT"</span>;
00829                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_PORT_MEMORY) {
00830                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_PORT_MEMORY"</span>;
00831                     }
00832                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_PORT_IO) {
00833                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_PORT_IO"</span>;
00834                     }
00835                     <span class="keywordflow">break</span>;
00836                 <span class="keywordflow">case</span> CmResourceTypeInterrupt:
00837                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"INTERRUPT"</span>;
00838                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_INTERRUPT_LEVEL_SENSITIVE) {
00839                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_INTERRUPT_LEVEL_SENSITIVE"</span>;
00840                     }
00841                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_INTERRUPT_LATCHED) {
00842                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_INTERRUPT_LATCHED"</span>;
00843                     }
00844                     <span class="keywordflow">break</span>;
00845                 <span class="keywordflow">case</span> CmResourceTypeMemory:
00846                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"MEMORY"</span>;
00847                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_MEMORY_READ_WRITE) {
00848                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_MEMORY_READ_WRITE"</span>;
00849                     }
00850                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_MEMORY_READ_ONLY) {
00851                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_MEMORY_READ_ONLY"</span>;
00852                     }
00853                     <span class="keywordflow">if</span> (PartialResourceDescriptor-&gt;Flags == CM_RESOURCE_MEMORY_WRITE_ONLY) {
00854                         FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"CM_RESOURCE_MEMORY_WRITE_ONLY"</span>;
00855                     }
00856                     <span class="keywordflow">break</span>;
00857                 <span class="keywordflow">case</span> CmResourceTypeDma:
00858                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"DMA"</span>;
00859                     FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***Unused"</span>;
00860                     <span class="keywordflow">break</span>;
00861                 <span class="keywordflow">case</span> CmResourceTypeDeviceSpecific:
00862                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"DEVICE SPECIFIC"</span>;
00863                     FlagName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***Unused"</span>;
00864                     <span class="keywordflow">break</span>;
00865                 <span class="keywordflow">default</span>:
00866                     TypeName = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"***invalid type***"</span>;
00867                     <span class="keywordflow">break</span>;
00868                 }
00869 
00870                 fprintf( fh, <span class="stringliteral">"%.*sTYPE              %ws\n"</span>,
00871                          IndentLevel+12,
00872                          <span class="stringliteral">"                                                                                  "</span>,
00873                          TypeName
00874                        );
00875 
00876                 fprintf( fh, <span class="stringliteral">"%.*sFlags             %ws\n"</span>,
00877                          IndentLevel+12,
00878                          <span class="stringliteral">"                                                                                  "</span>,
00879                          FlagName
00880                        );
00881 
00882                 <span class="keywordflow">switch</span>(PartialResourceDescriptor-&gt;Type) {
00883 
00884                 <span class="keywordflow">case</span> CmResourceTypePort:
00885                     fprintf( fh, <span class="stringliteral">"%.*sSTART 0x%08lx  LENGTH 0x%08lx\n"</span>,
00886                              IndentLevel+12,
00887                              <span class="stringliteral">"                                                                                  "</span>,
00888                              PartialResourceDescriptor-&gt;u.Port.Start.LowPart,
00889                              PartialResourceDescriptor-&gt;u.Port.Length
00890                            );
00891                     <span class="keywordflow">break</span>;
00892 
00893                 <span class="keywordflow">case</span> CmResourceTypeInterrupt:
00894                     fprintf( fh, <span class="stringliteral">"%.*sLEVEL %d  VECTOR %d  AFFINITY %d\n"</span>,
00895                              IndentLevel+12,
00896                              <span class="stringliteral">"                                                                                  "</span>,
00897                              PartialResourceDescriptor-&gt;u.Interrupt.Level,
00898                              PartialResourceDescriptor-&gt;u.Interrupt.Vector,
00899                              PartialResourceDescriptor-&gt;u.Interrupt.Affinity
00900                            );
00901                     <span class="keywordflow">break</span>;
00902 
00903                 <span class="keywordflow">case</span> CmResourceTypeMemory:
00904                     fprintf( fh, <span class="stringliteral">"%.*sSTART 0x%08lx%08lx  LENGTH 0x%08lx\n"</span>,
00905                              IndentLevel+12,
00906                              <span class="stringliteral">"                                                                                  "</span>,
00907                              PartialResourceDescriptor-&gt;u.Memory.Start.HighPart,
00908                              PartialResourceDescriptor-&gt;u.Memory.Start.LowPart,
00909                              PartialResourceDescriptor-&gt;u.Memory.Length
00910                            );
00911                     <span class="keywordflow">break</span>;
00912 
00913                 <span class="keywordflow">case</span> CmResourceTypeDma:
00914                     fprintf( fh, <span class="stringliteral">"%.*sCHANNEL %d  PORT %d\n"</span>,
00915                              IndentLevel+12,
00916                              <span class="stringliteral">"                                                                                  "</span>,
00917                              PartialResourceDescriptor-&gt;u.Dma.Channel,
00918                              PartialResourceDescriptor-&gt;u.Dma.Port
00919                            );
00920                     <span class="keywordflow">break</span>;
00921 
00922                 <span class="keywordflow">case</span> CmResourceTypeDeviceSpecific:
00923                     fprintf( fh, <span class="stringliteral">"%.*sDataSize 0x%08lx\n"</span>,
00924                              IndentLevel+12,
00925                              <span class="stringliteral">"                                                                                  "</span>,
00926                              PartialResourceDescriptor-&gt;u.DeviceSpecificData.DataSize
00927                            );
00928 
00929                     p = (PULONG)(PartialResourceDescriptor + 1);
00930                     k = (PartialResourceDescriptor-&gt;u.DeviceSpecificData.DataSize + 3) / <span class="keyword">sizeof</span>( ULONG );
00931                     <span class="keywordflow">for</span> (l=0; l&lt;k; l++) {
00932                         <span class="keywordflow">if</span> ((l % 8) == 0) {
00933                             fprintf( fh, <span class="stringliteral">"\n%.*s"</span>,
00934                                 IndentLevel+12,
00935                                 <span class="stringliteral">"                                                                                  "</span>
00936                                );
00937                         }
00938 
00939                         fprintf( fh, <span class="stringliteral">"0x%08lx  "</span>, *p++ );
00940                     }
00941                     fprintf( fh, <span class="stringliteral">"\n"</span> );
00942                     <span class="keywordflow">break</span>;
00943 
00944                 <span class="keywordflow">default</span>:
00945                     fprintf( fh, <span class="stringliteral">"%.*s*** Unknown resource list type: %c ****\n"</span>,
00946                              IndentLevel+12,
00947                              <span class="stringliteral">"                                                                                  "</span>,
00948                              PartialResourceDescriptor-&gt;Type
00949                            );
00950                     <span class="keywordflow">break</span>;
00951                 }
00952 
00953                 fprintf( fh, <span class="stringliteral">"\n"</span> );
00954             }
00955 
00956             FullDescriptor = (PCM_FULL_RESOURCE_DESCRIPTOR) (PartialResourceDescriptor+1);
00957         }
00958 
00959         <span class="keywordflow">break</span>;
00960         }
00961 
00962     <span class="keywordflow">case</span> REG_NONE:
00963     <span class="keywordflow">default</span>:
00964         <span class="keywordflow">if</span> (KeyValueInformation-&gt;Type == REG_NONE) {
00965             fprintf( fh, <span class="stringliteral">"REG_NONE\n"</span>);
00966             }
00967         <span class="keywordflow">else</span> {
00968             fprintf( fh, <span class="stringliteral">"*** Unknown registry type (%08lx)"</span>,
00969                      KeyValueInformation-&gt;Type
00970                    );
00971             }
00972         fprintf( fh, <span class="stringliteral">"%.*s"</span>,
00973              IndentLevel,
00974              <span class="stringliteral">"                                                                                  "</span>
00975              );
00976         fprintf( fh, <span class="stringliteral">"    Length: 0x%lx\n"</span>, KeyValueInformation-&gt;DataLength );
00977                 fprintf( fh, <span class="stringliteral">"\n%.*s"</span>,
00978                     IndentLevel,
00979                     <span class="stringliteral">"                                                                                  "</span>
00980                     );
00981         fprintf( fh, <span class="stringliteral">"      Data: "</span>);
00982         pbyte = ((PUCHAR)KeyValueInformation + KeyValueInformation-&gt;DataOffset);
00983         <span class="keywordflow">for</span> ( k=0, m=1; k&lt;KeyValueInformation-&gt;DataLength; k++,m++) {
00984             fprintf( fh, <span class="stringliteral">"%02x "</span>, (*pbyte) );
00985             pbyte++;
00986 
00987             <span class="keywordflow">if</span> (m==8) {
00988                 fprintf( fh, <span class="stringliteral">"\n%.*s"</span>,
00989                     IndentLevel+12,
00990                     <span class="stringliteral">"                                                                                  "</span>
00991                     );
00992                 m=0;
00993             }
00994         }
00995         <span class="keywordflow">break</span>;
00996     }
00997 
00998     fprintf( fh, <span class="stringliteral">"\n"</span> );
00999     <span class="keywordflow">return</span>;
01000 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="regutil.h::RegGetKeyValue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN RegGetKeyValue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyValue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">PREG_UNICODE_FILE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>UnicodeFile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l01096">1096</a> of file <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html">config/utils/regutil.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d8/d9/exts_8h-source.html#l00092">n</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d7/config_2utils_2regutil_8c.html#a3">NUMBER_DATE_TIME_FIELDS</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l01009">RegGetMultiString()</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00473">RegGetNextLine()</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00158">RegReadBinaryFile()</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00068">RegReadMultiSzFile()</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00031">RiDeleteKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00030">RiFalseKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00029">RiNoKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00028">RiOffKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00025">RiOnKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00038">RiRegBinaryFileKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00037">RiRegBinaryKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00042">RiRegDateKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00036">RiRegDwordKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00035">RiRegExpandSzKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00032">RiRegKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00039">RiRegLinkKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00041">RiRegMultiSzFileKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00040">RiRegMultiSzKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00033">RiRegNoneKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00034">RiRegSzKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00027">RiTrueKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00026">RiYesKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00022">RtlAllocateHeap</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01690">RtlPrefixUnicodeString()</a>, <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00225">RtlUnicodeStringToInteger()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, and <a class="el" href="../../d2/d0/hivedmp_8c-source.html#l00060">ValueBuffer</a>.
<p>
Referenced by <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00031">RiInitializeRegistryFromAsciiFile()</a>.
<p>
<pre class="fragment"><div>01103 {
01104     ULONG PrefixLength;
01105     PWSTR s;
01106     PULONG p;
01107     ULONG <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
01108     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01109     ULONG IndentAmount;
01110     PWSTR FirstEqual;
01111     UNICODE_STRING KeyValue;
01112     UNICODE_STRING MultiValue;
01113     BOOLEAN GetDataFromBinaryFile = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01114     BOOLEAN GetDataFromMultiSzFile = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01115     BOOLEAN ParseDateTime = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01116 
01117     KeyValue = *InitialKeyValue;
01118     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiDeleteKeyword, &amp;KeyValue, TRUE )) {
01119         *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01120         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01121         }
01122     <span class="keywordflow">else</span>
01123     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiRegKeyword, &amp;KeyValue, TRUE )) {
01124         *ValueType = REG_SZ;
01125         PrefixLength = 0;
01126         }
01127     <span class="keywordflow">else</span>
01128     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiRegNoneKeyword, &amp;KeyValue, TRUE )) {
01129         *ValueType = REG_NONE;
01130         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a12">RiRegNoneKeyword</a>.Length;
01131         }
01132     <span class="keywordflow">else</span>
01133     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiRegSzKeyword, &amp;KeyValue, TRUE )) {
01134         *ValueType = REG_SZ;
01135         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a13">RiRegSzKeyword</a>.Length;
01136         }
01137     <span class="keywordflow">else</span>
01138     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiRegExpandSzKeyword, &amp;KeyValue, TRUE )) {
01139         *ValueType = REG_EXPAND_SZ;
01140         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a14">RiRegExpandSzKeyword</a>.Length;
01141         }
01142     <span class="keywordflow">else</span>
01143     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiRegDwordKeyword, &amp;KeyValue, TRUE )) {
01144         *ValueType = REG_DWORD;
01145         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a15">RiRegDwordKeyword</a>.Length;
01146         }
01147     <span class="keywordflow">else</span>
01148     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiRegBinaryFileKeyword, &amp;KeyValue, TRUE )) {
01149         *ValueType = REG_BINARY;
01150         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a17">RiRegBinaryFileKeyword</a>.Length;
01151         GetDataFromBinaryFile = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01152         }
01153     <span class="keywordflow">else</span>
01154     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiRegBinaryKeyword, &amp;KeyValue, TRUE )) {
01155         *ValueType = REG_BINARY;
01156         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a16">RiRegBinaryKeyword</a>.Length;
01157         }
01158     <span class="keywordflow">else</span>
01159     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiRegLinkKeyword, &amp;KeyValue, TRUE )) {
01160         *ValueType = REG_LINK;
01161         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a18">RiRegLinkKeyword</a>.Length;
01162         }
01163     <span class="keywordflow">else</span>
01164     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiRegMultiSzFileKeyword, &amp;KeyValue, TRUE)) {
01165         *ValueType = REG_MULTI_SZ;
01166         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a20">RiRegMultiSzFileKeyword</a>.Length;
01167         GetDataFromMultiSzFile = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01168         }
01169     <span class="keywordflow">else</span>
01170     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiRegMultiSzKeyword, &amp;KeyValue, TRUE)) {
01171         *ValueType = REG_MULTI_SZ;
01172         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a19">RiRegMultiSzKeyword</a>.Length;
01173         }
01174     <span class="keywordflow">else</span>
01175     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiRegDateKeyword, &amp;KeyValue, TRUE )) {
01176         *ValueType = REG_BINARY;
01177         ParseDateTime = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01178         PrefixLength = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a21">RiRegDateKeyword</a>.Length;
01179         }
01180     <span class="keywordflow">else</span> {
01181         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01182         }
01183 
01184     <span class="keywordflow">if</span> (*ValueType != REG_NONE) {
01185         s = (PWSTR)
01186             ((PCHAR)KeyValue.Buffer + PrefixLength);
01187         KeyValue.Length -= (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)PrefixLength;
01188         <span class="keywordflow">while</span> (KeyValue.Length != 0 &amp;&amp; *s &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
01189             s++;
01190             KeyValue.Length -= <span class="keyword">sizeof</span>( WCHAR );
01191             }
01192         KeyValue.Buffer = s;
01193         }
01194     <span class="keywordflow">else</span> {
01195         *ValueType = REG_SZ;
01196         }
01197 
01198 
01199     <span class="keywordflow">if</span> (GetDataFromBinaryFile) {
01200         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d7/regutil_8h.html#a6">RegReadBinaryFile</a>( &amp;KeyValue, ValueBuffer, ValueLength );
01201         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01202             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01203             }
01204         <span class="keywordflow">else</span> {
01205             fprintf( stderr, <span class="stringliteral">"REGINI: Unable to read data from %wZ - Status == %lx\n"</span>, &amp;KeyValue, Status );
01206             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01207             }
01208         }
01209 
01210     <span class="keywordflow">if</span> (GetDataFromMultiSzFile) {
01211         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a23">RegReadMultiSzFile</a>( &amp;KeyValue, ValueBuffer, ValueLength );
01212         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01213             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01214             }
01215         <span class="keywordflow">else</span> {
01216             fprintf( stderr, <span class="stringliteral">"REGINI: Unable to read data from %wZ - Status == %lx\n"</span>, &amp;KeyValue, Status );
01217             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01218             }
01219         }
01220 
01221     <span class="keywordflow">switch</span>( *ValueType ) {
01222     <span class="keywordflow">case</span> REG_SZ:
01223     <span class="keywordflow">case</span> REG_EXPAND_SZ:
01224     <span class="keywordflow">case</span> REG_LINK:
01225         *ValueLength = KeyValue.Length + <span class="keyword">sizeof</span>( UNICODE_NULL );
01226         *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, *ValueLength );
01227         <span class="keywordflow">if</span> (*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01228             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01229             }
01230 
01231         RtlMoveMemory( *ValueBuffer, KeyValue.Buffer, KeyValue.Length );
01232         ((PWSTR)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>)[ KeyValue.Length / <span class="keyword">sizeof</span>( WCHAR ) ] = UNICODE_NULL;
01233         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01234 
01235     <span class="keywordflow">case</span> REG_DWORD:
01236         *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, <span class="keyword">sizeof</span>( ULONG ) );
01237         <span class="keywordflow">if</span> (*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01238             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01239             }
01240 
01241         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiTrueKeyword, &amp;KeyValue, TRUE ) ||
01242             <a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiYesKeyword, &amp;KeyValue, TRUE ) ||
01243             <a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiOnKeyword, &amp;KeyValue, TRUE )
01244            ) {
01245             *(PULONG)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = (ULONG)<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01246             }
01247         <span class="keywordflow">else</span>
01248         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiFalseKeyword, &amp;KeyValue, TRUE ) ||
01249             <a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiNoKeyword, &amp;KeyValue, TRUE ) ||
01250             <a class="code" href="../../d6/d6/nls_8c.html#a43">RtlPrefixUnicodeString</a>( &amp;RiOffKeyword, &amp;KeyValue, TRUE )
01251            ) {
01252             *(PULONG)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = (ULONG)<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01253             }
01254         <span class="keywordflow">else</span> {
01255             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a>( &amp;KeyValue, 0, (PULONG)*ValueBuffer );
01256             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01257                 fprintf( stderr, <span class="stringliteral">"REGINI: CharToInteger( %wZ ) failed - Status == %lx\n"</span>, &amp;KeyValue, Status );
01258                 <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *ValueBuffer );
01259                 <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01260                 }
01261             }
01262 
01263         *ValueLength = <span class="keyword">sizeof</span>( ULONG );
01264         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01265 
01266     <span class="keywordflow">case</span> REG_BINARY:
01267         <span class="keywordflow">if</span> (ParseDateTime) {
01268 <span class="preprocessor">#define NUMBER_DATE_TIME_FIELDS 6</span>
01269 <span class="preprocessor"></span>            ULONG FieldIndexes[ <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a3">NUMBER_DATE_TIME_FIELDS</a>  ] = {1, 2, 0, 3, 4, 7};
01270             <span class="comment">//</span>
01271             <span class="comment">// Month/Day/Year HH:MM DayOfWeek</span>
01272             <span class="comment">//</span>
01273 
01274             ULONG CurrentField = 0;
01275             PCSHORT Fields;
01276             TIME_FIELDS DateTimeFields;
01277             UNICODE_STRING Field;
01278             ULONG FieldValue;
01279 
01280             RtlZeroMemory( &amp;DateTimeFields, <span class="keyword">sizeof</span>( DateTimeFields ) );
01281             Fields = &amp;DateTimeFields.Year;
01282             <span class="keywordflow">while</span> (KeyValue.Length) {
01283                 <span class="keywordflow">if</span> (CurrentField &gt;= 7) {
01284                     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01285                     }
01286 
01287                 s = KeyValue.Buffer;
01288                 <span class="keywordflow">while</span> (KeyValue.Length &amp;&amp; *s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
01289                     KeyValue.Length--;
01290                     s++;
01291                     }
01292 
01293                 Field.Buffer = s;
01294                 <span class="keywordflow">while</span> (KeyValue.Length) {
01295                     <span class="keywordflow">if</span> (CurrentField == (<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a3">NUMBER_DATE_TIME_FIELDS</a>-1)) {
01296                         }
01297                     <span class="keywordflow">else</span>
01298                     <span class="keywordflow">if</span> (*s &lt; L'0' || *s &gt; <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'9'</span>) {
01299                         <span class="keywordflow">break</span>;
01300                         }
01301 
01302                     KeyValue.Length--;
01303                     s++;
01304                     }
01305 
01306                 Field.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((PCHAR)s - (PCHAR)Field.Buffer);
01307                 Field.MaximumLength = Field.Length;
01308 
01309                 <span class="keywordflow">if</span> (KeyValue.Length) {
01310                     KeyValue.Length--;
01311                     s++;
01312                     }
01313                 KeyValue.Buffer = s;
01314 
01315                 <span class="keywordflow">if</span> (CurrentField == (<a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a3">NUMBER_DATE_TIME_FIELDS</a>-1)) {
01316                     <span class="keywordflow">if</span> (Field.Length &lt; 3) {
01317                         printf( <span class="stringliteral">"REGINI: %wZ invalid day of week length\n"</span>, &amp;Field );
01318                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01319                         }
01320 
01321                     <span class="keywordflow">if</span> (DateTimeFields.Year != 0) {
01322                         printf( <span class="stringliteral">"REGINI: Year must be zero to specify day of week\n"</span> );
01323                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01324                         }
01325 
01326                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, L<span class="stringliteral">"SUN"</span>, 3 )) {
01327                         FieldValue = 0;
01328                         }
01329                     <span class="keywordflow">else</span>
01330                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, L<span class="stringliteral">"MON"</span>, 3 )) {
01331                         FieldValue = 1;
01332                         }
01333                     <span class="keywordflow">else</span>
01334                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, L<span class="stringliteral">"TUE"</span>, 3 )) {
01335                         FieldValue = 2;
01336                         }
01337                     <span class="keywordflow">else</span>
01338                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, L<span class="stringliteral">"WED"</span>, 3 )) {
01339                         FieldValue = 3;
01340                         }
01341                     <span class="keywordflow">else</span>
01342                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, L<span class="stringliteral">"THU"</span>, 3 )) {
01343                         FieldValue = 4;
01344                         }
01345                     <span class="keywordflow">else</span>
01346                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, L<span class="stringliteral">"FRI"</span>, 3 )) {
01347                         FieldValue = 5;
01348                         }
01349                     <span class="keywordflow">else</span>
01350                     <span class="keywordflow">if</span> (!_wcsnicmp( Field.Buffer, L<span class="stringliteral">"SAT"</span>, 3 )) {
01351                         FieldValue = 6;
01352                         }
01353                     <span class="keywordflow">else</span> {
01354                         printf( <span class="stringliteral">"REGINI: %wZ invalid day of week\n"</span>, &amp;Field );
01355                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01356                         }
01357                     }
01358                 <span class="keywordflow">else</span> {
01359                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a>( &amp;Field, 10, &amp;FieldValue );
01360                     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01361                         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01362                         }
01363                     }
01364 
01365                 Fields[ FieldIndexes[ CurrentField++ ] ] = (CSHORT)FieldValue;
01366                 }
01367 
01368             <span class="keywordflow">if</span> (DateTimeFields.Year == 0) {
01369                 <span class="keywordflow">if</span> (DateTimeFields.Day &gt; 5) {
01370                     printf( <span class="stringliteral">"REGINI: Day must be 0 - 5 if year is zero.\n"</span> );
01371                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01372                     }
01373                 }
01374             <span class="keywordflow">else</span>
01375             <span class="keywordflow">if</span> (DateTimeFields.Year &lt; 100) {
01376                 DateTimeFields.Year += 1900;
01377                 }
01378 
01379             *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, <span class="keyword">sizeof</span>( DateTimeFields ) );
01380             *ValueLength = <span class="keyword">sizeof</span>( DateTimeFields );
01381             RtlMoveMemory( *ValueBuffer, &amp;DateTimeFields, <span class="keyword">sizeof</span>( DateTimeFields ) );
01382             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01383             }
01384         <span class="keywordflow">else</span> {
01385             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a>( &amp;KeyValue, 0, ValueLength );
01386             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01387                 <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01388                 }
01389             s = KeyValue.Buffer;
01390             <span class="keywordflow">while</span> (KeyValue.Length != 0 &amp;&amp; *s &gt; <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
01391                 s++;
01392                 KeyValue.Length -= <span class="keyword">sizeof</span>( WCHAR );
01393                 }
01394             KeyValue.Buffer = s;
01395             }
01396         <span class="keywordflow">break</span>;
01397 
01398     <span class="keywordflow">case</span> REG_MULTI_SZ:
01399         *ValueLength = 0;
01400         *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, KeyValue.Length + <span class="keyword">sizeof</span>( UNICODE_NULL ) );
01401         <span class="keywordflow">while</span> (<a class="code" href="../../d5/d7/regutil_8h.html#a10">RegGetMultiString</a>(&amp;KeyValue, &amp;MultiValue)) {
01402             RtlMoveMemory( (PUCHAR)*ValueBuffer + *ValueLength,
01403                            MultiValue.Buffer,
01404                            MultiValue.Length );
01405             *ValueLength += MultiValue.Length;
01406             ((PWSTR)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>)[ *ValueLength / <span class="keyword">sizeof</span>(WCHAR) ] = UNICODE_NULL;
01407             *ValueLength += <span class="keyword">sizeof</span>(UNICODE_NULL);
01408         }
01409         ((PWSTR)*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>)[ *ValueLength / <span class="keyword">sizeof</span>(WCHAR) ] = UNICODE_NULL;
01410         *ValueLength += <span class="keyword">sizeof</span>(UNICODE_NULL);
01411 
01412         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01413 
01414     <span class="keywordflow">default</span>:
01415         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01416     }
01417 
01418     *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, *ValueLength );
01419     p = *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a>;
01420     <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = (*ValueLength + <span class="keyword">sizeof</span>( ULONG ) - 1) / <span class="keyword">sizeof</span>( ULONG );
01421     <span class="keywordflow">while</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>--) {
01422         <span class="keywordflow">if</span> (KeyValue.Length == 0) {
01423             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7/regutil_8h.html#a8">RegGetNextLine</a>( UnicodeFile, &amp;IndentAmount, &amp;FirstEqual )) {
01424                 <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *ValueBuffer );
01425                 <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01426                 }
01427             KeyValue.Buffer = UnicodeFile-&gt;BeginLine;
01428             KeyValue.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)
01429                 ((PCHAR)UnicodeFile-&gt;EndOfLine - (PCHAR)UnicodeFile-&gt;BeginLine);
01430             KeyValue.MaximumLength = KeyValue.Length;
01431             }
01432 
01433         s = KeyValue.Buffer;
01434         <span class="keywordflow">while</span> (KeyValue.Length != 0 &amp;&amp; *s &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
01435             s++;
01436             KeyValue.Length -= <span class="keyword">sizeof</span>( WCHAR );
01437             }
01438         KeyValue.Buffer = s;
01439         <span class="keywordflow">if</span> (KeyValue.Length != 0) {
01440             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a>( &amp;KeyValue, 0, p );
01441             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01442                 <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *ValueBuffer );
01443                 <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
01444                 }
01445             p++;
01446 
01447             s = KeyValue.Buffer;
01448             <span class="keywordflow">while</span> (KeyValue.Length != 0 &amp;&amp; *s &gt; <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
01449                 s++;
01450                 KeyValue.Length -= <span class="keyword">sizeof</span>( WCHAR );
01451                 }
01452             KeyValue.Buffer = s;
01453             }
01454         }
01455 
01456     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01457 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="regutil.h::RegGetMultiString" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN RegGetMultiString           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueString</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>MultiString</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l01009">1009</a> of file <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html">config/utils/regutil.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l01096">RegGetKeyValue()</a>, and <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00068">RegReadMultiSzFile()</a>.
<p>
<pre class="fragment"><div>01016                    :
01017 
01018     This routine parses multi-strings of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> form
01019 
01020         <span class="stringliteral">"foo"</span> <span class="stringliteral">"bar"</span> <span class="stringliteral">"bletch"</span>
01021 
01022     Each time <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> strips <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first string in quotes from
01023     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input string, and returns <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> multi-string.
01024 
01025     INPUT ValueString: <span class="stringliteral">"foo"</span> <span class="stringliteral">"bar"</span> <span class="stringliteral">"bletch"</span>
01026 
01027     OUTPUT ValueString: <span class="stringliteral">"bar"</span> <span class="stringliteral">"bletch"</span>
01028            MultiString: <a class="code" href="../../d8/d7/udbgk_8c.html#a2">foo</a>
01029 
01030 Arguments:
01031 
01032     ValueString - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> string from which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> multi-string will be
01033                   parsed
01034                 - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> remaining string after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> multi-string <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01035                   removed
01036 
01037     MultiString - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> multi-string removed from ValueString
01038 
01039 Return Value:
01040 
01041     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - multi-string found and removed.
01042 
01043     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - no more multi-strings remaining.
01044 
01045 --*/
01046 
01047 {
01048     <span class="comment">//</span>
01049     <span class="comment">// Find the first quote mark.</span>
01050     <span class="comment">//</span>
01051     <span class="keywordflow">while</span> ((*(ValueString-&gt;Buffer) != <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'"'</span>) &amp;&amp;
01052            (ValueString-&gt;Length &gt; 0)) {
01053         ++ValueString-&gt;Buffer;
01054         ValueString-&gt;Length -= <span class="keyword">sizeof</span>(WCHAR);
01055         ValueString-&gt;MaximumLength -= <span class="keyword">sizeof</span>(WCHAR);
01056     }
01057 
01058     <span class="keywordflow">if</span> (ValueString-&gt;Length == 0) {
01059         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01060     }
01061 
01062     <span class="comment">//</span>
01063     <span class="comment">// We have found the start of the multi-string.  Now find the end,</span>
01064     <span class="comment">// building up our return MultiString as we go.</span>
01065     <span class="comment">//</span>
01066     ++ValueString-&gt;Buffer;
01067     ValueString-&gt;Length -= <span class="keyword">sizeof</span>(WCHAR);
01068     ValueString-&gt;MaximumLength -= <span class="keyword">sizeof</span>(WCHAR);
01069     MultiString-&gt;Buffer = ValueString-&gt;Buffer;
01070     MultiString-&gt;Length = 0;
01071     MultiString-&gt;MaximumLength = 0;
01072     <span class="keywordflow">while</span> ((*(ValueString-&gt;Buffer) != <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'"'</span>) &amp;&amp;
01073            (ValueString-&gt;Length &gt; 0)) {
01074         ++ValueString-&gt;Buffer;
01075         ValueString-&gt;Length -= <span class="keyword">sizeof</span>(WCHAR);
01076         ValueString-&gt;MaximumLength -= <span class="keyword">sizeof</span>(WCHAR);
01077 
01078         MultiString-&gt;Length += <span class="keyword">sizeof</span>(WCHAR);
01079         MultiString-&gt;MaximumLength += <span class="keyword">sizeof</span>(WCHAR);
01080     }
01081 
01082     <span class="keywordflow">if</span> (ValueString-&gt;Length == 0) {
01083         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01084     }
01085 
01086     ++ValueString-&gt;Buffer;
01087     ValueString-&gt;Length -= <span class="keyword">sizeof</span>(WCHAR);
01088     ValueString-&gt;MaximumLength -= <span class="keyword">sizeof</span>(WCHAR);
01089 
01090     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01091 
01092 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="regutil.h::RegGetNextLine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN RegGetNextLine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">PREG_UNICODE_FILE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>UnicodeFile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>IndentAmount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PWSTR *&nbsp;</td>
          <td class="mdname" nowrap> <em>FirstEqual</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00473">473</a> of file <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html">config/utils/regutil.c</a>.
<p>
References <a class="el" href="../../d6/d6/regutil_8h-source.html#l00066">DebugOutput</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l01096">RegGetKeyValue()</a>, and <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00031">RiInitializeRegistryFromAsciiFile()</a>.
<p>
<pre class="fragment"><div>00478 {
00479     PWSTR s, s1;
00480 
00481     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00482         <span class="keywordflow">if</span> (!(s = UnicodeFile-&gt;NextLine)) {
00483             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00484             }
00485 
00486         *IndentAmount = 0;
00487         <span class="keywordflow">while</span> (*s &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00488             <span class="keywordflow">if</span> (*s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00489                 *IndentAmount += 1;
00490                 }
00491             <span class="keywordflow">else</span>
00492             <span class="keywordflow">if</span> (*s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\t'</span>) {
00493                 *IndentAmount = ((*IndentAmount + 8) -
00494                                  (*IndentAmount % 8)
00495                                 );
00496                 }
00497 
00498             <span class="keywordflow">if</span> (++s &gt;= UnicodeFile-&gt;EndOfFile) {
00499                 <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00500                 }
00501             }
00502 
00503         UnicodeFile-&gt;BeginLine = s;
00504 
00505         *FirstEqual = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00506         UnicodeFile-&gt;NextLine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00507         <span class="keywordflow">while</span> (s &lt; UnicodeFile-&gt;EndOfFile) {
00508             <span class="keywordflow">if</span> (*s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'='</span>) {
00509                 <span class="keywordflow">if</span> (*FirstEqual == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00510                     *FirstEqual = s;
00511                     }
00512                 }
00513             <span class="keywordflow">else</span>
00514             <span class="keywordflow">if</span> (*s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\n'</span>) {
00515                 s1 = s;
00516                 <span class="keywordflow">while</span> (s &gt; UnicodeFile-&gt;BeginLine &amp;&amp; s[ -1 ] &lt;= <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00517                     s--;
00518                     }
00519                 UnicodeFile-&gt;EndOfLine = s;
00520                 <span class="keywordflow">do</span> {
00521                     <span class="keywordflow">if</span> (++s1 &gt;= UnicodeFile-&gt;EndOfFile) {
00522                         s1 = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00523                         <span class="keywordflow">break</span>;
00524                         }
00525                     }
00526                 <span class="keywordflow">while</span> (*s1 == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\r'</span> || *s1 == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\n'</span>);
00527 
00528                 UnicodeFile-&gt;NextLine = s1;
00529                 <span class="keywordflow">break</span>;
00530                 }
00531 
00532             <span class="keywordflow">if</span> (++s == UnicodeFile-&gt;EndOfFile) {
00533                 <span class="keywordflow">break</span>;
00534                 }
00535             }
00536 
00537         <span class="keywordflow">if</span> (UnicodeFile-&gt;EndOfLine &gt; UnicodeFile-&gt;BeginLine) {
00538             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7/regutil_8h.html#a3">DebugOutput</a>) {
00539                 fprintf( stderr, <span class="stringliteral">"%02u  %.*ws\n"</span>,
00540                          *IndentAmount,
00541                          UnicodeFile-&gt;EndOfLine - UnicodeFile-&gt;BeginLine,
00542                          UnicodeFile-&gt;BeginLine
00543                        );
00544                 }
00545 
00546             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00547             }
00548         }
00549 
00550     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00551 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="regutil.h::RegInitialize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void RegInitialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00045">45</a> of file <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html">config/utils/regutil.c</a>.
<p>
References <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00031">RiDeleteKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00030">RiFalseKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00029">RiNoKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00028">RiOffKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00025">RiOnKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00038">RiRegBinaryFileKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00037">RiRegBinaryKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00042">RiRegDateKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00036">RiRegDwordKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00035">RiRegExpandSzKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00032">RiRegKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00039">RiRegLinkKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00041">RiRegMultiSzFileKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00040">RiRegMultiSzKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00033">RiRegNoneKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00034">RiRegSzKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00027">RiTrueKeyword</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00026">RiYesKeyword</a>, and <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>.
<p>
Referenced by <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00333">main()</a>.
<p>
<pre class="fragment"><div>00046 {
00047     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiOnKeyword, L<span class="stringliteral">"ON"</span> );
00048     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiYesKeyword, L<span class="stringliteral">"YES"</span> );
00049     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiTrueKeyword, L<span class="stringliteral">"TRUE"</span> );
00050     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiOffKeyword, L<span class="stringliteral">"OFF"</span> );
00051     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiNoKeyword, L<span class="stringliteral">"NO"</span> );
00052     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiFalseKeyword, L<span class="stringliteral">"FALSE"</span> );
00053     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiDeleteKeyword, L<span class="stringliteral">"DELETE"</span> );
00054     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiRegKeyword, L<span class="stringliteral">"REG_"</span> );
00055     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiRegNoneKeyword, L<span class="stringliteral">"REG_NONE"</span> );
00056     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiRegSzKeyword, L<span class="stringliteral">"REG_SZ"</span> );
00057     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiRegExpandSzKeyword, L<span class="stringliteral">"REG_EXPAND_SZ"</span> );
00058     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiRegDwordKeyword, L<span class="stringliteral">"REG_DWORD"</span> );
00059     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiRegBinaryKeyword, L<span class="stringliteral">"REG_BINARY"</span> );
00060     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiRegBinaryFileKeyword, L<span class="stringliteral">"REG_BINARYFILE"</span> );
00061     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiRegLinkKeyword, L<span class="stringliteral">"REG_LINK"</span> );
00062     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiRegMultiSzKeyword, L<span class="stringliteral">"REG_MULTI_SZ"</span> );
00063     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiRegMultiSzFileKeyword, L<span class="stringliteral">"REG_MULTISZFILE"</span> );
00064     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RiRegDateKeyword, L<span class="stringliteral">"REG_DATE"</span> );
00065 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="regutil.h::RegInitializeSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN RegInitializeSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="regutil.h::RegLoadAsciiFileAsUnicode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RegLoadAsciiFileAsUnicode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>FileName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d9/d2/struct__REG__UNICODE__FILE.html">PREG_UNICODE_FILE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>UnicodeFile</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00259">259</a> of file <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html">config/utils/regutil.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00004">File</a>, <a class="el" href="../../d3/d1/rtload_8c-source.html#l00047">FileName</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l00075">NtAllocateVirtualMemory()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d4/d6/freevm_8c-source.html#l00066">NtFreeVirtualMemory()</a>, <a class="el" href="../../d5/d1/open_8c-source.html#l00034">NtOpenFile()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00101">NtQueryInformationFile()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00036">NtReadFile()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d5/d7/regutil_8h.html#a2">PREG_UNICODE_FILE</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l00171">RtlAnsiCharToUnicodeChar()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00068">RegReadMultiSzFile()</a>, and <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00031">RiInitializeRegistryFromAsciiFile()</a>.
<p>
<pre class="fragment"><div>00263 {
00264     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00265     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00266     IO_STATUS_BLOCK IoStatus;
00267     HANDLE <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a>;
00268     FILE_BASIC_INFORMATION FileDateTimeInfo;
00269     FILE_STANDARD_INFORMATION FileInformation;
00270     ULONG <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>, i, i1, LineCount;
00271     PVOID BufferBase;
00272     PCHAR Src, Src1;
00273     PWSTR Dst;
00274 
00275     InitializeObjectAttributes( &amp;ObjectAttributes,
00276                                 FileName,
00277                                 OBJ_CASE_INSENSITIVE,
00278                                 (HANDLE)NULL,
00279                                 NULL
00280                               );
00281 
00282     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d2/open_8c.html#a0">NtOpenFile</a>( &amp;File,
00283                          SYNCHRONIZE | GENERIC_READ,
00284                          &amp;ObjectAttributes,
00285                          &amp;IoStatus,
00286                          FILE_SHARE_DELETE |
00287                             FILE_SHARE_READ |
00288                             FILE_SHARE_WRITE,
00289                          FILE_SYNCHRONOUS_IO_NONALERT |
00290                             FILE_NON_DIRECTORY_FILE
00291                        );
00292     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00293         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00294         }
00295 
00296     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d2/qsinfo_8c.html#a3">NtQueryInformationFile</a>( File,
00297                                      &amp;IoStatus,
00298                                      (PVOID)&amp;FileInformation,
00299                                      <span class="keyword">sizeof</span>( FileInformation ),
00300                                      FileStandardInformation
00301                                    );
00302     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00303         <span class="keywordflow">if</span> (FileInformation.EndOfFile.HighPart) {
00304             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_OVERFLOW;
00305             }
00306         }
00307     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00308         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( File );
00309         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00310         }
00311 
00312 
00313     <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> = FileInformation.EndOfFile.LowPart * <span class="keyword">sizeof</span>( WCHAR );
00314     <a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a> += <span class="keyword">sizeof</span>( UNICODE_NULL );
00315     BufferBase = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00316     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d6/allocvm_8c.html#a7">NtAllocateVirtualMemory</a>( NtCurrentProcess(),
00317                                       (PVOID *)&amp;BufferBase,
00318                                       0,
00319                                       &amp;BufferSize,
00320                                       MEM_COMMIT,
00321                                       PAGE_READWRITE
00322                                     );
00323     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00324         Src = (PCHAR)BufferBase + ((FileInformation.EndOfFile.LowPart+1) &amp; ~1);
00325         Dst = (PWSTR)BufferBase;
00326         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d5/io_2read_8c.html#a1">NtReadFile</a>( File,
00327                              NULL,
00328                              NULL,
00329                              NULL,
00330                              &amp;IoStatus,
00331                              Src,
00332                              FileInformation.EndOfFile.LowPart,
00333                              NULL,
00334                              NULL
00335                            );
00336 
00337         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00338             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = IoStatus.Status;
00339 
00340             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00341                 <span class="keywordflow">if</span> (IoStatus.Information != FileInformation.EndOfFile.LowPart) {
00342                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_END_OF_FILE;
00343                     }
00344                 <span class="keywordflow">else</span> {
00345                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d2/qsinfo_8c.html#a3">NtQueryInformationFile</a>( File,
00346                                                      &amp;IoStatus,
00347                                                      (PVOID)&amp;FileDateTimeInfo,
00348                                                      <span class="keyword">sizeof</span>( FileDateTimeInfo ),
00349                                                      FileBasicInformation
00350                                                    );
00351                     }
00352                 }
00353             }
00354 
00355         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00356             <a class="code" href="../../d3/d7/freevm_8c.html#a6">NtFreeVirtualMemory</a>( NtCurrentProcess(),
00357                                  (PVOID *)&amp;BufferBase,
00358                                  &amp;BufferSize,
00359                                  MEM_RELEASE
00360                                );
00361             }
00362         }
00363 
00364     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( File );
00365     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00366         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00367         }
00368 
00369     i = 0;
00370     <span class="keywordflow">while</span> (i &lt; FileInformation.EndOfFile.LowPart) {
00371         <span class="keywordflow">if</span> (i &gt; 1 &amp;&amp; (Src[-2] == <span class="charliteral">' '</span> || Src[-2] == <span class="charliteral">'\t'</span>) &amp;&amp;
00372             Src[-1] == <span class="charliteral">'\\'</span> &amp;&amp; (*Src == <span class="charliteral">'\r'</span> || *Src == <span class="charliteral">'\n'</span>)
00373            ) {
00374             <span class="keywordflow">if</span> (Dst[-1] == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\\'</span>) {
00375                 --Dst;
00376                 }
00377             <span class="keywordflow">while</span> (Dst &gt; (PWSTR)BufferBase) {
00378                 <span class="keywordflow">if</span> (Dst[-1] &gt; <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>) {
00379                     <span class="keywordflow">break</span>;
00380                     }
00381                 Dst--;
00382                 }
00383             LineCount = 0;
00384             <span class="keywordflow">while</span> (i &lt; FileInformation.EndOfFile.LowPart) {
00385                 <span class="keywordflow">if</span> (*Src == <span class="charliteral">'\n'</span>) {
00386                     i++;
00387                     Src++;
00388                     LineCount++;
00389                     }
00390                 <span class="keywordflow">else</span>
00391                 <span class="keywordflow">if</span> (*Src == <span class="charliteral">'\r'</span> &amp;&amp;
00392                     (i+1) &lt; FileInformation.EndOfFile.LowPart &amp;&amp;
00393                     Src[ 1 ] == <span class="charliteral">'\n'</span>
00394                    ) {
00395                     i += 2;
00396                     Src += 2;
00397                     LineCount++;
00398                     }
00399                 <span class="keywordflow">else</span> {
00400                     <span class="keywordflow">break</span>;
00401                     }
00402                 }
00403 
00404             <span class="keywordflow">if</span> (LineCount &gt; 1) {
00405                 *Dst++ = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\n'</span>;
00406                 }
00407             <span class="keywordflow">else</span> {
00408                 *Dst++ = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">' '</span>;
00409                 <span class="keywordflow">while</span> (i &lt; FileInformation.EndOfFile.LowPart &amp;&amp; (*Src == <span class="charliteral">' '</span> || *Src == <span class="charliteral">'\t'</span>)) {
00410                     i++;
00411                     Src++;
00412                     }
00413                 }
00414 
00415             <span class="keywordflow">if</span> (i &gt;= FileInformation.EndOfFile.LowPart) {
00416                 <span class="keywordflow">break</span>;
00417                 }
00418             }
00419         <span class="keywordflow">else</span>
00420         <span class="keywordflow">if</span> ((*Src == <span class="charliteral">'\r'</span> &amp;&amp; Src[1] == <span class="charliteral">'\n'</span>) || *Src == <span class="charliteral">'\n'</span>) {
00421             <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00422                 <span class="keywordflow">while</span> (i &lt; FileInformation.EndOfFile.LowPart &amp;&amp; (*Src == <span class="charliteral">'\r'</span> || *Src == <span class="charliteral">'\n'</span>)) {
00423                     i++;
00424                     Src++;
00425                     }
00426                 Src1 = Src;
00427                 i1 = i;
00428                 <span class="keywordflow">while</span> (i1 &lt; FileInformation.EndOfFile.LowPart &amp;&amp; (*Src1 == <span class="charliteral">' '</span> || *Src1 == <span class="charliteral">'\t'</span>)) {
00429                     i1++;
00430                     Src1++;
00431                     }
00432                 <span class="keywordflow">if</span> (i1 &lt; FileInformation.EndOfFile.LowPart &amp;&amp;
00433                     (*Src1 == <span class="charliteral">'\r'</span> &amp;&amp; Src1[1] == <span class="charliteral">'\n'</span>) || *Src1 == <span class="charliteral">'\n'</span>
00434                    ) {
00435                     Src = Src1;
00436                     i = i1;
00437                     }
00438                 <span class="keywordflow">else</span> {
00439                     <span class="keywordflow">break</span>;
00440                     }
00441                 }
00442 
00443             *Dst++ = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\n'</span>;
00444             }
00445         <span class="keywordflow">else</span> {
00446             i++;
00447             *Dst++ = <a class="code" href="../../d6/d6/nls_8c.html#a22">RtlAnsiCharToUnicodeChar</a>( &amp;Src );
00448             }
00449         }
00450 
00451     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00452         *Dst = UNICODE_NULL;
00453         UnicodeFile-&gt;FileContents = BufferBase;
00454         UnicodeFile-&gt;EndOfFile = Dst;
00455         UnicodeFile-&gt;BeginLine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00456         UnicodeFile-&gt;EndOfLine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00457         UnicodeFile-&gt;NextLine = BufferBase;
00458         UnicodeFile-&gt;LastWriteTime = FileDateTimeInfo.LastWriteTime;
00459         }
00460     <span class="keywordflow">else</span> {
00461         <a class="code" href="../../d3/d7/freevm_8c.html#a6">NtFreeVirtualMemory</a>( NtCurrentProcess(),
00462                              (PVOID *)&amp;BufferBase,
00463                              &amp;BufferSize,
00464                              MEM_RELEASE
00465                            );
00466         }
00467 
00468     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00469 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="regutil.h::RegReadBinaryFile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RegReadBinaryFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>FileName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ValueLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00158">158</a> of file <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html">config/utils/regutil.c</a>.
<p>
References <a class="el" href="../../d2/d8/icmui_8def-source.html#l00004">File</a>, <a class="el" href="../../d3/d1/rtload_8c-source.html#l00047">FileName</a>, <a class="el" href="../../d3/d1/rtload_8c-source.html#l00048">FileNameBuffer</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d5/d1/open_8c-source.html#l00034">NtOpenFile()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00101">NtQueryInformationFile()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00036">NtReadFile()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00022">RtlAllocateHeap</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d2/d0/hivedmp_8c-source.html#l00060">ValueBuffer</a>.
<p>
Referenced by <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l01096">RegGetKeyValue()</a>.
<p>
<pre class="fragment"><div>00163 {
00164     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00165     UNICODE_STRING NtFileName;
00166     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00167     IO_STATUS_BLOCK IoStatus;
00168     HANDLE <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a>;
00169     FILE_STANDARD_INFORMATION FileInformation;
00170     WCHAR <a class="code" href="../../d2/d2/rtload_8c.html#a4">FileNameBuffer</a>[ 256 ];
00171     PWSTR s;
00172 
00173     <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a>-&gt;Buffer[ <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a>-&gt;Length/<span class="keyword">sizeof</span>(WCHAR) ] = UNICODE_NULL;
00174     wcscpy( FileNameBuffer, L<span class="stringliteral">"\\DosDevices\\"</span> );
00175     s = wcscat( FileNameBuffer, <a class="code" href="../../d2/d2/rtload_8c.html#a3">FileName</a>-&gt;Buffer );
00176     <span class="keywordflow">while</span> (*s != UNICODE_NULL) {
00177         <span class="keywordflow">if</span> (*s == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'/'</span>) {
00178             *s = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\\'</span>;
00179             }
00180         s++;
00181         }
00182     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;NtFileName, FileNameBuffer );
00183 
00184     InitializeObjectAttributes( &amp;ObjectAttributes,
00185                                 &amp;NtFileName,
00186                                 OBJ_CASE_INSENSITIVE,
00187                                 (HANDLE)NULL,
00188                                 NULL
00189                               );
00190 
00191     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d2/open_8c.html#a0">NtOpenFile</a>( &amp;File,
00192                          SYNCHRONIZE | GENERIC_READ,
00193                          &amp;ObjectAttributes,
00194                          &amp;IoStatus,
00195                          FILE_SHARE_DELETE |
00196                             FILE_SHARE_READ |
00197                             FILE_SHARE_WRITE,
00198                          FILE_SYNCHRONOUS_IO_NONALERT |
00199                             FILE_NON_DIRECTORY_FILE
00200                        );
00201     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00202         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00203         }
00204 
00205     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d2/qsinfo_8c.html#a3">NtQueryInformationFile</a>( File,
00206                                      &amp;IoStatus,
00207                                      (PVOID)&amp;FileInformation,
00208                                      <span class="keyword">sizeof</span>( FileInformation ),
00209                                      FileStandardInformation
00210                                    );
00211     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00212         <span class="keywordflow">if</span> (FileInformation.EndOfFile.HighPart) {
00213             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_OVERFLOW;
00214             }
00215         }
00216     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00217         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( File );
00218         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00219         }
00220 
00221     *ValueLength = FileInformation.EndOfFile.LowPart;
00222     *<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, *ValueLength );
00223     <span class="keywordflow">if</span> (*<a class="code" href="../../d1/d1/hivedmp_8c.html#a0">ValueBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00224         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00225         }
00226 
00227     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00228         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d5/io_2read_8c.html#a1">NtReadFile</a>( File,
00229                              NULL,
00230                              NULL,
00231                              NULL,
00232                              &amp;IoStatus,
00233                              *ValueBuffer,
00234                              *ValueLength,
00235                              NULL,
00236                              NULL
00237                            );
00238 
00239         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00240             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = IoStatus.Status;
00241 
00242             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00243                 <span class="keywordflow">if</span> (IoStatus.Information != *ValueLength) {
00244                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_END_OF_FILE;
00245                     }
00246                 }
00247             }
00248 
00249         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00250             <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *ValueBuffer );
00251             }
00252         }
00253 
00254     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( File );
00255     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00256 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a3" doxytag="regutil.h::DebugOutput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d5/d7/regutil_8h.html#a3">DebugOutput</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d6/regutil_8h-source.html#l00066">66</a> of file <a class="el" href="../../d6/d6/regutil_8h-source.html">regutil.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/hivedmp_8c-source.html#l00074">main()</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00473">RegGetNextLine()</a>, and <a class="el" href="../../d5/d0/hiveini_8c-source.html#l00031">RiInitializeRegistryFromAsciiFile()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="regutil.h::SummaryOutput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d5/d7/regutil_8h.html#a4">SummaryOutput</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d6/regutil_8h-source.html#l00067">67</a> of file <a class="el" href="../../d6/d6/regutil_8h-source.html">regutil.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/hivedmp_8c-source.html#l00074">main()</a>, and <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00555">RegDumpKeyValue()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:28 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
