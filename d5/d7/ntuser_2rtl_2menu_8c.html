<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ntuser/rtl/menu.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>menu.c File Reference</h1>
<p>
<a href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a0">_GetMenuDefaultItem</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu, BOOL fByPosition, UINT uFlags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a1">xxxMNCanClose</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>RTLMENU&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a2">xxxLoadSysMenu</a> (UINT uMenuId)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="ntuser/rtl/menu.c::_GetMenuDefaultItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> _GetMenuDefaultItem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fByPosition</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html#l00026">26</a> of file <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html">ntuser/rtl/menu.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02791">tagMENU::cItems</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02763">MFMWFP_NOITEM</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00210">REBASEALWAYS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00211">REBASEPTR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02606">tagITEM::spSubMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02745">tagITEM::wID</a>.
<p>
Referenced by <a class="el" href="../../d8/d6/menuc_8c-source.html#l00045">GetMenuDefaultItem()</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00724">SetupFakeMDIAppStuff()</a>, and <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l02697">xxxMNDoubleClick()</a>.
<p>
<pre class="fragment"><div>00027 {
00028     <span class="keywordtype">int</span> iItem;
00029     <span class="keywordtype">int</span> cItems;
00030     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem;
00031     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pSubMenu;
00032 
00033     pItem = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pMenu, rgItems);
00034     cItems = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>;
00035 
00036     <span class="comment">/*</span>
00037 <span class="comment">     * Walk the list of items sequentially until we find one that has</span>
00038 <span class="comment">     * MFS_DEFAULT set.</span>
00039 <span class="comment">     */</span>
00040     <span class="keywordflow">for</span> (iItem = 0; iItem &lt; cItems; iItem++, pItem++) {
00041         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_DEFAULT)) {
00042             <span class="keywordflow">if</span> ((uFlags &amp; GMDI_USEDISABLED) || !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_GRAYED)) {
00043                 <span class="keywordflow">if</span> ((uFlags &amp; GMDI_GOINTOPOPUPS) &amp;&amp; (pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00044                     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <span class="keywordtype">id</span>;
00045 
00046                     <span class="comment">/*</span>
00047 <span class="comment">                     * Is there a valid submenu default?  If not, we'll use</span>
00048 <span class="comment">                     * this one.</span>
00049 <span class="comment">                     */</span>
00050                     pSubMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a25">REBASEPTR</a>(pMenu, pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a>);
00051                     <span class="keywordtype">id</span> = <a class="code" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a0">_GetMenuDefaultItem</a>(pSubMenu, fByPosition, uFlags);
00052                     <span class="keywordflow">if</span> (<span class="keywordtype">id</span> != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>)
00053                         <span class="keywordflow">return</span>(<span class="keywordtype">id</span>);
00054                 }
00055 
00056                 <span class="keywordflow">break</span>;
00057             }
00058         }
00059     }
00060 
00061     <span class="keywordflow">if</span> (iItem &lt; cItems) {
00062         <span class="keywordflow">return</span> (fByPosition ? iItem : pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o2">wID</a>);
00063     } <span class="keywordflow">else</span> {
00064         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>);
00065     }
00066 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ntuser/rtl/menu.c::xxxLoadSysMenu" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> RTLMENU xxxLoadSysMenu           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>uMenuId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html#l00117">117</a> of file <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html">ntuser/rtl/menu.c</a>.
<p>
References <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00053">hmodUser</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02595">ID_DIALOGSYSMENU</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d0/base_8c-source.html#l00204">RtlInitUnicodeStringOrId()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03162">RTLMENU</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1009">xxxClientLoadMenu()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03163">xxxRtlSetMenuInfo</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03164">xxxRtlSetMenuItemInfo</a>.
<p>
Referenced by <a class="el" href="../../d7/d4/mdiwin_8c-source.html#l02794">CreateMDIChild()</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00368">xxxGetSystemMenu()</a>, and <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00030">xxxLoadSysDesktopMenu()</a>.
<p>
<pre class="fragment"><div>00118 {
00119     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a891">RTLMENU</a> rtlMenu;
00120     MENUINFO mi;
00121     MENUITEMINFO mii;
00122     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlMenu;
00123 
00124 <span class="preprocessor">#ifdef _USERK_</span>
00125 <span class="preprocessor"></span>    UNICODE_STRING strMenuName;
00126     <a class="code" href="../../d4/d1/userk_8h.html#a1005">RtlInitUnicodeStringOrId</a>(&amp;strMenuName, MAKEINTRESOURCE(uMenuId));
00127     rtlMenu = <a class="code" href="../../d4/d1/userk_8h.html#a1009">xxxClientLoadMenu</a>(NULL, &amp;strMenuName);
00128 <span class="preprocessor">#else</span>
00129 <span class="preprocessor"></span>    rtlMenu = LoadMenu(hmodUser, MAKEINTRESOURCE(uMenuId));
00130 <span class="preprocessor">#endif</span>
00131 <span class="preprocessor"></span>
00132     <span class="keywordflow">if</span> (rtlMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00133         RIPMSG1(RIP_WARNING, <span class="stringliteral">"xxxLoadSysMenu failed to load:%#lx"</span>, uMenuId);
00134         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00135     }
00136 
00137     <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(rtlMenu, &amp;tlMenu);
00138     <span class="comment">/*</span>
00139 <span class="comment">     * Add the checkorbmp style. (draw bitmaps and checkmarks on the</span>
00140 <span class="comment">     *  same column)</span>
00141 <span class="comment">     */</span>
00142     mi.cbSize = <span class="keyword">sizeof</span>(mi);
00143     mi.fMask = MIM_STYLE | MIM_APPLYTOSUBMENUS;
00144     mi.dwStyle = MNS_CHECKORBMP;
00145     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a892">xxxRtlSetMenuInfo</a>(rtlMenu, &amp;mi);
00146     <span class="comment">/*</span>
00147 <span class="comment">     * Add the bitmaps for close, minimize, maximize and restore items.</span>
00148 <span class="comment">     */</span>
00149     mii.cbSize = <span class="keyword">sizeof</span>(mii);
00150     mii.fMask = MIIM_BITMAP;
00151     mii.hbmpItem = HBMMENU_POPUP_CLOSE;
00152     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a893">xxxRtlSetMenuItemInfo</a> (rtlMenu, SC_CLOSE, &amp;mii);
00153     <span class="keywordflow">if</span> (uMenuId != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a756">ID_DIALOGSYSMENU</a>) {
00154         mii.hbmpItem = HBMMENU_POPUP_MINIMIZE;
00155         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a893">xxxRtlSetMenuItemInfo</a> (rtlMenu, SC_MINIMIZE, &amp;mii);
00156         mii.hbmpItem = HBMMENU_POPUP_MAXIMIZE;
00157         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a893">xxxRtlSetMenuItemInfo</a> (rtlMenu, SC_MAXIMIZE, &amp;mii);
00158         mii.hbmpItem = HBMMENU_POPUP_RESTORE;
00159         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a893">xxxRtlSetMenuItemInfo</a> (rtlMenu, SC_RESTORE, &amp;mii);
00160     }
00161 
00162     <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlMenu);
00163     <span class="keywordflow">return</span> rtlMenu;
00164 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ntuser/rtl/menu.c::xxxMNCanClose" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxMNCanClose           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html#l00078">78</a> of file <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html">ntuser/rtl/menu.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01596">CFNOCLOSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00486">MNLookUpItem()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00210">REBASEALWAYS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00211">REBASEPTR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01613">TestCF2</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>, and <a class="el" href="../../d8/d6/menuc_8c-source.html#l00270">xxxGetSysMenuHandle()</a>.
<p>
Referenced by <a class="el" href="../../d7/d4/mdiwin_8c-source.html#l02101">DefFrameProcWorker()</a>, <a class="el" href="../../d6/d4/mdimenu_8c-source.html#l00165">MDIAddSysMenu()</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00030">xxxCalcCaptionButton()</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00986">xxxDrawCaptionBar()</a>, and <a class="el" href="../../d7/d6/winable2_8c-source.html#l00170">xxxGetTitleBarInfo()</a>.
<p>
<pre class="fragment"><div>00079 {
00080     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>   pMenu;
00081     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a>   pItem;
00082     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls;
00083 
00084     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00085 
00086     pcls = (<a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwnd, pcls);
00087     <span class="keywordflow">if</span> ( <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a488">TestCF2</a>(pcls, CFNOCLOSE) )
00088         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00089 
00090     pMenu = <a class="code" href="../../d4/d1/userk_8h.html#a1403">xxxGetSysMenuHandle</a>(pwnd);
00091     <span class="keywordflow">if</span> (!pMenu || !(pMenu = <a class="code" href="../../d6/d0/usercli_8h.html#a25">REBASEPTR</a>(pwnd, pMenu)))
00092         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00093 
00094     <span class="comment">/*</span>
00095 <span class="comment">     * Note how this parallels the code in SetCloseDefault--we check for</span>
00096 <span class="comment">     *  3 different IDs.</span>
00097 <span class="comment">     */</span>
00098     pItem = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a10">MNLookUpItem</a>(pMenu, SC_CLOSE, FALSE, NULL);
00099 
00100     <span class="keywordflow">if</span> (!(pItem))
00101         pItem = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a10">MNLookUpItem</a>(pMenu, SC_CLOSE-0x7000, FALSE, NULL);
00102 
00103     <span class="keywordflow">if</span> (!(pItem))
00104         pItem = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a10">MNLookUpItem</a>(pMenu, 0xC070, FALSE, NULL);
00105 
00106     <span class="keywordflow">return</span>((pItem) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_GRAYED));
00107 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:38 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
