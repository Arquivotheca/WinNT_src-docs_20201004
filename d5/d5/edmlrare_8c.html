<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: edmlrare.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>edmlrare.c File Reference</h1><code>#include "<a class="el" href="../../d8/d2/w32_2ntuser_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d6/d4/edmlrare_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/edmlrare_8c.html#a0">MLInsertCrCrLf</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/edmlrare_8c.html#a1">MLStripCrCrLf</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/edmlrare_8c.html#a2">MLSetHandle</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HANDLE hNewText)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/edmlrare_8c.html#a3">MLGetLine</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> lineNumber, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> maxCchToCopy, LPSTR lpBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/edmlrare_8c.html#a4">MLLineIndex</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> iLine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/edmlrare_8c.html#a5">MLLineLength</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ich)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/edmlrare_8c.html#a6">MLSetSelection</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, BOOL fDoNotScrollCaret, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ichMinSel, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ichMaxSel)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/edmlrare_8c.html#a7">MLSetTabStops</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, int nTabPos, LPINT lpTabStops)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/edmlrare_8c.html#a8">MLUndo</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a3" doxytag="edmlrare.c::MLGetLine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG MLGetLine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lineNumber</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>maxCchToCopy</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/edmlrare_8c-source.html#l00266">266</a> of file <a class="el" href="../../d6/d4/edmlrare_8c-source.html">edmlrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00661">tagED::cbChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00662">tagED::chLines</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00559">tagED::cLines</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, and <a class="el" href="../../d2/d4/editml_8c-source.html#l00374">MLLine()</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/editml_8c-source.html#l03457">MLEditWndProc()</a>.
<p>
<pre class="fragment"><div>00271 {
00272     PSTR pText;
00273     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> cchLen;
00274 
00275     <span class="keywordflow">if</span> (lineNumber &gt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o4">cLines</a> - 1) {
00276         RIPERR1(ERROR_INVALID_PARAMETER,
00277                 RIP_WARNING,
00278                 <span class="stringliteral">"Invalid parameter \"lineNumber\" (%ld) to MLGetLine"</span>,
00279                 lineNumber);
00280 
00281         <span class="keywordflow">return</span> 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00282     }
00283 
00284     cchLen = <a class="code" href="../../d6/d0/usercli_8h.html#a498">MLLine</a>(ped, lineNumber);
00285     maxCchToCopy = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(cchLen, maxCchToCopy);
00286 
00287     <span class="keywordflow">if</span> (maxCchToCopy) {
00288         pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped) +
00289                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a>[lineNumber] * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>;
00290         memmove(lpBuffer, pText, maxCchToCopy*ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>);
00291         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00292     }
00293 
00294     <span class="keywordflow">return</span> maxCchToCopy;
00295 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="edmlrare.c::MLInsertCrCrLf" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL MLInsertCrCrLf           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ped</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
fAnsi 
<p>
Definition at line <a class="el" href="../../d6/d4/edmlrare_8c-source.html#l00027">27</a> of file <a class="el" href="../../d6/d4/edmlrare_8c-source.html">edmlrare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00661">tagED::cbChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00553">tagED::cchAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00662">tagED::chLines</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00559">tagED::cLines</a>, <a class="el" href="../../d8/d3/conexts_8c-source.html#l01441">dch()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02429">ECNotifyParent()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00624">tagED::fStripCRCRLF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00615">tagED::fWrap</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00706">tagED::hInstance</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00552">tagED::hText</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d9/d5/ntuser_2client_2globals_8h-source.html#l00109">LOCALREALLOC</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/editml_8c-source.html#l03457">MLEditWndProc()</a>.
<p>
<pre class="fragment"><div>00029 {
00030     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> <a class="code" href="../../d7/d4/conexts_8c.html#a24">dch</a>;
00031     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> li;
00032     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> lineSize;
00033     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pchText;
00034     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pchTextNew;
00035 
00036     <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o34">fWrap</a> || !ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>) {
00037 
00038         <span class="comment">/*</span>
00039 <span class="comment">         * There are no soft line breaks if word-wrapping is off or if no chars</span>
00040 <span class="comment">         */</span>
00041         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00042     }
00043 
00044     <span class="comment">/*</span>
00045 <span class="comment">     * Calc an upper bound on the number of additional characters we will be</span>
00046 <span class="comment">     * adding to the text when we insert CR CR LFs.</span>
00047 <span class="comment">     */</span>
00048     <a class="code" href="../../d7/d4/conexts_8c.html#a24">dch</a> = 3 * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o4">cLines</a>;
00049 
00050     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d6/ntuser_2client_2globals_8h.html#a3">LOCALREALLOC</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o0">hText</a>, (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> + dch) * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>, 0, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o87">hInstance</a>, NULL)) {
00051         <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_ERRSPACE);
00052         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00053     }
00054 
00055     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o1">cchAlloc</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> + <a class="code" href="../../d7/d4/conexts_8c.html#a24">dch</a>;
00056 
00057     <span class="comment">/*</span>
00058 <span class="comment">     * Move the text up dch bytes and then copy it back down, inserting the CR</span>
00059 <span class="comment">     * CR LF's as necessary.</span>
00060 <span class="comment">     */</span>
00061     pchTextNew = pchText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00062     pchText += <a class="code" href="../../d7/d4/conexts_8c.html#a24">dch</a> * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>;
00063 
00064     <span class="comment">/*</span>
00065 <span class="comment">     * We will use dch to keep track of how many chars we add to the text</span>
00066 <span class="comment">     */</span>
00067     <a class="code" href="../../d7/d4/conexts_8c.html#a24">dch</a> = 0;
00068 
00069     <span class="comment">/*</span>
00070 <span class="comment">     * Copy the text up dch bytes to pchText. This will shift all indices in</span>
00071 <span class="comment">     * ped-&gt;chLines up by dch bytes.</span>
00072 <span class="comment">     */</span>
00073     memmove(pchText, pchTextNew, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>);
00074 
00075     <span class="comment">/*</span>
00076 <span class="comment">     * Now copy chars from pchText down to pchTextNew and insert CRCRLF at soft</span>
00077 <span class="comment">     * line breaks.</span>
00078 <span class="comment">     */</span>
00079     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>) {
00080         <span class="keywordflow">for</span> (li = 0; li &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o4">cLines</a> - 1; li++) {
00081             lineSize = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a>[li + 1] - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a>[li];
00082             memmove(pchTextNew, pchText, lineSize);
00083             pchTextNew += lineSize;
00084             pchText += lineSize;
00085 
00086             <span class="comment">/*</span>
00087 <span class="comment">             * If last character in newly copied line is not a line feed, then we</span>
00088 <span class="comment">             * need to add the CR CR LF triple to the end</span>
00089 <span class="comment">             */</span>
00090             <span class="keywordflow">if</span> (*(pchTextNew - 1) != 0x0A) {
00091                 *pchTextNew++ = 0x0D;
00092                 *pchTextNew++ = 0x0D;
00093                 *pchTextNew++ = 0x0A;
00094                 <a class="code" href="../../d7/d4/conexts_8c.html#a24">dch</a> += 3;
00095             }
00096         }
00097 
00098         <span class="comment">/*</span>
00099 <span class="comment">         * Now move the last line up. It won't have any line breaks in it...</span>
00100 <span class="comment">         */</span>
00101         memmove(pchTextNew, pchText, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a>[ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o4">cLines</a> - 1]);
00102     } <span class="keywordflow">else</span> { 
00103         LPWSTR pwchTextNew = (LPWSTR)pchTextNew;
00104 
00105         <span class="keywordflow">for</span> (li = 0; li &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o4">cLines</a> - 1; li++) {
00106             lineSize = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a>[li + 1] - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a>[li];
00107             memmove(pwchTextNew, pchText, lineSize * <span class="keyword">sizeof</span>(WCHAR));
00108             pwchTextNew += lineSize;
00109             pchText += lineSize * <span class="keyword">sizeof</span>(WCHAR);
00110 
00111             <span class="comment">/*</span>
00112 <span class="comment">             * If last character in newly copied line is not a line feed, then we</span>
00113 <span class="comment">             * need to add the CR CR LF triple to the end</span>
00114 <span class="comment">             */</span>
00115             <span class="keywordflow">if</span> (*(pwchTextNew - 1) != 0x0A) {
00116                 *pwchTextNew++ = 0x0D;
00117                 *pwchTextNew++ = 0x0D;
00118                 *pwchTextNew++ = 0x0A;
00119                 <a class="code" href="../../d7/d4/conexts_8c.html#a24">dch</a> += 3;
00120             }
00121         }
00122 
00123         <span class="comment">/*</span>
00124 <span class="comment">         * Now move the last line up. It won't have any line breaks in it...</span>
00125 <span class="comment">         */</span>
00126         memmove(pwchTextNew, pchText,
00127             (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a>[ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o4">cLines</a> - 1]) * <span class="keyword">sizeof</span>(WCHAR));
00128     }
00129 
00130     <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00131 
00132     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a24">dch</a>) {
00133         <span class="comment">/*</span>
00134 <span class="comment">         * Update number of characters in text handle</span>
00135 <span class="comment">         */</span>
00136         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> += <a class="code" href="../../d7/d4/conexts_8c.html#a24">dch</a>;
00137 
00138         <span class="comment">/*</span>
00139 <span class="comment">         * So that the next time we do anything with the text, we can strip the</span>
00140 <span class="comment">         * CRCRLFs</span>
00141 <span class="comment">         */</span>
00142         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o37">fStripCRCRLF</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00143         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00144     }
00145 
00146     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00147 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="edmlrare.c::MLLineIndex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> MLLineIndex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>iLine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/edmlrare_8c-source.html#l00306">306</a> of file <a class="el" href="../../d6/d4/edmlrare_8c-source.html">edmlrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00662">tagED::chLines</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00559">tagED::cLines</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00566">tagED::iCaretLine</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/editml_8c-source.html#l03457">MLEditWndProc()</a>.
<p>
<pre class="fragment"><div>00309 {
00310     <span class="keywordflow">if</span> (iLine == -1)
00311         iLine = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o8">iCaretLine</a>;
00312     <span class="keywordflow">if</span> (iLine &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o4">cLines</a>) {
00313         <span class="keywordflow">return</span> ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a>[iLine];
00314     } <span class="keywordflow">else</span> {
00315         RIPERR1(ERROR_INVALID_PARAMETER,
00316                 RIP_WARNING,
00317                 <span class="stringliteral">"Invalid parameter \"iLine\" (%ld) to MLLineIndex"</span>,
00318                 iLine);
00319 
00320         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>)-1;
00321     }
00322 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="edmlrare.c::MLLineLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> MLLineLength           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ich</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/edmlrare_8c-source.html#l00334">334</a> of file <a class="el" href="../../d6/d4/edmlrare_8c-source.html">edmlrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00662">tagED::chLines</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l00443">MLIchToLine()</a>, and <a class="el" href="../../d2/d4/editml_8c-source.html#l00374">MLLine()</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/editml_8c-source.html#l03457">MLEditWndProc()</a>.
<p>
<pre class="fragment"><div>00337 {
00338     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> il1, il2;
00339     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> temp;
00340 
00341     <span class="keywordflow">if</span> (ich != 0xFFFFFFFF)
00342         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a498">MLLine</a>(ped, <a class="code" href="../../d6/d0/usercli_8h.html#a495">MLIchToLine</a>(ped, ich)));
00343 
00344     <span class="comment">/*</span>
00345 <span class="comment">     * Find length of lines corresponding to current selection</span>
00346 <span class="comment">     */</span>
00347     il1 = <a class="code" href="../../d6/d0/usercli_8h.html#a495">MLIchToLine</a>(ped, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>);
00348     il2 = <a class="code" href="../../d6/d0/usercli_8h.html#a495">MLIchToLine</a>(ped, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>);
00349     <span class="keywordflow">if</span> (il1 == il2)
00350         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a498">MLLine</a>(ped, il1) - (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>));
00351 
00352     temp = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a>[il1];
00353     temp += <a class="code" href="../../d6/d0/usercli_8h.html#a498">MLLine</a>(ped, il2);
00354     temp -= (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a>[il2]);
00355 
00356     <span class="keywordflow">return</span> temp;
00357 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="edmlrare.c::MLSetHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MLSetHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hNewText</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/edmlrare_8c-source.html#l00222">222</a> of file <a class="el" href="../../d6/d4/edmlrare_8c-source.html">edmlrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00661">tagED::cbChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00553">tagED::cchAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00484">CCHALLOCEXTRA</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02547">ECResetTextInfo()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00708">tagED::fEncoded</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00706">tagED::hInstance</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00552">tagED::hText</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d9/d5/ntuser_2client_2globals_8h-source.html#l00109">LOCALREALLOC</a>, <a class="el" href="../../d9/d5/ntuser_2client_2globals_8h-source.html#l00115">LOCALSIZE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/editml_8c-source.html#l03457">MLEditWndProc()</a>.
<p>
<pre class="fragment"><div>00225 {
00226     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> newCch;
00227 
00228     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o1">cchAlloc</a> =
00229             <a class="code" href="../../d8/d6/ntuser_2client_2globals_8h.html#a6">LOCALSIZE</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o0">hText</a> = hNewText, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o87">hInstance</a>) / ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>;
00230     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o89">fEncoded</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00231 
00232     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>) {
00233 
00234         <span class="comment">/*</span>
00235 <span class="comment">         * We have to do it this way in case the app gives us a zero size handle</span>
00236 <span class="comment">         */</span>
00237         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>)
00238             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped));
00239         <span class="keywordflow">else</span>
00240             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> = wcslen((LPWSTR)<a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped));
00241         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00242     }
00243 
00244     newCch = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>)(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> + <a class="code" href="../../d6/d0/usercli_8h.html#a71">CCHALLOCEXTRA</a>);
00245 
00246     <span class="comment">/*</span>
00247 <span class="comment">     * We do this LocalReAlloc in case the app changed the size of the handle</span>
00248 <span class="comment">     */</span>
00249     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/ntuser_2client_2globals_8h.html#a3">LOCALREALLOC</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o0">hText</a>, newCch*ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>, 0, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o87">hInstance</a>, NULL))
00250         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o1">cchAlloc</a> = newCch;
00251 
00252     <a class="code" href="../../d6/d0/usercli_8h.html#a448">ECResetTextInfo</a>(ped);
00253 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="edmlrare.c::MLSetSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MLSetSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fDoNotScrollCaret</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ichMinSel</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ichMaxSel</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/edmlrare_8c-source.html#l00368">368</a> of file <a class="el" href="../../d6/d4/edmlrare_8c-source.html">edmlrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04133">ECAdjustIch()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00611">tagED::fDBCS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00566">tagED::iCaretLine</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00564">tagED::ichCaret</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l00919">MLChangeSelection()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l03379">MLEnsureCaretVisible()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l00443">MLIchToLine()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l00292">MLSetCaretPosition()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/editml_8c-source.html#l03457">MLEditWndProc()</a>, and <a class="el" href="../../d6/d4/edmlrare_8c-source.html#l00556">MLUndo()</a>.
<p>
<pre class="fragment"><div>00373 {
00374     HDC hdc;
00375 
00376     <span class="keywordflow">if</span> (ichMinSel == 0xFFFFFFFF) {
00377 
00378         <span class="comment">/*</span>
00379 <span class="comment">         * Set no selection if we specify -1</span>
00380 <span class="comment">         */</span>
00381         ichMinSel = ichMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
00382     }
00383 
00384     <span class="comment">/*</span>
00385 <span class="comment">     * Since these are unsigned, we don't check if they are greater than 0.</span>
00386 <span class="comment">     */</span>
00387     ichMinSel = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>, ichMinSel);
00388     ichMaxSel = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>, ichMaxSel);
00389 
00390 <span class="preprocessor">#ifdef FE_SB // MLSetSelectionHander()</span>
00391 <span class="preprocessor"></span>    <span class="comment">//</span>
00392     <span class="comment">// To avoid position to half of DBCS, check and ajust position if necessary</span>
00393     <span class="comment">//</span>
00394     <span class="comment">// We check ped-&gt;fDBCS and ped-&gt;fAnsi though ECAdjustIch checks these bits</span>
00395     <span class="comment">// at first. We're worrying about the overhead of ECLock and ECUnlock.</span>
00396     <span class="comment">//</span>
00397     <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o32">fDBCS</a> &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> ) {
00398 
00399         PSTR pText;
00400 
00401         pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00402         ichMinSel = <a class="code" href="../../d6/d0/usercli_8h.html#a461">ECAdjustIch</a>( ped, pText, ichMinSel );
00403         ichMaxSel = <a class="code" href="../../d6/d0/usercli_8h.html#a461">ECAdjustIch</a>( ped, pText, ichMaxSel );
00404         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00405     }
00406 <span class="preprocessor">#endif // FE_SB</span>
00407 <span class="preprocessor"></span>
00408     <span class="comment">/*</span>
00409 <span class="comment">     * Set the caret's position to be at ichMaxSel.</span>
00410 <span class="comment">     */</span>
00411     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = ichMaxSel;
00412     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o8">iCaretLine</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a495">MLIchToLine</a>(ped, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>);
00413 
00414     hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, FALSE);
00415     <a class="code" href="../../d6/d0/usercli_8h.html#a513">MLChangeSelection</a>(ped, hdc, ichMinSel, ichMaxSel);
00416 
00417     <a class="code" href="../../d6/d0/usercli_8h.html#a493">MLSetCaretPosition</a>(ped, hdc);
00418     <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, FALSE);
00419 
00420 <span class="preprocessor">#ifdef FE_SB // MLSetSelectionHander()</span>
00421 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!fDoNotScrollCaret)
00422         <a class="code" href="../../d6/d0/usercli_8h.html#a485">MLEnsureCaretVisible</a>(ped);
00423     <span class="comment">/*</span>
00424 <span class="comment">     * #ifdef KOREA is history, with FE_SB (FarEast Single Binary).</span>
00425 <span class="comment">     */</span>
00426 <span class="preprocessor">#else</span>
00427 <span class="preprocessor"></span><span class="preprocessor">#ifdef KOREA</span>
00428 <span class="preprocessor"></span>    <span class="comment">/*</span>
00429 <span class="comment">     * Extra parameter specified interim character mode</span>
00430 <span class="comment">     */</span>
00431     <a class="code" href="../../d6/d0/usercli_8h.html#a485">MLEnsureCaretVisible</a>(ped,NULL);
00432 <span class="preprocessor">#else</span>
00433 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!fDoNotScrollCaret)
00434         <a class="code" href="../../d6/d0/usercli_8h.html#a485">MLEnsureCaretVisible</a>(ped);
00435 <span class="preprocessor">#endif</span>
00436 <span class="preprocessor"></span><span class="preprocessor">#endif // FE_SB</span>
00437 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="edmlrare.c::MLSetTabStops" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL MLSetTabStops           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>nTabPos</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPINT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpTabStops</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/edmlrare_8c-source.html#l00458">458</a> of file <a class="el" href="../../d6/d4/edmlrare_8c-source.html">edmlrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00677">tagED::aveCharWidth</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l01562">MLBuildchLines()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l03379">MLEnsureCaretVisible()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l01003">MLUpdateiCaretLine()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00624">MultDiv</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05330">NtUserInvalidateRect()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00684">tagED::pTabStops</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00958">UserLocalAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00959">UserLocalReAlloc</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/editml_8c-source.html#l03457">MLEditWndProc()</a>.
<p>
<pre class="fragment"><div>00462 {
00463     <span class="keywordtype">int</span> *pTabStops;
00464 
00465     <span class="comment">/*</span>
00466 <span class="comment">     * Check if tab positions already exist</span>
00467 <span class="comment">     */</span>
00468     <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o73">pTabStops</a>) {
00469 
00470         <span class="comment">/*</span>
00471 <span class="comment">         * Check if the caller wants the new tab positions</span>
00472 <span class="comment">         */</span>
00473         <span class="keywordflow">if</span> (nTabPos) {
00474 
00475             <span class="comment">/*</span>
00476 <span class="comment">             * Allocate the array of tab stops</span>
00477 <span class="comment">             */</span>
00478             <span class="keywordflow">if</span> (!(pTabStops = (LPINT)<a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(HEAP_ZERO_MEMORY, (nTabPos + 1) * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)))) {
00479                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00480             }
00481         } <span class="keywordflow">else</span> {
00482             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; <span class="comment">/* No stops then and no stops now! */</span>
00483         }
00484     } <span class="keywordflow">else</span> {
00485 
00486         <span class="comment">/*</span>
00487 <span class="comment">         * Check if the caller wants the new tab positions</span>
00488 <span class="comment">         */</span>
00489         <span class="keywordflow">if</span> (nTabPos) {
00490 
00491             <span class="comment">/*</span>
00492 <span class="comment">             * Check if the number of tab positions is different</span>
00493 <span class="comment">             */</span>
00494             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o73">pTabStops</a>[0] != nTabPos) {
00495 
00496                 <span class="comment">/*</span>
00497 <span class="comment">                 * Yes! So ReAlloc to new size</span>
00498 <span class="comment">                 */</span>
00499                 <span class="keywordflow">if</span> (!(pTabStops = (LPINT)<a class="code" href="../../d6/d0/usercli_8h.html#a137">UserLocalReAlloc</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o73">pTabStops</a>,
00500                         (nTabPos + 1) * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 0)))
00501                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00502             } <span class="keywordflow">else</span> {
00503                 pTabStops = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o73">pTabStops</a>;
00504             }
00505         } <span class="keywordflow">else</span> {
00506 
00507             <span class="comment">/*</span>
00508 <span class="comment">             * Caller wants to remove all the tab stops; So, release</span>
00509 <span class="comment">             */</span>
00510             <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o73">pTabStops</a>))
00511                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;  <span class="comment">/* Failure */</span>
00512             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o73">pTabStops</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00513             <span class="keywordflow">goto</span> RedrawAndReturn;
00514         }
00515     }
00516 
00517     <span class="comment">/*</span>
00518 <span class="comment">     * Copy the new tab stops onto the tab stop array after converting the</span>
00519 <span class="comment">     * dialog co-ordinates into the pixel co-ordinates</span>
00520 <span class="comment">     */</span>
00521     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o73">pTabStops</a> = pTabStops;
00522     *pTabStops++ = nTabPos; <span class="comment">/* First element contains the count */</span>
00523     <span class="keywordflow">while</span> (nTabPos--) {
00524 
00525         <span class="comment">/*</span>
00526 <span class="comment">         * aveCharWidth must be used instead of cxSysCharWidth.</span>
00527 <span class="comment">         * Fix for Bug #3871 --SANKAR-- 03/14/91</span>
00528 <span class="comment">         */</span>
00529         *pTabStops++ = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(*lpTabStops++, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a>, 4);
00530     }
00531 
00532 RedrawAndReturn:
00533     <span class="comment">// Because the tabstops have changed, we need to recompute the</span>
00534     <span class="comment">// maxPixelWidth. Otherwise, horizontal scrolls will have problems.</span>
00535     <span class="comment">// Fix for Bug #6042 - 3/15/94</span>
00536     <a class="code" href="../../d6/d0/usercli_8h.html#a490">MLBuildchLines</a>(ped, 0, 0, FALSE, NULL, NULL);
00537 
00538     <span class="comment">// Caret may have changed line by the line recalc above.</span>
00539     <a class="code" href="../../d6/d0/usercli_8h.html#a519">MLUpdateiCaretLine</a>(ped);
00540 
00541     <a class="code" href="../../d6/d0/usercli_8h.html#a485">MLEnsureCaretVisible</a>(ped);
00542 
00543     <span class="comment">// Also, we need to redraw the whole window.</span>
00544     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, NULL, TRUE);
00545     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00546 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="edmlrare.c::MLStripCrCrLf" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MLStripCrCrLf           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ped</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/edmlrare_8c-source.html#l00159">159</a> of file <a class="el" href="../../d6/d4/edmlrare_8c-source.html">edmlrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00564">tagED::ichCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/editec_8c-source.html#l02547">ECResetTextInfo()</a>, and <a class="el" href="../../d2/d4/editml_8c-source.html#l03457">MLEditWndProc()</a>.
<p>
<pre class="fragment"><div>00161 {
00162     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>) {
00163         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>) {
00164             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pchSrc;
00165             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pchDst;
00166             <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pchLast;
00167 
00168             pchSrc = pchDst = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00169             pchLast = pchSrc + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>;
00170             <span class="keywordflow">while</span> (pchSrc &lt; pchLast) {
00171                 <span class="keywordflow">if</span> (   (pchSrc[0] == 0x0D)
00172                     &amp;&amp; (pchSrc[1] == 0x0D)
00173                     &amp;&amp; (pchSrc[2] == 0x0A)
00174                 ) {
00175                     pchSrc += 3;
00176                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> -= 3;
00177                 } <span class="keywordflow">else</span> {
00178                     *pchDst++ = *pchSrc++;
00179                 }
00180             }
00181         } <span class="keywordflow">else</span> { <span class="comment">// !fAnsi</span>
00182             LPWSTR pwchSrc;
00183             LPWSTR pwchDst;
00184             LPWSTR pwchLast;
00185 
00186             pwchSrc = pwchDst = (LPWSTR)<a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00187             pwchLast = pwchSrc + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>;
00188             <span class="keywordflow">while</span> (pwchSrc &lt; pwchLast) {
00189                 <span class="keywordflow">if</span> (   (pwchSrc[0] == 0x0D)
00190                     &amp;&amp; (pwchSrc[1] == 0x0D)
00191                     &amp;&amp; (pwchSrc[2] == 0x0A)
00192                 ) {
00193                     pwchSrc += 3;
00194                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> -= 3;
00195                 } <span class="keywordflow">else</span> {
00196                     *pwchDst++ = *pwchSrc++;
00197                 }
00198             }
00199         }
00200         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00201 
00202         <span class="comment">/*</span>
00203 <span class="comment">         * Make sure we don't have any values past the last character</span>
00204 <span class="comment">         */</span>
00205         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> &gt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>)
00206             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>  = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>;
00207         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> &gt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>)
00208             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>;
00209         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> &gt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>)
00210             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>;
00211     }
00212 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="edmlrare.c::MLUndo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL MLUndo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ped</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/edmlrare_8c-source.html#l00556">556</a> of file <a class="el" href="../../d6/d4/edmlrare_8c-source.html">edmlrare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l01040">MLInsertText()</a>, <a class="el" href="../../d6/d4/edmlrare_8c-source.html#l00368">MLSetSelection()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00526">UNDO_DELETE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00525">UNDO_INSERT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00524">UNDO_NONE</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00124">UserGlobalFree</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/editml_8c-source.html#l03457">MLEditWndProc()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l01040">MLInsertText()</a>, and <a class="el" href="../../d2/d4/editml_8c-source.html#l01309">MLReplaceSel()</a>.
<p>
<pre class="fragment"><div>00558 {
00559     HANDLE hDeletedText = ped-&gt;hDeletedText;
00560     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fDelete = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)(ped-&gt;undoType &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a84">UNDO_DELETE</a>);
00561     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> cchDeleted = ped-&gt;cchDeleted;
00562     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> ichDeleted = ped-&gt;ichDeleted;
00563 
00564     <span class="keywordflow">if</span> (ped-&gt;undoType == <a class="code" href="../../d6/d0/usercli_8h.html#a82">UNDO_NONE</a>) {
00565 
00566         <span class="comment">/*</span>
00567 <span class="comment">         * No undo...</span>
00568 <span class="comment">         */</span>
00569         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00570     }
00571 
00572     ped-&gt;hDeletedText = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00573     ped-&gt;cchDeleted = 0;
00574     ped-&gt;ichDeleted = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>)-1;
00575     ped-&gt;undoType &amp;= ~<a class="code" href="../../d6/d0/usercli_8h.html#a84">UNDO_DELETE</a>;
00576 
00577     <span class="keywordflow">if</span> (ped-&gt;undoType == <a class="code" href="../../d6/d0/usercli_8h.html#a83">UNDO_INSERT</a>) {
00578         ped-&gt;undoType = <a class="code" href="../../d6/d0/usercli_8h.html#a82">UNDO_NONE</a>;
00579 
00580         <span class="comment">/*</span>
00581 <span class="comment">         * Set the selection to the inserted text</span>
00582 <span class="comment">         */</span>
00583         <a class="code" href="../../d6/d0/usercli_8h.html#a506">MLSetSelection</a>(ped, FALSE, ped-&gt;ichInsStart, ped-&gt;ichInsEnd);
00584         ped-&gt;ichInsStart = ped-&gt;ichInsEnd = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>)-1;
00585 
00586         <span class="comment">/*</span>
00587 <span class="comment">         * Now send a backspace to delete and save it in the undo buffer...</span>
00588 <span class="comment">         */</span>
00589         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, WM_CHAR, (WPARAM)VK_BACK, 0L);
00590     }
00591 
00592     <span class="keywordflow">if</span> (fDelete) {
00593 
00594         <span class="comment">/*</span>
00595 <span class="comment">         * Insert deleted chars</span>
00596 <span class="comment">         */</span>
00597 
00598         <span class="comment">/*</span>
00599 <span class="comment">         * Set the selection to the inserted text</span>
00600 <span class="comment">         */</span>
00601         <a class="code" href="../../d6/d0/usercli_8h.html#a506">MLSetSelection</a>(ped, FALSE, ichDeleted, ichDeleted);
00602         <a class="code" href="../../d6/d0/usercli_8h.html#a483">MLInsertText</a>(ped, hDeletedText, cchDeleted, FALSE);
00603 
00604         <a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>(hDeletedText);
00605         <a class="code" href="../../d6/d0/usercli_8h.html#a506">MLSetSelection</a>(ped, FALSE, ichDeleted, ichDeleted + cchDeleted);
00606     }
00607 
00608     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00609 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:32 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
