<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: cc.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>cc.h File Reference</h1><code>#include &lt;<a class="el" href="../../d0/d8/ntos_8h-source.html">ntos.h</a>&gt;</code><br>
<code>#include &lt;NtIoLogc.h&gt;</code><br>
<code>#include &lt;FsRtl.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;limits.h&gt;</code><br>

<p>
<a href="../../d6/d4/cc_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">_VACB_LEVEL_REFERENCE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d5/struct__VACB.html">_VACB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html">_PRIVATE_CACHE_MAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">_SHARED_CACHE_MAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html">_SHARED_CACHE_MAP_LIST_CURSOR</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d3/struct__BITMAP__RANGE.html">_BITMAP_RANGE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d6/struct__MBCB.html">_MBCB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d3/struct__BCB.html">_BCB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d4/struct__OBCB.html">_OBCB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d2/struct__DEFERRED__WRITE.html">_DEFERRED_WRITE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d9/struct__LAZY__WRITER.html">_LAZY_WRITER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">_WORK_QUEUE_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d7/struct__MDL__WRITE.html">_MDL_WRITE</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a0">CcAcquireMasterLock</a>(OldIrql)&nbsp;&nbsp;&nbsp;ExAcquireSpinLock( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a8">CcMasterSpinLock</a>, OldIrql )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a1">CcReleaseMasterLock</a>(OldIrql)&nbsp;&nbsp;&nbsp;ExReleaseSpinLock( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a8">CcMasterSpinLock</a>, OldIrql )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a2">CcAcquireMasterLockAtDpcLevel</a>()&nbsp;&nbsp;&nbsp;ExAcquireSpinLockAtDpcLevel( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a8">CcMasterSpinLock</a> )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a3">CcReleaseMasterLockFromDpcLevel</a>()&nbsp;&nbsp;&nbsp;ExReleaseSpinLockFromDpcLevel( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a8">CcMasterSpinLock</a> )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>(OldIrql)&nbsp;&nbsp;&nbsp;ExAcquireSpinLock( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a9">CcVacbSpinLock</a>, OldIrql )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>(OldIrql)&nbsp;&nbsp;&nbsp;ExReleaseSpinLock( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a9">CcVacbSpinLock</a>, OldIrql )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a6">CcAcquireVacbLockAtDpcLevel</a>()&nbsp;&nbsp;&nbsp;ExAcquireSpinLockAtDpcLevel( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a9">CcVacbSpinLock</a> )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a7">CcReleaseVacbLockFromDpcLevel</a>()&nbsp;&nbsp;&nbsp;ExReleaseSpinLockFromDpcLevel( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a9">CcVacbSpinLock</a> )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a8">FsRtlAllocatePool</a>(a, b)&nbsp;&nbsp;&nbsp;FsRtlAllocatePoolWithTag(a,b,'  cC')</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a9">FsRtlAllocatePoolWithQuota</a>(a, b)&nbsp;&nbsp;&nbsp;FsRtlAllocatePoolWithQuotaTag(a,b,'  cC')</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(a, b)&nbsp;&nbsp;&nbsp;ExAllocatePoolWithTag(a,b,'  cC')</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a11">ExAllocatePoolWithQuota</a>(a, b)&nbsp;&nbsp;&nbsp;ExAllocatePoolWithQuotaTag(a,b,'  cC')</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a12">CACHE_NTC_SHARED_CACHE_MAP</a>&nbsp;&nbsp;&nbsp;(0x2FF)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a13">CACHE_NTC_PRIVATE_CACHE_MAP</a>&nbsp;&nbsp;&nbsp;(0x2FE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a14">CACHE_NTC_BCB</a>&nbsp;&nbsp;&nbsp;(0x2FD)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a15">CACHE_NTC_DEFERRED_WRITE</a>&nbsp;&nbsp;&nbsp;(0x2FC)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a16">CACHE_NTC_MBCB</a>&nbsp;&nbsp;&nbsp;(0x2FB)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a17">CACHE_NTC_OBCB</a>&nbsp;&nbsp;&nbsp;(0x2FA)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a18">CACHE_NTC_MBCB_GRANDE</a>&nbsp;&nbsp;&nbsp;(0x2F9)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a19">CACHE_BUG_CHECK_CACHEDAT</a>&nbsp;&nbsp;&nbsp;(0x00010000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a20">CACHE_BUG_CHECK_CACHESUB</a>&nbsp;&nbsp;&nbsp;(0x00020000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a21">CACHE_BUG_CHECK_COPYSUP</a>&nbsp;&nbsp;&nbsp;(0x00030000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a22">CACHE_BUG_CHECK_FSSUP</a>&nbsp;&nbsp;&nbsp;(0x00040000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a23">CACHE_BUG_CHECK_LAZYRITE</a>&nbsp;&nbsp;&nbsp;(0x00050000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a24">CACHE_BUG_CHECK_LOGSUP</a>&nbsp;&nbsp;&nbsp;(0x00060000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a25">CACHE_BUG_CHECK_MDLSUP</a>&nbsp;&nbsp;&nbsp;(0x00070000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a26">CACHE_BUG_CHECK_PINSUP</a>&nbsp;&nbsp;&nbsp;(0x00080000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a27">CACHE_BUG_CHECK_VACBSUP</a>&nbsp;&nbsp;&nbsp;(0x00090000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a28">CcBugCheck</a>(A, B, C)&nbsp;&nbsp;&nbsp;{ KeBugCheckEx(CACHE_MANAGER, BugCheckFileId | __LINE__, A, B, C ); }</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a29">DEFAULT_CREATE_MODULO</a>&nbsp;&nbsp;&nbsp;((ULONG)(0x00100000))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a30">DEFAULT_EXTEND_MODULO</a>&nbsp;&nbsp;&nbsp;((ULONG)(0x00100000))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a31">SEQUENTIAL_MAP_LIMIT</a>&nbsp;&nbsp;&nbsp;((ULONG)(0x00080000))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a32">MAX_READ_AHEAD</a>&nbsp;&nbsp;&nbsp;(8 * 1024 * 1024)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a33">MAX_WRITE_BEHIND</a>&nbsp;&nbsp;&nbsp;(MM_MAXIMUM_DISK_IO_SIZE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a34">WRITE_CHARGE_THRESHOLD</a>&nbsp;&nbsp;&nbsp;(64 * PAGE_SIZE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a35">MAX_ZERO_TRANSFER</a>&nbsp;&nbsp;&nbsp;(PAGE_SIZE * 128)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a36">MIN_ZERO_TRANSFER</a>&nbsp;&nbsp;&nbsp;(0x10000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a37">MAX_ZEROS_IN_CACHE</a>&nbsp;&nbsp;&nbsp;(0x10000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>&nbsp;&nbsp;&nbsp;(7)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a39">VACB_LEVEL_BLOCK_SIZE</a>&nbsp;&nbsp;&nbsp;((1 &lt;&lt; VACB_LEVEL_SHIFT) * sizeof(PVOID))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a40">VACB_LAST_INDEX_FOR_LEVEL</a>&nbsp;&nbsp;&nbsp;((1 &lt;&lt; VACB_LEVEL_SHIFT) - 1)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a41">VACB_SIZE_OF_FIRST_LEVEL</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; (VACB_OFFSET_SHIFT + VACB_LEVEL_SHIFT))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a42">VACB_NUMBER_OF_LEVELS</a>&nbsp;&nbsp;&nbsp;(((63 - VACB_OFFSET_SHIFT)/VACB_LEVEL_SHIFT) + 1)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a43">MBCB_BITMAP_BLOCK_SIZE</a>&nbsp;&nbsp;&nbsp;(VACB_LEVEL_BLOCK_SIZE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a44">MBCB_BITMAP_RANGE</a>&nbsp;&nbsp;&nbsp;(MBCB_BITMAP_BLOCK_SIZE * 8 * PAGE_SIZE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a45">MBCB_BITMAP_INITIAL_SIZE</a>&nbsp;&nbsp;&nbsp;(2 * sizeof(<a class="el" href="../../d8/d3/struct__BITMAP__RANGE.html">BITMAP_RANGE</a>))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a46">BEGIN_BCB_LIST_ARRAY</a>&nbsp;&nbsp;&nbsp;(0x200000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a47">SIZE_PER_BCB_LIST</a>&nbsp;&nbsp;&nbsp;(VACB_MAPPING_GRANULARITY * 2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a48">BCB_LIST_SHIFT</a>&nbsp;&nbsp;&nbsp;(VACB_OFFSET_SHIFT + 1)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a49">GetBcbListHead</a>(SCM, OFF, FAILSUCC)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a50">CcLockVacbLevel</a>(SCM, OFF)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a51">CcUnlockVacbLevel</a>(SCM, OFF)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a52">NOISE_BITS</a>&nbsp;&nbsp;&nbsp;(0x7)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a53">LAZY_WRITER_IDLE_DELAY</a>&nbsp;&nbsp;&nbsp;((LONG)(10000000))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a54">LAZY_WRITER_COLLISION_DELAY</a>&nbsp;&nbsp;&nbsp;((LONG)(1000000))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a55">LAZY_WRITER_MAX_AGE_TARGET</a>&nbsp;&nbsp;&nbsp;((ULONG)(8))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a56">CC_REQUEUE</a>&nbsp;&nbsp;&nbsp;35422</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a57">mm</a>&nbsp;&nbsp;&nbsp;(0x100)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(F, SF)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a59">BooleanFlagOn</a>(F, SF)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a60">SetFlag</a>(F, SF)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a61">ClearFlag</a>(F, SF)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a62">QuadAlign</a>(P)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a63">CcAddToLog</a>(LOG, ACTION, REASON)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a64">PREALLOCATED_VACBS</a>&nbsp;&nbsp;&nbsp;(4)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a65">VACB_SPECIAL_REFERENCE</a>&nbsp;&nbsp;&nbsp;((<a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a>) ~0)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a66">VACB_SPECIAL_DEREFERENCE</a>&nbsp;&nbsp;&nbsp;((<a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a>) ~1)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a67">VACB_SPECIAL_FIRST_VALID</a>&nbsp;&nbsp;&nbsp;VACB_SPECIAL_DEREFERENCE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a68">CcIncrementOpenCount</a>(SCM, REASON)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a69">CcDecrementOpenCount</a>(SCM, REASON)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a70">DISABLE_READ_AHEAD</a>&nbsp;&nbsp;&nbsp;0x0001</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a71">DISABLE_WRITE_BEHIND</a>&nbsp;&nbsp;&nbsp;0x0002</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a72">PIN_ACCESS</a>&nbsp;&nbsp;&nbsp;0x0004</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a73">TRUNCATE_REQUIRED</a>&nbsp;&nbsp;&nbsp;0x0010</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a74">WRITE_QUEUED</a>&nbsp;&nbsp;&nbsp;0x0020</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a75">ONLY_SEQUENTIAL_ONLY_SEEN</a>&nbsp;&nbsp;&nbsp;0x0040</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a76">ACTIVE_PAGE_IS_DIRTY</a>&nbsp;&nbsp;&nbsp;0x0080</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a77">BEING_CREATED</a>&nbsp;&nbsp;&nbsp;0x0100</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a78">MODIFIED_WRITE_DISABLED</a>&nbsp;&nbsp;&nbsp;0x0200</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a79">LAZY_WRITE_OCCURRED</a>&nbsp;&nbsp;&nbsp;0x0400</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a80">IS_CURSOR</a>&nbsp;&nbsp;&nbsp;0x0800</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a81">RANDOM_ACCESS_SEEN</a>&nbsp;&nbsp;&nbsp;0x1000</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a82">GetActiveVacb</a>(SCM, IRQ, V, P, D)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a83">GetActiveVacbAtDpcLevel</a>(SCM, V, P, D)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a84">SetActiveVacb</a>(SCM, IRQ, V, P, D)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a85">ZERO_FIRST_PAGE</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a86">ZERO_MIDDLE_PAGES</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a87">ZERO_LAST_PAGE</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a88">CcAllocateWorkQueueEntry</a>()&nbsp;&nbsp;&nbsp;(<a class="el" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">PWORK_QUEUE_ENTRY</a>)ExAllocateFromPPNPagedLookasideList(LookasideTwilightList)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a89">CcFreeWorkQueueEntry</a>(_entry_)&nbsp;&nbsp;&nbsp;ExFreeToPPNPagedLookasideList(LookasideTwilightList, (_entry_))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a90">try_return</a>(S)&nbsp;&nbsp;&nbsp;{ S; goto try_exit; }</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(INDENT, LEVEL, X, Y)&nbsp;&nbsp;&nbsp;{NOTHING;}</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a92">DebugTrace2</a>(INDENT, LEVEL, X, Y, Z)&nbsp;&nbsp;&nbsp;{NOTHING;}</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a93">DebugDump</a>(STR, LEVEL, PTR)&nbsp;&nbsp;&nbsp;{NOTHING;}</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">_VACB_LEVEL_REFERENCE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a95">VACB_LEVEL_REFERENCE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">_VACB_LEVEL_REFERENCE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a96">PVACB_LEVEL_REFERENCE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d5/struct__VACB.html">_VACB</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a97">VACB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d5/struct__VACB.html">_VACB</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a98">PVACB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html">_PRIVATE_CACHE_MAP</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a99">PRIVATE_CACHE_MAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html">PRIVATE_CACHE_MAP</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a100">PPRIVATE_CACHE_MAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">_SHARED_CACHE_MAP</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a101">SHARED_CACHE_MAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">SHARED_CACHE_MAP</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a102">PSHARED_CACHE_MAP</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html">_SHARED_CACHE_MAP_LIST_CURSOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a103">SHARED_CACHE_MAP_LIST_CURSOR</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html">_SHARED_CACHE_MAP_LIST_CURSOR</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a104">PSHARED_CACHE_MAP_LIST_CURSOR</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d3/struct__BITMAP__RANGE.html">_BITMAP_RANGE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a105">BITMAP_RANGE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d3/struct__BITMAP__RANGE.html">_BITMAP_RANGE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a106">PBITMAP_RANGE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d6/struct__MBCB.html">_MBCB</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a107">MBCB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d6/struct__MBCB.html">MBCB</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a108">PMBCB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d3/struct__BCB.html">_BCB</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a109">BCB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d3/struct__BCB.html">BCB</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a110">PBCB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d4/struct__OBCB.html">_OBCB</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a111">OBCB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d4/struct__OBCB.html">OBCB</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a112">POBCB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d2/struct__DEFERRED__WRITE.html">_DEFERRED_WRITE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a113">DEFERRED_WRITE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d2/struct__DEFERRED__WRITE.html">_DEFERRED_WRITE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a114">PDEFERRED_WRITE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d9/struct__LAZY__WRITER.html">_LAZY_WRITER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a115">LAZY_WRITER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d5/d5/cc_8h.html#a210">_WORKER_FUNCTION</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a116">WORKER_FUNCTION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">_WORK_QUEUE_ENTRY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a117">WORK_QUEUE_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">_WORK_QUEUE_ENTRY</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a118">PWORK_QUEUE_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d7/struct__MDL__WRITE.html">_MDL_WRITE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a119">MDL_WRITE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d7/struct__MDL__WRITE.html">_MDL_WRITE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a120">PMDL_WRITE</a></td></tr>

<tr><td colspan=2><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a210">_WORKER_FUNCTION</a> { <br>
&nbsp;&nbsp;<a class="el" href="../../d5/d5/cc_8h.html#a210a166">Noop</a> =  0, 
<a class="el" href="../../d5/d5/cc_8h.html#a210a167">ReadAhead</a>, 
<a class="el" href="../../d5/d5/cc_8h.html#a210a168">WriteBehind</a>, 
<a class="el" href="../../d5/d5/cc_8h.html#a210a169">LazyWriteScan</a>, 
<br>
&nbsp;&nbsp;<a class="el" href="../../d5/d5/cc_8h.html#a210a170">EventSet</a>
<br>
 }</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a211">UNMAP_ACTIONS</a> { <a class="el" href="../../d5/d5/cc_8h.html#a211a171">UNPIN</a>, 
<a class="el" href="../../d5/d5/cc_8h.html#a211a172">UNREF</a>, 
<a class="el" href="../../d5/d5/cc_8h.html#a211a173">SET_CLEAN</a>
 }</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a174">CcPostDeferredWrites</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a175">CcPinFileData</a> (IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject, IN PLARGE_INTEGER FileOffset, IN ULONG Length, IN BOOLEAN ReadOnly, IN BOOLEAN WriteOnly, IN ULONG Flags, OUT <a class="el" href="../../d4/d3/struct__BCB.html">PBCB</a> *Bcb, OUT PVOID *BaseAddress, OUT PLARGE_INTEGER BeyondLastByte)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a176">CcUnpinFileData</a> (IN OUT <a class="el" href="../../d4/d3/struct__BCB.html">PBCB</a> Bcb, IN BOOLEAN ReadOnly, IN <a class="el" href="../../d5/d5/cc_8h.html#a211">UNMAP_ACTIONS</a> UnmapAction)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a177">CcDeallocateBcb</a> (IN <a class="el" href="../../d4/d3/struct__BCB.html">PBCB</a> Bcb)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a178">CcPerformReadAhead</a> (IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a179">CcSetDirtyInMask</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN PLARGE_INTEGER FileOffset, IN ULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a180">CcWriteBehind</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN PIO_STATUS_BLOCK IoStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a181">CcMapAndRead</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN PLARGE_INTEGER FileOffset, IN ULONG Length, IN ULONG ZeroFlags, IN BOOLEAN Wait, IN PVOID BaseAddress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a182">CcFreeActiveVacb</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> ActiveVacb OPTIONAL, IN ULONG ActivePage, IN ULONG PageIsDirty)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a183">CcMapAndCopy</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN PVOID UserBuffer, IN PLARGE_INTEGER FileOffset, IN ULONG Length, IN ULONG ZeroFlags, IN BOOLEAN WriteThrough)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a184">CcScanDpc</a> (IN <a class="el" href="../../d1/d6/struct__KDPC.html">PKDPC</a> Dpc, IN PVOID DeferredContext, IN PVOID SystemArgument1, IN PVOID SystemArgument2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a185">CcScheduleLazyWriteScan</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a186">CcStartLazyWriter</a> (IN PVOID NotUsed)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a187">CcPostWorkQueue</a> (IN <a class="el" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">PWORK_QUEUE_ENTRY</a> WorkQueueEntry, IN PLIST_ENTRY WorkQueue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a188">CcWorkerThread</a> (PVOID ExWorkQueueItem)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a189">CcDeleteSharedCacheMap</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN KIRQL ListIrql, IN ULONG ReleaseFile)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a190">CcCopyReadExceptionFilter</a> (IN PEXCEPTION_POINTERS ExceptionPointer, IN PNTSTATUS ExceptionCode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a191">CcExceptionFilter</a> (IN NTSTATUS ExceptionCode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a192">CcInitializeVacbs</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a193">CcGetVirtualAddressIfMapped</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN LONGLONG FileOffset, OUT <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *Vacb, OUT PULONG ReceivedLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a194">CcGetVirtualAddress</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN LARGE_INTEGER FileOffset, OUT <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *Vacb, OUT PULONG ReceivedLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a195">CcFreeVirtualAddress</a> (IN <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> Vacb)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a196">CcReferenceFileOffset</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN LARGE_INTEGER FileOffset)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a197">CcDereferenceFileOffset</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN LARGE_INTEGER FileOffset)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a198">CcWaitOnActiveCount</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a199">CcCreateVacbArray</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN LARGE_INTEGER NewSectionSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a200">CcExtendVacbArray</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN LARGE_INTEGER NewSectionSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN FASTCALL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a201">CcUnmapVacbArray</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN PLARGE_INTEGER FileOffset OPTIONAL, IN ULONG Length, IN BOOLEAN UnmapBehind)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a202">CcAdjustVacbLevelLockCount</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN LONGLONG FileOffset, IN LONG Adjustment)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PLIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a203">CcGetBcbListHeadLargeOffset</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN LONGLONG FileOffset, IN BOOLEAN FailToSuccessor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a204">CcPrefillVacbLevelZone</a> (IN ULONG NumberNeeded, OUT PKIRQL OldIrql, IN ULONG NeedBcbListHeads)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a205">CcDrainVacbLevelZone</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>_inline <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a206">CcAllocateVacbLevel</a> (IN BOOLEAN AllocatingBcbListHeads)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>_inline VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a207">CcDeallocateVacbLevel</a> (IN <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *Entry, IN BOOLEAN DeallocatingBcbListHeads)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>_inline <a class="el" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">PVACB_LEVEL_REFERENCE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a208">VacbLevelReference</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *VacbArray, IN ULONG Level)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>_inline ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a209">IsVacbLevelReferenced</a> (IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap, IN <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *VacbArray, IN ULONG Level)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>PFN_COUNT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a94">MmAvailablePages</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a121">CcMasterSpinLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a122">CcBcbSpinLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a123">CcCleanSharedCacheMapList</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html">SHARED_CACHE_MAP_LIST_CURSOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a124">CcDirtySharedCacheMapList</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html">SHARED_CACHE_MAP_LIST_CURSOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a125">CcLazyWriterCursor</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">NPAGED_LOOKASIDE_LIST</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a126">CcTwilightLookasideList</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a127">CcWorkQueueSpinlock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a128">CcNumberWorkerThreads</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a129">CcNumberActiveWorkerThreads</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a130">CcIdleWorkerThreadList</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a131">CcExpressWorkQueue</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a132">CcRegularWorkQueue</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a133">CcPostTickWorkQueue</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a134">CcQueueThrottle</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a135">CcIdleDelayTick</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a136">CcNoDelay</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a137">CcFirstDelay</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a138">CcIdleDelay</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a139">CcCollisionDelay</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a140">CcTargetCleanDelay</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d9/struct__LAZY__WRITER.html">LAZY_WRITER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a141">LazyWriter</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a142">CcVacbSpinLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a143">CcNumberVacbs</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a144">CcVacbs</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a145">CcBeyondVacbs</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a146">CcVacbLru</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a147">CcDeferredWriteSpinLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a148">CcDeferredWrites</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a149">CcDirtyPageThreshold</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a150">CcDirtyPageTarget</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a151">CcDirtyPagesLastScan</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a152">CcPagesYetToWrite</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a153">CcPagesWrittenLastTime</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a154">CcAvailablePagesThreshold</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a155">CcTotalDirtyPages</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a156">CcTune</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a157">CcAggressiveZeroCount</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a158">CcAggressiveZeroThreshold</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a159">CcLazyWriteHotSpots</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d1/mm_8h.html#a140">MM_SYSTEMSIZE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a160">CcCapturedSystemSize</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a161">CcMaxVacbLevelsSeen</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a162">CcVacbLevelEntries</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a163">CcVacbLevelFreeList</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a164">CcVacbLevelWithBcbsEntries</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/cc_8h.html#a165">CcVacbLevelWithBcbsFreeList</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a76" doxytag="cc.h::ACTIVE_PAGE_IS_DIRTY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ACTIVE_PAGE_IS_DIRTY&nbsp;&nbsp;&nbsp;0x0080          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01065">1065</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01482">CcFastCopyWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">CcFreeActiveVacb()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="cc.h::BCB_LIST_SHIFT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BCB_LIST_SHIFT&nbsp;&nbsp;&nbsp;(VACB_OFFSET_SHIFT + 1)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00387">387</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="cc.h::BEGIN_BCB_LIST_ARRAY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BEGIN_BCB_LIST_ARRAY&nbsp;&nbsp;&nbsp;(0x200000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00385">385</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01208">CcCreateVacbArray()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a77" doxytag="cc.h::BEING_CREATED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BEING_CREATED&nbsp;&nbsp;&nbsp;0x0100          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01071">1071</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a59" doxytag="cc.h::BooleanFlagOn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define BooleanFlagOn          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">F,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>SF&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(    \
    (BOOLEAN)(((F) &amp; (SF)) != 0) \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00501">501</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01982">CcDeferWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01482">CcFastCopyWrite()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00271">CcPinMappedData()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03758">CcReleaseByteRangeFromWrite()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l04722">FsRtlPrivateCheckWaitingLocks()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l01173">FsRtlProcessFileLock()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l00108">UdfCommonCreate()</a>, <a class="el" href="../../d8/d4/udfs_2read_8c-source.html#l00068">UdfCommonRead()</a>, <a class="el" href="../../d2/d7/dirctrl_8c-source.html#l01500">UdfEnumerateIndex()</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l00675">UdfIllegalFcbAccess()</a>, <a class="el" href="../../d2/d7/dirctrl_8c-source.html#l01003">UdfInitializeEnumeration()</a>, <a class="el" href="../../d2/d7/dirctrl_8c-source.html#l00904">UdfNotifyChangeDirectory()</a>, and <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01232">UdfQueryAlternateNameInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="cc.h::CACHE_BUG_CHECK_CACHEDAT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_BUG_CHECK_CACHEDAT&nbsp;&nbsp;&nbsp;(0x00010000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00175">175</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="cc.h::CACHE_BUG_CHECK_CACHESUB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_BUG_CHECK_CACHESUB&nbsp;&nbsp;&nbsp;(0x00020000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00176">176</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="cc.h::CACHE_BUG_CHECK_COPYSUP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_BUG_CHECK_COPYSUP&nbsp;&nbsp;&nbsp;(0x00030000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00177">177</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="cc.h::CACHE_BUG_CHECK_FSSUP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_BUG_CHECK_FSSUP&nbsp;&nbsp;&nbsp;(0x00040000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00178">178</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="cc.h::CACHE_BUG_CHECK_LAZYRITE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_BUG_CHECK_LAZYRITE&nbsp;&nbsp;&nbsp;(0x00050000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00179">179</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="cc.h::CACHE_BUG_CHECK_LOGSUP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_BUG_CHECK_LOGSUP&nbsp;&nbsp;&nbsp;(0x00060000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00180">180</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="cc.h::CACHE_BUG_CHECK_MDLSUP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_BUG_CHECK_MDLSUP&nbsp;&nbsp;&nbsp;(0x00070000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00181">181</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="cc.h::CACHE_BUG_CHECK_PINSUP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_BUG_CHECK_PINSUP&nbsp;&nbsp;&nbsp;(0x00080000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00182">182</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="cc.h::CACHE_BUG_CHECK_VACBSUP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_BUG_CHECK_VACBSUP&nbsp;&nbsp;&nbsp;(0x00090000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00183">183</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="cc.h::CACHE_NTC_BCB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_NTC_BCB&nbsp;&nbsp;&nbsp;(0x2FD)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00155">155</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02439">CcCalculateVacbLevelLockCount()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05694">CcDeallocateBcb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05314">CcFindBcb()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00142">CcGetDirtyPages()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04232">CcGetFlushedValidData()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00450">CcGetLsnForFileObject()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00271">CcPinMappedData()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03758">CcReleaseByteRangeFromWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05024">CcRemapBcb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="cc.h::CACHE_NTC_DEFERRED_WRITE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_NTC_DEFERRED_WRITE&nbsp;&nbsp;&nbsp;(0x2FC)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00156">156</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, and <a class="el" href="../../d6/d6/copysup_8c-source.html#l01982">CcDeferWrite()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="cc.h::CACHE_NTC_MBCB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_NTC_MBCB&nbsp;&nbsp;&nbsp;(0x2FB)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00157">157</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="cc.h::CACHE_NTC_MBCB_GRANDE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_NTC_MBCB_GRANDE&nbsp;&nbsp;&nbsp;(0x2F9)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00159">159</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="cc.h::CACHE_NTC_OBCB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_NTC_OBCB&nbsp;&nbsp;&nbsp;(0x2FA)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00158">158</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d8/pinsup_8c-source.html#l01230">CcAllocateObcb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05024">CcRemapBcb()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l01078">CcSetBcbOwnerPointer()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02560">CcSetDirtyPinnedData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l01000">CcUnpinData()</a>, and <a class="el" href="../../d3/d8/pinsup_8c-source.html#l01142">CcUnpinDataForThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="cc.h::CACHE_NTC_PRIVATE_CACHE_MAP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_NTC_PRIVATE_CACHE_MAP&nbsp;&nbsp;&nbsp;(0x2FE)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00154">154</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="cc.h::CACHE_NTC_SHARED_CACHE_MAP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_NTC_SHARED_CACHE_MAP&nbsp;&nbsp;&nbsp;(0x2FF)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00153">153</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a56" doxytag="cc.h::CC_REQUEUE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CC_REQUEUE&nbsp;&nbsp;&nbsp;35422          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00442">442</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="cc.h::CcAcquireMasterLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcAcquireMasterLock          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OldIrql&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExAcquireSpinLock( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a8">CcMasterSpinLock</a>, OldIrql )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00064">64</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01982">CcDeferWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">CcFreeActiveVacb()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00142">CcGetDirtyPages()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l03658">CcGetFileObjectFromSectionPtrs()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04232">CcGetFlushedValidData()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00362">CcIsThereDirtyData()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00838">CcMdlWriteComplete2()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00032">CcSetAdditionalCacheAttributes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00158">CcWaitForCurrentLazyWriterActivity()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02804">CcZeroEndOfLastPage()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="cc.h::CcAcquireMasterLockAtDpcLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcAcquireMasterLockAtDpcLevel          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExAcquireSpinLockAtDpcLevel( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a8">CcMasterSpinLock</a> )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00070">70</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02626">CcDeleteMbcb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04232">CcGetFlushedValidData()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02560">CcSetDirtyPinnedData()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="cc.h::CcAcquireVacbLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcAcquireVacbLock          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OldIrql&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExAcquireSpinLock( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a9">CcVacbSpinLock</a>, OldIrql )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00076">76</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01007">CcDereferenceFileOffset()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02044">CcDrainVacbLevelZone()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00862">CcFreeVirtualAddress()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00310">CcGetVirtualAddress()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00230">CcGetVirtualAddressIfMapped()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01931">CcPrefillVacbLevelZone()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05024">CcRemapBcb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01784">CcUnmapVacbArray()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01062">CcWaitOnActiveCount()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="cc.h::CcAcquireVacbLockAtDpcLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcAcquireVacbLockAtDpcLevel          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExAcquireSpinLockAtDpcLevel( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a9">CcVacbSpinLock</a> )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00082">82</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02626">CcDeleteMbcb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a63" doxytag="cc.h::CcAddToLog" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcAddToLog          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LOG,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ACTION,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>REASON&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00558">558</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a88" doxytag="cc.h::CcAllocateWorkQueueEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcAllocateWorkQueueEntry          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(<a class="el" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">PWORK_QUEUE_ENTRY</a>)ExAllocateFromPPNPagedLookasideList(LookasideTwilightList)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01847">1847</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00099">CcScanDpc()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00158">CcWaitForCurrentLazyWriterActivity()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="cc.h::CcBugCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcBugCheck          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">A,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>B,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>C&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;{ KeBugCheckEx(CACHE_MANAGER, BugCheckFileId | __LINE__, A, B, C ); }</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00185">185</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a69" doxytag="cc.h::CcDecrementOpenCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcDecrementOpenCount          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">SCM,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>REASON&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{           \
    (SCM)-&gt;OpenCount -= 1;                              \
    <span class="keywordflow">if</span> (REASON != 0) {                                  \
        <a class="code" href="../../d5/d5/cc_8h.html#a63">CcAddToLog</a>( &amp;(SCM)-&gt;OpenCountLog, REASON, -1 ); \
    }                                                   \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01010">1010</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00142">CcGetDirtyPages()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04232">CcGetFlushedValidData()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00838">CcMdlWriteComplete2()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02804">CcZeroEndOfLastPage()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a89" doxytag="cc.h::CcFreeWorkQueueEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcFreeWorkQueueEntry          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">_entry_&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExFreeToPPNPagedLookasideList(LookasideTwilightList, (_entry_))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01850">1850</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a68" doxytag="cc.h::CcIncrementOpenCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcIncrementOpenCount          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">SCM,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>REASON&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{           \
    (SCM)-&gt;OpenCount += 1;                              \
    <span class="keywordflow">if</span> (REASON != 0) {                                  \
        <a class="code" href="../../d5/d5/cc_8h.html#a63">CcAddToLog</a>( &amp;(SCM)-&gt;OpenCountLog, REASON, 1 );  \
    }                                                   \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01003">1003</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00142">CcGetDirtyPages()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04232">CcGetFlushedValidData()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02804">CcZeroEndOfLastPage()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a50" doxytag="cc.h::CcLockVacbLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcLockVacbLevel          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">SCM,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OFF&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                                                               \
    <span class="keywordflow">if</span> (((SCM)-&gt;SectionSize.QuadPart &gt; <a class="code" href="../../d5/d5/cc_8h.html#a41">VACB_SIZE_OF_FIRST_LEVEL</a>) &amp;&amp;                              \
        <a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;Flags, MODIFIED_WRITE_DISABLED)) {                                \
    <a class="code" href="../../d5/d5/cc_8h.html#a202">CcAdjustVacbLevelLockCount</a>((SCM),(OFF), +1);}                                                \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00403">403</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="cc.h::CcReleaseMasterLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcReleaseMasterLock          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OldIrql&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExReleaseSpinLock( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a8">CcMasterSpinLock</a>, OldIrql )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00067">67</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01982">CcDeferWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">CcFreeActiveVacb()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00142">CcGetDirtyPages()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l03658">CcGetFileObjectFromSectionPtrs()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04232">CcGetFlushedValidData()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00362">CcIsThereDirtyData()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00838">CcMdlWriteComplete2()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00032">CcSetAdditionalCacheAttributes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00158">CcWaitForCurrentLazyWriterActivity()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02804">CcZeroEndOfLastPage()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="cc.h::CcReleaseMasterLockFromDpcLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcReleaseMasterLockFromDpcLevel          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExReleaseSpinLockFromDpcLevel( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a8">CcMasterSpinLock</a> )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00073">73</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02626">CcDeleteMbcb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02560">CcSetDirtyPinnedData()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="cc.h::CcReleaseVacbLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcReleaseVacbLock          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OldIrql&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExReleaseSpinLock( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a9">CcVacbSpinLock</a>, OldIrql )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00079">79</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01007">CcDereferenceFileOffset()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02044">CcDrainVacbLevelZone()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00862">CcFreeVirtualAddress()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00310">CcGetVirtualAddress()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00230">CcGetVirtualAddressIfMapped()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01931">CcPrefillVacbLevelZone()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00947">CcReferenceFileOffset()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05024">CcRemapBcb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01784">CcUnmapVacbArray()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01062">CcWaitOnActiveCount()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="cc.h::CcReleaseVacbLockFromDpcLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcReleaseVacbLockFromDpcLevel          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExReleaseSpinLockFromDpcLevel( &amp;<a class="el" href="../../d6/d9/kernlini_8c.html#a9">CcVacbSpinLock</a> )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00085">85</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02626">CcDeleteMbcb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a51" doxytag="cc.h::CcUnlockVacbLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CcUnlockVacbLevel          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">SCM,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OFF&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                                                             \
    <span class="keywordflow">if</span> (((SCM)-&gt;SectionSize.QuadPart &gt; <a class="code" href="../../d5/d5/cc_8h.html#a41">VACB_SIZE_OF_FIRST_LEVEL</a>) &amp;&amp;                              \
        <a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;Flags, MODIFIED_WRITE_DISABLED)) {                                \
    <a class="code" href="../../d5/d5/cc_8h.html#a202">CcAdjustVacbLevelLockCount</a>((SCM),(OFF), -1);}                                                \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00409">409</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a61" doxytag="cc.h::ClearFlag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ClearFlag          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">F,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>SF&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{ \
    (F) &amp;= ~(SF);         \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00509">509</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">CcFreeActiveVacb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00362">CcIsThereDirtyData()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00032">CcSetAdditionalCacheAttributes()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02467">FsRtlNotifyCompleteIrpList()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00547">FsRtlNotifyFullChangeDirectory()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00973">FsRtlNotifyFullReportChange()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01937">FsRtlOpBatchBreakClosePending()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02690">FsRtlOplockBreakToNone()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l00706">LfsCloseLogFile()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l02191">LfsFindFirstIo()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l03193">LfsFindLastLsn()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l00551">LfsFlushLfcb()</a>, <a class="el" href="../../d8/d0/lbcbsup_8c-source.html#l00134">LfsFlushToLsnPriv()</a>, <a class="el" href="../../d7/d4/logpgsup_8c-source.html#l00297">LfsFreeSpanningBuffer()</a>, <a class="el" href="../../d8/d0/lbcbsup_8c-source.html#l00311">LfsGetLbcb()</a>, <a class="el" href="../../d8/d7/sysinit_8c-source.html#l00040">LfsInitializeLogFileService()</a>, <a class="el" href="../../d8/d4/logrcsup_8c-source.html#l00431">LfsPrepareLfcbForLogRecord()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l01534">LfsRestartLogFile()</a>, <a class="el" href="../../d6/d8/restart_8c-source.html#l00582">LfsSetBaseLsnPriv()</a>, <a class="el" href="../../d8/d9/rstrtsup_8c-source.html#l00036">LfsWriteLfsRestart()</a>, <a class="el" href="../../d8/d4/logrcsup_8c-source.html#l00055">LfsWriteLogRecordIntoLogPage()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l01437">UdfCleanupIrpContext()</a>, <a class="el" href="../../d9/d6/udfs_2cleanup_8c-source.html#l00042">UdfCommonCleanup()</a>, <a class="el" href="../../d8/d4/udfs_2read_8c-source.html#l00068">UdfCommonRead()</a>, <a class="el" href="../../d7/d2/filobsup_8c-source.html#l00133">UdfDecodeFileObject()</a>, <a class="el" href="../../d9/d4/udfs_2verfysup_8c-source.html#l00365">UdfDismountVcb()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l03307">UdfFindAnchorVolumeDescriptor()</a>, <a class="el" href="../../d3/d8/close_8c-source.html#l00099">UdfFspClose()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01271">UdfInvalidateVolumes()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00287">UdfLookupNextDirEntry()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01444">UdfMountVolume()</a>, <a class="el" href="../../d4/d6/deviosup_8c-source.html#l00201">UdfNonCachedRead()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l00470">UdfOplockRequest()</a>, <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00539">UdfProcessException()</a>, <a class="el" href="../../d2/d7/dirctrl_8c-source.html#l00334">UdfQueryDirectory()</a>, <a class="el" href="../../d8/d5/volinfo_8c-source.html#l00421">UdfQueryFsAttributeInfo()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l01606">UdfTeardownStructures()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00207">UdfUninitializeFcbMcb()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l00732">UdfUnlockVolumeInternal()</a>, and <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l02043">UdfVerifyVolume()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a93" doxytag="cc.h::DebugDump" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DebugDump          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">STR,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LEVEL,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PTR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;{NOTHING;}</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02294">2294</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a91" doxytag="cc.h::DebugTrace" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DebugTrace          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">INDENT,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LEVEL,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>X,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Y&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;{NOTHING;}</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">2290</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l00031">CcCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00619">CcExceptionFilter()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l00588">CcFastCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01482">CcFastCopyWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05314">CcFindBcb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00052">CcMapData()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00030">CcMdlRead()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00406">CcMdlReadComplete2()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00838">CcMdlWriteComplete2()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00271">CcPinMappedData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00524">CcPinRead()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00662">CcPostWorkQueue()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00767">CcPreparePinWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03758">CcReleaseByteRangeFromWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02560">CcSetDirtyPinnedData()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02717">CcSetValidData()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02563">CcUnmapAndPurge()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01156">CcUnmapVacb()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l01000">CcUnpinData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l01142">CcUnpinDataForThread()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05143">CcUnpinRepinnedBcb()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01678">FsRtlAcknowledgeOplockBreak()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01221">FsRtlAllocateOplock()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l03519">FsRtlCancelExclusiveIrp()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02555">FsRtlCancelNotify()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l03396">FsRtlCancelOplockIIIrp()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l03288">FsRtlCancelWaitIrp()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l01315">FsRtlCheckLockForReadAccess()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l01416">FsRtlCheckLockForWriteAccess()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l02469">FsRtlCheckNoExclusiveConflict()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l00823">FsRtlCheckOplock()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l03241">FsRtlCompletionRoutinePriv()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01169">FsRtlCurrentBatchOplock()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l02582">FsRtlFastCheckLockForRead()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l02718">FsRtlFastCheckLockForWrite()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l03589">FsRtlFastUnlockSingleExclusive()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l03337">FsRtlFastUnlockSingleShared()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l01951">FsRtlGetNextFileLock()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01970">FsRtlGetNextLargeMcbEntry()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l00829">FsRtlInitializeFileLock()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00572">FsRtlInitializeLargeMcb()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l00373">FsRtlInitializeOplock()</a>, <a class="el" href="../../d2/d2/dbcsname_8c-source.html#l00771">FsRtlIsDbcsInExpression()</a>, <a class="el" href="../../d5/d4/name_8c-source.html#l00482">FsRtlIsNameInExpressionPrivate()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l01920">FsRtlIsNotifyOnList()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01600">FsRtlLookupLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01763">FsRtlLookupLastLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01841">FsRtlLookupLastLargeMcbEntryAndIndex()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00469">FsRtlNotifyChangeDirectory()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l01795">FsRtlNotifyCleanup()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02000">FsRtlNotifyCompleteIrp()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02467">FsRtlNotifyCompleteIrpList()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l03698">FsRtlNotifyCompletion()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00547">FsRtlNotifyFullChangeDirectory()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00973">FsRtlNotifyFullReportChange()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00371">FsRtlNotifyInitializeSync()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00897">FsRtlNotifyReportChange()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02195">FsRtlNotifySetCancelRoutine()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00426">FsRtlNotifyUninitializeSync()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02286">FsRtlNotifyUpdateBuffer()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01924">FsRtlNumberOfRunsInLargeMcb()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01937">FsRtlOpBatchBreakClosePending()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02111">FsRtlOplockBreakNotify()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02454">FsRtlOplockBreakToII()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02690">FsRtlOplockBreakToNone()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02249">FsRtlOplockCleanup()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l00581">FsRtlOplockFsctrl()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01116">FsRtlOplockIsFastIoPossible()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l05721">FsRtlPrivateCancelFileLockIrp()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l04722">FsRtlPrivateCheckWaitingLocks()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l05254">FsRtlPrivateFastUnlockAll()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l04343">FsRtlPrivateInsertSharedLock()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l03867">FsRtlPrivateLock()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l01173">FsRtlProcessFileLock()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02952">FsRtlRemoveAndCompleteIrp()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l03623">FsRtlRemoveAndCompleteWaitIrp()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01528">FsRtlRemoveLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00392">FsRtlRemoveMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01299">FsRtlRequestExclusiveOplock()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01514">FsRtlRequestOplockII()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02066">FsRtlSplitLargeMcb()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00743">FsRtlTruncateLargeMcb()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l00995">FsRtlUninitializeFileLock()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00670">FsRtlUninitializeLargeMcb()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l00413">FsRtlUninitializeOplock()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l03025">FsRtlWaitOnIrp()</a>, <a class="el" href="../../d5/d7/udfs__rec_8c-source.html#l00157">IsUdfsVolume()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l04463">LfsAddClientToList()</a>, <a class="el" href="../../d9/d6/lfs_2strucsup_8c-source.html#l00041">LfsAllocateLfcb()</a>, <a class="el" href="../../d7/d4/logpgsup_8c-source.html#l00113">LfsAllocateSpanningBuffer()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l04188">LfsCheckSubsequentLogPage()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l00706">LfsCloseLogFile()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l00339">LfsCopyReadLogRecord()</a>, <a class="el" href="../../d8/d4/lfs_2verfysup_8c-source.html#l00036">LfsCurrentAvailSpace()</a>, <a class="el" href="../../d9/d6/lfs_2strucsup_8c-source.html#l00188">LfsDeallocateLfcb()</a>, <a class="el" href="../../d4/d2/querylog_8c-source.html#l01004">LfsFindClientNextLsn()</a>, <a class="el" href="../../d8/d4/lfs_2verfysup_8c-source.html#l00412">LfsFindCurrentAvail()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l02191">LfsFindFirstIo()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l03193">LfsFindLastLsn()</a>, <a class="el" href="../../d4/d2/querylog_8c-source.html#l00809">LfsFindLogRecord()</a>, <a class="el" href="../../d0/d7/lsnsup_8c-source.html#l00148">LfsFindNextLsn()</a>, <a class="el" href="../../d8/d9/rstrtsup_8c-source.html#l00189">LfsFindOldestClientLsn()</a>, <a class="el" href="../../d8/d0/lbcbsup_8c-source.html#l00037">LfsFlushLbcb()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l00551">LfsFlushLfcb()</a>, <a class="el" href="../../d2/d9/lfs_2write_8c-source.html#l00360">LfsFlushToLsn()</a>, <a class="el" href="../../d8/d0/lbcbsup_8c-source.html#l00134">LfsFlushToLsnPriv()</a>, <a class="el" href="../../d2/d9/lfs_2write_8c-source.html#l00197">LfsForceWrite()</a>, <a class="el" href="../../d7/d4/logpgsup_8c-source.html#l00297">LfsFreeSpanningBuffer()</a>, <a class="el" href="../../d8/d0/lbcbsup_8c-source.html#l00311">LfsGetLbcb()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l00150">LfsInitializeLogFile()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l03065">LfsInitializeLogFilePriv()</a>, <a class="el" href="../../d8/d7/sysinit_8c-source.html#l00040">LfsInitializeLogFileService()</a>, <a class="el" href="../../d0/d7/lsnsup_8c-source.html#l00036">LfsLsnFinalOffset()</a>, <a class="el" href="../../d7/d4/logpgsup_8c-source.html#l00040">LfsNextLogPageOffset()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02246">LfsNormalizeBasicLogFile()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l00366">LfsOpenLogFile()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l00084">LfsPinOrMapData()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l00248">LfsPinOrMapLogRecordHeader()</a>, <a class="el" href="../../d8/d4/logrcsup_8c-source.html#l00431">LfsPrepareLfcbForLogRecord()</a>, <a class="el" href="../../d4/d2/querylog_8c-source.html#l00701">LfsQueryLastLsn()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l01141">LfsReadLogFileInformation()</a>, <a class="el" href="../../d4/d2/querylog_8c-source.html#l00072">LfsReadLogRecord()</a>, <a class="el" href="../../d4/d2/querylog_8c-source.html#l00299">LfsReadNextLogRecord()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l01402">LfsReadRestart()</a>, <a class="el" href="../../d6/d8/restart_8c-source.html#l00046">LfsReadRestartArea()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l04383">LfsRemoveClientFromList()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l01361">LfsResetUndoTotal()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l01534">LfsRestartLogFile()</a>, <a class="el" href="../../d4/d2/querylog_8c-source.html#l01116">LfsSearchForwardByClient()</a>, <a class="el" href="../../d6/d8/restart_8c-source.html#l00447">LfsSetBaseLsn()</a>, <a class="el" href="../../d6/d8/restart_8c-source.html#l00582">LfsSetBaseLsnPriv()</a>, <a class="el" href="../../d4/d2/querylog_8c-source.html#l00594">LfsTerminateLogQuery()</a>, <a class="el" href="../../d8/d4/logrcsup_8c-source.html#l00556">LfsTransferLogBytes()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02514">LfsUpdateLfcbFromNoRestart()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02390">LfsUpdateLfcbFromPgHeader()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02697">LfsUpdateLfcbFromRestart()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02964">LfsUpdateRestartAreaFromLfcb()</a>, <a class="el" href="../../d8/d4/lfs_2verfysup_8c-source.html#l00114">LfsVerifyLogSpaceAvail()</a>, <a class="el" href="../../d2/d9/lfs_2write_8c-source.html#l00039">LfsWrite()</a>, <a class="el" href="../../d8/d9/rstrtsup_8c-source.html#l00036">LfsWriteLfsRestart()</a>, <a class="el" href="../../d8/d4/logrcsup_8c-source.html#l00055">LfsWriteLogRecordIntoLogPage()</a>, <a class="el" href="../../d6/d8/restart_8c-source.html#l00270">LfsWriteRestartArea()</a>, <a class="el" href="../../d3/d5/allocsup_8c-source.html#l00724">UdfAddToPcb()</a>, <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00637">UdfAddVmcbMapping()</a>, <a class="el" href="../../d6/d4/namesup_8c-source.html#l00819">UdfCheckLegalCS0Dstring()</a>, <a class="el" href="../../d9/d6/udfs_2cleanup_8c-source.html#l00042">UdfCommonCleanup()</a>, <a class="el" href="../../d3/d8/close_8c-source.html#l00498">UdfCommonClosePrivate()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l01955">UdfCompleteFcbOpen()</a>, <a class="el" href="../../d3/d5/allocsup_8c-source.html#l00804">UdfCompletePcb()</a>, <a class="el" href="../../d9/d1/udfs_2cachesup_8c-source.html#l00046">UdfCreateInternalStream()</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l01239">UdfCS0DstringContainsLegalCharacters()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l03817">UdfDetermineVolumeBounding()</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l01988">UdfEqualEntityId()</a>, <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00448">UdfExceptionFilter()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l03307">UdfFindAnchorVolumeDescriptor()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00726">UdfFindDirEntry()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l02558">UdfFindFileSetDescriptor()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l02832">UdfFindVolumeDescriptors()</a>, <a class="el" href="../../d3/d8/close_8c-source.html#l00099">UdfFspClose()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l03388">UdfInitializeAllocations()</a>, <a class="el" href="../../d3/d5/allocsup_8c-source.html#l00367">UdfInitializePcb()</a>, <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00219">UdfInitializeVmcb()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l02439">UdfIsRemount()</a>, <a class="el" href="../../d3/d5/allocsup_8c-source.html#l01406">UdfLoadSparingTables()</a>, <a class="el" href="../../d3/d5/allocsup_8c-source.html#l00069">UdfLookupAllocation()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00916">UdfLookupDirEntryPostProcessing()</a>, <a class="el" href="../../d3/d5/allocsup_8c-source.html#l01017">UdfLookupPsnOfExtent()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01444">UdfMountVolume()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l01632">UdfOpenObjectFromDirContext()</a>, <a class="el" href="../../d3/d8/close_8c-source.html#l00634">UdfQueueClose()</a>, <a class="el" href="../../d4/d6/deviosup_8c-source.html#l00685">UdfReadSectors()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l03457">UdfRecognizeVolume()</a>, <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00867">UdfRemoveVmcbMapping()</a>, <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00370">UdfResetVmcb()</a>, <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00413">UdfSetMaximumLbnVmcb()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l01606">UdfTeardownStructures()</a>, <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00325">UdfUninitializeVmcb()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00360">UdfUpdateDirNames()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00477">UdfUpdateVcbPhase0()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00997">UdfUpdateVcbPhase1()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l04056">UdfUpdateVolumeLabel()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l02617">UdfVerifyDescriptor()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l02043">UdfVerifyVolume()</a>, <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00553">UdfVmcbLbnToVbn()</a>, and <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00461">UdfVmcbVbnToLbn()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a92" doxytag="cc.h::DebugTrace2" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DebugTrace2          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">INDENT,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LEVEL,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>X,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Y,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Z&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;{NOTHING;}</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02292">2292</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05314">CcFindBcb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00030">CcMdlRead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03758">CcReleaseByteRangeFromWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02717">CcSetValidData()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02563">CcUnmapAndPurge()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05143">CcUnpinRepinnedBcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="cc.h::DEFAULT_CREATE_MODULO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DEFAULT_CREATE_MODULO&nbsp;&nbsp;&nbsp;((ULONG)(0x00100000))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00192">192</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="cc.h::DEFAULT_EXTEND_MODULO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DEFAULT_EXTEND_MODULO&nbsp;&nbsp;&nbsp;((ULONG)(0x00100000))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00193">193</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a70" doxytag="cc.h::DISABLE_READ_AHEAD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DISABLE_READ_AHEAD&nbsp;&nbsp;&nbsp;0x0001          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01025">1025</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>, and <a class="el" href="../../d9/d4/logsup_8c-source.html#l00032">CcSetAdditionalCacheAttributes()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a71" doxytag="cc.h::DISABLE_WRITE_BEHIND" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DISABLE_WRITE_BEHIND&nbsp;&nbsp;&nbsp;0x0002          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01031">1031</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03758">CcReleaseByteRangeFromWrite()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00032">CcSetAdditionalCacheAttributes()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02560">CcSetDirtyPinnedData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="cc.h::ExAllocatePool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ExAllocatePool          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>b&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExAllocatePoolWithTag(a,b,'  cC')</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">126</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l02394">CmDeleteKeyRecursive()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02169">CmGetSystemDriverList()</a>, <a class="el" href="../../d7/d0/cmhvlist_8c-source.html#l00042">CmpAddToHiveFileList()</a>, <a class="el" href="../../d6/d0/cmgquota_8c-source.html#l00204">CmpClaimGlobalQuota()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03262">CmpCloneControlSet()</a>, <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l01869">CmpCloneHwProfile()</a>, <a class="el" href="../../d3/d2/cmtrecpy_8c-source.html#l00127">CmpCopySyncTree()</a>, <a class="el" href="../../d3/d2/cmtrecpy_8c-source.html#l00251">CmpCopySyncTree2()</a>, <a class="el" href="../../d6/d2/cmworker_8c-source.html#l00556">CmpDiskFullWarning()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01235">CmpFlushNotify()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l03764">CmpFreePostBlock()</a>, <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l00076">CmpGetAcpiProfileInformation()</a>, <a class="el" href="../../d7/d0/cmhvlist_8c-source.html#l00251">CmpGetHiveName()</a>, <a class="el" href="../../d3/d1/cmparse_8c-source.html#l01476">CmpGetSymbolicLink()</a>, <a class="el" href="../../d8/d1/cmse_8c-source.html#l01227">CmpHiveRootSecurityDescriptor()</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00087">CmpInitializeHardwareConfiguration()</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00465">CmpInitializeMachineDependentConfiguration()</a>, <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00458">CmpInitializeRegistryNode()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l02022">CmpInitializeSystemHive()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l00484">CmpLoadHiveVolatile()</a>, <a class="el" href="../../d3/d2/cmtrecpy_8c-source.html#l01150">CmpMergeKeyValues()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01378">CmpNotifyChangeKey()</a>, <a class="el" href="../../d9/d0/cminit_8c-source.html#l00046">CmpOpenHiveFiles()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00487">CmpPostNotify()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l03458">CmpSaveBootControlSet()</a>, <a class="el" href="../../d6/d2/cmworker_8c-source.html#l00115">CmpWorker()</a>, <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l00805">CmSetAcpiHwProfile()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01955">ComPortDBAdd()</a>, <a class="el" href="../../d5/d9/tex_8c-source.html#l01781">DoBitMapTest()</a>, <a class="el" href="../../d5/d9/tex_8c-source.html#l01468">DoPoolTest()</a>, <a class="el" href="../../d5/d9/tex_8c-source.html#l01510">DoZoneTest()</a>, <a class="el" href="../../d7/d7/fsvga_8c-source.html#l00053">DriverEntry()</a>, <a class="el" href="../../d6/d9/pnpeisa_8c-source.html#l00304">EisaBuildSlotsResources()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00694">ExAllocatePoolWithQuota()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00454">FindPathForDevice()</a>, <a class="el" href="../../d3/d1/drawscrn_8c-source.html#l00489">FsgWriteToFrameBuffer()</a>, <a class="el" href="../../d7/d7/fsvga_8c-source.html#l01056">FsVgaBuildResourceList()</a>, <a class="el" href="../../d7/d7/fsvga_8c-source.html#l00858">FsVgaServiceParameters()</a>, <a class="el" href="../../d7/d7/fsvga_8c-source.html#l01429">FsVgaWriteToFrameBuffer()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00326">GetNextReparseVolumePath()</a>, <a class="el" href="../../d1/d1/hivesync_8c-source.html#l00775">HvpDoWriteHive()</a>, <a class="el" href="../../d7/d0/hiveload_8c-source.html#l00311">HvpReadFileImageAndBuildMap()</a>, <a class="el" href="../../d1/d1/hivesync_8c-source.html#l01025">HvpWriteLog()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00891">IoAllocateWorkItem()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01071">IoCreateDriver()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l00373">IoGetDeviceProperty()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l00810">IoOpenDeviceRegistryKey()</a>, <a class="el" href="../../d7/d0/pnprlist_8c-source.html#l00055">IopAddRelationToList()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l02427">IopAllocateBuffer()</a>, <a class="el" href="../../d7/d0/pnprlist_8c-source.html#l00239">IopAllocateRelationList()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l05619">IopAllocateUnicodeString()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09357">IopAppendLegacyVeto()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l00546">IopAppendStringToValueKey()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l02209">IopApplyFunctionToServiceInstances()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l01844">IopApplyFunctionToSubKeys()</a>, <a class="el" href="../../d6/d8/arcsec_8c-source.html#l00168">IopApplySystemPartitionProt()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l03165">IopCallDriverAddDeviceQueryRoutine()</a>, <a class="el" href="../../d2/d7/report_8c-source.html#l00629">IopChangeInterfaceType()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l04392">IopCmResourcesToIoResources()</a>, <a class="el" href="../../d7/d0/pnprlist_8c-source.html#l00286">IopCompressRelationList()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l00695">IopConcatenateUnicodeStrings()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l01047">IopCreateArcNames()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02107">IopCreateEntry()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l00091">IopCreateMadeupNode()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00232">IopDeleteLockedDeviceNode()</a>, <a class="el" href="../../d8/d6/errorlog_8c-source.html#l00760">IopErrorLogQueueRequest()</a>, <a class="el" href="../../d8/d6/errorlog_8c-source.html#l00088">IopErrorLogThread()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l01028">IopExecuteHardwareProfileChange()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l04592">IopFilterResourceRequirementsList()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l04425">IopGetBusTypeGuidIndex()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l04081">IopGetDeviceResourcesFromRegistry()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l01411">IopGetDriverDeviceList()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02072">IopGetDriverNameFromKeyNode()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09565">IopGetLegacyVetoListDrivers()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02462">IopGetRegistryKeyInformation()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02546">IopGetRegistryValue()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00680">IopGetRootDevices()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02327">IopInitializeBootDrivers()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l08928">IopInitializeBootLogging()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02812">IopInitializeBuiltinDriver()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00879">IopInitializeDeviceInstanceKey()</a>, <a class="el" href="../../d8/d9/pnpinit_8c-source.html#l00093">IopInitializePlugPlayServices()</a>, <a class="el" href="../../d2/d7/report_8c-source.html#l00066">IopInitializeResourceMap()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l03200">IopLoadDriver()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l01891">IopMakeGloballyUniqueId()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l05198">IopMergeCmResourceLists()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l05109">IopMergeFilteredResourceRequirementsList()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09221">IoPnPDeliverServicePowerNotification()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l08501">IopOpenDeviceParametersSubkey()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l00648">IopPnPDispatch()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l01185">IopProcessAssignResources()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l04000">IopProcessCriticalDeviceRoutine()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01538">IopProcessNewDeviceNode()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l05034">IopProcessNewProfile()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09922">IopProcessSetInterfaceState()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l01604">IopQueryDeviceRelations()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l02262">IopQueryDeviceResources()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l03395">IopQueryDockRemovalInterface()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l02617">IopQueryResourceHandlerInterface()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06327">IopQueueDeviceWorkItem()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l01540">IopQueuePendingSurpriseRemoval()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l05617">IopRaiseHardError()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l04283">IopReadDeviceConfiguration()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l03491">IopRealloc()</a>, <a class="el" href="../../d0/d1/pnpsubs_8c-source.html#l02080">IopRegMultiSzToUnicodeStrings()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l00207">IopRequestDeviceAction()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l02467">IopResizeBuffer()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l08822">IopSafebootDriverLoad()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06127">IopSendMessageToTrackService()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06326">IopSetEaOrQuotaInformationFile()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00510">IopStartDevice()</a>, <a class="el" href="../../d6/d0/pnpres_8c-source.html#l04129">IopTranslateAndAdjustReqDesc()</a>, <a class="el" href="../../d3/d9/pnpdd_8c-source.html#l00540">IopTranslatorHandlerIo()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l01755">IopUnloadAttachedDriver()</a>, <a class="el" href="../../d0/d0/dockhwp_8c-source.html#l00862">IopUpdateHardwareProfile()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l07495">IoRegisterPlugPlayNotification()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l01548">IoReportDetectedDevice()</a>, <a class="el" href="../../d2/d7/report_8c-source.html#l00193">IoReportHalResourceUsage()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06118">IoReportTargetDeviceChangeAsynchronous()</a>, <a class="el" href="../../d3/d5/ia64_2iopm_8c-source.html#l00048">KeIA32SetIoAccessMap()</a>, <a class="el" href="../../d6/d0/i386_2thredini_8c-source.html#l00454">KeSetAutoAlignmentThread()</a>, <a class="el" href="../../d5/d5/alpha_2allproc_8c-source.html#l00078">KeStartAllProcessors()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01803">MapperAdjustResourceList()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00658">MapperCallback()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01600">MapperConstructRootEnumTree()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01091">MapperMarkKey()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l00535">MapperPeripheralCallback()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l02060">MapperPhantomizeDetectedComPorts()</a>, <a class="el" href="../../d3/d4/mapper_8c-source.html#l01298">MapperSeedKey()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00386">NtFlushBuffersFile()</a>, <a class="el" href="../../d8/d1/qsea_8c-source.html#l00035">NtQueryEaFile()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00101">NtQueryInformationFile()</a>, <a class="el" href="../../d1/d2/qsquota_8c-source.html#l00035">NtQueryQuotaInformationFile()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00037">NtQueryVolumeInformationFile()</a>, <a class="el" href="../../d8/d1/qsea_8c-source.html#l00652">NtSetEaFile()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00849">NtSetInformationFile()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l01235">NtSetLdtEntries()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00492">NtSetVolumeInformationFile()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00458">NtUnlockFile()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l01545">ObpGetDosDevicesProtection()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00225">OpenDeviceReparseIndex()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02089">PnPBiosCopyDeviceParamKey()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l02663">PnPBiosCopyIoDecode()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01725">PnPBiosEliminateDupes()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01026">PnPBiosExtractCompatibleIDs()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00399">PnPBiosGetBiosInfo()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l00890">PnPBiosIoResourceListToCmResourceList()</a>, <a class="el" href="../../d3/d0/pnpmap_8c-source.html#l01126">PnPBiosTranslateInfo()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l09077">PpCreateLegacyDeviceIds()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00902">PspCreateLdt()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00503">PspSetLdtInformation()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01211">PspSetQuotaLimits()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00160">PspTerminateThreadByPointer()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01800">PspUserThreadStartup()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00149">QueryDeviceNameForPath()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00094">QuerySymbolicLink()</a>, <a class="el" href="../../d1/d6/dev2dos_8c-source.html#l00580">RtlVolumeDeviceToDosName()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02765">SeOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03085">SeOpenObjectForDeleteAuditAlarm()</a>, <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00117">SepAdtInitializeBounds()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00049">SepCreateImpersonationTokenDacl()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02213">SepCreateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l00362">SepDuplicateToken()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01939">SepFilterToken()</a>, <a class="el" href="../../d0/d5/seinit_8c-source.html#l00184">SepInitializationPhase1()</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00773">SepProbeAndCaptureQosData()</a>, <a class="el" href="../../d0/d3/tokenqry_8c-source.html#l01189">SeQueryInformationToken()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00503">TestAccessCheck()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00360">TestAssignSecurity()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00296">TestCaptureSecurityDescriptor()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00205">TestDefaultObjectMethod()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00131">TestTokenCopy()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00177">TestTokenSize()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l00927">VerifierAllocatePool()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="cc.h::ExAllocatePoolWithQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ExAllocatePoolWithQuota          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>b&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExAllocatePoolWithQuotaTag(a,b,'  cC')</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00127">127</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d7/dir_8c-source.html#l00057">BuildQueryDirectoryIrp()</a>, <a class="el" href="../../d7/d1/cmsavres_8c-source.html#l01261">CmpSaveKeyByFileCopy()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06326">IopSetEaOrQuotaInformationFile()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l07272">IopTrackLink()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l08084">IopXxxControlFile()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00035">NtLoadDriver()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00035">NtLockFile()</a>, <a class="el" href="../../d1/d7/dir_8c-source.html#l00821">NtNotifyChangeDirectoryFile()</a>, <a class="el" href="../../d8/d1/qsea_8c-source.html#l00035">NtQueryEaFile()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00101">NtQueryInformationFile()</a>, <a class="el" href="../../d1/d2/qsquota_8c-source.html#l00035">NtQueryQuotaInformationFile()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00037">NtQueryVolumeInformationFile()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00036">NtReadFile()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00730">NtReadFileScatter()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01472">NtRegisterThreadTerminatePort()</a>, <a class="el" href="../../d8/d1/qsea_8c-source.html#l00652">NtSetEaFile()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00849">NtSetInformationFile()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00492">NtSetVolumeInformationFile()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00244">NtUnloadDriver()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00458">NtUnlockFile()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00035">NtWriteFile()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00801">NtWriteFileGather()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00730">Psp386CreateVdmIoListHead()</a>, <a class="el" href="../../d4/d1/i386_2psvdm_8c-source.html#l00477">Psp386InstallIoHandler()</a>, and <a class="el" href="../../d0/d5/verifier_8c-source.html#l01003">VerifierAllocatePoolWithQuota()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a58" doxytag="cc.h::FlagOn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FlagOn          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">F,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>SF&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>( \
    (((F) &amp; (SF)))     \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">497</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02439">CcCalculateVacbLevelLockCount()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l00031">CcCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01208">CcCreateVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l00588">CcFastCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01482">CcFastCopyWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">CcFreeActiveVacb()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00142">CcGetDirtyPages()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04232">CcGetFlushedValidData()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00362">CcIsThereDirtyData()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05749">CcMapAndRead()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00030">CcMdlRead()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00838">CcMdlWriteComplete2()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00271">CcPinMappedData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00524">CcPinRead()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00947">CcReferenceFileOffset()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03758">CcReleaseByteRangeFromWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02747">CcSetDirtyPageThreshold()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02560">CcSetDirtyPinnedData()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02563">CcUnmapAndPurge()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01156">CcUnmapVacb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05143">CcUnpinRepinnedBcb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02804">CcZeroEndOfLastPage()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01678">FsRtlAcknowledgeOplockBreak()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l02064">FsRtlAcquireFileForModWrite()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02555">FsRtlCancelNotify()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l00823">FsRtlCheckOplock()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00218">FsRtlCompareNodeAndKey()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l00330">FsRtlCopyWrite()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01169">FsRtlCurrentBatchOplock()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00255">FsRtlFreeTunnelNode()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l02020">FsRtlMdlWriteCompleteDev()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02000">FsRtlNotifyCompleteIrp()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00547">FsRtlNotifyFullChangeDirectory()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00973">FsRtlNotifyFullReportChange()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01937">FsRtlOpBatchBreakClosePending()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02111">FsRtlOplockBreakNotify()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02454">FsRtlOplockBreakToII()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02690">FsRtlOplockBreakToNone()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02249">FsRtlOplockCleanup()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l00581">FsRtlOplockFsctrl()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01116">FsRtlOplockIsFastIoPossible()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l01474">FsRtlPrepareMdlWriteDev()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01299">FsRtlRequestExclusiveOplock()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01514">FsRtlRequestOplockII()</a>, <a class="el" href="../../d7/d4/logpgsup_8c-source.html#l00113">LfsAllocateSpanningBuffer()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l00706">LfsCloseLogFile()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l00339">LfsCopyReadLogRecord()</a>, <a class="el" href="../../d8/d4/lfs_2verfysup_8c-source.html#l00036">LfsCurrentAvailSpace()</a>, <a class="el" href="../../d9/d6/lfs_2strucsup_8c-source.html#l00402">LfsDeallocateLbcb()</a>, <a class="el" href="../../d8/d4/lfs_2verfysup_8c-source.html#l00412">LfsFindCurrentAvail()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l02191">LfsFindFirstIo()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l03193">LfsFindLastLsn()</a>, <a class="el" href="../../d4/d2/querylog_8c-source.html#l00809">LfsFindLogRecord()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l00551">LfsFlushLfcb()</a>, <a class="el" href="../../d8/d0/lbcbsup_8c-source.html#l00134">LfsFlushToLsnPriv()</a>, <a class="el" href="../../d7/d4/logpgsup_8c-source.html#l00297">LfsFreeSpanningBuffer()</a>, <a class="el" href="../../d8/d0/lbcbsup_8c-source.html#l00311">LfsGetLbcb()</a>, <a class="el" href="../../d8/d7/sysinit_8c-source.html#l00040">LfsInitializeLogFileService()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l00366">LfsOpenLogFile()</a>, <a class="el" href="../../d8/d4/logrcsup_8c-source.html#l00431">LfsPrepareLfcbForLogRecord()</a>, <a class="el" href="../../d4/d2/querylog_8c-source.html#l00701">LfsQueryLastLsn()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l01361">LfsResetUndoTotal()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l01534">LfsRestartLogFile()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02514">LfsUpdateLfcbFromNoRestart()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02697">LfsUpdateLfcbFromRestart()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02964">LfsUpdateRestartAreaFromLfcb()</a>, <a class="el" href="../../d8/d4/lfs_2verfysup_8c-source.html#l00114">LfsVerifyLogSpaceAvail()</a>, <a class="el" href="../../d8/d9/rstrtsup_8c-source.html#l00036">LfsWriteLfsRestart()</a>, <a class="el" href="../../d8/d4/logrcsup_8c-source.html#l00055">LfsWriteLogRecordIntoLogPage()</a>, <a class="el" href="../../d5/d8/resrcsup_8c-source.html#l00047">UdfAcquireResource()</a>, <a class="el" href="../../d6/d4/namesup_8c-source.html#l00819">UdfCheckLegalCS0Dstring()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00099">UdfCleanupDirContext()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l01437">UdfCleanupIrpContext()</a>, <a class="el" href="../../d3/d8/close_8c-source.html#l00319">UdfCommonClose()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l00108">UdfCommonCreate()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00156">UdfCommonQueryInfo()</a>, <a class="el" href="../../d8/d4/udfs_2read_8c-source.html#l00068">UdfCommonRead()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00385">UdfCommonSetInfo()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l01955">UdfCompleteFcbOpen()</a>, <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00809">UdfCompleteRequest()</a>, <a class="el" href="../../d7/d2/filobsup_8c-source.html#l00133">UdfDecodeFileObject()</a>, <a class="el" href="../../d9/d4/udfs_2verfysup_8c-source.html#l00365">UdfDismountVcb()</a>, <a class="el" href="../../d2/d7/dirctrl_8c-source.html#l01500">UdfEnumerateIndex()</a>, <a class="el" href="../../d7/d2/filobsup_8c-source.html#l00201">UdfFastDecodeFileObject()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00496">UdfFastQueryBasicInfo()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00740">UdfFastQueryNetworkInfo()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00614">UdfFastQueryStdInfo()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00726">UdfFindDirEntry()</a>, <a class="el" href="../../d6/d3/prefxsup_8c-source.html#l00324">UdfFindPrefix()</a>, <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00218">UdfFsdDispatch()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l04013">UdfInitializeAllocationContext()</a>, <a class="el" href="../../d2/d7/dirctrl_8c-source.html#l01003">UdfInitializeEnumeration()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00181">UdfInitializeFcbMcb()</a>, <a class="el" href="../../d6/d3/prefxsup_8c-source.html#l00503">UdfInitializeLcbFromDirContext()</a>, <a class="el" href="../../d3/d5/allocsup_8c-source.html#l00367">UdfInitializePcb()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00331">UdfInitializeVcb()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01271">UdfInvalidateVolumes()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l00621">UdfLockVolumeInternal()</a>, <a class="el" href="../../d3/d5/allocsup_8c-source.html#l00069">UdfLookupAllocation()</a>, <a class="el" href="../../d2/d7/dirctrl_8c-source.html#l01688">UdfLookupFileEntryInEnumeration()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00287">UdfLookupNextDirEntry()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01444">UdfMountVolume()</a>, <a class="el" href="../../d4/d6/deviosup_8c-source.html#l01435">UdfMultipleAsync()</a>, <a class="el" href="../../d4/d6/deviosup_8c-source.html#l00201">UdfNonCachedRead()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l00809">UdfNormalizeFileNames()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l01522">UdfOpenExistingFcb()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l01244">UdfOpenObjectByFileId()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l01632">UdfOpenObjectFromDirContext()</a>, <a class="el" href="../../d9/d4/udfs_2verfysup_8c-source.html#l00042">UdfPerformVerify()</a>, <a class="el" href="../../d4/d6/deviosup_8c-source.html#l00883">UdfPrepareBuffers()</a>, <a class="el" href="../../d3/d8/workque_8c-source.html#l00111">UdfPrePostIrp()</a>, <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00539">UdfProcessException()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01232">UdfQueryAlternateNameInfo()</a>, <a class="el" href="../../d2/d7/dirctrl_8c-source.html#l00334">UdfQueryDirectory()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l01429">UdfQueryNetworkInfo()</a>, <a class="el" href="../../d5/d2/fileinfo_8c-source.html#l00936">UdfQueryStandardInfo()</a>, <a class="el" href="../../d4/d6/deviosup_8c-source.html#l00685">UdfReadSectors()</a>, <a class="el" href="../../d6/d3/prefxsup_8c-source.html#l00256">UdfRemovePrefix()</a>, <a class="el" href="../../d7/d2/filobsup_8c-source.html#l00049">UdfSetFileObject()</a>, <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00873">UdfSetThreadContext()</a>, <a class="el" href="../../d4/d6/deviosup_8c-source.html#l01642">UdfSingleAsync()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l01606">UdfTeardownStructures()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00207">UdfUninitializeFcbMcb()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l00732">UdfUnlockVolumeInternal()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00360">UdfUpdateDirNames()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l03595">UdfUpdateTimestampsFromIcbContext()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00477">UdfUpdateVcbPhase0()</a>, <a class="el" href="../../d9/d4/udfs_2verfysup_8c-source.html#l00760">UdfVerifyFcbOperation()</a>, <a class="el" href="../../d9/d4/udfs_2verfysup_8c-source.html#l00603">UdfVerifyVcb()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l02043">UdfVerifyVolume()</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l02094">VacbLevelReference()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="cc.h::FsRtlAllocatePool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FsRtlAllocatePool          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>b&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;FsRtlAllocatePoolWithTag(a,b,'  cC')</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00120">120</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/fsrtlpc_8c-source.html#l00215">FsRtlInitSystem()</a>, and <a class="el" href="../../d9/d6/lfs_2strucsup_8c-source.html#l00041">LfsAllocateLfcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="cc.h::FsRtlAllocatePoolWithQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FsRtlAllocatePoolWithQuota          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>b&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;FsRtlAllocatePoolWithQuotaTag(a,b,'  cC')</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00121">121</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a82" doxytag="cc.h::GetActiveVacb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define GetActiveVacb          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">SCM,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IRQ,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>V,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>P,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>D&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                                  \
    ExAcquireFastLock(&amp;(SCM)-&gt;ActiveVacbSpinLock, &amp;(IRQ));              \
    (V) = (SCM)-&gt;ActiveVacb;                                            \
    <span class="keywordflow">if</span> ((V) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {                                                  \
        (P) = (SCM)-&gt;ActivePage;                                        \
        (SCM)-&gt;ActiveVacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;                                       \
        (<a class="code" href="../../d2/d0/imemenu_8c.html#a0">D</a>) = (SCM)-&gt;Flags &amp; <a class="code" href="../../d5/d5/cc_8h.html#a76">ACTIVE_PAGE_IS_DIRTY</a>;                      \
    }                                                                   \
    ExReleaseFastLock(&amp;(SCM)-&gt;ActiveVacbSpinLock, (IRQ));               \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01577">1577</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l00031">CcCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l00588">CcFastCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01482">CcFastCopyWrite()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00030">CcMdlRead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, and <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a83" doxytag="cc.h::GetActiveVacbAtDpcLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define GetActiveVacbAtDpcLevel          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">SCM,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>V,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>P,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>D&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                            \
    ExAcquireSpinLockAtDpcLevel(&amp;(SCM)-&gt;ActiveVacbSpinLock);            \
    (V) = (SCM)-&gt;ActiveVacb;                                            \
    <span class="keywordflow">if</span> ((V) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {                                                  \
        (P) = (SCM)-&gt;ActivePage;                                        \
        (SCM)-&gt;ActiveVacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;                                       \
        (<a class="code" href="../../d2/d0/imemenu_8c.html#a0">D</a>) = (SCM)-&gt;Flags &amp; <a class="code" href="../../d5/d5/cc_8h.html#a76">ACTIVE_PAGE_IS_DIRTY</a>;                      \
    }                                                                   \
    ExReleaseSpinLockFromDpcLevel(&amp;(SCM)-&gt;ActiveVacbSpinLock);          \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01588">1588</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02804">CcZeroEndOfLastPage()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a49" doxytag="cc.h::GetBcbListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define GetBcbListHead          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">SCM,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OFF,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>FAILSUCC&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                                                         \
  (((SCM)-&gt;SectionSize.QuadPart &gt; <a class="code" href="../../d5/d5/cc_8h.html#a46">BEGIN_BCB_LIST_ARRAY</a>) &amp;&amp;                                         \
   <a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>((SCM)-&gt;Flags, MODIFIED_WRITE_DISABLED)) ?                                                \
   (((SCM)-&gt;SectionSize.QuadPart &gt; <a class="code" href="../../d5/d5/cc_8h.html#a41">VACB_SIZE_OF_FIRST_LEVEL</a>) ?                                     \
    <a class="code" href="../../d5/d5/cc_8h.html#a203">CcGetBcbListHeadLargeOffset</a>((SCM),(OFF),(FAILSUCC)) :                                          \
    (((OFF) &gt;= (SCM)-&gt;SectionSize.QuadPart) ? &amp;(SCM)-&gt;BcbList :                                    \
     ((PLIST_ENTRY)((SCM)-&gt;Vacbs) + (((SCM)-&gt;SectionSize.QuadPart + (OFF)) &gt;&gt; <a class="code" href="../../d5/d5/cc_8h.html#a48">BCB_LIST_SHIFT</a>)))) : \
   &amp;(SCM)-&gt;BcbList                                                                                 \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00389">389</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05314">CcFindBcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a80" doxytag="cc.h::IS_CURSOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IS_CURSOR&nbsp;&nbsp;&nbsp;0x0800          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01090">1090</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d4/logsup_8c-source.html#l00142">CcGetDirtyPages()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00362">CcIsThereDirtyData()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a79" doxytag="cc.h::LAZY_WRITE_OCCURRED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LAZY_WRITE_OCCURRED&nbsp;&nbsp;&nbsp;0x0400          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01083">1083</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a54" doxytag="cc.h::LAZY_WRITER_COLLISION_DELAY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LAZY_WRITER_COLLISION_DELAY&nbsp;&nbsp;&nbsp;((LONG)(1000000))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00430">430</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a53" doxytag="cc.h::LAZY_WRITER_IDLE_DELAY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LAZY_WRITER_IDLE_DELAY&nbsp;&nbsp;&nbsp;((LONG)(10000000))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00429">429</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a55" doxytag="cc.h::LAZY_WRITER_MAX_AGE_TARGET" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LAZY_WRITER_MAX_AGE_TARGET&nbsp;&nbsp;&nbsp;((ULONG)(8))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00436">436</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="cc.h::MAX_READ_AHEAD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_READ_AHEAD&nbsp;&nbsp;&nbsp;(8 * 1024 * 1024)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00217">217</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="cc.h::MAX_WRITE_BEHIND" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_WRITE_BEHIND&nbsp;&nbsp;&nbsp;(MM_MAXIMUM_DISK_IO_SIZE)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00223">223</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="cc.h::MAX_ZERO_TRANSFER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_ZERO_TRANSFER&nbsp;&nbsp;&nbsp;(PAGE_SIZE * 128)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00288">288</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="cc.h::MAX_ZEROS_IN_CACHE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_ZEROS_IN_CACHE&nbsp;&nbsp;&nbsp;(0x10000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00290">290</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="cc.h::MBCB_BITMAP_BLOCK_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MBCB_BITMAP_BLOCK_SIZE&nbsp;&nbsp;&nbsp;(VACB_LEVEL_BLOCK_SIZE)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00351">351</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02626">CcDeleteMbcb()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01996">CcFindBitmapRangeToDirty()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="cc.h::MBCB_BITMAP_INITIAL_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MBCB_BITMAP_INITIAL_SIZE&nbsp;&nbsp;&nbsp;(2 * sizeof(<a class="el" href="../../d8/d3/struct__BITMAP__RANGE.html">BITMAP_RANGE</a>))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00364">364</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="cc.h::MBCB_BITMAP_RANGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MBCB_BITMAP_RANGE&nbsp;&nbsp;&nbsp;(MBCB_BITMAP_BLOCK_SIZE * 8 * PAGE_SIZE)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00358">358</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="cc.h::MIN_ZERO_TRANSFER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MIN_ZERO_TRANSFER&nbsp;&nbsp;&nbsp;(0x10000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00289">289</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a57" doxytag="cc.h::mm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define mm&nbsp;&nbsp;&nbsp;(0x100)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00462">462</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00030">CcMdlRead()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00406">CcMdlReadComplete2()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00838">CcMdlWriteComplete2()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02563">CcUnmapAndPurge()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01156">CcUnmapVacb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a78" doxytag="cc.h::MODIFIED_WRITE_DISABLED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MODIFIED_WRITE_DISABLED&nbsp;&nbsp;&nbsp;0x0200          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01077">1077</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02439">CcCalculateVacbLevelLockCount()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01208">CcCreateVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00271">CcPinMappedData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00524">CcPinRead()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00947">CcReferenceFileOffset()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03758">CcReleaseByteRangeFromWrite()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00032">CcSetAdditionalCacheAttributes()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05143">CcUnpinRepinnedBcb()</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l02094">VacbLevelReference()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="cc.h::NOISE_BITS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NOISE_BITS&nbsp;&nbsp;&nbsp;(0x7)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00423">423</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a75" doxytag="cc.h::ONLY_SEQUENTIAL_ONLY_SEEN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ONLY_SEQUENTIAL_ONLY_SEEN&nbsp;&nbsp;&nbsp;0x0040          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01059">1059</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01156">CcUnmapVacb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a72" doxytag="cc.h::PIN_ACCESS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PIN_ACCESS&nbsp;&nbsp;&nbsp;0x0004          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01038">1038</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a64" doxytag="cc.h::PREALLOCATED_VACBS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PREALLOCATED_VACBS&nbsp;&nbsp;&nbsp;(4)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00571">571</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01208">CcCreateVacbArray()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a62" doxytag="cc.h::QuadAlign" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define QuadAlign          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">P&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(             \
    ((((P)) + 7) &amp; (-8)) \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00513">513</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l01885">LfsIsRestartAreaValid()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l01711">LfsIsRestartPageHeaderValid()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02514">LfsUpdateLfcbFromNoRestart()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02697">LfsUpdateLfcbFromRestart()</a>, <a class="el" href="../../d8/d4/logrcsup_8c-source.html#l00055">LfsWriteLogRecordIntoLogPage()</a>, and <a class="el" href="../../d2/d7/dirctrl_8c-source.html#l00334">UdfQueryDirectory()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a81" doxytag="cc.h::RANDOM_ACCESS_SEEN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define RANDOM_ACCESS_SEEN&nbsp;&nbsp;&nbsp;0x1000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01098">1098</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="cc.h::SEQUENTIAL_MAP_LIMIT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SEQUENTIAL_MAP_LIMIT&nbsp;&nbsp;&nbsp;((ULONG)(0x00080000))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00200">200</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a84" doxytag="cc.h::SetActiveVacb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SetActiveVacb          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">SCM,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IRQ,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>V,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>P,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>D&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01619">1619</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l00031">CcCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l00588">CcFastCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01482">CcFastCopyWrite()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a60" doxytag="cc.h::SetFlag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SetFlag          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">F,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>SF&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{ \
    (F) |= (SF);        \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00505">505</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00362">CcIsThereDirtyData()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00032">CcSetAdditionalCacheAttributes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02747">CcSetDirtyPageThreshold()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02804">CcZeroEndOfLastPage()</a>, <a class="el" href="../../d7/d6/fs__rec_8c-source.html#l00703">FsRecGetDeviceSectors()</a>, <a class="el" href="../../d7/d6/fs__rec_8c-source.html#l00800">FsRecGetDeviceSectorSize()</a>, <a class="el" href="../../d7/d6/fs__rec_8c-source.html#l00907">FsRecReadBlock()</a>, <a class="el" href="../../d2/d6/tunnel_8c-source.html#l00584">FsRtlAddToTunnelCache()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02555">FsRtlCancelNotify()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l02873">FsRtlCheckNotifyForDelete()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l01795">FsRtlNotifyCleanup()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00547">FsRtlNotifyFullChangeDirectory()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00973">FsRtlNotifyFullReportChange()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01937">FsRtlOpBatchBreakClosePending()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02454">FsRtlOplockBreakToII()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02690">FsRtlOplockBreakToNone()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l00581">FsRtlOplockFsctrl()</a>, <a class="el" href="../../d7/d4/logpgsup_8c-source.html#l00113">LfsAllocateSpanningBuffer()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l00706">LfsCloseLogFile()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l03193">LfsFindLastLsn()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l00551">LfsFlushLfcb()</a>, <a class="el" href="../../d8/d0/lbcbsup_8c-source.html#l00311">LfsGetLbcb()</a>, <a class="el" href="../../d8/d7/sysinit_8c-source.html#l00040">LfsInitializeLogFileService()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l01534">LfsRestartLogFile()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02514">LfsUpdateLfcbFromNoRestart()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02390">LfsUpdateLfcbFromPgHeader()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02697">LfsUpdateLfcbFromRestart()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l02964">LfsUpdateRestartAreaFromLfcb()</a>, <a class="el" href="../../d8/d9/rstrtsup_8c-source.html#l00036">LfsWriteLfsRestart()</a>, <a class="el" href="../../d8/d4/logrcsup_8c-source.html#l00055">LfsWriteLogRecordIntoLogPage()</a>, <a class="el" href="../../d9/d6/udfs_2cleanup_8c-source.html#l00042">UdfCommonCleanup()</a>, <a class="el" href="../../d5/d8/udfs_2pnp_8c-source.html#l00075">UdfCommonPnp()</a>, <a class="el" href="../../d8/d4/udfs_2read_8c-source.html#l00068">UdfCommonRead()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l01955">UdfCompleteFcbOpen()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l01301">UdfCreateIrpContext()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l00966">UdfDismountVolume()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l03307">UdfFindAnchorVolumeDescriptor()</a>, <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00218">UdfFsdDispatch()</a>, <a class="el" href="../../d3/d8/close_8c-source.html#l00099">UdfFspClose()</a>, <a class="el" href="../../d1/d7/fspdisp_8c-source.html#l00038">UdfFspDispatch()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l03388">UdfInitializeAllocations()</a>, <a class="el" href="../../d2/d7/dirctrl_8c-source.html#l01003">UdfInitializeEnumeration()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l02297">UdfInitializeFcbFromIcbContext()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00181">UdfInitializeFcbMcb()</a>, <a class="el" href="../../d6/d3/prefxsup_8c-source.html#l00503">UdfInitializeLcbFromDirContext()</a>, <a class="el" href="../../d3/d5/allocsup_8c-source.html#l00367">UdfInitializePcb()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l01528">UdfInitializeStackIrpContext()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00331">UdfInitializeVcb()</a>, <a class="el" href="../../d6/d3/prefxsup_8c-source.html#l00064">UdfInsertPrefix()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01271">UdfInvalidateVolumes()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01175">UdfIsVolumeMounted()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l00621">UdfLockVolumeInternal()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00916">UdfLookupDirEntryPostProcessing()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l01444">UdfMountVolume()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l00809">UdfNormalizeFileNames()</a>, <a class="el" href="../../d2/d7/dirctrl_8c-source.html#l00904">UdfNotifyChangeDirectory()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l01522">UdfOpenExistingFcb()</a>, <a class="el" href="../../d4/d7/udfs_2create_8c-source.html#l01632">UdfOpenObjectFromDirContext()</a>, <a class="el" href="../../d0/d7/udfs_2fsctrl_8c-source.html#l00470">UdfOplockRequest()</a>, <a class="el" href="../../d4/d6/deviosup_8c-source.html#l00573">UdfPerformDevIoCtrl()</a>, <a class="el" href="../../d3/d8/workque_8c-source.html#l00111">UdfPrePostIrp()</a>, <a class="el" href="../../d2/d7/dirctrl_8c-source.html#l00334">UdfQueryDirectory()</a>, <a class="el" href="../../d3/d8/close_8c-source.html#l00634">UdfQueueClose()</a>, <a class="el" href="../../d4/d6/deviosup_8c-source.html#l00685">UdfReadSectors()</a>, <a class="el" href="../../d7/d2/filobsup_8c-source.html#l00049">UdfSetFileObject()</a>, <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00873">UdfSetThreadContext()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l01606">UdfTeardownStructures()</a>, <a class="el" href="../../d5/d7/dirsup_8c-source.html#l00360">UdfUpdateDirNames()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00477">UdfUpdateVcbPhase0()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00997">UdfUpdateVcbPhase1()</a>, <a class="el" href="../../d9/d4/udfs_2verfysup_8c-source.html#l00760">UdfVerifyFcbOperation()</a>, and <a class="el" href="../../d9/d4/udfs_2verfysup_8c-source.html#l00603">UdfVerifyVcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="cc.h::SIZE_PER_BCB_LIST" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SIZE_PER_BCB_LIST&nbsp;&nbsp;&nbsp;(VACB_MAPPING_GRANULARITY * 2)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00386">386</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01208">CcCreateVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05314">CcFindBcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a73" doxytag="cc.h::TRUNCATE_REQUIRED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TRUNCATE_REQUIRED&nbsp;&nbsp;&nbsp;0x0010          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01045">1045</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02563">CcUnmapAndPurge()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a90" doxytag="cc.h::try_return" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define try_return          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">S&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;{ S; goto try_exit; }</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02154">2154</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05749">CcMapAndRead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00271">CcPinMappedData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00524">CcPinRead()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00767">CcPreparePinWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l01678">FsRtlAcknowledgeOplockBreak()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01970">FsRtlGetNextLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01600">FsRtlLookupLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01763">FsRtlLookupLastLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01841">FsRtlLookupLastLargeMcbEntryAndIndex()</a>, <a class="el" href="../../d3/d6/notify_8c-source.html#l00547">FsRtlNotifyFullChangeDirectory()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02111">FsRtlOplockBreakNotify()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02454">FsRtlOplockBreakToII()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02690">FsRtlOplockBreakToNone()</a>, <a class="el" href="../../d6/d1/oplock_8c-source.html#l02249">FsRtlOplockCleanup()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l00888">FsRtlPrivateInitializeFileLock()</a>, <a class="el" href="../../d6/d2/filelock_8c-source.html#l03867">FsRtlPrivateLock()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02066">FsRtlSplitLargeMcb()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l00706">LfsCloseLogFile()</a>, <a class="el" href="../../d8/d1/lfs_2cachesup_8c-source.html#l00551">LfsFlushLfcb()</a>, <a class="el" href="../../d1/d6/lfs_2registry_8c-source.html#l01141">LfsReadLogFileInformation()</a>, <a class="el" href="../../d6/d8/restart_8c-source.html#l00046">LfsReadRestartArea()</a>, and <a class="el" href="../../d4/d2/querylog_8c-source.html#l00594">LfsTerminateLogQuery()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="cc.h::VACB_LAST_INDEX_FOR_LEVEL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VACB_LAST_INDEX_FOR_LEVEL&nbsp;&nbsp;&nbsp;((1 &lt;&lt; VACB_LEVEL_SHIFT) - 1)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00321">321</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02439">CcCalculateVacbLevelLockCount()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02107">CcGetBcbListHeadLargeOffset()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="cc.h::VACB_LEVEL_BLOCK_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VACB_LEVEL_BLOCK_SIZE&nbsp;&nbsp;&nbsp;((1 &lt;&lt; VACB_LEVEL_SHIFT) * sizeof(PVOID))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00315">315</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d4/cc_8h-source.html#l02048">CcAllocateVacbLevel()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01208">CcCreateVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02107">CcGetBcbListHeadLargeOffset()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01931">CcPrefillVacbLevelZone()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l02094">VacbLevelReference()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="cc.h::VACB_LEVEL_SHIFT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VACB_LEVEL_SHIFT&nbsp;&nbsp;&nbsp;(7)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00307">307</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02335">CcAdjustVacbLevelLockCount()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01208">CcCreateVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02107">CcGetBcbListHeadLargeOffset()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02534">CcGetVacbLargeOffset()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="cc.h::VACB_NUMBER_OF_LEVELS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VACB_NUMBER_OF_LEVELS&nbsp;&nbsp;&nbsp;(((63 - VACB_OFFSET_SHIFT)/VACB_LEVEL_SHIFT) + 1)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00334">334</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01208">CcCreateVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02107">CcGetBcbListHeadLargeOffset()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="cc.h::VACB_SIZE_OF_FIRST_LEVEL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VACB_SIZE_OF_FIRST_LEVEL&nbsp;&nbsp;&nbsp;(1 &lt;&lt; (VACB_OFFSET_SHIFT + VACB_LEVEL_SHIFT))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00327">327</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02335">CcAdjustVacbLevelLockCount()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01007">CcDereferenceFileOffset()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02107">CcGetBcbListHeadLargeOffset()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02534">CcGetVacbLargeOffset()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00947">CcReferenceFileOffset()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00086">SetVacb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a66" doxytag="cc.h::VACB_SPECIAL_DEREFERENCE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VACB_SPECIAL_DEREFERENCE&nbsp;&nbsp;&nbsp;((<a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a>) ~1)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00629">629</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02335">CcAdjustVacbLevelLockCount()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01007">CcDereferenceFileOffset()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a67" doxytag="cc.h::VACB_SPECIAL_FIRST_VALID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VACB_SPECIAL_FIRST_VALID&nbsp;&nbsp;&nbsp;VACB_SPECIAL_DEREFERENCE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00631">631</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00086">SetVacb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a65" doxytag="cc.h::VACB_SPECIAL_REFERENCE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VACB_SPECIAL_REFERENCE&nbsp;&nbsp;&nbsp;((<a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a>) ~0)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00628">628</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00947">CcReferenceFileOffset()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="cc.h::WRITE_CHARGE_THRESHOLD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define WRITE_CHARGE_THRESHOLD&nbsp;&nbsp;&nbsp;(64 * PAGE_SIZE)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00280">280</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a74" doxytag="cc.h::WRITE_QUEUED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define WRITE_QUEUED&nbsp;&nbsp;&nbsp;0x0020          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01051">1051</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04232">CcGetFlushedValidData()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00362">CcIsThereDirtyData()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00838">CcMdlWriteComplete2()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02804">CcZeroEndOfLastPage()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a85" doxytag="cc.h::ZERO_FIRST_PAGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ZERO_FIRST_PAGE&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01798">1798</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01482">CcFastCopyWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05749">CcMapAndRead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, and <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a87" doxytag="cc.h::ZERO_LAST_PAGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ZERO_LAST_PAGE&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01800">1800</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01482">CcFastCopyWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05749">CcMapAndRead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, and <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a86" doxytag="cc.h::ZERO_MIDDLE_PAGES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ZERO_MIDDLE_PAGES&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01799">1799</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01482">CcFastCopyWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05749">CcMapAndRead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, and <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a109" doxytag="cc.h::BCB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d3/struct__BCB.html">_BCB</a>  <a class="el" href="../../d4/d3/struct__BCB.html">BCB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05314">CcFindBcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a105" doxytag="cc.h::BITMAP_RANGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d3/struct__BITMAP__RANGE.html">_BITMAP_RANGE</a>  <a class="el" href="../../d8/d3/struct__BITMAP__RANGE.html">BITMAP_RANGE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01996">CcFindBitmapRangeToDirty()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a113" doxytag="cc.h::DEFERRED_WRITE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d2/struct__DEFERRED__WRITE.html">_DEFERRED_WRITE</a>  <a class="el" href="../../d5/d2/struct__DEFERRED__WRITE.html">DEFERRED_WRITE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01982">CcDeferWrite()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a115" doxytag="cc.h::LAZY_WRITER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d9/struct__LAZY__WRITER.html">_LAZY_WRITER</a>  <a class="el" href="../../d3/d9/struct__LAZY__WRITER.html">LAZY_WRITER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a107" doxytag="cc.h::MBCB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d6/struct__MBCB.html">_MBCB</a>  <a class="el" href="../../d9/d6/struct__MBCB.html">MBCB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a119" doxytag="cc.h::MDL_WRITE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d7/struct__MDL__WRITE.html">_MDL_WRITE</a>  <a class="el" href="../../d7/d7/struct__MDL__WRITE.html">MDL_WRITE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a111" doxytag="cc.h::OBCB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d4/struct__OBCB.html">_OBCB</a>  <a class="el" href="../../d6/d4/struct__OBCB.html">OBCB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d8/pinsup_8c-source.html#l01230">CcAllocateObcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a110" doxytag="cc.h::PBCB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d4/d3/struct__BCB.html">BCB</a>* <a class="el" href="../../d4/d3/struct__BCB.html">PBCB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01340">1340</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d5/allocsup_8c-source.html#l01017">UdfLookupPsnOfExtent()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a106" doxytag="cc.h::PBITMAP_RANGE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d3/struct__BITMAP__RANGE.html">_BITMAP_RANGE</a> * <a class="el" href="../../d8/d3/struct__BITMAP__RANGE.html">PBITMAP_RANGE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a114" doxytag="cc.h::PDEFERRED_WRITE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d2/struct__DEFERRED__WRITE.html">_DEFERRED_WRITE</a> * <a class="el" href="../../d5/d2/struct__DEFERRED__WRITE.html">PDEFERRED_WRITE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a108" doxytag="cc.h::PMBCB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d9/d6/struct__MBCB.html">MBCB</a>* <a class="el" href="../../d9/d6/struct__MBCB.html">PMBCB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01228">1228</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a120" doxytag="cc.h::PMDL_WRITE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d7/struct__MDL__WRITE.html">_MDL_WRITE</a> * <a class="el" href="../../d7/d7/struct__MDL__WRITE.html">PMDL_WRITE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a112" doxytag="cc.h::POBCB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d6/d4/struct__OBCB.html">OBCB</a>* <a class="el" href="../../d6/d4/struct__OBCB.html">POBCB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01374">1374</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02560">CcSetDirtyPinnedData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a100" doxytag="cc.h::PPRIVATE_CACHE_MAP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html">PRIVATE_CACHE_MAP</a>* <a class="el" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html">PPRIVATE_CACHE_MAP</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00717">717</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01222">CcSetReadAheadGranularity()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a99" doxytag="cc.h::PRIVATE_CACHE_MAP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html">_PRIVATE_CACHE_MAP</a>  <a class="el" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html">PRIVATE_CACHE_MAP</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a102" doxytag="cc.h::PSHARED_CACHE_MAP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">SHARED_CACHE_MAP</a>* <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00997">997</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a104" doxytag="cc.h::PSHARED_CACHE_MAP_LIST_CURSOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html">_SHARED_CACHE_MAP_LIST_CURSOR</a> * <a class="el" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html">PSHARED_CACHE_MAP_LIST_CURSOR</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a98" doxytag="cc.h::PVACB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d5/struct__VACB.html">_VACB</a> * <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d4/cc_8h-source.html#l02048">CcAllocateVacbLevel()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02070">CcDeallocateVacbLevel()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a96" doxytag="cc.h::PVACB_LEVEL_REFERENCE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">_VACB_LEVEL_REFERENCE</a> * <a class="el" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">PVACB_LEVEL_REFERENCE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d4/cc_8h-source.html#l02110">IsVacbLevelReferenced()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00125">ReferenceVacbLevel()</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l02094">VacbLevelReference()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a118" doxytag="cc.h::PWORK_QUEUE_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">_WORK_QUEUE_ENTRY</a> * <a class="el" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">PWORK_QUEUE_ENTRY</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a101" doxytag="cc.h::SHARED_CACHE_MAP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">_SHARED_CACHE_MAP</a>  <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">SHARED_CACHE_MAP</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a103" doxytag="cc.h::SHARED_CACHE_MAP_LIST_CURSOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html">_SHARED_CACHE_MAP_LIST_CURSOR</a>  <a class="el" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html">SHARED_CACHE_MAP_LIST_CURSOR</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a97" doxytag="cc.h::VACB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d5/struct__VACB.html">_VACB</a>  <a class="el" href="../../d2/d5/struct__VACB.html">VACB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00188">CcInitializeVacbs()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a95" doxytag="cc.h::VACB_LEVEL_REFERENCE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">_VACB_LEVEL_REFERENCE</a>  <a class="el" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">VACB_LEVEL_REFERENCE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01208">CcCreateVacbArray()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01931">CcPrefillVacbLevelZone()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a117" doxytag="cc.h::WORK_QUEUE_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">_WORK_QUEUE_ENTRY</a>  <a class="el" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">WORK_QUEUE_ENTRY</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a116" doxytag="cc.h::WORKER_FUNCTION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d5/d5/cc_8h.html#a210">_WORKER_FUNCTION</a>  <a class="el" href="../../d5/d5/cc_8h.html#a116">WORKER_FUNCTION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="a210" doxytag="cc.h::_WORKER_FUNCTION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d5/d5/cc_8h.html#a210">_WORKER_FUNCTION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a210a166" doxytag="Noop" ></a>Noop</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a210a167" doxytag="ReadAhead" ></a>ReadAhead</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a210a168" doxytag="WriteBehind" ></a>WriteBehind</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a210a169" doxytag="LazyWriteScan" ></a>LazyWriteScan</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a210a170" doxytag="EventSet" ></a>EventSet</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01482">1482</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
<pre class="fragment"><div>01482                               {
01483     <a class="code" href="../../d5/d5/cc_8h.html#a210a166">Noop</a> = 0,
01484     <a class="code" href="../../d5/d5/cc_8h.html#a210a167">ReadAhead</a>,
01485     <a class="code" href="../../d5/d5/cc_8h.html#a210a168">WriteBehind</a>,
01486     <a class="code" href="../../d5/d5/cc_8h.html#a210a169">LazyWriteScan</a>,
01487     <a class="code" href="../../d5/d5/cc_8h.html#a210a170">EventSet</a>
01488     } <a class="code" href="../../d5/d5/cc_8h.html#a116">WORKER_FUNCTION</a>;
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a211" doxytag="cc.h::UNMAP_ACTIONS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d5/d5/cc_8h.html#a211">UNMAP_ACTIONS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a211a171" doxytag="UNPIN" ></a>UNPIN</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a211a172" doxytag="UNREF" ></a>UNREF</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a211a173" doxytag="SET_CLEAN" ></a>SET_CLEAN</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01758">1758</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
<pre class="fragment"><div>01758              {
01759     <a class="code" href="../../d5/d5/cc_8h.html#a211a171">UNPIN</a>,
01760     <a class="code" href="../../d5/d5/cc_8h.html#a211a172">UNREF</a>,
01761     <a class="code" href="../../d5/d5/cc_8h.html#a211a173">SET_CLEAN</a>
01762 } <a class="code" href="../../d5/d5/cc_8h.html#a211">UNMAP_ACTIONS</a>;
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a202" doxytag="cc.h::CcAdjustVacbLevelLockCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcAdjustVacbLevelLockCount           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FileOffset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Adjustment</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02335">2335</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02110">IsVacbLevelReferenced()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00125">ReferenceVacbLevel()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00307">VACB_LEVEL_SHIFT</a>, <a class="el" href="../../d5/d1/cache_8h-source.html#l00031">VACB_OFFSET_SHIFT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00327">VACB_SIZE_OF_FIRST_LEVEL</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l00629">VACB_SPECIAL_DEREFERENCE</a>.
<p>
<pre class="fragment"><div>02343                    :
02344 
02345     This routine may be called to adjust <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lock count of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> bottom Vacb level when
02346     Bcbs are inserted or deleted.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> count goes to zero, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> level will be
02347     eliminated.  The bottom level must exist, or we crash!
02348 
02349 Arguments:
02350 
02351     SharedCacheMap - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SharedCacheMap <span class="keywordflow">for</span> which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vacb
02352                      <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> desired.
02353 
02354     FileOffset - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> fileOffset corresponding to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired Vacb.
02355 
02356     Adjustment - Generally -1 or +1.
02357 
02358 Return Value:
02359 
02360     None.
02361 
02362 Environment:
02363 
02364     <a class="code" href="../../d5/d2/cachedat_8c.html#a18">CcVacbSpinLock</a> should be held on entry.
02365 
02366 --*/
02367 
02368 {
02369     ULONG Level, Shift;
02370     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *VacbArray;
02371     LONGLONG OriginalFileOffset = FileOffset;
02372 
02373     <span class="comment">//</span>
02374     <span class="comment">//  Initialize variables controlling our descent into the hierarchy.</span>
02375     <span class="comment">//</span>
02376 
02377     Level = 0;
02378     Shift = <a class="code" href="../../d4/d2/cache_8h.html#a1">VACB_OFFSET_SHIFT</a> + <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
02379 
02380     VacbArray = SharedCacheMap-&gt;Vacbs;
02381 
02382     <span class="comment">//</span>
02383     <span class="comment">//  Caller must have verified that we have a hierarchy, otherwise this routine</span>
02384     <span class="comment">//  would fail.</span>
02385     <span class="comment">//</span>
02386 
02387     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(SharedCacheMap-&gt;SectionSize.QuadPart &gt; VACB_SIZE_OF_FIRST_LEVEL);
02388 
02389     <span class="comment">//</span>
02390     <span class="comment">//  Loop to calculate how many levels we have and how much we have to</span>
02391     <span class="comment">//  shift to index into the first level.</span>
02392     <span class="comment">//</span>
02393 
02394     <span class="keywordflow">do</span> {
02395 
02396         Level += 1;
02397         Shift += <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
02398 
02399     } <span class="keywordflow">while</span> (SharedCacheMap-&gt;SectionSize.QuadPart &gt; ((LONGLONG)1 &lt;&lt; Shift));
02400 
02401     <span class="comment">//</span>
02402     <span class="comment">//  Now descend the tree to the bottom level to get the caller's Vacb.</span>
02403     <span class="comment">//</span>
02404 
02405     Shift -= <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
02406     <span class="keywordflow">do</span> {
02407 
02408         VacbArray = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *)VacbArray[(ULONG)(FileOffset &gt;&gt; Shift)];
02409 
02410         Level -= 1;
02411 
02412         FileOffset &amp;= ((LONGLONG)1 &lt;&lt; Shift) - 1;
02413 
02414         Shift -= <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
02415 
02416     } <span class="keywordflow">while</span> (Level != 0);
02417 
02418     <span class="comment">//</span>
02419     <span class="comment">//  Now we have reached the final level, do the adjustment.</span>
02420     <span class="comment">//</span>
02421 
02422     <a class="code" href="../../d5/d3/vacbsup_8c.html#a12">ReferenceVacbLevel</a>( SharedCacheMap, VacbArray, Level, Adjustment, FALSE );
02423 
02424     <span class="comment">//</span>
02425     <span class="comment">//  Now, if we decremented the count to 0, then force the collapse to happen by</span>
02426     <span class="comment">//  upping count and resetting to NULL.  Then smash OriginalFileOffset to be</span>
02427     <span class="comment">//  the first entry so we do not recalculate!</span>
02428     <span class="comment">//</span>
02429 
02430     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a209">IsVacbLevelReferenced</a>( SharedCacheMap, VacbArray, Level )) {
02431         <a class="code" href="../../d5/d3/vacbsup_8c.html#a12">ReferenceVacbLevel</a>( SharedCacheMap, VacbArray, Level, 1, TRUE );
02432         OriginalFileOffset &amp;= ~(<a class="code" href="../../d5/d5/cc_8h.html#a41">VACB_SIZE_OF_FIRST_LEVEL</a> - 1);
02433         <a class="code" href="../../d5/d3/vacbsup_8c.html#a10">CcSetVacbLargeOffset</a>( SharedCacheMap, OriginalFileOffset, VACB_SPECIAL_DEREFERENCE );
02434     }
02435 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a206" doxytag="cc.h::CcAllocateVacbLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> _inline <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a>* CcAllocateVacbLevel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>AllocatingBcbListHeads</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02048">2048</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00086">CcVacbLevelEntries</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00087">CcVacbLevelFreeList</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00088">CcVacbLevelWithBcbsEntries</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00089">CcVacbLevelWithBcbsFreeList</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d5/cc_8h.html#a98">PVACB</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l00315">VACB_LEVEL_BLOCK_SIZE</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>.
<p>
<pre class="fragment"><div>02052 {
02053     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *ReturnEntry;
02054 
02055     <span class="keywordflow">if</span> (AllocatingBcbListHeads) {
02056         ReturnEntry = <a class="code" href="../../d5/d2/cachedat_8c.html#a27">CcVacbLevelWithBcbsFreeList</a>;
02057         <a class="code" href="../../d5/d2/cachedat_8c.html#a27">CcVacbLevelWithBcbsFreeList</a> = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *)*ReturnEntry;
02058         <a class="code" href="../../d5/d2/cachedat_8c.html#a26">CcVacbLevelWithBcbsEntries</a> -= 1;
02059     } <span class="keywordflow">else</span> {
02060         ReturnEntry = <a class="code" href="../../d5/d2/cachedat_8c.html#a25">CcVacbLevelFreeList</a>;
02061         <a class="code" href="../../d5/d2/cachedat_8c.html#a25">CcVacbLevelFreeList</a> = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *)*ReturnEntry;
02062         <a class="code" href="../../d5/d2/cachedat_8c.html#a24">CcVacbLevelEntries</a> -= 1;
02063     }
02064     *ReturnEntry = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02065     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(RtlCompareMemory(ReturnEntry, ReturnEntry + 1, VACB_LEVEL_BLOCK_SIZE - <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>)) ==
02066                                                           (VACB_LEVEL_BLOCK_SIZE - <span class="keyword">sizeof</span>(PVACB)));
02067     <span class="keywordflow">return</span> ReturnEntry;
02068 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a190" doxytag="cc.h::CcCopyReadExceptionFilter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG CcCopyReadExceptionFilter           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_POINTERS&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionPointer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PNTSTATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionCode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d6/copysup_8c-source.html#l01747">1747</a> of file <a class="el" href="../../d6/d6/copysup_8c-source.html">copysup.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, and <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l00031">CcCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l00588">CcFastCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01482">CcFastCopyWrite()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>.
<p>
<pre class="fragment"><div>01754                    :
01755 
01756     This routine serves as a exception filter and has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> special job of
01757     extracting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="stringliteral">"real"</span> I/O error when Mm raises STATUS_IN_PAGE_ERROR
01758     beneath us.
01759 
01760 Arguments:
01761 
01762     ExceptionPointer - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception record that contains
01763                        <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> real Io <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>.
01764 
01765     ExceptionCode - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to an <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> real
01766                     status.
01767 
01768 Return Value:
01769 
01770     <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>
01771 
01772 --*/
01773 
01774 {
01775     *ExceptionCode = ExceptionPointer-&gt;ExceptionRecord-&gt;ExceptionCode;
01776 
01777     <span class="keywordflow">if</span> ( (*ExceptionCode == STATUS_IN_PAGE_ERROR) &amp;&amp;
01778          (ExceptionPointer-&gt;ExceptionRecord-&gt;NumberParameters &gt;= 3) ) {
01779 
01780         *ExceptionCode = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>) ExceptionPointer-&gt;ExceptionRecord-&gt;ExceptionInformation[2];
01781     }
01782 
01783     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(*ExceptionCode) );
01784 
01785     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>;
01786 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a199" doxytag="cc.h::CcCreateVacbArray" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL CcCreateVacbArray           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>NewSectionSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01208">1208</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00385">BEGIN_BCB_LIST_ARRAY</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00085">CcMaxVacbLevelsSeen</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01077">MODIFIED_WRITE_DISABLED</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00571">PREALLOCATED_VACBS</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00386">SIZE_PER_BCB_LIST</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00174">SizeOfVacbArray</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00315">VACB_LEVEL_BLOCK_SIZE</a>, <a class="el" href="../../d5/d5/cc_8h.html#a95">VACB_LEVEL_REFERENCE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00307">VACB_LEVEL_SHIFT</a>, <a class="el" href="../../d5/d1/cache_8h-source.html#l00030">VACB_MAPPING_GRANULARITY</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00334">VACB_NUMBER_OF_LEVELS</a>, and <a class="el" href="../../d5/d1/cache_8h-source.html#l00031">VACB_OFFSET_SHIFT</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>.
<p>
<pre class="fragment"><div>01215                    :
01216 
01217     This routine must be called when a SharedCacheMap <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> created to create
01218     and initialize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initial Vacb array.
01219 
01220 Arguments:
01221 
01222     SharedCacheMap - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> shared cache map <span class="keywordflow">for</span> which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01223                      to be created.
01224 
01225     NewSectionSize - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section which must be
01226                      covered by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vacb array.
01227 
01228 Return Value:
01229 
01230     None.
01231 
01232 --*/
01233 
01234 {
01235     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *NewAddresses;
01236     ULONG NewSize, SizeToAllocate;
01237     PLIST_ENTRY BcbListHead;
01238     BOOLEAN CreateBcbListHeads = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, CreateReference = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01239 
01240     NewSize = SizeToAllocate = <a class="code" href="../../d5/d3/vacbsup_8c.html#a4">SizeOfVacbArray</a>(NewSectionSize);
01241 
01242     <span class="comment">//</span>
01243     <span class="comment">//  The following limit is greater than the MM limit</span>
01244     <span class="comment">//  (i.e., MM actually only supports even smaller sections).</span>
01245     <span class="comment">//  We have to reject the sign bit, and testing the high byte</span>
01246     <span class="comment">//  for nonzero will surely only catch errors.</span>
01247     <span class="comment">//</span>
01248 
01249     <span class="keywordflow">if</span> (NewSectionSize.HighPart &amp; ~(<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1)) {
01250         <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>(STATUS_SECTION_TOO_BIG);
01251     }
01252 
01253     <span class="comment">//</span>
01254     <span class="comment">//  See if we can use the array inside the shared cache map.</span>
01255     <span class="comment">//</span>
01256 
01257     <span class="keywordflow">if</span> (NewSize == (<a class="code" href="../../d5/d5/cc_8h.html#a64">PREALLOCATED_VACBS</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>))) {
01258 
01259         NewAddresses = &amp;SharedCacheMap-&gt;InitialVacbs[0];
01260 
01261     <span class="comment">//</span>
01262     <span class="comment">//  Else allocate the array.</span>
01263     <span class="comment">//</span>
01264 
01265     } <span class="keywordflow">else</span> {
01266 
01267         <span class="comment">//</span>
01268         <span class="comment">//  For large metadata streams, double the size to allocate</span>
01269         <span class="comment">//  an array of Bcb listheads.  Each two Vacb pointers also</span>
01270         <span class="comment">//  gets its own Bcb listhead, thus requiring double the size.</span>
01271         <span class="comment">//</span>
01272 
01273         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(SIZE_PER_BCB_LIST == (VACB_MAPPING_GRANULARITY * 2));
01274 
01275         <span class="comment">//</span>
01276         <span class="comment">//  If this stream is larger than the size for multi-level Vacbs,</span>
01277         <span class="comment">//  then fix the size to allocate the root.</span>
01278         <span class="comment">//</span>
01279 
01280         <span class="keywordflow">if</span> (NewSize &gt; <a class="code" href="../../d5/d5/cc_8h.html#a39">VACB_LEVEL_BLOCK_SIZE</a>) {
01281 
01282             ULONG Level = 0;
01283             ULONG Shift = <a class="code" href="../../d4/d2/cache_8h.html#a1">VACB_OFFSET_SHIFT</a> + <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
01284 
01285             NewSize = SizeToAllocate = <a class="code" href="../../d5/d5/cc_8h.html#a39">VACB_LEVEL_BLOCK_SIZE</a>;
01286             SizeToAllocate += <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">VACB_LEVEL_REFERENCE</a>);
01287             CreateReference = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01288 
01289             <span class="comment">//</span>
01290             <span class="comment">//  Loop to calculate how many levels we have and how much we have to</span>
01291             <span class="comment">//  shift to index into the first level.</span>
01292             <span class="comment">//</span>
01293 
01294             <span class="keywordflow">do</span> {
01295 
01296                 Level += 1;
01297                 Shift += <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
01298 
01299             } <span class="keywordflow">while</span> ((NewSectionSize.QuadPart &gt; ((LONGLONG)1 &lt;&lt; Shift)) != 0);
01300 
01301             <span class="comment">//</span>
01302             <span class="comment">//  Remember the maximum level ever seen (which is actually Level + 1).</span>
01303             <span class="comment">//</span>
01304 
01305             <span class="keywordflow">if</span> (Level &gt;= <a class="code" href="../../d5/d2/cachedat_8c.html#a23">CcMaxVacbLevelsSeen</a>) {
01306                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Level &lt;= VACB_NUMBER_OF_LEVELS);
01307                 <a class="code" href="../../d5/d2/cachedat_8c.html#a23">CcMaxVacbLevelsSeen</a> = Level + 1;
01308             }
01309 
01310         } <span class="keywordflow">else</span> {
01311 
01312             <span class="comment">//</span>
01313             <span class="comment">//  Does this stream get a Bcb Listhead array?</span>
01314             <span class="comment">//</span>
01315 
01316             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;Flags, MODIFIED_WRITE_DISABLED) &amp;&amp;
01317                 (NewSectionSize.QuadPart &gt; <a class="code" href="../../d5/d5/cc_8h.html#a46">BEGIN_BCB_LIST_ARRAY</a>)) {
01318 
01319                 SizeToAllocate *= 2;
01320                 CreateBcbListHeads = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01321             }
01322 
01323             <span class="comment">//</span>
01324             <span class="comment">//  Handle the boundary case by giving the proto-level a</span>
01325             <span class="comment">//  reference count.  This will allow us to simply push it</span>
01326             <span class="comment">//  in the expansion case.  In practice, due to pool granularity</span>
01327             <span class="comment">//  this will not change the amount of space allocated</span>
01328             <span class="comment">//</span>
01329 
01330             <span class="keywordflow">if</span> (NewSize == <a class="code" href="../../d5/d5/cc_8h.html#a39">VACB_LEVEL_BLOCK_SIZE</a>) {
01331 
01332                 SizeToAllocate += <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">VACB_LEVEL_REFERENCE</a>);
01333                 CreateReference = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01334             }
01335         }
01336 
01337         NewAddresses = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( NonPagedPool, SizeToAllocate, 'pVcC' );
01338         <span class="keywordflow">if</span> (NewAddresses == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01339             SharedCacheMap-&gt;Status = STATUS_INSUFFICIENT_RESOURCES;
01340             <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>( STATUS_INSUFFICIENT_RESOURCES );
01341         }
01342     }
01343 
01344     <span class="comment">//</span>
01345     <span class="comment">//  Zero out the Vacb array and the trailing reference counts.</span>
01346     <span class="comment">//</span>
01347 
01348     RtlZeroMemory( (PCHAR)NewAddresses, NewSize );
01349 
01350     <span class="keywordflow">if</span> (CreateReference) {
01351 
01352         SizeToAllocate -= <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">VACB_LEVEL_REFERENCE</a>);
01353         RtlZeroMemory( (PCHAR)NewAddresses + SizeToAllocate, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">VACB_LEVEL_REFERENCE</a>) );
01354     }
01355 
01356     <span class="comment">//</span>
01357     <span class="comment">//  Loop to insert the Bcb listheads (if any) in the *descending* order</span>
01358     <span class="comment">//  Bcb list.</span>
01359     <span class="comment">//</span>
01360 
01361     <span class="keywordflow">if</span> (CreateBcbListHeads) {
01362 
01363         <span class="keywordflow">for</span> (BcbListHead = (PLIST_ENTRY)((PCHAR)NewAddresses + NewSize);
01364              BcbListHead &lt; (PLIST_ENTRY)((PCHAR)NewAddresses + SizeToAllocate);
01365              BcbListHead++) {
01366 
01367             InsertHeadList( &amp;SharedCacheMap-&gt;BcbList, BcbListHead );
01368         }
01369     }
01370 
01371     SharedCacheMap-&gt;Vacbs = NewAddresses;
01372     SharedCacheMap-&gt;SectionSize = NewSectionSize;
01373 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a177" doxytag="cc.h::CcDeallocateBcb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL CcDeallocateBcb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d3/struct__BCB.html">PBCB</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Bcb</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05694">5694</a> of file <a class="el" href="../../d7/d1/cachesub_8c-source.html">cachesub.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l01451">_LAZY_WRITER::BcbZone</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00155">CACHE_NTC_BCB</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01998">CcBcbSpinLock</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02478">ExDeleteResource</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02133">ExFreeToZone</a>, and <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00129">LazyWriter</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l02626">CcDeleteMbcb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.
<p>
<pre class="fragment"><div>05700                    :
05701 
05702     This routine deallocates a Bcb to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BcbZone.  It must
05703     already be removed from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> BcbList.
05704 
05705 Arguments:
05706 
05707     Bcb - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Bcb to deallocate
05708 
05709 Return Value:
05710 
05711     None
05712 
05713 --*/
05714 
05715 {
05716     KIRQL OldIrql;
05717 
05718     <span class="comment">//</span>
05719     <span class="comment">//  Deallocate Resource structures</span>
05720     <span class="comment">//</span>
05721 
05722     <span class="keywordflow">if</span> (Bcb-&gt;NodeTypeCode == <a class="code" href="../../d5/d5/cc_8h.html#a14">CACHE_NTC_BCB</a>) {
05723 
05724         <a class="code" href="../../d5/d8/ex_8h.html#a73">ExDeleteResource</a>( &amp;Bcb-&gt;Resource );
05725     }
05726 
05727     <span class="keywordflow">if</span> ( Bcb-&gt;NodeIsInZone ) {
05728 
05729         <span class="comment">//</span>
05730         <span class="comment">//  Synchronize access to the BcbZone</span>
05731         <span class="comment">//</span>
05732 
05733         ExAcquireSpinLock( &amp;CcBcbSpinLock, &amp;OldIrql );
05734         <a class="code" href="../../d5/d8/ex_8h.html#a57">ExFreeToZone</a>( &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a41">LazyWriter</a>.<a class="code" href="../../d3/d9/struct__LAZY__WRITER.html#o2">BcbZone</a>, Bcb );
05735         ExReleaseSpinLock( &amp;CcBcbSpinLock, OldIrql );
05736 
05737     } <span class="keywordflow">else</span> {
05738         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(Bcb);
05739     }
05740     <span class="keywordflow">return</span>;
05741 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a207" doxytag="cc.h::CcDeallocateVacbLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> _inline VOID CcDeallocateVacbLevel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Entry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>DeallocatingBcbListHeads</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02070">2070</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
References <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00086">CcVacbLevelEntries</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00087">CcVacbLevelFreeList</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00088">CcVacbLevelWithBcbsEntries</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00089">CcVacbLevelWithBcbsFreeList</a>, <a class="el" href="../../d5/d5/cc_8h.html#a98">PVACB</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l02626">CcDeleteMbcb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>.
<p>
<pre class="fragment"><div>02075 {
02076     <span class="keywordflow">if</span> (DeallocatingBcbListHeads) {
02077         *Entry = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>)<a class="code" href="../../d5/d2/cachedat_8c.html#a27">CcVacbLevelWithBcbsFreeList</a>;
02078         <a class="code" href="../../d5/d2/cachedat_8c.html#a27">CcVacbLevelWithBcbsFreeList</a> = Entry;
02079         <a class="code" href="../../d5/d2/cachedat_8c.html#a26">CcVacbLevelWithBcbsEntries</a> += 1;
02080     } <span class="keywordflow">else</span> {
02081         *Entry = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>)<a class="code" href="../../d5/d2/cachedat_8c.html#a25">CcVacbLevelFreeList</a>;
02082         <a class="code" href="../../d5/d2/cachedat_8c.html#a25">CcVacbLevelFreeList</a> = Entry;
02083         <a class="code" href="../../d5/d2/cachedat_8c.html#a24">CcVacbLevelEntries</a> += 1;
02084     }
02085 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a189" doxytag="cc.h::CcDeleteSharedCacheMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL CcDeleteSharedCacheMap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>ListIrql</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ReleaseFile</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">1517</a> of file <a class="el" href="../../d6/d7/fssup_8c-source.html">fssup.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01329">_BCB::BaseAddress</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01261">_BCB::BcbLinks</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01254">_BCB::ByteLength</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00155">CACHE_NTC_BCB</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00064">CcAcquireMasterLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01998">CcBcbSpinLock</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05694">CcDeallocateBcb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02626">CcDeleteMbcb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">CcFreeActiveVacb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00862">CcFreeVirtualAddress()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00067">CcReleaseMasterLock</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00103">CcTotalDirtyPages</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00409">CcUnlockVacbLevel</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02563">CcUnmapAndPurge()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01062">CcWaitOnActiveCount()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01335">_BCB::Dirty</a>, <a class="el" href="../../d5/d1/cache_8h-source.html#l00139">_CACHE_UNINITIALIZE_EVENT::Event</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01255">_BCB::FileOffset</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l02628">FsRtlReleaseFile()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01588">GetActiveVacbAtDpcLevel</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02110">IsVacbLevelReferenced()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00033">me</a>, <a class="el" href="../../d5/d1/cache_8h-source.html#l00138">_CACHE_UNINITIALIZE_EVENT::Next</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01247">_BCB::NodeTypeCode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00600">PAGE_SHIFT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01304">_BCB::PinCount</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l01521">_FILE_OBJECT::SectionObjectPointer</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00505">SetFlag</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l01472">_SECTION_OBJECT_POINTERS::SharedCacheMap</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01286">_BCB::Vacb</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00327">VACB_SIZE_OF_FIRST_LEVEL</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l01051">WRITE_QUEUED</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>.
<p>
<pre class="fragment"><div>01525                    :
01526 
01527     The specified SharedCacheMap <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> removed from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global list of
01528     SharedCacheMap's and deleted with all of its related structures.
01529     Other objects which were referenced in <a class="code" href="../../d5/d8/fssup_8c.html#a9">CcInitializeCacheMap</a> are
01530     dereferenced here.
01531 
01532     NOTE:   The <a class="code" href="../../d5/d2/cachedat_8c.html#a0">CcMasterSpinLock</a> must already be acquired
01533             on entry.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> released on <span class="keywordflow">return</span>.
01534 
01535 Arguments:
01536 
01537     SharedCacheMap - Pointer to Cache Map to <span class="keyword">delete</span>
01538 
01539     ListIrql - priority to restore to when releasing shared cache map list
01540 
01541     ReleaseFile - Supplied as nonzero <span class="keywordflow">if</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> was acquired exclusive and
01542                   should be released.
01543 
01544 ReturnValue:
01545 
01546     None.
01547 
01548 --*/
01549 
01550 {
01551     LIST_ENTRY LocalList;
01552     PLIST_ENTRY NextEntry;
01553     <a class="code" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a> FileObject;
01554     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> ActiveVacb;
01555     ULONG ActivePage;
01556     ULONG PageIsDirty;
01557     KIRQL OldIrql;
01558     <a class="code" href="../../d9/d6/struct__MBCB.html">PMBCB</a> Mbcb;
01559 
01560     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, me, <span class="stringliteral">"CcDeleteSharedCacheMap:\n"</span>, 0 );
01561     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"    SharedCacheMap = %08lx\n"</span>, SharedCacheMap );
01562 
01563     <span class="comment">//</span>
01564     <span class="comment">//  Remove it from the global list and clear the pointer to it via</span>
01565     <span class="comment">//  the File Object.</span>
01566     <span class="comment">//</span>
01567 
01568     RemoveEntryList( &amp;SharedCacheMap-&gt;SharedCacheMapLinks );
01569 
01570     <span class="comment">//</span>
01571     <span class="comment">//  Zero pointer to SharedCacheMap.  Once we have cleared the pointer,</span>
01572     <span class="comment">//  we can/must release the global list to avoid deadlocks.</span>
01573     <span class="comment">//</span>
01574 
01575     FileObject = SharedCacheMap-&gt;FileObject;
01576 
01577     FileObject-&gt;<a class="code" href="../../d9/d1/struct__FILE__OBJECT.html#o6">SectionObjectPointer</a>-&gt;<a class="code" href="../../d7/d0/struct__SECTION__OBJECT__POINTERS.html#o1">SharedCacheMap</a> = (<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01578     <a class="code" href="../../d5/d5/cc_8h.html#a60">SetFlag</a>( SharedCacheMap-&gt;Flags, WRITE_QUEUED );
01579 
01580     <span class="comment">//</span>
01581     <span class="comment">//  The OpenCount is 0, but we still need to flush out any dangling</span>
01582     <span class="comment">//  cache read or writes.</span>
01583     <span class="comment">//</span>
01584 
01585     <span class="keywordflow">if</span> ((SharedCacheMap-&gt;VacbActiveCount != 0) || (SharedCacheMap-&gt;NeedToZero != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01586 
01587         <span class="comment">//</span>
01588         <span class="comment">//  We will put it in a local list and set a flag</span>
01589         <span class="comment">//  to keep the Lazy Writer away from it, so that we can wrip it out</span>
01590         <span class="comment">//  below if someone manages to sneak in and set something dirty, etc.</span>
01591         <span class="comment">//  If the file system does not synchronize cleanup calls with an</span>
01592         <span class="comment">//  exclusive on the stream, then this case is possible.</span>
01593         <span class="comment">//</span>
01594 
01595         InitializeListHead( &amp;LocalList );
01596         InsertTailList( &amp;LocalList, &amp;SharedCacheMap-&gt;SharedCacheMapLinks );
01597 
01598         <span class="comment">//</span>
01599         <span class="comment">//  If there is an active Vacb, then nuke it now (before waiting!).</span>
01600         <span class="comment">//</span>
01601 
01602         <a class="code" href="../../d5/d5/cc_8h.html#a83">GetActiveVacbAtDpcLevel</a>( SharedCacheMap, ActiveVacb, ActivePage, PageIsDirty );
01603 
01604         <a class="code" href="../../d5/d5/cc_8h.html#a1">CcReleaseMasterLock</a>( ListIrql );
01605 
01606         <span class="comment">//</span>
01607         <span class="comment">//  No point in saying the page is dirty (which can cause an allocation</span>
01608         <span class="comment">//  failure), since we are deleting this SharedCacheMap anyway.</span>
01609         <span class="comment">//</span>
01610 
01611         <a class="code" href="../../d5/d5/cc_8h.html#a182">CcFreeActiveVacb</a>( SharedCacheMap, ActiveVacb, ActivePage, FALSE );
01612 
01613         <span class="keywordflow">while</span> (SharedCacheMap-&gt;VacbActiveCount != 0) {
01614             <a class="code" href="../../d5/d3/vacbsup_8c.html#a19">CcWaitOnActiveCount</a>( SharedCacheMap );
01615         }
01616 
01617         <span class="comment">//</span>
01618         <span class="comment">//  Now in case we hit the rare path where someone moved the</span>
01619         <span class="comment">//  SharedCacheMap again, do a remove again now.  It may be</span>
01620         <span class="comment">//  from our local list or it may be from the dirty list,</span>
01621         <span class="comment">//  but who cares?  The important thing is to remove it in</span>
01622         <span class="comment">//  the case it was the dirty list, since we will delete it</span>
01623         <span class="comment">//  below.</span>
01624         <span class="comment">//</span>
01625 
01626         <a class="code" href="../../d5/d5/cc_8h.html#a0">CcAcquireMasterLock</a>( &amp;ListIrql );
01627         RemoveEntryList( &amp;SharedCacheMap-&gt;SharedCacheMapLinks );
01628     }
01629 
01630     <a class="code" href="../../d5/d5/cc_8h.html#a1">CcReleaseMasterLock</a>( ListIrql );
01631 
01632     <span class="comment">//</span>
01633     <span class="comment">//  If there are Bcbs, then empty the list, asserting that none of them</span>
01634     <span class="comment">//  can be pinned now if we have gotten this far!</span>
01635     <span class="comment">//</span>
01636 
01637     NextEntry = SharedCacheMap-&gt;BcbList.Flink;
01638     <span class="keywordflow">while</span> (NextEntry != &amp;SharedCacheMap-&gt;BcbList) {
01639 
01640         <a class="code" href="../../d4/d3/struct__BCB.html">PBCB</a> Bcb;
01641 
01642         Bcb = (<a class="code" href="../../d4/d3/struct__BCB.html">PBCB</a>)CONTAINING_RECORD( NextEntry,
01643                                        <a class="code" href="../../d4/d3/struct__BCB.html">BCB</a>,
01644                                        BcbLinks );
01645         NextEntry = Bcb-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o4">BcbLinks</a>.Flink;
01646 
01647         <span class="comment">//</span>
01648         <span class="comment">//  Skip over the pendaflex entries, only removing true Bcbs</span>
01649         <span class="comment">//  so that level teardown doesn't need to special case unhooking</span>
01650         <span class="comment">//  the pendaflex.  This has the side benefit of dramatically</span>
01651         <span class="comment">//  reducing write traffic to memory on teardown of large files.</span>
01652         <span class="comment">//</span>
01653         <span class="comment">//  I really wonder how often we have Bcbs at teardown.  This is</span>
01654         <span class="comment">//  a lot of work that could be avoided otherwise.</span>
01655         <span class="comment">//</span>
01656 
01657         <span class="keywordflow">if</span> (Bcb-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o0">NodeTypeCode</a> == <a class="code" href="../../d5/d5/cc_8h.html#a14">CACHE_NTC_BCB</a>) {
01658 
01659             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Bcb-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o9">PinCount</a> == 0 );
01660 
01661             RemoveEntryList( &amp;Bcb-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o4">BcbLinks</a> );
01662 
01663             <span class="comment">//</span>
01664             <span class="comment">//  For large metadata streams we unlock the Vacb level when removing.</span>
01665             <span class="comment">//  We do not need spinlocks since no other thread can be accessing</span>
01666             <span class="comment">//  this list when we are deleting the SharedCacheMap.</span>
01667             <span class="comment">//</span>
01668 
01669             <a class="code" href="../../d5/d5/cc_8h.html#a51">CcUnlockVacbLevel</a>( SharedCacheMap, Bcb-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o3">FileOffset</a>.QuadPart );
01670 
01671             <span class="comment">//</span>
01672             <span class="comment">//  There is a small window where the data could still be mapped</span>
01673             <span class="comment">//  if (for example) the Lazy Writer collides with a CcCopyWrite</span>
01674             <span class="comment">//  in the foreground, and then someone calls CcUninitializeCacheMap</span>
01675             <span class="comment">//  while the Lazy Writer is active.  This is because the Lazy</span>
01676             <span class="comment">//  Writer biases the pin count.  Deal with that here.</span>
01677             <span class="comment">//</span>
01678 
01679             <span class="keywordflow">if</span> (Bcb-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01680                 <a class="code" href="../../d5/d3/vacbsup_8c.html#a16">CcFreeVirtualAddress</a>( Bcb-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o8">Vacb</a> );
01681             }
01682 
01683             <span class="comment">//</span>
01684             <span class="comment">//  Debug routines used to remove Bcbs from the global list</span>
01685             <span class="comment">//</span>
01686 
01687 <span class="preprocessor">#if LIST_DBG</span>
01688 <span class="preprocessor"></span>
01689             {
01690                 KIRQL OldIrql;
01691 
01692                 ExAcquireSpinLock( &amp;CcBcbSpinLock, &amp;OldIrql );
01693 
01694                 <span class="keywordflow">if</span> (Bcb-&gt;CcBcbLinks.Flink != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01695 
01696                     RemoveEntryList( &amp;Bcb-&gt;CcBcbLinks );
01697                     CcBcbCount -= 1;
01698                 }
01699 
01700                 ExReleaseSpinLock( &amp;CcBcbSpinLock, OldIrql );
01701             }
01702 
01703 <span class="preprocessor">#endif</span>
01704 <span class="preprocessor"></span>
01705             <span class="comment">//</span>
01706             <span class="comment">//  If the Bcb is dirty, we have to synchronize with the Lazy Writer</span>
01707             <span class="comment">//  and reduce the total number of dirty.</span>
01708             <span class="comment">//</span>
01709 
01710             <a class="code" href="../../d5/d5/cc_8h.html#a0">CcAcquireMasterLock</a>( &amp;ListIrql );
01711             <span class="keywordflow">if</span> (Bcb-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o13">Dirty</a>) {
01712 
01713                 SharedCacheMap-&gt;DirtyPages -= Bcb-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o2">ByteLength</a> &gt;&gt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>;
01714                 <a class="code" href="../../d5/d2/cachedat_8c.html#a36">CcTotalDirtyPages</a> -= Bcb-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o2">ByteLength</a> &gt;&gt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>;
01715             }
01716 
01717             <a class="code" href="../../d5/d5/cc_8h.html#a1">CcReleaseMasterLock</a>( ListIrql );
01718 
01719             <a class="code" href="../../d5/d5/cc_8h.html#a177">CcDeallocateBcb</a>( Bcb );
01720         }
01721     }
01722 
01723     <span class="comment">//</span>
01724     <span class="comment">//  Call local routine to unmap, and purge if necessary.</span>
01725     <span class="comment">//</span>
01726 
01727     <a class="code" href="../../d5/d8/fssup_8c.html#a5">CcUnmapAndPurge</a>( SharedCacheMap );
01728 
01729     <span class="comment">//</span>
01730     <span class="comment">//  Now release the file now that the purge is done.</span>
01731     <span class="comment">//</span>
01732 
01733     <span class="keywordflow">if</span> (ReleaseFile) {
01734         <a class="code" href="../../d1/d8/fsrtl_8h.html#a108">FsRtlReleaseFile</a>( SharedCacheMap-&gt;FileObject );
01735     }
01736 
01737     <span class="comment">//</span>
01738     <span class="comment">//  Dereference our pointer to the Section and FileObject</span>
01739     <span class="comment">//  (We have to test the Section pointer since CcInitializeCacheMap</span>
01740     <span class="comment">//  calls this routine for error recovery.  Release our global</span>
01741     <span class="comment">//  resource before dereferencing the FileObject to avoid deadlocks.</span>
01742     <span class="comment">//</span>
01743 
01744     <span class="keywordflow">if</span> (SharedCacheMap-&gt;Section != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01745         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( SharedCacheMap-&gt;Section );
01746     }
01747     <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( FileObject );
01748 
01749     <span class="comment">//</span>
01750     <span class="comment">//  If there is an Mbcb, deduct any dirty pages and deallocate.</span>
01751     <span class="comment">//</span>
01752 
01753     <span class="keywordflow">if</span> (SharedCacheMap-&gt;Mbcb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01754         <a class="code" href="../../d5/d8/fssup_8c.html#a6">CcDeleteMbcb</a>( SharedCacheMap );
01755     }
01756 
01757     <span class="comment">//</span>
01758     <span class="comment">//  If there was an uninitialize event specified for this shared cache</span>
01759     <span class="comment">//  map, then set it to the signalled state, indicating that we are</span>
01760     <span class="comment">//  removing the section and deleting the shared cache map.</span>
01761     <span class="comment">//</span>
01762 
01763     <span class="keywordflow">if</span> (SharedCacheMap-&gt;UninitializeEvent != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01764         <a class="code" href="../../d4/d6/struct__CACHE__UNINITIALIZE__EVENT.html">PCACHE_UNINITIALIZE_EVENT</a> CUEvent, EventNext;
01765 
01766         CUEvent = SharedCacheMap-&gt;UninitializeEvent;
01767         <span class="keywordflow">while</span> (CUEvent != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01768             EventNext = CUEvent-&gt;<a class="code" href="../../d4/d6/struct__CACHE__UNINITIALIZE__EVENT.html#o0">Next</a>;
01769             <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>(&amp;CUEvent-&gt;<a class="code" href="../../d4/d6/struct__CACHE__UNINITIALIZE__EVENT.html#o1">Event</a>, 0, FALSE);
01770             CUEvent = EventNext;
01771         }
01772     }
01773 
01774     <span class="comment">//</span>
01775     <span class="comment">//  Now delete the Vacb vector.</span>
01776     <span class="comment">//</span>
01777 
01778     <span class="keywordflow">if</span> ((SharedCacheMap-&gt;Vacbs != &amp;SharedCacheMap-&gt;InitialVacbs[0])
01779 
01780             &amp;&amp;
01781 
01782         (SharedCacheMap-&gt;Vacbs != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01783 
01784         <span class="comment">//</span>
01785         <span class="comment">//  If there are Vacb levels, then the Vacb Array better be in an empty state.</span>
01786         <span class="comment">//</span>
01787 
01788         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((SharedCacheMap-&gt;SectionSize.QuadPart &lt;= VACB_SIZE_OF_FIRST_LEVEL) ||
01789                !<a class="code" href="../../d5/d5/cc_8h.html#a209">IsVacbLevelReferenced</a>( SharedCacheMap, SharedCacheMap-&gt;Vacbs, 1 ));
01790 
01791         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( SharedCacheMap-&gt;Vacbs );
01792     }
01793 
01794     <span class="comment">//</span>
01795     <span class="comment">//  If an event had to be allocated for this SharedCacheMap,</span>
01796     <span class="comment">//  deallocate it.</span>
01797     <span class="comment">//</span>
01798 
01799     <span class="keywordflow">if</span> ((SharedCacheMap-&gt;CreateEvent != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (SharedCacheMap-&gt;CreateEvent != &amp;SharedCacheMap-&gt;Event)) {
01800         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( SharedCacheMap-&gt;CreateEvent );
01801     }
01802 
01803     <span class="keywordflow">if</span> ((SharedCacheMap-&gt;WaitOnActiveCount != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (SharedCacheMap-&gt;WaitOnActiveCount != &amp;SharedCacheMap-&gt;Event)) {
01804         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( SharedCacheMap-&gt;WaitOnActiveCount );
01805     }
01806 
01807     <span class="comment">//</span>
01808     <span class="comment">//  Deallocate the storeage for the SharedCacheMap.</span>
01809     <span class="comment">//</span>
01810 
01811     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( SharedCacheMap );
01812 
01813     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, me, <span class="stringliteral">"CcDeleteSharedCacheMap -&gt; VOID\n"</span>, 0 );
01814 
01815     <span class="keywordflow">return</span>;
01816 
01817 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a197" doxytag="cc.h::CcDereferenceFileOffset" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcDereferenceFileOffset           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>FileOffset</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01007">1007</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00076">CcAcquireVacbLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00079">CcReleaseVacbLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00086">SetVacb()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00327">VACB_SIZE_OF_FIRST_LEVEL</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l00629">VACB_SPECIAL_DEREFERENCE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>.
<p>
<pre class="fragment"><div>01014                    :
01015 
01016     This routine must be called once <span class="keywordflow">for</span> each call to <a class="code" href="../../d5/d5/cc_8h.html#a196">CcReferenceFileOffset</a>
01017     to remove <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference.
01018 
01019 Arguments:
01020 
01021     SharedCacheMap - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Shared Cache Map <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
01022 
01023     FileOffset - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired FileOffset within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
01024 
01025 Return Value:
01026 
01027     None
01028 
01029 --*/
01030 
01031 {
01032     KIRQL OldIrql;
01033 
01034     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt; DISPATCH_LEVEL);
01035 
01036     <span class="comment">//</span>
01037     <span class="comment">//  This operation only has meaning if the Vacbs are in the multilevel form.</span>
01038     <span class="comment">//</span>
01039 
01040     <span class="keywordflow">if</span> (SharedCacheMap-&gt;SectionSize.QuadPart &gt; <a class="code" href="../../d5/d5/cc_8h.html#a41">VACB_SIZE_OF_FIRST_LEVEL</a>) {
01041 
01042         <span class="comment">//</span>
01043         <span class="comment">//  Acquire the Vacb lock to synchronize the dereference.</span>
01044         <span class="comment">//</span>
01045 
01046         <a class="code" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>( &amp;OldIrql );
01047 
01048         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( FileOffset.QuadPart &lt;= SharedCacheMap-&gt;SectionSize.QuadPart );
01049 
01050         <a class="code" href="../../d5/d3/vacbsup_8c.html#a11">SetVacb</a>( SharedCacheMap, FileOffset, VACB_SPECIAL_DEREFERENCE );
01051 
01052         <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
01053     }
01054 
01055     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt; DISPATCH_LEVEL);
01056 
01057     <span class="keywordflow">return</span>;
01058 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a205" doxytag="cc.h::CcDrainVacbLevelZone" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcDrainVacbLevelZone           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02044">2044</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00076">CcAcquireVacbLock</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00085">CcMaxVacbLevelsSeen</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00079">CcReleaseVacbLock</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00086">CcVacbLevelEntries</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00087">CcVacbLevelFreeList</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00088">CcVacbLevelWithBcbsEntries</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00089">CcVacbLevelWithBcbsFreeList</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l02626">CcDeleteMbcb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01784">CcUnmapVacbArray()</a>.
<p>
<pre class="fragment"><div>02049                    :
02050 
02051     This routine should be called any time some entries have been deallocated to
02052     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> VacbLevel zone, and we want to insure <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> zone <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned to a normal level.
02053 
02054 Arguments:
02055 
02056 Return Value:
02057 
02058     None.
02059 
02060 Environment:
02061 
02062     No spinlocks should be held upon entry.
02063 
02064 --*/
02065 
02066 {
02067     KIRQL OldIrql;
02068     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *NextVacbArray;
02069 
02070     <span class="comment">//</span>
02071     <span class="comment">//  This is an unsafe loop to see if it looks like there is stuff to</span>
02072     <span class="comment">//  clean up.</span>
02073     <span class="comment">//</span>
02074 
02075     <span class="keywordflow">while</span> ((<a class="code" href="../../d5/d2/cachedat_8c.html#a24">CcVacbLevelEntries</a> &gt; (<a class="code" href="../../d5/d2/cachedat_8c.html#a23">CcMaxVacbLevelsSeen</a> * 4)) ||
02076            (<a class="code" href="../../d5/d2/cachedat_8c.html#a26">CcVacbLevelWithBcbsEntries</a> &gt; 2)) {
02077 
02078         <span class="comment">//</span>
02079         <span class="comment">//  Now go in and try to pick up one entry to free under a FastLock.</span>
02080         <span class="comment">//</span>
02081 
02082         NextVacbArray = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02083         <a class="code" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>( &amp;OldIrql );
02084         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d2/cachedat_8c.html#a24">CcVacbLevelEntries</a> &gt; (<a class="code" href="../../d5/d2/cachedat_8c.html#a23">CcMaxVacbLevelsSeen</a> * 4)) {
02085             NextVacbArray = <a class="code" href="../../d5/d2/cachedat_8c.html#a25">CcVacbLevelFreeList</a>;
02086             <a class="code" href="../../d5/d2/cachedat_8c.html#a25">CcVacbLevelFreeList</a> = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *)NextVacbArray[0];
02087             <a class="code" href="../../d5/d2/cachedat_8c.html#a24">CcVacbLevelEntries</a> -= 1;
02088         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d2/cachedat_8c.html#a26">CcVacbLevelWithBcbsEntries</a> &gt; 2) {
02089             NextVacbArray = <a class="code" href="../../d5/d2/cachedat_8c.html#a27">CcVacbLevelWithBcbsFreeList</a>;
02090             <a class="code" href="../../d5/d2/cachedat_8c.html#a27">CcVacbLevelWithBcbsFreeList</a> = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *)NextVacbArray[0];
02091             <a class="code" href="../../d5/d2/cachedat_8c.html#a26">CcVacbLevelWithBcbsEntries</a> -= 1;
02092         }
02093         <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
02094 
02095         <span class="comment">//</span>
02096         <span class="comment">//  Since the loop is unsafe, we may not have gotten anything.</span>
02097         <span class="comment">//</span>
02098 
02099         <span class="keywordflow">if</span> (NextVacbArray != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02100             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(NextVacbArray);
02101         }
02102     }
02103 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a191" doxytag="cc.h::CcExceptionFilter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG CcExceptionFilter           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NTSTATUS&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ExceptionCode</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00619">619</a> of file <a class="el" href="../../d6/d0/lazyrite_8c-source.html">lazyrite.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00056">EXCEPTION_CONTINUE_SEARCH</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, and <a class="el" href="../../d8/d2/fsrtl_2filter_8c-source.html#l00082">FsRtlIsNtstatusExpected()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>.
<p>
<pre class="fragment"><div>00625                    :
00626 
00627     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> standard exception filter <span class="keywordflow">for</span> worker threads which simply
00628     calls an FsRtl routine to see <span class="keywordflow">if</span> an expected status <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being raised.
00629     If so, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> handled, <span class="keywordflow">else</span> we bug check.
00630 
00631 Arguments:
00632 
00633     ExceptionCode - <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception code which was raised.
00634 
00635 Return Value:
00636 
00637     <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> <span class="keywordflow">if</span> expected, <span class="keywordflow">else</span> a Bug Check occurs.
00638 
00639 --*/
00640 
00641 {
00642     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(0, 0, <span class="stringliteral">"CcExceptionFilter %08lx\n"</span>, ExceptionCode);
00643 
00644     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/fsrtl_8h.html#a137">FsRtlIsNtstatusExpected</a>( ExceptionCode )) {
00645 
00646         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>;
00647 
00648     } <span class="keywordflow">else</span> {
00649 
00650         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>;
00651     }
00652 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a200" doxytag="cc.h::CcExtendVacbArray" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcExtendVacbArray           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>NewSectionSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">1377</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d5/cc_8h.html#a109">BCB</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00385">BEGIN_BCB_LIST_ARRAY</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00076">CcAcquireVacbLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00082">CcAcquireVacbLockAtDpcLevel</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02048">CcAllocateVacbLevel()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02439">CcCalculateVacbLevelLockCount()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02070">CcDeallocateVacbLevel()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00085">CcMaxVacbLevelsSeen</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01931">CcPrefillVacbLevelZone()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00079">CcReleaseVacbLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00085">CcReleaseVacbLockFromDpcLevel</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00086">CcVacbLevelEntries</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l01101">FsRtlAllocatePoolWithTag</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02110">IsVacbLevelReferenced()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01077">MODIFIED_WRITE_DISABLED</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00033">Offset</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00125">ReferenceVacbLevel()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00386">SIZE_PER_BCB_LIST</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00174">SizeOfVacbArray</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00315">VACB_LEVEL_BLOCK_SIZE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00307">VACB_LEVEL_SHIFT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00334">VACB_NUMBER_OF_LEVELS</a>, <a class="el" href="../../d5/d1/cache_8h-source.html#l00031">VACB_OFFSET_SHIFT</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l00327">VACB_SIZE_OF_FIRST_LEVEL</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>.
<p>
<pre class="fragment"><div>01384                    :
01385 
01386     This routine must be called any time <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section <span class="keywordflow">for</span> a shared cache
01387     map <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> extended, in order to extend <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vacb array (<span class="keywordflow">if</span> necessary).
01388 
01389 Arguments:
01390 
01391     SharedCacheMap - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> shared cache map <span class="keywordflow">for</span> which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> array <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01392                      to be created.
01393 
01394     NewSectionSize - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section which must be
01395                      covered by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vacb array.
01396 
01397 Return Value:
01398 
01399     None.
01400 
01401 --*/
01402 
01403 {
01404     KIRQL OldIrql;
01405     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *OldAddresses;
01406     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *NewAddresses;
01407     ULONG OldSize;
01408     ULONG NewSize, SizeToAllocate;
01409     LARGE_INTEGER NextLevelSize;
01410     BOOLEAN GrowingBcbListHeads = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, CreateReference = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01411 
01412     <span class="comment">//</span>
01413     <span class="comment">//  The following limit is greater than the MM limit</span>
01414     <span class="comment">//  (i.e., MM actually only supports even smaller sections).</span>
01415     <span class="comment">//  We have to reject the sign bit, and testing the high byte</span>
01416     <span class="comment">//  for nonzero will surely only catch errors.</span>
01417     <span class="comment">//</span>
01418 
01419     <span class="keywordflow">if</span> (NewSectionSize.HighPart &amp; ~(<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1)) {
01420         <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>(STATUS_SECTION_TOO_BIG);
01421     }
01422 
01423     <span class="comment">//</span>
01424     <span class="comment">//  See if we will be growing the Bcb ListHeads, so we can take out the</span>
01425     <span class="comment">//  master lock if so.</span>
01426     <span class="comment">//</span>
01427 
01428     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;Flags, MODIFIED_WRITE_DISABLED) &amp;&amp;
01429         (NewSectionSize.QuadPart &gt; <a class="code" href="../../d5/d5/cc_8h.html#a46">BEGIN_BCB_LIST_ARRAY</a>)) {
01430 
01431         GrowingBcbListHeads = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01432     }
01433 
01434     <span class="comment">//</span>
01435     <span class="comment">//  Is there any work to do?</span>
01436     <span class="comment">//</span>
01437 
01438     <span class="keywordflow">if</span> (NewSectionSize.QuadPart &gt; SharedCacheMap-&gt;SectionSize.QuadPart) {
01439 
01440         <span class="comment">//</span>
01441         <span class="comment">//  Handle the growth of the first level here.</span>
01442         <span class="comment">//</span>
01443 
01444         <span class="keywordflow">if</span> (SharedCacheMap-&gt;SectionSize.QuadPart &lt; <a class="code" href="../../d5/d5/cc_8h.html#a41">VACB_SIZE_OF_FIRST_LEVEL</a>) {
01445 
01446             NextLevelSize = NewSectionSize;
01447 
01448             <span class="comment">//</span>
01449             <span class="comment">//  Limit the growth of this level</span>
01450             <span class="comment">//</span>
01451 
01452             <span class="keywordflow">if</span> (NextLevelSize.QuadPart &gt;= <a class="code" href="../../d5/d5/cc_8h.html#a41">VACB_SIZE_OF_FIRST_LEVEL</a>) {
01453                 NextLevelSize.QuadPart = <a class="code" href="../../d5/d5/cc_8h.html#a41">VACB_SIZE_OF_FIRST_LEVEL</a>;
01454                 CreateReference = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01455             }
01456 
01457             <span class="comment">//</span>
01458             <span class="comment">//  N.B.: SizeOfVacbArray only calculates the size of the VACB</span>
01459             <span class="comment">//  pointer block.  We must adjust for Bcb listheads and the</span>
01460             <span class="comment">//  multilevel reference count.</span>
01461             <span class="comment">//</span>
01462 
01463             NewSize = SizeToAllocate = <a class="code" href="../../d5/d3/vacbsup_8c.html#a4">SizeOfVacbArray</a>(NextLevelSize);
01464             OldSize = <a class="code" href="../../d5/d3/vacbsup_8c.html#a4">SizeOfVacbArray</a>(SharedCacheMap-&gt;SectionSize);
01465 
01466             <span class="comment">//</span>
01467             <span class="comment">//  Only do something if the size is growing.</span>
01468             <span class="comment">//</span>
01469 
01470             <span class="keywordflow">if</span> (NewSize &gt; OldSize) {
01471 
01472                 <span class="comment">//</span>
01473                 <span class="comment">//  Does this stream get a Bcb Listhead array?</span>
01474                 <span class="comment">//</span>
01475 
01476                 <span class="keywordflow">if</span> (GrowingBcbListHeads) {
01477                     SizeToAllocate *= 2;
01478                 }
01479 
01480                 <span class="comment">//</span>
01481                 <span class="comment">//  Do we need space for the reference count?</span>
01482                 <span class="comment">//</span>
01483 
01484                 <span class="keywordflow">if</span> (CreateReference) {
01485                     SizeToAllocate += <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">VACB_LEVEL_REFERENCE</a>);
01486                 }
01487 
01488                 NewAddresses = <a class="code" href="../../d1/d8/fsrtl_8h.html#a37">FsRtlAllocatePoolWithTag</a>( NonPagedPool, SizeToAllocate, 'pVcC' );
01489 
01490                 <span class="comment">//</span>
01491                 <span class="comment">//  See if we will be growing the Bcb ListHeads, so we can take out the</span>
01492                 <span class="comment">//  master lock if so.</span>
01493                 <span class="comment">//</span>
01494 
01495                 <span class="keywordflow">if</span> (GrowingBcbListHeads) {
01496 
01497                     ExAcquireSpinLock( &amp;SharedCacheMap-&gt;BcbSpinLock, &amp;OldIrql );
01498                     <a class="code" href="../../d5/d5/cc_8h.html#a6">CcAcquireVacbLockAtDpcLevel</a>();
01499 
01500                 } <span class="keywordflow">else</span> {
01501 
01502                     <span class="comment">//</span>
01503                     <span class="comment">//  Acquire the spin lock to serialize with anyone who might like</span>
01504                     <span class="comment">//  to "steal" one of the mappings we are going to move.</span>
01505                     <span class="comment">//</span>
01506 
01507                     <a class="code" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>( &amp;OldIrql );
01508                 }
01509 
01510                 OldAddresses = SharedCacheMap-&gt;Vacbs;
01511                 <span class="keywordflow">if</span> (OldAddresses != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01512                     RtlCopyMemory( NewAddresses, OldAddresses, OldSize );
01513                 } <span class="keywordflow">else</span> {
01514                     OldSize = 0;
01515                 }
01516 
01517                 RtlZeroMemory( (PCHAR)NewAddresses + OldSize, NewSize - OldSize );
01518 
01519                 <span class="keywordflow">if</span> (CreateReference) {
01520 
01521                     SizeToAllocate -= <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">VACB_LEVEL_REFERENCE</a>);
01522                     RtlZeroMemory( (PCHAR)NewAddresses + SizeToAllocate, <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">VACB_LEVEL_REFERENCE</a>) );
01523                 }
01524 
01525                 <span class="comment">//</span>
01526                 <span class="comment">//  See if we have to initialize Bcb Listheads.</span>
01527                 <span class="comment">//</span>
01528 
01529                 <span class="keywordflow">if</span> (GrowingBcbListHeads) {
01530 
01531                     LARGE_INTEGER <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
01532                     PLIST_ENTRY BcbListHeadNew, TempEntry;
01533 
01534                     <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>.QuadPart = 0;
01535                     BcbListHeadNew = (PLIST_ENTRY)((PCHAR)NewAddresses + NewSize );
01536 
01537                     <span class="comment">//</span>
01538                     <span class="comment">//  Handle case where the old array had Bcb Listheads.</span>
01539                     <span class="comment">//</span>
01540 
01541                     <span class="keywordflow">if</span> ((SharedCacheMap-&gt;SectionSize.QuadPart &gt; <a class="code" href="../../d5/d5/cc_8h.html#a46">BEGIN_BCB_LIST_ARRAY</a>) &amp;&amp;
01542                         (OldAddresses != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01543 
01544                         PLIST_ENTRY BcbListHeadOld;
01545 
01546                         BcbListHeadOld = (PLIST_ENTRY)((PCHAR)OldAddresses + OldSize);
01547 
01548                         <span class="comment">//</span>
01549                         <span class="comment">//  Loop to remove each old listhead and insert the new one</span>
01550                         <span class="comment">//  in its place.</span>
01551                         <span class="comment">//</span>
01552 
01553                         <span class="keywordflow">do</span> {
01554                             TempEntry = BcbListHeadOld-&gt;Flink;
01555                             RemoveEntryList( BcbListHeadOld );
01556                             InsertTailList( TempEntry, BcbListHeadNew );
01557                             <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>.QuadPart += <a class="code" href="../../d5/d5/cc_8h.html#a47">SIZE_PER_BCB_LIST</a>;
01558                             BcbListHeadOld += 1;
01559                             BcbListHeadNew += 1;
01560                         } <span class="keywordflow">while</span> (<a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>.QuadPart &lt; SharedCacheMap-&gt;SectionSize.QuadPart);
01561 
01562                     <span class="comment">//</span>
01563                     <span class="comment">//  Otherwise, handle the case where we are adding Bcb</span>
01564                     <span class="comment">//  Listheads.</span>
01565                     <span class="comment">//</span>
01566 
01567                     } <span class="keywordflow">else</span> {
01568 
01569                         TempEntry = SharedCacheMap-&gt;BcbList.Blink;
01570 
01571                         <span class="comment">//</span>
01572                         <span class="comment">//  Loop through any/all Bcbs to insert the new listheads.</span>
01573                         <span class="comment">//</span>
01574 
01575                         <span class="keywordflow">while</span> (TempEntry != &amp;SharedCacheMap-&gt;BcbList) {
01576 
01577                             <span class="comment">//</span>
01578                             <span class="comment">//  Sit on this Bcb until we have inserted all listheads</span>
01579                             <span class="comment">//  that go before it.</span>
01580                             <span class="comment">//</span>
01581 
01582                             <span class="keywordflow">while</span> (<a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>.QuadPart &lt;= ((<a class="code" href="../../d4/d3/struct__BCB.html">PBCB</a>)CONTAINING_RECORD(TempEntry, <a class="code" href="../../d4/d3/struct__BCB.html">BCB</a>, BcbLinks))-&gt;FileOffset.QuadPart) {
01583 
01584                                 InsertHeadList(TempEntry, BcbListHeadNew);
01585                                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>.QuadPart += <a class="code" href="../../d5/d5/cc_8h.html#a47">SIZE_PER_BCB_LIST</a>;
01586                                 BcbListHeadNew += 1;
01587                             }
01588                             TempEntry = TempEntry-&gt;Blink;
01589                         }
01590                     }
01591 
01592                     <span class="comment">//</span>
01593                     <span class="comment">//  Now insert the rest of the new listhead entries that were</span>
01594                     <span class="comment">//  not finished in either loop above.</span>
01595                     <span class="comment">//</span>
01596 
01597                     <span class="keywordflow">while</span> (<a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>.QuadPart &lt; NextLevelSize.QuadPart) {
01598 
01599                         InsertHeadList(&amp;SharedCacheMap-&gt;BcbList, BcbListHeadNew);
01600                         <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>.QuadPart += <a class="code" href="../../d5/d5/cc_8h.html#a47">SIZE_PER_BCB_LIST</a>;
01601                         BcbListHeadNew += 1;
01602                     }
01603                 }
01604 
01605                 <span class="comment">//</span>
01606                 <span class="comment">//  These two fields must be changed while still holding the spinlock.</span>
01607                 <span class="comment">//</span>
01608 
01609                 SharedCacheMap-&gt;Vacbs = NewAddresses;
01610                 SharedCacheMap-&gt;SectionSize = NextLevelSize;
01611 
01612                 <span class="comment">//</span>
01613                 <span class="comment">//  Now we can free the spinlocks ahead of freeing pool.</span>
01614                 <span class="comment">//</span>
01615 
01616                 <span class="keywordflow">if</span> (GrowingBcbListHeads) {
01617                     <a class="code" href="../../d5/d5/cc_8h.html#a7">CcReleaseVacbLockFromDpcLevel</a>();
01618                     ExReleaseSpinLock( &amp;SharedCacheMap-&gt;BcbSpinLock, OldIrql );
01619                 } <span class="keywordflow">else</span> {
01620                     <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
01621                 }
01622 
01623                 <span class="keywordflow">if</span> ((OldAddresses != &amp;SharedCacheMap-&gt;InitialVacbs[0]) &amp;&amp;
01624                     (OldAddresses != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01625                     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( OldAddresses );
01626                 }
01627             }
01628 
01629             <span class="comment">//</span>
01630             <span class="comment">//  Make sure SectionSize gets updated.  It is ok to fall through here</span>
01631             <span class="comment">//  without a spinlock, so long as either Vacbs was not changed, or it</span>
01632             <span class="comment">//  was changed together with SectionSize under the spinlock(s) above.</span>
01633             <span class="comment">//</span>
01634 
01635             SharedCacheMap-&gt;SectionSize = NextLevelSize;
01636         }
01637 
01638         <span class="comment">//</span>
01639         <span class="comment">//  Handle extends up to and within multi-level Vacb arrays here.  This is fairly simple.</span>
01640         <span class="comment">//  If no additional Vacb levels are required, then there is no work to do, otherwise</span>
01641         <span class="comment">//  we just have to push the root one or more levels linked through the first pointer</span>
01642         <span class="comment">//  in the new root(s).</span>
01643         <span class="comment">//</span>
01644 
01645         <span class="keywordflow">if</span> (NewSectionSize.QuadPart &gt; SharedCacheMap-&gt;SectionSize.QuadPart) {
01646 
01647             <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *NextVacbArray;
01648             ULONG NewLevel;
01649             ULONG Level = 1;
01650             ULONG Shift = <a class="code" href="../../d4/d2/cache_8h.html#a1">VACB_OFFSET_SHIFT</a> + <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
01651 
01652             <span class="comment">//</span>
01653             <span class="comment">//  Loop to calculate how many levels we currently have.</span>
01654             <span class="comment">//</span>
01655 
01656             <span class="keywordflow">while</span> (SharedCacheMap-&gt;SectionSize.QuadPart &gt; ((LONGLONG)1 &lt;&lt; Shift)) {
01657 
01658                 Level += 1;
01659                 Shift += <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
01660             }
01661 
01662             NewLevel = Level;
01663 
01664             <span class="comment">//</span>
01665             <span class="comment">//  Loop to calculate how many levels we need.</span>
01666             <span class="comment">//</span>
01667 
01668             <span class="keywordflow">while</span> (((NewSectionSize.QuadPart - 1) &gt;&gt; Shift) != 0) {
01669 
01670                 NewLevel += 1;
01671                 Shift += <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
01672             }
01673 
01674             <span class="comment">//</span>
01675             <span class="comment">//  Now see if we have any work to do.</span>
01676             <span class="comment">//</span>
01677 
01678             <span class="keywordflow">if</span> (NewLevel &gt; Level) {
01679 
01680                 <span class="comment">//</span>
01681                 <span class="comment">//  Remember the maximum level ever seen (which is actually NewLevel + 1).</span>
01682                 <span class="comment">//</span>
01683 
01684                 <span class="keywordflow">if</span> (NewLevel &gt;= <a class="code" href="../../d5/d2/cachedat_8c.html#a23">CcMaxVacbLevelsSeen</a>) {
01685                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(NewLevel &lt;= VACB_NUMBER_OF_LEVELS);
01686                     <a class="code" href="../../d5/d2/cachedat_8c.html#a23">CcMaxVacbLevelsSeen</a> = NewLevel + 1;
01687                 }
01688 
01689                 <span class="comment">//</span>
01690                 <span class="comment">//  Raise if we cannot preallocate enough buffers.</span>
01691                 <span class="comment">//</span>
01692 
01693                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d3/vacbsup_8c.html#a23">CcPrefillVacbLevelZone</a>( NewLevel - Level, &amp;OldIrql, FALSE )) {
01694 
01695                     <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>( STATUS_INSUFFICIENT_RESOURCES );
01696                 }
01697 
01698                 <span class="comment">//</span>
01699                 <span class="comment">//  Now if the current Level of the file is 1, we have not been maintaining</span>
01700                 <span class="comment">//  a reference count, so we have to calculate it before pushing.  In the</span>
01701                 <span class="comment">//  boundary case we have made sure that the reference space is avaliable.</span>
01702                 <span class="comment">//</span>
01703 
01704                 <span class="keywordflow">if</span> (Level == 1) {
01705 
01706                     <span class="comment">//</span>
01707                     <span class="comment">//  We know this is always a leaf-like level right now.</span>
01708                     <span class="comment">//</span>
01709 
01710                     <a class="code" href="../../d5/d3/vacbsup_8c.html#a8">CcCalculateVacbLevelLockCount</a>( SharedCacheMap, SharedCacheMap-&gt;Vacbs, 0 );
01711                 }
01712 
01713                 <span class="comment">//</span>
01714                 <span class="comment">//  Finally, if there are any active pointers in the first level, then we</span>
01715                 <span class="comment">//  have to create new levels by adding a new root enough times to create</span>
01716                 <span class="comment">//  additional levels.  On the other hand, if the pointer count in the top</span>
01717                 <span class="comment">//  level is zero, then we must not do any pushes, because we never allow</span>
01718                 <span class="comment">//  empty leaves!</span>
01719                 <span class="comment">//</span>
01720 
01721                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a209">IsVacbLevelReferenced</a>( SharedCacheMap, SharedCacheMap-&gt;Vacbs, Level - 1 )) {
01722 
01723                     <span class="keywordflow">while</span> (NewLevel &gt; Level++) {
01724 
01725                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(CcVacbLevelEntries != 0);
01726                         NextVacbArray = <a class="code" href="../../d5/d5/cc_8h.html#a206">CcAllocateVacbLevel</a>(FALSE);
01727 
01728                         NextVacbArray[0] = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>)SharedCacheMap-&gt;Vacbs;
01729                         <a class="code" href="../../d5/d3/vacbsup_8c.html#a12">ReferenceVacbLevel</a>( SharedCacheMap, NextVacbArray, Level, 1, FALSE );
01730 
01731                         SharedCacheMap-&gt;Vacbs = NextVacbArray;
01732                     }
01733 
01734                 } <span class="keywordflow">else</span> {
01735 
01736                     <span class="comment">//</span>
01737                     <span class="comment">//  We are now possesed of the additional problem that this level has no</span>
01738                     <span class="comment">//  references but may have Bcb listheads due to the boundary case where</span>
01739                     <span class="comment">//  we have expanded up to the multilevel Vacbs above.  This level can't</span>
01740                     <span class="comment">//  remain at the root and needs to be destroyed.  What we need to do is</span>
01741                     <span class="comment">//  replace it with one of our prefilled (non Bcb) levels and unlink the</span>
01742                     <span class="comment">//  Bcb listheads in the old one.</span>
01743                     <span class="comment">//</span>
01744 
01745                     <span class="keywordflow">if</span> (Level == 1 &amp;&amp; <a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;Flags, MODIFIED_WRITE_DISABLED)) {
01746 
01747                         PLIST_ENTRY PredecessorListHead, SuccessorListHead;
01748 
01749                         NextVacbArray = SharedCacheMap-&gt;Vacbs;
01750                         SharedCacheMap-&gt;Vacbs = <a class="code" href="../../d5/d5/cc_8h.html#a206">CcAllocateVacbLevel</a>(FALSE);
01751 
01752                         PredecessorListHead = ((PLIST_ENTRY)((PCHAR)NextVacbArray + <a class="code" href="../../d5/d5/cc_8h.html#a39">VACB_LEVEL_BLOCK_SIZE</a>))-&gt;Flink;
01753                         SuccessorListHead = ((PLIST_ENTRY)((PCHAR)NextVacbArray + (<a class="code" href="../../d5/d5/cc_8h.html#a39">VACB_LEVEL_BLOCK_SIZE</a> * 2) - <span class="keyword">sizeof</span>(LIST_ENTRY)))-&gt;Blink;
01754                         PredecessorListHead-&gt;Blink = SuccessorListHead;
01755                         SuccessorListHead-&gt;Flink = PredecessorListHead;
01756 
01757                         <a class="code" href="../../d5/d5/cc_8h.html#a207">CcDeallocateVacbLevel</a>( NextVacbArray, TRUE );
01758                     }
01759                 }
01760 
01761                 <span class="comment">//</span>
01762                 <span class="comment">//  These two fields (Vacbs and SectionSize) must be changed while still</span>
01763                 <span class="comment">//  holding the spinlock.</span>
01764                 <span class="comment">//</span>
01765 
01766                 SharedCacheMap-&gt;SectionSize = NewSectionSize;
01767                 <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
01768             }
01769 
01770             <span class="comment">//</span>
01771             <span class="comment">//  Make sure SectionSize gets updated.  It is ok to fall through here</span>
01772             <span class="comment">//  without a spinlock, so long as either Vacbs was not changed, or it</span>
01773             <span class="comment">//  was changed together with SectionSize under the spinlock(s) above.</span>
01774             <span class="comment">//</span>
01775 
01776             SharedCacheMap-&gt;SectionSize = NewSectionSize;
01777         }
01778     }
01779 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a182" doxytag="cc.h::CcFreeActiveVacb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcFreeActiveVacb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> ActiveVacb&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ActivePage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PageIsDirty</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">5885</a> of file <a class="el" href="../../d7/d1/cachesub_8c-source.html">cachesub.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l01065">ACTIVE_PAGE_IS_DIRTY</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00064">CcAcquireMasterLock</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00862">CcFreeVirtualAddress()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00067">CcReleaseMasterLock</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00103">CcTotalDirtyPages</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00509">ClearFlag</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l01833">MmUnlockCachedPage()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00600">PAGE_SHIFT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, and <a class="el" href="../../d5/d1/cache_8h-source.html#l00030">VACB_MAPPING_GRANULARITY</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l00031">CcCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l00588">CcFastCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01482">CcFastCopyWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00030">CcMdlRead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02804">CcZeroEndOfLastPage()</a>.
<p>
<pre class="fragment"><div>05894                    :
05895 
05896     This routine may be called to zero <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> end of a locked page or
05897     free <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ActiveVacb <span class="keywordflow">for</span> a Shared Cache Map, <span class="keywordflow">if</span> there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> one.
05898     Note that some callers are not <span class="keyword">synchronized</span> with foreground
05899     activity, and may therefore not have an ActiveVacb.  Examples
05900     of unsynchronized callers are <a class="code" href="../../d4/d2/cache_8h.html#a65">CcZeroEndOfLastPage</a> (which is
05901     called by MM) and any flushing done by <a class="code" href="../../d6/d2/cachesub_8c.html#a19">CcWriteBehind</a>.
05902 
05903 Arguments:
05904 
05905     SharedCacheMap - SharedCacheMap to examine <span class="keywordflow">for</span> page to be zeroed.
05906 
05907     ActiveVacb - Vacb to free
05908 
05909     ActivePage - Page that was used
05910 
05911     PageIsDirty - <a class="code" href="../../d5/d5/cc_8h.html#a76">ACTIVE_PAGE_IS_DIRTY</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> active page <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> dirty
05912 
05913 Return Value:
05914 
05915     None
05916 
05917 --*/
05918 
05919 {
05920     LARGE_INTEGER ActiveOffset;
05921     PVOID ActiveAddress;
05922     ULONG BytesLeftInPage;
05923     KIRQL OldIrql;
05924 
05925     <span class="comment">//</span>
05926     <span class="comment">//  If the page was locked, then unlock it.</span>
05927     <span class="comment">//</span>
05928 
05929     <span class="keywordflow">if</span> (SharedCacheMap-&gt;NeedToZero != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05930 
05931         <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> NeedToZeroVacb;
05932 
05933         <span class="comment">//</span>
05934         <span class="comment">//  Zero the rest of the page under spinlock control,</span>
05935         <span class="comment">//  and then clear the address field.  This field makes</span>
05936         <span class="comment">//  zero-&gt;nonzero transitions only when the file is exclusive,</span>
05937         <span class="comment">//  but it can make nonzero-&gt;zero transitions any time the</span>
05938         <span class="comment">//  spinlock is not held.</span>
05939         <span class="comment">//</span>
05940 
05941         ExAcquireFastLock( &amp;SharedCacheMap-&gt;ActiveVacbSpinLock, &amp;OldIrql );
05942 
05943         <span class="comment">//</span>
05944         <span class="comment">//  The address could already be gone.</span>
05945         <span class="comment">//</span>
05946 
05947         ActiveAddress = SharedCacheMap-&gt;NeedToZero;
05948         <span class="keywordflow">if</span> (ActiveAddress != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05949 
05950             BytesLeftInPage = <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - ((((ULONG)((ULONG_PTR)ActiveAddress) - 1) &amp; (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1)) + 1);
05951 
05952             RtlZeroBytes( ActiveAddress, BytesLeftInPage );
05953             SharedCacheMap-&gt;NeedToZero = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
05954             NeedToZeroVacb = SharedCacheMap-&gt;NeedToZeroVacb;
05955         }
05956         ExReleaseFastLock( &amp;SharedCacheMap-&gt;ActiveVacbSpinLock, OldIrql );
05957 
05958         <span class="comment">//</span>
05959         <span class="comment">//  Now call MM to unlock the address.  Note we will never store the</span>
05960         <span class="comment">//  address at the start of the page, but we can sometimes store</span>
05961         <span class="comment">//  the start of the next page when we have exactly filled the page.</span>
05962         <span class="comment">//</span>
05963 
05964         <span class="keywordflow">if</span> (ActiveAddress != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05965             <a class="code" href="../../d1/d5/mapcache_8c.html#a15">MmUnlockCachedPage</a>( (PVOID)((PCHAR)ActiveAddress - 1) );
05966             <a class="code" href="../../d5/d3/vacbsup_8c.html#a16">CcFreeVirtualAddress</a>( NeedToZeroVacb );
05967         }
05968     }
05969 
05970     <span class="comment">//</span>
05971     <span class="comment">//  See if caller actually has an ActiveVacb</span>
05972     <span class="comment">//</span>
05973 
05974     <span class="keywordflow">if</span> (ActiveVacb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05975 
05976         <span class="comment">//</span>
05977         <span class="comment">//  See if the page is dirty</span>
05978         <span class="comment">//</span>
05979 
05980         <span class="keywordflow">if</span> (PageIsDirty) {
05981 
05982             ActiveOffset.QuadPart = (LONGLONG)ActivePage &lt;&lt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>;
05983             ActiveAddress = (PVOID)((PCHAR)ActiveVacb-&gt;BaseAddress +
05984                                     (ActiveOffset.LowPart  &amp; (<a class="code" href="../../d4/d2/cache_8h.html#a0">VACB_MAPPING_GRANULARITY</a> - 1)));
05985 
05986             <span class="comment">//</span>
05987             <span class="comment">//  Tell the Lazy Writer to write the page.</span>
05988             <span class="comment">//</span>
05989 
05990             <a class="code" href="../../d5/d5/cc_8h.html#a179">CcSetDirtyInMask</a>( SharedCacheMap, &amp;ActiveOffset, PAGE_SIZE );
05991 
05992             <span class="comment">//</span>
05993             <span class="comment">//  Now we need to clear the flag and decrement some counts if there is</span>
05994             <span class="comment">//  no other active Vacb which snuck in.</span>
05995             <span class="comment">//</span>
05996 
05997             <a class="code" href="../../d5/d5/cc_8h.html#a0">CcAcquireMasterLock</a>( &amp;OldIrql );
05998             ExAcquireSpinLockAtDpcLevel( &amp;SharedCacheMap-&gt;ActiveVacbSpinLock );
05999             <span class="keywordflow">if</span> ((SharedCacheMap-&gt;ActiveVacb == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
06000                 <a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;Flags, ACTIVE_PAGE_IS_DIRTY)) {
06001 
06002                 <a class="code" href="../../d5/d5/cc_8h.html#a61">ClearFlag</a>(SharedCacheMap-&gt;Flags, ACTIVE_PAGE_IS_DIRTY);
06003                 SharedCacheMap-&gt;DirtyPages -= 1;
06004                 <a class="code" href="../../d5/d2/cachedat_8c.html#a36">CcTotalDirtyPages</a> -= 1;
06005             }
06006             ExReleaseSpinLockFromDpcLevel( &amp;SharedCacheMap-&gt;ActiveVacbSpinLock );
06007             <a class="code" href="../../d5/d5/cc_8h.html#a1">CcReleaseMasterLock</a>( OldIrql );
06008         }
06009 
06010         <span class="comment">//</span>
06011         <span class="comment">//  Now free the Vacb.</span>
06012         <span class="comment">//</span>
06013 
06014         <a class="code" href="../../d5/d3/vacbsup_8c.html#a16">CcFreeVirtualAddress</a>( ActiveVacb );
06015     }
06016 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a195" doxytag="cc.h::CcFreeVirtualAddress" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL CcFreeVirtualAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Vacb</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00862">862</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00076">CcAcquireVacbLock</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00163">CcMoveVacbToReuseHead</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00166">CcMoveVacbToReuseTail</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00079">CcReleaseVacbLock</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00181">CheckedDec</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00817">_SHARED_CACHE_MAP::VacbActiveCount</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l00877">_SHARED_CACHE_MAP::WaitOnActiveCount</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l00031">CcCopyRead()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l00588">CcFastCopyRead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">CcFreeActiveVacb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00030">CcMdlRead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00271">CcPinMappedData()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02194">CcPurgeAndClearCacheSection()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.
<p>
<pre class="fragment"><div>00868                    :
00869 
00870     This routine must be called once <span class="keywordflow">for</span> each call to <a class="code" href="../../d5/d5/cc_8h.html#a194">CcGetVirtualAddress</a>
00871     to free that <span class="keyword">virtual</span> address.
00872 
00873 Arguments:
00874 
00875     Vacb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vacb which was returned from <a class="code" href="../../d5/d5/cc_8h.html#a194">CcGetVirtualAddress</a>.
00876 
00877 Return Value:
00878 
00879     None.
00880 
00881 --*/
00882 
00883 {
00884     KIRQL OldIrql;
00885     <a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap = Vacb-&gt;SharedCacheMap;
00886 
00887     <a class="code" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>( &amp;OldIrql );
00888 
00889     <a class="code" href="../../d5/d3/vacbsup_8c.html#a5">CheckedDec</a>(Vacb-&gt;Overlay.ActiveCount);
00890 
00891     <span class="comment">//</span>
00892     <span class="comment">//  If the count goes to zero, then we want to decrement the global</span>
00893     <span class="comment">//  Active count.</span>
00894     <span class="comment">//</span>
00895 
00896     <span class="keywordflow">if</span> (Vacb-&gt;Overlay.ActiveCount == 0) {
00897 
00898         <span class="comment">//</span>
00899         <span class="comment">//  If the SharedCacheMap address is not NULL, then this one is</span>
00900         <span class="comment">//  in use by a shared cache map, and we have to decrement his</span>
00901         <span class="comment">//  count and see if anyone is waiting.</span>
00902         <span class="comment">//</span>
00903 
00904         <span class="keywordflow">if</span> (SharedCacheMap != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00905 
00906             <a class="code" href="../../d5/d3/vacbsup_8c.html#a5">CheckedDec</a>(SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o16">VacbActiveCount</a>);
00907 
00908             <span class="comment">//</span>
00909             <span class="comment">//  If there is someone waiting for this count to go to zero,</span>
00910             <span class="comment">//  wake them here.</span>
00911             <span class="comment">//</span>
00912 
00913             <span class="keywordflow">if</span> (SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o24">WaitOnActiveCount</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00914                 <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>( SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o24">WaitOnActiveCount</a>, 0, FALSE );
00915             }
00916 
00917             <span class="comment">//</span>
00918             <span class="comment">//  Go to the back of the LRU to save this range for a bit</span>
00919             <span class="comment">//</span>
00920 
00921             <a class="code" href="../../d5/d3/vacbsup_8c.html#a3">CcMoveVacbToReuseTail</a>( Vacb );
00922 
00923         } <span class="keywordflow">else</span> {
00924 
00925             <span class="comment">//</span>
00926             <span class="comment">//  This range is no longer referenced, so make it avaliable</span>
00927             <span class="comment">//</span>
00928 
00929             <a class="code" href="../../d5/d3/vacbsup_8c.html#a2">CcMoveVacbToReuseHead</a>( Vacb );
00930         }
00931 
00932     } <span class="keywordflow">else</span> {
00933 
00934         <span class="comment">//</span>
00935         <span class="comment">//  This range is still in use, so move it away from the front</span>
00936         <span class="comment">//  so that it doesn't consume cycles being checked.</span>
00937         <span class="comment">//</span>
00938 
00939         <a class="code" href="../../d5/d3/vacbsup_8c.html#a3">CcMoveVacbToReuseTail</a>( Vacb );
00940     }
00941 
00942     <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
00943 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a203" doxytag="cc.h::CcGetBcbListHeadLargeOffset" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PLIST_ENTRY CcGetBcbListHeadLargeOffset           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FileOffset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>FailToSuccessor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02107">2107</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00321">VACB_LAST_INDEX_FOR_LEVEL</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00315">VACB_LEVEL_BLOCK_SIZE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00307">VACB_LEVEL_SHIFT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00334">VACB_NUMBER_OF_LEVELS</a>, <a class="el" href="../../d5/d1/cache_8h-source.html#l00031">VACB_OFFSET_SHIFT</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l00327">VACB_SIZE_OF_FIRST_LEVEL</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>.
<p>
<pre class="fragment"><div>02115                    :
02116 
02117     This routine may be called to <span class="keywordflow">return</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Bcb listhead <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified FileOffset.
02118     It should <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be called <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SectionSize <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> greater than <a class="code" href="../../d5/d5/cc_8h.html#a41">VACB_SIZE_OF_FIRST_LEVEL</a>.
02119 
02120 Arguments:
02121 
02122     SharedCacheMap - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SharedCacheMap <span class="keywordflow">for</span> which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> listhead
02123                      <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> desired.
02124 
02125     FileOffset - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> fileOffset corresponding to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired listhead.
02126 
02127     FailToSuccessor - Instructs whether not finding <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exact listhead should cause us to
02128         <span class="keywordflow">return</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> predecessor or successor Bcb listhead.
02129 
02130 Return Value:
02131 
02132     Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired Listhead pointer.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired listhead does not actually exist
02133     yet, then <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate listhead.
02134 
02135 Environment:
02136 
02137     The BcbSpinlock should be held on entry.
02138 
02139 --*/
02140 
02141 {
02142     ULONG Level, Shift;
02143     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *VacbArray, *NextVacbArray;
02144     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
02145     ULONG SavedIndexes[<a class="code" href="../../d5/d5/cc_8h.html#a42">VACB_NUMBER_OF_LEVELS</a>];
02146     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *SavedVacbArrays[<a class="code" href="../../d5/d5/cc_8h.html#a42">VACB_NUMBER_OF_LEVELS</a>];
02147     ULONG SavedLevels = 0;
02148 
02149     <span class="comment">//</span>
02150     <span class="comment">//  Initialize variables controlling our descent into the hierarchy.</span>
02151     <span class="comment">//</span>
02152 
02153     Level = 0;
02154     Shift = <a class="code" href="../../d4/d2/cache_8h.html#a1">VACB_OFFSET_SHIFT</a> + <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
02155     VacbArray = SharedCacheMap-&gt;Vacbs;
02156 
02157     <span class="comment">//</span>
02158     <span class="comment">//  Caller must have verified that we have a hierarchy, otherwise this routine</span>
02159     <span class="comment">//  would fail.</span>
02160     <span class="comment">//</span>
02161 
02162     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(SharedCacheMap-&gt;SectionSize.QuadPart &gt; VACB_SIZE_OF_FIRST_LEVEL);
02163 
02164     <span class="comment">//</span>
02165     <span class="comment">//  Loop to calculate how many levels we have and how much we have to</span>
02166     <span class="comment">//  shift to index into the first level.</span>
02167     <span class="comment">//</span>
02168 
02169     <span class="keywordflow">do</span> {
02170 
02171         Level += 1;
02172         Shift += <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
02173 
02174     } <span class="keywordflow">while</span> (SharedCacheMap-&gt;SectionSize.QuadPart &gt; ((LONGLONG)1 &lt;&lt; Shift));
02175 
02176     <span class="comment">//</span>
02177     <span class="comment">//  Our caller could be asking for an offset off the end of section size, so if he</span>
02178     <span class="comment">//  is actually off the size of the level, then return the main listhead.</span>
02179     <span class="comment">//</span>
02180 
02181     <span class="keywordflow">if</span> (FileOffset &gt;= ((LONGLONG)1 &lt;&lt; Shift)) {
02182         <span class="keywordflow">return</span> &amp;SharedCacheMap-&gt;BcbList;
02183     }
02184 
02185     <span class="comment">//</span>
02186     <span class="comment">//  Now descend the tree to the bottom level to get the caller's Bcb ListHead.</span>
02187     <span class="comment">//</span>
02188 
02189     Shift -= <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
02190     <span class="keywordflow">do</span> {
02191 
02192         <span class="comment">//</span>
02193         <span class="comment">//  Decrement back to the level that describes the size we are within.</span>
02194         <span class="comment">//</span>
02195 
02196         Level -= 1;
02197 
02198         <span class="comment">//</span>
02199         <span class="comment">//  Calculate the index into the Vacb block for this level.</span>
02200         <span class="comment">//</span>
02201 
02202         <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = (ULONG)(FileOffset &gt;&gt; Shift);
02203         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Index &lt;= VACB_LAST_INDEX_FOR_LEVEL);
02204 
02205         <span class="comment">//</span>
02206         <span class="comment">//  Get block address for next level.</span>
02207         <span class="comment">//</span>
02208 
02209         NextVacbArray = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *)VacbArray[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
02210 
02211         <span class="comment">//</span>
02212         <span class="comment">//  If it is NULL then we have to go find the highest Bcb or listhead which</span>
02213         <span class="comment">//  comes before the guy we are looking for, i.e., its predecessor.</span>
02214         <span class="comment">//</span>
02215 
02216         <span class="keywordflow">if</span> (NextVacbArray == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02217 
02218             <span class="comment">//</span>
02219             <span class="comment">//  Back up to look for the highest guy earlier in this tree, i.e., the</span>
02220             <span class="comment">//  predecessor listhead.</span>
02221             <span class="comment">//</span>
02222 
02223             <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02224 
02225                 <span class="comment">//</span>
02226                 <span class="comment">//  Scan, if we can, in the current array for a non-null index.</span>
02227                 <span class="comment">//</span>
02228 
02229                 <span class="keywordflow">if</span> (FailToSuccessor) {
02230 
02231                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> != <a class="code" href="../../d5/d5/cc_8h.html#a40">VACB_LAST_INDEX_FOR_LEVEL</a>) {
02232 
02233                         <span class="keywordflow">while</span> ((<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> != <a class="code" href="../../d5/d5/cc_8h.html#a40">VACB_LAST_INDEX_FOR_LEVEL</a>) &amp;&amp; (VacbArray[++<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
02234                             <span class="keywordflow">continue</span>;
02235                         }
02236 
02237                         <span class="comment">//</span>
02238                         <span class="comment">//  If we found a non-null index, get out and try to return the</span>
02239                         <span class="comment">//  listhead.</span>
02240                         <span class="comment">//</span>
02241 
02242                         <span class="keywordflow">if</span> ((NextVacbArray = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *)VacbArray[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>]) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02243                             <span class="keywordflow">break</span>;
02244                         }
02245                     }
02246 
02247                 } <span class="keywordflow">else</span> {
02248 
02249                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> != 0) {
02250 
02251                         <span class="keywordflow">while</span> ((<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> != 0) &amp;&amp; (VacbArray[--<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
02252                             <span class="keywordflow">continue</span>;
02253                         }
02254 
02255                         <span class="comment">//</span>
02256                         <span class="comment">//  If we found a non-null index, get out and try to return the</span>
02257                         <span class="comment">//  listhead.</span>
02258                         <span class="comment">//</span>
02259 
02260                         <span class="keywordflow">if</span> ((NextVacbArray = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *)VacbArray[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>]) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02261                             <span class="keywordflow">break</span>;
02262                         }
02263                     }
02264                 }
02265 
02266                 <span class="comment">//</span>
02267                 <span class="comment">//  If there are no saved levels yet, then there is no predecessor or</span>
02268                 <span class="comment">//  successor - it is the main listhead.</span>
02269                 <span class="comment">//</span>
02270 
02271                 <span class="keywordflow">if</span> (SavedLevels == 0) {
02272                     <span class="keywordflow">return</span> &amp;SharedCacheMap-&gt;BcbList;
02273                 }
02274 
02275                 <span class="comment">//</span>
02276                 <span class="comment">//  Otherwise, we can pop up a level in the tree and start scanning</span>
02277                 <span class="comment">//  from that guy for a path to the right listhead.</span>
02278                 <span class="comment">//</span>
02279 
02280                 Level += 1;
02281                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = SavedIndexes[--SavedLevels];
02282                 VacbArray = SavedVacbArrays[SavedLevels];
02283             }
02284 
02285             <span class="comment">//</span>
02286             <span class="comment">//  We have backed up in the hierarchy, so now we are just looking for the</span>
02287             <span class="comment">//  highest/lowest guy in the level we want, i.e., the level-linking listhead.</span>
02288             <span class="comment">//  So smash FileOffset accordingly (we mask the high bits out anyway).</span>
02289             <span class="comment">//</span>
02290 
02291             <span class="keywordflow">if</span> (FailToSuccessor) {
02292                 FileOffset = 0;
02293             } <span class="keywordflow">else</span> {
02294                 FileOffset = MAXLONGLONG;
02295             }
02296         }
02297 
02298         <span class="comment">//</span>
02299         <span class="comment">//  We save Index and VacbArray at each level, for the case that we</span>
02300         <span class="comment">//  have to walk back up the tree to find a predecessor.</span>
02301         <span class="comment">//</span>
02302 
02303         SavedIndexes[SavedLevels] = <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
02304         SavedVacbArrays[SavedLevels] = VacbArray;
02305         SavedLevels += 1;
02306 
02307         <span class="comment">//</span>
02308         <span class="comment">//  Now make this one our current pointer, and mask away the extraneous high-order</span>
02309         <span class="comment">//  FileOffset bits for this level.</span>
02310         <span class="comment">//</span>
02311 
02312         VacbArray = NextVacbArray;
02313         FileOffset &amp;= ((LONGLONG)1 &lt;&lt; Shift) - 1;
02314         Shift -= <a class="code" href="../../d5/d5/cc_8h.html#a38">VACB_LEVEL_SHIFT</a>;
02315 
02316     <span class="comment">//</span>
02317     <span class="comment">//  Loop until we hit the bottom level.</span>
02318     <span class="comment">//</span>
02319 
02320     } <span class="keywordflow">while</span> (Level != 0);
02321 
02322     <span class="comment">//</span>
02323     <span class="comment">//  Now calculate the index for the bottom level and return the appropriate listhead.</span>
02324     <span class="comment">//  (The normal Vacb index indexes to a pointer to a Vacb for a .25MB view, so dropping</span>
02325     <span class="comment">//  the low bit gets you to the even-indexed Vacb pointer which is one block size below</span>
02326     <span class="comment">//  the two-pointer listhead for the Bcbs for that .5MB range...)</span>
02327     <span class="comment">//</span>
02328 
02329     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = (ULONG)(FileOffset &gt;&gt; Shift);
02330     <span class="keywordflow">return</span> (PLIST_ENTRY)((PCHAR)&amp;VacbArray[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &amp; ~1] + <a class="code" href="../../d5/d5/cc_8h.html#a39">VACB_LEVEL_BLOCK_SIZE</a>);
02331 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a194" doxytag="cc.h::CcGetVirtualAddress" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID CcGetVirtualAddress           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>FileOffset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Vacb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ReceivedLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a193" doxytag="cc.h::CcGetVirtualAddressIfMapped" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID CcGetVirtualAddressIfMapped           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FileOffset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Vacb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ReceivedLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00230">230</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00076">CcAcquireVacbLock</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00166">CcMoveVacbToReuseTail</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00079">CcReleaseVacbLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00078">GetVacb</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d1/cache_8h-source.html#l00030">VACB_MAPPING_GRANULARITY</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>.
<p>
<pre class="fragment"><div>00239                    :
00240 
00241     This routine returns a <span class="keyword">virtual</span> address <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified FileOffset,
00242     iff <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> mapped.  Otherwise, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> informs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00243     <span class="keyword">virtual</span> address was not mapped.  In <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> latter <span class="keywordflow">case</span>, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> still returns
00244     a ReceivedLength, which may be used to advance to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next view boundary.
00245 
00246 Arguments:
00247 
00248     SharedCacheMap - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Shared Cache Map <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00249 
00250     FileOffset - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired FileOffset within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00251 
00252     Vach - Returns a Vacb pointer which must be supplied later to free
00253            <span class="keyword">this</span> <span class="keyword">virtual</span> address, or <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <span class="keywordflow">if</span> not mapped.
00254 
00255     ReceivedLength - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next view boundary,
00256                      whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> offset <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> mapped or not.
00257 
00258 Return Value:
00259 
00260     The <span class="keyword">virtual</span> address at which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired data <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> mapped, or <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>
00261     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not mapped.
00262 
00263 --*/
00264 
00265 {
00266     KIRQL OldIrql;
00267     ULONG VacbOffset = (ULONG)FileOffset &amp; (<a class="code" href="../../d4/d2/cache_8h.html#a0">VACB_MAPPING_GRANULARITY</a> - 1);
00268     PVOID Value = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00269 
00270     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt; DISPATCH_LEVEL);
00271 
00272     <span class="comment">//</span>
00273     <span class="comment">//  Generate ReceivedLength return right away.</span>
00274     <span class="comment">//</span>
00275 
00276     *ReceivedLength = <a class="code" href="../../d4/d2/cache_8h.html#a0">VACB_MAPPING_GRANULARITY</a> - VacbOffset;
00277 
00278     <span class="comment">//</span>
00279     <span class="comment">//  Acquire the Vacb lock to see if the desired offset is already mapped.</span>
00280     <span class="comment">//</span>
00281 
00282     <a class="code" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>( &amp;OldIrql );
00283 
00284     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( FileOffset &lt;= SharedCacheMap-&gt;SectionSize.QuadPart );
00285 
00286     <span class="keywordflow">if</span> ((*Vacb = <a class="code" href="../../d5/d3/vacbsup_8c.html#a1">GetVacb</a>( SharedCacheMap, *(PLARGE_INTEGER)&amp;FileOffset )) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00287 
00288         <span class="keywordflow">if</span> ((*Vacb)-&gt;Overlay.ActiveCount == 0) {
00289             SharedCacheMap-&gt;VacbActiveCount += 1;
00290         }
00291 
00292         (*Vacb)-&gt;Overlay.ActiveCount += 1;
00293 
00294         <span class="comment">//</span>
00295         <span class="comment">//  Move this range away from the front to avoid wasting cycles</span>
00296         <span class="comment">//  looking at it for reuse.</span>
00297         <span class="comment">//</span>
00298 
00299         <a class="code" href="../../d5/d3/vacbsup_8c.html#a3">CcMoveVacbToReuseTail</a>( *Vacb );
00300 
00301         Value = (PVOID)((PCHAR)(*Vacb)-&gt;BaseAddress + VacbOffset);
00302     }
00303 
00304     <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
00305     <span class="keywordflow">return</span> Value;
00306 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a192" doxytag="cc.h::CcInitializeVacbs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcInitializeVacbs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00188">188</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00083">CcBeyondVacbs</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00076">CcNumberVacbs</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00084">CcVacbLru</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00082">CcVacbs</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00075">CcVacbSpinLock</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l01101">FsRtlAllocatePoolWithTag</a>, <a class="el" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00619">_VACB::LruList</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l00406">MmSizeOfSystemCacheInPages</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00600">PAGE_SHIFT</a>, <a class="el" href="../../d5/d5/cc_8h.html#a97">VACB</a>, and <a class="el" href="../../d5/d1/cache_8h-source.html#l00031">VACB_OFFSET_SHIFT</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>.
<p>
<pre class="fragment"><div>00193                    :
00194 
00195     This routine must be called during Cache <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a79">Manager</a> initialization to
00196     initialize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a2">Virtual</a> Address Control Block structures.
00197 
00198 Arguments:
00199 
00200     None.
00201 
00202 Return Value:
00203 
00204     None.
00205 
00206 --*/
00207 
00208 {
00209     ULONG VacbBytes;
00210     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> NextVacb;
00211 
00212     <a class="code" href="../../d5/d2/cachedat_8c.html#a19">CcNumberVacbs</a> = (<a class="code" href="../../d2/d1/mm_8h.html#a137">MmSizeOfSystemCacheInPages</a> &gt;&gt; (<a class="code" href="../../d4/d2/cache_8h.html#a1">VACB_OFFSET_SHIFT</a> - <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>)) - 2;
00213     VacbBytes = <a class="code" href="../../d5/d2/cachedat_8c.html#a19">CcNumberVacbs</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d5/struct__VACB.html">VACB</a>);
00214 
00215     <a class="code" href="../../d4/d9/ke_8h.html#a354">KeInitializeSpinLock</a>( &amp;CcVacbSpinLock );
00216     <a class="code" href="../../d5/d2/cachedat_8c.html#a20">CcVacbs</a> = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>)<a class="code" href="../../d1/d8/fsrtl_8h.html#a37">FsRtlAllocatePoolWithTag</a>( NonPagedPool, VacbBytes, 'aVcC' );
00217     <a class="code" href="../../d5/d2/cachedat_8c.html#a21">CcBeyondVacbs</a> = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>)((PCHAR)<a class="code" href="../../d5/d2/cachedat_8c.html#a20">CcVacbs</a> + VacbBytes);
00218     RtlZeroMemory( CcVacbs, VacbBytes );
00219 
00220     InitializeListHead( &amp;CcVacbLru );
00221 
00222     <span class="keywordflow">for</span> (NextVacb = <a class="code" href="../../d5/d2/cachedat_8c.html#a20">CcVacbs</a>; NextVacb &lt; <a class="code" href="../../d5/d2/cachedat_8c.html#a21">CcBeyondVacbs</a>; NextVacb++) {
00223 
00224         InsertTailList( &amp;CcVacbLru, &amp;NextVacb-&gt;<a class="code" href="../../d2/d5/struct__VACB.html#o5">LruList</a> );
00225     }
00226 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a183" doxytag="cc.h::CcMapAndCopy" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcMapAndCopy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>UserBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>FileOffset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ZeroFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WriteThrough</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">6024</a> of file <a class="el" href="../../d7/d1/cachesub_8c-source.html">cachesub.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l01065">ACTIVE_PAGE_IS_DIRTY</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00583">_VACB::BaseAddress</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00076">CcAcquireVacbLock</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01747">CcCopyReadExceptionFilter()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">CcFreeActiveVacb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00862">CcFreeVirtualAddress()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00310">CcGetVirtualAddress()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00041">CcMaxDirtyWrite</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00079">CcReleaseVacbLock</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02292">DebugTrace2</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d8/d2/fsrtl_2filter_8c-source.html#l00049">FsRtlNormalizeNtstatus()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00033">me</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l01274">MmCopyToCachedPage()</a>, <a class="el" href="../../d7/d4/flushsec_8c-source.html#l00668">MmFlushSection()</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l01053">MmResetPageFaultReadAhead</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l00983">MmSavePageFaultReadAhead</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l05920">MmSetAddressRangeModified()</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l01018">MmSetPageFaultReadAhead</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d5/struct__VACB.html#o4">_VACB::Overlay</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00600">PAGE_SHIFT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01619">SetActiveVacb</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02154">try_return</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01798">ZERO_FIRST_PAGE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01800">ZERO_LAST_PAGE</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l01799">ZERO_MIDDLE_PAGES</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, and <a class="el" href="../../d6/d6/copysup_8c-source.html#l01482">CcFastCopyWrite()</a>.
<p>
<pre class="fragment"><div>06035                    :
06036 
06037     This routine may be called to copy <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified user data to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
06038     cache via a special Mm routine which copies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data to uninitialized
06039     pages and returns.
06040 
06041 Arguments:
06042 
06043     SharedCacheMap - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SharedCacheMap <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
06044                      data.
06045 
06046     UserBuffer - unsafe buffer supplying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user's data to be written
06047 
06048     FileOffset - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> offset to be modified
06049 
06050     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> total amount of data
06051 
06052     ZeroFlags - Defines which pages may be zeroed <span class="keywordflow">if</span> not resident.
06053 
06054     WriteThrough - Supplies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be written through or not
06055 
06056 Return Value:
06057 
06058     None
06059 
06060 --*/
06061 
06062 {
06063     ULONG ReceivedLength;
06064     ULONG ZeroCase;
06065     PVOID CacheBuffer;
06066     PVOID SavedMappedBuffer;
06067     ULONG SavedMappedLength;
06068     ULONG ActivePage;
06069     KIRQL OldIrql;
06070     LARGE_INTEGER PFileOffset;
06071     IO_STATUS_BLOCK IoStatus;
06072     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
06073     ULONG SavedState;
06074     BOOLEAN MorePages;
06075     ULONG SavedTotalLength = Length;
06076     LARGE_INTEGER LocalOffset = *FileOffset;
06077     ULONG PageOffset = FileOffset-&gt;LowPart &amp; (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1);
06078     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> Vacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
06079     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
06080 
06081     <span class="comment">//</span>
06082     <span class="comment">//  Initialize SavePage to TRUE to skip the finally clause on zero-length</span>
06083     <span class="comment">//  writes.</span>
06084     <span class="comment">//</span>
06085 
06086     BOOLEAN SavePage = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06087 
06088     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, me, <span class="stringliteral">"CcMapAndCopy:\n"</span>, 0 );
06089     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"    SharedCacheMap = %08lx\n"</span>, SharedCacheMap );
06090     <a class="code" href="../../d5/d5/cc_8h.html#a92">DebugTrace2</a>(0, me, <span class="stringliteral">"    FileOffset = %08lx, %08lx\n"</span>, FileOffset-&gt;LowPart,
06091                                                           FileOffset-&gt;HighPart );
06092     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"    Length = %08lx\n"</span>, Length );
06093 
06094     <a class="code" href="../../d2/d1/mm_8h.html#a19">MmSavePageFaultReadAhead</a>( Thread, &amp;SavedState );
06095 
06096     <span class="comment">//</span>
06097     <span class="comment">//  try around everything for cleanup.</span>
06098     <span class="comment">//</span>
06099 
06100     <span class="keywordflow">try</span> {
06101 
06102         <span class="keywordflow">while</span> (Length != 0) {
06103 
06104             CacheBuffer = <a class="code" href="../../d5/d3/vacbsup_8c.html#a15">CcGetVirtualAddress</a>( SharedCacheMap,
06105                                                LocalOffset,
06106                                                &amp;Vacb,
06107                                                &amp;ReceivedLength );
06108 
06109             <span class="comment">//</span>
06110             <span class="comment">//  If we got more than we need, make sure to only use</span>
06111             <span class="comment">//  the right amount.</span>
06112             <span class="comment">//</span>
06113 
06114             <span class="keywordflow">if</span> (ReceivedLength &gt; Length) {
06115                 ReceivedLength = Length;
06116             }
06117             SavedMappedBuffer = CacheBuffer;
06118             SavedMappedLength = ReceivedLength;
06119             Length -= ReceivedLength;
06120 
06121             <span class="comment">//</span>
06122             <span class="comment">//  Now loop to touch all of the pages, calling MM to insure</span>
06123             <span class="comment">//  that if we fault, we take in exactly the number of pages</span>
06124             <span class="comment">//  we need.</span>
06125             <span class="comment">//</span>
06126 
06127             CacheBuffer = (PVOID)((PCHAR)CacheBuffer - PageOffset);
06128             ReceivedLength += PageOffset;
06129 
06130             <span class="comment">//</span>
06131             <span class="comment">//  Loop to touch or zero the pages.</span>
06132             <span class="comment">//</span>
06133 
06134             ZeroCase = <a class="code" href="../../d5/d5/cc_8h.html#a85">ZERO_FIRST_PAGE</a>;
06135 
06136             <span class="comment">//</span>
06137             <span class="comment">//  Set up offset to page for use below.</span>
06138             <span class="comment">//</span>
06139 
06140             PFileOffset = LocalOffset;
06141             PFileOffset.LowPart -= PageOffset;
06142 
06143             <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
06144 
06145                 <span class="comment">//</span>
06146                 <span class="comment">//  Calculate whether we wish to save an active page</span>
06147                 <span class="comment">//  or not.</span>
06148                 <span class="comment">//</span>
06149 
06150                 SavePage = ((Length == 0) &amp;&amp;
06151                             (ReceivedLength &lt; <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>) &amp;&amp;
06152                             (SavedTotalLength &lt;= (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> / 2)) &amp;&amp;
06153                             !WriteThrough);
06154 
06155                 MorePages = (ReceivedLength &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>);
06156 
06157                 <span class="comment">//</span>
06158                 <span class="comment">//  Copy the data to the user buffer.</span>
06159                 <span class="comment">//</span>
06160 
06161                 <span class="keywordflow">try</span> {
06162 
06163                     <span class="comment">//</span>
06164                     <span class="comment">//  It is possible that there is a locked page</span>
06165                     <span class="comment">//  hanging around, and so we need to nuke it here.</span>
06166                     <span class="comment">//</span>
06167 
06168                     <span class="keywordflow">if</span> (SharedCacheMap-&gt;NeedToZero != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
06169                         <a class="code" href="../../d5/d5/cc_8h.html#a182">CcFreeActiveVacb</a>( SharedCacheMap, NULL, 0, 0 );
06170                     }
06171 
06172                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
06173                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(ZeroFlags, ZeroCase)) {
06174 
06175                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d5/mapcache_8c.html#a14">MmCopyToCachedPage</a>( CacheBuffer,
06176                                                      UserBuffer,
06177                                                      PageOffset,
06178                                                      MorePages ?
06179                                                        (PAGE_SIZE - PageOffset) :
06180                                                        (ReceivedLength - PageOffset),
06181                                                      SavePage );
06182 
06183                         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
06184 
06185                             <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>( <a class="code" href="../../d1/d8/fsrtl_8h.html#a136">FsRtlNormalizeNtstatus</a>( Status,
06186                                                                    STATUS_INVALID_USER_BUFFER ));
06187                         }
06188 
06189                     <span class="comment">//</span>
06190                     <span class="comment">//  Otherwise, we have to actually copy the data ourselves.</span>
06191                     <span class="comment">//</span>
06192 
06193                     } <span class="keywordflow">else</span> {
06194 
06195                         <a class="code" href="../../d2/d1/mm_8h.html#a20">MmSetPageFaultReadAhead</a>( Thread,
06196                                                  (MorePages &amp;&amp; <a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(ZeroFlags, ZERO_LAST_PAGE)) ? 1 : 0);
06197 
06198                         RtlCopyBytes( (PVOID)((PCHAR)CacheBuffer + PageOffset),
06199                                       UserBuffer,
06200                                       MorePages ?
06201                                         (PAGE_SIZE - PageOffset) :
06202                                         (ReceivedLength - PageOffset) );
06203 
06204                         <a class="code" href="../../d2/d1/mm_8h.html#a21">MmResetPageFaultReadAhead</a>( Thread, SavedState );
06205 
06206                     }
06207 
06208                 } except( <a class="code" href="../../d5/d7/copysup_8c.html#a5">CcCopyReadExceptionFilter</a>( GetExceptionInformation(),
06209                                                      &amp;Status ) ) {
06210 
06211                     <span class="comment">//</span>
06212                     <span class="comment">//  If we got an access violation, then the user buffer went</span>
06213                     <span class="comment">//  away.  Otherwise we must have gotten an I/O error trying</span>
06214                     <span class="comment">//  to bring the data in.</span>
06215                     <span class="comment">//</span>
06216 
06217                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_ACCESS_VIOLATION) {
06218                         <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>( STATUS_INVALID_USER_BUFFER );
06219                     }
06220                     <span class="keywordflow">else</span> {
06221                         <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>( <a class="code" href="../../d1/d8/fsrtl_8h.html#a136">FsRtlNormalizeNtstatus</a>( Status,
06222                                                                STATUS_UNEXPECTED_IO_ERROR ));
06223                     }
06224                 }
06225 
06226                 <span class="comment">//</span>
06227                 <span class="comment">//  Now get out quickly if it is a small write and we want</span>
06228                 <span class="comment">//  to save the page.</span>
06229                 <span class="comment">//</span>
06230 
06231                 <span class="keywordflow">if</span> (SavePage) {
06232 
06233                     ActivePage = (ULONG)( Vacb-&gt;<a class="code" href="../../d2/d5/struct__VACB.html#o4">Overlay</a>.FileOffset.QuadPart &gt;&gt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a> ) +
06234                                  (ULONG)(((PCHAR)CacheBuffer - (PCHAR)Vacb-&gt;<a class="code" href="../../d2/d5/struct__VACB.html#o0">BaseAddress</a>) &gt;&gt;
06235                                    <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>);
06236 
06237                     PFileOffset.LowPart += ReceivedLength;
06238 
06239                     <span class="comment">//</span>
06240                     <span class="comment">//  If the cache page was not locked, then clear the address</span>
06241                     <span class="comment">//  to zero from.</span>
06242                     <span class="comment">//</span>
06243 
06244                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_CACHE_PAGE_LOCKED) {
06245 
06246                         <span class="comment">//</span>
06247                         <span class="comment">//  We need to guarantee this Vacb for zeroing and calling</span>
06248                         <span class="comment">//  MmUnlockCachedPage, so we increment the active count here</span>
06249                         <span class="comment">//  and remember it for CcFreeActiveVacb.</span>
06250                         <span class="comment">//</span>
06251 
06252                         <a class="code" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>( &amp;OldIrql );
06253                         Vacb-&gt;<a class="code" href="../../d2/d5/struct__VACB.html#o4">Overlay</a>.ActiveCount += 1;
06254                         
06255                         ExAcquireSpinLockAtDpcLevel( &amp;SharedCacheMap-&gt;ActiveVacbSpinLock );
06256 
06257                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(SharedCacheMap-&gt;NeedToZero == NULL);
06258 
06259                         SharedCacheMap-&gt;NeedToZero = (PVOID)((PCHAR)CacheBuffer +
06260                                                              (PFileOffset.LowPart &amp; (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1)));
06261                         SharedCacheMap-&gt;NeedToZeroPage = ActivePage;
06262                         SharedCacheMap-&gt;NeedToZeroVacb = Vacb;
06263 
06264                         ExReleaseSpinLockFromDpcLevel( &amp;SharedCacheMap-&gt;ActiveVacbSpinLock );
06265                         <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
06266                         
06267                     }
06268 
06269                     <a class="code" href="../../d5/d5/cc_8h.html#a84">SetActiveVacb</a>( SharedCacheMap,
06270                                    OldIrql,
06271                                    Vacb,
06272                                    ActivePage,
06273                                    ACTIVE_PAGE_IS_DIRTY );
06274 
06275                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( NOTHING );
06276                 }
06277 
06278                 <span class="comment">//</span>
06279                 <span class="comment">//  If it looks like we may save a page and exit on the next loop,</span>
06280                 <span class="comment">//  then we must make sure to mark the current page dirty.  Note</span>
06281                 <span class="comment">//  that Cc[Fast]CopyWrite will finish the last part of any page</span>
06282                 <span class="comment">//  before allowing us to free the Active Vacb above, therefore</span>
06283                 <span class="comment">//  this case only occurs for a small random write.</span>
06284                 <span class="comment">//</span>
06285 
06286                 <span class="keywordflow">if</span> ((SavedTotalLength &lt;= (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> / 2)) &amp;&amp; !WriteThrough) {
06287 
06288                     <a class="code" href="../../d5/d5/cc_8h.html#a179">CcSetDirtyInMask</a>( SharedCacheMap, &amp;PFileOffset, ReceivedLength );
06289                 }
06290 
06291                 UserBuffer = (PVOID)((PCHAR)UserBuffer + (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - PageOffset));
06292                 PageOffset = 0;
06293 
06294                 <span class="comment">//</span>
06295                 <span class="comment">//  If there is more than a page to go (including what we just</span>
06296                 <span class="comment">//  copied), then adjust our buffer pointer and counts, and</span>
06297                 <span class="comment">//  determine if we are to the last page yet.</span>
06298                 <span class="comment">//</span>
06299 
06300                 <span class="keywordflow">if</span> (MorePages) {
06301 
06302                     CacheBuffer = (PCHAR)CacheBuffer + <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>;
06303                     ReceivedLength -= <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>;
06304 
06305                     <span class="comment">//</span>
06306                     <span class="comment">//  Update our offset to the page.  Note that 32-bit</span>
06307                     <span class="comment">//  add is ok since we cannot cross a Vacb boundary</span>
06308                     <span class="comment">//  and we reinitialize this offset before entering</span>
06309                     <span class="comment">//  this loop again.</span>
06310                     <span class="comment">//</span>
06311 
06312                     PFileOffset.LowPart += <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>;
06313 
06314                     <span class="keywordflow">if</span> (ReceivedLength &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>) {
06315                         ZeroCase = <a class="code" href="../../d5/d5/cc_8h.html#a86">ZERO_MIDDLE_PAGES</a>;
06316                     } <span class="keywordflow">else</span> {
06317                         ZeroCase = <a class="code" href="../../d5/d5/cc_8h.html#a87">ZERO_LAST_PAGE</a>;
06318                     }
06319 
06320                 } <span class="keywordflow">else</span> {
06321 
06322                     <span class="keywordflow">break</span>;
06323                 }
06324             }
06325 
06326             <span class="comment">//</span>
06327             <span class="comment">//  If there is still more to write (ie. we are going to step</span>
06328             <span class="comment">//  onto the next vacb) AND we just dirtied more than 64K, then</span>
06329             <span class="comment">//  do a vicarious MmFlushSection here.  This prevents us from</span>
06330             <span class="comment">//  creating unlimited dirty pages while holding the file</span>
06331             <span class="comment">//  resource exclusive.  We also do not need to set the pages</span>
06332             <span class="comment">//  dirty in the mask in this case.</span>
06333             <span class="comment">//</span>
06334 
06335             <span class="keywordflow">if</span> (Length &gt; <a class="code" href="../../d6/d2/cachesub_8c.html#a3">CcMaxDirtyWrite</a>) {
06336 
06337                 <a class="code" href="../../d5/d6/iosup_8c.html#a74">MmSetAddressRangeModified</a>( SavedMappedBuffer, SavedMappedLength );
06338                 <a class="code" href="../../d6/d5/flushsec_8c.html#a8">MmFlushSection</a>( SharedCacheMap-&gt;FileObject-&gt;SectionObjectPointer,
06339                                 &amp;LocalOffset,
06340                                 SavedMappedLength,
06341                                 &amp;IoStatus,
06342                                 TRUE );
06343 
06344                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(IoStatus.Status)) {
06345                     <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>( <a class="code" href="../../d1/d8/fsrtl_8h.html#a136">FsRtlNormalizeNtstatus</a>( IoStatus.Status,
06346                                                            STATUS_UNEXPECTED_IO_ERROR ));
06347                 }
06348 
06349             <span class="comment">//</span>
06350             <span class="comment">//  For write through files, call Mm to propagate the dirty bits</span>
06351             <span class="comment">//  here while we have the view mapped, so we know the flush will</span>
06352             <span class="comment">//  work below.  Again - do not set dirty in the mask.</span>
06353             <span class="comment">//</span>
06354 
06355             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (WriteThrough) {
06356 
06357                 <a class="code" href="../../d5/d6/iosup_8c.html#a74">MmSetAddressRangeModified</a>( SavedMappedBuffer, SavedMappedLength );
06358 
06359             <span class="comment">//</span>
06360             <span class="comment">//  For the normal case, just set the pages dirty for the Lazy Writer</span>
06361             <span class="comment">//  now.</span>
06362             <span class="comment">//</span>
06363 
06364             } <span class="keywordflow">else</span> {
06365 
06366                 <a class="code" href="../../d5/d5/cc_8h.html#a179">CcSetDirtyInMask</a>( SharedCacheMap, &amp;LocalOffset, SavedMappedLength );
06367             }
06368 
06369             <a class="code" href="../../d5/d3/vacbsup_8c.html#a16">CcFreeVirtualAddress</a>( Vacb );
06370             Vacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
06371 
06372             <span class="comment">//</span>
06373             <span class="comment">//  If we have to loop back to get at least a page, it will be ok to</span>
06374             <span class="comment">//  zero the first page.  If we are not getting at least a page, we</span>
06375             <span class="comment">//  must make sure we clear the ZeroFlags if we cannot zero the last</span>
06376             <span class="comment">//  page.</span>
06377             <span class="comment">//</span>
06378 
06379             <span class="keywordflow">if</span> (Length &gt;= <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>) {
06380                 ZeroFlags |= <a class="code" href="../../d5/d5/cc_8h.html#a85">ZERO_FIRST_PAGE</a>;
06381             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ZeroFlags &amp; <a class="code" href="../../d5/d5/cc_8h.html#a87">ZERO_LAST_PAGE</a>) == 0) {
06382                 ZeroFlags = 0;
06383             }
06384 
06385             <span class="comment">//</span>
06386             <span class="comment">//  Note that if ReceivedLength (and therefore SavedMappedLength)</span>
06387             <span class="comment">//  was truncated to the transfer size then the new LocalOffset</span>
06388             <span class="comment">//  computed below is not correct.  This is not an issue since</span>
06389             <span class="comment">//  in that case (Length == 0) and we would never get here.</span>
06390             <span class="comment">//</span>
06391 
06392             LocalOffset.QuadPart = LocalOffset.QuadPart + (LONGLONG)SavedMappedLength;
06393         }
06394     try_exit: NOTHING;
06395     }
06396 
06397     <span class="comment">//</span>
06398     <span class="comment">//  Cleanup on the way out.</span>
06399     <span class="comment">//</span>
06400 
06401     finally {
06402 
06403         <a class="code" href="../../d2/d1/mm_8h.html#a21">MmResetPageFaultReadAhead</a>( Thread, SavedState );
06404 
06405         <span class="comment">//</span>
06406         <span class="comment">//  We have no work to do if we have squirreled away the Vacb.</span>
06407         <span class="comment">//</span>
06408 
06409         <span class="keywordflow">if</span> (!SavePage || AbnormalTermination()) {
06410 
06411             <span class="comment">//</span>
06412             <span class="comment">//  Make sure we do not leave anything mapped or dirty in the PTE</span>
06413             <span class="comment">//  on the way out.</span>
06414             <span class="comment">//</span>
06415 
06416             <span class="keywordflow">if</span> (Vacb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
06417 
06418                 <a class="code" href="../../d5/d3/vacbsup_8c.html#a16">CcFreeVirtualAddress</a>( Vacb );
06419             }
06420 
06421             <span class="comment">//</span>
06422             <span class="comment">//  Either flush the whole range because of write through, or</span>
06423             <span class="comment">//  mark it dirty for the lazy writer.</span>
06424             <span class="comment">//</span>
06425 
06426             <span class="keywordflow">if</span> (WriteThrough) {
06427 
06428                 <a class="code" href="../../d6/d5/flushsec_8c.html#a8">MmFlushSection</a> ( SharedCacheMap-&gt;FileObject-&gt;SectionObjectPointer,
06429                                  FileOffset,
06430                                  SavedTotalLength,
06431                                  &amp;IoStatus,
06432                                  TRUE );
06433 
06434                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(IoStatus.Status)) {
06435                     <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>( <a class="code" href="../../d1/d8/fsrtl_8h.html#a136">FsRtlNormalizeNtstatus</a>( IoStatus.Status,
06436                                                            STATUS_UNEXPECTED_IO_ERROR ));
06437                 }
06438 
06439                 <span class="comment">//</span>
06440                 <span class="comment">//  Advance ValidDataGoal</span>
06441                 <span class="comment">//</span>
06442 
06443                 LocalOffset.QuadPart = FileOffset-&gt;QuadPart + (LONGLONG)SavedTotalLength;
06444                 <span class="keywordflow">if</span> (LocalOffset.QuadPart &gt; SharedCacheMap-&gt;ValidDataGoal.QuadPart) {
06445                     SharedCacheMap-&gt;ValidDataGoal = LocalOffset;
06446                 }
06447             }
06448         }
06449     }
06450 
06451     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, me, <span class="stringliteral">"CcMapAndCopy -&gt; %02lx\n"</span>, Result );
06452 
06453     <span class="keywordflow">return</span>;
06454 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a181" doxytag="cc.h::CcMapAndRead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CcMapAndRead           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>FileOffset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ZeroFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Wait</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05749">5749</a> of file <a class="el" href="../../d7/d1/cachesub_8c-source.html">cachesub.c</a>.
<p>
References <a class="el" href="../../d3/d0/mm_8h-source.html#l00221">COMPUTE_PAGES_SPANNED</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l01016">MmCheckCachedPageState()</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l01053">MmResetPageFaultReadAhead</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l00983">MmSavePageFaultReadAhead</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l01018">MmSetPageFaultReadAhead</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02154">try_return</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01798">ZERO_FIRST_PAGE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01800">ZERO_LAST_PAGE</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l01799">ZERO_MIDDLE_PAGES</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, and <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>.
<p>
<pre class="fragment"><div>05760                    :
05761 
05762     This routine may be called to insure that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified data <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> mapped,
05763     read into memory and locked.  If <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
05764     correct I/O status <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transfer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> also returned, along with
05765     a system-space address <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data.
05766 
05767 Arguments:
05768 
05769     SharedCacheMap - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> SharedCacheMap <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
05770                      data.
05771 
05772     FileOffset - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> offset of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired data.
05773 
05774     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> total amount of data desired.
05775 
05776     ZeroFlags - Defines which pages may be zeroed <span class="keywordflow">if</span> not resident.
05777 
05778     Wait - Supplies <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not willing to block <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
05779            data, or <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> willing to block.
05780 
05781     BaseAddress - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system base address at which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data may
05782                   be accessed.
05783 
05784 Return Value:
05785 
05786     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller supplied Wait = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data could not
05787             be returned without blocking.
05788 
05789     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being returned.
05790 
05791     Note: <span class="keyword">this</span> routine may raise an exception due to a map or read <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>,
05792           however, <span class="keyword">this</span> can <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> happen <span class="keywordflow">if</span> Wait was specified as <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, since
05793           mapping and reading will not be performed <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller cannot wait.
05794 
05795 --*/
05796 
05797 {
05798     ULONG ZeroCase;
05799     ULONG SavedState;
05800     BOOLEAN Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05801     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
05802 
05803     <a class="code" href="../../d2/d1/mm_8h.html#a19">MmSavePageFaultReadAhead</a>( Thread, &amp;SavedState );
05804 
05805     <span class="comment">//</span>
05806     <span class="comment">//  try around everything for cleanup.</span>
05807     <span class="comment">//</span>
05808 
05809     <span class="keywordflow">try</span> {
05810 
05811         ULONG PagesToGo;
05812 
05813         <span class="comment">//</span>
05814         <span class="comment">//  Now loop to touch all of the pages, calling MM to insure</span>
05815         <span class="comment">//  that if we fault, we take in exactly the number of pages</span>
05816         <span class="comment">//  we need.</span>
05817         <span class="comment">//</span>
05818 
05819         PagesToGo = <a class="code" href="../../d2/d1/mm_8h.html#a9">COMPUTE_PAGES_SPANNED</a>( BaseAddress, Length );
05820 
05821         <span class="comment">//</span>
05822         <span class="comment">//  Loop to touch or zero the pages.</span>
05823         <span class="comment">//</span>
05824 
05825         ZeroCase = <a class="code" href="../../d5/d5/cc_8h.html#a85">ZERO_FIRST_PAGE</a>;
05826 
05827         <span class="keywordflow">while</span> (PagesToGo) {
05828 
05829             <span class="comment">//</span>
05830             <span class="comment">//  If we cannot zero this page, or Mm failed to return</span>
05831             <span class="comment">//  a zeroed page, then just fault it in.</span>
05832             <span class="comment">//</span>
05833 
05834             <a class="code" href="../../d2/d1/mm_8h.html#a20">MmSetPageFaultReadAhead</a>( Thread, (PagesToGo - 1) );
05835 
05836             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(ZeroFlags, ZeroCase) ||
05837                 !<a class="code" href="../../d1/d5/mapcache_8c.html#a13">MmCheckCachedPageState</a>(BaseAddress, TRUE)) {
05838 
05839                 <span class="comment">//</span>
05840                 <span class="comment">//  If we get here, it is almost certainly due to the fact</span>
05841                 <span class="comment">//  that we can not take a zero page.  MmCheckCachedPageState</span>
05842                 <span class="comment">//  will so rarely return FALSE, that we will not worry</span>
05843                 <span class="comment">//  about it.  We will only check if the page is there if</span>
05844                 <span class="comment">//  Wait is FALSE, so that we can do the right thing.</span>
05845                 <span class="comment">//</span>
05846 
05847                 <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d5/mapcache_8c.html#a13">MmCheckCachedPageState</a>(BaseAddress, FALSE) &amp;&amp; !Wait) {
05848                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = FALSE );
05849                 }
05850             }
05851 
05852             BaseAddress = (PCHAR)BaseAddress + <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>;
05853             PagesToGo -= 1;
05854 
05855             <span class="keywordflow">if</span> (PagesToGo == 1) {
05856                 ZeroCase = <a class="code" href="../../d5/d5/cc_8h.html#a87">ZERO_LAST_PAGE</a>;
05857             } <span class="keywordflow">else</span> {
05858                 ZeroCase = <a class="code" href="../../d5/d5/cc_8h.html#a86">ZERO_MIDDLE_PAGES</a>;
05859             }
05860         }
05861 
05862         <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = TRUE );
05863 
05864     try_exit: NOTHING;
05865     }
05866 
05867     <span class="comment">//</span>
05868     <span class="comment">//  Cleanup on the way out.</span>
05869     <span class="comment">//</span>
05870 
05871     finally {
05872 
05873         <a class="code" href="../../d2/d1/mm_8h.html#a21">MmResetPageFaultReadAhead</a>(Thread, SavedState);
05874     }
05875 
05876     <span class="keywordflow">return</span> Result;
05877 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a178" doxytag="cc.h::CcPerformReadAhead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL CcPerformReadAhead           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>FileObject</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">1633</a> of file <a class="el" href="../../d7/d1/cachesub_8c-source.html">cachesub.c</a>.
<p>
References <a class="el" href="../../d5/d1/cache_8h-source.html#l00127">_CACHE_MANAGER_CALLBACKS::AcquireForReadAhead</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00903">_SHARED_CACHE_MAP::Callbacks</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00064">CcAcquireMasterLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01010">CcDecrementOpenCount</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00031">CcDirtySharedCacheMapList</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00862">CcFreeVirtualAddress()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00310">CcGetVirtualAddress()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00206">CcMissCounter</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00198">CcReadAheadIos</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00067">CcReleaseMasterLock</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00049">CcScheduleLazyWriteScan()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00160">CcThrowAway</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l00221">COMPUTE_PAGES_SPANNED</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00846">_SHARED_CACHE_MAP::DirtyPages</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00752">_SHARED_CACHE_MAP::FileSize</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00832">_SHARED_CACHE_MAP::Flags</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l01495">FO_SEQUENTIAL_ONLY</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00905">_SHARED_CACHE_MAP::LazyWriteContext</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00129">LazyWriter</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00217">MAX_READ_AHEAD</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00033">me</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l01016">MmCheckCachedPageState()</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l01053">MmResetPageFaultReadAhead</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l00983">MmSavePageFaultReadAhead</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l01018">MmSetPageFaultReadAhead</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00033">Offset</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00740">_SHARED_CACHE_MAP::OpenCount</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01471">_LAZY_WRITER::OtherWork</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00705">_PRIVATE_CACHE_MAP::ReadAheadActive</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00713">_PRIVATE_CACHE_MAP::ReadAheadEnabled</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00677">_PRIVATE_CACHE_MAP::ReadAheadLength</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00676">_PRIVATE_CACHE_MAP::ReadAheadOffset</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00683">_PRIVATE_CACHE_MAP::ReadAheadSpinLock</a>, <a class="el" href="../../d5/d1/cache_8h-source.html#l00128">_CACHE_MANAGER_CALLBACKS::ReleaseFromReadAhead</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01464">_LAZY_WRITER::ScanActive</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01113">_SHARED_CACHE_MAP_LIST_CURSOR::SharedCacheMapLinks</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00826">_SHARED_CACHE_MAP::SharedCacheMapLinks</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02154">try_return</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l01051">WRITE_QUEUED</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>.
<p>
<pre class="fragment"><div>01639                    :
01640 
01641     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Lazy <a class="code" href="../../d4/d0/tex_8c.html#a44">Writer</a> to perform read ahead which
01642     has been scheduled <span class="keywordflow">for</span> <span class="keyword">this</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> by <a class="code" href="../../d6/d2/cachesub_8c.html#a15">CcScheduleReadAhead</a>.
01643 
01644 Arguments:
01645 
01646     FileObject - supplies pointer to FileObject on which readahead should be
01647                  considered.
01648 
01649 Return Value:
01650 
01651     None
01652 --*/
01653 
01654 {
01655     KIRQL OldIrql;
01656     <a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap;
01657     <a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html">PPRIVATE_CACHE_MAP</a> PrivateCacheMap;
01658     ULONG i;
01659     LARGE_INTEGER ReadAheadOffset[2];
01660     ULONG ReadAheadLength[2];
01661     <a class="code" href="../../d3/d6/struct__CACHE__MANAGER__CALLBACKS.html">PCACHE_MANAGER_CALLBACKS</a> Callbacks;
01662     PVOID Context;
01663     ULONG SavedState;
01664     BOOLEAN Done;
01665     BOOLEAN HitEof = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01666     BOOLEAN ReadAheadPerformed = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01667     ULONG FaultOccurred = 0;
01668     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
01669     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> Vacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01670 
01671     BOOLEAN ResourceHeld = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01672 
01673     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, me, <span class="stringliteral">"CcPerformReadAhead:\n"</span>, 0 );
01674     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"    FileObject = %08lx\n"</span>, FileObject );
01675 
01676     <a class="code" href="../../d2/d1/mm_8h.html#a19">MmSavePageFaultReadAhead</a>( Thread, &amp;SavedState );
01677 
01678     <span class="keywordflow">try</span> {
01679 
01680         <span class="comment">//</span>
01681         <span class="comment">//  Since we have the open count biased, we can safely access the</span>
01682         <span class="comment">//  SharedCacheMap.</span>
01683         <span class="comment">//</span>
01684 
01685         SharedCacheMap = FileObject-&gt;SectionObjectPointer-&gt;SharedCacheMap;
01686 
01687         Callbacks = SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o27">Callbacks</a>;
01688         Context = SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o28">LazyWriteContext</a>;
01689 
01690         <span class="comment">//</span>
01691         <span class="comment">//  After the first time, keep looping as long as there are new</span>
01692         <span class="comment">//  read ahead requirements.  (We will skip out below.)</span>
01693         <span class="comment">//</span>
01694 
01695         <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01696 
01697             <span class="comment">//</span>
01698             <span class="comment">//  Get SharedCacheMap and PrivateCacheMap.  If either are now NULL, get</span>
01699             <span class="comment">//  out.</span>
01700             <span class="comment">//</span>
01701 
01702             <a class="code" href="../../d5/d5/cc_8h.html#a0">CcAcquireMasterLock</a>( &amp;OldIrql );
01703 
01704             PrivateCacheMap = FileObject-&gt;PrivateCacheMap;
01705 
01706             <span class="comment">//</span>
01707             <span class="comment">//  Now capture the information that we need, so that we can drop the</span>
01708             <span class="comment">//  SharedList Resource.  This information is advisory only anyway, and</span>
01709             <span class="comment">//  the caller must guarantee that the FileObject is referenced.</span>
01710             <span class="comment">//</span>
01711 
01712             <span class="keywordflow">if</span> (PrivateCacheMap != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01713 
01714                 ExAcquireSpinLockAtDpcLevel( &amp;PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o9">ReadAheadSpinLock</a> );
01715 
01716                 <span class="comment">//</span>
01717                 <span class="comment">//  We are done when the lengths are 0</span>
01718                 <span class="comment">//</span>
01719 
01720                 Done = ((PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o8">ReadAheadLength</a>[0] |
01721                          PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o8">ReadAheadLength</a>[1]) == 0);
01722 
01723                 ReadAheadOffset[0] = PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o7">ReadAheadOffset</a>[0];
01724                 ReadAheadOffset[1] = PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o7">ReadAheadOffset</a>[1];
01725                 ReadAheadLength[0] = PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o8">ReadAheadLength</a>[0];
01726                 ReadAheadLength[1] = PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o8">ReadAheadLength</a>[1];
01727                 PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o8">ReadAheadLength</a>[0] = 0;
01728                 PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o8">ReadAheadLength</a>[1] = 0;
01729 
01730                 ExReleaseSpinLockFromDpcLevel( &amp;PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o9">ReadAheadSpinLock</a> );
01731             }
01732 
01733             <a class="code" href="../../d5/d5/cc_8h.html#a1">CcReleaseMasterLock</a>( OldIrql );
01734 
01735             <span class="comment">//</span>
01736             <span class="comment">//  Acquire the file shared.</span>
01737             <span class="comment">//</span>
01738 
01739             (*Callbacks-&gt;<a class="code" href="../../d3/d6/struct__CACHE__MANAGER__CALLBACKS.html#o2">AcquireForReadAhead</a>)( Context, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
01740             ResourceHeld = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01741 
01742             <span class="keywordflow">if</span> ((PrivateCacheMap == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || Done) {
01743 
01744                 <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( NOTHING );
01745             }
01746 
01747             <span class="comment">//</span>
01748             <span class="comment">//  PERFORM READ AHEAD</span>
01749             <span class="comment">//</span>
01750             <span class="comment">//</span>
01751             <span class="comment">//  Now loop until everything is read in.  The Read ahead is accomplished</span>
01752             <span class="comment">//  by touching the pages with an appropriate ReadAhead parameter in MM.</span>
01753             <span class="comment">//</span>
01754 
01755             i = 0;
01756 
01757             <span class="keywordflow">do</span> {
01758 
01759                 LARGE_INTEGER <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>, SavedOffset;
01760                 ULONG Length, SavedLength;
01761 
01762                 <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = ReadAheadOffset[i];
01763                 Length = ReadAheadLength[i];
01764                 SavedOffset = <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
01765                 SavedLength = Length;
01766 
01767                 <span class="keywordflow">if</span> ((Length != 0)
01768 
01769                         &amp;&amp;
01770 
01771                     ( <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>.QuadPart &lt;= SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o3">FileSize</a>.QuadPart )) {
01772 
01773                     ReadAheadPerformed = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01774 
01775                     <span class="comment">//</span>
01776                     <span class="comment">//  Keep length within file and MAX_READ_AHEAD</span>
01777                     <span class="comment">//</span>
01778 
01779                     <span class="keywordflow">if</span> ( ( <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>.QuadPart + (LONGLONG)Length ) &gt;= SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o3">FileSize</a>.QuadPart ) {
01780 
01781                         Length = (ULONG)( SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o3">FileSize</a>.QuadPart - <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>.QuadPart );
01782                         HitEof = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01783 
01784                     }
01785                     <span class="keywordflow">if</span> (Length &gt; <a class="code" href="../../d5/d5/cc_8h.html#a32">MAX_READ_AHEAD</a>) {
01786                         Length = <a class="code" href="../../d5/d5/cc_8h.html#a32">MAX_READ_AHEAD</a>;
01787                     }
01788 
01789                     <span class="comment">//</span>
01790                     <span class="comment">//  Now loop to read all of the desired data in.  This loop</span>
01791                     <span class="comment">//  is more or less like the same loop to read data in</span>
01792                     <span class="comment">//  CcCopyRead, except that we do not copy anything, just</span>
01793                     <span class="comment">//  unmap as soon as it is in.</span>
01794                     <span class="comment">//</span>
01795 
01796                     <span class="keywordflow">while</span> (Length != 0) {
01797 
01798                         ULONG ReceivedLength;
01799                         PVOID CacheBuffer;
01800                         ULONG PagesToGo;
01801 
01802                         <span class="comment">//</span>
01803                         <span class="comment">//  Call local routine to Map or Access the file data.</span>
01804                         <span class="comment">//  If we cannot map the data because of a Wait condition,</span>
01805                         <span class="comment">//  return FALSE.</span>
01806                         <span class="comment">//</span>
01807                         <span class="comment">//  Since this routine is intended to be called from</span>
01808                         <span class="comment">//  the finally handler from file system read modules,</span>
01809                         <span class="comment">//  it is imperative that it not raise any exceptions.</span>
01810                         <span class="comment">//  Therefore, if any expected exception is raised, we</span>
01811                         <span class="comment">//  will simply get out.</span>
01812                         <span class="comment">//</span>
01813 
01814                         CacheBuffer = <a class="code" href="../../d5/d3/vacbsup_8c.html#a15">CcGetVirtualAddress</a>( SharedCacheMap,
01815                                                            Offset,
01816                                                            &amp;Vacb,
01817                                                            &amp;ReceivedLength );
01818 
01819                         <span class="comment">//</span>
01820                         <span class="comment">//  If we got more than we need, make sure to only transfer</span>
01821                         <span class="comment">//  the right amount.</span>
01822                         <span class="comment">//</span>
01823 
01824                         <span class="keywordflow">if</span> (ReceivedLength &gt; Length) {
01825                             ReceivedLength = Length;
01826                         }
01827 
01828                         <span class="comment">//</span>
01829                         <span class="comment">//  Now loop to touch all of the pages, calling MM to insure</span>
01830                         <span class="comment">//  that if we fault, we take in exactly the number of pages</span>
01831                         <span class="comment">//  we need.</span>
01832                         <span class="comment">//</span>
01833 
01834                         PagesToGo = <a class="code" href="../../d2/d1/mm_8h.html#a9">COMPUTE_PAGES_SPANNED</a>( CacheBuffer,
01835                                                            ReceivedLength );
01836 
01837                         <a class="code" href="../../d5/d2/cachedat_8c.html#a75">CcMissCounter</a> = &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a69">CcReadAheadIos</a>;
01838 
01839                         <span class="keywordflow">while</span> (PagesToGo) {
01840 
01841                             <a class="code" href="../../d2/d1/mm_8h.html#a20">MmSetPageFaultReadAhead</a>( Thread, (PagesToGo - 1) );
01842                             FaultOccurred |= !<a class="code" href="../../d1/d5/mapcache_8c.html#a13">MmCheckCachedPageState</a>(CacheBuffer, FALSE);
01843 
01844                             CacheBuffer = (PCHAR)CacheBuffer + <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>;
01845                             PagesToGo -= 1;
01846                         }
01847                         <a class="code" href="../../d5/d2/cachedat_8c.html#a75">CcMissCounter</a> = &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a43">CcThrowAway</a>;
01848 
01849                         <span class="comment">//</span>
01850                         <span class="comment">//  Calculate how much data we have left to go.</span>
01851                         <span class="comment">//</span>
01852 
01853                         Length -= ReceivedLength;
01854 
01855                         <span class="comment">//</span>
01856                         <span class="comment">//  Assume we did not get all the data we wanted, and set</span>
01857                         <span class="comment">//  Offset to the end of the returned data.</span>
01858                         <span class="comment">//</span>
01859 
01860                         <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>.QuadPart = <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>.QuadPart + (LONGLONG)ReceivedLength;
01861 
01862                         <span class="comment">//</span>
01863                         <span class="comment">//  It was only a page, so we can just leave this loop</span>
01864                         <span class="comment">//  After freeing the address.</span>
01865                         <span class="comment">//</span>
01866 
01867                         <a class="code" href="../../d5/d3/vacbsup_8c.html#a16">CcFreeVirtualAddress</a>( Vacb );
01868                         Vacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01869                     }
01870                 }
01871                 i += 1;
01872             } <span class="keywordflow">while</span> (i &lt;= 1);
01873 
01874             <span class="comment">//</span>
01875             <span class="comment">//  Release the file</span>
01876             <span class="comment">//</span>
01877 
01878             (*Callbacks-&gt;<a class="code" href="../../d3/d6/struct__CACHE__MANAGER__CALLBACKS.html#o3">ReleaseFromReadAhead</a>)( Context );
01879             ResourceHeld = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01880         }
01881 
01882     try_exit: NOTHING;
01883     }
01884     finally {
01885 
01886         <a class="code" href="../../d2/d1/mm_8h.html#a21">MmResetPageFaultReadAhead</a>(Thread, SavedState);
01887         <a class="code" href="../../d5/d2/cachedat_8c.html#a75">CcMissCounter</a> = &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a43">CcThrowAway</a>;
01888 
01889         <span class="comment">//</span>
01890         <span class="comment">//  If we got an error faulting a single page in, release the Vacb</span>
01891         <span class="comment">//  here.  It is important to free any mapping before dropping the</span>
01892         <span class="comment">//  resource to prevent purge problems.</span>
01893         <span class="comment">//</span>
01894 
01895         <span class="keywordflow">if</span> (Vacb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01896             <a class="code" href="../../d5/d3/vacbsup_8c.html#a16">CcFreeVirtualAddress</a>( Vacb );
01897         }
01898 
01899         <span class="comment">//</span>
01900         <span class="comment">//  Release the file</span>
01901         <span class="comment">//</span>
01902 
01903         <span class="keywordflow">if</span> (ResourceHeld) {
01904             (*Callbacks-&gt;<a class="code" href="../../d3/d6/struct__CACHE__MANAGER__CALLBACKS.html#o3">ReleaseFromReadAhead</a>)( Context );
01905         }
01906 
01907         <span class="comment">//</span>
01908         <span class="comment">//  To show we are done, we must make sure the PrivateCacheMap is</span>
01909         <span class="comment">//  still there.</span>
01910         <span class="comment">//</span>
01911 
01912         <a class="code" href="../../d5/d5/cc_8h.html#a0">CcAcquireMasterLock</a>( &amp;OldIrql );
01913 
01914         PrivateCacheMap = FileObject-&gt;PrivateCacheMap;
01915 
01916         <span class="comment">//</span>
01917         <span class="comment">//  Show readahead is going inactive.</span>
01918         <span class="comment">//</span>
01919 
01920         <span class="keywordflow">if</span> (PrivateCacheMap != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01921 
01922             ExAcquireSpinLockAtDpcLevel( &amp;PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o9">ReadAheadSpinLock</a> );
01923             PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o12">ReadAheadActive</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01924 
01925             <span class="comment">//</span>
01926             <span class="comment">//  If he said sequential only and we smashed into Eof, then</span>
01927             <span class="comment">//  let's reset the highwater mark in case he wants to read the</span>
01928             <span class="comment">//  file sequentially again.</span>
01929             <span class="comment">//</span>
01930 
01931             <span class="keywordflow">if</span> (HitEof &amp;&amp; <a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(FileObject-&gt;Flags, FO_SEQUENTIAL_ONLY)) {
01932                 PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o7">ReadAheadOffset</a>[1].LowPart =
01933                 PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o7">ReadAheadOffset</a>[1].HighPart = 0;
01934             }
01935 
01936             <span class="comment">//</span>
01937             <span class="comment">//  If no faults occurred, turn read ahead off.</span>
01938             <span class="comment">//</span>
01939 
01940             <span class="keywordflow">if</span> (ReadAheadPerformed &amp;&amp; !FaultOccurred) {
01941                 PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o13">ReadAheadEnabled</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01942             }
01943 
01944             ExReleaseSpinLockFromDpcLevel( &amp;PrivateCacheMap-&gt;<a class="code" href="../../d7/d9/struct__PRIVATE__CACHE__MAP.html#o9">ReadAheadSpinLock</a> );
01945         }
01946 
01947         <span class="comment">//</span>
01948         <span class="comment">//  Free SharedCacheMap list</span>
01949         <span class="comment">//</span>
01950 
01951         <a class="code" href="../../d5/d5/cc_8h.html#a1">CcReleaseMasterLock</a>( OldIrql );
01952 
01953         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( FileObject );
01954 
01955         <span class="comment">//</span>
01956         <span class="comment">//  Serialize again to decrement the open count.</span>
01957         <span class="comment">//</span>
01958 
01959         <a class="code" href="../../d5/d5/cc_8h.html#a0">CcAcquireMasterLock</a>( &amp;OldIrql );
01960 
01961         <a class="code" href="../../d5/d5/cc_8h.html#a69">CcDecrementOpenCount</a>( SharedCacheMap, 'adRP' );
01962 
01963         <span class="keywordflow">if</span> ((SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o2">OpenCount</a> == 0) &amp;&amp;
01964             !<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o18">Flags</a>, WRITE_QUEUED) &amp;&amp;
01965             (SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o20">DirtyPages</a> == 0)) {
01966 
01967             <span class="comment">//</span>
01968             <span class="comment">//  Move to the dirty list.</span>
01969             <span class="comment">//</span>
01970 
01971             RemoveEntryList( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o17">SharedCacheMapLinks</a> );
01972             InsertTailList( &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a2">CcDirtySharedCacheMapList</a>.<a class="code" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html#o0">SharedCacheMapLinks</a>,
01973                             &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o17">SharedCacheMapLinks</a> );
01974 
01975             <span class="comment">//</span>
01976             <span class="comment">//  Make sure the Lazy Writer will wake up, because we</span>
01977             <span class="comment">//  want him to delete this SharedCacheMap.</span>
01978             <span class="comment">//</span>
01979 
01980             <a class="code" href="../../d5/d2/cachedat_8c.html#a41">LazyWriter</a>.<a class="code" href="../../d3/d9/struct__LAZY__WRITER.html#o6">OtherWork</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01981             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d2/cachedat_8c.html#a41">LazyWriter</a>.<a class="code" href="../../d3/d9/struct__LAZY__WRITER.html#o5">ScanActive</a>) {
01982                 <a class="code" href="../../d5/d5/cc_8h.html#a185">CcScheduleLazyWriteScan</a>();
01983             }
01984         }
01985 
01986         <a class="code" href="../../d5/d5/cc_8h.html#a1">CcReleaseMasterLock</a>( OldIrql );
01987     }
01988 
01989     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, me, <span class="stringliteral">"CcPerformReadAhead -&gt; VOID\n"</span>, 0 );
01990 
01991     <span class="keywordflow">return</span>;
01992 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a175" doxytag="cc.h::CcPinFileData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN CcPinFileData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d1/struct__FILE__OBJECT.html">PFILE_OBJECT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>FileObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>FileOffset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ReadOnly</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WriteOnly</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d4/d3/struct__BCB.html">PBCB</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Bcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>BeyondLastByte</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">116</a> of file <a class="el" href="../../d7/d1/cachesub_8c-source.html">cachesub.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01329">_BCB::BaseAddress</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00965">_SHARED_CACHE_MAP::BcbSpinLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01267">_BCB::BeyondLastByte</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01254">_BCB::ByteLength</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01007">CcDereferenceFileOffset()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05314">CcFindBcb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">CcFreeActiveVacb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00862">CcFreeVirtualAddress()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00310">CcGetVirtualAddress()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05749">CcMapAndRead()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00947">CcReferenceFileOffset()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02292">DebugTrace2</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02475">ExAcquireResourceExclusive</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01014">ExAcquireSharedStarveExclusive()</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01255">_BCB::FileOffset</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00832">_SHARED_CACHE_MAP::Flags</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01577">GetActiveVacb</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00033">me</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01077">MODIFIED_WRITE_DISABLED</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00809">_SHARED_CACHE_MAP::NeedToZero</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01038">PIN_ACCESS</a>, <a class="el" href="../../d5/d1/cache_8h-source.html#l00590">PIN_EXCLUSIVE</a>, <a class="el" href="../../d5/d1/cache_8h-source.html#l00609">PIN_IF_BCB</a>, <a class="el" href="../../d5/d1/cache_8h-source.html#l00600">PIN_NO_READ</a>, <a class="el" href="../../d5/d1/cache_8h-source.html#l00582">PIN_WAIT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01304">_BCB::PinCount</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01315">_BCB::Resource</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l00117">ROUND_TO_PAGES</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00766">_SHARED_CACHE_MAP::SectionSize</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02154">try_return</a>, <a class="el" href="../../d5/d5/cc_8h.html#a211a171">UNPIN</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01286">_BCB::Vacb</a>, <a class="el" href="../../d5/d1/cache_8h-source.html#l00030">VACB_MAPPING_GRANULARITY</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00780">_SHARED_CACHE_MAP::ValidDataGoal</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01798">ZERO_FIRST_PAGE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01800">ZERO_LAST_PAGE</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l01799">ZERO_MIDDLE_PAGES</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l00031">CcCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00052">CcMapData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00271">CcPinMappedData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00524">CcPinRead()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00767">CcPreparePinWrite()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>.
<p>
<pre class="fragment"><div>00130                    :
00131 
00132     This routine locks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified range of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> data into memory.
00133 
00134     Note that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data desired by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller (or the first part of it)
00135     may be in one of three states:
00136 
00137         No Bcb exists which describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data
00138 
00139         <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> Bcb exists describing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data, but <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not mapped
00140         (BcbOut-&gt;BaseAddress == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00141 
00142         <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> Bcb exists describing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data, and <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> mapped
00143 
00144     Given <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> above three states, and given that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller may call
00145     with either Wait == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> or Wait == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <span class="keyword">this</span> routine has basically
00146     six cases.  What has to be done, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> order in which things must be
00147     done varies quite a bit with each of these six cases.  The most
00148     straight-forward implementation of <span class="keyword">this</span> routine, with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> least amount
00149     of branching, <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> achieved by determining which of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> six cases applies,
00150     and dispatching fairly directly to that <span class="keywordflow">case</span>.  The handling of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00151     cases <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> summarized in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following table:
00152 
00153                 Wait == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>                Wait == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00154                 ------------                -------------
00155 
00156     no Bcb      Case 1:                     Case 2:
00157 
00158                 <a class="code" href="../../d6/d2/cachesub_8c.html#a5">CcAllocateInitializeBcb</a>     <a class="code" href="../../d5/d5/cc_8h.html#a181">CcMapAndRead</a> (exit <span class="keywordflow">if</span> FALSE)
00159                 Acquire Bcb Exclusive       <a class="code" href="../../d6/d2/cachesub_8c.html#a5">CcAllocateInitializeBcb</a>
00160                 Release BcbList SpinLock    Acquire Bcb Shared <span class="keywordflow">if</span> not ReadOnly
00161                 <a class="code" href="../../d6/d2/cachesub_8c.html#a26">CcMapAndRead</a> w/ Wait        Release BcbList SpinLock
00162                 Convert/Release Bcb <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>
00163 
00164     Bcb not     Case 3:                     Case 4:
00165     mapped
00166                 <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> PinCount          Acquire Bcb Exclusive (exit <span class="keywordflow">if</span> FALSE)
00167                 Release BcbList SpinLock    <a class="code" href="../../d5/d5/cc_8h.html#a181">CcMapAndRead</a> (exit <span class="keywordflow">if</span> FALSE)
00168                 Acquire Bcb Excl. w/ Wait   <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> PinCount
00169                 <span class="keywordflow">if</span> still not mapped         Convert/Release Bcb <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>
00170                     <a class="code" href="../../d6/d2/cachesub_8c.html#a26">CcMapAndRead</a> w/ Wait    Release BcbList SpinLock
00171                 Convert/Release Bcb <a class="code" href="../../d4/d0/tex_8c.html#a21">Resource</a>
00172 
00173     Bcb mapped  Case 5:                     Case 6:
00174 
00175                 <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> PinCount          <span class="keywordflow">if</span> not ReadOnly
00176                 Release BcbList SpinLock        Acquire Bcb shared (exit <span class="keywordflow">if</span> FALSE)
00177                 <span class="keywordflow">if</span> not ReadOnly             <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> PinCount
00178                     Acquire Bcb Shared      Release BcbList SpinLock
00179 
00180     It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> important to note that most changes to <span class="keyword">this</span> routine will affect
00181     multiple cases from above.
00182 
00183 Arguments:
00184 
00185     FileObject - Pointer to <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a> Object <span class="keywordflow">for</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>
00186 
00187     FileOffset - <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> in <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> at which map should begin
00188 
00189     Length - Length of desired map in bytes
00190 
00191     ReadOnly - Supplies <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> caller will <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> read <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapped data (i.e.,
00192                TRUE <span class="keywordflow">for</span> CcCopyRead, CcMapData and CcMdlRead and FALSE <span class="keywordflow">for</span>
00193                everyone <span class="keywordflow">else</span>)
00194 
00195     WriteOnly - The specified range of bytes will <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be written.
00196 
00197     Flags - (<a class="code" href="../../d4/d2/cache_8h.html#a6">PIN_WAIT</a>, <a class="code" href="../../d4/d2/cache_8h.html#a7">PIN_EXCLUSIVE</a>, <a class="code" href="../../d4/d2/cache_8h.html#a8">PIN_NO_READ</a>, etc. as defined in cache.h)
00198 
00199     Bcb - Returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Bcb representing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pinned data.
00200 
00201     BaseAddress - Returns base address of desired data
00202 
00203     BeyondLastByte - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a> <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first byte beyond <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00204                      last accessible byte.
00205 
00206 Return Value:
00207 
00208     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - <span class="keywordflow">if</span> <a class="code" href="../../d4/d2/cache_8h.html#a6">PIN_WAIT</a> was set, and <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> was impossible to lock all
00209             of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data without blocking
00210     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired data, <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being returned
00211 
00212 Raises:
00213 
00214     STATUS_INSUFFICIENT_RESOURCES - If a <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocation <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a> occurs.
00215         This can <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> occur <span class="keywordflow">if</span> Wait was specified as <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>.  (If Wait <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00216         specified as <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, and an allocation <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a> occurs, <span class="keyword">this</span>
00217         routine simply returns <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>.)
00218 
00219 --*/
00220 
00221 {
00222     <a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap;
00223     LARGE_INTEGER TrialBound;
00224     KIRQL OldIrql;
00225     <a class="code" href="../../d4/d3/struct__BCB.html">PBCB</a> BcbOut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00226     ULONG ZeroFlags = 0;
00227     BOOLEAN SpinLockAcquired = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00228     BOOLEAN Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00229 
00230     ULONG ReceivedLength;
00231     ULONG ActivePage;
00232     ULONG PageIsDirty;
00233     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> Vacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00234 
00235     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, me, <span class="stringliteral">"CcPinFileData:\n"</span>, 0 );
00236     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"    FileObject = %08lx\n"</span>, FileObject );
00237     <a class="code" href="../../d5/d5/cc_8h.html#a92">DebugTrace2</a>(0, me, <span class="stringliteral">"    FileOffset = %08lx, %08lx\n"</span>, FileOffset-&gt;LowPart,
00238                                                           FileOffset-&gt;HighPart );
00239     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"    Length = %08lx\n"</span>, Length );
00240     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"    Flags = %02lx\n"</span>, Flags );
00241 
00242     <span class="comment">//</span>
00243     <span class="comment">//  Get pointer to SharedCacheMap via File Object.</span>
00244     <span class="comment">//</span>
00245 
00246     SharedCacheMap = *(<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> *)((PCHAR)FileObject-&gt;SectionObjectPointer
00247                                             + <span class="keyword">sizeof</span>(PVOID));
00248 
00249     <span class="comment">//</span>
00250     <span class="comment">//  See if we have an active Vacb, that we need to free.</span>
00251     <span class="comment">//</span>
00252 
00253     <a class="code" href="../../d5/d5/cc_8h.html#a82">GetActiveVacb</a>( SharedCacheMap, OldIrql, Vacb, ActivePage, PageIsDirty );
00254 
00255     <span class="comment">//</span>
00256     <span class="comment">//  If there is an end of a page to be zeroed, then free that page now,</span>
00257     <span class="comment">//  so it does not cause our data to get zeroed.  If there is an active</span>
00258     <span class="comment">//  page, free it so we have the correct ValidDataGoal.</span>
00259     <span class="comment">//</span>
00260 
00261     <span class="keywordflow">if</span> ((Vacb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o13">NeedToZero</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00262 
00263         <a class="code" href="../../d5/d5/cc_8h.html#a182">CcFreeActiveVacb</a>( SharedCacheMap, Vacb, ActivePage, PageIsDirty );
00264         Vacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00265     }
00266 
00267     <span class="comment">//</span>
00268     <span class="comment">//  Make sure the calling file system is not asking to map beyond the</span>
00269     <span class="comment">//  end of the section, for example, that it did not forget to do</span>
00270     <span class="comment">//  CcExtendCacheSection.</span>
00271     <span class="comment">//</span>
00272 
00273     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( ( FileOffset-&gt;QuadPart + (LONGLONG)Length ) &lt;=
00274                      SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o5">SectionSize</a>.QuadPart );
00275 
00276     <span class="comment">//</span>
00277     <span class="comment">//  Initially clear output</span>
00278     <span class="comment">//</span>
00279 
00280     *Bcb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00281     *BaseAddress = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00282 
00283     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_NO_READ)) {
00284 
00285         *BaseAddress = <a class="code" href="../../d5/d3/vacbsup_8c.html#a15">CcGetVirtualAddress</a>( SharedCacheMap,
00286                                             *FileOffset,
00287                                             &amp;Vacb,
00288                                             &amp;ReceivedLength );
00289 
00290     } <span class="keywordflow">else</span> {
00291 
00292         <span class="comment">//</span>
00293         <span class="comment">//  In the PIN_NO_READ case, we simply need to make sure that the</span>
00294         <span class="comment">//  sparse structure containing the Bcb listheads is expanded in the</span>
00295         <span class="comment">//  region of the file we are interested in.</span>
00296         <span class="comment">//</span>
00297         <span class="comment">//  Fake a ReceivedLength that matches the remaining bytes in the view.</span>
00298         <span class="comment">//</span>
00299 
00300         ReceivedLength = <a class="code" href="../../d4/d2/cache_8h.html#a0">VACB_MAPPING_GRANULARITY</a> -
00301                          (ULONG)(FileOffset-&gt;QuadPart &amp; (<a class="code" href="../../d4/d2/cache_8h.html#a0">VACB_MAPPING_GRANULARITY</a> - 1));
00302 
00303         <span class="comment">//</span>
00304         <span class="comment">//  Now simply cause a reference that will expand a multilevel Vacb.</span>
00305         <span class="comment">//</span>
00306 
00307         <a class="code" href="../../d5/d3/vacbsup_8c.html#a17">CcReferenceFileOffset</a>( SharedCacheMap, *FileOffset );
00308     }
00309 
00310     <span class="comment">//</span>
00311     <span class="comment">//  Acquire Bcb List Exclusive to look for Bcb</span>
00312     <span class="comment">//</span>
00313 
00314     ExAcquireSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, &amp;OldIrql );
00315     SpinLockAcquired = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00316 
00317     <span class="comment">//</span>
00318     <span class="comment">//  Use try to guarantee cleanup on the way out.</span>
00319     <span class="comment">//</span>
00320 
00321     <span class="keywordflow">try</span> {
00322 
00323         BOOLEAN Found;
00324         LARGE_INTEGER FOffset;
00325         LARGE_INTEGER TLength;
00326 
00327         <span class="comment">//</span>
00328         <span class="comment">//  Search for Bcb describing the largest matching "prefix" byte range,</span>
00329         <span class="comment">//  or where to insert it.</span>
00330         <span class="comment">//</span>
00331 
00332         TrialBound.QuadPart = FileOffset-&gt;QuadPart + (LONGLONG)Length;
00333         Found = <a class="code" href="../../d6/d2/cachesub_8c.html#a4">CcFindBcb</a>( SharedCacheMap, FileOffset, &amp;TrialBound, &amp;BcbOut );
00334 
00335 
00336         <span class="comment">//</span>
00337         <span class="comment">//  Cases 1 and 2 - Bcb was not found.</span>
00338         <span class="comment">//</span>
00339         <span class="comment">//  First caculate data to pin down.</span>
00340         <span class="comment">//</span>
00341 
00342         <span class="keywordflow">if</span> (!Found) {
00343 
00344             <span class="comment">//</span>
00345             <span class="comment">//  Get out if the user specified PIN_IF_BCB.</span>
00346             <span class="comment">//</span>
00347 
00348             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_IF_BCB)) {
00349 
00350                 <span class="comment">//</span>
00351                 <span class="comment">//  We need to zap BcbOut since this is a hint to the cleanup code</span>
00352                 <span class="comment">//  to remove the Bcb if we are returning FALSE.</span>
00353                 <span class="comment">//</span>
00354 
00355                 BcbOut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00356                 <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = FALSE );
00357             }
00358 
00359             <span class="comment">//</span>
00360             <span class="comment">//  Not found, calculate data to pin down.</span>
00361             <span class="comment">//</span>
00362             <span class="comment">//  Round local copy of FileOffset down to page boundary, and</span>
00363             <span class="comment">//  round copies of size and minimum size up.  Also make sure that</span>
00364             <span class="comment">//  we keep the length from crossing the end of the SharedCacheMap.</span>
00365             <span class="comment">//</span>
00366 
00367             FOffset = *FileOffset;
00368             TLength.QuadPart = TrialBound.QuadPart - FOffset.QuadPart;
00369 
00370             TLength.LowPart += FOffset.LowPart &amp; (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1);
00371             ReceivedLength += FOffset.LowPart &amp; (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1);
00372 
00373             <span class="comment">//</span>
00374             <span class="comment">//  At this point we can calculate the ReadOnly flag for</span>
00375             <span class="comment">//  the purposes of whether to use the Bcb resource, and</span>
00376             <span class="comment">//  we can calculate the ZeroFlags.</span>
00377             <span class="comment">//</span>
00378 
00379             <span class="keywordflow">if</span> ((!ReadOnly  &amp;&amp; !<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o18">Flags</a>, PIN_ACCESS)) || WriteOnly) {
00380 
00381                 <span class="comment">//</span>
00382                 <span class="comment">//  We can always zero middle pages, if any.</span>
00383                 <span class="comment">//</span>
00384 
00385                 ZeroFlags = <a class="code" href="../../d5/d5/cc_8h.html#a86">ZERO_MIDDLE_PAGES</a>;
00386 
00387                 <span class="keywordflow">if</span> (((FOffset.LowPart &amp; (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1)) == 0) &amp;&amp;
00388                     (Length &gt;= <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>)) {
00389                     ZeroFlags |= <a class="code" href="../../d5/d5/cc_8h.html#a85">ZERO_FIRST_PAGE</a>;
00390                 }
00391 
00392                 <span class="keywordflow">if</span> ((TLength.LowPart &amp; (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1)) == 0) {
00393                     ZeroFlags |= <a class="code" href="../../d5/d5/cc_8h.html#a87">ZERO_LAST_PAGE</a>;
00394                 }
00395             }
00396 
00397             <span class="comment">//</span>
00398             <span class="comment">//  We treat Bcbs as ReadOnly (do not acquire resource) if they</span>
00399             <span class="comment">//  are in sections for which we have not disabled modified writing.</span>
00400             <span class="comment">//</span>
00401 
00402             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o18">Flags</a>, MODIFIED_WRITE_DISABLED)) {
00403                 ReadOnly = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00404             }
00405 
00406             TLength.LowPart = (ULONG) <a class="code" href="../../d2/d1/mm_8h.html#a4">ROUND_TO_PAGES</a>( TLength.LowPart );
00407 
00408             <span class="comment">//</span>
00409             <span class="comment">//  Round BaseAddress and FOffset down to the bottom of a page.</span>
00410             <span class="comment">//</span>
00411 
00412             *BaseAddress = ((PCHAR)*BaseAddress - (FileOffset-&gt;LowPart &amp; (<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1)));
00413             FOffset.LowPart &amp;= ~(<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> - 1);
00414 
00415             <span class="comment">//</span>
00416             <span class="comment">//  Even if we are readonly, we can still zero pages entirely</span>
00417             <span class="comment">//  beyond valid data length.</span>
00418             <span class="comment">//</span>
00419 
00420             <span class="keywordflow">if</span> (FOffset.QuadPart &gt;= SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o7">ValidDataGoal</a>.QuadPart) {
00421 
00422                 ZeroFlags |= <a class="code" href="../../d5/d5/cc_8h.html#a85">ZERO_FIRST_PAGE</a> | <a class="code" href="../../d5/d5/cc_8h.html#a86">ZERO_MIDDLE_PAGES</a> | <a class="code" href="../../d5/d5/cc_8h.html#a87">ZERO_LAST_PAGE</a>;
00423 
00424             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((FOffset.QuadPart + (LONGLONG)<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>) &gt;=
00425                                 SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o7">ValidDataGoal</a>.QuadPart) {
00426 
00427                 ZeroFlags |= <a class="code" href="../../d5/d5/cc_8h.html#a86">ZERO_MIDDLE_PAGES</a> | <a class="code" href="../../d5/d5/cc_8h.html#a87">ZERO_LAST_PAGE</a>;
00428             }
00429 
00430             <span class="comment">//</span>
00431             <span class="comment">//  We will get into trouble if we try to read more than we</span>
00432             <span class="comment">//  can map by one Vacb.  So make sure that our lengths stay</span>
00433             <span class="comment">//  within a Vacb.</span>
00434             <span class="comment">//</span>
00435 
00436             <span class="keywordflow">if</span> (TLength.LowPart &gt; ReceivedLength) {
00437                 TLength.LowPart = ReceivedLength;
00438             }
00439 
00440 
00441             <span class="comment">//</span>
00442             <span class="comment">//  Case 1 - Bcb was not found and Wait is TRUE.</span>
00443             <span class="comment">//</span>
00444             <span class="comment">//  Note that it is important to minimize the time that the Bcb</span>
00445             <span class="comment">//  List spin lock is held, as well as guarantee we do not take</span>
00446             <span class="comment">//  any faults while holding this lock.</span>
00447             <span class="comment">//</span>
00448             <span class="comment">//  If we can (and perhaps will) wait, then it is important to</span>
00449             <span class="comment">//  allocate the Bcb acquire it exclusive and free the Bcb List.</span>
00450             <span class="comment">//  We then procede to read in the data, and anyone else finding</span>
00451             <span class="comment">//  our Bcb will have to wait shared to insure that the data is</span>
00452             <span class="comment">//  in.</span>
00453             <span class="comment">//</span>
00454 
00455             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_WAIT)) {
00456 
00457                 BcbOut = <a class="code" href="../../d6/d2/cachesub_8c.html#a5">CcAllocateInitializeBcb</a>( SharedCacheMap,
00458                                                   BcbOut,
00459                                                   &amp;FOffset,
00460                                                   &amp;TLength );
00461 
00462                 <span class="keywordflow">if</span> (BcbOut == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00463                     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, 0, <span class="stringliteral">"Bcb allocation failure\n"</span>, 0 );
00464                     ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
00465                     SpinLockAcquired = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00466                     <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>( STATUS_INSUFFICIENT_RESOURCES );
00467                 }
00468 
00469                 <span class="comment">//</span>
00470                 <span class="comment">//  Now just acquire the newly-allocated Bcb shared, and</span>
00471                 <span class="comment">//  release the spin lock.</span>
00472                 <span class="comment">//</span>
00473 
00474                 <span class="keywordflow">if</span> (!ReadOnly) {
00475                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_EXCLUSIVE)) {
00476                         (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d8/ex_8h.html#a70">ExAcquireResourceExclusive</a>( &amp;BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o10">Resource</a>, TRUE );
00477                     } <span class="keywordflow">else</span> {
00478                         (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d8/ex_8h.html#a270">ExAcquireSharedStarveExclusive</a>( &amp;BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o10">Resource</a>, TRUE );
00479                     }
00480                 }
00481                 ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
00482                 SpinLockAcquired = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00483 
00484                 <span class="comment">//</span>
00485                 <span class="comment">//  Now read in the data.</span>
00486                 <span class="comment">//</span>
00487 
00488                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_NO_READ)) {
00489 
00490                     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d5/cc_8h.html#a181">CcMapAndRead</a>( SharedCacheMap,
00491                                         &amp;FOffset,
00492                                         TLength.LowPart,
00493                                         ZeroFlags,
00494                                         TRUE,
00495                                         *BaseAddress );
00496 
00497                     <span class="comment">//</span>
00498                     <span class="comment">//  Now we have to reacquire the Bcb List spinlock to load</span>
00499                     <span class="comment">//  up the mapping if we are the first one, else we collided</span>
00500                     <span class="comment">//  with someone else who loaded the mapping first, and we</span>
00501                     <span class="comment">//  will just free our mapping.  It is guaranteed that the</span>
00502                     <span class="comment">//  data will be mapped to the same place.</span>
00503                     <span class="comment">//</span>
00504 
00505                     ExAcquireSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, &amp;OldIrql );
00506 
00507                     <span class="keywordflow">if</span> (BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00508 
00509                         BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> = *BaseAddress;
00510                         BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o8">Vacb</a> = Vacb;
00511                         Vacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00512                     }
00513 
00514                     ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
00515 
00516                     <span class="comment">//</span>
00517                     <span class="comment">//  Calculate Base Address of the data we want.</span>
00518                     <span class="comment">//</span>
00519 
00520                     *BaseAddress = (PCHAR)BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> +
00521                                    (ULONG)( FileOffset-&gt;QuadPart - BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o3">FileOffset</a>.QuadPart );
00522                 }
00523 
00524                 <span class="comment">//</span>
00525                 <span class="comment">//  Success!</span>
00526                 <span class="comment">//</span>
00527 
00528                 <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = TRUE );
00529             }
00530 
00531 
00532             <span class="comment">//</span>
00533             <span class="comment">//  Case 2 - Bcb was not found and Wait is FALSE</span>
00534             <span class="comment">//</span>
00535             <span class="comment">//  If we cannot wait, then we go immediately see if the data is</span>
00536             <span class="comment">//  there (CcMapAndRead), and then only set up the Bcb and release</span>
00537             <span class="comment">//  the spin lock if the data is there.  Note here we call</span>
00538             <span class="comment">//  CcMapAndRead while holding the spin lock, because we know we</span>
00539             <span class="comment">//  will not fault and not block before returning.</span>
00540             <span class="comment">//</span>
00541 
00542             <span class="keywordflow">else</span> {
00543 
00544                 <span class="comment">//</span>
00545                 <span class="comment">//  Now try to allocate and initialize the Bcb.  If we</span>
00546                 <span class="comment">//  fail to allocate one, then return FALSE, since we know that</span>
00547                 <span class="comment">//  Wait = FALSE.  The caller may get lucky if he calls</span>
00548                 <span class="comment">//  us back with Wait = TRUE.</span>
00549                 <span class="comment">//</span>
00550 
00551                 BcbOut = <a class="code" href="../../d6/d2/cachesub_8c.html#a5">CcAllocateInitializeBcb</a>( SharedCacheMap,
00552                                                   BcbOut,
00553                                                   &amp;FOffset,
00554                                                   &amp;TLength );
00555 
00556                 <span class="keywordflow">if</span> (BcbOut == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00557 
00558                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = FALSE );
00559                 }
00560 
00561                 <span class="comment">//</span>
00562                 <span class="comment">//  If we are not ReadOnly, we must acquire the newly-allocated</span>
00563                 <span class="comment">//  resource shared, and then we can free the spin lock.</span>
00564                 <span class="comment">//</span>
00565 
00566                 <span class="keywordflow">if</span> (!ReadOnly) {
00567                     <a class="code" href="../../d5/d8/ex_8h.html#a270">ExAcquireSharedStarveExclusive</a>( &amp;BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o10">Resource</a>, TRUE );
00568                 }
00569                 ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
00570                 SpinLockAcquired = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00571 
00572                 <span class="comment">//</span>
00573                 <span class="comment">//  Note that since this call has Wait = FALSE, it cannot</span>
00574                 <span class="comment">//  get an exception (see procedure header).</span>
00575                 <span class="comment">//</span>
00576 
00577                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( !<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_NO_READ) );
00578                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a181">CcMapAndRead</a>( SharedCacheMap,
00579                                    &amp;FOffset,
00580                                    TLength.LowPart,
00581                                    ZeroFlags,
00582                                    FALSE,
00583                                    *BaseAddress )) {
00584 
00585                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = FALSE );
00586                 }
00587 
00588                 <span class="comment">//</span>
00589                 <span class="comment">//  Now we have to reacquire the Bcb List spinlock to load</span>
00590                 <span class="comment">//  up the mapping if we are the first one, else we collided</span>
00591                 <span class="comment">//  with someone else who loaded the mapping first, and we</span>
00592                 <span class="comment">//  will just free our mapping.  It is guaranteed that the</span>
00593                 <span class="comment">//  data will be mapped to the same place.</span>
00594                 <span class="comment">//</span>
00595 
00596                 ExAcquireSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, &amp;OldIrql );
00597 
00598                 <span class="keywordflow">if</span> (BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00599 
00600                     BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> = *BaseAddress;
00601                     BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o8">Vacb</a> = Vacb;
00602                     Vacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00603                 }
00604 
00605                 ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
00606 
00607                 <span class="comment">//</span>
00608                 <span class="comment">//  Calculate Base Address of the data we want.</span>
00609                 <span class="comment">//</span>
00610 
00611                 *BaseAddress = (PCHAR)BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> +
00612                                (ULONG)( FileOffset-&gt;QuadPart - BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o3">FileOffset</a>.QuadPart );
00613 
00614                 <span class="comment">//</span>
00615                 <span class="comment">//  Success!</span>
00616                 <span class="comment">//</span>
00617 
00618                 <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = TRUE );
00619             }
00620 
00621         } <span class="keywordflow">else</span> {
00622 
00623             <span class="comment">//</span>
00624             <span class="comment">//  We treat Bcbs as ReadOnly (do not acquire resource) if they</span>
00625             <span class="comment">//  are in sections for which we have not disabled modified writing.</span>
00626             <span class="comment">//</span>
00627 
00628             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o18">Flags</a>, MODIFIED_WRITE_DISABLED)) {
00629                 ReadOnly = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00630             }
00631         }
00632 
00633 
00634         <span class="comment">//</span>
00635         <span class="comment">//  Cases 3 and 4 - Bcb is there but not mapped</span>
00636         <span class="comment">//</span>
00637 
00638         <span class="keywordflow">if</span> (BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00639 
00640             <span class="comment">//</span>
00641             <span class="comment">//  It is too complicated to attempt to calculate any ZeroFlags in this</span>
00642             <span class="comment">//  case, because we have to not only do the tests above, but also</span>
00643             <span class="comment">//  compare to the byte range in the Bcb since we will be passing</span>
00644             <span class="comment">//  those parameters to CcMapAndRead.  Also, the probability of hitting</span>
00645             <span class="comment">//  some window where zeroing is of any advantage is quite small.</span>
00646             <span class="comment">//</span>
00647 
00648             <span class="comment">//</span>
00649             <span class="comment">//  Set up to just reread the Bcb exactly as the data in it is</span>
00650             <span class="comment">//  described.</span>
00651             <span class="comment">//</span>
00652 
00653             *BaseAddress = ((PCHAR)*BaseAddress - (FileOffset-&gt;LowPart - BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o3">FileOffset</a>.LowPart));
00654             FOffset = BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o3">FileOffset</a>;
00655             TLength.QuadPart = (LONGLONG)BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o2">ByteLength</a>;
00656 
00657             <span class="comment">//</span>
00658             <span class="comment">//  Case 3 - Bcb is there but not mapped and Wait is TRUE</span>
00659             <span class="comment">//</span>
00660             <span class="comment">//  Increment the PinCount, and then release the BcbList</span>
00661             <span class="comment">//  SpinLock so that we can wait to acquire the Bcb exclusive.</span>
00662             <span class="comment">//  Once we have the Bcb exclusive, map and read it in if no</span>
00663             <span class="comment">//  one beats us to it.  Someone may have beat us to it since</span>
00664             <span class="comment">//  we had to release the SpinLock above.</span>
00665             <span class="comment">//</span>
00666 
00667             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_WAIT)) {
00668 
00669                 BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o9">PinCount</a> += 1;
00670 
00671                 <span class="comment">//</span>
00672                 <span class="comment">//  Now we have to release the BcbList SpinLock in order to</span>
00673                 <span class="comment">//  acquire the Bcb shared.</span>
00674                 <span class="comment">//</span>
00675 
00676                 ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
00677                 SpinLockAcquired = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00678                 <span class="keywordflow">if</span> (!ReadOnly) {
00679                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_EXCLUSIVE)) {
00680                         (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d8/ex_8h.html#a70">ExAcquireResourceExclusive</a>( &amp;BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o10">Resource</a>, TRUE );
00681                     } <span class="keywordflow">else</span> {
00682                         (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d8/ex_8h.html#a270">ExAcquireSharedStarveExclusive</a>( &amp;BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o10">Resource</a>, TRUE );
00683                     }
00684                 }
00685 
00686                 <span class="comment">//</span>
00687                 <span class="comment">//  Now procede to map and read the data in.</span>
00688                 <span class="comment">//</span>
00689                 <span class="comment">//  Now read in the data.</span>
00690                 <span class="comment">//</span>
00691 
00692                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_NO_READ)) {
00693 
00694                     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d5/cc_8h.html#a181">CcMapAndRead</a>( SharedCacheMap,
00695                                         &amp;FOffset,
00696                                         TLength.LowPart,
00697                                         ZeroFlags,
00698                                         TRUE,
00699                                         *BaseAddress );
00700 
00701                     <span class="comment">//</span>
00702                     <span class="comment">//  Now we have to reacquire the Bcb List spinlock to load</span>
00703                     <span class="comment">//  up the mapping if we are the first one, else we collided</span>
00704                     <span class="comment">//  with someone else who loaded the mapping first, and we</span>
00705                     <span class="comment">//  will just free our mapping.  It is guaranteed that the</span>
00706                     <span class="comment">//  data will be mapped to the same place.</span>
00707                     <span class="comment">//</span>
00708 
00709                     ExAcquireSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, &amp;OldIrql );
00710 
00711                     <span class="keywordflow">if</span> (BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00712 
00713                         BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> = *BaseAddress;
00714                         BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o8">Vacb</a> = Vacb;
00715                         Vacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00716                     }
00717 
00718                     ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
00719 
00720                     <span class="comment">//</span>
00721                     <span class="comment">//</span>
00722                     <span class="comment">//  Calculate Base Address of the data we want.</span>
00723                     <span class="comment">//</span>
00724 
00725                     *BaseAddress = (PCHAR)BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> +
00726                                    (ULONG)( FileOffset-&gt;QuadPart - BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o3">FileOffset</a>.QuadPart );
00727                 }
00728 
00729                 <span class="comment">//</span>
00730                 <span class="comment">//  Success!</span>
00731                 <span class="comment">//</span>
00732 
00733                 <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = TRUE );
00734             }
00735 
00736 
00737             <span class="comment">//</span>
00738             <span class="comment">//  Case 4 - Bcb is there but not mapped, and Wait is FALSE</span>
00739             <span class="comment">//</span>
00740             <span class="comment">//  Since we cannot wait, we go immediately see if the data is</span>
00741             <span class="comment">//  there (CcMapAndRead), and then only set up the Bcb and release</span>
00742             <span class="comment">//  the spin lock if the data is there.  Note here we call</span>
00743             <span class="comment">//  CcMapAndRead while holding the spin lock, because we know we</span>
00744             <span class="comment">//  will not fault and not block before returning.</span>
00745             <span class="comment">//</span>
00746 
00747             <span class="keywordflow">else</span> {
00748 
00749                 <span class="keywordflow">if</span> (!ReadOnly &amp;&amp; !<a class="code" href="../../d5/d8/ex_8h.html#a270">ExAcquireSharedStarveExclusive</a>( &amp;BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o10">Resource</a>, FALSE )) {
00750 
00751                     <span class="comment">//</span>
00752                     <span class="comment">//  If we cannot get the resource and have not incremented PinCount, then</span>
00753                     <span class="comment">//  suppress the unpin on cleanup.</span>
00754                     <span class="comment">//</span>
00755 
00756                     BcbOut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00757                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = FALSE );
00758                 }
00759 
00760                 BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o9">PinCount</a> += 1;
00761 
00762                 ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
00763                 SpinLockAcquired = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00764 
00765                 <span class="comment">//</span>
00766                 <span class="comment">//  Note that since this call has Wait = FALSE, it cannot</span>
00767                 <span class="comment">//  get an exception (see procedure header).</span>
00768                 <span class="comment">//</span>
00769 
00770                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( !<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_NO_READ) );
00771                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a181">CcMapAndRead</a>( SharedCacheMap,
00772                                    &amp;BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o3">FileOffset</a>,
00773                                    BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o2">ByteLength</a>,
00774                                    ZeroFlags,
00775                                    FALSE,
00776                                    *BaseAddress )) {
00777 
00778                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = FALSE );
00779                 }
00780 
00781                 <span class="comment">//</span>
00782                 <span class="comment">//  Now we have to reacquire the Bcb List spinlock to load</span>
00783                 <span class="comment">//  up the mapping if we are the first one, else we collided</span>
00784                 <span class="comment">//  with someone else who loaded the mapping first, and we</span>
00785                 <span class="comment">//  will just free our mapping.  It is guaranteed that the</span>
00786                 <span class="comment">//  data will be mapped to the same place.</span>
00787                 <span class="comment">//</span>
00788 
00789                 ExAcquireSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, &amp;OldIrql );
00790 
00791                 <span class="keywordflow">if</span> (BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00792 
00793                     BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> = *BaseAddress;
00794                     BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o8">Vacb</a> = Vacb;
00795                     Vacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00796                 }
00797 
00798                 ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
00799 
00800                 <span class="comment">//</span>
00801                 <span class="comment">//  Calculate Base Address of the data we want.</span>
00802                 <span class="comment">//</span>
00803 
00804                 *BaseAddress = (PCHAR)BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> +
00805                                (ULONG)( FileOffset-&gt;QuadPart - BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o3">FileOffset</a>.QuadPart );
00806 
00807                 <span class="comment">//</span>
00808                 <span class="comment">//  Success!</span>
00809                 <span class="comment">//</span>
00810 
00811                 <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = TRUE );
00812             }
00813         }
00814 
00815 
00816         <span class="comment">//</span>
00817         <span class="comment">//  Cases 5 and 6 - Bcb is there and it is mapped</span>
00818         <span class="comment">//</span>
00819 
00820         <span class="keywordflow">else</span> {
00821 
00822             <span class="comment">//</span>
00823             <span class="comment">//  Case 5 - Bcb is there and mapped, and Wait is TRUE</span>
00824             <span class="comment">//</span>
00825             <span class="comment">//  We can just increment the PinCount, release the SpinLock</span>
00826             <span class="comment">//  and then acquire the Bcb Shared if we are not ReadOnly.</span>
00827             <span class="comment">//</span>
00828 
00829             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_WAIT)) {
00830 
00831                 BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o9">PinCount</a> += 1;
00832                 ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
00833                 SpinLockAcquired = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00834 
00835                 <span class="comment">//</span>
00836                 <span class="comment">//  Acquire Bcb Resource shared to insure that it is in memory.</span>
00837                 <span class="comment">//</span>
00838 
00839                 <span class="keywordflow">if</span> (!ReadOnly) {
00840                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_EXCLUSIVE)) {
00841                         (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d8/ex_8h.html#a70">ExAcquireResourceExclusive</a>( &amp;BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o10">Resource</a>, TRUE );
00842                     } <span class="keywordflow">else</span> {
00843                         (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d5/d8/ex_8h.html#a270">ExAcquireSharedStarveExclusive</a>( &amp;BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o10">Resource</a>, TRUE );
00844                     }
00845                 }
00846             }
00847 
00848             <span class="comment">//</span>
00849             <span class="comment">//  Case 6 - Bcb is there and mapped, and Wait is FALSE</span>
00850             <span class="comment">//</span>
00851             <span class="comment">//  If we are not ReadOnly, we have to first see if we can</span>
00852             <span class="comment">//  acquire the Bcb shared before incrmenting the PinCount,</span>
00853             <span class="comment">//  since we will have to return FALSE if we cannot acquire the</span>
00854             <span class="comment">//  resource.</span>
00855             <span class="comment">//</span>
00856 
00857             <span class="keywordflow">else</span> {
00858 
00859                 <span class="comment">//</span>
00860                 <span class="comment">//  Acquire Bcb Resource shared to insure that it is in memory.</span>
00861                 <span class="comment">//</span>
00862 
00863                 <span class="keywordflow">if</span> (!ReadOnly &amp;&amp; !<a class="code" href="../../d5/d8/ex_8h.html#a270">ExAcquireSharedStarveExclusive</a>( &amp;BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o10">Resource</a>, FALSE )) {
00864 
00865                     <span class="comment">//</span>
00866                     <span class="comment">//  If we cannot get the resource and have not incremented PinCount, then</span>
00867                     <span class="comment">//  suppress the unpin on cleanup.</span>
00868                     <span class="comment">//</span>
00869 
00870                     BcbOut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00871                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = FALSE );
00872                 }
00873 
00874                 BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o9">PinCount</a> += 1;
00875                 ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
00876                 SpinLockAcquired = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00877             }
00878 
00879             <span class="comment">//</span>
00880             <span class="comment">//  Calculate Base Address of the data we want.</span>
00881             <span class="comment">//</span>
00882 
00883             *BaseAddress = (PCHAR)BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> +
00884                            (ULONG)( FileOffset-&gt;QuadPart - BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o3">FileOffset</a>.QuadPart );
00885 
00886             <span class="comment">//</span>
00887             <span class="comment">//  Success!</span>
00888             <span class="comment">//</span>
00889 
00890             <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>( Result = TRUE );
00891         }
00892 
00893 
00894     try_exit: NOTHING;
00895 
00896         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_NO_READ) &amp;&amp;
00897             <a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_EXCLUSIVE) &amp;&amp;
00898             (BcbOut != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
00899             (BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00900 
00901             <span class="comment">//</span>
00902             <span class="comment">//  Unmap the Vacb and free the resource if the Bcb is still</span>
00903             <span class="comment">//  dirty.  We have to free the resource before dropping the</span>
00904             <span class="comment">//  spinlock, and we want to hold the resource until the</span>
00905             <span class="comment">//  virtual address is freed.</span>
00906             <span class="comment">//</span>
00907 
00908             <a class="code" href="../../d5/d3/vacbsup_8c.html#a16">CcFreeVirtualAddress</a>( BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o8">Vacb</a> );
00909 
00910             BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o12">BaseAddress</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00911             BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o8">Vacb</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00912         }
00913 
00914     } finally {
00915 
00916         <span class="comment">//</span>
00917         <span class="comment">//  Release the spinlock if it is acquired.</span>
00918         <span class="comment">//</span>
00919 
00920         <span class="keywordflow">if</span> (SpinLockAcquired) {
00921             ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
00922         }
00923 
00924         <span class="comment">//</span>
00925         <span class="comment">//  If the Vacb was not used for any reason (error or not needed), then free it here.</span>
00926         <span class="comment">//</span>
00927 
00928         <span class="keywordflow">if</span> (Vacb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00929             <a class="code" href="../../d5/d3/vacbsup_8c.html#a16">CcFreeVirtualAddress</a>( Vacb );
00930         }
00931 
00932         <span class="comment">//</span>
00933         <span class="comment">//  If we referenced a piece of a multilevel structure, release here.</span>
00934         <span class="comment">//</span>
00935 
00936         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(Flags, PIN_NO_READ)) {
00937 
00938             <a class="code" href="../../d5/d3/vacbsup_8c.html#a18">CcDereferenceFileOffset</a>( SharedCacheMap, *FileOffset );
00939         }
00940 
00941         <span class="keywordflow">if</span> (Result) {
00942 
00943             *Bcb = BcbOut;
00944             *BeyondLastByte = BcbOut-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o5">BeyondLastByte</a>;
00945 
00946         <span class="comment">//</span>
00947         <span class="comment">//  An abnormal termination can occur on an allocation failure,</span>
00948         <span class="comment">//  or on a failure to map and read the buffer.</span>
00949         <span class="comment">//</span>
00950 
00951         } <span class="keywordflow">else</span> {
00952 
00953             *BaseAddress = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00954             <span class="keywordflow">if</span> (BcbOut != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00955                 <a class="code" href="../../d5/d5/cc_8h.html#a176">CcUnpinFileData</a>( BcbOut, ReadOnly, UNPIN );
00956             }
00957         }
00958 
00959         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"    &lt;Bcb = %08lx\n"</span>, *Bcb );
00960         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"    &lt;BaseAddress = %08lx\n"</span>, *BaseAddress );
00961         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, me, <span class="stringliteral">"CcPinFileData -&gt; %02lx\n"</span>, Result );
00962     }
00963 
00964     <span class="keywordflow">return</span> Result;
00965 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a174" doxytag="cc.h::CcPostDeferredWrites" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcPostDeferredWrites           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d6/copysup_8c-source.html#l02099">2099</a> of file <a class="el" href="../../d6/d6/copysup_8c-source.html">copysup.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l01400">_DEFERRED_WRITE::BytesToWrite</a>, <a class="el" href="../../d4/d2/cache_8h.html#a72">CcCanIWrite()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00096">CcDeferredWrites</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00095">CcDeferredWriteSpinLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01421">_DEFERRED_WRITE::Context1</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01422">_DEFERRED_WRITE::Context2</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01406">_DEFERRED_WRITE::DeferredWriteLinks</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01414">_DEFERRED_WRITE::Event</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01394">_DEFERRED_WRITE::FileObject</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01424">_DEFERRED_WRITE::LimitModifiedPages</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l01420">_DEFERRED_WRITE::PostRoutine</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01982">CcDeferWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05143">CcUnpinRepinnedBcb()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>.
<p>
<pre class="fragment"><div>02104                    :
02105 
02106     This routine may be called to see <span class="keywordflow">if</span> any deferred writes should be posted
02107     now, and to post them.  It should be called any time <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> status of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02108     queue may have changed, such as when a <span class="keyword">new</span> entry has been added, or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02109     Lazy <a class="code" href="../../d4/d0/tex_8c.html#a44">Writer</a> has finished writing <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> buffers and set them clean.
02110 
02111 Arguments:
02112 
02113     None
02114 
02115 Return Value:
02116 
02117     None
02118 
02119 --*/
02120 
02121 {
02122     <a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html">PDEFERRED_WRITE</a> DeferredWrite;
02123     ULONG TotalBytesLetLoose = 0;
02124     KIRQL OldIrql;
02125 
02126     <span class="keywordflow">do</span> {
02127 
02128         <span class="comment">//</span>
02129         <span class="comment">//  Initially clear the deferred write structure pointer</span>
02130         <span class="comment">//  and syncrhronize.</span>
02131         <span class="comment">//</span>
02132 
02133         DeferredWrite = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02134 
02135         ExAcquireSpinLock( &amp;CcDeferredWriteSpinLock, &amp;OldIrql );
02136 
02137         <span class="comment">//</span>
02138         <span class="comment">//  If the list is empty we are done.</span>
02139         <span class="comment">//</span>
02140 
02141         <span class="keywordflow">if</span> (!IsListEmpty(&amp;CcDeferredWrites)) {
02142 
02143             PLIST_ENTRY Entry;
02144 
02145             Entry = <a class="code" href="../../d5/d2/cachedat_8c.html#a29">CcDeferredWrites</a>.Flink;
02146 
02147             <span class="keywordflow">while</span> (Entry != &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a29">CcDeferredWrites</a>) {
02148 
02149                 DeferredWrite = CONTAINING_RECORD( Entry,
02150                                                    <a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html">DEFERRED_WRITE</a>,
02151                                                    DeferredWriteLinks );
02152 
02153                 <span class="comment">//</span>
02154                 <span class="comment">//  Check for a paranoid case here that TotalBytesLetLoose</span>
02155                 <span class="comment">//  wraps.  We stop processing the list at this time.</span>
02156                 <span class="comment">//</span>
02157 
02158                 TotalBytesLetLoose += DeferredWrite-&gt;<a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html#o3">BytesToWrite</a>;
02159 
02160                 <span class="keywordflow">if</span> (TotalBytesLetLoose &lt; DeferredWrite-&gt;<a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html#o3">BytesToWrite</a>) {
02161 
02162                     DeferredWrite = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02163                     <span class="keywordflow">break</span>;
02164                 }
02165 
02166                 <span class="comment">//</span>
02167                 <span class="comment">//  If it is now ok to post this write, remove him from</span>
02168                 <span class="comment">//  the list.</span>
02169                 <span class="comment">//</span>
02170 
02171                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d2/cache_8h.html#a72">CcCanIWrite</a>( DeferredWrite-&gt;<a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html#o2">FileObject</a>,
02172                                  TotalBytesLetLoose,
02173                                  FALSE,
02174                                  MAXUCHAR - 1 )) {
02175 
02176                     RemoveEntryList( &amp;DeferredWrite-&gt;<a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html#o4">DeferredWriteLinks</a> );
02177                     <span class="keywordflow">break</span>;
02178 
02179                 <span class="comment">//</span>
02180                 <span class="comment">//  Otherwise, it is time to stop processing the list, so</span>
02181                 <span class="comment">//  we clear the pointer again unless we throttled this item</span>
02182                 <span class="comment">//  because of a private dirty page limit.</span>
02183                 <span class="comment">//</span>
02184 
02185                 } <span class="keywordflow">else</span> {
02186 
02187                     <span class="comment">//</span>
02188                     <span class="comment">//  If this was a private throttle, skip over it and</span>
02189                     <span class="comment">//  remove its byte count from the running total.</span>
02190                     <span class="comment">//</span>
02191 
02192                     <span class="keywordflow">if</span> (DeferredWrite-&gt;<a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html#o9">LimitModifiedPages</a>) {
02193 
02194                         Entry = Entry-&gt;Flink;
02195                         TotalBytesLetLoose -= DeferredWrite-&gt;<a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html#o3">BytesToWrite</a>;
02196                         DeferredWrite = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02197                         <span class="keywordflow">continue</span>;
02198 
02199                     } <span class="keywordflow">else</span> {
02200 
02201                         DeferredWrite = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02202 
02203                         <span class="keywordflow">break</span>;
02204                     }
02205                 }
02206             }
02207         }
02208 
02209         ExReleaseSpinLock( &amp;CcDeferredWriteSpinLock, OldIrql );
02210 
02211         <span class="comment">//</span>
02212         <span class="comment">//  If we got something, set the event or call the post routine</span>
02213         <span class="comment">//  and deallocate the structure.</span>
02214         <span class="comment">//</span>
02215 
02216         <span class="keywordflow">if</span> (DeferredWrite != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02217 
02218             <span class="keywordflow">if</span> (DeferredWrite-&gt;<a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html#o5">Event</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02219 
02220                 <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>( DeferredWrite-&gt;<a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html#o5">Event</a>, 0, FALSE );
02221 
02222             } <span class="keywordflow">else</span> {
02223 
02224                 (*DeferredWrite-&gt;<a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html#o6">PostRoutine</a>)( DeferredWrite-&gt;<a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html#o7">Context1</a>,
02225                                                DeferredWrite-&gt;<a class="code" href="../../d5/d2/struct__DEFERRED__WRITE.html#o8">Context2</a> );
02226                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( DeferredWrite );
02227             }
02228         }
02229 
02230     <span class="comment">//</span>
02231     <span class="comment">//  Loop until we find no more work to do.</span>
02232     <span class="comment">//</span>
02233 
02234     } <span class="keywordflow">while</span> (DeferredWrite != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
02235 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a187" doxytag="cc.h::CcPostWorkQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL CcPostWorkQueue           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">PWORK_QUEUE_ENTRY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>WorkQueueEntry</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLIST_ENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>WorkQueue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00662">662</a> of file <a class="el" href="../../d6/d0/lazyrite_8c-source.html">lazyrite.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00051">CcIdleWorkerThreadList</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00050">CcNumberActiveWorkerThreads</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00056">CcQueueThrottle</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00048">CcWorkQueueSpinlock</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a205">CriticalWorkQueue</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00375">ExQueueWorkItem()</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00094">List</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00033">me</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00099">CcScanDpc()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>.
<p>
<pre class="fragment"><div>00669                    :
00670 
00671     This routine queues a WorkQueueEntry, which has been allocated and
00672     initialized by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller, to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> WorkQueue <span class="keywordflow">for</span> FIFO processing by
00673     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> work threads.
00674 
00675 Arguments:
00676 
00677     WorkQueueEntry - supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entry to queue
00678 
00679 Return Value:
00680 
00681     None
00682 
00683 --*/
00684 
00685 {
00686     KIRQL OldIrql;
00687     PLIST_ENTRY WorkerThreadEntry = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00688 
00689     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FIELD_OFFSET(<a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">WORK_QUEUE_ITEM</a>, List) == 0);
00690 
00691     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, me, <span class="stringliteral">"CcPostWorkQueue:\n"</span>, 0 );
00692     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"    WorkQueueEntry = %08lx\n"</span>, WorkQueueEntry );
00693 
00694     <span class="comment">//</span>
00695     <span class="comment">//  Queue the entry to the respective work queue.</span>
00696     <span class="comment">//</span>
00697 
00698     ExAcquireFastLock( &amp;CcWorkQueueSpinlock, &amp;OldIrql );
00699     InsertTailList( WorkQueue, &amp;WorkQueueEntry-&gt;WorkQueueLinks );
00700 
00701     <span class="comment">//</span>
00702     <span class="comment">//  Now, if we aren't throttled and have any more idle threads we can</span>
00703     <span class="comment">//  use, activate one.</span>
00704     <span class="comment">//</span>
00705 
00706     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d2/cachedat_8c.html#a11">CcQueueThrottle</a> &amp;&amp; !IsListEmpty(&amp;CcIdleWorkerThreadList)) {
00707         WorkerThreadEntry = RemoveHeadList( &amp;CcIdleWorkerThreadList );
00708         <a class="code" href="../../d5/d2/cachedat_8c.html#a6">CcNumberActiveWorkerThreads</a> += 1;
00709     }
00710     ExReleaseFastLock( &amp;CcWorkQueueSpinlock, OldIrql );
00711 
00712     <span class="keywordflow">if</span> (WorkerThreadEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00713 
00714         <span class="comment">//</span>
00715         <span class="comment">//  I had to peak in the sources to verify that this routine</span>
00716         <span class="comment">//  is a noop if the Flink is not NULL.  Sheeeeit!</span>
00717         <span class="comment">//</span>
00718 
00719         ((<a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">PWORK_QUEUE_ITEM</a>)WorkerThreadEntry)-&gt;List.Flink = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00720         <a class="code" href="../../d5/d8/ex_8h.html#a261">ExQueueWorkItem</a>( (<a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">PWORK_QUEUE_ITEM</a>)WorkerThreadEntry, CriticalWorkQueue );
00721     }
00722 
00723     <span class="comment">//</span>
00724     <span class="comment">//  And return to our caller</span>
00725     <span class="comment">//</span>
00726 
00727     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, me, <span class="stringliteral">"CcPostWorkQueue -&gt; VOID\n"</span>, 0 );
00728 
00729     <span class="keywordflow">return</span>;
00730 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a204" doxytag="cc.h::CcPrefillVacbLevelZone" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG CcPrefillVacbLevelZone           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberNeeded</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PKIRQL&nbsp;</td>
          <td class="mdname" nowrap> <em>OldIrql</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NeedBcbListHeads</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01931">1931</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00076">CcAcquireVacbLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00079">CcReleaseVacbLock</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00086">CcVacbLevelEntries</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00087">CcVacbLevelFreeList</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00088">CcVacbLevelWithBcbsEntries</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00089">CcVacbLevelWithBcbsFreeList</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00315">VACB_LEVEL_BLOCK_SIZE</a>, and <a class="el" href="../../d5/d5/cc_8h.html#a95">VACB_LEVEL_REFERENCE</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00947">CcReferenceFileOffset()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>.
<p>
<pre class="fragment"><div>01939                    :
01940 
01941     This routine may be called to prefill <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> VacbLevelZone with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of
01942     entries required, and <span class="keywordflow">return</span> with <a class="code" href="../../d5/d2/cachedat_8c.html#a18">CcVacbSpinLock</a> acquired.  This approach <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01943     taken so that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> allocations and RtlZeroMemory calls can occur without
01944     holding any spinlock, yet <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller may proceed to peform a single indivisible
01945     operation without error handling, since there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a guaranteed <a class="code" href="../../d0/d4/mrcf_8c.html#a3">minimum</a> number of
01946     entries in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> zone.
01947 
01948 Arguments:
01949 
01950     NumberNeeded - Number of VacbLevel entries needed, not counting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> possible
01951                    one with Bcb listheads.
01952 
01953     OldIrql = supplies a pointer to where OldIrql should be returned upon acquiring
01954               <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> spinlock.
01955 
01956     NeedBcbListHeads - Supplies <span class="keyword">true</span> <span class="keywordflow">if</span> a level <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> also needed which contains listheads.
01957 
01958 Return Value:
01959 
01960     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffers could not be preallocated, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> otherwise.
01961 
01962 Environment:
01963 
01964     No spinlocks should be held upon entry.
01965 
01966 --*/
01967 
01968 {
01969     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *NextVacbArray;
01970 
01971     <a class="code" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>( OldIrql );
01972 
01973     <span class="comment">//</span>
01974     <span class="comment">//  Loop until there is enough entries, else raise...</span>
01975     <span class="comment">//</span>
01976 
01977     <span class="keywordflow">while</span> ((NumberNeeded &gt; <a class="code" href="../../d5/d2/cachedat_8c.html#a24">CcVacbLevelEntries</a>) ||
01978            (NeedBcbListHeads &amp;&amp; (<a class="code" href="../../d5/d2/cachedat_8c.html#a27">CcVacbLevelWithBcbsFreeList</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>))) {
01979 
01980 
01981         <span class="comment">//</span>
01982         <span class="comment">//  Else release the spinlock so we can do the allocate/zero.</span>
01983         <span class="comment">//</span>
01984 
01985         <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( *OldIrql );
01986 
01987         <span class="comment">//</span>
01988         <span class="comment">//  First handle the case where we need a VacbListHead with Bcb Listheads.</span>
01989         <span class="comment">//  The pointer test is unsafe but see below.</span>
01990         <span class="comment">//</span>
01991 
01992         <span class="keywordflow">if</span> (NeedBcbListHeads &amp;&amp; (<a class="code" href="../../d5/d2/cachedat_8c.html#a27">CcVacbLevelWithBcbsFreeList</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01993 
01994             <span class="comment">//</span>
01995             <span class="comment">//  Allocate and initialize the Vacb block for this level, and store its pointer</span>
01996             <span class="comment">//  back into our parent.  We do not zero the listhead area.</span>
01997             <span class="comment">//</span>
01998 
01999             NextVacbArray =
02000             (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( NonPagedPool, (VACB_LEVEL_BLOCK_SIZE * 2) + <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">VACB_LEVEL_REFERENCE</a>), 'lVcC' );
02001 
02002             <span class="keywordflow">if</span> (NextVacbArray == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02003                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02004             }
02005 
02006             RtlZeroMemory( (PCHAR)NextVacbArray, VACB_LEVEL_BLOCK_SIZE );
02007             RtlZeroMemory( (PCHAR)NextVacbArray + (VACB_LEVEL_BLOCK_SIZE * 2), <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">VACB_LEVEL_REFERENCE</a>) );
02008 
02009             <a class="code" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>( OldIrql );
02010 
02011             NextVacbArray[0] = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>)<a class="code" href="../../d5/d2/cachedat_8c.html#a27">CcVacbLevelWithBcbsFreeList</a>;
02012             <a class="code" href="../../d5/d2/cachedat_8c.html#a27">CcVacbLevelWithBcbsFreeList</a> = NextVacbArray;
02013             <a class="code" href="../../d5/d2/cachedat_8c.html#a26">CcVacbLevelWithBcbsEntries</a> += 1;
02014 
02015         } <span class="keywordflow">else</span> {
02016 
02017             <span class="comment">//</span>
02018             <span class="comment">//  Allocate and initialize the Vacb block for this level, and store its pointer</span>
02019             <span class="comment">//  back into our parent.</span>
02020             <span class="comment">//</span>
02021 
02022             NextVacbArray =
02023             (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( NonPagedPool, VACB_LEVEL_BLOCK_SIZE + <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">VACB_LEVEL_REFERENCE</a>), 'lVcC' );
02024 
02025             <span class="keywordflow">if</span> (NextVacbArray == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02026                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02027             }
02028 
02029             RtlZeroMemory( (PCHAR)NextVacbArray, VACB_LEVEL_BLOCK_SIZE + <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">VACB_LEVEL_REFERENCE</a>) );
02030 
02031             <a class="code" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>( OldIrql );
02032 
02033             NextVacbArray[0] = (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>)<a class="code" href="../../d5/d2/cachedat_8c.html#a25">CcVacbLevelFreeList</a>;
02034             <a class="code" href="../../d5/d2/cachedat_8c.html#a25">CcVacbLevelFreeList</a> = NextVacbArray;
02035             <a class="code" href="../../d5/d2/cachedat_8c.html#a24">CcVacbLevelEntries</a> += 1;
02036         }
02037     }
02038 
02039     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02040 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a196" doxytag="cc.h::CcReferenceFileOffset" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcReferenceFileOffset           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>FileOffset</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00947">947</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00085">CcMaxVacbLevelsSeen</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01931">CcPrefillVacbLevelZone()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00079">CcReleaseVacbLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01077">MODIFIED_WRITE_DISABLED</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00086">SetVacb()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00327">VACB_SIZE_OF_FIRST_LEVEL</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l00628">VACB_SPECIAL_REFERENCE</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>.
<p>
<pre class="fragment"><div>00954                    :
00955 
00956     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a special form of reference that insures that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> multi-level
00957     Vacb structures are expanded to cover a given <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> offset.
00958 
00959 Arguments:
00960 
00961     SharedCacheMap - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Shared Cache Map <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00962 
00963     FileOffset - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired FileOffset within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00964 
00965 Return Value:
00966 
00967     None
00968 
00969 --*/
00970 
00971 {
00972     KIRQL OldIrql;
00973 
00974     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt; DISPATCH_LEVEL);
00975 
00976     <span class="comment">//</span>
00977     <span class="comment">//  This operation only has meaning if the Vacbs are in the multilevel form.</span>
00978     <span class="comment">//</span>
00979 
00980     <span class="keywordflow">if</span> (SharedCacheMap-&gt;SectionSize.QuadPart &gt; <a class="code" href="../../d5/d5/cc_8h.html#a41">VACB_SIZE_OF_FIRST_LEVEL</a>) {
00981 
00982         <span class="comment">//</span>
00983         <span class="comment">//  Prefill the level zone so that we can expand the tree if required.</span>
00984         <span class="comment">//</span>
00985 
00986         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d3/vacbsup_8c.html#a23">CcPrefillVacbLevelZone</a>( CcMaxVacbLevelsSeen - 1,
00987                                      &amp;OldIrql,
00988                                      <a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;Flags, MODIFIED_WRITE_DISABLED) )) {
00989 
00990             <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>( STATUS_INSUFFICIENT_RESOURCES );
00991         }
00992 
00993         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( FileOffset.QuadPart &lt;= SharedCacheMap-&gt;SectionSize.QuadPart );
00994 
00995         <a class="code" href="../../d5/d3/vacbsup_8c.html#a11">SetVacb</a>( SharedCacheMap, FileOffset, VACB_SPECIAL_REFERENCE );
00996 
00997         <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
00998     }
00999 
01000     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt; DISPATCH_LEVEL);
01001 
01002     <span class="keywordflow">return</span>;
01003 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a184" doxytag="cc.h::CcScanDpc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcScanDpc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d6/struct__KDPC.html">PKDPC</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Dpc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>DeferredContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00099">99</a> of file <a class="el" href="../../d6/d0/lazyrite_8c-source.html">lazyrite.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l01847">CcAllocateWorkQueueEntry</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00662">CcPostWorkQueue()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00053">CcRegularWorkQueue</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01535">_WORK_QUEUE_ENTRY::Function</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00129">LazyWriter</a>, <a class="el" href="../../d5/d5/cc_8h.html#a210a169">LazyWriteScan</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l01464">_LAZY_WRITER::ScanActive</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>.
<p>
<pre class="fragment"><div>00108                    :
00109 
00110     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Dpc routine which runs when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> scan timer goes off.  It
00111     simply posts an element <span class="keywordflow">for</span> an Ex Worker thread to <span class="keywordflow">do</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> scan.
00112 
00113 Arguments:
00114 
00115     (All are ignored)
00116 
00117 Return Value:
00118 
00119     None.
00120 
00121 --*/
00122 
00123 {
00124     <a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">PWORK_QUEUE_ENTRY</a> WorkQueueEntry;
00125 
00126     UNREFERENCED_PARAMETER(Dpc);
00127     UNREFERENCED_PARAMETER(DeferredContext);
00128     UNREFERENCED_PARAMETER(SystemArgument1);
00129     UNREFERENCED_PARAMETER(SystemArgument2);
00130 
00131     WorkQueueEntry = <a class="code" href="../../d5/d5/cc_8h.html#a88">CcAllocateWorkQueueEntry</a>();
00132 
00133     <span class="comment">//</span>
00134     <span class="comment">//  If we failed to allocate a WorkQueueEntry, things must</span>
00135     <span class="comment">//  be in pretty bad shape.  However, all we have to do is</span>
00136     <span class="comment">//  say we are not active, and wait for another event to</span>
00137     <span class="comment">//  wake things up again.</span>
00138     <span class="comment">//</span>
00139 
00140     <span class="keywordflow">if</span> (WorkQueueEntry == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00141 
00142         <a class="code" href="../../d5/d2/cachedat_8c.html#a41">LazyWriter</a>.<a class="code" href="../../d3/d9/struct__LAZY__WRITER.html#o5">ScanActive</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00143 
00144     } <span class="keywordflow">else</span> {
00145 
00146         <span class="comment">//</span>
00147         <span class="comment">//  Otherwise post a work queue entry to do the scan.</span>
00148         <span class="comment">//</span>
00149 
00150         WorkQueueEntry-&gt;<a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html#o8">Function</a> = (UCHAR)<a class="code" href="../../d5/d5/cc_8h.html#a210a169">LazyWriteScan</a>;
00151 
00152         <a class="code" href="../../d5/d1/lazyrite_8c.html#a8">CcPostWorkQueue</a>( WorkQueueEntry, &amp;CcRegularWorkQueue );
00153     }
00154 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a185" doxytag="cc.h::CcScheduleLazyWriteScan" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcScheduleLazyWriteScan           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00049">49</a> of file <a class="el" href="../../d6/d0/lazyrite_8c-source.html">lazyrite.c</a>.
<p>
References <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00065">CcFirstDelay</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00066">CcIdleDelay</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00243">KeSetTimer()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00129">LazyWriter</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01464">_LAZY_WRITER::ScanActive</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01457">_LAZY_WRITER::ScanDpc</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01458">_LAZY_WRITER::ScanTimer</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01982">CcDeferWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04232">CcGetFlushedValidData()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00838">CcMdlWriteComplete2()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02560">CcSetDirtyPinnedData()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00158">CcWaitForCurrentLazyWriterActivity()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02804">CcZeroEndOfLastPage()</a>.
<p>
<pre class="fragment"><div>00054                    :
00055 
00056     This routine may be called to schedule <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next lazy writer scan,
00057     during which lazy write and lazy close activity <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> posted to other
00058     worker threads.  Callers should acquire <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lazy writer spin lock
00059     to see <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> scan <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently active, and then call <span class="keyword">this</span> routine
00060     still holding <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> spin lock <span class="keywordflow">if</span> not.  One special call <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used at
00061     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> end of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lazy write scan to propagate lazy write active once
00062     we go active.  This call <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="stringliteral">"the"</span> scan thread, and <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> can therefore
00063     safely schedule <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next scan without taking <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> spin lock.
00064 
00065 Arguments:
00066 
00067     None
00068 
00069 Return Value:
00070 
00071     None.
00072 
00073 --*/
00074 
00075 {
00076     <span class="comment">//</span>
00077     <span class="comment">//  It is important to set the active flag TRUE first for the propagate</span>
00078     <span class="comment">//  case, because it is conceivable that once the timer is set, another</span>
00079     <span class="comment">//  thread could actually run and make the scan go idle before we then</span>
00080     <span class="comment">//  jam the flag TRUE.</span>
00081     <span class="comment">//</span>
00082     <span class="comment">//  When going from idle to active, we delay a little longer to let the</span>
00083     <span class="comment">//  app finish saving its file.</span>
00084     <span class="comment">//</span>
00085 
00086     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d2/cachedat_8c.html#a41">LazyWriter</a>.<a class="code" href="../../d3/d9/struct__LAZY__WRITER.html#o5">ScanActive</a>) {
00087 
00088         <a class="code" href="../../d3/d2/timerobj_8c.html#a6">KeSetTimer</a>( &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a41">LazyWriter</a>.<a class="code" href="../../d3/d9/struct__LAZY__WRITER.html#o4">ScanTimer</a>, CcIdleDelay, &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a41">LazyWriter</a>.<a class="code" href="../../d3/d9/struct__LAZY__WRITER.html#o3">ScanDpc</a> );
00089 
00090     } <span class="keywordflow">else</span> {
00091 
00092         <a class="code" href="../../d5/d2/cachedat_8c.html#a41">LazyWriter</a>.<a class="code" href="../../d3/d9/struct__LAZY__WRITER.html#o5">ScanActive</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00093         <a class="code" href="../../d3/d2/timerobj_8c.html#a6">KeSetTimer</a>( &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a41">LazyWriter</a>.<a class="code" href="../../d3/d9/struct__LAZY__WRITER.html#o4">ScanTimer</a>, CcFirstDelay, &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a41">LazyWriter</a>.<a class="code" href="../../d3/d9/struct__LAZY__WRITER.html#o3">ScanDpc</a> );
00094     }
00095 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a179" doxytag="cc.h::CcSetDirtyInMask" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcSetDirtyInMask           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>FileOffset</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">2242</a> of file <a class="el" href="../../d7/d1/cachesub_8c-source.html">cachesub.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01144">_BITMAP_RANGE::BasePage</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01163">_BITMAP_RANGE::Bitmap</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01222">_MBCB::BitmapRange1</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01223">_MBCB::BitmapRange2</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01224">_MBCB::BitmapRange3</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01206">_MBCB::BitmapRanges</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00157">CACHE_NTC_MBCB</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00159">CACHE_NTC_MBCB_GRANDE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00070">CcAcquireMasterLockAtDpcLevel</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00082">CcAcquireVacbLockAtDpcLevel</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02048">CcAllocateVacbLevel()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02070">CcDeallocateVacbLevel()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00031">CcDirtySharedCacheMapList</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01996">CcFindBitmapRangeToDirty()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01931">CcPrefillVacbLevelZone()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00073">CcReleaseMasterLockFromDpcLevel</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00079">CcReleaseVacbLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00085">CcReleaseVacbLockFromDpcLevel</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00049">CcScheduleLazyWriteScan()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00103">CcTotalDirtyPages</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01194">_MBCB::DirtyPages</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01157">_BITMAP_RANGE::DirtyPages</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01150">_BITMAP_RANGE::FirstDirtyPage</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01151">_BITMAP_RANGE::LastDirtyPage</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00129">LazyWriter</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01137">_BITMAP_RANGE::Links</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00364">MBCB_BITMAP_INITIAL_SIZE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00358">MBCB_BITMAP_RANGE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01180">_MBCB::NodeTypeCode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00600">PAGE_SHIFT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00513">QuadAlign</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01213">_MBCB::ResumeWritePage</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01464">_LAZY_WRITER::ScanActive</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l01113">_SHARED_CACHE_MAP_LIST_CURSOR::SharedCacheMapLinks</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">CcFreeActiveVacb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00838">CcMdlWriteComplete2()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00466">CcPrepareMdlWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02194">CcPurgeAndClearCacheSection()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03758">CcReleaseByteRangeFromWrite()</a>.
<p>
<pre class="fragment"><div>02250                    :
02251 
02252     This routine may be called to set a range of pages dirty in a user data
02253     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>, by just setting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> corresponding bits in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mask bcb.
02254 
02255     IMPORTANT NOTE:
02256 
02257         If <span class="keyword">this</span> routine fails to set any bits due to an allocation <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>,
02258         <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> just returns quietly without informing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller.  (Note that <span class="keyword">this</span>
02259         routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> never called <span class="keywordflow">for</span> no modified write sections.)  The <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a>
02260         <span class="keywordflow">for</span> <span class="keyword">this</span> behavior <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> that <span class="keyword">this</span> routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> sometimes called as part of
02261         error recovery (CcFreeActiveVacb, CcMdlWriteComplete, etc.) when it is
02262         essential to just keep on moving.  Note that <span class="keywordflow">if</span> an allocation failure does
02263         occur, <span class="keyword">this</span> only means that MM will have to flush the modified page in
02264         time, since the Lazy Writer will not <span class="keywordflow">do</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.
02265 
02266 Arguments:
02267 
02268     SharedCacheMap - SharedCacheMap where the pages are to be set dirty.
02269 
02270     FileOffset - FileOffset of first page to set dirty
02271 
02272     Length - Used in conjunction with FileOffset to determine how many pages
02273              to set dirty.
02274 
02275 Return Value:
02276 
02277     None
02278 
02279 --*/
02280 
02281 {
02282     KIRQL OldIrql;
02283     <a class="code" href="../../d9/d6/struct__MBCB.html">PMBCB</a> Mbcb;
02284     <a class="code" href="../../d8/d3/struct__BITMAP__RANGE.html">PBITMAP_RANGE</a> BitmapRange;
02285     LONGLONG FirstPage;
02286     LONGLONG LastPage;
02287     PULONG MaskPtr;
02288     ULONG Mask = 0;
02289     PULONG Bitmap = NULL;
02290     ULONG AllocationError = FALSE;
02291 
02292     <span class="comment">//</span>
02293     <span class="comment">//  We assume no caller can cross a bitmap range boundary (currently not even</span>
02294     <span class="comment">//  a view boundary!), so we do not want to loop through bitmap ranges.</span>
02295     <span class="comment">//</span>
02296 
02297     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((FileOffset-&gt;QuadPart / MBCB_BITMAP_RANGE) ==
02298            ((FileOffset-&gt;QuadPart + Length - 1) / MBCB_BITMAP_RANGE));
02299 
02300     <span class="comment">//</span>
02301     <span class="comment">//  Initialize our locals.</span>
02302     <span class="comment">//</span>
02303 
02304     FirstPage = FileOffset-&gt;QuadPart &gt;&gt; PAGE_SHIFT;
02305     LastPage = ((FileOffset-&gt;QuadPart + Length - 1) &gt;&gt; PAGE_SHIFT);
02306 
02307     <span class="comment">//</span>
02308     <span class="comment">//  If we have to convert to an Mbcb grande, we will loop back here to</span>
02309     <span class="comment">//  preallocate another buffer.</span>
02310     <span class="comment">//</span>
02311 
02312     <span class="keywordflow">do</span> {
02313 
02314         <span class="comment">//</span>
02315         <span class="comment">//  For large streams, we need to preallocate a block we use for</span>
02316         <span class="comment">//  we use for bitmaps.  We allocate one, then loop back in the rare</span>
02317         <span class="comment">//  case where we will need another.  We free it at the bottom if we</span>
02318         <span class="comment">//  don't need one.</span>
02319         <span class="comment">//</span>
02320 
02321         if (SharedCacheMap-&gt;SectionSize.QuadPart &gt; (MBCB_BITMAP_INITIAL_SIZE * 8 * PAGE_SIZE)) {
02322 
02323             <span class="comment">//</span>
02324             <span class="comment">//  If we could not preallocate, break out into common cleanup code and</span>
02325             <span class="comment">//  return quietly.</span>
02326             <span class="comment">//</span>
02327 
02328             if (!<a class="code" href="../../d5/d3/vacbsup_8c.html#a23">CcPrefillVacbLevelZone</a>( 1, &amp;OldIrql, FALSE )) {
02329                 <span class="keywordflow">return</span>;
02330             }
02331 
02332             Bitmap = (PULONG)<a class="code" href="../../d5/d5/cc_8h.html#a206">CcAllocateVacbLevel</a>( FALSE );
02333             <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
02334         }
02335 
02336         <span class="comment">//</span>
02337         <span class="comment">//  Acquire the Mbcb spinlock.</span>
02338         <span class="comment">//</span>
02339 
02340         ExAcquireSpinLock( &amp;SharedCacheMap-&gt;BcbSpinLock, &amp;OldIrql );
02341 
02342         <span class="comment">//</span>
02343         <span class="comment">//  If there is no Mbcb, we will have to allocate one.</span>
02344         <span class="comment">//</span>
02345 
02346         Mbcb = SharedCacheMap-&gt;Mbcb;
02347         if (Mbcb == NULL) {
02348 
02349             <span class="comment">//</span>
02350             <span class="comment">//  Since we use the Bcb zone, we must assume that Bcbs are big enough.</span>
02351             <span class="comment">//</span>
02352 
02353             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d5/cc_8h.html#a62">QuadAlign</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d6/struct__MBCB.html">MBCB</a>)) &lt;= <a class="code" href="../../d5/d5/cc_8h.html#a62">QuadAlign</a>(<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d3/struct__BCB.html">BCB</a>)));
02354 
02355             <span class="comment">//</span>
02356             <span class="comment">//  Allocate the Mbcb from the Bcb zone.</span>
02357             <span class="comment">//</span>
02358 
02359             Mbcb = (<a class="code" href="../../d9/d6/struct__MBCB.html">PMBCB</a>)<a class="code" href="../../d6/d2/cachesub_8c.html#a5">CcAllocateInitializeBcb</a>( NULL, NULL, NULL, NULL );
02360 
02361             <span class="comment">//</span>
02362             <span class="comment">//  If we could not allocate an Mbcb, break out to clean up and return</span>
02363             <span class="comment">//</span>
02364 
02365             <span class="keywordflow">if</span> (Mbcb == NULL) {
02366                 <span class="keywordflow">break</span>;
02367             }
02368 
02369             <span class="comment">//</span>
02370             <span class="comment">//  Set in the node type, and initialize the listhead of ranges.</span>
02371             <span class="comment">//</span>
02372 
02373             Mbcb-&gt;<a class="code" href="../../d4/d3/struct__BCB.html#o0">NodeTypeCode</a> = CACHE_NTC_MBCB;
02374             InitializeListHead( &amp;Mbcb-&gt;BitmapRanges );
02375 
02376             <span class="comment">//</span>
02377             <span class="comment">//  Insert and initialize the first range.</span>
02378             <span class="comment">//</span>
02379 
02380             InsertTailList( &amp;Mbcb-&gt;BitmapRanges, &amp;Mbcb-&gt;BitmapRange1.Links );
02381             Mbcb-&gt;BitmapRange1.FirstDirtyPage = MAXULONG;
02382 
02383             <span class="comment">//</span>
02384             <span class="comment">//  Use the rest of the Mbcb as the initial bitmap.</span>
02385             <span class="comment">//</span>
02386 
02387             Mbcb-&gt;BitmapRange1.Bitmap = (PULONG)&amp;Mbcb-&gt;BitmapRange2;
02388 
02389             <span class="comment">//</span>
02390             <span class="comment">//  Now set to use our new Mbcb.</span>
02391             <span class="comment">//</span>
02392 
02393             SharedCacheMap-&gt;Mbcb = Mbcb;
02394         }
02395 
02396         <span class="comment">//</span>
02397         <span class="comment">//  Now see if we need to switch to the Mbcb grande format.</span>
02398         <span class="comment">//</span>
02399 
02400         <span class="keywordflow">if</span> ((LastPage &gt;= (<a class="code" href="../../d5/d5/cc_8h.html#a45">MBCB_BITMAP_INITIAL_SIZE</a> * 8)) &amp;&amp;
02401             (Mbcb-&gt;NodeTypeCode != <a class="code" href="../../d5/d5/cc_8h.html#a18">CACHE_NTC_MBCB_GRANDE</a>)) {
02402 
02403             <span class="comment">//</span>
02404             <span class="comment">//  If there are any dirty pages, copy the initial bitmap over, and zero</span>
02405             <span class="comment">//  out the original end of the Mbcb for reuse.</span>
02406             <span class="comment">//</span>
02407 
02408             <span class="keywordflow">if</span> (Mbcb-&gt;BitmapRange1.DirtyPages != 0) {
02409                 RtlCopyMemory( Bitmap, Mbcb-&gt;BitmapRange1.Bitmap, MBCB_BITMAP_INITIAL_SIZE );
02410                 RtlZeroMemory( Mbcb-&gt;BitmapRange1.Bitmap, MBCB_BITMAP_INITIAL_SIZE );
02411             }
02412 
02413             <span class="comment">//</span>
02414             <span class="comment">//  Store the new bitmap pointer and show we have consumed this one.</span>
02415             <span class="comment">//</span>
02416 
02417             Mbcb-&gt;BitmapRange1.Bitmap = Bitmap;
02418             Bitmap = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02419 
02420             <span class="comment">//</span>
02421             <span class="comment">//  Insert and initialize the first range.</span>
02422             <span class="comment">//</span>
02423 
02424             InsertTailList( &amp;Mbcb-&gt;BitmapRanges, &amp;Mbcb-&gt;BitmapRange2.Links );
02425             Mbcb-&gt;BitmapRange2.BasePage = MAXLONGLONG;
02426             Mbcb-&gt;BitmapRange2.FirstDirtyPage = MAXULONG;
02427             InsertTailList( &amp;Mbcb-&gt;BitmapRanges, &amp;Mbcb-&gt;BitmapRange3.Links );
02428             Mbcb-&gt;BitmapRange3.BasePage = MAXLONGLONG;
02429             Mbcb-&gt;BitmapRange3.FirstDirtyPage = MAXULONG;
02430             Mbcb-&gt;NodeTypeCode = <a class="code" href="../../d5/d5/cc_8h.html#a18">CACHE_NTC_MBCB_GRANDE</a>;
02431 
02432             <span class="comment">//</span>
02433             <span class="comment">//  This is a one-time event - converting to the large Mbcb.  Continue back</span>
02434             <span class="comment">//  to preallocate another buffer for CcFindBitmapRangeToDirty.</span>
02435             <span class="comment">//</span>
02436 
02437             ExReleaseSpinLock( &amp;SharedCacheMap-&gt;BcbSpinLock, OldIrql );
02438             <span class="keywordflow">continue</span>;
02439         }
02440 
02441         <span class="comment">//</span>
02442         <span class="comment">//  Now find the Bitmap range we are setting bits in.</span>
02443         <span class="comment">//</span>
02444 
02445         BitmapRange = <a class="code" href="../../d6/d2/cachesub_8c.html#a9">CcFindBitmapRangeToDirty</a>( Mbcb, FirstPage, &amp;Bitmap );
02446 
02447         <span class="comment">//</span>
02448         <span class="comment">//  If we could not allocate this dinky structure, break out quietly.</span>
02449         <span class="comment">//</span>
02450 
02451         <span class="keywordflow">if</span> (BitmapRange == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02452             <span class="keywordflow">break</span>;
02453         }
02454 
02455         <span class="comment">//</span>
02456         <span class="comment">//  Now update the first and last dirty page indices and the bitmap.</span>
02457         <span class="comment">//</span>
02458 
02459         <span class="keywordflow">if</span> (FirstPage &lt; (BitmapRange-&gt;BasePage + BitmapRange-&gt;FirstDirtyPage)) {
02460             BitmapRange-&gt;FirstDirtyPage = (ULONG)(FirstPage - BitmapRange-&gt;BasePage);
02461         }
02462 
02463         <span class="keywordflow">if</span> (LastPage &gt; (BitmapRange-&gt;BasePage + BitmapRange-&gt;LastDirtyPage)) {
02464             BitmapRange-&gt;LastDirtyPage = (ULONG)(LastPage - BitmapRange-&gt;BasePage);
02465         }
02466 
02467         <span class="comment">//</span>
02468         <span class="comment">//  We have to acquire the shared cache map list, because we</span>
02469         <span class="comment">//  may be changing lists.</span>
02470         <span class="comment">//</span>
02471 
02472         <a class="code" href="../../d5/d5/cc_8h.html#a2">CcAcquireMasterLockAtDpcLevel</a>();
02473 
02474         <span class="comment">//</span>
02475         <span class="comment">//  If this is the first dirty page for this cache map, there is some work</span>
02476         <span class="comment">//  to do.</span>
02477         <span class="comment">//</span>
02478 
02479         <span class="keywordflow">if</span> (SharedCacheMap-&gt;DirtyPages == 0) {
02480 
02481             <span class="comment">//</span>
02482             <span class="comment">//  If the lazy write scan is not active, then start it.</span>
02483             <span class="comment">//</span>
02484 
02485             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d2/cachedat_8c.html#a41">LazyWriter</a>.<a class="code" href="../../d3/d9/struct__LAZY__WRITER.html#o5">ScanActive</a>) {
02486                 <a class="code" href="../../d5/d5/cc_8h.html#a185">CcScheduleLazyWriteScan</a>();
02487             }
02488 
02489             <span class="comment">//</span>
02490             <span class="comment">//  Move to the dirty list.</span>
02491             <span class="comment">//</span>
02492 
02493             RemoveEntryList( &amp;SharedCacheMap-&gt;SharedCacheMapLinks );
02494             InsertTailList( &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a2">CcDirtySharedCacheMapList</a>.<a class="code" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html#o0">SharedCacheMapLinks</a>,
02495                             &amp;SharedCacheMap-&gt;SharedCacheMapLinks );
02496 
02497             Mbcb-&gt;ResumeWritePage = FirstPage;
02498         }
02499 
02500         MaskPtr = &amp;BitmapRange-&gt;Bitmap[(ULONG)(FirstPage - BitmapRange-&gt;BasePage) / 32];
02501         Mask = 1 &lt;&lt; ((ULONG)FirstPage % 32);
02502 
02503         <span class="comment">//</span>
02504         <span class="comment">//  Loop to set all of the bits and adjust the DirtyPage totals.</span>
02505         <span class="comment">//</span>
02506 
02507         <span class="keywordflow">for</span> ( ; FirstPage &lt;= LastPage; FirstPage++) {
02508 
02509             <span class="keywordflow">if</span> ((*MaskPtr &amp; Mask) == 0) {
02510 
02511                 <a class="code" href="../../d5/d2/cachedat_8c.html#a36">CcTotalDirtyPages</a> += 1;
02512                 SharedCacheMap-&gt;DirtyPages += 1;
02513                 Mbcb-&gt;DirtyPages += 1;
02514                 BitmapRange-&gt;DirtyPages += 1;
02515                 *MaskPtr |= Mask;
02516             }
02517 
02518             Mask &lt;&lt;= 1;
02519 
02520             <span class="keywordflow">if</span> (Mask == 0) {
02521 
02522                 MaskPtr += 1;
02523                 Mask = 1;
02524             }
02525         }
02526 
02527         <span class="comment">//</span>
02528         <span class="comment">//  See if we need to advance our goal for ValidDataLength.</span>
02529         <span class="comment">//</span>
02530 
02531         LastPage = FileOffset-&gt;QuadPart + Length;
02532 
02533         <span class="keywordflow">if</span> (LastPage &gt; SharedCacheMap-&gt;ValidDataGoal.QuadPart) {
02534             SharedCacheMap-&gt;ValidDataGoal.QuadPart = (LONGLONG)LastPage;
02535         }
02536 
02537         <a class="code" href="../../d5/d5/cc_8h.html#a3">CcReleaseMasterLockFromDpcLevel</a>();
02538 
02539     <span class="comment">//</span>
02540     <span class="comment">//  Continue until we have actually set the bits (there is a continue</span>
02541     <span class="comment">//  which just wants to loop back and allocate another buffer).</span>
02542     <span class="comment">//</span>
02543 
02544     } <span class="keywordflow">while</span> (Mask == 0);
02545 
02546     <span class="comment">//</span>
02547     <span class="comment">//  Now if we preallocated a bitmap buffer, free it on the way out.</span>
02548     <span class="comment">//</span>
02549 
02550     <span class="keywordflow">if</span> (Bitmap != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02551         <a class="code" href="../../d5/d5/cc_8h.html#a6">CcAcquireVacbLockAtDpcLevel</a>();
02552         <a class="code" href="../../d5/d5/cc_8h.html#a207">CcDeallocateVacbLevel</a>( (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> *)Bitmap, FALSE );
02553         <a class="code" href="../../d5/d5/cc_8h.html#a7">CcReleaseVacbLockFromDpcLevel</a>();
02554     }
02555     ExReleaseSpinLock( &amp;SharedCacheMap-&gt;BcbSpinLock, OldIrql );
02556 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a186" doxytag="cc.h::CcStartLazyWriter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcStartLazyWriter           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NotUsed</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a201" doxytag="cc.h::CcUnmapVacbArray" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FASTCALL CcUnmapVacbArray           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLARGE_INTEGER FileOffset&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>UnmapBehind</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01784">1784</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00076">CcAcquireVacbLock</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02044">CcDrainVacbLevelZone()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00163">CcMoveVacbToReuseHead</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00079">CcReleaseVacbLock</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01156">CcUnmapVacb()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00078">GetVacb</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d5/struct__VACB.html#o4">_VACB::Overlay</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00086">SetVacb()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00589">_VACB::SharedCacheMap</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d1/cache_8h-source.html#l00030">VACB_MAPPING_GRANULARITY</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02563">CcUnmapAndPurge()</a>.
<p>
<pre class="fragment"><div>01793                    :
01794 
01795     This routine must be called to <span class="keywordflow">do</span> any unmapping and associated
01796     cleanup <span class="keywordflow">for</span> a shared cache map, just before <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> deleted.
01797 
01798 Arguments:
01799 
01800     SharedCacheMap - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> shared cache map
01801                      which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> about to be deleted.
01802 
01803     FileOffset - If supplied, <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> unmap <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified offset and length
01804 
01805     Length - Completes range to unmap <span class="keywordflow">if</span> FileOffset specified.  If FileOffset
01806              <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified, Length of 0 means unmap to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> end of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section.
01807 
01808     UnmapBehind - If <span class="keyword">this</span> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a result of our unmap behind logic
01809 
01810 Return Value:
01811 
01812     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> -- <span class="keywordflow">if</span> an <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unmap was not done due to an active vacb
01813     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> -- <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unmap was done
01814 
01815 --*/
01816 
01817 {
01818     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> Vacb;
01819     KIRQL OldIrql;
01820     LARGE_INTEGER StartingFileOffset = {0,0};
01821     LARGE_INTEGER EndingFileOffset = SharedCacheMap-&gt;SectionSize;
01822 
01823     <span class="comment">//</span>
01824     <span class="comment">//  We could be just cleaning up for error recovery.</span>
01825     <span class="comment">//</span>
01826 
01827     <span class="keywordflow">if</span> (SharedCacheMap-&gt;Vacbs == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01828         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01829     }
01830 
01831     <span class="comment">//</span>
01832     <span class="comment">//  See if a range was specified. Align it to the VACB boundaries so it</span>
01833     <span class="comment">//  works in the loop below  </span>
01834     <span class="comment">//</span>
01835 
01836     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(FileOffset)) {
01837         StartingFileOffset.QuadPart = ((FileOffset-&gt;QuadPart) &amp; (~((LONGLONG)<a class="code" href="../../d4/d2/cache_8h.html#a0">VACB_MAPPING_GRANULARITY</a> - 1)));
01838         <span class="keywordflow">if</span> (Length != 0) {
01839 
01840             EndingFileOffset.QuadPart = FileOffset-&gt;QuadPart + Length;
01841                 
01842         }
01843     }
01844 
01845     <span class="comment">//</span>
01846     <span class="comment">//  Acquire the spin lock to</span>
01847     <span class="comment">//</span>
01848 
01849     <a class="code" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>( &amp;OldIrql );
01850 
01851     <span class="keywordflow">while</span> (StartingFileOffset.QuadPart &lt; EndingFileOffset.QuadPart) {
01852 
01853         <span class="comment">//</span>
01854         <span class="comment">//  Note that the caller with an explicit range may be off the</span>
01855         <span class="comment">//  end of the section (example CcPurgeCacheSection for cache</span>
01856         <span class="comment">//  coherency).  That is the reason for the first part of the</span>
01857         <span class="comment">//  test below.</span>
01858         <span class="comment">//</span>
01859         <span class="comment">//  Check the next cell once without the spin lock, it probably will</span>
01860         <span class="comment">//  not change, but we will handle it if it does not.</span>
01861         <span class="comment">//</span>
01862 
01863         <span class="keywordflow">if</span> ((StartingFileOffset.QuadPart &lt; SharedCacheMap-&gt;SectionSize.QuadPart) &amp;&amp;
01864             ((Vacb = <a class="code" href="../../d5/d3/vacbsup_8c.html#a1">GetVacb</a>( SharedCacheMap, StartingFileOffset )) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01865 
01866             <span class="comment">//</span>
01867             <span class="comment">//  Return here if we are unlucky and see an active</span>
01868             <span class="comment">//  Vacb.  It could be Purge calling, and the Lazy Writer</span>
01869             <span class="comment">//  may have done a CcGetVirtualAddressIfMapped!</span>
01870             <span class="comment">//</span>
01871 
01872             <span class="keywordflow">if</span> (Vacb-&gt;<a class="code" href="../../d2/d5/struct__VACB.html#o4">Overlay</a>.ActiveCount != 0) {
01873 
01874                 <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
01875                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01876             }
01877 
01878             <span class="comment">//</span>
01879             <span class="comment">//  Unlink it from the other SharedCacheMap, so the other</span>
01880             <span class="comment">//  guy will not try to use it when we free the spin lock.</span>
01881             <span class="comment">//</span>
01882 
01883             <a class="code" href="../../d5/d3/vacbsup_8c.html#a11">SetVacb</a>( SharedCacheMap, StartingFileOffset, NULL );
01884             Vacb-&gt;<a class="code" href="../../d2/d5/struct__VACB.html#o1">SharedCacheMap</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01885 
01886             <span class="comment">//</span>
01887             <span class="comment">//  Increment the open count so that no one else will</span>
01888             <span class="comment">//  try to unmap or reuse until we are done.</span>
01889             <span class="comment">//</span>
01890 
01891             Vacb-&gt;<a class="code" href="../../d2/d5/struct__VACB.html#o4">Overlay</a>.ActiveCount += 1;
01892 
01893             <span class="comment">//</span>
01894             <span class="comment">//  Release the spin lock.</span>
01895             <span class="comment">//</span>
01896 
01897             <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
01898 
01899             <span class="comment">//</span>
01900             <span class="comment">//  Unmap and free it if we really got it above.</span>
01901             <span class="comment">//</span>
01902 
01903             <a class="code" href="../../d5/d3/vacbsup_8c.html#a6">CcUnmapVacb</a>( Vacb, SharedCacheMap, UnmapBehind );
01904 
01905             <span class="comment">//</span>
01906             <span class="comment">//  Reacquire the spin lock so that we can decrment the count.</span>
01907             <span class="comment">//</span>
01908 
01909             <a class="code" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>( &amp;OldIrql );
01910             Vacb-&gt;<a class="code" href="../../d2/d5/struct__VACB.html#o4">Overlay</a>.ActiveCount -= 1;
01911 
01912             <span class="comment">//</span>
01913             <span class="comment">//  Place this VACB at the head of the LRU</span>
01914             <span class="comment">//</span>
01915 
01916             <a class="code" href="../../d5/d3/vacbsup_8c.html#a2">CcMoveVacbToReuseHead</a>( Vacb );
01917         }
01918 
01919         StartingFileOffset.QuadPart = StartingFileOffset.QuadPart + <a class="code" href="../../d4/d2/cache_8h.html#a0">VACB_MAPPING_GRANULARITY</a>;
01920     }
01921 
01922     <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
01923 
01924     <a class="code" href="../../d5/d5/cc_8h.html#a205">CcDrainVacbLevelZone</a>();
01925 
01926     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01927 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a176" doxytag="cc.h::CcUnpinFileData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL CcUnpinFileData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d4/d3/struct__BCB.html">PBCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Bcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ReadOnly</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d5/cc_8h.html#a211">UNMAP_ACTIONS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>UnmapAction</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">974</a> of file <a class="el" href="../../d7/d1/cachesub_8c-source.html">cachesub.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00965">_SHARED_CACHE_MAP::BcbSpinLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00155">CACHE_NTC_BCB</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00153">CACHE_NTC_SHARED_CACHE_MAP</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00070">CcAcquireMasterLockAtDpcLevel</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00082">CcAcquireVacbLockAtDpcLevel</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01998">CcBcbSpinLock</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00083">CcBeyondVacbs</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00185">CcBugCheck</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00030">CcCleanSharedCacheMapList</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05694">CcDeallocateBcb()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00862">CcFreeVirtualAddress()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00099">CcPagesYetToWrite</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00073">CcReleaseMasterLockFromDpcLevel</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00085">CcReleaseVacbLockFromDpcLevel</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00103">CcTotalDirtyPages</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00409">CcUnlockVacbLevel</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00082">CcVacbs</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00846">_SHARED_CACHE_MAP::DirtyPages</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02393">ExReleaseResource</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00832">_SHARED_CACHE_MAP::Flags</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00033">me</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01077">MODIFIED_WRITE_DISABLED</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00733">_SHARED_CACHE_MAP::NodeTypeCode</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00740">_SHARED_CACHE_MAP::OpenCount</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00600">PAGE_SHIFT</a>, <a class="el" href="../../d5/d5/cc_8h.html#a98">PVACB</a>, <a class="el" href="../../d5/d5/cc_8h.html#a211a173">SET_CLEAN</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00826">_SHARED_CACHE_MAP::SharedCacheMapLinks</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d5/cc_8h.html#a211a171">UNPIN</a>, and <a class="el" href="../../d5/d5/cc_8h.html#a211a172">UNREF</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l00031">CcCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01075">CcCopyWrite()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00142">CcGetDirtyPages()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00052">CcMapData()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00116">CcPinFileData()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03758">CcReleaseByteRangeFromWrite()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l01000">CcUnpinData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l01142">CcUnpinDataForThread()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05143">CcUnpinRepinnedBcb()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>.
<p>
<pre class="fragment"><div>00982                    :
00983 
00984     This routine umaps and unlocks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified buffer, which was previously
00985     locked and mapped by calling <a class="code" href="../../d6/d2/cachesub_8c.html#a12">CcPinFileData</a>.
00986 
00987 Arguments:
00988 
00989     Bcb - Pointer previously returned from <a class="code" href="../../d6/d2/cachesub_8c.html#a12">CcPinFileData</a>.  As may be
00990           seen above, <span class="keyword">this</span> pointer may be either a Bcb or a Vacb.
00991 
00992     ReadOnly - must specify same value as when data was mapped
00993 
00994     UnmapAction - <a class="code" href="../../d5/d5/cc_8h.html#a211a171">UNPIN</a> or <a class="code" href="../../d5/d5/cc_8h.html#a211a173">SET_CLEAN</a>
00995 
00996 Return Value:
00997 
00998     None
00999 
01000 --*/
01001 
01002 {
01003     KIRQL OldIrql;
01004     <a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a> SharedCacheMap;
01005 
01006     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, me, <span class="stringliteral">"CcUnpinFileData &gt;Bcb = %08lx\n"</span>, Bcb );
01007 
01008     <span class="comment">//</span>
01009     <span class="comment">//  Note, since we have to allocate so many Vacbs, we do not use</span>
01010     <span class="comment">//  a node type code.  However, the Vacb starts with a BaseAddress,</span>
01011     <span class="comment">//  so we assume that the low byte of the Bcb node type code has</span>
01012     <span class="comment">//  some bits set, which a page-aligned Base Address cannot.</span>
01013     <span class="comment">//</span>
01014 
01015     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( (CACHE_NTC_BCB &amp; 0xFF) != 0 );
01016 
01017     <span class="keywordflow">if</span> (Bcb-&gt;NodeTypeCode != <a class="code" href="../../d5/d5/cc_8h.html#a14">CACHE_NTC_BCB</a>) {
01018 
01019         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(((<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>)Bcb &gt;= CcVacbs) &amp;&amp; ((<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>)Bcb &lt; CcBeyondVacbs));
01020         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(((<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>)Bcb)-&gt;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o0">NodeTypeCode</a> == CACHE_NTC_SHARED_CACHE_MAP);
01021 
01022         <a class="code" href="../../d5/d3/vacbsup_8c.html#a16">CcFreeVirtualAddress</a>( (<a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a>)Bcb );
01023 
01024         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, me, <span class="stringliteral">"CcUnpinFileData -&gt; VOID (simple release)\n"</span>, 0 );
01025 
01026         <span class="keywordflow">return</span>;
01027     }
01028 
01029     SharedCacheMap = Bcb-&gt;SharedCacheMap;
01030 
01031     <span class="comment">//</span>
01032     <span class="comment">//  We treat Bcbs as ReadOnly (do not acquire resource) if they</span>
01033     <span class="comment">//  are in sections for which we have not disabled modified writing.</span>
01034     <span class="comment">//</span>
01035 
01036     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o18">Flags</a>, MODIFIED_WRITE_DISABLED) ||
01037         UnmapAction == <a class="code" href="../../d5/d5/cc_8h.html#a211a172">UNREF</a>) {
01038         ReadOnly = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01039     }
01040 
01041     <span class="comment">//</span>
01042     <span class="comment">//  Synchronize</span>
01043     <span class="comment">//</span>
01044 
01045     ExAcquireSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, &amp;OldIrql );
01046 
01047     <span class="keywordflow">switch</span> (UnmapAction) {
01048 
01049     <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/cc_8h.html#a211a171">UNPIN</a>:
01050     <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/cc_8h.html#a211a172">UNREF</a>:
01051 
01052         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Bcb-&gt;PinCount &gt; 0 );
01053 
01054         Bcb-&gt;PinCount -= 1;
01055         <span class="keywordflow">break</span>;
01056 
01057     <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/cc_8h.html#a211a173">SET_CLEAN</a>:
01058 
01059         <span class="keywordflow">if</span> (Bcb-&gt;Dirty) {
01060 
01061             ULONG Pages = Bcb-&gt;ByteLength &gt;&gt; <a class="code" href="../../d6/d7/halmips_8h.html#a447">PAGE_SHIFT</a>;
01062 
01063             <span class="comment">//</span>
01064             <span class="comment">//  Reverse the rest of the actions taken when the Bcb was set dirty.</span>
01065             <span class="comment">//</span>
01066 
01067             Bcb-&gt;Dirty = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01068 
01069             <a class="code" href="../../d5/d5/cc_8h.html#a2">CcAcquireMasterLockAtDpcLevel</a>();
01070 
01071             SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o20">DirtyPages</a> -= Pages;
01072             <a class="code" href="../../d5/d2/cachedat_8c.html#a36">CcTotalDirtyPages</a> -= Pages;
01073 
01074             <span class="comment">//</span>
01075             <span class="comment">//  Normally we need to reduce CcPagesYetToWrite appropriately.</span>
01076             <span class="comment">//</span>
01077 
01078             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d2/cachedat_8c.html#a32">CcPagesYetToWrite</a> &gt; Pages) {
01079                 <a class="code" href="../../d5/d2/cachedat_8c.html#a32">CcPagesYetToWrite</a> -= Pages;
01080             } <span class="keywordflow">else</span> {
01081                 <a class="code" href="../../d5/d2/cachedat_8c.html#a32">CcPagesYetToWrite</a> = 0;
01082             }
01083 
01084             <span class="comment">//</span>
01085             <span class="comment">//  Remove SharedCacheMap from dirty list if nothing more dirty,</span>
01086             <span class="comment">//  and someone still has the cache map opened.</span>
01087             <span class="comment">//</span>
01088 
01089             <span class="keywordflow">if</span> ((SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o20">DirtyPages</a> == 0) &amp;&amp;
01090                 (SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o2">OpenCount</a> != 0)) {
01091 
01092                 RemoveEntryList( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o17">SharedCacheMapLinks</a> );
01093                 InsertTailList( &amp;CcCleanSharedCacheMapList,
01094                                 &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o17">SharedCacheMapLinks</a> );
01095             }
01096 
01097             <a class="code" href="../../d5/d5/cc_8h.html#a3">CcReleaseMasterLockFromDpcLevel</a>();
01098         }
01099 
01100         <span class="keywordflow">break</span>;
01101 
01102     <span class="keywordflow">default</span>:
01103         <a class="code" href="../../d5/d5/cc_8h.html#a28">CcBugCheck</a>( UnmapAction, 0, 0 );
01104     }
01105 
01106     <span class="comment">//</span>
01107     <span class="comment">//  If we brought it to 0, then we have to kill it.</span>
01108     <span class="comment">//</span>
01109 
01110     <span class="keywordflow">if</span> (Bcb-&gt;PinCount == 0) {
01111 
01112         <span class="comment">//</span>
01113         <span class="comment">//  If the Bcb is Dirty, we only release the resource and unmap now.</span>
01114         <span class="comment">//</span>
01115 
01116         <span class="keywordflow">if</span> (Bcb-&gt;Dirty) {
01117 
01118             <span class="keywordflow">if</span> (Bcb-&gt;BaseAddress != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01119 
01120                 <span class="comment">//</span>
01121                 <span class="comment">//  Unmap the Vacb and free the resource if the Bcb is still</span>
01122                 <span class="comment">//  dirty.  We have to free the resource before dropping the</span>
01123                 <span class="comment">//  spinlock, and we want to hold the resource until the</span>
01124                 <span class="comment">//  virtual address is freed.</span>
01125                 <span class="comment">//</span>
01126 
01127                 <a class="code" href="../../d5/d3/vacbsup_8c.html#a16">CcFreeVirtualAddress</a>( Bcb-&gt;Vacb );
01128 
01129                 Bcb-&gt;BaseAddress = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01130                 Bcb-&gt;Vacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01131             }
01132 
01133             <span class="keywordflow">if</span> (!ReadOnly) {
01134                 <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>( &amp;Bcb-&gt;Resource );
01135             }
01136 
01137             ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
01138         }
01139 
01140         <span class="comment">//</span>
01141         <span class="comment">//  Otherwise, we also delete the Bcb.</span>
01142         <span class="comment">//</span>
01143 
01144         <span class="keywordflow">else</span> {
01145 
01146             <span class="comment">//</span>
01147             <span class="comment">//  Since CcCalculateVacbLockCount has to be able to walk</span>
01148             <span class="comment">//  the BcbList with only the VacbSpinLock, we take that one</span>
01149             <span class="comment">//  out to change the list and decrement the level.</span>
01150             <span class="comment">//</span>
01151 
01152             <a class="code" href="../../d5/d5/cc_8h.html#a6">CcAcquireVacbLockAtDpcLevel</a>();
01153             RemoveEntryList( &amp;Bcb-&gt;BcbLinks );
01154 
01155             <span class="comment">//</span>
01156             <span class="comment">//  For large metadata streams we unlock the Vacb level.</span>
01157             <span class="comment">//</span>
01158 
01159             <a class="code" href="../../d5/d5/cc_8h.html#a51">CcUnlockVacbLevel</a>( SharedCacheMap, Bcb-&gt;FileOffset.QuadPart );
01160             <a class="code" href="../../d5/d5/cc_8h.html#a7">CcReleaseVacbLockFromDpcLevel</a>();
01161 
01162             <span class="comment">//</span>
01163             <span class="comment">//  Debug routines used to remove Bcbs from the global list</span>
01164             <span class="comment">//</span>
01165 
01166 <span class="preprocessor">#if LIST_DBG</span>
01167 <span class="preprocessor"></span>
01168             ExAcquireSpinLockAtDpcLevel( &amp;CcBcbSpinLock );
01169 
01170             <span class="keywordflow">if</span> (Bcb-&gt;CcBcbLinks.Flink != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01171 
01172                 RemoveEntryList( &amp;Bcb-&gt;CcBcbLinks );
01173                 CcBcbCount -= 1;
01174             }
01175 
01176             ExReleaseSpinLockFromDpcLevel( &amp;CcBcbSpinLock );
01177 
01178 <span class="preprocessor">#endif</span>
01179 <span class="preprocessor"></span>
01180             <span class="keywordflow">if</span> (Bcb-&gt;BaseAddress != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01181 
01182                 <a class="code" href="../../d5/d3/vacbsup_8c.html#a16">CcFreeVirtualAddress</a>( Bcb-&gt;Vacb );
01183             }
01184 <span class="preprocessor">#if DBG</span>
01185 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (!ReadOnly) {
01186                 <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>( &amp;Bcb-&gt;Resource );
01187             }
01188 
01189             <span class="comment">//</span>
01190             <span class="comment">//  ASSERT that the resource is unowned.</span>
01191             <span class="comment">//</span>
01192 
01193             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Bcb-&gt;Resource.ActiveCount == 0 );
01194 <span class="preprocessor">#endif</span>
01195 <span class="preprocessor"></span>            ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
01196             <a class="code" href="../../d5/d5/cc_8h.html#a177">CcDeallocateBcb</a>( Bcb );
01197         }
01198     }
01199 
01200     <span class="comment">//</span>
01201     <span class="comment">//  Else we just have to release our Shared access, if we are not</span>
01202     <span class="comment">//  readonly.  We don't need to do this above, since we deallocate</span>
01203     <span class="comment">//  the entire Bcb there.</span>
01204     <span class="comment">//</span>
01205 
01206     <span class="keywordflow">else</span> {
01207 
01208         <span class="keywordflow">if</span> (!ReadOnly) {
01209             <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>( &amp;Bcb-&gt;Resource );
01210         }
01211 
01212         ExReleaseSpinLock( &amp;SharedCacheMap-&gt;<a class="code" href="../../d0/d3/struct__SHARED__CACHE__MAP.html#o36">BcbSpinLock</a>, OldIrql );
01213     }
01214 
01215     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, me, <span class="stringliteral">"CcUnpinFileData -&gt; VOID\n"</span>, 0 );
01216 
01217     <span class="keywordflow">return</span>;
01218 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a198" doxytag="cc.h::CcWaitOnActiveCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcWaitOnActiveCount           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SharedCacheMap</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01062">1062</a> of file <a class="el" href="../../d6/d2/vacbsup_8c-source.html">vacbsup.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00076">CcAcquireVacbLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00079">CcReleaseVacbLock</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00086">Event()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00623">Executive</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01066">KeInitializeEvent</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a175">NonPagedPoolMustSucceed</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>.
<p>
<pre class="fragment"><div>01068                    :
01069 
01070     This routine may be called to wait <span class="keywordflow">for</span> outstanding mappings <span class="keywordflow">for</span>
01071     a given SharedCacheMap to go inactive.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> intended to be called
01072     from <a class="code" href="../../d5/d8/fssup_8c.html#a10">CcUninitializeCacheMap</a>, which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> systems
01073     during cleanup processing.  In that <span class="keywordflow">case</span> <span class="keyword">this</span> routine <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> has to
01074     wait <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user closed a handle without waiting <span class="keywordflow">for</span> all I/Os on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01075     handle to complete.
01076 
01077     This routine returns each time <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> active count <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> decremented.  The
01078     caller must recheck his wait conditions on <span class="keywordflow">return</span>, either waiting <span class="keywordflow">for</span>
01079     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ActiveCount to go to 0, or <span class="keywordflow">for</span> specific views to go inactive
01080     (<a class="code" href="../../d5/d8/fssup_8c.html#a13">CcPurgeCacheSection</a> <span class="keywordflow">case</span>).
01081 
01082 Arguments:
01083 
01084     SharedCacheMap - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Shared Cache Map on whose VacbActiveCount
01085                      we wish to wait.
01086 
01087 Return Value:
01088 
01089     None.
01090 
01091 --*/
01092 
01093 {
01094     KIRQL OldIrql;
01095     <a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a> <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a>;
01096 
01097     <span class="comment">//</span>
01098     <span class="comment">//  In the unusual case that we get a cleanup while I/O is still going</span>
01099     <span class="comment">//  on, we can wait here.  The caller must test the count for nonzero</span>
01100     <span class="comment">//  before calling this routine.</span>
01101     <span class="comment">//</span>
01102     <span class="comment">//  Since we are being called from cleanup, we cannot afford to</span>
01103     <span class="comment">//  fail here.</span>
01104     <span class="comment">//</span>
01105 
01106     <a class="code" href="../../d5/d5/cc_8h.html#a4">CcAcquireVacbLock</a>( &amp;OldIrql );
01107 
01108     <span class="comment">//</span>
01109     <span class="comment">//  It is possible that the count went to zero before we acquired the</span>
01110     <span class="comment">//  spinlock, so we must handle two cases here.</span>
01111     <span class="comment">//</span>
01112 
01113     <span class="keywordflow">if</span> (SharedCacheMap-&gt;VacbActiveCount != 0) {
01114 
01115         <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> = SharedCacheMap-&gt;WaitOnActiveCount) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01116 
01117             <span class="comment">//</span>
01118             <span class="comment">//  If the local event is not being used then we take it.</span>
01119             <span class="comment">//</span>
01120 
01121             <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> = InterlockedExchangePointer( &amp;SharedCacheMap-&gt;LocalEvent, NULL );
01122 
01123             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01124 
01125                 <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> = (<a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a>)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( NonPagedPoolMustSucceed,
01126                                                         <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d6/struct__KEVENT.html">KEVENT</a>),
01127                                                         'vEcC' );
01128             }
01129         }
01130 
01131         <a class="code" href="../../d4/d9/ke_8h.html#a20">KeInitializeEvent</a>( Event,
01132                            NotificationEvent,
01133                            FALSE );
01134 
01135         SharedCacheMap-&gt;WaitOnActiveCount = <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a>;
01136 
01137         <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
01138 
01139         <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>( Event,
01140                                Executive,
01141                                KernelMode,
01142                                FALSE,
01143                                (PLARGE_INTEGER)NULL);
01144     } <span class="keywordflow">else</span> {
01145 
01146         <a class="code" href="../../d5/d5/cc_8h.html#a5">CcReleaseVacbLock</a>( OldIrql );
01147     }
01148 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a188" doxytag="cc.h::CcWorkerThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CcWorkerThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ExWorkQueueItem</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">738</a> of file <a class="el" href="../../d6/d0/lazyrite_8c-source.html">lazyrite.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00442">CC_REQUEUE</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00096">CcDeferredWrites</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00619">CcExceptionFilter()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00052">CcExpressWorkQueue</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01850">CcFreeWorkQueueEntry</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00051">CcIdleWorkerThreadList</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00050">CcNumberActiveWorkerThreads</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00056">CcQueueThrottle</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00053">CcRegularWorkQueue</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00103">CcTotalDirtyPages</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00048">CcWorkQueueSpinlock</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d5/d5/cc_8h.html#a210a170">EventSet</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01535">_WORK_QUEUE_ENTRY::Function</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d5/d5/cc_8h.html#a210a169">LazyWriteScan</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00094">List</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00033">me</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html#o7">_WORK_QUEUE_ENTRY::Parameters</a>, <a class="el" href="../../d5/d5/cc_8h.html#a210a167">ReadAhead</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01497">_WORK_QUEUE_ENTRY::WorkQueueLinks</a>, and <a class="el" href="../../d5/d5/cc_8h.html#a210a168">WriteBehind</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>.
<p>
<pre class="fragment"><div>00744                    :
00745 
00746     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> worker thread routine <span class="keywordflow">for</span> processing cache manager work queue
00747     entries.
00748 
00749 Arguments:
00750 
00751     ExWorkQueueItem - The work item used <span class="keywordflow">for</span> <span class="keyword">this</span> thread
00752 
00753 Return Value:
00754 
00755     None
00756 
00757 --*/
00758 
00759 {
00760     KIRQL OldIrql;
00761     PLIST_ENTRY WorkQueue;
00762     <a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">PWORK_QUEUE_ENTRY</a> WorkQueueEntry;
00763     BOOLEAN RescanOk = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00764     BOOLEAN DropThrottle = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00765     IO_STATUS_BLOCK IoStatus;
00766 
00767     IoStatus.Status = STATUS_SUCCESS;
00768     IoStatus.Information = 0;
00769 
00770     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FIELD_OFFSET(<a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">WORK_QUEUE_ENTRY</a>, WorkQueueLinks) == 0);
00771 
00772     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00773 
00774         ExAcquireFastLock( &amp;CcWorkQueueSpinlock, &amp;OldIrql );
00775 
00776         <span class="comment">//</span>
00777         <span class="comment">//  If we just processed a throttled operation, drop the flag.</span>
00778         <span class="comment">//</span>
00779 
00780         <span class="keywordflow">if</span> (DropThrottle) {
00781 
00782             DropThrottle = <a class="code" href="../../d5/d2/cachedat_8c.html#a11">CcQueueThrottle</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00783         }
00784 
00785         <span class="comment">//</span>
00786         <span class="comment">//  On requeue, push at end of the regular queue and clear hint.</span>
00787         <span class="comment">//</span>
00788         
00789         <span class="keywordflow">if</span> (IoStatus.Information == <a class="code" href="../../d5/d5/cc_8h.html#a56">CC_REQUEUE</a>) {
00790 
00791             InsertTailList( WorkQueue, &amp;WorkQueueEntry-&gt;<a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html#o0">WorkQueueLinks</a> );
00792             IoStatus.Information = 0;
00793         }
00794         
00795         <span class="comment">//</span>
00796         <span class="comment">//  First see if there is something in the express queue.</span>
00797         <span class="comment">//</span>
00798 
00799         <span class="keywordflow">if</span> (!IsListEmpty(&amp;CcExpressWorkQueue)) {
00800             WorkQueue = &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a8">CcExpressWorkQueue</a>;
00801 
00802         <span class="comment">//</span>
00803         <span class="comment">//  If there was nothing there, then try the regular queue.</span>
00804         <span class="comment">//</span>
00805 
00806         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!IsListEmpty(&amp;CcRegularWorkQueue)) {
00807             WorkQueue = &amp;<a class="code" href="../../d5/d2/cachedat_8c.html#a9">CcRegularWorkQueue</a>;
00808 
00809         <span class="comment">//</span>
00810         <span class="comment">//  Else we can break and go idle.</span>
00811         <span class="comment">//</span>
00812         
00813         } <span class="keywordflow">else</span> {
00814 
00815             <span class="keywordflow">break</span>;
00816         }
00817 
00818         WorkQueueEntry = CONTAINING_RECORD( WorkQueue-&gt;Flink, <a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html">WORK_QUEUE_ENTRY</a>, WorkQueueLinks );
00819 
00820         <span class="comment">//</span>
00821         <span class="comment">//  If this is an EventSet, throttle down to a single thread to be sure</span>
00822         <span class="comment">//  that this event fires after all preceeding workitems have completed.</span>
00823         <span class="comment">//</span>
00824 
00825         <span class="keywordflow">if</span> (WorkQueueEntry-&gt;<a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html#o8">Function</a> == <a class="code" href="../../d5/d5/cc_8h.html#a210a170">EventSet</a> &amp;&amp; <a class="code" href="../../d5/d2/cachedat_8c.html#a6">CcNumberActiveWorkerThreads</a> &gt; 1) {
00826 
00827             <a class="code" href="../../d5/d2/cachedat_8c.html#a11">CcQueueThrottle</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00828             <span class="keywordflow">break</span>;
00829         }
00830 
00831         <span class="comment">//</span>
00832         <span class="comment">//  Pop the workitem off: we will execute it now.</span>
00833         <span class="comment">//</span>
00834 
00835         RemoveHeadList( WorkQueue );
00836 
00837         ExReleaseFastLock( &amp;CcWorkQueueSpinlock, OldIrql );
00838 
00839         <span class="comment">//</span>
00840         <span class="comment">//  Process the entry within a try-except clause, so that any errors</span>
00841         <span class="comment">//  will cause us to continue after the called routine has unwound.</span>
00842         <span class="comment">//</span>
00843 
00844         <span class="keywordflow">try</span> {
00845 
00846             <span class="keywordflow">switch</span> (WorkQueueEntry-&gt;<a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html#o8">Function</a>) {
00847 
00848             <span class="comment">//</span>
00849             <span class="comment">//  Perform read ahead</span>
00850             <span class="comment">//</span>
00851 
00852             <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/cc_8h.html#a210a167">ReadAhead</a>:
00853 
00854                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"CcWorkerThread Read Ahead FileObject = %08lx\n"</span>,
00855                             WorkQueueEntry-&gt;<a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html#o7">Parameters</a>.Read.FileObject );
00856 
00857                 <a class="code" href="../../d5/d5/cc_8h.html#a178">CcPerformReadAhead</a>( WorkQueueEntry-&gt;<a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html#o7">Parameters</a>.Read.FileObject );
00858 
00859                 <span class="keywordflow">break</span>;
00860 
00861             <span class="comment">//</span>
00862             <span class="comment">//  Perform write behind</span>
00863             <span class="comment">//</span>
00864 
00865             <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/cc_8h.html#a210a168">WriteBehind</a>:
00866 
00867                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"CcWorkerThread WriteBehind SharedCacheMap = %08lx\n"</span>,
00868                             WorkQueueEntry-&gt;<a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html#o7">Parameters</a>.Write.SharedCacheMap );
00869 
00870                 <a class="code" href="../../d5/d5/cc_8h.html#a180">CcWriteBehind</a>( WorkQueueEntry-&gt;<a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html#o7">Parameters</a>.Write.SharedCacheMap, &amp;IoStatus );
00871                 RescanOk = (BOOLEAN)<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(IoStatus.Status);
00872                 <span class="keywordflow">break</span>;
00873 
00874             
00875             <span class="comment">//</span>
00876             <span class="comment">//  Perform set event</span>
00877             <span class="comment">//</span>
00878             
00879             <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/cc_8h.html#a210a170">EventSet</a>:
00880                 
00881                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"CcWorkerThread SetEvent Event = %08lx\n"</span>,
00882                             WorkQueueEntry-&gt;<a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html#o7">Parameters</a>.Event.Event );
00883 
00884                 <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>( WorkQueueEntry-&gt;<a class="code" href="../../d2/d9/struct__WORK__QUEUE__ENTRY.html#o7">Parameters</a>.Event.Event, 0, FALSE );
00885                 DropThrottle = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00886                 <span class="keywordflow">break</span>;
00887 
00888             <span class="comment">//</span>
00889             <span class="comment">//  Perform Lazy Write Scan</span>
00890             <span class="comment">//</span>
00891 
00892             <span class="keywordflow">case</span> <a class="code" href="../../d5/d5/cc_8h.html#a210a169">LazyWriteScan</a>:
00893 
00894                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"CcWorkerThread Lazy Write Scan\n"</span>, 0 );
00895 
00896                 <a class="code" href="../../d5/d1/lazyrite_8c.html#a3">CcLazyWriteScan</a>();
00897                 <span class="keywordflow">break</span>;
00898             }
00899 
00900         }
00901         except( <a class="code" href="../../d5/d1/lazyrite_8c.html#a7">CcExceptionFilter</a>( GetExceptionCode() )) {
00902 
00903             NOTHING;
00904         }
00905 
00906         <span class="comment">//</span>
00907         <span class="comment">//  If not a requeue request, free the workitem.</span>
00908         <span class="comment">//</span>
00909         
00910         <span class="keywordflow">if</span> (IoStatus.Information != <a class="code" href="../../d5/d5/cc_8h.html#a56">CC_REQUEUE</a>) {
00911             
00912             <a class="code" href="../../d5/d5/cc_8h.html#a89">CcFreeWorkQueueEntry</a>( WorkQueueEntry );
00913         }
00914     }
00915 
00916     <span class="comment">//</span>
00917     <span class="comment">//  No more work.  Requeue our worker thread entry and get out.</span>
00918     <span class="comment">//</span>
00919 
00920     InsertTailList( &amp;CcIdleWorkerThreadList,
00921                     &amp;((<a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">PWORK_QUEUE_ITEM</a>)ExWorkQueueItem)-&gt;List );
00922     <a class="code" href="../../d5/d2/cachedat_8c.html#a6">CcNumberActiveWorkerThreads</a> -= 1;
00923 
00924     ExReleaseFastLock( &amp;CcWorkQueueSpinlock, OldIrql );
00925 
00926     <span class="keywordflow">if</span> (!IsListEmpty(&amp;CcDeferredWrites) &amp;&amp; (<a class="code" href="../../d5/d2/cachedat_8c.html#a36">CcTotalDirtyPages</a> &gt;= 20) &amp;&amp; RescanOk) {
00927         <a class="code" href="../../d5/d1/lazyrite_8c.html#a3">CcLazyWriteScan</a>();
00928     }
00929 
00930     <span class="keywordflow">return</span>;
00931 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a180" doxytag="cc.h::CcWriteBehind" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FASTCALL CcWriteBehind           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PIO_STATUS_BLOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>IoStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">3880</a> of file <a class="el" href="../../d7/d1/cachesub_8c-source.html">cachesub.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00442">CC_REQUEUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00064">CcAcquireMasterLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00070">CcAcquireMasterLockAtDpcLevel</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01010">CcDecrementOpenCount</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00096">CcDeferredWrites</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">CcFreeActiveVacb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04232">CcGetFlushedValidData()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01003">CcIncrementOpenCount</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06458">CcLogError()</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00064">CcNoDelay</a>, <a class="el" href="../../d6/d1/cachedat_8c-source.html#l00099">CcPagesYetToWrite</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l02099">CcPostDeferredWrites()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00067">CcReleaseMasterLock</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00073">CcReleaseMasterLockFromDpcLevel</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02717">CcSetValidData()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00509">ClearFlag</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01194">_MBCB::DirtyPages</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l02555">FsRtlAcquireFileExclusive()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l02628">FsRtlReleaseFile()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01588">GetActiveVacbAtDpcLevel</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l08909">IoRaiseInformationalHardError()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01083">LAZY_WRITE_OCCURRED</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00033">me</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00713">ObQueryNameString()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01188">_MBCB::PagesToWrite</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01038">PIN_ACCESS</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00039">RetryError</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l01051">WRITE_QUEUED</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>.
<p>
<pre class="fragment"><div>03887                    :
03888 
03889     This routine may be called with Wait = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> to see <span class="keywordflow">if</span> write behind
03890     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> required, or with Wait = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> to perform write behind as required.
03891 
03892     The code <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> very similar to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> code that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Lazy <a class="code" href="../../d4/d0/tex_8c.html#a44">Writer</a> performs
03893     <span class="keywordflow">for</span> each SharedCacheMap.  The <a class="code" href="../../d3/d9/arcinst_8c.html#a19">main</a> difference <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call to
03894     <a class="code" href="../../d6/d2/cachesub_8c.html#a7">CcAcquireByteRangeForWrite</a>.  Write Behind does not care about time
03895     stamps (passing ULONG to accept all time stamps), but <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> will never
03896     dump <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first (highest byte offset) buffer in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last
03897     byte of that buffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not yet written.  The Lazy <a class="code" href="../../d4/d0/tex_8c.html#a44">Writer</a> does exactly
03898     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> opposite, in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sense that <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> totally time-driven, and will
03899     even dump a partially modified buffer <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> sits around <span class="keywordtype">long</span> enough.
03900 
03901 Arguments:
03902 
03903     SharedCacheMap - Pointer to SharedCacheMap to be written
03904 
03905 Return Value:
03906 
03907     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - <span class="keywordflow">if</span> write behind <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> required, but <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller supplied
03908             Wait = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
03909 
03910     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - <span class="keywordflow">if</span> write behind <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> complete or not required
03911 
03912 --*/
03913 
03914 {
03915     KIRQL OldIrql;
03916     ULONG ActivePage;
03917     ULONG PageIsDirty;
03918     <a class="code" href="../../d9/d6/struct__MBCB.html">PMBCB</a> Mbcb;
03919     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03920     ULONG FileExclusive = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03921     <a class="code" href="../../d2/d5/struct__VACB.html">PVACB</a> ActiveVacb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03922 
03923     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, me, <span class="stringliteral">"CcWriteBehind\n"</span>, 0 );
03924     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, me, <span class="stringliteral">"    SharedCacheMap = %08lx\n"</span>, SharedCacheMap );
03925 
03926     <span class="comment">//</span>
03927     <span class="comment">//  First we have to acquire the file for LazyWrite, to avoid</span>
03928     <span class="comment">//  deadlocking with writers to the file.  We do this via the</span>
03929     <span class="comment">//  CallBack procedure specified to CcInitializeCacheMap.</span>
03930     <span class="comment">//</span>
03931 
03932     <span class="keywordflow">if</span> (!(*SharedCacheMap-&gt;Callbacks-&gt;AcquireForLazyWrite)
03933                             ( SharedCacheMap-&gt;LazyWriteContext, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> )) {
03934 
03935         <span class="comment">//</span>
03936         <span class="comment">//  The filesystem is hinting that it doesn't think that it can</span>
03937         <span class="comment">//  service the write without significant delay so we will defer</span>
03938         <span class="comment">//  and come back later.  Simply drop the queued flag ... note that</span>
03939         <span class="comment">//  we do not modify CcPagesYetToWrite, in the hope that we can make</span>
03940         <span class="comment">//  up the difference in some other cache map on this pass.</span>
03941         <span class="comment">//</span>
03942 
03943         <a class="code" href="../../d5/d5/cc_8h.html#a0">CcAcquireMasterLock</a>( &amp;OldIrql );
03944         <a class="code" href="../../d5/d5/cc_8h.html#a61">ClearFlag</a>(SharedCacheMap-&gt;Flags, WRITE_QUEUED);
03945         <a class="code" href="../../d5/d5/cc_8h.html#a1">CcReleaseMasterLock</a>( OldIrql );
03946 
03947         IoStatus-&gt;Status = STATUS_FILE_LOCK_CONFLICT;
03948         <span class="keywordflow">return</span>;
03949     }
03950 
03951     <span class="comment">//</span>
03952     <span class="comment">//  See if there is a previous active page to clean up, but only</span>
03953     <span class="comment">//  do so now if it is the last dirty page or no users have the</span>
03954     <span class="comment">//  file open.  We will free it below after dropping the spinlock.</span>
03955     <span class="comment">//</span>
03956 
03957     ExAcquireFastLock( &amp;SharedCacheMap-&gt;BcbSpinLock, &amp;OldIrql );
03958     <a class="code" href="../../d5/d5/cc_8h.html#a2">CcAcquireMasterLockAtDpcLevel</a>();
03959 
03960     <span class="keywordflow">if</span> ((SharedCacheMap-&gt;DirtyPages &lt;= 1) || (SharedCacheMap-&gt;OpenCount == 0)) {
03961         <a class="code" href="../../d5/d5/cc_8h.html#a83">GetActiveVacbAtDpcLevel</a>( SharedCacheMap, ActiveVacb, ActivePage, PageIsDirty );
03962     }
03963 
03964     <span class="comment">//</span>
03965     <span class="comment">//  Increment open count so that our caller's views stay available</span>
03966     <span class="comment">//  for CcGetVacbMiss.  We could be tying up all of the views, and</span>
03967     <span class="comment">//  still need to write file sizes.</span>
03968     <span class="comment">//</span>
03969 
03970     <a class="code" href="../../d5/d5/cc_8h.html#a68">CcIncrementOpenCount</a>( SharedCacheMap, 'brWS' );
03971 
03972     <span class="comment">//</span>
03973     <span class="comment">//  If there is a mask bcb, then we need to establish a target for</span>
03974     <span class="comment">//  it to flush.</span>
03975     <span class="comment">//</span>
03976 
03977     <span class="keywordflow">if</span> ((Mbcb = SharedCacheMap-&gt;Mbcb) != 0) {
03978 
03979         <span class="comment">//</span>
03980         <span class="comment">//  Set a target of pages to write, assuming that any Active</span>
03981         <span class="comment">//  Vacb will increase the number.</span>
03982         <span class="comment">//</span>
03983 
03984         Mbcb-&gt;<a class="code" href="../../d9/d6/struct__MBCB.html#o2">PagesToWrite</a> = Mbcb-&gt;<a class="code" href="../../d9/d6/struct__MBCB.html#o3">DirtyPages</a> + ((ActiveVacb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ? 1 : 0);
03985 
03986         <span class="keywordflow">if</span> (Mbcb-&gt;<a class="code" href="../../d9/d6/struct__MBCB.html#o2">PagesToWrite</a> &gt; <a class="code" href="../../d5/d2/cachedat_8c.html#a32">CcPagesYetToWrite</a>) {
03987 
03988             Mbcb-&gt;<a class="code" href="../../d9/d6/struct__MBCB.html#o2">PagesToWrite</a> = <a class="code" href="../../d5/d2/cachedat_8c.html#a32">CcPagesYetToWrite</a>;
03989         }
03990     }
03991 
03992     <a class="code" href="../../d5/d5/cc_8h.html#a3">CcReleaseMasterLockFromDpcLevel</a>();
03993     ExReleaseFastLock( &amp;SharedCacheMap-&gt;BcbSpinLock, OldIrql );
03994 
03995     <span class="comment">//</span>
03996     <span class="comment">//  Now free the active Vacb, if we found one.</span>
03997     <span class="comment">//</span>
03998 
03999     <span class="keywordflow">if</span> (ActiveVacb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04000 
04001         <a class="code" href="../../d5/d5/cc_8h.html#a182">CcFreeActiveVacb</a>( SharedCacheMap, ActiveVacb, ActivePage, PageIsDirty );
04002     }
04003 
04004     <span class="comment">//</span>
04005     <span class="comment">//  Now perform the lazy writing for this file via a special call</span>
04006     <span class="comment">//  to CcFlushCache.  He recognizes us by the &amp;CcNoDelay input to</span>
04007     <span class="comment">//  FileOffset, which signifies a Lazy Write, but is subsequently</span>
04008     <span class="comment">//  ignored.</span>
04009     <span class="comment">//</span>
04010 
04011     <a class="code" href="../../d4/d2/cache_8h.html#a63">CcFlushCache</a>( SharedCacheMap-&gt;FileObject-&gt;SectionObjectPointer,
04012                   &amp;CcNoDelay,
04013                   1,
04014                   IoStatus );
04015 
04016     <span class="comment">//</span>
04017     <span class="comment">//  No need for the Lazy Write resource now.</span>
04018     <span class="comment">//</span>
04019 
04020     (*SharedCacheMap-&gt;Callbacks-&gt;ReleaseFromLazyWrite)
04021                         ( SharedCacheMap-&gt;LazyWriteContext );
04022 
04023     <span class="comment">//</span>
04024     <span class="comment">//  Check if we need to put up a popup.</span>
04025     <span class="comment">//</span>
04026 
04027     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(IoStatus-&gt;Status) &amp;&amp; !<a class="code" href="../../d6/d2/cachesub_8c.html#a2">RetryError</a>(IoStatus-&gt;Status)) {
04028 
04029         <span class="comment">//</span>
04030         <span class="comment">//  We lost writebehind data. Try to get the filename. If we can't,</span>
04031         <span class="comment">//  then just raise the error returned by the failing write</span>
04032         <span class="comment">//</span>
04033 
04034         POBJECT_NAME_INFORMATION FileNameInfo;
04035         <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> QueryStatus;
04036         ULONG whocares;
04037 
04038         FileNameInfo = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, 1024, 'nFcC' );
04039 
04040         <span class="keywordflow">if</span> ( FileNameInfo ) {
04041             QueryStatus = <a class="code" href="../../d6/d1/obquery_8c.html#a7">ObQueryNameString</a>( SharedCacheMap-&gt;FileObject,
04042                                              FileNameInfo,
04043                                              1024,
04044                                              &amp;whocares );
04045 
04046             <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(QueryStatus) ) {
04047                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(FileNameInfo);
04048                 FileNameInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04049             }
04050         }
04051 
04052         <span class="comment">//</span>
04053         <span class="comment">//  Give checked builds something to look at.  This should also be event</span>
04054         <span class="comment">//  logged for after-the-fact analysis.</span>
04055         <span class="comment">//</span>
04056 
04057         KdPrint((<span class="stringliteral">"CACHE MANAGER: Lost delayed write FileOb %08x status %08x\n"</span>, SharedCacheMap-&gt;FileObject, IoStatus-&gt;Status));
04058 
04059         <span class="keywordflow">if</span> ( FileNameInfo ) {
04060             <a class="code" href="../../d4/d6/iosubs_8c.html#a94">IoRaiseInformationalHardError</a>( STATUS_LOST_WRITEBEHIND_DATA,&amp;FileNameInfo-&gt;Name, NULL );
04061             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(FileNameInfo);
04062         } <span class="keywordflow">else</span> {
04063             <span class="keywordflow">if</span> ( SharedCacheMap-&gt;FileObject-&gt;FileName.Length &amp;&amp;
04064                  SharedCacheMap-&gt;FileObject-&gt;FileName.MaximumLength &amp;&amp;
04065                  SharedCacheMap-&gt;FileObject-&gt;FileName.Buffer ) {
04066 
04067                 <a class="code" href="../../d4/d6/iosubs_8c.html#a94">IoRaiseInformationalHardError</a>( STATUS_LOST_WRITEBEHIND_DATA,&amp;SharedCacheMap-&gt;FileObject-&gt;FileName, NULL );
04068             }
04069         }
04070 
04071         <a class="code" href="../../d6/d2/cachesub_8c.html#a11">CcLogError</a>( SharedCacheMap-&gt;FileObject-&gt;DeviceObject,
04072                     IO_LOST_DELAYED_WRITE,
04073                     IoStatus-&gt;Status,
04074                     &amp;(SharedCacheMap-&gt;FileObject-&gt;FileName) );
04075     <span class="comment">//</span>
04076     <span class="comment">//  See if there is any deferred writes we can post.</span>
04077     <span class="comment">//</span>
04078 
04079     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!IsListEmpty(&amp;CcDeferredWrites)) {
04080         <a class="code" href="../../d5/d5/cc_8h.html#a174">CcPostDeferredWrites</a>();
04081     }
04082 
04083     <span class="comment">//</span>
04084     <span class="comment">//  Now acquire BcbSpinLock again to check for ValidData updates.</span>
04085     <span class="comment">//</span>
04086 
04087     ExAcquireSpinLock( &amp;SharedCacheMap-&gt;BcbSpinLock, &amp;OldIrql );
04088 
04089     <span class="comment">//</span>
04090     <span class="comment">//  If the the current ValidDataGoal is greater (or equal) than ValidDataLength,</span>
04091     <span class="comment">//  then we must see if we have advanced beyond the current ValidDataLength.</span>
04092     <span class="comment">//</span>
04093     <span class="comment">//  If we have NEVER written anything out from this shared cache map, then</span>
04094     <span class="comment">//  there is no need to check anything associtated with valid data length</span>
04095     <span class="comment">//  here.  We will come by here again when, and if, anybody actually</span>
04096     <span class="comment">//  modifies the file and we lazy write some data.</span>
04097     <span class="comment">//</span>
04098 
04099     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
04100     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;Flags, LAZY_WRITE_OCCURRED) &amp;&amp;
04101         (SharedCacheMap-&gt;ValidDataGoal.QuadPart &gt;= SharedCacheMap-&gt;ValidDataLength.QuadPart) &amp;&amp;
04102         (SharedCacheMap-&gt;ValidDataLength.QuadPart != MAXLONGLONG) &amp;&amp;
04103         (SharedCacheMap-&gt;FileSize.QuadPart != 0)) {
04104 
04105         LARGE_INTEGER NewValidDataLength;
04106 
04107         NewValidDataLength = <a class="code" href="../../d4/d2/cache_8h.html#a64">CcGetFlushedValidData</a>( SharedCacheMap-&gt;FileObject-&gt;SectionObjectPointer,
04108                                                     TRUE );
04109 
04110         <span class="comment">//</span>
04111         <span class="comment">//  If New ValidDataLength has been written, then we have to</span>
04112         <span class="comment">//  call the file system back to update it.  We must temporarily</span>
04113         <span class="comment">//  drop our global list while we do this, which is safe to do since</span>
04114         <span class="comment">//  we have not cleared WRITE_QUEUED.</span>
04115         <span class="comment">//</span>
04116         <span class="comment">//  Note we keep calling any time we wrote the last page of the file,</span>
04117         <span class="comment">//  to solve the "famous" AFS Server problem.  The file system will</span>
04118         <span class="comment">//  truncate our valid data call to whatever is currently valid.  But</span>
04119         <span class="comment">//  then if he writes a little more, we do not want to stop calling</span>
04120         <span class="comment">//  back.</span>
04121         <span class="comment">//</span>
04122 
04123         <span class="keywordflow">if</span> ( NewValidDataLength.QuadPart &gt;= SharedCacheMap-&gt;ValidDataLength.QuadPart ) {
04124 
04125             ExReleaseSpinLock( &amp;SharedCacheMap-&gt;BcbSpinLock, OldIrql );
04126 
04127             <span class="comment">//</span>
04128             <span class="comment">//  Call file system to set new valid data.  We have no</span>
04129             <span class="comment">//  one to tell if this doesn't work.</span>
04130             <span class="comment">//</span>
04131 
04132             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d2/cachesub_8c.html#a6">CcSetValidData</a>( SharedCacheMap-&gt;FileObject,
04133                                      &amp;NewValidDataLength );
04134 
04135             ExAcquireSpinLock( &amp;SharedCacheMap-&gt;BcbSpinLock, &amp;OldIrql );
04136             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
04137                 SharedCacheMap-&gt;ValidDataLength = NewValidDataLength;
04138 <span class="preprocessor">#ifdef TOMM</span>
04139 <span class="preprocessor"></span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_INSUFFICIENT_RESOURCES) &amp;&amp; !<a class="code" href="../../d6/d2/cachesub_8c.html#a2">RetryError</a>(Status)) {
04140                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Unexpected status from CcSetValidData: %08lx, FileObject: %08lx\n"</span>,
04141                          Status,
04142                          SharedCacheMap-&gt;FileObject);
04143                 DbgBreakPoint();
04144 <span class="preprocessor">#endif TOMM</span>
04145 <span class="preprocessor"></span>            }
04146         }
04147     }
04148 
04149     ExReleaseSpinLock( &amp;SharedCacheMap-&gt;BcbSpinLock, OldIrql );
04150 
04151     <span class="comment">//</span>
04152     <span class="comment">//  Show we are done.</span>
04153     <span class="comment">//</span>
04154 
04155     <a class="code" href="../../d5/d5/cc_8h.html#a0">CcAcquireMasterLock</a>( &amp;OldIrql );
04156     <a class="code" href="../../d5/d5/cc_8h.html#a69">CcDecrementOpenCount</a>( SharedCacheMap, 'brWF' );
04157 
04158     <span class="comment">//</span>
04159     <span class="comment">//  Make an approximate guess about whether we will call CcDeleteSharedCacheMap or not</span>
04160     <span class="comment">//  to truncate the file.</span>
04161     <span class="comment">//</span>
04162     <span class="comment">//  Also do not delete the SharedCacheMap if we got an error on the ValidDataLength</span>
04163     <span class="comment">//  callback.  If we get a resource allocation failure or a retryable error (due to</span>
04164     <span class="comment">//  log file full?), we have no one to tell, so we must just loop back and try again.</span>
04165     <span class="comment">//  Of course all I/O errors are just too bad.</span>
04166     <span class="comment">//</span>
04167 
04168     <span class="keywordflow">if</span> ((SharedCacheMap-&gt;OpenCount == 0)
04169         
04170             &amp;&amp;
04171         
04172         (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) || ((<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_INSUFFICIENT_RESOURCES) &amp;&amp; !<a class="code" href="../../d6/d2/cachesub_8c.html#a2">RetryError</a>(Status)))) {
04173 
04174         <a class="code" href="../../d5/d5/cc_8h.html#a1">CcReleaseMasterLock</a>( OldIrql );
04175         <a class="code" href="../../d1/d8/fsrtl_8h.html#a107">FsRtlAcquireFileExclusive</a>( SharedCacheMap-&gt;FileObject );
04176         <a class="code" href="../../d5/d5/cc_8h.html#a0">CcAcquireMasterLock</a>( &amp;OldIrql );
04177         
04178         <span class="comment">//</span>
04179         <span class="comment">//  Now really see if we are to delete this SharedCacheMap. By having released</span>
04180         <span class="comment">//  first we avoid a deadlock with the file system when the FileObject is</span>
04181         <span class="comment">//  dereferenced.  Note that CcDeleteSharedCacheMap requires that the</span>
04182         <span class="comment">//  CcMasterSpinLock already be acquired, and it releases it.</span>
04183         <span class="comment">//</span>
04184         <span class="comment">//  Note that we must retest since we dropped and reacquired the master</span>
04185         <span class="comment">//  lock.</span>
04186         <span class="comment">//</span>
04187 
04188         <span class="keywordflow">if</span> ((SharedCacheMap-&gt;OpenCount == 0)
04189 
04190                 &amp;&amp;
04191 
04192             ((SharedCacheMap-&gt;DirtyPages == 0) || ((SharedCacheMap-&gt;FileSize.QuadPart == 0) &amp;&amp;
04193                                                    !<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>(SharedCacheMap-&gt;Flags, PIN_ACCESS)))) {
04194 
04195             <span class="comment">//</span>
04196             <span class="comment">//  Make sure to drop the requeue flag in case the write hit the timeout at</span>
04197             <span class="comment">//  the same time it finished everything up.</span>
04198             <span class="comment">//</span>
04199             
04200             <a class="code" href="../../d5/d8/fssup_8c.html#a11">CcDeleteSharedCacheMap</a>( SharedCacheMap, OldIrql, TRUE );
04201             IoStatus-&gt;Information = 0;
04202             SharedCacheMap = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04203         
04204         } <span class="keywordflow">else</span> {
04205 
04206             <a class="code" href="../../d5/d5/cc_8h.html#a1">CcReleaseMasterLock</a>( OldIrql );
04207             <a class="code" href="../../d1/d8/fsrtl_8h.html#a108">FsRtlReleaseFile</a>( SharedCacheMap-&gt;FileObject );
04208             <a class="code" href="../../d5/d5/cc_8h.html#a0">CcAcquireMasterLock</a>( &amp;OldIrql );
04209         }
04210     }
04211 
04212     <span class="comment">//</span>
04213     <span class="comment">//  In the normal case, we just clear the flag on the way out if</span>
04214     <span class="comment">//  we will not requeue the workitem.</span>
04215     <span class="comment">//</span>
04216 
04217     <span class="keywordflow">if</span> (SharedCacheMap != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04218 
04219         <span class="keywordflow">if</span> (IoStatus-&gt;Information != <a class="code" href="../../d5/d5/cc_8h.html#a56">CC_REQUEUE</a>) {
04220             <a class="code" href="../../d5/d5/cc_8h.html#a61">ClearFlag</a>(SharedCacheMap-&gt;Flags, WRITE_QUEUED);
04221         }
04222         <a class="code" href="../../d5/d5/cc_8h.html#a1">CcReleaseMasterLock</a>( OldIrql );
04223     }
04224 
04225     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, me, <span class="stringliteral">"CcWriteBehind-&gt;VOID\n"</span>, 0 );
04226 
04227     <span class="keywordflow">return</span>;
04228 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a209" doxytag="cc.h::IsVacbLevelReferenced" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> _inline ULONG IsVacbLevelReferenced           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>VacbArray</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Level</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02110">2110</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
References <a class="el" href="../../d5/d5/cc_8h.html#a96">PVACB_LEVEL_REFERENCE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00342">_VACB_LEVEL_REFERENCE::Reference</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00343">_VACB_LEVEL_REFERENCE::SpecialReference</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l02094">VacbLevelReference()</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02335">CcAdjustVacbLevelLockCount()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02621">CcSetVacbLargeOffset()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00086">SetVacb()</a>.
<p>
<pre class="fragment"><div>02115 {
02116     <a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">PVACB_LEVEL_REFERENCE</a> VacbReference = <a class="code" href="../../d5/d5/cc_8h.html#a208">VacbLevelReference</a>( SharedCacheMap, VacbArray, Level );
02117 
02118     <span class="keywordflow">return</span> VacbReference-&gt;<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html#o0">Reference</a> | VacbReference-&gt;<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html#o1">SpecialReference</a>;
02119 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a208" doxytag="cc.h::VacbLevelReference" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> _inline <a class="el" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">PVACB_LEVEL_REFERENCE</a> VacbLevelReference           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d3/struct__SHARED__CACHE__MAP.html">PSHARED_CACHE_MAP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SharedCacheMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>VacbArray</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Level</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02094">2094</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00497">FlagOn</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l01077">MODIFIED_WRITE_DISABLED</a>, <a class="el" href="../../d5/d5/cc_8h.html#a96">PVACB_LEVEL_REFERENCE</a>, and <a class="el" href="../../d6/d4/cc_8h-source.html#l00315">VACB_LEVEL_BLOCK_SIZE</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02439">CcCalculateVacbLevelLockCount()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02110">IsVacbLevelReferenced()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00125">ReferenceVacbLevel()</a>.
<p>
<pre class="fragment"><div>02099 {
02100     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d5/struct__VACB__LEVEL__REFERENCE.html">PVACB_LEVEL_REFERENCE</a>)
02101            ((PCHAR)VacbArray +
02102             <a class="code" href="../../d5/d5/cc_8h.html#a39">VACB_LEVEL_BLOCK_SIZE</a> +
02103             (Level != 0?
02104              0 : (<a class="code" href="../../d5/d5/cc_8h.html#a58">FlagOn</a>( SharedCacheMap-&gt;Flags, MODIFIED_WRITE_DISABLED )?
02105                   <a class="code" href="../../d5/d5/cc_8h.html#a39">VACB_LEVEL_BLOCK_SIZE</a> : 0)));
02106 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a157" doxytag="cc.h::CcAggressiveZeroCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG <a class="el" href="../../d5/d5/cc_8h.html#a157">CcAggressiveZeroCount</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02033">2033</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a158" doxytag="cc.h::CcAggressiveZeroThreshold" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG <a class="el" href="../../d5/d5/cc_8h.html#a158">CcAggressiveZeroThreshold</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02034">2034</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a154" doxytag="cc.h::CcAvailablePagesThreshold" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a154">CcAvailablePagesThreshold</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02030">2030</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a122" doxytag="cc.h::CcBcbSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d7/d4/ppc_2splocks_8c.html#a3">CcBcbSpinLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01998">1998</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05694">CcDeallocateBcb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00052">CcMapData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00271">CcPinMappedData()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00524">CcPinRead()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00767">CcPreparePinWrite()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a145" doxytag="cc.h::CcBeyondVacbs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> <a class="el" href="../../d5/d5/cc_8h.html#a145">CcBeyondVacbs</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02021">2021</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02534">CcGetVacbLargeOffset()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00188">CcInitializeVacbs()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05024">CcRemapBcb()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a160" doxytag="cc.h::CcCapturedSystemSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d1/mm_8h.html#a140">MM_SYSTEMSIZE</a> <a class="el" href="../../d5/d5/cc_8h.html#a160">CcCapturedSystemSize</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02036">2036</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a123" doxytag="cc.h::CcCleanSharedCacheMapList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d5/d5/cc_8h.html#a123">CcCleanSharedCacheMapList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01999">1999</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a139" doxytag="cc.h::CcCollisionDelay" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER <a class="el" href="../../d5/d5/cc_8h.html#a139">CcCollisionDelay</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02015">2015</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a148" doxytag="cc.h::CcDeferredWrites" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d5/d5/cc_8h.html#a148">CcDeferredWrites</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02024">2024</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01982">CcDeferWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l02099">CcPostDeferredWrites()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05143">CcUnpinRepinnedBcb()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a147" doxytag="cc.h::CcDeferredWriteSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d7/d4/ppc_2splocks_8c.html#a1">CcDeferredWriteSpinLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02023">2023</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a151" doxytag="cc.h::CcDirtyPagesLastScan" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a151">CcDirtyPagesLastScan</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02027">2027</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a150" doxytag="cc.h::CcDirtyPageTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a150">CcDirtyPageTarget</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02026">2026</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a149" doxytag="cc.h::CcDirtyPageThreshold" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a149">CcDirtyPageThreshold</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02025">2025</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a124" doxytag="cc.h::CcDirtySharedCacheMapList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html">SHARED_CACHE_MAP_LIST_CURSOR</a> <a class="el" href="../../d5/d5/cc_8h.html#a124">CcDirtySharedCacheMapList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02000">2000</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00142">CcGetDirtyPages()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04232">CcGetFlushedValidData()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d9/d4/logsup_8c-source.html#l00362">CcIsThereDirtyData()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00838">CcMdlWriteComplete2()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02560">CcSetDirtyPinnedData()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02804">CcZeroEndOfLastPage()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a131" doxytag="cc.h::CcExpressWorkQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d5/d5/cc_8h.html#a131">CcExpressWorkQueue</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02007">2007</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01253">CcScheduleReadAhead()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a137" doxytag="cc.h::CcFirstDelay" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER <a class="el" href="../../d5/d5/cc_8h.html#a137">CcFirstDelay</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02013">2013</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00049">CcScheduleLazyWriteScan()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a138" doxytag="cc.h::CcIdleDelay" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER <a class="el" href="../../d5/d5/cc_8h.html#a138">CcIdleDelay</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02014">2014</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00049">CcScheduleLazyWriteScan()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a135" doxytag="cc.h::CcIdleDelayTick" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a135">CcIdleDelayTick</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02011">2011</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a130" doxytag="cc.h::CcIdleWorkerThreadList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d5/d5/cc_8h.html#a130">CcIdleWorkerThreadList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02006">2006</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00662">CcPostWorkQueue()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a159" doxytag="cc.h::CcLazyWriteHotSpots" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a159">CcLazyWriteHotSpots</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02035">2035</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a125" doxytag="cc.h::CcLazyWriterCursor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d3/struct__SHARED__CACHE__MAP__LIST__CURSOR.html">SHARED_CACHE_MAP_LIST_CURSOR</a> <a class="el" href="../../d5/d5/cc_8h.html#a125">CcLazyWriterCursor</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02001">2001</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a121" doxytag="cc.h::CcMasterSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d6/d9/kernlini_8c.html#a8">CcMasterSpinLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l01997">1997</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a161" doxytag="cc.h::CcMaxVacbLevelsSeen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a161">CcMaxVacbLevelsSeen</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02037">2037</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01208">CcCreateVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02044">CcDrainVacbLevelZone()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00947">CcReferenceFileOffset()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a136" doxytag="cc.h::CcNoDelay" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER <a class="el" href="../../d5/d5/cc_8h.html#a136">CcNoDelay</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02012">2012</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a129" doxytag="cc.h::CcNumberActiveWorkerThreads" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a129">CcNumberActiveWorkerThreads</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02005">2005</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00662">CcPostWorkQueue()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a143" doxytag="cc.h::CcNumberVacbs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a143">CcNumberVacbs</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02019">2019</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00188">CcInitializeVacbs()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a128" doxytag="cc.h::CcNumberWorkerThreads" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a128">CcNumberWorkerThreads</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02004">2004</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a153" doxytag="cc.h::CcPagesWrittenLastTime" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a153">CcPagesWrittenLastTime</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02029">2029</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a152" doxytag="cc.h::CcPagesYetToWrite" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a152">CcPagesYetToWrite</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02028">2028</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l03880">CcWriteBehind()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a133" doxytag="cc.h::CcPostTickWorkQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d5/d5/cc_8h.html#a133">CcPostTickWorkQueue</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02009">2009</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00158">CcWaitForCurrentLazyWriterActivity()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a134" doxytag="cc.h::CcQueueThrottle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d5/d5/cc_8h.html#a134">CcQueueThrottle</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02010">2010</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00662">CcPostWorkQueue()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a132" doxytag="cc.h::CcRegularWorkQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d5/d5/cc_8h.html#a132">CcRegularWorkQueue</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02008">2008</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00099">CcScanDpc()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a140" doxytag="cc.h::CcTargetCleanDelay" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER <a class="el" href="../../d5/d5/cc_8h.html#a140">CcTargetCleanDelay</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02016">2016</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a155" doxytag="cc.h::CcTotalDirtyPages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a155">CcTotalDirtyPages</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02031">2031</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02861">CcAcquireByteRangeForWrite()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02626">CcDeleteMbcb()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01517">CcDeleteSharedCacheMap()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05885">CcFreeActiveVacb()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02560">CcSetDirtyPinnedData()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>, and <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00738">CcWorkerThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a156" doxytag="cc.h::CcTune" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a156">CcTune</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02032">2032</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a126" doxytag="cc.h::CcTwilightLookasideList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">NPAGED_LOOKASIDE_LIST</a> <a class="el" href="../../d5/d5/cc_8h.html#a126">CcTwilightLookasideList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02002">2002</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a162" doxytag="cc.h::CcVacbLevelEntries" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a162">CcVacbLevelEntries</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02038">2038</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d4/cc_8h-source.html#l02048">CcAllocateVacbLevel()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02070">CcDeallocateVacbLevel()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02044">CcDrainVacbLevelZone()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01377">CcExtendVacbArray()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01931">CcPrefillVacbLevelZone()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a163" doxytag="cc.h::CcVacbLevelFreeList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a>* <a class="el" href="../../d5/d5/cc_8h.html#a163">CcVacbLevelFreeList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02039">2039</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d4/cc_8h-source.html#l02048">CcAllocateVacbLevel()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02070">CcDeallocateVacbLevel()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02044">CcDrainVacbLevelZone()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01931">CcPrefillVacbLevelZone()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a164" doxytag="cc.h::CcVacbLevelWithBcbsEntries" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d5/cc_8h.html#a164">CcVacbLevelWithBcbsEntries</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02040">2040</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d4/cc_8h-source.html#l02048">CcAllocateVacbLevel()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02070">CcDeallocateVacbLevel()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02044">CcDrainVacbLevelZone()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01931">CcPrefillVacbLevelZone()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a165" doxytag="cc.h::CcVacbLevelWithBcbsFreeList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a>* <a class="el" href="../../d5/d5/cc_8h.html#a165">CcVacbLevelWithBcbsFreeList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02041">2041</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d4/cc_8h-source.html#l02048">CcAllocateVacbLevel()</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02070">CcDeallocateVacbLevel()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02044">CcDrainVacbLevelZone()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l01931">CcPrefillVacbLevelZone()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a146" doxytag="cc.h::CcVacbLru" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d5/d5/cc_8h.html#a146">CcVacbLru</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02022">2022</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, and <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00188">CcInitializeVacbs()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a144" doxytag="cc.h::CcVacbs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d5/struct__VACB.html">PVACB</a> <a class="el" href="../../d5/d5/cc_8h.html#a144">CcVacbs</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02020">2020</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l02534">CcGetVacbLargeOffset()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00188">CcInitializeVacbs()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05024">CcRemapBcb()</a>, and <a class="el" href="../../d7/d1/cachesub_8c-source.html#l00974">CcUnpinFileData()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a142" doxytag="cc.h::CcVacbSpinLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d6/d9/kernlini_8c.html#a9">CcVacbSpinLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02018">2018</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a127" doxytag="cc.h::CcWorkQueueSpinlock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d7/d4/ppc_2splocks_8c.html#a0">CcWorkQueueSpinlock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02003">2003</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a141" doxytag="cc.h::LazyWriter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d9/struct__LAZY__WRITER.html">LAZY_WRITER</a> <a class="el" href="../../d5/d5/cc_8h.html#a141">LazyWriter</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l02017">2017</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05541">CcAllocateInitializeBcb()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01790">CcCanIWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05694">CcDeallocateBcb()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l01982">CcDeferWrite()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04411">CcFlushCache()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l04232">CcGetFlushedValidData()</a>, <a class="el" href="../../d6/d2/vacbsup_8c-source.html#l00401">CcGetVacbMiss()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00387">CcInitializeCacheMap()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00221">CcLazyWriteScan()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00838">CcMdlWriteComplete2()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l02331">CcPurgeCacheSection()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00099">CcScanDpc()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00049">CcScheduleLazyWriteScan()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02242">CcSetDirtyInMask()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02560">CcSetDirtyPinnedData()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01821">CcSetFileSizes()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l01164">CcUninitializeCacheMap()</a>, <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00158">CcWaitForCurrentLazyWriterActivity()</a>, and <a class="el" href="../../d6/d7/fssup_8c-source.html#l02804">CcZeroEndOfLastPage()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a94" doxytag="cc.h::MmAvailablePages" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PFN_COUNT <a class="el" href="../../d0/d9/miglobal_8c.html#a10">MmAvailablePages</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/cc_8h-source.html#l00134">134</a> of file <a class="el" href="../../d6/d4/cc_8h-source.html">cc.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l02824">MiAddWorkingSetPage()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l03179">MiAddWsleHash()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00807">MiAllocatePoolPages()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l03472">MiAllocateSpecialPool()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l00996">MiCheckAndSetSystemTrimCriteria()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l01372">MiCheckProcessTrimCriteria()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l01218">MiCheckSystemTrimEndCriteria()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l01644">MiDetermineWsTrimAmount()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l00254">MiDoReplacement()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00941">MiEnsureAvailablePageOrWait()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l03198">MiGatherMappedPages()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l04222">MiInitializeSessionPool()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00059">MiInsertPageInList()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00388">MiInsertStandbyListAtFront()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l02831">MiModifiedPageWriterWorker()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l00336">MiObtainFreePages()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l01395">MiRemoveAnyPage()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l01567">MiRemovePageByColor()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00521">MiRemovePageFromList()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l01177">MiRemoveZeroPage()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l01989">MiResolveMappedFileFault()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00821">MiUnlinkFreeOrZeroedPage()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00667">MiUnlinkPageFromList()</a>, <a class="el" href="../../d5/d0/mmfault_8c-source.html#l00041">MmAccessFault()</a>, <a class="el" href="../../d0/d3/dynmem_8c-source.html#l00043">MmAddPhysicalMemory()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l02450">MmAdjustWorkingSetSize()</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l01016">MmCheckCachedPageState()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l07930">MmGatherMemoryForHibernate()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l00184">MmInitSystem()</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l01118">MmRaisePoolQuota()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l05567">MmSetMemoryPriorityProcess()</a>, <a class="el" href="../../d2/d8/shutdown_8c-source.html#l00041">MmShutdownSystem()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l00397">MmWorkingSetManager()</a>, and <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00941">NtQuerySystemInformation()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:03 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
