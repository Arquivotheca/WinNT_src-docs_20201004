<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: logon.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>logon.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d6/d4/logon_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/logon_8c.html#a0">_RegisterLogonProcess</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwProcessId, BOOL fSecure)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/logon_8c.html#a1">_LockWindowStation</a> (<a class="el" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/logon_8c.html#a2">_UnlockWindowStation</a> (<a class="el" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d5/logon_8c.html#a3">_SetLogonNotifyWindow</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1" doxytag="logon.c::_LockWindowStation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT _LockWindowStation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwinsta</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/logon_8c-source.html#l00057">57</a> of file <a class="el" href="../../d6/d4/logon_8c-source.html">logon.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02718">tagWINDOWSTATION::dwWSF_Flags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00092">GetCurrentProcessId</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00793">gpidLogon</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00653">grpdeskLogon</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00355">OBJECT_TO_OBJECT_HEADER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02712">tagWINDOWSTATION::rpdeskList</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02647">tagDESKTOP::rpdeskNext</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02703">WSF_OPENLOCK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02705">WSF_SHUTDOWN</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l02702">WSF_SWITCHLOCK</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07070">NtUserLockWindowStation()</a>.
<p>
<pre class="fragment"><div>00059 {
00060     <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdesk;
00061     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fBusy = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00062 
00063     <span class="comment">/*</span>
00064 <span class="comment">     * Make sure the caller is the logon process</span>
00065 <span class="comment">     */</span>
00066     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a19">GetCurrentProcessId</a>() != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a298">gpidLogon</a>) {
00067         RIPERR0(ERROR_ACCESS_DENIED,
00068                 RIP_WARNING,
00069                 <span class="stringliteral">"Access denied in _LockWindowStation"</span>);
00070 
00071         <span class="keywordflow">return</span> WSS_ERROR;
00072     }
00073 
00074     <span class="comment">/*</span>
00075 <span class="comment">     * Prevent desktop switches</span>
00076 <span class="comment">     */</span>
00077     pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a> |= <a class="code" href="../../d4/d1/userk_8h.html#a314">WSF_SWITCHLOCK</a>;
00078 
00079     <span class="comment">/*</span>
00080 <span class="comment">     * Determine whether the station is busy</span>
00081 <span class="comment">     */</span>
00082     pdesk = pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o1">rpdeskList</a>;
00083     <span class="keywordflow">while</span> (pdesk != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00084         <span class="keywordflow">if</span> (pdesk != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a242">grpdeskLogon</a> &amp;&amp;
00085                 <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(pdesk)-&gt;HandleCount != 0) {
00086 
00087             <span class="comment">/*</span>
00088 <span class="comment">             * This desktop is open, thus the station is busy</span>
00089 <span class="comment">             */</span>
00090             fBusy = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00091             <span class="keywordflow">break</span>;
00092         }
00093         pdesk = pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o2">rpdeskNext</a>;
00094     }
00095 
00096     <span class="keywordflow">if</span> (pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a317">WSF_SHUTDOWN</a>)
00097         pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a> |= <a class="code" href="../../d4/d1/userk_8h.html#a315">WSF_OPENLOCK</a>;
00098 
00099     <span class="comment">/*</span>
00100 <span class="comment">     * Unlock opens if the station is busy and is not in the middle</span>
00101 <span class="comment">     * of shutting down.</span>
00102 <span class="comment">     */</span>
00103     <span class="keywordflow">if</span> (fBusy)
00104         <span class="keywordflow">return</span> WSS_BUSY;
00105     <span class="keywordflow">else</span>
00106         <span class="keywordflow">return</span> WSS_IDLE;
00107 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="logon.c::_RegisterLogonProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _RegisterLogonProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwProcessId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fSecure</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/logon_8c-source.html#l00025">25</a> of file <a class="el" href="../../d6/d4/logon_8c-source.html">logon.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00793">gpidLogon</a>, <a class="el" href="../../d3/d9/server_2exitwin_8c-source.html#l02001">IsPrivileged()</a>, <a class="el" href="../../d0/d6/ntuser_2kernel_2globals_8h-source.html#l00512">psTcb</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00028 {
00029     UNREFERENCED_PARAMETER(fSecure);
00030 
00031     <span class="comment">/*</span>
00032 <span class="comment">     * Allow only one logon process and then only if it has TCB</span>
00033 <span class="comment">     * privilege.</span>
00034 <span class="comment">     */</span>
00035     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a298">gpidLogon</a> != 0 || !<a class="code" href="../../d2/d0/server_2exitwin_8c.html#a22">IsPrivileged</a>(&amp;psTcb)) {
00036         RIPERR0(ERROR_ACCESS_DENIED,
00037                 RIP_WARNING,
00038                 <span class="stringliteral">"Access denied in _RegisterLogonProcess"</span>);
00039 
00040         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00041     }
00042 
00043     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a298">gpidLogon</a> = (HANDLE)LongToHandle( dwProcessId );
00044     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00045 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="logon.c::_SetLogonNotifyWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _SetLogonNotifyWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/logon_8c-source.html#l00153">153</a> of file <a class="el" href="../../d6/d4/logon_8c-source.html">logon.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00092">GetCurrentProcessId</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00793">gpidLogon</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00071">gspwndLogonNotify</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07149">NtUserSetLogonNotifyWindow()</a>.
<p>
<pre class="fragment"><div>00155 {
00156     <span class="comment">/*</span>
00157 <span class="comment">     * Make sure the caller is the logon process</span>
00158 <span class="comment">     */</span>
00159     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a19">GetCurrentProcessId</a>() != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a298">gpidLogon</a>) {
00160         RIPERR0(ERROR_ACCESS_DENIED,
00161                 RIP_WARNING,
00162                 <span class="stringliteral">"Access denied in _SetLogonNotifyWindow"</span>);
00163 
00164         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00165     }
00166 
00167     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;gspwndLogonNotify, pwnd);
00168 
00169     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00170 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="logon.c::_UnlockWindowStation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _UnlockWindowStation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwinsta</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d4/logon_8c-source.html#l00119">119</a> of file <a class="el" href="../../d6/d4/logon_8c-source.html">logon.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02718">tagWINDOWSTATION::dwWSF_Flags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00092">GetCurrentProcessId</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00793">gpidLogon</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02703">WSF_OPENLOCK</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02705">WSF_SHUTDOWN</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l02702">WSF_SWITCHLOCK</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07090">NtUserUnlockWindowStation()</a>.
<p>
<pre class="fragment"><div>00121 {
00122 
00123     <span class="comment">/*</span>
00124 <span class="comment">     * Make sure the caller is the logon process</span>
00125 <span class="comment">     */</span>
00126     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a19">GetCurrentProcessId</a>() != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a298">gpidLogon</a>) {
00127         RIPERR0(ERROR_ACCESS_DENIED,
00128                 RIP_WARNING,
00129                 <span class="stringliteral">"Access denied in _UnlockWindowStation"</span>);
00130 
00131         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00132     }
00133 
00134     <span class="comment">/*</span>
00135 <span class="comment">     * If shutdown is occuring, only remove the switch lock.</span>
00136 <span class="comment">     */</span>
00137     <span class="keywordflow">if</span> (pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a317">WSF_SHUTDOWN</a>)
00138         pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a> &amp;= ~<a class="code" href="../../d4/d1/userk_8h.html#a314">WSF_SWITCHLOCK</a>;
00139     <span class="keywordflow">else</span>
00140         pwinsta-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a> &amp;= ~(<a class="code" href="../../d4/d1/userk_8h.html#a315">WSF_OPENLOCK</a> | <a class="code" href="../../d4/d1/userk_8h.html#a314">WSF_SWITCHLOCK</a>);
00141     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00142 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:33 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
