<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: edecrare.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>edecrare.c File Reference</h1><code>#include "<a class="el" href="../../d8/d2/w32_2ntuser_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d6/d3/edecrare_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a0">WS_EX_EDGEMASK</a>&nbsp;&nbsp;&nbsp;(WS_EX_WINDOWEDGE | WS_EX_CLIENTEDGE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a1">GetCharABCWidthsAorW</a>&nbsp;&nbsp;&nbsp;((ped)-&gt;fAnsi ? GetCharABCWidthsA : GetCharABCWidthsW)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a2">GetCharWidthAorW</a>&nbsp;&nbsp;&nbsp;((ped)-&gt;fAnsi ? GetCharWidthA : GetCharWidthW)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a3">umin</a>(a, b)&nbsp;&nbsp;&nbsp;((unsigned)(a) &lt; (unsigned)(b) ? (unsigned)(a) : (unsigned)(b))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a4">GET_COMPOSITION_STRING</a>&nbsp;&nbsp;&nbsp;(ped-&gt;fAnsi ? fpImmGetCompositionStringA : fpImmGetCompositionStringW)</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOL(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a6">PFNABCWIDTHS</a> )(HDC, UINT, UINT, LPABC)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOL(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a7">PFNCHARWIDTH</a> )(HDC, UINT, UINT, LPINT)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a9">GetMaxOverlapChars</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a10">ECSetMargin</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, UINT wFlags, long lMarginValues, BOOL fRedraw)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a11">ECCalcMarginForDBCSFont</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, BOOL fRedraw)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a12">UserGetCharDimensionsEx</a> (HDC hDC, HFONT hfont, LPTEXTMETRIC lptm, LPINT lpcy)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a13">ECGetText</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> maxCchToCopy, LPSTR lpBuffer, BOOL fNullTerminate)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a14">ECNcCreate</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, LPCREATESTRUCT lpCreateStruct)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a15">ECCreate</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, LONG windowStyle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a16">ECNcDestroyHandler</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <a class="el" href="../../d3/d4/structtagED.html">PED</a> ped)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a17">ECSetPasswordChar</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, UINT pwchar)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a18">GetNegABCwidthInfo</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a19">ECSize</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, LPRECT lprc, BOOL fRedraw)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a20">ECSetFont</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HFONT hfont, BOOL fRedraw)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a21">ECIsCharNumeric</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> keyPress)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a22">ECEnableDisableIME</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a23">ECImmSetCompositionWindow</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, LONG x, LONG y)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a24">ECImmSetCompositionFont</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a25">ECInitInsert</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HKL hkl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a26">ECSetCaretHandler</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a27">MLReplaceSel</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a>, LPSTR)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL FAR PASCAL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a28">ECResultStrHandler</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a29">ECImeComposition</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, WPARAM wParam, LPARAM lParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a30">HanjaKeyHandler</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a31">EcImeRequestHandler</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, WPARAM dwSubMsg, LPARAM lParam)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d4/struct__LOOKASIDE.html">LOOKASIDE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a5">EditLookaside</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/edecrare_8c.html#a8">AveCharWidthData</a> [] = L"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a4" doxytag="edecrare.c::GET_COMPOSITION_STRING" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define GET_COMPOSITION_STRING&nbsp;&nbsp;&nbsp;(ped-&gt;fAnsi ? fpImmGetCompositionStringA : fpImmGetCompositionStringW)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01285">1285</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01287">ECResultStrHandler()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="edecrare.c::GetCharABCWidthsAorW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define GetCharABCWidthsAorW&nbsp;&nbsp;&nbsp;((ped)-&gt;fAnsi ? GetCharABCWidthsA : GetCharABCWidthsW)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00025">25</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00109">ECCalcMarginForDBCSFont()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="edecrare.c::GetCharWidthAorW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define GetCharWidthAorW&nbsp;&nbsp;&nbsp;((ped)-&gt;fAnsi ? GetCharWidthA : GetCharWidthW)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00026">26</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="edecrare.c::umin" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define umin          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">a,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>b&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((unsigned)(a) &lt; (unsigned)(b) ? (unsigned)(a) : (unsigned)(b))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00028">28</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/editec_8c-source.html#l01281">ECCchInWidth()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="edecrare.c::WS_EX_EDGEMASK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define WS_EX_EDGEMASK&nbsp;&nbsp;&nbsp;(WS_EX_WINDOWEDGE | WS_EX_CLIENTEDGE)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00020">20</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a6" doxytag="edecrare.c::PFNABCWIDTHS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOL(* <a class="el" href="../../d5/d4/edecrare_8c.html#a6">PFNABCWIDTHS</a>)(HDC, UINT, UINT, LPABC)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00030">30</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="edecrare.c::PFNCHARWIDTH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOL(* <a class="el" href="../../d5/d4/edecrare_8c.html#a7">PFNCHARWIDTH</a>)(HDC, UINT, UINT, LPINT)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00031">31</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a11" doxytag="edecrare.c::ECCalcMarginForDBCSFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ECCalcMarginForDBCSFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fRedraw</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00109">109</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00049">ECSetMargin()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00599">tagED::fSingle</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00639">tagED::fTrueType</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00025">GetCharABCWidthsAorW</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00674">tagED::hFont</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06624">NtUserGetDC()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l01052">ReleaseDC()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00958">UserLocalAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00692">tagED::wMaxNegA</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00708">ECSetFont()</a>.
<p>
<pre class="fragment"><div>00110 {
00111     <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o41">fTrueType</a>)
00112         <span class="keywordflow">return</span>;
00113 
00114     <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o20">fSingle</a>) {
00115         <span class="comment">// wMaxNegA came from ABC CharWidth.</span>
00116         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o76">wMaxNegA</a> != 0) {
00117             <a class="code" href="../../d6/d0/usercli_8h.html#a455">ECSetMargin</a>(ped, EC_LEFTMARGIN | EC_RIGHTMARGIN,
00118                     MAKELONG(EC_USEFONTINFO, EC_USEFONTINFO),fRedraw);
00119         }
00120     } <span class="keywordflow">else</span> {
00121         <span class="keywordtype">int</span>    iMaxNegA = 0, iMaxNegC = 0;
00122         <span class="keywordtype">int</span>    i;
00123         PVOID  lpBuffer;
00124         LPABC  lpABCBuff;
00125         ABC    ABCInfo;
00126         HFONT  hOldFont;
00127         HDC    hdc = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a250">NtUserGetDC</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>);
00128 
00129         <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o66">hFont</a> || !(hOldFont = SelectFont(hdc, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o66">hFont</a>))) {
00130             <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, hdc);
00131             <span class="keywordflow">return</span>;
00132         }
00133 
00134         <span class="keywordflow">if</span> (lpBuffer = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0,<span class="keyword">sizeof</span>(ABC) * 256)) {
00135             lpABCBuff = lpBuffer;
00136             <a class="code" href="../../d5/d4/edecrare_8c.html#a1">GetCharABCWidthsAorW</a>(hdc, 0, 255, lpABCBuff);
00137         } <span class="keywordflow">else</span> {
00138             lpABCBuff = &amp;ABCInfo;
00139             <a class="code" href="../../d5/d4/edecrare_8c.html#a1">GetCharABCWidthsAorW</a>(hdc, 0, 0, lpABCBuff);
00140         }
00141 
00142         i = 0;
00143         <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00144             iMaxNegA = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(iMaxNegA, lpABCBuff-&gt;abcA);
00145             iMaxNegC = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(iMaxNegC, lpABCBuff-&gt;abcC);
00146             <span class="keywordflow">if</span> (++i == 256)
00147                 <span class="keywordflow">break</span>;
00148             <span class="keywordflow">if</span> (lpBuffer) {
00149                 lpABCBuff++;
00150             } <span class="keywordflow">else</span> {
00151                 <a class="code" href="../../d5/d4/edecrare_8c.html#a1">GetCharABCWidthsAorW</a>(hdc, i, i, lpABCBuff);
00152             }
00153         }
00154 
00155         SelectFont(hdc, hOldFont);
00156 
00157         <span class="keywordflow">if</span> (lpBuffer) <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(lpBuffer);
00158 
00159         <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, hdc);
00160 
00161         <span class="keywordflow">if</span> ((iMaxNegA != 0) || (iMaxNegC != 0))
00162            <a class="code" href="../../d6/d0/usercli_8h.html#a455">ECSetMargin</a>(ped, EC_LEFTMARGIN | EC_RIGHTMARGIN,
00163                     MAKELONG((UINT)(-iMaxNegC), (UINT)(-iMaxNegA)),fRedraw);
00164     }
00165 
00166     <span class="keywordflow">return</span>;
00167 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="edecrare.c::ECCreate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ECCreate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>windowStyle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00387">387</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00555">tagED::cchTextMax</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00689">tagED::charSet</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01183">ECInitInsert()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03289">tagLPKEDITCALLOUT::EditCreate</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00609">tagED::fAutoHScroll</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00610">tagED::fNoHideSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00664">tagED::format</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00111">fpLpkEditControl</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01514">HW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00503">MAXTEXT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00585">tagED::pwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01124">THREAD_HKL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02372">WEFRIGHT</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/edmlonce_8c-source.html#l00023">MLCreate()</a>, and <a class="el" href="../../d7/d4/edslrare_8c-source.html#l00027">SLCreate()</a>.
<p>
<pre class="fragment"><div>00390 {
00391     HDC hdc;
00392 
00393     <span class="comment">/*</span>
00394 <span class="comment">     * Get values from the window instance data structure and put them in the</span>
00395 <span class="comment">     * ped so that we can access them easier.</span>
00396 <span class="comment">     */</span>
00397     <span class="keywordflow">if</span> (windowStyle &amp; ES_AUTOHSCROLL)
00398         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o30">fAutoHScroll</a> = 1;
00399     <span class="keywordflow">if</span> (windowStyle &amp; ES_NOHIDESEL)
00400         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o31">fNoHideSel</a> = 1;
00401 
00402     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> = (LOWORD(windowStyle) &amp; LOWORD(ES_FMTMASK));
00403     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>, WEFRIGHT) &amp;&amp; !ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a>)
00404         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> = ES_RIGHT;
00405 
00406     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o2">cchTextMax</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a75">MAXTEXT</a>; <span class="comment">/* Max # chars we will initially allow */</span>
00407 
00408     <span class="comment">/*</span>
00409 <span class="comment">     * Set up undo initial conditions... (ie. nothing to undo)</span>
00410 <span class="comment">     */</span>
00411     ped-&gt;ichDeleted = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>)-1;
00412     ped-&gt;ichInsStart = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>)-1;
00413     ped-&gt;ichInsEnd = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>)-1;
00414 
00415     <span class="comment">// initial charset value - need to do this BEFORE MLCreate is called</span>
00416     <span class="comment">// so that we know not to fool with scrollbars if nessacary</span>
00417     hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, TRUE);
00418     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o75">charSet</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)GetTextCharset(hdc);
00419     <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, TRUE);
00420 
00421     <span class="comment">// FE_IME</span>
00422     <span class="comment">// EC_INSERT_COMPOSITION_CHARACTER: ECCreate() - call ECInitInsert()</span>
00423     <a class="code" href="../../d6/d0/usercli_8h.html#a473">ECInitInsert</a>(ped, <a class="code" href="../../d6/d0/usercli_8h.html#a151">THREAD_HKL</a>());
00424 
00425     <span class="keywordflow">if</span>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a> = <a class="code" href="../../d1/d8/clglobal_8c.html#a35">fpLpkEditControl</a>) {
00426         <span class="keywordflow">return</span> ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>-&gt;<a class="code" href="../../d2/d0/structtagLPKEDITCALLOUT.html#o0">EditCreate</a>(ped, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>));
00427     } <span class="keywordflow">else</span>
00428         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00429 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="edecrare.c::ECEnableDisableIME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ECEnableDisableIME           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ped</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01037">1037</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00578">tagED::charPasswordChar</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01150">ECImmSetCompositionFont()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01085">ECImmSetCompositionWindow()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01183">ECInitInsert()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02529">fpImmAssociateContext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02532">fpImmGetContext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02539">fpImmReleaseContext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00632">tagED::fReadOnly</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00712">tagED::hImcPrev</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07458">NtUserGetCaretPos()</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00025">NULL_HIMC</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01124">THREAD_HKL</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00516">ECSetPasswordChar()</a>, and <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>.
<p>
<pre class="fragment"><div>01038 {
01039     <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o39">fReadOnly</a> || ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a> ) {
01040     <span class="comment">//</span>
01041     <span class="comment">// IME should be disabled</span>
01042     <span class="comment">//</span>
01043         HIMC hImc;
01044         hImc = <a class="code" href="../../d6/d0/usercli_8h.html#a307">fpImmGetContext</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a> );
01045 
01046         <span class="keywordflow">if</span> ( hImc != <a class="code" href="../../d8/d0/immstruc_8h.html#a0">NULL_HIMC</a> ) {
01047             <a class="code" href="../../d6/d0/usercli_8h.html#a314">fpImmReleaseContext</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, hImc );
01048             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o92">hImcPrev</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a304">fpImmAssociateContext</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, NULL_HIMC );
01049         }
01050 
01051     } <span class="keywordflow">else</span> {
01052     <span class="comment">//</span>
01053     <span class="comment">// IME should be enabled</span>
01054     <span class="comment">//</span>
01055         <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o92">hImcPrev</a> != <a class="code" href="../../d8/d0/immstruc_8h.html#a0">NULL_HIMC</a> ) {
01056             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o92">hImcPrev</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a304">fpImmAssociateContext</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o92">hImcPrev</a> );
01057 
01058             <span class="comment">//</span>
01059             <span class="comment">// Font and the caret position might be changed while</span>
01060             <span class="comment">// IME was being disabled. Set those now if the window</span>
01061             <span class="comment">// has the focus.</span>
01062             <span class="comment">//</span>
01063             <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a> ) {
01064                 POINT pt;
01065 
01066                 <a class="code" href="../../d6/d0/usercli_8h.html#a470">ECImmSetCompositionFont</a>( ped );
01067 
01068                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a274">NtUserGetCaretPos</a>( &amp;pt );
01069                 <a class="code" href="../../d6/d0/usercli_8h.html#a471">ECImmSetCompositionWindow</a>( ped, pt.x, pt.y  );
01070             }
01071         }
01072     }
01073     <a class="code" href="../../d6/d0/usercli_8h.html#a473">ECInitInsert</a>(ped, <a class="code" href="../../d6/d0/usercli_8h.html#a151">THREAD_HKL</a>());
01074 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="edecrare.c::ECGetText" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ECGetText           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>maxCchToCopy</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fNullTerminate</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00246">246</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00661">tagED::cbChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, and <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>.
<p>
<pre class="fragment"><div>00251 {
00252     PSTR pText;
00253 
00254     <span class="keywordflow">if</span> (maxCchToCopy) {
00255 
00256         <span class="comment">/*</span>
00257 <span class="comment">         * Zero terminator takes the extra byte</span>
00258 <span class="comment">         */</span>
00259         <span class="keywordflow">if</span> (fNullTerminate)
00260             maxCchToCopy--;
00261         maxCchToCopy = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(maxCchToCopy, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>);
00262 
00263         <span class="comment">/*</span>
00264 <span class="comment">         * Zero terminate the string</span>
00265 <span class="comment">         */</span>
00266         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>)
00267             *(LPSTR)(lpBuffer + maxCchToCopy) = 0;
00268         <span class="keywordflow">else</span>
00269             *(((LPWSTR)lpBuffer) + maxCchToCopy) = 0;
00270 
00271         pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00272         RtlCopyMemory(lpBuffer, pText, maxCchToCopy*ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>);
00273         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00274     }
00275 
00276     <span class="keywordflow">return</span> maxCchToCopy;
00277 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="edecrare.c::ECImeComposition" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT ECImeComposition           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01337">1337</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00555">tagED::cchTextMax</a>, <a class="el" href="../../d1/d8/clmsg_8c-source.html#l00574">DefWindowProcWorker()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02293">ECDeleteText()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00402">ECInOutReconversionMode()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02429">ECNotifyParent()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01287">ECResultStrHandler()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01225">ECSetCaretHandler()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00651">tagED::fInsertCompChr</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00601">tagED::fMouseDown</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00653">tagED::fNoMoveCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02532">fpImmGetContext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02547">fpImmNotifyIME</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02539">fpImmReleaseContext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00652">tagED::fReplaceCompChr</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00654">tagED::fResultProcess</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00599">tagED::fSingle</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00184">HIBYTE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00564">tagED::ichCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l01367">MLDeleteText()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l01040">MLInsertText()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01564">NtUserMessageBeep</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00585">tagED::pwnd</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01074">SLInsertText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00932">SLScrollText()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00659">tagED::wImeStatus</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>.
<p>
<pre class="fragment"><div>01338 {
01339     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> ich;
01340     LRESULT lReturn = 1;
01341     HDC hdc;
01342     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSLTextUpdated = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01343     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> iResult;
01344     HIMC hImc;
01345     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> TextBuf[4];
01346 
01347     <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o52">fInsertCompChr</a>) {
01348         <span class="keywordflow">if</span> (lParam &amp; GCS_RESULTSTR) {
01349             <a class="code" href="../../d6/d0/usercli_8h.html#a477">ECInOutReconversionMode</a>(ped, FALSE);
01350 
01351             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o59">wImeStatus</a> &amp; EIMES_GETCOMPSTRATONCE) {
01352 ResultAtOnce:
01353                 <a class="code" href="../../d5/d4/edecrare_8c.html#a28">ECResultStrHandler</a>(ped);
01354                 lParam &amp;= ~GCS_RESULTSTR;
01355             }
01356         }
01357         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>, WM_IME_COMPOSITION, wParam, lParam, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>);
01358     }
01359 
01360     <span class="comment">// In case of Ansi edit control, the length of minimum composition string</span>
01361     <span class="comment">// is 2. Check here maximum byte of edit control.</span>
01362     <span class="keywordflow">if</span>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o2">cchTextMax</a> == 1 ) {
01363         HIMC hImc;
01364 
01365         hImc = <a class="code" href="../../d6/d0/usercli_8h.html#a307">fpImmGetContext</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a> );
01366         <a class="code" href="../../d6/d0/usercli_8h.html#a322">fpImmNotifyIME</a>(hImc, NI_COMPOSITIONSTR, CPS_CANCEL, 0L);
01367         <a class="code" href="../../d6/d0/usercli_8h.html#a314">fpImmReleaseContext</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, hImc );
01368         <a class="code" href="../../d6/d0/usercli_8h.html#a219">NtUserMessageBeep</a>(MB_ICONEXCLAMATION);
01369         <span class="keywordflow">return</span> lReturn;
01370     }
01371 
01372     <span class="comment">// Don't move this after CS_NOMOVECARET check.</span>
01373     <span class="comment">// In case if skip the message, fNoMoveCaret should not be set.</span>
01374     <span class="keywordflow">if</span> ((lParam &amp; CS_INSERTCHAR) &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o55">fResultProcess</a>) {
01375 
01376         <span class="comment">// Now we're in result processing. GCS_RESULTSTR ends up</span>
01377         <span class="comment">// to WM_IME_CHAR and WM_CHAR. Since WM_CHAR is posted,</span>
01378         <span class="comment">// the message(s) will come later than this CS_INSERTCHAR</span>
01379         <span class="comment">// message. This composition character should be handled</span>
01380         <span class="comment">// after the WM_CHAR message(s).</span>
01381         <span class="comment">//</span>
01382         <span class="keywordflow">if</span>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>)
01383             PostMessageA(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, WM_IME_COMPOSITION, wParam, lParam);
01384         <span class="keywordflow">else</span>
01385             PostMessageW(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, WM_IME_COMPOSITION, wParam, lParam);
01386         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o55">fResultProcess</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01387         <span class="keywordflow">return</span> lReturn;
01388     }
01389 
01390 <span class="comment">//</span>
01391 <span class="comment">// If fReplaceCompChr is TRUE, we change the shape of caret. A block</span>
01392 <span class="comment">// caret is displayed on the composition character. From the user's</span>
01393 <span class="comment">// point of view, there is no difference if the caret is before the</span>
01394 <span class="comment">// composition character or after the composition character. When</span>
01395 <span class="comment">// the composition character is finalized, the insertion point should</span>
01396 <span class="comment">// be moved to after the character, any way. Therefore checking</span>
01397 <span class="comment">// CS_NOMOVECARET bit doesn't make sense in our current implementation.</span>
01398 <span class="comment">// [takaok]</span>
01399 <span class="comment">//</span>
01400 <span class="preprocessor">#if 0</span>
01401 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (lParam &amp; CS_NOMOVECARET)
01402         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o54">fNoMoveCaret</a>=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;   <span class="comment">// stick to current caret pos.</span>
01403     <span class="keywordflow">else</span>
01404         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o54">fNoMoveCaret</a>=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01405 <span class="preprocessor">#endif</span>
01406 <span class="preprocessor"></span>
01407     <span class="keywordflow">if</span> (lParam &amp; GCS_RESULTSTR) {
01408 
01409         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o59">wImeStatus</a> &amp; EIMES_GETCOMPSTRATONCE) {
01410             <span class="keywordflow">goto</span> ResultAtOnce;
01411         }
01412 
01413         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o55">fResultProcess</a>=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01414         <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o53">fReplaceCompChr</a> ) {
01415             <span class="comment">//</span>
01416             <span class="comment">// we have a DBCS character to be replaced.</span>
01417             <span class="comment">// let's delete it before inserting the new one.</span>
01418             <span class="comment">//</span>
01419             ich = (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>) ? 2 : 1;
01420             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o53">fReplaceCompChr</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01421             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> + ich, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>);
01422             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01423             <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d0/usercli_8h.html#a447">ECDeleteText</a>( ped ) &gt; 0 ) {
01424                 <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o20">fSingle</a> ) {
01425                     <span class="comment">//</span>
01426                     <span class="comment">// Update the display</span>
01427                     <span class="comment">//</span>
01428                     <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_UPDATE);
01429                     hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped,FALSE);
01430                     <a class="code" href="../../d6/d0/usercli_8h.html#a527">SLDrawText</a>(ped, hdc, 0);
01431                     <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped,hdc,FALSE);
01432                     <span class="comment">//</span>
01433                     <span class="comment">// Tell parent our text contents changed.</span>
01434                     <span class="comment">//</span>
01435                     <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_CHANGE);
01436                 }
01437             }
01438             <a class="code" href="../../d6/d0/usercli_8h.html#a472">ECSetCaretHandler</a>( ped );
01439         }
01440 
01441     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(lParam &amp; CS_INSERTCHAR) {
01442 
01443         <span class="comment">//</span>
01444         <span class="comment">// If we are in the middle of a mousedown command, don't do anything.</span>
01445         <span class="comment">//</span>
01446         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o22">fMouseDown</a>) {
01447             <span class="keywordflow">return</span> lReturn;
01448         }
01449 
01450         <span class="comment">//</span>
01451         <span class="comment">// We can safely assume that interimm character is always DBCS.</span>
01452         <span class="comment">//</span>
01453         ich = ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> ) ? 2 : 1;
01454 
01455         <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o53">fReplaceCompChr</a> ) {
01456             <span class="comment">//</span>
01457             <span class="comment">// we have a character to be replaced.</span>
01458             <span class="comment">// let's delete it before inserting the new one.</span>
01459             <span class="comment">// when we have a composition characters, the</span>
01460             <span class="comment">// caret is placed before the composition character.</span>
01461             <span class="comment">//</span>
01462             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>+ich, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>);
01463             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01464         }
01465 
01466         <span class="comment">//</span>
01467         <span class="comment">// let's delete current selected text or composition character</span>
01468         <span class="comment">//</span>
01469         <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o20">fSingle</a> ) {
01470             <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d0/usercli_8h.html#a447">ECDeleteText</a>( ped ) &gt; 0 ) {
01471                 fSLTextUpdated = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01472             }
01473         } <span class="keywordflow">else</span> {
01474             <a class="code" href="../../d6/d0/usercli_8h.html#a484">MLDeleteText</a>( ped );
01475         }
01476 
01477         <span class="comment">//</span>
01478         <span class="comment">// When the composition charcter is canceled, IME may give us NULL wParam,</span>
01479         <span class="comment">// with CS_INSERTCHAR flag on. We shouldn't insert a NULL character.</span>
01480         <span class="comment">//</span>
01481         <span class="keywordflow">if</span> ( wParam != 0 ) {
01482 
01483             <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> ) {
01484                 TextBuf[0] = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(LOWORD(wParam)); <span class="comment">// leading byte</span>
01485                 TextBuf[1] = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(LOWORD(wParam)); <span class="comment">// trailing byte</span>
01486                 TextBuf[2] = <span class="charliteral">'\0'</span>;
01487             } <span class="keywordflow">else</span> {
01488                 TextBuf[0] = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(LOWORD(wParam));
01489                 TextBuf[1] = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(LOWORD(wParam));
01490                 TextBuf[2] = <span class="charliteral">'\0'</span>;
01491                 TextBuf[3] = <span class="charliteral">'\0'</span>;
01492             }
01493 
01494             <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o20">fSingle</a> ) {
01495 
01496                 iResult = <a class="code" href="../../d6/d0/usercli_8h.html#a532">SLInsertText</a>( ped, (LPSTR)TextBuf, ich );
01497                 <span class="keywordflow">if</span> (iResult == 0) {
01498                     <span class="comment">/*</span>
01499 <span class="comment">                     * Couldn't insert the text, for e.g. the text exceeded the limit.</span>
01500 <span class="comment">                     */</span>
01501                     <a class="code" href="../../d6/d0/usercli_8h.html#a219">NtUserMessageBeep</a>(0);
01502                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iResult &gt; 0) {
01503                     <span class="comment">/*</span>
01504 <span class="comment">                     * Remember we need to update the text.</span>
01505 <span class="comment">                     */</span>
01506                     fSLTextUpdated = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01507                 }
01508 
01509             } <span class="keywordflow">else</span> {
01510 
01511                 iResult = <a class="code" href="../../d6/d0/usercli_8h.html#a483">MLInsertText</a>( ped, (LPSTR)TextBuf, ich, TRUE);
01512             }
01513 
01514             <span class="keywordflow">if</span> ( iResult &gt; 0 ) {
01515                 <span class="comment">//</span>
01516                 <span class="comment">// ped-&gt;fReplaceCompChr will be reset:</span>
01517                 <span class="comment">//</span>
01518                 <span class="comment">// 1) when the character is finalized.</span>
01519                 <span class="comment">//    we will receive GCS_RESULTSTR</span>
01520                 <span class="comment">//</span>
01521                 <span class="comment">// 2) when the character is canceled.</span>
01522                 <span class="comment">//</span>
01523                 <span class="comment">//    we will receive WM_IME_COMPOSITION|CS_INSERTCHAR</span>
01524                 <span class="comment">//    with wParam == 0 (in case of user types backspace</span>
01525                 <span class="comment">//    at the first element of composition character).</span>
01526                 <span class="comment">//</span>
01527                 <span class="comment">//      or</span>
01528                 <span class="comment">//</span>
01529                 <span class="comment">//    we will receive WM_IME_ENDCOMPOSITION message</span>
01530                 <span class="comment">//</span>
01531                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o53">fReplaceCompChr</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01532 
01533                 <span class="comment">//</span>
01534                 <span class="comment">// Caret should be placed BEFORE the composition</span>
01535                 <span class="comment">// character.</span>
01536                 <span class="comment">//</span>
01537                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>( 0, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> - ich);
01538                 <a class="code" href="../../d6/d0/usercli_8h.html#a472">ECSetCaretHandler</a>( ped );
01539             } <span class="keywordflow">else</span> {
01540 
01541                 <span class="comment">//</span>
01542                 <span class="comment">// We failed to insert a character. We might run out</span>
01543                 <span class="comment">// of memory, or reached to the text size limit. let's</span>
01544                 <span class="comment">// cancel the composition character.</span>
01545                 <span class="comment">//</span>
01546                 hImc = <a class="code" href="../../d6/d0/usercli_8h.html#a307">fpImmGetContext</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>);
01547                 <a class="code" href="../../d6/d0/usercli_8h.html#a322">fpImmNotifyIME</a>(hImc, NI_COMPOSITIONSTR, CPS_CANCEL, 0);
01548                 <a class="code" href="../../d6/d0/usercli_8h.html#a314">fpImmReleaseContext</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, hImc);
01549 
01550                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o53">fReplaceCompChr</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01551                 <a class="code" href="../../d6/d0/usercli_8h.html#a472">ECSetCaretHandler</a>( ped );
01552             }
01553         } <span class="keywordflow">else</span> {
01554             <span class="comment">//</span>
01555             <span class="comment">// the composition character is canceled.</span>
01556             <span class="comment">//</span>
01557             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o53">fReplaceCompChr</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01558             <a class="code" href="../../d6/d0/usercli_8h.html#a472">ECSetCaretHandler</a>( ped );
01559         }
01560 
01561         <span class="comment">//</span>
01562         <span class="comment">// We won't notify parent the text change</span>
01563         <span class="comment">// because the composition character has</span>
01564         <span class="comment">// not been finalized.</span>
01565         <span class="comment">//</span>
01566         <span class="keywordflow">if</span> ( fSLTextUpdated ) {
01567 
01568             <span class="comment">//</span>
01569             <span class="comment">// Update the display</span>
01570             <span class="comment">//</span>
01571             <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_UPDATE);
01572 
01573             hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped,FALSE);
01574 
01575             <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o53">fReplaceCompChr</a> ) {
01576                 <span class="comment">//</span>
01577                 <span class="comment">// move back the caret to the original position</span>
01578                 <span class="comment">// temporarily so that our new block cursor can</span>
01579                 <span class="comment">// be located within the visible area of window.</span>
01580                 <span class="comment">//</span>
01581                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> + ich);
01582                 <a class="code" href="../../d6/d0/usercli_8h.html#a530">SLScrollText</a>(ped, hdc);
01583                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>( 0, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> - ich);
01584             } <span class="keywordflow">else</span> {
01585                 <a class="code" href="../../d6/d0/usercli_8h.html#a530">SLScrollText</a>(ped, hdc);
01586             }
01587             <a class="code" href="../../d6/d0/usercli_8h.html#a527">SLDrawText</a>(ped, hdc, 0);
01588 
01589             <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped,hdc,FALSE);
01590 
01591             <span class="comment">//</span>
01592             <span class="comment">// Tell parent our text contents changed.</span>
01593             <span class="comment">//</span>
01594             <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_CHANGE);
01595         }
01596         <span class="keywordflow">return</span> lReturn;
01597     }
01598 
01599     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>, WM_IME_COMPOSITION, wParam, lParam, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>);
01600 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="edecrare.c::EcImeRequestHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT EcImeRequestHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>dwSubMsg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01735">1735</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00661">tagED::cbChar</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01085">ECImmSetCompositionWindow()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00402">ECInOutReconversionMode()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02537">fpImmIsIME</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00552">tagED::hText</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d7/d2/kcodecnv_8c-source.html#l00021">lpDest</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01124">THREAD_HKL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>.
<p>
<pre class="fragment"><div>01736 {
01737     LRESULT lreturn = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01738 
01739     <span class="keywordflow">switch</span> (dwSubMsg) {
01740     <span class="keywordflow">case</span> IMR_CONFIRMRECONVERTSTRING:
01741         <span class="comment">// Edit control does not allow IME to change it.</span>
01742         <span class="keywordflow">break</span>;
01743 
01744     <span class="keywordflow">case</span> IMR_RECONVERTSTRING:
01745         <span class="comment">//</span>
01746         <span class="comment">// CHECK VERSION of the structure</span>
01747         <span class="comment">//</span>
01748         <span class="keywordflow">if</span> (lParam &amp;&amp; ((LPRECONVERTSTRING)lParam)-&gt;dwVersion != 0) {
01749             RIPMSG1(RIP_WARNING, <span class="stringliteral">"EcImeRequestHandler: RECONVERTSTRING dwVersion is not expected."</span>,
01750                 ((LPRECONVERTSTRING)lParam)-&gt;dwVersion);
01751             <span class="keywordflow">return</span> 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
01752         }
01753 
01754         <span class="keywordflow">if</span> (ped &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a> &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o0">hText</a> &amp;&amp; <a class="code" href="../../d6/d0/usercli_8h.html#a312">fpImmIsIME</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a151">THREAD_HKL</a>())) {
01755             <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cchLen = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>;    <span class="comment">// holds character count.</span>
01756             <span class="keywordflow">if</span> (cchLen == 0) {
01757                 <span class="comment">// if we have no selection,</span>
01758                 <span class="comment">// just return 0.</span>
01759                 <span class="keywordflow">break</span>;
01760             }
01761 
01762             UserAssert(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a> == <span class="keyword">sizeof</span>(BYTE) || ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a> == <span class="keyword">sizeof</span>(WCHAR));
01763 
01764             <span class="comment">// This Edit Control has selection.</span>
01765             <span class="keywordflow">if</span> (lParam == 0) {
01766                 <span class="comment">//</span>
01767                 <span class="comment">// IME just want to get required size for buffer.</span>
01768                 <span class="comment">// cchLen + 1 is needed to reserve room for trailing L'\0'.</span>
01769                 <span class="comment">//       ~~~~</span>
01770                 lreturn = <span class="keyword">sizeof</span>(RECONVERTSTRING) + (cchLen + 1) * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>;
01771             } <span class="keywordflow">else</span> {
01772                 LPRECONVERTSTRING lpRCS = (LPRECONVERTSTRING)lParam;
01773                 <a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> lpSrc;
01774                 <a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> <a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a> = (LPBYTE)lpRCS + <span class="keyword">sizeof</span>(RECONVERTSTRING);
01775 
01776                 <span class="comment">// check buffer size</span>
01777                 <span class="comment">// if the given buffer is smaller than actual needed size,</span>
01778                 <span class="comment">// shrink our size to fit the buffer</span>
01779                 <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)lpRCS-&gt;dwSize &lt;= <span class="keyword">sizeof</span>(RECONVERTSTRING) + cchLen * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>) {
01780                     RIPMSG0(RIP_WARNING, <span class="stringliteral">"EcImeRequest: ERR09"</span>);
01781                     cchLen = (lpRCS-&gt;dwSize - <span class="keyword">sizeof</span>(RECONVERTSTRING)) / ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>;
01782                 }
01783 
01784                 lpRCS-&gt;dwStrOffset = <span class="keyword">sizeof</span>(RECONVERTSTRING); <span class="comment">// buffer begins just after RECONVERTSTRING</span>
01785                 lpRCS-&gt;dwCompStrOffset =
01786                 lpRCS-&gt;dwTargetStrOffset = 0;
01787                 lpRCS-&gt;dwStrLen =
01788                 lpRCS-&gt;dwCompStrLen =
01789                 lpRCS-&gt;dwTargetStrLen = cchLen; <span class="comment">// StrLen means TCHAR count</span>
01790 
01791                 lpSrc = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
01792                 <span class="keywordflow">if</span> (lpSrc == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01793                     RIPMSG0(RIP_WARNING, <span class="stringliteral">"EcImeRequestHandler: LOCALLOCK(ped) failed."</span>);
01794                 } <span class="keywordflow">else</span> {
01795                     RtlCopyMemory(lpDest,
01796                                   (LPBYTE)lpSrc + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>,
01797                                   cchLen * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>);
01798                     <span class="comment">// Null-Terminate the string</span>
01799                     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>) {
01800                         LPBYTE psz = (LPBYTE)<a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a>;
01801                         psz[cchLen] = <span class="charliteral">'\0'</span>;
01802                     } <span class="keywordflow">else</span> {
01803                         LPWSTR pwsz = (LPWSTR)<a class="code" href="../../d6/d3/kcodecnv_8c.html#a4">lpDest</a>;
01804                         pwsz[cchLen] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
01805                     }
01806                     <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
01807                     <span class="comment">// final buffer size</span>
01808                     lreturn = <span class="keyword">sizeof</span>(RECONVERTSTRING) + (cchLen + 1) * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>;
01809 
01810                     <a class="code" href="../../d6/d0/usercli_8h.html#a477">ECInOutReconversionMode</a>(ped, TRUE);
01811                     <a class="code" href="../../d6/d0/usercli_8h.html#a471">ECImmSetCompositionWindow</a>(ped, 0, 0);
01812                 }
01813             }
01814 
01815         }
01816         <span class="keywordflow">break</span>;
01817     }
01818 
01819     <span class="keywordflow">return</span> lreturn;
01820 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="edecrare.c::ECImmSetCompositionFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ECImmSetCompositionFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ped</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01150">1150</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l02532">fpImmGetContext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02539">fpImmReleaseContext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02543">fpImmSetCompositionFontW</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00674">tagED::hFont</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00098">lf</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00025">NULL_HIMC</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01037">ECEnableDisableIME()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00708">ECSetFont()</a>, and <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>.
<p>
<pre class="fragment"><div>01151 {
01152     HIMC hImc;
01153     LOGFONTW <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>;
01154 
01155     <span class="keywordflow">if</span> ( (hImc = <a class="code" href="../../d6/d0/usercli_8h.html#a307">fpImmGetContext</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a> )) != <a class="code" href="../../d8/d0/immstruc_8h.html#a0">NULL_HIMC</a> ) {
01156 
01157         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o66">hFont</a>) {
01158             GetObjectW( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o66">hFont</a>,
01159                         <span class="keyword">sizeof</span>(LOGFONTW),
01160                         (LPLOGFONTW)&amp;lf);
01161         } <span class="keywordflow">else</span> {
01162             GetObjectW( GetStockObject(SYSTEM_FONT),
01163                         <span class="keyword">sizeof</span>(LOGFONTW),
01164                         (LPLOGFONTW)&amp;lf);
01165         }
01166         <a class="code" href="../../d6/d0/usercli_8h.html#a318">fpImmSetCompositionFontW</a>( hImc, &amp;lf );
01167         <a class="code" href="../../d6/d0/usercli_8h.html#a314">fpImmReleaseContext</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, hImc );
01168     }
01169 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="edecrare.c::ECImmSetCompositionWindow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ECImmSetCompositionWindow           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>x</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>y</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01085">1085</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00656">tagED::fInReconversion</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02535">fpImmGetCompositionWindow</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02532">fpImmGetContext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02539">fpImmReleaseContext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02546">fpImmSetCompositionWindow</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00599">tagED::fSingle</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00143">GET_X_LPARAM</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00147">GET_Y_LPARAM</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00655">GetWindowRect()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00155">MapWindowPoints()</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00025">NULL_HIMC</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00713">tagED::ptScreenBounding</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00245">SetRectEmpty</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/editec_8c-source.html#l00423">ECDoIMEMenuCommand()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01037">ECEnableDisableIME()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01735">EcImeRequestHandler()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00597">ECSize()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l00292">MLSetCaretPosition()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00126">SLSetCaretPosition()</a>.
<p>
<pre class="fragment"><div>01086 {
01087     COMPOSITIONFORM cf;
01088     COMPOSITIONFORM cft;
01089     RECT rcScreenWindow;
01090     HIMC hImc;
01091 
01092     hImc = <a class="code" href="../../d6/d0/usercli_8h.html#a307">fpImmGetContext</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a> );
01093     <span class="keywordflow">if</span> ( hImc != <a class="code" href="../../d8/d0/immstruc_8h.html#a0">NULL_HIMC</a> ) {
01094 
01095         <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a> ) {
01096             <a class="code" href="../../d3/d9/client_2wow_8c.html#a26">GetWindowRect</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, &amp;rcScreenWindow);
01097             <span class="comment">// assuming RECT.left is the first and and RECT.top is the second field</span>
01098             <a class="code" href="../../d3/d8/winmgrc_8c.html#a15">MapWindowPoints</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, HWND_DESKTOP, (LPPOINT)&amp;rcScreenWindow, 2);
01099             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o57">fInReconversion</a>) {
01100                 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwPoint = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> ? SendMessageA : SendMessageW)(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, EM_POSFROMCHAR, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>, 0);
01101 
01102                 x = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a7">GET_X_LPARAM</a>(dwPoint);
01103                 y = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a8">GET_Y_LPARAM</a>(dwPoint);
01104 
01105                 RIPMSG2(RIP_WARNING, <span class="stringliteral">"ECImmSetCompositionWindow: fInReconversion (%d,%d)"</span>, x, y);
01106             }
01107             <span class="comment">//</span>
01108             <span class="comment">// The window currently has the focus.</span>
01109             <span class="comment">//</span>
01110             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o20">fSingle</a>) {
01111                 <span class="comment">//</span>
01112                 <span class="comment">// Single line edit control.</span>
01113                 <span class="comment">//</span>
01114                 cf.dwStyle = CFS_POINT;
01115                 cf.ptCurrentPos.x = x;
01116                 cf.ptCurrentPos.y = y;
01117                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a35">SetRectEmpty</a>(&amp;cf.rcArea);
01118 
01119             } <span class="keywordflow">else</span> {
01120                 <span class="comment">//</span>
01121                 <span class="comment">// Multi line edit control.</span>
01122                 <span class="comment">//</span>
01123                 cf.dwStyle = CFS_RECT;
01124                 cf.ptCurrentPos.x = x;
01125                 cf.ptCurrentPos.y = y;
01126                 cf.rcArea = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>;
01127             }
01128             <a class="code" href="../../d6/d0/usercli_8h.html#a310">fpImmGetCompositionWindow</a>( hImc, &amp;cft );
01129             <span class="keywordflow">if</span> ( (!RtlEqualMemory(&amp;cf,&amp;cft,<span class="keyword">sizeof</span>(COMPOSITIONFORM))) ||
01130                  (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o93">ptScreenBounding</a>.x != rcScreenWindow.left)    ||
01131                  (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o93">ptScreenBounding</a>.y  != rcScreenWindow.top) ) {
01132 
01133                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o93">ptScreenBounding</a>.x = rcScreenWindow.left;
01134                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o93">ptScreenBounding</a>.y = rcScreenWindow.top;
01135                 <a class="code" href="../../d6/d0/usercli_8h.html#a321">fpImmSetCompositionWindow</a>( hImc, &amp;cf );
01136             }
01137         }
01138         <a class="code" href="../../d6/d0/usercli_8h.html#a314">fpImmReleaseContext</a>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, hImc );
01139     }
01140 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="edecrare.c::ECInitInsert" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ECInitInsert           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HKL&nbsp;</td>
          <td class="mdname" nowrap> <em>hkl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01183">1183</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01225">ECSetCaretHandler()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00651">tagED::fInsertCompChr</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00655">tagED::fKorea</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00653">tagED::fNoMoveCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02537">fpImmIsIME</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00652">tagED::fReplaceCompChr</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00654">tagED::fResultProcess</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00387">ECCreate()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01037">ECEnableDisableIME()</a>, and <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>.
<p>
<pre class="fragment"><div>01184 {
01185     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o56">fKorea</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01186     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o52">fInsertCompChr</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01187     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o54">fNoMoveCaret</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01188     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o55">fResultProcess</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01189 
01190     <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d0/usercli_8h.html#a312">fpImmIsIME</a>(hkl) ) {
01191         <span class="keywordflow">if</span> (  PRIMARYLANGID(LOWORD(HandleToUlong(hkl))) == LANG_KOREAN ) {
01192 
01193             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o56">fKorea</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01194         }
01195         <span class="comment">//</span>
01196         <span class="comment">// LATER:this flag should be set based on the IME caps</span>
01197         <span class="comment">// retrieved from IME. (Such IME caps should be defined)</span>
01198         <span class="comment">// For now, we can safely assume that only Korean IMEs</span>
01199         <span class="comment">// set CS_INSERTCHAR.</span>
01200         <span class="comment">//</span>
01201         <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o56">fKorea</a> ) {
01202             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o52">fInsertCompChr</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01203         }
01204     }
01205 
01206     <span class="comment">//</span>
01207     <span class="comment">// if we had a composition character, the shape of caret</span>
01208     <span class="comment">// is changed. We need to reset the caret shape.</span>
01209     <span class="comment">//</span>
01210     <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o53">fReplaceCompChr</a> ) {
01211         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o53">fReplaceCompChr</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01212         <a class="code" href="../../d6/d0/usercli_8h.html#a472">ECSetCaretHandler</a>( ped );
01213     }
01214 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="edecrare.c::ECIsCharNumeric" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ECIsCharNumeric           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>keyPress</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01010">1010</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01124">THREAD_HKL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/editml_8c-source.html#l02531">MLChar()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l01304">SLChar()</a>.
<p>
<pre class="fragment"><div>01013 {
01014     WORD wCharType;
01015 
01016     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>) {
01017         <span class="keywordtype">char</span> ch = (<span class="keywordtype">char</span>)keyPress;
01018         LCID lcid = (LCID)((ULONG_PTR)<a class="code" href="../../d6/d0/usercli_8h.html#a151">THREAD_HKL</a>() &amp; 0xFFFF);
01019         GetStringTypeA(lcid, CT_CTYPE1, &amp;ch, 1, &amp;wCharType);
01020     } <span class="keywordflow">else</span> {
01021         WCHAR wch = (WCHAR)keyPress;
01022         GetStringTypeW(CT_CTYPE1, &amp;wch, 1, &amp;wCharType);
01023     }
01024     <span class="keywordflow">return</span> (wCharType &amp; C1_DIGIT ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01025 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="edecrare.c::ECNcCreate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ECNcCreate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCREATESTRUCT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpCreateStruct</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00285">285</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00661">tagED::cbChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00553">tagED::cchAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00484">CCHALLOCEXTRA</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00688">tagED::charWidthBuffer</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00662">tagED::chLines</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2kernel_2random_8c-source.html#l00102">ClearWindowState()</a>, <a class="el" href="../../d1/d8/clmsg_8c-source.html#l00574">DefWindowProcWorker()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00018">EditLookaside</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02491">EFMULTILINE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02500">EFREADONLY</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00642">tagED::f40Compat</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00607">tagED::fBorder</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00604">tagED::fDisabled</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00708">tagED::fEncoded</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00643">tagED::fFlatBorder</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00836">FNID_CLEANEDUP_BIT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00632">tagED::fReadOnly</a>, <a class="el" href="../../d2/d1/rtlinit_8c-source.html#l00344">FreeLookasideEntry()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00599">tagED::fSingle</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00641">tagED::fWin31Compat</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00916">GETEXPWINVER</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00712">tagED::hImcPrev</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00706">tagED::hInstance</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00552">tagED::hText</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00587">tagED::hwndParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00709">tagED::iLockLevel</a>, <a class="el" href="../../d9/d5/ntuser_2client_2globals_8h-source.html#l00090">LHND</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00678">tagED::lineHeight</a>, <a class="el" href="../../d9/d5/ntuser_2client_2globals_8h-source.html#l00107">LOCALALLOC</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07715">NtUserSetWindowFNID()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00025">NULL_HIMC</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00684">tagED::pTabStops</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02367">WEFEDGEMASK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02302">WFANSICREATOR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02410">WFBORDER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02418">WFDISABLED</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00659">tagED::wImeStatus</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>.
<p>
<pre class="fragment"><div>00289 {
00290     HWND hwnd = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd);
00291     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fAnsi;
00292 
00293     fAnsi = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFANSICREATOR);
00294 
00295     <span class="comment">/*</span>
00296 <span class="comment">     * Initialize the ped</span>
00297 <span class="comment">     */</span>
00298     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o89">fEncoded</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00299     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o90">iLockLevel</a> = 0;
00300 
00301     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00302     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o73">pTabStops</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00303     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00304     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> = fAnsi ? 1 : 0; <span class="comment">// Force TRUE to be 1 because its a 1 bit field</span>
00305     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a> = (WORD)(fAnsi ? <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>) : <span class="keyword">sizeof</span>(WCHAR));
00306     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o87">hInstance</a> = pwnd-&gt;hModule;
00307     <span class="comment">// IME</span>
00308     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o92">hImcPrev</a> = <a class="code" href="../../d8/d0/immstruc_8h.html#a0">NULL_HIMC</a>;
00309 
00310     {
00311         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwVer = <a class="code" href="../../d6/d0/usercli_8h.html#a134">GETEXPWINVER</a>(lpCreateStruct-&gt;hInstance);
00312 
00313         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o43">fWin31Compat</a> = (dwVer &gt;= 0x030a);
00314         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o44">f40Compat</a> = (dwVer &gt;= 0x0400);
00315     }
00316 
00317     <span class="comment">//</span>
00318     <span class="comment">// NOTE:</span>
00319     <span class="comment">// The order of the following two checks is important.  People can</span>
00320     <span class="comment">// create edit fields with a 3D and a normal border, and we don't</span>
00321     <span class="comment">// want to disallow that.  But we need to detect the "no 3D border"</span>
00322     <span class="comment">// border case too.</span>
00323     <span class="comment">//</span>
00324     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFEDGEMASK))
00325     {
00326         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o28">fBorder</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00327     }
00328     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFBORDER))
00329     {
00330         <a class="code" href="../../d4/d1/userk_8h.html#a1629">ClearWindowState</a>(pwnd, WFBORDER);
00331         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o45">fFlatBorder</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00332         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o28">fBorder</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00333     }
00334 
00335     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, EFMULTILINE))
00336         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o20">fSingle</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00337 
00338     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFDISABLED))
00339         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o25">fDisabled</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00340 
00341     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, EFREADONLY)) {
00342         <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o43">fWin31Compat</a>) {
00343             <span class="comment">/*</span>
00344 <span class="comment">             * BACKWARD COMPATIBILITY HACK</span>
00345 <span class="comment">             *</span>
00346 <span class="comment">             * "MileStone" unknowingly sets the ES_READONLY style. So, we strip this</span>
00347 <span class="comment">             * style here for all Win3.0 apps (this style is new for Win3.1).</span>
00348 <span class="comment">             * Fix for Bug #12982 -- SANKAR -- 01/24/92 --</span>
00349 <span class="comment">             */</span>
00350              <a class="code" href="../../d4/d1/userk_8h.html#a1629">ClearWindowState</a>(pwnd, EFREADONLY);
00351         } <span class="keywordflow">else</span>
00352             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o39">fReadOnly</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00353     }
00354 
00355 
00356     <span class="comment">/*</span>
00357 <span class="comment">     * Allocate storage for the text for the edit controls. Storage for single</span>
00358 <span class="comment">     * line edit controls will always get allocated in the local data segment.</span>
00359 <span class="comment">     * Multiline will allocate in the local ds but the app may free this and</span>
00360 <span class="comment">     * allocate storage elsewhere...</span>
00361 <span class="comment">     */</span>
00362     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o0">hText</a> = <a class="code" href="../../d8/d6/ntuser_2client_2globals_8h.html#a2">LOCALALLOC</a>(LHND, CCHALLOCEXTRA*ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o87">hInstance</a>);
00363     <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o0">hText</a>) {
00364         <a class="code" href="../../d6/d0/usercli_8h.html#a408">FreeLookasideEntry</a>(&amp;EditLookaside, ped);
00365         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a284">NtUserSetWindowFNID</a>(hwnd, FNID_CLEANEDUP_BIT); <span class="comment">/* No ped for this window */</span>
00366         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>; <span class="comment">/* If no_memory error */</span>
00367     }
00368 
00369     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o1">cchAlloc</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a71">CCHALLOCEXTRA</a>;
00370     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a> = 1;
00371 
00372     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a> = hwnd;
00373     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a> = lpCreateStruct-&gt;hwndParent;
00374 
00375     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o59">wImeStatus</a> = 0;
00376 
00377     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(pwnd, WM_NCCREATE, 0,
00378             (LPARAM)lpCreateStruct, fAnsi);
00379 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="edecrare.c::ECNcDestroyHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ECNcDestroyHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00439">439</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00688">tagED::charWidthBuffer</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00662">tagED::chLines</a>, <a class="el" href="../../d2/d3/combo_8c-source.html#l00207">ComboBoxWndProcWorker()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00018">EditLookaside</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00836">FNID_CLEANEDUP_BIT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00794">FNID_COMBOBOX</a>, <a class="el" href="../../d2/d1/rtlinit_8c-source.html#l00344">FreeLookasideEntry()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00843">GETFNID</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00703">tagED::hCaretBitmap</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00706">tagED::hInstance</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00552">tagED::hText</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d9/d5/ntuser_2client_2globals_8h-source.html#l00117">LOCALFREE</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07715">NtUserSetWindowFNID()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00684">tagED::pTabStops</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00411">PTR_TO_ID</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00215">REBASEPWND</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01764">tagWND::spmenu</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00124">UserGlobalFree</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>.
<p>
<pre class="fragment"><div>00442 {
00443     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;
00444 
00445     <span class="comment">/*</span>
00446 <span class="comment">     * ped could be NULL if WM_NCCREATE failed to create it...</span>
00447 <span class="comment">     */</span>
00448     <span class="keywordflow">if</span> (ped) {
00449 
00450         <span class="comment">/*</span>
00451 <span class="comment">         * Free the text buffer (always present?)</span>
00452 <span class="comment">         */</span>
00453         <a class="code" href="../../d8/d6/ntuser_2client_2globals_8h.html#a7">LOCALFREE</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o0">hText</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o87">hInstance</a>);
00454 
00455         <span class="comment">/*</span>
00456 <span class="comment">         * Free up undo buffer and line start array (if present)</span>
00457 <span class="comment">         */</span>
00458         <span class="keywordflow">if</span> (ped-&gt;hDeletedText != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00459             <a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>(ped-&gt;hDeletedText);
00460 
00461         <span class="comment">/*</span>
00462 <span class="comment">         * Free tab stop buffer (if present)</span>
00463 <span class="comment">         */</span>
00464         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o73">pTabStops</a>)
00465             <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o73">pTabStops</a>);
00466 
00467         <span class="comment">/*</span>
00468 <span class="comment">         * Free line start array (if present)</span>
00469 <span class="comment">         */</span>
00470         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a>) {
00471             <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o61">chLines</a>);
00472         }
00473 
00474         <span class="comment">/*</span>
00475 <span class="comment">         * Free the character width buffer (if present)</span>
00476 <span class="comment">         */</span>
00477         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a>)
00478             <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a>);
00479 
00480         <span class="comment">/*</span>
00481 <span class="comment">         * Free the cursor bitmap</span>
00482 <span class="comment">         */</span>
00483         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a> &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o85">hCaretBitmap</a>) {
00484             DeleteObject(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o85">hCaretBitmap</a>);
00485         }
00486 
00487         <span class="comment">/*</span>
00488 <span class="comment">         * Last but not least, free the ped</span>
00489 <span class="comment">         */</span>
00490         <a class="code" href="../../d6/d0/usercli_8h.html#a408">FreeLookasideEntry</a>(&amp;EditLookaside, ped);
00491     }
00492 
00493     <span class="comment">/*</span>
00494 <span class="comment">     * Set the window's fnid status so that we can ignore rogue messages</span>
00495 <span class="comment">     */</span>
00496     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a284">NtUserSetWindowFNID</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), FNID_CLEANEDUP_BIT);
00497 
00498     <span class="comment">/*</span>
00499 <span class="comment">     * If we're part of a combo box, let it know we're gone</span>
00500 <span class="comment">     */</span>
00501     pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
00502     <span class="keywordflow">if</span> (pwndParent &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndParent) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a201">FNID_COMBOBOX</a>) {
00503         <a class="code" href="../../d6/d0/usercli_8h.html#a614">ComboBoxWndProcWorker</a>(pwndParent, WM_PARENTNOTIFY,
00504                 MAKELONG(WM_DESTROY, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>)), (LPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), FALSE);
00505     }
00506 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="edecrare.c::ECResultStrHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL FAR PASCAL ECResultStrHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ped</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01287">1287</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00661">tagED::cbChar</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01225">ECSetCaretHandler()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/aug98_2dll32_2icmdll_8h-source.html#l00010">FAR</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00651">tagED::fInsertCompChr</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00653">tagED::fNoMoveCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02532">fpImmGetContext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02539">fpImmReleaseContext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00652">tagED::fReplaceCompChr</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00654">tagED::fResultProcess</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00599">tagED::fSingle</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01285">GET_COMPOSITION_STRING</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l01309">MLReplaceSel()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01225">SLReplaceSel()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00125">UserGlobalAlloc</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00124">UserGlobalFree</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01337">ECImeComposition()</a>.
<p>
<pre class="fragment"><div>01288 {
01289     HIMC himc;
01290     LPSTR lpStr;
01291     LONG dwLen;
01292 
01293     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o52">fInsertCompChr</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;    <span class="comment">// clear the state</span>
01294     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o54">fNoMoveCaret</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01295 
01296     <span class="keywordflow">if</span> ((himc = <a class="code" href="../../d6/d0/usercli_8h.html#a307">fpImmGetContext</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>)) == 0) {
01297         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01298     }
01299 
01300     dwLen = <a class="code" href="../../d5/d4/edecrare_8c.html#a4">GET_COMPOSITION_STRING</a>(himc, GCS_RESULTSTR, NULL, 0);
01301 
01302     <span class="keywordflow">if</span> (dwLen == 0) {
01303         <a class="code" href="../../d6/d0/usercli_8h.html#a314">fpImmReleaseContext</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, himc);
01304         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01305     }
01306 
01307     dwLen *= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>;
01308     dwLen += ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>;
01309 
01310     lpStr = (LPSTR)<a class="code" href="../../d6/d0/usercli_8h.html#a3">UserGlobalAlloc</a>(GPTR, dwLen);
01311     <span class="keywordflow">if</span> (lpStr == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01312         <a class="code" href="../../d6/d0/usercli_8h.html#a314">fpImmReleaseContext</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, himc);
01313         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01314     }
01315 
01316     <a class="code" href="../../d5/d4/edecrare_8c.html#a4">GET_COMPOSITION_STRING</a>(himc, GCS_RESULTSTR, lpStr, dwLen);
01317 
01318     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o20">fSingle</a>) {
01319         <a class="code" href="../../d6/d0/usercli_8h.html#a522">SLReplaceSel</a>(ped, lpStr);
01320     } <span class="keywordflow">else</span> {
01321         <a class="code" href="../../d6/d0/usercli_8h.html#a521">MLReplaceSel</a>(ped, lpStr);
01322     }
01323 
01324     <a class="code" href="../../d6/d0/usercli_8h.html#a2">UserGlobalFree</a>((HGLOBAL)lpStr);
01325 
01326     <a class="code" href="../../d6/d0/usercli_8h.html#a314">fpImmReleaseContext</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, himc);
01327 
01328     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o53">fReplaceCompChr</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01329     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o54">fNoMoveCaret</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01330     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o55">fResultProcess</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01331 
01332     <a class="code" href="../../d6/d0/usercli_8h.html#a472">ECSetCaretHandler</a>(ped);
01333 
01334     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01335 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="edecrare.c::ECSetCaretHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ECSetCaretHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ped</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01225">1225</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00677">tagED::aveCharWidth</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01579">CreateCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00680">tagED::cxSysCharWidth</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l02981">DestroyCaret()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00652">tagED::fReplaceCompChr</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00599">tagED::fSingle</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00564">tagED::ichCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00678">tagED::lineHeight</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l00292">MLSetCaretPosition()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05279">NtUserHideCaret()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06219">NtUserShowCaret()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00126">SLSetCaretPosition()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01337">ECImeComposition()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01183">ECInitInsert()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01287">ECResultStrHandler()</a>, and <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>.
<p>
<pre class="fragment"><div>01226 {
01227     HDC     hdc;
01228     SIZE    size;
01229     PSTR    pText;
01230 
01231 <span class="comment">//    if (!ped-&gt;fInsertCompChr || ped-&gt;fReadOnly)</span>
01232 <span class="comment">//        return;</span>
01233 
01234     <span class="comment">// In any case destroy caret beforehand otherwise SetCaretPos()</span>
01235     <span class="comment">// will get crazy.. win95d-B#992,B#2370</span>
01236     <span class="comment">//</span>
01237     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a>) {
01238 
01239         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a204">NtUserHideCaret</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>);
01240         <a class="code" href="../../d3/d8/client_8c.html#a95">DestroyCaret</a>();
01241         <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o53">fReplaceCompChr</a> ) {
01242 
01243             hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, TRUE );
01244             pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
01245 
01246             <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>)
01247                  GetTextExtentPointA(hdc, pText + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>, 2, &amp;size);
01248             <span class="keywordflow">else</span>
01249                  GetTextExtentPointW(hdc, (LPWSTR)pText + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>, 1, &amp;size);
01250 
01251             <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
01252             <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, TRUE);
01253 
01254             <a class="code" href="../../d6/d0/usercli_8h.html#a233">CreateCaret</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, (HBITMAP)NULL, size.cx, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a>);
01255         }
01256         <span class="keywordflow">else</span> {
01257             <a class="code" href="../../d6/d0/usercli_8h.html#a233">CreateCaret</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>,
01258                         (HBITMAP)NULL,
01259                         (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o70">cxSysCharWidth</a> &gt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a> ? 1 : 2),
01260                         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a>);
01261         }
01262 
01263         hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, TRUE );
01264         <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o20">fSingle</a> )
01265             <a class="code" href="../../d6/d0/usercli_8h.html#a524">SLSetCaretPosition</a>( ped, hdc );
01266         <span class="keywordflow">else</span>
01267             <a class="code" href="../../d6/d0/usercli_8h.html#a493">MLSetCaretPosition</a>( ped, hdc );
01268         <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, TRUE);
01269         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a234">NtUserShowCaret</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>);
01270     }
01271 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="edecrare.c::ECSetFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ECSetFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HFONT&nbsp;</td>
          <td class="mdname" nowrap> <em>hfont</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fRedraw</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00708">708</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00677">tagED::aveCharWidth</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00549">CHAR_WIDTH_BUFFER_LENGTH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00679">tagED::charOverhang</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00578">tagED::charPasswordChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00689">tagED::charSet</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00688">tagED::charWidthBuffer</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00680">tagED::cxSysCharWidth</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00681">tagED::cySysCharHeight</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00109">ECCalcMarginForDBCSFont()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01051">ECGetCaretWidth</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l03820">ECGetDBCSVector()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01150">ECImmSetCompositionFont()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00049">ECSetMargin()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00516">ECSetPasswordChar()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00597">ECSize()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03301">tagLPKEDITCALLOUT::EditCreateCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00642">tagED::f40Compat</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00611">tagED::fDBCS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00606">tagED::fNonPropDBCS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00605">tagED::fNonPropFont</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02537">fpImmIsIME</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00599">tagED::fSingle</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00639">tagED::fTrueType</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00615">tagED::fWrap</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01123">GETAPPVER</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00039">GetMaxOverlapChars()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00555">GetNegABCwidthInfo()</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00674">tagED::hFont</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00678">tagED::lineHeight</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l01562">MLBuildchLines()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06550">NtUserCreateCaret()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01560">NtUserDestroyCaret</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06624">NtUserGetDC()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05279">NtUserHideCaret()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06219">NtUserShowCaret()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l01052">ReleaseDC()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01124">THREAD_HKL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00185">UserGetCharDimensionsEx()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00958">UserLocalAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00959">UserLocalReAlloc</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00475">VER40</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00692">tagED::wMaxNegA</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00693">tagED::wMaxNegAcharPos</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00694">tagED::wMaxNegC</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00695">tagED::wMaxNegCcharPos</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>, <a class="el" href="../../d5/d4/edmlonce_8c-source.html#l00023">MLCreate()</a>, and <a class="el" href="../../d7/d4/edslrare_8c-source.html#l00027">SLCreate()</a>.
<p>
<pre class="fragment"><div>00712 {
00713     <span class="keywordtype">short</span>  i;
00714     TEXTMETRIC      TextMetrics;
00715     HDC             hdc;
00716     HFONT           hOldFont=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00717     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>            wBuffSize;
00718     LPINT           lpCharWidthBuff;
00719     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>           dwMaxOverlapChars;
00720     CHWIDTHINFO     cwi;
00721     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>            uExtracharPos;
00722 
00723     hdc = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a250">NtUserGetDC</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>);
00724 
00725     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o66">hFont</a> = hfont) {
00726         <span class="comment">//</span>
00727         <span class="comment">// Since the default font is the system font, no need to select it in</span>
00728         <span class="comment">// if that's what the user wants.</span>
00729         <span class="comment">//</span>
00730         <span class="keywordflow">if</span> (!(hOldFont = SelectObject(hdc, hfont))) {
00731             hfont = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o66">hFont</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00732         }
00733 
00734         <span class="comment">//</span>
00735         <span class="comment">// Get the metrics and ave char width for the currently selected font</span>
00736         <span class="comment">//</span>
00737 
00738         <span class="comment">//</span>
00739         <span class="comment">// Call Vertical font-aware AveWidth compute function...</span>
00740         <span class="comment">//</span>
00741         <span class="comment">// FE_SB</span>
00742         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a> = <a class="code" href="../../d5/d4/edecrare_8c.html#a12">UserGetCharDimensionsEx</a>(hdc, hfont, &amp;TextMetrics, &amp;ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a>);
00743 
00744         <span class="comment">/*</span>
00745 <span class="comment">         * This might fail when people uses network fonts (or bad fonts).</span>
00746 <span class="comment">         */</span>
00747         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a> == 0) {
00748             RIPMSG0(RIP_WARNING, <span class="stringliteral">"ECSetFont: GdiGetCharDimensions failed"</span>);
00749             <span class="keywordflow">if</span> (hOldFont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00750                 SelectObject(hdc, hOldFont);
00751             }
00752 
00753             <span class="comment">/*</span>
00754 <span class="comment">             * We've messed up the ped so let's reset the font.</span>
00755 <span class="comment">             *  Note that we won't recurse more than once because we'll</span>
00756 <span class="comment">             *  pass hfont == NULL.</span>
00757 <span class="comment">             * Too bad WM_SETFONT doesn't return a value.</span>
00758 <span class="comment">             */</span>
00759             <a class="code" href="../../d6/d0/usercli_8h.html#a454">ECSetFont</a>(ped, NULL, fRedraw);
00760             <span class="keywordflow">return</span>;
00761         }
00762     } <span class="keywordflow">else</span> {
00763         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a> = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cxSysFontChar;
00764         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a> = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cySysFontChar;
00765         TextMetrics = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;tmSysFont;
00766     }
00767 
00768     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o69">charOverhang</a> = TextMetrics.tmOverhang;
00769 
00770     <span class="comment">//assume that they don't have any negative widths at all.</span>
00771     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o76">wMaxNegA</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o78">wMaxNegC</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o77">wMaxNegAcharPos</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o79">wMaxNegCcharPos</a> = 0;
00772 
00773 
00774     <span class="comment">// Check if Proportional Width Font</span>
00775     <span class="comment">//</span>
00776     <span class="comment">// NOTE: as SDK doc says about TEXTMETRIC:</span>
00777     <span class="comment">// TMPF_FIXED_PITCH</span>
00778     <span class="comment">// If this bit is set the font is a variable pitch font. If this bit is clear</span>
00779     <span class="comment">// the font is a fixed pitch font. Note very carefully that those meanings are</span>
00780     <span class="comment">// the opposite of what the constant name implies.</span>
00781     <span class="comment">//</span>
00782     <span class="comment">// Thus we have to reverse the value using logical not (fNonPropFont has 1 bit width)</span>
00783     <span class="comment">//</span>
00784     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o26">fNonPropFont</a> = !(TextMetrics.tmPitchAndFamily &amp; FIXED_PITCH);
00785 
00786     <span class="comment">// Check for a TrueType font</span>
00787     <span class="comment">// Older app OZWIN chokes if we allocate a bigger buffer for TrueType fonts</span>
00788     <span class="comment">// So, for apps older than 4.0, no special treatment for TrueType fonts.</span>
00789     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o44">f40Compat</a> &amp;&amp; (TextMetrics.tmPitchAndFamily &amp; TMPF_TRUETYPE)) {
00790         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o41">fTrueType</a> = GetCharWidthInfo(hdc, &amp;cwi);
00791 <span class="preprocessor">#if DBG</span>
00792 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o41">fTrueType</a>) {
00793             RIPMSG0(RIP_WARNING, <span class="stringliteral">"ECSetFont: GetCharWidthInfo Failed"</span>);
00794         }
00795 <span class="preprocessor">#endif</span>
00796 <span class="preprocessor"></span>    } <span class="keywordflow">else</span> {
00797         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o41">fTrueType</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00798     }
00799 
00800     <span class="comment">// FE_SB</span>
00801     <span class="comment">//</span>
00802     <span class="comment">// In DBCS Windows, Edit Control must handle Double Byte Character</span>
00803     <span class="comment">// if tmCharSet field of textmetrics is double byte character set</span>
00804     <span class="comment">// such as SHIFTJIS_CHARSET(128:Japan), HANGEUL_CHARSET(129:Korea).</span>
00805     <span class="comment">//</span>
00806     <span class="comment">// We call ECGetDBCSVector even when fAnsi is false so that we could</span>
00807     <span class="comment">// treat ped-&gt;fAnsi and ped-&gt;fDBCS indivisually. I changed ECGetDBCSVector</span>
00808     <span class="comment">// function so that it returns 0 or 1, because I would like to set ped-&gt;fDBCS</span>
00809     <span class="comment">// bit field here.</span>
00810     <span class="comment">//</span>
00811     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o32">fDBCS</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a463">ECGetDBCSVector</a>(ped,hdc,TextMetrics.tmCharSet);
00812     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o75">charSet</a> = TextMetrics.tmCharSet;
00813 
00814     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o32">fDBCS</a>) {
00815         <span class="comment">//</span>
00816         <span class="comment">// Free the character width buffer if ped-&gt;fDBCS.</span>
00817         <span class="comment">//</span>
00818         <span class="comment">// I expect single GetTextExtentPoint call is faster than multiple</span>
00819         <span class="comment">// GetTextExtentPoint call (because the graphic engine has a cache buffer).</span>
00820         <span class="comment">// See editec.c/ECTabTheTextOut().</span>
00821         <span class="comment">//</span>
00822         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a>) {
00823             LocalFree(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a>);
00824             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00825         }
00826 
00827         <span class="comment">//</span>
00828         <span class="comment">// if FullWidthChar : HalfWidthChar == 2 : 1....</span>
00829         <span class="comment">//</span>
00830         <span class="comment">// TextMetrics.tmMaxCharWidth = FullWidthChar width</span>
00831         <span class="comment">// ped-&gt;aveCharWidth          = HalfWidthChar width</span>
00832         <span class="comment">//</span>
00833         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o26">fNonPropFont</a> &amp;&amp;
00834             ((ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a> * 2) == TextMetrics.tmMaxCharWidth)) {
00835             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o27">fNonPropDBCS</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00836         } <span class="keywordflow">else</span> {
00837             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o27">fNonPropDBCS</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00838         }
00839 
00840     } <span class="keywordflow">else</span> {
00841 
00842         <span class="comment">//</span>
00843         <span class="comment">// Since the font has changed, let us obtain and save the character width</span>
00844         <span class="comment">// info for this font.</span>
00845         <span class="comment">//</span>
00846         <span class="comment">// First left us find out if the maximum chars that can overlap due to</span>
00847         <span class="comment">// negative widths. Since we can't access USER globals, we make a call here.</span>
00848         <span class="comment">//</span>
00849         <span class="keywordflow">if</span> (!(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o20">fSingle</a> || ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>)) {  <span class="comment">// Is this a multiline edit control with no LPK present?</span>
00850             <span class="comment">//</span>
00851             <span class="comment">// For multiline edit controls, we maintain a buffer that contains</span>
00852             <span class="comment">// the character width information.</span>
00853             <span class="comment">//</span>
00854             wBuffSize = (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o41">fTrueType</a>) ? (<a class="code" href="../../d6/d0/usercli_8h.html#a86">CHAR_WIDTH_BUFFER_LENGTH</a> * <span class="keyword">sizeof</span>(ABC)) :
00855                                            (<a class="code" href="../../d6/d0/usercli_8h.html#a86">CHAR_WIDTH_BUFFER_LENGTH</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00856 
00857             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a>) { <span class="comment">/* If buffer already present */</span>
00858                 lpCharWidthBuff = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a>;
00859                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a137">UserLocalReAlloc</a>(lpCharWidthBuff, wBuffSize, HEAP_ZERO_MEMORY);
00860                 <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00861                     <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>((HANDLE)lpCharWidthBuff);
00862                 }
00863             } <span class="keywordflow">else</span> {
00864                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(HEAP_ZERO_MEMORY, wBuffSize);
00865             }
00866 
00867             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00868                 <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o41">fTrueType</a>) {
00869                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o41">fTrueType</a> = <a class="code" href="../../d5/d4/edecrare_8c.html#a18">GetNegABCwidthInfo</a>(ped, hdc);
00870                 }
00871 
00872                 <span class="comment">/*</span>
00873 <span class="comment">                 * It is possible that the above attempts could have failed and reset</span>
00874 <span class="comment">                 * the value of fTrueType. So, let us check that value again.</span>
00875 <span class="comment">                 */</span>
00876                 <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o41">fTrueType</a>) {
00877                     <span class="keywordflow">if</span> (!GetCharWidthA(hdc, 0, CHAR_WIDTH_BUFFER_LENGTH-1, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a>)) {
00878                         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>((HANDLE)ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a>);
00879                         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a>=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00880                     } <span class="keywordflow">else</span> {
00881                         <span class="comment">/*</span>
00882 <span class="comment">                         * We need to subtract out the overhang associated with</span>
00883 <span class="comment">                         * each character since GetCharWidth includes it...</span>
00884 <span class="comment">                         */</span>
00885                         <span class="keywordflow">for</span> (i=0;i &lt; <a class="code" href="../../d6/d0/usercli_8h.html#a86">CHAR_WIDTH_BUFFER_LENGTH</a>;i++)
00886                             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a>[i] -= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o69">charOverhang</a>;
00887                     }
00888                 }
00889             } <span class="comment">/* if (ped-&gt;charWidthBuffer != NULL) */</span>
00890         } <span class="comment">/* if (!ped-&gt;fSingle) */</span>
00891     } <span class="comment">/* if (ped-&gt;fDBCS) */</span>
00892 
00893     {
00894         <span class="comment">/*</span>
00895 <span class="comment">         * Calculate MaxNeg A C metrics</span>
00896 <span class="comment">         */</span>
00897         dwMaxOverlapChars = <a class="code" href="../../d5/d4/edecrare_8c.html#a9">GetMaxOverlapChars</a>();
00898         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o41">fTrueType</a>) {
00899             <span class="keywordflow">if</span> (cwi.lMaxNegA &lt; 0)
00900                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o76">wMaxNegA</a> = -cwi.lMaxNegA;
00901             <span class="keywordflow">else</span>
00902                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o76">wMaxNegA</a> = 0;
00903             <span class="keywordflow">if</span> (cwi.lMaxNegC &lt; 0)
00904                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o78">wMaxNegC</a> = -cwi.lMaxNegC;
00905             <span class="keywordflow">else</span>
00906                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o78">wMaxNegC</a> = 0;
00907             <span class="keywordflow">if</span> (cwi.lMinWidthD != 0) {
00908                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o77">wMaxNegAcharPos</a> = (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o76">wMaxNegA</a> + cwi.lMinWidthD - 1) / cwi.lMinWidthD;
00909                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o79">wMaxNegCcharPos</a> = (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o78">wMaxNegC</a> + cwi.lMinWidthD - 1) / cwi.lMinWidthD;
00910                 <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o76">wMaxNegA</a> + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o78">wMaxNegC</a> &gt; (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)cwi.lMinWidthD) {
00911                     uExtracharPos = (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o76">wMaxNegA</a> + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o78">wMaxNegC</a> - 1) / cwi.lMinWidthD;
00912                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o77">wMaxNegAcharPos</a> += uExtracharPos;
00913                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o79">wMaxNegCcharPos</a> += uExtracharPos;
00914                 }
00915             } <span class="keywordflow">else</span> {
00916                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o77">wMaxNegAcharPos</a> = LOWORD(dwMaxOverlapChars);     <span class="comment">// Left</span>
00917                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o79">wMaxNegCcharPos</a> = HIWORD(dwMaxOverlapChars);     <span class="comment">// Right</span>
00918             }
00919 
00920         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o69">charOverhang</a> != 0) {
00921             <span class="comment">/*</span>
00922 <span class="comment">             * Some bitmaps fonts (i.e., italic) have under/overhangs;</span>
00923 <span class="comment">             *  this is pretty much like having negative A and C widths.</span>
00924 <span class="comment">             */</span>
00925             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o76">wMaxNegA</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o78">wMaxNegC</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o69">charOverhang</a>;
00926             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o77">wMaxNegAcharPos</a> = LOWORD(dwMaxOverlapChars);     <span class="comment">// Left</span>
00927             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o79">wMaxNegCcharPos</a> = HIWORD(dwMaxOverlapChars);     <span class="comment">// Right</span>
00928         }
00929     } <span class="comment">/* if (ped-&gt;fDBCS) */</span>
00930 
00931     <span class="keywordflow">if</span> (!hfont) {
00932         <span class="comment">//</span>
00933         <span class="comment">// We are getting the stats for the system font so update the system</span>
00934         <span class="comment">// font fields in the ed structure since we use these when calculating</span>
00935         <span class="comment">// some spacing.</span>
00936         <span class="comment">//</span>
00937         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o70">cxSysCharWidth</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a>;
00938         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o71">cySysCharHeight</a>= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a>;
00939     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hOldFont)
00940         SelectObject(hdc, hOldFont);
00941 
00942     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a>) {
00943         <span class="comment">//</span>
00944         <span class="comment">// Update the caret.</span>
00945         <span class="comment">//</span>
00946         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a204">NtUserHideCaret</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>);
00947         <a class="code" href="../../d6/d0/usercli_8h.html#a215">NtUserDestroyCaret</a>();
00948 
00949         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
00950             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>-&gt;<a class="code" href="../../d2/d0/structtagLPKEDITCALLOUT.html#o12">EditCreateCaret</a> (ped, hdc, <a class="code" href="../../d6/d0/usercli_8h.html#a149">ECGetCaretWidth</a>(), ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a>, 0);
00951         }
00952         <span class="keywordflow">else</span> {
00953             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a247">NtUserCreateCaret</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, (HBITMAP)NULL, <a class="code" href="../../d6/d0/usercli_8h.html#a149">ECGetCaretWidth</a>(), ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a>);
00954         }
00955         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a234">NtUserShowCaret</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>);
00956     }
00957 
00958     <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, hdc);
00959 
00960     <span class="comment">//</span>
00961     <span class="comment">// Update password character.</span>
00962     <span class="comment">//</span>
00963     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a>)
00964         <a class="code" href="../../d6/d0/usercli_8h.html#a442">ECSetPasswordChar</a>(ped, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a>);
00965 
00966     <span class="comment">//</span>
00967     <span class="comment">// If it is a TrueType font and it's a new app, set both the margins at the</span>
00968     <span class="comment">// max negative width values for all types of the edit controls.</span>
00969     <span class="comment">// (NOTE: Can't use ped-&gt;f40Compat here because edit-controls inside dialog</span>
00970     <span class="comment">// boxes without DS_LOCALEDIT style are always marked as 4.0 compat.</span>
00971     <span class="comment">// This is the fix for NETBENCH 3.0)</span>
00972     <span class="comment">//</span>
00973 
00974     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o41">fTrueType</a> &amp;&amp; (<a class="code" href="../../d6/d0/usercli_8h.html#a150">GETAPPVER</a>() &gt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a101">VER40</a>))
00975         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o32">fDBCS</a>) {
00976             <span class="comment">// For DBCS TrueType Font, we calc margin from ABC width.</span>
00977             <a class="code" href="../../d5/d4/edecrare_8c.html#a11">ECCalcMarginForDBCSFont</a>(ped, fRedraw);
00978         } <span class="keywordflow">else</span> {
00979             <a class="code" href="../../d6/d0/usercli_8h.html#a455">ECSetMargin</a>(ped, EC_LEFTMARGIN | EC_RIGHTMARGIN,
00980                         MAKELONG(EC_USEFONTINFO, EC_USEFONTINFO), fRedraw);
00981         }
00982 
00983     <span class="comment">//</span>
00984     <span class="comment">// We need to calc maxPixelWidth when font changes.</span>
00985     <span class="comment">// If the word-wrap is ON, then this is done in MLSize() called later.</span>
00986     <span class="comment">//</span>
00987     <span class="keywordflow">if</span>((!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o20">fSingle</a>) &amp;&amp; (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o34">fWrap</a>))
00988         <a class="code" href="../../d6/d0/usercli_8h.html#a490">MLBuildchLines</a>(ped, 0, 0, FALSE, NULL, NULL);
00989 
00990     <span class="comment">//</span>
00991     <span class="comment">// Recalc the layout.</span>
00992     <span class="comment">//</span>
00993     <a class="code" href="../../d6/d0/usercli_8h.html#a482">ECSize</a>(ped, NULL, fRedraw);
00994 
00995     <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a> &amp;&amp; <a class="code" href="../../d6/d0/usercli_8h.html#a312">fpImmIsIME</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a151">THREAD_HKL</a>()) ) {
00996         <a class="code" href="../../d6/d0/usercli_8h.html#a470">ECImmSetCompositionFont</a>( ped );
00997     }
00998 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="edecrare.c::ECSetMargin" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ECSetMargin           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>lMarginValues</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fRedraw</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00049">49</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00677">tagED::aveCharWidth</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02679">ECInvalidateClient()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00696">tagED::wLeftMargin</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00692">tagED::wMaxNegA</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00694">tagED::wMaxNegC</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00697">tagED::wRightMargin</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00109">ECCalcMarginForDBCSFont()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00708">ECSetFont()</a>, and <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>.
<p>
<pre class="fragment"><div>00050 {
00051     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fUseFontInfo = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00052     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wValue, wOldLeftMargin, wOldRightMargin;
00053 
00054 
00055     <span class="keywordflow">if</span> (wFlags &amp; EC_LEFTMARGIN)  <span class="comment">/* Set the left margin */</span> {
00056 
00057         <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>) (wValue = (<span class="keywordtype">int</span>)(<span class="keywordtype">short</span>)LOWORD(lMarginValues)) &lt; 0) {
00058             fUseFontInfo = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00059             wValue = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>((ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a> / 2), (<span class="keywordtype">int</span>)ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o76">wMaxNegA</a>);
00060         }
00061 
00062         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left += wValue - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o80">wLeftMargin</a>;
00063         wOldLeftMargin = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o80">wLeftMargin</a>;
00064         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o80">wLeftMargin</a> = wValue;
00065     }
00066 
00067     <span class="keywordflow">if</span> (wFlags &amp; EC_RIGHTMARGIN)  <span class="comment">/* Set the Right margin */</span> {
00068 
00069         <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>) (wValue = (<span class="keywordtype">int</span>)(<span class="keywordtype">short</span>)HIWORD(lMarginValues)) &lt; 0) {
00070             fUseFontInfo = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00071             wValue = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>((ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a> / 2), (<span class="keywordtype">int</span>)ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o78">wMaxNegC</a>);
00072         }
00073 
00074         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right -= wValue - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o81">wRightMargin</a>;
00075         wOldRightMargin = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o81">wRightMargin</a>;
00076         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o81">wRightMargin</a> = wValue;
00077     }
00078 
00079     <span class="keywordflow">if</span> (fUseFontInfo) {
00080         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left &lt; 2 * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a>) {
00081             RIPMSG0(RIP_WARNING, <span class="stringliteral">"ECSetMargin: rcFmt is too narrow for EC_USEFONTINFO"</span>);
00082 
00083             <span class="keywordflow">if</span> (wFlags &amp; EC_LEFTMARGIN)  <span class="comment">/* Reset the left margin */</span> {
00084                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left += wOldLeftMargin - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o80">wLeftMargin</a>;
00085                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o80">wLeftMargin</a> = wOldLeftMargin;
00086             }
00087 
00088             <span class="keywordflow">if</span> (wFlags &amp; EC_RIGHTMARGIN)  <span class="comment">/* Reset the Right margin */</span> {
00089                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right -= wOldRightMargin - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o81">wRightMargin</a>;
00090                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o81">wRightMargin</a> = wOldRightMargin;
00091             }
00092 
00093             <span class="keywordflow">return</span>;
00094         }
00095     }
00096 
00097 <span class="comment">//    NtUserInvalidateRect(ped-&gt;hwnd, NULL, TRUE);</span>
00098     <span class="keywordflow">if</span> (fRedraw) {
00099         <a class="code" href="../../d6/d0/usercli_8h.html#a436">ECInvalidateClient</a>(ped, TRUE);
00100     }
00101 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="edecrare.c::ECSetPasswordChar" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ECSetPasswordChar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>pwchar</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00516">516</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00578">tagED::charPasswordChar</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2kernel_2random_8c-source.html#l00102">ClearWindowState()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00582">tagED::cPasswordCharWidth</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01037">ECEnableDisableIME()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02494">EFPASSWORD</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00585">tagED::pwnd</a>, <a class="el" href="../../d9/d3/w32_2ntuser_2kernel_2random_8c-source.html#l00083">SetWindowState()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00708">ECSetFont()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>, and <a class="el" href="../../d7/d4/edslrare_8c-source.html#l00027">SLCreate()</a>.
<p>
<pre class="fragment"><div>00519 {
00520     HDC hdc;
00521     SIZE size;
00522 
00523     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a> = pwchar;
00524 
00525     <span class="keywordflow">if</span> (pwchar) {
00526         hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, TRUE);
00527         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>)
00528             GetTextExtentPointA(hdc, (LPSTR)&amp;pwchar, 1, &amp;size);
00529         <span class="keywordflow">else</span>
00530             GetTextExtentPointW(hdc, (LPWSTR)&amp;pwchar, 1, &amp;size);
00531 
00532         GetTextExtentPointW(hdc, (LPWSTR)&amp;pwchar, 1, &amp;size);
00533         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o13">cPasswordCharWidth</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(size.cx, 1);
00534         <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, TRUE);
00535     }
00536     <span class="keywordflow">if</span> (pwchar)
00537         <a class="code" href="../../d4/d1/userk_8h.html#a1628">SetWindowState</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>, EFPASSWORD);
00538     <span class="keywordflow">else</span>
00539         <a class="code" href="../../d4/d1/userk_8h.html#a1629">ClearWindowState</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>, EFPASSWORD);
00540 
00541     <a class="code" href="../../d6/d0/usercli_8h.html#a469">ECEnableDisableIME</a>(ped);
00542 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="edecrare.c::ECSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ECSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>lprc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fRedraw</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00597">597</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00924">_GetClientRect()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00677">tagED::aveCharWidth</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00243">CopyRect</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01085">ECImmSetCompositionWindow()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00607">tagED::fBorder</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00635">tagED::fCaretHidden</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00643">tagED::fFlatBorder</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02537">fpImmIsIME</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00599">tagED::fSingle</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00165">InflateRect()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00678">tagED::lineHeight</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l00056">MLSize()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l07458">NtUserGetCaretPos()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05330">NtUserInvalidateRect()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00585">tagED::pwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01124">THREAD_HKL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00696">tagED::wLeftMargin</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00697">tagED::wRightMargin</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00708">ECSetFont()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l03457">MLEditWndProc()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>.
<p>
<pre class="fragment"><div>00601 {
00602     RECT    rc;
00603 
00604     <span class="comment">/*</span>
00605 <span class="comment">     *  BiDi VB32 Creates an Edit Control and immediately sends a WM_SIZE</span>
00606 <span class="comment">     *  message which causes EXSize to be called before ECSetFont, which</span>
00607 <span class="comment">     *  in turn causes a divide by zero exception below. This check for</span>
00608 <span class="comment">     *  ped-&gt;lineHeight will pick it up safely. [samera] 3/5/97</span>
00609 <span class="comment">     */</span>
00610     <span class="keywordflow">if</span>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a> == 0)
00611         <span class="keywordflow">return</span>;
00612 
00613     <span class="comment">// assume that we won't be able to display the caret</span>
00614     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o40">fCaretHidden</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00615 
00616 
00617     <span class="keywordflow">if</span> ( lprc )
00618         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;rc, lprc);
00619     <span class="keywordflow">else</span>
00620         <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>, &amp;rc);
00621 
00622     <span class="keywordflow">if</span> (!(rc.right - rc.left) || !(rc.bottom - rc.top)) {
00623         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left)
00624             <span class="keywordflow">return</span>;
00625 
00626         rc.left     = 0;
00627         rc.top      = 0;
00628         rc.right    = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a> * 10;
00629         rc.bottom   = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a>;
00630     }
00631 
00632     <span class="keywordflow">if</span> (!lprc) {
00633         <span class="comment">// subtract the margins from the given rectangle --</span>
00634         <span class="comment">// make sure that this rectangle is big enough to have these margins.</span>
00635         <span class="keywordflow">if</span> ((rc.right - rc.left) &gt; (<span class="keywordtype">int</span>)(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o80">wLeftMargin</a> + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o81">wRightMargin</a>)) {
00636             rc.left  += ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o80">wLeftMargin</a>;
00637             rc.right -= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o81">wRightMargin</a>;
00638         }
00639     }
00640 
00641     <span class="comment">//</span>
00642     <span class="comment">// Leave space so text doesn't touch borders.</span>
00643     <span class="comment">// For 3.1 compatibility, don't subtract out vertical borders unless</span>
00644     <span class="comment">// there is room.</span>
00645     <span class="comment">//</span>
00646     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o28">fBorder</a>) {
00647         <span class="keywordtype">int</span> cxBorder = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER);
00648         <span class="keywordtype">int</span> cyBorder = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00649 
00650         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o45">fFlatBorder</a>)
00651         {
00652             cxBorder *= 2;
00653             cyBorder *= 2;
00654         }
00655 
00656         <span class="keywordflow">if</span> (rc.bottom &lt; rc.top + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a> + 2*cyBorder)
00657             cyBorder = 0;
00658 
00659         <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rc, -cxBorder, -cyBorder);
00660     }
00661 
00662     <span class="comment">// Is the resulting rectangle too small?  Don't change it then.</span>
00663     <span class="keywordflow">if</span> ((!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o20">fSingle</a>) &amp;&amp; ((rc.right - rc.left &lt; (<span class="keywordtype">int</span>) ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a>) ||
00664         ((rc.bottom - rc.top) / ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a> == 0)))
00665         <span class="keywordflow">return</span>;
00666 
00667     <span class="comment">// now, we know we're safe to display the caret</span>
00668     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o40">fCaretHidden</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00669 
00670     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>, &amp;rc);
00671 
00672     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o20">fSingle</a>)
00673         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.bottom = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(rc.bottom, rc.top + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a>);
00674     <span class="keywordflow">else</span>
00675         <a class="code" href="../../d6/d0/usercli_8h.html#a512">MLSize</a>(ped, fRedraw);
00676 
00677     <span class="keywordflow">if</span> (fRedraw) {
00678         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, NULL, TRUE);
00679         <span class="comment">// UpdateWindow31(ped-&gt;hwnd);    Evaluates to NOP in Chicago - Johnl</span>
00680     }
00681 
00682     <span class="comment">// FE_IME</span>
00683     <span class="comment">// ECSize()  - call ECImmSetCompositionWindow()</span>
00684     <span class="comment">//</span>
00685     <span class="comment">// normally this isn't needed because WM_SIZE will cause</span>
00686     <span class="comment">// WM_PAINT and the paint handler will take care of IME</span>
00687     <span class="comment">// composition window. However when the edit window is</span>
00688     <span class="comment">// restored from maximized window and client area is out</span>
00689     <span class="comment">// of screen, the window will not be redrawn.</span>
00690     <span class="comment">//</span>
00691     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a> &amp;&amp; <a class="code" href="../../d6/d0/usercli_8h.html#a312">fpImmIsIME</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a151">THREAD_HKL</a>())) {
00692         POINT pt;
00693 
00694         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a274">NtUserGetCaretPos</a>(&amp;pt);
00695         <a class="code" href="../../d6/d0/usercli_8h.html#a471">ECImmSetCompositionWindow</a>(ped, pt.x, pt.y);
00696     }
00697 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="edecrare.c::GetMaxOverlapChars" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetMaxOverlapChars           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00039">39</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, and <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00708">ECSetFont()</a>.
<p>
<pre class="fragment"><div>00040 {
00041     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) MAKELONG( <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;wMaxLeftOverlapChars, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;wMaxRightOverlapChars ) ;
00042 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="edecrare.c::GetNegABCwidthInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL GetNegABCwidthInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00555">555</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00549">CHAR_WIDTH_BUFFER_LENGTH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00679">tagED::charOverhang</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00688">tagED::charWidthBuffer</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00708">ECSetFont()</a>.
<p>
<pre class="fragment"><div>00558 {
00559     LPABC lpABCbuff;
00560     <span class="keywordtype">int</span>   i;
00561     <span class="keywordtype">int</span>   CharWidthBuff[<a class="code" href="../../d6/d0/usercli_8h.html#a86">CHAR_WIDTH_BUFFER_LENGTH</a>]; <span class="comment">// Local char width buffer.</span>
00562     <span class="keywordtype">int</span>   iOverhang;
00563 
00564     <span class="keywordflow">if</span> (!GetCharABCWidthsA(hdc, 0, CHAR_WIDTH_BUFFER_LENGTH-1, (LPABC)ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a>)) {
00565         RIPMSG0(RIP_WARNING, <span class="stringliteral">"GetNegABCwidthInfo: GetCharABCWidthsA Failed"</span>);
00566         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00567     }
00568 
00569    <span class="comment">// The (A+B+C) returned for some fonts (eg: Lucida Caligraphy) does not</span>
00570    <span class="comment">// equal the actual advanced width returned by GetCharWidths() minus overhang.</span>
00571    <span class="comment">// This is due to font bugs. So, we adjust the 'B' width so that this</span>
00572    <span class="comment">// discrepancy is removed.</span>
00573    <span class="comment">// Fix for Bug #2932 --sankar-- 02/17/93</span>
00574    iOverhang = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o69">charOverhang</a>;
00575    GetCharWidthA(hdc, 0, CHAR_WIDTH_BUFFER_LENGTH-1, (LPINT)CharWidthBuff);
00576    lpABCbuff = (LPABC)ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o74">charWidthBuffer</a>;
00577    <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="../../d6/d0/usercli_8h.html#a86">CHAR_WIDTH_BUFFER_LENGTH</a>; i++) {
00578         lpABCbuff-&gt;abcB = CharWidthBuff[i] - iOverhang
00579                 - lpABCbuff-&gt;abcA
00580                 - lpABCbuff-&gt;abcC;
00581         lpABCbuff++;
00582    }
00583 
00584    <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00585 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="edecrare.c::HanjaKeyHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL HanjaKeyHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ped</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01683">1683</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00661">tagED::cbChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00655">tagED::fKorea</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02530">fpImmEscapeA</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02531">fpImmEscapeW</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02532">fpImmGetContext</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00632">tagED::fReadOnly</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00652">tagED::fReplaceCompChr</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00564">tagED::ichCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01564">NtUserMessageBeep</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01124">THREAD_HKL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/editml_8c-source.html#l02028">MLKeyDown()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l01529">SLKeyDown()</a>.
<p>
<pre class="fragment"><div>01684 {
01685     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01686 
01687     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o56">fKorea</a> &amp;&amp; !ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o39">fReadOnly</a>) {
01688         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> oldCaret = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01689 
01690         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o53">fReplaceCompChr</a>)
01691                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01692 
01693         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>)
01694             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>;
01695 
01696         <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> || ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>) {
01697             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = oldCaret;
01698             <a class="code" href="../../d6/d0/usercli_8h.html#a219">NtUserMessageBeep</a>(MB_ICONEXCLAMATION);
01699             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01700         }
01701 
01702         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>) {
01703             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a305">fpImmEscapeA</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a151">THREAD_HKL</a>(), <a class="code" href="../../d6/d0/usercli_8h.html#a307">fpImmGetContext</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>),
01704                 IME_ESC_HANJA_MODE, (<a class="code" href="../../d8/d4/editec_8c.html#a12">ECLock</a>(ped) + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>))) {
01705                 changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01706             }
01707             <span class="keywordflow">else</span>
01708                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = oldCaret;
01709             <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
01710         }
01711         <span class="keywordflow">else</span> {
01712             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a306">fpImmEscapeW</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a151">THREAD_HKL</a>(), <a class="code" href="../../d6/d0/usercli_8h.html#a307">fpImmGetContext</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>),
01713                 IME_ESC_HANJA_MODE, (<a class="code" href="../../d8/d4/editec_8c.html#a12">ECLock</a>(ped) + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>))) {
01714                 changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01715             }
01716             <span class="keywordflow">else</span>
01717                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = oldCaret;
01718             <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
01719         }
01720     }
01721     <span class="keywordflow">return</span> changeSelection;
01722 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="edecrare.c::MLReplaceSel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void MLReplaceSel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSTR&nbsp;</td>
          <td class="mdname" nowrap></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/editml_8c-source.html#l01309">1309</a> of file <a class="el" href="../../d2/d4/editml_8c-source.html">editml.c</a>.
<p>
<pre class="fragment"><div>01310 {
01311     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>  cchText;
01312 
01313     <span class="comment">//</span>
01314     <span class="comment">// Delete text, which will put it into the clean undo buffer.</span>
01315     <span class="comment">//</span>
01316     <a class="code" href="../../d6/d0/usercli_8h.html#a444">ECEmptyUndo</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a85">Pundo</a>(ped));
01317     <a class="code" href="../../d6/d0/usercli_8h.html#a484">MLDeleteText</a>(ped);
01318 
01319     <span class="comment">//</span>
01320     <span class="comment">// B#3356</span>
01321     <span class="comment">// Some apps do "clear" by selecting all of the text, then replacing</span>
01322     <span class="comment">// it with "", in which case MLInsertText() will return 0.  But that</span>
01323     <span class="comment">// doesn't mean failure...</span>
01324     <span class="comment">//</span>
01325     <span class="keywordflow">if</span> ( ped-&gt;fAnsi )
01326         cchText = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(lpText);
01327     <span class="keywordflow">else</span>
01328         cchText = wcslen((LPWSTR)lpText);
01329 
01330     <span class="keywordflow">if</span> (cchText ) {
01331         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fFailed;
01332         <a class="code" href="../../d9/d8/structtagUNDO.html">UNDO</a> undo;
01333         HWND hwndSave;
01334 
01335         <span class="comment">//</span>
01336         <span class="comment">// B#1385,1427</span>
01337         <span class="comment">// Save undo buffer, but DO NOT CLEAR IT.  We want to restore it</span>
01338         <span class="comment">// if insertion fails due to OOM.</span>
01339         <span class="comment">//</span>
01340         <a class="code" href="../../d6/d0/usercli_8h.html#a445">ECSaveUndo</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a85">Pundo</a>(ped), (<a class="code" href="../../d9/d8/structtagUNDO.html">PUNDO</a>)&amp;undo, FALSE);
01341 
01342         hwndSave = ped-&gt;hwnd;
01343         fFailed = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>) !<a class="code" href="../../d6/d0/usercli_8h.html#a483">MLInsertText</a>(ped, lpText, cchText, FALSE);
01344         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(hwndSave))
01345             <span class="keywordflow">return</span>;
01346 
01347         <span class="keywordflow">if</span> (fFailed) {
01348             <span class="comment">//</span>
01349             <span class="comment">// UNDO the previous edit</span>
01350             <span class="comment">//</span>
01351             <a class="code" href="../../d6/d0/usercli_8h.html#a445">ECSaveUndo</a>((<a class="code" href="../../d9/d8/structtagUNDO.html">PUNDO</a>)&amp;undo, <a class="code" href="../../d6/d0/usercli_8h.html#a85">Pundo</a>(ped), FALSE);
01352             <a class="code" href="../../d6/d0/usercli_8h.html#a501">MLUndo</a>(ped);
01353         }
01354     }
01355 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="edecrare.c::UserGetCharDimensionsEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int UserGetCharDimensionsEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hDC</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HFONT&nbsp;</td>
          <td class="mdname" nowrap> <em>hfont</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPTEXTMETRIC&nbsp;</td>
          <td class="mdname" nowrap> <em>lptm</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPINT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpcy</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00185">185</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
References <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00176">AveCharWidthData</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00098">lf</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00708">ECSetFont()</a>.
<p>
<pre class="fragment"><div>00186 {
00187     <span class="keywordtype">int</span>         cxWidth;
00188     TEXTMETRIC  tm;
00189     LOGFONTW    <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>;
00190     WCHAR       wchFaceName[LF_FACESIZE];
00191 
00192     <span class="comment">//</span>
00193     <span class="comment">// Is this font vertical font ??</span>
00194     <span class="comment">//</span>
00195     GetTextFaceW(hDC, LF_FACESIZE, wchFaceName);
00196     <span class="keywordflow">if</span> (wchFaceName[0] != <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'@'</span>) {
00197         <span class="comment">//</span>
00198         <span class="comment">// if not call GDI...</span>
00199         <span class="comment">//</span>
00200         <span class="keywordflow">return</span>(GdiGetCharDimensions(hDC, lptm, lpcy));
00201     }
00202 
00203     <span class="keywordflow">if</span> (!lptm)
00204         lptm = &amp;tm;
00205 
00206     GetTextMetrics(hDC, lptm);
00207 
00208     <span class="comment">// TMPF_FIXED_PITCH</span>
00209     <span class="comment">//</span>
00210     <span class="comment">//   If this bit is set the font is a variable pitch font.</span>
00211     <span class="comment">//   If this bit is clear the font is a fixed pitch font.</span>
00212     <span class="comment">// Note very carefully that those meanings are the opposite of what the constant name implies.</span>
00213     <span class="comment">//</span>
00214     <span class="keywordflow">if</span> (!(lptm-&gt;tmPitchAndFamily &amp; TMPF_FIXED_PITCH)) { <span class="comment">// If !variable_width font</span>
00215         <span class="comment">// This is fixed pitch font....</span>
00216         cxWidth = lptm-&gt;tmAveCharWidth;
00217     } <span class="keywordflow">else</span> {
00218         <span class="comment">// This is variable pitch font...</span>
00219         <span class="keywordflow">if</span> (hfont &amp;&amp; GetObjectW(hfont, <span class="keyword">sizeof</span>(LOGFONTW), &amp;lf) &amp;&amp; (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a18">lf</a>.lfEscapement != 0)) {
00220             cxWidth = lptm-&gt;tmAveCharWidth;
00221         } <span class="keywordflow">else</span> {
00222             SIZE size;
00223             GetTextExtentPointW(hDC, AveCharWidthData, 52, &amp;size);
00224             cxWidth = ((size.cx / 26) + 1) / 2;
00225         }
00226     }
00227 
00228     <span class="keywordflow">if</span> (lpcy)
00229         *lpcy = lptm-&gt;tmHeight;
00230 
00231     <span class="keywordflow">return</span>(cxWidth);
00232 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a8" doxytag="edecrare.c::AveCharWidthData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d5/d4/edecrare_8c.html#a8">AveCharWidthData</a>[] = L"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00176">176</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00185">UserGetCharDimensionsEx()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="edecrare.c::EditLookaside" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d4/struct__LOOKASIDE.html">LOOKASIDE</a> <a class="el" href="../../d8/d4/editec_8c.html#a8">EditLookaside</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00018">18</a> of file <a class="el" href="../../d6/d3/edecrare_8c-source.html">edecrare.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00285">ECNcCreate()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00439">ECNcDestroyHandler()</a>, and <a class="el" href="../../d9/d3/editec_8c-source.html#l02831">EditWndProcWorker()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:31 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
