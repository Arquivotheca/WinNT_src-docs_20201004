<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: caret.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>caret.c</h1><a href="../../d4/d5/caret_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: caret.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* Caret code. Every thread has a caret in its queue structure.</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 11-17-90 ScottLu      Created.</span>
00010 <span class="comment">* 01-Feb-1991 mikeke    Added Revalidation code (None)</span>
00011 <span class="comment">* 02-12-91 JimA         Added access checks</span>
00012 <span class="comment">\***************************************************************************/</span>
00013 
00014 <span class="preprocessor">#include "<a class="code" href="../../d0/d4/w32_2ntuser_2kernel_2precomp_8h.html">precomp.h</a>"</span>
00015 <span class="preprocessor">#pragma hdrstop</span>
00016 <span class="preprocessor"></span>
00017 
00018 <span class="comment">/***************************************************************************\</span>
00019 <span class="comment">* UT_CaretSet</span>
00020 <span class="comment">*</span>
00021 <span class="comment">* Checks to see if the current queue has a caret. If pwnd != NULL, check</span>
00022 <span class="comment">* to see if the caret is for pwnd.</span>
00023 <span class="comment">*</span>
00024 <span class="comment">* History:</span>
00025 <span class="comment">* 11-17-90 ScottLu      Ported.</span>
00026 <span class="comment">\***************************************************************************/</span>
00027 
<a name="l00028"></a><a class="code" href="../../d4/d5/caret_8c.html#a0">00028</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d5/caret_8c.html#a0">UT_CaretSet</a>(
00029     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00030 {
00031     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
00032     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent;
00033 
00034     <span class="comment">/*</span>
00035 <span class="comment">     * Current queue have a caret? If not, return FALSE.</span>
00036 <span class="comment">     */</span>
00037     ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00038     pq = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>;
00039 
00040     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00041         RIPERR0(ERROR_ACCESS_DENIED,
00042                 RIP_VERBOSE,
00043                 <span class="stringliteral">"Access denied in UT_CaretSet to current queue's caret"</span>);
00044 
00045         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00046     }
00047 
00048     <span class="comment">/*</span>
00049 <span class="comment">     * If the current task does not own the caret, then return FALSE</span>
00050 <span class="comment">     * but we let 32 bit multithreaded apps set the caret position from</span>
00051 <span class="comment">     * a second thread for compatibility to our NT 3.1 BETAs</span>
00052 <span class="comment">     */</span>
00053     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o10">tid</a> != <a class="code" href="../../d4/d1/userk_8h.html#a107">TIDq</a>(ptiCurrent)) {
00054         <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCursorOwner;
00055 
00056         ptiCursorOwner = <a class="code" href="../../d4/d1/userk_8h.html#a1201">PtiFromThreadId</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o10">tid</a>);
00057 
00058         <span class="keywordflow">if</span> ((ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a796">TIF_16BIT</a>) || ptiCursorOwner == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00059                 (ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a> != ptiCursorOwner-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>))  {
00060             RIPERR0(ERROR_ACCESS_DENIED,
00061                     RIP_VERBOSE,
00062                     <span class="stringliteral">"Access denied in UT_CaretSet"</span>);
00063 
00064             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00065         }
00066     }
00067 
00068     <span class="comment">/*</span>
00069 <span class="comment">     * If pwnd == NULL, just checking to see if current queue has caret.</span>
00070 <span class="comment">     * It does, so return TRUE.</span>
00071 <span class="comment">     */</span>
00072     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00073         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00074 
00075     <span class="comment">/*</span>
00076 <span class="comment">     * pwnd != NULL.  Check to see if the caret is for pwnd.  If so, return</span>
00077 <span class="comment">     * TRUE.</span>
00078 <span class="comment">     */</span>
00079     <span class="keywordflow">if</span> (pwnd == pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>)
00080         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00081 
00082     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00083 }
00084 
00085 <span class="comment">/***************************************************************************\</span>
00086 <span class="comment">* UT_InvertCaret</span>
00087 <span class="comment">*</span>
00088 <span class="comment">* Invert the caret.</span>
00089 <span class="comment">*</span>
00090 <span class="comment">* History:</span>
00091 <span class="comment">* 11-17-90 ScottLu      Ported.</span>
00092 <span class="comment">\***************************************************************************/</span>
00093 
<a name="l00094"></a><a class="code" href="../../d4/d5/caret_8c.html#a1">00094</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d5/caret_8c.html#a1">UT_InvertCaret</a>()
00095 {
00096     HDC hdc;
00097     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00098     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
00099     HBITMAP hbmSave;
00100     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRestore;
00101 
00102     pq = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq;
00103     pwnd = pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>;
00104 
00105 
00106     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || !<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a6">IsVisible</a>(pwnd)) {
00107         pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o1">fVisible</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00108         <span class="keywordflow">return</span>;
00109     }
00110 
00111     <span class="comment">/*</span>
00112 <span class="comment">     * Don't have a dc.  Get one for this window and draw the caret.</span>
00113 <span class="comment">     */</span>
00114     hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1694">_GetDC</a>(pwnd);
00115 
00116     <span class="keywordflow">if</span> (fRestore = (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a> ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00117         GreSaveDC(hdc);
00118         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a592">WFWIN31COMPAT</a>))
00119             <a class="code" href="../../d4/d1/userk_8h.html#a1676">_ExcludeUpdateRgn</a>(hdc, pwnd);
00120     }
00121 
00122     <span class="comment">/*</span>
00123 <span class="comment">     * If the caret bitmap is NULL, the caret is a white pattern invert</span>
00124 <span class="comment">     * If the caret bitmap is == 1, the caret is a gray pattern.</span>
00125 <span class="comment">     * If the caret bitmap is  &gt; 1, the caret is really a bitmap.</span>
00126 <span class="comment">     */</span>
00127     <span class="keywordflow">if</span> ((pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o8">hBitmap</a>) &gt; (HBITMAP)1) {
00128 
00129         <span class="comment">/*</span>
00130 <span class="comment">         * The caret is a bitmap...  SRCINVERT it onto the screen.</span>
00131 <span class="comment">         */</span>
00132         hbmSave = GreSelectBitmap(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a192">ghdcMem</a>, pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o8">hBitmap</a>);
00133         GreBitBlt(hdc, pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o4">x</a>, pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o5">y</a>, pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o7">cx</a>,
00134               pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o6">cy</a>, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a192">ghdcMem</a>, 0, 0, SRCINVERT, 0);
00135 
00136         GreSelectBitmap(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a192">ghdcMem</a>, hbmSave);
00137 
00138     } <span class="keywordflow">else</span> {
00139 
00140         POLYPATBLT PolyData;
00141 
00142         <span class="comment">/*</span>
00143 <span class="comment">         * The caret is a pattern (gray or white).  PATINVERT it onto the</span>
00144 <span class="comment">         * screen.  Remember to unrealize the gray object so it aligns</span>
00145 <span class="comment">         * to the window correctly.</span>
00146 <span class="comment">         *</span>
00147 <span class="comment">         * Remove call to UnrealizeObject.  GDI handles this on NT for</span>
00148 <span class="comment">         * brushes.</span>
00149 <span class="comment">         *</span>
00150 <span class="comment">         * UnrealizeObject(hbrGray);</span>
00151 <span class="comment">         */</span>
00152         PolyData.x  = pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o4">x</a>;
00153         PolyData.y  = pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o5">y</a>;
00154         PolyData.cx = pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o7">cx</a>;
00155         PolyData.cy = pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o6">cy</a>;
00156 
00157         <span class="keywordflow">if</span> ((pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o8">hBitmap</a>) == (HBITMAP)1) {
00158             <span class="comment">//hbrSave = GreSelectBrush(hdc, ghbrGray);</span>
00159             PolyData.BrClr.hbr = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hbrGray;
00160         } <span class="keywordflow">else</span> {
00161             <span class="comment">//hbrSave = GreSelectBrush(hdc, ghbrWhite);</span>
00162             PolyData.BrClr.hbr = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1134">ghbrWhite</a>;
00163         }
00164 
00165         GrePolyPatBlt(hdc,PATINVERT,&amp;PolyData,1,PPB_BRUSH);
00166 
00167         <span class="comment">//GrePatBlt(hdc, pq-&gt;caret.x, pq-&gt;caret.y, pq-&gt;caret.cx, pq-&gt;caret.cy,</span>
00168         <span class="comment">//        PATINVERT);</span>
00169         <span class="comment">//</span>
00170         <span class="comment">//GreSelectBrush(hdc,hbrSave);</span>
00171     }
00172 
00173     <span class="keywordflow">if</span> (fRestore)
00174         GreRestoreDC(hdc, -1);
00175 
00176     <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdc);
00177 }
00178 
00179 
00180 <span class="comment">/***************************************************************************\</span>
00181 <span class="comment">* zzzInternalDestroyCaret</span>
00182 <span class="comment">*</span>
00183 <span class="comment">* Internal routine for killing the caret for this thread.</span>
00184 <span class="comment">*</span>
00185 <span class="comment">* History:</span>
00186 <span class="comment">* 11-17-90 ScottLu      Ported</span>
00187 <span class="comment">\***************************************************************************/</span>
00188 
<a name="l00189"></a><a class="code" href="../../d4/d1/userk_8h.html#a1247">00189</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d5/caret_8c.html#a2">zzzInternalDestroyCaret</a>()
00190 {
00191     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
00192     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00193     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndCaret;
00194     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndCaret;
00195 
00196     <span class="comment">/*</span>
00197 <span class="comment">     * Hide the caret, kill the timer, and null out the caret structure.</span>
00198 <span class="comment">     */</span>
00199     <a class="code" href="../../d4/d5/caret_8c.html#a6">zzzInternalHideCaret</a>();
00200     pq = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>;
00201     <a class="code" href="../../d4/d1/userk_8h.html#a1567">_KillSystemTimer</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a58">IDSYS_CARET</a>);
00202 
00203     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o9">hTimer</a> = 0;
00204     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o8">hBitmap</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00205     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o3">iHideLevel</a> = 0;
00206 
00207     pwndCaret = pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>;
00208     <span class="keywordflow">if</span> (pwndCaret != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00209         <span class="comment">/*</span>
00210 <span class="comment">         * Threadlock caret's spwnd for WinEvent notification below</span>
00211 <span class="comment">         */</span>
00212         <a class="code" href="../../d6/d0/usercli_8h.html#a38">ThreadLockWithPti</a>(ptiCurrent, pwndCaret, &amp;tlpwndCaret);
00213         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>);
00214 
00215         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
00216             <a class="code" href="../../d4/d1/userk_8h.html#a619">zzzWindowEvent</a>(EVENT_OBJECT_DESTROY, pwndCaret, OBJID_CARET, INDEXID_CONTAINER, 0);
00217         }
00218 
00219         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndCaret);
00220     }
00221 }
00222 
00223 
00224 <span class="comment">/***************************************************************************\</span>
00225 <span class="comment">* zzzDestroyCaret</span>
00226 <span class="comment">*</span>
00227 <span class="comment">* External api for destroying the caret of the current thread.</span>
00228 <span class="comment">*</span>
00229 <span class="comment">* History:</span>
00230 <span class="comment">* 11-17-90 ScottLu      Ported.</span>
00231 <span class="comment">* 16-May-1991 mikeke    Changed to return BOOL</span>
00232 <span class="comment">\***************************************************************************/</span>
00233 
<a name="l00234"></a><a class="code" href="../../d4/d5/caret_8c.html#a3">00234</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d5/caret_8c.html#a3">zzzDestroyCaret</a>()
00235 {
00236     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d5/caret_8c.html#a0">UT_CaretSet</a>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00237         <a class="code" href="../../d4/d5/caret_8c.html#a2">zzzInternalDestroyCaret</a>();
00238         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00239     }
00240     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00241 }
00242 
00243 
00244 <span class="comment">/***************************************************************************\</span>
00245 <span class="comment">* xxxCreateCaret</span>
00246 <span class="comment">*</span>
00247 <span class="comment">* External api for creating the caret.</span>
00248 <span class="comment">*</span>
00249 <span class="comment">* History:</span>
00250 <span class="comment">* 11-17-90 ScottLu      Ported.</span>
00251 <span class="comment">* 16-May-1991 mikeke    Changed to return BOOL</span>
00252 <span class="comment">\***************************************************************************/</span>
00253 
<a name="l00254"></a><a class="code" href="../../d4/d1/userk_8h.html#a1724">00254</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1724">xxxCreateCaret</a>(
00255     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00256     HBITMAP hBitmap,
00257     <span class="keywordtype">int</span> cx,
00258     <span class="keywordtype">int</span> cy)
00259 {
00260     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
00261     BITMAP bitmap;
00262     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>  ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00263 
00264     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00265     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a616">IsWinEventNotifyDeferredOK</a>());
00266 
00267     pq = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>;
00268 
00269     <span class="comment">/*</span>
00270 <span class="comment">     * Don't allow the app to create a caret in a window</span>
00271 <span class="comment">     * from another queue.</span>
00272 <span class="comment">     */</span>
00273     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd)-&gt;pq != pq) {
00274         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00275     }
00276 
00277     <span class="comment">/*</span>
00278 <span class="comment">     * Defer WinEvent notifications to preserve pq</span>
00279 <span class="comment">     */</span>
00280     <a class="code" href="../../d4/d1/userk_8h.html#a614">DeferWinEventNotify</a>();
00281 
00282     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00283         <a class="code" href="../../d4/d5/caret_8c.html#a2">zzzInternalDestroyCaret</a>();
00284 
00285     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>, pwnd);
00286     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o3">iHideLevel</a> = 1;
00287     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o2">fOn</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00288     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o1">fVisible</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00289     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o10">tid</a> = <a class="code" href="../../d4/d1/userk_8h.html#a107">TIDq</a>(ptiCurrent);
00290 
00291     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> == 0)
00292         <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00293     <span class="keywordflow">if</span> (cx == 0)
00294         cx = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER);
00295 
00296     <span class="keywordflow">if</span> ((pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o8">hBitmap</a> = hBitmap) &gt; (HBITMAP)1) {
00297         GreExtGetObjectW(hBitmap, <span class="keyword">sizeof</span>(BITMAP), &amp;bitmap);
00298         <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> = bitmap.bmHeight;
00299         cx = bitmap.bmWidth;
00300     }
00301 
00302     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o6">cy</a> = <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a>;
00303     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o7">cx</a> = cx;
00304 
00305     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o9">hTimer</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1894">_SetSystemTimer</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a58">IDSYS_CARET</a>, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dtCaretBlink,
00306             <a class="code" href="../../d4/d5/caret_8c.html#a9">CaretBlinkProc</a>);
00307 
00308     UserAssert(pwnd == pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>);
00309     <a class="code" href="../../d4/d1/userk_8h.html#a617">zzzEndDeferWinEventNotify</a>();
00310     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
00311         <span class="comment">/*</span>
00312 <span class="comment">         * It's best to force this routine to be an xxx routine: that way we can</span>
00313 <span class="comment">         * force pwnd to be locked and force notifications from within this routine</span>
00314 <span class="comment">         * and all of the callers are happy with this.</span>
00315 <span class="comment">         */</span>
00316         <a class="code" href="../../d5/d7/kernel_2winable_8c.html#a8">xxxWindowEvent</a>(EVENT_OBJECT_CREATE, pwnd, OBJID_CARET, INDEXID_CONTAINER, 0);
00317     }
00318 
00319     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00320 }
00321 
00322 <span class="comment">/***************************************************************************\</span>
00323 <span class="comment">* zzzInternalShowCaret</span>
00324 <span class="comment">*</span>
00325 <span class="comment">* Internal routine for showing the caret for this thread.</span>
00326 <span class="comment">*</span>
00327 <span class="comment">* History:</span>
00328 <span class="comment">* 11-17-90 ScottLu      Ported.</span>
00329 <span class="comment">\***************************************************************************/</span>
00330 
<a name="l00331"></a><a class="code" href="../../d4/d1/userk_8h.html#a1245">00331</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d5/caret_8c.html#a5">zzzInternalShowCaret</a>()
00332 {
00333     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
00334     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00335 
00336     pq = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>;
00337 
00338     <span class="comment">/*</span>
00339 <span class="comment">     * If the caret hide level is aleady 0 (meaning it's ok to show) and the</span>
00340 <span class="comment">     * caret is not physically on, try to invert now if it's turned on.</span>
00341 <span class="comment">     */</span>
00342     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o3">iHideLevel</a> == 0) {
00343         <span class="keywordflow">if</span> (!pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o1">fVisible</a>) {
00344             <span class="keywordflow">if</span> ((pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o1">fVisible</a> = pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o2">fOn</a>) != 0) {
00345                 <a class="code" href="../../d4/d5/caret_8c.html#a1">UT_InvertCaret</a>();
00346             }
00347         }
00348         <span class="keywordflow">return</span>;
00349     }
00350 
00351     <span class="comment">/*</span>
00352 <span class="comment">     * Adjust the hide caret hide count.  If we hit 0, we can show the</span>
00353 <span class="comment">     * caret.  Try to invert it if it's turned on.</span>
00354 <span class="comment">     */</span>
00355 
00356     <span class="keywordflow">if</span> (--pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o3">iHideLevel</a> == 0) {
00357         <span class="keywordflow">if</span> ((pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o1">fVisible</a> = pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o2">fOn</a>) != 0)
00358             <a class="code" href="../../d4/d5/caret_8c.html#a1">UT_InvertCaret</a>();
00359 
00360         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
00361             <a class="code" href="../../d4/d1/userk_8h.html#a619">zzzWindowEvent</a>(EVENT_OBJECT_SHOW, pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>, OBJID_CARET, INDEXID_CONTAINER, 0);
00362         }
00363     }
00364 }
00365 
00366 
00367 <span class="comment">/***************************************************************************\</span>
00368 <span class="comment">* zzzInternalHideCaret</span>
00369 <span class="comment">*</span>
00370 <span class="comment">* Internal routine for hiding the caret.</span>
00371 <span class="comment">*</span>
00372 <span class="comment">* History:</span>
00373 <span class="comment">* 11-17-90 ScottLu      Created.</span>
00374 <span class="comment">\***************************************************************************/</span>
00375 
<a name="l00376"></a><a class="code" href="../../d4/d1/userk_8h.html#a1246">00376</a> <span class="keywordtype">void</span> <a class="code" href="../../d4/d5/caret_8c.html#a6">zzzInternalHideCaret</a>()
00377 {
00378     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
00379     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00380 
00381     pq = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>;
00382 
00383     <span class="comment">/*</span>
00384 <span class="comment">     * If the caret is physically visible, invert it to turn off the bits.</span>
00385 <span class="comment">     * Adjust the hide count upwards to remember this hide level.</span>
00386 <span class="comment">     */</span>
00387     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o1">fVisible</a>)
00388         <a class="code" href="../../d4/d5/caret_8c.html#a1">UT_InvertCaret</a>();
00389 
00390     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o1">fVisible</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00391     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o3">iHideLevel</a>++;
00392 
00393     <span class="comment">/*</span>
00394 <span class="comment">     * Is the caret transitioning to being hidden?  If so, iHideLevel is</span>
00395 <span class="comment">     * going from 0 to 1.</span>
00396 <span class="comment">     */</span>
00397     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>() &amp;&amp; (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o3">iHideLevel</a> == 1)) {
00398         <a class="code" href="../../d4/d1/userk_8h.html#a619">zzzWindowEvent</a>(EVENT_OBJECT_HIDE, pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>, OBJID_CARET, INDEXID_CONTAINER, 0);
00399     }
00400 }
00401 
00402 
00403 <span class="comment">/***************************************************************************\</span>
00404 <span class="comment">* zzzShowCaret</span>
00405 <span class="comment">*</span>
00406 <span class="comment">* External routine for showing the caret!</span>
00407 <span class="comment">*</span>
00408 <span class="comment">* History:</span>
00409 <span class="comment">* 11-17-90 ScottLu      Ported.</span>
00410 <span class="comment">* 16-May-1991 mikeke    Changed to return BOOL</span>
00411 <span class="comment">\***************************************************************************/</span>
00412 
<a name="l00413"></a><a class="code" href="../../d4/d1/userk_8h.html#a1725">00413</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1725">zzzShowCaret</a>(
00414     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00415 {
00416     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d5/caret_8c.html#a0">UT_CaretSet</a>(pwnd)) {
00417         <a class="code" href="../../d4/d5/caret_8c.html#a5">zzzInternalShowCaret</a>();
00418         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00419     }
00420     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00421 }
00422 
00423 
00424 <span class="comment">/***************************************************************************\</span>
00425 <span class="comment">* zzzHideCaret</span>
00426 <span class="comment">*</span>
00427 <span class="comment">* External api to hide the caret!</span>
00428 <span class="comment">*</span>
00429 <span class="comment">* History:</span>
00430 <span class="comment">* 11-17-90 ScottLu      Ported.</span>
00431 <span class="comment">* 16-May-1991 mikeke    Changed to return BOOL</span>
00432 <span class="comment">\***************************************************************************/</span>
00433 
<a name="l00434"></a><a class="code" href="../../d4/d1/userk_8h.html#a1726">00434</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1726">zzzHideCaret</a>(
00435     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00436 {
00437     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d5/caret_8c.html#a0">UT_CaretSet</a>(pwnd)) {
00438         <a class="code" href="../../d4/d5/caret_8c.html#a6">zzzInternalHideCaret</a>();
00439         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00440     }
00441     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00442 }
00443 
00444 <span class="comment">/***************************************************************************\</span>
00445 <span class="comment">* CaretBlinkProc</span>
00446 <span class="comment">*</span>
00447 <span class="comment">* This routine gets called by DispatchMessage when it gets the WM_SYSTIMER</span>
00448 <span class="comment">* message - it blinks the caret.</span>
00449 <span class="comment">*</span>
00450 <span class="comment">* History:</span>
00451 <span class="comment">* 11-17-90 ScottLu      Ported.</span>
00452 <span class="comment">\***************************************************************************/</span>
00453 
<a name="l00454"></a><a class="code" href="../../d4/d1/userk_8h.html#a1498">00454</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d4/d1/userk_8h.html#a1498">CaretBlinkProc</a>(
00455     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00456     UINT message,
00457     UINT_PTR <span class="keywordtype">id</span>,
00458     LPARAM lParam)
00459 {
00460     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
00461 
00462     <span class="comment">/*</span>
00463 <span class="comment">     * If this window doesn't even have a timer, just return.  TRUE is</span>
00464 <span class="comment">     * returned, which gets returned from DispatchMessage().  Why? Because</span>
00465 <span class="comment">     * it is compatible with Win3.</span>
00466 <span class="comment">     */</span>
00467     pq = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq;
00468     <span class="keywordflow">if</span> (pwnd != pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>)
00469         <span class="keywordflow">return</span>;
00470 
00471     <span class="comment">/*</span>
00472 <span class="comment">     * leave caret on, don't blink it off for remote sessions</span>
00473 <span class="comment">     */</span>
00474 
00475     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a328">gbRemoteSession</a> &amp;&amp; (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dtCaretBlink &gt;= 1200) &amp;&amp; pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o2">fOn</a> &amp;&amp; pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o1">fVisible</a>) {
00476 
00477         <span class="comment">/*</span>
00478 <span class="comment">         * Kill the timer for performance</span>
00479 <span class="comment">         */</span>
00480         <a class="code" href="../../d4/d1/userk_8h.html#a1567">_KillSystemTimer</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a58">IDSYS_CARET</a>);
00481         <span class="keywordflow">return</span>;
00482     }
00483 
00484     <span class="comment">/*</span>
00485 <span class="comment">     * Flip the logical cursor state.  If the hide level permits it, flip</span>
00486 <span class="comment">     * the physical state and draw the caret.</span>
00487 <span class="comment">     */</span>
00488     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o2">fOn</a> ^= 1;
00489     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o3">iHideLevel</a> == 0) {
00490         pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o1">fVisible</a> ^= 1;
00491         <a class="code" href="../../d4/d5/caret_8c.html#a1">UT_InvertCaret</a>();
00492     }
00493 
00494     <span class="keywordflow">return</span>;
00495 
00496     DBG_UNREFERENCED_PARAMETER(message);
00497     DBG_UNREFERENCED_PARAMETER(<span class="keywordtype">id</span>);
00498     DBG_UNREFERENCED_PARAMETER(lParam);
00499 }
00500 
00501 
00502 <span class="comment">/***************************************************************************\</span>
00503 <span class="comment">* _SetCaretBlinkTime</span>
00504 <span class="comment">*</span>
00505 <span class="comment">* Sets the system caret blink time.</span>
00506 <span class="comment">*</span>
00507 <span class="comment">* History:</span>
00508 <span class="comment">* 11-17-90 ScottLu      Created.</span>
00509 <span class="comment">* 02-12-91 JimA         Added access check</span>
00510 <span class="comment">* 16-May-1991 mikeke    Changed to return BOOL</span>
00511 <span class="comment">\***************************************************************************/</span>
00512 
<a name="l00513"></a><a class="code" href="../../d4/d1/userk_8h.html#a1727">00513</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1727">_SetCaretBlinkTime</a>(
00514     UINT cmsBlink)
00515 {
00516     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
00517     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>  ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00518 
00519     <span class="comment">/*</span>
00520 <span class="comment">     * Blow it off if the caller doesn't have the proper access rights</span>
00521 <span class="comment">     */</span>
00522     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d5/w32_2ntuser_2kernel_2security_8c.html#a9">CheckWinstaWriteAttributesAccess</a>()) {
00523         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00524     }
00525 
00526     <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dtCaretBlink = cmsBlink;
00527 
00528     pq = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>;
00529 
00530     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>) {
00531         <a class="code" href="../../d4/d1/userk_8h.html#a1567">_KillSystemTimer</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a58">IDSYS_CARET</a>);
00532         pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o9">hTimer</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1894">_SetSystemTimer</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a58">IDSYS_CARET</a>,
00533             <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dtCaretBlink, <a class="code" href="../../d4/d5/caret_8c.html#a9">CaretBlinkProc</a>);
00534     }
00535 
00536     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00537 }
00538 
00539 
00540 <span class="comment">/***************************************************************************\</span>
00541 <span class="comment">* zzzSetCaretPos</span>
00542 <span class="comment">*</span>
00543 <span class="comment">* External routine for setting the caret pos.</span>
00544 <span class="comment">*</span>
00545 <span class="comment">* History:</span>
00546 <span class="comment">* 11-17-90 ScottLu      Ported.</span>
00547 <span class="comment">* 02-12-91 JimA         Added access check</span>
00548 <span class="comment">\***************************************************************************/</span>
00549 
<a name="l00550"></a><a class="code" href="../../d4/d1/userk_8h.html#a1728">00550</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d1/userk_8h.html#a1728">zzzSetCaretPos</a>(
00551     <span class="keywordtype">int</span> x,
00552     <span class="keywordtype">int</span> y)
00553 {
00554     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
00555     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>  ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00556 
00557     <span class="comment">/*</span>
00558 <span class="comment">     * If this thread does not have the caret set, return FALSE.</span>
00559 <span class="comment">     */</span>
00560     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d5/caret_8c.html#a0">UT_CaretSet</a>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00561         RIPERR0(ERROR_ACCESS_DENIED, RIP_VERBOSE, <span class="stringliteral">"Access denied in zzzSetCaretPos"</span>);
00562         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00563     }
00564 
00565     <span class="comment">/*</span>
00566 <span class="comment">     * If the caret isn't changing position, do nothing (but return success).</span>
00567 <span class="comment">     */</span>
00568     pq = ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>;
00569     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o4">x</a> == x &amp;&amp; pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o5">y</a> == y)
00570         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00571 
00572     <span class="comment">/*</span>
00573 <span class="comment">     * If the caret is visible, turn it off while we move it.</span>
00574 <span class="comment">     */</span>
00575     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o1">fVisible</a>)
00576         <a class="code" href="../../d4/d5/caret_8c.html#a1">UT_InvertCaret</a>();
00577 
00578     <span class="comment">/*</span>
00579 <span class="comment">     * Adjust to the new position.</span>
00580 <span class="comment">     */</span>
00581     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o4">x</a> = x;
00582     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o5">y</a> = y;
00583 
00584     <span class="comment">/*</span>
00585 <span class="comment">     * Set a new timer so it'll blink in the new position dtCaretBlink</span>
00586 <span class="comment">     * milliseconds from now.</span>
00587 <span class="comment">     */</span>
00588     <a class="code" href="../../d4/d1/userk_8h.html#a1567">_KillSystemTimer</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a58">IDSYS_CARET</a>);
00589     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o9">hTimer</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1894">_SetSystemTimer</a>(pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a58">IDSYS_CARET</a>,
00590             <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dtCaretBlink, <a class="code" href="../../d4/d5/caret_8c.html#a9">CaretBlinkProc</a>);
00591 
00592     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o2">fOn</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00593 
00594     <span class="comment">/*</span>
00595 <span class="comment">     * Draw it immediately now if the hide level permits it.</span>
00596 <span class="comment">     */</span>
00597     pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o1">fVisible</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00598     <span class="keywordflow">if</span> (pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o3">iHideLevel</a> == 0) {
00599         pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o1">fVisible</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00600         <a class="code" href="../../d4/d5/caret_8c.html#a1">UT_InvertCaret</a>();
00601     }
00602 
00603     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
00604         <a class="code" href="../../d4/d1/userk_8h.html#a619">zzzWindowEvent</a>(EVENT_OBJECT_LOCATIONCHANGE, pq-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o18">caret</a>.<a class="code" href="../../d6/d9/structtagCARET.html#o0">spwnd</a>, OBJID_CARET, INDEXID_CONTAINER, 0);
00605     }
00606 
00607     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00608 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:21 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
