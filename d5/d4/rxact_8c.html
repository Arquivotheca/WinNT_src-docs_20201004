<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: rxact.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>rxact.c File Reference</h1><code>#include "<a class="el" href="../../d6/d8/ntrtlp_8h-source.html">ntrtlp.h</a>"</code><br>

<p>
<a href="../../d6/d3/rxact_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d7/struct__RTLP__RXACT.html">_RTLP_RXACT</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html">_RXACT_LOG_ENTRY</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>&nbsp;&nbsp;&nbsp;(HANDLE)-1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a1">RTLP_RXACT_REVISION1</a>&nbsp;&nbsp;&nbsp;(1l)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a2">RTLP_RXACT_CURRENT_REVISION</a>&nbsp;&nbsp;&nbsp;RTLP_RXACT_REVISION1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a3">RTLP_RXACT_KEY_NAME</a>&nbsp;&nbsp;&nbsp;L"RXACT"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a4">RTLP_RXACT_LOG_NAME</a>&nbsp;&nbsp;&nbsp;L"Log"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a5">RTLP_INITIAL_LOG_SIZE</a>&nbsp;&nbsp;&nbsp;0x4000</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a6">DwordAlign</a>(Value)</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d5/d4/rxact_8c.html#a25">_RTLP_RXACT_STATE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a7">RTLP_RXACT_STATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d5/d4/rxact_8c.html#a25">_RTLP_RXACT_STATE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a8">PRTLP_RXACT_STATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d7/struct__RTLP__RXACT.html">_RTLP_RXACT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a9">RTLP_RXACT</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d7/struct__RTLP__RXACT.html">_RTLP_RXACT</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a10">PRTLP_RXACT</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html">_RXACT_LOG_ENTRY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a11">RXACT_LOG_ENTRY</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html">_RXACT_LOG_ENTRY</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a12">PRXACT_LOG_ENTRY</a></td></tr>

<tr><td colspan=2><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a25">_RTLP_RXACT_STATE</a> { <a class="el" href="../../d5/d4/rxact_8c.html#a25a13">RtlpRXactStateNoTransaction</a> =  2, 
<a class="el" href="../../d5/d4/rxact_8c.html#a25a14">RtlpRXactStateCommitting</a>
 }</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a15">RXactpCommit</a> (IN PRTL_RXACT_CONTEXT RXactContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a16">RXactpOpenTargetKey</a> (IN HANDLE RootRegistryKey, IN RTL_RXACT_OPERATION Operation, IN PUNICODE_STRING SubKeyName, OUT PHANDLE TargetKey)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a17">RXactInitializeContext</a> (IN PRTL_RXACT_CONTEXT RXactContext, IN HANDLE RootRegistryKey, IN HANDLE RXactKey)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a18">RtlInitializeRXact</a> (IN HANDLE RootRegistryKey, IN BOOLEAN CommitIfNecessary, OUT PRTL_RXACT_CONTEXT *RXactContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a19">RtlStartRXact</a> (IN PRTL_RXACT_CONTEXT RXactContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a20">RtlAbortRXact</a> (IN PRTL_RXACT_CONTEXT RXactContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a21">RtlAddAttributeActionToRXact</a> (IN PRTL_RXACT_CONTEXT RXactContext, IN RTL_RXACT_OPERATION Operation, IN PUNICODE_STRING SubKeyName, IN HANDLE KeyHandle OPTIONAL, IN PUNICODE_STRING AttributeName, IN ULONG NewValueType, IN PVOID NewValue, IN ULONG NewValueLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a22">RtlAddActionToRXact</a> (IN PRTL_RXACT_CONTEXT RXactContext, IN RTL_RXACT_OPERATION Operation, IN PUNICODE_STRING SubKeyName, IN ULONG NewKeyValueType, IN PVOID NewKeyValue OPTIONAL, IN ULONG NewKeyValueLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a23">RtlApplyRXact</a> (IN PRTL_RXACT_CONTEXT RXactContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d4/rxact_8c.html#a24">RtlApplyRXactNoFlush</a> (IN PRTL_RXACT_CONTEXT RXactContext)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a6" doxytag="rxact.c::DwordAlign" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DwordAlign          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Value&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                       \
    (ULONG)((((ULONG)(Value)) + 3) &amp; 0xfffffffc)  \
    )
</div></pre>
<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00242">242</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/rxact_8c-source.html#l00900">RtlAddAttributeActionToRXact()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="rxact.c::INVALID_HANDLE_VALUE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define INVALID_HANDLE_VALUE&nbsp;&nbsp;&nbsp;(HANDLE)-1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00212">212</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d5/iostubs_8c-source.html#l01666">CreateConsoleScreenBuffer()</a>, <a class="el" href="../../d9/d7/shellext_8cpp-source.html#l00174">DllMain()</a>, <a class="el" href="../../d4/d0/hivehdr_8c-source.html#l00055">DoDump()</a>, <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00597">DuplicateConsoleHandle()</a>, <a class="el" href="../../d7/d9/extract_8c-source.html#l00517">ExtractIconFromEXE()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00053">FindActiveScreenBufferHandle()</a>, <a class="el" href="../../d5/d8/icmupg_8c-source.html#l00726">InstallProfiles()</a>, <a class="el" href="../../d1/d6/w32_2ntgdi_2icm_2mscms_2profile_8c-source.html#l02694">InternalOpenColorProfile()</a>, <a class="el" href="../../d4/d3/link_8c-source.html#l00129">LoadLink()</a>, <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00098">OpenConsoleW()</a>, <a class="el" href="../../d0/d6/client_2stream_8c-source.html#l00044">OpenConsoleWInternal()</a>, <a class="el" href="../../d0/d7/profman_8c-source.html#l05280">OpenMonitor()</a>, <a class="el" href="../../d7/d9/extract_8c-source.html#l00830">PrivateExtractIconsW()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01778">ReadChars()</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l01156">RtlAddActionToRXact()</a>, <a class="el" href="../../d4/d1/rtlres_8c-source.html#l00142">RtlLoadObjectFromDIBFile()</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l01461">RXactpCommit()</a>, <a class="el" href="../../d9/d0/hivestat_8c-source.html#l00320">ScanHive()</a>, <a class="el" href="../../d1/d1/lboxctl3_8c-source.html#l00839">xxxLbDir()</a>, and <a class="el" href="../../d1/d1/lboxctl3_8c-source.html#l01036">xxxLbInsertFile()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="rxact.c::RTLP_INITIAL_LOG_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define RTLP_INITIAL_LOG_SIZE&nbsp;&nbsp;&nbsp;0x4000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00236">236</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/rxact_8c-source.html#l00760">RtlStartRXact()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="rxact.c::RTLP_RXACT_CURRENT_REVISION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define RTLP_RXACT_CURRENT_REVISION&nbsp;&nbsp;&nbsp;RTLP_RXACT_REVISION1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00229">229</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="rxact.c::RTLP_RXACT_KEY_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define RTLP_RXACT_KEY_NAME&nbsp;&nbsp;&nbsp;L"RXACT"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00232">232</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/rxact_8c-source.html#l00341">RtlInitializeRXact()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="rxact.c::RTLP_RXACT_LOG_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define RTLP_RXACT_LOG_NAME&nbsp;&nbsp;&nbsp;L"Log"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00234">234</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/rxact_8c-source.html#l01240">RtlApplyRXact()</a>, and <a class="el" href="../../d6/d3/rxact_8c-source.html#l00341">RtlInitializeRXact()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="rxact.c::RTLP_RXACT_REVISION1" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define RTLP_RXACT_REVISION1&nbsp;&nbsp;&nbsp;(1l)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00228">228</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/rxact_8c-source.html#l00341">RtlInitializeRXact()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a10" doxytag="rxact.c::PRTLP_RXACT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d7/struct__RTLP__RXACT.html">_RTLP_RXACT</a> * <a class="el" href="../../d1/d7/struct__RTLP__RXACT.html">PRTLP_RXACT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="rxact.c::PRTLP_RXACT_STATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d5/d4/rxact_8c.html#a25">_RTLP_RXACT_STATE</a> * <a class="el" href="../../d5/d4/rxact_8c.html#a8">PRTLP_RXACT_STATE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="rxact.c::PRXACT_LOG_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html">_RXACT_LOG_ENTRY</a> * <a class="el" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html">PRXACT_LOG_ENTRY</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d6/d3/rxact_8c-source.html#l00900">RtlAddAttributeActionToRXact()</a>, and <a class="el" href="../../d6/d3/rxact_8c-source.html#l01461">RXactpCommit()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="rxact.c::RTLP_RXACT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d7/struct__RTLP__RXACT.html">_RTLP_RXACT</a>  <a class="el" href="../../d1/d7/struct__RTLP__RXACT.html">RTLP_RXACT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="rxact.c::RTLP_RXACT_STATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d5/d4/rxact_8c.html#a25">_RTLP_RXACT_STATE</a>  <a class="el" href="../../d5/d4/rxact_8c.html#a7">RTLP_RXACT_STATE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="rxact.c::RXACT_LOG_ENTRY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html">_RXACT_LOG_ENTRY</a>  <a class="el" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html">RXACT_LOG_ENTRY</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="a25" doxytag="rxact.c::_RTLP_RXACT_STATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d5/d4/rxact_8c.html#a25">_RTLP_RXACT_STATE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a25a13" doxytag="RtlpRXactStateNoTransaction" ></a>RtlpRXactStateNoTransaction</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a25a14" doxytag="RtlpRXactStateCommitting" ></a>RtlpRXactStateCommitting</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00260">260</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
<pre class="fragment"><div>00260                                {
00261     <a class="code" href="../../d5/d4/rxact_8c.html#a25a13">RtlpRXactStateNoTransaction</a> = 2,
00262     <a class="code" href="../../d5/d4/rxact_8c.html#a25a14">RtlpRXactStateCommitting</a>
00263 } <a class="code" href="../../d5/d4/rxact_8c.html#a7">RTLP_RXACT_STATE</a>, *<a class="code" href="../../d5/d4/rxact_8c.html#a8">PRTLP_RXACT_STATE</a>;
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a20" doxytag="rxact.c::RtlAbortRXact" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlAbortRXact           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRTL_RXACT_CONTEXT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>RXactContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00833">833</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00716">RXactInitializeContext()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/rxact_8c-source.html#l01240">RtlApplyRXact()</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l01380">RtlApplyRXactNoFlush()</a>, and <a class="el" href="../../d6/d3/rxact_8c-source.html#l00341">RtlInitializeRXact()</a>.
<p>
<pre class="fragment"><div>00839                    :
00840 
00841     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to abort a transaction in a registry sub-tree.
00842 
00843 Arguments:
00844 
00845     RootRegistryKey - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry key within whose sub-tree
00846         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be aborted.
00847 
00848 Return Value:
00849 
00850     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction was aborted.
00851 
00852 
00853     STATUS_UNKNOWN_REVISION - Indicates that a transaction state
00854         exists <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified sub-tree, but has a revision level that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00855         unknown by <span class="keyword">this</span> service.
00856 
00857 
00858     STATUS_RXACT_INVALID_STATE - Indicates that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction state
00859         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry sub-tree <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> incompatible with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested operation.
00860         For example, a request to start a <span class="keyword">new</span> transaction <span class="keywordflow">while</span> one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already
00861         in progress, or a request to apply a transaction when one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
00862         currently in progress.  This may also indicate that there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no
00863         transaction state at all <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified registry sub-tree.
00864 
00865 --*/
00866 
00867 {
00868     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
00869 
00870     <span class="keywordflow">if</span> ( RXactContext-&gt;RXactLog == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00871 
00872         <span class="comment">//</span>
00873         <span class="comment">// There is no transaction in progress for this</span>
00874         <span class="comment">// context.  Return an error.</span>
00875         <span class="comment">//</span>
00876 
00877         <span class="keywordflow">return</span>( STATUS_RXACT_INVALID_STATE );
00878     }
00879 
00880     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, RXactContext-&gt;RXactLog );
00881 
00882     <span class="comment">//</span>
00883     <span class="comment">// Reinitialize the RXactContext structure with the same initial data.</span>
00884     <span class="comment">//</span>
00885 
00886     <a class="code" href="../../d5/d4/rxact_8c.html#a17">RXactInitializeContext</a>(
00887         RXactContext,
00888         RXactContext-&gt;RootRegistryKey,
00889         RXactContext-&gt;RXactKey
00890         );
00891 
00892 
00893     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00894 
00895 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="rxact.c::RtlAddActionToRXact" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlAddActionToRXact           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRTL_RXACT_CONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>RXactContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN RTL_RXACT_OPERATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Operation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>SubKeyName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NewKeyValueType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID NewKeyValue&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NewKeyValueLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l01156">1156</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
References <a class="el" href="../../d6/d3/rxact_8c-source.html#l00212">INVALID_HANDLE_VALUE</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00900">RtlAddAttributeActionToRXact()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01167                    :
01168 
01169     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to add a <span class="keyword">new</span> action to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction operation log.
01170     Upon commit, these operations are applied in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> order they are added
01171     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> log.
01172 
01173 Arguments:
01174 
01175     RXactContext - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RXactContext structure <span class="keywordflow">for</span> <span class="keyword">this</span>
01176         subsystem's root registry key.
01177 
01178     Operation - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of operation to perform (e.g., <span class="keyword">delete</span>
01179         a sub-key or set the value of a sub-key).  Sub-keys may be created
01180         by setting a value of a previously non-existent sub-key.  This will
01181         cause all sub-keys between <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified sub-key to
01182         be created.
01183 
01184     SubKeyName - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target registry key.  This name
01185         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> relative to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Root of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Registry transaction sub-tree
01186         and must NOT start with a delimiter character (<span class="stringliteral">"\").</span>
01187 <span class="stringliteral"></span>
01188 <span class="stringliteral">    NewKeyValueType - (Optional) Contains the KeyValueType to assign</span>
01189 <span class="stringliteral">        to the target registry key.  This parameter is ignored if the</span>
01190 <span class="stringliteral">        Operation is not RtlRXactOperationSetValue.</span>
01191 <span class="stringliteral"></span>
01192 <span class="stringliteral">    NewKeyValue -  (Optional) Points to a buffer containing the value</span>
01193 <span class="stringliteral">        to assign to the specified target registry key.  This parameter</span>
01194 <span class="stringliteral">        is ignored if the Operation is not RtlRXactOperationSetValue.</span>
01195 <span class="stringliteral"></span>
01196 <span class="stringliteral">    NewKeyValueLength - Indicates the length (number of bytes) of the</span>
01197 <span class="stringliteral">        NewKeyValue buffer.  This parameter is ignored if the Operation</span>
01198 <span class="stringliteral">        is not RtlRXactOperationSetValue.</span>
01199 <span class="stringliteral"></span>
01200 <span class="stringliteral">Return Value:</span>
01201 <span class="stringliteral"></span>
01202 <span class="stringliteral">    STATUS_SUCCESS - Indicates the request completed successfully..</span>
01203 <span class="stringliteral"></span>
01204 <span class="stringliteral"></span>
01205 <span class="stringliteral">    STATUS_UNKNOWN_REVISION - Indicates that a transaction state</span>
01206 <span class="stringliteral">        exists for the specified sub-tree, but has a revision level that is</span>
01207 <span class="stringliteral">        unknown by this service.</span>
01208 <span class="stringliteral"></span>
01209 <span class="stringliteral">    Others - Other status values that may be returned from registry key</span>
01210 <span class="stringliteral">        services (such as STATUS_ACCESS_DENIED).</span>
01211 <span class="stringliteral"></span>
01212 <span class="stringliteral">--*/</span>
01213 <span class="stringliteral">{</span>
01214 <span class="stringliteral">    UNICODE_STRING AttributeName;</span>
01215 <span class="stringliteral">    NTSTATUS Status;</span>
01216 <span class="stringliteral"></span>
01217 <span class="stringliteral">    RTL_PAGED_CODE();</span>
01218 <span class="stringliteral"></span>
01219 <span class="stringliteral">    RtlInitUnicodeString( &amp;AttributeName, NULL );</span>
01220 <span class="stringliteral"></span>
01221 <span class="stringliteral">    Status = RtlAddAttributeActionToRXact(</span>
01222 <span class="stringliteral">                 RXactContext,</span>
01223 <span class="stringliteral">                 Operation,</span>
01224 <span class="stringliteral">                 SubKeyName,</span>
01225 <span class="stringliteral">                 INVALID_HANDLE_VALUE,</span>
01226 <span class="stringliteral">                 &amp;AttributeName,</span>
01227 <span class="stringliteral">                 NewKeyValueType,</span>
01228 <span class="stringliteral">                 NewKeyValue,</span>
01229 <span class="stringliteral">                 NewKeyValueLength</span>
01230 <span class="stringliteral">                 );</span>
01231 <span class="stringliteral"></span>
01232 <span class="stringliteral">    return( Status );</span>
01233 <span class="stringliteral"></span>
01234 <span class="stringliteral"></span>
01235 <span class="stringliteral">}</span>
</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="rxact.c::RtlAddAttributeActionToRXact" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlAddAttributeActionToRXact           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRTL_RXACT_CONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>RXactContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN RTL_RXACT_OPERATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Operation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>SubKeyName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE KeyHandle&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AttributeName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NewValueType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>NewValue</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NewValueLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00900">900</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00126">ALIGN_UP</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00277">_RXACT_LOG_ENTRY::AttributeName</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00242">DwordAlign</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00050">End</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00278">_RXACT_LOG_ENTRY::KeyHandle</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00274">_RXACT_LOG_ENTRY::LogEntrySize</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00281">_RXACT_LOG_ENTRY::NewKeyValue</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00280">_RXACT_LOG_ENTRY::NewKeyValueLength</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00279">_RXACT_LOG_ENTRY::NewKeyValueType</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00275">_RXACT_LOG_ENTRY::Operation</a>, <a class="el" href="../../d5/d4/rxact_8c.html#a12">PRXACT_LOG_ENTRY</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00022">RtlAllocateHeap</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>, and <a class="el" href="../../d6/d3/rxact_8c-source.html#l00276">_RXACT_LOG_ENTRY::SubKeyName</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/rxact_8c-source.html#l01156">RtlAddActionToRXact()</a>.
<p>
<pre class="fragment"><div>00913                    :
00914 
00915     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to add a <span class="keyword">new</span> action to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction operation log.
00916     Upon commit, these operations are applied in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> order they are added
00917     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> log.
00918 
00919     This routine differs from <a class="code" href="../../d5/d4/rxact_8c.html#a22">RtlAddActionToRXact</a> in that <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> takes an Attribute
00920     <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a> parameter, rather than <span class="keyword">using</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> (<span class="stringliteral">"NULL"</span>) Attribute of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00921     specified key.
00922 
00923 
00924 Arguments:
00925 
00926     RXactContext - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RXactContext structure <span class="keywordflow">for</span> <span class="keyword">this</span>
00927         subsystem's root registry key.
00928 
00929     Operation - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of operation to perform (e.g., <span class="keyword">delete</span>
00930         a sub-key or set the value of a sub-key).  Sub-keys may be created
00931         by setting a value of a previously non-existent sub-key.  This will
00932         cause all sub-keys between <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified sub-key to
00933         be created.
00934 
00935     SubKeyName - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target registry key.  This name
00936         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> relative to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Root of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Registry transaction sub-tree
00937         and must NOT start with a delimiter character (<span class="stringliteral">"\").</span>
00938 <span class="stringliteral"></span>
00939 <span class="stringliteral">    KeyHandle - Optionally supplies a handle to the target key.  If</span>
00940 <span class="stringliteral">        not specified, the name passed for SubKeyName will determine</span>
00941 <span class="stringliteral">        the target key.</span>
00942 <span class="stringliteral"></span>
00943 <span class="stringliteral">    AttributeName - Supplies the name of the key attribute to be</span>
00944 <span class="stringliteral">        modified.</span>
00945 <span class="stringliteral"></span>
00946 <span class="stringliteral">    NewKeyValueType - (Optional) Contains the KeyValueType to assign</span>
00947 <span class="stringliteral">        to the target registry key.  This parameter is ignored if the</span>
00948 <span class="stringliteral">        Operation is not RtlRXactOperationSetValue.</span>
00949 <span class="stringliteral"></span>
00950 <span class="stringliteral">    NewKeyValue -  (Optional) Points to a buffer containing the value</span>
00951 <span class="stringliteral">        to assign to the specified target registry key.  This parameter</span>
00952 <span class="stringliteral">        is ignored if the Operation is not RtlRXactOperationSetValue.</span>
00953 <span class="stringliteral"></span>
00954 <span class="stringliteral">    NewKeyValueLength - Indicates the length (number of bytes) of the</span>
00955 <span class="stringliteral">        NewKeyValue buffer.  This parameter is ignored if the Operation</span>
00956 <span class="stringliteral">        is not RtlRXactOperationSetValue.</span>
00957 <span class="stringliteral"></span>
00958 <span class="stringliteral"></span>
00959 <span class="stringliteral">Return Value:</span>
00960 <span class="stringliteral"></span>
00961 <span class="stringliteral">    STATUS_SUCCESS - Indicates the request completed successfully..</span>
00962 <span class="stringliteral"></span>
00963 <span class="stringliteral">    STATUS_INVALID_PARAMETER - Indicates that an unknown Operation</span>
00964 <span class="stringliteral">        was requested.</span>
00965 <span class="stringliteral"></span>
00966 <span class="stringliteral">    STATUS_NO_MEMORY - Insufficient memeory was available to complete</span>
00967 <span class="stringliteral">        this operation.</span>
00968 <span class="stringliteral"></span>
00969 <span class="stringliteral">    STATUS_UNKNOWN_REVISION - Indicates that a transaction state</span>
00970 <span class="stringliteral">        exists for the specified sub-tree, but has a revision level that is</span>
00971 <span class="stringliteral">        unknown by this service.</span>
00972 <span class="stringliteral"></span>
00973 <span class="stringliteral"></span>
00974 <span class="stringliteral">--*/</span>
00975 <span class="stringliteral"></span>
00976 <span class="stringliteral">{</span>
00977 <span class="stringliteral"></span>
00978 <span class="stringliteral">    PRTL_RXACT_LOG   NewLog;</span>
00979 <span class="stringliteral">    PRXACT_LOG_ENTRY Base;</span>
00980 <span class="stringliteral"></span>
00981 <span class="stringliteral">    ULONG End;</span>
00982 <span class="stringliteral">    ULONG LogEntrySize;</span>
00983 <span class="stringliteral">    ULONG NewLogSize;</span>
00984 <span class="stringliteral"></span>
00985 <span class="stringliteral">    RTL_PAGED_CODE();</span>
00986 <span class="stringliteral"></span>
00987 <span class="stringliteral">    //</span>
00988 <span class="stringliteral">    // Make sure we were passed a legitimate operation.</span>
00989 <span class="stringliteral">    //</span>
00990 <span class="stringliteral"></span>
00991 <span class="stringliteral">    if (  (Operation != RtlRXactOperationDelete)  &amp;&amp;</span>
00992 <span class="stringliteral">          (Operation != RtlRXactOperationSetValue)   ) {</span>
00993 <span class="stringliteral">        return STATUS_INVALID_PARAMETER;</span>
00994 <span class="stringliteral">    }</span>
00995 <span class="stringliteral"></span>
00996 <span class="stringliteral">    //</span>
00997 <span class="stringliteral">    // Compute the total size of the new data</span>
00998 <span class="stringliteral">    //</span>
00999 <span class="stringliteral"></span>
01000 <span class="stringliteral">    LogEntrySize = sizeof( RXACT_LOG_ENTRY )               +</span>
01001 <span class="stringliteral">                   DwordAlign( SubKeyName-&gt;Length )        +</span>
01002 <span class="stringliteral">                   DwordAlign( AttributeName-&gt;Length )     +</span>
01003 <span class="stringliteral">                   DwordAlign( NewValueLength );</span>
01004 <span class="stringliteral"></span>
01005 <span class="stringliteral">    LogEntrySize = ALIGN_UP( LogEntrySize, PVOID );</span>
01006 <span class="stringliteral"></span>
01007 <span class="stringliteral">    //</span>
01008 <span class="stringliteral">    // Make sure there is enough space in the current</span>
01009 <span class="stringliteral">    // log file for this data.  If not, we must create</span>
01010 <span class="stringliteral">    // a larger log, copy all the old data, and then</span>
01011 <span class="stringliteral">    // append this to the end.</span>
01012 <span class="stringliteral">    //</span>
01013 <span class="stringliteral"></span>
01014 <span class="stringliteral">    if ( RXactContext-&gt;RXactLog-&gt;LogSizeInUse + LogEntrySize &gt;</span>
01015 <span class="stringliteral">                                   RXactContext-&gt;RXactLog-&gt;LogSize ) {</span>
01016 <span class="stringliteral"></span>
01017 <span class="stringliteral">        //</span>
01018 <span class="stringliteral">        // We must allocate a bigger log file.</span>
01019 <span class="stringliteral">        //</span>
01020 <span class="stringliteral"></span>
01021 <span class="stringliteral">        NewLogSize = RXactContext-&gt;RXactLog-&gt;LogSize;</span>
01022 <span class="stringliteral"></span>
01023 <span class="stringliteral">        do {</span>
01024 <span class="stringliteral"></span>
01025 <span class="stringliteral">            NewLogSize = NewLogSize * 2;</span>
01026 <span class="stringliteral"></span>
01027 <span class="stringliteral">        } while ( NewLogSize &lt;</span>
01028 <span class="stringliteral">            ( RXactContext-&gt;RXactLog-&gt;LogSizeInUse + LogEntrySize ) );</span>
01029 <span class="stringliteral"></span>
01030 <span class="stringliteral">        NewLog = RtlAllocateHeap( RtlProcessHeap(), 0, NewLogSize );</span>
01031 <span class="stringliteral"></span>
01032 <span class="stringliteral">        if ( NewLog == NULL ) {</span>
01033 <span class="stringliteral">            return( STATUS_NO_MEMORY );</span>
01034 <span class="stringliteral">        }</span>
01035 <span class="stringliteral"></span>
01036 <span class="stringliteral">        //</span>
01037 <span class="stringliteral">        // Copy over previous information</span>
01038 <span class="stringliteral">        //</span>
01039 <span class="stringliteral"></span>
01040 <span class="stringliteral">        RtlMoveMemory( NewLog, RXactContext-&gt;RXactLog, RXactContext-&gt;RXactLog-&gt;LogSizeInUse );</span>
01041 <span class="stringliteral"></span>
01042 <span class="stringliteral">        //</span>
01043 <span class="stringliteral">        // Free the old log file</span>
01044 <span class="stringliteral">        //</span>
01045 <span class="stringliteral"></span>
01046 <span class="stringliteral">        RtlFreeHeap( RtlProcessHeap(), 0, RXactContext-&gt;RXactLog );</span>
01047 <span class="stringliteral"></span>
01048 <span class="stringliteral">        //</span>
01049 <span class="stringliteral">        // Install the new log file and adjust its size in its header</span>
01050 <span class="stringliteral">        //</span>
01051 <span class="stringliteral"></span>
01052 <span class="stringliteral">        RXactContext-&gt;RXactLog = NewLog;</span>
01053 <span class="stringliteral">        RXactContext-&gt;RXactLog-&gt;LogSize = NewLogSize;</span>
01054 <span class="stringliteral">    }</span>
01055 <span class="stringliteral"></span>
01056 <span class="stringliteral">    //</span>
01057 <span class="stringliteral">    // The log file is big enough, append data to</span>
01058 <span class="stringliteral">    // the end.</span>
01059 <span class="stringliteral">    //</span>
01060 <span class="stringliteral"></span>
01061 <span class="stringliteral">    Base = (PRXACT_LOG_ENTRY)((PCHAR)(RXactContext-&gt;RXactLog) +</span>
01062 <span class="stringliteral">                             (RXactContext-&gt;RXactLog-&gt;LogSizeInUse));</span>
01063 <span class="stringliteral"></span>
01064 <span class="stringliteral"></span>
01065 <span class="stringliteral">    //</span>
01066 <span class="stringliteral">    // Append each parameter to the end of the log.  Unicode string data</span>
01067 <span class="stringliteral">    // will be appended to the end of the entry.  The Buffer field in the</span>
01068 <span class="stringliteral">    // Unicode string structure will contain the offset to the Buffer,</span>
01069 <span class="stringliteral">    // relative to the beginning of the log file.</span>
01070 <span class="stringliteral">    //</span>
01071 <span class="stringliteral"></span>
01072 <span class="stringliteral">    Base-&gt;LogEntrySize      = LogEntrySize;</span>
01073 <span class="stringliteral">    Base-&gt;Operation         = Operation;</span>
01074 <span class="stringliteral">    Base-&gt;SubKeyName        = *SubKeyName;</span>
01075 <span class="stringliteral">    Base-&gt;AttributeName     = *AttributeName;</span>
01076 <span class="stringliteral">    Base-&gt;NewKeyValueType   = NewValueType;</span>
01077 <span class="stringliteral">    Base-&gt;NewKeyValueLength = NewValueLength;</span>
01078 <span class="stringliteral">    Base-&gt;KeyHandle         = KeyHandle;</span>
01079 <span class="stringliteral"></span>
01080 <span class="stringliteral">    //</span>
01081 <span class="stringliteral">    // Fill in the variable length data: SubKeyName, AttributeName,</span>
01082 <span class="stringliteral">    // and NewKeyValue</span>
01083 <span class="stringliteral">    //</span>
01084 <span class="stringliteral"></span>
01085 <span class="stringliteral">    //</span>
01086 <span class="stringliteral">    // End is an offset relative to the beginning of the entire log</span>
01087 <span class="stringliteral">    // structure.  It is initialized to 'point' to the offset immediately</span>
01088 <span class="stringliteral">    // following the structure we just filled in above.</span>
01089 <span class="stringliteral">    //</span>
01090 <span class="stringliteral"></span>
01091 <span class="stringliteral">    End = (ULONG)((RXactContext-&gt;RXactLog-&gt;LogSizeInUse) +</span>
01092 <span class="stringliteral">                 sizeof( *Base ));</span>
01093 <span class="stringliteral"></span>
01094 <span class="stringliteral"></span>
01095 <span class="stringliteral">    //</span>
01096 <span class="stringliteral">    // Append SubKeyName information to the log file</span>
01097 <span class="stringliteral">    //</span>
01098 <span class="stringliteral"></span>
01099 <span class="stringliteral">    RtlMoveMemory (</span>
01100 <span class="stringliteral">        (PCHAR)(RXactContext-&gt;RXactLog) + End,</span>
01101 <span class="stringliteral">        SubKeyName-&gt;Buffer,</span>
01102 <span class="stringliteral">        SubKeyName-&gt;Length</span>
01103 <span class="stringliteral">        );</span>
01104 <span class="stringliteral"></span>
01105 <span class="stringliteral">    Base-&gt;SubKeyName.Buffer = (PWSTR)ULongToPtr(End);</span>
01106 <span class="stringliteral">    End += DwordAlign( SubKeyName-&gt;Length );</span>
01107 <span class="stringliteral"></span>
01108 <span class="stringliteral"></span>
01109 <span class="stringliteral"></span>
01110 <span class="stringliteral">    //</span>
01111 <span class="stringliteral">    // Append AttributeName information to the log file</span>
01112 <span class="stringliteral">    //</span>
01113 <span class="stringliteral"></span>
01114 <span class="stringliteral"></span>
01115 <span class="stringliteral">    RtlMoveMemory(</span>
01116 <span class="stringliteral">        (PCHAR)(RXactContext-&gt;RXactLog) + End,</span>
01117 <span class="stringliteral">        AttributeName-&gt;Buffer,</span>
01118 <span class="stringliteral">        AttributeName-&gt;Length</span>
01119 <span class="stringliteral">        );</span>
01120 <span class="stringliteral"></span>
01121 <span class="stringliteral">    Base-&gt;AttributeName.Buffer = (PWSTR)ULongToPtr(End);</span>
01122 <span class="stringliteral">    End += DwordAlign( AttributeName-&gt;Length );</span>
01123 <span class="stringliteral"></span>
01124 <span class="stringliteral"></span>
01125 <span class="stringliteral"></span>
01126 <span class="stringliteral">    //</span>
01127 <span class="stringliteral">    // Append NewKeyValue information (if present) to the log file</span>
01128 <span class="stringliteral">    //</span>
01129 <span class="stringliteral"></span>
01130 <span class="stringliteral">    if ( Operation == RtlRXactOperationSetValue ) {</span>
01131 <span class="stringliteral"></span>
01132 <span class="stringliteral">        RtlMoveMemory(</span>
01133 <span class="stringliteral">            (PCHAR)(RXactContext-&gt;RXactLog) + End,</span>
01134 <span class="stringliteral">            NewValue,</span>
01135 <span class="stringliteral">            NewValueLength</span>
01136 <span class="stringliteral">            );</span>
01137 <span class="stringliteral"></span>
01138 <span class="stringliteral">        Base-&gt;NewKeyValue = (PVOID)ULongToPtr(End);</span>
01139 <span class="stringliteral">        End += DwordAlign( NewValueLength );</span>
01140 <span class="stringliteral">    }</span>
01141 <span class="stringliteral"></span>
01142 <span class="stringliteral">    End = ALIGN_UP( End, PVOID );</span>
01143 <span class="stringliteral"></span>
01144 <span class="stringliteral">    RXactContext-&gt;RXactLog-&gt;LogSizeInUse = End;</span>
01145 <span class="stringliteral">    RXactContext-&gt;RXactLog-&gt;OperationCount++;</span>
01146 <span class="stringliteral"></span>
01147 <span class="stringliteral">    //</span>
01148 <span class="stringliteral">    // We're done</span>
01149 <span class="stringliteral">    //</span>
01150 <span class="stringliteral"></span>
01151 <span class="stringliteral">    return(STATUS_SUCCESS);</span>
01152 <span class="stringliteral">}</span>
</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="rxact.c::RtlApplyRXact" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlApplyRXact           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRTL_RXACT_CONTEXT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>RXactContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l01240">1240</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00504">NtDeleteValueKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00904">NtFlushKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02672">NtSetValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00833">RtlAbortRXact()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00234">RTLP_RXACT_LOG_NAME</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l01461">RXactpCommit()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>01246                    :
01247 
01248     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to apply <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> changes of a registry sub-tree
01249     Transaction to that registry sub-tree.  This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> meant to be
01250     called <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> common <span class="keywordflow">case</span>, where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> hive <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> automatically
01251     lazy-flushed.  That means that <span class="keyword">this</span> routine must write <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> change log
01252     to disk, then flush <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> hive (to ensure that pieces of changes aren't
01253     lazy-written to disk before <span class="keyword">this</span> routine finishes an atomic operation),
01254     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> apply <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> changes, then <span class="keyword">delete</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> change log.
01255 
01256     The actual changes will be lazy-written to disk, but <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry
01257     guarantees that none or all will make <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> machine goes down
01258     <span class="keywordflow">while</span> <span class="keyword">this</span> routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executing, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> flushed change log guarantees
01259     that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> hive can be put into a consistent state.
01260 
01261 Arguments:
01262 
01263     RXactContext - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RXactContext structure <span class="keywordflow">for</span> <span class="keyword">this</span>
01264         subsystem's root registry key.
01265 
01266 Return Value:
01267 
01268     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction was completed.
01269 
01270     STATUS_UNKNOWN_REVISION - Indicates that a transaction state
01271         exists <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified sub-tree, but has a revision level that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01272         unknown by <span class="keyword">this</span> service.
01273 
01274 
01275     STATUS_RXACT_INVALID_STATE - Indicates that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction state
01276         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry sub-tree <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> incompatible with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested operation.
01277         For example, a request to start a <span class="keyword">new</span> transaction <span class="keywordflow">while</span> one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already
01278         in progress, or a request to apply a transaction when one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
01279         currently in progress.  This may also indicate that there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no
01280         transaction state at all <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified registry sub-tree.
01281 
01282 
01283 --*/
01284 {
01285     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01286     UNICODE_STRING LogName;
01287     HANDLE RXactKey;
01288 
01289     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
01290 
01291     <span class="comment">//</span>
01292     <span class="comment">// Commit the contents of the current log to disk</span>
01293     <span class="comment">//</span>
01294 
01295     RXactKey = RXactContext-&gt;RXactKey;
01296 
01297     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;LogName, RTLP_RXACT_LOG_NAME );
01298 
01299     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>( RXactKey,
01300                             &amp;LogName,        <span class="comment">// ValueName</span>
01301                             0,               <span class="comment">// TitleIndex</span>
01302                             REG_BINARY,
01303                             RXactContext-&gt;RXactLog,
01304                             RXactContext-&gt;RXactLog-&gt;LogSizeInUse
01305                             );
01306 
01307     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01308         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01309     }
01310 
01311     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a19">NtFlushKey</a>( RXactKey );
01312 
01313     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01314 
01315         <span class="comment">//</span>
01316         <span class="comment">// If this fails, maintain the in-memory data,</span>
01317         <span class="comment">// but get rid of what we just tried to write</span>
01318         <span class="comment">// to disk.</span>
01319         <span class="comment">//</span>
01320         <span class="comment">// Ignore the error, since we're in a funky</span>
01321         <span class="comment">// state right now.</span>
01322         <span class="comment">//</span>
01323 
01324         (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d7/d7/ntapi_8c.html#a16">NtDeleteValueKey</a>( RXactKey, &amp;LogName );
01325 
01326         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01327     }
01328 
01329     <span class="comment">//</span>
01330     <span class="comment">// The log is safe, now execute what is in it</span>
01331     <span class="comment">//</span>
01332 
01333     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d4/rxact_8c.html#a15">RXactpCommit</a>( RXactContext );
01334 
01335     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01336 
01337         <span class="comment">//</span>
01338         <span class="comment">// As above, try to get rid of what's on</span>
01339         <span class="comment">// disk, leave the in-memory stuff alone,</span>
01340         <span class="comment">// so that the caller may try again.</span>
01341         <span class="comment">//</span>
01342 
01343         (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d7/d7/ntapi_8c.html#a16">NtDeleteValueKey</a>( RXactKey, &amp;LogName );
01344 
01345         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01346     }
01347 
01348     <span class="comment">//</span>
01349     <span class="comment">// Delete the log file value and data</span>
01350     <span class="comment">//</span>
01351 
01352     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a16">NtDeleteValueKey</a>( RXactKey, &amp;LogName );
01353 
01354     <span class="comment">//</span>
01355     <span class="comment">// This should never fail</span>
01356     <span class="comment">//</span>
01357 
01358     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ));
01359 
01360     <span class="comment">//</span>
01361     <span class="comment">// Get rid of the in memory data structures.  Abort</span>
01362     <span class="comment">// does exactly what we want to do.</span>
01363     <span class="comment">//</span>
01364 
01365     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d4/rxact_8c.html#a20">RtlAbortRXact</a>( RXactContext );
01366 
01367     <span class="comment">//</span>
01368     <span class="comment">// This should never fail</span>
01369     <span class="comment">//</span>
01370 
01371     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ));
01372 
01373     <span class="keywordflow">return</span>( STATUS_SUCCESS );
01374 
01375 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="rxact.c::RtlApplyRXactNoFlush" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlApplyRXactNoFlush           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRTL_RXACT_CONTEXT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>RXactContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l01380">1380</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00833">RtlAbortRXact()</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l01461">RXactpCommit()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01386                    :
01387 
01388     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to apply <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> changes of a registry sub-tree
01389     Transaction to that registry sub-tree.  This routine should <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be
01390     called <span class="keywordflow">for</span> special hives that <span class="keywordflow">do</span> not have automatic lazy-flushing.
01391     The caller must decide when to flush <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> hive in order to guarantee
01392     a consistent hive.
01393 
01394 Arguments:
01395 
01396     RXactContext - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RXactContext structure <span class="keywordflow">for</span> <span class="keyword">this</span>
01397         subsystem's root registry key.
01398 
01399 Return Value:
01400 
01401     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction was completed.
01402 
01403     STATUS_UNKNOWN_REVISION - Indicates that a transaction state
01404         exists <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified sub-tree, but has a revision level that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01405         unknown by <span class="keyword">this</span> service.
01406 
01407 
01408     STATUS_RXACT_INVALID_STATE - Indicates that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction state
01409         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry sub-tree <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> incompatible with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested operation.
01410         For example, a request to start a <span class="keyword">new</span> transaction <span class="keywordflow">while</span> one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already
01411         in progress, or a request to apply a transaction when one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
01412         currently in progress.  This may also indicate that there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no
01413         transaction state at all <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified registry sub-tree.
01414 
01415 
01416 --*/
01417 {
01418     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01419 
01420     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
01421 
01422     <span class="comment">//</span>
01423     <span class="comment">// Execute the contents of the RXACT log.</span>
01424     <span class="comment">//</span>
01425 
01426     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d4/rxact_8c.html#a15">RXactpCommit</a>( RXactContext );
01427 
01428     <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ) ) {
01429 
01430         <span class="comment">//</span>
01431         <span class="comment">// Get rid of the in memory data structures.  Abort</span>
01432         <span class="comment">// does exactly what we want to do.</span>
01433         <span class="comment">//</span>
01434 
01435         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d4/rxact_8c.html#a20">RtlAbortRXact</a>( RXactContext );
01436 
01437         <span class="comment">//</span>
01438         <span class="comment">// This should never fail</span>
01439         <span class="comment">//</span>
01440 
01441         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ));
01442     }
01443 
01444     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01445 
01446 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="rxact.c::RtlInitializeRXact" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlInitializeRXact           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>RootRegistryKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>CommitIfNecessary</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PRTL_RXACT_CONTEXT *&nbsp;</td>
          <td class="mdname" nowrap> <em>RXactContext</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00341">341</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00166">NtCreateKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00411">NtDeleteKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00504">NtDeleteValueKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02672">NtSetValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00267">_RTLP_RXACT::Revision</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00833">RtlAbortRXact()</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00022">RtlAllocateHeap</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00232">RTLP_RXACT_KEY_NAME</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00234">RTLP_RXACT_LOG_NAME</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00228">RTLP_RXACT_REVISION1</a>, <a class="el" href="../../d2/d6/rtl_2registry_8c-source.html#l00226">RtlpNtQueryValueKey()</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00716">RXactInitializeContext()</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l01461">RXactpCommit()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
<pre class="fragment"><div>00349                    :
00350 
00351     This routine should be called by a server exactly once when <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> starts.
00352     This routine will check to see that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry transaction information
00353     exists <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified registry sub-tree, and will create <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>
00354     doesn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> exist.
00355 
00356 Arguments:
00357 
00358     RootRegistryKey - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry key within whose sub-tree
00359         a transaction <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be initialized.
00360 
00361     CommitIfNecessary - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> BOOLEAN value indicating whether or not any
00362         previously aborted commit discovered should be commited at <span class="keyword">this</span>
00363         time.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> commit should be applied
00364         <span class="keywordflow">if</span> encountered.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> indicates a previously
00365         aborted COMMIT should not be committed at <span class="keyword">this</span> time.
00366 
00367     RXactContext - Returns a pointer to an RTL_RXACT_CONTEXT structure
00368         allocated <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> local heap.  The caller must keep <span class="keyword">this</span>
00369         pointer and pass <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> back in <span class="keywordflow">for</span> all future RXact transactions
00370         <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed RootRegistryKey.
00371 
00372 
00373 Return Value:
00374 
00375     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction state already exists <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00376         registry sub-tree and <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> NO_TRANSACTION state.
00377 
00378     STATUS_UNKNOWN_REVISION - Indicates that a transaction state already
00379         exists <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified sub-tree, but <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a revision level that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00380         unknown by <span class="keyword">this</span> service.
00381 
00382     STATUS_RXACT_STATE_CREATED - This informational level status indicates
00383         that a specified registry sub-tree transaction state did not yet
00384         exist and had to be created.
00385 
00386     STATUS_RXACT_COMMIT_NECESSARY - This warning level status indicates that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00387         transaction state already exists <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry sub-tree, but that
00388         a transaction commit was previously aborted.  The commit has NOT been
00389         completed.  Another call to <span class="keyword">this</span> service with a CommitIfNecessary value
00390         of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> may be used to commit <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction.
00391 
00392 
00393     STATUS_RXACT_INVALID_STATE - Indicates that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction state
00394         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry sub-tree <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> incompatible with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested operation.
00395         For example, a request to start a <span class="keyword">new</span> transaction <span class="keywordflow">while</span> one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already
00396         in progress, or a request to apply a transaction when one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
00397         currently in progress.
00398 
00399 --*/
00400 
00401 {
00402 
00403     HANDLE RXactKey;
00404     LARGE_INTEGER LastWriteTime;
00405     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>, TmpStatus;
00406     OBJECT_ATTRIBUTES RXactAttributes;
00407     PKEY_VALUE_FULL_INFORMATION FullInformation;
00408     <a class="code" href="../../d1/d7/struct__RTLP__RXACT.html">RTLP_RXACT</a> RXactKeyValue;
00409     UCHAR BasicInformation[128];      <span class="comment">// Should be more than long enough</span>
00410     ULONG Disposition;
00411     ULONG KeyValueLength;
00412     ULONG KeyValueType;
00413     ULONG ResultLength;
00414     UNICODE_STRING RXactKeyName;
00415     UNICODE_STRING <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00416     UNICODE_STRING NullName;
00417 
00418     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
00419 
00420     <span class="comment">//</span>
00421     <span class="comment">// Initialize some stuff</span>
00422     <span class="comment">//</span>
00423 
00424     KeyValueLength = (ULONG)<span class="keyword">sizeof</span>( <a class="code" href="../../d1/d7/struct__RTLP__RXACT.html">RTLP_RXACT</a> );
00425     KeyValueType   = 0;         <span class="comment">// Not used by RXact</span>
00426 
00427     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;NullName, NULL );
00428 
00429     <span class="comment">//</span>
00430     <span class="comment">// Create or open the RXACT key.</span>
00431     <span class="comment">//</span>
00432 
00433     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;RXactKeyName, RTLP_RXACT_KEY_NAME);
00434 
00435     InitializeObjectAttributes(
00436         &amp;RXactAttributes,
00437         &amp;RXactKeyName,
00438         OBJ_CASE_INSENSITIVE | OBJ_OPENIF,
00439         RootRegistryKey,
00440         NULL);
00441 
00442 <span class="comment">//    Status = RtlpNtCreateKey(</span>
00443 <span class="comment">//                 &amp;RXactKey,</span>
00444 <span class="comment">//                 (KEY_READ | KEY_WRITE | DELETE),</span>
00445 <span class="comment">//                 &amp;RXactAttributes,</span>
00446 <span class="comment">//                 0,</span>
00447 <span class="comment">//                 NULL,</span>
00448 <span class="comment">//                 &amp;Disposition</span>
00449 <span class="comment">//                 );</span>
00450 
00451     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>( &amp;RXactKey,
00452                           (KEY_READ | KEY_WRITE | DELETE),
00453                           &amp;RXactAttributes,
00454                           0,                          <span class="comment">//TitleIndex</span>
00455                           NULL,                       <span class="comment">//Class OPTIONAL,</span>
00456                           REG_OPTION_NON_VOLATILE,    <span class="comment">//CreateOptions,</span>
00457                           &amp;Disposition
00458                           );
00459 
00460     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
00461         <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00462     }
00463 
00464     <span class="comment">//</span>
00465     <span class="comment">// Allocate the RXactContext block</span>
00466     <span class="comment">//</span>
00467 
00468     *RXactContext = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, <span class="keyword">sizeof</span>( RTL_RXACT_CONTEXT ));
00469 
00470     <span class="keywordflow">if</span> ( *RXactContext == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00471 
00472         <span class="comment">//</span>
00473         <span class="comment">// Something prevented value assignment...</span>
00474         <span class="comment">// Get rid of the RXact key and return the error</span>
00475         <span class="comment">//</span>
00476 
00477         TmpStatus = <a class="code" href="../../d7/d7/ntapi_8c.html#a15">NtDeleteKey</a>( RXactKey );
00478         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus)); <span class="comment">//Safe to ignore, notify security group</span>
00479         TmpStatus = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( RXactKey );
00480         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus)); <span class="comment">//Safe to ignore, notify security group</span>
00481 
00482         <span class="keywordflow">return</span>( STATUS_NO_MEMORY );
00483     }
00484 
00485     <span class="comment">//</span>
00486     <span class="comment">// Initialize the newly created RXactContext structure.</span>
00487     <span class="comment">//</span>
00488 
00489     <a class="code" href="../../d5/d4/rxact_8c.html#a17">RXactInitializeContext</a>( *RXactContext, RootRegistryKey, RXactKey );
00490 
00491     <span class="comment">//</span>
00492     <span class="comment">// If we created (as opposed to opened an existing) rxact key,</span>
00493     <span class="comment">// then we need to initialize it.</span>
00494     <span class="comment">//</span>
00495 
00496     <span class="keywordflow">if</span> ( Disposition == REG_CREATED_NEW_KEY ) {
00497 
00498         RXactKeyValue.<a class="code" href="../../d1/d7/struct__RTLP__RXACT.html#o0">Revision</a>       = <a class="code" href="../../d5/d4/rxact_8c.html#a1">RTLP_RXACT_REVISION1</a>;
00499 
00500         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>( RXactKey,
00501                                 &amp;NullName,       <span class="comment">// ValueName</span>
00502                                 0,               <span class="comment">// TitleIndex</span>
00503                                 KeyValueType,
00504                                 &amp;RXactKeyValue,
00505                                 KeyValueLength
00506                                 );
00507 
00508         <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
00509 
00510             <span class="comment">//</span>
00511             <span class="comment">// Something prevented value assignment...</span>
00512             <span class="comment">// Get rid of the RXact key and return the error</span>
00513             <span class="comment">//</span>
00514 
00515             TmpStatus = <a class="code" href="../../d7/d7/ntapi_8c.html#a15">NtDeleteKey</a>( RXactKey );
00516             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus)); <span class="comment">//Safe to ignore, notify security group</span>
00517             TmpStatus = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( RXactKey );
00518             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus)); <span class="comment">//Safe to ignore, notify security group</span>
00519 
00520             <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *RXactContext );
00521 
00522             <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00523         }
00524 
00525         <span class="keywordflow">return</span>( STATUS_RXACT_STATE_CREATED );
00526     }
00527 
00528 
00529 
00530     <span class="comment">//</span>
00531     <span class="comment">// We have opened an existing RXACT key.</span>
00532     <span class="comment">// See if it is a revision level we know about.</span>
00533     <span class="comment">//</span>
00534 
00535     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d7/rtl_2registry_8c.html#a3">RtlpNtQueryValueKey</a>(
00536                  RXactKey,              <span class="comment">// KeyHandle</span>
00537                  &amp;KeyValueType,         <span class="comment">// KeyValueType</span>
00538                  &amp;RXactKeyValue,        <span class="comment">// KeyValue</span>
00539                  &amp;KeyValueLength,       <span class="comment">// KeyValueLength</span>
00540                  &amp;LastWriteTime         <span class="comment">// LastWriteTime</span>
00541                  );
00542 
00543 
00544     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
00545 
00546         <span class="comment">//</span>
00547         <span class="comment">// Something prevented value query...</span>
00548         <span class="comment">//</span>
00549 
00550         TmpStatus = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( RXactKey );
00551         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus)); <span class="comment">//Safe to ignore, notify security group</span>
00552         <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *RXactContext );
00553         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00554     }
00555 
00556 
00557     <span class="keywordflow">if</span> ( KeyValueLength != (ULONG)<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d7/struct__RTLP__RXACT.html">RTLP_RXACT</a>) ) {
00558         TmpStatus = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( RXactKey );
00559         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus)); <span class="comment">//Safe to ignore, notify security group</span>
00560         <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *RXactContext );
00561         <span class="keywordflow">return</span>( STATUS_UNKNOWN_REVISION );
00562     }
00563 
00564     <span class="keywordflow">if</span> (RXactKeyValue.<a class="code" href="../../d1/d7/struct__RTLP__RXACT.html#o0">Revision</a> != <a class="code" href="../../d5/d4/rxact_8c.html#a1">RTLP_RXACT_REVISION1</a>) {
00565         TmpStatus = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( RXactKey );
00566         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus)); <span class="comment">//Safe to ignore, notify security group</span>
00567         <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *RXactContext );
00568         <span class="keywordflow">return</span>( STATUS_UNKNOWN_REVISION );
00569     }
00570 
00571 
00572 
00573     <span class="comment">//</span>
00574     <span class="comment">// Right revision...</span>
00575     <span class="comment">// See if there is a transaction or commit in progress.  If not,</span>
00576     <span class="comment">// return success</span>
00577     <span class="comment">//</span>
00578 
00579     <span class="comment">//</span>
00580     <span class="comment">// If a log file exists, then we are committing.</span>
00581     <span class="comment">//</span>
00582 
00583     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;ValueName, RTLP_RXACT_LOG_NAME );
00584 
00585     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00586                  RXactKey,
00587                  &amp;ValueName,
00588                  KeyValueBasicInformation,
00589                  &amp;BasicInformation,
00590                  128,
00591                  &amp;ResultLength
00592                  );
00593 
00594     <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00595 
00596         <span class="comment">//</span>
00597         <span class="comment">// We found a value called 'Log'.  This means that a commit</span>
00598         <span class="comment">// was in progress.</span>
00599         <span class="comment">//</span>
00600 
00601         <span class="keywordflow">if</span> ( CommitIfNecessary ) {
00602 
00603             <span class="comment">//</span>
00604             <span class="comment">// Query the full value of the log, then call a low level routine</span>
00605             <span class="comment">// to actually perform the commit.</span>
00606             <span class="comment">//</span>
00607 
00608             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00609                          RXactKey,
00610                          &amp;ValueName,
00611                          KeyValueFullInformation,
00612                          NULL,
00613                          0,
00614                          &amp;ResultLength
00615                          );
00616 
00617             <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_BUFFER_TOO_SMALL ) {
00618                 <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00619             }
00620 
00621             FullInformation = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, ResultLength );
00622 
00623             <span class="keywordflow">if</span> ( FullInformation == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00624                 <span class="keywordflow">return</span>( STATUS_NO_MEMORY );
00625             }
00626 
00627 
00628             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00629                          RXactKey,
00630                          &amp;ValueName,
00631                          KeyValueFullInformation,
00632                          FullInformation,
00633                          ResultLength,
00634                          &amp;ResultLength
00635                          );
00636 
00637             <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00638 
00639                 <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, FullInformation );
00640                 <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *RXactContext );
00641                 <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00642             }
00643 
00644             <span class="comment">//</span>
00645             <span class="comment">// The log information is buried in the returned FullInformation</span>
00646             <span class="comment">// buffer.  Dig it out and make the RXactLog in the RXactContext</span>
00647             <span class="comment">// structure point to it.  Then commit.</span>
00648             <span class="comment">//</span>
00649 
00650             (*RXactContext)-&gt;RXactLog = (PRTL_RXACT_LOG)((PCHAR)FullInformation + FullInformation-&gt;DataOffset);
00651 
00652             <span class="comment">//</span>
00653             <span class="comment">// Don't use any handles we may find in the log file</span>
00654             <span class="comment">//</span>
00655 
00656             (*RXactContext)-&gt;HandlesValid = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00657 
00658             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d4/rxact_8c.html#a15">RXactpCommit</a>( *RXactContext );
00659 
00660             <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00661 
00662                 <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, FullInformation );
00663                 <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>( RtlProcessHeap(), 0, *RXactContext );
00664                 <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00665             }
00666 
00667 
00668             <span class="comment">//</span>
00669             <span class="comment">// The commit was successful.  Clean up.</span>
00670             <span class="comment">// Delete the log file value and data</span>
00671             <span class="comment">//</span>
00672 
00673             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a16">NtDeleteValueKey</a>( RXactKey, &amp;ValueName );
00674 
00675             <span class="comment">//</span>
00676             <span class="comment">// This should never fail</span>
00677             <span class="comment">//</span>
00678 
00679             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ));
00680 
00681             <span class="comment">//</span>
00682             <span class="comment">// Get rid of the in memory data structures.  Abort</span>
00683             <span class="comment">// will free the RXactLog, so put what we want</span>
00684             <span class="comment">// freed in there and it will go away.</span>
00685             <span class="comment">//</span>
00686 
00687             (*RXactContext)-&gt;RXactLog = (PRTL_RXACT_LOG)FullInformation;
00688 
00689             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d4/rxact_8c.html#a20">RtlAbortRXact</a>( *RXactContext );
00690 
00691             <span class="comment">//</span>
00692             <span class="comment">// This should never fail</span>
00693             <span class="comment">//</span>
00694 
00695             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ));
00696             <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00697         } <span class="keywordflow">else</span> {
00698 
00699             <span class="keywordflow">return</span>( STATUS_RXACT_COMMIT_NECESSARY );
00700         }
00701 
00702     } <span class="keywordflow">else</span> {
00703 
00704         <span class="comment">//</span>
00705         <span class="comment">// No log, so nothing to do here.</span>
00706         <span class="comment">//</span>
00707 
00708         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00709     }
00710 
00711 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="rxact.c::RtlStartRXact" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RtlStartRXact           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRTL_RXACT_CONTEXT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>RXactContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00760">760</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00246">RTL_PAGED_CODE</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00022">RtlAllocateHeap</a>, and <a class="el" href="../../d6/d3/rxact_8c-source.html#l00236">RTLP_INITIAL_LOG_SIZE</a>.
<p>
<pre class="fragment"><div>00766                    :
00767 
00768     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to start a <span class="keyword">new</span> transaction in a registry sub-tree.
00769     Transactions must be serialized by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> server so that <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> one transaction
00770     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> in progress at a time.
00771 
00772 Arguments:
00773 
00774     RXactContext - Supplies a pointer to an RTL_RXACT_CONTEXT structure
00775         that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not currently in use.
00776 
00777 Return Value:
00778 
00779     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction was started.
00780 
00781     STATUS_RXACT_INVALID_STATE - Indicates that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction state
00782         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry sub-tree <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> incompatible with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested operation.
00783         For example, a request to start a <span class="keyword">new</span> transaction <span class="keywordflow">while</span> one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already
00784         in progress, or a request to apply a transaction when one <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not
00785         currently in progress.  This may also indicate that there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no
00786         transaction state at all <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified registry sub-tree.
00787 
00788 --*/
00789 {
00790     PRTL_RXACT_LOG RXactLogHeader;
00791 
00792     <a class="code" href="../../d5/d9/ntrtlp_8h.html#a12">RTL_PAGED_CODE</a>();
00793 
00794     <span class="comment">//</span>
00795     <span class="comment">// Allocate in-memory log file and initialize.  This implicitly</span>
00796     <span class="comment">// sets the state to 'transaction in progress'.</span>
00797     <span class="comment">//</span>
00798 
00799     <span class="keywordflow">if</span> ( RXactContext-&gt;RXactLog != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00800 
00801         <span class="comment">//</span>
00802         <span class="comment">// There is already a transaction in progress for this</span>
00803         <span class="comment">// context.  Return an error.</span>
00804         <span class="comment">//</span>
00805 
00806         <span class="keywordflow">return</span>( STATUS_RXACT_INVALID_STATE );
00807     }
00808 
00809     RXactLogHeader = <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>( RtlProcessHeap(), 0, RTLP_INITIAL_LOG_SIZE );
00810 
00811     <span class="keywordflow">if</span> ( RXactLogHeader == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00812         <span class="keywordflow">return</span>( STATUS_NO_MEMORY );
00813     }
00814 
00815     <span class="comment">//</span>
00816     <span class="comment">// Fill in the log header information at the top of the</span>
00817     <span class="comment">// newly allocated buffer.</span>
00818     <span class="comment">//</span>
00819 
00820 
00821     RXactLogHeader-&gt;OperationCount = 0;
00822     RXactLogHeader-&gt;LogSize        = <a class="code" href="../../d5/d4/rxact_8c.html#a5">RTLP_INITIAL_LOG_SIZE</a>;
00823     RXactLogHeader-&gt;LogSizeInUse   = <span class="keyword">sizeof</span>( RTL_RXACT_LOG );
00824 
00825     RXactContext-&gt;RXactLog = RXactLogHeader;
00826 
00827     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00828 
00829 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="rxact.c::RXactInitializeContext" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RXactInitializeContext           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRTL_RXACT_CONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>RXactContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>RootRegistryKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>RXactKey</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l00716">716</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/rxact_8c-source.html#l00833">RtlAbortRXact()</a>, and <a class="el" href="../../d6/d3/rxact_8c-source.html#l00341">RtlInitializeRXact()</a>.
<p>
<pre class="fragment"><div>00724                    :
00725 
00726     Initializes an in-memory RXactContext structure.
00727 
00728 Arguments:
00729 
00730     RXactContext - Supplies a pointer to an RXact Context created
00731         by <a class="code" href="../../d5/d4/rxact_8c.html#a18">RtlInitializeRXact</a>.
00732 
00733     RootRegistryKey - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RootRegistryKey <span class="keywordflow">for</span> <span class="keyword">this</span> component.
00734 
00735     RXactKey - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> {RootRegistryKey}\RXactKey <span class="keywordflow">for</span> <span class="keyword">this</span> component
00736 
00737 
00738 Return Value:
00739 
00740     None.
00741 
00742 --*/
00743 
00744 {
00745     <span class="comment">//</span>
00746     <span class="comment">// Initialize the RXactContext for this client</span>
00747     <span class="comment">//</span>
00748 
00749     RXactContext-&gt;RootRegistryKey      = RootRegistryKey;
00750     RXactContext-&gt;HandlesValid         = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00751     RXactContext-&gt;RXactLog             = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00752     RXactContext-&gt;RXactKey             = RXactKey;
00753 
00754     <span class="keywordflow">return</span>;
00755 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="rxact.c::RXactpCommit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RXactpCommit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRTL_RXACT_CONTEXT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>RXactContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l01461">1461</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00277">_RXACT_LOG_ENTRY::AttributeName</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00212">INVALID_HANDLE_VALUE</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00278">_RXACT_LOG_ENTRY::KeyHandle</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00274">_RXACT_LOG_ENTRY::LogEntrySize</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00281">_RXACT_LOG_ENTRY::NewKeyValue</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00280">_RXACT_LOG_ENTRY::NewKeyValueLength</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00279">_RXACT_LOG_ENTRY::NewKeyValueType</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00411">NtDeleteKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02672">NtSetValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00275">_RXACT_LOG_ENTRY::Operation</a>, <a class="el" href="../../d5/d4/rxact_8c.html#a12">PRXACT_LOG_ENTRY</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l01717">RXactpOpenTargetKey()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00276">_RXACT_LOG_ENTRY::SubKeyName</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/rxact_8c-source.html#l01240">RtlApplyRXact()</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l01380">RtlApplyRXactNoFlush()</a>, and <a class="el" href="../../d6/d3/rxact_8c-source.html#l00341">RtlInitializeRXact()</a>.
<p>
<pre class="fragment"><div>01467                    :
01468 
01469     This routine commits <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operations in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation log.
01470 
01471     When all changes have been applied, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction state
01472     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> changed to NO_TRANSACTION.
01473 
01474 Arguments:
01475 
01476     RXactContext - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> RXactContext structure <span class="keywordflow">for</span> <span class="keyword">this</span>
01477         subsystem's root registry key.
01478 
01479 Return Value:
01480 
01481     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> transaction was completed.
01482 
01483 
01484 
01485 --*/
01486 {
01487     BOOLEAN HandlesValid;
01488 
01489     HANDLE TargetKey;
01490     HANDLE RXactKey;
01491     HANDLE RootRegistryKey;
01492 
01493     PRTL_RXACT_LOG      RXactLog;
01494     <a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html">PRXACT_LOG_ENTRY</a>    RXactLogEntry;
01495     RTL_RXACT_OPERATION Operation;
01496 
01497     ULONG OperationCount;
01498     ULONG i;
01499 
01500     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01501     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> TmpStatus = STATUS_SUCCESS;
01502     BOOLEAN CloseTargetKey;
01503 
01504     <span class="comment">//</span>
01505     <span class="comment">// Extract information from the RXactContext to simplify</span>
01506     <span class="comment">// the code that follows</span>
01507     <span class="comment">//</span>
01508 
01509     RootRegistryKey = RXactContext-&gt;RootRegistryKey;
01510     RXactKey        = RXactContext-&gt;RXactKey;
01511     RXactLog        = RXactContext-&gt;RXactLog;
01512 
01513     OperationCount  = RXactLog-&gt;OperationCount;
01514 
01515     HandlesValid    = RXactContext-&gt;HandlesValid;
01516 
01517 
01518     <span class="comment">//</span>
01519     <span class="comment">// Keep a pointer to the beginning of the current log entry.</span>
01520     <span class="comment">//</span>
01521 
01522     RXactLogEntry = (<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html">PRXACT_LOG_ENTRY</a>)((PCHAR)RXactLog + <span class="keyword">sizeof</span>( RTL_RXACT_LOG ));
01523 
01524 
01525     <span class="comment">//</span>
01526     <span class="comment">// Go through and perform each operation log.  Notice that some operation</span>
01527     <span class="comment">// logs may already have been deleted by a previous commit attempt.</span>
01528     <span class="comment">// So, don't get alarmed if we don't successfully open some operation</span>
01529     <span class="comment">// log entry keys.</span>
01530     <span class="comment">//</span>
01531 
01532     <span class="keywordflow">for</span> ( i=0 ; i&lt;OperationCount ; i++ ) {
01533 
01534         <span class="comment">//</span>
01535         <span class="comment">// Turn the self-relative offsets in the structure</span>
01536         <span class="comment">// back into real pointers.</span>
01537         <span class="comment">//</span>
01538 
01539         RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o2">SubKeyName</a>.Buffer = (PWSTR) ((PCHAR)RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o2">SubKeyName</a>.Buffer +
01540                                                     (ULONG_PTR)RXactLog);
01541 
01542         RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o3">AttributeName</a>.Buffer = (PWSTR) ((PCHAR)RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o3">AttributeName</a>.Buffer +
01543                                                        (ULONG_PTR)RXactLog);
01544 
01545         RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o7">NewKeyValue</a> = (PVOID)((PCHAR)RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o7">NewKeyValue</a> + (ULONG_PTR)RXactLog);
01546 
01547         Operation = RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o1">Operation</a>;
01548 
01549         <span class="comment">//</span>
01550         <span class="comment">// Perform this operation</span>
01551         <span class="comment">//</span>
01552 
01553         <span class="keywordflow">switch</span> (Operation) {
01554             <span class="keywordflow">case</span> RtlRXactOperationDelete:
01555 
01556                 <span class="comment">//</span>
01557                 <span class="comment">// Open the target key and delete it.</span>
01558                 <span class="comment">// The name is relative to the RootRegistryKey.</span>
01559                 <span class="comment">//</span>
01560 
01561                 <span class="keywordflow">if</span> ( ((RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o4">KeyHandle</a> == <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>) || !HandlesValid) ) {
01562 
01563                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d4/rxact_8c.html#a16">RXactpOpenTargetKey</a>(
01564                                  RootRegistryKey,
01565                                  RtlRXactOperationDelete,
01566                                  &amp;RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o2">SubKeyName</a>,
01567                                  &amp;TargetKey
01568                                  );
01569 
01570                     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01571 
01572                         <span class="comment">//</span>
01573                         <span class="comment">// We must allow the object not to be found,</span>
01574                         <span class="comment">// because we may be replaying this log after</span>
01575                         <span class="comment">// it had been partially executed.</span>
01576                         <span class="comment">//</span>
01577 
01578                         <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_OBJECT_NAME_NOT_FOUND ) {
01579 
01580                             <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01581 
01582                         } <span class="keywordflow">else</span> {
01583 
01584                             <span class="keywordflow">break</span>;
01585                         }
01586                     }
01587 
01588                     CloseTargetKey = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01589 
01590                 } <span class="keywordflow">else</span> {
01591 
01592                     TargetKey = RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o4">KeyHandle</a>;
01593                     CloseTargetKey = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01594                 }
01595 
01596 
01597                 <span class="comment">//</span>
01598                 <span class="comment">// If this fails, then it is an error</span>
01599                 <span class="comment">// because the key should exist at</span>
01600                 <span class="comment">// this point.</span>
01601                 <span class="comment">//</span>
01602 
01603                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a15">NtDeleteKey</a>( TargetKey );
01604 
01605 
01606                 <span class="comment">//</span>
01607                 <span class="comment">// Only close the target key if we opened it</span>
01608                 <span class="comment">//</span>
01609 
01610                 <span class="keywordflow">if</span> ( CloseTargetKey ) {
01611 
01612                     TmpStatus = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( TargetKey );
01613 
01614                     <span class="comment">//</span>
01615                     <span class="comment">// If we opened this handle, then we should</span>
01616                     <span class="comment">// be able to close it, whether it has been</span>
01617                     <span class="comment">// deleted or not.</span>
01618                     <span class="comment">//</span>
01619 
01620                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus));        <span class="comment">// safe to ignore, but curious...</span>
01621                 }
01622 
01623 
01624                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01625                     <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01626                 }
01627 
01628                 <span class="keywordflow">break</span>;
01629 
01630             <span class="keywordflow">case</span> RtlRXactOperationSetValue:
01631 
01632                 <span class="comment">//</span>
01633                 <span class="comment">// Open the target key.</span>
01634                 <span class="comment">// The name is relative to the RootRegistryKey.</span>
01635                 <span class="comment">//</span>
01636 
01637                 <span class="keywordflow">if</span> ( ((RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o4">KeyHandle</a> == <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>) || !HandlesValid) ) {
01638 
01639                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d5/d4/rxact_8c.html#a16">RXactpOpenTargetKey</a>(
01640                                  RootRegistryKey,
01641                                  RtlRXactOperationSetValue,
01642                                  &amp;RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o2">SubKeyName</a>,
01643                                  &amp;TargetKey
01644                                  );
01645 
01646                     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
01647                         <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01648                     }
01649 
01650                     CloseTargetKey = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01651 
01652                 } <span class="keywordflow">else</span> {
01653 
01654                     TargetKey = RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o4">KeyHandle</a>;
01655                     CloseTargetKey = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01656                 }
01657 
01658                 <span class="comment">//</span>
01659                 <span class="comment">// Assign to the target key's new value</span>
01660                 <span class="comment">//</span>
01661 
01662                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>( TargetKey,
01663                                         &amp;RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o3">AttributeName</a>,
01664                                         0,               <span class="comment">// TitleIndex</span>
01665                                         RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o5">NewKeyValueType</a>,
01666                                         RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o7">NewKeyValue</a>,
01667                                         RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o6">NewKeyValueLength</a>
01668                                         );
01669 
01670                 <span class="comment">//</span>
01671                 <span class="comment">// Only close the target key if we opened it</span>
01672                 <span class="comment">//</span>
01673 
01674                 <span class="keywordflow">if</span> ( CloseTargetKey ) {
01675 
01676                     TmpStatus = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( TargetKey );
01677                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus));        <span class="comment">// safe to ignore, but curious...</span>
01678 
01679                 }
01680 
01681                 <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
01682                     <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
01683                 }
01684 
01685                 <span class="keywordflow">break</span>;
01686 
01687 
01688 
01689             <span class="keywordflow">default</span>:
01690 
01691                 <span class="comment">//</span>
01692                 <span class="comment">// Unknown operation type.  This should never happen.</span>
01693                 <span class="comment">//</span>
01694 
01695                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( FALSE );
01696 
01697                 <span class="keywordflow">return</span>(STATUS_INVALID_PARAMETER);
01698 
01699         }
01700 
01701         RXactLogEntry = (<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html">PRXACT_LOG_ENTRY</a>)((PCHAR)RXactLogEntry + RXactLogEntry-&gt;<a class="code" href="../../d7/d7/struct__RXACT__LOG__ENTRY.html#o0">LogEntrySize</a>);
01702 
01703     }
01704 
01705     <span class="comment">//</span>
01706     <span class="comment">// Commit complete</span>
01707     <span class="comment">//</span>
01708 
01709     <span class="keywordflow">return</span>( STATUS_SUCCESS );
01710 
01711 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="rxact.c::RXactpOpenTargetKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RXactpOpenTargetKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>RootRegistryKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN RTL_RXACT_OPERATION&nbsp;</td>
          <td class="mdname" nowrap> <em>Operation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>SubKeyName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetKey</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d3/rxact_8c-source.html#l01717">1717</a> of file <a class="el" href="../../d6/d3/rxact_8c-source.html">rxact.c</a>.
<p>
References <a class="el" href="../../d8/d6/ntapi_8c-source.html#l00166">NtCreateKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/rxact_8c-source.html#l01461">RXactpCommit()</a>.
<p>
<pre class="fragment"><div>01726                    :
01727 
01728     This routine opens <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target registry key of an operation.
01729 
01730 Arguments:
01731 
01732     RootRegistryKey - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry key within whose sub-tree
01733         a transaction <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be initialized.
01734 
01735     Operation - Indicates what operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be performed on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target.
01736         This will effect how <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> opened.
01737 
01738     OperationNameKey - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation log sub-key
01739         containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target registry key.
01740 
01741     TargetKey - Receives a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target registry key.
01742 
01743 Return Value:
01744 
01745     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation log entry was opened.
01746 
01747     STATUS_NO_MEMORY - Ran <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of heap.
01748 
01749 
01750 --*/
01751 {
01752 
01753     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01754     OBJECT_ATTRIBUTES TargetKeyAttributes;
01755     ACCESS_MASK DesiredAccess;
01756     ULONG Disposition;
01757 
01758 
01759     <span class="keywordflow">if</span> (Operation == RtlRXactOperationDelete) {
01760 
01761         DesiredAccess = DELETE;
01762 
01763         InitializeObjectAttributes(
01764             &amp;TargetKeyAttributes,
01765             SubKeyName,
01766             OBJ_CASE_INSENSITIVE,
01767             RootRegistryKey,
01768             NULL);
01769 
01770 <span class="comment">//        Status = RtlpNtOpenKey(</span>
01771 <span class="comment">//                     TargetKey,</span>
01772 <span class="comment">//                     DesiredAccess,</span>
01773 <span class="comment">//                     &amp;TargetKeyAttributes,</span>
01774 <span class="comment">//                     0);</span>
01775 
01776         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>( TargetKey,
01777                             DesiredAccess,
01778                             &amp;TargetKeyAttributes
01779                             );
01780 
01781 
01782     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Operation == RtlRXactOperationSetValue) {
01783 
01784         DesiredAccess = KEY_WRITE;
01785 
01786         InitializeObjectAttributes(
01787             &amp;TargetKeyAttributes,
01788             SubKeyName,
01789             OBJ_CASE_INSENSITIVE | OBJ_OPENIF,
01790             RootRegistryKey,
01791             NULL);
01792 
01793         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(
01794                      TargetKey,
01795                      DesiredAccess,
01796                      &amp;TargetKeyAttributes,
01797                      0,
01798                      NULL,
01799                      REG_OPTION_NON_VOLATILE,
01800                      &amp;Disposition
01801                      );
01802 
01803     } <span class="keywordflow">else</span> {
01804         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01805     }
01806 
01807 
01808 
01809     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
01810 
01811 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:32 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
