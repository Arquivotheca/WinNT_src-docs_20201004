<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mnsys.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>mnsys.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d6/d2/mnsys_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a0">_SetCloseDefault</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pSubMenu)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a1">FindFakeMDIChild</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a2">xxxLoadSysDesktopMenu</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> *ppmenu, UINT uMenuId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a3">LockDesktopMenu</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> *ppmenu, <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenu)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a4">UnlockDesktopMenu</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> *ppmenu)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a5">xxxGetSysMenuHandle</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a6">xxxGetSysMenu</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, BOOL fSubMenu)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a7">IsSmallerThanScreen</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a8">xxxSetSysMenu</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a9">xxxGetSystemMenu</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, BOOL fRevert)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a10">MenuItemState</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu, UINT wCmd, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> wFlags, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> wMask, <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> *ppMenu)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a11">xxxEnableMenuItem</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu, UINT wIDEnableItem, UINT wEnable)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a12">_CheckMenuItem</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu, UINT wIDCheckItem, UINT wCheck)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a13">_SetMenuDefaultItem</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu, UINT wID, BOOL fByPosition)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/mnsys_8c.html#a14">SetupFakeMDIAppStuff</a> (<a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> lpMenu, <a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a> lpItem)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a12" doxytag="mnsys.c::_CheckMenuItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> _CheckMenuItem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wIDCheckItem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wCheck</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00546">546</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00455">MenuItemState()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l03893">NtUserCheckMenuItem()</a>.
<p>
<pre class="fragment"><div>00550 {
00551     <span class="keywordflow">return</span> <a class="code" href="../../d5/d3/mnsys_8c.html#a10">MenuItemState</a>(pMenu, wIDCheckItem, wCheck, (UINT)MF_CHECKED, NULL);
00552 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="mnsys.c::_SetCloseDefault" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void _SetCloseDefault           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pSubMenu</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00654">654</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00567">_SetMenuDefaultItem()</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00724">SetupFakeMDIAppStuff()</a>, and <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00232">xxxSetSysMenu()</a>.
<p>
<pre class="fragment"><div>00655 {
00656     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1599">_SetMenuDefaultItem</a>(pSubMenu, SC_CLOSE, MF_BYCOMMAND))
00657     {
00658         <span class="comment">//</span>
00659         <span class="comment">// Bloody hell.  Let's try a couple other values.</span>
00660         <span class="comment">//      * Project   --  0x7000 less</span>
00661         <span class="comment">//      * FoxPro    --  0xC070</span>
00662         <span class="comment">//</span>
00663         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1599">_SetMenuDefaultItem</a>(pSubMenu, SC_CLOSE - 0x7000, MF_BYCOMMAND))
00664             <a class="code" href="../../d4/d1/userk_8h.html#a1599">_SetMenuDefaultItem</a>(pSubMenu, 0xC070, MF_BYCOMMAND);
00665     }
00666 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="mnsys.c::_SetMenuDefaultItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _SetMenuDefaultItem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fByPosition</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00567">567</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02791">tagMENU::cItems</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02780">ClearMFS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02763">MFMWFP_NOITEM</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00486">MNLookUpItem()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02797">tagMENU::rgItems</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02778">SetMFS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02783">TestMFT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02758">tagITEM::ulWidth</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02757">tagITEM::ulX</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l05295">UNDERLINE_RECALC</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00654">_SetCloseDefault()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04759">NtUserSetMenuDefaultItem()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>, and <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00232">xxxSetSysMenu()</a>.
<p>
<pre class="fragment"><div>00568 {
00569     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  iItem;
00570     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  cItems;
00571     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem;
00572     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItemFound;
00573     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>   pMenuFound;
00574 
00575     <span class="comment">//</span>
00576     <span class="comment">// We need to check if wId actually exists on this menu.  0xFFFF means</span>
00577     <span class="comment">// clear all default items.</span>
00578     <span class="comment">//</span>
00579 
00580     <span class="keywordflow">if</span> (wID != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>)
00581     {
00582         pItemFound = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a10">MNLookUpItem</a>(pMenu, wID, fByPosition, &amp;pMenuFound);
00583 
00584         <span class="comment">// item must be on same menu and can't be a separator</span>
00585         <span class="keywordflow">if</span> ((pItemFound == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (pMenuFound != pMenu) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a791">TestMFT</a>(pItemFound, MFT_SEPARATOR))
00586             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00587 
00588     }
00589     <span class="keywordflow">else</span>
00590         pItemFound = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00591 
00592     pItem = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>;
00593     cItems = pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>;
00594 
00595     <span class="comment">// Walk the menu list, clearing MFS_DEFAULT from all other items, and</span>
00596     <span class="comment">// setting MFS_DEFAULT on the requested one.</span>
00597     <span class="keywordflow">for</span> (iItem = 0; iItem &lt; cItems; iItem++, pItem++) {
00598         <span class="comment">//</span>
00599         <span class="comment">// Note we don't change the state of lpItemFound if it exists.  This</span>
00600         <span class="comment">// is so that below, where we try to set the default, we can tell</span>
00601         <span class="comment">// if we need to recalculate the underline.</span>
00602         <span class="comment">//</span>
00603 
00604         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_DEFAULT) &amp;&amp; (pItem != pItemFound))
00605         {
00606             <span class="comment">//</span>
00607             <span class="comment">// We are changing the default item.  As such, it will be drawn</span>
00608             <span class="comment">// with a different font than the one used to calculate it, if</span>
00609             <span class="comment">// the menu has already been drawn once.  We need to ensure</span>
00610             <span class="comment">// that the underline gets drawn in the right place the next</span>
00611             <span class="comment">// time the menu comes up.  Cause it to recalculate.</span>
00612             <span class="comment">//</span>
00613             <span class="comment">// We do NOT do this if the item</span>
00614             <span class="comment">//      (a) isn't default--otherwise we'll recalculate the</span>
00615             <span class="comment">//  underline for every system menu item every time we go into</span>
00616             <span class="comment">//  menu mode because sysmenu init will call SetMenuDefaultItem.</span>
00617             <span class="comment">//      (b) isn't the item we're going to set as the default.</span>
00618             <span class="comment">//  That way we don't recalculate the underline when the item</span>
00619             <span class="comment">//  isn't changing state.</span>
00620             <span class="comment">//</span>
00621             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a789">ClearMFS</a>(pItem, MFS_DEFAULT);
00622             pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o14">ulX</a> = <a class="code" href="../../d4/d1/userk_8h.html#a570">UNDERLINE_RECALC</a>;
00623             pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o15">ulWidth</a> = 0;
00624         }
00625     }
00626 
00627     <span class="keywordflow">if</span> (wID != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a778">MFMWFP_NOITEM</a>)
00628     {
00629         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItemFound, MFS_DEFAULT))
00630         {
00631             <span class="comment">//</span>
00632             <span class="comment">// We are changing from non-default to default.  Clear out</span>
00633             <span class="comment">// the underline info.  If the menu has never painted, this</span>
00634             <span class="comment">// won't do anything.  But it matters a lot if it has.</span>
00635             <span class="comment">//</span>
00636             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a787">SetMFS</a>(pItemFound, MFS_DEFAULT);
00637             pItemFound-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o14">ulX</a> = <a class="code" href="../../d4/d1/userk_8h.html#a570">UNDERLINE_RECALC</a>;
00638             pItemFound-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o15">ulWidth</a> = 0;
00639         }
00640     }
00641 
00642     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00643 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="mnsys.c::FindFakeMDIChild" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> FindFakeMDIChild           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwndParent</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00678">678</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01763">tagWND::spmenuSys</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01746">tagWND::spwndChild</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01744">tagWND::spwndNext</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02421">WFCHILD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02415">WFMAXIMIZED</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00724">SetupFakeMDIAppStuff()</a>.
<p>
<pre class="fragment"><div>00679 {
00680     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwndReturn;
00681 
00682     <span class="comment">// Skip invisible windows and their descendants</span>
00683     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE))
00684         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00685 
00686     <span class="comment">// Did we hit pay dirt?</span>
00687     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCHILD) &amp;&amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXIMIZED) || (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>)))
00688         <span class="keywordflow">return</span>(pwnd);
00689 
00690     <span class="comment">// Check our children</span>
00691     <span class="keywordflow">for</span> (pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>; pwnd; pwnd = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>)
00692     {
00693         pwndReturn = <a class="code" href="../../d5/d3/mnsys_8c.html#a1">FindFakeMDIChild</a>(pwnd);
00694         <span class="keywordflow">if</span> (pwndReturn)
00695             <span class="keywordflow">return</span>(pwndReturn);
00696     }
00697 
00698     <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00699 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="mnsys.c::IsSmallerThanScreen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL IsSmallerThanScreen           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00208">208</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d0/d1/mmrtl_8c-source.html#l00426">_MonitorFromWindow()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02158">tagMONITOR::rcWork</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00232">xxxSetSysMenu()</a>, and <a class="el" href="../../d3/d7/swp_8c-source.html#l01955">zzzChangeStates()</a>.
<p>
<pre class="fragment"><div>00209 {
00210     <span class="keywordtype">int</span> dxMax, dyMax;
00211     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> pMonitor;
00212 
00213     pMonitor = <a class="code" href="../../d9/d1/mmrtl_8c.html#a8">_MonitorFromWindow</a>(pwnd, MONITOR_DEFAULTTOPRIMARY);
00214     dxMax = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.right - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.left;
00215     dyMax = pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.bottom - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.top;
00216 
00217     <span class="keywordflow">if</span> ((pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left &lt; dxMax) ||
00218             (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top &lt; dyMax)) {
00219         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00220     }
00221     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00222 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="mnsys.c::LockDesktopMenu" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID LockDesktopMenu           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppmenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pmenu</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00074">74</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02791">tagMENU::cItems</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01191">HMChangeOwnerProcess</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00649">MFDESKTOP</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02797">tagMENU::rgItems</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02774">SetMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02606">tagITEM::spSubMenu</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/sbctl_8c-source.html#l02444">xxxGetScrollMenu()</a>, and <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00030">xxxLoadSysDesktopMenu()</a>.
<p>
<pre class="fragment"><div>00075 {
00076     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pSubMenu;
00077     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiDesktop;
00078     <span class="comment">/*</span>
00079 <span class="comment">     * We only load desktop sys menus once.</span>
00080 <span class="comment">     */</span>
00081     UserAssert(*ppmenu == NULL);
00082 
00083     <span class="keywordflow">if</span> (pmenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00084         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00085     }
00086 
00087     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a784">SetMF</a>(pmenu, MFDESKTOP);
00088     <span class="comment">/*</span>
00089 <span class="comment">     * This is awful but this is the real owner of this object. We used to set it</span>
00090 <span class="comment">     *  to NULL but that was forcing us to handle the NULL owner all over the place</span>
00091 <span class="comment">     */</span>
00092     ptiDesktop = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;rpdesk-&gt;rpwinstaParent-&gt;pTerm-&gt;ptiDesktop;
00093     <a class="code" href="../../d4/d1/userk_8h.html#a111">HMChangeOwnerProcess</a>(pmenu, ptiDesktop);
00094 
00095     pSubMenu = pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a>;
00096     UserAssert(pSubMenu != NULL);
00097 
00098     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a784">SetMF</a>(pSubMenu, MFDESKTOP);
00099     <a class="code" href="../../d4/d1/userk_8h.html#a111">HMChangeOwnerProcess</a>(pSubMenu, ptiDesktop);
00100 
00101 <span class="preprocessor">#if DBG</span>
00102 <span class="preprocessor"></span>    {
00103         <span class="comment">/*</span>
00104 <span class="comment">         * Assert that there are no other submenus that would need to be</span>
00105 <span class="comment">         *  marked as MFDESKTOP.</span>
00106 <span class="comment">         */</span>
00107         <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pitem;
00108         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uItems;
00109 
00110         UserAssert(pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a> == 1);
00111 
00112         pitem = pSubMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o9">rgItems</a>;
00113         uItems = pSubMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>;
00114         <span class="keywordflow">while</span> (uItems--) {
00115             UserAssert(pitem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a> == NULL);
00116             pitem++;
00117         }
00118     }
00119 <span class="preprocessor">#endif</span>
00120 <span class="preprocessor"></span>
00121     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(ppmenu, pmenu);
00122 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="mnsys.c::MenuItemState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> MenuItemState           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wCmd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>wFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>wMask</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppMenu</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00455">455</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02744">tagITEM::fState</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00486">MNLookUpItem()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00546">_CheckMenuItem()</a>, and <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00494">xxxEnableMenuItem()</a>.
<p>
<pre class="fragment"><div>00461 {
00462     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem;
00463     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> wRet;
00464 
00465     <span class="comment">/*</span>
00466 <span class="comment">     * Get a pointer the the menu item</span>
00467 <span class="comment">     */</span>
00468     <span class="keywordflow">if</span> ((pItem = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a10">MNLookUpItem</a>(pMenu, wCmd, (BOOL) (wFlags &amp; MF_BYPOSITION), ppMenu)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00469         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)-1;
00470 
00471     <span class="comment">/*</span>
00472 <span class="comment">     * Return previous state</span>
00473 <span class="comment">     */</span>
00474     wRet = pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> &amp; wMask;
00475 
00476     <span class="comment">/*</span>
00477 <span class="comment">     * Set new state</span>
00478 <span class="comment">     */</span>
00479     pItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a> ^= ((wRet ^ wFlags) &amp; wMask);
00480 
00481     <span class="keywordflow">return</span> wRet;
00482 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="mnsys.c::SetupFakeMDIAppStuff" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SetupFakeMDIAppStuff           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d9/structtagITEM.html">PITEM</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lpItem</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00724">724</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html#l00026">_GetMenuDefaultItem()</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00654">_SetCloseDefault()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02611">tagITEM::dwItemData</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00678">FindFakeMDIChild()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02606">tagITEM::spSubMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02646">tagMENU::spwndNotify</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02319">WFWIN40COMPAT</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00954">xxxRealDrawMenuItem()</a>.
<p>
<pre class="fragment"><div>00725 {
00726     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>   pSubMenu;
00727     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwndParent;
00728     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwndChild;
00729 
00730     <span class="keywordflow">if</span> (!(pSubMenu = lpItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a>))
00731         <span class="keywordflow">return</span>;
00732 
00733     pwndParent = lpMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>;
00734 
00735     <span class="comment">//</span>
00736     <span class="comment">// Set up the default menu item.  Project and FoxPro renumber their</span>
00737     <span class="comment">// IDs so we do some special stuff for them, among others.</span>
00738     <span class="comment">//</span>
00739     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndParent, WFWIN40COMPAT))
00740     {
00741         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a0">_GetMenuDefaultItem</a>(pSubMenu, TRUE, GMDI_USEDISABLED) == -1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>)
00742             <a class="code" href="../../d5/d3/mnsys_8c.html#a0">_SetCloseDefault</a>(pSubMenu);
00743     }
00744 
00745     <span class="comment">//</span>
00746     <span class="comment">// Don't touch the HIWORD if we don't find an HWND.  That way apps</span>
00747     <span class="comment">// like Excel which have starting-up maxed children can benefit a little.</span>
00748     <span class="comment">// The first time the menu bar is redrawn, the child isn't visible/</span>
00749     <span class="comment">// around (they add the item too early).  But if it redraws later, or</span>
00750     <span class="comment">// you max a child, the icon will kick in.</span>
00751     <span class="comment">//</span>
00752     <span class="keywordflow">if</span> (pwndChild = <a class="code" href="../../d5/d3/mnsys_8c.html#a1">FindFakeMDIChild</a>(pwndParent)) {
00753         lpItem-&gt;<a class="code" href="../../d0/d9/structtagITEM.html#o8">dwItemData</a> = (ULONG_PTR)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwndChild);
00754 <span class="comment">//        lpItem-&gt;dwTypeData = MAKELONG(LOWORD(lpItem-&gt;dwTypeData), HW16(hwndChild));</span>
00755     }
00756 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="mnsys.c::UnlockDesktopMenu" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID UnlockDesktopMenu           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ppmenu</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00124">124</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02775">ClearMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00649">MFDESKTOP</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/desktop_8c-source.html#l00114">xxxDesktopThread()</a>.
<p>
<pre class="fragment"><div>00125 {
00126     UserAssert(*ppmenu != NULL);
00127     UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(*ppmenu, MFDESKTOP));
00128     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a785">ClearMF</a>(*ppmenu, MFDESKTOP);
00129     UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>((*ppmenu)-&gt;rgItems-&gt;spSubMenu, MFDESKTOP));
00130     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a785">ClearMF</a>((*ppmenu)-&gt;rgItems-&gt;spSubMenu, MFDESKTOP);
00131     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(ppmenu);
00132 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="mnsys.c::xxxEnableMenuItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> xxxEnableMenuItem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pMenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wIDEnableItem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wEnable</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00494">494</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00455">MenuItemState()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00701">MFAPPSYSMENU</a>, <a class="el" href="../../d4/d1/mnchange_8c-source.html#l01027">MNGetPopupFromMenu()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04788">MNUS_DEFAULT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02646">tagMENU::spwndNotify</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d4/d1/mnchange_8c-source.html#l01106">xxxMNUpdateShownMenu()</a>, and <a class="el" href="../../d9/d2/dwp_8c-source.html#l00766">xxxRedrawTitle()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04154">NtUserEnableMenuItem()</a>, and <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00232">xxxSetSysMenu()</a>.
<p>
<pre class="fragment"><div>00498 {
00499     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dres;
00500     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pRealMenu;
00501     <a class="code" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a> ppopup;
00502 
00503     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pMenu);
00504 
00505     dres = <a class="code" href="../../d5/d3/mnsys_8c.html#a10">MenuItemState</a>(pMenu, wIDEnableItem, wEnable,
00506             MFS_GRAYED, &amp;pRealMenu);
00507 
00508     <span class="comment">/*</span>
00509 <span class="comment">     * If enabling/disabling a system menu item, redraw the caption buttons</span>
00510 <span class="comment">     */</span>
00511     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MFAPPSYSMENU) &amp;&amp; (pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00512 
00513         <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwnd;
00514 
00515         <span class="keywordflow">switch</span> (wIDEnableItem) {
00516         <span class="keywordflow">case</span> SC_SIZE:
00517         <span class="keywordflow">case</span> SC_MOVE:
00518         <span class="keywordflow">case</span> SC_MINIMIZE:
00519         <span class="keywordflow">case</span> SC_MAXIMIZE:
00520         <span class="keywordflow">case</span> SC_CLOSE:
00521         <span class="keywordflow">case</span> SC_RESTORE:
00522             <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>, &amp;tlpwnd);
00523             <a class="code" href="../../d4/d1/userk_8h.html#a1995">xxxRedrawTitle</a>(pMenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>, DC_BUTTONS);
00524             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwnd);
00525         }
00526     }
00527 
00528     <span class="comment">/* 367162: If the menu is already being displayed we need to redraw it */</span>
00529     <span class="keywordflow">if</span>(pRealMenu &amp;&amp; (ppopup = <a class="code" href="../../d4/d1/userk_8h.html#a1602">MNGetPopupFromMenu</a>(pRealMenu, NULL))){
00530         <a class="code" href="../../d4/d1/userk_8h.html#a1336">xxxMNUpdateShownMenu</a>(ppopup, NULL, MNUS_DEFAULT);
00531     }
00532 
00533     <span class="keywordflow">return</span> dres;
00534 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="mnsys.c::xxxGetSysMenu" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> xxxGetSysMenu           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fSubMenu</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00189">189</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00796">_GetSubMenu()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d6/menuc_8c-source.html#l00270">xxxGetSysMenuHandle()</a>, and <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00232">xxxSetSysMenu()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00601">xxxDWP_NCMouse()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00402">xxxDWP_SetCursor()</a>, <a class="el" href="../../d5/d2/mnstate_8c-source.html#l00808">xxxGetInitMenuParam()</a>, <a class="el" href="../../d7/d6/winable2_8c-source.html#l00580">xxxGetMenuBarInfo()</a>, and <a class="el" href="../../d5/d2/mnstate_8c-source.html#l00677">xxxMNStartMenu()</a>.
<p>
<pre class="fragment"><div>00190 {
00191     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>   pMenu;
00192 
00193     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00194     <a class="code" href="../../d4/d1/userk_8h.html#a1402">xxxSetSysMenu</a>(pwnd);
00195     <span class="keywordflow">if</span> ((pMenu = <a class="code" href="../../d4/d1/userk_8h.html#a1403">xxxGetSysMenuHandle</a>(pwnd)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00196         <span class="keywordflow">if</span> (fSubMenu)
00197             pMenu = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a15">_GetSubMenu</a>(pMenu, 0);
00198     }
00199 
00200     <span class="keywordflow">return</span>(pMenu);
00201 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="mnsys.c::xxxGetSysMenuHandle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> xxxGetSysMenuHandle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00142">142</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01515">HWq</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02592">ID_SYSMENU</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04563">NtUserCallHwndLock()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01763">tagWND::spmenuSys</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02826">TIF_INCLEANUP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02828">TIF_SYSTEMTHREAD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02405">WFSYSMENU</a>, and <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00030">xxxLoadSysDesktopMenu()</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00189">xxxGetSysMenu()</a>, <a class="el" href="../../d5/d7/syscmd_8c-source.html#l00023">xxxHandleNCMouseGuys()</a>, <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html#l00078">xxxMNCanClose()</a>, <a class="el" href="../../d7/d1/mndraw_8c-source.html#l01697">xxxMNInvertItem()</a>, <a class="el" href="../../d2/d2/mnloop_8c-source.html#l00635">xxxMNLoop()</a>, and <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00232">xxxSetSysMenu()</a>.
<p>
<pre class="fragment"><div>00144 {
00145     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00146 
00147     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00148 
00149     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSYSMENU)) {
00150         pMenu = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>;
00151 
00152         <span class="comment">/*</span>
00153 <span class="comment">         * If the window doesn't have a System Menu, use the default one.</span>
00154 <span class="comment">         */</span>
00155         <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00156 
00157             <span class="comment">/*</span>
00158 <span class="comment">             * Grab the menu from the desktop.  If the desktop menu</span>
00159 <span class="comment">             * has not been loaded and this is not a system thread,</span>
00160 <span class="comment">             * load it now.  Callbacks cannot be made from a system</span>
00161 <span class="comment">             * thread or when a thread is in cleanup.</span>
00162 <span class="comment">             */</span>
00163             pMenu = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spmenuSys;
00164 
00165             <span class="comment">/*</span>
00166 <span class="comment">             * Do not do callbacks if the thread is exiting.  We ran into this when</span>
00167 <span class="comment">             * destroying a thread's window and the window it was promoting to</span>
00168 <span class="comment">             * foreground was a hard error popup.</span>
00169 <span class="comment">             */</span>
00170             <span class="keywordflow">if</span> (pMenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; !(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;TIF_flags &amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a797">TIF_SYSTEMTHREAD</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a795">TIF_INCLEANUP</a>))) {
00171 
00172                 pMenu = <a class="code" href="../../d4/d1/userk_8h.html#a1605">xxxLoadSysDesktopMenu</a> (&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;spmenuSys, ID_SYSMENU);
00173             }
00174         }
00175     } <span class="keywordflow">else</span> {
00176         pMenu = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00177     }
00178 
00179     <span class="keywordflow">return</span> pMenu;
00180 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="mnsys.c::xxxGetSystemMenu" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> xxxGetSystemMenu           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fRevert</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00368">368</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d8/d1/mndstry_8c-source.html#l00027">_DestroyMenu()</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00796">_GetSubMenu()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02816">tagPOPUPMENU::fIsSysMenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02817">tagPOPUPMENU::fIsTrackPopup</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04731">GetpGlobalPopupMenu()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02595">ID_DIALOGSYSMENU</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02592">ID_SYSMENU</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00422">LockWndMenu()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00701">MFAPPSYSMENU</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00650">MFSYSMENU</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02774">SetMF</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02881">tagPOPUPMENU::spmenu</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02883">tagPOPUPMENU::spmenuAlternate</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01763">tagWND::spmenuSys</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02863">tagPOPUPMENU::spwndNotify</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02646">tagMENU::spwndNotify</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02868">tagPOPUPMENU::spwndPopupMenu</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d3/d6/ntuser_2kernel_2menu_8c-source.html#l00458">UnlockWndMenu()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02405">WFSYSMENU</a>, and <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html#l00117">xxxLoadSysMenu()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05226">NtUserGetSystemMenu()</a>, and <a class="el" href="../../d5/d7/createw_8c-source.html#l00033">xxxCreateWindowEx()</a>.
<p>
<pre class="fragment"><div>00371 {
00372     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenu;
00373     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00374 
00375     <span class="comment">/*</span>
00376 <span class="comment">     * Should we start with a fresh copy?</span>
00377 <span class="comment">     */</span>
00378 
00379     pmenu = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>;
00380     <span class="keywordflow">if</span> (fRevert) {
00381 
00382         <span class="comment">/*</span>
00383 <span class="comment">         * Destroy the old system menu.</span>
00384 <span class="comment">         */</span>
00385         <span class="keywordflow">if</span> ((pmenu != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFSYSMENU)) {
00386 
00387             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1363">UnlockWndMenu</a>(pwnd, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>)) {
00388                 <a class="code" href="../../d4/d1/userk_8h.html#a1887">_DestroyMenu</a>(pmenu);
00389             }
00390         }
00391     } <span class="keywordflow">else</span> {
00392 
00393         <span class="comment">/*</span>
00394 <span class="comment">         * Do we need to load a new system menu?</span>
00395 <span class="comment">         */</span>
00396         <span class="keywordflow">if</span> (((pmenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pmenu, MFSYSMENU))
00397                 &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSYSMENU)) {
00398 
00399             <a class="code" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a> pGlobalPopupMenu;
00400             <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uMenuId = (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a753">ID_SYSMENU</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a756">ID_DIALOGSYSMENU</a>);
00401             pmenu = <a class="code" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a2">xxxLoadSysMenu</a>(uMenuId);
00402             <span class="keywordflow">if</span> (pmenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00403                 RIPMSG1(RIP_WARNING, <span class="stringliteral">"_GetSystemMenu: xxxLoadSysMenu Failed. pwnd:%#p"</span>, pwnd);
00404             }
00405             <a class="code" href="../../d4/d1/userk_8h.html#a1362">LockWndMenu</a>(pwnd, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>, pmenu);
00406 
00407             pmenu = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>;
00408             pGlobalPopupMenu = <a class="code" href="../../d4/d1/userk_8h.html#a1321">GetpGlobalPopupMenu</a>(pwnd);
00409             <span class="keywordflow">if</span> ((pGlobalPopupMenu != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00410                     &amp;&amp; !pGlobalPopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o3">fIsTrackPopup</a>
00411                     &amp;&amp; (pGlobalPopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o26">spwndPopupMenu</a> == pwnd)) {
00412 
00413                 UserAssert(pGlobalPopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o25">spwndNotify</a> == pwnd);
00414                 <span class="keywordflow">if</span> (pGlobalPopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o2">fIsSysMenu</a>) {
00415                     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pGlobalPopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o29">spmenu</a>, pmenu);
00416                 } <span class="keywordflow">else</span> {
00417                     <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pGlobalPopupMenu-&gt;<a class="code" href="../../d4/d3/structtagPOPUPMENU.html#o30">spmenuAlternate</a>, pmenu);
00418                 }
00419             }
00420         }
00421     }
00422 
00423     <span class="comment">/*</span>
00424 <span class="comment">     * Return the handle to the system menu.</span>
00425 <span class="comment">     */</span>
00426     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00427         <span class="comment">/*</span>
00428 <span class="comment">         * The app is probably going to modify this menu and then we'll need to</span>
00429 <span class="comment">         *  redraw the caption buttons. Hence we need to store the window pointer</span>
00430 <span class="comment">         *  in this pmenu or we won't be able to know what window to repaint.</span>
00431 <span class="comment">         * The bogus thing is that we cannot call LockWndMenu here because this is</span>
00432 <span class="comment">         *  not the actual pmenuSys.</span>
00433 <span class="comment">         */</span>
00434         pmenu = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a15">_GetSubMenu</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>, 0);
00435         <span class="keywordflow">if</span> (pmenu) {
00436             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a784">SetMF</a>(pmenu, MFAPPSYSMENU);
00437             <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;pmenu-&gt;<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>, pwnd);
00438         }
00439         <span class="keywordflow">return</span> pmenu;
00440     }
00441 
00442     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00443 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mnsys.c::xxxLoadSysDesktopMenu" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> xxxLoadSysDesktopMenu           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d1/structtagMENU.html">PMENU</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppmenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uMenuId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00030">30</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d8/d1/mndstry_8c-source.html#l00027">_DestroyMenu()</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00074">LockDesktopMenu()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00650">MFSYSMENU</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02774">SetMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, and <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html#l00117">xxxLoadSysMenu()</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00142">xxxGetSysMenuHandle()</a>, <a class="el" href="../../d3/d1/mnapi_8c-source.html#l00095">xxxSetDialogSystemMenu()</a>, and <a class="el" href="../../d2/d1/mnaccel_8c-source.html#l00251">xxxTranslateAccelerator()</a>.
<p>
<pre class="fragment"><div>00031 {
00032     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pmenu;
00033     <span class="comment">/*</span>
00034 <span class="comment">     * This should only be called when the menu hasn't been loaded</span>
00035 <span class="comment">     */</span>
00036     UserAssert(*ppmenu == NULL);
00037 
00038     pmenu = <a class="code" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a2">xxxLoadSysMenu</a>(uMenuId);
00039     <span class="keywordflow">if</span> (pmenu == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00040         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00041     }
00042     <span class="comment">/*</span>
00043 <span class="comment">     * If someone beat us loading the menu, destroy this one</span>
00044 <span class="comment">     *  and return the one already loaded</span>
00045 <span class="comment">     */</span>
00046     <span class="keywordflow">if</span> (*ppmenu != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00047         UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(*ppmenu, MFSYSMENU));
00048         RIPMSG1(RIP_WARNING,
00049                 <span class="stringliteral">"LoadSysDesktopMenu: Menu loaded during callback. ppmenu:%#p"</span>,
00050                 ppmenu);
00051         <a class="code" href="../../d4/d1/userk_8h.html#a1887">_DestroyMenu</a>(pmenu);
00052         <span class="keywordflow">return</span> *ppmenu;
00053     }
00054     <span class="comment">/*</span>
00055 <span class="comment">     * Mark it, lock it and done</span>
00056 <span class="comment">     */</span>
00057     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a784">SetMF</a>(pmenu, MFSYSMENU);
00058     <a class="code" href="../../d4/d1/userk_8h.html#a1603">LockDesktopMenu</a>(ppmenu, pmenu);
00059     <span class="keywordflow">return</span> pmenu;
00060 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="mnsys.c::xxxSetSysMenu" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xxxSetSysMenu           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00232">232</a> of file <a class="el" href="../../d6/d2/mnsys_8c-source.html">mnsys.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00796">_GetSubMenu()</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00654">_SetCloseDefault()</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00567">_SetMenuDefaultItem()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00208">IsSmallerThanScreen()</a>, <a class="el" href="../../d9/d6/winloop2_8c-source.html#l00062">IsTrayWindow()</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00650">MFSYSMENU</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00486">MNLookUpItem()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02776">TestMF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02779">TestMFS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00363">ThreadLockAlways</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02357">WEFDLGMODALFRAME</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02364">WEFTOOLWINDOW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02411">WFBORDERMASK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02421">WFCHILD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02408">WFDLGFRAME</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02400">WFMAXBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02415">WFMAXIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02402">WFMINBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02420">WFMINIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02404">WFSIZEBOX</a>, <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00494">xxxEnableMenuItem()</a>, and <a class="el" href="../../d8/d6/menuc_8c-source.html#l00270">xxxGetSysMenuHandle()</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/mnsys_8c-source.html#l00189">xxxGetSysMenu()</a>, <a class="el" href="../../d5/d7/syscmd_8c-source.html#l00023">xxxHandleNCMouseGuys()</a>, and <a class="el" href="../../d2/d1/mnaccel_8c-source.html#l00251">xxxTranslateAccelerator()</a>.
<p>
<pre class="fragment"><div>00234 {
00235     <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu;
00236     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wSize;
00237     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wMinimize;
00238     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wMaximize;
00239     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wMove;
00240     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wRestore;
00241     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wDefault;
00242     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fFramedDialogBox;
00243     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlmenu;
00244 
00245     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00246     <span class="comment">/*</span>
00247 <span class="comment">     * Get the handle of the current system menu.</span>
00248 <span class="comment">     */</span>
00249     <span class="keywordflow">if</span> ((pMenu = <a class="code" href="../../d4/d1/userk_8h.html#a1403">xxxGetSysMenuHandle</a>(pwnd)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00250 
00251         pMenu = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a15">_GetSubMenu</a>(pMenu, 0);
00252         <span class="keywordflow">if</span> (!pMenu)
00253             <span class="keywordflow">return</span>;
00254 
00255         <a class="code" href="../../d6/d0/usercli_8h.html#a37">ThreadLockAlways</a>(pMenu, &amp;tlmenu);
00256 
00257         <span class="comment">/*</span>
00258 <span class="comment">         * System modal window: no size, icon, zoom, or move.</span>
00259 <span class="comment">         */</span>
00260 
00261 <span class="comment">// No system modal windows on NT.</span>
00262 <span class="comment">//        wSize = wMaximize = wMinimize = wMove =</span>
00263 <span class="comment">//            (UINT)((_GetSysModalWindow() == NULL) || hTaskLockInput ? 0: MFS_GRAYED);</span>
00264         wSize = wMaximize = wMinimize = wMove =  0;
00265         wRestore = MFS_GRAYED;
00266 
00267         <span class="comment">//</span>
00268         <span class="comment">// Default menu command is close.</span>
00269         <span class="comment">//</span>
00270         wDefault = SC_CLOSE;
00271 
00272         <span class="comment">/*</span>
00273 <span class="comment">         * Minimized exceptions: no minimize, restore.</span>
00274 <span class="comment">         */</span>
00275 
00276         <span class="comment">// we need to reverse these because VB has a "special" window</span>
00277         <span class="comment">// that is both minimized but without a minbox.</span>
00278         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED))
00279         {
00280             wRestore  = 0;
00281             wMinimize = MFS_GRAYED;
00282             wSize     = MFS_GRAYED;
00283             wDefault  = SC_RESTORE;
00284 
00285             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/winloop2_8c.html#a2">IsTrayWindow</a>(pwnd))
00286               wMove = MFS_GRAYED;
00287         }
00288         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINBOX))
00289             wMinimize = MFS_GRAYED;
00290 
00291         <span class="comment">/*</span>
00292 <span class="comment">         * Maximized exceptions: no maximize, restore.</span>
00293 <span class="comment">         */</span>
00294         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXBOX))
00295             wMaximize = MFS_GRAYED;
00296         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXIMIZED)) {
00297             wRestore = 0;
00298 
00299             <span class="comment">/*</span>
00300 <span class="comment">             * If the window is maximized but it isn't larger than the</span>
00301 <span class="comment">             * screen, we allow the user to move the window around the</span>
00302 <span class="comment">             * desktop (but we don't allow resizing).</span>
00303 <span class="comment">             */</span>
00304             wMove = MFS_GRAYED;
00305             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCHILD)) {
00306                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1109">IsSmallerThanScreen</a>(pwnd)) {
00307                     wMove = 0;
00308                 }
00309             }
00310 
00311             wSize     = MFS_GRAYED;
00312             wMaximize = MFS_GRAYED;
00313         }
00314 
00315         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSIZEBOX))
00316             wSize = MFS_GRAYED;
00317 
00318         <span class="comment">/*</span>
00319 <span class="comment">         * Are we dealing with a framed dialog box with a sys menu?</span>
00320 <span class="comment">         * Dialogs with min/max/size boxes get a regular system menu</span>
00321 <span class="comment">         *  (as opposed to the dialog menu)</span>
00322 <span class="comment">         */</span>
00323         fFramedDialogBox =
00324                 (((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFBORDERMASK) == (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(WFDLGFRAME))
00325                         || (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFDLGMODALFRAME)))
00326                     &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSIZEBOX | WFMINBOX | WFMAXBOX));
00327 
00328         <span class="keywordflow">if</span> (!fFramedDialogBox) {
00329             <a class="code" href="../../d4/d1/userk_8h.html#a1889">xxxEnableMenuItem</a>(pMenu, (UINT)SC_SIZE, wSize);
00330             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFTOOLWINDOW))
00331             {
00332                 <a class="code" href="../../d4/d1/userk_8h.html#a1889">xxxEnableMenuItem</a>(pMenu, (UINT)SC_MINIMIZE, wMinimize);
00333                 <a class="code" href="../../d4/d1/userk_8h.html#a1889">xxxEnableMenuItem</a>(pMenu, (UINT)SC_MAXIMIZE, wMaximize);
00334                 <a class="code" href="../../d4/d1/userk_8h.html#a1889">xxxEnableMenuItem</a>(pMenu, (UINT)SC_RESTORE, wRestore);
00335             }
00336         }
00337 
00338         <a class="code" href="../../d4/d1/userk_8h.html#a1889">xxxEnableMenuItem</a>(pMenu, (UINT)SC_MOVE, wMove);
00339 
00340 <span class="preprocessor">#if DBG</span>
00341 <span class="preprocessor"></span>        <span class="comment">/*</span>
00342 <span class="comment">         * Assert that nobody managed to change the desktop menus.</span>
00343 <span class="comment">         */</span>
00344         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a786">TestMF</a>(pMenu, MFSYSMENU)) {
00345             <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a> pItem = <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a10">MNLookUpItem</a>(pMenu, SC_CLOSE, FALSE, NULL);
00346             UserAssert((pItem != NULL) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a788">TestMFS</a>(pItem, MFS_GRAYED));
00347         }
00348 <span class="preprocessor">#endif</span>
00349 <span class="preprocessor"></span>
00350         <span class="keywordflow">if</span> (wDefault == SC_CLOSE)
00351             <a class="code" href="../../d5/d3/mnsys_8c.html#a0">_SetCloseDefault</a>(pMenu);
00352         <span class="keywordflow">else</span>
00353             <a class="code" href="../../d4/d1/userk_8h.html#a1599">_SetMenuDefaultItem</a>(pMenu, wDefault, MF_BYCOMMAND);
00354 
00355         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlmenu);
00356     }
00357 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:47 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
