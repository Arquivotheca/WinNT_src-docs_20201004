<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ppc/flush.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>flush.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>

<p>
<a href="../../d4/d4/ppc_2flush_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/ppc_2flush_8c.html#a0">KiChangeColorPageTarget</a> (IN PULONG SignalDone, IN PVOID NewColor, IN PVOID OldColor, IN PVOID PageFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/ppc_2flush_8c.html#a1">KiSweepDcacheTarget</a> (IN PULONG SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/ppc_2flush_8c.html#a2">KiSweepIcacheTarget</a> (IN PULONG SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/ppc_2flush_8c.html#a3">KiSweepIcacheRangeTarget</a> (IN PULONG SignalDone, IN PVOID BaseAddress, IN PVOID Length, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/ppc_2flush_8c.html#a4">KiFlushIoBuffersTarget</a> (IN PULONG SignalDone, IN PVOID Mdl, IN PVOID ReadOperation, IN PVOID DmaOperation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/ppc_2flush_8c.html#a5">KeChangeColorPage</a> (IN PVOID NewColor, IN PVOID OldColor, IN ULONG PageFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/ppc_2flush_8c.html#a6">KeSweepDcache</a> (IN BOOLEAN AllProcessors)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/ppc_2flush_8c.html#a7">KeSweepIcache</a> (IN BOOLEAN AllProcessors)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/ppc_2flush_8c.html#a8">KeSweepIcacheRange</a> (IN BOOLEAN AllProcessors, IN PVOID BaseAddress, IN ULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/ppc_2flush_8c.html#a9">KeFlushIoBuffers</a> (IN <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a> Mdl, IN BOOLEAN ReadOperation, IN BOOLEAN DmaOperation)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a5" doxytag="ppc/flush.c::KeChangeColorPage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeChangeColorPage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>NewColor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>OldColor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PageFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/ppc_2flush_8c-source.html#l00077">77</a> of file <a class="el" href="../../d4/d4/ppc_2flush_8c-source.html">ppc/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00164">KiChangeColorPageTarget()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00092">SYNCH_LEVEL</a>.
<p>
<pre class="fragment"><div>00085                    :
00086 
00087     This routine changes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> color of a page.
00088 
00089 Arguments:
00090 
00091     NewColor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page aligned <span class="keyword">virtual</span> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> color
00092         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page to change.
00093 
00094     OldColor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page aligned <span class="keyword">virtual</span> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> old color
00095         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page to change.
00096 
00097     PageFrame - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page frame number of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> page that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> changed.
00098 
00099 Return Value:
00100 
00101     None.
00102 
00103 --*/
00104 
00105 {
00106     KIRQL OldIrql;
00107     KAFFINITY TargetProcessors;
00108 
00109     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= SYNCH_LEVEL);
00110 
00111     <span class="comment">//</span>
00112     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00113     <span class="comment">//</span>
00114 
00115 <span class="preprocessor">#if !defined(NT_UP)</span>
00116 <span class="preprocessor"></span>
00117     OldIrql = KeRaiseIrqlToSynchLevel();
00118 
00119     <span class="comment">//</span>
00120     <span class="comment">// Compute the set of target processors and send the change color</span>
00121     <span class="comment">// parameters to the target processors, if any, for execution.</span>
00122     <span class="comment">//</span>
00123 
00124     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00125     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00126         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00127                         KiChangeColorPageTarget,
00128                         (PVOID)NewColor,
00129                         (PVOID)OldColor,
00130                         (PVOID)PageFrame);
00131     }
00132 
00133 <span class="preprocessor">#endif</span>
00134 <span class="preprocessor"></span>
00135 <span class="preprocessor">#ifdef COLORED_PAGES</span>
00136 <span class="preprocessor"></span>    <span class="comment">//</span>
00137     <span class="comment">// Change the color of the page on the current processor.</span>
00138     <span class="comment">//</span>
00139 
00140     HalChangeColorPage(NewColor, OldColor, PageFrame);
00141 
00142 <span class="preprocessor">#endif</span>
00143 <span class="preprocessor"></span>
00144     <span class="comment">//</span>
00145     <span class="comment">// Wait until all target processors have finished changing the color</span>
00146     <span class="comment">// of the page.</span>
00147     <span class="comment">//</span>
00148 
00149 <span class="preprocessor">#if !defined(NT_UP)</span>
00150 <span class="preprocessor"></span>
00151     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00152         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00153     }
00154 
00155     <span class="comment">//</span>
00156     <span class="comment">// Lower IRQL to its previous level and return.</span>
00157     <span class="comment">//</span>
00158 
00159     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00160 
00161 <span class="preprocessor">#endif</span>
00162 <span class="preprocessor"></span>
00163     <span class="keywordflow">return</span>;
00164 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ppc/flush.c::KeFlushIoBuffers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeFlushIoBuffers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d7/struct__MDL.html">PMDL</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mdl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ReadOperation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>DmaOperation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/ppc_2flush_8c-source.html#l00693">693</a> of file <a class="el" href="../../d4/d4/ppc_2flush_8c-source.html">ppc/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02496">DMA_READ_DCACHE_INVALIDATE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02497">DMA_READ_ICACHE_INVALIDATE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02498">DMA_WRITE_DCACHE_SNOOP</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02776">KeNumberProcessors</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00301">KiDmaIoCoherency</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00508">KiFlushIoBuffersTarget()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00430">MDL_IO_PAGE_READ</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00092">SYNCH_LEVEL</a>.
<p>
Referenced by <a class="el" href="../../d4/d6/deviosup_8c-source.html#l00201">UdfNonCachedRead()</a>.
<p>
<pre class="fragment"><div>00701                    :
00702 
00703     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I/O buffer specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory descriptor
00704     list from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data cache on all processors.
00705 
00706 Arguments:
00707 
00708     Mdl - Supplies a pointer to a memory descriptor list that describes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00709         I/O buffer location.
00710 
00711     ReadOperation - Supplies a <span class="keywordtype">boolean</span> value that determines whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I/O
00712         operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a read into memory.
00713 
00714     DmaOperation - Supplies a <span class="keywordtype">boolean</span> value that determines whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I/O
00715         operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a DMA operation.
00716 
00717 Return Value:
00718 
00719     None.
00720 
00721 --*/
00722 
00723 {
00724 
00725     KIRQL OldIrql;
00726     KAFFINITY TargetProcessors;
00727     ULONG MaxLocalSweep;
00728 
00729     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= SYNCH_LEVEL);
00730 
00731     <span class="comment">//</span>
00732     <span class="comment">// If the operation is a DMA operation, then check if the flush</span>
00733     <span class="comment">// can be avoided because the host system supports the right set</span>
00734     <span class="comment">// of cache coherency attributes. Otherwise, the flush can also</span>
00735     <span class="comment">// be avoided if the operation is a programmed I/O and not a page</span>
00736     <span class="comment">// read.</span>
00737     <span class="comment">//</span>
00738 
00739     <span class="keywordflow">if</span> (DmaOperation != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00740         <span class="keywordflow">if</span> (ReadOperation != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00741 
00742 <span class="preprocessor">#if DBG</span>
00743 <span class="preprocessor"></span>
00744             <span class="comment">//</span>
00745             <span class="comment">// Yes, it's a DMA operation, and yes, it's a read.  PPC</span>
00746             <span class="comment">// I-Caches do not snoop so this code is here only in debug</span>
00747             <span class="comment">// systems to ensure KiDmaIoCoherency is set reasonably.</span>
00748             <span class="comment">//</span>
00749 
00750             <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d9/kernldat_8c.html#a34">KiDmaIoCoherency</a> &amp; <a class="code" href="../../d4/d9/ke_8h.html#a41">DMA_READ_ICACHE_INVALIDATE</a>) != 0) {
00751 
00752                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((KiDmaIoCoherency &amp; DMA_READ_DCACHE_INVALIDATE) != 0);
00753 
00754                 <span class="keywordflow">return</span>;
00755             }
00756 
00757 <span class="preprocessor">#endif</span>
00758 <span class="preprocessor"></span>
00759             <span class="comment">//</span>
00760             <span class="comment">// If the operation is NOT a page read, then the read will</span>
00761             <span class="comment">// not affect the I-Cache.  The PPC architecture ensures the</span>
00762             <span class="comment">// D-Cache will remain coherent.</span>
00763             <span class="comment">//</span>
00764 
00765             <span class="keywordflow">if</span> ((Mdl-&gt;MdlFlags &amp; <a class="code" href="../../d0/d9/ntosdef_8h.html#a18">MDL_IO_PAGE_READ</a>) == 0) {
00766                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((KiDmaIoCoherency &amp; DMA_READ_DCACHE_INVALIDATE) != 0);
00767                 <span class="keywordflow">return</span>;
00768             }
00769 
00770         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d9/kernldat_8c.html#a34">KiDmaIoCoherency</a> &amp; <a class="code" href="../../d4/d9/ke_8h.html#a42">DMA_WRITE_DCACHE_SNOOP</a>) != 0) {
00771             <span class="keywordflow">return</span>;
00772         }
00773 
00774     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((Mdl-&gt;MdlFlags &amp; <a class="code" href="../../d0/d9/ntosdef_8h.html#a18">MDL_IO_PAGE_READ</a>) == 0) {
00775         <span class="keywordflow">return</span>;
00776     }
00777 
00778     <span class="comment">//</span>
00779     <span class="comment">// If the processor has a unified cache (currently the only</span>
00780     <span class="comment">// PowerPC to fall into this category is a 601) then there</span>
00781     <span class="comment">// are no problems with the I-Cache not snooping and D-Cache</span>
00782     <span class="comment">// coherency is architected.</span>
00783     <span class="comment">//</span>
00784 
00785     <span class="keywordflow">if</span> ((KeGetPvr() &gt;&gt; 16) == 1) {
00786         <span class="keywordflow">return</span>;
00787     }
00788 
00789     <span class="comment">//</span>
00790     <span class="comment">// Either the operation is a DMA operation and the right coherency</span>
00791     <span class="comment">// atributes are not supported by the host system, or the operation</span>
00792     <span class="comment">// is programmed I/O and a page read.</span>
00793     <span class="comment">//</span>
00794     <span class="comment">// If the amount of data to sweep is large, sweep the entire</span>
00795     <span class="comment">// data and inctruction caches on all processors, otherwise,</span>
00796     <span class="comment">// sweep the explicit range covered by the mdl.</span>
00797     <span class="comment">//</span>
00798     <span class="comment">// Sweeping the range covered by the mdl will be broadcast</span>
00799     <span class="comment">// to the other processors by the PPC h/w coherency mechanism.</span>
00800     <span class="comment">// (1 DCBST + 1 ICBI per block)</span>
00801     <span class="comment">// Sweeping the entire D-Cache involves (potentially) loading</span>
00802     <span class="comment">// and broadcasting a DCBST for each block in the D-Cache on</span>
00803     <span class="comment">// every processor.</span>
00804     <span class="comment">//</span>
00805     <span class="comment">// For this reason we only sweep all if the amount to flush</span>
00806     <span class="comment">// is greater than the First Level D Cache size * number of</span>
00807     <span class="comment">// processors in the system.</span>
00808     <span class="comment">//</span>
00809 
00810     MaxLocalSweep = PCR-&gt;FirstLevelDcacheSize;
00811 
00812 <span class="preprocessor">#if !defined(NT_UP)</span>
00813 <span class="preprocessor"></span>
00814     MaxLocalSweep *= <a class="code" href="../../d4/d9/ke_8h.html#a133">KeNumberProcessors</a>;
00815 
00816 <span class="preprocessor">#endif</span>
00817 <span class="preprocessor"></span>
00818     <span class="keywordflow">if</span> (Mdl-&gt;ByteCount &gt; MaxLocalSweep) {
00819 
00820         <span class="comment">//</span>
00821         <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00822         <span class="comment">//</span>
00823 
00824         OldIrql = KeRaiseIrqlToSynchLevel();
00825 
00826 <span class="preprocessor">#if !defined(NT_UP)</span>
00827 <span class="preprocessor"></span>
00828         <span class="comment">//</span>
00829         <span class="comment">// Compute the set of target processors and send the sweep parameters</span>
00830         <span class="comment">// to the target processors, if any, for execution.</span>
00831         <span class="comment">//</span>
00832 
00833         TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00834         <span class="keywordflow">if</span> (TargetProcessors != 0) {
00835 
00836             <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00837                             KiFlushIoBuffersTarget,
00838                             (PVOID)Mdl,
00839                             (PVOID)((ULONG)ReadOperation),
00840                             (PVOID)((ULONG)DmaOperation));
00841 
00842         }
00843 
00844 <span class="preprocessor">#endif</span>
00845 <span class="preprocessor"></span>
00846         <span class="comment">//</span>
00847         <span class="comment">// Flush the caches on the current processor.</span>
00848         <span class="comment">//</span>
00849 
00850         HalSweepDcache();
00851 
00852         HalSweepIcache();
00853 
00854         <span class="comment">//</span>
00855         <span class="comment">// Wait until all target processors have finished</span>
00856         <span class="comment">// flushing their caches.</span>
00857         <span class="comment">//</span>
00858 
00859 <span class="preprocessor">#if !defined(NT_UP)</span>
00860 <span class="preprocessor"></span>
00861         <span class="keywordflow">if</span> (TargetProcessors != 0) {
00862             <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00863         }
00864 
00865 <span class="preprocessor">#endif</span>
00866 <span class="preprocessor"></span>
00867         <span class="comment">//</span>
00868         <span class="comment">// Lower IRQL to its previous level and return.</span>
00869         <span class="comment">//</span>
00870 
00871         <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00872 
00873         <span class="keywordflow">return</span>;
00874     }
00875 
00876     <span class="comment">//</span>
00877     <span class="comment">// The amount of data to be flushed is sufficiently small that it</span>
00878     <span class="comment">// should be done on this processor only, allowing the h/w to ensure</span>
00879     <span class="comment">// coherency.</span>
00880     <span class="comment">//</span>
00881 
00882     HalFlushIoBuffers(Mdl, ReadOperation, DmaOperation);
00883 
00884 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ppc/flush.c::KeSweepDcache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSweepDcache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>AllProcessors</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/ppc_2flush_8c-source.html#l00220">220</a> of file <a class="el" href="../../d4/d4/ppc_2flush_8c-source.html">ppc/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00156">KiSweepDcacheTarget()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00092">SYNCH_LEVEL</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l02952">CcZeroData()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, <a class="el" href="../../d5/d3/i386_2intobj_8c-source.html#l00086">KeInitializeInterrupt()</a>, <a class="el" href="../../d3/d0/inialpha_8c-source.html#l00041">MiInitMachineDependent()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03744">MmAllocateContiguousMemorySpecifyCache()</a>, and <a class="el" href="../../d6/d5/iosup_8c-source.html#l05581">MmAllocateNonCachedMemory()</a>.
<p>
<pre class="fragment"><div>00226                    :
00227 
00228     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data cache on all processors that are currently
00229     running threads which are children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00230     data cache on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00231 
00232     N.B. PowerPC maintains cache coherency across processors however
00233     in <span class="keyword">this</span> routine, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range of addresses being flushed <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> unknown
00234     so we must still broadcast <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> other processors.
00235 
00236 Arguments:
00237 
00238     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which data
00239         caches are flushed.
00240 
00241 Return Value:
00242 
00243     None.
00244 
00245 --*/
00246 
00247 {
00248 
00249     KIRQL OldIrql;
00250     KAFFINITY TargetProcessors;
00251 
00252     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= SYNCH_LEVEL);
00253 
00254     <span class="comment">//</span>
00255     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00256     <span class="comment">//</span>
00257 
00258 <span class="preprocessor">#if !defined(NT_UP)</span>
00259 <span class="preprocessor"></span>
00260     OldIrql = KeRaiseIrqlToSynchLevel();
00261 
00262     <span class="comment">//</span>
00263     <span class="comment">// Compute the set of target processors and send the sweep parameters</span>
00264     <span class="comment">// to the target processors, if any, for execution.</span>
00265     <span class="comment">//</span>
00266 
00267     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00268     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00269         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00270                         KiSweepDcacheTarget,
00271                         NULL,
00272                         NULL,
00273                         NULL);
00274     }
00275 
00276 <span class="preprocessor">#endif</span>
00277 <span class="preprocessor"></span>
00278     <span class="comment">//</span>
00279     <span class="comment">// Sweep the data cache on the current processor.</span>
00280     <span class="comment">//</span>
00281 
00282     HalSweepDcache();
00283 
00284     <span class="comment">//</span>
00285     <span class="comment">// Wait until all target processors have finished sweeping the their</span>
00286     <span class="comment">// data cache.</span>
00287     <span class="comment">//</span>
00288 
00289 <span class="preprocessor">#if !defined(NT_UP)</span>
00290 <span class="preprocessor"></span>
00291     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00292         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00293     }
00294 
00295     <span class="comment">//</span>
00296     <span class="comment">// Lower IRQL to its previous level and return.</span>
00297     <span class="comment">//</span>
00298 
00299     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00300 
00301 <span class="preprocessor">#endif</span>
00302 <span class="preprocessor"></span>
00303     <span class="keywordflow">return</span>;
00304 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ppc/flush.c::KeSweepIcache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSweepIcache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>AllProcessors</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/ppc_2flush_8c-source.html#l00356">356</a> of file <a class="el" href="../../d4/d4/ppc_2flush_8c-source.html">ppc/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00287">KiSweepIcacheTarget()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00092">SYNCH_LEVEL</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00298">KeDisconnectInterrupt()</a>, <a class="el" href="../../d4/d3/alpha_2intobj_8c-source.html#l00032">KeInitializeInterrupt()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00335">KeSweepIcacheRange()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, and <a class="el" href="../../d6/d4/flushbuf_8c-source.html#l00142">NtFlushInstructionCache()</a>.
<p>
<pre class="fragment"><div>00362                    :
00363 
00364     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> instruction cache on all processors that are
00365     currently running threads which are children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or
00366     flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> instruction cache on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00367 
00368     N.B. Although PowerPC maintains cache coherency across processors, we
00369     use <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> flash invalidate function (h/w) <span class="keywordflow">for</span> I-Cache sweeps which doesn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a>
00370     maintain coherency so we still <span class="keywordflow">do</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> MP I-Cache flush in s/w.   plj.
00371 
00372 Arguments:
00373 
00374     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which instruction
00375         caches are flushed.
00376 
00377 Return Value:
00378 
00379     None.
00380 
00381 --*/
00382 
00383 {
00384 
00385     KIRQL OldIrql;
00386     KAFFINITY TargetProcessors;
00387 
00388     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= SYNCH_LEVEL);
00389 
00390     <span class="comment">//</span>
00391     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00392     <span class="comment">//</span>
00393 
00394 <span class="preprocessor">#if !defined(NT_UP)</span>
00395 <span class="preprocessor"></span>
00396     OldIrql = KeRaiseIrqlToSynchLevel();
00397 
00398     <span class="comment">//</span>
00399     <span class="comment">// Compute the set of target processors and send the sweep parameters</span>
00400     <span class="comment">// to the target processors, if any, for execution.</span>
00401     <span class="comment">//</span>
00402 
00403     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00404     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00405         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00406                         KiSweepIcacheTarget,
00407                         NULL,
00408                         NULL,
00409                         NULL);
00410     }
00411 
00412 <span class="preprocessor">#endif</span>
00413 <span class="preprocessor"></span>
00414     <span class="comment">//</span>
00415     <span class="comment">// Sweep the instruction cache on the current processor.</span>
00416     <span class="comment">//</span>
00417     <span class="comment">// If the processor is not a 601, flush the data cache first.</span>
00418     <span class="comment">//</span>
00419 
00420     <span class="keywordflow">if</span> ( ( (KeGetPvr() &gt;&gt; 16 ) &amp; 0xffff ) &gt; 1 ) {
00421         HalSweepDcache();
00422     }
00423 
00424     HalSweepIcache();
00425 
00426     <span class="comment">//</span>
00427     <span class="comment">// Wait until all target processors have finished sweeping their</span>
00428     <span class="comment">// instruction caches.</span>
00429     <span class="comment">//</span>
00430 
00431 <span class="preprocessor">#if !defined(NT_UP)</span>
00432 <span class="preprocessor"></span>
00433     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00434         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00435     }
00436 
00437     <span class="comment">//</span>
00438     <span class="comment">// Lower IRQL to its previous level and return.</span>
00439     <span class="comment">//</span>
00440 
00441     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00442 
00443 <span class="preprocessor">#endif</span>
00444 <span class="preprocessor"></span>
00445     <span class="keywordflow">return</span>;
00446 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ppc/flush.c::KeSweepIcacheRange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSweepIcacheRange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/ppc_2flush_8c-source.html#l00502">502</a> of file <a class="el" href="../../d4/d4/ppc_2flush_8c-source.html">ppc/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d4/d4/ppc_2flush_8c-source.html#l00356">KeSweepIcache()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d3/d4/mips_2flush_8c-source.html#l00588">KiSweepIcacheRangeTarget()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00033">Offset</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00092">SYNCH_LEVEL</a>.
<p>
Referenced by <a class="el" href="../../d6/d4/flushbuf_8c-source.html#l00142">NtFlushInstructionCache()</a>.
<p>
<pre class="fragment"><div>00510                    :
00511 
00512     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to flush a range of <span class="keyword">virtual</span> addresses from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00513     primary instruction cache on all processors that are currently running
00514     threads which are children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range
00515     of <span class="keyword">virtual</span> addresses from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary instruction cache on all
00516     processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00517 
00518 Arguments:
00519 
00520     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which instruction
00521         caches are flushed.
00522 
00523     BaseAddress - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed.
00524 
00525     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base
00526         address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified.
00527 
00528 Return Value:
00529 
00530     None.
00531 
00532 --*/
00533 
00534 {
00535 
00536     ULONG <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a>;
00537     KIRQL OldIrql;
00538     KAFFINITY TargetProcessors;
00539     ULONG ProcessorType;
00540     ULONG DcacheAlignment;
00541     ULONG IcacheAlignment;
00542 
00543     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= SYNCH_LEVEL);
00544 
00545     <span class="comment">//</span>
00546     <span class="comment">// If the length of the range is greater than the size of the primary</span>
00547     <span class="comment">// instruction cache, then flush the entire cache.</span>
00548     <span class="comment">//</span>
00549     <span class="comment">// N.B. It is assumed that the size of the primary instruction and</span>
00550     <span class="comment">//      data caches are the same.</span>
00551     <span class="comment">//</span>
00552 
00553     <span class="keywordflow">if</span> (Length &gt; PCR-&gt;FirstLevelIcacheSize) {
00554         <a class="code" href="../../d3/d5/ppc_2flush_8c.html#a7">KeSweepIcache</a>(AllProcessors);
00555         <span class="keywordflow">return</span>;
00556     }
00557 
00558     ProcessorType = KeGetPvr() &gt;&gt; 16;
00559 
00560     <span class="keywordflow">if</span> (ProcessorType != 1) {
00561 
00562         <span class="comment">// PowerPc 601 has a unified cache; all others have dual caches.</span>
00563         <span class="comment">// Flush the Dcache prior to sweeping the Icache in case we need</span>
00564         <span class="comment">// to fetch a modified instruction currently Dcache resident.</span>
00565 
00566         DcacheAlignment = PCR-&gt;DcacheAlignment;
00567         <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = (ULONG)BaseAddress &amp; DcacheAlignment;
00568         HalSweepDcacheRange(
00569             (PVOID)((ULONG)BaseAddress &amp; ~DcacheAlignment),
00570             (Offset + Length + DcacheAlignment) &amp; ~DcacheAlignment);
00571     }
00572 
00573 <span class="preprocessor">#if 0</span>
00574 <span class="preprocessor"></span>
00575     <span class="comment">//</span>
00576     <span class="comment">// PowerPC h/w maintains coherency across processors.  No need</span>
00577     <span class="comment">// to send IPI request.</span>
00578     <span class="comment">//</span>
00579 
00580     <span class="comment">//</span>
00581     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00582     <span class="comment">//</span>
00583 
00584     OldIrql = KeRaiseIrqlToSynchLevel();
00585 
00586     <span class="comment">//</span>
00587     <span class="comment">// Compute the set of target processors, and send the sweep range</span>
00588     <span class="comment">// parameters to the target processors, if any, for execution.</span>
00589     <span class="comment">//</span>
00590 
00591     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00592     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00593         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00594                         KiSweepIcacheRangeTarget,
00595                         (PVOID)BaseAddress,
00596                         (PVOID)Length,
00597                         NULL);
00598     }
00599 
00600 <span class="preprocessor">#endif</span>
00601 <span class="preprocessor"></span>
00602     <span class="comment">//</span>
00603     <span class="comment">// Flush the specified range of virtual addresses from the primary</span>
00604     <span class="comment">// instruction cache.</span>
00605     <span class="comment">//</span>
00606 
00607     IcacheAlignment = PCR-&gt;IcacheAlignment;
00608     <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = (ULONG)BaseAddress &amp; IcacheAlignment;
00609     HalSweepIcacheRange((PVOID)((ULONG)BaseAddress &amp; ~IcacheAlignment),
00610                         (Offset + Length + IcacheAlignment) &amp; ~IcacheAlignment);
00611 
00612     <span class="comment">//</span>
00613     <span class="comment">// Wait until all target processors have finished sweeping the specified</span>
00614     <span class="comment">// range of addresses from the instruction cache.</span>
00615     <span class="comment">//</span>
00616 
00617 <span class="preprocessor">#if 0</span>
00618 <span class="preprocessor"></span>
00619     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00620         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>();
00621     }
00622 
00623     <span class="comment">//</span>
00624     <span class="comment">// Lower IRQL to its previous level and return.</span>
00625     <span class="comment">//</span>
00626 
00627     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00628 
00629 <span class="preprocessor">#endif</span>
00630 <span class="preprocessor"></span>
00631     <span class="keywordflow">return</span>;
00632 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="ppc/flush.c::KiChangeColorPageTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiChangeColorPageTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>NewColor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>OldColor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>PageFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ppc/flush.c::KiFlushIoBuffersTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushIoBuffersTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Mdl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ReadOperation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>DmaOperation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ppc/flush.c::KiSweepDcacheTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSweepDcacheTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ppc/flush.c::KiSweepIcacheRangeTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSweepIcacheRangeTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ppc/flush.c::KiSweepIcacheTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSweepIcacheTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:43 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
