<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: i386/trapc.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>trapc.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>

<p>
<a href="../../d4/d4/i386_2trapc_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d8/structKMOD.html">KMOD</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(field)&nbsp;&nbsp;&nbsp;((ULONG)(&amp;((KTRAP_FRAME *)0)-&gt;field))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/i386_2trapc_8c.html#a1">GETREG</a>(frame, reg)&nbsp;&nbsp;&nbsp;((PULONG) (((ULONG) frame)+reg))[0]</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/i386_2trapc_8c.html#a2">PKMOD</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/i386_2trapc_8c.html#a11">Ki386CheckDivideByZeroTrap</a> (IN PKTRAP_FRAME UserFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/i386_2trapc_8c.html#a12">KiNextIStreamByte</a> (IN PKTRAP_FRAME UserFrame, IN PUCHAR *istream)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/i386_2trapc_8c.html#a13">Ki386CheckDelayedNpxTrap</a> (IN PKTRAP_FRAME UserFrame, IN PFX_SAVE_AREA NpxFrame)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>UCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/i386_2trapc_8c.html#a3">RM32</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/i386_2trapc_8c.html#a4">RM8</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d8/structKMOD.html">KMOD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/i386_2trapc_8c.html#a5">MOD32</a> []</td></tr>

<tr><td class="memItemLeft" nowrap>struct {</td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;UCHAR&nbsp;&nbsp;&nbsp;<a class="el" href="../../d3/d5/i386_2trapc_8c.html#a6">Opcode1</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;UCHAR&nbsp;&nbsp;&nbsp;<a class="el" href="../../d3/d5/i386_2trapc_8c.html#a7">Opcode2</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;UCHAR&nbsp;&nbsp;&nbsp;<a class="el" href="../../d3/d5/i386_2trapc_8c.html#a8">ModRm</a></td></tr>

<tr><td class="memItemLeft" nowrap>&nbsp;&nbsp;&nbsp;UCHAR&nbsp;&nbsp;&nbsp;<a class="el" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a></td></tr>

<tr><td class="memItemLeft" nowrap valign=top>}&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/i386_2trapc_8c.html#a10">NoWaitNpxInstructions</a> []</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="i386/trapc.c::GETREG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define GETREG          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">frame,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>reg&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((PULONG) (((ULONG) frame)+reg))[0]</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00036">36</a> of file <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html">i386/trapc.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00309">Ki386CheckDelayedNpxTrap()</a>, and <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00090">Ki386CheckDivideByZeroTrap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="i386/trapc.c::REG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define REG          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">field&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((ULONG)(&amp;((KTRAP_FRAME *)0)-&gt;field))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00035">35</a> of file <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html">i386/trapc.c</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a2" doxytag="i386/trapc.c::PKMOD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef   * <a class="el" href="../../d3/d5/i386_2trapc_8c.html#a2">PKMOD</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00309">Ki386CheckDelayedNpxTrap()</a>, and <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00090">Ki386CheckDivideByZeroTrap()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a13" doxytag="i386/trapc.c::Ki386CheckDelayedNpxTrap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN Ki386CheckDelayedNpxTrap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>UserFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PFX_SAVE_AREA&nbsp;</td>
          <td class="mdname" nowrap> <em>NpxFrame</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00309">309</a> of file <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html">i386/trapc.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00036">GETREG</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00886">KiCopyInformation()</a>, <a class="el" href="../../d3/d8/ppc_2exceptn_8c-source.html#l00373">KiDispatchException()</a>, <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00277">KiNextIStreamByte()</a>, <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00067">MOD32</a>, <a class="el" href="../../d3/d5/i386_2trapc_8c.html#a10">NoWaitNpxInstructions</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d5/i386_2trapc_8c.html#a2">PKMOD</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01793">ProbeAndWriteUshort</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00045">RM32</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00316                    :
00317 
00318     This function gains <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Trap07 handler.  It examines
00319     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user mode instruction to see <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>'s a NoWait NPX instruction.
00320     Such instructions <span class="keywordflow">do</span> not generate floating point exceptions - <span class="keyword">this</span>
00321     check needs to be done due to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> way 80386/80387 systems are
00322     implemented.  Such machines will generate a floating point exception
00323     interrupt when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel performs an FRSTOR to reload <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread's
00324     NPX context.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread's next instruction <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a NoWait style
00325     instruction, then we clear <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception or emulate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> instruction.
00326 
00327     AND... due to a different 80386/80387 <span class="stringliteral">"feature"</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel needs
00328     to use FWAIT at times which can causes 80487's to generate delayed
00329     exceptions that can lead to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> same problem described above.
00330 
00331 Arguments:
00332 
00333     UserFrame - Trap frame of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception
00334     NpxFrame - Thread's NpxFrame  (WARNING: does not have NpxState)
00335 
00336     Interrupts are disabled
00337 
00338 Return Value:
00339 
00340     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - Dispatch NPX exception to user mode
00341     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - Exception handled, <span class="keywordflow">continue</span>
00342 
00343 --*/
00344 
00345 {
00346     EXCEPTION_RECORD ExceptionRecord;
00347     UCHAR       ibyte1, ibyte2, inmodrm, status;
00348     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>      StatusWord, ControlWord, UsersWord;
00349     PUCHAR      istream;
00350     BOOLEAN     fPrefix;
00351     UCHAR       rm;
00352     <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a2">PKMOD</a>       Mod;
00353     ULONG       accum, i;
00354 
00355     status = 0;
00356     <span class="keywordflow">try</span> {
00357 
00358         <span class="comment">//</span>
00359         <span class="comment">// read instruction prefixes</span>
00360         <span class="comment">//</span>
00361 
00362         fPrefix = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00363         istream = (PUCHAR) UserFrame-&gt;Eip;
00364         <span class="keywordflow">while</span> (fPrefix) {
00365             ibyte1 = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a12">KiNextIStreamByte</a> (UserFrame, &amp;istream);
00366             <span class="keywordflow">switch</span> (ibyte1) {
00367                 <span class="keywordflow">case</span> 0x2e:  <span class="comment">// cs override</span>
00368                 <span class="keywordflow">case</span> 0x36:  <span class="comment">// ss override</span>
00369                 <span class="keywordflow">case</span> 0x3e:  <span class="comment">// ds override</span>
00370                 <span class="keywordflow">case</span> 0x26:  <span class="comment">// es override</span>
00371                 <span class="keywordflow">case</span> 0x64:  <span class="comment">// fs override</span>
00372                 <span class="keywordflow">case</span> 0x65:  <span class="comment">// gs override</span>
00373                     <span class="keywordflow">break</span>;
00374 
00375                 <span class="keywordflow">default</span>:
00376                     fPrefix = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00377                     <span class="keywordflow">break</span>;
00378             }
00379         }
00380 
00381         <span class="comment">//</span>
00382         <span class="comment">// Check for coprocessor NoWait NPX instruction</span>
00383         <span class="comment">//</span>
00384 
00385         ibyte2 = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a12">KiNextIStreamByte</a> (UserFrame, &amp;istream);
00386         inmodrm = (ibyte2 &gt;&gt; 3) &amp; 0x7;
00387 
00388         <span class="keywordflow">for</span> (i=0; <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a10">NoWaitNpxInstructions</a>[i].Opcode1; i++) {
00389             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a10">NoWaitNpxInstructions</a>[i].Opcode1 == ibyte1) {
00390 
00391                 <span class="comment">//</span>
00392                 <span class="comment">// first opcode byte matched - check second part of opcode</span>
00393                 <span class="comment">//</span>
00394 
00395                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a10">NoWaitNpxInstructions</a>[i].ModRm) {
00396 
00397                     <span class="comment">//</span>
00398                     <span class="comment">// modrm only applies for opcode in range 0-0xbf</span>
00399                     <span class="comment">//</span>
00400 
00401                     <span class="keywordflow">if</span> (((ibyte2 &amp; 0xc0) != 0xc0) &amp;&amp;
00402                         (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a10">NoWaitNpxInstructions</a>[i].Opcode2 == inmodrm)) {
00403 
00404                         <span class="comment">//</span>
00405                         <span class="comment">// This is a no-wait NPX instruction</span>
00406                         <span class="comment">//</span>
00407 
00408                         status = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a10">NoWaitNpxInstructions</a>[i].type;
00409                         <span class="keywordflow">break</span>;
00410                     }
00411 
00412                 } <span class="keywordflow">else</span> {
00413                     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a10">NoWaitNpxInstructions</a>[i].Opcode2 == ibyte2) {
00414 
00415                         <span class="comment">//</span>
00416                         <span class="comment">// This is a no-wait NPX instruction</span>
00417                         <span class="comment">//</span>
00418 
00419                         status = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a10">NoWaitNpxInstructions</a>[i].type;
00420                         <span class="keywordflow">break</span>;
00421                     }
00422                 }
00423             }
00424         }
00425 
00426     } except (EXCEPTION_EXECUTE_HANDLER) {
00427         <span class="comment">// do nothing...</span>
00428     }
00429 
00430     <span class="keywordflow">if</span> (status == 0) {
00431         <span class="comment">//</span>
00432         <span class="comment">// Dispatch coprocessor exception to user mode</span>
00433         <span class="comment">//</span>
00434 
00435         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00436     }
00437 
00438     <span class="keywordflow">if</span> (status == 1) {
00439         <span class="comment">//</span>
00440         <span class="comment">// Ignore pending exception, user mode instruction does not trap</span>
00441         <span class="comment">// on pending execptions and it will clear/mask the pending exceptions</span>
00442         <span class="comment">//</span>
00443 
00444         _asm {
00445             mov     eax, cr0
00446             and     eax, NOT (CR0_MP+CR0_EM+CR0_TS)
00447             mov     cr0, eax
00448         }
00449 
00450         NpxFrame-&gt;Cr0NpxState &amp;= ~CR0_TS;
00451         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00452     }
00453 
00454     <span class="comment">//</span>
00455     <span class="comment">// This is either FNSTSW or FNSTCW.  Both of these instructions get</span>
00456     <span class="comment">// a value from the coprocessor without effecting the pending exception</span>
00457     <span class="comment">// state.  To do this we emulate the instructions.</span>
00458     <span class="comment">//</span>
00459 
00460     <span class="comment">//</span>
00461     <span class="comment">// Read the coprocessors Status &amp; Control word state, then re-enable</span>
00462     <span class="comment">// interrupts.  (it's safe to context switch after that point)</span>
00463     <span class="comment">//</span>
00464 
00465     _asm {
00466         mov     eax, cr0
00467         mov     ecx, eax
00468         and     eax, NOT (CR0_MP+CR0_EM+CR0_TS)
00469         mov     cr0, eax
00470 
00471         fnstsw  StatusWord
00472         fnstcw  ControlWord
00473 
00474         mov     cr0, ecx
00475         sti
00476     }
00477 
00478     <span class="keywordflow">if</span> (status == 4) {
00479         <span class="comment">//</span>
00480         <span class="comment">// Emulate FNSTSW AX</span>
00481         <span class="comment">//</span>
00482 
00483         UserFrame-&gt;Eip = (ULONG)istream;
00484         UserFrame-&gt;Eax = (UserFrame-&gt;Eax &amp; 0xFFFF0000) | StatusWord;
00485         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00486     }
00487 
00488     <span class="keywordflow">if</span> (status == 2) {
00489         UsersWord = ControlWord;
00490     } <span class="keywordflow">else</span> {
00491         UsersWord = StatusWord;
00492     }
00493 
00494     <span class="keywordflow">try</span> {
00495 
00496         <span class="comment">//</span>
00497         <span class="comment">// (PERFNOTE: the operand decode code should really share code with</span>
00498         <span class="comment">// KiCheckDivideByZeroTrap, but this is a late change therefore the</span>
00499         <span class="comment">// code was copied to keep the impact of the change localized)</span>
00500         <span class="comment">//</span>
00501 
00502         <span class="comment">//</span>
00503         <span class="comment">// decode Mod/RM byte</span>
00504         <span class="comment">//</span>
00505 
00506         Mod = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a5">MOD32</a> + (ibyte2 &gt;&gt; 6);
00507         rm  = ibyte2 &amp; 7;
00508 
00509         <span class="comment">//</span>
00510         <span class="comment">// Decode the instruction's word pointer into accum</span>
00511         <span class="comment">//</span>
00512 
00513         accum = 0;
00514         <span class="keywordflow">if</span> (rm != Mod-&gt;RmDisplaceOnly) {
00515             <span class="keywordflow">if</span> (rm == Mod-&gt;RmSib) {
00516                 <span class="comment">// get SIB</span>
00517                 ibyte1 = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a12">KiNextIStreamByte</a> (UserFrame, &amp;istream);
00518                 i = (ibyte1 &gt;&gt; 3) &amp; 7;
00519                 <span class="keywordflow">if</span> (i != 4) {
00520                     accum = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a1">GETREG</a>(UserFrame, RM32[i]);
00521                     accum = accum &lt;&lt; (ibyte1 &gt;&gt; 6);    <span class="comment">// apply scaler</span>
00522                 }
00523                 i = ibyte1 &amp; 7;
00524                 accum = accum + <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a1">GETREG</a>(UserFrame, RM32[i]);
00525             } <span class="keywordflow">else</span> {
00526                 <span class="comment">// get register's value</span>
00527                 accum = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a1">GETREG</a>(UserFrame, RM32[rm]);
00528             }
00529         }
00530 
00531         <span class="comment">//</span>
00532         <span class="comment">// apply displacement to accum</span>
00533         <span class="comment">//</span>
00534 
00535         <span class="keywordflow">if</span> (Mod-&gt;RmDisplace &amp; (1 &lt;&lt; rm)) {
00536             <span class="keywordflow">if</span> (Mod-&gt;Disp == 4) {
00537                 i = (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a12">KiNextIStreamByte</a> (UserFrame, &amp;istream) &lt;&lt; 0) |
00538                     (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a12">KiNextIStreamByte</a> (UserFrame, &amp;istream) &lt;&lt; 8) |
00539                     (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a12">KiNextIStreamByte</a> (UserFrame, &amp;istream) &lt;&lt; 16) |
00540                     (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a12">KiNextIStreamByte</a> (UserFrame, &amp;istream) &lt;&lt; 24);
00541             } <span class="keywordflow">else</span> {
00542                 ibyte1 = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a12">KiNextIStreamByte</a> (UserFrame, &amp;istream);
00543                 i = (<span class="keywordtype">signed</span> <span class="keywordtype">long</span>) ((<span class="keywordtype">signed</span> <span class="keywordtype">char</span>) ibyte1);    <span class="comment">// sign extend</span>
00544             }
00545             accum += i;
00546         }
00547 
00548         <span class="comment">//</span>
00549         <span class="comment">// Set the word pointer</span>
00550         <span class="comment">//</span>
00551 
00552         <span class="keywordflow">if</span> (UserFrame-&gt;SegCs == KGDT_R0_CODE) {
00553             *((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>) accum) = UsersWord;
00554         } <span class="keywordflow">else</span> {
00555             <a class="code" href="../../d5/d8/ex_8h.html#a48">ProbeAndWriteUshort</a> ((PUSHORT) accum, UsersWord);
00556         }
00557         UserFrame-&gt;Eip = (ULONG)istream;
00558 
00559     } except (<a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a12">KiCopyInformation</a>(&amp;ExceptionRecord,
00560                 (GetExceptionInformation())-&gt;ExceptionRecord)) {
00561         <span class="comment">//</span>
00562         <span class="comment">// Faulted addressing user's memory.</span>
00563         <span class="comment">// Set the address of the exception to the current program address</span>
00564         <span class="comment">// and raise the exception by calling the exception dispatcher.</span>
00565         <span class="comment">//</span>
00566 
00567         ExceptionRecord.ExceptionAddress = (PVOID)(UserFrame-&gt;Eip);
00568         <a class="code" href="../../d2/d9/ppc_2exceptn_8c.html#a11">KiDispatchException</a>(
00569             &amp;ExceptionRecord,
00570             NULL,                <span class="comment">// ExceptionFrame</span>
00571             UserFrame,
00572             UserMode,
00573             TRUE
00574         );
00575     }
00576 
00577     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00578 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="i386/trapc.c::Ki386CheckDivideByZeroTrap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS Ki386CheckDivideByZeroTrap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>UserFrame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00090">90</a> of file <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html">i386/trapc.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00036">GETREG</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00067">MOD32</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d5/i386_2trapc_8c.html#a2">PKMOD</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01248">ProbeAndReadChar</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01261">ProbeAndReadUchar</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01339">ProbeAndReadUlong</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01287">ProbeAndReadUshort</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00045">RM32</a>, <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00056">RM8</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00035">UNEXPECTED_KERNEL_MODE_TRAP</a>.
<p>
<pre class="fragment"><div>00095                    :
00096 
00097     This function gains <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> x86 processor generates a
00098     divide by zero trap.  The x86 design generates such a trap on
00099     divide by zero and on division overflows.  In order to determine
00100     which expection code to dispatch, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> divisor of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="stringliteral">"div"</span> or <span class="stringliteral">"idiv"</span>
00101     instruction needs to be inspected.
00102 
00103 Arguments:
00104 
00105     UserFrame - Trap frame of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> divide by zero trap
00106 
00107 Return Value:
00108 
00109     exception code dispatch
00110 
00111 --*/
00112 {
00113     ULONG       operandsize, operandmask, i, accum;
00114     PUCHAR      istream, pRM;
00115     UCHAR       ibyte, rm;
00116     <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a2">PKMOD</a>       Mod;
00117     BOOLEAN     fPrefix;
00118     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    status;
00119 
00120     status = STATUS_INTEGER_DIVIDE_BY_ZERO;
00121 
00122     <span class="keywordflow">if</span> (UserFrame-&gt;SegCs == KGDT_R0_CODE) {
00123         <span class="comment">//</span>
00124         <span class="comment">// Divide by zero exception from Kernel Mode?</span>
00125         <span class="comment">// Likely bad hardware interrupt and the device or vector table is corrupt.</span>
00126         <span class="comment">// Bugcheck NOW so we can figure out what went wrong. If we try and</span>
00127         <span class="comment">// proceed, then we'll likely fault in reading the top of user space, and then</span>
00128         <span class="comment">// double fault (page fault in the div zero handler.) -- This is a debugging</span>
00129         <span class="comment">// consideration. You can't put breakpoints on the trap labels  so this is hard to debug.</span>
00130         <span class="comment">// We cannot recover</span>
00131         <span class="comment">//</span>
00132         <span class="comment">//</span>
00133         <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a> (UNEXPECTED_KERNEL_MODE_TRAP);
00134 
00135     }
00136 
00137 
00138     <span class="keywordflow">try</span> {
00139 
00140         <span class="comment">//</span>
00141         <span class="comment">// read instruction prefixes</span>
00142         <span class="comment">//</span>
00143 
00144         fPrefix = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00145         pRM = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a3">RM32</a>;
00146         operandsize = 4;
00147         operandmask = 0xffffffff;
00148         istream = (PUCHAR) UserFrame-&gt;Eip;
00149         <span class="keywordflow">while</span> (fPrefix) {
00150             ibyte = <a class="code" href="../../d5/d8/ex_8h.html#a14">ProbeAndReadUchar</a>(istream);
00151             istream++;
00152             <span class="keywordflow">switch</span> (ibyte) {
00153                 <span class="keywordflow">case</span> 0x2e:  <span class="comment">// cs override</span>
00154                 <span class="keywordflow">case</span> 0x36:  <span class="comment">// ss override</span>
00155                 <span class="keywordflow">case</span> 0x3e:  <span class="comment">// ds override</span>
00156                 <span class="keywordflow">case</span> 0x26:  <span class="comment">// es override</span>
00157                 <span class="keywordflow">case</span> 0x64:  <span class="comment">// fs override</span>
00158                 <span class="keywordflow">case</span> 0x65:  <span class="comment">// gs override</span>
00159                 <span class="keywordflow">case</span> 0xF3:  <span class="comment">// rep</span>
00160                 <span class="keywordflow">case</span> 0xF2:  <span class="comment">// rep</span>
00161                 <span class="keywordflow">case</span> 0xF0:  <span class="comment">// lock</span>
00162                     <span class="keywordflow">break</span>;
00163 
00164                 <span class="keywordflow">case</span> 0x66:
00165                     <span class="comment">// 16 bit operand override</span>
00166                     operandsize = 2;
00167                     operandmask = 0xffff;
00168                     <span class="keywordflow">break</span>;
00169 
00170                 <span class="keywordflow">case</span> 0x67:
00171                     <span class="comment">// 16 bit address size override</span>
00172                     <span class="comment">// this is some non-flat code</span>
00173                     <span class="keywordflow">goto</span> try_exit;
00174 
00175                 <span class="keywordflow">default</span>:
00176                     fPrefix = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00177                     <span class="keywordflow">break</span>;
00178             }
00179         }
00180 
00181         <span class="comment">//</span>
00182         <span class="comment">// Check instruction opcode</span>
00183         <span class="comment">//</span>
00184 
00185         <span class="keywordflow">if</span> (ibyte != 0xf7  &amp;&amp;  ibyte != 0xf6) {
00186             <span class="comment">// this is not a DIV or IDIV opcode</span>
00187             <span class="keywordflow">goto</span> try_exit;
00188         }
00189 
00190         <span class="keywordflow">if</span> (ibyte == 0xf6) {
00191             <span class="comment">// this is a byte div or idiv</span>
00192             operandsize = 1;
00193             operandmask = 0xff;
00194         }
00195 
00196         <span class="comment">//</span>
00197         <span class="comment">// Get Mod R/M</span>
00198         <span class="comment">//</span>
00199 
00200         ibyte = <a class="code" href="../../d5/d8/ex_8h.html#a14">ProbeAndReadUchar</a> (istream);
00201         istream++;
00202         Mod = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a5">MOD32</a> + (ibyte &gt;&gt; 6);
00203         rm  = ibyte &amp; 7;
00204 
00205         <span class="comment">//</span>
00206         <span class="comment">// put register values into accum</span>
00207         <span class="comment">//</span>
00208 
00209         <span class="keywordflow">if</span> (operandsize == 1  &amp;&amp;  (ibyte &amp; 0xc0) == 0xc0) {
00210             pRM = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a4">RM8</a>;
00211         }
00212 
00213         accum = 0;
00214         <span class="keywordflow">if</span> (rm != Mod-&gt;RmDisplaceOnly) {
00215             <span class="keywordflow">if</span> (rm == Mod-&gt;RmSib) {
00216                 <span class="comment">// get SIB</span>
00217                 ibyte = <a class="code" href="../../d5/d8/ex_8h.html#a14">ProbeAndReadUchar</a>(istream);
00218                 istream++;
00219                 i = (ibyte &gt;&gt; 3) &amp; 7;
00220                 <span class="keywordflow">if</span> (i != 4) {
00221                     accum = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a1">GETREG</a>(UserFrame, RM32[i]);
00222                     accum = accum &lt;&lt; (ibyte &gt;&gt; 6);    <span class="comment">// apply scaler</span>
00223                 }
00224                 i = ibyte &amp; 7;
00225                 accum = accum + <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a1">GETREG</a>(UserFrame, RM32[i]);
00226             } <span class="keywordflow">else</span> {
00227                 <span class="comment">// get register's value</span>
00228                 accum = <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a1">GETREG</a>(UserFrame, pRM[rm]);
00229             }
00230         }
00231 
00232         <span class="comment">//</span>
00233         <span class="comment">// apply displacement to accum</span>
00234         <span class="comment">//</span>
00235 
00236         <span class="keywordflow">if</span> (Mod-&gt;RmDisplace &amp; (1 &lt;&lt; rm)) {
00237             <span class="keywordflow">if</span> (Mod-&gt;Disp == 4) {
00238                 i = <a class="code" href="../../d5/d8/ex_8h.html#a20">ProbeAndReadUlong</a> ((PULONG) istream);
00239             } <span class="keywordflow">else</span> {
00240                 ibyte = <a class="code" href="../../d5/d8/ex_8h.html#a13">ProbeAndReadChar</a> (istream);
00241                 i = (<span class="keywordtype">signed</span> <span class="keywordtype">long</span>) ((<span class="keywordtype">signed</span> <span class="keywordtype">char</span>) ibyte);    <span class="comment">// sign extend</span>
00242             }
00243             accum += i;
00244         }
00245 
00246         <span class="comment">//</span>
00247         <span class="comment">// if this is an effective address, go get the data value</span>
00248         <span class="comment">//</span>
00249 
00250         <span class="keywordflow">if</span> (Mod-&gt;Disp) {
00251             <span class="keywordflow">switch</span> (operandsize) {
00252                 <span class="keywordflow">case</span> 1:  accum = <a class="code" href="../../d5/d8/ex_8h.html#a14">ProbeAndReadUchar</a>((PUCHAR) accum);    <span class="keywordflow">break</span>;
00253                 <span class="keywordflow">case</span> 2:  accum = <a class="code" href="../../d5/d8/ex_8h.html#a16">ProbeAndReadUshort</a>((PUSHORT) accum);  <span class="keywordflow">break</span>;
00254                 <span class="keywordflow">case</span> 4:  accum = <a class="code" href="../../d5/d8/ex_8h.html#a20">ProbeAndReadUlong</a>((PULONG) accum);    <span class="keywordflow">break</span>;
00255             }
00256         }
00257 
00258         <span class="comment">//</span>
00259         <span class="comment">// accum now contains the instruction operand, see if the</span>
00260         <span class="comment">// operand was really a zero</span>
00261         <span class="comment">//</span>
00262 
00263         <span class="keywordflow">if</span> (accum &amp; operandmask) {
00264             <span class="comment">// operand was non-zero, must be an overflow</span>
00265             status = STATUS_INTEGER_OVERFLOW;
00266         }
00267 
00268 try_exit: ;
00269     } except (EXCEPTION_EXECUTE_HANDLER) {
00270         <span class="comment">// do nothing...</span>
00271     }
00272 
00273     <span class="keywordflow">return</span> status;
00274 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="i386/trapc.c::KiNextIStreamByte" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR KiNextIStreamByte           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>UserFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUCHAR *&nbsp;</td>
          <td class="mdname" nowrap> <em>istream</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00277">277</a> of file <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html">i386/trapc.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l01261">ProbeAndReadUchar</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00309">Ki386CheckDelayedNpxTrap()</a>.
<p>
<pre class="fragment"><div>00283                    :
00284 
00285     Reads <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next byte from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> istream pointed to by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> UserFrame, and
00286     advances <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d8/d3/ia32def_8h.html#a123">EIP</a>.
00287 
00288 
00289     Note: <span class="keyword">this</span> function works <span class="keywordflow">for</span> 32 bit code <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a>
00290 
00291 --*/
00292 {
00293     UCHAR   ibyte;
00294 
00295     <span class="keywordflow">if</span> (UserFrame-&gt;SegCs == KGDT_R0_CODE) {
00296         ibyte = **istream;
00297     } <span class="keywordflow">else</span> {
00298         ibyte = <a class="code" href="../../d5/d8/ex_8h.html#a14">ProbeAndReadUchar</a> (*istream);
00299     }
00300 
00301     *istream += 1;
00302     <span class="keywordflow">return</span> ibyte;
00303 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a5" doxytag="i386/trapc.c::MOD32" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d8/structKMOD.html">KMOD</a> <a class="el" href="../../d0/d5/vdmnpx_8c.html#a1">MOD32</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
         5,     4,   0x20,   4,
      0xff,     4,   0xff,   1,
      0xff,     4,   0xff,   4,
      0xff,  0xff,   0x00,   0
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00067">67</a> of file <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html">i386/trapc.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00309">Ki386CheckDelayedNpxTrap()</a>, and <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00090">Ki386CheckDivideByZeroTrap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="i386/trapc.c::ModRm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR <a class="el" href="../../d4/d4/iafptrap_8c.html#a8">ModRm</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00076">76</a> of file <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html">i386/trapc.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="i386/trapc.c::NoWaitNpxInstructions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct { ... }   <a class="el" href="../../d4/d4/iafptrap_8c.html#a10">NoWaitNpxInstructions</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00309">Ki386CheckDelayedNpxTrap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="i386/trapc.c::Opcode1" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR <a class="el" href="../../d4/d4/iafptrap_8c.html#a6">Opcode1</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00075">75</a> of file <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html">i386/trapc.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="i386/trapc.c::Opcode2" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR <a class="el" href="../../d4/d4/iafptrap_8c.html#a7">Opcode2</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00075">75</a> of file <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html">i386/trapc.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="i386/trapc.c::RM32" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR <a class="el" href="../../d4/d4/iafptrap_8c.html#a3">RM32</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Eax),
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Ecx),
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Edx),
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Ebx),
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(HardwareEsp),
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Ebp),       
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Esi),
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Edi)
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00045">45</a> of file <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html">i386/trapc.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00309">Ki386CheckDelayedNpxTrap()</a>, and <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00090">Ki386CheckDivideByZeroTrap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="i386/trapc.c::RM8" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR <a class="el" href="../../d4/d4/iafptrap_8c.html#a4">RM8</a>[]<code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Eax),       
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Ecx),       
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Edx),       
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Ebx),       
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Eax) + 1,   
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Ecx) + 1,   
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Edx) + 1,   
       <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a0">REG</a>(Ebx) + 1    
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00056">56</a> of file <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html">i386/trapc.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00090">Ki386CheckDivideByZeroTrap()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="i386/trapc.c::type" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR <a class="el" href="../../d4/d4/iafptrap_8c.html#a9">type</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html#l00076">76</a> of file <a class="el" href="../../d4/d4/i386_2trapc_8c-source.html">i386/trapc.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d2/parseini_8c-source.html#l00219">CmpAppendSection()</a>, <a class="el" href="../../d0/d3/rules_8c-source.html#l01703">CmpGetInfData()</a>, <a class="el" href="../../d4/d7/handles_8c-source.html#l00075">CreateHandle()</a>, <a class="el" href="../../d3/d2/ldrsnap_8c-source.html#l01261">LdrpMapDll()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l00966">List()</a>, <a class="el" href="../../d5/d8/clres_8c-source.html#l02544">LoadDIB()</a>, <a class="el" href="../../d5/d8/clres_8c-source.html#l02657">LoadIcoCur()</a>, <a class="el" href="../../d5/d8/clres_8c-source.html#l02414">LoadImageA()</a>, <a class="el" href="../../d3/d4/editreg_8c-source.html#l02460">main()</a>, <a class="el" href="../../d5/d8/clres_8c-source.html#l02847">ObjectFromDIBResource()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00136">OpenUserPerformanceData()</a>, <a class="el" href="../../d4/d1/rtlres_8c-source.html#l00142">RtlLoadObjectFromDIBFile()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02519">UserGetDesktopDC()</a>, <a class="el" href="../../d5/d8/clres_8c-source.html#l04200">WowServerLoadCreateCursorIcon()</a>, and <a class="el" href="../../d9/d2/movesize_8c-source.html#l01562">xxxDrawDragRect()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
