<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: editsl.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>editsl.c File Reference</h1><code>#include "<a class="el" href="../../d8/d2/w32_2ntuser_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d4/d4/editsl_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a0">SYS_ALTERNATE</a>&nbsp;&nbsp;&nbsp;0x2000</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOL(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a1">FnGetTextExtentPoint</a> )(HDC, PVOID, int, LPSIZE)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a2">SLCalcStringWidth</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ich, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> cch)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a3">SLCalcXOffsetLeft</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ich)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a4">SLCalcXOffsetSpecial</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ich)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a5">SLSetCaretPosition</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a6">SLIchToLeftXPos</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ich)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a7">SLSetSelection</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ichSelStart, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ichSelEnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a8">SLGetClipRect</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ichStart, int iCount, LPRECT lpClipRect)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a9">SLChangeSelection</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ichNewMinSel, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ichNewMaxSel)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a10">SLDrawLine</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc, int xClipStPos, int xClipEndPos, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ichStart, int iCount, BOOL fSelStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a11">SLGetBlkEnd</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ichStart, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ichEnd, BOOL FAR *lpfStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a12">SLDrawText</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ichStart)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a13">SLScrollText</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a14">SLInsertText</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, LPSTR lpText, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> cchInsert)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> PASCAL NEAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a15">SLPasteText</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a16">SLReplaceSel</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, LPSTR lpText)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a17">SLChar</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> keyValue)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a18">SLMoveSelectionRestricted</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> ich, BOOL fLeft)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a19">SLKeyDown</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> virtKeyCode, int keyMods)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a20">SLMouseToIch</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc, LPPOINT mousePt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a21">SLMouseMotion</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, UINT message, UINT virtKeyDown, LPPOINT mousePt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a22">SLPaint</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HDC hdc)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a23">SLSetFocus</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a24">SLKillFocus</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, HWND newFocusHwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a25">SLPaste</a> (<a class="el" href="../../d3/d4/structtagED.html">PED</a> ped)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LRESULT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/editsl_8c.html#a26">SLEditWndProc</a> (HWND hwnd, <a class="el" href="../../d3/d4/structtagED.html">PED</a> ped, UINT message, WPARAM wParam, LPARAM lParam)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="editsl.c::SYS_ALTERNATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SYS_ALTERNATE&nbsp;&nbsp;&nbsp;0x2000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00021">21</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d8/clmsg_8c-source.html#l00574">DefWindowProcWorker()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>, <a class="el" href="../../d6/d8/dlgmgr2_8c-source.html#l00317">IsDialogMessageW()</a>, <a class="el" href="../../d2/d4/editml_8c-source.html#l03457">MLEditWndProc()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>, <a class="el" href="../../d2/d1/mnaccel_8c-source.html#l00461">SystoChar()</a>, and <a class="el" href="../../d9/d2/dwp_8c-source.html#l01264">xxxDefWindowProc()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a1" doxytag="editsl.c::FnGetTextExtentPoint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOL(* <a class="el" href="../../d3/d5/editsl_8c.html#a1">FnGetTextExtentPoint</a>)(HDC, PVOID, int, LPSIZE)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00023">23</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l01934">SLMouseToIch()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a2" doxytag="editsl.c::SLCalcStringWidth" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int SLCalcStringWidth           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ich</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cch</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00030">30</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00677">tagED::aveCharWidth</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00679">tagED::charOverhang</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00578">tagED::charPasswordChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00582">tagED::cPasswordCharWidth</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00611">tagED::fDBCS</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00605">tagED::fNonPropFont</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l00062">SLCalcXOffsetLeft()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00080">SLCalcXOffsetSpecial()</a>.
<p>
<pre class="fragment"><div>00031 {
00032     <span class="keywordflow">if</span> (cch == 0)
00033         <span class="keywordflow">return</span> 0;
00034 
00035     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a>) {
00036         <span class="keywordflow">return</span> cch * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o13">cPasswordCharWidth</a>;
00037     } <span class="keywordflow">else</span> {
00038         SIZE size;
00039 
00040         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o26">fNonPropFont</a> &amp;&amp; !ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o32">fDBCS</a>) {
00041             size.cx = cch * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a>;
00042         } <span class="keywordflow">else</span> {
00043             PSTR pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00044             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>) {
00045                 GetTextExtentPointA(hdc, (LPSTR)(pText + ich), cch, &amp;size);
00046             } <span class="keywordflow">else</span> {
00047                 GetTextExtentPointW(hdc, (LPWSTR)pText + ich, cch, &amp;size);
00048             }
00049             <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00050         }
00051         <span class="keywordflow">return</span> size.cx - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o69">charOverhang</a>;
00052     }
00053 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="editsl.c::SLCalcXOffsetLeft" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int SLCalcXOffsetLeft           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ich</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00062">62</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00570">tagED::ichScreenStart</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00030">SLCalcStringWidth()</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l00080">SLCalcXOffsetSpecial()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00507">SLDrawLine()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00323">SLGetClipRect()</a>.
<p>
<pre class="fragment"><div>00063 {
00064     <span class="keywordtype">int</span> cch = (<span class="keywordtype">int</span>)(ich - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>);
00065 
00066     <span class="keywordflow">if</span> (cch &lt;= 0)
00067         <span class="keywordflow">return</span> 0;
00068 
00069     <span class="keywordflow">return</span> <a class="code" href="../../d3/d5/editsl_8c.html#a2">SLCalcStringWidth</a>(ped, hdc, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>, cch);
00070 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="editsl.c::SLCalcXOffsetSpecial" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int SLCalcXOffsetSpecial           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ich</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00080">80</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00661">tagED::cbChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01281">ECCchInWidth()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00664">tagED::format</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00570">tagED::ichScreenStart</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00030">SLCalcStringWidth()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00062">SLCalcXOffsetLeft()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l00507">SLDrawLine()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00323">SLGetClipRect()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00182">SLIchToLeftXPos()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l01934">SLMouseToIch()</a>.
<p>
<pre class="fragment"><div>00081 {
00082     PSTR pText;
00083     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> cch, ichStart = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>;
00084     <span class="keywordtype">int</span> cx;
00085 
00086     <span class="comment">/*</span>
00087 <span class="comment">     * Calc the number of characters from start to right end.</span>
00088 <span class="comment">     */</span>
00089     pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00090     cch = <a class="code" href="../../d6/d0/usercli_8h.html#a443">ECCchInWidth</a>(ped, hdc, (LPSTR)(pText + ichStart * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>),
00091             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> - ichStart, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left, TRUE);
00092     <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00093 
00094     <span class="comment">/*</span>
00095 <span class="comment">     * Once the last character of the string has been scrolled out of</span>
00096 <span class="comment">     * the view, use normal offset calculation.</span>
00097 <span class="comment">     */</span>
00098     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> + cch &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>)
00099         <span class="keywordflow">return</span> <a class="code" href="../../d3/d5/editsl_8c.html#a3">SLCalcXOffsetLeft</a>(ped, hdc, ich);
00100 
00101     cx = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left - <a class="code" href="../../d3/d5/editsl_8c.html#a2">SLCalcStringWidth</a>(ped,
00102             hdc, ichStart, cch);
00103 
00104     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> == ES_CENTER) {
00105          cx = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(0, cx / 2);
00106     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> == ES_RIGHT) {
00107         <span class="comment">/*</span>
00108 <span class="comment">         * Subtract 1 so that the 1 pixel wide cursor will be in the visible</span>
00109 <span class="comment">         * region on the very right side of the screen, mle does this.</span>
00110 <span class="comment">         */</span>
00111         cx = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(0, cx - 1);
00112     }
00113 
00114     <span class="keywordflow">return</span> cx + <a class="code" href="../../d3/d5/editsl_8c.html#a2">SLCalcStringWidth</a>(ped, hdc, ichStart, ich - ichStart);
00115 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="editsl.c::SLChangeSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLChangeSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ichNewMinSel</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ichNewMaxSel</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00395">395</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00860">_IsWindowVisible()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04133">ECAdjustIch()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l03692">ECCalcChangeSelection()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01412">ECGetBrush()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03294">tagLPKEDITCALLOUT::EditDrawText</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00758">tagBLOCK::EndPos</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00611">tagED::fDBCS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00610">tagED::fNoHideSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05279">NtUserHideCaret()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06219">NtUserShowCaret()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00585">tagED::pwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00507">SLDrawLine()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00323">SLGetClipRect()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00126">SLSetCaretPosition()</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00757">tagBLOCK::StPos</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l01529">SLKeyDown()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02098">SLMouseMotion()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00283">SLSetSelection()</a>.
<p>
<pre class="fragment"><div>00400 {
00401     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> temp;
00402     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> ichOldMinSel;
00403     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> ichOldMaxSel;
00404 
00405     <span class="keywordflow">if</span> (ichNewMinSel &gt; ichNewMaxSel) {
00406         temp = ichNewMinSel;
00407         ichNewMinSel = ichNewMaxSel;
00408         ichNewMaxSel = temp;
00409     }
00410     ichNewMinSel = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(ichNewMinSel, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>);
00411     ichNewMaxSel = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(ichNewMaxSel, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>);
00412 
00413     <span class="comment">//</span>
00414     <span class="comment">// To avoid position to half of DBCS, check and ajust position if necessary</span>
00415     <span class="comment">//</span>
00416     <span class="comment">// We check ped-&gt;fDBCS and ped-&gt;fAnsi though ECAdjustIch checks these bits.</span>
00417     <span class="comment">// We're worrying about the overhead of EcLock and EcUnlock.</span>
00418     <span class="comment">//</span>
00419     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o32">fDBCS</a> &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>) {
00420         PSTR pText;
00421 
00422         pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00423         ichNewMinSel = <a class="code" href="../../d6/d0/usercli_8h.html#a461">ECAdjustIch</a>( ped, pText, ichNewMinSel );
00424         ichNewMaxSel = <a class="code" href="../../d6/d0/usercli_8h.html#a461">ECAdjustIch</a>( ped, pText, ichNewMaxSel );
00425         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00426     }
00427 
00428     <span class="comment">/*</span>
00429 <span class="comment">     * Preserve the Old selection</span>
00430 <span class="comment">     */</span>
00431     ichOldMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>;
00432     ichOldMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>;
00433 
00434     <span class="comment">/*</span>
00435 <span class="comment">     * Set new selection</span>
00436 <span class="comment">     */</span>
00437     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> = ichNewMinSel;
00438     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> = ichNewMaxSel;
00439 
00440     <span class="comment">/*</span>
00441 <span class="comment">     * We will find the intersection of current selection rectangle with the new</span>
00442 <span class="comment">     * selection rectangle. We will then invert the parts of the two rectangles</span>
00443 <span class="comment">     * not in the intersection.</span>
00444 <span class="comment">     */</span>
00445     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a17">_IsWindowVisible</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>) &amp;&amp; (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a> || ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o31">fNoHideSel</a>)) {
00446         <a class="code" href="../../d7/d8/structtagBLOCK.html">BLOCK</a> Blk[2];
00447         <span class="keywordtype">int</span>   i;
00448         RECT  rc;
00449 
00450         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a>)
00451             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a204">NtUserHideCaret</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>);
00452 
00453         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
00454             <span class="comment">/*</span>
00455 <span class="comment">             * The language pack handles display while complex script support present</span>
00456 <span class="comment">             */</span>
00457             PSTR pText;
00458 
00459             <a class="code" href="../../d6/d0/usercli_8h.html#a480">ECGetBrush</a>(ped, hdc);   <span class="comment">// Give user a chance to manipulate the DC</span>
00460             pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00461             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>-&gt;<a class="code" href="../../d2/d0/structtagLPKEDITCALLOUT.html#o5">EditDrawText</a>(ped, hdc, pText, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.top);
00462             <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00463         } <span class="keywordflow">else</span> {
00464             Blk[0].<a class="code" href="../../d7/d8/structtagBLOCK.html#o0">StPos</a> = ichOldMinSel;
00465             Blk[0].<a class="code" href="../../d7/d8/structtagBLOCK.html#o1">EndPos</a> = ichOldMaxSel;
00466             Blk[1].<a class="code" href="../../d7/d8/structtagBLOCK.html#o0">StPos</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>;
00467             Blk[1].<a class="code" href="../../d7/d8/structtagBLOCK.html#o1">EndPos</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>;
00468 
00469             <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a457">ECCalcChangeSelection</a>(ped, ichOldMinSel, ichOldMaxSel,
00470                 (<a class="code" href="../../d7/d8/structtagBLOCK.html">LPBLOCK</a>)&amp;Blk[0], (<a class="code" href="../../d7/d8/structtagBLOCK.html">LPBLOCK</a>)&amp;Blk[1])) {
00471 
00472                 <span class="comment">//</span>
00473                 <span class="comment">// Paint the rectangles where selection has changed.</span>
00474                 <span class="comment">// Paint both Blk[0] and Blk[1], if they exist.</span>
00475                 <span class="comment">//</span>
00476                 <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
00477                     <span class="keywordflow">if</span> (Blk[i].<a class="code" href="../../d7/d8/structtagBLOCK.html#o0">StPos</a> != 0xFFFFFFFF) {
00478                                <a class="code" href="../../d3/d5/editsl_8c.html#a8">SLGetClipRect</a>(ped, hdc, Blk[i].StPos,
00479                                                        Blk[i].EndPos - Blk[i].StPos, (LPRECT)&amp;rc);
00480                                <a class="code" href="../../d6/d0/usercli_8h.html#a528">SLDrawLine</a>(ped, hdc, rc.left, rc.right, Blk[i].StPos,
00481                                                     Blk[i].EndPos - Blk[i].StPos,
00482                                           ((Blk[i].StPos &gt;= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>) &amp;&amp;
00483                                        (Blk[i].StPos &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>)));
00484                     }
00485                 }
00486             }
00487         }
00488 
00489         <span class="comment">//</span>
00490         <span class="comment">// Update caret.</span>
00491         <span class="comment">//</span>
00492         <a class="code" href="../../d6/d0/usercli_8h.html#a524">SLSetCaretPosition</a>(ped, hdc);
00493 
00494         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a>)
00495             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a234">NtUserShowCaret</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>);
00496     }
00497 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="editsl.c::SLChar" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLChar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>keyValue</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l01304">1304</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04109">DbcsCombine()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02293">ECDeleteText()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00402">ECInOutReconversionMode()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01010">ECIsCharNumeric()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04083">ECIsDBCSLeadByte()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02429">ECNotifyParent()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04001">ECPrevIch()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02502">EFNUMBER</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00642">tagED::f40Compat</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00601">tagED::fMouseDown</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00664">tagED::format</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00632">tagED::fReadOnly</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01265">FWINABLE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00587">tagED::hwndParent</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00564">tagED::ichCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00590">IS_DBCS_ENABLED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00591">IS_IME_ENABLED</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00277">IsWindow()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00682">tagED::listboxHwnd</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00354">NotifyWinEvent()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04510">NtUserCallNoParam()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01564">NtUserMessageBeep</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00585">tagED::pwnd</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01074">SLInsertText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00932">SLScrollText()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00695">tagED::wMaxNegCcharPos</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l01529">SLKeyDown()</a>.
<p>
<pre class="fragment"><div>01307 {
01308     HDC hdc;
01309     WCHAR keyPress;
01310     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> updateText = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01311     HWND hwndSave = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>;
01312     <span class="keywordtype">int</span> InsertTextLen = 1;
01313     <span class="keywordtype">int</span> DBCSkey;
01314 
01315     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>)
01316         keyPress = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(keyValue);
01317     <span class="keywordflow">else</span>
01318         keyPress = LOWORD(keyValue);
01319 
01320     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o22">fMouseDown</a> || (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o39">fReadOnly</a> &amp;&amp; keyPress != 3)) {
01321 
01322         <span class="comment">/*</span>
01323 <span class="comment">         * Don't do anything if we are in the middle of a mousedown deal or if</span>
01324 <span class="comment">         * this is a read only edit control, with exception of allowing</span>
01325 <span class="comment">         * ctrl-C in order to copy to the clipboard.</span>
01326 <span class="comment">         */</span>
01327         <span class="keywordflow">return</span> ;
01328     }
01329 
01330     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a126">IS_IME_ENABLED</a>()) {
01331         <a class="code" href="../../d6/d0/usercli_8h.html#a477">ECInOutReconversionMode</a>(ped, FALSE);
01332     }
01333 
01334     <span class="keywordflow">switch</span> (keyPress) {
01335     <span class="keywordflow">case</span> VK_BACK:
01336 DeleteSelection:
01337         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a447">ECDeleteText</a>(ped))
01338             updateText = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01339         <span class="keywordflow">break</span>;
01340 
01341     <span class="keywordflow">default</span>:
01342         <span class="keywordflow">if</span> (keyPress &gt;= TEXT(<span class="charliteral">' '</span>))
01343         {
01344             <span class="comment">/*</span>
01345 <span class="comment">             * If this is in [a-z],[A-Z] and we are an ES_NUMBER</span>
01346 <span class="comment">             * edit field, bail.</span>
01347 <span class="comment">             */</span>
01348             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o44">f40Compat</a> &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>, EFNUMBER)) {
01349                 <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a459">ECIsCharNumeric</a>(ped, keyPress)) {
01350                     <span class="keywordflow">goto</span> IllegalChar;
01351                 }
01352             }
01353             <span class="keywordflow">goto</span> DeleteSelection;
01354         }
01355         <span class="keywordflow">break</span>;
01356     }
01357 
01358     <span class="keywordflow">switch</span> (keyPress) {
01359     <span class="keywordflow">case</span> 3:
01360 
01361         <span class="comment">/*</span>
01362 <span class="comment">         * CTRL-C Copy</span>
01363 <span class="comment">         */</span>
01364         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, WM_COPY, 0, 0L);
01365         <span class="keywordflow">return</span>;
01366 
01367     <span class="keywordflow">case</span> VK_BACK:
01368 
01369         <span class="comment">/*</span>
01370 <span class="comment">         * Delete any selected text or delete character left if no sel</span>
01371 <span class="comment">         */</span>
01372         <span class="keywordflow">if</span> (!updateText &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>) {
01373 
01374             <span class="comment">/*</span>
01375 <span class="comment">             * There was no selection to delete so we just delete character</span>
01376 <span class="comment">               left if available</span>
01377 <span class="comment">             */</span>
01378             <span class="comment">//</span>
01379             <span class="comment">// Calling PrevIch rather than just doing a decrement for VK_BACK</span>
01380             <span class="comment">//</span>
01381             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a467">ECPrevIch</a>( ped, NULL, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>);
01382             <a class="code" href="../../d6/d0/usercli_8h.html#a447">ECDeleteText</a>(ped);
01383             updateText = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01384         }
01385         <span class="keywordflow">break</span>;
01386 
01387     <span class="keywordflow">case</span> 22: <span class="comment">/* CTRL-V Paste */</span>
01388         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, WM_PASTE, 0, 0L);
01389         <span class="keywordflow">return</span>;
01390 
01391     <span class="keywordflow">case</span> 24: <span class="comment">/* CTRL-X Cut */</span>
01392         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>)
01393             <span class="keywordflow">goto</span> IllegalChar;
01394 
01395         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, WM_CUT, 0, 0L);
01396         <span class="keywordflow">return</span>;
01397 
01398     <span class="keywordflow">case</span> 26: <span class="comment">/* CTRL-Z Undo */</span>
01399         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, EM_UNDO, 0, 0L);
01400         <span class="keywordflow">return</span>;
01401 
01402     <span class="keywordflow">case</span> VK_RETURN:
01403     <span class="keywordflow">case</span> VK_ESCAPE:
01404         <span class="comment">//</span>
01405         <span class="comment">// If this is an edit control for a combobox and the dropdown list</span>
01406         <span class="comment">// is visible, forward it up to the combo.</span>
01407         <span class="comment">//</span>
01408         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o72">listboxHwnd</a> &amp;&amp; <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, CB_GETDROPPEDSTATE, 0, 0L)) {
01409             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, WM_KEYDOWN, (WPARAM)keyPress, 0L);
01410         } <span class="keywordflow">else</span>
01411             <span class="keywordflow">goto</span> IllegalChar;
01412         <span class="keywordflow">return</span>;
01413 
01414     <span class="keywordflow">default</span>:
01415         <span class="keywordflow">if</span> (keyPress &gt;= 0x1E) {  <span class="comment">// 1E,1F are unicode block and segment separators</span>
01416             <span class="comment">/*</span>
01417 <span class="comment">             * Hide the cursor if typing, if the mouse is captured, do not mess with this</span>
01418 <span class="comment">             * as it is going to desapear forever (no WM_SETCURSOR is sent to restore it</span>
01419 <span class="comment">             * at the first mouse-move)</span>
01420 <span class="comment">             * MCostea #166951</span>
01421 <span class="comment">             */</span>
01422             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a173">NtUserCallNoParam</a>(SFI_ZZZHIDECURSORNOCAPTURE);
01423 
01424             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a125">IS_DBCS_ENABLED</a>() &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> &amp;&amp; (<a class="code" href="../../d6/d0/usercli_8h.html#a464">ECIsDBCSLeadByte</a>(ped,(BYTE)keyPress))) {
01425                 <span class="keywordflow">if</span> ((DBCSkey = <a class="code" href="../../d6/d0/usercli_8h.html#a460">DbcsCombine</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, keyPress)) != 0 &amp;&amp;
01426                      <a class="code" href="../../d6/d0/usercli_8h.html#a532">SLInsertText</a>(ped,(LPSTR)&amp;DBCSkey, 2) == 2) {
01427                     InsertTextLen = 2;
01428                     updateText = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01429                 } <span class="keywordflow">else</span> {
01430                     <a class="code" href="../../d6/d0/usercli_8h.html#a219">NtUserMessageBeep</a>(0);
01431                 }
01432             } <span class="keywordflow">else</span> {  <span class="comment">// Here the original code begins</span>
01433                 InsertTextLen = 1;
01434                 <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a532">SLInsertText</a>(ped, (LPSTR)&amp;keyPress, 1))
01435                     updateText = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01436                 <span class="keywordflow">else</span>
01437 
01438                     <span class="comment">/*</span>
01439 <span class="comment">                     * Beep. Since we couldn't add the text</span>
01440 <span class="comment">                     */</span>
01441                     <a class="code" href="../../d6/d0/usercli_8h.html#a219">NtUserMessageBeep</a>(0);
01442             } <span class="comment">// Here the original code ends</span>
01443         } <span class="keywordflow">else</span> {
01444 
01445             <span class="comment">/*</span>
01446 <span class="comment">             * User hit an illegal control key</span>
01447 <span class="comment">             */</span>
01448 IllegalChar:
01449             <a class="code" href="../../d6/d0/usercli_8h.html#a219">NtUserMessageBeep</a>(0);
01450         }
01451 
01452         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(hwndSave))
01453             <span class="keywordflow">return</span>;
01454         <span class="keywordflow">break</span>;
01455     }
01456 
01457     <span class="keywordflow">if</span> (updateText) {
01458 
01459         <span class="comment">/*</span>
01460 <span class="comment">         * Dirty flag (ped-&gt;fDirty) was set when we inserted text</span>
01461 <span class="comment">         */</span>
01462         <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_UPDATE);
01463         hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, FALSE);
01464         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a530">SLScrollText</a>(ped, hdc)) {
01465             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> == ES_LEFT) {
01466             <span class="comment">//</span>
01467             <span class="comment">// Call SLDrawText with correct ichStart</span>
01468             <span class="comment">//</span>
01469                 <a class="code" href="../../d6/d0/usercli_8h.html#a527">SLDrawText</a>(ped, hdc, <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(0, (<span class="keywordtype">int</span>)(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> - InsertTextLen - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o79">wMaxNegCcharPos</a>)));
01470             } <span class="keywordflow">else</span> {
01471                 <span class="comment">/*</span>
01472 <span class="comment">                 * We can't just draw from ichStart because string may have</span>
01473 <span class="comment">                 * shifted because of alignment.</span>
01474 <span class="comment">                 */</span>
01475                 <a class="code" href="../../d6/d0/usercli_8h.html#a527">SLDrawText</a>(ped, hdc, 0);
01476             }
01477         }
01478         <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, FALSE);
01479         <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_CHANGE);
01480 
01481         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
01482             <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a12">NotifyWinEvent</a>(EVENT_OBJECT_VALUECHANGE, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, OBJID_CLIENT, INDEXID_CONTAINER);
01483         }
01484     }
01485 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="editsl.c::SLDrawLine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLDrawLine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>xClipStPos</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>xClipEndPos</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ichStart</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>iCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fSelStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00507">507</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00860">_IsWindowVisible()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00578">tagED::charPasswordChar</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00243">CopyRect</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00582">tagED::cPasswordCharWidth</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l03926">ECAnsiNext()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l03938">ECAnsiPrev()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01412">ECGetBrush()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02452">ECSetEditClip()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00611">tagED::fDBCS</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00061">FillRect()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00664">tagED::format</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00366">GetSysColor()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00570">tagED::ichScreenStart</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00165">InflateRect()</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00585">tagED::pwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00062">SLCalcXOffsetLeft()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00080">SLCalcXOffsetSpecial()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00693">tagED::wMaxNegAcharPos</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00695">tagED::wMaxNegCcharPos</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l00395">SLChangeSelection()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>.
<p>
<pre class="fragment"><div>00515 {
00516     RECT    rc;
00517     RECT    rcClip;
00518     PSTR    pText;
00519     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   rgbSaveBk;
00520     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   rgbSaveText;
00521     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   wSaveBkMode;
00522     <span class="keywordtype">int</span>     iStCount;
00523     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>     ichNewStart;
00524     HBRUSH  hbrBack;
00525 
00526     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
00527         RIPMSG0(RIP_WARNING, <span class="stringliteral">"SLDrawLine - Error - Invalid call with language pack loaded"</span>);
00528         <span class="keywordflow">return</span>;
00529     }
00530 
00531     <span class="comment">//</span>
00532     <span class="comment">// Anything to draw?</span>
00533     <span class="comment">//</span>
00534     <span class="keywordflow">if</span> (xClipStPos &gt;= xClipEndPos || !<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a17">_IsWindowVisible</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>) )
00535         <span class="keywordflow">return</span>;
00536 
00537     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o32">fDBCS</a>) {
00538         PSTR pT,pTOrg;
00539         <span class="keywordtype">int</span> iTCount;
00540 
00541         pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00542         ichNewStart = 0;
00543         <span class="keywordflow">if</span> (ichStart &gt; 0) {
00544             pT = pText + ichStart;
00545             ichNewStart = ichStart;
00546 
00547             <span class="keywordflow">while</span> (ichNewStart &amp;&amp;
00548                   (ichStart - ichNewStart &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o79">wMaxNegCcharPos</a>)) {
00549                 pT = <a class="code" href="../../d6/d0/usercli_8h.html#a466">ECAnsiPrev</a>(ped, pText, pT);
00550                 ichNewStart = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>)(pT - pText);
00551                 <span class="keywordflow">if</span> (!ichNewStart)
00552                     <span class="keywordflow">break</span>;
00553             }
00554 
00555             <span class="comment">// B#16152 - win95.</span>
00556             <span class="comment">// In case of T2, SLE always set an additional margin</span>
00557             <span class="comment">// to erase a character (iCount == 0 case), using aveCharWidth.</span>
00558             <span class="comment">// It erases unexpected an extra char if we don't use ichNewStart</span>
00559             <span class="comment">// and it happens when wMaxNegCcharPos == 0.</span>
00560             <span class="comment">//</span>
00561             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o79">wMaxNegCcharPos</a> == 0 &amp;&amp; iCount == 0) {
00562                 pT = <a class="code" href="../../d6/d0/usercli_8h.html#a466">ECAnsiPrev</a>(ped, pText, pT);
00563                 ichNewStart = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>)(pT - pText);
00564             }
00565         }
00566 
00567         iTCount = 0;
00568         <span class="keywordflow">if</span> (ichStart + iCount &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>) {
00569             pTOrg = pT = pText + ichStart + iCount;
00570             <span class="keywordflow">while</span> ((iTCount &lt; (<span class="keywordtype">int</span>)ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o77">wMaxNegAcharPos</a>) &amp;&amp;
00571                    (ichStart + iCount + iTCount &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>)) {
00572                 pT = <a class="code" href="../../d6/d0/usercli_8h.html#a465">ECAnsiNext</a>(ped, pT);
00573                 iTCount = (<span class="keywordtype">int</span>)(pT - pTOrg);
00574             }
00575         }
00576 
00577         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00578         iCount = (<span class="keywordtype">int</span>)(<a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(ichStart+iCount+iTCount, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>) - ichNewStart);
00579     } <span class="keywordflow">else</span> {
00580         <span class="comment">// Reset ichStart to take care of the negative C widths</span>
00581         ichNewStart = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>((<span class="keywordtype">int</span>)(ichStart - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o79">wMaxNegCcharPos</a>), 0);
00582 
00583         <span class="comment">// Reset ichCount to take care of the negative C and A widths</span>
00584         iCount = (<span class="keywordtype">int</span>)(<a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(ichStart+iCount+ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o77">wMaxNegAcharPos</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>)
00585                     - ichNewStart);
00586     }
00587     ichStart = ichNewStart;
00588 
00589     <span class="comment">//</span>
00590     <span class="comment">// Reset ichStart and iCount to the first one visible on the screen</span>
00591     <span class="comment">//</span>
00592     <span class="keywordflow">if</span> (ichStart &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>) {
00593         <span class="keywordflow">if</span> (ichStart+iCount &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>)
00594             <span class="keywordflow">return</span>;
00595 
00596         iCount -= (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>-ichStart);
00597         ichStart = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>;
00598     }
00599 
00600     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(&amp;rc, &amp;ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>);
00601 
00602     <span class="comment">//</span>
00603     <span class="comment">// Set the drawing rectangle</span>
00604     <span class="comment">//</span>
00605     rcClip.left   = xClipStPos;
00606     rcClip.right  = xClipEndPos;
00607     rcClip.top    = rc.top;
00608     rcClip.bottom = rc.bottom;
00609 
00610     <span class="comment">//</span>
00611     <span class="comment">// Set the proper clipping rectangle</span>
00612     <span class="comment">//</span>
00613     <a class="code" href="../../d6/d0/usercli_8h.html#a450">ECSetEditClip</a>(ped, hdc, TRUE);
00614 
00615     pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00616 
00617     <span class="comment">//</span>
00618     <span class="comment">// Calculate the starting pos for this piece of text</span>
00619     <span class="comment">//</span>
00620     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> == ES_LEFT) {
00621         <span class="keywordflow">if</span> (iStCount = (<span class="keywordtype">int</span>)(ichStart - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>)) {
00622             rc.left += <a class="code" href="../../d3/d5/editsl_8c.html#a3">SLCalcXOffsetLeft</a>(ped, hdc, ichStart);
00623         }
00624     } <span class="keywordflow">else</span> {
00625         rc.left += <a class="code" href="../../d3/d5/editsl_8c.html#a4">SLCalcXOffsetSpecial</a>(ped, hdc, ichStart);
00626     }
00627 
00628     <span class="comment">//</span>
00629     <span class="comment">// Set the background mode before calling NtUserGetControlBrush so that the app</span>
00630     <span class="comment">// can change it to TRANSPARENT if it wants to.</span>
00631     <span class="comment">//</span>
00632     SetBkMode(hdc, OPAQUE);
00633 
00634     <span class="keywordflow">if</span> (fSelStatus) {
00635         hbrBack = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(HIGHLIGHT);
00636         <span class="keywordflow">if</span> (hbrBack == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00637             <span class="keywordflow">goto</span> sldl_errorexit;
00638         }
00639         rgbSaveBk = SetBkColor(hdc, <a class="code" href="../../d3/d9/client_2wow_8c.html#a15">GetSysColor</a>(COLOR_HIGHLIGHT));
00640         rgbSaveText = SetTextColor(hdc, <a class="code" href="../../d3/d9/client_2wow_8c.html#a15">GetSysColor</a>(COLOR_HIGHLIGHTTEXT));
00641 
00642     } <span class="keywordflow">else</span> {
00643         <span class="comment">//</span>
00644         <span class="comment">// We always want to send this so that the app has a chance to muck</span>
00645         <span class="comment">// with the DC.</span>
00646         <span class="comment">//</span>
00647         <span class="comment">// Note that ReadOnly and Disabled edit fields are drawn as "static"</span>
00648         <span class="comment">// instead of as "active."</span>
00649         <span class="comment">//</span>
00650         hbrBack = <a class="code" href="../../d6/d0/usercli_8h.html#a480">ECGetBrush</a>(ped, hdc);
00651         rgbSaveText = GetTextColor(hdc);
00652     }
00653 
00654     <span class="comment">//</span>
00655     <span class="comment">// Erase the rectangular area before text is drawn. Note that we inflate</span>
00656     <span class="comment">// the rect by 1 so that the selection color has a one pixel border around</span>
00657     <span class="comment">// the text.</span>
00658     <span class="comment">//</span>
00659     <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcClip, 0, 1);
00660     <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a3">FillRect</a>(hdc, &amp;rcClip, hbrBack);
00661     <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcClip, 0, -1);
00662 
00663     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a>) {
00664         wSaveBkMode = SetBkMode(hdc, TRANSPARENT);
00665 
00666         <span class="keywordflow">for</span> (iStCount = 0; iStCount &lt; iCount; iStCount++) {
00667             <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> )
00668                 ExtTextOutA(hdc, rc.left, rc.top, ETO_CLIPPED, &amp;rcClip,
00669                             (LPSTR)&amp;ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a>, 1, NULL);
00670             <span class="keywordflow">else</span>
00671                 ExtTextOutW(hdc, rc.left, rc.top, ETO_CLIPPED, &amp;rcClip,
00672                             (LPWSTR)&amp;ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a>, 1, NULL);
00673 
00674             rc.left += ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o13">cPasswordCharWidth</a>;
00675         }
00676 
00677         SetBkMode(hdc, wSaveBkMode);
00678     } <span class="keywordflow">else</span> {
00679         <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> )
00680             ExtTextOutA(hdc, rc.left, rc.top, ETO_CLIPPED, &amp;rcClip,
00681                     pText+ichStart,iCount, NULL);
00682         <span class="keywordflow">else</span>
00683             ExtTextOutW(hdc, rc.left, rc.top, ETO_CLIPPED, &amp;rcClip,
00684                     ((LPWSTR)pText)+ichStart,iCount, NULL);
00685     }
00686 
00687     SetTextColor(hdc, rgbSaveText);
00688     <span class="keywordflow">if</span> (fSelStatus) {
00689         SetBkColor(hdc, rgbSaveBk);
00690     }
00691 
00692 sldl_errorexit:
00693     <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00694 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="editsl.c::SLDrawText" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLDrawText           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ichStart</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">737</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00860">_IsWindowVisible()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00661">tagED::cbChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00679">tagED::charOverhang</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00578">tagED::charPasswordChar</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00243">CopyRect</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00582">tagED::cPasswordCharWidth</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04133">ECAdjustIch()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01281">ECCchInWidth()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01412">ECGetBrush()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03294">tagLPKEDITCALLOUT::EditDrawText</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00611">tagED::fDBCS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00061">FillRect()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00610">tagED::fNoHideSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00664">tagED::format</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00639">tagED::fTrueType</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00570">tagED::ichScreenStart</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00585">tagED::pwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00062">SLCalcXOffsetLeft()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00080">SLCalcXOffsetSpecial()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00507">SLDrawLine()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00706">SLGetBlkEnd()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00126">SLSetCaretPosition()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00696">tagED::wLeftMargin</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00692">tagED::wMaxNegA</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00694">tagED::wMaxNegC</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00697">tagED::wRightMargin</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01337">ECImeComposition()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01304">SLChar()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01529">SLKeyDown()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02280">SLPaint()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02467">SLPaste()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01225">SLReplaceSel()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00932">SLScrollText()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l02341">SLSetFocus()</a>.
<p>
<pre class="fragment"><div>00741 {
00742     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>    cchToDraw;
00743     RECT   rc;
00744     PSTR   pText;
00745     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fSelStatus;
00746     <span class="keywordtype">int</span>    iCount, iStCount;
00747     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>    ichEnd;
00748     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fNoSelection;
00749     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fCalcRect;
00750     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fDrawLeftMargin = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00751     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fDrawEndOfLineStrip = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00752     SIZE   size;
00753 
00754     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a17">_IsWindowVisible</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>))
00755         <span class="keywordflow">return</span>;
00756 
00757     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
00758         <span class="comment">// The language pack handles display while complex script support present</span>
00759         <a class="code" href="../../d6/d0/usercli_8h.html#a480">ECGetBrush</a>(ped, hdc);   <span class="comment">// Give user a chance to manipulate the DC</span>
00760         pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00761         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>-&gt;<a class="code" href="../../d2/d0/structtagLPKEDITCALLOUT.html#o5">EditDrawText</a>(ped, hdc, pText, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.top);
00762         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00763         <a class="code" href="../../d6/d0/usercli_8h.html#a524">SLSetCaretPosition</a>(ped, hdc);
00764         <span class="keywordflow">return</span>;
00765     }
00766 
00767     <span class="comment">/*</span>
00768 <span class="comment">     * When drawing the entire visible content of special-aligned sle</span>
00769 <span class="comment">     * erase the view.</span>
00770 <span class="comment">     */</span>
00771     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> != ES_LEFT &amp;&amp; ichStart == 0)
00772         <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a3">FillRect</a>(hdc, &amp;ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>, <a class="code" href="../../d8/d4/editec_8c.html#a25">ECGetBrush</a>(ped, hdc));
00773 
00774     pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00775 
00776     <span class="keywordflow">if</span> (ichStart &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>) {
00777 <span class="preprocessor">#if DBG</span>
00778 <span class="preprocessor"></span>        <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> ichCompare = <a class="code" href="../../d6/d0/usercli_8h.html#a461">ECAdjustIch</a>(ped, pText, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>);
00779         UserAssert(ichCompare == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>);
00780 <span class="preprocessor">#endif</span>
00781 <span class="preprocessor"></span>        ichStart = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>;
00782     }
00783     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o32">fDBCS</a> &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>) {
00784         <span class="comment">/*</span>
00785 <span class="comment">         * If ichStart stays on trailing byte of DBCS, we have to</span>
00786 <span class="comment">         * adjust it.</span>
00787 <span class="comment">         */</span>
00788         ichStart = <a class="code" href="../../d6/d0/usercli_8h.html#a461">ECAdjustIch</a>(ped, pText, ichStart);
00789     }
00790 
00791     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>((LPRECT)&amp;rc, (LPRECT)&amp;ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>);
00792 
00793     <span class="comment">/*</span>
00794 <span class="comment">     * Find out how many characters will fit on the screen so that we don't do</span>
00795 <span class="comment">     * any needless drawing.</span>
00796 <span class="comment">     */</span>
00797     cchToDraw = <a class="code" href="../../d6/d0/usercli_8h.html#a443">ECCchInWidth</a>(ped, hdc,
00798             (LPSTR)(pText + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>),
00799             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>, rc.right - rc.left, TRUE);
00800     ichEnd = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> + cchToDraw;
00801 
00802     <span class="comment">/*</span>
00803 <span class="comment">     * There is no selection if,</span>
00804 <span class="comment">     * 1. MinSel and MaxSel are equal OR</span>
00805 <span class="comment">     * 2. (This has lost the focus AND Selection is to be hidden)</span>
00806 <span class="comment">     */</span>
00807     fNoSelection = ((ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>) || (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a> &amp;&amp; !ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o31">fNoHideSel</a>));
00808 
00809     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> == ES_LEFT) {
00810         <span class="keywordflow">if</span> (iStCount = (<span class="keywordtype">int</span>)(ichStart - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>)) {
00811             rc.left += <a class="code" href="../../d3/d5/editsl_8c.html#a3">SLCalcXOffsetLeft</a>(ped, hdc, ichStart);
00812         }
00813     } <span class="keywordflow">else</span> {
00814         rc.left += <a class="code" href="../../d3/d5/editsl_8c.html#a4">SLCalcXOffsetSpecial</a>(ped, hdc, ichStart);
00815     }
00816 
00817     <span class="comment">//</span>
00818     <span class="comment">// If this is the begining of the whole line, we may have to draw a blank</span>
00819     <span class="comment">// strip at the begining.</span>
00820     <span class="comment">//</span>
00821     <span class="keywordflow">if</span> ((ichStart == 0) &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o80">wLeftMargin</a>)
00822         fDrawLeftMargin = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00823 
00824     <span class="comment">//</span>
00825     <span class="comment">// If there is nothing to draw, that means we need to draw the end of</span>
00826     <span class="comment">// line strip, which erases the last character.</span>
00827     <span class="comment">//</span>
00828     <span class="keywordflow">if</span> (ichStart == ichEnd) {
00829         fDrawEndOfLineStrip = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00830         rc.left -= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o80">wLeftMargin</a>;
00831     }
00832 
00833     <span class="keywordflow">while</span> (ichStart &lt; ichEnd) {
00834         fCalcRect = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00835 
00836         <span class="keywordflow">if</span> (fNoSelection) {
00837             fSelStatus = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00838             iCount = ichEnd - ichStart;
00839         } <span class="keywordflow">else</span> {
00840             <span class="keywordflow">if</span> (fDrawLeftMargin) {
00841                 iCount = 0;
00842                 fSelStatus = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00843                 fCalcRect = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00844                 rc.right = rc.left;
00845             } <span class="keywordflow">else</span>
00846                 iCount = <a class="code" href="../../d6/d0/usercli_8h.html#a529">SLGetBlkEnd</a>(ped, ichStart, ichEnd,
00847                     (BOOL  *)&amp;fSelStatus);
00848         }
00849 
00850 
00851         <span class="keywordflow">if</span> (ichStart+iCount == ichEnd) {
00852             <span class="keywordflow">if</span> (fSelStatus)
00853                 fDrawEndOfLineStrip = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00854             <span class="keywordflow">else</span> {
00855                 rc.right = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o81">wRightMargin</a>;
00856                 fCalcRect = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00857             }
00858         }
00859 
00860         <span class="keywordflow">if</span> (fCalcRect) {
00861             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a>)
00862                 rc.right = rc.left + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o13">cPasswordCharWidth</a> * iCount;
00863             <span class="keywordflow">else</span> {
00864                 <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> )
00865                     GetTextExtentPointA(hdc, pText + ichStart,
00866                                         iCount, &amp;size);
00867                 <span class="keywordflow">else</span>
00868                     GetTextExtentPointW(hdc, ((LPWSTR)pText) + ichStart,
00869                                         iCount, &amp;size);
00870                 rc.right = rc.left + size.cx;
00871                 <span class="comment">/*</span>
00872 <span class="comment">                 * The extent is equal to the advance width. So for TrueType fonts</span>
00873 <span class="comment">                 *  we need to take care of Neg A and C. For non TrueType, the extent</span>
00874 <span class="comment">                 *  includes the overhang.</span>
00875 <span class="comment">                 * If drawing the selection, draw only the advance width</span>
00876 <span class="comment">                 */</span>
00877                 <span class="keywordflow">if</span> (fSelStatus) {
00878                     rc.right -= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o69">charOverhang</a>;
00879                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o41">fTrueType</a>) {
00880                    rc.right += ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o78">wMaxNegC</a>;
00881                    <span class="keywordflow">if</span> (iStCount &gt; 0) {
00882                       rc.right += ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o76">wMaxNegA</a>;
00883                       iStCount = 0;
00884                    }
00885                 }
00886 
00887             } <span class="comment">/* if (ped-&gt;charPasswordChar) */</span>
00888 
00889         }
00890 
00891         <span class="keywordflow">if</span> (fDrawLeftMargin) {
00892             fDrawLeftMargin = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00893             rc.left -= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o80">wLeftMargin</a>;
00894             <span class="keywordflow">if</span> (rc.right &lt; rc.left) {
00895                 rc.right = rc.left;
00896             }
00897         }
00898 
00899         <a class="code" href="../../d6/d0/usercli_8h.html#a528">SLDrawLine</a>(ped, hdc, rc.left, rc.right, ichStart, iCount, fSelStatus);
00900         ichStart += iCount;
00901         rc.left = rc.right;
00902         <span class="comment">/*</span>
00903 <span class="comment">         * If we're going to draw the selection, adjust rc.left</span>
00904 <span class="comment">         * to include advance width of the selected text</span>
00905 <span class="comment">         * For non TT fonts, ped-&gt;wMaxNegC equals ped-&gt;charOverhang</span>
00906 <span class="comment">         */</span>
00907         <span class="keywordflow">if</span> (!fSelStatus &amp;&amp; (iCount != 0) &amp;&amp; (ichStart &lt; ichEnd)) {
00908             rc.left -= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o78">wMaxNegC</a>;
00909         }
00910     }
00911 
00912     <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00913 
00914     <span class="comment">// Check if anything to be erased on the right hand side</span>
00915     <span class="keywordflow">if</span> (fDrawEndOfLineStrip &amp;&amp;
00916             (rc.left &lt; (rc.right = (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right+ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o81">wRightMargin</a>))))
00917         <a class="code" href="../../d6/d0/usercli_8h.html#a528">SLDrawLine</a>(ped, hdc, rc.left, rc.right, ichStart, 0, FALSE);
00918 
00919     <a class="code" href="../../d6/d0/usercli_8h.html#a524">SLSetCaretPosition</a>(ped, hdc);
00920 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="editsl.c::SLEditWndProc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LRESULT SLEditWndProc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">2520</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00860">_IsWindowVisible()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02460">CBFDROPDOWN</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d1/d8/clmsg_8c-source.html#l00574">DefWindowProcWorker()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01977">ECEmptyUndo()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01051">ECGetCaretWidth</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00246">ECGetText()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l00597">ECSize()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04185">ECUpdateFormat()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03301">tagLPKEDITCALLOUT::EditCreateCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00642">tagED::f40Compat</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00607">tagED::fBorder</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00619">tagED::fEatNextChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00601">tagED::fMouseDown</a>, <a class="el" href="../../d9/d6/udbgk_8c-source.html#l00038">foo()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00632">tagED::fReadOnly</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00506">GetKeyState()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01170">HtoP</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00587">tagED::hwndParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00570">tagED::ichScreenStart</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00678">tagED::lineHeight</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00682">tagED::listboxHwnd</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06520">NtUserBeginPaint()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01560">NtUserDestroyCaret</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06575">NtUserEndPaint()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05279">NtUserHideCaret()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06219">NtUserShowCaret()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00540">Pundo</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00585">tagED::pwnd</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01304">SLChar()</a>, <a class="el" href="../../d7/d4/edslrare_8c-source.html#l00027">SLCreate()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00182">SLIchToLeftXPos()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01529">SLKeyDown()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02394">SLKillFocus()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02098">SLMouseMotion()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01934">SLMouseToIch()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02280">SLPaint()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02467">SLPaste()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01225">SLReplaceSel()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00126">SLSetCaretPosition()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02341">SLSetFocus()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00283">SLSetSelection()</a>, <a class="el" href="../../d7/d4/edslrare_8c-source.html#l00087">SLUndo()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00021">SYS_ALTERNATE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00120">ValidateHwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02357">WEFDLGMODALFRAME</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02261">WFHPRESENT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02259">WFMPRESENT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02404">WFSIZEBOX</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02260">WFVPRESENT</a>.
<p>
Referenced by <a class="el" href="../../d9/d3/editec_8c-source.html#l00692">ECClearText()</a>, and <a class="el" href="../../d9/d3/editec_8c-source.html#l02904">EditWndProc()</a>.
<p>
<pre class="fragment"><div>02526 {
02527     HDC         hdc;
02528     PAINTSTRUCT ps;
02529     POINT       pt;
02530 
02531     <span class="comment">/*</span>
02532 <span class="comment">     * Dispatch the various messages we can receive</span>
02533 <span class="comment">     */</span>
02534     <span class="keywordflow">switch</span> (message) {
02535 
02536     <span class="keywordflow">case</span> WM_INPUTLANGCHANGE:
02537         <span class="keywordflow">if</span> (ped &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a> &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
02538             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a204">NtUserHideCaret</a>(hwnd);
02539             hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, TRUE);
02540             <a class="code" href="../../d6/d0/usercli_8h.html#a215">NtUserDestroyCaret</a>();
02541             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>-&gt;<a class="code" href="../../d2/d0/structtagLPKEDITCALLOUT.html#o12">EditCreateCaret</a> (ped, hdc, <a class="code" href="../../d6/d0/usercli_8h.html#a149">ECGetCaretWidth</a>(), ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a>, (UINT)lParam);
02542             <a class="code" href="../../d6/d0/usercli_8h.html#a524">SLSetCaretPosition</a>(ped, hdc);
02543             <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, TRUE);
02544             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a234">NtUserShowCaret</a>(hwnd);
02545         }
02546         <span class="keywordflow">goto</span> PassToDefaultWindowProc;
02547 
02548     <span class="keywordflow">case</span> WM_STYLECHANGED:
02549         <span class="keywordflow">if</span> (ped &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
02550             <span class="keywordflow">switch</span> (wParam) {
02551 
02552                 <span class="keywordflow">case</span> GWL_STYLE:
02553                     <a class="code" href="../../d6/d0/usercli_8h.html#a426">ECUpdateFormat</a>(ped,
02554                         ((LPSTYLESTRUCT)lParam)-&gt;styleNew,
02555                         GetWindowLong(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, GWL_EXSTYLE));
02556                     <span class="keywordflow">return</span> 1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
02557 
02558                 <span class="keywordflow">case</span> GWL_EXSTYLE:
02559                     <a class="code" href="../../d6/d0/usercli_8h.html#a426">ECUpdateFormat</a>(ped,
02560                         GetWindowLong(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, GWL_STYLE),
02561                         ((LPSTYLESTRUCT)lParam)-&gt;styleNew);
02562                     <span class="keywordflow">return</span> 1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
02563             }
02564         }
02565 
02566         <span class="keywordflow">goto</span> PassToDefaultWindowProc;
02567 
02568     <span class="keywordflow">case</span> WM_CHAR:
02569 
02570         <span class="comment">/*</span>
02571 <span class="comment">         * wParam - the value of the key</span>
02572 <span class="comment">           lParam - modifiers, repeat count etc (not used)</span>
02573 <span class="comment">         */</span>
02574         <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o36">fEatNextChar</a>)
02575             <a class="code" href="../../d6/d0/usercli_8h.html#a534">SLChar</a>(ped, (UINT)wParam);
02576         <span class="keywordflow">else</span>
02577             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o36">fEatNextChar</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02578         <span class="keywordflow">break</span>;
02579 
02580     <span class="keywordflow">case</span> WM_ERASEBKGND:
02581 
02582        <span class="comment">/*</span>
02583 <span class="comment">        * wParam - device context handle</span>
02584 <span class="comment">        * lParam - not used</span>
02585 <span class="comment">        * We do nothing on this message and we don't want DefWndProc to do</span>
02586 <span class="comment">        * anything, so return 1</span>
02587 <span class="comment">        */</span>
02588         <span class="keywordflow">return</span> (1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
02589         <span class="keywordflow">break</span>;
02590 
02591     <span class="keywordflow">case</span> WM_GETDLGCODE: {
02592            LONG code = DLGC_WANTCHARS | DLGC_HASSETSEL | DLGC_WANTARROWS;
02593 
02594            <span class="comment">/*</span>
02595 <span class="comment">            * If this is a WM_SYSCHAR message generated by the UNDO keystroke</span>
02596 <span class="comment">            * we want this message so we can EAT IT in "case WM_SYSCHAR:"</span>
02597 <span class="comment">            */</span>
02598             <span class="keywordflow">if</span> (lParam) {
02599                 <span class="keywordflow">switch</span> (((LPMSG)lParam)-&gt;message) {
02600                     <span class="keywordflow">case</span> WM_SYSCHAR:
02601                         <span class="keywordflow">if</span> ((HIWORD(((LPMSG)lParam)-&gt;lParam) &amp; <a class="code" href="../../d3/d5/editsl_8c.html#a0">SYS_ALTERNATE</a>) &amp;&amp;
02602                             ((WORD)wParam == VK_BACK)) {
02603                             code |= DLGC_WANTMESSAGE;
02604                         }
02605                         <span class="keywordflow">break</span>;
02606 
02607                     <span class="keywordflow">case</span> WM_KEYDOWN:
02608                         <span class="keywordflow">if</span> (( (((WORD)wParam == VK_RETURN) ||
02609                                ((WORD)wParam == VK_ESCAPE)) &amp;&amp;
02610                             (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o72">listboxHwnd</a>)      &amp;&amp;
02611                             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(<a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>), CBFDROPDOWN) &amp;&amp;
02612                             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, CB_GETDROPPEDSTATE, 0, 0L))) {
02613                             code |= DLGC_WANTMESSAGE;
02614                         }
02615                         <span class="keywordflow">break</span>;
02616                 }
02617             }
02618             <span class="keywordflow">return</span> code;
02619         }
02620 
02621         <span class="keywordflow">break</span>;
02622 
02623     <span class="keywordflow">case</span> WM_KEYDOWN:
02624 
02625         <span class="comment">/*</span>
02626 <span class="comment">         * wParam - virt keycode of the given key</span>
02627 <span class="comment">         * lParam - modifiers such as repeat count etc. (not used)</span>
02628 <span class="comment">         */</span>
02629         <a class="code" href="../../d6/d0/usercli_8h.html#a535">SLKeyDown</a>(ped, (UINT)wParam, 0);
02630         <span class="keywordflow">break</span>;
02631 
02632     <span class="keywordflow">case</span> WM_KILLFOCUS:
02633 
02634         <span class="comment">/*</span>
02635 <span class="comment">         * wParam - handle of the window that receives the input focus</span>
02636 <span class="comment">           lParam - not used</span>
02637 <span class="comment">         */</span>
02638 
02639         <a class="code" href="../../d6/d0/usercli_8h.html#a541">SLKillFocus</a>(ped, (HWND)wParam);
02640         <span class="keywordflow">break</span>;
02641 
02642     <span class="keywordflow">case</span> WM_CAPTURECHANGED:
02643         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o22">fMouseDown</a>)
02644             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o22">fMouseDown</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02645         <span class="keywordflow">break</span>;
02646 
02647     <span class="keywordflow">case</span> WM_MOUSEMOVE:
02648         UserAssert(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o22">fMouseDown</a>);
02649         <span class="comment">/*</span>
02650 <span class="comment">         * FALL THRU</span>
02651 <span class="comment">         */</span>
02652 
02653     <span class="keywordflow">case</span> WM_LBUTTONDBLCLK:
02654     <span class="keywordflow">case</span> WM_LBUTTONDOWN:
02655     <span class="keywordflow">case</span> WM_LBUTTONUP:
02656         <span class="comment">/*</span>
02657 <span class="comment">         * wParam - contains a value that indicates which virtual keys are down</span>
02658 <span class="comment">         * lParam - contains x and y coords of the mouse cursor</span>
02659 <span class="comment">         */</span>
02660         POINTSTOPOINT(pt, lParam);
02661         <a class="code" href="../../d6/d0/usercli_8h.html#a537">SLMouseMotion</a>(ped, message, (UINT)wParam, &amp;pt);
02662         <span class="keywordflow">break</span>;
02663 
02664     <span class="keywordflow">case</span> WM_CREATE:
02665 
02666         <span class="comment">/*</span>
02667 <span class="comment">         * wParam - handle to window being created</span>
02668 <span class="comment">           lParam - points to a CREATESTRUCT that contains copies of parameters</span>
02669 <span class="comment">                    passed to the CreateWindow function.</span>
02670 <span class="comment">         */</span>
02671         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a538">SLCreate</a>(ped, (LPCREATESTRUCT)lParam));
02672         <span class="keywordflow">break</span>;
02673 
02674     <span class="keywordflow">case</span> WM_PRINTCLIENT:
02675         <span class="comment">// wParam --    can be hdc from subclassed paint</span>
02676         <span class="comment">// lParam --    unused</span>
02677         <a class="code" href="../../d6/d0/usercli_8h.html#a539">SLPaint</a>(ped, (HDC) wParam);
02678         <span class="keywordflow">break</span>;
02679 
02680     <span class="keywordflow">case</span> WM_PAINT:
02681 
02682         <span class="comment">/*</span>
02683 <span class="comment">         * wParam --    can be hdc from subclassed paint</span>
02684 <span class="comment">         * lParam --    unused</span>
02685 <span class="comment">         */</span>
02686         <span class="keywordflow">if</span> (wParam)
02687             hdc = (HDC) wParam;
02688         <span class="keywordflow">else</span> {
02689             <span class="comment">// this hide/show caret is outside Begin/EndPaint to handle the</span>
02690             <span class="comment">// case when the caret is half in/half out of the update region</span>
02691             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a204">NtUserHideCaret</a>(hwnd);
02692             hdc = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a246">NtUserBeginPaint</a>(hwnd, &amp;ps);
02693         }
02694 
02695         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a17">_IsWindowVisible</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>))
02696             <a class="code" href="../../d6/d0/usercli_8h.html#a539">SLPaint</a>(ped, hdc);
02697 
02698         <span class="keywordflow">if</span> (!wParam) {
02699             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a248">NtUserEndPaint</a>(hwnd, &amp;ps);
02700             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a234">NtUserShowCaret</a>(hwnd);
02701         }
02702         <span class="keywordflow">break</span>;
02703 
02704     <span class="keywordflow">case</span> WM_PASTE:
02705 
02706         <span class="comment">/*</span>
02707 <span class="comment">         * wParam - not used</span>
02708 <span class="comment">         * lParam - not used</span>
02709 <span class="comment">         */</span>
02710         <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o39">fReadOnly</a>)
02711             <a class="code" href="../../d3/d5/editsl_8c.html#a25">SLPaste</a>(ped);
02712         <span class="keywordflow">break</span>;
02713 
02714     <span class="keywordflow">case</span> WM_SETFOCUS:
02715 
02716         <span class="comment">/*</span>
02717 <span class="comment">         * wParam - handle of window that loses the input focus (may be NULL)</span>
02718 <span class="comment">           lParam - not used</span>
02719 <span class="comment">         */</span>
02720         <a class="code" href="../../d6/d0/usercli_8h.html#a540">SLSetFocus</a>(ped);
02721         <span class="keywordflow">break</span>;
02722 
02723     <span class="keywordflow">case</span> WM_SIZE:
02724 
02725         <span class="comment">/*</span>
02726 <span class="comment">         * wParam - defines the type of resizing fullscreen, sizeiconic,</span>
02727 <span class="comment">                    sizenormal etc.</span>
02728 <span class="comment">           lParam - new width in LOWORD, new height in HIGHWORD of client area</span>
02729 <span class="comment">         */</span>
02730         <a class="code" href="../../d6/d0/usercli_8h.html#a482">ECSize</a>(ped, NULL, TRUE);
02731         <span class="keywordflow">return</span> 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
02732 
02733     <span class="keywordflow">case</span> WM_SYSKEYDOWN:
02734         <span class="comment">/*</span>
02735 <span class="comment">         * wParam --    virtual key code</span>
02736 <span class="comment">         * lParam --    modifiers</span>
02737 <span class="comment">         */</span>
02738 
02739         <span class="comment">/*</span>
02740 <span class="comment">         * Are we in a combobox with the Alt key down?</span>
02741 <span class="comment">         */</span>
02742         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o72">listboxHwnd</a> &amp;&amp; (lParam &amp; 0x20000000<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>)) {
02743             <span class="comment">/*</span>
02744 <span class="comment">             * Handle Combobox support. We want alt up or down arrow to behave</span>
02745 <span class="comment">             * like F4 key which completes the combo box selection</span>
02746 <span class="comment">             */</span>
02747             <span class="keywordflow">if</span> (lParam &amp; 0x1000000) {
02748 
02749                 <span class="comment">/*</span>
02750 <span class="comment">                 * This is an extended key such as the arrow keys not on the</span>
02751 <span class="comment">                 * numeric keypad so just drop the combobox.</span>
02752 <span class="comment">                 */</span>
02753                 <span class="keywordflow">if</span> (wParam == VK_DOWN || wParam == VK_UP)
02754                     <span class="keywordflow">goto</span> DropCombo;
02755                 <span class="keywordflow">else</span>
02756                     <span class="keywordflow">goto</span> <a class="code" href="../../d8/d7/udbgk_8c.html#a2">foo</a>;
02757             }
02758 
02759             <span class="keywordflow">if</span> (!(<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a16">GetKeyState</a>(VK_NUMLOCK) &amp; 1) &amp;&amp;
02760                     (wParam == VK_DOWN || wParam == VK_UP)) {
02761 
02762                 <span class="comment">/*</span>
02763 <span class="comment">                 * NUMLOCK is up and the keypad up or down arrow hit:</span>
02764 <span class="comment">                 * eat character generated by keyboard driver.</span>
02765 <span class="comment">                 */</span>
02766                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o36">fEatNextChar</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02767             } <span class="keywordflow">else</span> {
02768                 <span class="keywordflow">goto</span> <a class="code" href="../../d8/d7/udbgk_8c.html#a2">foo</a>;
02769             }
02770 
02771 DropCombo:
02772             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>,
02773                     CB_GETEXTENDEDUI, 0, 0) &amp; 0x00000001) {
02774 
02775                 <span class="comment">/*</span>
02776 <span class="comment">                 * Extended ui doesn't honor VK_F4.</span>
02777 <span class="comment">                 */</span>
02778                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, CB_GETDROPPEDSTATE, 0, 0))
02779                     <span class="keywordflow">return</span>(<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, CB_SHOWDROPDOWN, 0, 0));
02780                 <span class="keywordflow">else</span>
02781                     <span class="keywordflow">return</span> (<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, CB_SHOWDROPDOWN, 1, 0));
02782             } <span class="keywordflow">else</span>
02783                 <span class="keywordflow">return</span> (<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o72">listboxHwnd</a>, WM_KEYDOWN, VK_F4, 0));
02784         }
02785 <a class="code" href="../../d8/d7/udbgk_8c.html#a2">foo</a>:
02786         <span class="keywordflow">if</span> (wParam == VK_BACK) {
02787             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, WM_UNDO, 0, 0L);
02788             <span class="keywordflow">break</span>;
02789         }
02790         <span class="keywordflow">else</span>
02791             <span class="keywordflow">goto</span> PassToDefaultWindowProc;
02792         <span class="keywordflow">break</span>;
02793 
02794     <span class="keywordflow">case</span> EM_GETLINE:
02795 
02796         <span class="comment">/*</span>
02797 <span class="comment">         * wParam - line number to copy (always the first line for SL)</span>
02798 <span class="comment">         * lParam - buffer to copy text to. FIrst word is max # of bytes to copy</span>
02799 <span class="comment">         */</span>
02800         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a453">ECGetText</a>(ped, (*(LPWORD)lParam), (LPSTR)lParam, FALSE);
02801 
02802     <span class="keywordflow">case</span> EM_LINELENGTH:
02803 
02804         <span class="comment">/*</span>
02805 <span class="comment">         * wParam - ignored</span>
02806 <span class="comment">         * lParam - ignored</span>
02807 <span class="comment">         */</span>
02808         <span class="keywordflow">return</span> (LONG)ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>;
02809         <span class="keywordflow">break</span>;
02810 
02811     <span class="keywordflow">case</span> EM_SETSEL:
02812         <span class="comment">/*</span>
02813 <span class="comment">         * wParam -- start pos</span>
02814 <span class="comment">         * lParam -- end pos</span>
02815 <span class="comment">         */</span>
02816         <a class="code" href="../../d6/d0/usercli_8h.html#a531">SLSetSelection</a>(ped, (ICH)wParam, (ICH)lParam);
02817         <span class="keywordflow">break</span>;
02818 
02819     <span class="keywordflow">case</span> EM_REPLACESEL:
02820 
02821         <span class="comment">/*</span>
02822 <span class="comment">         * wParam - flag for 4.0+ apps saying whether to clear undo</span>
02823 <span class="comment">         * lParam - points to a null terminated string of replacement text</span>
02824 <span class="comment">         */</span>
02825         <a class="code" href="../../d6/d0/usercli_8h.html#a522">SLReplaceSel</a>(ped, (LPSTR)lParam);
02826         <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o44">f40Compat</a> || !wParam)
02827             <a class="code" href="../../d6/d0/usercli_8h.html#a444">ECEmptyUndo</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a85">Pundo</a>(ped));
02828         <span class="keywordflow">break</span>;
02829 
02830     <span class="keywordflow">case</span> EM_GETFIRSTVISIBLELINE:
02831 
02832         <span class="comment">/*</span>
02833 <span class="comment">         * wParam - not used</span>
02834 <span class="comment">         * lParam - not used</span>
02835 <span class="comment">         *</span>
02836 <span class="comment">         * effects: Returns the first visible line for single line edit controls.</span>
02837 <span class="comment">         */</span>
02838         <span class="keywordflow">return</span> ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>;
02839         <span class="keywordflow">break</span>;
02840 
02841     <span class="keywordflow">case</span> EM_POSFROMCHAR:
02842         <span class="comment">//</span>
02843         <span class="comment">// wParam --    char index in text</span>
02844         <span class="comment">// lParam --    not used</span>
02845         <span class="comment">// This function returns the (x,y) position of the character.</span>
02846         <span class="comment">//      y is always 0 for single.</span>
02847         <span class="comment">//</span>
02848     <span class="keywordflow">case</span> EM_CHARFROMPOS:
02849         <span class="comment">//</span>
02850         <span class="comment">// wParam --    unused</span>
02851         <span class="comment">// lParam --    pt in edit client coords</span>
02852         <span class="comment">// This function returns</span>
02853         <span class="comment">//          LOWORD: the position of the _closest_ char</span>
02854         <span class="comment">//                  to the passed in point.</span>
02855         <span class="comment">//          HIWORD: the index of the line (always 0 for single)</span>
02856 
02857         {
02858             LONG xyPos;
02859 
02860             hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, TRUE);
02861 
02862             <span class="keywordflow">if</span> (message == EM_POSFROMCHAR)
02863                 xyPos = MAKELONG(<a class="code" href="../../d6/d0/usercli_8h.html#a525">SLIchToLeftXPos</a>(ped, hdc, (ICH)wParam), 0);
02864             <span class="keywordflow">else</span> {
02865                 POINTSTOPOINT(pt, lParam);
02866                 xyPos = <a class="code" href="../../d6/d0/usercli_8h.html#a536">SLMouseToIch</a>(ped, hdc, &amp;pt);
02867             }
02868 
02869             <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, TRUE);
02870             <span class="keywordflow">return</span>((LRESULT)xyPos);
02871             <span class="keywordflow">break</span>;
02872         }
02873 
02874     <span class="keywordflow">case</span> WM_UNDO:
02875     <span class="keywordflow">case</span> EM_UNDO:
02876         <a class="code" href="../../d6/d0/usercli_8h.html#a523">SLUndo</a>(ped);
02877         <span class="keywordflow">break</span>;
02878 
02879 <span class="preprocessor">#if 0</span>
02880 <span class="preprocessor"></span>    <span class="keywordflow">case</span> WM_NCPAINT: <span class="comment">// not in server.c gawEditWndProc[] anyway.</span>
02881 
02882         <span class="comment">/*</span>
02883 <span class="comment">         * LATER - This is an NT optimization.  It needs to be revisited</span>
02884 <span class="comment">         * for validity once all of the Chicago changes are done - Johnl</span>
02885 <span class="comment">         */</span>
02886 
02887         pwnd = (<a class="code" href="../../d6/d9/structtagWND.html">PWND</a>)<a class="code" href="../../d4/d1/userk_8h.html#a102">HtoP</a>(hwnd);
02888 
02889         <span class="comment">/*</span>
02890 <span class="comment">         * Check to see if this window has any non-client areas that</span>
02891 <span class="comment">         * would be painted.  If not, don't bother calling DefWindowProc()</span>
02892 <span class="comment">         * since it'll be a wasted c/s transition.</span>
02893 <span class="comment">         */</span>
02894         <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o28">fBorder</a> &amp;&amp;
02895             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFDLGMODALFRAME) == 0 &amp;&amp;
02896             !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, (WFMPRESENT | WFVPRESENT | WFHPRESENT)) &amp;&amp;
02897             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSIZEBOX) == 0) {
02898             <span class="keywordflow">break</span>;
02899         } <span class="keywordflow">else</span> {
02900             <span class="keywordflow">goto</span> PassToDefaultWindowProc;
02901         }
02902         <span class="keywordflow">break</span>;
02903 <span class="preprocessor">#endif</span>
02904 <span class="preprocessor"></span>
02905     <span class="keywordflow">default</span>:
02906 PassToDefaultWindowProc:
02907         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a610">DefWindowProcWorker</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>, message, wParam, lParam, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>);
02908         <span class="keywordflow">break</span>;
02909     } <span class="comment">/* switch (message) */</span>
02910 
02911     <span class="keywordflow">return</span> 1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
02912 } <span class="comment">/* SLEditWndProc */</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="editsl.c::SLGetBlkEnd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int SLGetBlkEnd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ichStart</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ichEnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL FAR *&nbsp;</td>
          <td class="mdname" nowrap> <em>lpfStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00706">706</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>.
<p>
<pre class="fragment"><div>00711 {
00712     *lpfStatus = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00713     <span class="keywordflow">if</span> (ichStart &gt;= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>) {
00714         <span class="keywordflow">if</span> (ichStart &gt;= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>)
00715             <span class="keywordflow">return</span> (ichEnd - ichStart);
00716         *lpfStatus = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00717         <span class="keywordflow">return</span> (<a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(ichEnd, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>) - ichStart);
00718     }
00719     <span class="keywordflow">return</span> (<a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(ichEnd, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>) - ichStart);
00720 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="editsl.c::SLGetClipRect" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLGetClipRect           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ichStart</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>iCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpClipRect</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00323">323</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00679">tagED::charOverhang</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00578">tagED::charPasswordChar</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00243">CopyRect</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00582">tagED::cPasswordCharWidth</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00664">tagED::format</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00570">tagED::ichScreenStart</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00245">SetRectEmpty</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00062">SLCalcXOffsetLeft()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00080">SLCalcXOffsetSpecial()</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l00395">SLChangeSelection()</a>.
<p>
<pre class="fragment"><div>00329 {
00330     <span class="keywordtype">int</span>    iStCount;
00331     PSTR   pText;
00332 
00333     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
00334         RIPMSG0(RIP_WARNING, <span class="stringliteral">"SLGetClipRect - Error - Invalid call with language pack loaded"</span>);
00335         memset(lpClipRect, 0, <span class="keyword">sizeof</span>(RECT));
00336         <span class="keywordflow">return</span>;
00337     }
00338 
00339     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a33">CopyRect</a>(lpClipRect, &amp;ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>);
00340 
00341     pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped) ;
00342 
00343     <span class="comment">// Calculates the starting pos for this piece of text</span>
00344     <span class="keywordflow">if</span> ((iStCount = (<span class="keywordtype">int</span>)(ichStart - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>)) &gt; 0) {
00345         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> == ES_LEFT) {
00346             lpClipRect-&gt;left += <a class="code" href="../../d3/d5/editsl_8c.html#a3">SLCalcXOffsetLeft</a>(ped, hdc, ichStart);
00347         }
00348     } <span class="keywordflow">else</span> {
00349             <span class="comment">// Reset the values to visible portions</span>
00350             iCount -= (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> - ichStart);
00351             ichStart = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>;
00352     }
00353 
00354     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> != ES_LEFT) {
00355         lpClipRect-&gt;left += <a class="code" href="../../d3/d5/editsl_8c.html#a4">SLCalcXOffsetSpecial</a>(ped, hdc, ichStart);
00356     }
00357 
00358     <span class="keywordflow">if</span> (iCount &lt; 0) {
00359         <span class="comment">/*</span>
00360 <span class="comment">         * This is not in the visible area of the edit control, so return</span>
00361 <span class="comment">         * an empty rect.</span>
00362 <span class="comment">         */</span>
00363         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a35">SetRectEmpty</a>(lpClipRect);
00364         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00365         <span class="keywordflow">return</span>;
00366     }
00367 
00368     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a>)
00369              lpClipRect-&gt;right = lpClipRect-&gt;left + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o13">cPasswordCharWidth</a> * iCount;
00370     <span class="keywordflow">else</span> {
00371         SIZE size ;
00372 
00373         <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>) {
00374             GetTextExtentPointA(hdc, pText + ichStart, iCount, &amp;size);
00375         } <span class="keywordflow">else</span> {
00376             GetTextExtentPointW(hdc, ((LPWSTR)pText) + ichStart, iCount, &amp;size);
00377         }
00378         lpClipRect-&gt;right = lpClipRect-&gt;left + size.cx - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o69">charOverhang</a>;
00379     }
00380 
00381     <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00382 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="editsl.c::SLIchToLeftXPos" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int SLIchToLeftXPos           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ich</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
fAnsi 
<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00182">182</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00677">tagED::aveCharWidth</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00679">tagED::charOverhang</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00578">tagED::charPasswordChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00582">tagED::cPasswordCharWidth</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03290">tagLPKEDITCALLOUT::EditIchToXY</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00611">tagED::fDBCS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00605">tagED::fNonPropFont</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00664">tagED::format</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00570">tagED::ichScreenStart</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00080">SLCalcXOffsetSpecial()</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00126">SLSetCaretPosition()</a>.
<p>
<pre class="fragment"><div>00186 {
00187     <span class="keywordtype">int</span> textExtent;
00188     PSTR pText;
00189     SIZE size;
00190     <span class="keywordtype">int</span>  cchDiff;
00191 
00192     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
00193 
00194        pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00195        textExtent = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>-&gt;<a class="code" href="../../d2/d0/structtagLPKEDITCALLOUT.html#o1">EditIchToXY</a>(ped, hdc, pText, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>, ich);
00196        <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00197 
00198        <span class="keywordflow">return</span> textExtent;
00199 
00200     }
00201 
00202     <span class="comment">/*</span>
00203 <span class="comment">     * Check if we are adding lots and lots of chars. A paste for example could</span>
00204 <span class="comment">     * cause this and GetTextExtents could overflow on this.</span>
00205 <span class="comment">     */</span>
00206     cchDiff = (<span class="keywordtype">int</span>)ich - (<span class="keywordtype">int</span>)ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>;
00207     <span class="keywordflow">if</span> (cchDiff &gt; 1000)
00208         <span class="keywordflow">return</span> (30000);
00209     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cchDiff &lt; -1000)
00210         <span class="keywordflow">return</span> (-30000);
00211 
00212     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> != ES_LEFT)
00213         <span class="keywordflow">return</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left + <a class="code" href="../../d3/d5/editsl_8c.html#a4">SLCalcXOffsetSpecial</a>(ped, hdc, ich));
00214 
00215     <span class="comment">/*</span>
00216 <span class="comment">     * Caret position /w DBCS text, we can not optimize...</span>
00217 <span class="comment">     */</span>
00218     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o26">fNonPropFont</a> &amp;&amp; !ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o32">fDBCS</a>)
00219         <span class="keywordflow">return</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left + cchDiff*ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a>);
00220 
00221     <span class="comment">/*</span>
00222 <span class="comment">     * Check if password hidden chars are being used.</span>
00223 <span class="comment">     */</span>
00224     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a>)
00225         <span class="keywordflow">return</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left + cchDiff*ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o13">cPasswordCharWidth</a>);
00226 
00227     pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00228 
00229     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>) {
00230         <span class="keywordflow">if</span> (cchDiff &gt;= 0) {
00231 
00232             GetTextExtentPointA(hdc, (LPSTR)(pText + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>),
00233                     cchDiff, &amp;size);
00234             textExtent =  size.cx;
00235 
00236             <span class="comment">/*</span>
00237 <span class="comment">             * In case of signed/unsigned overflow since the text extent may be</span>
00238 <span class="comment">             * greater than maxint. This happens with long single line edit</span>
00239 <span class="comment">             * controls. The rect we edit text in will never be greater than 30000</span>
00240 <span class="comment">             * pixels so we are ok if we just ignore them.</span>
00241 <span class="comment">             */</span>
00242             <span class="keywordflow">if</span> (textExtent &lt; 0 || textExtent &gt; 31000)
00243                 textExtent = 30000;
00244         } <span class="keywordflow">else</span> {
00245             GetTextExtentPointA(hdc,(LPSTR)(pText + ich), -cchDiff, &amp;size);
00246             textExtent = (-1) * size.cx;
00247         }
00248     } <span class="keywordflow">else</span> {  
00249         <span class="keywordflow">if</span> (cchDiff &gt;= 0) {
00250 
00251             GetTextExtentPointW(hdc, (LPWSTR)(pText + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>*<span class="keyword">sizeof</span>(WCHAR)),
00252                     cchDiff, &amp;size);
00253             textExtent =  size.cx;
00254 
00255             <span class="comment">/*</span>
00256 <span class="comment">             * In case of signed/unsigned overflow since the text extent may be</span>
00257 <span class="comment">             * greater than maxint. This happens with long single line edit</span>
00258 <span class="comment">             * controls. The rect we edit text in will never be greater than 30000</span>
00259 <span class="comment">             * pixels so we are ok if we just ignore them.</span>
00260 <span class="comment">             */</span>
00261             <span class="keywordflow">if</span> (textExtent &lt; 0 || textExtent &gt; 31000)
00262                 textExtent = 30000;
00263         } <span class="keywordflow">else</span> {
00264             GetTextExtentPointW(hdc,(LPWSTR)(pText + ich*<span class="keyword">sizeof</span>(WCHAR)), -cchDiff, &amp;size);
00265             textExtent = (-1) * size.cx;
00266         }
00267     }
00268 
00269     <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00270 
00271     <span class="keywordflow">return</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left + textExtent -
00272             (textExtent ? ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o69">charOverhang</a> : 0));
00273 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="editsl.c::SLInsertText" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> SLInsertText           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpText</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cchInsert</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l01074">1074</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00555">tagED::cchTextMax</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00578">tagED::charPasswordChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00582">tagED::cPasswordCharWidth</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01281">ECCchInWidth()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02059">ECInsertText()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02429">ECNotifyParent()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00609">tagED::fAutoHScroll</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00603">tagED::fDirty</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01337">ECImeComposition()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01304">SLChar()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01157">SLPasteText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01225">SLReplaceSel()</a>, and <a class="el" href="../../d7/d4/edslrare_8c-source.html#l00087">SLUndo()</a>.
<p>
<pre class="fragment"><div>01078 {
01079     HDC hdc;
01080     PSTR pText;
01081     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> cchInsertCopy = cchInsert;
01082     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> cchT;
01083     <span class="keywordtype">int</span> textWidth;
01084     SIZE size;
01085 
01086     <span class="comment">/*</span>
01087 <span class="comment">     * First determine exactly how many characters from lpText we can insert</span>
01088 <span class="comment">     * into the ped.</span>
01089 <span class="comment">     */</span>
01090     <span class="keywordflow">if</span>( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o2">cchTextMax</a> &lt;= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>)
01091        cchInsert = 0;
01092     <span class="keywordflow">else</span> {
01093         <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o30">fAutoHScroll</a>) {
01094             pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
01095             hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, TRUE);
01096 
01097             cchInsert = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(cchInsert, (<span class="keywordtype">unsigned</span>)(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o2">cchTextMax</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>));
01098             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a>)
01099                 textWidth = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o13">cPasswordCharWidth</a>;
01100             <span class="keywordflow">else</span> {
01101                 <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>)
01102                     GetTextExtentPointA(hdc, (LPSTR)pText,  ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>, &amp;size);
01103                 <span class="keywordflow">else</span>
01104                     GetTextExtentPointW(hdc, (LPWSTR)pText, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>, &amp;size);
01105                 textWidth = size.cx;
01106             }
01107             cchT = <a class="code" href="../../d6/d0/usercli_8h.html#a443">ECCchInWidth</a>(ped, hdc, lpText, cchInsert,
01108                                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left -
01109                                 textWidth, TRUE);
01110             cchInsert = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(cchInsert, cchT);
01111 
01112             <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
01113             <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, TRUE);
01114         } <span class="keywordflow">else</span> {
01115             cchInsert = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>((<span class="keywordtype">unsigned</span>)(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o2">cchTextMax</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>), cchInsert);
01116         }
01117     }
01118 
01119 
01120     <span class="comment">/*</span>
01121 <span class="comment">     * Now try actually adding the text to the ped</span>
01122 <span class="comment">     */</span>
01123     <span class="keywordflow">if</span> (cchInsert &amp;&amp; !<a class="code" href="../../d6/d0/usercli_8h.html#a446">ECInsertText</a>(ped, lpText, &amp;cchInsert)) {
01124         <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_ERRSPACE);
01125         <span class="keywordflow">return</span> (0);
01126     }
01127     <span class="keywordflow">if</span> (cchInsert)
01128         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o24">fDirty</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; <span class="comment">/* Set modify flag */</span>
01129 
01130     <span class="keywordflow">if</span> (cchInsert &lt; cchInsertCopy) {
01131 
01132         <span class="comment">/*</span>
01133 <span class="comment">         * Notify parent that we couldn't insert all the text requested</span>
01134 <span class="comment">         */</span>
01135         <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_MAXTEXT);
01136     }
01137 
01138     <span class="comment">/*</span>
01139 <span class="comment">     * Update selection extents and the caret position. Note that ECInsertText</span>
01140 <span class="comment">     * updates ped-&gt;ichCaret, ped-&gt;ichMinSel, and ped-&gt;ichMaxSel to all be after</span>
01141 <span class="comment">     * the inserted text.</span>
01142 <span class="comment">     */</span>
01143     <span class="keywordflow">return</span> (cchInsert);
01144 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="editsl.c::SLKeyDown" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLKeyDown           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>virtKeyCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>keyMods</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l01529">1529</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00510">CTRLDOWN</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00733">ECGetModKeys()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l03969">ECNextIch()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02429">ECNotifyParent()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04001">ECPrevIch()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01552">ECWord()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00619">tagED::fEatNextChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00601">tagED::fMouseDown</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00632">tagED::fReadOnly</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01265">FWINABLE</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01683">HanjaKeyHandler()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00587">tagED::hwndParent</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00564">tagED::ichCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00682">tagED::listboxHwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00509">NONEDOWN</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00354">NotifyWinEvent()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00511">SHFTDOWN</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00395">SLChangeSelection()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01304">SLChar()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01498">SLMoveSelectionRestricted()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00932">SLScrollText()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>.
<p>
<pre class="fragment"><div>01533 {
01534     HDC hdc;
01535 
01536     <span class="comment">/*</span>
01537 <span class="comment">     * Variables we will use for redrawing the updated text</span>
01538 <span class="comment">     */</span>
01539     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>;
01540     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>;
01541 
01542     <span class="comment">/*</span>
01543 <span class="comment">     * Flags for drawing the updated text</span>
01544 <span class="comment">     */</span>
01545     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> updateText = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01546     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>; <span class="comment">/* new selection is specified by</span>
01547 <span class="comment">                                      newMinSel, newMaxSel */</span>
01548 
01549     <span class="comment">/*</span>
01550 <span class="comment">     * Comparisons we do often</span>
01551 <span class="comment">     */</span>
01552     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> MinEqMax = (newMaxSel == newMinSel);
01553     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> MinEqCar = (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> == newMinSel);
01554     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> MaxEqCar = (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> == newMaxSel);
01555 
01556     <span class="comment">/*</span>
01557 <span class="comment">     * State of shift and control keys.</span>
01558 <span class="comment">     */</span>
01559     <span class="keywordtype">int</span> scState;
01560 
01561     <span class="comment">/*</span>
01562 <span class="comment">     * Combo box support</span>
01563 <span class="comment">     */</span>
01564     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fIsListVisible;
01565     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fIsExtendedUI;
01566 
01567     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o22">fMouseDown</a>) {
01568 
01569         <span class="comment">/*</span>
01570 <span class="comment">         * If we are in the middle of a mouse down handler, then don't do</span>
01571 <span class="comment">         * anything. ie. ignore keyboard input.</span>
01572 <span class="comment">         */</span>
01573         <span class="keywordflow">return</span>;
01574     }
01575 
01576     scState = <a class="code" href="../../d6/d0/usercli_8h.html#a481">ECGetModKeys</a>(keyMods);
01577 
01578     <span class="keywordflow">switch</span> (virtKeyCode) {
01579     <span class="keywordflow">case</span> VK_UP:
01580         <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o72">listboxHwnd</a> ) {
01581 
01582             <span class="comment">/*</span>
01583 <span class="comment">             * Handle Combobox support</span>
01584 <span class="comment">             */</span>
01585             fIsExtendedUI = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, CB_GETEXTENDEDUI, 0, 0);
01586             fIsListVisible = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, CB_GETDROPPEDSTATE, 0, 0);
01587 
01588             <span class="keywordflow">if</span> (!fIsListVisible &amp;&amp; fIsExtendedUI) {
01589 
01590                 <span class="comment">/*</span>
01591 <span class="comment">                 * For TandyT</span>
01592 <span class="comment">                 */</span>
01593 DropExtendedUIListBox:
01594 
01595                 <span class="comment">/*</span>
01596 <span class="comment">                 * Since an extendedui combo box doesn't do anything on f4, we</span>
01597 <span class="comment">                 * turn off the extended ui, send the f4 to drop, and turn it</span>
01598 <span class="comment">                 * back on again.</span>
01599 <span class="comment">                 */</span>
01600                 <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, CB_SETEXTENDEDUI, 0, 0);
01601                 <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o72">listboxHwnd</a>, WM_KEYDOWN, VK_F4, 0);
01602                 <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, CB_SETEXTENDEDUI, 1, 0);
01603                 <span class="keywordflow">return</span>;
01604             } <span class="keywordflow">else</span>
01605                 <span class="keywordflow">goto</span> SendKeyToListBox;
01606         }
01607 
01608     <span class="comment">/*</span>
01609 <span class="comment">     * else fall through</span>
01610 <span class="comment">     */</span>
01611     <span class="keywordflow">case</span> VK_LEFT:
01612         <span class="comment">//</span>
01613         <span class="comment">// If the caret isn't at the beginning, we can move left</span>
01614         <span class="comment">//</span>
01615         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>) {
01616             <span class="comment">//</span>
01617             <span class="comment">// Get new caret pos.</span>
01618             <span class="comment">//</span>
01619             <span class="keywordflow">if</span> (scState &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a77">CTRLDOWN</a>) {
01620                 <span class="comment">// Move caret word left</span>
01621                 <a class="code" href="../../d6/d0/usercli_8h.html#a438">ECWord</a>(ped, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>, TRUE, &amp;ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>, NULL);
01622             } <span class="keywordflow">else</span> {
01623                 <span class="comment">// Move caret char left</span>
01624                 <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
01625                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = <a class="code" href="../../d3/d5/editsl_8c.html#a18">SLMoveSelectionRestricted</a>(ped, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>, TRUE);
01626                 } <span class="keywordflow">else</span>
01627                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a467">ECPrevIch</a>(ped,NULL,ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>);
01628             }
01629 
01630             <span class="comment">//</span>
01631             <span class="comment">// Get new selection</span>
01632             <span class="comment">//</span>
01633             <span class="keywordflow">if</span> (scState &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a78">SHFTDOWN</a>) {
01634                 <span class="keywordflow">if</span> (MaxEqCar &amp;&amp; !MinEqMax) {
01635                     <span class="comment">// Reduce selection</span>
01636                     newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01637 
01638                     UserAssert(newMinSel == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>);
01639                 } <span class="keywordflow">else</span> {
01640                     <span class="comment">// Extend selection</span>
01641                     newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01642                 }
01643             } <span class="keywordflow">else</span> {
01644                 <span class="comment">//</span>
01645                 <span class="comment">// Clear selection</span>
01646                 <span class="comment">//</span>
01647                 newMaxSel = newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01648             }
01649 
01650             changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01651         } <span class="keywordflow">else</span> {
01652             <span class="comment">//</span>
01653             <span class="comment">// If the user tries to move left and we are at the 0th</span>
01654             <span class="comment">// character and there is a selection, then cancel the</span>
01655             <span class="comment">// selection.</span>
01656             <span class="comment">//</span>
01657             <span class="keywordflow">if</span> ( (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> != ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>) &amp;&amp;
01658                 !(scState &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a78">SHFTDOWN</a>) ) {
01659                 changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01660                 newMaxSel = newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01661             }
01662         }
01663         <span class="keywordflow">break</span>;
01664 
01665     <span class="keywordflow">case</span> VK_DOWN:
01666         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o72">listboxHwnd</a>) {
01667 
01668             <span class="comment">/*</span>
01669 <span class="comment">             * Handle Combobox support</span>
01670 <span class="comment">             */</span>
01671             fIsExtendedUI = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, CB_GETEXTENDEDUI, 0, 0);
01672             fIsListVisible = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, CB_GETDROPPEDSTATE, 0, 0);
01673 
01674             <span class="keywordflow">if</span> (!fIsListVisible &amp;&amp; fIsExtendedUI) {
01675 
01676                 <span class="comment">/*</span>
01677 <span class="comment">                 * For TandyT</span>
01678 <span class="comment">                 */</span>
01679                 <span class="keywordflow">goto</span> DropExtendedUIListBox;
01680             } <span class="keywordflow">else</span>
01681                 <span class="keywordflow">goto</span> SendKeyToListBox;
01682         }
01683 
01684     <span class="comment">/*</span>
01685 <span class="comment">     * else fall through</span>
01686 <span class="comment">     */</span>
01687     <span class="keywordflow">case</span> VK_RIGHT:
01688         <span class="comment">//</span>
01689         <span class="comment">// If the caret isn't at the end, we can move right.</span>
01690         <span class="comment">//</span>
01691         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>) {
01692             <span class="comment">//</span>
01693             <span class="comment">// Get new caret pos.</span>
01694             <span class="comment">//</span>
01695             <span class="keywordflow">if</span> (scState &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a77">CTRLDOWN</a>) {
01696                 <span class="comment">// Move caret word right</span>
01697                 <a class="code" href="../../d6/d0/usercli_8h.html#a438">ECWord</a>(ped, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>, FALSE, NULL, &amp;ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>);
01698             } <span class="keywordflow">else</span> {
01699                 <span class="comment">// Move caret char right</span>
01700                 <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
01701                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = <a class="code" href="../../d3/d5/editsl_8c.html#a18">SLMoveSelectionRestricted</a>(ped, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>, FALSE);
01702                 } <span class="keywordflow">else</span>
01703                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a468">ECNextIch</a>(ped,NULL,ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>);
01704             }
01705 
01706             <span class="comment">//</span>
01707             <span class="comment">// Get new selection.</span>
01708             <span class="comment">//</span>
01709             <span class="keywordflow">if</span> (scState &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a78">SHFTDOWN</a>) {
01710                 <span class="keywordflow">if</span> (MinEqCar &amp;&amp; !MinEqMax) {
01711                     <span class="comment">// Reduce selection</span>
01712                     newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01713 
01714                     UserAssert(newMaxSel == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>);
01715                 } <span class="keywordflow">else</span> {
01716                     <span class="comment">// Extend selection</span>
01717                     newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01718                 }
01719             } <span class="keywordflow">else</span> {
01720                 <span class="comment">// Clear selection</span>
01721                 newMaxSel = newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01722             }
01723 
01724             changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01725         } <span class="keywordflow">else</span> {
01726             <span class="comment">//</span>
01727             <span class="comment">// If the user tries to move right and we are at the last</span>
01728             <span class="comment">// character and there is a selection, then cancel the</span>
01729             <span class="comment">// selection.</span>
01730             <span class="comment">//</span>
01731             <span class="keywordflow">if</span> ( (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> != ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>) &amp;&amp;
01732                 !(scState &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a78">SHFTDOWN</a>) ) {
01733                 newMaxSel = newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01734                 changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01735             }
01736         }
01737         <span class="keywordflow">break</span>;
01738 
01739     <span class="keywordflow">case</span> VK_HOME:
01740         <span class="comment">//</span>
01741         <span class="comment">// Move caret to top.</span>
01742         <span class="comment">//</span>
01743         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = 0;
01744 
01745         <span class="comment">//</span>
01746         <span class="comment">// Update selection.</span>
01747         <span class="comment">//</span>
01748         <span class="keywordflow">if</span> (scState &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a78">SHFTDOWN</a>) {
01749             <span class="keywordflow">if</span> (MaxEqCar &amp;&amp; !MinEqMax) {
01750                 <span class="comment">// Reduce selection</span>
01751                 newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01752                 newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>;
01753             } <span class="keywordflow">else</span> {
01754                 <span class="comment">// Extend selection</span>
01755                 newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01756             }
01757         } <span class="keywordflow">else</span> {
01758             <span class="comment">// Clear selection</span>
01759             newMaxSel = newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01760         }
01761 
01762         changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01763         <span class="keywordflow">break</span>;
01764 
01765     <span class="keywordflow">case</span> VK_END:
01766         <span class="comment">//</span>
01767         <span class="comment">// Move caret to end.</span>
01768         <span class="comment">//</span>
01769         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>;
01770 
01771         <span class="comment">//</span>
01772         <span class="comment">// Update selection.</span>
01773         <span class="comment">//</span>
01774         newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01775         <span class="keywordflow">if</span> (scState &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a78">SHFTDOWN</a>) {
01776             <span class="keywordflow">if</span> (MinEqCar &amp;&amp; !MinEqMax) {
01777                 <span class="comment">// Reduce selection</span>
01778                 newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>;
01779             }
01780         } <span class="keywordflow">else</span> {
01781             <span class="comment">// Clear selection</span>
01782             newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01783         }
01784 
01785         changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01786         <span class="keywordflow">break</span>;
01787 
01788     <span class="keywordflow">case</span> VK_DELETE:
01789         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o39">fReadOnly</a>)
01790             <span class="keywordflow">break</span>;
01791 
01792         <span class="keywordflow">switch</span> (scState) {
01793         <span class="keywordflow">case</span> <a class="code" href="../../d6/d0/usercli_8h.html#a76">NONEDOWN</a>:
01794 
01795             <span class="comment">/*</span>
01796 <span class="comment">             * Clear selection. If no selection, delete (clear) character</span>
01797 <span class="comment">             * right.</span>
01798 <span class="comment">             */</span>
01799             <span class="keywordflow">if</span> ((ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>) &amp;&amp; (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>)) {
01800 
01801                 <span class="comment">/*</span>
01802 <span class="comment">                 * Move cursor forwards and simulate a backspace.</span>
01803 <span class="comment">                 */</span>
01804                 <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
01805                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01806                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = <a class="code" href="../../d3/d5/editsl_8c.html#a18">SLMoveSelectionRestricted</a>(ped, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>, FALSE);
01807                 } <span class="keywordflow">else</span> {
01808                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a468">ECNextIch</a>(ped,NULL,ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>);
01809                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01810                 }
01811                 <a class="code" href="../../d6/d0/usercli_8h.html#a534">SLChar</a>(ped, (UINT)VK_BACK);
01812             }
01813             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> != ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>)
01814                 <a class="code" href="../../d6/d0/usercli_8h.html#a534">SLChar</a>(ped, (UINT)VK_BACK);
01815             <span class="keywordflow">break</span>;
01816 
01817         <span class="keywordflow">case</span> <a class="code" href="../../d6/d0/usercli_8h.html#a78">SHFTDOWN</a>:
01818 
01819             <span class="comment">//</span>
01820             <span class="comment">// Send ourself a WM_CUT message if a selection exists.</span>
01821             <span class="comment">// Otherwise, delete the left character.</span>
01822             <span class="comment">//</span>
01823             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>) {
01824                 UserAssert(!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o36">fEatNextChar</a>);
01825                 <a class="code" href="../../d6/d0/usercli_8h.html#a534">SLChar</a>(ped, VK_BACK);
01826             } <span class="keywordflow">else</span>
01827                 <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, WM_CUT, 0, 0L);
01828 
01829             <span class="keywordflow">break</span>;
01830 
01831         <span class="keywordflow">case</span> <a class="code" href="../../d6/d0/usercli_8h.html#a77">CTRLDOWN</a>:
01832 
01833             <span class="comment">/*</span>
01834 <span class="comment">             * Delete to end of line if no selection else delete (clear)</span>
01835 <span class="comment">             * selection.</span>
01836 <span class="comment">             */</span>
01837             <span class="keywordflow">if</span> ((ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>) &amp;&amp; (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>)) {
01838 
01839                 <span class="comment">/*</span>
01840 <span class="comment">                 * Move cursor to end of line and simulate a backspace.</span>
01841 <span class="comment">                 */</span>
01842                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>;
01843             }
01844             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> != ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>)
01845                 <a class="code" href="../../d6/d0/usercli_8h.html#a534">SLChar</a>(ped, (UINT)VK_BACK);
01846             <span class="keywordflow">break</span>;
01847 
01848         }
01849 
01850         <span class="comment">/*</span>
01851 <span class="comment">         * No need to update text or selection since BACKSPACE message does it</span>
01852 <span class="comment">         * for us.</span>
01853 <span class="comment">         */</span>
01854         <span class="keywordflow">break</span>;
01855 
01856     <span class="keywordflow">case</span> VK_INSERT:
01857         <span class="keywordflow">switch</span> (scState) {
01858         <span class="keywordflow">case</span> <a class="code" href="../../d6/d0/usercli_8h.html#a77">CTRLDOWN</a>:
01859 
01860             <span class="comment">/*</span>
01861 <span class="comment">             * Copy current selection to clipboard</span>
01862 <span class="comment">             */</span>
01863             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, WM_COPY, 0, 0);
01864             <span class="keywordflow">break</span>;
01865 
01866         <span class="keywordflow">case</span> <a class="code" href="../../d6/d0/usercli_8h.html#a78">SHFTDOWN</a>:
01867             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, WM_PASTE, 0, 0L);
01868             <span class="keywordflow">break</span>;
01869         }
01870         <span class="keywordflow">break</span>;
01871 
01872     <span class="comment">// VK_HANJA support</span>
01873     <span class="keywordflow">case</span> VK_HANJA:
01874         <span class="keywordflow">if</span> ( <a class="code" href="../../d6/d0/usercli_8h.html#a476">HanjaKeyHandler</a>( ped ) ) {
01875             changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01876             newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
01877             newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> + (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> ? 2 : 1);
01878         }
01879         <span class="keywordflow">break</span>;
01880 
01881     <span class="keywordflow">case</span> VK_F4:
01882     <span class="keywordflow">case</span> VK_PRIOR:
01883     <span class="keywordflow">case</span> VK_NEXT:
01884 
01885         <span class="comment">/*</span>
01886 <span class="comment">         * Send keys to the listbox if we are a part of a combo box. This</span>
01887 <span class="comment">         * assumes the listbox ignores keyup messages which is correct right</span>
01888 <span class="comment">         * now.</span>
01889 <span class="comment">         */</span>
01890 SendKeyToListBox:
01891         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o72">listboxHwnd</a>) {
01892 
01893             <span class="comment">/*</span>
01894 <span class="comment">             * Handle Combobox support</span>
01895 <span class="comment">             */</span>
01896             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o72">listboxHwnd</a>, WM_KEYDOWN, virtKeyCode, 0L);
01897             <span class="keywordflow">return</span>;
01898         }
01899     }
01900 
01901     <span class="keywordflow">if</span> (changeSelection || updateText) {
01902         hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, FALSE);
01903 
01904         <span class="comment">/*</span>
01905 <span class="comment">         * Scroll if needed</span>
01906 <span class="comment">         */</span>
01907         <a class="code" href="../../d6/d0/usercli_8h.html#a530">SLScrollText</a>(ped, hdc);
01908 
01909         <span class="keywordflow">if</span> (changeSelection)
01910             <a class="code" href="../../d6/d0/usercli_8h.html#a526">SLChangeSelection</a>(ped, hdc, newMinSel, newMaxSel);
01911 
01912         <span class="keywordflow">if</span> (updateText)
01913             <a class="code" href="../../d6/d0/usercli_8h.html#a527">SLDrawText</a>(ped, hdc, 0);
01914 
01915         <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, FALSE);
01916         <span class="keywordflow">if</span> (updateText) {
01917             <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_CHANGE);
01918 
01919             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
01920                 <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a12">NotifyWinEvent</a>(EVENT_OBJECT_VALUECHANGE, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, OBJID_CLIENT, INDEXID_CONTAINER);
01921             }
01922         }
01923     }
01924 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="editsl.c::SLKillFocus" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLKillFocus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>newFocusHwnd</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l02394">2394</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d9/d3/editec_8c-source.html#l02429">ECNotifyParent()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00610">tagED::fNoHideSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00587">tagED::hwndParent</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00564">tagED::ichCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00508">IsChild()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00682">tagED::listboxHwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01560">NtUserDestroyCaret</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05330">NtUserInvalidateRect()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00283">SLSetSelection()</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>.
<p>
<pre class="fragment"><div>02397 {
02398     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a>) {
02399 
02400         <span class="comment">/*</span>
02401 <span class="comment">         * Destroy the caret (Win31/Chicago hides it first)</span>
02402 <span class="comment">         */</span>
02403         <a class="code" href="../../d6/d0/usercli_8h.html#a215">NtUserDestroyCaret</a>();
02404 
02405         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>; <span class="comment">/* Clear focus */</span>
02406         <span class="comment">/*</span>
02407 <span class="comment">         * Do this only if we still have the focus. But we always notify the</span>
02408 <span class="comment">         * parent that we lost the focus whether or not we originally had the</span>
02409 <span class="comment">         * focus.</span>
02410 <span class="comment">         */</span>
02411 
02412         <span class="comment">/*</span>
02413 <span class="comment">         * Hide the current selection if needed</span>
02414 <span class="comment">         */</span>
02415         <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o31">fNoHideSel</a> &amp;&amp; (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> != ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>)) {
02416             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, NULL, FALSE);
02417 <span class="preprocessor">#if 0</span>
02418 <span class="preprocessor"></span>            <a class="code" href="../../d6/d0/usercli_8h.html#a531">SLSetSelection</a>(ped, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>);
02419 <span class="preprocessor">#endif</span>
02420 <span class="preprocessor"></span>        }
02421     }
02422 
02423     <span class="comment">/*</span>
02424 <span class="comment">     * If we aren't a combo box, notify parent that we lost the focus.</span>
02425 <span class="comment">     */</span>
02426     <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o72">listboxHwnd</a>)
02427         <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_KILLFOCUS);
02428     <span class="keywordflow">else</span> {
02429 
02430         <span class="comment">/*</span>
02431 <span class="comment">         * This editcontrol is part of a combo box and is losing the focus. If</span>
02432 <span class="comment">         * the focus is NOT being sent to another control in the combo box</span>
02433 <span class="comment">         * window, then it means the combo box is losing the focus. So we will</span>
02434 <span class="comment">         * notify the combo box of this fact.</span>
02435 <span class="comment">         */</span>
02436         <span class="keywordflow">if</span> ((newFocusHwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
02437                     (!<a class="code" href="../../d3/d9/client_2wow_8c.html#a18">IsChild</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, newFocusHwnd))) {
02438             <span class="comment">// Excel has a slaker in it's midst.  They're not using our combo</span>
02439             <span class="comment">// boxes, but they still expect to get all the internal messages</span>
02440             <span class="comment">// that we give to OUR comboboxes.  And they expect them to be at</span>
02441             <span class="comment">// the same offset from WM_USER as they were in 3.1.</span>
02442             <span class="comment">//                                           (JEFFBOG - 01/26/94)</span>
02443             <span class="comment">/*</span>
02444 <span class="comment">             * Windows NT won't fix the bug described above: it only applies</span>
02445 <span class="comment">             * to old 16-bit excel, and WOW converts msgs to Win3.1 values.</span>
02446 <span class="comment">             */</span>
02447 
02448             <span class="comment">/*</span>
02449 <span class="comment">             * Focus is being sent to a window which is not a child of the combo</span>
02450 <span class="comment">             * box window which implies that the combo box is losing the focus.</span>
02451 <span class="comment">             * Send a message to the combo box informing him of this fact so</span>
02452 <span class="comment">             * that he can clean up...</span>
02453 <span class="comment">             */</span>
02454             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o17">hwndParent</a>, CBEC_KILLCOMBOFOCUS, 0, 0L);
02455         }
02456     }
02457 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="editsl.c::SLMouseMotion" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLMouseMotion           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>virtKeyDown</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPPOINT&nbsp;</td>
          <td class="mdname" nowrap> <em>mousePt</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l02098">2098</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04083">ECIsDBCSLeadByte()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01552">ECWord()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00611">tagED::fDBCS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00601">tagED::fMouseDown</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00610">tagED::fNoHideSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00564">tagED::ichCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00561">tagED::ichMinSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00700">tagED::ichStartMaxSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00699">tagED::ichStartMinSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00682">tagED::listboxHwnd</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01570">NtUserReleaseCapture</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05822">NtUserSetCapture()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05902">NtUserSetFocus()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00395">SLChangeSelection()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01934">SLMouseToIch()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00932">SLScrollText()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>.
<p>
<pre class="fragment"><div>02103 {
02104     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   selectionl;
02105     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   selectionh;
02106     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    changeSelection;
02107     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>     newMaxSel;
02108     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>     newMinSel;
02109     HDC     hdc;
02110     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>     mouseIch;
02111     LPSTR   pText;
02112 
02113     changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02114 
02115     newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>;
02116     newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>;
02117 
02118     hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, FALSE);
02119     mouseIch = <a class="code" href="../../d6/d0/usercli_8h.html#a536">SLMouseToIch</a>(ped, hdc, mousePt);
02120 
02121     <span class="keywordflow">switch</span> (message) {
02122         <span class="keywordflow">case</span> WM_LBUTTONDBLCLK:
02123 
02124             <span class="comment">// if shift key is down, extend selection to word we double clicked on</span>
02125             <span class="comment">// else clear current selection and select word.</span>
02126 
02127             <span class="comment">// in DBCS, we have different word breaking. LiZ -- 5/5/93</span>
02128             <span class="comment">// In Hangeul Environment we use word selection feature because Hangeul</span>
02129             <span class="comment">// use SPACE as word break</span>
02130             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o32">fDBCS</a>) {
02131                 pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped) + mouseIch;
02132                 <a class="code" href="../../d6/d0/usercli_8h.html#a438">ECWord</a>(ped, mouseIch,
02133                        (<a class="code" href="../../d6/d0/usercli_8h.html#a464">ECIsDBCSLeadByte</a>(ped,*pText) &amp;&amp; mouseIch &lt; ped-&gt;cch) ? FALSE : TRUE,
02134                        &amp;selectionl, &amp;selectionh);
02135                 <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
02136             } <span class="keywordflow">else</span> {
02137                 <a class="code" href="../../d6/d0/usercli_8h.html#a438">ECWord</a>(ped, mouseIch, (mouseIch) ? TRUE : FALSE, &amp;selectionl, &amp;selectionh);
02138             }
02139 
02140             <span class="keywordflow">if</span> (!(virtKeyDown &amp; MK_SHIFT)) {
02141                 <span class="comment">// If shift key isn't down, move caret to mouse point and clear</span>
02142                 <span class="comment">// old selection</span>
02143                 newMinSel = selectionl;
02144                 newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = selectionh;
02145             } <span class="keywordflow">else</span> {
02146                 <span class="comment">// Shiftkey is down so we want to maintain the current selection</span>
02147                 <span class="comment">// (if any) and just extend or reduce it</span>
02148                 <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>) {
02149                     newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = selectionl;
02150                     <a class="code" href="../../d6/d0/usercli_8h.html#a438">ECWord</a>(ped, newMaxSel, TRUE, &amp;selectionl, &amp;selectionh);
02151                 } <span class="keywordflow">else</span> {
02152                     newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = selectionh;
02153                     <a class="code" href="../../d6/d0/usercli_8h.html#a438">ECWord</a>(ped, newMinSel, FALSE, &amp;selectionl, &amp;selectionh);
02154                 }
02155                 <span class="comment">/*</span>
02156 <span class="comment">                 * v-ronaar: fix bug 24627 - edit selection is weird.</span>
02157 <span class="comment">                 */</span>
02158                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
02159             }
02160 
02161             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o82">ichStartMinSel</a> = selectionl;
02162             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o83">ichStartMaxSel</a> = selectionh;
02163 
02164             <span class="keywordflow">goto</span> InitDragSelect;
02165 
02166         <span class="keywordflow">case</span> WM_MOUSEMOVE:
02167             <span class="comment">//</span>
02168             <span class="comment">// We know the mouse button's down -- otherwise the OPTIMIZE</span>
02169             <span class="comment">// test would've failed in SLEditWndProc and never called</span>
02170             <span class="comment">//</span>
02171             changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02172 
02173             <span class="comment">// Extend selection, move caret word right</span>
02174             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o82">ichStartMinSel</a> || ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o83">ichStartMaxSel</a>) {
02175                 <span class="comment">// We're in WORD SELECT mode</span>
02176                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fReverse = (mouseIch &lt;= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o82">ichStartMinSel</a>);
02177 
02178                 <a class="code" href="../../d6/d0/usercli_8h.html#a438">ECWord</a>(ped, mouseIch, !fReverse, &amp;selectionl, &amp;selectionh);
02179 
02180                 <span class="keywordflow">if</span> (fReverse) {
02181                     newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = selectionl;
02182                     newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o83">ichStartMaxSel</a>;
02183                 } <span class="keywordflow">else</span> {
02184                     newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o82">ichStartMinSel</a>;
02185                     newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = selectionh;
02186                 }
02187             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>) &amp;&amp;
02188                 (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> != ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>))
02189                 <span class="comment">// Reduce selection extent</span>
02190                 newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = mouseIch;
02191             <span class="keywordflow">else</span>
02192                 <span class="comment">// Extend selection extent</span>
02193                 newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>=mouseIch;
02194             <span class="keywordflow">break</span>;
02195 
02196         <span class="keywordflow">case</span> WM_LBUTTONDOWN:
02197             <span class="comment">// If we currently don't have the focus yet, try to get it.</span>
02198             <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a>) {
02199                 <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o31">fNoHideSel</a>)
02200                     <span class="comment">// Clear the selection before setting the focus so that we</span>
02201                     <span class="comment">// don't get refresh problems and flicker. Doesn't matter</span>
02202                     <span class="comment">// since the mouse down will end up changing it anyway.</span>
02203                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
02204 
02205                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a225">NtUserSetFocus</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>);
02206 
02207                 <span class="comment">//</span>
02208                 <span class="comment">// BOGUS</span>
02209                 <span class="comment">// (1) We should see if SetFocus() succeeds.</span>
02210                 <span class="comment">// (2) We should ignore mouse messages if the first window</span>
02211                 <span class="comment">//      ancestor with a caption isn't "active."</span>
02212                 <span class="comment">//</span>
02213 
02214                 <span class="comment">// If we are part of a combo box, then this is the first time</span>
02215                 <span class="comment">// the edit control is getting the focus so we just want to</span>
02216                 <span class="comment">// highlight the selection and we don't really want to position</span>
02217                 <span class="comment">// the caret.</span>
02218                 <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o72">listboxHwnd</a>)
02219                     <span class="keywordflow">break</span>;
02220 
02221                 <span class="comment">// We yield at SetFocus -- text might have changed at that point</span>
02222                 <span class="comment">// update selection and caret info accordingly</span>
02223                 <span class="comment">// FIX for bug # 11743 -- JEFFBOG 8/23/91</span>
02224                 newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>;
02225                 newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a>;
02226                 mouseIch  = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(mouseIch, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>);
02227             }
02228 
02229             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a>) {
02230                 <span class="comment">// Only do this if we have the focus since a clever app may not</span>
02231                 <span class="comment">// want to give us the focus at the SetFocus call above.</span>
02232                 <span class="keywordflow">if</span> (!(virtKeyDown &amp; MK_SHIFT)) {
02233                     <span class="comment">// If shift key isn't down, move caret to mouse point and</span>
02234                     <span class="comment">// clear old selection</span>
02235                     newMinSel = newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = mouseIch;
02236                 } <span class="keywordflow">else</span> {
02237                     <span class="comment">// Shiftkey is down so we want to maintain the current</span>
02238                     <span class="comment">// selection (if any) and just extend or reduce it</span>
02239                     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o5">ichMinSel</a> == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>)
02240                         newMinSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = mouseIch;
02241                     <span class="keywordflow">else</span>
02242                         newMaxSel = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = mouseIch;
02243                 }
02244 
02245                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o82">ichStartMinSel</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o83">ichStartMaxSel</a> = 0;
02246 
02247 InitDragSelect:
02248                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o22">fMouseDown</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02249                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a221">NtUserSetCapture</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>);
02250                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o22">fMouseDown</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02251                 changeSelection = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02252             }
02253             <span class="keywordflow">break</span>;
02254 
02255         <span class="keywordflow">case</span> WM_LBUTTONUP:
02256             <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o22">fMouseDown</a>) {
02257                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o22">fMouseDown</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02258                 <a class="code" href="../../d6/d0/usercli_8h.html#a225">NtUserReleaseCapture</a>();
02259             }
02260             <span class="keywordflow">break</span>;
02261     }
02262 
02263     <span class="keywordflow">if</span> (changeSelection) {
02264         <a class="code" href="../../d6/d0/usercli_8h.html#a530">SLScrollText</a>(ped,hdc);
02265         <a class="code" href="../../d6/d0/usercli_8h.html#a526">SLChangeSelection</a>(ped, hdc, newMinSel, newMaxSel);
02266     }
02267 
02268     <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, FALSE);
02269 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="editsl.c::SLMouseToIch" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> SLMouseToIch           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPPOINT&nbsp;</td>
          <td class="mdname" nowrap> <em>mousePt</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l01934">1934</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00661">tagED::cbChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00578">tagED::charPasswordChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00582">tagED::cPasswordCharWidth</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04133">ECAdjustIch()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01281">ECCchInWidth()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04083">ECIsDBCSLeadByte()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03291">tagLPKEDITCALLOUT::EditMouseToIch</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00611">tagED::fDBCS</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00023">FnGetTextExtentPoint</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00664">tagED::format</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00570">tagED::ichScreenStart</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00080">SLCalcXOffsetSpecial()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l02098">SLMouseMotion()</a>.
<p>
<pre class="fragment"><div>01938 {
01939     PSTR pText;
01940     <span class="keywordtype">int</span> width = mousePt-&gt;x;
01941     <span class="keywordtype">int</span> lastHighWidth, lastLowWidth;
01942     SIZE size;
01943     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> cch;
01944     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> cchLo, cchHi;
01945     LPSTR lpText;
01946     <a class="code" href="../../d3/d5/editsl_8c.html#a1">FnGetTextExtentPoint</a> pGetTextExtentPoint;
01947 
01948     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
01949         pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
01950         cch = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>-&gt;<a class="code" href="../../d2/d0/structtagLPKEDITCALLOUT.html#o2">EditMouseToIch</a>(ped, hdc, pText, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>, width);
01951         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
01952         <span class="keywordflow">return</span> cch;
01953     }
01954 
01955     <span class="keywordflow">if</span> (width &lt;= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left) {
01956 
01957         <span class="comment">/*</span>
01958 <span class="comment">         * Return either the first non visible character or return 0 if at</span>
01959 <span class="comment">         * beginning of text</span>
01960 <span class="comment">         */</span>
01961         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>)
01962             <span class="keywordflow">return</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> - 1);
01963         <span class="keywordflow">else</span>
01964             <span class="keywordflow">return</span> (0);
01965     }
01966 
01967     <span class="keywordflow">if</span> (width &gt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right) {
01968         pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
01969 
01970         <span class="comment">/*</span>
01971 <span class="comment">         * Return last char in text or one plus the last char visible</span>
01972 <span class="comment">         */</span>
01973         cch = <a class="code" href="../../d6/d0/usercli_8h.html#a443">ECCchInWidth</a>(ped, hdc,
01974                 (LPSTR)(pText + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>),
01975                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right -
01976                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left, TRUE) + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>;
01977 
01978         <span class="comment">//</span>
01979         <span class="comment">// This is marked as JAPAN in Win31J. But it should be a DBCS</span>
01980         <span class="comment">// issue. LiZ -- 5/5/93</span>
01981         <span class="comment">// We must check DBCS Lead byte. Because ECAdjustIch() pick up Prev Char.</span>
01982         <span class="comment">//  1993.3.9 by yutakas</span>
01983         <span class="comment">//</span>
01984         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o32">fDBCS</a>) {
01985             <span class="keywordflow">if</span> (cch &gt;= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>) {
01986                 cch = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>;
01987             } <span class="keywordflow">else</span> {
01988                 <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a464">ECIsDBCSLeadByte</a>(ped,*(pText+cch))) {
01989                     cch += 2;
01990                 } <span class="keywordflow">else</span> {
01991                     cch ++;
01992                 }
01993             }
01994             <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
01995             <span class="keywordflow">return</span> cch;
01996         } <span class="keywordflow">else</span> {
01997             <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
01998             <span class="keywordflow">if</span> (cch &gt;= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>)
01999                 <span class="keywordflow">return</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>);
02000             <span class="keywordflow">else</span>
02001                 <span class="keywordflow">return</span> (cch + 1);
02002         }
02003     }
02004 
02005     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> != ES_LEFT) {
02006         width -= <a class="code" href="../../d3/d5/editsl_8c.html#a4">SLCalcXOffsetSpecial</a>(ped, hdc, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>);
02007     }
02008 
02009     <span class="comment">/*</span>
02010 <span class="comment">     * Check if password hidden chars are being used.</span>
02011 <span class="comment">     */</span>
02012     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o12">charPasswordChar</a>)
02013         <span class="keywordflow">return</span> <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>( (DWORD)( (width - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left) / ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o13">cPasswordCharWidth</a>),
02014                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>);
02015 
02016     <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>)
02017         <span class="keywordflow">return</span> (0);
02018 
02019     pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
02020     lpText = pText + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>;
02021 
02022     pGetTextExtentPoint = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> ? (<a class="code" href="../../d3/d5/editsl_8c.html#a1">FnGetTextExtentPoint</a>)GetTextExtentPointA
02023                                      : (<a class="code" href="../../d3/d5/editsl_8c.html#a1">FnGetTextExtentPoint</a>)GetTextExtentPointW;
02024     width -= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left;
02025 
02026     <span class="comment">/*</span>
02027 <span class="comment">     * If the user clicked past the end of the text, return the last character</span>
02028 <span class="comment">     */</span>
02029     cchHi = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>;
02030     pGetTextExtentPoint(hdc, lpText, cchHi, &amp;size);
02031     <span class="keywordflow">if</span> (size.cx &lt;= width) {
02032         cch = cchHi;
02033         <span class="keywordflow">goto</span> edAdjust;
02034     }
02035     <span class="comment">/*</span>
02036 <span class="comment">     * Initialize Binary Search Bounds</span>
02037 <span class="comment">     */</span>
02038     cchLo = 0;
02039     cchHi ++;
02040     lastLowWidth = 0;
02041     lastHighWidth = size.cx;
02042 
02043     <span class="comment">/*</span>
02044 <span class="comment">     * Binary search for closest char</span>
02045 <span class="comment">     */</span>
02046     <span class="keywordflow">while</span> (cchLo &lt; cchHi - 1) {
02047 
02048         cch = (cchHi + cchLo) / 2;
02049         pGetTextExtentPoint(hdc, lpText, cch, &amp;size);
02050 
02051         <span class="keywordflow">if</span> (size.cx &lt;= width) {
02052             cchLo = cch;
02053             lastLowWidth = size.cx;
02054         } <span class="keywordflow">else</span> {
02055             cchHi = cch;
02056             lastHighWidth = size.cx;
02057         }
02058     }
02059 
02060     <span class="comment">/*</span>
02061 <span class="comment">     * When the while ends, you can't know the exact position.</span>
02062 <span class="comment">     * Try to see if the mouse pointer was on the farest half</span>
02063 <span class="comment">     * of the char we got and if so, adjust cch.</span>
02064 <span class="comment">     */</span>
02065     <span class="keywordflow">if</span> (cchLo == cch) {
02066         <span class="comment">/*</span>
02067 <span class="comment">         * Need to compare with lastHighWidth</span>
02068 <span class="comment">         */</span>
02069         <span class="keywordflow">if</span> ((lastHighWidth - width) &lt; (width - size.cx)) {
02070             cch++;
02071         }
02072     } <span class="keywordflow">else</span> {
02073         <span class="comment">/*</span>
02074 <span class="comment">         * Need to compare with lastLowWidth</span>
02075 <span class="comment">         */</span>
02076         <span class="keywordflow">if</span> ((width - lastLowWidth) &lt; (size.cx - width)) {
02077             cch--;
02078         }
02079     }
02080 
02081 edAdjust:
02082     <span class="comment">//</span>
02083     <span class="comment">// Avoid to point the intermediate of double byte character</span>
02084     <span class="comment">//</span>
02085     cch = <a class="code" href="../../d6/d0/usercli_8h.html#a461">ECAdjustIch</a>( ped, pText, cch + ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> );
02086     <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
02087     <span class="keywordflow">return</span> ( cch );
02088 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="editsl.c::SLMoveSelectionRestricted" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> SLMoveSelectionRestricted           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ich</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fLeft</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l01498">1498</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03296">tagLPKEDITCALLOUT::EditMoveSelection</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l01529">SLKeyDown()</a>.
<p>
<pre class="fragment"><div>01502 {
01503     PSTR pText;
01504     HDC  hdc;
01505     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a>  ichResult;
01506 
01507     pText = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
01508     hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, TRUE);
01509     ichResult = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>-&gt;<a class="code" href="../../d2/d0/structtagLPKEDITCALLOUT.html#o7">EditMoveSelection</a>(ped, hdc, pText, ich, fLeft);
01510     <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, TRUE);
01511     <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
01512 
01513     <span class="keywordflow">return</span> ichResult;
01514 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="editsl.c::SLPaint" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLPaint           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l02280">2280</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00924">_GetClientRect()</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00860">_IsWindowVisible()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00711">DF_WINDOWFRAME</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l01188">DrawFrame()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01412">ECGetBrush()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00643">tagED::fFlatBorder</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00061">FillRect()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00674">tagED::hFont</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05279">NtUserHideCaret()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06219">NtUserShowCaret()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00585">tagED::pwnd</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>.
<p>
<pre class="fragment"><div>02283 {
02284     HWND   hwnd = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>;
02285     HBRUSH hBrushRemote;
02286     RECT   rcEdit;
02287     HANDLE hOldFont;
02288 
02289     <span class="comment">/*</span>
02290 <span class="comment">     * Had to put in hide/show carets. The first one needs to be done before</span>
02291 <span class="comment">     * beginpaint to correctly paint the caret if part is in the update region</span>
02292 <span class="comment">     * and part is out. The second is for 1.03 compatibility. It breaks</span>
02293 <span class="comment">     * micrografix's worksheet edit control if not there.</span>
02294 <span class="comment">     */</span>
02295     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a204">NtUserHideCaret</a>(hwnd);
02296 
02297     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a17">_IsWindowVisible</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>)) {
02298         <span class="comment">/*</span>
02299 <span class="comment">         * Erase the background since we don't do it in the erasebkgnd message.</span>
02300 <span class="comment">         */</span>
02301         hBrushRemote = <a class="code" href="../../d6/d0/usercli_8h.html#a480">ECGetBrush</a>(ped, hdc);
02302         <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>, (LPRECT)&amp;rcEdit);
02303         <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a3">FillRect</a>(hdc, &amp;rcEdit, hBrushRemote);
02304 
02305         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o45">fFlatBorder</a>)
02306         {
02307             RECT    rcT;
02308 
02309             <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>, &amp;rcT);
02310             <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a17">DrawFrame</a>(hdc, &amp;rcT, 1, DF_WINDOWFRAME);
02311         }
02312 
02313         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o66">hFont</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02314             <span class="comment">/*</span>
02315 <span class="comment">             * We have to select in the font since this may be a subclassed dc</span>
02316 <span class="comment">             * or a begin paint dc which hasn't been initialized with out fonts</span>
02317 <span class="comment">             * like ECGetEditDC does.</span>
02318 <span class="comment">             */</span>
02319             hOldFont = SelectObject(hdc, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o66">hFont</a>);
02320         }
02321 
02322         <a class="code" href="../../d6/d0/usercli_8h.html#a527">SLDrawText</a>(ped, hdc, 0);
02323 
02324         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o66">hFont</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; hOldFont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02325             SelectObject(hdc, hOldFont);
02326         }
02327     }
02328 
02329     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a234">NtUserShowCaret</a>(hwnd);
02330 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="editsl.c::SLPaste" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLPaste           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ped</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l02467">2467</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d9/d3/editec_8c-source.html#l02293">ECDeleteText()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02429">ECNotifyParent()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01265">FWINABLE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00354">NotifyWinEvent()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01157">SLPasteText()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00932">SLScrollText()</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>.
<p>
<pre class="fragment"><div>02468 {
02469     HDC hdc;
02470 
02471     <span class="comment">//</span>
02472     <span class="comment">// Insert contents of clipboard, after unhilighting current selection</span>
02473     <span class="comment">// and deleting it.</span>
02474     <span class="comment">//</span>
02475     <a class="code" href="../../d6/d0/usercli_8h.html#a447">ECDeleteText</a>(ped);
02476     <a class="code" href="../../d6/d0/usercli_8h.html#a533">SLPasteText</a>(ped);
02477 
02478     <span class="comment">//</span>
02479     <span class="comment">// Update display</span>
02480     <span class="comment">//</span>
02481     <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_UPDATE);
02482 
02483     hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped,FALSE);
02484 
02485     <a class="code" href="../../d6/d0/usercli_8h.html#a530">SLScrollText</a>(ped, hdc);
02486     <a class="code" href="../../d6/d0/usercli_8h.html#a527">SLDrawText</a>(ped, hdc, 0);
02487 
02488     <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped,hdc,FALSE);
02489 
02490     <span class="comment">/*</span>
02491 <span class="comment">     * Tell parent our text contents changed.</span>
02492 <span class="comment">     */</span>
02493     <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_CHANGE);
02494     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
02495         <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a12">NotifyWinEvent</a>(EVENT_OBJECT_VALUECHANGE, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, OBJID_CLIENT, INDEXID_CONTAINER);
02496     }
02497 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="editsl.c::SLPasteText" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a> PASCAL NEAR SLPasteText           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ped</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l01157">1157</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l00390">GetClipboardData()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l03252">NtUserCloseClipboard()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00540">OpenClipboard()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01074">SLInsertText()</a>, <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00128">USERGLOBALLOCK</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00123">USERGLOBALUNLOCK</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l02467">SLPaste()</a>.
<p>
<pre class="fragment"><div>01159 {
01160     HANDLE hData;
01161     LPSTR lpchClip;
01162     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> cchAdded = 0;
01163     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> clipLength;
01164 
01165     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a17">OpenClipboard</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>))
01166         <span class="keywordflow">goto</span> PasteExitNoCloseClip;
01167 
01168     <span class="keywordflow">if</span> (!(hData = <a class="code" href="../../d3/d8/client_8c.html#a42">GetClipboardData</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> ? CF_TEXT : CF_UNICODETEXT)) ||
01169             (GlobalFlags(hData) == GMEM_INVALID_HANDLE)) {
01170         RIPMSG1(RIP_WARNING, <span class="stringliteral">"SLPasteText(): couldn't get a valid handle(%x)"</span>, hData);
01171         <span class="keywordflow">goto</span> PasteExit;
01172     }
01173 
01174     <a class="code" href="../../d6/d0/usercli_8h.html#a4">USERGLOBALLOCK</a>(hData, lpchClip);
01175     <span class="keywordflow">if</span> (lpchClip == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01176         RIPMSG1(RIP_WARNING, <span class="stringliteral">"SLPasteText(): USERGLOBALLOCK(%x) failed."</span>, hData);
01177         <span class="keywordflow">goto</span> PasteExit;
01178     }
01179 
01180     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a>) {
01181         LPSTR lpchClip2 = lpchClip;
01182 
01183         <span class="comment">/*</span>
01184 <span class="comment">         * Find the first carrage return or line feed. Just add text to that point.</span>
01185 <span class="comment">         */</span>
01186         clipLength = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(lpchClip);
01187         <span class="keywordflow">for</span> (cchAdded = 0; cchAdded &lt; clipLength; cchAdded++)
01188             <span class="keywordflow">if</span> (*lpchClip2++ == 0x0D)
01189                 <span class="keywordflow">break</span>;
01190 
01191     } <span class="keywordflow">else</span> { <span class="comment">// !fAnsi</span>
01192         LPWSTR lpwstrClip2 = (LPWSTR)lpchClip;
01193 
01194         <span class="comment">/*</span>
01195 <span class="comment">         * Find the first carrage return or line feed. Just add text to that point.</span>
01196 <span class="comment">         */</span>
01197         clipLength = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)wcslen((LPWSTR)lpchClip);
01198         <span class="keywordflow">for</span> (cchAdded = 0; cchAdded &lt; clipLength; cchAdded++)
01199             <span class="keywordflow">if</span> (*lpwstrClip2++ == 0x0D)
01200                 <span class="keywordflow">break</span>;
01201     }
01202 
01203     <span class="comment">/*</span>
01204 <span class="comment">     * Insert the text (SLInsertText checks line length)</span>
01205 <span class="comment">     */</span>
01206     cchAdded = <a class="code" href="../../d6/d0/usercli_8h.html#a532">SLInsertText</a>(ped, lpchClip, cchAdded);
01207 
01208     <a class="code" href="../../d6/d0/usercli_8h.html#a1">USERGLOBALUNLOCK</a>(hData);
01209 
01210 PasteExit:
01211     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a129">NtUserCloseClipboard</a>();
01212 
01213 PasteExitNoCloseClip:
01214     <span class="keywordflow">return</span> (cchAdded);
01215 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="editsl.c::SLReplaceSel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLReplaceSel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpText</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l01225">1225</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00860">_IsWindowVisible()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02293">ECDeleteText()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01977">ECEmptyUndo()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02429">ECNotifyParent()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01955">ECSaveUndo()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01265">FWINABLE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00277">IsWindow()</a>, <a class="el" href="../../d9/d8/client_2ntstubs_8c-source.html#l00354">NotifyWinEvent()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00540">Pundo</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00585">tagED::pwnd</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01074">SLInsertText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00932">SLScrollText()</a>, <a class="el" href="../../d7/d4/edslrare_8c-source.html#l00087">SLUndo()</a>, <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01287">ECResultStrHandler()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>.
<p>
<pre class="fragment"><div>01228 {
01229     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> cchText;
01230 
01231     <span class="comment">//</span>
01232     <span class="comment">// Delete text, putting it into the clean undo buffer.</span>
01233     <span class="comment">//</span>
01234     <a class="code" href="../../d6/d0/usercli_8h.html#a444">ECEmptyUndo</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a85">Pundo</a>(ped));
01235     <a class="code" href="../../d6/d0/usercli_8h.html#a447">ECDeleteText</a>(ped);
01236 
01237     <span class="comment">//</span>
01238     <span class="comment">// B#3356</span>
01239     <span class="comment">// Some apps do "clear" by selecting all of the text, then replacing it</span>
01240     <span class="comment">// with "", in which case SLInsertText() will return 0.  But that</span>
01241     <span class="comment">// doesn't mean failure...</span>
01242     <span class="comment">//</span>
01243     <span class="keywordflow">if</span> ( ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> )
01244         cchText = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(lpText);
01245     <span class="keywordflow">else</span>
01246         cchText = wcslen((LPWSTR)lpText);
01247 
01248     <span class="keywordflow">if</span> (cchText) {
01249         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fFailed;
01250         <a class="code" href="../../d9/d8/structtagUNDO.html">UNDO</a> undo;
01251         HWND hwndSave;
01252 
01253         <span class="comment">//</span>
01254         <span class="comment">// Save undo buffer, but DO NOT CLEAR IT!</span>
01255         <span class="comment">//</span>
01256         <a class="code" href="../../d6/d0/usercli_8h.html#a445">ECSaveUndo</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a85">Pundo</a>(ped), &amp;undo, FALSE);
01257 
01258         hwndSave = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>;
01259         fFailed = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>) !<a class="code" href="../../d6/d0/usercli_8h.html#a532">SLInsertText</a>(ped, lpText, cchText);
01260         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(hwndSave))
01261             <span class="keywordflow">return</span>;
01262 
01263         <span class="keywordflow">if</span> (fFailed) {
01264             <span class="comment">//</span>
01265             <span class="comment">// UNDO the previous edit.</span>
01266             <span class="comment">//</span>
01267             <a class="code" href="../../d6/d0/usercli_8h.html#a445">ECSaveUndo</a>(&amp;undo, <a class="code" href="../../d6/d0/usercli_8h.html#a85">Pundo</a>(ped), FALSE);
01268             <a class="code" href="../../d6/d0/usercli_8h.html#a523">SLUndo</a>(ped);
01269             <span class="keywordflow">return</span>;
01270         }
01271     }
01272 
01273     <span class="comment">//</span>
01274     <span class="comment">// Success.  So update the display</span>
01275     <span class="comment">//</span>
01276     <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_UPDATE);
01277 
01278     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a17">_IsWindowVisible</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o15">pwnd</a>)) {
01279         HDC hdc;
01280 
01281         hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, FALSE);
01282 
01283         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a530">SLScrollText</a>(ped, hdc))
01284             <a class="code" href="../../d6/d0/usercli_8h.html#a527">SLDrawText</a>(ped, hdc, 0);
01285 
01286         <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, FALSE);
01287     }
01288 
01289     <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_CHANGE);
01290 
01291     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
01292         <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a12">NotifyWinEvent</a>(EVENT_OBJECT_VALUECHANGE, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, OBJID_CLIENT, INDEXID_CONTAINER);
01293     }
01294 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="editsl.c::SLScrollText" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SLScrollText           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00932">932</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00661">tagED::cbChar</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00557">tagED::cch</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00052">CopyInflateRect()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04133">ECAdjustIch()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l04162">ECAdjustIchNext()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01281">ECCchInWidth()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l01412">ECGetBrush()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00052">ECLock()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l00086">ECUnlock()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03295">tagLPKEDITCALLOUT::EditHScroll</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00640">tagED::fAnsi</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00609">tagED::fAutoHScroll</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00611">tagED::fDBCS</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00061">FillRect()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00664">tagED::format</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00626">ICH</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00564">tagED::ichCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00570">tagED::ichScreenStart</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00696">tagED::wLeftMargin</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01337">ECImeComposition()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01304">SLChar()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01529">SLKeyDown()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02098">SLMouseMotion()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02467">SLPaste()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l01225">SLReplaceSel()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00283">SLSetSelection()</a>.
<p>
<pre class="fragment"><div>00935 {
00936     PSTR pTextScreenStart;
00937     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> scrollAmount;
00938     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> newScreenStartX = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>;
00939     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a980">ICH</a> cch;
00940     BOOLEAN fAdjustNext = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00941 
00942     <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o30">fAutoHScroll</a>)
00943         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00944 
00945     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
00946         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fChanged;
00947 
00948         <span class="comment">// With complex script glyph reordering, use lpk to do horz scroll</span>
00949         pTextScreenStart = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00950         fChanged = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>-&gt;<a class="code" href="../../d2/d0/structtagLPKEDITCALLOUT.html#o6">EditHScroll</a>(ped, hdc, pTextScreenStart);
00951         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00952 
00953         <span class="keywordflow">if</span> (fChanged) {
00954             <a class="code" href="../../d6/d0/usercli_8h.html#a527">SLDrawText</a>(ped, hdc, 0);
00955         }
00956 
00957         <span class="keywordflow">return</span> fChanged;
00958     }
00959 
00960     <span class="comment">/*</span>
00961 <span class="comment">     * Calculate the new starting screen position</span>
00962 <span class="comment">     */</span>
00963     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> &lt;= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>) {
00964 
00965         <span class="comment">/*</span>
00966 <span class="comment">         * Caret is to the left of the starting text on the screen we must</span>
00967 <span class="comment">         * scroll the text backwards to bring it into view. Watch out when</span>
00968 <span class="comment">         * subtracting unsigned numbers when we have the possibility of going</span>
00969 <span class="comment">         * negative.</span>
00970 <span class="comment">         */</span>
00971         pTextScreenStart = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00972 
00973         scrollAmount = <a class="code" href="../../d6/d0/usercli_8h.html#a443">ECCchInWidth</a>(ped, hdc, (LPSTR)pTextScreenStart,
00974                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>, (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left) / 4, FALSE);
00975 
00976         newScreenStartX = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> - scrollAmount;
00977         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
00978     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> != ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>) {
00979         pTextScreenStart = <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped);
00980         pTextScreenStart += ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>;
00981 
00982         cch = <a class="code" href="../../d6/d0/usercli_8h.html#a443">ECCchInWidth</a>(ped, hdc, (LPSTR)pTextScreenStart,
00983                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>,
00984                 ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left, FALSE);
00985 
00986         <span class="keywordflow">if</span> (cch &lt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>) {
00987             fAdjustNext = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00988 
00989             <span class="comment">/*</span>
00990 <span class="comment">             * Scroll Forward 1/4 -- if that leaves some empty space</span>
00991 <span class="comment">             * at the end, scroll back enough to fill the space</span>
00992 <span class="comment">             */</span>
00993             newScreenStartX = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> - (3 * cch / 4);
00994 
00995             cch = <a class="code" href="../../d6/d0/usercli_8h.html#a443">ECCchInWidth</a>(ped, hdc, (LPSTR)pTextScreenStart,
00996                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>,
00997                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left, FALSE);
00998 
00999             <span class="keywordflow">if</span> (newScreenStartX &gt; (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> - cch))
01000                 newScreenStartX = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> - cch;
01001         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o62">format</a> != ES_LEFT) {
01002 
01003             cch = <a class="code" href="../../d6/d0/usercli_8h.html#a443">ECCchInWidth</a>(ped, hdc, (LPSTR)pTextScreenStart,
01004                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a>,
01005                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left, FALSE);
01006 
01007            <span class="comment">/*</span>
01008 <span class="comment">            * Scroll the text hidden behind the left border back</span>
01009 <span class="comment">            * into view.</span>
01010 <span class="comment">            */</span>
01011            <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> == ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> - cch) {
01012 
01013                pTextScreenStart -= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> * ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o60">cbChar</a>;
01014                cch = <a class="code" href="../../d6/d0/usercli_8h.html#a443">ECCchInWidth</a>(ped, hdc, (LPSTR)pTextScreenStart,
01015                        ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a>, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right - ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.left, FALSE);
01016 
01017                newScreenStartX = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o3">cch</a> - cch;
01018            }
01019         }
01020 
01021         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
01022     }
01023 
01024     <span class="comment">//</span>
01025     <span class="comment">// Adjust newScreenStartX</span>
01026     <span class="comment">//</span>
01027     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o42">fAnsi</a> &amp;&amp; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o32">fDBCS</a>) {
01028         newScreenStartX = (fAdjustNext ? <a class="code" href="../../d8/d4/editec_8c.html#a58">ECAdjustIchNext</a> : <a class="code" href="../../d8/d4/editec_8c.html#a57">ECAdjustIch</a>)(ped,
01029                                                                         <a class="code" href="../../d6/d0/usercli_8h.html#a433">ECLock</a>(ped),
01030                                                                         newScreenStartX);
01031         <a class="code" href="../../d6/d0/usercli_8h.html#a434">ECUnlock</a>(ped);
01032     }
01033 
01034     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> != newScreenStartX) {
01035         <span class="comment">// Check if we have to wipe out the left margin</span>
01036         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o80">wLeftMargin</a> &amp;&amp; (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> == 0)) {
01037             RECT   rc;
01038             HBRUSH hBrush;
01039 
01040             hBrush = <a class="code" href="../../d6/d0/usercli_8h.html#a480">ECGetBrush</a>(ped, hdc);
01041 
01042             <a class="code" href="../../d3/d6/rect_8c.html#a2">CopyInflateRect</a>(&amp;rc, &amp;ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>, 0, 1);
01043             rc.right = rc.left;
01044             rc.left -= ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o80">wLeftMargin</a>;
01045 
01046             <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a3">FillRect</a>(hdc, &amp;rc, hBrush);
01047         }
01048 
01049         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o9">ichScreenStart</a> = newScreenStartX;
01050         <a class="code" href="../../d6/d0/usercli_8h.html#a527">SLDrawText</a>(ped, hdc, 0);
01051 
01052         <span class="comment">// Caret pos is set by SLDrawText().</span>
01053         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01054     }
01055 
01056     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01057 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="editsl.c::SLSetCaretPosition" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLSetCaretPosition           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00126">126</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00677">tagED::aveCharWidth</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00680">tagED::cxSysCharWidth</a>, <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01085">ECImmSetCompositionWindow()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00635">tagED::fCaretHidden</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02537">fpImmIsIME</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00704">tagED::iCaretOffset</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00564">tagED::ichCaret</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01571">NtUserSetCaretPos</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00586">tagED::rcFmt</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00182">SLIchToLeftXPos()</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l01124">THREAD_HKL</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/edecrare_8c-source.html#l01225">ECSetCaretHandler()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00395">SLChangeSelection()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02341">SLSetFocus()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00283">SLSetSelection()</a>.
<p>
<pre class="fragment"><div>00129 {
00130     <span class="keywordtype">int</span> xPosition;
00131 
00132     <span class="comment">/*</span>
00133 <span class="comment">     * We will only position the caret if we have the focus since we don't want</span>
00134 <span class="comment">     * to move the caret while another window could own it.</span>
00135 <span class="comment">     */</span>
00136     <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a>)
00137         <span class="keywordflow">return</span>;
00138 
00139     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o40">fCaretHidden</a>) {
00140         <a class="code" href="../../d6/d0/usercli_8h.html#a226">NtUserSetCaretPos</a>(-20000, -20000);
00141         <span class="keywordflow">return</span>;
00142     }
00143 
00144     xPosition = <a class="code" href="../../d6/d0/usercli_8h.html#a525">SLIchToLeftXPos</a>(ped, hdc, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>);
00145 
00146     <span class="comment">/*</span>
00147 <span class="comment">     * Don't let caret go out of bounds of edit control if there is too much</span>
00148 <span class="comment">     * text.</span>
00149 <span class="comment">     */</span>
00150     <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
00151         xPosition += ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o86">iCaretOffset</a>;
00152         xPosition = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(xPosition , 0);
00153         xPosition = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(xPosition, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right - 1 -
00154             ((ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o70">cxSysCharWidth</a> &gt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a>) ? 1 : 2));
00155     } <span class="keywordflow">else</span> {
00156         xPosition = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(xPosition, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.right -
00157             ((ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o70">cxSysCharWidth</a> &gt; ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o67">aveCharWidth</a>) ? 1 : 2));
00158     }
00159 
00160     <a class="code" href="../../d6/d0/usercli_8h.html#a226">NtUserSetCaretPos</a>(xPosition, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.top);
00161 
00162     <span class="comment">// FE_IME SLSetCaretPosition - ECImmSetCompostionWindow( CFS_POINT )</span>
00163     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a312">fpImmIsIME</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a151">THREAD_HKL</a>())) {
00164         <a class="code" href="../../d6/d0/usercli_8h.html#a471">ECImmSetCompositionWindow</a>(ped, xPosition, ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o16">rcFmt</a>.top);
00165     }
00166 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="editsl.c::SLSetFocus" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLSetFocus           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ped</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l02341">2341</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l01051">ECGetCaretWidth</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02429">ECNotifyParent()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03301">tagLPKEDITCALLOUT::EditCreateCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00602">tagED::fFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00610">tagED::fNoHideSel</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00584">tagED::hwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00678">tagED::lineHeight</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06550">NtUserCreateCaret()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06219">NtUserShowCaret()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00702">tagED::pLpkEditCallout</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00737">SLDrawText()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00126">SLSetCaretPosition()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>.
<p>
<pre class="fragment"><div>02343 {
02344     HDC hdc;
02345 
02346     <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a>) {
02347 
02348         ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o23">fFocus</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; <span class="comment">/* Set focus */</span>
02349 
02350         <span class="comment">/*</span>
02351 <span class="comment">         * We don't want to muck with the caret since it isn't created.</span>
02352 <span class="comment">         */</span>
02353         hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, TRUE);
02354 
02355         <span class="comment">/*</span>
02356 <span class="comment">         * Show the current selection if necessary.</span>
02357 <span class="comment">         */</span>
02358         <span class="keywordflow">if</span> (!ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o31">fNoHideSel</a>)
02359             <a class="code" href="../../d6/d0/usercli_8h.html#a527">SLDrawText</a>(ped, hdc, 0);
02360 
02361         <span class="comment">/*</span>
02362 <span class="comment">         * Create the caret</span>
02363 <span class="comment">         */</span>
02364         <span class="keywordflow">if</span> (ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>) {
02365             ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o84">pLpkEditCallout</a>-&gt;<a class="code" href="../../d2/d0/structtagLPKEDITCALLOUT.html#o12">EditCreateCaret</a> (ped, hdc, <a class="code" href="../../d6/d0/usercli_8h.html#a149">ECGetCaretWidth</a>(),
02366                                                    ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a>, 0);
02367         }
02368         <span class="keywordflow">else</span> {
02369             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a247">NtUserCreateCaret</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>, (HBITMAP)NULL,
02370                     <a class="code" href="../../d6/d0/usercli_8h.html#a149">ECGetCaretWidth</a>(),
02371                     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o68">lineHeight</a> );
02372         }
02373         <a class="code" href="../../d6/d0/usercli_8h.html#a524">SLSetCaretPosition</a>(ped, hdc);
02374         <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, TRUE);
02375         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a234">NtUserShowCaret</a>(ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o14">hwnd</a>);
02376 
02377     }
02378 
02379     <span class="comment">/*</span>
02380 <span class="comment">     * Notify parent we have the focus</span>
02381 <span class="comment">     */</span>
02382     <a class="code" href="../../d6/d0/usercli_8h.html#a449">ECNotifyParent</a>(ped, EN_SETFOCUS);
02383 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="editsl.c::SLSetSelection" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void SLSetSelection           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d3/d4/structtagED.html">PED</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ped</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ichSelStart</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d1/d0/inc_2user_8h.html#a949">ICH</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ichSelEnd</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/editsl_8c-source.html#l00283">283</a> of file <a class="el" href="../../d4/d4/editsl_8c-source.html">editsl.c</a>.
<p>
References <a class="el" href="../../d9/d3/editec_8c-source.html#l02492">ECGetEditDC()</a>, <a class="el" href="../../d9/d3/editec_8c-source.html#l02524">ECReleaseEditDC()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00564">tagED::ichCaret</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00563">tagED::ichMaxSel</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00395">SLChangeSelection()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l00932">SLScrollText()</a>, and <a class="el" href="../../d4/d4/editsl_8c-source.html#l00126">SLSetCaretPosition()</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/editsl_8c-source.html#l02520">SLEditWndProc()</a>, <a class="el" href="../../d4/d4/editsl_8c-source.html#l02394">SLKillFocus()</a>, and <a class="el" href="../../d7/d4/edslrare_8c-source.html#l00087">SLUndo()</a>.
<p>
<pre class="fragment"><div>00287 {
00288     HDC hdc = <a class="code" href="../../d6/d0/usercli_8h.html#a451">ECGetEditDC</a>(ped, FALSE );
00289 
00290     <span class="keywordflow">if</span> (ichSelStart == 0xFFFFFFFF) {
00291 
00292         <span class="comment">/*</span>
00293 <span class="comment">         * Set no selection if we specify -1</span>
00294 <span class="comment">         */</span>
00295         ichSelStart = ichSelEnd = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a>;
00296     }
00297 
00298     <span class="comment">/*</span>
00299 <span class="comment">     * Bounds ichSelStart, ichSelEnd are checked in SLChangeSelection...</span>
00300 <span class="comment">     */</span>
00301     <a class="code" href="../../d6/d0/usercli_8h.html#a526">SLChangeSelection</a>(ped, hdc, ichSelStart, ichSelEnd);
00302 
00303     <span class="comment">/*</span>
00304 <span class="comment">     * Put the caret at the end of the selected text</span>
00305 <span class="comment">     */</span>
00306     ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o7">ichCaret</a> = ped-&gt;<a class="code" href="../../d3/d4/structtagED.html#o6">ichMaxSel</a>;
00307 
00308     <a class="code" href="../../d6/d0/usercli_8h.html#a524">SLSetCaretPosition</a>(ped, hdc);
00309 
00310     <span class="comment">/*</span>
00311 <span class="comment">     * We may need to scroll the text to bring the caret into view...</span>
00312 <span class="comment">     */</span>
00313     <a class="code" href="../../d6/d0/usercli_8h.html#a530">SLScrollText</a>(ped, hdc);
00314 
00315     <a class="code" href="../../d6/d0/usercli_8h.html#a452">ECReleaseEditDC</a>(ped, hdc, FALSE);
00316 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:32 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
