<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mutntobj.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>mutntobj.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>

<p>
<a href="../../d4/d4/mutntobj_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/mutntobj_8c.html#a0">ASSERT_MUTANT</a>(E)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/mutntobj_8c.html#a1">KeInitializeMutant</a> (IN <a class="el" href="../../d3/d7/struct__KMUTANT.html">PRKMUTANT</a> Mutant, IN BOOLEAN InitialOwner)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/mutntobj_8c.html#a2">KeInitializeMutex</a> (IN <a class="el" href="../../d3/d7/struct__KMUTANT.html">PRKMUTANT</a> Mutant, IN ULONG Level)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/mutntobj_8c.html#a3">KeReadStateMutant</a> (IN <a class="el" href="../../d3/d7/struct__KMUTANT.html">PRKMUTANT</a> Mutant)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/mutntobj_8c.html#a4">KeReleaseMutant</a> (IN <a class="el" href="../../d3/d7/struct__KMUTANT.html">PRKMUTANT</a> Mutant, IN KPRIORITY Increment, IN BOOLEAN Abandoned, IN BOOLEAN Wait)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d5/mutntobj_8c.html#a5">KeReleaseMutex</a> (IN <a class="el" href="../../d3/d7/struct__KMUTANT.html">PRKMUTANT</a> Mutex, IN BOOLEAN Wait)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="mutntobj.c::ASSERT_MUTANT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ASSERT_MUTANT          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">E&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{                    \
    <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>((E)-&gt;<a class="code" href="../../d3/d3/dumpuser_8c.html#a17">Header</a>.Type == MutantObject); \
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00035">35</a> of file <a class="el" href="../../d4/d4/mutntobj_8c-source.html">mutntobj.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00146">KeReadStateMutant()</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00178">KeReleaseMutant()</a>, and <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00310">KeReleaseMutex()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1" doxytag="mutntobj.c::KeInitializeMutant" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeInitializeMutant           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d7/struct__KMUTANT.html">PRKMUTANT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mutant</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>InitialOwner</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00040">40</a> of file <a class="el" href="../../d4/d4/mutntobj_8c-source.html">mutntobj.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00546">_KTHREAD::MutantListHead</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a159">MutantObject</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/mminit_8c-source.html#l00184">MmInitSystem()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00156">NtCreateMutant()</a>, and <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">ObInitSystem()</a>.
<p>
<pre class="fragment"><div>00047                    :
00048 
00049     This function initializes a kernel mutant object.
00050 
00051 Arguments:
00052 
00053     Mutant - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> mutant.
00054 
00055     InitialOwner - Supplies a <span class="keywordtype">boolean</span> value that determines whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00056         current thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initial owner of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mutant object.
00057 
00058 Return Value:
00059 
00060     None.
00061 
00062 --*/
00063 
00064 {
00065 
00066     PLIST_ENTRY ListEntry;
00067     KIRQL OldIrql;
00068     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread;
00069 
00070     <span class="comment">//</span>
00071     <span class="comment">// Initialize standard dispatcher object header, set the owner thread to</span>
00072     <span class="comment">// NULL, set the abandoned state to FALSE, and set the APC disable count</span>
00073     <span class="comment">// to zero (this is the only thing that distinguishes a mutex from a mutant).</span>
00074     <span class="comment">//</span>
00075 
00076     Mutant-&gt;Header.Type = <a class="code" href="../../d4/d9/ke_8h.html#a402a159">MutantObject</a>;
00077     Mutant-&gt;Header.Size = <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d7/struct__KMUTANT.html">KMUTANT</a>) / <span class="keyword">sizeof</span>(LONG);
00078     <span class="keywordflow">if</span> (InitialOwner == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00079         Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00080         Mutant-&gt;Header.SignalState = 0;
00081         Mutant-&gt;OwnerThread = Thread;
00082         <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00083         ListEntry = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o1">MutantListHead</a>.Blink;
00084         InsertHeadList(ListEntry, &amp;Mutant-&gt;MutantListEntry);
00085         <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00086 
00087     } <span class="keywordflow">else</span> {
00088         Mutant-&gt;Header.SignalState = 1;
00089         Mutant-&gt;OwnerThread = (<a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00090     }
00091 
00092     InitializeListHead(&amp;Mutant-&gt;Header.WaitListHead);
00093     Mutant-&gt;Abandoned = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00094     Mutant-&gt;ApcDisable = 0;
00095     <span class="keywordflow">return</span>;
00096 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mutntobj.c::KeInitializeMutex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeInitializeMutex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d7/struct__KMUTANT.html">PRKMUTANT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mutant</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Level</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00099">99</a> of file <a class="el" href="../../d4/d4/mutntobj_8c-source.html">mutntobj.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a159">MutantObject</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00079">ExpProfileInitialization()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00325">InitializePool()</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l01088">KeI386VdmInitialize()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00084">PspLdtInitialize()</a>, and <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00219">UdfInitializeVmcb()</a>.
<p>
<pre class="fragment"><div>00106                    :
00107 
00108     This function initializes a kernel mutex object. The level number
00109     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored.
00110 
00111     N.B. Kernel mutex objects have been subsumed by mutant objects.
00112 
00113 Arguments:
00114 
00115     Mutex - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> mutex.
00116 
00117     Level - Ignored.
00118 
00119 Return Value:
00120 
00121     None.
00122 
00123 --*/
00124 
00125 {
00126 
00127     PLIST_ENTRY ListEntry;
00128 
00129     <span class="comment">//</span>
00130     <span class="comment">// Initialize standard dispatcher object header, set the owner thread to</span>
00131     <span class="comment">// NULL, set the abandoned state to FALSE, adn set the APC disable count</span>
00132     <span class="comment">// to one (this is the only thing that distinguishes a mutex from a mutant).</span>
00133     <span class="comment">//</span>
00134 
00135     Mutant-&gt;Header.Type = <a class="code" href="../../d4/d9/ke_8h.html#a402a159">MutantObject</a>;
00136     Mutant-&gt;Header.Size = <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d7/struct__KMUTANT.html">KMUTANT</a>) / <span class="keyword">sizeof</span>(LONG);
00137     Mutant-&gt;Header.SignalState = 1;
00138     InitializeListHead(&amp;Mutant-&gt;Header.WaitListHead);
00139     Mutant-&gt;OwnerThread = (<a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00140     Mutant-&gt;Abandoned = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00141     Mutant-&gt;ApcDisable = 1;
00142     <span class="keywordflow">return</span>;
00143 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="mutntobj.c::KeReadStateMutant" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG KeReadStateMutant           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d7/struct__KMUTANT.html">PRKMUTANT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Mutant</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00146">146</a> of file <a class="el" href="../../d4/d4/mutntobj_8c-source.html">mutntobj.c</a>.
<p>
References <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00035">ASSERT_MUTANT</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mutant_8c-source.html#l00380">NtQueryMutant()</a>.
<p>
<pre class="fragment"><div>00152                    :
00153 
00154     This function reads <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current signal state of a mutant object.
00155 
00156 Arguments:
00157 
00158     Mutant - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> mutant.
00159 
00160 Return Value:
00161 
00162     The current signal state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mutant object.
00163 
00164 --*/
00165 
00166 {
00167 
00168     <a class="code" href="../../d3/d5/mutntobj_8c.html#a0">ASSERT_MUTANT</a>(Mutant);
00169 
00170     <span class="comment">//</span>
00171     <span class="comment">// Return current signal state of mutant object.</span>
00172     <span class="comment">//</span>
00173 
00174     <span class="keywordflow">return</span> Mutant-&gt;Header.SignalState;
00175 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="mutntobj.c::KeReleaseMutant" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG KeReleaseMutant           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d7/struct__KMUTANT.html">PRKMUTANT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mutant</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KPRIORITY&nbsp;</td>
          <td class="mdname" nowrap> <em>Increment</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Abandoned</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Wait</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00178">178</a> of file <a class="el" href="../../d4/d4/mutntobj_8c-source.html">mutntobj.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00086">APC_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00243">_KAPC_STATE::ApcListHead</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00035">ASSERT_MUTANT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d3/rtl_2random_8c-source.html#l00032">Increment</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00596">_KTHREAD::KernelApcDisable</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00246">_KAPC_STATE::KernelApcPending</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01907">KiLockDispatcherDatabase</a>, <a class="el" href="../../d0/d4/intsupc_8c-source.html#l00159">KiRequestSoftwareInterrupt()</a>, <a class="el" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase()</a>, <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00277">KiWaitTest()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00583">_KTHREAD::WaitIrql</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00585">_KTHREAD::WaitNext</a>.
<p>
Referenced by <a class="el" href="../../d3/d4/mutant_8c-source.html#l00057">ExpDeleteMutant()</a>, <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00310">KeReleaseMutex()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, <a class="el" href="../../d5/d6/sessload_8c-source.html#l01273">MiLookupPsLoadedModule()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l03846">MmAddVerifierThunks()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l04046">MmGetVerifierInformation()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l04226">MmSetVerifierInformation()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02896">MmUnloadSystemImage()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00531">NtQueryInformationProcess()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00521">NtReleaseMutant()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00038">NtSignalAndWaitForSingleObject()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l01234">ObFindHandleForObject()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00815">ObInitProcess()</a>, and <a class="el" href="../../d1/d0/obinit_8c-source.html#l01022">ObKillProcess()</a>.
<p>
<pre class="fragment"><div>00187                    :
00188 
00189     This function releases a mutant object by incrementing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mutant
00190     count. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> resultant value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> one, then an attempt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to
00191     satisfy as many Waits as possible. The previous signal state of
00192     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mutant <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function value. If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Abandoned
00193     parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mutant object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> released by settings
00194     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> signal state to one.
00195 
00196 Arguments:
00197 
00198     Mutant - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> mutant.
00199 
00200     <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> priority increment that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be applied
00201         <span class="keywordflow">if</span> setting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> event causes a Wait to be satisfied.
00202 
00203     Abandoned - Supplies a <span class="keywordtype">boolean</span> value that signifies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00204         mutant object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being abandoned.
00205 
00206     Wait - Supplies a <span class="keywordtype">boolean</span> value that signifies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call to
00207         <a class="code" href="../../d4/d9/ke_8h.html#a287">KeReleaseMutant</a> will be immediately followed by a call to one
00208         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel Wait <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a16">functions</a>.
00209 
00210 Return Value:
00211 
00212     The previous signal state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mutant object.
00213 
00214 --*/
00215 
00216 {
00217 
00218     KIRQL OldIrql;
00219     LONG OldState;
00220     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread;
00221 
00222 
00223     <a class="code" href="../../d3/d5/mutntobj_8c.html#a0">ASSERT_MUTANT</a>(Mutant);
00224     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00225 
00226     <span class="comment">//</span>
00227     <span class="comment">// Raise IRQL to dispatcher level and lock dispatcher database.</span>
00228     <span class="comment">//</span>
00229 
00230     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00231 
00232     <span class="comment">//</span>
00233     <span class="comment">// Capture the current signal state of the mutant object.</span>
00234     <span class="comment">//</span>
00235 
00236     OldState = Mutant-&gt;Header.SignalState;
00237 
00238     <span class="comment">//</span>
00239     <span class="comment">// If the Abandoned parameter is TRUE, then force the release of the</span>
00240     <span class="comment">// mutant object by setting its ownership count to one and setting its</span>
00241     <span class="comment">// abandoned state to TRUE. Otherwise increment mutant ownership count.</span>
00242     <span class="comment">// If the result count is one, then remove the mutant object from the</span>
00243     <span class="comment">// thread's owned mutant list, set the owner thread to NULL, and attempt</span>
00244     <span class="comment">// to satisfy a Wait for the mutant object if the mutant object wait</span>
00245     <span class="comment">// list is not empty.</span>
00246     <span class="comment">//</span>
00247 
00248     Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00249     <span class="keywordflow">if</span> (Abandoned != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00250         Mutant-&gt;Header.SignalState = 1;
00251         Mutant-&gt;Abandoned = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00252 
00253     } <span class="keywordflow">else</span> {
00254 
00255         <span class="comment">//</span>
00256         <span class="comment">// If the Mutant object is not owned by the current thread, then</span>
00257         <span class="comment">// unlock the dispatcher data base and raise an exception. Otherwise</span>
00258         <span class="comment">// increment the ownership count.</span>
00259         <span class="comment">//</span>
00260 
00261         <span class="keywordflow">if</span> (Mutant-&gt;OwnerThread != Thread) {
00262             <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00263             <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>(Mutant-&gt;Abandoned ?
00264                           STATUS_ABANDONED : STATUS_MUTANT_NOT_OWNED);
00265         }
00266 
00267         Mutant-&gt;Header.SignalState += 1;
00268     }
00269 
00270     <span class="keywordflow">if</span> (Mutant-&gt;Header.SignalState == 1) {
00271         <span class="keywordflow">if</span> (OldState &lt;= 0) {
00272             RemoveEntryList(&amp;Mutant-&gt;MutantListEntry);
00273             Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o30">KernelApcDisable</a> += Mutant-&gt;ApcDisable;
00274             <span class="keywordflow">if</span> ((Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o30">KernelApcDisable</a> == 0) &amp;&amp;
00275                 (IsListEmpty(&amp;Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o0">ApcListHead</a>[KernelMode]) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00276                 Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o3">KernelApcPending</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00277                 <a class="code" href="../../d9/d4/intsupc_8c.html#a3">KiRequestSoftwareInterrupt</a>(APC_LEVEL);
00278             }
00279         }
00280 
00281         Mutant-&gt;OwnerThread = (<a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00282         <span class="keywordflow">if</span> (IsListEmpty(&amp;Mutant-&gt;Header.WaitListHead) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00283             <a class="code" href="../../d2/d7/waitsup_8c.html#a3">KiWaitTest</a>(Mutant, Increment);
00284         }
00285     }
00286 
00287     <span class="comment">//</span>
00288     <span class="comment">// If the value of the Wait argument is TRUE, then return to</span>
00289     <span class="comment">// caller with IRQL raised and the dispatcher database locked.</span>
00290     <span class="comment">// Else release the dispatcher database lock and lower IRQL to</span>
00291     <span class="comment">// its previous value.</span>
00292     <span class="comment">//</span>
00293 
00294     <span class="keywordflow">if</span> (Wait != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00295         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o19">WaitNext</a> = Wait;
00296         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o17">WaitIrql</a> = OldIrql;
00297 
00298     } <span class="keywordflow">else</span> {
00299         <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00300     }
00301 
00302     <span class="comment">//</span>
00303     <span class="comment">// Return previous signal state of mutant object.</span>
00304     <span class="comment">//</span>
00305 
00306     <span class="keywordflow">return</span> OldState;
00307 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="mutntobj.c::KeReleaseMutex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG KeReleaseMutex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d3/d7/struct__KMUTANT.html">PRKMUTANT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mutex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Wait</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00310">310</a> of file <a class="el" href="../../d4/d4/mutntobj_8c-source.html">mutntobj.c</a>.
<p>
References <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00035">ASSERT_MUTANT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d4/d4/mutntobj_8c-source.html#l00178">KeReleaseMutant()</a>.
<p>
Referenced by <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00262">ExUnlockPool()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l01235">NtSetLdtEntries()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00517">NtStartProfile()</a>, <a class="el" href="../../d0/d6/ex_2profile_8c-source.html#l00680">NtStopProfile()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l01061">PspQueryDescriptorThread()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00108">PspQueryLdtInformation()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00503">PspSetLdtInformation()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l00308">PspSetLdtSize()</a>, <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00637">UdfAddVmcbMapping()</a>, <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00867">UdfRemoveVmcbMapping()</a>, <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00553">UdfVmcbLbnToVbn()</a>, <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00461">UdfVmcbVbnToLbn()</a>, and <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00777">VdmDispatchStringIoToHandler()</a>.
<p>
<pre class="fragment"><div>00317                    :
00318 
00319     This function releases a mutex object.
00320 
00321     N.B. Kernel mutex objects have been subsumed by mutant objects.
00322 
00323 Arguments:
00324 
00325     Mutex - Supplies a pointer to a dispatcher object of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> mutex.
00326 
00327     Wait - Supplies a <span class="keywordtype">boolean</span> value that signifies whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call to
00328         <a class="code" href="../../d6/d3/cmwraper_8c.html#a19">KeReleaseMutex</a> will be immediately followed by a call to one
00329         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> kernel Wait <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a16">functions</a>.
00330 
00331 Return Value:
00332 
00333     The previous signal state of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mutex object.
00334 
00335 --*/
00336 
00337 {
00338 
00339     <a class="code" href="../../d3/d5/mutntobj_8c.html#a0">ASSERT_MUTANT</a>(Mutex);
00340 
00341     <span class="comment">//</span>
00342     <span class="comment">// Release the specified mutex object with defaults for increment</span>
00343     <span class="comment">// and abandoned parameters.</span>
00344     <span class="comment">//</span>
00345 
00346     <span class="keywordflow">return</span> <a class="code" href="../../d3/d5/mutntobj_8c.html#a4">KeReleaseMutant</a>(Mutex, 1, FALSE, Wait);
00347 }
}
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
