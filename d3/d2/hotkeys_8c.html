<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: hotkeys.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>hotkeys.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d4/d1/hotkeys_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d2/hotkeys_8c.html#a0">SetDebugHotKeys</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d2/hotkeys_8c.html#a1">DestroyThreadsHotKeys</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d2/hotkeys_8c.html#a2">DestroyWindowsHotKeys</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d2/hotkeys_8c.html#a3">_RegisterHotKey</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, int id, UINT fsModifiers, UINT vk)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d2/hotkeys_8c.html#a4">_UnregisterHotKey</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, int id)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d2/hotkeys_8c.html#a5">FindHotKey</a> (<a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent, <a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, int id, UINT fsModifiers, UINT vk, BOOL fUnregister, PBOOL pfKeysExist)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d2/hotkeys_8c.html#a6">IsSAS</a> (<a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> vk, UINT *pfsModifiers)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d2/hotkeys_8c.html#a7">xxxDoHotKeyStuff</a> (UINT vk, BOOL fBreak, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> fsReserveKeys)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d2/hotkeys_8c.html#a8">IsHotKey</a> (UINT fsModifiers, UINT vk)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a3" doxytag="hotkeys.c::_RegisterHotKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _RegisterHotKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>fsModifiers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>vk</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00125">125</a> of file <a class="el" href="../../d4/d1/hotkeys_8c-source.html">hotkeys.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00518">CheckWinstaWriteAttributesAccess()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00290">FindHotKey()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03818">tagHOTKEY::fsModifiers</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00604">gfsSASModifiers</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00794">gpepCSRSS</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00262">gphkFirst</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00793">gpidLogon</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00648">grpWinStaList</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00606">gvkSAS</a>, <a class="el" href="../../d4/d1/userk_8h.html#a902">HOTKEY</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03821">tagHOTKEY::id</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03822">tagHOTKEY::phkNext</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03816">tagHOTKEY::pti</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03826">PWND_FOCUS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03825">PWND_INPUTOWNER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03817">tagHOTKEY::spwnd</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03820">tagHOTKEY::vk</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l03819">tagHOTKEY::wFlags</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05690">NtUserRegisterHotKey()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l03858">RawInputThread()</a>, <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00026">SetDebugHotKeys()</a>, and <a class="el" href="../../d0/d0/miscutil_8c-source.html#l00097">xxxSetShellWindow()</a>.
<p>
<pre class="fragment"><div>00130 {
00131     <a class="code" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a>         phk;
00132     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            fKeysExist;
00133     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>     ptiCurrent;
00134     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            bSAS = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00135     WORD            wFlags;
00136 
00137     wFlags = fsModifiers &amp; MOD_SAS;
00138     fsModifiers &amp;= ~MOD_SAS;
00139 
00140     ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00141 
00142     <span class="comment">/*</span>
00143 <span class="comment">     * Blow it off if the caller is not the windowstation init thread</span>
00144 <span class="comment">     * and doesn't have the proper access rights</span>
00145 <span class="comment">     */</span>
00146     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>() != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a299">gpepCSRSS</a>) {
00147         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a241">grpWinStaList</a> &amp;&amp; !<a class="code" href="../../d7/d5/w32_2ntuser_2kernel_2security_8c.html#a9">CheckWinstaWriteAttributesAccess</a>()) {
00148             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00149         }
00150     }
00151 
00152     <span class="comment">/*</span>
00153 <span class="comment">     * If VK_PACKET is specified, just bail out, since VK_PACKET is</span>
00154 <span class="comment">     * not a real keyboard input.</span>
00155 <span class="comment">     */</span>
00156     <span class="keywordflow">if</span> (vk == VK_PACKET) {
00157         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00158     }
00159 
00160     <span class="comment">/*</span>
00161 <span class="comment">     * If this is the SAS check that winlogon is the one registering it.</span>
00162 <span class="comment">     */</span>
00163     <span class="keywordflow">if</span> (wFlags &amp; MOD_SAS) {
00164         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;UniqueProcessId == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a298">gpidLogon</a>) {
00165             bSAS = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00166         }
00167     }
00168 
00169     <span class="comment">/*</span>
00170 <span class="comment">     * Can't register hotkey for a window of another queue.</span>
00171 <span class="comment">     * Return FALSE in this case.</span>
00172 <span class="comment">     */</span>
00173     <span class="keywordflow">if</span> ((pwnd != <a class="code" href="../../d4/d1/userk_8h.html#a450">PWND_FOCUS</a>) &amp;&amp; (pwnd != <a class="code" href="../../d4/d1/userk_8h.html#a449">PWND_INPUTOWNER</a>)) {
00174         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd) != ptiCurrent) {
00175             RIPERR0(ERROR_WINDOW_OF_OTHER_THREAD, RIP_VERBOSE, <span class="stringliteral">""</span>);
00176             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00177         }
00178     }
00179 
00180     phk = <a class="code" href="../../d4/d1/userk_8h.html#a1463">FindHotKey</a>(ptiCurrent, pwnd, <span class="keywordtype">id</span>, fsModifiers, vk, FALSE, &amp;fKeysExist);
00181 
00182     <span class="comment">/*</span>
00183 <span class="comment">     * If the keys have already been registered, return FALSE.</span>
00184 <span class="comment">     */</span>
00185     <span class="keywordflow">if</span> (fKeysExist) {
00186         RIPERR0(ERROR_HOTKEY_ALREADY_REGISTERED, RIP_WARNING, <span class="stringliteral">"Hotkey already exists"</span>);
00187         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00188     }
00189 
00190     <span class="keywordflow">if</span> (phk == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00191         <span class="comment">/*</span>
00192 <span class="comment">         * This hotkey doesn't exist yet.</span>
00193 <span class="comment">         */</span>
00194         phk = (<a class="code" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a>)UserAllocPool(<span class="keyword">sizeof</span>(<a class="code" href="../../d8/d6/structtagHOTKEY.html">HOTKEY</a>), TAG_HOTKEY);
00195 
00196         <span class="comment">/*</span>
00197 <span class="comment">         * If the allocation failed, bail out.</span>
00198 <span class="comment">         */</span>
00199         <span class="keywordflow">if</span> (phk == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00200             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00201         }
00202 
00203         phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o0">pti</a> = ptiCurrent;
00204 
00205         <span class="keywordflow">if</span> ((pwnd != <a class="code" href="../../d4/d1/userk_8h.html#a450">PWND_FOCUS</a>) &amp;&amp; (pwnd != <a class="code" href="../../d4/d1/userk_8h.html#a449">PWND_INPUTOWNER</a>)) {
00206             phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00207             <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a>, pwnd);
00208         } <span class="keywordflow">else</span> {
00209             phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a> = pwnd;
00210         }
00211         phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o2">fsModifiers</a> = (WORD)fsModifiers;
00212         phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o3">wFlags</a> = wFlags;
00213 
00214         phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o4">vk</a> = vk;
00215         phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o5">id</a> = <span class="keywordtype">id</span>;
00216 
00217         <span class="comment">/*</span>
00218 <span class="comment">         * Link the new hotkey to the front of the list.</span>
00219 <span class="comment">         */</span>
00220         phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o6">phkNext</a> = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a115">gphkFirst</a>;
00221         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a115">gphkFirst</a> = phk;
00222 
00223     } <span class="keywordflow">else</span> {
00224 
00225         <span class="comment">/*</span>
00226 <span class="comment">         * Hotkey already exists, reset the keys.</span>
00227 <span class="comment">         */</span>
00228         phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o2">fsModifiers</a> = (WORD)fsModifiers;
00229         phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o3">wFlags</a> = wFlags;
00230         phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o4">vk</a> = vk;
00231     }
00232 
00233     <span class="keywordflow">if</span> (bSAS) {
00234         <span class="comment">/*</span>
00235 <span class="comment">         * store the SAS on the terminal.</span>
00236 <span class="comment">         */</span>
00237         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a230">gvkSAS</a> = vk;
00238         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a228">gfsSASModifiers</a> = fsModifiers;
00239     }
00240 
00241     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00242 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="hotkeys.c::_UnregisterHotKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL _UnregisterHotKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>id</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00255">255</a> of file <a class="el" href="../../d4/d1/hotkeys_8c-source.html">hotkeys.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00290">FindHotKey()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06439">NtUserUnregisterHotKey()</a>, and <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00026">SetDebugHotKeys()</a>.
<p>
<pre class="fragment"><div>00258 {
00259     <a class="code" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a> phk;
00260     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fKeysExist;
00261     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>  ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00262     phk = <a class="code" href="../../d4/d1/userk_8h.html#a1463">FindHotKey</a>(ptiCurrent, pwnd, <span class="keywordtype">id</span>, 0, 0, TRUE, &amp;fKeysExist);
00263 
00264     <span class="comment">/*</span>
00265 <span class="comment">     * No hotkey to unregister, return FALSE.</span>
00266 <span class="comment">     */</span>
00267     <span class="keywordflow">if</span> (phk == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00268         RIPERR0(ERROR_HOTKEY_NOT_REGISTERED, RIP_VERBOSE, <span class="stringliteral">""</span>);
00269         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00270     }
00271 
00272     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00273 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="hotkeys.c::DestroyThreadsHotKeys" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DestroyThreadsHotKeys           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00056">56</a> of file <a class="el" href="../../d4/d1/hotkeys_8c-source.html">hotkeys.c</a>.
<p>
References <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00262">gphkFirst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03822">tagHOTKEY::phkNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03826">PWND_FOCUS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03825">PWND_INPUTOWNER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03817">tagHOTKEY::spwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/queue_8c-source.html#l02552">xxxDestroyThreadInfo()</a>.
<p>
<pre class="fragment"><div>00057 {
00058     <a class="code" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a> *pphk;
00059     <a class="code" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a> phk;
00060     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00061     pphk = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a115">gphkFirst</a>;
00062     <span class="keywordflow">while</span> (*pphk) {
00063         <span class="keywordflow">if</span> ((*pphk)-&gt;pti == ptiCurrent) {
00064             phk = *pphk;
00065             *pphk = (*pphk)-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o6">phkNext</a>;
00066 
00067             <span class="comment">/*</span>
00068 <span class="comment">             * Unlock the object stored here.</span>
00069 <span class="comment">             */</span>
00070             <span class="keywordflow">if</span> ((phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a> != <a class="code" href="../../d4/d1/userk_8h.html#a450">PWND_FOCUS</a>) &amp;&amp; (phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a> != <a class="code" href="../../d4/d1/userk_8h.html#a449">PWND_INPUTOWNER</a>)) {
00071                 <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a>);
00072             }
00073 
00074             UserFreePool(phk);
00075         } <span class="keywordflow">else</span> {
00076             pphk = &amp;((*pphk)-&gt;phkNext);
00077         }
00078     }
00079 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="hotkeys.c::DestroyWindowsHotKeys" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DestroyWindowsHotKeys           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pwnd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00093">93</a> of file <a class="el" href="../../d4/d1/hotkeys_8c-source.html">hotkeys.c</a>.
<p>
References <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00262">gphkFirst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03822">tagHOTKEY::phkNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03817">tagHOTKEY::spwnd</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/createw_8c-source.html#l02218">xxxFreeWindow()</a>.
<p>
<pre class="fragment"><div>00095 {
00096     <a class="code" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a> *pphk;
00097     <a class="code" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a> phk;
00098     pphk = &amp;<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a115">gphkFirst</a>;
00099     <span class="keywordflow">while</span> (*pphk) {
00100         <span class="keywordflow">if</span> ((*pphk)-&gt;spwnd == pwnd) {
00101             phk = *pphk;
00102             *pphk = (*pphk)-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o6">phkNext</a>;
00103 
00104             <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a>);
00105             UserFreePool(phk);
00106         } <span class="keywordflow">else</span> {
00107             pphk = &amp;((*pphk)-&gt;phkNext);
00108         }
00109     }
00110 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="hotkeys.c::FindHotKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a> FindHotKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ptiCurrent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>fsModifiers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>vk</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fUnregister</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PBOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>pfKeysExist</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00290">290</a> of file <a class="el" href="../../d4/d1/hotkeys_8c-source.html">hotkeys.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03818">tagHOTKEY::fsModifiers</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00262">gphkFirst</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03821">tagHOTKEY::id</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03822">tagHOTKEY::phkNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03816">tagHOTKEY::pti</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03826">PWND_FOCUS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03825">PWND_INPUTOWNER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03817">tagHOTKEY::spwnd</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00368">Unlock</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l03820">tagHOTKEY::vk</a>.
<p>
Referenced by <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00125">_RegisterHotKey()</a>, and <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00255">_UnregisterHotKey()</a>.
<p>
<pre class="fragment"><div>00298 {
00299     <a class="code" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a> phk, phkRet, phkPrev;
00300 
00301     <span class="comment">/*</span>
00302 <span class="comment">     * Initialize out 'return' values.</span>
00303 <span class="comment">     */</span>
00304     *pfKeysExist = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00305     phkRet = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00306 
00307     phk = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a115">gphkFirst</a>;
00308 
00309     <span class="keywordflow">while</span> (phk) {
00310 
00311         <span class="comment">/*</span>
00312 <span class="comment">         * If all this matches up then we've found it.</span>
00313 <span class="comment">         */</span>
00314         <span class="keywordflow">if</span> ((phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o0">pti</a> == ptiCurrent) &amp;&amp; (phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a> == pwnd) &amp;&amp; (phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o5">id</a> == <span class="keywordtype">id</span>)) {
00315             <span class="keywordflow">if</span> (fUnregister) {
00316 
00317                 <span class="comment">/*</span>
00318 <span class="comment">                 * Unlink the HOTKEY from the list.</span>
00319 <span class="comment">                 */</span>
00320                 <span class="keywordflow">if</span> (phk == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a115">gphkFirst</a>) {
00321                     <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a115">gphkFirst</a> = phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o6">phkNext</a>;
00322                 } <span class="keywordflow">else</span> {
00323                     phkPrev-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o6">phkNext</a> = phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o6">phkNext</a>;
00324                 }
00325 
00326                 <span class="keywordflow">if</span> ((pwnd != <a class="code" href="../../d4/d1/userk_8h.html#a450">PWND_FOCUS</a>) &amp;&amp; (pwnd != <a class="code" href="../../d4/d1/userk_8h.html#a449">PWND_INPUTOWNER</a>)) {
00327                     <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a>);
00328                 }
00329                 UserFreePool((PVOID)phk);
00330 
00331                 <span class="keywordflow">return</span>((<a class="code" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a>)1);
00332             }
00333             phkRet = phk;
00334         }
00335 
00336         <span class="comment">/*</span>
00337 <span class="comment">         * If the key is already registered, set the exists flag so</span>
00338 <span class="comment">         * the app knows it can't use this hotkey sequence.</span>
00339 <span class="comment">         */</span>
00340         <span class="keywordflow">if</span> ((phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o2">fsModifiers</a> == (WORD)fsModifiers) &amp;&amp; (phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o4">vk</a> == vk)) {
00341 
00342             <span class="comment">/*</span>
00343 <span class="comment">             * In the case of PWND_FOCUS, we need to check that the queues</span>
00344 <span class="comment">             * are the same since PWND_FOCUS is local to the queue it was</span>
00345 <span class="comment">             * registered under.</span>
00346 <span class="comment">             */</span>
00347             <span class="keywordflow">if</span> (phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a> == <a class="code" href="../../d4/d1/userk_8h.html#a450">PWND_FOCUS</a>) {
00348                 <span class="keywordflow">if</span> (phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o0">pti</a> == ptiCurrent) {
00349                     *pfKeysExist = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00350                 }
00351             } <span class="keywordflow">else</span> {
00352                 *pfKeysExist = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00353             }
00354         }
00355 
00356         phkPrev = phk;
00357         phk = phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o6">phkNext</a>;
00358     }
00359 
00360     <span class="keywordflow">return</span> phkRet;
00361 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="hotkeys.c::IsHotKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a> IsHotKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>fsModifiers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>vk</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00735">735</a> of file <a class="el" href="../../d4/d1/hotkeys_8c-source.html">hotkeys.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03818">tagHOTKEY::fsModifiers</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00262">gphkFirst</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03822">tagHOTKEY::phkNext</a>, and <a class="el" href="../../d5/d0/userk_8h-source.html#l03820">tagHOTKEY::vk</a>.
<p>
Referenced by <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00434">xxxDoHotKeyStuff()</a>, and <a class="el" href="../../d7/d7/ntinput_8c-source.html#l01338">xxxKeyEvent()</a>.
<p>
<pre class="fragment"><div>00738 {
00739     <a class="code" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a> phk;
00740 
00741     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00742 
00743     phk = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a115">gphkFirst</a>;
00744 
00745     <span class="keywordflow">while</span> (phk != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00746 
00747         <span class="comment">/*</span>
00748 <span class="comment">         * Do the modifiers and vk for this hotkey match the current state?</span>
00749 <span class="comment">         */</span>
00750         <span class="keywordflow">if</span> ((phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o2">fsModifiers</a> == fsModifiers) &amp;&amp; (phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o4">vk</a> == vk)) {
00751             <span class="keywordflow">return</span> phk;
00752         }
00753 
00754         phk = phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o6">phkNext</a>;
00755     }
00756 
00757     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00758 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="hotkeys.c::IsSAS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL IsSAS           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>vk</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT *&nbsp;</td>
          <td class="mdname" nowrap> <em>pfsModifiers</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00372">372</a> of file <a class="el" href="../../d4/d1/hotkeys_8c-source.html">hotkeys.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00604">gfsSASModifiers</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00605">gfsSASModifiersDown</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00606">gvkSAS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
Referenced by <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00434">xxxDoHotKeyStuff()</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l01338">xxxKeyEvent()</a>, and <a class="el" href="../../d8/d7/kbd_8c-source.html#l00211">xxxNumpadCursor()</a>.
<p>
<pre class="fragment"><div>00375 {
00376     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> fsDown = 0;
00377 
00378     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00379 
00380     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a230">gvkSAS</a> != vk) {
00381         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00382     }
00383 
00384     <span class="comment">/*</span>
00385 <span class="comment">     * Special case for SAS - examine real physical modifier-key state!</span>
00386 <span class="comment">     *</span>
00387 <span class="comment">     * An evil daemon process can fool convincingly pretend to be winlogon</span>
00388 <span class="comment">     * by registering Alt+Del as a hotkey, and spinning another thread that</span>
00389 <span class="comment">     * continually calls keybd_event() to send the Ctrl key up: when the</span>
00390 <span class="comment">     * user types Ctrl+Alt+Del, only Alt+Del will be seen by the system,</span>
00391 <span class="comment">     * the evil daemon will get woken by WM_HOTKEY and can pretend to be</span>
00392 <span class="comment">     * winlogon.  So look at gfsSASModifiersDown in this case, to see what keys</span>
00393 <span class="comment">     * were physically pressed.</span>
00394 <span class="comment">     * NOTE: If hotkeys are ever made to work under journal playback, make</span>
00395 <span class="comment">     * sure they don't affect the gfsSASModifiersDown!  - IanJa.</span>
00396 <span class="comment">     */</span>
00397     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a229">gfsSASModifiersDown</a> == <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a228">gfsSASModifiers</a>) {
00398         *pfsModifiers = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a229">gfsSASModifiersDown</a>;
00399         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00400     }
00401 
00402     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00403 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="hotkeys.c::SetDebugHotKeys" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetDebugHotKeys           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00026">26</a> of file <a class="el" href="../../d4/d1/hotkeys_8c-source.html">hotkeys.c</a>.
<p>
References <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00125">_RegisterHotKey()</a>, <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00255">_UnregisterHotKey()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00575">FastGetProfileDwordW()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00543">gKeyboardInfo</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03835">IDHOT_DEBUG</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03836">IDHOT_DEBUGSERVER</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06861">PMAP_AEDEBUG</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03825">PWND_INPUTOWNER</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l01191">ProcessDeviceChanges()</a>, and <a class="el" href="../../d7/d7/ntinput_8c-source.html#l03858">RawInputThread()</a>.
<p>
<pre class="fragment"><div>00027 {
00028     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> VkDebug;
00029 
00030     VkDebug = <a class="code" href="../../d4/d1/userk_8h.html#a2006">FastGetProfileDwordW</a>(NULL, PMAP_AEDEBUG, L<span class="stringliteral">"UserDebuggerHotkey"</span>, 0);
00031     <span class="keywordflow">if</span> (VkDebug == 0) {
00032         <span class="keywordflow">if</span> (ENHANCED_KEYBOARD(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a214">gKeyboardInfo</a>.KeyboardIdentifier)) {
00033             VkDebug = VK_F12;
00034         } <span class="keywordflow">else</span> {
00035             VkDebug = VK_SUBTRACT;
00036         }
00037     } <span class="keywordflow">else</span> {
00038         UserAssert((0xFFFFFF00 &amp; VkDebug) == 0);
00039     }
00040 
00041     <a class="code" href="../../d4/d1/userk_8h.html#a1661">_UnregisterHotKey</a>(PWND_INPUTOWNER, IDHOT_DEBUG);
00042     <a class="code" href="../../d4/d1/userk_8h.html#a1661">_UnregisterHotKey</a>(PWND_INPUTOWNER, IDHOT_DEBUGSERVER);
00043 
00044     <a class="code" href="../../d4/d1/userk_8h.html#a1660">_RegisterHotKey</a>(PWND_INPUTOWNER, IDHOT_DEBUG, 0, VkDebug);
00045     <a class="code" href="../../d4/d1/userk_8h.html#a1660">_RegisterHotKey</a>(PWND_INPUTOWNER, IDHOT_DEBUGSERVER, MOD_SHIFT, VkDebug);
00046 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="hotkeys.c::xxxDoHotKeyStuff" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxDoHotKeyStuff           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>vk</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fBreak</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>fsReserveKeys</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00434">434</a> of file <a class="el" href="../../d4/d1/hotkeys_8c-source.html">hotkeys.c</a>.
<p>
References <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l00981">_PostMessage()</a>, <a class="el" href="../../d6/d2/ntuser_2kernel_2input_8c-source.html#l01123">_PostThreadMessage()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02718">tagWINDOWSTATION::dwWSF_Flags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03818">tagHOTKEY::fsModifiers</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02345">GETDESKINFO</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01547">GETPTI</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00178">gfInNumpadHexInput</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00219">ghwndSwitch</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00198">glinp</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00793">gpidLogon</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00099">gpqForeground</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00456">grpdeskRitInput</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01827">tagWND::head</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03821">tagHOTKEY::id</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03835">IDHOT_DEBUG</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03836">IDHOT_DEBUGSERVER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03837">IDHOT_WINDOWS</a>, <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00735">IsHotKey()</a>, <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00372">IsSAS()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06472">IsWinEventNotifyDeferredOK</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03993">NUMPAD_HEXMODE_LL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03816">tagHOTKEY::pti</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03262">tagLASTINPUT::ptiLastWoken</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01172">PW</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03825">PWND_INPUTOWNER</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02648">tagDESKTOP::rpwinstaParent</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03817">tagHOTKEY::spwnd</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03110">tagQ::spwndFocus</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00362">ThreadLock</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00366">ThreadUnlock</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03819">tagHOTKEY::wFlags</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02702">WSF_SWITCHLOCK</a>, <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html#l00032">xxxActivateDebugger()</a>, <a class="el" href="../../d4/d5/focusact_8c-source.html#l01342">xxxSetForegroundWindow2()</a>, and <a class="el" href="../../d2/d1/hooks_8c-source.html#l00404">zzzCancelJournalling()</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/ntinput_8c-source.html#l01338">xxxKeyEvent()</a>.
<p>
<pre class="fragment"><div>00438 {
00439     <span class="keyword">static</span> <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> fsModifiers = 0;
00440     <span class="keyword">static</span> <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> fsModOnlyCandidate = 0;
00441     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> fsModOnlyHotkey;
00442     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> fs;
00443     <a class="code" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a> phk;
00444     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fCancel;
00445     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fEatDebugKeyBreak = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00446     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
00447     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bSAS;
00448 
00449     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00450     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a616">IsWinEventNotifyDeferredOK</a>());
00451 
00452     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a67">gfInNumpadHexInput</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a488">NUMPAD_HEXMODE_LL</a>) {
00453         RIPMSG0(RIP_VERBOSE, <span class="stringliteral">"xxxDoHotKeyStuff: Since we're in gfInNumpadHexInput, just bail out."</span>);
00454         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00455     }
00456 
00457     <span class="comment">/*</span>
00458 <span class="comment">     * Update fsModifiers.</span>
00459 <span class="comment">     */</span>
00460     fs = 0;
00461     fsModOnlyHotkey = 0;
00462 
00463     <span class="keywordflow">switch</span> (vk) {
00464     <span class="keywordflow">case</span> VK_SHIFT:
00465         fs = MOD_SHIFT;
00466         <span class="keywordflow">break</span>;
00467 
00468     <span class="keywordflow">case</span> VK_CONTROL:
00469         fs = MOD_CONTROL;
00470         <span class="keywordflow">break</span>;
00471 
00472     <span class="keywordflow">case</span> VK_MENU:
00473         fs = MOD_ALT;
00474         <span class="keywordflow">break</span>;
00475 
00476     <span class="keywordflow">case</span> VK_LWIN:
00477     <span class="keywordflow">case</span> VK_RWIN:
00478         fs = MOD_WIN;
00479         <span class="keywordflow">break</span>;
00480 
00481     <span class="keywordflow">default</span>:
00482         <span class="comment">/*</span>
00483 <span class="comment">         * A non-modifier key rules out Modifier-Only hotkeys</span>
00484 <span class="comment">         */</span>
00485         fsModOnlyCandidate = 0;
00486         <span class="keywordflow">break</span>;
00487     }
00488 
00489     <span class="keywordflow">if</span> (fBreak) {
00490         fsModifiers &amp;= ~fs;
00491         <span class="comment">/*</span>
00492 <span class="comment">         * If a modifier key is coming up, the current modifier only hotkey</span>
00493 <span class="comment">         * candidate must be tested to see if it is a hotkey.  Store this</span>
00494 <span class="comment">         * in fsModOnlyHotkey, and prevent the next key release from</span>
00495 <span class="comment">         * being a candidate by clearing fsModOnlyCandidate.</span>
00496 <span class="comment">         */</span>
00497         <span class="keywordflow">if</span> (fs != 0) {
00498             fsModOnlyHotkey = fsModOnlyCandidate;
00499             fsModOnlyCandidate = 0;
00500         }
00501     } <span class="keywordflow">else</span> {
00502         fsModifiers |= fs;
00503         <span class="comment">/*</span>
00504 <span class="comment">         * If a modifier key is going down, we have a modifier-only hotkey</span>
00505 <span class="comment">         * candidate.  Save current modifier state until the following break.</span>
00506 <span class="comment">         */</span>
00507         <span class="keywordflow">if</span> (fs != 0) {
00508             fsModOnlyCandidate = fsModifiers;
00509         }
00510     }
00511 
00512     <span class="comment">/*</span>
00513 <span class="comment">     * We look at the physical state for the modifiers because they can not be</span>
00514 <span class="comment">     * manipulated and this prevents someone from writing a trojan winlogon look alike.</span>
00515 <span class="comment">     * (See comment in AreModifiersIndicatingSAS)</span>
00516 <span class="comment">     */</span>
00517     bSAS = <a class="code" href="../../d4/d1/userk_8h.html#a1260">IsSAS</a>((BYTE)vk, &amp;fsModifiers);
00518 
00519     <span class="comment">/*</span>
00520 <span class="comment">     * If the key is not a hotkey then we're done but first check if the</span>
00521 <span class="comment">     * key is an Alt-Escape if so we need to cancel journalling.</span>
00522 <span class="comment">     *</span>
00523 <span class="comment">     * NOTE: Support for Alt+Esc to cancel journalling dropped in NT 4.0</span>
00524 <span class="comment">     */</span>
00525     <span class="keywordflow">if</span> (fsModOnlyHotkey &amp;&amp; fBreak) {
00526         <span class="comment">/*</span>
00527 <span class="comment">         * A hotkey involving only VK_SHIFT, VK_CONTROL, VK_MENU or VK_WINDOWS</span>
00528 <span class="comment">         * must only operate on a key release.</span>
00529 <span class="comment">         */</span>
00530         <span class="keywordflow">if</span> ((phk = <a class="code" href="../../d4/d1/userk_8h.html#a1262">IsHotKey</a>(fsModOnlyHotkey, VK_NONE)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00531             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00532         }
00533     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((phk = <a class="code" href="../../d4/d1/userk_8h.html#a1262">IsHotKey</a>(fsModifiers, vk)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00534         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00535     }
00536 
00537     <span class="comment">/*</span>
00538 <span class="comment">     * If we tripped a SAS hotkey, but it's not really the SAS, don't do it.</span>
00539 <span class="comment">     */</span>
00540     <span class="keywordflow">if</span> ((phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o3">wFlags</a> &amp; MOD_SAS) &amp;&amp; !bSAS) {
00541         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00542 
00543     }
00544     <span class="keywordflow">if</span> (phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o5">id</a> == <a class="code" href="../../d4/d1/userk_8h.html#a460">IDHOT_WINDOWS</a>) {
00545         pwnd = <a class="code" href="../../d4/d1/userk_8h.html#a256">GETDESKINFO</a>(<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>())-&gt;spwndShell;
00546         <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00547             fsModOnlyCandidate = 0; <span class="comment">/* Make it return TRUE */</span>
00548             <span class="keywordflow">goto</span> PostTaskListSysCmd;
00549         }
00550     }
00551 
00552     <span class="keywordflow">if</span> ((phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o5">id</a> == <a class="code" href="../../d4/d1/userk_8h.html#a458">IDHOT_DEBUG</a>) || (phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o5">id</a> == <a class="code" href="../../d4/d1/userk_8h.html#a459">IDHOT_DEBUGSERVER</a>)) {
00553 
00554         <span class="keywordflow">if</span> (!fBreak) {
00555             <span class="comment">/*</span>
00556 <span class="comment">             * The DEBUG key has been pressed.  Break the appropriate</span>
00557 <span class="comment">             * thread into the debugger.  Won't need phk after this callback</span>
00558 <span class="comment">             * because we return immediately.</span>
00559 <span class="comment">             */</span>
00560             fEatDebugKeyBreak = <a class="code" href="../../d4/d1/userk_8h.html#a1146">xxxActivateDebugger</a>(phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o2">fsModifiers</a>);
00561         }
00562 
00563         <span class="comment">/*</span>
00564 <span class="comment">         * This'll eat the debug key down and break if we broke into</span>
00565 <span class="comment">         * the debugger on the server only on the down.</span>
00566 <span class="comment">         */</span>
00567         <span class="keywordflow">return</span> fEatDebugKeyBreak;
00568     }
00569 
00570     <span class="comment">/*</span>
00571 <span class="comment">     * don't allow hotkeys(except for ones owned by the logon process)</span>
00572 <span class="comment">     * if the window station is locked.</span>
00573 <span class="comment">     */</span>
00574 
00575     <span class="keywordflow">if</span> (((<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a176">grpdeskRitInput</a>-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o3">rpwinstaParent</a>-&gt;<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o3">dwWSF_Flags</a> &amp; <a class="code" href="../../d4/d1/userk_8h.html#a314">WSF_SWITCHLOCK</a>) != 0) &amp;&amp;
00576             (phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o0">pti</a>-&gt;pEThread-&gt;Cid.UniqueProcess != <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a298">gpidLogon</a>)) {
00577         RIPMSG0(RIP_WARNING, <span class="stringliteral">"Ignoring hotkey because Workstation locked"</span>);
00578         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00579     }
00580 
00581     <span class="keywordflow">if</span> ((fsModOnlyHotkey == 0) &amp;&amp; fBreak) {
00582         <span class="comment">/*</span>
00583 <span class="comment">         * Do Modifier-Only hotkeys on break events, else return here.</span>
00584 <span class="comment">         */</span>
00585         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00586     }
00587 
00588     <span class="comment">/*</span>
00589 <span class="comment">     * Unhook hooks if a control-escape, alt-escape, or control-alt-del</span>
00590 <span class="comment">     * comes through, so the user can cancel if the system seems hung.</span>
00591 <span class="comment">     *</span>
00592 <span class="comment">     * Note the hook may be locked so even if the unhook succeeds it</span>
00593 <span class="comment">     * won't remove the hook from the global asphkStart array.  So</span>
00594 <span class="comment">     * we have to walk the list manually.  This code works because</span>
00595 <span class="comment">     * we are in the critical section and we know other hooks won't</span>
00596 <span class="comment">     * be deleted.</span>
00597 <span class="comment">     *</span>
00598 <span class="comment">     * Once we've unhooked, post a WM_CANCELJOURNAL message to the app</span>
00599 <span class="comment">     * that set the hook so it knows we did this.</span>
00600 <span class="comment">     *</span>
00601 <span class="comment">     * NOTE: Support for Alt+Esc to cancel journalling dropped in NT 4.0</span>
00602 <span class="comment">     */</span>
00603     fCancel = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00604     <span class="keywordflow">if</span> (vk == VK_ESCAPE &amp;&amp; (fsModifiers == MOD_CONTROL)) {
00605         fCancel = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00606     }
00607 
00608     <span class="keywordflow">if</span> (bSAS) {
00609         fCancel = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00610     }
00611 
00612     <span class="keywordflow">if</span> (fCancel)
00613         <a class="code" href="../../d1/d2/hooks_8c.html#a13">zzzCancelJournalling</a>(); <span class="comment">// BUG BUG phk might go away IANJA</span>
00614 
00615     <span class="comment">/*</span>
00616 <span class="comment">     * See if the key is reserved by a console window.  If it is,</span>
00617 <span class="comment">     * return FALSE so the key will be passed to the console.</span>
00618 <span class="comment">     */</span>
00619     <span class="keywordflow">if</span> (fsReserveKeys != 0) {
00620         <span class="keywordflow">switch</span> (vk) {
00621         <span class="keywordflow">case</span> VK_TAB:
00622             <span class="keywordflow">if</span> ((fsReserveKeys &amp; CONSOLE_ALTTAB) &amp;&amp;
00623                     ((fsModifiers &amp; (MOD_CONTROL | MOD_ALT)) == MOD_ALT)) {
00624                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00625             }
00626             <span class="keywordflow">break</span>;
00627         <span class="keywordflow">case</span> VK_ESCAPE:
00628             <span class="keywordflow">if</span> ((fsReserveKeys &amp; CONSOLE_ALTESC) &amp;&amp;
00629                     ((fsModifiers &amp; (MOD_CONTROL | MOD_ALT)) == MOD_ALT)) {
00630                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00631             }
00632             <span class="keywordflow">if</span> ((fsReserveKeys &amp; CONSOLE_CTRLESC) &amp;&amp;
00633                     ((fsModifiers &amp; (MOD_CONTROL | MOD_ALT)) == MOD_CONTROL)) {
00634                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00635             }
00636             <span class="keywordflow">break</span>;
00637         <span class="keywordflow">case</span> VK_RETURN:
00638             <span class="keywordflow">if</span> ((fsReserveKeys &amp; CONSOLE_ALTENTER) &amp;&amp;
00639                     ((fsModifiers &amp; (MOD_CONTROL | MOD_ALT)) == MOD_ALT)) {
00640                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00641             }
00642             <span class="keywordflow">break</span>;
00643         <span class="keywordflow">case</span> VK_SNAPSHOT:
00644             <span class="keywordflow">if</span> ((fsReserveKeys &amp; CONSOLE_PRTSC) &amp;&amp;
00645                     ((fsModifiers &amp; (MOD_CONTROL | MOD_ALT)) == 0)) {
00646                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00647             }
00648             <span class="keywordflow">if</span> ((fsReserveKeys &amp; CONSOLE_ALTPRTSC) &amp;&amp;
00649                     ((fsModifiers &amp; (MOD_CONTROL | MOD_ALT)) == MOD_ALT)) {
00650                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00651             }
00652             <span class="keywordflow">break</span>;
00653         <span class="keywordflow">case</span> VK_SPACE:
00654             <span class="keywordflow">if</span> ((fsReserveKeys &amp; CONSOLE_ALTSPACE) &amp;&amp;
00655                     ((fsModifiers &amp; (MOD_CONTROL | MOD_ALT)) == MOD_ALT)) {
00656                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00657             }
00658             <span class="keywordflow">break</span>;
00659         }
00660     }
00661 
00662     <span class="comment">/*</span>
00663 <span class="comment">     * If this is the task-list hotkey, go ahead and set foreground</span>
00664 <span class="comment">     * status to the task-list queue right now.  This prevents problems</span>
00665 <span class="comment">     * where the user hits ctrl-esc and types-ahead before the task-list</span>
00666 <span class="comment">     * processes the hotkey and brings up the task-list window.</span>
00667 <span class="comment">     */</span>
00668     <span class="keywordflow">if</span> ((fsModifiers == MOD_CONTROL) &amp;&amp; (vk == VK_ESCAPE) &amp;&amp; !fBreak) {
00669         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndSwitch;
00670         <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndSwitch;
00671 
00672         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a91">ghwndSwitch</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00673             pwndSwitch = <a class="code" href="../../d4/d1/userk_8h.html#a104">PW</a>(ghwndSwitch);
00674             <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(pwndSwitch, &amp;tlpwndSwitch);
00675             <a class="code" href="../../d4/d1/userk_8h.html#a1225">xxxSetForegroundWindow2</a>(pwndSwitch, NULL, 0);  <span class="comment">// BUG BUG phk might go away IANJA</span>
00676             <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndSwitch);
00677         }
00678     }
00679 
00680     <span class="comment">/*</span>
00681 <span class="comment">     * Get the hot key contents.</span>
00682 <span class="comment">     */</span>
00683     <span class="keywordflow">if</span> (phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00684         <a class="code" href="../../d4/d1/userk_8h.html#a1645">_PostThreadMessage</a>(
00685                 phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o0">pti</a>, WM_HOTKEY, phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o5">id</a>,
00686                 MAKELONG(fsModifiers, vk));
00687         <span class="comment">/*</span>
00688 <span class="comment">         * Since this hotkey is for this guy, he owns the last input.</span>
00689 <span class="comment">         */</span>
00690         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a78">glinp</a>.<a class="code" href="../../d5/d9/structtagLASTINPUT.html#o2">ptiLastWoken</a> = phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o0">pti</a>;
00691 
00692     } <span class="keywordflow">else</span> {
00693         <span class="keywordflow">if</span> (phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a> == <a class="code" href="../../d4/d1/userk_8h.html#a449">PWND_INPUTOWNER</a>) {
00694             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00695                 pwnd = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o7">spwndFocus</a>;
00696             } <span class="keywordflow">else</span> {
00697                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00698             }
00699         } <span class="keywordflow">else</span> {
00700             pwnd = phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a>;
00701         }
00702 
00703         <span class="keywordflow">if</span> (pwnd) {
00704             <span class="keywordflow">if</span> (pwnd == pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk-&gt;pDeskInfo-&gt;spwndShell &amp;&amp; phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o5">id</a> == SC_TASKLIST) {
00705 PostTaskListSysCmd:
00706                 <a class="code" href="../../d4/d1/userk_8h.html#a1642">_PostMessage</a>(pwnd, WM_SYSCOMMAND, SC_TASKLIST, 0);
00707             } <span class="keywordflow">else</span> {
00708                 <a class="code" href="../../d4/d1/userk_8h.html#a1642">_PostMessage</a>(pwnd, WM_HOTKEY, phk-&gt;<a class="code" href="../../d8/d6/structtagHOTKEY.html#o5">id</a>, MAKELONG(fsModifiers, vk));
00709             }
00710 
00711             <span class="comment">/*</span>
00712 <span class="comment">             * Since this hotkey is for this guy, he owns the last input.</span>
00713 <span class="comment">             */</span>
00714             <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a78">glinp</a>.<a class="code" href="../../d5/d9/structtagLASTINPUT.html#o2">ptiLastWoken</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a455">GETPTI</a>(pwnd);
00715         }
00716     }
00717 
00718     <span class="comment">/*</span>
00719 <span class="comment">     * If this is a Modifier-Only hotkey, let the modifier break through</span>
00720 <span class="comment">     * by returning FALSE, otherwise we will have modifier keys stuck down.</span>
00721 <span class="comment">     */</span>
00722     <span class="keywordflow">return</span> (fsModOnlyHotkey == 0);
00723 
00724 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:06 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
