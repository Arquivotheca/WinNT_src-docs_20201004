<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: waitsup.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>waitsup.c</h1><a href="../../d2/d7/waitsup_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    waitsup.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module contains the support routines necessary to support the</span>
00012 <span class="comment">    generic kernel wait functions. Functions are provided to test if a</span>
00013 <span class="comment">    wait can be satisfied, to satisfy a wait, and to unwwait a thread.</span>
00014 <span class="comment"></span>
00015 <span class="comment">Author:</span>
00016 <span class="comment"></span>
00017 <span class="comment">    David N. Cutler (davec) 24-Mar-1989</span>
00018 <span class="comment"></span>
00019 <span class="comment">Environment:</span>
00020 <span class="comment"></span>
00021 <span class="comment">    Kernel mode only.</span>
00022 <span class="comment"></span>
00023 <span class="comment">Revision History:</span>
00024 <span class="comment"></span>
00025 <span class="comment">--*/</span>
00026 
00027 <span class="preprocessor">#include "<a class="code" href="../../d0/d0/ki_8h.html">ki.h</a>"</span>
00028 
00029 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00030 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
<a name="l00031"></a><a class="code" href="../../d2/d7/waitsup_8c.html#a0">00031</a> <a class="code" href="../../d2/d7/waitsup_8c.html#a0">KiUnwaitThread</a> (
00032     IN <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread,
00033     IN LONG_PTR WaitStatus,
00034     IN KPRIORITY Increment
00035     )
00036 
00037 <span class="comment">/*++</span>
00038 <span class="comment"></span>
00039 <span class="comment">Routine Description:</span>
00040 <span class="comment"></span>
00041 <span class="comment">    This function unwaits a thread, sets the thread's wait completion status,</span>
00042 <span class="comment">    calculates the thread's new priority, and readies the thread for execution.</span>
00043 <span class="comment"></span>
00044 <span class="comment">Arguments:</span>
00045 <span class="comment"></span>
00046 <span class="comment">    Thread - Supplies a pointer to a dispatcher object of type thread.</span>
00047 <span class="comment"></span>
00048 <span class="comment">    WaitStatus - Supplies the wait completion status.</span>
00049 <span class="comment"></span>
00050 <span class="comment">    Increment - Supplies the priority increment that is to be applied to</span>
00051 <span class="comment">        the thread's priority.</span>
00052 <span class="comment"></span>
00053 <span class="comment">Return Value:</span>
00054 <span class="comment"></span>
00055 <span class="comment">    None.</span>
00056 <span class="comment"></span>
00057 <span class="comment">--*/</span>
00058 
00059 {
00060 
00061     KPRIORITY NewPriority;
00062     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process;
00063     <a class="code" href="../../d7/d7/struct__KQUEUE.html">PKQUEUE</a> Queue;
00064     <a class="code" href="../../d3/d8/struct__KTIMER.html">PKTIMER</a> Timer;
00065     <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">PRKWAIT_BLOCK</a> WaitBlock;
00066 
00067     <span class="comment">//</span>
00068     <span class="comment">// Set wait completion status, remove wait blocks from object wait</span>
00069     <span class="comment">// lists, and remove thread from wait list.</span>
00070     <span class="comment">//</span>
00071 
00072     Thread-&gt;WaitStatus |= WaitStatus;
00073     WaitBlock = Thread-&gt;WaitBlockList;
00074     <span class="keywordflow">do</span> {
00075         RemoveEntryList(&amp;WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o0">WaitListEntry</a>);
00076         WaitBlock = WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o3">NextWaitBlock</a>;
00077     } <span class="keywordflow">while</span> (WaitBlock != Thread-&gt;WaitBlockList);
00078 
00079     RemoveEntryList(&amp;Thread-&gt;WaitListEntry);
00080 
00081     <span class="comment">//</span>
00082     <span class="comment">// If thread timer is still active, then cancel thread timer.</span>
00083     <span class="comment">//</span>
00084 
00085     Timer = &amp;Thread-&gt;Timer;
00086     <span class="keywordflow">if</span> (Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o3">Inserted</a> != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00087         <a class="code" href="../../d0/d0/ki_8h.html#a22">KiRemoveTreeTimer</a>(Timer);
00088     }
00089 
00090     <span class="comment">//</span>
00091     <span class="comment">// If the thread is processing a queue entry, then increment the</span>
00092     <span class="comment">// count of currently active threads.</span>
00093     <span class="comment">//</span>
00094 
00095     Queue = Thread-&gt;Queue;
00096     <span class="keywordflow">if</span> (Queue != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00097         Queue-&gt;<a class="code" href="../../d7/d7/struct__KQUEUE.html#o2">CurrentCount</a> += 1;
00098     }
00099 
00100     <span class="comment">//</span>
00101     <span class="comment">// If the thread runs at a realtime priority level, then reset the</span>
00102     <span class="comment">// thread quantum. Otherwise, compute the next thread priority and</span>
00103     <span class="comment">// charge the thread for the wait operation.</span>
00104     <span class="comment">//</span>
00105 
00106     Process = Thread-&gt;ApcState.Process;
00107     <span class="keywordflow">if</span> (Thread-&gt;Priority &lt; LOW_REALTIME_PRIORITY) {
00108         <span class="keywordflow">if</span> ((Thread-&gt;PriorityDecrement == 0) &amp;&amp;
00109             (Thread-&gt;DisableBoost == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
00110             NewPriority = Thread-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o12">BasePriority</a> + <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a>;
00111             <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)Process)-&gt;Vm.MemoryPriority == <a class="code" href="../../d1/d9/ps_8h.html#a3">MEMORY_PRIORITY_FOREGROUND</a>) {
00112                 NewPriority += <a class="code" href="../../d1/d9/ps_8h.html#a47">PsPrioritySeperation</a>;
00113             }
00114 
00115             <span class="keywordflow">if</span> (NewPriority &gt; Thread-&gt;Priority) {
00116                 <span class="keywordflow">if</span> (NewPriority &gt;= LOW_REALTIME_PRIORITY) {
00117                     Thread-&gt;Priority = LOW_REALTIME_PRIORITY - 1;
00118 
00119                 } <span class="keywordflow">else</span> {
00120                     Thread-&gt;Priority = (SCHAR)NewPriority;
00121                 }
00122             }
00123         }
00124 
00125         <span class="keywordflow">if</span> (Thread-&gt;BasePriority &gt;= <a class="code" href="../../d0/d0/ki_8h.html#a4">TIME_CRITICAL_PRIORITY_BOUND</a>) {
00126             Thread-&gt;Quantum = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a>;
00127 
00128         } <span class="keywordflow">else</span> {
00129             Thread-&gt;Quantum -= <a class="code" href="../../d4/d9/ke_8h.html#a1">WAIT_QUANTUM_DECREMENT</a>;
00130             <span class="keywordflow">if</span> (Thread-&gt;Quantum &lt;= 0) {
00131                 Thread-&gt;Quantum = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a>;
00132                 Thread-&gt;Priority -= (Thread-&gt;PriorityDecrement + 1);
00133                 <span class="keywordflow">if</span> (Thread-&gt;Priority &lt; Thread-&gt;BasePriority) {
00134                     Thread-&gt;Priority = Thread-&gt;BasePriority;
00135                 }
00136 
00137                 Thread-&gt;PriorityDecrement = 0;
00138             }
00139         }
00140 
00141     } <span class="keywordflow">else</span> {
00142         Thread-&gt;Quantum = Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a>;
00143     }
00144 
00145     <span class="comment">//</span>
00146     <span class="comment">// Reready the thread for execution.</span>
00147     <span class="comment">//</span>
00148 
00149     <a class="code" href="../../d0/d2/thredsup_8c.html#a3">KiReadyThread</a>(Thread);
00150     <span class="keywordflow">return</span>;
00151 }
00152 
00153 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00154"></a><a class="code" href="../../d2/d7/waitsup_8c.html#a1">00154</a> <a class="code" href="../../d2/d7/waitsup_8c.html#a1">KeBoostCurrentThread</a>(
00155     VOID
00156     )
00157 
00158 <span class="comment">/*++</span>
00159 <span class="comment"></span>
00160 <span class="comment">Routine Description:</span>
00161 <span class="comment"></span>
00162 <span class="comment">    This function boosts the priority of the current thread for one quantum,</span>
00163 <span class="comment">    then reduce the thread priority to the base priority of the thread.</span>
00164 <span class="comment"></span>
00165 <span class="comment">Arguments:</span>
00166 <span class="comment"></span>
00167 <span class="comment">    None.</span>
00168 <span class="comment"></span>
00169 <span class="comment">Return Value:</span>
00170 <span class="comment"></span>
00171 <span class="comment">    None.</span>
00172 <span class="comment"></span>
00173 <span class="comment">--*/</span>
00174 
00175 {
00176 
00177     KIRQL OldIrql;
00178     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread;
00179 
00180     <span class="comment">//</span>
00181     <span class="comment">// Get current thread address, raise IRQL to synchronization level, and</span>
00182     <span class="comment">// lock the dispatcher database</span>
00183     <span class="comment">//</span>
00184 
00185     Thread = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00186 
00187 redoboost:
00188     <a class="code" href="../../d4/d9/ke_8h.html#a36">KiLockDispatcherDatabase</a>(&amp;OldIrql);
00189 
00190     <span class="comment">//</span>
00191     <span class="comment">// If a priority boost is not already active for the current thread</span>
00192     <span class="comment">// and the thread priority is less than 14, then boost the thread</span>
00193     <span class="comment">// priority to 14 and give the thread a large quantum. Otherwise,</span>
00194     <span class="comment">// if a priority boost is active, then decrement the round trip</span>
00195     <span class="comment">// count. If the count goes to zero, then release the dispatcher</span>
00196     <span class="comment">// database lock, lower the thread priority to the base priority,</span>
00197     <span class="comment">// and then attempt to boost the priority again. This will give</span>
00198     <span class="comment">// other threads a chance to run. If the count does not reach zero,</span>
00199     <span class="comment">// then give the thread another large qunatum.</span>
00200     <span class="comment">//</span>
00201     <span class="comment">// If the thread priority is above 14, then no boost is applied.</span>
00202     <span class="comment">//</span>
00203 
00204     <span class="keywordflow">if</span> ((Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o26">PriorityDecrement</a> == 0) &amp;&amp; (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o13">Priority</a> &lt; 14)) {
00205         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o26">PriorityDecrement</a> = 14 - Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o24">BasePriority</a>;
00206         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o25">DecrementCount</a> = <a class="code" href="../../d4/d9/ke_8h.html#a4">ROUND_TRIP_DECREMENT_COUNT</a>;
00207         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o13">Priority</a> = 14;
00208         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o27">Quantum</a> = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o1">Process</a>-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a> * 2;
00209 
00210     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o26">PriorityDecrement</a> != 0) {
00211         Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o25">DecrementCount</a> -= 1;
00212         <span class="keywordflow">if</span> (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o25">DecrementCount</a> == 0) {
00213             <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00214             <a class="code" href="../../d9/d1/thredobj_8c.html#a24">KeSetPriorityThread</a>(Thread, Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o24">BasePriority</a>);
00215             <span class="keywordflow">goto</span> redoboost;
00216 
00217         } <span class="keywordflow">else</span> {
00218             Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o27">Quantum</a> = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o1">Process</a>-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a> * 2;
00219         }
00220     }
00221 
00222     <a class="code" href="../../d0/d0/ki_8h.html#a84">KiUnlockDispatcherDatabase</a>(OldIrql);
00223     <span class="keywordflow">return</span>;
00224 }
00225 
00226 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00227 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
<a name="l00228"></a><a class="code" href="../../d2/d7/waitsup_8c.html#a2">00228</a> <a class="code" href="../../d2/d7/waitsup_8c.html#a2">KiWaitSatisfyAll</a> (
00229     IN <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">PRKWAIT_BLOCK</a> WaitBlock
00230     )
00231 
00232 <span class="comment">/*++</span>
00233 <span class="comment"></span>
00234 <span class="comment">Routine Description:</span>
00235 <span class="comment"></span>
00236 <span class="comment">    This function satisfies a wait all and performs any side effects that</span>
00237 <span class="comment">    are necessary.</span>
00238 <span class="comment"></span>
00239 <span class="comment">Arguments:</span>
00240 <span class="comment"></span>
00241 <span class="comment">    WaitBlock - Supplies a pointer to a wait block.</span>
00242 <span class="comment"></span>
00243 <span class="comment">Return Value:</span>
00244 <span class="comment"></span>
00245 <span class="comment">    None.</span>
00246 <span class="comment"></span>
00247 <span class="comment">--*/</span>
00248 
00249 {
00250 
00251     <a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTANT</a> Object;
00252     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread;
00253     <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">PRKWAIT_BLOCK</a> WaitBlock1;
00254 
00255     <span class="comment">//</span>
00256     <span class="comment">// If the wait type was WaitAny, then perform neccessary side effects on</span>
00257     <span class="comment">// the object specified by the wait block. Else perform necessary side</span>
00258     <span class="comment">// effects on all the objects that were involved in the wait operation.</span>
00259     <span class="comment">//</span>
00260 
00261     WaitBlock1 = WaitBlock;
00262     Thread = WaitBlock1-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o1">Thread</a>;
00263     <span class="keywordflow">do</span> {
00264         <span class="keywordflow">if</span> (WaitBlock1-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o4">WaitKey</a> != (CSHORT)STATUS_TIMEOUT) {
00265             Object = (<a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTANT</a>)WaitBlock1-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o2">Object</a>;
00266             <a class="code" href="../../d0/d0/ki_8h.html#a25">KiWaitSatisfyAny</a>(Object, Thread);
00267         }
00268 
00269         WaitBlock1 = WaitBlock1-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o3">NextWaitBlock</a>;
00270     } <span class="keywordflow">while</span> (WaitBlock1 != WaitBlock);
00271 
00272     <span class="keywordflow">return</span>;
00273 }
00274 
00275 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00276 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a0">FASTCALL</a>
<a name="l00277"></a><a class="code" href="../../d2/d7/waitsup_8c.html#a3">00277</a> <a class="code" href="../../d2/d7/waitsup_8c.html#a3">KiWaitTest</a> (
00278     IN PVOID Object,
00279     IN KPRIORITY Increment
00280     )
00281 
00282 <span class="comment">/*++</span>
00283 <span class="comment"></span>
00284 <span class="comment">Routine Description:</span>
00285 <span class="comment"></span>
00286 <span class="comment">    This function tests if a wait can be satisfied when an object attains</span>
00287 <span class="comment">    a state of signaled. If a wait can be satisfied, then the subject thread</span>
00288 <span class="comment">    is unwaited with a completion status that is the WaitKey of the wait</span>
00289 <span class="comment">    block from the object wait list. As many waits as possible are satisfied.</span>
00290 <span class="comment"></span>
00291 <span class="comment">Arguments:</span>
00292 <span class="comment"></span>
00293 <span class="comment">    Object - Supplies a pointer to a dispatcher object.</span>
00294 <span class="comment"></span>
00295 <span class="comment">Return Value:</span>
00296 <span class="comment"></span>
00297 <span class="comment">    None.</span>
00298 <span class="comment"></span>
00299 <span class="comment">--*/</span>
00300 
00301 {
00302 
00303     <a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a> <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a>;
00304     PLIST_ENTRY ListHead;
00305     <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">PRKWAIT_BLOCK</a> NextBlock;
00306     <a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTANT</a> Mutant;
00307     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PRKTHREAD</a> Thread;
00308     <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">PRKWAIT_BLOCK</a> WaitBlock;
00309     PLIST_ENTRY WaitEntry;
00310 
00311     <span class="comment">//</span>
00312     <span class="comment">// As long as the signal state of the specified object is Signaled and</span>
00313     <span class="comment">// there are waiters in the object wait list, then try to satisfy a wait.</span>
00314     <span class="comment">//</span>
00315 
00316     <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a> = (<a class="code" href="../../d2/d6/struct__KEVENT.html">PKEVENT</a>)Object;
00317     ListHead = &amp;<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a>-&gt;Header.WaitListHead;
00318     WaitEntry = ListHead-&gt;Flink;
00319     <span class="keywordflow">while</span> ((<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a>-&gt;Header.SignalState &gt; 0) &amp;&amp;
00320            (WaitEntry != ListHead)) {
00321         WaitBlock = CONTAINING_RECORD(WaitEntry, <a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html">KWAIT_BLOCK</a>, WaitListEntry);
00322         Thread = WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o1">Thread</a>;
00323         <span class="keywordflow">if</span> (WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o5">WaitType</a> != WaitAny) {
00324 
00325             <span class="comment">//</span>
00326             <span class="comment">// The wait type is wait all - if all the objects are in</span>
00327             <span class="comment">// a Signaled state, then satisfy the wait.</span>
00328             <span class="comment">//</span>
00329 
00330             NextBlock = WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o3">NextWaitBlock</a>;
00331             <span class="keywordflow">while</span> (NextBlock != WaitBlock) {
00332                 <span class="keywordflow">if</span> (NextBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o4">WaitKey</a> != (CSHORT)(STATUS_TIMEOUT)) {
00333                     Mutant = (<a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTANT</a>)NextBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o2">Object</a>;
00334                     <span class="keywordflow">if</span> ((Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o0">Type</a> == <a class="code" href="../../d4/d9/ke_8h.html#a402a159">MutantObject</a>) &amp;&amp;
00335                         (Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o4">SignalState</a> &lt;= 0) &amp;&amp;
00336                         (Thread == Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o2">OwnerThread</a>)) {
00337                         <span class="keywordflow">goto</span> next;
00338 
00339                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Mutant-&gt;<a class="code" href="../../d3/d7/struct__KMUTANT.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o4">SignalState</a> &lt;= 0) {
00340                         <span class="keywordflow">goto</span> scan;
00341                     }
00342                 }
00343 
00344             next:
00345                 NextBlock = NextBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o3">NextWaitBlock</a>;
00346             }
00347 
00348             <span class="comment">//</span>
00349             <span class="comment">// All objects associated with the wait are in the Signaled</span>
00350             <span class="comment">// state - satisfy the wait.</span>
00351             <span class="comment">//</span>
00352 
00353             WaitEntry = WaitEntry-&gt;Blink;
00354             <a class="code" href="../../d2/d7/waitsup_8c.html#a2">KiWaitSatisfyAll</a>(WaitBlock);
00355 
00356         } <span class="keywordflow">else</span> {
00357 
00358             <span class="comment">//</span>
00359             <span class="comment">// The wait type is wait any - satisfy the wait.</span>
00360             <span class="comment">//</span>
00361 
00362             WaitEntry = WaitEntry-&gt;Blink;
00363             <a class="code" href="../../d0/d0/ki_8h.html#a25">KiWaitSatisfyAny</a>((<a class="code" href="../../d3/d7/struct__KMUTANT.html">PKMUTANT</a>)<a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a>, Thread);
00364         }
00365 
00366         <a class="code" href="../../d2/d7/waitsup_8c.html#a0">KiUnwaitThread</a>(Thread, (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)WaitBlock-&gt;<a class="code" href="../../d4/d8/struct__KWAIT__BLOCK.html#o4">WaitKey</a>, <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a>);
00367 
00368     scan:
00369         WaitEntry = WaitEntry-&gt;Flink;
00370     }
00371 
00372     <span class="keywordflow">return</span>;
00373 }
00374 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:24 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
