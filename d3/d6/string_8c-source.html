<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: string.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>string.c</h1><a href="../../d2/d7/string_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    strings.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module defines functions for manipulating counted strings (STRING).</span>
00012 <span class="comment">    A counted string is a data structure containing three fields.  The Buffer</span>
00013 <span class="comment">    field is a pointer to the string itself.  The MaximumLength field contains</span>
00014 <span class="comment">    the maximum number of bytes that can be stored in the memory pointed to</span>
00015 <span class="comment">    by the Buffer field.  The Length field contains the current length, in</span>
00016 <span class="comment">    bytes, of the string pointed to by the Buffer field.  Users of counted</span>
00017 <span class="comment">    strings should not make any assumptions about the existence of a null</span>
00018 <span class="comment">    byte at the end of the string, unless the null byte is explicitly</span>
00019 <span class="comment">    included in the Length of the string.</span>
00020 <span class="comment"></span>
00021 <span class="comment">Author:</span>
00022 <span class="comment"></span>
00023 <span class="comment">    Steve Wood (stevewo) 31-Mar-1989</span>
00024 <span class="comment"></span>
00025 <span class="comment">Revision History:</span>
00026 <span class="comment"></span>
00027 <span class="comment">    22-Sep-1993    JulieB    Fixed TO_UPPER macro for chars above 0x7f.</span>
00028 <span class="comment"></span>
00029 <span class="comment"></span>
00030 <span class="comment">--*/</span>
00031 
00032 <span class="preprocessor">#include "string.h"</span>
00033 <span class="preprocessor">#include "nt.h"</span>
00034 <span class="preprocessor">#include "<a class="code" href="../../d5/d9/ntrtlp_8h.html">ntrtlp.h</a>"</span>
00035 
00036 
00037 <span class="preprocessor">#if defined(ALLOC_PRAGMA) &amp;&amp; defined(NTOS_KERNEL_RUNTIME)</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,RtlUpperChar)</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#pragma alloc_text(PAGE,RtlUpperString)</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00041 <span class="preprocessor"></span>
00042 <span class="comment">//</span>
00043 <span class="comment">// Global data used for translations.</span>
00044 <span class="comment">//</span>
<a name="l00045"></a><a class="code" href="../../d2/d7/string_8c.html#a0">00045</a> <span class="keyword">extern</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>  <a class="code" href="../../d6/d6/nls_8c.html#a19">NlsAnsiToUnicodeData</a>;    <span class="comment">// Ansi CP to Unicode translation table</span>
<a name="l00046"></a><a class="code" href="../../d2/d7/string_8c.html#a1">00046</a> <span class="keyword">extern</span> PCH      <a class="code" href="../../d9/d6/nlsxlat_8c.html#a17">NlsUnicodeToAnsiData</a>;    <span class="comment">// Unicode to Ansi CP translation table</span>
<a name="l00047"></a><a class="code" href="../../d2/d7/string_8c.html#a2">00047</a> <span class="keyword">extern</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>  <a class="code" href="../../d6/d6/nls_8c.html#a20">NlsLeadByteInfo</a>;         <span class="comment">// Lead byte info for ACP</span>
<a name="l00048"></a><a class="code" href="../../d2/d7/string_8c.html#a3">00048</a> <span class="keyword">extern</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>  <a class="code" href="../../d9/d6/nlsxlat_8c.html#a18">NlsUnicodeToMbAnsiData</a>;  <span class="comment">// Unicode to Multibyte Ansi CP translation table</span>
<a name="l00049"></a><a class="code" href="../../d2/d7/string_8c.html#a4">00049</a> <span class="keyword">extern</span> BOOLEAN  <a class="code" href="../../d9/d6/nlsxlat_8c.html#a19">NlsMbCodePageTag</a>;        <span class="comment">// TRUE -&gt; Multibyte ACP, FALSE -&gt; Singlebyte ACP</span>
00050 
00051 
00052 
00053 <span class="preprocessor">#if !defined(_M_IX86)</span>
00054 <span class="preprocessor"></span>
00055 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00056"></a><a class="code" href="../../d2/d7/string_8c.html#a5">00056</a> <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>(
00057     OUT PSTRING DestinationString,
00058     IN PCSZ SourceString OPTIONAL
00059     )
00060 
00061 <span class="comment">/*++</span>
00062 <span class="comment"></span>
00063 <span class="comment">Routine Description:</span>
00064 <span class="comment"></span>
00065 <span class="comment">    The RtlInitString function initializes an NT counted string.</span>
00066 <span class="comment">    The DestinationString is initialized to point to the SourceString</span>
00067 <span class="comment">    and the Length and MaximumLength fields of DestinationString are</span>
00068 <span class="comment">    initialized to the length of the SourceString, which is zero if</span>
00069 <span class="comment">    SourceString is not specified.</span>
00070 <span class="comment"></span>
00071 <span class="comment">Arguments:</span>
00072 <span class="comment"></span>
00073 <span class="comment">    DestinationString - Pointer to the counted string to initialize</span>
00074 <span class="comment"></span>
00075 <span class="comment">    SourceString - Optional pointer to a null terminated string that</span>
00076 <span class="comment">        the counted string is to point to.</span>
00077 <span class="comment"></span>
00078 <span class="comment"></span>
00079 <span class="comment">Return Value:</span>
00080 <span class="comment"></span>
00081 <span class="comment">    None.</span>
00082 <span class="comment"></span>
00083 <span class="comment">--*/</span>
00084 
00085 {
00086     ULONG Length;
00087 
00088     DestinationString-&gt;Buffer = (PCHAR)<a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>;
00089     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a> )) {
00090         Length = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(<a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>);
00091         DestinationString-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Length;
00092         DestinationString-&gt;MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(Length+1);
00093         }
00094     <span class="keywordflow">else</span> {
00095         DestinationString-&gt;Length = 0;
00096         DestinationString-&gt;MaximumLength = 0;
00097         }
00098 }
00099 
00100 
00101 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00102"></a><a class="code" href="../../d2/d7/string_8c.html#a6">00102</a> <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(
00103     OUT PANSI_STRING DestinationString,
00104     IN PCSZ SourceString OPTIONAL
00105     )
00106 
00107 <span class="comment">/*++</span>
00108 <span class="comment"></span>
00109 <span class="comment">Routine Description:</span>
00110 <span class="comment"></span>
00111 <span class="comment">    The RtlInitAnsiString function initializes an NT counted string.</span>
00112 <span class="comment">    The DestinationString is initialized to point to the SourceString</span>
00113 <span class="comment">    and the Length and MaximumLength fields of DestinationString are</span>
00114 <span class="comment">    initialized to the length of the SourceString, which is zero if</span>
00115 <span class="comment">    SourceString is not specified.</span>
00116 <span class="comment"></span>
00117 <span class="comment">Arguments:</span>
00118 <span class="comment"></span>
00119 <span class="comment">    DestinationString - Pointer to the counted string to initialize</span>
00120 <span class="comment"></span>
00121 <span class="comment">    SourceString - Optional pointer to a null terminated string that</span>
00122 <span class="comment">        the counted string is to point to.</span>
00123 <span class="comment"></span>
00124 <span class="comment"></span>
00125 <span class="comment">Return Value:</span>
00126 <span class="comment"></span>
00127 <span class="comment">    None.</span>
00128 <span class="comment"></span>
00129 <span class="comment">--*/</span>
00130 
00131 {
00132     ULONG Length;
00133 
00134     DestinationString-&gt;Buffer = (PCHAR)<a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>;
00135     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a> )) {
00136         Length = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(<a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>);
00137         DestinationString-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Length;
00138         DestinationString-&gt;MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(Length+1);
00139         }
00140     <span class="keywordflow">else</span> {
00141         DestinationString-&gt;Length = 0;
00142         DestinationString-&gt;MaximumLength = 0;
00143         }
00144 }
00145 
00146 
00147 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00148"></a><a class="code" href="../../d2/d7/string_8c.html#a7">00148</a> <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(
00149     OUT PUNICODE_STRING DestinationString,
00150     IN PCWSTR SourceString OPTIONAL
00151     )
00152 
00153 <span class="comment">/*++</span>
00154 <span class="comment"></span>
00155 <span class="comment">Routine Description:</span>
00156 <span class="comment"></span>
00157 <span class="comment">    The RtlInitUnicodeString function initializes an NT counted</span>
00158 <span class="comment">    unicode string.  The DestinationString is initialized to point to</span>
00159 <span class="comment">    the SourceString and the Length and MaximumLength fields of</span>
00160 <span class="comment">    DestinationString are initialized to the length of the SourceString,</span>
00161 <span class="comment">    which is zero if SourceString is not specified.</span>
00162 <span class="comment"></span>
00163 <span class="comment">Arguments:</span>
00164 <span class="comment"></span>
00165 <span class="comment">    DestinationString - Pointer to the counted string to initialize</span>
00166 <span class="comment"></span>
00167 <span class="comment">    SourceString - Optional pointer to a null terminated unicode string that</span>
00168 <span class="comment">        the counted string is to point to.</span>
00169 <span class="comment"></span>
00170 <span class="comment"></span>
00171 <span class="comment">Return Value:</span>
00172 <span class="comment"></span>
00173 <span class="comment">    None.</span>
00174 <span class="comment"></span>
00175 <span class="comment">--*/</span>
00176 
00177 {
00178     ULONG Length;
00179 
00180     DestinationString-&gt;Buffer = (PWSTR)<a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>;
00181     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a> )) {
00182         Length = wcslen( <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a> ) * <span class="keyword">sizeof</span>( WCHAR );
00183         DestinationString-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)Length;
00184         DestinationString-&gt;MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(Length + <span class="keyword">sizeof</span>(UNICODE_NULL));
00185         }
00186     <span class="keywordflow">else</span> {
00187         DestinationString-&gt;MaximumLength = 0;
00188         DestinationString-&gt;Length = 0;
00189         }
00190 }
00191 
00192 <span class="preprocessor">#endif // !defined(_M_IX86)</span>
00193 <span class="preprocessor"></span>
00194 
00195 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00196"></a><a class="code" href="../../d2/d7/string_8c.html#a8">00196</a> <a class="code" href="../../d2/d7/string_8c.html#a8">RtlCopyString</a>(
00197     OUT PSTRING DestinationString,
00198     IN PSTRING SourceString OPTIONAL
00199     )
00200 
00201 <span class="comment">/*++</span>
00202 <span class="comment"></span>
00203 <span class="comment">Routine Description:</span>
00204 <span class="comment"></span>
00205 <span class="comment">    The RtlCopyString function copies the SourceString to the</span>
00206 <span class="comment">    DestinationString.  If SourceString is not specified, then</span>
00207 <span class="comment">    the Length field of DestinationString is set to zero.  The</span>
00208 <span class="comment">    MaximumLength and Buffer fields of DestinationString are not</span>
00209 <span class="comment">    modified by this function.</span>
00210 <span class="comment"></span>
00211 <span class="comment">    The number of bytes copied from the SourceString is either the</span>
00212 <span class="comment">    Length of SourceString or the MaximumLength of DestinationString,</span>
00213 <span class="comment">    whichever is smaller.</span>
00214 <span class="comment"></span>
00215 <span class="comment">Arguments:</span>
00216 <span class="comment"></span>
00217 <span class="comment">    DestinationString - Pointer to the destination string.</span>
00218 <span class="comment"></span>
00219 <span class="comment">    SourceString - Optional pointer to the source string.</span>
00220 <span class="comment"></span>
00221 <span class="comment">Return Value:</span>
00222 <span class="comment"></span>
00223 <span class="comment">    None.</span>
00224 <span class="comment"></span>
00225 <span class="comment">--*/</span>
00226 
00227 {
00228     PSZ src, dst;
00229     ULONG <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
00230 
00231     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a> )) {
00232         dst = DestinationString-&gt;Buffer;
00233         src = <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>-&gt;Buffer;
00234         <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>-&gt;Length;
00235         <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> &gt; DestinationString-&gt;MaximumLength) {
00236             <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = DestinationString-&gt;MaximumLength;
00237             }
00238         DestinationString-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
00239         <span class="keywordflow">while</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>) {
00240             *dst++ = *src++;
00241             <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>--;
00242             }
00243         }
00244     <span class="keywordflow">else</span> {
00245         DestinationString-&gt;Length = 0;
00246         }
00247 }
00248 
00249 <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>
<a name="l00250"></a><a class="code" href="../../d2/d7/string_8c.html#a9">00250</a> <a class="code" href="../../d2/d7/string_8c.html#a9">RtlUpperChar</a> (
00251     <span class="keyword">register</span> IN CHAR Character
00252     )
00253 
00254 <span class="comment">/*++</span>
00255 <span class="comment"></span>
00256 <span class="comment">Routine Description:</span>
00257 <span class="comment"></span>
00258 <span class="comment">    This routine returns a character uppercased</span>
00259 <span class="comment">.</span>
00260 <span class="comment">Arguments:</span>
00261 <span class="comment"></span>
00262 <span class="comment">    IN CHAR Character - Supplies the character to upper case</span>
00263 <span class="comment"></span>
00264 <span class="comment">Return Value:</span>
00265 <span class="comment"></span>
00266 <span class="comment">    CHAR - Uppercased version of the charac</span>
00267 <span class="comment">ter</span>
00268 <span class="comment">--*/</span>
00269 
00270 {
00271     <span class="comment">//</span>
00272     <span class="comment">// NOTE:  This assumes an ANSI string and it does NOT upper case</span>
00273     <span class="comment">//        DOUBLE BYTE characters properly.</span>
00274     <span class="comment">//</span>
00275 
00276     <span class="comment">//</span>
00277     <span class="comment">//  Handle a - z separately.</span>
00278     <span class="comment">//</span>
00279     <span class="keywordflow">if</span> (Character &lt;= <span class="charliteral">'z'</span>) {
00280         <span class="keywordflow">if</span> (Character &gt;= <span class="charliteral">'a'</span>) {
00281             <span class="keywordflow">return</span> Character ^ 0x20;
00282             }
00283         <span class="keywordflow">else</span> {
00284             <span class="keywordflow">return</span> Character;
00285             }
00286         }
00287     <span class="keywordflow">else</span> {
00288         WCHAR wCh;
00289 
00290         <span class="comment">/*</span>
00291 <span class="comment">         *  Handle extended characters.</span>
00292 <span class="comment">         */</span>
00293         <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d6/nlsxlat_8c.html#a19">NlsMbCodePageTag</a>) {
00294             <span class="comment">//</span>
00295             <span class="comment">//  Single byte code page.</span>
00296             <span class="comment">//</span>
00297             wCh = <a class="code" href="../../d6/d6/nls_8c.html#a19">NlsAnsiToUnicodeData</a>[(UCHAR)Character];
00298             wCh = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a10">NLS_UPCASE</a>(wCh);
00299             <span class="keywordflow">return</span> <a class="code" href="../../d9/d6/nlsxlat_8c.html#a17">NlsUnicodeToAnsiData</a>[(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)wCh];
00300             }
00301         <span class="keywordflow">else</span> {
00302             <span class="comment">//</span>
00303             <span class="comment">//  Multi byte code page.  Do nothing to the character</span>
00304             <span class="comment">//  if it's a lead byte or if the translation of the</span>
00305             <span class="comment">//  upper case Unicode character is a DBCS character.</span>
00306             <span class="comment">//</span>
00307             <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d6/nls_8c.html#a20">NlsLeadByteInfo</a>[Character]) {
00308                 wCh = <a class="code" href="../../d6/d6/nls_8c.html#a19">NlsAnsiToUnicodeData</a>[(UCHAR)Character];
00309                 wCh = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a10">NLS_UPCASE</a>(wCh);
00310                 wCh = <a class="code" href="../../d9/d6/nlsxlat_8c.html#a18">NlsUnicodeToMbAnsiData</a>[(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)wCh];
00311                 <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(wCh)) {
00312                     <span class="keywordflow">return</span> <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(wCh);
00313                     }
00314                 }
00315             }
00316         }
00317 
00318     <span class="keywordflow">return</span> Character;
00319 }
00320 
00321 LONG
<a name="l00322"></a><a class="code" href="../../d2/d7/string_8c.html#a10">00322</a> <a class="code" href="../../d2/d7/string_8c.html#a10">RtlCompareString</a>(
00323     IN PSTRING String1,
00324     IN PSTRING String2,
00325     IN BOOLEAN CaseInSensitive
00326     )
00327 
00328 <span class="comment">/*++</span>
00329 <span class="comment"></span>
00330 <span class="comment">Routine Description:</span>
00331 <span class="comment"></span>
00332 <span class="comment">    The RtlCompareString function compares two counted strings.  The return</span>
00333 <span class="comment">    value indicates if the strings are equal or String1 is less than String2</span>
00334 <span class="comment">    or String1 is greater than String2.</span>
00335 <span class="comment"></span>
00336 <span class="comment">    The CaseInSensitive parameter specifies if case is to be ignored when</span>
00337 <span class="comment">    doing the comparison.</span>
00338 <span class="comment"></span>
00339 <span class="comment">Arguments:</span>
00340 <span class="comment"></span>
00341 <span class="comment">    String1 - Pointer to the first string.</span>
00342 <span class="comment"></span>
00343 <span class="comment">    String2 - Pointer to the second string.</span>
00344 <span class="comment"></span>
00345 <span class="comment">    CaseInsensitive - TRUE if case should be ignored when doing the</span>
00346 <span class="comment">        comparison.</span>
00347 <span class="comment"></span>
00348 <span class="comment">Return Value:</span>
00349 <span class="comment"></span>
00350 <span class="comment">    Signed value that gives the results of the comparison:</span>
00351 <span class="comment"></span>
00352 <span class="comment">        Zero - String1 equals String2</span>
00353 <span class="comment"></span>
00354 <span class="comment">        &lt; Zero - String1 less than String2</span>
00355 <span class="comment"></span>
00356 <span class="comment">        &gt; Zero - String1 greater than String2</span>
00357 <span class="comment"></span>
00358 <span class="comment"></span>
00359 <span class="comment">--*/</span>
00360 
00361 {
00362 
00363     PUCHAR s1, s2, Limit;
00364     LONG n1, n2;
00365     UCHAR c1, c2;
00366 
00367     s1 = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>-&gt;Buffer;
00368     s2 = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>-&gt;Buffer;
00369     n1 = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>-&gt;Length;
00370     n2 = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>-&gt;Length;
00371     Limit = s1 + (n1 &lt;= n2 ? n1 : n2);
00372     <span class="keywordflow">if</span> (CaseInSensitive) {
00373         <span class="keywordflow">while</span> (s1 &lt; Limit) {
00374             c1 = *s1++;
00375             c2 = *s2++;
00376             <span class="keywordflow">if</span> (c1 !=c2) {
00377                 c1 = <a class="code" href="../../d2/d7/string_8c.html#a9">RtlUpperChar</a>(c1);
00378                 c2 = <a class="code" href="../../d2/d7/string_8c.html#a9">RtlUpperChar</a>(c2);
00379                 <span class="keywordflow">if</span> (c1 != c2) {
00380                     <span class="keywordflow">return</span> (LONG)c1 - (LONG)c2;
00381                 }
00382             }
00383         }
00384 
00385     } <span class="keywordflow">else</span> {
00386         <span class="keywordflow">while</span> (s1 &lt; Limit) {
00387             c1 = *s1++;
00388             c2 = *s2++;
00389             <span class="keywordflow">if</span> (c1 != c2) {
00390                 <span class="keywordflow">return</span> (LONG)c1 - (LONG)c2;
00391             }
00392         }
00393     }
00394 
00395     <span class="keywordflow">return</span> n1 - n2;
00396 }
00397 
00398 BOOLEAN
<a name="l00399"></a><a class="code" href="../../d2/d7/string_8c.html#a11">00399</a> <a class="code" href="../../d2/d7/string_8c.html#a11">RtlEqualString</a>(
00400     IN PSTRING String1,
00401     IN PSTRING String2,
00402     IN BOOLEAN CaseInSensitive
00403     )
00404 
00405 <span class="comment">/*++</span>
00406 <span class="comment"></span>
00407 <span class="comment">Routine Description:</span>
00408 <span class="comment"></span>
00409 <span class="comment">    The RtlEqualString function compares two counted strings for equality.</span>
00410 <span class="comment"></span>
00411 <span class="comment">    The CaseInSensitive parameter specifies if case is to be ignored when</span>
00412 <span class="comment">    doing the comparison.</span>
00413 <span class="comment"></span>
00414 <span class="comment">Arguments:</span>
00415 <span class="comment"></span>
00416 <span class="comment">    String1 - Pointer to the first string.</span>
00417 <span class="comment"></span>
00418 <span class="comment">    String2 - Pointer to the second string.</span>
00419 <span class="comment"></span>
00420 <span class="comment">    CaseInsensitive - TRUE if case should be ignored when doing the</span>
00421 <span class="comment">        comparison.</span>
00422 <span class="comment"></span>
00423 <span class="comment">Return Value:</span>
00424 <span class="comment"></span>
00425 <span class="comment">    Boolean value that is TRUE if String1 equals String2 and FALSE otherwise.</span>
00426 <span class="comment"></span>
00427 <span class="comment">--*/</span>
00428 
00429 {
00430 
00431     PUCHAR s1, s2, Limit;
00432     LONG n1, n2;
00433     UCHAR c1, c2;
00434 
00435     n1 = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>-&gt;Length;
00436     n2 = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>-&gt;Length;
00437     <span class="keywordflow">if</span> (n1 == n2) {
00438         s1 = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>-&gt;Buffer;
00439         s2 = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>-&gt;Buffer;
00440         Limit = s1 + n1;
00441         <span class="keywordflow">if</span> (CaseInSensitive) {
00442             <span class="keywordflow">while</span> (s1 &lt; Limit) {
00443                 c1 = *s1++;
00444                 c2 = *s2++;
00445                 <span class="keywordflow">if</span> (c1 != c2) {
00446                     c1 = <a class="code" href="../../d2/d7/string_8c.html#a9">RtlUpperChar</a>(c1);
00447                     c2 = <a class="code" href="../../d2/d7/string_8c.html#a9">RtlUpperChar</a>(c2);
00448                     <span class="keywordflow">if</span> (c1 != c2) {
00449                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00450                     }
00451                 }
00452             }
00453 
00454             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00455 
00456         } <span class="keywordflow">else</span> {
00457             <span class="keywordflow">while</span> (s1 &lt; Limit) {
00458                 c1 = *s1++;
00459                 c2 = *s2++;
00460                 <span class="keywordflow">if</span> (c1 != c2) {
00461                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00462                 }
00463             }
00464 
00465             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00466         }
00467 
00468     } <span class="keywordflow">else</span> {
00469         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00470     }
00471 }
00472 
00473 BOOLEAN
<a name="l00474"></a><a class="code" href="../../d2/d7/string_8c.html#a12">00474</a> <a class="code" href="../../d2/d7/string_8c.html#a12">RtlPrefixString</a>(
00475     IN PSTRING String1,
00476     IN PSTRING String2,
00477     IN BOOLEAN CaseInSensitive
00478     )
00479 
00480 <span class="comment">/*++</span>
00481 <span class="comment"></span>
00482 <span class="comment">Routine Description:</span>
00483 <span class="comment"></span>
00484 <span class="comment">    The RtlPrefixString function determines if the String1 counted string</span>
00485 <span class="comment">    parameter is a prefix of the String2 counted string parameter.</span>
00486 <span class="comment"></span>
00487 <span class="comment">    The CaseInSensitive parameter specifies if case is to be ignored when</span>
00488 <span class="comment">    doing the comparison.</span>
00489 <span class="comment"></span>
00490 <span class="comment">Arguments:</span>
00491 <span class="comment"></span>
00492 <span class="comment">    String1 - Pointer to the first string.</span>
00493 <span class="comment"></span>
00494 <span class="comment">    String2 - Pointer to the second string.</span>
00495 <span class="comment"></span>
00496 <span class="comment">    CaseInsensitive - TRUE if case should be ignored when doing the</span>
00497 <span class="comment">        comparison.</span>
00498 <span class="comment"></span>
00499 <span class="comment">Return Value:</span>
00500 <span class="comment"></span>
00501 <span class="comment">    Boolean value that is TRUE if String1 equals a prefix of String2 and</span>
00502 <span class="comment">    FALSE otherwise.</span>
00503 <span class="comment"></span>
00504 <span class="comment">--*/</span>
00505 
00506 {
00507     PSZ s1, s2;
00508     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
00509     UCHAR c1, c2;
00510 
00511     s1 = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>-&gt;Buffer;
00512     s2 = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>-&gt;Buffer;
00513     <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>-&gt;Length;
00514     <span class="keywordflow">if</span> (<a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>-&gt;Length &lt; <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>) {
00515         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00516         }
00517 
00518     <span class="keywordflow">if</span> (CaseInSensitive) {
00519         <span class="keywordflow">while</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>) {
00520             c1 = *s1++;
00521             c2 = *s2++;
00522 
00523             <span class="keywordflow">if</span> (c1 != c2 &amp;&amp; <a class="code" href="../../d2/d7/string_8c.html#a9">RtlUpperChar</a>(c1) != <a class="code" href="../../d2/d7/string_8c.html#a9">RtlUpperChar</a>(c2)) {
00524                 <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00525                 }
00526 
00527             <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>--;
00528             }
00529         }
00530     <span class="keywordflow">else</span> {
00531         <span class="keywordflow">while</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>) {
00532             <span class="keywordflow">if</span> (*s1++ != *s2++) {
00533                 <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00534                 }
00535 
00536             <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>--;
00537             }
00538         }
00539 
00540     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00541 }
00542 
00543 BOOLEAN
<a name="l00544"></a><a class="code" href="../../d2/d7/string_8c.html#a13">00544</a> <a class="code" href="../../d2/d7/string_8c.html#a13">RtlCreateUnicodeStringFromAsciiz</a>(
00545     OUT PUNICODE_STRING DestinationString,
00546     IN PCSZ SourceString
00547     )
00548 {
00549     ANSI_STRING AnsiString;
00550     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00551 
00552     <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>( &amp;AnsiString, <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a> );
00553     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>( DestinationString, &amp;AnsiString, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00554     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> )) {
00555         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00556         }
00557     <span class="keywordflow">else</span> {
00558         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00559         }
00560 }
00561 
00562 
00563 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00564"></a><a class="code" href="../../d2/d7/string_8c.html#a14">00564</a> <a class="code" href="../../d2/d7/string_8c.html#a14">RtlUpperString</a>(
00565     IN PSTRING DestinationString,
00566     IN PSTRING SourceString
00567     )
00568 
00569 <span class="comment">/*++</span>
00570 <span class="comment"></span>
00571 <span class="comment">Routine Description:</span>
00572 <span class="comment"></span>
00573 <span class="comment">    The RtlUpperString function copies the SourceString to the</span>
00574 <span class="comment">    DestinationString, converting it to upper case.  The MaximumLength</span>
00575 <span class="comment">    and Buffer fields of DestinationString are not modified by this</span>
00576 <span class="comment">    function.</span>
00577 <span class="comment"></span>
00578 <span class="comment">    The number of bytes copied from the SourceString is either the</span>
00579 <span class="comment">    Length of SourceString or the MaximumLength of DestinationString,</span>
00580 <span class="comment">    whichever is smaller.</span>
00581 <span class="comment"></span>
00582 <span class="comment">Arguments:</span>
00583 <span class="comment"></span>
00584 <span class="comment">    DestinationString - Pointer to the destination string.</span>
00585 <span class="comment"></span>
00586 <span class="comment">    SourceString - Pointer to the source string.</span>
00587 <span class="comment"></span>
00588 <span class="comment">Return Value:</span>
00589 <span class="comment"></span>
00590 <span class="comment">    None.</span>
00591 <span class="comment"></span>
00592 <span class="comment">--*/</span>
00593 
00594 {
00595     PSZ src, dst;
00596     ULONG <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
00597 
00598     dst = DestinationString-&gt;Buffer;
00599     src = <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>-&gt;Buffer;
00600     <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>-&gt;Length;
00601     <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> &gt; DestinationString-&gt;MaximumLength) {
00602         <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = DestinationString-&gt;MaximumLength;
00603         }
00604     DestinationString-&gt;Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
00605     <span class="keywordflow">while</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>) {
00606         *dst++ = <a class="code" href="../../d2/d7/string_8c.html#a9">RtlUpperChar</a>(*src++);
00607         <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>--;
00608         }
00609 }
00610 
00611 
00612 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00613"></a><a class="code" href="../../d2/d7/string_8c.html#a15">00613</a> <a class="code" href="../../d2/d7/string_8c.html#a15">RtlAppendAsciizToString</a> (
00614     IN PSTRING Destination,
00615     IN PCSZ Source OPTIONAL
00616     )
00617 
00618 <span class="comment">/*++</span>
00619 <span class="comment"></span>
00620 <span class="comment">Routine Description:</span>
00621 <span class="comment"></span>
00622 <span class="comment">    This routine appends the supplied ASCIIZ string to an existing PSTRING.</span>
00623 <span class="comment"></span>
00624 <span class="comment">    It will copy bytes from the Source PSZ to the destination PSTRING up to</span>
00625 <span class="comment">    the destinations PSTRING-&gt;MaximumLength field.</span>
00626 <span class="comment"></span>
00627 <span class="comment">Arguments:</span>
00628 <span class="comment"></span>
00629 <span class="comment">    IN PSTRING Destination, - Supplies a pointer to the destination string</span>
00630 <span class="comment">    IN PSZ Source - Supplies the string to append to the destination</span>
00631 <span class="comment"></span>
00632 <span class="comment">Return Value:</span>
00633 <span class="comment"></span>
00634 <span class="comment">    STATUS_SUCCESS - The source string was successfully appended to the</span>
00635 <span class="comment">        destination counted string.</span>
00636 <span class="comment"></span>
00637 <span class="comment">    STATUS_BUFFER_TOO_SMALL - The destination string length was not big</span>
00638 <span class="comment">        enough to allow the source string to be appended.  The Destination</span>
00639 <span class="comment">        string length is not updated.</span>
00640 <span class="comment"></span>
00641 <span class="comment">--*/</span>
00642 
00643 {
00644     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
00645 
00646     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( Source )) {
00647         <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>( Source );
00648 
00649         <span class="keywordflow">if</span> ((<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> + Destination-&gt;Length) &gt; Destination-&gt;MaximumLength) {
00650             <span class="keywordflow">return</span>( STATUS_BUFFER_TOO_SMALL );
00651             }
00652 
00653         RtlMoveMemory( &amp;Destination-&gt;Buffer[ Destination-&gt;Length ], Source, <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> );
00654         Destination-&gt;Length += <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
00655         }
00656 
00657     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00658 }
00659 
00660 
00661 
00662 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00663"></a><a class="code" href="../../d2/d7/string_8c.html#a16">00663</a> <a class="code" href="../../d2/d7/string_8c.html#a16">RtlAppendStringToString</a> (
00664     IN PSTRING Destination,
00665     IN PSTRING Source
00666     )
00667 
00668 <span class="comment">/*++</span>
00669 <span class="comment"></span>
00670 <span class="comment">Routine Description:</span>
00671 <span class="comment"></span>
00672 <span class="comment">    This routine will concatinate two PSTRINGs together.  It will copy</span>
00673 <span class="comment">    bytes from the source up to the MaximumLength of the destination.</span>
00674 <span class="comment"></span>
00675 <span class="comment">Arguments:</span>
00676 <span class="comment"></span>
00677 <span class="comment">    IN PSTRING Destination, - Supplies the destination string</span>
00678 <span class="comment">    IN PSTRING Source - Supplies the source for the string copy</span>
00679 <span class="comment"></span>
00680 <span class="comment">Return Value:</span>
00681 <span class="comment"></span>
00682 <span class="comment">    STATUS_SUCCESS - The source string was successfully appended to the</span>
00683 <span class="comment">        destination counted string.</span>
00684 <span class="comment"></span>
00685 <span class="comment">    STATUS_BUFFER_TOO_SMALL - The destination string length was not big</span>
00686 <span class="comment">        enough to allow the source string to be appended.  The Destination</span>
00687 <span class="comment">        string length is not updated.</span>
00688 <span class="comment"></span>
00689 <span class="comment">--*/</span>
00690 
00691 {
00692     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = Source-&gt;Length;
00693 
00694     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>) {
00695         <span class="keywordflow">if</span> ((<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> + Destination-&gt;Length) &gt; Destination-&gt;MaximumLength) {
00696             <span class="keywordflow">return</span>( STATUS_BUFFER_TOO_SMALL );
00697             }
00698 
00699         RtlMoveMemory( &amp;Destination-&gt;Buffer[ Destination-&gt;Length ],
00700                        Source-&gt;Buffer,
00701                        <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>
00702                      );
00703         Destination-&gt;Length += <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
00704         }
00705 
00706     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00707 }
00708 
00709 
00710 <span class="preprocessor">#ifndef i386</span>
00711 <span class="preprocessor"></span>
00712 SIZE_T
00713 NTAPI
<a name="l00714"></a><a class="code" href="../../d2/d7/string_8c.html#a17">00714</a> <a class="code" href="../../d2/d7/string_8c.html#a17">RtlCompareMemoryUlong</a>(
00715     PVOID Source,
00716     SIZE_T Length,
00717     ULONG Pattern
00718     )
00719 
00720 <span class="comment">/*++</span>
00721 <span class="comment"></span>
00722 <span class="comment">Routine Description:</span>
00723 <span class="comment"></span>
00724 <span class="comment">    This function compares two blocks of memory and returns the number</span>
00725 <span class="comment">    of bytes that compared equal.</span>
00726 <span class="comment"></span>
00727 <span class="comment">    N.B. This routine requires that the source address is aligned on a</span>
00728 <span class="comment">         longword boundary and that the length is an even multiple of</span>
00729 <span class="comment">         longwords.</span>
00730 <span class="comment"></span>
00731 <span class="comment">Arguments:</span>
00732 <span class="comment"></span>
00733 <span class="comment">    Source - Supplies a pointer to the block of memory to compare against.</span>
00734 <span class="comment"></span>
00735 <span class="comment">    Length - Supplies the Length, in bytes, of the memory to be</span>
00736 <span class="comment">        compared.</span>
00737 <span class="comment"></span>
00738 <span class="comment">    Pattern - Supplies a 32-bit pattern to compare against the block of</span>
00739 <span class="comment">        memory.</span>
00740 <span class="comment"></span>
00741 <span class="comment">Return Value:</span>
00742 <span class="comment"></span>
00743 <span class="comment">   The number of bytes that compared equal is returned as the function</span>
00744 <span class="comment">   value.  If all bytes compared equal, then the length of the orginal</span>
00745 <span class="comment">   block of memory is returned.  Returns zero if either the Source</span>
00746 <span class="comment">   address is not longword aligned or the length is not a multiple of</span>
00747 <span class="comment">   longwords.</span>
00748 <span class="comment"></span>
00749 <span class="comment">--*/</span>
00750 {
00751     SIZE_T CountLongs;
00752     PULONG p = (PULONG)Source;
00753     PCHAR p1, p2;
00754 
00755     <span class="keywordflow">if</span> (((ULONG_PTR)p &amp; (<span class="keyword">sizeof</span>( ULONG )-1)) ||
00756         (Length &amp; (<span class="keyword">sizeof</span>( ULONG )-1))
00757        ) {
00758         <span class="keywordflow">return</span>( 0 );
00759         }
00760 
00761     CountLongs = Length / <span class="keyword">sizeof</span>( ULONG );
00762     <span class="keywordflow">while</span> (CountLongs--) {
00763         <span class="keywordflow">if</span> (*p++ != <a class="code" href="../../d9/d4/localrtl_8c.html#a2">Pattern</a>) {
00764             p1 = (PCHAR)(p - 1);
00765             p2 = (PCHAR)&amp;<a class="code" href="../../d9/d4/localrtl_8c.html#a2">Pattern</a>;
00766             Length = p1 - (PCHAR)Source;
00767             <span class="keywordflow">while</span> (*p1++ == *p2++) {
00768                 <span class="keywordflow">if</span> (p1 &gt; (PCHAR)p) {
00769                     <span class="keywordflow">break</span>;
00770                     }
00771 
00772                 Length++;
00773                 }
00774             }
00775         }
00776 
00777     <span class="keywordflow">return</span>( Length );
00778 }
00779 
00780 <span class="preprocessor">#endif // ndef i386</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:53 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
