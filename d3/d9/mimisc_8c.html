<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: mimisc.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>mimisc.c File Reference</h1><code>#include "<a class="el" href="../../d5/d7/mi_8h-source.html">mi.h</a>"</code><br>

<p>
<a href="../../d4/d8/mimisc_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d6/struct__CACHE__ATTRIBUTE__DESCRIPTOR.html">_CACHE_ATTRIBUTE_DESCRIPTOR</a></td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d3/d9/mimisc_8c.html#a13">_MEM_TYPES</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d9/mimisc_8c.html#a0">MEM_TYPES</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d6/struct__CACHE__ATTRIBUTE__DESCRIPTOR.html">_CACHE_ATTRIBUTE_DESCRIPTOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d9/mimisc_8c.html#a1">CACHE_ATTRIBUTE_DESCRIPTOR</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d6/struct__CACHE__ATTRIBUTE__DESCRIPTOR.html">_CACHE_ATTRIBUTE_DESCRIPTOR</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d9/mimisc_8c.html#a2">PCACHE_ATTRIBUTE_DESCRIPTOR</a></td></tr>

<tr><td colspan=2><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d9/mimisc_8c.html#a13">_MEM_TYPES</a> { <br>
&nbsp;&nbsp;<a class="el" href="../../d3/d9/mimisc_8c.html#a13a6">RegularMemory</a>, 
<a class="el" href="../../d3/d9/mimisc_8c.html#a13a7">MemoryMappedIo</a>, 
<a class="el" href="../../d3/d9/mimisc_8c.html#a13a8">VideoDisplayBuffer</a>, 
<a class="el" href="../../d3/d9/mimisc_8c.html#a13a9">IoPort</a>, 
<br>
&nbsp;&nbsp;<a class="el" href="../../d3/d9/mimisc_8c.html#a13a10">RomMemory</a>
<br>
 }</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d9/mimisc_8c.html#a11">MiCheckMemoryAttribute</a> (IN PFN_NUMBER PageFrameNumber)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d9/mimisc_8c.html#a12">MiDisableCaching</a> (IN <a class="el" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> PointerPte;)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d9/mimisc_8c.html#a3">MmCacheAttributeDescriptorListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d9/mimisc_8c.html#a4">MmDefaultCacheAttribute</a> = MM_PTE_MA_WBU</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d9/mimisc_8c.html#a5">MmDisableCache</a> [16]</td></tr>

</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a1" doxytag="mimisc.c::CACHE_ATTRIBUTE_DESCRIPTOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d6/struct__CACHE__ATTRIBUTE__DESCRIPTOR.html">_CACHE_ATTRIBUTE_DESCRIPTOR</a>  <a class="el" href="../../d2/d6/struct__CACHE__ATTRIBUTE__DESCRIPTOR.html">CACHE_ATTRIBUTE_DESCRIPTOR</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="mimisc.c::MEM_TYPES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d3/d9/mimisc_8c.html#a13">_MEM_TYPES</a>  <a class="el" href="../../d3/d9/mimisc_8c.html#a0">MEM_TYPES</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="mimisc.c::PCACHE_ATTRIBUTE_DESCRIPTOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d6/struct__CACHE__ATTRIBUTE__DESCRIPTOR.html">_CACHE_ATTRIBUTE_DESCRIPTOR</a> * <a class="el" href="../../d2/d6/struct__CACHE__ATTRIBUTE__DESCRIPTOR.html">PCACHE_ATTRIBUTE_DESCRIPTOR</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="a13" doxytag="mimisc.c::_MEM_TYPES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d3/d9/mimisc_8c.html#a13">_MEM_TYPES</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a13a6" doxytag="RegularMemory" ></a>RegularMemory</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a13a7" doxytag="MemoryMappedIo" ></a>MemoryMappedIo</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a13a8" doxytag="VideoDisplayBuffer" ></a>VideoDisplayBuffer</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a13a9" doxytag="IoPort" ></a>IoPort</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a13a10" doxytag="RomMemory" ></a>RomMemory</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00031">31</a> of file <a class="el" href="../../d4/d8/mimisc_8c-source.html">mimisc.c</a>.
<p>
<pre class="fragment"><div>00031                         {
00032     <a class="code" href="../../d3/d9/mimisc_8c.html#a13a6">RegularMemory</a>,
00033     <a class="code" href="../../d3/d9/mimisc_8c.html#a13a7">MemoryMappedIo</a>,
00034     <a class="code" href="../../d3/d9/mimisc_8c.html#a13a8">VideoDisplayBuffer</a>,
00035     <a class="code" href="../../d3/d9/mimisc_8c.html#a13a9">IoPort</a>,
00036     <a class="code" href="../../d3/d9/mimisc_8c.html#a13a10">RomMemory</a>
00037 } <a class="code" href="../../d3/d9/mimisc_8c.html#a0">MEM_TYPES</a>;
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a11" doxytag="mimisc.c::MiCheckMemoryAttribute" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG MiCheckMemoryAttribute           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PFN_NUMBER&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PageFrameNumber</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00060">60</a> of file <a class="el" href="../../d4/d8/mimisc_8c-source.html">mimisc.c</a>.
<p>
References <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00049">MmCacheAttributeDescriptorListHead</a>, and <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00055">MmDefaultCacheAttribute</a>.
<p>
Referenced by <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00139">MiDisableCaching()</a>.
<p>
<pre class="fragment"><div>00066                   :
00067 
00068     This function examines <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> physical address which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> given 
00069     by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> physical page frame number, and returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cache 
00070     attributes <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <span class="keywordflow">for</span> that page. The returned value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to specify 
00071     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> MemoryAttribute field in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> HARDWARE_PTE structure to map 
00072     that page.
00073      
00074     This function searches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cache descriptor attribute link 
00075     lists to see <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specific cache attribute <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> defined <span class="keywordflow">for</span> 
00076     that physical address range.  
00077 
00078     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> physical address range <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not defined in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cache 
00079     descriptor attribute link lists, returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> memory 
00080     attribute.
00081 
00082 Arguments:
00083 
00084     PageFrameIndex - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> physical page frame number to be
00085                      examined <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cache attribute.
00086 
00087 Return Value: 
00088 
00089     Returns a cache attribute <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied physical page 
00090     frame number. 
00091  
00092 Environment:
00093 
00094     Kernel Mode Only.
00095 
00096 --*/
00097 
00098 {
00099    PLIST_ENTRY NextMd;
00100 
00101    NextMd = <a class="code" href="../../d3/d9/mimisc_8c.html#a3">MmCacheAttributeDescriptorListHead</a>.Flink;
00102 
00103    While (NextMd != MmCacheAttributeDescriptorListHead) {
00104 
00105        CacheAttributeDescriptor = CONTAINING_RECORD(NextMd,
00106                                                      <a class="code" href="../../d2/d6/struct__CACHE__ATTRIBUTE__DESCRIPTOR.html">CACHE_ATTRIBUTE_DESCRIPTOR</a>,
00107                                                      ListEntry);
00108 
00109        <span class="keywordflow">if</span> ((PageFrameNumber &gt;= CacheAttributeDescriptor.BasePage) ||
00110            (PageFrameNumber &lt; CacheAttributeDescriptor.PageCount)) {
00111 
00112            <span class="keywordflow">return</span> (CacheAttributeDescriptor.CacheAttribute);
00113            
00114        }
00115 
00116        NextMd = CacheAttributeDescriptor-&gt;ListEntry.Flink;
00117    }
00118 
00119    <span class="comment">//</span>
00120    <span class="comment">// if the cache memory descriptor is not found, </span>
00121    <span class="comment">// return the default cache attribute, MmDefaultCacheAttribute.</span>
00122    <span class="comment">//</span>
00123           
00124    <span class="keywordflow">return</span> (<a class="code" href="../../d3/d9/mimisc_8c.html#a4">MmDefaultCacheAttribute</a>);
00125 
00126 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="mimisc.c::MiDisableCaching" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> MiDisableCaching           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> PointerPte;&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00139">139</a> of file <a class="el" href="../../d4/d8/mimisc_8c-source.html">mimisc.c</a>.
<p>
References <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00060">MiCheckMemoryAttribute()</a>, and <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00134">MmDisableCache</a>.
<p>
<pre class="fragment"><div>00145                    :
00146 
00147     This macro takes a valid PTE and sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caching state to be
00148     disabled.
00149 
00150 Argments
00151 
00152     PTE - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> valid PTE.
00153   
00154 Return Value:
00155 
00156     None.
00157 
00158 Environment:
00159 
00160     Kernel mode
00161 
00162 --*/
00163 
00164 {
00165     ULONG CacheAttribute;
00166 
00167     CacheAttribute = <a class="code" href="../../d3/d9/mimisc_8c.html#a11">MiCheckMemoryAttribute</a>(TempPte.u.Hard.PageFrameNumber);
00168 
00169     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d9/mimisc_8c.html#a5">MmDisableCache</a>[CacheAttribute]) {
00170         
00171         <span class="comment">//</span>
00172         <span class="comment">// The returned CacheAttributes indicate uncachable.</span>
00173         <span class="comment">//</span>
00174 
00175         PointerPte-&gt;u.Hard.MemAttribute = CacheAttribute;
00176 
00177     } <span class="keywordflow">else</span> {
00178 
00179         <span class="comment">//</span>
00180         <span class="comment">// Set the most conservative cache memory attribute,</span>
00181         <span class="comment">// UCO (Uncachable, Non-coalescing, Sequential &amp; Non-</span>
00182         <span class="comment">// speculative and Ordered.</span>
00183         <span class="comment">//</span>
00184         
00185         PointerPte-&gt;u.Hard.MemAttribute = MM_PTE_MA_UCO;
00186 
00187     }
00188 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a3" doxytag="mimisc.c::MmCacheAttributeDescriptorListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d3/d9/mimisc_8c.html#a3">MmCacheAttributeDescriptorListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00049">49</a> of file <a class="el" href="../../d4/d8/mimisc_8c-source.html">mimisc.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00060">MiCheckMemoryAttribute()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="mimisc.c::MmDefaultCacheAttribute" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d3/d9/mimisc_8c.html#a4">MmDefaultCacheAttribute</a> = MM_PTE_MA_WBU          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00055">55</a> of file <a class="el" href="../../d4/d8/mimisc_8c-source.html">mimisc.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00060">MiCheckMemoryAttribute()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="mimisc.c::MmDisableCache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UCHAR <a class="el" href="../../d3/d9/mimisc_8c.html#a5">MmDisableCache</a>[16]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {0, 0, 0, 0, 0, 0, 0, 0
                           1, 1, 0, 1, 0, 1, 0, 0}
</div></pre>
<p>
Definition at line <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00134">134</a> of file <a class="el" href="../../d4/d8/mimisc_8c-source.html">mimisc.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d8/mimisc_8c-source.html#l00139">MiDisableCaching()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:43 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
