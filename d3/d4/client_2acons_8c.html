<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: client/acons.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>acons.c File Reference</h1><code>#include "<a class="el" href="../../d8/d2/w32_2ntuser_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d4/d3/client_2acons_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d0/struct__ICONFILERESDIR.html">_ICONFILERESDIR</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/struct__HOTSPOTREC.html">_HOTSPOTREC</a></td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d0/struct__ICONFILERESDIR.html">_ICONFILERESDIR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a0">ICONFILERESDIR</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d8/struct__HOTSPOTREC.html">_HOTSPOTREC</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a1">HOTSPOTREC</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d2/structtagCURSORRESOURCE.html">PCURSORRESOURCE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a2">ReadIconGuts</a> (IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a> pfi, IN LPNEWHEADER pnhBase, IN int offResBase, OUT LPWSTR *prt, IN int cxDesired, IN int cyDesired, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LR_flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a3">ReadTag</a> (IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a> pfi, OUT PRTAG ptag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a4">ReadChunk</a> (IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a> pfi, IN PRTAG ptag, OUT PVOID pv)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a5">SkipChunk</a> (IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a> pfi, IN PRTAG ptag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HICON&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a6">CreateAniIcon</a> (LPCWSTR pszName, LPWSTR rt, int cicur, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *aicur, int cpcur, HCURSOR *ahcur, JIF jifRate, PJIF ajifRate, BOOL fPublic)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HCURSOR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a7">ReadIconFromFileMap</a> (IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a> pfi, IN int cbSize, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cxDesired, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cyDesired, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LR_flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HICON&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a8">LoadAniIcon</a> (IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a> pfi, IN LPWSTR rt, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cxDesired, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cyDesired, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LR_flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HCURSOR WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a9">LoadCursorFromFileW</a> (LPCWSTR pszFilename)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HCURSOR WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a10">LoadCursorFromFileA</a> (LPCSTR pszFilename)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a11">ReadFilePtr</a> (IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a> pfi, OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> *ppBuf, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cb)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a12">ReadFilePtrUnaligned</a> (IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a> pfi, OUT VOID UNALIGNED **ppBuf, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cb)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a13">ReadFilePtrCopy</a> (IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a> pfi, IN OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> pBuf, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cb)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a14">LoadCursorIconFromFileMap</a> (IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a> pfi, IN OUT LPWSTR *prt, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cxDesired, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cyDesired, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LR_flags, OUT LPBOOL pfAni)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d2/structtagCURSORRESOURCE.html">PCURSORRESOURCE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a15">ReadIconGuts</a> (IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a> pfi, IN NEWHEADER *pnhBase, IN int offResBase, OUT LPWSTR *prt, IN int cxDesired, IN int cyDesired, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LR_flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HCURSOR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/client_2acons_8c.html#a16">ReadIconFromFileMap</a> (<a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a> pfi, int cbSize, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cxDesired, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cyDesired, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LR_flags)</td></tr>

</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a1" doxytag="client/acons.c::HOTSPOTREC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d8/struct__HOTSPOTREC.html">_HOTSPOTREC</a>  <a class="el" href="../../d4/d8/struct__HOTSPOTREC.html">HOTSPOTREC</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00454">ReadIconGuts()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="client/acons.c::ICONFILERESDIR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d0/struct__ICONFILERESDIR.html">_ICONFILERESDIR</a>  <a class="el" href="../../d0/d0/struct__ICONFILERESDIR.html">ICONFILERESDIR</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a6" doxytag="client/acons.c::CreateAniIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HCURSOR CreateAniIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>rt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cicur</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>aicur</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cpcur</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HCURSOR *&nbsp;</td>
          <td class="mdname" nowrap> <em>ahcur</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>JIF&nbsp;</td>
          <td class="mdname" nowrap> <em>jifRate</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PJIF&nbsp;</td>
          <td class="mdname" nowrap> <em>ajifRate</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fPublic</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00581">581</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d5/d3/kernel_2acons_8c-source.html#l00319">_SetCursorIconData()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02169">CURSOR_ALWAYSDESTROY</a>, <a class="el" href="../../d0/d0/client_2nt6_2user_8h.html#a1070">CURSORDATA</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02176">CURSORF_ACON</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04526">NtUserCallOneParam()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04033">NtUserDestroyCursor()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00411">PTR_TO_ID</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00063">szUSER32</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00958">UserLocalAlloc</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00777">LoadAniIcon()</a>.
<p>
<pre class="fragment"><div>00591 {
00592     HCURSOR hacon;
00593     <a class="code" href="../../d8/d1/structtagCURSORDATA.html">CURSORDATA</a> acon;
00594     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbacon;
00595     HCURSOR *ahcurT;             <span class="comment">// Array of image frame pointers</span>
00596     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *aicurT;               <span class="comment">// Array of frame indices (sequence table)</span>
00597     PJIF ajifRateT;              <span class="comment">// Array of time offsets</span>
00598     <span class="keywordtype">int</span> i;
00599 
00600     <span class="comment">/*</span>
00601 <span class="comment">     * Start by allocating space for the ACON structure and the ahcur and</span>
00602 <span class="comment">     * ajifRate arrays.</span>
00603 <span class="comment">     */</span>
00604     hacon = (HCURSOR)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a174">NtUserCallOneParam</a>(fPublic,
00605                                         SFI__CREATEEMPTYCURSOROBJECT);
00606     <span class="keywordflow">if</span> (hacon == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00607         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00608 
00609     <span class="comment">/*</span>
00610 <span class="comment">     * Save a couple LocalAlloc calls by allocating the memory needed for</span>
00611 <span class="comment">     * the CURSOR, JIF, and SEQ arrays at once.</span>
00612 <span class="comment">     */</span>
00613     RtlZeroMemory(&amp;acon, <span class="keyword">sizeof</span>(acon));
00614     cbacon = (cpcur * <span class="keyword">sizeof</span>(HCURSOR)) +
00615             (cicur * <span class="keyword">sizeof</span>(JIF)) + (cicur * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>));
00616     ahcurT = (HCURSOR *)<a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(HEAP_ZERO_MEMORY, cbacon);
00617     <span class="keywordflow">if</span> (ahcurT == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00618         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a156">NtUserDestroyCursor</a>((HCURSOR)hacon, CURSOR_ALWAYSDESTROY);
00619         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00620     }
00621     acon.<a class="code" href="../../d8/d1/structtagCURSORDATA.html#o14">aspcur</a> = (<a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> *)ahcurT;
00622 
00623     <span class="comment">/*</span>
00624 <span class="comment">     * Set up work pointers</span>
00625 <span class="comment">     */</span>
00626     ajifRateT = (PJIF)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)ahcurT + (cpcur * <span class="keyword">sizeof</span>(HCURSOR)));
00627     aicurT = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)ajifRateT + (cicur * <span class="keyword">sizeof</span>(JIF)));
00628 
00629     <span class="comment">/*</span>
00630 <span class="comment">     * Save offsets to arrays to make copying them to the server</span>
00631 <span class="comment">     * easier.</span>
00632 <span class="comment">     */</span>
00633     acon.<a class="code" href="../../d8/d1/structtagCURSORDATA.html#o16">ajifRate</a> = (PJIF)(cpcur * <span class="keyword">sizeof</span>(HCURSOR));
00634     acon.<a class="code" href="../../d8/d1/structtagCURSORDATA.html#o15">aicur</a> = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)acon.<a class="code" href="../../d8/d1/structtagCURSORDATA.html#o16">ajifRate</a> + (cicur * <span class="keyword">sizeof</span>(JIF)));
00635 
00636     acon.<a class="code" href="../../d8/d1/structtagCURSORDATA.html#o12">cpcur</a> = cpcur;
00637     acon.<a class="code" href="../../d8/d1/structtagCURSORDATA.html#o13">cicur</a> = cicur;
00638 
00639     acon.<a class="code" href="../../d8/d1/structtagCURSORDATA.html#o0">CURSORF_flags</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a537">CURSORF_ACON</a>;
00640 
00641     <span class="comment">/*</span>
00642 <span class="comment">     * Store this information away so we can identify</span>
00643 <span class="comment">     * repeated calls to LoadCursor/Icon for the same</span>
00644 <span class="comment">     * resource type/id.</span>
00645 <span class="comment">     */</span>
00646     acon.<a class="code" href="../../d8/d1/structtagCURSORDATA.html#o3">rt</a> = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(rt);
00647     acon.<a class="code" href="../../d8/d1/structtagCURSORDATA.html#o2">lpModName</a> = <a class="code" href="../../d1/d8/clglobal_8c.html#a12">szUSER32</a>;
00648     acon.<a class="code" href="../../d8/d1/structtagCURSORDATA.html#o1">lpName</a> = (LPWSTR)pszName;
00649 
00650     <span class="comment">/*</span>
00651 <span class="comment">     * Make a private copy of the cursor pointers and the animation rate table.</span>
00652 <span class="comment">     */</span>
00653     <span class="keywordflow">for</span> (i = 0; i &lt; cpcur; i++) {
00654         ahcurT[i] = ahcur[i];
00655 <span class="comment">//        ahcurT[i]-&gt;fPointer |= PTRI_ANIMATED;   // if GDI needs it</span>
00656 
00657     }
00658 
00659     <span class="keywordflow">for</span> (i = 0; i &lt; cicur; i++) {
00660 
00661         <span class="comment">/*</span>
00662 <span class="comment">         * If constant rate, initialize the rate table to a single value.</span>
00663 <span class="comment">         */</span>
00664         <span class="keywordflow">if</span> (ajifRate == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00665             ajifRateT[i] = jifRate;
00666         <span class="keywordflow">else</span>
00667             ajifRateT[i] = ajifRate[i];
00668 
00669         <span class="comment">/*</span>
00670 <span class="comment">         * If no sequence table then build a unity map to the cursor table.</span>
00671 <span class="comment">         */</span>
00672         <span class="keywordflow">if</span> (aicur == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00673             aicurT[i] = i;
00674         <span class="keywordflow">else</span>
00675             aicurT[i] = aicur[i];
00676     }
00677 
00678     <span class="comment">/*</span>
00679 <span class="comment">     * Stuff acon data into the cursor</span>
00680 <span class="comment">     */</span>
00681     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1114">_SetCursorIconData</a>(hacon, &amp;acon)) {
00682         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a156">NtUserDestroyCursor</a>(hacon, CURSOR_ALWAYSDESTROY);
00683         hacon = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00684     }
00685     <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(ahcurT);
00686 
00687     <span class="keywordflow">return</span> hacon;
00688 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="client/acons.c::LoadAniIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HICON LoadAniIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pfi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>rt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cxDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cyDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LR_flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00777">777</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00581">CreateAniIcon()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02169">CURSOR_ALWAYSDESTROY</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04033">NtUserDestroyCursor()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00222">ReadChunk()</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00187">ReadFilePtrCopy()</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00700">ReadIconFromFileMap()</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00211">ReadTag()</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00245">SkipChunk()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00958">UserLocalAlloc</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00279">LoadCursorIconFromFileMap()</a>.
<p>
<pre class="fragment"><div>00783 {
00784     <span class="keywordtype">int</span> cpcur, ipcur = 0, i, cicur;
00785     ANIHEADER anih;
00786     ANIHEADER *panih = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00787     HICON hacon = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00788     HCURSOR *phcur;
00789     JIF jifRate, *pjifRate;
00790     RTAG tag;
00791     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *picur;
00792 
00793     <span class="comment">/*</span>
00794 <span class="comment">     * Position to the beginning of the file.</span>
00795 <span class="comment">     */</span>
00796     pfi-&gt;pFilePtr = pfi-&gt;pFileMap + <span class="keyword">sizeof</span>(tag);
00797 
00798 <span class="preprocessor">#if DBG</span>
00799 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((ULONG_PTR)pfi-&gt;pFileEnd != ((ULONG_PTR)(pfi-&gt;pFileMap + <span class="keyword">sizeof</span> (RTAG) + ((RTAG *)(pfi-&gt;pFileMap))-&gt;ckSize + 1) &amp; ~1)) {
00800         RIPMSG2(RIP_WARNING, <span class="stringliteral">"LoadAniIcon: First RIFF chunk has invalid ckSize. Actual:%#lx Expected:%#lx"</span>,
00801                 ((RTAG *)(pfi-&gt;pFileMap))-&gt;ckSize, (pfi-&gt;pFileEnd - pfi-&gt;pFileMap - <span class="keyword">sizeof</span>(RTAG)) &amp; ~1);
00802     }
00803 <span class="preprocessor">#endif</span>
00804 <span class="preprocessor"></span>
00805     <span class="comment">/* read the chunk type */</span>
00806     <span class="keywordflow">if</span>(!<a class="code" href="../../d3/d4/client_2acons_8c.html#a13">ReadFilePtrCopy</a>(pfi,
00807                         &amp;tag.ckID,
00808                         <span class="keyword">sizeof</span>(tag.ckID))) {
00809         <span class="keywordflow">goto</span> laiFileErr;
00810     }
00811 
00812     <span class="keywordflow">if</span> (tag.ckID != FOURCC_ACON)
00813         <span class="keywordflow">goto</span> laiFileErr;
00814 
00815     <span class="comment">/* look for 'anih', 'rate', 'seq ', and 'icon' chunks */</span>
00816     <span class="keywordflow">while</span>( <a class="code" href="../../d3/d4/client_2acons_8c.html#a3">ReadTag</a>(pfi, &amp;tag)) {
00817 
00818         <span class="keywordflow">switch</span>( tag.ckID ) {
00819         <span class="keywordflow">case</span> FOURCC_anih:
00820             <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d4/client_2acons_8c.html#a4">ReadChunk</a>(pfi, &amp;tag, &amp;anih))
00821                 <span class="keywordflow">goto</span> laiFileErr;
00822 
00823             <span class="keywordflow">if</span> (!(anih.fl &amp; AF_ICON) || (anih.cFrames == 0))
00824                 <span class="keywordflow">goto</span> laiFileErr;
00825 
00826             <span class="comment">/*</span>
00827 <span class="comment">             * Allocate space for the ANIHEADER, HCURSOR array and a</span>
00828 <span class="comment">             * rate table (in case we run into one later).</span>
00829 <span class="comment">             */</span>
00830             cpcur = anih.cFrames;
00831             cicur = anih.cSteps;
00832             panih = (PANIHEADER)<a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(HEAP_ZERO_MEMORY, <span class="keyword">sizeof</span>(ANIHEADER) +
00833                     (cicur * <span class="keyword">sizeof</span>(JIF)) + (cpcur * <span class="keyword">sizeof</span>(HCURSOR)) +
00834                     (cicur * <span class="keyword">sizeof</span>(DWORD)));
00835 
00836             <span class="keywordflow">if</span> (panih == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00837                 <span class="keywordflow">goto</span> laiFileErr;
00838 
00839 
00840             phcur = (HCURSOR *)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)panih + <span class="keyword">sizeof</span>(ANIHEADER));
00841             pjifRate = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00842             picur = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00843 
00844             *panih = anih;
00845             jifRate = panih-&gt;jifRate;
00846             <span class="keywordflow">break</span>;
00847 
00848 
00849         <span class="keywordflow">case</span> FOURCC_rate:
00850             <span class="comment">/*</span>
00851 <span class="comment">             * If we find a rate chunk, read it into its preallocated</span>
00852 <span class="comment">             * space.</span>
00853 <span class="comment">             */</span>
00854             pjifRate = (PJIF)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)phcur + cpcur * <span class="keyword">sizeof</span>(HCURSOR));
00855             <span class="keywordflow">if</span>(!<a class="code" href="../../d3/d4/client_2acons_8c.html#a4">ReadChunk</a>(pfi, &amp;tag, (PBYTE)pjifRate))
00856                 <span class="keywordflow">goto</span> laiFileErr;
00857             <span class="keywordflow">break</span>;
00858 
00859 
00860         <span class="keywordflow">case</span> FOURCC_seq:
00861             <span class="comment">/*</span>
00862 <span class="comment">             * If we find a seq chunk, read it into its preallocated</span>
00863 <span class="comment">             * space.</span>
00864 <span class="comment">             */</span>
00865             picur = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)phcur + cpcur * <span class="keyword">sizeof</span>(HCURSOR) +
00866                     cicur * <span class="keyword">sizeof</span>(JIF));
00867             <span class="keywordflow">if</span>(!<a class="code" href="../../d3/d4/client_2acons_8c.html#a4">ReadChunk</a>(pfi, &amp;tag, (PBYTE)picur))
00868                 <span class="keywordflow">goto</span> laiFileErr;
00869             <span class="keywordflow">break</span>;
00870 
00871 
00872         <span class="keywordflow">case</span> FOURCC_LIST:
00873             {
00874                 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbChunk = (tag.ckSize + 1) &amp; ~1;
00875 
00876                 <span class="comment">/*</span>
00877 <span class="comment">                 * See if this list is the 'fram' list of icon chunks</span>
00878 <span class="comment">                 */</span>
00879                 <span class="keywordflow">if</span>(!<a class="code" href="../../d3/d4/client_2acons_8c.html#a13">ReadFilePtrCopy</a>(pfi, &amp;tag.ckID, <span class="keyword">sizeof</span>(tag.ckID))) {
00880                     <span class="keywordflow">goto</span> laiFileErr;
00881                 }
00882 
00883                 cbChunk -= <span class="keyword">sizeof</span>(tag.ckID);
00884 
00885                 <span class="keywordflow">if</span> (tag.ckID != FOURCC_fram) {
00886                     <span class="comment">/*</span>
00887 <span class="comment">                     * Not the fram list (probably the INFO list).  Skip</span>
00888 <span class="comment">                     * the rest of this chunk.  (Don't forget that we have</span>
00889 <span class="comment">                     * already skipped one dword!)</span>
00890 <span class="comment">                     */</span>
00891                     tag.ckSize = cbChunk;
00892                     <a class="code" href="../../d3/d4/client_2acons_8c.html#a5">SkipChunk</a>(pfi, &amp;tag);
00893                     <span class="keywordflow">break</span>;
00894                 }
00895 
00896                 <span class="keywordflow">while</span>(cbChunk &gt;= <span class="keyword">sizeof</span>(tag)) {
00897                     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d4/client_2acons_8c.html#a3">ReadTag</a>(pfi, &amp;tag))
00898                         <span class="keywordflow">goto</span> laiFileErr;
00899 
00900                     cbChunk -= <span class="keyword">sizeof</span>(tag);
00901 
00902                     <span class="keywordflow">if</span>(tag.ckID == FOURCC_icon) {
00903 
00904                         <span class="comment">/*</span>
00905 <span class="comment">                         * Ok, load the icon/cursor bits, create a cursor from</span>
00906 <span class="comment">                         * them, and save a pointer to it away in the ACON</span>
00907 <span class="comment">                         * cursor pointer array.</span>
00908 <span class="comment">                         */</span>
00909                         phcur[ipcur] = <a class="code" href="../../d3/d4/client_2acons_8c.html#a16">ReadIconFromFileMap</a>(pfi,
00910                                                            tag.ckSize,
00911                                                            cxDesired,
00912                                                            cyDesired,
00913                                                            LR_flags);
00914 
00915                         <span class="keywordflow">if</span> (phcur[ipcur] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00916                             <span class="keywordflow">for</span> (i = 0; i &lt; ipcur; i++)
00917                                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a156">NtUserDestroyCursor</a>(phcur[i], 0);
00918                             <span class="keywordflow">goto</span> laiFileErr;
00919                         }
00920 
00921                         ipcur++;
00922                     } <span class="keywordflow">else</span> {
00923                         <span class="comment">/*</span>
00924 <span class="comment">                         * Unknown chunk in fram list, just ignore it</span>
00925 <span class="comment">                         */</span>
00926                         <a class="code" href="../../d3/d4/client_2acons_8c.html#a5">SkipChunk</a>(pfi, &amp;tag);
00927                     }
00928 
00929                     cbChunk -= (tag.ckSize + 1) &amp; ~1;
00930                 }
00931             }
00932             <span class="keywordflow">break</span>;
00933 
00934         <span class="keywordflow">default</span>:
00935             <span class="comment">/*</span>
00936 <span class="comment">             * We're not interested in this chunk, skip it.</span>
00937 <span class="comment">             */</span>
00938             <span class="keywordflow">if</span>(!<a class="code" href="../../d3/d4/client_2acons_8c.html#a5">SkipChunk</a>(pfi, &amp;tag))
00939                 <span class="keywordflow">goto</span> laiFileErr;
00940             <span class="keywordflow">break</span>;
00941 
00942         }
00943 
00944     }
00945 
00946     <span class="comment">/*</span>
00947 <span class="comment">     * Sanity check the count of frames so we won't fault trying</span>
00948 <span class="comment">     * to select a nonexistant cursor</span>
00949 <span class="comment">     */</span>
00950     <span class="keywordflow">if</span> (cpcur != ipcur) {
00951         RIPMSG2(RIP_WARNING, <span class="stringliteral">"LoadAniIcon: Invalid number of frames; Actual:%#lx Expected:%#lx"</span>,
00952                 ipcur, cpcur);
00953         <span class="keywordflow">for</span> (i = 0; i &lt; ipcur; i++)
00954             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a156">NtUserDestroyCursor</a>(phcur[i], CURSOR_ALWAYSDESTROY);
00955         <span class="keywordflow">goto</span> laiFileErr;
00956     }
00957 
00958 
00959 
00960     <span class="keywordflow">if</span> (cpcur != 0)
00961         hacon = <a class="code" href="../../d3/d4/client_2acons_8c.html#a6">CreateAniIcon</a>(pfi-&gt;pszName,
00962                               rt,
00963                               cicur,
00964                               picur,
00965                               cpcur,
00966                               phcur,
00967                               jifRate,
00968                               pjifRate,
00969                               LR_flags &amp; LR_GLOBAL);
00970 
00971 laiFileErr:
00972 
00973 <span class="preprocessor">#if DBG</span>
00974 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (hacon == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00975         RIPMSG0(RIP_WARNING, <span class="stringliteral">"LoadAniIcon: Invalid icon data format"</span>);
00976     }
00977 <span class="preprocessor">#endif</span>
00978 <span class="preprocessor"></span>
00979     <span class="keywordflow">if</span> (panih != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00980         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(panih);
00981 
00982     <span class="keywordflow">return</span> hacon;
00983 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="client/acons.c::LoadCursorFromFileA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HCURSOR WINAPI LoadCursorFromFileA           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPCSTR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pszFilename</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00117">117</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00096">LoadCursorFromFileW()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>.
<p>
<pre class="fragment"><div>00119 {
00120     LPWSTR lpUniName;
00121     HCURSOR hcur;
00122 
00123     <span class="keywordflow">if</span> (pszFilename == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00124             !MBToWCS(pszFilename, -1, &amp;lpUniName, -1, TRUE))
00125         <span class="keywordflow">return</span> (HANDLE)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00126 
00127     hcur = <a class="code" href="../../d3/d4/client_2acons_8c.html#a9">LoadCursorFromFileW</a>(lpUniName);
00128 
00129     <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(lpUniName);
00130 
00131     <span class="keywordflow">return</span> hcur;
00132 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="client/acons.c::LoadCursorFromFileW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HCURSOR WINAPI LoadCursorFromFileW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPCWSTR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pszFilename</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00096">96</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00117">LoadCursorFromFileA()</a>.
<p>
<pre class="fragment"><div>00098 {
00099     <span class="keywordflow">return</span>(LoadImage(NULL,
00100                      pszFilename,
00101                      IMAGE_CURSOR,
00102                      0,
00103                      0,
00104                      LR_DEFAULTSIZE | LR_LOADFROMFILE));
00105 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="client/acons.c::LoadCursorIconFromFileMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE LoadCursorIconFromFileMap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pfi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT LPWSTR *&nbsp;</td>
          <td class="mdname" nowrap> <em>prt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cxDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cyDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LR_flags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPBOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>pfAni</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00279">279</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d8/clres_8c-source.html#l03344">ConvertDIBIcon()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00777">LoadAniIcon()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00222">ReadChunk()</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00145">ReadFilePtr()</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00454">ReadIconGuts()</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00211">ReadTag()</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00245">SkipChunk()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/clres_8c-source.html#l01573">LoadCursorIconFromResource()</a>, and <a class="el" href="../../d4/d1/rtlres_8c-source.html#l00142">RtlLoadObjectFromDIBFile()</a>.
<p>
<pre class="fragment"><div>00286 {
00287     LPNEWHEADER pnh;
00288     <span class="keywordtype">int</span> offResBase;
00289 
00290     *pfAni = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00291     offResBase = 0;
00292 
00293     <span class="comment">/*</span>
00294 <span class="comment">     * Determine if this is an .ICO/.CUR file or an .ANI file.</span>
00295 <span class="comment">     */</span>
00296     pnh = (LPNEWHEADER)pfi-&gt;pFileMap;
00297     <span class="keywordflow">if</span> (*(LPDWORD)pnh == FOURCC_RIFF) {
00298 
00299         RTAG tag;
00300 
00301         <span class="comment">/*</span>
00302 <span class="comment">         * It's an ANICURSOR!</span>
00303 <span class="comment">         * Seek back to beginning + 1 tag.</span>
00304 <span class="comment">         */</span>
00305         pfi-&gt;pFilePtr = pfi-&gt;pFileMap + <span class="keyword">sizeof</span>(tag);
00306 
00307         <span class="comment">/* check RIFF type for ACON */</span>
00308         <span class="keywordflow">if</span> (*(LPDWORD)pfi-&gt;pFilePtr != FOURCC_ACON) {
00309             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00310         }
00311         pfi-&gt;pFilePtr += <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
00312         <span class="keywordflow">if</span> (pfi-&gt;pFilePtr &gt; pfi-&gt;pFileEnd) {
00313             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00314         }
00315 
00316         <span class="comment">/*</span>
00317 <span class="comment">         * Ok, we have a ACON chunk.  Find the first ICON chunk and set</span>
00318 <span class="comment">         * things up so it looks we've just loaded the header of a normal</span>
00319 <span class="comment">         * .CUR file, then fall into the .CUR bits handling code below.</span>
00320 <span class="comment">         */</span>
00321         <span class="keywordflow">while</span> (<a class="code" href="../../d3/d4/client_2acons_8c.html#a3">ReadTag</a>(pfi, &amp;tag)) {
00322             <span class="comment">/*</span>
00323 <span class="comment">             * Handle each chunk type.</span>
00324 <span class="comment">             */</span>
00325             <span class="keywordflow">if</span> (tag.ckID == FOURCC_anih) {
00326 
00327                 ANIHEADER anih;
00328 
00329                 <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d4/client_2acons_8c.html#a4">ReadChunk</a>(pfi, &amp;tag, &amp;anih)) {
00330                     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00331                 }
00332 
00333                 <span class="keywordflow">if</span> (!(anih.fl &amp; AF_ICON) || (anih.cFrames == 0)) {
00334                     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00335                 }
00336 
00337                 <span class="comment">// If this ACON has more than one frame then go ahead</span>
00338                 <span class="comment">// and create an ACON, otherwise just use the first</span>
00339                 <span class="comment">// frame to create a normal ICON/CURSOR.</span>
00340 
00341                 <span class="keywordflow">if</span> (anih.cFrames &gt; 1) {
00342 
00343                     *pfAni = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00344                     *prt = RT_CURSOR;
00345                     <span class="keywordflow">return</span>(<a class="code" href="../../d3/d4/client_2acons_8c.html#a8">LoadAniIcon</a>(pfi,
00346                                        RT_CURSOR,
00347                                        cxDesired,
00348                                        cyDesired,
00349                                        LR_flags));
00350                 }
00351 
00352             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tag.ckID == FOURCC_LIST) {
00353                 LPDWORD pdwType = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00354                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fOK = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00355                 <span class="comment">/*</span>
00356 <span class="comment">                 * If this is the fram list, then get the first icon out of it</span>
00357 <span class="comment">                 */</span>
00358 
00359                 <span class="comment">/* check LIST type for fram */</span>
00360 
00361                 <span class="keywordflow">if</span>( tag.ckSize &gt;= <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) &amp;&amp;
00362                         (fOK = <a class="code" href="../../d3/d4/client_2acons_8c.html#a11">ReadFilePtr</a>( pfi,
00363                                             &amp;pdwType,
00364                                             <span class="keyword">sizeof</span>(DWORD))) &amp;&amp;
00365                         *pdwType == FOURCC_fram) {
00366 
00367                     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d4/client_2acons_8c.html#a3">ReadTag</a>(pfi, &amp;tag)) {
00368                         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00369                     }
00370 
00371                     <span class="keywordflow">if</span> (tag.ckID == FOURCC_icon) {
00372                         <span class="comment">/*</span>
00373 <span class="comment">                         * We've found what we're looking for.  Get current position</span>
00374 <span class="comment">                         * in file to be used as the base from which the icon data</span>
00375 <span class="comment">                         * offsets are offset from.</span>
00376 <span class="comment">                         */</span>
00377                         offResBase = (<span class="keywordtype">int</span>)(pfi-&gt;pFilePtr - pfi-&gt;pFileMap);
00378 
00379                         <span class="comment">/*</span>
00380 <span class="comment">                         * Grab the header first, since the following code assumes</span>
00381 <span class="comment">                         * it was read above.</span>
00382 <span class="comment">                         */</span>
00383                         <a class="code" href="../../d3/d4/client_2acons_8c.html#a11">ReadFilePtr</a>(pfi, &amp;pnh, <span class="keyword">sizeof</span>(NEWHEADER));
00384 
00385                         <span class="comment">/*</span>
00386 <span class="comment">                         * Break out and let the icon loading/cursor creating code</span>
00387 <span class="comment">                         * take it from here.</span>
00388 <span class="comment">                         */</span>
00389                         <span class="keywordflow">break</span>;
00390                     } <span class="keywordflow">else</span> {
00391                         <a class="code" href="../../d3/d4/client_2acons_8c.html#a5">SkipChunk</a>(pfi, &amp;tag);
00392                     }
00393                 } <span class="keywordflow">else</span> {
00394                     <span class="comment">/*</span>
00395 <span class="comment">                     * Something bad happened in the type read, if it was</span>
00396 <span class="comment">                     * a file error then close and exit, otherwise just</span>
00397 <span class="comment">                     * skip the rest of the chunk</span>
00398 <span class="comment">                     */</span>
00399                     <span class="keywordflow">if</span>(!fOK) {
00400                         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00401                     }
00402                     <span class="comment">/*</span>
00403 <span class="comment">                     * take the type we just read out of the tag size and</span>
00404 <span class="comment">                     * skip the rest</span>
00405 <span class="comment">                     */</span>
00406                     tag.ckSize -= <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
00407                     <a class="code" href="../../d3/d4/client_2acons_8c.html#a5">SkipChunk</a>(pfi, &amp;tag);
00408                 }
00409             } <span class="keywordflow">else</span> {
00410                 <span class="comment">/*</span>
00411 <span class="comment">                 * We're not interested in this chunk, skip it.</span>
00412 <span class="comment">                 */</span>
00413                 <a class="code" href="../../d3/d4/client_2acons_8c.html#a5">SkipChunk</a>(pfi, &amp;tag);
00414             }
00415         }
00416     } <span class="keywordflow">else</span> { <span class="comment">// not a RIFF file.</span>
00417         <span class="keywordflow">if</span> ((pnh-&gt;ResType != FT_ICON) &amp;&amp; (pnh-&gt;ResType != FT_CURSOR)) {
00418             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00419         }
00420     }
00421     {
00422         <a class="code" href="../../d0/d2/structtagCURSORRESOURCE.html">PCURSORRESOURCE</a> pcres;
00423 
00424         pcres = <a class="code" href="../../d3/d4/client_2acons_8c.html#a15">ReadIconGuts</a>(pfi,
00425                              pnh,
00426                              offResBase,
00427                              prt,
00428                              cxDesired,
00429                              cyDesired,
00430                              LR_flags);
00431 
00432         <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a660">ConvertDIBIcon</a>((LPBITMAPINFOHEADER)pcres,
00433                               NULL,
00434                               pfi-&gt;pszName,
00435                               *prt == RT_ICON,
00436                               cxDesired,
00437                               cyDesired,
00438                               LR_flags);
00439     }
00440 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="client/acons.c::ReadChunk" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ReadChunk           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pfi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PRTAG&nbsp;</td>
          <td class="mdname" nowrap> <em>ptag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>pv</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00222">222</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00187">ReadFilePtrCopy()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00777">LoadAniIcon()</a>, and <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00279">LoadCursorIconFromFileMap()</a>.
<p>
<pre class="fragment"><div>00226 {
00227     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d4/client_2acons_8c.html#a13">ReadFilePtrCopy</a>(pfi, pv, ptag-&gt;ckSize))
00228         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00229 
00230     <span class="comment">/* WORD align file pointer */</span>
00231     <span class="keywordflow">if</span>( ptag-&gt;ckSize &amp; 1 )
00232         pfi-&gt;pFilePtr++;
00233 
00234 
00235     <span class="keywordflow">if</span> (pfi-&gt;pFilePtr &lt;= pfi-&gt;pFileEnd) {
00236         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00237     } <span class="keywordflow">else</span> {
00238         RIPMSG0(RIP_WARNING, <span class="stringliteral">"ReadChunk: Advanced pointer past end of file map"</span>);
00239         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00240     }
00241 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="client/acons.c::ReadFilePtr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ReadFilePtr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pfi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppBuf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cb</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00145">145</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00279">LoadCursorIconFromFileMap()</a>, and <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00700">ReadIconFromFileMap()</a>.
<p>
<pre class="fragment"><div>00149 {
00150     *ppBuf = pfi-&gt;pFilePtr;
00151     pfi-&gt;pFilePtr += cb;
00152     <span class="keywordflow">return</span> (pfi-&gt;pFilePtr &lt;= pfi-&gt;pFileEnd);
00153 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="client/acons.c::ReadFilePtrCopy" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ReadFilePtrCopy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pfi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pBuf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cb</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00187">187</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00777">LoadAniIcon()</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00222">ReadChunk()</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00454">ReadIconGuts()</a>, and <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00211">ReadTag()</a>.
<p>
<pre class="fragment"><div>00191 {
00192     <span class="keywordflow">if</span> (pfi-&gt;pFilePtr + cb &gt; pfi-&gt;pFileEnd) {
00193         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00194     }
00195     RtlCopyMemory(pBuf, pfi-&gt;pFilePtr, cb);
00196     pfi-&gt;pFilePtr += cb;
00197     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00198 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="client/acons.c::ReadFilePtrUnaligned" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ReadFilePtrUnaligned           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pfi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT VOID UNALIGNED **&nbsp;</td>
          <td class="mdname" nowrap> <em>ppBuf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cb</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00166">166</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00454">ReadIconGuts()</a>.
<p>
<pre class="fragment"><div>00170 {
00171     *ppBuf = pfi-&gt;pFilePtr;
00172     pfi-&gt;pFilePtr += cb;
00173     <span class="keywordflow">return</span> (pfi-&gt;pFilePtr &lt;= pfi-&gt;pFileEnd);
00174 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="client/acons.c::ReadIconFromFileMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HCURSOR ReadIconFromFileMap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pfi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cbSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cxDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cyDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LR_flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00700">700</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d5/d8/clres_8c-source.html#l03344">ConvertDIBIcon()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01633">_FILEINFO::pFileMap</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01634">_FILEINFO::pFilePtr</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00145">ReadFilePtr()</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00454">ReadIconGuts()</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00777">LoadAniIcon()</a>.
<p>
<pre class="fragment"><div>00706 {
00707     <a class="code" href="../../d0/d2/structtagCURSORRESOURCE.html">PCURSORRESOURCE</a> pcres;
00708     HCURSOR         hcur = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00709     LPNEWHEADER     pnh;
00710     <span class="keywordtype">int</span>             offResBase;
00711     LPWSTR          rt;
00712 
00713     <span class="comment">/*</span>
00714 <span class="comment">     * Get current position in file to be used as the base from which</span>
00715 <span class="comment">     * the icon data offsets are offset from.</span>
00716 <span class="comment">     */</span>
00717     offResBase = (<span class="keywordtype">int</span>)(pfi-&gt;<a class="code" href="../../d1/d2/struct__FILEINFO.html#o1">pFilePtr</a> - pfi-&gt;<a class="code" href="../../d1/d2/struct__FILEINFO.html#o0">pFileMap</a>);
00718 
00719     <span class="comment">/*</span>
00720 <span class="comment">     * Read the .ICO/.CUR data's header.</span>
00721 <span class="comment">     */</span>
00722     <a class="code" href="../../d3/d4/client_2acons_8c.html#a11">ReadFilePtr</a>(pfi, &amp;pnh, <span class="keyword">sizeof</span>(NEWHEADER));
00723 
00724     pcres = <a class="code" href="../../d3/d4/client_2acons_8c.html#a15">ReadIconGuts</a>(pfi,
00725                          pnh,
00726                          offResBase,
00727                          &amp;rt,
00728                          cxDesired,
00729                          cyDesired,
00730                          LR_flags);
00731 
00732     <span class="keywordflow">if</span> (pcres != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00733         hcur = (HCURSOR)<a class="code" href="../../d6/d0/usercli_8h.html#a660">ConvertDIBIcon</a>((LPBITMAPINFOHEADER)pcres,
00734                                        NULL,
00735                                        NULL,
00736                                        (rt == RT_ICON),
00737                                        cxDesired,
00738                                        cyDesired,
00739                                        LR_ACONFRAME | LR_flags);
00740 
00741         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pcres);
00742     }
00743 
00744     <span class="comment">/*</span>
00745 <span class="comment">     * Seek to the end of this chunk, regardless of our current position.</span>
00746 <span class="comment">     */</span>
00747     pfi-&gt;<a class="code" href="../../d1/d2/struct__FILEINFO.html#o1">pFilePtr</a> = pfi-&gt;<a class="code" href="../../d1/d2/struct__FILEINFO.html#o0">pFileMap</a> + ((offResBase + cbSize + 1) &amp; (~1));
00748 
00749     <span class="keywordflow">return</span> hcur;
00750 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="client/acons.c::ReadIconFromFileMap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HCURSOR ReadIconFromFileMap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pfi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>cbSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cxDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cyDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LR_flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="client/acons.c::ReadIconGuts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d2/structtagCURSORRESOURCE.html">PCURSORRESOURCE</a> ReadIconGuts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pfi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN NEWHEADER *&nbsp;</td>
          <td class="mdname" nowrap> <em>pnhBase</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>offResBase</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR *&nbsp;</td>
          <td class="mdname" nowrap> <em>prt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>cxDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>cyDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LR_flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00454">454</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00882">tagCURSORRESOURCE::bih</a>, <a class="el" href="../../d6/d0/usercli_8h.html#a375">CURSORRESOURCE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d4/client_2acons_8c.html#a1">HOTSPOTREC</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00187">ReadFilePtrCopy()</a>, <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00166">ReadFilePtrUnaligned()</a>, <a class="el" href="../../d5/d8/clres_8c-source.html#l04759">RtlGetIdFromDirectory()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00958">UserLocalAlloc</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00960">UserLocalFree</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00880">tagCURSORRESOURCE::xHotspot</a>, and <a class="el" href="../../d7/d9/usercli_8h-source.html#l00881">tagCURSORRESOURCE::yHotspot</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00279">LoadCursorIconFromFileMap()</a>, and <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00700">ReadIconFromFileMap()</a>.
<p>
<pre class="fragment"><div>00462 {
00463     NEWHEADER *pnh;
00464     <span class="keywordtype">int</span> i, Id;
00465     <a class="code" href="../../d0/d0/struct__ICONFILERESDIR.html">ICONFILERESDIR</a> UNALIGNED *pird;
00466     <a class="code" href="../../d0/d2/structtagCURSORRESOURCE.html">PCURSORRESOURCE</a> pcres;
00467     RESDIR UNALIGNED *prd;
00468     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cb;
00469     <a class="code" href="../../d4/d8/struct__HOTSPOTREC.html">HOTSPOTREC</a> UNALIGNED *phs;
00470     LPBITMAPINFOHEADER pbih;
00471 
00472     <span class="comment">/*</span>
00473 <span class="comment">     * Construct a fake array of RESDIR entries using the info at the head</span>
00474 <span class="comment">     * of the file.  Store the data offset in the idIcon WORD so it can be</span>
00475 <span class="comment">     * returned by RtlGetIdFromDirectory.</span>
00476 <span class="comment">     */</span>
00477     pnh = (NEWHEADER *)<a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, <span class="keyword">sizeof</span>(NEWHEADER) +
00478             (pnhBase-&gt;ResCount * (<span class="keyword">sizeof</span>(RESDIR) + <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8/struct__HOTSPOTREC.html">HOTSPOTREC</a>))));
00479     <span class="keywordflow">if</span> (pnh == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00480         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00481 
00482     *pnh = *pnhBase;
00483     prd = (RESDIR UNALIGNED *)(pnh + 1);
00484     phs = (<a class="code" href="../../d4/d8/struct__HOTSPOTREC.html">HOTSPOTREC</a> UNALIGNED *)(prd + pnhBase-&gt;ResCount);
00485 
00486     <span class="keywordflow">for</span> (i = 0; i &lt; (<span class="keywordtype">int</span>)pnh-&gt;ResCount; i++, prd++) {
00487         <span class="comment">/*</span>
00488 <span class="comment">         * Read the resource directory from the icon file.</span>
00489 <span class="comment">         */</span>
00490         <a class="code" href="../../d3/d4/client_2acons_8c.html#a12">ReadFilePtrUnaligned</a>(pfi, &amp;pird, <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d0/struct__ICONFILERESDIR.html">ICONFILERESDIR</a>));
00491 
00492         <span class="comment">/*</span>
00493 <span class="comment">         * Convert from the icon editor's resource directory format</span>
00494 <span class="comment">         * to the post-RC.EXE format LookupIconIdFromDirectory expects.</span>
00495 <span class="comment">         */</span>
00496         prd-&gt;Icon.Width = pird-&gt;bWidth;
00497         prd-&gt;Icon.Height = pird-&gt;bHeight;
00498         <span class="keywordflow">if</span> (pnh-&gt;ResType == FT_ICON) {     <span class="comment">// ICON</span>
00499             prd-&gt;Icon.ColorCount = pird-&gt;bColorCount;
00500             prd-&gt;Icon.reserved = 0;
00501         }
00502         prd-&gt;Planes = 0;                <span class="comment">// Hopefully nobody uses this</span>
00503         prd-&gt;BitCount = 0;              <span class="comment">//        "        "</span>
00504         prd-&gt;BytesInRes = pird-&gt;dwDIBSize;
00505         prd-&gt;idIcon = (WORD)pird-&gt;dwDIBOffset;
00506 
00507         phs-&gt;xHotspot = pird-&gt;xHotspot;
00508         phs-&gt;yHotspot = pird-&gt;yHotspot;
00509         phs++;
00510     }
00511 
00512     *prt = pnhBase-&gt;ResType == FT_ICON ? RT_ICON : RT_CURSOR;
00513     Id = <a class="code" href="../../d6/d0/usercli_8h.html#a428">RtlGetIdFromDirectory</a>((PBYTE)pnh,
00514                                 *prt == RT_ICON,
00515                                 cxDesired,
00516                                 cyDesired,
00517                                 LR_flags,
00518                                 &amp;cb);
00519 
00520     <span class="comment">/*</span>
00521 <span class="comment">     * Allocate for worst case (cursor).</span>
00522 <span class="comment">     */</span>
00523     pcres = (<a class="code" href="../../d0/d2/structtagCURSORRESOURCE.html">PCURSORRESOURCE</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0,
00524             cb + FIELD_OFFSET(<a class="code" href="../../d0/d2/structtagCURSORRESOURCE.html">CURSORRESOURCE</a>, bih));
00525     <span class="keywordflow">if</span> (pcres == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00526         <span class="keywordflow">goto</span> CleanExit;
00527     }
00528 
00529     <span class="keywordflow">if</span> (*prt == RT_CURSOR) {
00530         <span class="comment">/*</span>
00531 <span class="comment">         * Fill in hotspot info for cursors.</span>
00532 <span class="comment">         */</span>
00533         prd = (RESDIR UNALIGNED *)(pnh + 1);
00534         phs = (<a class="code" href="../../d4/d8/struct__HOTSPOTREC.html">HOTSPOTREC</a> UNALIGNED *)(prd + pnh-&gt;ResCount);
00535 
00536         <span class="keywordflow">for</span>( i = 0; i &lt; pnh-&gt;ResCount; i++ ) {
00537             <span class="keywordflow">if</span> (prd[i].idIcon == (WORD)Id) {
00538                 pcres-&gt;<a class="code" href="../../d0/d2/structtagCURSORRESOURCE.html#o0">xHotspot</a> = phs[i].xHotspot;
00539                 pcres-&gt;<a class="code" href="../../d0/d2/structtagCURSORRESOURCE.html#o1">yHotspot</a> = phs[i].yHotspot;
00540                 <span class="keywordflow">break</span>;
00541             }
00542         }
00543 
00544         <span class="keywordflow">if</span> (i == pnh-&gt;ResCount) {
00545             pcres-&gt;<a class="code" href="../../d0/d2/structtagCURSORRESOURCE.html#o0">xHotspot</a> = pird-&gt;xHotspot;
00546             pcres-&gt;<a class="code" href="../../d0/d2/structtagCURSORRESOURCE.html#o1">yHotspot</a> = pird-&gt;yHotspot;
00547         }
00548         pbih = &amp;pcres-&gt;<a class="code" href="../../d0/d2/structtagCURSORRESOURCE.html#o2">bih</a>;
00549     } <span class="keywordflow">else</span> {
00550         pbih = (LPBITMAPINFOHEADER)pcres;
00551     }
00552 
00553     <span class="comment">/*</span>
00554 <span class="comment">     * Read in the header information into pcres.</span>
00555 <span class="comment">     */</span>
00556     pfi-&gt;pFilePtr = pfi-&gt;pFileMap + offResBase + Id;
00557     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d4/client_2acons_8c.html#a13">ReadFilePtrCopy</a>(pfi, pbih, cb)) {
00558         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pnh);
00559         <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pcres);
00560         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00561     }
00562 
00563 
00564 CleanExit:
00565     <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pnh);
00566     <span class="keywordflow">return</span> pcres;
00567 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="client/acons.c::ReadIconGuts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d2/structtagCURSORRESOURCE.html">PCURSORRESOURCE</a> ReadIconGuts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pfi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPNEWHEADER&nbsp;</td>
          <td class="mdname" nowrap> <em>pnhBase</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>offResBase</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR *&nbsp;</td>
          <td class="mdname" nowrap> <em>prt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>cxDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>cyDesired</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LR_flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="client/acons.c::ReadTag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ReadTag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pfi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PRTAG&nbsp;</td>
          <td class="mdname" nowrap> <em>ptag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00211">211</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00187">ReadFilePtrCopy()</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00777">LoadAniIcon()</a>, and <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00279">LoadCursorIconFromFileMap()</a>.
<p>
<pre class="fragment"><div>00214 {
00215     ptag-&gt;ckID = ptag-&gt;ckSize = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;  <span class="comment">// in case we fail the read.</span>
00216 
00217     <span class="keywordflow">return</span>(<a class="code" href="../../d3/d4/client_2acons_8c.html#a13">ReadFilePtrCopy</a>(pfi, ptag, <span class="keyword">sizeof</span>(RTAG)));
00218 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="client/acons.c::SkipChunk" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SkipChunk           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d2/struct__FILEINFO.html">PFILEINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pfi</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PRTAG&nbsp;</td>
          <td class="mdname" nowrap> <em>ptag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00245">245</a> of file <a class="el" href="../../d4/d3/client_2acons_8c-source.html">client/acons.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00777">LoadAniIcon()</a>, and <a class="el" href="../../d4/d3/client_2acons_8c-source.html#l00279">LoadCursorIconFromFileMap()</a>.
<p>
<pre class="fragment"><div>00248 {
00249     <span class="comment">/*</span>
00250 <span class="comment">     * Round ptag-&gt;ckSize up to nearest word boundary</span>
00251 <span class="comment">     * to maintain alignment</span>
00252 <span class="comment">     */</span>
00253     pfi-&gt;pFilePtr += (ptag-&gt;ckSize + 1) &amp; (~1);
00254     <span class="keywordflow">if</span> (pfi-&gt;pFilePtr &lt;= pfi-&gt;pFileEnd) {
00255         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00256     } <span class="keywordflow">else</span> {
00257         RIPMSG0(RIP_WARNING, <span class="stringliteral">"SkipChunk: Advanced pointer past end of file map"</span>);
00258         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00259     }
00260 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
