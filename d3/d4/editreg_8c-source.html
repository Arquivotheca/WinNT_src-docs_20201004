<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: editreg.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>editreg.c</h1><a href="../../d2/d5/editreg_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1991  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    editreg.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This program acts as an interactive shell allowing a user to view</span>
00012 <span class="comment">    and manipulate the configuration registry.  Also, it has some specific</span>
00013 <span class="comment">    commands for support of the NTFT component of the registry.</span>
00014 <span class="comment"></span>
00015 <span class="comment">Author:</span>
00016 <span class="comment"></span>
00017 <span class="comment">    Mike Glass</span>
00018 <span class="comment">    Bob Rinne</span>
00019 <span class="comment"></span>
00020 <span class="comment">Environment:</span>
00021 <span class="comment"></span>
00022 <span class="comment">    User process.</span>
00023 <span class="comment"></span>
00024 <span class="comment">Notes:</span>
00025 <span class="comment"></span>
00026 <span class="comment">    The commands "disk", "fix", "restore" are commands that know where</span>
00027 <span class="comment">    the configuration information is for the NTFT component of the NT</span>
00028 <span class="comment">    system.</span>
00029 <span class="comment"></span>
00030 <span class="comment">Revision History:</span>
00031 <span class="comment"></span>
00032 <span class="comment">--*/</span>
00033 
00034 <span class="preprocessor">#include "<a class="code" href="../../d1/d2/cmp_8h.html">cmp.h</a>"</span>
00035 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00036 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00037 <span class="preprocessor">#include &lt;string.h&gt;</span>
00038 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
00039 <span class="preprocessor">#include "ntdskreg.h"</span>
00040 <span class="preprocessor">#include "ntddft.h"</span>
00041 
00042 <span class="comment">//</span>
00043 <span class="comment">// Tempory stuff to get types and values to print in help.</span>
00044 <span class="comment">//</span>
00045 
<a name="l00046"></a><a class="code" href="../../d2/d5/editreg_8c.html#a39">00046</a> PUCHAR <a class="code" href="../../d2/d5/editreg_8c.html#a39">TypeNames</a>[] =
00047 {
00048     <span class="stringliteral">"REG_NONE"</span>,
00049     <span class="stringliteral">"REG_SZ"</span>,
00050     <span class="stringliteral">"REG_BINARY"</span>,
00051     <span class="stringliteral">"REG_DWORD"</span>,
00052     <span class="stringliteral">"REG_DWORD_LITTLE_ENDIAN"</span>,
00053     <span class="stringliteral">"REG_DWORD_BIG_ENDIAN"</span>,
00054     <span class="stringliteral">"REG_LINK"</span>,
00055     <span class="stringliteral">"REG_MULTI_SZ"</span>,
00056     <span class="stringliteral">"REG_RESOURCE_LIST"</span>,
00057     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00058 };
00059 
<a name="l00060"></a><a class="code" href="../../d2/d5/editreg_8c.html#a40">00060</a> ULONG <a class="code" href="../../d2/d5/editreg_8c.html#a40">TypeNumbers</a>[] =
00061 {
00062     REG_NONE,
00063     REG_SZ,
00064     REG_BINARY,
00065     REG_DWORD,
00066     REG_DWORD_LITTLE_ENDIAN,
00067     REG_DWORD_BIG_ENDIAN,
00068     REG_LINK,
00069     REG_MULTI_SZ,
00070     REG_RESOURCE_LIST
00071 };
00072 
00073 <span class="comment">//</span>
00074 <span class="comment">// Special support for the driver load lists in the registry.</span>
00075 <span class="comment">//</span>
00076 
<a name="l00077"></a><a class="code" href="../../d2/d5/editreg_8c.html#a41">00077</a> PUCHAR <a class="code" href="../../d2/d5/editreg_8c.html#a41">StartDescription</a>[] =
00078 {
00079     <span class="stringliteral">"Boot loader"</span>,
00080     <span class="stringliteral">"System"</span>,
00081     <span class="stringliteral">"2"</span>,
00082     <span class="stringliteral">"3"</span>,
00083     
00084     <span class="comment">//</span>
00085     <span class="comment">// Anything above 3 is not loaded.</span>
00086     <span class="comment">//</span>
00087 
00088     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00089 };
00090 
<a name="l00091"></a><a class="code" href="../../d2/d5/editreg_8c.html#a42">00091</a> PUCHAR <a class="code" href="../../d2/d5/editreg_8c.html#a42">TypeDescription</a>[] =
00092 {
00093     <span class="stringliteral">"System driver"</span>,
00094     <span class="stringliteral">"File system"</span>,
00095     <span class="stringliteral">"Service"</span>,
00096     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00097 };
00098 
00099 
00100 <span class="comment">//</span>
00101 <span class="comment">// Constants and defines.</span>
00102 <span class="comment">//</span>
00103 
<a name="l00104"></a><a class="code" href="../../d2/d5/editreg_8c.html#a0">00104</a> <span class="preprocessor">#define WORK_BUFFER_SIZE 4096</span>
00105 <span class="preprocessor"></span>
00106 <span class="comment">//</span>
00107 <span class="comment">// Amount to fudge when mallocing for strings.</span>
00108 <span class="comment">//</span>
00109 
<a name="l00110"></a><a class="code" href="../../d2/d5/editreg_8c.html#a1">00110</a> <span class="preprocessor">#define FUDGE 8</span>
00111 <span class="preprocessor"></span>
00112 <span class="comment">//</span>
00113 <span class="comment">// Registry base.</span>
00114 <span class="comment">//</span>
00115 
<a name="l00116"></a><a class="code" href="../../d2/d5/editreg_8c.html#a2">00116</a> <span class="preprocessor">#define REGISTRY_BASE "\\REGISTRY\\MACHINE"</span>
00117 <span class="preprocessor"></span>
00118 <span class="comment">//</span>
00119 <span class="comment">// Default type value when key value set.</span>
00120 <span class="comment">//</span>
00121 
<a name="l00122"></a><a class="code" href="../../d2/d5/editreg_8c.html#a3">00122</a> <span class="preprocessor">#define DEFAULT_TYPE REG_SZ</span>
00123 <span class="preprocessor"></span>
00124 <span class="comment">//</span>
00125 <span class="comment">// Base location for component descriptions of FT elements.</span>
00126 <span class="comment">//</span>
00127 
<a name="l00128"></a><a class="code" href="../../d2/d5/editreg_8c.html#a4">00128</a> <span class="preprocessor">#define FT_REGISTRY_ROOT "\\REGISTRY\\MACHINE\\SYSTEM\\NTFT"</span>
00129 <span class="preprocessor"></span>
00130 <span class="comment">//</span>
00131 <span class="comment">// Subkey name located in the FT_REGISTRY_ROOT for stripes.</span>
00132 <span class="comment">//</span>
00133 
<a name="l00134"></a><a class="code" href="../../d2/d5/editreg_8c.html#a5">00134</a> <span class="preprocessor">#define FT_STRIPE_BASE   "Stripe%d"</span>
00135 <span class="preprocessor"></span>
00136 <span class="comment">//</span>
00137 <span class="comment">// Subkey name located in the FT_REGISTRY_ROOT for mirrors.</span>
00138 <span class="comment">//</span>
00139 
<a name="l00140"></a><a class="code" href="../../d2/d5/editreg_8c.html#a6">00140</a> <span class="preprocessor">#define FT_MIRROR_BASE   "Mirror%d"</span>
00141 <span class="preprocessor"></span>
00142 <span class="comment">//</span>
00143 <span class="comment">// Subkey name located in the FT_REGISTRY_ROOT for volume sets.</span>
00144 <span class="comment">//</span>
00145 
<a name="l00146"></a><a class="code" href="../../d2/d5/editreg_8c.html#a7">00146</a> <span class="preprocessor">#define FT_VOLSET_BASE   "VolSet%d"</span>
00147 <span class="preprocessor"></span>
00148 
00149 <span class="comment">//</span>
00150 <span class="comment">// Constants for the command values.</span>
00151 <span class="comment">//</span>
00152 
<a name="l00153"></a><a class="code" href="../../d2/d5/editreg_8c.html#a8">00153</a> <span class="preprocessor">#define INVALID   -1</span>
<a name="l00154"></a><a class="code" href="../../d2/d5/editreg_8c.html#a9">00154</a> <span class="preprocessor"></span><span class="preprocessor">#define DIR       0</span>
<a name="l00155"></a><a class="code" href="../../d2/d5/editreg_8c.html#a10">00155</a> <span class="preprocessor"></span><span class="preprocessor">#define CREATE    1</span>
<a name="l00156"></a><a class="code" href="../../d2/d5/editreg_8c.html#a11">00156</a> <span class="preprocessor"></span><span class="preprocessor">#define LIST      2</span>
<a name="l00157"></a><a class="code" href="../../d2/d5/editreg_8c.html#a12">00157</a> <span class="preprocessor"></span><span class="preprocessor">#define CHDIR     3</span>
<a name="l00158"></a><a class="code" href="../../d2/d5/editreg_8c.html#a13">00158</a> <span class="preprocessor"></span><span class="preprocessor">#define HELP      4</span>
<a name="l00159"></a><a class="code" href="../../d2/d5/editreg_8c.html#a14">00159</a> <span class="preprocessor"></span><span class="preprocessor">#define QUIT      5</span>
<a name="l00160"></a><a class="code" href="../../d2/d5/editreg_8c.html#a15">00160</a> <span class="preprocessor"></span><span class="preprocessor">#define DDEBUG    6</span>
<a name="l00161"></a><a class="code" href="../../d2/d5/editreg_8c.html#a16">00161</a> <span class="preprocessor"></span><span class="preprocessor">#define SETVALUE  7</span>
<a name="l00162"></a><a class="code" href="../../d2/d5/editreg_8c.html#a17">00162</a> <span class="preprocessor"></span><span class="preprocessor">#define DELKEY    8</span>
<a name="l00163"></a><a class="code" href="../../d2/d5/editreg_8c.html#a18">00163</a> <span class="preprocessor"></span><span class="preprocessor">#define DELVALUE  9</span>
<a name="l00164"></a><a class="code" href="../../d2/d5/editreg_8c.html#a19">00164</a> <span class="preprocessor"></span><span class="preprocessor">#define DIRLONG  10</span>
<a name="l00165"></a><a class="code" href="../../d2/d5/editreg_8c.html#a20">00165</a> <span class="preprocessor"></span><span class="preprocessor">#define INLONG   11</span>
<a name="l00166"></a><a class="code" href="../../d2/d5/editreg_8c.html#a21">00166</a> <span class="preprocessor"></span><span class="preprocessor">#define INSHORT  12</span>
<a name="l00167"></a><a class="code" href="../../d2/d5/editreg_8c.html#a22">00167</a> <span class="preprocessor"></span><span class="preprocessor">#define INBYTE   13</span>
<a name="l00168"></a><a class="code" href="../../d2/d5/editreg_8c.html#a23">00168</a> <span class="preprocessor"></span><span class="preprocessor">#define DUMP     14</span>
<a name="l00169"></a><a class="code" href="../../d2/d5/editreg_8c.html#a24">00169</a> <span class="preprocessor"></span><span class="preprocessor">#define DISKREG  15</span>
<a name="l00170"></a><a class="code" href="../../d2/d5/editreg_8c.html#a25">00170</a> <span class="preprocessor"></span><span class="preprocessor">#define FIXDISK  16</span>
<a name="l00171"></a><a class="code" href="../../d2/d5/editreg_8c.html#a26">00171</a> <span class="preprocessor"></span><span class="preprocessor">#define RESTORE  17</span>
<a name="l00172"></a><a class="code" href="../../d2/d5/editreg_8c.html#a27">00172</a> <span class="preprocessor"></span><span class="preprocessor">#define DRIVERS  18</span>
<a name="l00173"></a><a class="code" href="../../d2/d5/editreg_8c.html#a28">00173</a> <span class="preprocessor"></span><span class="preprocessor">#define ORPHAN   19</span>
<a name="l00174"></a><a class="code" href="../../d2/d5/editreg_8c.html#a29">00174</a> <span class="preprocessor"></span><span class="preprocessor">#define REGEN    20</span>
<a name="l00175"></a><a class="code" href="../../d2/d5/editreg_8c.html#a30">00175</a> <span class="preprocessor"></span><span class="preprocessor">#define INIT     21</span>
<a name="l00176"></a><a class="code" href="../../d2/d5/editreg_8c.html#a31">00176</a> <span class="preprocessor"></span><span class="preprocessor">#define MAKEFT   22</span>
00177 <span class="preprocessor"></span>
<a name="l00178"></a><a class="code" href="../../d2/d5/editreg_8c.html#a32">00178</a> <span class="preprocessor">#define CTRL_C 0x03</span>
00179 <span class="preprocessor"></span>
00180 <span class="comment">//</span>
00181 <span class="comment">// Table of recognized commands.</span>
00182 <span class="comment">//</span>
00183 
<a name="l00184"></a><a class="code" href="../../d2/d5/editreg_8c.html#a43">00184</a> PUCHAR <a class="code" href="../../d2/d5/editreg_8c.html#a43">Commands</a>[] = {
00185     <span class="stringliteral">"dir"</span>,
00186     <span class="stringliteral">"keys"</span>,
00187     <span class="stringliteral">"lc"</span>,
00188     <span class="stringliteral">"ls"</span>,
00189     <span class="stringliteral">"create"</span>,
00190     <span class="stringliteral">"set"</span>,
00191     <span class="stringliteral">"unset"</span>,
00192     <span class="stringliteral">"erase"</span>,
00193     <span class="stringliteral">"delete"</span>,
00194     <span class="stringliteral">"rm"</span>,
00195     <span class="stringliteral">"list"</span>,
00196     <span class="stringliteral">"values"</span>,
00197     <span class="stringliteral">"display"</span>,
00198     <span class="stringliteral">"cd"</span>,
00199     <span class="stringliteral">"chdir"</span>,
00200     <span class="stringliteral">"help"</span>,
00201     <span class="stringliteral">"?"</span>,
00202     <span class="stringliteral">"quit"</span>,
00203     <span class="stringliteral">"exit"</span>,
00204     <span class="stringliteral">"debug"</span>,
00205     <span class="stringliteral">"longs"</span>,
00206     <span class="stringliteral">"shorts"</span>,
00207     <span class="stringliteral">"bytes"</span>,
00208     <span class="stringliteral">"dump"</span>,
00209     <span class="stringliteral">"disks"</span>,
00210     <span class="stringliteral">"fix"</span>,
00211     <span class="stringliteral">"restore"</span>,
00212     <span class="stringliteral">"drivers"</span>,
00213     <span class="stringliteral">"orphan"</span>,
00214     <span class="stringliteral">"regenerate"</span>,
00215     <span class="stringliteral">"initialize"</span>,
00216     <span class="stringliteral">"makeft"</span>,
00217     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00218 };
00219 
00220 <span class="comment">//</span>
00221 <span class="comment">// Using the index from the match on the commands in Commands[], this</span>
00222 <span class="comment">// table gives the proper command value to be executed.  This allows</span>
00223 <span class="comment">// for multiple entries in Commands[] for the same command code.</span>
00224 <span class="comment">//</span>
00225 
<a name="l00226"></a><a class="code" href="../../d2/d5/editreg_8c.html#a44">00226</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/d5/editreg_8c.html#a44">CommandMap</a>[] = {
00227 
00228     <a class="code" href="../../d2/d5/editreg_8c.html#a19">DIRLONG</a>,
00229     <a class="code" href="../../d2/d5/editreg_8c.html#a9">DIR</a>,
00230     <a class="code" href="../../d2/d5/editreg_8c.html#a9">DIR</a>,
00231     <a class="code" href="../../d2/d5/editreg_8c.html#a9">DIR</a>,
00232     <a class="code" href="../../d2/d5/editreg_8c.html#a10">CREATE</a>,
00233     <a class="code" href="../../d2/d5/editreg_8c.html#a16">SETVALUE</a>,
00234     <a class="code" href="../../d2/d5/editreg_8c.html#a18">DELVALUE</a>,
00235     <a class="code" href="../../d2/d5/editreg_8c.html#a18">DELVALUE</a>,
00236     <a class="code" href="../../d2/d5/editreg_8c.html#a17">DELKEY</a>,
00237     <a class="code" href="../../d2/d5/editreg_8c.html#a17">DELKEY</a>,
00238     <a class="code" href="../../d2/d5/editreg_8c.html#a11">LIST</a>,
00239     <a class="code" href="../../d2/d5/editreg_8c.html#a11">LIST</a>,
00240     <a class="code" href="../../d2/d5/editreg_8c.html#a11">LIST</a>,
00241     <a class="code" href="../../d2/d5/editreg_8c.html#a12">CHDIR</a>,
00242     <a class="code" href="../../d2/d5/editreg_8c.html#a12">CHDIR</a>,
00243     <a class="code" href="../../d2/d5/editreg_8c.html#a13">HELP</a>,
00244     <a class="code" href="../../d2/d5/editreg_8c.html#a13">HELP</a>,
00245     <a class="code" href="../../d2/d5/editreg_8c.html#a14">QUIT</a>,
00246     <a class="code" href="../../d2/d5/editreg_8c.html#a14">QUIT</a>,
00247     <a class="code" href="../../d2/d5/editreg_8c.html#a15">DDEBUG</a>,
00248     <a class="code" href="../../d2/d5/editreg_8c.html#a20">INLONG</a>,
00249     <a class="code" href="../../d2/d5/editreg_8c.html#a21">INSHORT</a>,
00250     <a class="code" href="../../d2/d5/editreg_8c.html#a22">INBYTE</a>,
00251     <a class="code" href="../../d2/d5/editreg_8c.html#a23">DUMP</a>,
00252     <a class="code" href="../../d2/d5/editreg_8c.html#a24">DISKREG</a>,
00253     <a class="code" href="../../d2/d5/editreg_8c.html#a25">FIXDISK</a>,
00254     <a class="code" href="../../d2/d5/editreg_8c.html#a26">RESTORE</a>,
00255     <a class="code" href="../../d2/d5/editreg_8c.html#a27">DRIVERS</a>,
00256     <a class="code" href="../../d2/d5/editreg_8c.html#a28">ORPHAN</a>,
00257     <a class="code" href="../../d2/d5/editreg_8c.html#a29">REGEN</a>,
00258     <a class="code" href="../../d2/d5/editreg_8c.html#a30">INIT</a>,
00259     <a class="code" href="../../d2/d5/editreg_8c.html#a31">MAKEFT</a>
00260 };
00261 
00262 <span class="comment">//</span>
00263 <span class="comment">// CommandHelp is an array of help strings for each of the commands.</span>
00264 <span class="comment">// The array is indexed by the result of CommandMap[i] for the Commands[]</span>
00265 <span class="comment">// array.  This way the same help message will print for each of the</span>
00266 <span class="comment">// commands aliases.</span>
00267 <span class="comment">//</span>
00268 
<a name="l00269"></a><a class="code" href="../../d2/d5/editreg_8c.html#a45">00269</a> PUCHAR   <a class="code" href="../../d2/d5/editreg_8c.html#a45">CommandHelp</a>[] = {
00270 
00271     <span class="stringliteral">"Displays keys."</span>,
00272     <span class="stringliteral">"Create a new key."</span>,
00273     <span class="stringliteral">"Displays values withing a key."</span>,
00274     <span class="stringliteral">"Change current location in registry."</span>,
00275     <span class="stringliteral">"This help information."</span>,
00276     <span class="stringliteral">"Exit the program."</span>,
00277     <span class="stringliteral">"Set internal debug on for this program."</span>,
00278     <span class="stringliteral">"Set a new value within a key."</span>,
00279     <span class="stringliteral">"Delete a key."</span>,
00280     <span class="stringliteral">"Unset (erase) a key value."</span>,
00281     <span class="stringliteral">"Unset (erase) a key value."</span>,
00282     <span class="stringliteral">"Change dump format to Longs (default)."</span>,
00283     <span class="stringliteral">"Change dump format to Shorts."</span>,
00284     <span class="stringliteral">"Change dump format to Bytes."</span>,
00285     <span class="stringliteral">"Toggle dump mode (force hex dump for all value types)."</span>,
00286     <span class="stringliteral">"Display the disk registry."</span>,
00287     <span class="stringliteral">"Set disk signatures in registry."</span>,
00288     <span class="stringliteral">"Restore an FT orphan to working state."</span>,
00289     <span class="stringliteral">"List the information on the drivers from the registry."</span>,
00290     <span class="stringliteral">"Orphan a member of an FT set."</span>,
00291     <span class="stringliteral">"Mark a FT set member for regeneration on next boot."</span>,
00292     <span class="stringliteral">"Mark a stripe with parity for initialization on next boot."</span>,
00293     <span class="stringliteral">"Construct an FT set from existing partitions"</span>,
00294     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00295 
00296 };
00297 
00298 <span class="comment">//</span>
00299 <span class="comment">// Space for working location string in registry.</span>
00300 <span class="comment">//</span>
00301 
<a name="l00302"></a><a class="code" href="../../d2/d5/editreg_8c.html#a46">00302</a> UCHAR <a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>[512];
00303 
00304 <span class="comment">//</span>
00305 <span class="comment">// Space for current location string in registry.</span>
00306 <span class="comment">//</span>
00307 
<a name="l00308"></a><a class="code" href="../../d2/d5/editreg_8c.html#a47">00308</a> UCHAR <a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>[512];
00309 
00310 <span class="comment">//</span>
00311 <span class="comment">// Space for command input.</span>
00312 <span class="comment">//</span>
00313 
<a name="l00314"></a><a class="code" href="../../d2/d5/editreg_8c.html#a48">00314</a> UCHAR <a class="code" href="../../d2/d5/editreg_8c.html#a48">CommandLine</a>[512];
00315 
00316 <span class="comment">//</span>
00317 <span class="comment">// Prompt strings for getting definition for an FT_COPY request.</span>
00318 <span class="comment">//</span>
00319 
<a name="l00320"></a><a class="code" href="../../d2/d5/editreg_8c.html#a49">00320</a> PUCHAR <a class="code" href="../../d2/d5/editreg_8c.html#a49">SetPrompts</a>[] = {
00321 
00322     <span class="stringliteral">"Name =&gt; "</span>,
00323     <span class="stringliteral">"Value =&gt; "</span>,
00324     <span class="stringliteral">"Index =&gt; "</span>,
00325     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00326 };
00327 
00328 <span class="comment">//</span>
00329 <span class="comment">// Version indicator.  Should be changed every time a major edit occurs.</span>
00330 <span class="comment">//</span>
00331 
<a name="l00332"></a><a class="code" href="../../d2/d5/editreg_8c.html#a50">00332</a> PUCHAR <a class="code" href="../../d2/d5/editreg_8c.html#a50">Version</a> = <span class="stringliteral">"Version 1.30"</span>;
00333 
00334 <span class="comment">//</span>
00335 <span class="comment">// Debug print level.</span>
00336 <span class="comment">//</span>
00337 
<a name="l00338"></a><a class="code" href="../../d2/d5/editreg_8c.html#a51">00338</a> ULONG <a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a> = 0;
00339 
00340 <span class="comment">//</span>
00341 <span class="comment">// Dump control values.</span>
00342 <span class="comment">//</span>
00343 
<a name="l00344"></a><a class="code" href="../../d2/d5/editreg_8c.html#a88">00344</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="../../d2/d5/editreg_8c.html#a88">_DUMP_CONTROL</a> {
00345 
00346     <a class="code" href="../../d2/d5/editreg_8c.html#a88a56">InBytes</a>,
00347     <a class="code" href="../../d2/d5/editreg_8c.html#a88a57">InShorts</a>,
00348     <a class="code" href="../../d2/d5/editreg_8c.html#a88a58">InLongs</a>
00349 
00350 } <a class="code" href="../../d2/d5/editreg_8c.html#a52">DUMP_CONTROL</a>, *<a class="code" href="../../d2/d5/editreg_8c.html#a53">PDUMP_CONTROL</a>;
00351 
<a name="l00352"></a><a class="code" href="../../d2/d5/editreg_8c.html#a54">00352</a> ULONG <a class="code" href="../../d2/d5/editreg_8c.html#a54">ForceDump</a> = 0;
00353 
<a name="l00354"></a><a class="code" href="../../d2/d5/editreg_8c.html#a55">00354</a> <a class="code" href="../../d2/d5/editreg_8c.html#a52">DUMP_CONTROL</a> <a class="code" href="../../d2/d5/editreg_8c.html#a55">DumpControl</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a88a58">InLongs</a>;
00355 
00356 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00357"></a><a class="code" href="../../d2/d5/editreg_8c.html#a59">00357</a> <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(
00358     PHANDLE HandlePtr,
00359     PUCHAR  KeyName
00360     )
00361 
00362 <span class="comment">/*++</span>
00363 <span class="comment"></span>
00364 <span class="comment">Routine Description:</span>
00365 <span class="comment"></span>
00366 <span class="comment">Arguments:</span>
00367 <span class="comment"></span>
00368 <span class="comment">Return Value:</span>
00369 <span class="comment"></span>
00370 <span class="comment">--*/</span>
00371 
00372 {
00373     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>          status;
00374     STRING            keyString;
00375     OBJECT_ATTRIBUTES objectAttributes;
00376     UNICODE_STRING    unicodeKeyName;
00377 
00378     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>(&amp;keyString,
00379                   <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>);
00380 
00381     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeKeyName,
00382                                        &amp;keyString,
00383                                        (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00384 
00385     memset(&amp;objectAttributes, 0, <span class="keyword">sizeof</span>(OBJECT_ATTRIBUTES));
00386     InitializeObjectAttributes(&amp;objectAttributes,
00387                                &amp;unicodeKeyName,
00388                                OBJ_CASE_INSENSITIVE,
00389                                <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00390                                <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00391 
00392     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(HandlePtr,
00393                        MAXIMUM_ALLOWED,
00394                        &amp;objectAttributes);
00395 
00396     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeKeyName);
00397 
00398     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a> == 1) {
00399         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00400             printf(<span class="stringliteral">"Failed NtOpenKey for %s =&gt; %x\n"</span>,
00401                    <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>,
00402                    status);
00403         }
00404     }
00405 
00406     <span class="keywordflow">return</span> status;
00407 }
00408 
00409 
00410 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00411"></a><a class="code" href="../../d2/d5/editreg_8c.html#a60">00411</a> <a class="code" href="../../d2/d5/editreg_8c.html#a60">FtDeleteKey</a>(
00412     PUCHAR KeyName
00413     )
00414 
00415 <span class="comment">/*++</span>
00416 <span class="comment"></span>
00417 <span class="comment">Routine Description:</span>
00418 <span class="comment"></span>
00419 <span class="comment">Arguments:</span>
00420 <span class="comment"></span>
00421 <span class="comment">Return Value:</span>
00422 <span class="comment"></span>
00423 <span class="comment">--*/</span>
00424 
00425 {
00426     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
00427     HANDLE   keyToDelete;
00428 
00429     status = <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(&amp;keyToDelete,
00430                        <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>);
00431 
00432     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00433         printf(<span class="stringliteral">"Key %s not found (0x%x).\n"</span>, <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>, status);
00434         <span class="keywordflow">return</span> status;
00435     }
00436 
00437     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a15">NtDeleteKey</a>(keyToDelete);
00438 
00439     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a> == 1) {
00440         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00441             printf(<span class="stringliteral">"Could not delete key %s =&gt; %x\n"</span>,
00442                    <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>,
00443                    status);
00444         }
00445     }
00446 
00447     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(keyToDelete);
00448     <span class="keywordflow">return</span> status;
00449 }
00450 
00451 
00452 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00453"></a><a class="code" href="../../d2/d5/editreg_8c.html#a61">00453</a> <a class="code" href="../../d2/d5/editreg_8c.html#a61">FtCreateKey</a>(
00454     PUCHAR KeyName,
00455     PUCHAR KeyClass,
00456     ULONG  Index
00457     )
00458 
00459 <span class="comment">/*++</span>
00460 <span class="comment"></span>
00461 <span class="comment">Routine Description:</span>
00462 <span class="comment"></span>
00463 <span class="comment">Arguments:</span>
00464 <span class="comment"></span>
00465 <span class="comment">Return Value:</span>
00466 <span class="comment"></span>
00467 <span class="comment">--*/</span>
00468 
00469 {
00470     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>          status;
00471     STRING            keyString;
00472     UNICODE_STRING    unicodeKeyName;
00473     STRING            classString;
00474     UNICODE_STRING    unicodeClassName;
00475     OBJECT_ATTRIBUTES objectAttributes;
00476     ULONG             disposition;
00477     HANDLE            tempHandle;
00478 
00479 <span class="preprocessor">#if DBG</span>
00480 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00481         (KeyClass == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00482         printf(<span class="stringliteral">"FtCreateKey: Invalid parameter 0x%x, 0x%x\n"</span>,
00483                <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>,
00484                KeyClass);
00485         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(0);
00486     }
00487 <span class="preprocessor">#endif</span>
00488 <span class="preprocessor"></span>
00489     <span class="comment">//</span>
00490     <span class="comment">// Initialize the object for the key.</span>
00491     <span class="comment">//</span>
00492 
00493     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>(&amp;keyString,
00494                   <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>);
00495 
00496     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeKeyName,
00497                                        &amp;keyString,
00498                                        (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00499 
00500     memset(&amp;objectAttributes, 0, <span class="keyword">sizeof</span>(OBJECT_ATTRIBUTES));
00501     InitializeObjectAttributes(&amp;objectAttributes,
00502                                &amp;unicodeKeyName,
00503                                OBJ_CASE_INSENSITIVE,
00504                                <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00505                                <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00506 
00507     <span class="comment">//</span>
00508     <span class="comment">// Setup the unicode class value.</span>
00509     <span class="comment">//</span>
00510 
00511     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>(&amp;classString,
00512                   KeyClass);
00513     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>)<a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeClassName,
00514                                        &amp;classString,
00515                                        (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00516 
00517     <span class="comment">//</span>
00518     <span class="comment">// Create the key.</span>
00519     <span class="comment">//</span>
00520 
00521     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a14">NtCreateKey</a>(&amp;tempHandle,
00522                          MAXIMUM_ALLOWED,
00523                          &amp;objectAttributes,
00524                          <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,
00525                          &amp;unicodeClassName,
00526                          REG_OPTION_NON_VOLATILE,
00527                          &amp;disposition);
00528 
00529     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00530         <span class="keywordflow">switch</span> (disposition)
00531         {
00532         <span class="keywordflow">case</span> REG_CREATED_NEW_KEY:
00533             <span class="keywordflow">break</span>;
00534 
00535         <span class="keywordflow">case</span> REG_OPENED_EXISTING_KEY:
00536             printf(<span class="stringliteral">"Warning: Creation was for an existing key!\n"</span>);
00537             <span class="keywordflow">break</span>;
00538 
00539         <span class="keywordflow">default</span>:
00540             printf(<span class="stringliteral">"New disposition returned == 0x%x\n"</span>, disposition);
00541             <span class="keywordflow">break</span>;
00542         }
00543     }
00544 
00545     <span class="comment">//</span>
00546     <span class="comment">// Free all allocated space.</span>
00547     <span class="comment">//</span>
00548 
00549     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeKeyName);
00550     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeClassName);
00551     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(tempHandle);
00552     <span class="keywordflow">return</span> status;
00553 }
00554 
00555 
00556 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00557"></a><a class="code" href="../../d2/d5/editreg_8c.html#a62">00557</a> <a class="code" href="../../d2/d5/editreg_8c.html#a62">FtDeleteValue</a>(
00558     HANDLE KeyHandle,
00559     PUCHAR ValueName
00560     )
00561 
00562 <span class="comment">/*++</span>
00563 <span class="comment"></span>
00564 <span class="comment">Routine Description:</span>
00565 <span class="comment"></span>
00566 <span class="comment">Arguments:</span>
00567 <span class="comment"></span>
00568 <span class="comment">Return Value:</span>
00569 <span class="comment"></span>
00570 <span class="comment">--*/</span>
00571 
00572 {
00573     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>       status;
00574     STRING         valueString;
00575     UNICODE_STRING unicodeValueName;
00576 
00577     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>(&amp;valueString,
00578                   <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>);
00579     status = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeValueName,
00580                                           &amp;valueString,
00581                                           (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00582     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00583         printf(<span class="stringliteral">"FtDeleteValue: internal conversion error 0x%x\n"</span>, status);
00584         <span class="keywordflow">return</span> status;
00585     }
00586 
00587     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a16">NtDeleteValueKey</a>(KeyHandle,
00588                               &amp;unicodeValueName);
00589     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a> == 1) {
00590         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00591             printf(<span class="stringliteral">"Could not delete value %s =&gt; %x\n"</span>,
00592                    <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00593                    status);
00594         }
00595     }
00596 
00597     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeValueName);
00598     <span class="keywordflow">return</span> status;
00599 }
00600 
00601 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00602"></a><a class="code" href="../../d2/d5/editreg_8c.html#a63">00602</a> <a class="code" href="../../d2/d5/editreg_8c.html#a63">FtSetValue</a>(
00603     HANDLE KeyHandle,
00604     PUCHAR ValueName,
00605     PVOID  DataBuffer,
00606     ULONG  DataLength,
00607     ULONG  Type
00608     )
00609 
00610 <span class="comment">/*++</span>
00611 <span class="comment"></span>
00612 <span class="comment">Routine Description:</span>
00613 <span class="comment"></span>
00614 <span class="comment">Arguments:</span>
00615 <span class="comment"></span>
00616 <span class="comment">Return Value:</span>
00617 <span class="comment"></span>
00618 <span class="comment">--*/</span>
00619 
00620 {
00621     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>          status;
00622     STRING            valueString;
00623     UNICODE_STRING    unicodeValueName;
00624 
00625     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>(&amp;valueString,
00626                   <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>);
00627     <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeValueName,
00628                                  &amp;valueString,
00629                                  (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00630     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a29">NtSetValueKey</a>(KeyHandle,
00631                            &amp;unicodeValueName,
00632                            0,
00633                            Type,
00634                            DataBuffer,
00635                            DataLength);
00636     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a> == 1) {
00637         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00638             printf(<span class="stringliteral">"Could not set value %s =&gt; %x\n"</span>,
00639                    <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>,
00640                    status);
00641         }
00642     }
00643 
00644     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeValueName);
00645     <span class="keywordflow">return</span> status;
00646 }
00647 
00648 
00649 PUCHAR
<a name="l00650"></a><a class="code" href="../../d2/d5/editreg_8c.html#a64">00650</a> <a class="code" href="../../d2/d5/editreg_8c.html#a64">FindTypeString</a>(
00651     ULONG Type
00652     )
00653 
00654 <span class="comment">/*++</span>
00655 <span class="comment"></span>
00656 <span class="comment">Routine Description:</span>
00657 <span class="comment"></span>
00658 <span class="comment">Arguments:</span>
00659 <span class="comment"></span>
00660 <span class="comment">Return Value:</span>
00661 <span class="comment"></span>
00662 <span class="comment">--*/</span>
00663 
00664 {
00665     <span class="keywordtype">int</span> i;
00666 
00667     <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d2/d5/editreg_8c.html#a39">TypeNames</a>[i] != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; i++) {
00668 
00669         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a40">TypeNumbers</a>[i] == Type) {
00670             <span class="keywordflow">return</span> <a class="code" href="../../d2/d5/editreg_8c.html#a39">TypeNames</a>[i];
00671         }
00672     }
00673     <span class="keywordflow">return</span> <span class="stringliteral">"(Unknown)"</span>;
00674 }
00675 
00676 
00677 BOOLEAN
<a name="l00678"></a><a class="code" href="../../d2/d5/editreg_8c.html#a65">00678</a> <a class="code" href="../../d2/d5/editreg_8c.html#a65">ProcessHex</a>(
00679     PUCHAR String,
00680     PULONG Value
00681     )
00682 
00683 <span class="comment">/*++</span>
00684 <span class="comment"></span>
00685 <span class="comment">Routine Description:</span>
00686 <span class="comment"></span>
00687 <span class="comment">Arguments:</span>
00688 <span class="comment"></span>
00689 <span class="comment">Return Value:</span>
00690 <span class="comment"></span>
00691 <span class="comment">--*/</span>
00692 
00693 {
00694     ULONG  workValue;
00695     <span class="keywordtype">int</span>    i;
00696     PUCHAR cp;
00697 
00698     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00699         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00700     }
00701 
00702     cp = <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>;
00703 
00704     <span class="comment">//</span>
00705     <span class="comment">// 'i' is an index value.  It contains the maximum index into the String.</span>
00706     <span class="comment">// Therefore it is initialized to -1.</span>
00707     <span class="comment">//</span>
00708 
00709     i = -1;
00710     <span class="keywordflow">while</span> ((*cp) &amp;&amp; (*cp != <span class="charliteral">'\n'</span>)) {
00711         i++;
00712         cp++;
00713     }
00714 
00715     <span class="keywordflow">if</span> (i &gt;= 8) {
00716 
00717         <span class="comment">//</span>
00718         <span class="comment">// String to long for a long.</span>
00719         <span class="comment">//</span>
00720 
00721         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00722     }
00723 
00724     workValue = 0;
00725     cp = <a class="code" href="../../d4/d9/talloc_8c.html#a0">String</a>;
00726     <span class="keywordflow">while</span> (*cp) {
00727         *cp = (UCHAR) tolower(*cp);
00728 
00729         <span class="keywordflow">switch</span> (*cp) {
00730 
00731         <span class="keywordflow">case</span> <span class="charliteral">'0'</span>:
00732         <span class="keywordflow">case</span> <span class="charliteral">'1'</span>:
00733         <span class="keywordflow">case</span> <span class="charliteral">'2'</span>:
00734         <span class="keywordflow">case</span> <span class="charliteral">'3'</span>:
00735         <span class="keywordflow">case</span> <span class="charliteral">'4'</span>:
00736         <span class="keywordflow">case</span> <span class="charliteral">'5'</span>:
00737         <span class="keywordflow">case</span> <span class="charliteral">'6'</span>:
00738         <span class="keywordflow">case</span> <span class="charliteral">'7'</span>:
00739         <span class="keywordflow">case</span> <span class="charliteral">'8'</span>:
00740         <span class="keywordflow">case</span> <span class="charliteral">'9'</span>:
00741             workValue |= (((*cp) - <span class="charliteral">'0'</span>) &lt;&lt; (i * 4));
00742             <span class="keywordflow">break</span>;
00743 
00744         <span class="keywordflow">case</span> <span class="charliteral">'a'</span>:
00745         <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:
00746         <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
00747         <span class="keywordflow">case</span> <span class="charliteral">'d'</span>:
00748         <span class="keywordflow">case</span> <span class="charliteral">'e'</span>:
00749         <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
00750             workValue |= ((((*cp) - <span class="charliteral">'a'</span>) + 10) &lt;&lt; (i * 4));
00751             <span class="keywordflow">break</span>;
00752 
00753         <span class="keywordflow">default</span>:
00754 
00755             <span class="comment">//</span>
00756             <span class="comment">// Illegal value, just punt.</span>
00757             <span class="comment">//</span>
00758 
00759             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00760             <span class="keywordflow">break</span>;
00761         }
00762         cp++;
00763         i--;
00764     }
00765 
00766     *Value = workValue;
00767     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00768 }
00769 
00770 
00771 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00772"></a><a class="code" href="../../d2/d5/editreg_8c.html#a66">00772</a> <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a24">Dump</a>(
00773     PVOID Buffer,
00774     ULONG Length
00775     )
00776 
00777 <span class="comment">/*++</span>
00778 <span class="comment"></span>
00779 <span class="comment">Routine Description:</span>
00780 <span class="comment"></span>
00781 <span class="comment">    Dump the value data from a buffer in the format specified.</span>
00782 <span class="comment"></span>
00783 <span class="comment">Arguments:</span>
00784 <span class="comment"></span>
00785 <span class="comment">    Buffer - pointer to the data.</span>
00786 <span class="comment">    Length - length of the data.</span>
00787 <span class="comment"></span>
00788 <span class="comment">Return Value:</span>
00789 <span class="comment"></span>
00790 <span class="comment">    None.</span>
00791 <span class="comment"></span>
00792 <span class="comment">--*/</span>
00793 {
00794     PUCHAR location;
00795     PUCHAR internalBuffer;
00796     <span class="keywordtype">int</span>    i;
00797     <span class="keywordtype">int</span>    j;
00798     <span class="keywordtype">int</span>    numberLines;
00799     UCHAR  outHexLine[128];
00800     UCHAR  outPrintable[64];
00801 
00802     numberLines = (Length + 15) / 16;
00803 
00804     <span class="comment">//</span>
00805     <span class="comment">// Since the amount of data displayed has been rounded up, this</span>
00806     <span class="comment">// routine mallocs enough space and copies the data in.  This way</span>
00807     <span class="comment">// it won't fault if the data is at the end of memory.</span>
00808     <span class="comment">//</span>
00809 
00810     internalBuffer = (PUCHAR) malloc(numberLines * 16);
00811     RtlMoveMemory(internalBuffer, <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>, Length);
00812     location = (PUCHAR) internalBuffer;
00813 
00814     <span class="keywordflow">for</span> (i = 0; i &lt; numberLines; i++) {
00815 
00816         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(outHexLine, <span class="stringliteral">"%8x: "</span>, (i * 16));
00817         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(outPrintable, <span class="stringliteral">"*"</span>);
00818         <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a55">DumpControl</a>) {
00819 
00820         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a88a56">InBytes</a>:
00821 
00822             <span class="keywordflow">for</span> (j = 0; j &lt; 16; j++) {
00823                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(outHexLine, <span class="stringliteral">"%s%2X "</span>, outHexLine, *location);
00824                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(outPrintable, <span class="stringliteral">"%s%c"</span>, outPrintable,
00825                         (isprint(location[0])) ? location[0] : <span class="charliteral">'.'</span>);
00826                 location++;
00827             }
00828             <span class="keywordflow">break</span>;
00829 
00830         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a88a57">InShorts</a>:
00831 
00832             <span class="keywordflow">for</span> (j = 0; j &lt; 8; j++) {
00833                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(outHexLine, <span class="stringliteral">"%s%4X "</span>, outHexLine,
00834                         *((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)location));
00835                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(outPrintable, <span class="stringliteral">"%s%c%c"</span>, outPrintable,
00836                         (isprint(location[0])) ? location[0] : <span class="charliteral">'.'</span>,
00837                         (isprint(location[1])) ? location[1] : <span class="charliteral">'.'</span>);
00838                 location += 2;
00839             }
00840             <span class="keywordflow">break</span>;
00841 
00842         <span class="keywordflow">default</span>:
00843         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a88a58">InLongs</a>:
00844 
00845             <span class="keywordflow">for</span> (j = 0; j &lt; 4; j++) {
00846                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(outHexLine, <span class="stringliteral">"%s%8X "</span>, outHexLine,
00847                         *((PULONG)location));
00848                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(outPrintable, <span class="stringliteral">"%s%c%c%c%c"</span>, outPrintable,
00849                         (isprint(location[0])) ? location[0] : <span class="charliteral">'.'</span>,
00850                         (isprint(location[1])) ? location[1] : <span class="charliteral">'.'</span>,
00851                         (isprint(location[2])) ? location[2] : <span class="charliteral">'.'</span>,
00852                         (isprint(location[3])) ? location[3] : <span class="charliteral">'.'</span>);
00853                 location += 4;
00854             }
00855             <span class="keywordflow">break</span>;
00856         }
00857 
00858         printf(<span class="stringliteral">"%s   %s*\n"</span>, outHexLine, outPrintable);
00859     }
00860     printf(<span class="stringliteral">"\n"</span>);
00861     free(internalBuffer);
00862 }
00863 
00864 
00865 <span class="keywordtype">void</span>
<a name="l00866"></a><a class="code" href="../../d2/d5/editreg_8c.html#a67">00866</a> <a class="code" href="../../d2/d5/editreg_8c.html#a67">UnicodePrint</a>(
00867     PUNICODE_STRING  UnicodeString
00868     )
00869 
00870 <span class="comment">/*++</span>
00871 <span class="comment"></span>
00872 <span class="comment">Routine Description:</span>
00873 <span class="comment"></span>
00874 <span class="comment">    Print a unicode string.</span>
00875 <span class="comment"></span>
00876 <span class="comment">Arguments:</span>
00877 <span class="comment"></span>
00878 <span class="comment">    UnicodeString - pointer to the string.</span>
00879 <span class="comment"></span>
00880 <span class="comment">Return Value:</span>
00881 <span class="comment"></span>
00882 <span class="comment">    None.</span>
00883 <span class="comment"></span>
00884 <span class="comment">--*/</span>
00885 {
00886     ANSI_STRING ansiString;
00887     PUCHAR      tempbuffer = (PUCHAR) malloc(<a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
00888 
00889     ansiString.MaximumLength = <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>;
00890     ansiString.Length = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00891     ansiString.Buffer = tempbuffer;
00892 
00893     <a class="code" href="../../d6/d6/nls_8c.html#a23">RtlUnicodeStringToAnsiString</a>(&amp;ansiString,
00894                                  UnicodeString,
00895                                  (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00896     printf(<span class="stringliteral">"%s"</span>, ansiString.Buffer);
00897     free(tempbuffer);
00898     <span class="keywordflow">return</span>;
00899 }
00900 
00901 
00902 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00903"></a><a class="code" href="../../d2/d5/editreg_8c.html#a68">00903</a> <a class="code" href="../../d2/d5/editreg_8c.html#a68">Directory</a>(
00904     HANDLE  KeyHandle,
00905     BOOLEAN LongListing
00906     )
00907 
00908 <span class="comment">/*++</span>
00909 <span class="comment"></span>
00910 <span class="comment"></span>
00911 <span class="comment">Routine Description:</span>
00912 <span class="comment"></span>
00913 <span class="comment">Arguments:</span>
00914 <span class="comment"></span>
00915 <span class="comment">Return Value:</span>
00916 <span class="comment"></span>
00917 <span class="comment">--*/</span>
00918 
00919 {
00920     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>        status;
00921     ULONG           index;
00922     ULONG           resultLength;
00923     UNICODE_STRING  unicodeValueName;
00924     PKEY_BASIC_INFORMATION keyInformation;
00925 
00926     keyInformation = (PKEY_BASIC_INFORMATION) malloc(<a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
00927 
00928     <span class="keywordflow">for</span> (index = 0; <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; index++) {
00929 
00930         RtlZeroMemory(keyInformation, <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
00931 
00932         status = <a class="code" href="../../d7/d7/ntapi_8c.html#a17">NtEnumerateKey</a>(KeyHandle,
00933                                 index,
00934                                 KeyBasicInformation,
00935                                 keyInformation,
00936                                 <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>,
00937                                 &amp;resultLength);
00938 
00939         <span class="keywordflow">if</span> (status == STATUS_NO_MORE_ENTRIES) {
00940 
00941             <span class="keywordflow">break</span>;
00942 
00943         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
00944 
00945             printf(<span class="stringliteral">"readreg: Error on Enumerate status = %x\n"</span>, status);
00946             <span class="keywordflow">break</span>;
00947 
00948         }
00949 
00950         unicodeValueName.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)keyInformation-&gt;NameLength;
00951         unicodeValueName.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)keyInformation-&gt;NameLength;
00952         unicodeValueName.Buffer = (PWSTR)&amp;keyInformation-&gt;Name[0];
00953         <a class="code" href="../../d2/d5/editreg_8c.html#a67">UnicodePrint</a>(&amp;unicodeValueName);
00954         printf(<span class="stringliteral">"\n"</span>);
00955 
00956         <span class="keywordflow">if</span> (LongListing) {
00957         }
00958     }
00959 
00960     free(keyInformation);
00961     <span class="keywordflow">return</span> status;
00962 }
00963 
00964 
00965 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00966"></a><a class="code" href="../../d2/d5/editreg_8c.html#a69">00966</a> <a class="code" href="../../d2/d5/editreg_8c.html#a69">List</a>(
00967     HANDLE KeyHandle,
00968     PUCHAR ItemName
00969     )
00970 
00971 <span class="comment">/*++</span>
00972 <span class="comment"></span>
00973 <span class="comment"></span>
00974 <span class="comment">Routine Description:</span>
00975 <span class="comment"></span>
00976 <span class="comment">Arguments:</span>
00977 <span class="comment"></span>
00978 <span class="comment">Return Value:</span>
00979 <span class="comment"></span>
00980 <span class="comment">--*/</span>
00981 {
00982     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>       status;
00983     ULONG          index;
00984     ULONG          resultLength;
00985     ULONG          <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>;
00986     PUCHAR         typeString;
00987     UNICODE_STRING unicodeValueName;
00988     PKEY_VALUE_FULL_INFORMATION keyValueInformation;
00989 
00990     UNREFERENCED_PARAMETER(ItemName);
00991 
00992     resultLength = <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>;
00993     keyValueInformation = (PKEY_VALUE_FULL_INFORMATION)malloc(<a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
00994 
00995     <span class="keywordflow">for</span> (index = 0; <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; index++) {
00996 
00997         <span class="keywordflow">while</span> (1) {
00998 
00999             RtlZeroMemory(keyValueInformation, resultLength);
01000             status = <a class="code" href="../../d7/d7/ntapi_8c.html#a18">NtEnumerateValueKey</a>(KeyHandle,
01001                                          index,
01002                                          KeyValueFullInformation,
01003                                          keyValueInformation,
01004                                          resultLength,
01005                                          &amp;resultLength);
01006 
01007             <span class="keywordflow">if</span> (status == STATUS_BUFFER_OVERFLOW) {
01008                 free(keyValueInformation);
01009                 keyValueInformation = (PKEY_VALUE_FULL_INFORMATION)
01010                                            malloc(resultLength + 10);
01011             } <span class="keywordflow">else</span> {
01012                 <span class="keywordflow">break</span>;
01013             }
01014         }
01015 
01016         <span class="keywordflow">if</span> (status == STATUS_NO_MORE_ENTRIES) {
01017 
01018             <span class="keywordflow">break</span>;
01019 
01020         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01021 
01022             printf(<span class="stringliteral">"readreg: Cannot list (%x)\n"</span>, status);
01023             <span class="keywordflow">break</span>;
01024 
01025         }
01026 
01027         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = keyValueInformation-&gt;Type;
01028         typeString = <a class="code" href="../../d2/d5/editreg_8c.html#a64">FindTypeString</a>(<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>);
01029         unicodeValueName.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)keyValueInformation-&gt;NameLength;
01030         unicodeValueName.MaximumLength =(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)keyValueInformation-&gt;NameLength;
01031         unicodeValueName.Buffer = (PWSTR)&amp;keyValueInformation-&gt;Name[0];
01032         printf(<span class="stringliteral">"Name-&gt; "</span><span class="stringliteral">""</span>);
01033         <a class="code" href="../../d2/d5/editreg_8c.html#a67">UnicodePrint</a>(&amp;unicodeValueName);
01034         printf(<span class="stringliteral">""</span><span class="stringliteral">"\n"</span>);
01035         printf(<span class="stringliteral">"\ttype = %s (%d)\ttitle index = %d\tdata length = %d\n"</span>,
01036                typeString,
01037                <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>,
01038                keyValueInformation-&gt;TitleIndex,
01039                keyValueInformation-&gt;DataLength);
01040         printf(<span class="stringliteral">"\tData:\n"</span>);
01041 
01042         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a54">ForceDump</a>) {
01043             <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = REG_BINARY;
01044         }
01045 
01046         <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>) {
01047 
01048         <span class="keywordflow">case</span> REG_DWORD:
01049         <span class="comment">// case REG_DWORD_LITTLE_ENDIAN:</span>
01050             printf(<span class="stringliteral">"\tDWORD value == %d, (0x%x)\n"</span>,
01051                *((PULONG)((PUCHAR)keyValueInformation +
01052                                   keyValueInformation-&gt;DataOffset)),
01053                *((PULONG)((PUCHAR)keyValueInformation +
01054                                   keyValueInformation-&gt;DataOffset)));
01055             <span class="keywordflow">break</span>;
01056 
01057         <span class="keywordflow">case</span> REG_SZ:
01058 
01059             unicodeValueName.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)keyValueInformation-&gt;DataLength;
01060             unicodeValueName.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)
01061                                                 keyValueInformation-&gt;DataLength;
01062             unicodeValueName.Buffer = (PWSTR) ((PUCHAR) keyValueInformation +
01063                                                keyValueInformation-&gt;DataOffset);
01064             <a class="code" href="../../d2/d5/editreg_8c.html#a67">UnicodePrint</a>(&amp;unicodeValueName);
01065             <span class="keywordflow">break</span>;
01066 
01067         <span class="keywordflow">case</span> REG_BINARY:
01068         <span class="keywordflow">default</span>:
01069             <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a24">Dump</a>(((PUCHAR)keyValueInformation +keyValueInformation-&gt;DataOffset),
01070                  keyValueInformation-&gt;DataLength);
01071         }
01072         printf(<span class="stringliteral">"\n"</span>);
01073     }
01074 
01075     free(keyValueInformation);
01076     <span class="keywordflow">return</span> status;
01077 }
01078 
01079 
01080 UCHAR
<a name="l01081"></a><a class="code" href="../../d2/d5/editreg_8c.html#a70">01081</a> <a class="code" href="../../d2/d5/editreg_8c.html#a70">GetCharacter</a>(
01082     BOOLEAN Batch
01083     )
01084 
01085 <span class="comment">/*++</span>
01086 <span class="comment"></span>
01087 <span class="comment">Routine Description:</span>
01088 <span class="comment"></span>
01089 <span class="comment">    This routine returns a single character from the input stream.</span>
01090 <span class="comment">    It discards leading blanks if the input is not from the console.</span>
01091 <span class="comment"></span>
01092 <span class="comment">Arguments:</span>
01093 <span class="comment"></span>
01094 <span class="comment">    Batch - a boolean indicating if the input it coming from the console.</span>
01095 <span class="comment"></span>
01096 <span class="comment">Return Value:</span>
01097 <span class="comment"></span>
01098 <span class="comment">    A character</span>
01099 <span class="comment"></span>
01100 <span class="comment">--*/</span>
01101 
01102 {
01103     UCHAR <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
01104 
01105     <span class="keywordflow">if</span> (Batch) {
01106 
01107         <span class="keywordflow">while</span> ((<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = (UCHAR) getchar()) == <span class="charliteral">' '</span>)
01108             ;
01109 
01110     } <span class="keywordflow">else</span> {
01111 
01112         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = (UCHAR) getchar();
01113     }
01114 
01115     <span class="keywordflow">return</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
01116 } <span class="comment">// GetCharacter</span>
01117 
01118 
01119 PUCHAR
<a name="l01120"></a><a class="code" href="../../d2/d5/editreg_8c.html#a71">01120</a> <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(
01121     BOOLEAN Batch,
01122     PUCHAR  Prompt,
01123     BOOLEAN ConvertToLower
01124     )
01125 
01126 <span class="comment">/*++</span>
01127 <span class="comment"></span>
01128 <span class="comment">Routine Description:</span>
01129 <span class="comment"></span>
01130 <span class="comment">    This routine prints the prompt if the input is coming from the console,</span>
01131 <span class="comment">    then proceeds to collect the user input until a carraige return is typed.</span>
01132 <span class="comment"></span>
01133 <span class="comment">Arguments:</span>
01134 <span class="comment"></span>
01135 <span class="comment">    Batch  - a boolean indicating if the input is coming from the console.</span>
01136 <span class="comment">    Prompt - String to prompt with.</span>
01137 <span class="comment"></span>
01138 <span class="comment">Return Value:</span>
01139 <span class="comment"></span>
01140 <span class="comment">    A pointer to the input string.</span>
01141 <span class="comment">    NULL if the user escaped.</span>
01142 <span class="comment"></span>
01143 <span class="comment">--*/</span>
01144 
01145 {
01146     <span class="comment">//</span>
01147     <span class="comment">// The command line data area is used to store the argument string.</span>
01148     <span class="comment">//</span>
01149 
01150     PUCHAR argument = <a class="code" href="../../d2/d5/editreg_8c.html#a48">CommandLine</a>;
01151     <span class="keywordtype">int</span>    i;
01152     UCHAR  <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
01153 
01154     <span class="keywordflow">if</span> (!Batch) {
01155 
01156         printf(<span class="stringliteral">"%s"</span>, Prompt);
01157     }
01158 
01159     <span class="keywordflow">while</span> ((<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a70">GetCharacter</a>(Batch)) == <span class="charliteral">' '</span>) {
01160 
01161         <span class="comment">//</span>
01162         <span class="comment">// Ignore leading spaces.</span>
01163         <span class="comment">//</span>
01164     }
01165 
01166     i = 0;
01167     <span class="keywordflow">while</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>) {
01168 
01169         putchar(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>);
01170 
01171         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <a class="code" href="../../d2/d5/editreg_8c.html#a32">CTRL_C</a>) {
01172 
01173             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01174         }
01175 
01176         <span class="keywordflow">if</span> ((<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">'\n'</span>) || (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">'\r'</span>)) {
01177 
01178             putchar(<span class="charliteral">'\n'</span>);
01179 
01180             <span class="keywordflow">if</span> (i == 0) {
01181                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01182             } <span class="keywordflow">else</span> {
01183                 <span class="keywordflow">break</span>;
01184             }
01185         }
01186 
01187         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">'\b'</span>) {
01188 
01189             <span class="keywordflow">if</span> (i &gt; 0) {
01190 
01191                 <span class="comment">//</span>
01192                 <span class="comment">// blank over last char</span>
01193                 <span class="comment">//</span>
01194 
01195                 putchar(<span class="charliteral">' '</span>);
01196                 putchar(<span class="charliteral">'\b'</span>);
01197                 i--;
01198 
01199             } <span class="keywordflow">else</span> {
01200 
01201                 <span class="comment">//</span>
01202                 <span class="comment">// space forward to keep prompt in the same place.</span>
01203                 <span class="comment">//</span>
01204 
01205                 putchar(<span class="charliteral">' '</span>);
01206             }
01207 
01208         } <span class="keywordflow">else</span> {
01209 
01210             <span class="comment">//</span>
01211             <span class="comment">// Collect the argument.</span>
01212             <span class="comment">//</span>
01213 
01214             <span class="keywordflow">if</span> (ConvertToLower == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01215                 argument[i] = (UCHAR) tolower(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>);
01216             } <span class="keywordflow">else</span> {
01217                 argument[i] = (UCHAR) <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
01218             }
01219             i++;
01220 
01221         }
01222 
01223         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a70">GetCharacter</a>(Batch);
01224     }
01225 
01226     argument[i] = <span class="charliteral">'\0'</span>;
01227     <span class="keywordflow">return</span> <a class="code" href="../../d2/d5/editreg_8c.html#a48">CommandLine</a>;
01228 
01229 } <span class="comment">// GetArgumentString</span>
01230 
01231 
01232 ULONG
<a name="l01233"></a><a class="code" href="../../d2/d5/editreg_8c.html#a72">01233</a> <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(
01234     PUCHAR  *ArgumentPtr
01235     )
01236 
01237 <span class="comment">/*++</span>
01238 <span class="comment"></span>
01239 <span class="comment">Routine Description:</span>
01240 <span class="comment"></span>
01241 <span class="comment">    This routine prints the prompt if the input is coming from the console.</span>
01242 <span class="comment"></span>
01243 <span class="comment">Arguments:</span>
01244 <span class="comment"></span>
01245 <span class="comment">    Batch - a boolean indicating if the input is coming from the console.</span>
01246 <span class="comment"></span>
01247 <span class="comment">Return Value:</span>
01248 <span class="comment"></span>
01249 <span class="comment">    None</span>
01250 <span class="comment"></span>
01251 <span class="comment">--*/</span>
01252 
01253 {
01254     UCHAR   <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
01255     ULONG   number;
01256     <span class="keywordtype">int</span>     i;
01257     BOOLEAN complete = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01258     PUCHAR  argument = *ArgumentPtr;
01259 
01260     <span class="keywordflow">while</span> (*argument == <span class="charliteral">' '</span>) {
01261 
01262         <span class="comment">//</span>
01263         <span class="comment">// skip spaces.</span>
01264         <span class="comment">//</span>
01265 
01266         argument++;
01267     }
01268 
01269     <span class="comment">//</span>
01270     <span class="comment">// Assume there is only one option to parse until proven</span>
01271     <span class="comment">// otherwise.</span>
01272     <span class="comment">//</span>
01273 
01274     *ArgumentPtr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01275 
01276     i = 0;
01277 
01278     <span class="keywordflow">while</span> (complete == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01279 
01280         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = argument[i];
01281 
01282         <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>) {
01283 
01284         <span class="keywordflow">case</span> <span class="charliteral">'\n'</span>:
01285         <span class="keywordflow">case</span> <span class="charliteral">'\r'</span>:
01286         <span class="keywordflow">case</span> <span class="charliteral">'\t'</span>:
01287         <span class="keywordflow">case</span> <span class="charliteral">' '</span>:
01288 
01289             <span class="comment">//</span>
01290             <span class="comment">// Update the caller argument pointer to the remaining string.</span>
01291             <span class="comment">//</span>
01292 
01293             *ArgumentPtr = &amp;argument[i + 1];
01294 
01295             <span class="comment">//</span>
01296             <span class="comment">// fall through.</span>
01297             <span class="comment">//</span>
01298 
01299         <span class="keywordflow">case</span> <span class="charliteral">'\0'</span>:
01300 
01301             argument[i] = <span class="charliteral">'\0'</span>;
01302             complete = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01303             <span class="keywordflow">break</span>;
01304 
01305         <span class="keywordflow">default</span>:
01306 
01307             i++;
01308             <span class="keywordflow">break</span>;
01309         }
01310 
01311     }
01312 
01313     <span class="keywordflow">if</span> (i &gt; 0) {
01314         number = (ULONG) atoi(argument);
01315     } <span class="keywordflow">else</span> {
01316         number = (ULONG) -1;
01317     }
01318 
01319     <span class="keywordflow">return</span> number;
01320 
01321 } <span class="comment">// ParseArgumentNumeric</span>
01322 
01323 
01324 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01325"></a><a class="code" href="../../d2/d5/editreg_8c.html#a73">01325</a> <a class="code" href="../../d2/d5/editreg_8c.html#a73">PromptUser</a>(
01326     BOOLEAN Batch
01327     )
01328 
01329 <span class="comment">/*++</span>
01330 <span class="comment"></span>
01331 <span class="comment">Routine Description:</span>
01332 <span class="comment"></span>
01333 <span class="comment">    This routine prints the prompt if the input is coming from the console.</span>
01334 <span class="comment"></span>
01335 <span class="comment">Arguments:</span>
01336 <span class="comment"></span>
01337 <span class="comment">    Batch - a boolean indicating if the input is coming from the console.</span>
01338 <span class="comment"></span>
01339 <span class="comment">Return Value:</span>
01340 <span class="comment"></span>
01341 <span class="comment">    None</span>
01342 <span class="comment"></span>
01343 <span class="comment">--*/</span>
01344 
01345 {
01346     <span class="keywordflow">if</span> (!Batch) {
01347 
01348         printf(<span class="stringliteral">"\n%s&gt; "</span>, <a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>);
01349     }
01350 
01351 } <span class="comment">// PromptUser</span>
01352 
01353 
01354 <span class="keywordtype">int</span>
<a name="l01355"></a><a class="code" href="../../d2/d5/editreg_8c.html#a74">01355</a> <a class="code" href="../../d2/d5/editreg_8c.html#a74">GetCommand</a>(
01356     BOOLEAN Batch,
01357     PUCHAR *ArgumentPtr
01358     )
01359 <span class="comment">/*++</span>
01360 <span class="comment"></span>
01361 <span class="comment">Routine Description:</span>
01362 <span class="comment"></span>
01363 <span class="comment">    This routine processes the user input and returns the code for the</span>
01364 <span class="comment">    command entered.  If the command has an argument, either the default</span>
01365 <span class="comment">    value for the argument (if none is given) or the value provided by the</span>
01366 <span class="comment">    user is returned.</span>
01367 <span class="comment"></span>
01368 <span class="comment">Arguments:</span>
01369 <span class="comment"></span>
01370 <span class="comment">    Batch - a boolean indicating if the input it coming from the console.</span>
01371 <span class="comment"></span>
01372 <span class="comment">Return Value:</span>
01373 <span class="comment"></span>
01374 <span class="comment">    A command code</span>
01375 <span class="comment"></span>
01376 <span class="comment">--*/</span>
01377 
01378 {
01379     <span class="keywordtype">int</span>    i;
01380     <span class="keywordtype">int</span>    commandIndex;
01381     <span class="keywordtype">int</span>    commandCode;
01382     UCHAR  <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
01383     PUCHAR commandPtr;
01384     PUCHAR command = <a class="code" href="../../d2/d5/editreg_8c.html#a48">CommandLine</a>;
01385     <span class="keywordtype">int</span>    argumentIndex = -1;
01386     PUCHAR argument = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01387 
01388     <a class="code" href="../../d2/d5/editreg_8c.html#a73">PromptUser</a>(Batch);
01389 
01390     <span class="keywordflow">while</span> ((<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a70">GetCharacter</a>(Batch)) == <span class="charliteral">' '</span>) {
01391 
01392         <span class="comment">//</span>
01393         <span class="comment">// Ignore leading spaces.</span>
01394         <span class="comment">//</span>
01395     }
01396 
01397     i = 0;
01398     <span class="keywordflow">while</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>) {
01399 
01400         putchar(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>);
01401 
01402         <span class="keywordflow">if</span> ((<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">'\n'</span>) || (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">'\r'</span>)) {
01403             putchar(<span class="charliteral">'\n'</span>);
01404             <span class="keywordflow">if</span> (i == 0) {
01405                 <a class="code" href="../../d2/d5/editreg_8c.html#a73">PromptUser</a>(Batch);
01406                 <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a70">GetCharacter</a>(Batch);
01407                 <span class="keywordflow">continue</span>;
01408             }
01409             <span class="keywordflow">break</span>;
01410         }
01411 
01412         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">'\b'</span>) {
01413 
01414             <span class="keywordflow">if</span> (i &gt; 0) {
01415 
01416                 <span class="comment">//</span>
01417                 <span class="comment">// blank over last char</span>
01418                 <span class="comment">//</span>
01419 
01420                 putchar(<span class="charliteral">' '</span>);
01421                 putchar(<span class="charliteral">'\b'</span>);
01422                 i--;
01423 
01424                 <span class="keywordflow">if</span> (argumentIndex == i) {
01425                     argumentIndex = -1;
01426                     argument = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01427                 }
01428             } <span class="keywordflow">else</span> {
01429 
01430                 <span class="comment">//</span>
01431                 <span class="comment">// space forward to keep prompt in the same place.</span>
01432                 <span class="comment">//</span>
01433 
01434                 putchar(<span class="charliteral">' '</span>);
01435             }
01436         } <span class="keywordflow">else</span> {
01437 
01438             <span class="comment">//</span>
01439             <span class="comment">// Collect the command.</span>
01440             <span class="comment">//</span>
01441 
01442             command[i] = (UCHAR)tolower(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>);
01443             i++;
01444         }
01445 
01446         <span class="keywordflow">if</span> ((<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == <span class="charliteral">' '</span>) &amp;&amp; (argument == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
01447 
01448             argument = &amp;command[i];
01449             argumentIndex = i;
01450             command[i - 1] = <span class="charliteral">'\0'</span>;
01451         }
01452 
01453         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a70">GetCharacter</a>(Batch);
01454     }
01455 
01456     <span class="comment">//</span>
01457     <span class="comment">// add end of string.</span>
01458     <span class="comment">//</span>
01459 
01460     command[i] = <span class="charliteral">'\0'</span>;
01461 
01462     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a>) {
01463         printf(<span class="stringliteral">"command =&gt; %s$\n"</span>, command);
01464     }
01465 
01466     <span class="comment">//</span>
01467     <span class="comment">// Identify the command and return its code.</span>
01468     <span class="comment">//</span>
01469 
01470     commandIndex = 0;
01471 
01472     <span class="keywordflow">for</span> (commandPtr = <a class="code" href="../../d2/d5/editreg_8c.html#a43">Commands</a>[commandIndex];
01473          commandPtr != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01474          commandPtr = <a class="code" href="../../d2/d5/editreg_8c.html#a43">Commands</a>[commandIndex]) {
01475 
01476         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a>) {
01477             printf(<span class="stringliteral">"Testing =&gt; %s$ ... "</span>, commandPtr);
01478         }
01479 
01480         i = 0;
01481         <span class="keywordflow">while</span> (commandPtr[i] == command[i]) {
01482             <span class="keywordflow">if</span> (command[i] == <span class="charliteral">'\0'</span>) {
01483                 <span class="keywordflow">break</span>;
01484             }
01485             i++;
01486         }
01487 
01488         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a>) {
01489             printf(<span class="stringliteral">" i == %d, command[i] == 0x%x\n"</span>, i, command[i]);
01490         }
01491 
01492         <span class="keywordflow">if</span> (command[i]) {
01493 
01494             <span class="comment">//</span>
01495             <span class="comment">// Not complete there was a mismatch on the command.</span>
01496             <span class="comment">//</span>
01497 
01498             commandIndex++;
01499             <span class="keywordflow">continue</span>;
01500         }
01501 
01502         <span class="comment">//</span>
01503         <span class="comment">// Have a match on the command.</span>
01504         <span class="comment">//</span>
01505 
01506         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a>) {
01507             printf(<span class="stringliteral">"Command match %d, argument %s\n"</span>,
01508                    commandIndex,
01509                    (argument == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ? <span class="stringliteral">"(none)"</span> : argument);
01510         }
01511 
01512         commandCode = <a class="code" href="../../d2/d5/editreg_8c.html#a44">CommandMap</a>[commandIndex];
01513         *ArgumentPtr = argument;
01514         <span class="keywordflow">return</span> commandCode;
01515     }
01516 
01517     printf(<span class="stringliteral">"Command was invalid\n"</span>);
01518     <span class="keywordflow">return</span> <a class="code" href="../../d2/d5/editreg_8c.html#a8">INVALID</a>;
01519 } <span class="comment">// GetCommand</span>
01520 
01521 
01522 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01523"></a><a class="code" href="../../d2/d5/editreg_8c.html#a75">01523</a> <a class="code" href="../../d2/d5/editreg_8c.html#a75">NotImplemented</a>()
01524 
01525 <span class="comment">/*++</span>
01526 <span class="comment"></span>
01527 <span class="comment">--*/</span>
01528 
01529 {
01530     printf(<span class="stringliteral">"Sorry, function not implemented yet.\n"</span>);
01531 }
01532 
01533 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l01534"></a><a class="code" href="../../d2/d5/editreg_8c.html#a76">01534</a> <a class="code" href="../../d2/d5/editreg_8c.html#a76">FtReturnValue</a>(
01535     IN HANDLE Handle,
01536     IN PUCHAR ValueName,
01537     IN PUCHAR Buffer,
01538     IN ULONG  BufferLength
01539     )
01540 
01541 <span class="comment">/*++</span>
01542 <span class="comment"></span>
01543 <span class="comment">Routine Description:</span>
01544 <span class="comment"></span>
01545 <span class="comment">    Formatted display of the disk registry information.</span>
01546 <span class="comment"></span>
01547 <span class="comment">Arguments:</span>
01548 <span class="comment"></span>
01549 <span class="comment">    None.</span>
01550 <span class="comment"></span>
01551 <span class="comment">Return Values:</span>
01552 <span class="comment"></span>
01553 <span class="comment">    None.</span>
01554 <span class="comment"></span>
01555 <span class="comment">--*/</span>
01556 
01557 {
01558     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>       status;
01559     ULONG          resultLength;
01560     ULONG          length;
01561     STRING         valueString;
01562     UNICODE_STRING unicodeValueName;
01563     PUCHAR         internalBuffer;
01564     PKEY_VALUE_FULL_INFORMATION keyValueInformation;
01565 
01566     keyValueInformation = (PKEY_VALUE_FULL_INFORMATION)malloc(<a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
01567     <span class="keywordflow">if</span> (keyValueInformation == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01568         printf(<span class="stringliteral">"FtReturnValue: cannot allocate memory.\n"</span>);
01569         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01570     }
01571 
01572     <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>(&amp;valueString,
01573                   <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>);
01574     <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeValueName,
01575                                  &amp;valueString,
01576                                  (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01577     status = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>,
01578                              &amp;unicodeValueName,
01579                              KeyValueFullInformation,
01580                              keyValueInformation,
01581                              <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>,
01582                              &amp;resultLength);
01583     <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeValueName);
01584 
01585     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01586         length = (resultLength &gt; BufferLength) ? BufferLength : resultLength;
01587         internalBuffer =
01588            ((PUCHAR)keyValueInformation + keyValueInformation-&gt;DataOffset);
01589 
01590         RtlMoveMemory(<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>, internalBuffer, length);
01591     }
01592     free(keyValueInformation);
01593     <span class="keywordflow">return</span> status;
01594 }
01595 
01596 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01597"></a><a class="code" href="../../d2/d5/editreg_8c.html#a77">01597</a> <a class="code" href="../../d2/d5/editreg_8c.html#a77">DiskDump</a>()
01598 
01599 <span class="comment">/*++</span>
01600 <span class="comment"></span>
01601 <span class="comment">Routine Description:</span>
01602 <span class="comment"></span>
01603 <span class="comment">    Formatted display of the disk registry information.</span>
01604 <span class="comment"></span>
01605 <span class="comment">Arguments:</span>
01606 <span class="comment"></span>
01607 <span class="comment">    None.</span>
01608 <span class="comment"></span>
01609 <span class="comment">Return Values:</span>
01610 <span class="comment"></span>
01611 <span class="comment">    None.</span>
01612 <span class="comment"></span>
01613 <span class="comment">--*/</span>
01614 
01615 {
01616     ULONG               outerLoop;
01617     ULONG               innerLoop;
01618     HANDLE              handle;
01619     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            status;
01620     PDISK_CONFIG_HEADER configHeader;
01621     PDISK_REGISTRY      diskRegistry;
01622     PDISK_DESCRIPTION   diskDescription;
01623     PDISK_PARTITION     diskPartition;
01624     PFT_REGISTRY        ftRegistry;
01625     PFT_DESCRIPTION     ftDescription;
01626     PFT_MEMBER_DESCRIPTION ftMember;
01627 
01628     status = <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(&amp;handle,
01629                        DISK_REGISTRY_KEY);
01630 
01631     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01632         printf(<span class="stringliteral">"Currently there is no key in the registry"</span>
01633                <span class="stringliteral">" for the disk information.\n"</span>);
01634         <span class="keywordflow">return</span>;
01635     }
01636 
01637     configHeader = (PDISK_CONFIG_HEADER) malloc(<a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
01638     <span class="keywordflow">if</span> (configHeader == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01639         printf(<span class="stringliteral">"Unable to allocate memory for the disk registy information.\n"</span>);
01640         <span class="keywordflow">return</span>;
01641     }
01642 
01643     RtlZeroMemory(configHeader, <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
01644 
01645     status = <a class="code" href="../../d2/d5/editreg_8c.html#a76">FtReturnValue</a>(handle,
01646                            (PUCHAR) DISK_REGISTRY_VALUE,
01647                            (PUCHAR) configHeader,
01648                            <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
01649     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(handle);
01650 
01651     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01652         printf(<span class="stringliteral">"There is no disk registry information (%x)\n"</span>, status);
01653         free(configHeader);
01654         <span class="keywordflow">return</span>;
01655     }
01656 
01657     <span class="comment">//</span>
01658     <span class="comment">// Print the header.</span>
01659     <span class="comment">//</span>
01660 
01661     printf(<span class="stringliteral">"Registry header information:\n"</span>);
01662     printf(<span class="stringliteral">"\tVersion = 0x%x, Checksum = 0x%x\n"</span>,
01663            configHeader-&gt;Version,
01664            configHeader-&gt;CheckSum);
01665     printf(<span class="stringliteral">"\tDisk info Offset = 0x%x, Size = 0x%x\n"</span>,
01666            configHeader-&gt;DiskInformationOffset,
01667            configHeader-&gt;DiskInformationSize);
01668     printf(<span class="stringliteral">"\tFT info Offset = 0x%x, Size = 0x%x\n"</span>,
01669            configHeader-&gt;FtInformationOffset,
01670            configHeader-&gt;FtInformationSize);
01671 
01672     <span class="comment">//</span>
01673     <span class="comment">// Print the information on disks.</span>
01674     <span class="comment">//</span>
01675 
01676     diskRegistry = (PDISK_REGISTRY)
01677                  ((PUCHAR) configHeader + configHeader-&gt;DiskInformationOffset);
01678     printf(<span class="stringliteral">"\nDisk information for %d disks:\n"</span>,
01679            diskRegistry-&gt;NumberOfDisks);
01680 
01681     diskDescription = &amp;diskRegistry-&gt;Disks[0];
01682     <span class="keywordflow">for</span> (outerLoop = 0;
01683          outerLoop &lt; diskRegistry-&gt;NumberOfDisks;
01684          outerLoop++) {
01685 
01686         printf(<span class="stringliteral">"\nDisk %d signature 0x%08x has %d partitions:\n"</span>,
01687                outerLoop,
01688                diskDescription-&gt;Signature,
01689                diskDescription-&gt;NumberOfPartitions);
01690 
01691         printf(<span class="stringliteral">"       Ln Type  Start              Length             FtGrp  Member\n"</span>);
01692         <span class="keywordflow">for</span> (innerLoop = 0;
01693              innerLoop &lt; diskDescription-&gt;NumberOfPartitions;
01694              innerLoop++) {
01695             diskPartition = &amp;diskDescription-&gt;Partitions[innerLoop];
01696             printf(<span class="stringliteral">"  %c: %c %1d   %3d  %08x:%08x  %08x:%08x  %5d  %4d  %s\n"</span>,
01697                    (diskPartition-&gt;DriveLetter != <span class="charliteral">'\0'</span>) ?
01698                                                diskPartition-&gt;DriveLetter : <span class="charliteral">' '</span>,
01699                    (diskPartition-&gt;AssignDriveLetter) ? <span class="charliteral">'A'</span> : <span class="charliteral">' '</span>,
01700                    diskPartition-&gt;LogicalNumber,
01701                    diskPartition-&gt;FtType,
01702                    diskPartition-&gt;StartingOffset.HighPart,
01703                    diskPartition-&gt;StartingOffset.LowPart,
01704                    diskPartition-&gt;Length.HighPart,
01705                    diskPartition-&gt;Length.LowPart,
01706                    diskPartition-&gt;FtGroup,
01707                    diskPartition-&gt;FtMember,
01708                    (diskPartition-&gt;FtState == Orphaned) ? <span class="stringliteral">"Orphan"</span> :
01709                      (diskPartition-&gt;FtState == Regenerating) ? <span class="stringliteral">"Regen"</span> :
01710                      (diskPartition-&gt;FtState == Initializing) ? <span class="stringliteral">"Init"</span> : <span class="stringliteral">""</span>);
01711 
01712         }
01713 
01714         diskDescription = (PDISK_DESCRIPTION)
01715           &amp;diskDescription-&gt;Partitions[diskDescription-&gt;NumberOfPartitions];
01716     }
01717 
01718     <span class="comment">//</span>
01719     <span class="comment">// Print the information for FT.</span>
01720     <span class="comment">//</span>
01721 
01722     <span class="keywordflow">if</span> (configHeader-&gt;FtInformationSize == 0) {
01723         printf(<span class="stringliteral">"There is no FT configuration.\n"</span>);
01724         free(configHeader);
01725         <span class="keywordflow">return</span>;
01726     }
01727 
01728     ftRegistry = (PFT_REGISTRY)
01729                  ((PUCHAR) configHeader + configHeader-&gt;FtInformationOffset);
01730 
01731     printf(<span class="stringliteral">"\nNumber of FT components = %d\n"</span>,
01732            ftRegistry-&gt;NumberOfComponents);
01733 
01734     ftDescription = &amp;ftRegistry-&gt;FtDescription[0];
01735     <span class="keywordflow">for</span> (outerLoop = 0;
01736          outerLoop &lt; ftRegistry-&gt;NumberOfComponents;
01737          outerLoop++) {
01738 
01739         printf(<span class="stringliteral">"Component %d has %d members and is type %d\n"</span>,
01740                outerLoop,
01741                ftDescription-&gt;NumberOfMembers,
01742                ftDescription-&gt;Type);
01743 
01744         printf(<span class="stringliteral">"      State Signature Start              Length            #\n"</span>);
01745         <span class="keywordflow">for</span> (innerLoop = 0;
01746              innerLoop &lt; ftDescription-&gt;NumberOfMembers;
01747              innerLoop++) {
01748             ftMember = &amp;ftDescription-&gt;FtMemberDescription[innerLoop];
01749 
01750             diskPartition = (PDISK_PARTITION)
01751                  ((PUCHAR) configHeader + ftMember-&gt;OffsetToPartitionInfo);
01752             
01753             printf(<span class="stringliteral">"%5x    %2x %08x  %08x:%08x  %08x:%08x %d\n"</span>,
01754                    ftMember-&gt;OffsetToPartitionInfo,
01755                    ftMember-&gt;State,
01756                    ftMember-&gt;Signature,
01757                    diskPartition-&gt;StartingOffset.HighPart,
01758                    diskPartition-&gt;StartingOffset.LowPart,
01759                    diskPartition-&gt;Length.HighPart,
01760                    diskPartition-&gt;Length.LowPart,
01761                    ftMember-&gt;LogicalNumber);
01762         }
01763 
01764         ftDescription = (PFT_DESCRIPTION)
01765          &amp;ftDescription-&gt;FtMemberDescription[ftDescription-&gt;NumberOfMembers];
01766     }
01767 }
01768 
01769 
01770 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01771"></a><a class="code" href="../../d2/d5/editreg_8c.html#a78">01771</a> <a class="code" href="../../d2/d5/editreg_8c.html#a78">ChangeMemberState</a>(
01772     IN ULONG Type,
01773     IN ULONG Group,
01774     IN ULONG Member,
01775     IN FT_PARTITION_STATE NewState
01776     )
01777 
01778 <span class="comment">/*++</span>
01779 <span class="comment"></span>
01780 <span class="comment">Routine Description:</span>
01781 <span class="comment"></span>
01782 <span class="comment">    Set the FT state for a partition.</span>
01783 <span class="comment"></span>
01784 <span class="comment">Arguments:</span>
01785 <span class="comment"></span>
01786 <span class="comment">    Type   - the FT type.</span>
01787 <span class="comment">    Group  - the FT Group number for that type.</span>
01788 <span class="comment">    Member - the member number within the group.</span>
01789 <span class="comment"></span>
01790 <span class="comment">Return Values:</span>
01791 <span class="comment"></span>
01792 <span class="comment">    None.</span>
01793 <span class="comment"></span>
01794 <span class="comment">--*/</span>
01795 
01796 {
01797     BOOLEAN             writeBackRegistry = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01798     HANDLE              handle;
01799     ULONG               outerLoop;
01800     ULONG               innerLoop;
01801     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            status;
01802     PDISK_CONFIG_HEADER configHeader;
01803     PDISK_REGISTRY      diskRegistry;
01804     PDISK_DESCRIPTION   diskDescription;
01805     PDISK_PARTITION     partitionDescription;
01806 
01807     status = <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(&amp;handle,
01808                        DISK_REGISTRY_KEY);
01809 
01810     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01811         printf(<span class="stringliteral">"Currently there is no key in the registry"</span>
01812                <span class="stringliteral">" for the disk information.\n"</span>);
01813         <span class="keywordflow">return</span>;
01814     }
01815 
01816     configHeader = (PDISK_CONFIG_HEADER) malloc(<a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
01817     <span class="keywordflow">if</span> (configHeader == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01818         printf(<span class="stringliteral">"Unable to allocate memory for the disk registy information.\n"</span>);
01819         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(handle);
01820         <span class="keywordflow">return</span>;
01821     }
01822 
01823     RtlZeroMemory(configHeader, <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
01824 
01825     status = <a class="code" href="../../d2/d5/editreg_8c.html#a76">FtReturnValue</a>(handle,
01826                            (PUCHAR) DISK_REGISTRY_VALUE,
01827                            (PUCHAR) configHeader,
01828                            <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
01829 
01830     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
01831         printf(<span class="stringliteral">"There is no disk registry information (%x)\n"</span>, status);
01832         free(configHeader);
01833         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(handle);
01834         <span class="keywordflow">return</span>;
01835     }
01836 
01837     diskRegistry = (PDISK_REGISTRY)
01838                  ((PUCHAR) configHeader + configHeader-&gt;DiskInformationOffset);
01839 
01840     diskDescription = &amp;diskRegistry-&gt;Disks[0];
01841     <span class="keywordflow">for</span> (outerLoop = 0;
01842          outerLoop &lt; diskRegistry-&gt;NumberOfDisks;
01843          outerLoop++) {
01844 
01845         <span class="keywordflow">for</span> (innerLoop = 0;
01846              innerLoop &lt; diskDescription-&gt;NumberOfPartitions;
01847              innerLoop++) {
01848 
01849             partitionDescription = &amp;diskDescription-&gt;Partitions[innerLoop];
01850 
01851             <span class="keywordflow">if</span> ((partitionDescription-&gt;FtType == (FT_TYPE) Type) &amp;&amp;
01852                 (partitionDescription-&gt;FtGroup == (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a>) &amp;&amp;
01853                 (partitionDescription-&gt;FtMember == (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) Member)) {
01854 
01855                 partitionDescription-&gt;FtState = NewState;
01856                 writeBackRegistry = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01857                 <span class="keywordflow">break</span>;
01858             }
01859         }
01860 
01861         <span class="keywordflow">if</span> (writeBackRegistry == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
01862             ULONG size;
01863 
01864             <span class="keywordflow">if</span> (configHeader-&gt;FtInformationSize == 0) {
01865                 printf(<span class="stringliteral">"Seems a little odd to be setting FT state "</span> <span class="comment">// no comma</span>
01866                        <span class="stringliteral">"with no FT information...\n"</span>);
01867                 size = configHeader-&gt;DiskInformationOffset +
01868                        configHeader-&gt;DiskInformationSize;
01869             } <span class="keywordflow">else</span> {
01870                 size = configHeader-&gt;FtInformationOffset +
01871                        configHeader-&gt;FtInformationSize;
01872             }
01873 
01874             (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d2/d5/editreg_8c.html#a63">FtSetValue</a>(handle,
01875                               (PUCHAR) DISK_REGISTRY_VALUE,
01876                               (PUCHAR) configHeader,
01877                               size,
01878                               REG_BINARY);
01879             <span class="keywordflow">break</span>;
01880         }
01881         diskDescription = (PDISK_DESCRIPTION)
01882               &amp;diskDescription-&gt;Partitions[diskDescription-&gt;NumberOfPartitions];
01883     }
01884 
01885     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(handle);
01886     free(configHeader);
01887 }
01888 
01889 
01890 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01891"></a><a class="code" href="../../d2/d5/editreg_8c.html#a79">01891</a> <a class="code" href="../../d2/d5/editreg_8c.html#a79">RestoreOrphan</a>(
01892     IN ULONG Type,
01893     IN ULONG Group,
01894     IN ULONG Member
01895     )
01896 
01897 <span class="comment">/*++</span>
01898 <span class="comment"></span>
01899 <span class="comment">Routine Description:</span>
01900 <span class="comment"></span>
01901 <span class="comment">    Set the FT state for a partition back to Healthy.</span>
01902 <span class="comment"></span>
01903 <span class="comment">Arguments:</span>
01904 <span class="comment"></span>
01905 <span class="comment">    Type   - the FT type.</span>
01906 <span class="comment">    Group  - the FT Group number for that type.</span>
01907 <span class="comment">    Member - the member number within the group.</span>
01908 <span class="comment"></span>
01909 <span class="comment">Return Values:</span>
01910 <span class="comment"></span>
01911 <span class="comment">    None.</span>
01912 <span class="comment"></span>
01913 <span class="comment">--*/</span>
01914 
01915 {
01916     <a class="code" href="../../d2/d5/editreg_8c.html#a78">ChangeMemberState</a>(Type,
01917                       <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a>,
01918                       Member,
01919                       Healthy);
01920 }
01921 
01922 
01923 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01924"></a><a class="code" href="../../d2/d5/editreg_8c.html#a80">01924</a> <a class="code" href="../../d2/d5/editreg_8c.html#a80">OrphanMember</a>(
01925     IN ULONG Type,
01926     IN ULONG Group,
01927     IN ULONG Member
01928     )
01929 
01930 <span class="comment">/*++</span>
01931 <span class="comment"></span>
01932 <span class="comment">Routine Description:</span>
01933 <span class="comment"></span>
01934 <span class="comment">    Set the FT state for a partition to Orphaned.</span>
01935 <span class="comment"></span>
01936 <span class="comment">Arguments:</span>
01937 <span class="comment"></span>
01938 <span class="comment">    Type   - the FT type.</span>
01939 <span class="comment">    Group  - the FT Group number for that type.</span>
01940 <span class="comment">    Member - the member number within the group.</span>
01941 <span class="comment"></span>
01942 <span class="comment">Return Values:</span>
01943 <span class="comment"></span>
01944 <span class="comment">    None.</span>
01945 <span class="comment"></span>
01946 <span class="comment">--*/</span>
01947 
01948 {
01949     <a class="code" href="../../d2/d5/editreg_8c.html#a78">ChangeMemberState</a>(Type,
01950                       <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a>,
01951                       Member,
01952                       Orphaned);
01953 }
01954 
01955 
01956 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01957"></a><a class="code" href="../../d2/d5/editreg_8c.html#a81">01957</a> <a class="code" href="../../d2/d5/editreg_8c.html#a81">RegenerateMember</a>(
01958     IN ULONG Type,
01959     IN ULONG Group,
01960     IN ULONG Member
01961     )
01962 
01963 <span class="comment">/*++</span>
01964 <span class="comment"></span>
01965 <span class="comment">Routine Description:</span>
01966 <span class="comment"></span>
01967 <span class="comment">    Set the FT state for a partition to regenerate.</span>
01968 <span class="comment"></span>
01969 <span class="comment">Arguments:</span>
01970 <span class="comment"></span>
01971 <span class="comment">    Type   - the FT type.</span>
01972 <span class="comment">    Group  - the FT Group number for that type.</span>
01973 <span class="comment">    Member - the member number within the group.</span>
01974 <span class="comment"></span>
01975 <span class="comment">Return Values:</span>
01976 <span class="comment"></span>
01977 <span class="comment">    None.</span>
01978 <span class="comment"></span>
01979 <span class="comment">--*/</span>
01980 
01981 {
01982     <a class="code" href="../../d2/d5/editreg_8c.html#a78">ChangeMemberState</a>(Type,
01983                       <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a>,
01984                       Member,
01985                       Regenerating);
01986 }
01987 
01988 
01989 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l01990"></a><a class="code" href="../../d2/d5/editreg_8c.html#a82">01990</a> <a class="code" href="../../d2/d5/editreg_8c.html#a82">FixDisk</a>()
01991 
01992 <span class="comment">/*++</span>
01993 <span class="comment"></span>
01994 <span class="comment">Routine Description:</span>
01995 <span class="comment"></span>
01996 <span class="comment">    Fix the disk signatures in the registry.</span>
01997 <span class="comment"></span>
01998 <span class="comment">Arguments:</span>
01999 <span class="comment"></span>
02000 <span class="comment">    None.</span>
02001 <span class="comment"></span>
02002 <span class="comment">Return Values:</span>
02003 <span class="comment"></span>
02004 <span class="comment">    None.</span>
02005 <span class="comment"></span>
02006 <span class="comment">--*/</span>
02007 
02008 {
02009     ULONG               outerLoop;
02010     ULONG               innerLoop;
02011     ULONG               length;
02012     HANDLE              handle;
02013     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            status;
02014     PDISK_CONFIG_HEADER configHeader;
02015     PDISK_REGISTRY      diskRegistry;
02016     PDISK_DESCRIPTION   diskDescription;
02017     PFT_REGISTRY        ftRegistry;
02018     PFT_DESCRIPTION     ftDescription;
02019     PFT_MEMBER_DESCRIPTION ftMember;
02020     UCHAR               prompt[128];
02021     PUCHAR              hexString;
02022     BOOLEAN             changed = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02023 
02024     status = <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(&amp;handle,
02025                        DISK_REGISTRY_KEY);
02026 
02027     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02028         printf(<span class="stringliteral">"Currently there is no key in the registry"</span>
02029                <span class="stringliteral">" for the disk information.\n"</span>);
02030         <span class="keywordflow">return</span>;
02031     }
02032 
02033     configHeader = (PDISK_CONFIG_HEADER) malloc(<a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
02034     <span class="keywordflow">if</span> (configHeader == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02035         printf(<span class="stringliteral">"Unable to allocate memory for the disk registy information.\n"</span>);
02036         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(handle);
02037         <span class="keywordflow">return</span>;
02038     }
02039 
02040     RtlZeroMemory(configHeader, <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
02041 
02042     status = <a class="code" href="../../d2/d5/editreg_8c.html#a76">FtReturnValue</a>(handle,
02043                            (PUCHAR) DISK_REGISTRY_VALUE,
02044                            (PUCHAR) configHeader,
02045                            <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
02046 
02047     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02048         printf(<span class="stringliteral">"There is no disk registry information (%x)\n"</span>, status);
02049         free(configHeader);
02050         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(handle);
02051         <span class="keywordflow">return</span>;
02052     }
02053 
02054     diskRegistry = (PDISK_REGISTRY)
02055                  ((PUCHAR) configHeader + configHeader-&gt;DiskInformationOffset);
02056     printf(<span class="stringliteral">"\nDisk information for %d disks:\n"</span>,
02057            diskRegistry-&gt;NumberOfDisks);
02058 
02059     diskDescription = &amp;diskRegistry-&gt;Disks[0];
02060     <span class="keywordflow">for</span> (outerLoop = 0;
02061          outerLoop &lt; diskRegistry-&gt;NumberOfDisks;
02062          outerLoop++) {
02063 
02064         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(prompt,
02065                <span class="stringliteral">"\nDisk %d signature 0x%08x = "</span>,
02066                outerLoop,
02067                diskDescription-&gt;Signature);
02068 
02069         hexString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>((BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
02070                                       prompt,
02071                                       (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
02072 
02073         <span class="keywordflow">if</span> (hexString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02074 
02075             changed = <a class="code" href="../../d2/d5/editreg_8c.html#a65">ProcessHex</a>(hexString, &amp;diskDescription-&gt;Signature);
02076         }
02077 
02078         diskDescription = (PDISK_DESCRIPTION)
02079           &amp;diskDescription-&gt;Partitions[diskDescription-&gt;NumberOfPartitions];
02080     }
02081 
02082     <span class="comment">//</span>
02083     <span class="comment">// Print the information for FT.</span>
02084     <span class="comment">//</span>
02085 
02086     <span class="keywordflow">if</span> (configHeader-&gt;FtInformationSize == 0) {
02087         printf(<span class="stringliteral">"There is no FT configuration.\n"</span>);
02088         free(configHeader);
02089         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(handle);
02090         <span class="keywordflow">return</span>;
02091     }
02092 
02093     ftRegistry = (PFT_REGISTRY)
02094                  ((PUCHAR) configHeader + configHeader-&gt;FtInformationOffset);
02095 
02096     printf(<span class="stringliteral">"\nNumber of FT components = %d\n"</span>,
02097            ftRegistry-&gt;NumberOfComponents);
02098 
02099     ftDescription = &amp;ftRegistry-&gt;FtDescription[0];
02100     <span class="keywordflow">for</span> (outerLoop = 0;
02101          outerLoop &lt; ftRegistry-&gt;NumberOfComponents;
02102          outerLoop++) {
02103 
02104         printf(<span class="stringliteral">"Component %d has %d members and is type %d\n"</span>,
02105                outerLoop,
02106                ftDescription-&gt;NumberOfMembers,
02107                ftDescription-&gt;Type);
02108 
02109         <span class="keywordflow">for</span> (innerLoop = 0;
02110              innerLoop &lt; ftDescription-&gt;NumberOfMembers;
02111              innerLoop++) {
02112             ftMember = &amp;ftDescription-&gt;FtMemberDescription[innerLoop];
02113 
02114             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(prompt,
02115                     <span class="stringliteral">"FT Member Signature 0x%x = "</span>,
02116                     ftMember-&gt;Signature);
02117 
02118             hexString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>((BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
02119                                           prompt,
02120                                           (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
02121 
02122             <span class="keywordflow">if</span> (hexString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02123 
02124                 changed = <a class="code" href="../../d2/d5/editreg_8c.html#a65">ProcessHex</a>(hexString, &amp;ftMember-&gt;Signature);
02125             }
02126         }
02127 
02128         ftDescription = (PFT_DESCRIPTION)
02129          &amp;ftDescription-&gt;FtMemberDescription[ftDescription-&gt;NumberOfMembers];
02130     }
02131 
02132     <span class="keywordflow">if</span> (changed == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02133 
02134         printf(<span class="stringliteral">"Attempting to update registry information.\n"</span>);
02135 
02136         <span class="comment">//</span>
02137         <span class="comment">// Delete the current registry value and write the new one.</span>
02138         <span class="comment">//</span>
02139 
02140         status = <a class="code" href="../../d2/d5/editreg_8c.html#a62">FtDeleteValue</a>(handle,
02141                                DISK_REGISTRY_VALUE);
02142 
02143         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02144             printf(<span class="stringliteral">"Could not delete value (0x%x).\n"</span>, status);
02145         } <span class="keywordflow">else</span> {
02146 
02147             length = (ULONG) ((PCHAR)ftDescription - (PUCHAR)configHeader);
02148             status = <a class="code" href="../../d2/d5/editreg_8c.html#a63">FtSetValue</a>(handle,
02149                                 DISK_REGISTRY_VALUE,
02150                                 configHeader,
02151                                 length,
02152                                 REG_BINARY);
02153             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02154                 printf(<span class="stringliteral">"Could not write value (0x%x)\n."</span>, status);
02155             }
02156         }
02157     }
02158 
02159     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(handle);
02160 }
02161 
02162 PDISK_CONFIG_HEADER
<a name="l02163"></a><a class="code" href="../../d2/d5/editreg_8c.html#a83">02163</a> <a class="code" href="../../d2/d5/editreg_8c.html#a83">GetDiskInfo</a>()
02164 
02165 <span class="comment">/*++</span>
02166 <span class="comment"></span>
02167 <span class="comment">--*/</span>
02168 
02169 {
02170     HANDLE              handle;
02171     ULONG               length;
02172     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            status;
02173     PDISK_CONFIG_HEADER configHeader;
02174 
02175     status = <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(&amp;handle,
02176                        DISK_REGISTRY_KEY);
02177 
02178     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02179         printf(<span class="stringliteral">"Currently there is no key in the registry"</span>
02180                <span class="stringliteral">" for the disk information.\n"</span>);
02181         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02182     }
02183 
02184     configHeader = (PDISK_CONFIG_HEADER) malloc(<a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
02185     <span class="keywordflow">if</span> (configHeader == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02186         printf(<span class="stringliteral">"Unable to allocate memory for the disk registy information.\n"</span>);
02187         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(handle);
02188         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02189     }
02190 
02191     RtlZeroMemory(configHeader, <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
02192 
02193     status = <a class="code" href="../../d2/d5/editreg_8c.html#a76">FtReturnValue</a>(handle,
02194                            (PUCHAR) DISK_REGISTRY_VALUE,
02195                            (PUCHAR) configHeader,
02196                            <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
02197     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(handle);
02198 
02199     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02200         printf(<span class="stringliteral">"There is no disk registry information (%x)\n"</span>, status);
02201         free(configHeader);
02202         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02203     }
02204 
02205     <span class="keywordflow">return</span> configHeader;
02206 }
02207 
02208 
02209 BOOLEAN
<a name="l02210"></a><a class="code" href="../../d2/d5/editreg_8c.html#a84">02210</a> <a class="code" href="../../d2/d5/editreg_8c.html#a84">CreateFtMember</a>(
02211     IN PDISK_CONFIG_HEADER ConfigHeader,
02212     IN ULONG Disk,
02213     IN ULONG Partition,
02214     IN ULONG Type,
02215     IN ULONG Group,
02216     IN ULONG Member
02217     )
02218 
02219 <span class="comment">/*++</span>
02220 <span class="comment"></span>
02221 <span class="comment">--*/</span>
02222 
02223 {
02224     ULONG               innerLoop;
02225     ULONG               outerLoop;
02226     ULONG               length;
02227     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>            status;
02228     PDISK_REGISTRY      diskRegistry;
02229     PDISK_DESCRIPTION   diskDescription;
02230     PDISK_PARTITION     diskPartition;
02231 
02232     diskRegistry = (PDISK_REGISTRY)
02233                  ((PUCHAR) ConfigHeader + ConfigHeader-&gt;DiskInformationOffset);
02234     diskDescription = &amp;diskRegistry-&gt;Disks[0];
02235 
02236     <span class="comment">//</span>
02237     <span class="comment">// Have to walk the disk information by hand to find a match on</span>
02238     <span class="comment">// disk number and partition</span>
02239     <span class="comment">//</span>
02240 
02241     <span class="keywordflow">for</span> (outerLoop = 0;
02242          outerLoop &lt; diskRegistry-&gt;NumberOfDisks;
02243          outerLoop++) {
02244 
02245         <span class="keywordflow">if</span> (outerLoop == Disk) {
02246             <span class="keywordflow">for</span> (innerLoop = 0;
02247                  innerLoop &lt; diskDescription-&gt;NumberOfPartitions;
02248                  innerLoop++) {
02249                 diskPartition = &amp;diskDescription-&gt;Partitions[innerLoop];
02250     
02251                 <span class="keywordflow">if</span> (diskPartition-&gt;LogicalNumber == Partition) {
02252     
02253                     <span class="comment">//</span>
02254                     <span class="comment">// Found a match.</span>
02255                     <span class="comment">//</span>
02256 
02257                     diskPartition-&gt;FtType = Type;
02258                     diskPartition-&gt;FtMember = Member;
02259                     diskPartition-&gt;FtGroup = <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a>;
02260                     diskPartition-&gt;FtState = Healthy;
02261                     diskPartition-&gt;AssignDriveLetter = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02262                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02263                 }
02264             }
02265         }
02266 
02267         diskDescription = (PDISK_DESCRIPTION)
02268           &amp;diskDescription-&gt;Partitions[diskDescription-&gt;NumberOfPartitions];
02269     }
02270 
02271     <span class="comment">//</span>
02272     <span class="comment">// Didn't find it.</span>
02273     <span class="comment">//</span>
02274 
02275     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02276 }
02277 
02278 
<a name="l02279"></a><a class="code" href="../../d2/d5/editreg_8c.html#a33">02279</a> <span class="preprocessor">#define DRIVER_KEY "\\REGISTRY\\MACHINE\\System\\CurrentControlSet\\Services"</span>
02280 <span class="preprocessor"></span>
<a name="l02281"></a><a class="code" href="../../d2/d5/editreg_8c.html#a34">02281</a> <span class="preprocessor">#define TYPE_KEY     "Type"</span>
<a name="l02282"></a><a class="code" href="../../d2/d5/editreg_8c.html#a35">02282</a> <span class="preprocessor"></span><span class="preprocessor">#define START_KEY    "Start"</span>
<a name="l02283"></a><a class="code" href="../../d2/d5/editreg_8c.html#a36">02283</a> <span class="preprocessor"></span><span class="preprocessor">#define GROUP_KEY    "Group"</span>
<a name="l02284"></a><a class="code" href="../../d2/d5/editreg_8c.html#a37">02284</a> <span class="preprocessor"></span><span class="preprocessor">#define DEPENDENCIES "DependOnGroup"</span>
02285 <span class="preprocessor"></span>
02286 <span class="preprocessor">#if 0</span>
02287 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
02288 <a class="code" href="../../d2/d5/editreg_8c.html#a85">DisplayLoadInformation</a>(
02289     IN PUNICODE_STRING DriverKey
02290     )
02291 
02292 <span class="comment">/*++</span>
02293 <span class="comment"></span>
02294 <span class="comment">Routine Description:</span>
02295 <span class="comment"></span>
02296 <span class="comment"></span>
02297 <span class="comment">Arguments:</span>
02298 <span class="comment"></span>
02299 <span class="comment">    DriverKey - a Unicode string pointer for the driver key name.</span>
02300 <span class="comment"></span>
02301 <span class="comment">Return Value:</span>
02302 <span class="comment"></span>
02303 <span class="comment">    None.</span>
02304 <span class="comment"></span>
02305 <span class="comment">--*/</span>
02306 
02307 {
02308     HANDLE         keyHandle;
02309     UNICODE_STRING unicodeKeyName;
02310     UNICODE_STRING unicodeValueName;
02311     ULONG          resultLength;
02312     PKEY_VALUE_FULL_INFORMATION keyValueInformation;
02313 
02314     resultLength = <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>;
02315     keyValueInformation = (PKEY_VALUE_FULL_INFORMATION)malloc(<a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
02316 
02317     <span class="comment">//</span>
02318     <span class="comment">// Type</span>
02319     <span class="comment">//</span>
02320 
02321     <span class="comment">//</span>
02322     <span class="comment">// Start</span>
02323     <span class="comment">//</span>
02324 
02325     <span class="comment">//</span>
02326     <span class="comment">// Group</span>
02327     <span class="comment">//</span>
02328 
02329     <span class="comment">//</span>
02330     <span class="comment">// DependOnGroup</span>
02331     <span class="comment">//</span>
02332 
02333     <span class="keywordflow">while</span> (1) {
02334 
02335         RtlZeroMemory(keyValueInformation, resultLength);
02336         status = <a class="code" href="../../d7/d7/ntapi_8c.html#a18">NtEnumerateValueKey</a>(KeyHandle,
02337                                      0,
02338                                      KeyValueFullInformation,
02339                                      keyValueInformation,
02340                                      resultLength,
02341                                      &amp;resultLength);
02342 
02343         <span class="keywordflow">if</span> (status == STATUS_BUFFER_OVERFLOW) {
02344             free(keyValueInformation);
02345             keyValueInformation = (PKEY_VALUE_FULL_INFORMATION)
02346                                        malloc(resultLength + 10);
02347         } <span class="keywordflow">else</span> {
02348             <span class="keywordflow">break</span>;
02349         }
02350     }
02351 
02352     free(keyValueInformation);
02353     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(keyHandle);
02354 }
02355 <span class="preprocessor">#else</span>
02356 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02357"></a><a class="code" href="../../d2/d5/editreg_8c.html#a85">02357</a> <a class="code" href="../../d2/d5/editreg_8c.html#a85">DisplayLoadInformation</a>(
02358     IN PUCHAR DriverKey
02359     )
02360 {
02361     UNREFERENCED_PARAMETER(DriverKey);
02362 }
02363 <span class="preprocessor">#endif</span>
02364 <span class="preprocessor"></span>
02365 
02366 
<a name="l02367"></a><a class="code" href="../../d2/d5/editreg_8c.html#a38">02367</a> <span class="preprocessor">#define TEMP_BUFFER_SIZE 256</span>
02368 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02369"></a><a class="code" href="../../d2/d5/editreg_8c.html#a86">02369</a> <a class="code" href="../../d2/d5/editreg_8c.html#a86">ListDrivers</a>()
02370 
02371 <span class="comment">/*++</span>
02372 <span class="comment"></span>
02373 <span class="comment">Routine Description:</span>
02374 <span class="comment"></span>
02375 <span class="comment">    Got to the load list for the drivers, interpret and display what is there.</span>
02376 <span class="comment"></span>
02377 <span class="comment">Arguments:</span>
02378 <span class="comment"></span>
02379 <span class="comment">    None.</span>
02380 <span class="comment"></span>
02381 <span class="comment">Return Value:</span>
02382 <span class="comment"></span>
02383 <span class="comment">    NONE</span>
02384 <span class="comment"></span>
02385 <span class="comment">--*/</span>
02386 
02387 {
02388     <span class="keywordtype">int</span>            index;
02389     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>       status;
02390     HANDLE         keyHandle;
02391     ULONG          resultLength;
02392     UCHAR          tempBuffer[<a class="code" href="../../d2/d5/editreg_8c.html#a38">TEMP_BUFFER_SIZE</a>];
02393     ANSI_STRING    ansiString;
02394     UNICODE_STRING unicodeValueName;
02395     PKEY_BASIC_INFORMATION keyInformation;
02396 
02397     keyInformation = (PKEY_BASIC_INFORMATION)malloc(<a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
02398 
02399     status = <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(&amp;keyHandle, <a class="code" href="../../d2/d5/editreg_8c.html#a33">DRIVER_KEY</a>);
02400 
02401     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02402 
02403         printf(<span class="stringliteral">"Could not open Services key (0x%x).\n"</span>, status);
02404         <span class="keywordflow">return</span>;
02405     }
02406 
02407     <span class="keywordflow">for</span> (index = 0; <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; index++) {
02408 
02409         RtlZeroMemory(keyInformation, <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>);
02410 
02411         status = <a class="code" href="../../d7/d7/ntapi_8c.html#a17">NtEnumerateKey</a>(keyHandle,
02412                                 index,
02413                                 KeyBasicInformation,
02414                                 keyInformation,
02415                                 <a class="code" href="../../d2/d5/editreg_8c.html#a0">WORK_BUFFER_SIZE</a>,
02416                                 &amp;resultLength);
02417 
02418         <span class="keywordflow">if</span> (status == STATUS_NO_MORE_ENTRIES) {
02419 
02420             <span class="keywordflow">break</span>;
02421 
02422         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02423 
02424             printf(<span class="stringliteral">"readreg: Error on Enumerate status = %x\n"</span>, status);
02425             <span class="keywordflow">break</span>;
02426 
02427         }
02428 
02429         unicodeValueName.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)keyInformation-&gt;NameLength;
02430         unicodeValueName.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)keyInformation-&gt;NameLength;
02431         unicodeValueName.Buffer = (PWSTR)&amp;keyInformation-&gt;Name[0];
02432 
02433         ansiString.MaximumLength = <a class="code" href="../../d2/d5/editreg_8c.html#a38">TEMP_BUFFER_SIZE</a>;
02434         ansiString.Length = 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
02435         ansiString.Buffer = &amp;tempBuffer[0];
02436 
02437         <a class="code" href="../../d6/d6/nls_8c.html#a23">RtlUnicodeStringToAnsiString</a>(&amp;ansiString,
02438                                      &amp;unicodeValueName,
02439                                      (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02440 
02441         <span class="comment">//</span>
02442         <span class="comment">// Now have the key name for the driver - concatenate it and</span>
02443         <span class="comment">// call the routine to display what is in the key.</span>
02444         <span class="comment">//</span>
02445 
02446         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>,
02447                 <span class="stringliteral">"%s\\%s"</span>,
02448                 <a class="code" href="../../d2/d5/editreg_8c.html#a33">DRIVER_KEY</a>,
02449                 tempBuffer);
02450 
02451         <a class="code" href="../../d2/d5/editreg_8c.html#a85">DisplayLoadInformation</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>);
02452     }
02453 
02454     free(keyInformation);
02455     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(keyHandle);
02456 }
02457 
02458 
02459 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l02460"></a><a class="code" href="../../d2/d7/regtest_8c.html#a3">02460</a> <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>()
02461 
02462 <span class="comment">/*++</span>
02463 <span class="comment"></span>
02464 <span class="comment">Routine Description:</span>
02465 <span class="comment"></span>
02466 <span class="comment">    The main entry point for the user process.</span>
02467 <span class="comment">    This process will prompt the user for the action desired.  This</span>
02468 <span class="comment">    includes starting performance, stopping performance, and retreiving</span>
02469 <span class="comment">    performance data collected by the FT driver.</span>
02470 <span class="comment"></span>
02471 <span class="comment">Arguments:</span>
02472 <span class="comment"></span>
02473 <span class="comment">    Command line:</span>
02474 <span class="comment">        No options.</span>
02475 <span class="comment"></span>
02476 <span class="comment">Return Value:</span>
02477 <span class="comment"></span>
02478 <span class="comment">    NONE</span>
02479 <span class="comment"></span>
02480 <span class="comment">--*/</span>
02481 
02482 {
02483     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
02484     BOOLEAN  batch;
02485     PUCHAR   argumentString;
02486     <span class="keywordtype">int</span>      commandCode;
02487     HANDLE   keyHandle;
02488 
02489 
02490     status = <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(&amp;keyHandle, <a class="code" href="../../d2/d5/editreg_8c.html#a2">REGISTRY_BASE</a>);
02491 
02492     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02493 
02494         printf(<span class="stringliteral">"readreg: Unable to open registry base (0x%x)\n"</span>, status);
02495         <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(1);
02496     }
02497 
02498     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>,
02499             <a class="code" href="../../d2/d5/editreg_8c.html#a2">REGISTRY_BASE</a>);
02500 
02501     <span class="comment">//</span>
02502     <span class="comment">// See if we are connected to CON</span>
02503     <span class="comment">//</span>
02504 
02505     batch = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02506 <span class="comment">//  batch = (BOOLEAN)(!isatty(0));</span>
02507 
02508     <span class="keywordflow">if</span> (!batch) {
02509         printf(<span class="stringliteral">"FT registry edit utility.  %s:\n"</span>, <a class="code" href="../../d2/d5/editreg_8c.html#a50">Version</a>);
02510     }
02511 
02512     <span class="keywordflow">while</span>(1) {
02513         <span class="keywordflow">while</span> ((commandCode = <a class="code" href="../../d2/d5/editreg_8c.html#a74">GetCommand</a>(batch,
02514                                          &amp;argumentString)) == <a class="code" href="../../d2/d5/editreg_8c.html#a8">INVALID</a>) {
02515 
02516             <span class="comment">//</span>
02517             <span class="comment">// Continue until we get a valid command.</span>
02518             <span class="comment">//</span>
02519 
02520         }
02521 
02522         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a>) {
02523             printf(<span class="stringliteral">"Command code == %d, argumentString = %s\n"</span>,
02524                    commandCode,
02525                    (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ? <span class="stringliteral">"(none)"</span> : argumentString);
02526         }
02527 
02528         <span class="keywordflow">switch</span> (commandCode) {
02529 
02530         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a19">DIRLONG</a>:
02531 
02532             <a class="code" href="../../d2/d5/editreg_8c.html#a68">Directory</a>(keyHandle, (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
02533             <span class="keywordflow">break</span>;
02534 
02535         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a9">DIR</a>:
02536 
02537             <a class="code" href="../../d2/d5/editreg_8c.html#a68">Directory</a>(keyHandle, (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02538             <span class="keywordflow">break</span>;
02539 
02540         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a10">CREATE</a>:
02541         {
02542             ULONG   index;
02543             PUCHAR  keyClass;
02544             BOOLEAN classAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02545 
02546             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02547                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02548                                                    <span class="stringliteral">"Key Name = "</span>, 
02549                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02550             }
02551 
02552             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02553                 <span class="keywordflow">break</span>;
02554             }
02555 
02556             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>,
02557                     <span class="stringliteral">"%s\\%s"</span>,
02558                     <a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>,
02559                     argumentString);
02560 
02561             argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02562                                                <span class="stringliteral">"Key Class = "</span>,
02563                                                (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02564 
02565             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02566                 keyClass = <span class="stringliteral">"Default Class"</span>;
02567             } <span class="keywordflow">else</span> {
02568                 keyClass = (PUCHAR) malloc(<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(argumentString) + <a class="code" href="../../d2/d5/editreg_8c.html#a1">FUDGE</a>);
02569                 classAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02570 
02571                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(keyClass,
02572                         <span class="stringliteral">"%s"</span>,
02573                         argumentString);
02574             }
02575 
02576             argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02577                                                <span class="stringliteral">"Index = "</span>,
02578                                                (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
02579 
02580             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02581                 index = 1;
02582             } <span class="keywordflow">else</span> {
02583                 index = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
02584             }
02585 
02586             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a>) {
02587                 printf(<span class="stringliteral">"Creating key %s, index %d with class %s\n"</span>,
02588                        <a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>,
02589                        index,
02590                        keyClass);
02591             }
02592 
02593             status = <a class="code" href="../../d2/d5/editreg_8c.html#a61">FtCreateKey</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>,
02594                                  keyClass,
02595                                  index);
02596 
02597             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02598 
02599                 printf(<span class="stringliteral">"Could not create key %s (0x%x).\n"</span>,
02600                        <a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>,
02601                        status);
02602             }
02603 
02604             <span class="keywordflow">if</span> (classAllocated == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02605                 free(keyClass);
02606             }
02607 
02608             <span class="keywordflow">break</span>;
02609         }
02610 
02611         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a11">LIST</a>:
02612 
02613             <a class="code" href="../../d2/d5/editreg_8c.html#a69">List</a>(keyHandle,
02614                  argumentString);
02615             <span class="keywordflow">break</span>;
02616 
02617         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a12">CHDIR</a>:
02618 
02619             <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(keyHandle);
02620 
02621             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02622 
02623                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02624                                                    <span class="stringliteral">"New location = "</span>,
02625                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
02626             }
02627 
02628             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02629 
02630                 <span class="keywordflow">if</span> (*argumentString == <span class="charliteral">'\\'</span>) {
02631 
02632                     <span class="comment">//</span>
02633                     <span class="comment">// Root relative string.</span>
02634                     <span class="comment">// Use text provided (i.e. %s is to avoid user crashing</span>
02635                     <span class="comment">// by putting %s in the string).</span>
02636                     <span class="comment">//</span>
02637 
02638                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>,
02639                             <span class="stringliteral">"%s"</span>,
02640                             argumentString);
02641 
02642                 } <span class="keywordflow">else</span> {
02643 
02644                     <span class="keywordflow">while</span> ((*argumentString == <span class="charliteral">'.'</span>) &amp;&amp;
02645                            (*(argumentString + 1) == <span class="charliteral">'.'</span>)) {
02646 
02647                         <span class="keywordflow">if</span> ((*(argumentString + 2) == <span class="charliteral">'\\'</span>) ||
02648                             (*(argumentString + 2) == <span class="charliteral">'\0'</span>)) {
02649 
02650                             PUCHAR cptr = <a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>;
02651 
02652                             <span class="comment">//</span>
02653                             <span class="comment">// move argumentString past ".."</span>
02654                             <span class="comment">//</span>
02655 
02656                             argumentString += 2;
02657 
02658                             <span class="comment">//</span>
02659                             <span class="comment">// Find end of current directory.</span>
02660                             <span class="comment">//</span>
02661 
02662                             <span class="keywordflow">while</span> (*cptr != <span class="charliteral">'\0'</span>) {
02663                                 cptr++;
02664                             }
02665 
02666                             <span class="comment">//</span>
02667                             <span class="comment">// Backup to last component.</span>
02668                             <span class="comment">//</span>
02669 
02670                             <span class="keywordflow">while</span> (*cptr != <span class="charliteral">'\\'</span>) {
02671                                 cptr--;
02672                             }
02673 
02674                             <span class="keywordflow">if</span> (cptr == <a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>) {
02675 
02676                                 <span class="comment">//</span>
02677                                 <span class="comment">// Cannot backup anymore.  Continue parsing</span>
02678                                 <span class="comment">// argument.</span>
02679                                 <span class="comment">//</span>
02680 
02681                                 <span class="keywordflow">continue</span>;
02682                             }
02683 
02684                             <span class="comment">//</span>
02685                             <span class="comment">// Remove component from path.</span>
02686                             <span class="comment">//</span>
02687 
02688                             *cptr = <span class="charliteral">'\0'</span>;
02689 
02690                             <span class="keywordflow">if</span> (*argumentString == <span class="charliteral">'\0'</span>) {
02691 
02692                                 <span class="comment">//</span>
02693                                 <span class="comment">// All done with argument.</span>
02694                                 <span class="comment">//</span>
02695 
02696                                 <span class="keywordflow">break</span>;
02697                             }
02698 
02699                             <span class="comment">//</span>
02700                             <span class="comment">// Step around backslash.</span>
02701                             <span class="comment">//</span>
02702 
02703                             argumentString++;
02704 
02705                         } <span class="keywordflow">else</span> {
02706 
02707                             <span class="comment">//</span>
02708                             <span class="comment">// Assume it is a real name.</span>
02709                             <span class="comment">//</span>
02710 
02711                             <span class="keywordflow">break</span>;
02712                         }
02713                     }
02714 
02715                     <span class="keywordflow">if</span> (*argumentString != <span class="charliteral">'\0'</span>) {
02716                         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>,
02717                                 <span class="stringliteral">"%s\\%s"</span>,
02718                                 <a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>,
02719                                 argumentString);
02720                     } <span class="keywordflow">else</span> {
02721                         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>,
02722                                 <span class="stringliteral">"%s"</span>,
02723                                 <a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>);
02724                     }
02725                 }
02726 
02727                 status = <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(&amp;keyHandle,
02728                                    <a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>);
02729 
02730                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02731 
02732                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>,
02733                             <span class="stringliteral">"%s"</span>,
02734                             <a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>);
02735                 } <span class="keywordflow">else</span> {
02736 
02737                     (<a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>) <a class="code" href="../../d2/d5/editreg_8c.html#a59">FtOpenKey</a>(&amp;keyHandle,
02738                                      <a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>);
02739 
02740                     <span class="comment">//</span>
02741                     <span class="comment">// No error checks because this was opened once before.</span>
02742                     <span class="comment">//</span>
02743                 }
02744 
02745             }
02746 
02747             <span class="keywordflow">break</span>;
02748 
02749         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a13">HELP</a>:
02750         {
02751             <span class="keywordtype">int</span> i;
02752 
02753             printf(<span class="stringliteral">"Valid commands are:\n"</span>);
02754 
02755             <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d2/d5/editreg_8c.html#a43">Commands</a>[i] != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; i++) {
02756                 printf(<span class="stringliteral">"  %10s  - %s\n"</span>,
02757                        <a class="code" href="../../d2/d5/editreg_8c.html#a43">Commands</a>[i],
02758                        <a class="code" href="../../d2/d5/editreg_8c.html#a45">CommandHelp</a>[<a class="code" href="../../d2/d5/editreg_8c.html#a44">CommandMap</a>[i]]);
02759             }
02760             <span class="keywordflow">break</span>;
02761         }
02762 
02763         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a14">QUIT</a>:
02764 
02765             <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(0);
02766             <span class="keywordflow">break</span>;
02767 
02768         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a15">DDEBUG</a>:
02769 
02770             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02771 
02772                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a>) {
02773 
02774                     printf(<span class="stringliteral">"Debug turned off.\n"</span>);
02775                     <a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a> = 0;
02776                 } <span class="keywordflow">else</span> {
02777 
02778                     <a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a> = 1;
02779                 }
02780             } <span class="keywordflow">else</span> {
02781 
02782                 <a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a> = atoi(argumentString);
02783                 printf(<span class="stringliteral">"Debug set to %d\n"</span>, <a class="code" href="../../d2/d5/editreg_8c.html#a51">Debug</a>);
02784             }
02785             <span class="keywordflow">break</span>;
02786 
02787         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a16">SETVALUE</a>:
02788         {
02789             <span class="keywordtype">int</span>    i;
02790             BOOLEAN convertToUnicode = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02791             PUCHAR valueName;
02792             PUCHAR valueData;
02793             ULONG  valueLength;
02794             ULONG  valueWord;
02795             PVOID  valuePtr;
02796             ULONG  <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a3">DEFAULT_TYPE</a>;
02797             STRING         valueString;
02798             UNICODE_STRING unicodeValue;
02799             BOOLEAN dataAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02800             BOOLEAN unicodeAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02801 
02802             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02803 
02804                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02805                                                    <span class="stringliteral">"Value Name = "</span>,
02806                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02807             }
02808 
02809             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02810 
02811                 <span class="keywordflow">break</span>;
02812             }
02813 
02814             valueName = (PUCHAR) malloc(<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(argumentString) + <a class="code" href="../../d2/d5/editreg_8c.html#a1">FUDGE</a>);
02815 
02816             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(valueName,
02817                     <span class="stringliteral">"%s"</span>,
02818                     argumentString);
02819 
02820             <span class="comment">//</span>
02821             <span class="comment">// print a help banner on type and get the type.</span>
02822             <span class="comment">//</span>
02823 
02824             <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d2/d5/editreg_8c.html#a39">TypeNames</a>[i] != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; i++) {
02825 
02826                 printf(<span class="stringliteral">"%d - %s\n"</span>, <a class="code" href="../../d2/d5/editreg_8c.html#a40">TypeNumbers</a>[i], <a class="code" href="../../d2/d5/editreg_8c.html#a39">TypeNames</a>[i]);
02827             }
02828             printf(<span class="stringliteral">"# - Other numbers are user defined\n"</span>);
02829             argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02830                                                <span class="stringliteral">"Numeric value for type = "</span>,
02831                                                (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
02832 
02833             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02834                 <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
02835             }
02836 
02837             <span class="keywordflow">switch</span>(<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>)
02838             {
02839             <span class="keywordflow">default</span>:
02840             <span class="keywordflow">case</span> REG_SZ:
02841                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> == REG_SZ) {
02842                     convertToUnicode = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02843                     printf(<span class="stringliteral">"Typed in string will be converted to unicode...\n"</span>);
02844                     argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02845                                                        <span class="stringliteral">"Value Data = "</span>,
02846                                                        (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02847                 } <span class="keywordflow">else</span> {
02848                     printf(<span class="stringliteral">"For now the data must be typed in...\n"</span>);
02849                     argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02850                                                        <span class="stringliteral">"Value Data = "</span>,
02851                                                        (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
02852                 }
02853 
02854                 <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02855                     valueData = <span class="stringliteral">"Default Data"</span>;
02856                     valueLength = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(valueData);
02857                 } <span class="keywordflow">else</span> {
02858                     valueData = (PUCHAR) malloc(<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(argumentString) + <a class="code" href="../../d2/d5/editreg_8c.html#a1">FUDGE</a>);
02859                     dataAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02860                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(valueData,
02861                             <span class="stringliteral">"%s"</span>,
02862                             argumentString);
02863                     <span class="keywordflow">if</span> (convertToUnicode == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02864                         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>(&amp;valueString,
02865                                       valueData);
02866                         <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(&amp;unicodeValue,
02867                                                      &amp;valueString,
02868                                                      (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
02869                         unicodeAllocated = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02870                         valueLength = unicodeValue.Length + 2;
02871                     } <span class="keywordflow">else</span> {
02872                         valueLength = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(valueData);
02873                     }
02874                 }
02875 
02876                 <span class="keywordflow">break</span>;
02877 
02878             <span class="keywordflow">case</span> REG_DWORD:
02879                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02880                                                    <span class="stringliteral">"Value Data Word = "</span>,
02881                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
02882                 <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02883                     valueWord = 0;
02884                 } <span class="keywordflow">else</span> {
02885                     valueWord = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
02886                 }
02887 
02888                 valueLength = <span class="keyword">sizeof</span>(ULONG);
02889                 <span class="keywordflow">break</span>;
02890             }
02891 
02892             <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>) {
02893 
02894             <span class="keywordflow">case</span> REG_DWORD:
02895                 valuePtr = (PVOID) &amp;valueWord;
02896                 <span class="keywordflow">break</span>;
02897 
02898             <span class="keywordflow">case</span> REG_SZ:
02899                 valuePtr = (PVOID) unicodeValue.Buffer;
02900                 <span class="keywordflow">break</span>;
02901 
02902             <span class="keywordflow">default</span>:
02903                 valuePtr = (PVOID) valueData;
02904                 <span class="keywordflow">break</span>;
02905             }
02906             status = <a class="code" href="../../d2/d5/editreg_8c.html#a63">FtSetValue</a>(keyHandle,
02907                                 valueName,
02908                                 valuePtr,
02909                                 valueLength,
02910                                 <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>);
02911 
02912             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02913                 printf(<span class="stringliteral">"Could not set value %s (0x%x).\n"</span>, valueName, status);
02914             }
02915 
02916             free(valueName);
02917             <span class="keywordflow">if</span> (dataAllocated == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02918                 free(valueData);
02919             }
02920             <span class="keywordflow">if</span> (unicodeAllocated == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02921                 <a class="code" href="../../d6/d6/nls_8c.html#a34">RtlFreeUnicodeString</a>(&amp;unicodeValue);
02922             }
02923             <span class="keywordflow">break</span>;
02924         }
02925 
02926         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a17">DELKEY</a>:
02927         {
02928             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02929 
02930                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02931                                                    <span class="stringliteral">"Key Name = "</span>,
02932                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
02933             }
02934 
02935             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02936 
02937                 <span class="keywordflow">break</span>;
02938             }
02939 
02940             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>,
02941                     <span class="stringliteral">"%s\\%s"</span>,
02942                     <a class="code" href="../../d2/d5/editreg_8c.html#a47">CurrentDirectory</a>,
02943                     argumentString);
02944 
02945             status = <a class="code" href="../../d2/d5/editreg_8c.html#a60">FtDeleteKey</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>);
02946 
02947             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02948                 printf(<span class="stringliteral">"Unable to delete key %s (0x%x)\n"</span>,
02949                        <a class="code" href="../../d2/d5/editreg_8c.html#a46">WorkingDirectory</a>,
02950                        status);
02951             }
02952 
02953             <span class="keywordflow">break</span>;
02954         }
02955 
02956         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a18">DELVALUE</a>:
02957         {
02958             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02959 
02960                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
02961                                                    <span class="stringliteral">"Key Name = "</span>,
02962                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
02963             }
02964 
02965             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02966 
02967                 <span class="keywordflow">break</span>;
02968             }
02969 
02970             status = <a class="code" href="../../d2/d5/editreg_8c.html#a62">FtDeleteValue</a>(keyHandle,
02971                                    argumentString);
02972 
02973             <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
02974 
02975                 printf(<span class="stringliteral">"Unable to delete value %s (0x%x)\n"</span>,
02976                        argumentString,
02977                        status);
02978             }
02979             <span class="keywordflow">break</span>;
02980         }
02981 
02982         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a20">INLONG</a>:
02983             <a class="code" href="../../d2/d5/editreg_8c.html#a55">DumpControl</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a88a58">InLongs</a>;
02984             <span class="keywordflow">break</span>;
02985 
02986         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a21">INSHORT</a>:
02987             <a class="code" href="../../d2/d5/editreg_8c.html#a55">DumpControl</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a88a57">InShorts</a>;
02988             <span class="keywordflow">break</span>;
02989 
02990         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a22">INBYTE</a>:
02991             <a class="code" href="../../d2/d5/editreg_8c.html#a55">DumpControl</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a88a56">InBytes</a>;
02992             <span class="keywordflow">break</span>;
02993 
02994         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a23">DUMP</a>:
02995 
02996             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a54">ForceDump</a>) {
02997                 <a class="code" href="../../d2/d5/editreg_8c.html#a54">ForceDump</a> = 0;
02998             } <span class="keywordflow">else</span> {
02999                 <a class="code" href="../../d2/d5/editreg_8c.html#a54">ForceDump</a>++;
03000             }
03001             <span class="keywordflow">break</span>;
03002 
03003         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a24">DISKREG</a>:
03004             <a class="code" href="../../d2/d5/editreg_8c.html#a77">DiskDump</a>();
03005             <span class="keywordflow">break</span>;
03006 
03007         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a25">FIXDISK</a>:
03008             <a class="code" href="../../d2/d5/editreg_8c.html#a82">FixDisk</a>();
03009             <span class="keywordflow">break</span>;
03010 
03011         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a26">RESTORE</a>:
03012         {
03013             ULONG <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>;
03014             ULONG group;
03015             ULONG member;
03016 
03017             printf(<span class="stringliteral">"FT types that can be restored are:\n"</span>);
03018             printf(<span class="stringliteral">"\t%d - for Mirrors\n"</span>, Mirror);
03019             printf(<span class="stringliteral">"\t%d - for Stripes with parity\n"</span>, StripeWithParity);
03020 
03021             <span class="comment">//</span>
03022             <span class="comment">// Get the type</span>
03023             <span class="comment">//</span>
03024 
03025             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03026                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03027                                                    <span class="stringliteral">"FT volume type = "</span>,
03028                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03029             }
03030             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03031                 <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03032             } <span class="keywordflow">else</span> {
03033                 <span class="keywordflow">break</span>;
03034             }
03035 
03036             <span class="comment">//</span>
03037             <span class="comment">// Get the group</span>
03038             <span class="comment">//</span>
03039 
03040             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03041                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03042                                                    <span class="stringliteral">"FT group number = "</span>,
03043                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03044             }
03045             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03046                 group = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03047             } <span class="keywordflow">else</span> {
03048                 <span class="keywordflow">break</span>;
03049             }
03050 
03051             <span class="comment">//</span>
03052             <span class="comment">// Get the member</span>
03053             <span class="comment">//</span>
03054 
03055             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03056                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03057                                                    <span class="stringliteral">"FT member number = "</span>,
03058                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03059             }
03060             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03061                 member = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03062             } <span class="keywordflow">else</span> {
03063                 <span class="keywordflow">break</span>;
03064             }
03065 
03066             <a class="code" href="../../d2/d5/editreg_8c.html#a79">RestoreOrphan</a>(<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>, group, member);
03067             <span class="keywordflow">break</span>;
03068         }
03069 
03070         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a27">DRIVERS</a>:
03071             <a class="code" href="../../d2/d5/editreg_8c.html#a75">NotImplemented</a>();
03072             <span class="comment">// ListDrivers();</span>
03073             <span class="keywordflow">break</span>;
03074 
03075         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a28">ORPHAN</a>:
03076         {
03077             ULONG <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>;
03078             ULONG group;
03079             ULONG member;
03080 
03081             printf(<span class="stringliteral">"FT types that can be orphaned are:\n"</span>);
03082             printf(<span class="stringliteral">"\t%d - for Mirrors\n"</span>, Mirror);
03083             printf(<span class="stringliteral">"\t%d - for Stripes with parity\n"</span>, StripeWithParity);
03084 
03085             <span class="comment">//</span>
03086             <span class="comment">// Get the type</span>
03087             <span class="comment">//</span>
03088 
03089             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03090                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03091                                                    <span class="stringliteral">"FT volume type = "</span>,
03092                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03093             }
03094             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03095                 <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03096             } <span class="keywordflow">else</span> {
03097                 <span class="keywordflow">break</span>;
03098             }
03099 
03100             <span class="comment">//</span>
03101             <span class="comment">// Get the group</span>
03102             <span class="comment">//</span>
03103 
03104             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03105                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03106                                                    <span class="stringliteral">"FT group number = "</span>,
03107                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03108             }
03109             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03110                 group = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03111             } <span class="keywordflow">else</span> {
03112                 <span class="keywordflow">break</span>;
03113             }
03114 
03115             <span class="comment">//</span>
03116             <span class="comment">// Get the member</span>
03117             <span class="comment">//</span>
03118 
03119             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03120                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03121                                                    <span class="stringliteral">"FT member number = "</span>,
03122                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03123             }
03124             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03125                 member = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03126             } <span class="keywordflow">else</span> {
03127                 <span class="keywordflow">break</span>;
03128             }
03129 
03130             <a class="code" href="../../d2/d5/editreg_8c.html#a80">OrphanMember</a>(<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>, group, member);
03131             <span class="keywordflow">break</span>;
03132         }
03133 
03134         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a29">REGEN</a>:
03135         {
03136             ULONG <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>;
03137             ULONG group;
03138             ULONG member;
03139 
03140             printf(<span class="stringliteral">"FT types that can be regenerated are:\n"</span>);
03141             printf(<span class="stringliteral">"\t%d - for Mirrors\n"</span>, Mirror);
03142             printf(<span class="stringliteral">"\t%d - for Stripes with parity\n"</span>, StripeWithParity);
03143 
03144             <span class="comment">//</span>
03145             <span class="comment">// Get the type</span>
03146             <span class="comment">//</span>
03147 
03148             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03149                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03150                                                    <span class="stringliteral">"FT volume type = "</span>,
03151                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03152             }
03153             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03154                 <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03155             } <span class="keywordflow">else</span> {
03156                 <span class="keywordflow">break</span>;
03157             }
03158 
03159             <span class="comment">//</span>
03160             <span class="comment">// Get the group</span>
03161             <span class="comment">//</span>
03162 
03163             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03164                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03165                                                    <span class="stringliteral">"FT group number = "</span>,
03166                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03167             }
03168             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03169                 group = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03170             } <span class="keywordflow">else</span> {
03171                 <span class="keywordflow">break</span>;
03172             }
03173 
03174             <span class="comment">//</span>
03175             <span class="comment">// Get the member</span>
03176             <span class="comment">//</span>
03177 
03178             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03179                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03180                                                    <span class="stringliteral">"FT member number = "</span>,
03181                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03182             }
03183             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03184                 member = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03185             } <span class="keywordflow">else</span> {
03186                 <span class="keywordflow">break</span>;
03187             }
03188 
03189             <a class="code" href="../../d2/d5/editreg_8c.html#a81">RegenerateMember</a>(<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>, group, member);
03190             <span class="keywordflow">break</span>;
03191         }
03192 
03193         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a30">INIT</a>:
03194         {
03195             ULONG <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>;
03196             ULONG group;
03197             ULONG member;
03198 
03199             printf(<span class="stringliteral">"Only stripes with parity are initialized.\n"</span>);
03200 
03201             <span class="comment">//</span>
03202             <span class="comment">// Get the group</span>
03203             <span class="comment">//</span>
03204 
03205             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03206                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03207                                                <span class="stringliteral">"Parity stripe group number = "</span>,
03208                                                (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03209             }
03210             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03211                 group = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03212             } <span class="keywordflow">else</span> {
03213                 <span class="keywordflow">break</span>;
03214             }
03215 
03216             <a class="code" href="../../d2/d5/editreg_8c.html#a78">ChangeMemberState</a>(StripeWithParity,
03217                               group,
03218                               0,
03219                               Initializing);
03220             <span class="keywordflow">break</span>;
03221         }
03222 
03223         <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a31">MAKEFT</a>:
03224         {
03225             ULONG <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>;
03226             ULONG group;
03227             ULONG member;
03228             ULONG disk;
03229             ULONG partition;
03230             PDISK_CONFIG_HEADER configHeader;
03231             BOOLEAN doUpdate = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03232 
03233             configHeader = <a class="code" href="../../d2/d5/editreg_8c.html#a83">GetDiskInfo</a>();
03234             <span class="keywordflow">if</span> (configHeader == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03235                 <span class="keywordflow">break</span>;
03236             }
03237             printf(<span class="stringliteral">"\t%d for Mirrors\n"</span>, Mirror);
03238             printf(<span class="stringliteral">"\t%d for Stripe Set\n"</span>, Stripe);
03239             printf(<span class="stringliteral">"\t%d for Stripe with parity\n"</span>, StripeWithParity);
03240             printf(<span class="stringliteral">"\t%d for Volume Set\n"</span>, VolumeSet);
03241 
03242             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03243                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03244                                                    <span class="stringliteral">"Which FT set to create? "</span>,
03245                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03246             }
03247             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03248                 <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03249             } <span class="keywordflow">else</span> {
03250                 <span class="keywordflow">break</span>;
03251             }
03252 
03253             <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03254                 argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03255                                                    <span class="stringliteral">"Please give an FT group # - "</span>,
03256                                                    (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03257             }
03258             <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03259                 group = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03260             } <span class="keywordflow">else</span> {
03261                 <span class="keywordflow">break</span>;
03262             }
03263 
03264             <span class="keywordflow">for</span> (member = 0; <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; member++) {
03265                 printf(<span class="stringliteral">"Information for member %d\n"</span>, member);
03266 
03267                 <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03268                     argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03269                                                        <span class="stringliteral">"Disk Number = "</span>,
03270                                                        (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03271                 }
03272 
03273                 <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03274                     disk = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03275                 } <span class="keywordflow">else</span> {
03276                     <span class="keywordflow">break</span>;
03277                 }
03278 
03279                 <span class="keywordflow">if</span> (argumentString == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03280                     argumentString = <a class="code" href="../../d2/d5/editreg_8c.html#a71">GetArgumentString</a>(batch,
03281                                                        <span class="stringliteral">"Partition Number = "</span>,
03282                                                        (BOOLEAN) <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03283                 }
03284 
03285                 <span class="keywordflow">if</span> (argumentString != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03286                     partition = <a class="code" href="../../d2/d5/editreg_8c.html#a72">ParseArgumentNumeric</a>(&amp;argumentString);
03287                 } <span class="keywordflow">else</span> {
03288                     <span class="keywordflow">break</span>;
03289                 }
03290 
03291                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d5/editreg_8c.html#a84">CreateFtMember</a>(configHeader, disk, partition, <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>, group, member) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
03292                     printf(<span class="stringliteral">"Failed to change member state\n"</span>);
03293                     printf(<span class="stringliteral">"No update will be made\n"</span>);
03294                     doUpdate = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03295                     <span class="keywordflow">break</span>;
03296                 }
03297             }
03298             <span class="keywordflow">if</span> (doUpdate == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
03299                 PDISK_REGISTRY diskRegistry;
03300                 diskRegistry = (PDISK_REGISTRY)
03301                              ((PUCHAR) configHeader + configHeader-&gt;DiskInformationOffset);
03302                 DiskRegistrySet(diskRegistry);
03303             }
03304             free(configHeader);
03305             <span class="keywordflow">break</span>;
03306         }
03307 
03308         <span class="keywordflow">default</span>:
03309 
03310             printf(<span class="stringliteral">"WDF homer?!?\n"</span>);
03311             <span class="keywordflow">break</span>;
03312         }
03313     }
03314 } <span class="comment">// main</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
