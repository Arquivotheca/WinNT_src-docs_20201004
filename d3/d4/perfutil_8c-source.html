<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: perfutil.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>perfutil.c</h1><a href="../../d2/d5/perfutil_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++ BUILD Version: 0001</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:    perfutil.c</span>
00006 <span class="comment"></span>
00007 <span class="comment">Abstract:</span>
00008 <span class="comment">    This file implements the utility routines used to construct the</span>
00009 <span class="comment">    common parts of a PERF_INSTANCE_DEFINITION (see winperf.h) and</span>
00010 <span class="comment">    perform event logging functions.</span>
00011 <span class="comment"></span>
00012 <span class="comment">Revision History:</span>
00013 <span class="comment">--*/</span>
00014 
00015 <span class="comment">//</span>
00016 <span class="comment">//  include files</span>
00017 <span class="comment">//</span>
00018 
00019 <span class="preprocessor">#include &lt;windows.h&gt;</span>
00020 <span class="preprocessor">#include &lt;string.h&gt;</span>
00021 <span class="preprocessor">#include &lt;winperf.h&gt;</span>
00022 <span class="preprocessor">#include "userctrs.h"</span>     <span class="comment">// error message definition</span>
00023 <span class="preprocessor">#include "<a class="code" href="../../d8/d4/perfmsg_8h.html">perfmsg.h</a>"</span>
00024 <span class="preprocessor">#include "<a class="code" href="../../d3/d5/perfutil_8h.html">perfutil.h</a>"</span>
00025 <span class="preprocessor">#include "<a class="code" href="../../d9/d0/userdata_8h.html">userdata.h</a>"</span>
<a name="l00026"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a0">00026</a> <span class="preprocessor">#define INITIAL_SIZE     1024L</span>
<a name="l00027"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a1">00027</a> <span class="preprocessor"></span><span class="preprocessor">#define EXTEND_SIZE      1024L</span>
00028 <span class="preprocessor"></span>
00029 <span class="comment">//</span>
00030 <span class="comment">// Global data definitions.</span>
00031 <span class="comment">//</span>
00032 
<a name="l00033"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a7">00033</a> ULONG   <a class="code" href="../../d2/d5/perfutil_8c.html#a7">ulInfoBufferSize</a> = 0;
<a name="l00034"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a8">00034</a> HANDLE  <a class="code" href="../../d8/d4/perfmsg_8h.html#a13">hEventLog</a>   = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;    <span class="comment">// event log handle for reporting events</span>
00035                                <span class="comment">// initialized in Open... routines</span>
<a name="l00036"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a9">00036</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   <a class="code" href="../../d8/d4/perfmsg_8h.html#a14">dwLogUsers</a>      = 0;   <span class="comment">// count of functions using event log</span>
<a name="l00037"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a10">00037</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   <a class="code" href="../../d8/d4/perfmsg_8h.html#a15">MESSAGE_LEVEL</a>   = 0;
<a name="l00038"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a11">00038</a> WCHAR   <a class="code" href="../../d2/d5/perfutil_8c.html#a11">GLOBAL_STRING</a>[]     = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Global"</span>;
<a name="l00039"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a12">00039</a> WCHAR   <a class="code" href="../../d2/d5/perfutil_8c.html#a12">FOREIGN_STRING</a>[]    = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Foreign"</span>;
<a name="l00040"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a13">00040</a> WCHAR   <a class="code" href="../../d2/d5/perfutil_8c.html#a13">COSTLY_STRING</a>[]     = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"Costly"</span>;
<a name="l00041"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a14">00041</a> WCHAR   <a class="code" href="../../d2/d5/perfutil_8c.html#a14">NULL_STRING</a>[]       = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\0"</span>;
00042 
00043 <span class="comment">//</span>
00044 <span class="comment">// Global data from userdata.c</span>
00045 <span class="comment">//</span>
<a name="l00046"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a15">00046</a> <span class="keyword">extern</span> <a class="code" href="../../d5/d4/struct__USER__DATA__DEFINITION.html">USER_DATA_DEFINITION</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a7">UserDataDefinition</a>;
<a name="l00047"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a16">00047</a> <span class="keyword">extern</span> <a class="code" href="../../d7/d9/struct__CS__DATA__DEFINITION.html">CS_DATA_DEFINITION</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a8">CSDataDefinition</a>;
00048 
00049 <span class="comment">// pointer to null string</span>
00050 <span class="comment">// test for delimiter, end of line and non-digit characters</span>
00051 <span class="comment">// used by IsNumberInUnicodeList routine</span>
00052 <span class="comment">//</span>
00053 
<a name="l00054"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a2">00054</a> <span class="preprocessor">#define DIGIT       1</span>
<a name="l00055"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a3">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define DELIMITER   2</span>
<a name="l00056"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a4">00056</a> <span class="preprocessor"></span><span class="preprocessor">#define ENDOFSTRING 3</span>
<a name="l00057"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a5">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define INVALID     4</span>
<a name="l00058"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a6">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define EvalThisChar(c,d) ( \</span>
00059 <span class="preprocessor">     (c == d) ? DELIMITER : \</span>
00060 <span class="preprocessor">     (c == 0) ? ENDOFSTRING : \</span>
00061 <span class="preprocessor">     (c &lt; (WCHAR)'0') ? INVALID : \</span>
00062 <span class="preprocessor">     (c &gt; (WCHAR)'9') ? INVALID : \</span>
00063 <span class="preprocessor">     DIGIT)</span>
00064 <span class="preprocessor"></span>
<a name="l00065"></a><a class="code" href="../../d3/d5/perfutil_8h.html#a17">00065</a> HANDLE <a class="code" href="../../d2/d5/perfutil_8c.html#a17">MonOpenEventLog</a> ()
00066 <span class="comment">/*++</span>
00067 <span class="comment">Routine Description:</span>
00068 <span class="comment"></span>
00069 <span class="comment">    Reads the level of event logging from the registry and opens the</span>
00070 <span class="comment">    channel to the event logger for subsequent event log entries.</span>
00071 <span class="comment"></span>
00072 <span class="comment">Arguments:</span>
00073 <span class="comment">        None</span>
00074 <span class="comment"></span>
00075 <span class="comment">Return Value:</span>
00076 <span class="comment">        Handle to the event log for reporting events.</span>
00077 <span class="comment">        NULL if open not successful.</span>
00078 <span class="comment">--*/</span>
00079 {
00080     HKEY hAppKey;
00081     TCHAR LogLevelKeyName[] = <span class="stringliteral">"SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\PerfLib"</span>;
00082     TCHAR LogLevelValueName[] = <span class="stringliteral">"EventLogLevel"</span>;
00083     LONG lStatus;
00084     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwLogLevel;
00085     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwValueType;
00086     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwValueSize;
00087 
00088     <span class="comment">// if global value of the logging level not initialized or is disabled,</span>
00089     <span class="comment">//  check the registry to see if it should be updated.</span>
00090 
00091     <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d4/perfmsg_8h.html#a15">MESSAGE_LEVEL</a>) {
00092         lStatus = RegOpenKeyEx (HKEY_LOCAL_MACHINE,
00093                                LogLevelKeyName,
00094                                0,
00095                                KEY_READ,
00096                                &amp;hAppKey);
00097         dwValueSize = <span class="keyword">sizeof</span> (dwLogLevel);
00098         <span class="keywordflow">if</span> (lStatus == ERROR_SUCCESS) {
00099             lStatus = RegQueryValueEx (hAppKey,
00100                                LogLevelValueName,
00101                                (LPDWORD)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00102                                &amp;dwValueType,
00103                                (LPBYTE)&amp;dwLogLevel,
00104                                &amp;dwValueSize);
00105             <span class="keywordflow">if</span> (lStatus == ERROR_SUCCESS) {
00106                <a class="code" href="../../d8/d4/perfmsg_8h.html#a15">MESSAGE_LEVEL</a> = dwLogLevel;
00107             }
00108             <span class="keywordflow">else</span> {
00109                <a class="code" href="../../d8/d4/perfmsg_8h.html#a15">MESSAGE_LEVEL</a> = <a class="code" href="../../d8/d4/perfmsg_8h.html#a5">MESSAGE_LEVEL_DEFAULT</a>;
00110             }
00111             RegCloseKey (hAppKey);
00112         }
00113         <span class="keywordflow">else</span> {
00114             <a class="code" href="../../d8/d4/perfmsg_8h.html#a15">MESSAGE_LEVEL</a> = <a class="code" href="../../d8/d4/perfmsg_8h.html#a5">MESSAGE_LEVEL_DEFAULT</a>;
00115         }
00116     }
00117     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d4/perfmsg_8h.html#a13">hEventLog</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00118         <a class="code" href="../../d8/d4/perfmsg_8h.html#a13">hEventLog</a> = RegisterEventSource (
00119             (LPTSTR)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,            <span class="comment">// Use Local Machine</span>
00120             <a class="code" href="../../d8/d4/perfmsg_8h.html#a0">APP_NAME</a>);               <span class="comment">// event log app name to find in registry</span>
00121          <span class="keywordflow">if</span> (<a class="code" href="../../d8/d4/perfmsg_8h.html#a13">hEventLog</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00122             <a class="code" href="../../d8/d4/perfmsg_8h.html#a7">REPORT_INFORMATION</a> (UTIL_LOG_OPEN, <a class="code" href="../../d8/d4/perfmsg_8h.html#a3">LOG_DEBUG</a>);
00123          }
00124     }
00125     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d4/perfmsg_8h.html#a13">hEventLog</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00126          <a class="code" href="../../d8/d4/perfmsg_8h.html#a14">dwLogUsers</a>++;           <span class="comment">// increment count of perfctr log users</span>
00127     }
00128     <span class="keywordflow">return</span> (<a class="code" href="../../d8/d4/perfmsg_8h.html#a13">hEventLog</a>);
00129 }
00130 
<a name="l00131"></a><a class="code" href="../../d3/d5/perfutil_8h.html#a18">00131</a> <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d2/d5/perfutil_8c.html#a18">MonCloseEventLog</a> ()
00132 <span class="comment">/*++</span>
00133 <span class="comment">Routine Description:</span>
00134 <span class="comment">      Closes the handle to the event logger if this is the last caller</span>
00135 <span class="comment"></span>
00136 <span class="comment">Arguments:      None</span>
00137 <span class="comment"></span>
00138 <span class="comment">Return Value:   None</span>
00139 <span class="comment"></span>
00140 <span class="comment">--*/</span>
00141 {
00142     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d4/perfmsg_8h.html#a13">hEventLog</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00143         <a class="code" href="../../d8/d4/perfmsg_8h.html#a14">dwLogUsers</a>--;               <span class="comment">// decrement usage</span>
00144         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d4/perfmsg_8h.html#a14">dwLogUsers</a> &lt;= 0) {      <span class="comment">// and if we're the last, then close up log</span>
00145             <a class="code" href="../../d8/d4/perfmsg_8h.html#a7">REPORT_INFORMATION</a> (UTIL_CLOSING_LOG, <a class="code" href="../../d8/d4/perfmsg_8h.html#a3">LOG_DEBUG</a>);
00146             DeregisterEventSource (<a class="code" href="../../d8/d4/perfmsg_8h.html#a13">hEventLog</a>);
00147         }
00148     }
00149 }
00150 
<a name="l00151"></a><a class="code" href="../../d3/d5/perfutil_8h.html#a19">00151</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d3/d5/perfutil_8h.html#a19">GetQueryType</a> (
00152     IN LPWSTR lpValue)
00153 <span class="comment">/*++</span>
00154 <span class="comment">Routine Description:</span>
00155 <span class="comment">    Returns the type of query described in the lpValue string so that</span>
00156 <span class="comment">    the appropriate processing method may be used</span>
00157 <span class="comment"></span>
00158 <span class="comment">Arguments</span>
00159 <span class="comment">    IN lpValue</span>
00160 <span class="comment">    string passed to PerfRegQuery Value for processing</span>
00161 <span class="comment"></span>
00162 <span class="comment">Return Value</span>
00163 <span class="comment"></span>
00164 <span class="comment">    QUERY_GLOBAL        if lpValue == 0 (null pointer)</span>
00165 <span class="comment">           lpValue == pointer to Null string</span>
00166 <span class="comment">           lpValue == pointer to "Global" string</span>
00167 <span class="comment">    QUERY_FOREIGN</span>
00168 <span class="comment">        if lpValue == pointer to "Foreign" string</span>
00169 <span class="comment">    QUERY_COSTLY</span>
00170 <span class="comment">        if lpValue == pointer to "Costly" string</span>
00171 <span class="comment">    otherwise:</span>
00172 <span class="comment"></span>
00173 <span class="comment">    QUERY_ITEMS</span>
00174 <span class="comment"></span>
00175 <span class="comment">--*/</span>
00176 
00177 {
00178     WCHAR   *pwcArgChar, *pwcTypeChar;
00179     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    bFound;
00180     <span class="keywordflow">if</span> (lpValue == 0) {
00181         <span class="keywordflow">return</span> <a class="code" href="../../d3/d5/perfutil_8h.html#a2">QUERY_GLOBAL</a>;
00182     }
00183     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*lpValue == 0) {
00184         <span class="keywordflow">return</span> <a class="code" href="../../d3/d5/perfutil_8h.html#a2">QUERY_GLOBAL</a>;
00185     }
00186 
00187     <span class="comment">// check for "Global" request</span>
00188     pwcArgChar = lpValue;
00189     pwcTypeChar = <a class="code" href="../../d2/d5/perfutil_8c.html#a11">GLOBAL_STRING</a>;
00190     bFound = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;  <span class="comment">// assume found until contradicted</span>
00191 
00192     <span class="comment">// check to the length of the shortest string</span>
00193     <span class="keywordflow">while</span> ((*pwcArgChar != 0) &amp;&amp; (*pwcTypeChar != 0)) {
00194         <span class="keywordflow">if</span> (*pwcArgChar++ != *pwcTypeChar++) {
00195             bFound = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>; <span class="comment">// no match</span>
00196             <span class="keywordflow">break</span>;          <span class="comment">// bail out now</span>
00197         }
00198     }
00199     <span class="keywordflow">if</span> (bFound) <span class="keywordflow">return</span> <a class="code" href="../../d3/d5/perfutil_8h.html#a2">QUERY_GLOBAL</a>;
00200 
00201     <span class="comment">// check for "Foreign" request</span>
00202     pwcArgChar = lpValue;
00203     pwcTypeChar = <a class="code" href="../../d2/d5/perfutil_8c.html#a12">FOREIGN_STRING</a>;
00204     bFound = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;  <span class="comment">// assume found until contradicted</span>
00205 
00206     <span class="comment">// check to the length of the shortest string</span>
00207     <span class="keywordflow">while</span> ((*pwcArgChar != 0) &amp;&amp; (*pwcTypeChar != 0)) {
00208         <span class="keywordflow">if</span> (*pwcArgChar++ != *pwcTypeChar++) {
00209             bFound = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>; <span class="comment">// no match</span>
00210             <span class="keywordflow">break</span>;          <span class="comment">// bail out now</span>
00211         }
00212     }
00213     <span class="keywordflow">if</span> (bFound) <span class="keywordflow">return</span> <a class="code" href="../../d3/d5/perfutil_8h.html#a4">QUERY_FOREIGN</a>;
00214 
00215     <span class="comment">// check for "Costly" request</span>
00216     pwcArgChar = lpValue;
00217     pwcTypeChar = <a class="code" href="../../d2/d5/perfutil_8c.html#a13">COSTLY_STRING</a>;
00218     bFound = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;  <span class="comment">// assume found until contradicted</span>
00219 
00220     <span class="comment">// check to the length of the shortest string</span>
00221     <span class="keywordflow">while</span> ((*pwcArgChar != 0) &amp;&amp; (*pwcTypeChar != 0)) {
00222         <span class="keywordflow">if</span> (*pwcArgChar++ != *pwcTypeChar++) {
00223             bFound = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>; <span class="comment">// no match</span>
00224             <span class="keywordflow">break</span>;          <span class="comment">// bail out now</span>
00225         }
00226     }
00227     <span class="keywordflow">if</span> (bFound) <span class="keywordflow">return</span> <a class="code" href="../../d3/d5/perfutil_8h.html#a5">QUERY_COSTLY</a>;
00228 
00229     <span class="comment">// if not Global and not Foreign and not Costly,</span>
00230     <span class="comment">// then it must be an item list</span>
00231 
00232     <span class="keywordflow">return</span> <a class="code" href="../../d3/d5/perfutil_8h.html#a3">QUERY_ITEMS</a>;
00233 }
00234 
00235 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00236"></a><a class="code" href="../../d2/d5/perfutil_8c.html#a20">00236</a> <a class="code" href="../../d3/d5/perfutil_8h.html#a20">IsNumberInUnicodeList</a> (
00237     IN LPWSTR  lpwszUnicodeList
00238 )
00239 <span class="comment">/*++</span>
00240 <span class="comment">Routine Description:</span>
00241 <span class="comment">    When querying counters, the collect function receives a list of Unicode strings</span>
00242 <span class="comment">    representing object indexes.  This function parses the string and returns a bit</span>
00243 <span class="comment">    combination representing the needed objects.</span>
00244 <span class="comment"></span>
00245 <span class="comment">Arguments:</span>
00246 <span class="comment">     IN lpwszUnicodeList</span>
00247 <span class="comment">        Null terminated, space delimited list of decimal numbers</span>
00248 <span class="comment"></span>
00249 <span class="comment">Return Value:</span>
00250 <span class="comment">    The returned DWORD is a combination of QUERY_USER and QUERY_CS</span>
00251 <span class="comment">--*/</span>
00252 {
00253     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwThisNumber;
00254     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwReturnValue;
00255     WCHAR   *pwcThisChar;
00256     WCHAR   wcDelimiter;
00257     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    bValidNumber;
00258     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    bNewItem;
00259 
00260     <span class="keywordflow">if</span> (lpwszUnicodeList == 0) <span class="keywordflow">return</span> 0;    <span class="comment">// null pointer, # not found</span>
00261 
00262     pwcThisChar = lpwszUnicodeList;
00263     dwThisNumber = 0;
00264     dwReturnValue = 0;
00265     wcDelimiter = (WCHAR)<span class="charliteral">' '</span>;
00266     bValidNumber = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00267     bNewItem = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00268 
00269     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00270         <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d5/perfutil_8c.html#a6">EvalThisChar</a> (*pwcThisChar, wcDelimiter)) {
00271             <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/perfutil_8c.html#a2">DIGIT</a>:
00272                 <span class="comment">// if this is the first digit after a delimiter, then</span>
00273                 <span class="comment">// set flags to start computing the new number</span>
00274                 <span class="keywordflow">if</span> (bNewItem) {
00275                     bNewItem = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00276                     bValidNumber = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00277                 }
00278                 <span class="keywordflow">if</span> (bValidNumber) {
00279                     dwThisNumber *= 10;
00280                     dwThisNumber += (*pwcThisChar - (WCHAR)<span class="charliteral">'0'</span>);
00281                 }
00282                 <span class="keywordflow">break</span>;
00283             <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/perfutil_8c.html#a4">ENDOFSTRING</a>:
00284             <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/perfutil_8c.html#a3">DELIMITER</a>:
00285                 <span class="comment">// a delimiter is either the delimiter character or the</span>
00286                 <span class="comment">// end of the string ('\0') if when the delimiter has been</span>
00287                 <span class="comment">// reached a valid number was found, then compare it to the</span>
00288                 <span class="comment">// number from the argument list. if this is the end of the</span>
00289                 <span class="comment">// string and no match was found, then return.</span>
00290                 <span class="comment">//</span>
00291                 <span class="keywordflow">if</span> (bValidNumber) {
00292                     <span class="keywordflow">if</span> (dwThisNumber == <a class="code" href="../../d0/d5/perfuser_8c.html#a7">UserDataDefinition</a>.<a class="code" href="../../d5/d4/struct__USER__DATA__DEFINITION.html#o0">UserObjectType</a>.ObjectNameTitleIndex) {
00293                         dwReturnValue |= <a class="code" href="../../d3/d5/perfutil_8h.html#a7">QUERY_USER</a>;
00294                     }
00295                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwThisNumber == <a class="code" href="../../d0/d5/perfuser_8c.html#a8">CSDataDefinition</a>.<a class="code" href="../../d7/d9/struct__CS__DATA__DEFINITION.html#o0">CSObjectType</a>.ObjectNameTitleIndex) {
00296                         dwReturnValue |= <a class="code" href="../../d3/d5/perfutil_8h.html#a8">QUERY_CS</a>;
00297                     }
00298                     bValidNumber = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00299                 }
00300                 <span class="keywordflow">if</span> (*pwcThisChar == 0) {
00301                     <span class="keywordflow">return</span> dwReturnValue;
00302                 }
00303                 <span class="keywordflow">else</span> {
00304                     bNewItem = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00305                     dwThisNumber = 0;
00306                 }
00307                 <span class="keywordflow">break</span>;
00308 
00309             <span class="keywordflow">case</span> <a class="code" href="../../d2/d5/editreg_8c.html#a8">INVALID</a>:
00310                 <span class="comment">// if an invalid character was encountered, ignore all</span>
00311                 <span class="comment">// characters up to the next delimiter and then start fresh.</span>
00312                 <span class="comment">// the invalid number is not compared.</span>
00313                 bValidNumber = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00314                 <span class="keywordflow">break</span>;
00315 
00316             <span class="keywordflow">default</span>:
00317                 <span class="keywordflow">break</span>;
00318 
00319         }
00320     pwcThisChar++;
00321     }
00322 
00323 }   <span class="comment">// IsNumberInUnicodeList</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:09 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
