<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: lh_core/runtime.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>runtime.h File Reference</h1>
<p>
<a href="../../d4/d3/lh__core_2runtime_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a0">LHMatchColorsPrivate</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, <a class="el" href="../../d8/d3/unionCMColor.html">CMColor</a> *myColors, long count)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a1">LHCheckBitMapPrivate</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, const <a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *bitMap, <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a27">CMBitmapCallBackUPP</a> progressProc, void *refCon, <a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *resultBitMap)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a2">LHMatchBitMapPrivate</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, const <a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *bitMap, <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a27">CMBitmapCallBackUPP</a> progressProc, void *refCon, <a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *matchedBitMap)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a3">LHCheckColorsPrivate</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, <a class="el" href="../../d8/d3/unionCMColor.html">CMColor</a> *myColors, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> count, unsigned char *result)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a4">LHCheckColorsPrivateMS</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, <a class="el" href="../../d8/d3/unionCMColor.html">CMColor</a> *myColors, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> count, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a6">UINT8</a> *result)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a5">LHMatchBitMapPlanePrivate</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, const <a class="el" href="../../d2/d8/structLH__CMBitmapPlane.html">LH_CMBitmapPlane</a> *bitMapLH, <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a27">CMBitmapCallBackUPP</a> progressProc, void *refCon, <a class="el" href="../../d2/d8/structLH__CMBitmapPlane.html">LH_CMBitmapPlane</a> *matchedBitMapLH)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a6">ConvertNamedIndexToPCS</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> cw, <a class="el" href="../../d8/d3/unionCMColor.html">CMColor</a> *theData, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a14">SINT32</a> pixCnt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a7">ConvertNamedIndexToColors</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, <a class="el" href="../../d8/d3/unionCMColor.html">CMColor</a> *theData, long pixCnt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a8">ConvertPCSToNamedIndex</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, <a class="el" href="../../d8/d3/unionCMColor.html">CMColor</a> *theData, long pixCnt)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a9">ConvertLabToIndexBitmap</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a> InBuffer, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> processedLinesIn, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> inLineCount, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> width, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> rowBytes)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a10">ConvertIndexToLabBitmap</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a> InBuffer, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a> OutBuffer, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> processedLinesIn, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> lineCount, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> inWidth, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> inRowBytes, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> outRowBytes, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> outputSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a11">PreProcNamedColorMatchBitmap</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, <a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *inBitMap, <a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *outBitMap, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a21">Boolean</a> MatchInPlace)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a12">MidProcNamedColorMatchBitmap</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, <a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *InBitMap, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a> dataOut, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> startLine, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a> height)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d4/lh__core_2runtime_8h.html#a13">PostProcNamedColorMatchBitmap</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, <a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *inBitMap, <a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *outBitMap)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a10" doxytag="lh_core/runtime.h::ConvertIndexToLabBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> ConvertIndexToLabBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OutBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>processedLinesIn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>lineCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>inWidth</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>inRowBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>outRowBytes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>outputSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html#l04948">4948</a> of file <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html">lh_core/runtime.c</a>.
<p>
<pre class="fragment"><div>04957 {
04958         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
04959         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a1">LUT_DATA_TYPE</a>   tagH=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04960         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  *tagTbl = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,*ColorPtr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04961         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  *imgIn=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04962         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>                   *imgOut=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04963         <span class="keywordtype">int</span>                             deviceChannelCount,elemSz;
04964         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  i,j,index,countNamesInProfile;
04965         
04966         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"ConvertIndexToLabBitmap"</span>)
04967         <span class="comment">/* set up the table for indexing */</span>
04968         tagH = modelingData-&gt;theNamedColorTagData;
04969         if (tagH==NULL) {
04970                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a>;
04971                 <span class="keywordflow">goto</span> CleanUp;
04972         }
04973         
04974         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(tagH);
04975         tagTbl = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(tagH) + 58;               <span class="comment">/* points to PCS */</span>
04976         deviceChannelCount = ((<a class="code" href="../../d4/d3/structicNamedColor2Type.html">icNamedColor2Type</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(tagH))-&gt;ncolor.nDeviceCoords;
04977         countNamesInProfile = ((<a class="code" href="../../d4/d3/structicNamedColor2Type.html">icNamedColor2Type</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(tagH))-&gt;ncolor.count;
04978         <span class="keywordflow">if</span> (deviceChannelCount==3) {
04979                 elemSz = 32+(3+3)*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
04980         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deviceChannelCount==4) {
04981                 elemSz = 32+(3+4)*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
04982         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deviceChannelCount==0) {
04983                 elemSz = 32+(3+0)*<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
04984         } <span class="keywordflow">else</span> {
04985                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a>;
04986                 <span class="keywordflow">goto</span> CleanUp;
04987         }
04988         elemSz/=2;
04989         
04990         <span class="comment">/* ...and convert the data from index to PCS values */</span>
04991         <span class="keywordflow">for</span>( i=processedLinesIn; i&lt;processedLinesIn+lineCount; i++ ){
04992                 imgIn = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a> *)(InBuffer + i * inRowBytes);
04993                 imgOut = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>*)OutBuffer + (i-processedLinesIn) * outRowBytes;
04994                 <span class="keywordflow">if</span>( outputSize == 24 ){
04995                         <span class="keywordflow">for</span> (j=0;j&lt;inWidth;j++) {
04996                                 index = *imgIn++;
04997                                 <span class="keywordflow">if</span>( index == 0 || index &gt; countNamesInProfile ){
04998                                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a37">cmNamedColorNotFound</a>;
04999                                         <span class="keywordflow">goto</span> CleanUp;
05000                                 }
05001 
05002                                 ColorPtr = tagTbl + (index-1)*elemSz;
05003                                 *imgOut++  = (*ColorPtr++)&gt;&gt;8;
05004                                 *imgOut++  = (*ColorPtr++)&gt;&gt;8;
05005                                 *imgOut++  = (*ColorPtr++)&gt;&gt;8;
05006                         }
05007                 }
05008                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( outputSize == 32 ){
05009                         <span class="keywordflow">for</span> (j=0;j&lt;inWidth;j++) {
05010                                 index = *imgIn++;
05011                                 <span class="keywordflow">if</span>( index == 0 || index &gt; countNamesInProfile ){
05012                                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a37">cmNamedColorNotFound</a>;
05013                                         <span class="keywordflow">goto</span> CleanUp;
05014                                 }
05015 
05016                                 ColorPtr = tagTbl + (index-1)*elemSz;
05017                                 *imgOut++  = (*ColorPtr++)&gt;&gt;8;
05018                                 *imgOut++  = (*ColorPtr++)&gt;&gt;8;
05019                                 *imgOut    = (*ColorPtr++)&gt;&gt;8;
05020                                 imgOut += 2;
05021                         }
05022                 }
05023         }
05024 CleanUp:
05025         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(tagH);
05026         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"ConvertIndexToLabBitmap"</span>)
05027         return err;
05028 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="lh_core/runtime.h::ConvertLabToIndexBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> ConvertLabToIndexBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>InBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>processedLinesIn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>inLineCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>width</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>rowBytes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html#l04865">4865</a> of file <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html">lh_core/runtime.c</a>.
<p>
<pre class="fragment"><div>04871 {
04872         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
04873         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a1">LUT_DATA_TYPE</a>   tagH=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04874         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  *tagTbl = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,*colorPtr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04875         <span class="keywordtype">int</span>                             deviceChannelCount,elemSz,count;
04876         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  i,j,k,index,dE,dEnow;
04877         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  LL,aa,bb;
04878         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>                   *imgIn=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,*imgOut=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04879         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  *imgInPtr=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04880         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>                   *imgInPtr8=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04881         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>                   *imgOutPtr8=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04882         
04883         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"ConvertLabToIndexBitmap"</span>)
04884         <span class="comment">/* prepare the tag table  */</span>
04885         tagH = modelingData-&gt;theNamedColorTagData;
04886         if (tagH==NULL){
04887                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a>;
04888                 <span class="keywordflow">goto</span> CleanUp;
04889         }
04890         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(tagH);
04891         tagTbl = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(tagH) + 58;
04892         count = ((<a class="code" href="../../d4/d3/structicNamedColor2Type.html">icNamedColor2Type</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(tagH))-&gt;ncolor.count;
04893         deviceChannelCount = ((<a class="code" href="../../d4/d3/structicNamedColor2Type.html">icNamedColor2Type</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(tagH))-&gt;ncolor.nDeviceCoords;
04894         <span class="keywordflow">if</span> (deviceChannelCount == 3){
04895                 elemSz = 32+(3+3)*<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>);
04896         }
04897         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deviceChannelCount == 4){
04898                 elemSz = 32+(3+4)*<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>);
04899         }
04900         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deviceChannelCount == 0){
04901                 elemSz = 32+(3+0)*<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>);
04902         }
04903         <span class="keywordflow">else</span>{
04904                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a>;
04905                 <span class="keywordflow">goto</span> CleanUp;
04906         }
04907         elemSz /= 2;
04908         
04909         <span class="comment">/* search for index */</span>
04910         imgIn = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>*)InBuffer + processedLinesIn * rowBytes;
04911         imgInPtr8=((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)imgIn);
04912         LL = *(imgInPtr8+0)+1;  <span class="comment">/* do not use cache for first pixel */</span>
04913         <span class="keywordflow">for</span> (i = 0; i &lt; inLineCount; i++){
04914                 <span class="keywordflow">for</span> (j = 0; j &lt; width; j++){
04915                         imgInPtr8=((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)imgIn+j*4);
04916                         <span class="keywordflow">if</span>( LL == *(imgInPtr8+0) ){
04917                                 <span class="keywordflow">if</span>( aa == *(imgInPtr8+1) &amp;&amp; bb == *(imgInPtr8+2) ){
04918                                         *((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a> *)imgIn+j) = index+1;
04919                                         <span class="keywordflow">continue</span>;
04920                                 }
04921                         }
04922                         LL = *(imgInPtr8+0);
04923                         aa = *(imgInPtr8+1);
04924                         bb = *(imgInPtr8+2);
04925                         <span class="comment">/* go through the whole table to find the closest one*/</span>
04926                         dEnow = 0x40000;        <span class="comment">/* just arbitrarily high = 256*256*4 */</span>
04927                         index =(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>)-1;
04928                         colorPtr = tagTbl;
04929                         <span class="keywordflow">for</span> (k = 0; k &lt; (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>)count; k++){
04930                                 dE =      <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a6">POS</a>((<span class="keywordtype">long</span>)aa - (*(colorPtr+1)&gt;&gt;8));
04931                                 dE = dE + <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a6">POS</a>((<span class="keywordtype">long</span>)bb - (*(colorPtr+2)&gt;&gt;8));
04932                                 dE = 2*dE + (dE&gt;&gt;1) + <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a6">POS</a>((<span class="keywordtype">long</span>)LL - (*(colorPtr)&gt;&gt;8));                 <span class="comment">/* Quantization L = 2.55 * (a|b) */</span>
04933                                 <span class="keywordflow">if</span> (dE &lt; dEnow){
04934                                         index = k;
04935                                         dEnow = dE;
04936                                 }
04937                                 colorPtr += elemSz;
04938                         }
04939                         *((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a> *)imgIn+j) = index+1;
04940                 }
04941                 imgIn+=rowBytes;
04942         }
04943 CleanUp:
04944         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(tagH);
04945         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"ConvertLabToIndexBitmap"</span>)
04946         return err;
04947 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="lh_core/runtime.h::ConvertNamedIndexToColors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a> ConvertNamedIndexToColors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d8/d3/unionCMColor.html">CMColor</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>theData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>pixCnt</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="lh_core/runtime.h::ConvertNamedIndexToPCS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a> ConvertNamedIndexToPCS           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cw</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d8/d3/unionCMColor.html">CMColor</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>theData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a14">SINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pixCnt</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html#l04690">4690</a> of file <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html">lh_core/runtime.c</a>.
<p>
<pre class="fragment"><div>04693 {
04694         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  *tagTbl = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04695         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a1">LUT_DATA_TYPE</a>   tagH = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04696         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
04697         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  i,index;
04698         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                  *colorPtr=<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04699         <span class="keywordtype">int</span>                             elemSz,deviceChannelCount,count;
04700         <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>             modelingData = (<a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>)cw;
04701 
04702         
04703         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"ConvertNamedIndexToPCS"</span>)
04704         if( cw == 0 )return cmparamErr;
04705         {
04706                 <span class="comment">/* prepare the tag table */</span>
04707                         tagH = modelingData-&gt;theNamedColorTagData;
04708                 <span class="keywordflow">if</span> (tagH == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) 
04709                 {
04710                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a>;
04711                         <span class="keywordflow">goto</span> CleanUp;
04712                 }
04713                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(tagH);
04714                 
04715                 <span class="comment">/* tagTbl should now point to beginning of first PCS data */</span>
04716                 <span class="comment">/* = CMNamedColor2Type_header(84) + firstName(32) */</span>
04717                 tagTbl = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(tagH) + 58;
04718                 
04719                 <span class="comment">/* find out how many bytes to skip per element. div'ed 2 for indexing purpose */</span>
04720                 count = ((<a class="code" href="../../d4/d3/structicNamedColor2Type.html">icNamedColor2Type</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(tagH))-&gt;ncolor.count;
04721                 deviceChannelCount = ((<a class="code" href="../../d4/d3/structicNamedColor2Type.html">icNamedColor2Type</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(tagH))-&gt;ncolor.nDeviceCoords;
04722                 <span class="keywordflow">if</span> (deviceChannelCount == 3) 
04723                 {
04724                         elemSz = 32+(3+3)*<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>);
04725                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deviceChannelCount == 4) 
04726                 {
04727                         elemSz = 32+(3+4)*<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>);
04728                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (deviceChannelCount == 0) 
04729                 {
04730                         elemSz = 32+(3+0)*<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>);
04731                 } <span class="keywordflow">else</span> 
04732                 {
04733                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a30">cmparamErr</a>;
04734                         <span class="keywordflow">goto</span> CleanUp;
04735                 }
04736                 elemSz /= 2;
04737                 
04738                 <span class="comment">/* doing the actual */</span>
04739                 <span class="keywordflow">for</span> (i=0; i&lt;(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>)pixCnt; i++) 
04740                 {
04741                         <span class="comment">/* go to the index'th element*/</span>
04742                         index = theData-&gt;<a class="code" href="../../d8/d3/unionCMColor.html#o7">namedColor</a>.<a class="code" href="../../d7/d4/structPI__NAMEDCOLOR.html#o0">namedColorIndex</a>;
04743                         <span class="keywordflow">if</span> (index &gt; (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>)count || index == 0 ) 
04744                         {
04745                                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a37">cmNamedColorNotFound</a>;
04746                                 <span class="keywordflow">goto</span> CleanUp;
04747                         }
04748                         colorPtr = tagTbl + (index-1)*elemSz;
04749                         <span class="comment">/* put in all the info */</span>
04750                         theData-&gt;<a class="code" href="../../d8/d3/unionCMColor.html#o5">Lab</a>.<a class="code" href="../../d6/d4/structPI__LabCOLOR.html#o0">L</a> = *colorPtr++;
04751                         theData-&gt;<a class="code" href="../../d8/d3/unionCMColor.html#o5">Lab</a>.<a class="code" href="../../d6/d4/structPI__LabCOLOR.html#o1">a</a> = *colorPtr++;
04752                         theData-&gt;<a class="code" href="../../d8/d3/unionCMColor.html#o5">Lab</a>.<a class="code" href="../../d6/d4/structPI__LabCOLOR.html#o2">b</a> = *colorPtr++;
04753                         theData++;
04754                 }
04755                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(tagH);
04756         }
04757 CleanUp:
04758         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"ConvertNamedIndexToPCS"</span>)
04759         return err;
04760 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="lh_core/runtime.h::ConvertPCSToNamedIndex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a> ConvertPCSToNamedIndex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d8/d3/unionCMColor.html">CMColor</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>theData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>pixCnt</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="lh_core/runtime.h::LHCheckBitMapPrivate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> LHCheckBitMapPrivate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>const <a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>bitMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a27">CMBitmapCallBackUPP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>progressProc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>refCon</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>resultBitMap</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html#l04255">4255</a> of file <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html">lh_core/runtime.c</a>.
<p>
<pre class="fragment"><div>04260 {
04261         <a class="code" href="../../d7/d3/structCMCalcParam.html">CMCalcParam</a>     calcParam;
04262         <a class="code" href="../../d0/d4/structCMLutParam.html">CMLutParam</a>              lutParam;
04263         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = -1;
04264         <a class="code" href="../../d9/d4/structColorSpaceInfo.html">ColorSpaceInfo</a>  info;
04265         <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a8">CalcProcPtr</a>             calcRoutine     = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
04266         <a class="code" href="../../d6/d3/structCMBitmap.html">CMBitmap</a>                bitMapIn                        = *inBitMap;
04267         <a class="code" href="../../d6/d3/structCMBitmap.html">CMBitmap</a>                bitMapOut;
04268         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                  inColorSpace    = modelingData-&gt;firstColorSpace;
04269         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                 progressProcWasCalled = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04270         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  offset;
04271         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  progressTimer;
04272         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  dimLoop;
04273         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                 matchInPlace = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04274         <span class="keywordtype">long</span>                    progressProcCount = 0;
04275         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  inLineCount;
04276         
04277         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"LHCheckBitMapPrivate"</span>)
04278 
04279         if( (modelingData)-&gt;gamutLutParam.colorLut == 0 )return cmMethodError;
04280         LOCK_DATA((modelingData)-&gt;gamutLutParam.inputLut);
04281         LOCK_DATA((modelingData)-&gt;gamutLutParam.colorLut);
04282         LOCK_DATA((modelingData)-&gt;gamutLutParam.outputLut);
04283 
04284         SetMem(&amp;info,           sizeof(<a class="code" href="../../d9/d4/structColorSpaceInfo.html">ColorSpaceInfo</a>), 0);
04285         SetMem(&amp;calcParam,      sizeof(<a class="code" href="../../d7/d3/structCMCalcParam.html">CMCalcParam</a>),    0);
04286 
04287         if ( (outBitMap == nil ) || (modelingData-&gt;gamutLutParam.colorLut == nil) )
04288         {
04289                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a36">cmInvalidDstMap</a>;
04290                 <span class="keywordflow">goto</span> CleanupAndExit;
04291         }
04292         bitMapOut = *outBitMap;
04293         <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a18">FillLutParamChk</a>(&amp;lutParam, modelingData);
04294         <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a19">FillCalcParam</a>(&amp;calcParam, &amp;bitMapIn, &amp;bitMapOut);
04295         
04296         err = <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a21">CheckInputColorSpace</a>( &amp;bitMapIn, &amp;calcParam, &amp;info, inColorSpace, lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> );
04297         inLineCount = calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>;
04298         <span class="keywordflow">if</span> (err)
04299                 <span class="keywordflow">goto</span> CleanupAndExit;
04300                 
04301         err = <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a24">CheckOutputColorSpaceChk</a>( &amp;bitMapOut, &amp;calcParam, &amp;info );
04302         <span class="keywordflow">if</span> (err)
04303                 <span class="keywordflow">goto</span> CleanupAndExit;
04304         
04305         info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o10">inPlace</a> = bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a> == bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a> &amp;&amp; info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a> &amp;&amp; info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
04306         calcRoutine = <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a27">FindCalcRoutine</a>( &amp;calcParam, &amp;lutParam, &amp;info, modelingData-&gt;lookup );
04307         <span class="keywordflow">if</span> (calcRoutine == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
04308         {
04309                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a32">cmMethodError</a>;
04310                 <span class="keywordflow">goto</span> CleanupAndExit;
04311         }
04312         
04313         <span class="comment">/* ------------------------------------------------- 8 or 16 bit data --------------------------------------------------------- */</span>
04314         <span class="keywordflow">if</span> ((info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>) &amp;&amp; (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>) &amp;&amp; modelingData-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a16">NoNamedColorProfile</a>)
04315         {
04316                 <span class="keywordflow">if</span> (progressProc == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
04317                         err = <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a4">CallCalcProc</a>(calcRoutine,&amp;calcParam, &amp;lutParam);          <span class="comment">/* no callback proc - do it all in one step */</span>
04318                 <span class="keywordflow">else</span>
04319                 {
04320                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> = <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a1">kMaxTempBlock</a> / calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a>;
04321                         <span class="keywordflow">if</span> (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> &lt; 1)
04322                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> = 1;
04323                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> &gt; bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>)
04324                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> = bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>;
04325                                 
04326                         progressTimer = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>();
04327                         <span class="keywordflow">while</span> ( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> &lt;  bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a> )
04328                         {
04329                                 err = <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a4">CallCalcProc</a>(calcRoutine,&amp;calcParam, &amp;lutParam);
04330                         
04331                                 <span class="keywordflow">for</span> (dimLoop = 0; dimLoop&lt; lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>; dimLoop++)
04332                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o8">inputData</a>[dimLoop] = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o8">inputData</a>[dimLoop] + calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> * calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a>;
04333                                         
04334                                 <span class="keywordflow">for</span> (dimLoop = 0; dimLoop&lt; lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>; dimLoop++)
04335                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[dimLoop] =  (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[dimLoop]  + calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> * calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o5">cmOutputBytesPerLine</a>;
04336         
04337                                 info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> += calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>;
04338                                 <span class="keywordflow">if</span> ( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> + calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> &gt; bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a> )
04339                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> = bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>-info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>;
04340                                                 
04341                                 <span class="comment">/* - - - - - handle CMBitmapCallBackProc - - - - - */</span>
04342                                 <span class="keywordflow">if</span> ( progressProc &amp;&amp; ( progressTimer + <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a0">kProgressTicks</a> &lt; (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>)<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>()) )  
04343                                 {
04344                                         progressProcWasCalled = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04345                                         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a1">CallCMBitmapCallBackProc</a> ( progressProc, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, (<span class="keywordtype">void</span> *)refCon ))
04346                                         {
04347                                                 info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> =  bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>; 
04348                                                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a39">userCanceledErr</a>;
04349                                         } <span class="keywordflow">else</span>
04350                                                 progressTimer = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>();
04351                                                 progressProcCount = info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>;
04352                                 }
04353                         }
04354                 }
04355         }
04356         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (modelingData-&gt;hasNamedColorProf != <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a17">NamedColorProfileOnly</a> ){
04357                 info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> = 0;
04358                 progressTimer = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>();
04359                 <span class="keywordflow">if</span>( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> &amp;&amp; info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> ){
04360                         <span class="keywordflow">if</span>( inLineCount &gt; calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> )inLineCount = calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>;
04361                 }
04362                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> ){
04363                 }
04364                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> ){
04365                         inLineCount = calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>;
04366                 }
04367                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( progressProc ){
04368                         inLineCount = <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a1">kMaxTempBlock</a> / calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a>;
04369                         <span class="keywordflow">if</span> (inLineCount &lt; 1)
04370                                 inLineCount = 1;
04371                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inLineCount &gt; bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>)
04372                                 inLineCount = bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>;
04373                 }
04374                 <span class="keywordflow">while</span> ( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> &lt;  bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a> )
04375                 {
04376                         <span class="keywordflow">if</span> ( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> + inLineCount &gt; bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a> )
04377                                 inLineCount = bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>-info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>;
04378 
04379                         <span class="keywordflow">if</span> (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o0">origSizeIn</a> == 5 )                                                                                                                                                      <span class="comment">/* input is 5 bit */</span>
04380                                 <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a12">Convert5To8</a>  ( bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>, (Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, inLineCount, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a> );
04381 <span class="preprocessor">#ifdef PI_Application_h</span>
04382 <span class="preprocessor"></span>                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o0">origSizeIn</a> == 6 )                                                                                                                                                 <span class="comment">/* output is 5 bit */</span>
04383                                 Convert565To8 ( bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>, (Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, inLineCount, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a> );
04384 <span class="preprocessor">#endif</span>
04385 <span class="preprocessor"></span>                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o0">origSizeIn</a> == 10 ) 
04386                                         <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a16">Convert10To16</a>  ( bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>, (Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, inLineCount, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a> );
04387                         
04388                         <span class="keywordflow">if</span> (modelingData-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a18">NamedColorProfileAtBegin</a> ){
04389                                 err = <a class="code" href="../../d4/d4/w98_2lh__core_2runtime_8h.html#a10">ConvertIndexToLabBitmap</a>(  modelingData, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>, 
04390                                                                                                 (Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, 
04391                                                                                                 inLineCount, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, 
04392                                                                                                 bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>, 
04393                                                                                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a>, 
04394                                                                                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o6">cmInputPixelOffset</a>*8 );
04395                                 <span class="keywordflow">if</span> (err) 
04396                                         <span class="keywordflow">goto</span> CleanupAndExit;
04397                         }
04398                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> = inLineCount;
04399                         err = <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a4">CallCalcProc</a>( calcRoutine, &amp;calcParam, &amp;lutParam );
04400                         <span class="keywordflow">if</span> (err) 
04401                                 <span class="keywordflow">goto</span> CleanupAndExit;
04402 
04403                         <span class="keywordflow">if</span>( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o1">origSizeOut</a> == 1 )                                                                                                                                                     <span class="comment">/* output is 5 bit */</span>
04404                                 <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a14">Convert8To1</a> ( (Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>);
04405 
04406                         info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> += inLineCount;
04407                         <span class="comment">/* - - - - - handle CMBitmapCallBackProc - - - - - */</span>
04408                         <span class="keywordflow">if</span> ( progressProc &amp;&amp; ( progressTimer + <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a0">kProgressTicks</a> &lt; (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>)<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>()) )  
04409                         {
04410                                 progressProcWasCalled = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04411                                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a1">CallCMBitmapCallBackProc</a> ( progressProc, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, (<span class="keywordtype">void</span> *)refCon ))
04412                                 {
04413                                         info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> =  bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>; 
04414                                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a39">userCanceledErr</a>;
04415                                 } <span class="keywordflow">else</span>
04416                                         progressTimer = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>();
04417                                         progressProcCount = info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>;
04418                         }
04419                         <span class="keywordflow">if</span>( !info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> ){
04420                                 offset = calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> * calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a>;
04421                                 <span class="keywordflow">for</span> (dimLoop = 0; dimLoop&lt; lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>; dimLoop++)
04422                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o8">inputData</a>[dimLoop] = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o8">inputData</a>[dimLoop] + offset;
04423                         }
04424                         <span class="keywordflow">if</span>( !info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> ){
04425                                 offset = calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> * calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o5">cmOutputBytesPerLine</a>;
04426                                 <span class="keywordflow">for</span> (dimLoop = 0; dimLoop&lt; lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>; dimLoop++)
04427                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[dimLoop] =  (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[dimLoop]  + offset;
04428                         }
04429                 }
04430                 <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>);
04431                 <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a>);
04432         }
04433         <span class="keywordflow">else</span>{
04434                 <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>);
04435                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a32">cmMethodError</a>;
04436                 <span class="keywordflow">goto</span> CleanupAndExit;
04437         }
04438         <span class="keywordflow">if</span> (err) 
04439                 <span class="keywordflow">goto</span> CleanupAndExit;
04440         
04441         <span class="keywordflow">if</span>( progressProcWasCalled &amp;&amp; progressProcCount != bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a> )
04442                 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a1">CallCMBitmapCallBackProc</a> ( progressProc, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>, (<span class="keywordtype">void</span> *)refCon );
04443 CleanupAndExit:
04444         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>((modelingData)-&gt;gamutLutParam.inputLut);
04445         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>((modelingData)-&gt;gamutLutParam.colorLut);
04446         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>((modelingData)-&gt;gamutLutParam.outputLut);
04447 
04448         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"LHCheckBitMapPrivate"</span>)
04449         
04450         return err;
04451 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="lh_core/runtime.h::LHCheckColorsPrivate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> LHCheckColorsPrivate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d8/d3/unionCMColor.html">CMColor</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>myColors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>count</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>unsigned char *&nbsp;</td>
          <td class="mdname" nowrap> <em>result</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="lh_core/runtime.h::LHCheckColorsPrivateMS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> LHCheckColorsPrivateMS           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d8/d3/unionCMColor.html">CMColor</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>myColors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>count</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a6">UINT8</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>result</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html#l03797">3797</a> of file <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html">lh_core/runtime.c</a>.
<p>
<pre class="fragment"><div>03801 {
03802         <a class="code" href="../../d7/d3/structCMCalcParam.html">CMCalcParam</a>     calcParam;
03803         <a class="code" href="../../d0/d4/structCMLutParam.html">CMLutParam</a>              lutParam;
03804         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = -1;
03805         <a class="code" href="../../d9/d4/structColorSpaceInfo.html">ColorSpaceInfo</a>  info;
03806         <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a8">CalcProcPtr</a>             calcRoutine   = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
03807 
03808         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"LHCheckColorsPrivateMS"</span>)
03809         
03810         if( (modelingData)-&gt;gamutLutParam.colorLut == 0 )return cmMethodError;
03811         LOCK_DATA((modelingData)-&gt;gamutLutParam.inputLut);
03812         LOCK_DATA((modelingData)-&gt;gamutLutParam.colorLut);
03813         LOCK_DATA((modelingData)-&gt;gamutLutParam.outputLut);
03814 
03815         <span class="comment">/* preprocess for NamedColor stuff */</span>
03816         if (modelingData-&gt;hasNamedColorProf == NamedColorProfileOnly){
03817                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
03818                 <span class="keywordflow">goto</span> CleanupAndExit;
03819         } 
03820         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (modelingData-&gt;hasNamedColorProf==<a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a18">NamedColorProfileAtBegin</a>){
03821                 err = <a class="code" href="../../d4/d4/w98_2lh__core_2runtime_8h.html#a6">ConvertNamedIndexToPCS</a>(modelingData,myColors,count); 
03822                 <span class="keywordflow">if</span> (err) <span class="keywordflow">goto</span> CleanupAndExit;
03823         }
03824 
03825         <a class="code" href="../../d7/d7/w98_2lh__open_2pi__mem_8c.html#a6">SetMem</a>(&amp;info,           <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d4/structColorSpaceInfo.html">ColorSpaceInfo</a>), 0);
03826         <a class="code" href="../../d7/d7/w98_2lh__open_2pi__mem_8c.html#a6">SetMem</a>(&amp;calcParam,      <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d3/structCMCalcParam.html">CMCalcParam</a>),    0);
03827  
03828         info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o0">origSizeIn</a>  = 16;
03829         info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o1">origSizeOut</a> = 8;
03830         info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o2">usedSizeIn</a>  = 16;
03831         info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o3">usedSizeOut</a> = 8;
03832 
03833         <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a18">FillLutParamChk</a>(&amp;lutParam, modelingData);
03834         <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a20">FillCalcParamCM</a>(&amp;calcParam, &amp;lutParam, myColors, count );
03835         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[0] = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)result;
03836         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o5">cmOutputBytesPerLine</a> = count*<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>);
03837         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o7">cmOutputPixelOffset</a> = 1;
03838         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o1">cmOutputColorSpace</a> = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a151a96">cmGraySpace8Bit</a>; <span class="comment">/* cmGraySpace is 16 bit */</span>
03839 
03840         
03841         info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o10">inPlace</a> = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)myColors == result;
03842         calcRoutine = <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a27">FindCalcRoutine</a>( &amp;calcParam, &amp;lutParam, &amp;info, modelingData-&gt;lookup );
03843         <span class="keywordflow">if</span> (calcRoutine == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
03844         {
03845                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a32">cmMethodError</a>;
03846                 <span class="keywordflow">goto</span> CleanupAndExit;
03847         }
03848                 
03849         err = <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a4">CallCalcProc</a>(calcRoutine,&amp;calcParam, &amp;lutParam);
03850         <span class="keywordflow">if</span> (err)
03851                 <span class="keywordflow">goto</span> CleanupAndExit;
03852         
03853         <span class="comment">/* postprocess for NamedColor stuff */</span>
03854         <span class="keywordflow">if</span>( modelingData-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a19">NamedColorProfileAtEnd</a> ){
03855                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
03856                 <span class="keywordflow">goto</span> CleanupAndExit;
03857         }
03858 CleanupAndExit:
03859         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>((modelingData)-&gt;gamutLutParam.inputLut);
03860         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>((modelingData)-&gt;gamutLutParam.colorLut);
03861         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>((modelingData)-&gt;gamutLutParam.outputLut);
03862 
03863         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"LHCheckColorsPrivateMS"</span>)
03864         return err;
03865 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="lh_core/runtime.h::LHMatchBitMapPlanePrivate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> LHMatchBitMapPlanePrivate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>const <a class="el" href="../../d2/d8/structLH__CMBitmapPlane.html">LH_CMBitmapPlane</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>bitMapLH</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a27">CMBitmapCallBackUPP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>progressProc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>refCon</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d2/d8/structLH__CMBitmapPlane.html">LH_CMBitmapPlane</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>matchedBitMapLH</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html#l04466">4466</a> of file <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html">lh_core/runtime.c</a>.
<p>
<pre class="fragment"><div>04471 {
04472         <a class="code" href="../../d7/d3/structCMCalcParam.html">CMCalcParam</a>     calcParam;
04473         <a class="code" href="../../d0/d4/structCMLutParam.html">CMLutParam</a>              lutParam;
04474         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = -1;
04475         <a class="code" href="../../d9/d4/structColorSpaceInfo.html">ColorSpaceInfo</a>  info;
04476         <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a8">CalcProcPtr</a>             calcRoutine             = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
04477         <a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html">LH_CMBitmapPlane</a> *      secondBitmapLH  = matchedBitMapLH;
04478         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                  inColorSpace            = (modelingData)-&gt;firstColorSpace;
04479         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                  outColorSpace           = (modelingData)-&gt;lastColorSpace;
04480         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                 progressProcWasCalled = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04481         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                 matchInPlace = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04482         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  dimLoop;
04483         
04484         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"LHMatchBitMapPlanePrivate"</span>)
04485         
04486         SetMem(&amp;info,           sizeof(<a class="code" href="../../d9/d4/structColorSpaceInfo.html">ColorSpaceInfo</a>), 0);
04487         SetMem(&amp;calcParam,      sizeof(<a class="code" href="../../d7/d3/structCMCalcParam.html">CMCalcParam</a>),    0);
04488         
04489         if (secondBitmapLH == nil)
04490         {
04491                 secondBitmapLH = (<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html">LH_CMBitmapPlane</a> *)bitMapLH;
04492                 matchInPlace = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04493         }
04494         
04495         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>((modelingData)-&gt;lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
04496         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>((modelingData)-&gt;lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
04497         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>((modelingData)-&gt;lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
04498         
04499         <span class="comment">/* create CMBitmap based on the LH_CMBitmapPlane - so we can use the 'standard' setup functions */</span>
04500         {
04501                 <a class="code" href="../../d6/d3/structCMBitmap.html">CMBitmap</a>                bitMap;
04502                 <a class="code" href="../../d6/d3/structCMBitmap.html">CMBitmap</a>                secondBitmap;
04503         
04504                 bitMap.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>                    = bitMapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o0">image</a>[0];
04505                 bitMap.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>                    = bitMapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o1">width</a>;
04506                 bitMap.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>                   = bitMapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o2">height</a>;
04507                 bitMap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>                 = bitMapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o3">rowBytes</a>;
04508                 bitMap.<a class="code" href="../../d6/d3/structCMBitmap.html#o4">pixelSize</a>                = bitMapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o5">pixelSize</a>;
04509                 bitMap.<a class="code" href="../../d6/d3/structCMBitmap.html#o5">space</a>                    = bitMapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o6">space</a>;
04510         
04511                 secondBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>              = secondBitmapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o0">image</a>[0];
04512                 secondBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>              = secondBitmapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o1">width</a>;
04513                 secondBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>             = secondBitmapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o2">height</a>;
04514                 secondBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>   = secondBitmapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o3">rowBytes</a>;
04515                 secondBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o4">pixelSize</a>  = secondBitmapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o5">pixelSize</a>;
04516                 secondBitmap.<a class="code" href="../../d6/d3/structCMBitmap.html#o5">space</a>              = secondBitmapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o6">space</a>;
04517         
04518                 <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a17">FillLutParam</a>(&amp;lutParam, modelingData);
04519                 <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a19">FillCalcParam</a>(&amp;calcParam, &amp;bitMap, &amp;secondBitmap);
04520 
04521                 err = <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a21">CheckInputColorSpace</a>(&amp;bitMap,&amp;calcParam, &amp;info, inColorSpace, lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> );
04522                 <span class="keywordflow">if</span> (err)
04523                         <span class="keywordflow">goto</span> CleanupAndExit;
04524                 err = <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a22">CheckOutputColorSpace</a>(&amp;secondBitmap,&amp;calcParam, &amp;info, outColorSpace, lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> );
04525                 <span class="keywordflow">if</span> (err)
04526                         <span class="keywordflow">goto</span> CleanupAndExit;
04527         }
04528         
04529         <span class="comment">/* now update the input/output data pointers */</span>
04530         <span class="keywordflow">for</span> (dimLoop = 0; dimLoop &lt; 8; dimLoop++)
04531         {
04532                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o8">inputData</a>[dimLoop]    = bitMapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o0">image</a>[dimLoop];
04533                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[dimLoop]   = secondBitmapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o0">image</a>[dimLoop];
04534         }
04535         
04536         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o6">cmInputPixelOffset</a> = bitMapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o4">elementOffset</a>;
04537         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o7">cmOutputPixelOffset</a> = secondBitmapLH-&gt;<a class="code" href="../../d2/d8/structLH__CMBitmapPlane.html#o4">elementOffset</a>;
04538         <span class="keywordflow">if</span> (bitMapLH == secondBitmapLH)         <span class="comment">/* matching in place - check if pixeloffsets are ok */</span>
04539         {
04540                 <span class="keywordflow">if</span> (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o6">cmInputPixelOffset</a> &lt; calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o7">cmOutputPixelOffset</a>)
04541                 {
04542                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a36">cmInvalidDstMap</a>;
04543                         <span class="keywordflow">goto</span> CleanupAndExit;
04544                 }
04545                 <span class="keywordflow">if</span> (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o0">origSizeIn</a> * lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> &lt; info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o1">origSizeOut</a> * lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>)
04546                 {
04547                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a36">cmInvalidDstMap</a>;
04548                         <span class="keywordflow">goto</span> CleanupAndExit;
04549                 }
04550         } <span class="keywordflow">else</span>
04551         {
04552                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o10">copyAlpha</a> = (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o0">cmInputColorSpace</a> &amp; <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a43">cmAlphaSpace</a>) &amp;&amp; (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o1">cmOutputColorSpace</a> &amp; <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a43">cmAlphaSpace</a>);
04553         }
04554 
04555         info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o10">inPlace</a> = info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a> &amp;&amp; info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
04556         calcRoutine = <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a27">FindCalcRoutine</a>( &amp;calcParam, &amp;lutParam, &amp;info, modelingData-&gt;lookup );
04557         <span class="keywordflow">if</span> (calcRoutine == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
04558         {
04559                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a32">cmMethodError</a>;
04560                 <span class="keywordflow">goto</span> CleanupAndExit;
04561         }
04562         
04563         <span class="comment">/* ------------------------------------------------- 8 or 16 bit data --------------------------------------------------------- */</span>
04564         <span class="keywordflow">if</span> ((info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>) &amp;&amp; (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>))
04565         {
04566                 err = <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a4">CallCalcProc</a>(calcRoutine,&amp;calcParam, &amp;lutParam);
04567         }
04568         <span class="comment">/* ----------------------------------------------- input is 5 or 10 bit ------------------------------------------------------- */</span>
04569         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>) &amp;&amp; (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>))
04570         {
04571                 <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>);
04572         }
04573         <span class="comment">/* ----------------------------------------------- output is 5 or 10 bit ------------------------------------------------------- */</span>
04574         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>) &amp;&amp; (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>))
04575         {
04576                 <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a>);
04577         }
04578         <span class="comment">/* ------------------------------------------ input and output are 5 or 10 bit ------------------------------------------------- */</span>
04579         <span class="keywordflow">else</span>
04580         {
04581                 <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>);
04582                 <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a>);
04583         }
04584         
04585         <span class="keywordflow">if</span> (progressProcWasCalled)
04586                 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a1">CallCMBitmapCallBackProc</a> ( progressProc, 0, 0, (<span class="keywordtype">void</span> *)refCon );
04587 CleanupAndExit:
04588         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>((modelingData)-&gt;lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
04589         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>((modelingData)-&gt;lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
04590         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>((modelingData)-&gt;lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
04591                 
04592         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"LHMatchBitMapPlanePrivate"</span>)
04593         return err;
04594 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="lh_core/runtime.h::LHMatchBitMapPrivate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> LHMatchBitMapPrivate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>const <a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>bitMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a27">CMBitmapCallBackUPP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>progressProc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>void *&nbsp;</td>
          <td class="mdname" nowrap> <em>refCon</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>matchedBitMap</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html#l03995">3995</a> of file <a class="el" href="../../d2/d3/lh__core_2runtime_8c-source.html">lh_core/runtime.c</a>.
<p>
<pre class="fragment"><div>04000 {
04001         <a class="code" href="../../d7/d3/structCMCalcParam.html">CMCalcParam</a>     calcParam;
04002         <a class="code" href="../../d0/d4/structCMLutParam.html">CMLutParam</a>              lutParam;
04003         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = -1;
04004         <a class="code" href="../../d9/d4/structColorSpaceInfo.html">ColorSpaceInfo</a>  info;
04005         <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a8">CalcProcPtr</a>             calcRoutine     = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
04006         <a class="code" href="../../d6/d3/structCMBitmap.html">CMBitmap</a>                bitMapOut;
04007         <a class="code" href="../../d6/d3/structCMBitmap.html">CMBitmap</a>                bitMapIn                        = *inBitMap;
04008         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                  inColorSpace    = modelingData-&gt;firstColorSpace;
04009         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                  outColorSpace   = modelingData-&gt;lastColorSpace;
04010         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                 progressProcWasCalled = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04011         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  offset;
04012         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  progressTimer;
04013         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  dimLoop;
04014         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                 matchInPlace = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04015         <span class="keywordtype">long</span>                    progressProcCount = 0;
04016         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  inLineCount;
04017         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>                             aBuffer;
04018         
04019         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"LHMatchBitMapPrivate"</span>)
04020 
04021         LOCK_DATA((modelingData)-&gt;lutParam.inputLut);
04022         LOCK_DATA((modelingData)-&gt;lutParam.colorLut);
04023         LOCK_DATA((modelingData)-&gt;lutParam.outputLut);
04024 
04025         if( outBitMap == nil ){
04026                 bitMapOut = *inBitMap;
04027                 matchInPlace = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04028         }
04029         <span class="keywordflow">else</span>{
04030                 bitMapOut       = *outBitMap;
04031         }
04032 
04033         <a class="code" href="../../d7/d7/w98_2lh__open_2pi__mem_8c.html#a6">SetMem</a>(&amp;info,           <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d4/structColorSpaceInfo.html">ColorSpaceInfo</a>), 0);
04034         <a class="code" href="../../d7/d7/w98_2lh__open_2pi__mem_8c.html#a6">SetMem</a>(&amp;calcParam,      <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d3/structCMCalcParam.html">CMCalcParam</a>),    0);
04035 
04036         <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a17">FillLutParam</a>(&amp;lutParam, modelingData);
04037         <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a19">FillCalcParam</a>(&amp;calcParam, &amp;bitMapIn, &amp;bitMapOut);
04038         
04039         err = <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a21">CheckInputColorSpace</a>( &amp;bitMapIn, &amp;calcParam, &amp;info, inColorSpace, lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> );
04040         inLineCount = calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>;
04041         <span class="keywordflow">if</span> (err)
04042                 <span class="keywordflow">goto</span> CleanupAndExit;
04043                 
04044         <span class="keywordflow">if</span> (matchInPlace){
04045                 err = <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a23">SetOutputColorSpaceInplace</a>( &amp;calcParam, &amp;info, outColorSpace);
04046                 <span class="keywordflow">if</span> (err)
04047                         <span class="keywordflow">goto</span> CleanupAndExit;
04048         }
04049         err = <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a22">CheckOutputColorSpace</a>( &amp;bitMapOut, &amp;calcParam, &amp;info, outColorSpace, lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> );
04050         <span class="keywordflow">if</span> (err)
04051                 <span class="keywordflow">goto</span> CleanupAndExit;
04052         
04053         <span class="keywordflow">if</span> (matchInPlace)               <span class="comment">/* matching in place - check if pixel sizes are ok */</span>
04054         {
04055                 <span class="keywordflow">if</span> (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o8">inputPixelSize</a> &lt; info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o9">outputPixelSize</a>)
04056                 {
04057                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a36">cmInvalidDstMap</a>;
04058                         <span class="keywordflow">goto</span> CleanupAndExit;
04059                 }               
04060                 <span class="comment">/* set the color space field to the output color space */</span>
04061                 bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o5">space</a> = calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o1">cmOutputColorSpace</a>;
04062         } <span class="keywordflow">else</span>
04063         {
04064                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o10">copyAlpha</a> = (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o0">cmInputColorSpace</a> &amp; <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a43">cmAlphaSpace</a>) &amp;&amp; (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o1">cmOutputColorSpace</a> &amp; <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a43">cmAlphaSpace</a>);
04065         }
04066 
04067         info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o10">inPlace</a> = bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a> == bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a> &amp;&amp; info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a> &amp;&amp; info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
04068         calcRoutine = <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a27">FindCalcRoutine</a>( &amp;calcParam, &amp;lutParam, &amp;info, modelingData-&gt;lookup );
04069         <span class="keywordflow">if</span> (calcRoutine == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
04070         {
04071                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a32">cmMethodError</a>;
04072                 <span class="keywordflow">goto</span> CleanupAndExit;
04073         }
04074         
04075         <span class="keywordflow">if</span>( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o10">inPlace</a> &amp;&amp; calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o6">cmInputPixelOffset</a> &lt; calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o7">cmOutputPixelOffset</a> ){
04076                         <span class="keywordflow">for</span>( dimLoop=0; dimLoop&lt;8; dimLoop++){                                  <span class="comment">/* now work backwards                           */</span>
04077                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o8">inputData</a>[dimLoop] = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o8">inputData</a>[dimLoop] + (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>-1) * calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a> + (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o2">cmPixelPerLine</a>-1) * calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o6">cmInputPixelOffset</a>;
04078                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[dimLoop] = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[dimLoop] + (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>-1) * calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o5">cmOutputBytesPerLine</a> + (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o2">cmPixelPerLine</a>-1) * calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o7">cmOutputPixelOffset</a>;
04079                         }
04080                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o6">cmInputPixelOffset</a> = -calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o6">cmInputPixelOffset</a>;   
04081                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o7">cmOutputPixelOffset</a> = -calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o7">cmOutputPixelOffset</a>;
04082                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a> = -calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a>;
04083                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o5">cmOutputBytesPerLine</a> = -calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o5">cmOutputBytesPerLine</a>;
04084         }
04085         <span class="comment">/* ------------------------------------------------- 8 or 16 bit data --------------------------------------------------------- */</span>
04086         <span class="keywordflow">if</span> ((info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>) &amp;&amp; (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)&amp;&amp; modelingData-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a16">NoNamedColorProfile</a>)
04087         {
04088                 <span class="keywordflow">if</span> (progressProc == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
04089                         err = <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a4">CallCalcProc</a>(calcRoutine,&amp;calcParam, &amp;lutParam);          <span class="comment">/* no callback proc - do it all in one step */</span>
04090                 <span class="keywordflow">else</span>
04091                 {
04092                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> = <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a1">kMaxTempBlock</a> / calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a>;
04093                         <span class="keywordflow">if</span> (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> &lt; 1)
04094                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> = 1;
04095                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> &gt; bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>)
04096                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> = bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>;
04097                                 
04098                         progressTimer = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>();
04099                         <span class="keywordflow">while</span> ( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> &lt;  bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a> )
04100                         {
04101                                 err = <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a4">CallCalcProc</a>(calcRoutine,&amp;calcParam, &amp;lutParam);
04102                         
04103                                 <span class="keywordflow">for</span> (dimLoop = 0; dimLoop&lt; lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>; dimLoop++)
04104                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o8">inputData</a>[dimLoop] = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o8">inputData</a>[dimLoop] + calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> * calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a>;
04105                                         
04106                                 <span class="keywordflow">for</span> (dimLoop = 0; dimLoop&lt; lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>; dimLoop++)
04107                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[dimLoop] =  (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[dimLoop]  + calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> * calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o5">cmOutputBytesPerLine</a>;
04108         
04109                                 info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> += calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>;
04110                                 <span class="keywordflow">if</span> ( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> + calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> &gt; bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a> )
04111                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> = bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>-info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>;
04112                                                 
04113                                 <span class="comment">/* - - - - - handle CMBitmapCallBackProc - - - - - */</span>
04114                                 <span class="keywordflow">if</span> ( progressProc &amp;&amp; ( progressTimer + <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a0">kProgressTicks</a> &lt; (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>)<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>()) )  
04115                                 {
04116                                         progressProcWasCalled = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04117                                         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a1">CallCMBitmapCallBackProc</a> ( progressProc, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, (<span class="keywordtype">void</span> *)refCon ))
04118                                         {
04119                                                 info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> =  bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>; 
04120                                                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a39">userCanceledErr</a>;
04121                                         } <span class="keywordflow">else</span>
04122                                                 progressTimer = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>();
04123                                                 progressProcCount = info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>;
04124                                 }
04125                         }
04126                 }
04127         }
04128         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (modelingData-&gt;hasNamedColorProf != <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a17">NamedColorProfileOnly</a> ){
04129                 info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> = 0;
04130                 progressTimer = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>();
04131                 <span class="keywordflow">if</span>( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> &amp;&amp; info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> ){
04132                         <span class="keywordflow">if</span>( inLineCount &gt; calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> )inLineCount = calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>;
04133                 }
04134                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> ){
04135                         <span class="keywordflow">if</span>( progressProc &amp;&amp; modelingData-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a19">NamedColorProfileAtEnd</a> ){
04136                                 inLineCount /= 32;
04137                                 <span class="keywordflow">if</span>( inLineCount &lt; 1 ) inLineCount = 1;
04138                         }
04139                 }
04140                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> ){
04141                         inLineCount = calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>;
04142                 }
04143                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( progressProc ){
04144                         inLineCount = <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a1">kMaxTempBlock</a> / calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a>;
04145                         <span class="keywordflow">if</span> (inLineCount &lt; 1)
04146                                 inLineCount = 1;
04147                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inLineCount &gt; bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>)
04148                                 inLineCount = bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>;
04149                         <span class="keywordflow">if</span>( modelingData-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a19">NamedColorProfileAtEnd</a> ){
04150                                 inLineCount /= 32;
04151                                 <span class="keywordflow">if</span>( inLineCount &lt; 1 ) inLineCount = 1;
04152                         }
04153                 }
04154                 <span class="keywordflow">while</span> ( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> &lt;  bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a> )
04155                 {
04156                         <span class="keywordflow">if</span> ( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> + inLineCount &gt; bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a> )
04157                                 inLineCount = bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>-info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>;
04158 
04159                         <span class="keywordflow">if</span> (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o0">origSizeIn</a> == 5 )                                                                                                                                                      <span class="comment">/* input is 5 bit */</span>
04160                                 <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a12">Convert5To8</a>  ( bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>, (Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, inLineCount, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a> );
04161 <span class="preprocessor">#ifdef PI_Application_h</span>
04162 <span class="preprocessor"></span>                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o0">origSizeIn</a> == 6 )                                                                                                                                                 <span class="comment">/* output is 5 bit */</span>
04163                                 Convert565To8 ( bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>, (Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, inLineCount, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a> );
04164 <span class="preprocessor">#endif</span>
04165 <span class="preprocessor"></span>                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o0">origSizeIn</a> == 10 ) 
04166                                         <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a16">Convert10To16</a>  ( bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>, (Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, inLineCount, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a> );
04167                         
04168                         <span class="keywordflow">if</span> (modelingData-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a18">NamedColorProfileAtBegin</a> ){
04169                                 err = <a class="code" href="../../d4/d4/w98_2lh__core_2runtime_8h.html#a10">ConvertIndexToLabBitmap</a>(  modelingData, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>, 
04170                                                                                                 (Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, 
04171                                                                                                 inLineCount, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, 
04172                                                                                                 bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>, 
04173                                                                                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a>, 
04174                                                                                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o6">cmInputPixelOffset</a>*8 );
04175                                 <span class="keywordflow">if</span> (err) 
04176                                         <span class="keywordflow">goto</span> CleanupAndExit;
04177                         }
04178                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> = inLineCount;
04179                         err = <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a4">CallCalcProc</a>( calcRoutine, &amp;calcParam, &amp;lutParam );
04180                         <span class="keywordflow">if</span> (err) 
04181                                 <span class="keywordflow">goto</span> CleanupAndExit;
04182 
04183                         <span class="keywordflow">if</span> (modelingData-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a19">NamedColorProfileAtEnd</a> ){
04184                                 <span class="keywordflow">if</span>( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> )aBuffer = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a>;
04185                                 <span class="keywordflow">else</span> aBuffer = bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>;
04186                                 err = <a class="code" href="../../d4/d4/w98_2lh__core_2runtime_8h.html#a9">ConvertLabToIndexBitmap</a>(  modelingData, aBuffer, 
04187                                                                                                 info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, 
04188                                                                                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>,
04189                                                                                                 bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a> );
04190                                 <span class="keywordflow">if</span> (err) 
04191                                         <span class="keywordflow">goto</span> CleanupAndExit;
04192                         }
04193 
04194                         <span class="keywordflow">if</span>( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o1">origSizeOut</a> == 5 )                                                                                                                                                     <span class="comment">/* output is 5 bit */</span>
04195                                 <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a13">Convert8To5</a> ( (Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>);
04196 <span class="preprocessor">#ifdef PI_Application_h</span>
04197 <span class="preprocessor"></span>                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o1">origSizeOut</a> == 6 )                                                                                                                                                        <span class="comment">/* output is 5 bit */</span>
04198                                 Convert8To565 ( (Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>);
04199 <span class="preprocessor">#endif</span>
04200 <span class="preprocessor"></span>                        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o1">origSizeOut</a> == 10 )                                                                                                                                                                                               <span class="comment">/* output is 10 bit */</span>
04201                                 <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a15">Convert16To10</a> ( (Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o0">image</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o1">width</a>, bitMapOut.<a class="code" href="../../d6/d3/structCMBitmap.html#o3">rowBytes</a>);
04202 
04203                         info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> += inLineCount;
04204                         <span class="comment">/* - - - - - handle CMBitmapCallBackProc - - - - - */</span>
04205                         <span class="keywordflow">if</span> ( progressProc &amp;&amp; ( progressTimer + <a class="code" href="../../d1/d4/lh__core_2runtime_8c.html#a0">kProgressTicks</a> &lt; (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>)<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>()) )  
04206                         {
04207                                 progressProcWasCalled = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04208                                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a1">CallCMBitmapCallBackProc</a> ( progressProc, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>, info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>, (<span class="keywordtype">void</span> *)refCon ))
04209                                 {
04210                                         info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a> =  bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>; 
04211                                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a39">userCanceledErr</a>;
04212                                 } <span class="keywordflow">else</span>
04213                                         progressTimer = <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>();
04214                                         progressProcCount = info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o6">processedLinesIn</a>;
04215                         }
04216                         <span class="keywordflow">if</span>( !info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a> ){
04217                                 offset = calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> * calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a>;
04218                                 <span class="keywordflow">for</span> (dimLoop = 0; dimLoop&lt; lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>; dimLoop++)
04219                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o8">inputData</a>[dimLoop] = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o8">inputData</a>[dimLoop] + offset;
04220                         }
04221                         <span class="keywordflow">if</span>( !info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a> ){
04222                                 offset = calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a> * calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o5">cmOutputBytesPerLine</a>;
04223                                 <span class="keywordflow">for</span> (dimLoop = 0; dimLoop&lt; lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>; dimLoop++)
04224                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[dimLoop] =  (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[dimLoop]  + offset;
04225                         }
04226                 }
04227         }
04228         <span class="keywordflow">else</span>{
04229                 <a class="code" href="../../d2/d4/w98_2lh__core_2runtime_8c.html#a33">CopyIndexData</a>( &amp;bitMapIn, &amp;bitMapOut, &amp;info );
04230         }
04231         <span class="keywordflow">if</span> (err) 
04232                 <span class="keywordflow">goto</span> CleanupAndExit;
04233         
04234         <span class="keywordflow">if</span>( progressProcWasCalled &amp;&amp; progressProcCount != bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a> )
04235                 <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a1">CallCMBitmapCallBackProc</a> ( progressProc, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>, bitMapIn.<a class="code" href="../../d6/d3/structCMBitmap.html#o2">height</a>, (<span class="keywordtype">void</span> *)refCon );
04236 CleanupAndExit:
04237 
04238   <span class="comment">/* Clean up temporary storage */</span>
04239         <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o4">tempInBuffer</a>);
04240         <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)info.<a class="code" href="../../d9/d4/structColorSpaceInfo.html#o5">tempOutBuffer</a>);
04241         
04242   <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>((modelingData)-&gt;lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
04243         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>((modelingData)-&gt;lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
04244         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>((modelingData)-&gt;lutParam.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
04245 
04246         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"LHMatchBitMapPrivate"</span>)
04247         
04248         return err;
04249 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="lh_core/runtime.h::LHMatchColorsPrivate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> LHMatchColorsPrivate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d8/d3/unionCMColor.html">CMColor</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>myColors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>count</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="lh_core/runtime.h::MidProcNamedColorMatchBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a> MidProcNamedColorMatchBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>InBitMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dataOut</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>startLine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a8">UINT32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>height</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="lh_core/runtime.h::PostProcNamedColorMatchBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a> PostProcNamedColorMatchBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>inBitMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>outBitMap</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="lh_core/runtime.h::PreProcNamedColorMatchBitmap" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a35">OSErr</a> PreProcNamedColorMatchBitmap           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>inBitMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d3/structCMBitmap.html">CMBitmap</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>outBitMap</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a21">Boolean</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>MatchInPlace</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:31 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
