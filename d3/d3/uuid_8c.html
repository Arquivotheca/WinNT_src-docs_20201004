<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: uuid.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>uuid.c File Reference</h1><code>#include "<a class="el" href="../../d5/d9/exp_8h-source.html">exp.h</a>"</code><br>

<p>
<a href="../../d4/d2/uuid_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d9/d4/struct__UUID__GENERATE.html">_UUID_GENERATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html">_UUID_CACHED_VALUES_STRUCT</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a0">RPC_SEQUENCE_NUMBER_PATH</a>&nbsp;&nbsp;&nbsp;L"\\Registry\\Machine\\Software\\Microsoft\\Rpc"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a1">RPC_SEQUENCE_NUMBER_NAME</a>&nbsp;&nbsp;&nbsp;L"UuidSequenceNumber"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a2">UUID_TIME_HIGH_MASK</a>&nbsp;&nbsp;&nbsp;0x0FFF</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a3">UUID_VERSION</a>&nbsp;&nbsp;&nbsp;0x1000</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a4">UUID_RESERVED</a>&nbsp;&nbsp;&nbsp;0x80</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a5">UUID_CLOCK_SEQ_HI_MASK</a>&nbsp;&nbsp;&nbsp;0x3F</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a6">CACHE_LOCAL_ONLY</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a7">CACHE_VALID</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a8">SEED_SIZE</a>&nbsp;&nbsp;&nbsp;6 * sizeof(<a class="el" href="../../d2/d1/bench_8h.html#a8">CHAR</a>)</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d9/d4/struct__UUID__GENERATE.html">_UUID_GENERATE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a9">UUID_GENERATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html">_UUID_CACHED_VALUES_STRUCT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a10">UUID_CACHED_VALUES_STRUCT</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a18">ExpUuidLoadSequenceNumber</a> (OUT PULONG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a19">ExpUuidSaveSequenceNumber</a> (IN ULONG)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a20">ExpUuidSaveSequenceNumberIf</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a21">ExpUuidGetValues</a> (OUT <a class="el" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html">UUID_CACHED_VALUES_STRUCT</a> *Values)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a22">ExpUuidInitialization</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a23">ExpAllocateUuids</a> (OUT PLARGE_INTEGER <a class="el" href="../../d6/d6/ttime_8c.html#a14">Time</a>, OUT PULONG Range, OUT PULONG Sequence)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a24">NtSetUuidSeed</a> (IN PCHAR <a class="el" href="../../d1/d1/theap_8c.html#a17">Seed</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a25">NtAllocateUuids</a> (OUT PULARGE_INTEGER <a class="el" href="../../d6/d6/ttime_8c.html#a14">Time</a>, OUT PULONG Range, OUT PULONG Sequence, OUT PCHAR <a class="el" href="../../d1/d1/theap_8c.html#a17">Seed</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a26">ExUuidCreate</a> (OUT <a class="el" href="../../d5/d8/ex_8h.html#a172">UUID</a> *Uuid)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a11">ExpUuidLastTimeAllocated</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a12">ExpUuidCacheValid</a> = CACHE_LOCAL_ONLY</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html">UUID_CACHED_VALUES_STRUCT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a13">ExpUuidCachedValues</a> = { 0, -1, 0, 0, { 0x80, 'm', 'a', 'r', 'i', 'o' }}</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a14">ExpUuidSequenceNumber</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a15">ExpUuidSequenceNumberValid</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a16">ExpUuidSequenceNumberNotSaved</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d3/uuid_8c.html#a17">ExpUuidLock</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a6" doxytag="uuid.c::CACHE_LOCAL_ONLY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_LOCAL_ONLY&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00058">58</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00841">ExUuidCreate()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00532">NtSetUuidSeed()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="uuid.c::CACHE_VALID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CACHE_VALID&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00059">59</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00532">NtSetUuidSeed()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="uuid.c::RPC_SEQUENCE_NUMBER_NAME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define RPC_SEQUENCE_NUMBER_NAME&nbsp;&nbsp;&nbsp;L"UuidSequenceNumber"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00049">49</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00137">ExpUuidLoadSequenceNumber()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00220">ExpUuidSaveSequenceNumber()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="uuid.c::RPC_SEQUENCE_NUMBER_PATH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define RPC_SEQUENCE_NUMBER_PATH&nbsp;&nbsp;&nbsp;L"\\Registry\\Machine\\Software\\Microsoft\\Rpc"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00048">48</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00137">ExpUuidLoadSequenceNumber()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00220">ExpUuidSaveSequenceNumber()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="uuid.c::SEED_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SEED_SIZE&nbsp;&nbsp;&nbsp;6 * sizeof(<a class="el" href="../../d2/d1/bench_8h.html#a8">CHAR</a>)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00528">528</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00617">NtAllocateUuids()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00532">NtSetUuidSeed()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="uuid.c::UUID_CLOCK_SEQ_HI_MASK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UUID_CLOCK_SEQ_HI_MASK&nbsp;&nbsp;&nbsp;0x3F          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00055">55</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00751">ExpUuidGetValues()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="uuid.c::UUID_RESERVED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UUID_RESERVED&nbsp;&nbsp;&nbsp;0x80          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00054">54</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00751">ExpUuidGetValues()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="uuid.c::UUID_TIME_HIGH_MASK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UUID_TIME_HIGH_MASK&nbsp;&nbsp;&nbsp;0x0FFF          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00052">52</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00841">ExUuidCreate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="uuid.c::UUID_VERSION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UUID_VERSION&nbsp;&nbsp;&nbsp;0x1000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00053">53</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00841">ExUuidCreate()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a10" doxytag="uuid.c::UUID_CACHED_VALUES_STRUCT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html">_UUID_CACHED_VALUES_STRUCT</a>  <a class="el" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html">UUID_CACHED_VALUES_STRUCT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="uuid.c::UUID_GENERATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d9/d4/struct__UUID__GENERATE.html">_UUID_GENERATE</a>  <a class="el" href="../../d9/d4/struct__UUID__GENERATE.html">UUID_GENERATE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a23" doxytag="uuid.c::ExpAllocateUuids" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ExpAllocateUuids           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>Time</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Range</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Sequence</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00378">378</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
References <a class="el" href="../../d4/d2/uuid_8c-source.html#l00090">ExpUuidLastTimeAllocated</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00137">ExpUuidLoadSequenceNumber()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00098">ExpUuidSequenceNumber</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00100">ExpUuidSequenceNumberNotSaved</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00099">ExpUuidSequenceNumberValid</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter()</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00153">KeQuerySystemTime()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d5/ttime_8c-source.html#l00047">Time</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00751">ExpUuidGetValues()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00617">NtAllocateUuids()</a>.
<p>
<pre class="fragment"><div>00386                    :
00387 
00388     Allocates a sequence number and a range of times <span class="keywordflow">for</span> a set of UUIDs.
00389     The caller can use <span class="keyword">this</span> together with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> network address to
00390     generate complete UUIDs.
00391 
00392     This routine assumes that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread has exclusive access
00393     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ExpUuid* values.
00394 
00395 Arguments:
00396 
00397     <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a variable that will receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00398         start time (SYSTEMTIME format) of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range of time reserved.
00399 
00400     Range - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a variable that will receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00401         number of ticks (100ns) reserved after the value in Time.
00402         The range reserved is *Time to (*Time+*Range-1).
00403 
00404     Sequence - Supplies the address of a variable that will receive
00405         the time sequence number.  This value is used with the associated
00406         range of time to prevent problems with clocks going backwards.
00407 
00408 Return Value:
00409 
00410     STATUS_SUCCESS is returned if the service is successfully executed.
00411 
00412     STATUS_RETRY is returned if we're unable to reserve a range of
00413         UUIDs.  This will occur if system clock hasn't advanced
00414         and the allocator is out of cached values.
00415 
00416     STATUS_UNSUCCESSFUL is returned if some other service reports
00417         an error, most likly the registery.
00418 
00419 --*/
00420 
00421 {
00422     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00423     LARGE_INTEGER CurrentTime;
00424     LARGE_INTEGER AvailableTime;
00425 
00426     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00427 
00428     <span class="comment">//</span>
00429     <span class="comment">// Make sure we have a valid sequence number.  If not, make one up.</span>
00430     <span class="comment">//</span>
00431 
00432     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d3/uuid_8c.html#a15">ExpUuidSequenceNumberValid</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00433 
00434         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/uuid_8c.html#a18">ExpUuidLoadSequenceNumber</a>(&amp;ExpUuidSequenceNumber);
00435 
00436         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00437             <span class="comment">// Unable read the sequence number, this means we should make one up.</span>
00438 
00439             LARGE_INTEGER PerfCounter;
00440             LARGE_INTEGER PerfFrequency;
00441 
00442             <span class="comment">// This should only happen when we're called</span>
00443             <span class="comment">// for the first time on a given machine. (machine, not boot)</span>
00444 
00445             KdPrint((<span class="stringliteral">"Uuid: Generating first sequence number.\n"</span>));
00446 
00447             PerfCounter = <a class="code" href="../../d2/d7/hal_8h.html#a205">KeQueryPerformanceCounter</a>(&amp;PerfFrequency);
00448 
00449             <a class="code" href="../../d3/d3/uuid_8c.html#a14">ExpUuidSequenceNumber</a> ^= (ULONG)((ULONG_PTR)&amp;<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>) ^ PerfCounter.LowPart ^
00450                 PerfCounter.HighPart ^ (ULONG)((ULONG_PTR)Sequence);
00451             }
00452         <span class="keywordflow">else</span> {
00453             <span class="comment">// We increment the sequence number on every boot.</span>
00454             <a class="code" href="../../d3/d3/uuid_8c.html#a14">ExpUuidSequenceNumber</a>++;
00455             }
00456 
00457         <a class="code" href="../../d3/d3/uuid_8c.html#a15">ExpUuidSequenceNumberValid</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00458         <a class="code" href="../../d3/d3/uuid_8c.html#a16">ExpUuidSequenceNumberNotSaved</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00459 
00460         }
00461 
00462     <span class="comment">//</span>
00463     <span class="comment">// Get the current time, usually we will have plenty of avaliable</span>
00464     <span class="comment">// to give the caller.  But we may need to deal with time going</span>
00465     <span class="comment">// backwards and really fast machines.</span>
00466     <span class="comment">//</span>
00467 
00468     <a class="code" href="../../d7/d0/ke_2miscc_8c.html#a3">KeQuerySystemTime</a>(&amp;CurrentTime);
00469 
00470     AvailableTime.QuadPart = CurrentTime.QuadPart - <a class="code" href="../../d3/d3/uuid_8c.html#a11">ExpUuidLastTimeAllocated</a>.QuadPart;
00471 
00472     <span class="keywordflow">if</span> (AvailableTime.QuadPart &lt; 0) {
00473 
00474         <span class="comment">// Time has been set time backwards. This means that we must make sure</span>
00475         <span class="comment">// that somebody increments the sequence number and saves the new</span>
00476         <span class="comment">// sequence number in the registry.</span>
00477 
00478         <a class="code" href="../../d3/d3/uuid_8c.html#a16">ExpUuidSequenceNumberNotSaved</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00479         <a class="code" href="../../d3/d3/uuid_8c.html#a14">ExpUuidSequenceNumber</a>++;
00480 
00481         <span class="comment">// The sequence number has been changed, so it's now okay to set time</span>
00482         <span class="comment">// backwards.  Since time is going backwards anyway, it's okay to set</span>
00483         <span class="comment">// it back an extra millisecond or two.</span>
00484 
00485         <a class="code" href="../../d3/d3/uuid_8c.html#a11">ExpUuidLastTimeAllocated</a>.QuadPart = CurrentTime.QuadPart - 20000;
00486         AvailableTime.QuadPart = 20000;
00487         }
00488 
00489     <span class="keywordflow">if</span> (AvailableTime.QuadPart == 0) {
00490         <span class="comment">// System time hasn't moved.  The caller should yield the CPU and retry.</span>
00491         <span class="keywordflow">return</span>(STATUS_RETRY);
00492         }
00493 
00494     <span class="comment">//</span>
00495     <span class="comment">// Common case, time has moved forward.</span>
00496     <span class="comment">//</span>
00497 
00498     <span class="keywordflow">if</span> (AvailableTime.QuadPart &gt; 10*1000*1000) {
00499         <span class="comment">// We never want to give out really old (&gt; 1 second) Uuids.</span>
00500         AvailableTime.QuadPart = 10*1000*1000;
00501         }
00502 
00503     <span class="keywordflow">if</span> (AvailableTime.QuadPart &gt; 10*1000) {
00504         <span class="comment">// We've got over a millisecond to give out.  We'll save some time for</span>
00505         <span class="comment">// another caller so that we can avoid returning STATUS_RETRY very often.</span>
00506         *Range = 10*1000;
00507         AvailableTime.QuadPart -= 10*1000;
00508         }
00509     <span class="keywordflow">else</span> {
00510         <span class="comment">// Not much time avaiable, give it all away.</span>
00511         *Range = (ULONG)AvailableTime.QuadPart;
00512         AvailableTime.QuadPart = 0;
00513         }
00514 
00515     <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>-&gt;QuadPart = CurrentTime.QuadPart - (*Range + AvailableTime.QuadPart);
00516 
00517     <a class="code" href="../../d3/d3/uuid_8c.html#a11">ExpUuidLastTimeAllocated</a>.QuadPart = <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>-&gt;QuadPart + *Range;
00518 
00519     <span class="comment">// Last time allocated is just after the range we hand back to the caller</span>
00520     <span class="comment">// this may be almost a second behind the true system time.</span>
00521 
00522     *Sequence = <a class="code" href="../../d3/d3/uuid_8c.html#a14">ExpUuidSequenceNumber</a>;
00523 
00524 
00525     <span class="keywordflow">return</span>(STATUS_SUCCESS);
00526 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="uuid.c::ExpUuidGetValues" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ExpUuidGetValues           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT <a class="el" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html">UUID_CACHED_VALUES_STRUCT</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Values</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00751">751</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00378">ExpAllocateUuids()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d5/ttime_8c-source.html#l00047">Time</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00055">UUID_CLOCK_SEQ_HI_MASK</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00054">UUID_RESERVED</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00841">ExUuidCreate()</a>.
<p>
<pre class="fragment"><div>00756                    :
00757 
00758     This routine allocates a block of UUIDs and stores them in
00759     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller-provided cached-values structure.
00760 
00761     This routine assumes that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread has exclusive
00762     access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ExpUuid* values.
00763 
00764     Note that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a> value in <span class="keyword">this</span> cache <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> different than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00765     <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a> value returned by <a class="code" href="../../d3/d3/uuid_8c.html#a25">NtAllocateUuids</a> (and ExpAllocateUuids).
00766     As a result, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cache must be interpreted differently in
00767     order to determine <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> valid range.  The valid range from
00768     these two <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>:
00769 
00770         <a class="code" href="../../d3/d3/uuid_8c.html#a25">NtAllocateUuids</a>:  [ <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>, <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>+Range )
00771         <a class="code" href="../../d3/d3/uuid_8c.html#a21">ExpUuidGetValues</a>: ( Values.Time-Values.Range, Values.Time ]
00772 
00773 Arguments:
00774 
00775     Values - Set to contain everything needed to allocate a block of uuids.
00776 
00777 Return Value:
00778 
00779     STATUS_SUCCESS <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> service <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successfully executed.
00780 
00781     STATUS_RETRY <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> we're unable to reserve a range of
00782         UUIDs.  This will occur <span class="keywordflow">if</span> system clock hasn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> advanced
00783         and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocator <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of cached values.
00784 
00785     STATUS_NO_MEMORY <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> we're unable to reserve a range
00786         of UUIDs, <span class="keywordflow">for</span> some <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> other than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> clock not advancing.
00787 
00788 --*/
00789 {
00790     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00791     LARGE_INTEGER <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>;
00792     ULONG Range;
00793     ULONG Sequence;
00794 
00795     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00796 
00797     <span class="comment">// Allocate a range of times for use in UUIDs.</span>
00798 
00799     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/uuid_8c.html#a23">ExpAllocateUuids</a>(&amp;Time, &amp;Range, &amp;Sequence);
00800 
00801     <span class="keywordflow">if</span> (STATUS_RETRY == <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>) {
00802         <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00803         }
00804 
00805     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00806         <span class="keywordflow">return</span>(STATUS_NO_MEMORY);
00807         }
00808 
00809     <span class="comment">// ExpAllocateUuids keeps time in SYSTEM_TIME format which is 100ns ticks since</span>
00810     <span class="comment">// Jan 1, 1601.  UUIDs use time in 100ns ticks since Oct 15, 1582.</span>
00811 
00812     <span class="comment">// 17 Days in Oct + 30 (Nov) + 31 (Dec) + 18 years and 5 leap days.</span>
00813 
00814     <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>.QuadPart +=   (ULONGLONG) (1000*1000*10)       <span class="comment">// seconds</span>
00815                      * (ULONGLONG) (60 * 60 * 24)       <span class="comment">// days</span>
00816                      * (ULONGLONG) (17+30+31+365*18+5); <span class="comment">// # of days</span>
00817 
00818     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Range);
00819 
00820     Values-&gt;ClockSeqHiAndReserved =
00821         <a class="code" href="../../d3/d3/uuid_8c.html#a4">UUID_RESERVED</a> | (((UCHAR) (Sequence &gt;&gt; 8))
00822         &amp; (UCHAR) <a class="code" href="../../d3/d3/uuid_8c.html#a5">UUID_CLOCK_SEQ_HI_MASK</a>);
00823 
00824     Values-&gt;ClockSeqLow = (UCHAR) (Sequence &amp; 0x00FF);
00825 
00826 
00827     <span class="comment">// We'll modify the Time value so that it indicates the</span>
00828     <span class="comment">// end of the range rather than the beginning of it.</span>
00829 
00830     <span class="comment">// The order of these assignments is important</span>
00831 
00832     Values-&gt;Time = <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>.QuadPart + (Range - 1);
00833     Values-&gt;AllocatedCount = Range;
00834 
00835     <span class="keywordflow">return</span>(STATUS_SUCCESS);
00836 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="uuid.c::ExpUuidInitialization" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN ExpUuidInitialization           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00340">340</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00367">ExInitializeFastMutex</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00090">ExpUuidLastTimeAllocated</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00103">ExpUuidLock</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00099">ExpUuidSequenceNumberValid</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/ke_2miscc_8c-source.html#l00153">KeQuerySystemTime()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00345                    :
00346 
00347     This function initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d5/d8/ex_8h.html#a172">UUID</a> allocation.
00348 
00349 Arguments:
00350 
00351     None.
00352 
00353 Return Value:
00354 
00355     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initialization <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successfully
00356     completed.  Otherwise, a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00357 
00358 --*/
00359 
00360 {
00361     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00362 
00363     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00364 
00365     <a class="code" href="../../d5/d8/ex_8h.html#a8">ExInitializeFastMutex</a>(&amp;ExpUuidLock);
00366 
00367     <a class="code" href="../../d3/d3/uuid_8c.html#a15">ExpUuidSequenceNumberValid</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00368 
00369     <span class="comment">// We can use the current time since we'll be changing the sequence number.</span>
00370 
00371     <a class="code" href="../../d7/d0/ke_2miscc_8c.html#a3">KeQuerySystemTime</a>(&amp;ExpUuidLastTimeAllocated);
00372 
00373     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00374 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="uuid.c::ExpUuidLoadSequenceNumber" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ExpUuidLoadSequenceNumber           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PULONG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00137">137</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00059">KeyName</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00058">KeyPath</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00049">RPC_SEQUENCE_NUMBER_NAME</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00048">RPC_SEQUENCE_NUMBER_PATH</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00378">ExpAllocateUuids()</a>.
<p>
<pre class="fragment"><div>00142                    :
00143 
00144     This function loads <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> saved sequence number from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry.
00145     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> during system startup.
00146 
00147 Arguments:
00148 
00149     Sequence - Pointer to storage <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sequence number.
00150 
00151 Return Value:
00152 
00153     STATUS_SUCCESS when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sequence number <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successfully read from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00154         registry.
00155 
00156     STATUS_UNSUCCESSFUL when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sequence number <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not correctly stored
00157         in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry.
00158 
00159     Failure codes from ZwOpenKey() and ZwQueryValueKey() maybe returned.
00160 
00161 --*/
00162 {
00163     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00164     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00165     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>, <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00166     HANDLE <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>;
00167     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> KeyValueBuffer[<span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + <span class="keyword">sizeof</span>(ULONG)];
00168     PKEY_VALUE_PARTIAL_INFORMATION KeyValueInformation;
00169     ULONG ResultLength;
00170 
00171     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00172 
00173     KeyValueInformation = (PKEY_VALUE_PARTIAL_INFORMATION)KeyValueBuffer;
00174 
00175     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;KeyPath, RPC_SEQUENCE_NUMBER_PATH);
00176     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;KeyName, RPC_SEQUENCE_NUMBER_NAME);
00177 
00178     InitializeObjectAttributes( &amp;ObjectAttributes,
00179                                 &amp;KeyPath,
00180                                 OBJ_CASE_INSENSITIVE | OBJ_KERNEL_HANDLE,
00181                                 NULL,
00182                                 NULL
00183                               );
00184 
00185     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> =
00186     ZwOpenKey( &amp;Key,
00187                GENERIC_READ,
00188                &amp;ObjectAttributes
00189              );
00190 
00191     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00192         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> =
00193         ZwQueryValueKey( Key,
00194                          &amp;KeyName,
00195                          KeyValuePartialInformation,
00196                          KeyValueInformation,
00197                          <span class="keyword">sizeof</span>(KeyValueBuffer),
00198                          &amp;ResultLength
00199                        );
00200 
00201         ZwClose( Key );
00202         }
00203 
00204     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00205         <span class="keywordflow">if</span> ( KeyValueInformation-&gt;Type == REG_DWORD &amp;&amp;
00206              KeyValueInformation-&gt;DataLength == <span class="keyword">sizeof</span>(ULONG)
00207            ) {
00208             *Sequence = *(PULONG)KeyValueInformation-&gt;Data;
00209             }
00210         <span class="keywordflow">else</span> {
00211             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
00212             }
00213         }
00214 
00215     <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00216 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="uuid.c::ExpUuidSaveSequenceNumber" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ExpUuidSaveSequenceNumber           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ULONG</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00220">220</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
References <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00417">Key</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00059">KeyName</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00058">KeyPath</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00049">RPC_SEQUENCE_NUMBER_NAME</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00048">RPC_SEQUENCE_NUMBER_PATH</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00287">ExpUuidSaveSequenceNumberIf()</a>.
<p>
<pre class="fragment"><div>00225                    :
00226 
00227     This function saves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> uuid sequence number in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry.  This
00228     value will be read by <a class="code" href="../../d3/d3/uuid_8c.html#a18">ExpUuidLoadSequenceNumber</a> during <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next boot.
00229 
00230     This routine assumes that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread has exclusive access
00231     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ExpUuid* values.
00232 
00233 Arguments:
00234 
00235     Sequence - The sequence number to save.
00236 
00237 Return Value:
00238 
00239     STATUS_SUCCESS
00240 
00241     Failure codes from ZwOpenKey() and ZwSetValueKey() maybe returned.
00242 
00243 --*/
00244 {
00245     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00246     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00247     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a2">KeyPath</a>, <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00248     HANDLE <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a51">Key</a>;
00249 
00250     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00251 
00252     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;KeyPath, RPC_SEQUENCE_NUMBER_PATH);
00253     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;KeyName, RPC_SEQUENCE_NUMBER_NAME);
00254 
00255     InitializeObjectAttributes( &amp;ObjectAttributes,
00256                                 &amp;KeyPath,
00257                                 OBJ_CASE_INSENSITIVE | OBJ_KERNEL_HANDLE,
00258                                 NULL,
00259                                 NULL
00260                               );
00261 
00262     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> =
00263     ZwOpenKey( &amp;Key,
00264                GENERIC_READ | GENERIC_WRITE,
00265                &amp;ObjectAttributes
00266              );
00267 
00268     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00269         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> =
00270         ZwSetValueKey( Key,
00271                        &amp;KeyName,
00272                        0,
00273                        REG_DWORD,
00274                        &amp;Sequence,
00275                        <span class="keyword">sizeof</span>(ULONG)
00276                      );
00277 
00278         ZwClose( Key );
00279         }
00280 
00281     <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00282 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="uuid.c::ExpUuidSaveSequenceNumberIf" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ExpUuidSaveSequenceNumberIf           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00287">287</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
References <a class="el" href="../../d4/d2/uuid_8c-source.html#l00220">ExpUuidSaveSequenceNumber()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00098">ExpUuidSequenceNumber</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00100">ExpUuidSequenceNumberNotSaved</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00841">ExUuidCreate()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00617">NtAllocateUuids()</a>.
<p>
<pre class="fragment"><div>00291                    :
00292 
00293     This function saves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d3/uuid_8c.html#a14">ExpUuidSequenceNumber</a>, but <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a>
00294     <span class="keywordflow">if</span> necessary (as determined by the ExpUuidSequenceNumberNotSaved
00295     flag).
00296 
00297     This routine assumes that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread has exclusive access
00298     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ExpUuid* values.
00299 
00300 Arguments:
00301 
00302     None.
00303 
00304 Return Value:
00305 
00306     STATUS_SUCCESS <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation was successful.
00307 
00308 --*/
00309 
00310 {
00311     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00312 
00313     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00314 
00315     <span class="comment">// Does the sequence number need to be saved?</span>
00316     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d3/uuid_8c.html#a16">ExpUuidSequenceNumberNotSaved</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00317 
00318         <span class="comment">// Print this message just to make sure we aren't hitting the</span>
00319         <span class="comment">// registry too much under normal usage.</span>
00320 
00321         KdPrint((<span class="stringliteral">"Uuid: Saving new sequence number.\n"</span>));
00322 
00323         <span class="comment">// Save the sequence number</span>
00324 
00325         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/uuid_8c.html#a19">ExpUuidSaveSequenceNumber</a>(ExpUuidSequenceNumber);
00326 
00327         <span class="comment">// Indicate that it's now been saved.</span>
00328         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00329             <a class="code" href="../../d3/d3/uuid_8c.html#a16">ExpUuidSequenceNumberNotSaved</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00330             }
00331         }
00332 
00333     <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00334 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="uuid.c::ExUuidCreate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ExUuidCreate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT <a class="el" href="../../d5/d8/ex_8h.html#a172">UUID</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Uuid</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00841">841</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
References <a class="el" href="../../d4/d2/uuid_8c-source.html#l00078">_UUID_CACHED_VALUES_STRUCT::AllocatedCount</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00058">CACHE_LOCAL_ONLY</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00070">_UUID_GENERATE::ClockSeqHiAndReserved</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00079">_UUID_CACHED_VALUES_STRUCT::ClockSeqHiAndReserved</a>, <a class="el" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00095">ExpUuidCachedValues</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00091">ExpUuidCacheValid</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00751">ExpUuidGetValues()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00103">ExpUuidLock</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00287">ExpUuidSaveSequenceNumberIf()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00072">_UUID_GENERATE::NodeId</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00081">_UUID_CACHED_VALUES_STRUCT::NodeId</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d5/ttime_8c-source.html#l00047">Time</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00077">_UUID_CACHED_VALUES_STRUCT::Time</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00069">_UUID_GENERATE::TimeHiAndVersion</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00067">_UUID_GENERATE::TimeLow</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00068">_UUID_GENERATE::TimeMid</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l03344">UUID</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00052">UUID_TIME_HIGH_MASK</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00053">UUID_VERSION</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l01869">CmpCloneHwProfile()</a>.
<p>
<pre class="fragment"><div>00847                    :
00848 
00849     This routine creates a <a class="code" href="../../d3/d2/structtagDCE.html">DCE</a> <a class="code" href="../../d5/d8/ex_8h.html#a172">UUID</a> and returns <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's
00850     buffer.
00851 
00852 Arguments:
00853 
00854     Uuid - will receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d5/d8/ex_8h.html#a172">UUID</a>.
00855 
00856 Return Value:
00857 
00858     STATUS_SUCCESS <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> service <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successfully executed.
00859 
00860     STATUS_RETRY <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> we're unable to reserve a range of
00861         UUIDs.  This will occur <span class="keywordflow">if</span> system clock hasn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> advanced
00862         and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> allocator <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of cached values.
00863 
00864 --*/
00865 
00866 {
00867     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00868 
00869     <a class="code" href="../../d9/d4/struct__UUID__GENERATE.html">UUID_GENERATE</a>  *UuidGen = (<a class="code" href="../../d9/d4/struct__UUID__GENERATE.html">UUID_GENERATE</a> *) Uuid;
00870     ULONGLONG       <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>;
00871     LONG            Delta;
00872 
00873     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00874 
00875     <span class="comment">//</span>
00876     <span class="comment">// Get a value from the cache.  If the cache is empty, we'll fill</span>
00877     <span class="comment">// it and retry.  The first time cache will be empty.</span>
00878     <span class="comment">//</span>
00879 
00880     <span class="keywordflow">for</span>(;;) {
00881 
00882         <span class="comment">// Get the highest value in the cache (though it may not</span>
00883         <span class="comment">// be available).</span>
00884         <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a> = <a class="code" href="../../d3/d3/uuid_8c.html#a13">ExpUuidCachedValues</a>.<a class="code" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html#o0">Time</a>;
00885 
00886         <span class="comment">// Copy the static info into the UUID.  We can't do this later</span>
00887         <span class="comment">// because the clock sequence could be updated by another thread.</span>
00888 
00889         *(PULONG)&amp;UuidGen-&gt;<a class="code" href="../../d9/d4/struct__UUID__GENERATE.html#o3">ClockSeqHiAndReserved</a> =
00890             *(PULONG)&amp;<a class="code" href="../../d3/d3/uuid_8c.html#a13">ExpUuidCachedValues</a>.<a class="code" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html#o2">ClockSeqHiAndReserved</a>;
00891         *(PULONG)&amp;UuidGen-&gt;<a class="code" href="../../d9/d4/struct__UUID__GENERATE.html#o5">NodeId</a>[2] =
00892             *(PULONG)&amp;<a class="code" href="../../d3/d3/uuid_8c.html#a13">ExpUuidCachedValues</a>.<a class="code" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html#o4">NodeId</a>[2];
00893 
00894         <span class="comment">// See what we need to subtract from Time to get a valid GUID.</span>
00895         Delta = InterlockedDecrement(&amp;<a class="code" href="../../d3/d3/uuid_8c.html#a13">ExpUuidCachedValues</a>.<a class="code" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html#o1">AllocatedCount</a>);
00896 
00897         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a> != <a class="code" href="../../d3/d3/uuid_8c.html#a13">ExpUuidCachedValues</a>.<a class="code" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html#o0">Time</a>) {
00898 
00899             <span class="comment">// If our captured time doesn't match the cache then another</span>
00900             <span class="comment">// thread already took the lock and updated the cache. We'll</span>
00901             <span class="comment">// just loop and try again.</span>
00902             <span class="keywordflow">continue</span>;
00903             }
00904 
00905         <span class="comment">// If the cache hadn't already run dry, we can break out of this retry</span>
00906         <span class="comment">// loop.</span>
00907         <span class="keywordflow">if</span> (Delta &gt;= 0) {
00908             <span class="keywordflow">break</span>;
00909             }
00910 
00911         <span class="comment">//</span>
00912         <span class="comment">// Allocate a new block of Uuids.</span>
00913         <span class="comment">//</span>
00914 
00915         <span class="comment">// Take the cache lock</span>
00916         <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
00917         <a class="code" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe</a>(&amp;ExpUuidLock);
00918 
00919         <span class="comment">// If the cache has already been updated, try again.</span>
00920         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a> != <a class="code" href="../../d3/d3/uuid_8c.html#a13">ExpUuidCachedValues</a>.<a class="code" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html#o0">Time</a>) {
00921             <span class="comment">// Release the lock</span>
00922             <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a>(&amp;ExpUuidLock);
00923             <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
00924             <span class="keywordflow">continue</span>;
00925             }
00926 
00927         <span class="comment">// Update the cache.</span>
00928         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/uuid_8c.html#a21">ExpUuidGetValues</a>( &amp;ExpUuidCachedValues );
00929 
00930         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_SUCCESS) {
00931             <span class="comment">// Release the lock</span>
00932             <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a>(&amp;ExpUuidLock);
00933             <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
00934             <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00935             }
00936 
00937         <span class="comment">// The sequence number may have been dirtied, see if it needs</span>
00938         <span class="comment">// to be saved.  If there's an error, we'll ignore it and</span>
00939         <span class="comment">// retry on a future call.</span>
00940 
00941         <a class="code" href="../../d3/d3/uuid_8c.html#a20">ExpUuidSaveSequenceNumberIf</a>();
00942 
00943         <span class="comment">// Release the lock</span>
00944         <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a>(&amp;ExpUuidLock);
00945         <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
00946 
00947         <span class="comment">// Loop</span>
00948         }
00949 
00950     <span class="comment">// Adjust the time to that of the next available UUID.</span>
00951     <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a> -= Delta;
00952 
00953     <span class="comment">// Finish filling in the UUID.</span>
00954 
00955     UuidGen-&gt;<a class="code" href="../../d9/d4/struct__UUID__GENERATE.html#o0">TimeLow</a> = (ULONG) <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>;
00956     UuidGen-&gt;<a class="code" href="../../d9/d4/struct__UUID__GENERATE.html#o1">TimeMid</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) (<a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a> &gt;&gt; 32);
00957     UuidGen-&gt;<a class="code" href="../../d9/d4/struct__UUID__GENERATE.html#o2">TimeHiAndVersion</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)
00958         (( (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(<a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a> &gt;&gt; (32+16))
00959         &amp; <a class="code" href="../../d3/d3/uuid_8c.html#a2">UUID_TIME_HIGH_MASK</a>) | <a class="code" href="../../d3/d3/uuid_8c.html#a3">UUID_VERSION</a>);
00960 
00961     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Status == STATUS_SUCCESS);
00962 
00963     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d3/uuid_8c.html#a12">ExpUuidCacheValid</a> == <a class="code" href="../../d3/d3/uuid_8c.html#a6">CACHE_LOCAL_ONLY</a>) {
00964         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = RPC_NT_UUID_LOCAL_ONLY;
00965         }
00966 
00967     <span class="keywordflow">return</span>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>);
00968 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="uuid.c::NtAllocateUuids" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtAllocateUuids           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PULARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>Time</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Range</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Sequence</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Seed</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00617">617</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00378">ExpAllocateUuids()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00095">ExpUuidCachedValues</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00103">ExpUuidLock</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00287">ExpUuidSaveSequenceNumberIf()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00081">_UUID_CACHED_VALUES_STRUCT::NodeId</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d0/d4/probe_8c-source.html#l00034">ProbeForWrite()</a>, <a class="el" href="../../d5/d3/tprefix_8c-source.html#l00032">Seed</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00528">SEED_SIZE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d5/ttime_8c-source.html#l00047">Time</a>.
<p>
<pre class="fragment"><div>00626                    :
00627 
00628     This function reserves a range of time <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller(s) to use for
00629     handing out Uuids.  As far a possible the same range of time and
00630     sequence number will never be given out.
00631 
00632     (It's possible to reboot 2^14-1 times and set the clock backwards and then
00633     call this allocator and get a duplicate.  Since only the low 14bits of the
00634     sequence number are used in a real uuid.)
00635 
00636 Arguments:
00637 
00638     Time - Supplies the address of a variable that will receive the
00639         start time (SYSTEMTIME format) of the range of time reserved.
00640 
00641     Range - Supplies the address of a variable that will receive the
00642         number of ticks (100ns) reserved after the value in Time.
00643         The range reserved is *Time to (*Time + *Range - 1).
00644 
00645     Sequence - Supplies the address of a variable that will receive
00646         the time sequence number.  This value is used with the associated
00647         range of time to prevent problems with clocks going backwards.
00648 
00649     Seed - Pointer to a 6 byte buffer. The current seed is written into this buffer.
00650     
00651 Return Value:
00652 
00653     STATUS_SUCCESS is returned if the service is successfully executed.
00654 
00655     STATUS_RETRY is returned if we're unable to reserve a range of
00656         UUIDs.  This may (?) occur if system clock hasn't advanced
00657         and the allocator is out of cached values.
00658 
00659     STATUS_ACCESS_VIOLATION is returned if the output parameter for the
00660         UUID cannot be written.
00661 
00662     STATUS_UNSUCCESSFUL is returned if some other service reports
00663         an error, most likly the registery.
00664 
00665 --*/
00666 
00667 {
00668 
00669     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00670     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00671 
00672     LARGE_INTEGER OutputTime;
00673     ULONG OutputRange;
00674     ULONG OutputSequence;
00675 
00676     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00677 
00678     <span class="comment">//</span>
00679     <span class="comment">// Establish an exception handler and attempt to write the output</span>
00680     <span class="comment">// arguments. If the write attempt fails, then return</span>
00681     <span class="comment">// the exception code as the service status. Otherwise return success</span>
00682     <span class="comment">// as the service status.</span>
00683     <span class="comment">//</span>
00684 
00685     <span class="keywordflow">try</span> {
00686 
00687         <span class="comment">//</span>
00688         <span class="comment">// Get previous processor mode and probe arguments if necessary.</span>
00689         <span class="comment">//</span>
00690 
00691         PreviousMode = KeGetPreviousMode();
00692         <span class="keywordflow">if</span> (PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00693             <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>((PVOID)Time, <span class="keyword">sizeof</span>(LARGE_INTEGER), <span class="keyword">sizeof</span>(ULONG));
00694             <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>((PVOID)Range, <span class="keyword">sizeof</span>(ULONG), <span class="keyword">sizeof</span>(ULONG));
00695             <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>((PVOID)Sequence, <span class="keyword">sizeof</span>(ULONG), <span class="keyword">sizeof</span>(ULONG));
00696             <a class="code" href="../../d5/d8/ex_8h.html#a259">ProbeForWrite</a>((PVOID)Seed, SEED_SIZE, <span class="keyword">sizeof</span>(CHAR));
00697             }
00698         }
00699     except (<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00700         <span class="keywordflow">return</span> GetExceptionCode();
00701         }
00702 
00703     <span class="comment">// Take the lock, because we're about to update the UUID cache.</span>
00704 
00705     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
00706     <a class="code" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe</a>(&amp;ExpUuidLock);
00707 
00708     <span class="comment">// Get the sequence number and a range of times that can</span>
00709     <span class="comment">// be used in UUID-generation.</span>
00710 
00711     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d3/uuid_8c.html#a23">ExpAllocateUuids</a>( &amp;OutputTime, &amp;OutputRange, &amp;OutputSequence );
00712 
00713     <span class="keywordflow">if</span>( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
00714         <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a>(&amp;ExpUuidLock);
00715         <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
00716         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00717         }
00718 
00719     <span class="comment">// If necessary, save the sequence number.  If there's an error,</span>
00720     <span class="comment">// we'll just leave it marked as dirty, and retry on some future call.</span>
00721 
00722     <a class="code" href="../../d3/d3/uuid_8c.html#a20">ExpUuidSaveSequenceNumberIf</a>();
00723 
00724     <span class="comment">// Release the lock</span>
00725     <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a>(&amp;ExpUuidLock);
00726     <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
00727 
00728     <span class="comment">//</span>
00729     <span class="comment">// Attempt to store the result of this call into the output parameters.</span>
00730     <span class="comment">// This is done within an exception handler in case output parameters</span>
00731     <span class="comment">// are now invalid.</span>
00732     <span class="comment">//</span>
00733 
00734     <span class="keywordflow">try</span> {
00735         <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>-&gt;QuadPart = OutputTime.QuadPart;
00736         *Range = OutputRange;
00737         *Sequence = OutputSequence;
00738         RtlCopyMemory((PVOID) Seed, &amp;<a class="code" href="../../d3/d3/uuid_8c.html#a13">ExpUuidCachedValues</a>.<a class="code" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html#o4">NodeId</a>[0], SEED_SIZE);
00739     }
00740     except (<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00741         <span class="keywordflow">return</span> GetExceptionCode();
00742         }
00743 
00744     <span class="keywordflow">return</span>(STATUS_SUCCESS);
00745 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="uuid.c::NtSetUuidSeed" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtSetUuidSeed           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCHAR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Seed</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00532">532</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00058">CACHE_LOCAL_ONLY</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00059">CACHE_VALID</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00095">ExpUuidCachedValues</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00091">ExpUuidCacheValid</a>, <a class="el" href="../../d1/d3/ex_2alpha_2raisests_8c-source.html#l00157">ExRaiseStatus()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00081">_UUID_CACHED_VALUES_STRUCT::NodeId</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, <a class="el" href="../../d5/d3/tprefix_8c-source.html#l00032">Seed</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00528">SEED_SIZE</a>, <a class="el" href="../../d0/d3/tokenqry_8c-source.html#l01152">SeQueryAuthenticationIdToken()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00732">SeQuerySubjectContextToken</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00196">SeReleaseSubjectContext()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00537                    :
00538 
00539     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to set <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> seed used <span class="keywordflow">for</span> <a class="code" href="../../d5/d8/ex_8h.html#a172">UUID</a> generation. The seed
00540     will be set by RPCSS at startup and each time a card <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> replaced.
00541     
00542 Arguments:
00543 
00544     <a class="code" href="../../d4/d4/tprefix_8c.html#a2">Seed</a> - Pointer to a six byte buffer
00545     
00546 Return Value:
00547 
00548     STATUS_SUCCESS <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> service <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> successfully executed.
00549 
00550     STATUS_ACCESS_DENIED If caller doesn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> permissions to make <span class="keyword">this</span> call. 
00551     You need to be logged on as Local System in order to call <span class="keyword">this</span> API.
00552 
00553     STATUS_ACCESS_VIOLATION <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d4/tprefix_8c.html#a2">Seed</a> could not be read.
00554     
00555 --*/
00556 {
00557     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00558     LUID AuthenticationId;
00559     <a class="code" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">SECURITY_SUBJECT_CONTEXT</a> SubjectContext;
00560     LUID SystemLuid = SYSTEM_LUID;
00561     BOOLEAN CapturedSubjectContext = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00562     
00563     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00564 
00565     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetPreviousMode() != KernelMode);
00566 
00567     <span class="keywordflow">try</span> {
00568         <span class="comment">//</span>
00569         <span class="comment">// Check if the caller has the appropriate permission</span>
00570         <span class="comment">//</span>
00571         <a class="code" href="../../d0/d8/subject_8c.html#a0">SeCaptureSubjectContext</a>(&amp;SubjectContext); 
00572         CapturedSubjectContext = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00573 
00574         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/tokenqry_8c.html#a1">SeQueryAuthenticationIdToken</a>(
00575                              <a class="code" href="../../d0/d5/se_8h.html#a16">SeQuerySubjectContextToken</a>(&amp;SubjectContext),
00576                              &amp;AuthenticationId);
00577         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00578             <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>(Status);
00579             }
00580         
00581         <span class="keywordflow">if</span> (RtlCompareMemory(&amp;AuthenticationId, &amp;SystemLuid, <span class="keyword">sizeof</span>(LUID)) != <span class="keyword">sizeof</span>(LUID)) {
00582             <a class="code" href="../../d5/d8/ex_8h.html#a303">ExRaiseStatus</a>(STATUS_ACCESS_DENIED);
00583             }
00584 
00585         <span class="comment">//</span>
00586         <span class="comment">// Store the UUID seed</span>
00587         <span class="comment">//</span>
00588         <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>(Seed, SEED_SIZE, <span class="keyword">sizeof</span>(CHAR));
00589         RtlCopyMemory(&amp;<a class="code" href="../../d3/d3/uuid_8c.html#a13">ExpUuidCachedValues</a>.<a class="code" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html#o4">NodeId</a>[0], Seed, SEED_SIZE);
00590 
00591         <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d4/tprefix_8c.html#a2">Seed</a>[0] &amp; 0x80) == 0)
00592             {
00593             <span class="comment">// If the high bit is not set the NodeId is a valid IEEE 802</span>
00594             <span class="comment">// address and should be globally unique.</span>
00595             <a class="code" href="../../d3/d3/uuid_8c.html#a12">ExpUuidCacheValid</a> = <a class="code" href="../../d3/d3/uuid_8c.html#a7">CACHE_VALID</a>;
00596             }
00597         <span class="keywordflow">else</span>
00598             {
00599             <a class="code" href="../../d3/d3/uuid_8c.html#a12">ExpUuidCacheValid</a> = <a class="code" href="../../d3/d3/uuid_8c.html#a6">CACHE_LOCAL_ONLY</a>;
00600             }
00601         
00602         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00603     }
00604     except (EXCEPTION_EXECUTE_HANDLER) {
00605         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = GetExceptionCode();
00606     }
00607 
00608     <span class="keywordflow">if</span> (CapturedSubjectContext) {
00609         <a class="code" href="../../d0/d8/subject_8c.html#a3">SeReleaseSubjectContext</a>( &amp;SubjectContext );
00610         }
00611 
00612     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00613 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a13" doxytag="uuid.c::ExpUuidCachedValues" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d4/struct__UUID__CACHED__VALUES__STRUCT.html">UUID_CACHED_VALUES_STRUCT</a> <a class="el" href="../../d3/d3/uuid_8c.html#a13">ExpUuidCachedValues</a> = { 0, -1, 0, 0, { 0x80, 'm', 'a', 'r', 'i', 'o' }}          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00095">95</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00841">ExUuidCreate()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00617">NtAllocateUuids()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00532">NtSetUuidSeed()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="uuid.c::ExpUuidCacheValid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d3/d3/uuid_8c.html#a12">ExpUuidCacheValid</a> = CACHE_LOCAL_ONLY          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00091">91</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00841">ExUuidCreate()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00532">NtSetUuidSeed()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="uuid.c::ExpUuidLastTimeAllocated" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER <a class="el" href="../../d3/d3/uuid_8c.html#a11">ExpUuidLastTimeAllocated</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00090">90</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00378">ExpAllocateUuids()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00340">ExpUuidInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="uuid.c::ExpUuidLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="el" href="../../d3/d3/uuid_8c.html#a17">ExpUuidLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00103">103</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00340">ExpUuidInitialization()</a>, <a class="el" href="../../d4/d2/uuid_8c-source.html#l00841">ExUuidCreate()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00617">NtAllocateUuids()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="uuid.c::ExpUuidSequenceNumber" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d3/d3/uuid_8c.html#a14">ExpUuidSequenceNumber</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00098">98</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00378">ExpAllocateUuids()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00287">ExpUuidSaveSequenceNumberIf()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="uuid.c::ExpUuidSequenceNumberNotSaved" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d3/d3/uuid_8c.html#a16">ExpUuidSequenceNumberNotSaved</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00100">100</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00378">ExpAllocateUuids()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00287">ExpUuidSaveSequenceNumberIf()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="uuid.c::ExpUuidSequenceNumberValid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d3/d3/uuid_8c.html#a15">ExpUuidSequenceNumberValid</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d2/uuid_8c-source.html#l00099">99</a> of file <a class="el" href="../../d4/d2/uuid_8c-source.html">uuid.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/uuid_8c-source.html#l00378">ExpAllocateUuids()</a>, and <a class="el" href="../../d4/d2/uuid_8c-source.html#l00340">ExpUuidInitialization()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:46:06 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
