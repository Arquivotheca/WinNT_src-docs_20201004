<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: winmgr.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>winmgr.c</h1><a href="../../d2/d8/rtl_2winmgr_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: winmgr.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* This module contains routines common to client and kernel.</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 02-20-92 DarrinM      Pulled functions from user\server.</span>
00010 <span class="comment">* 11-11-94 JimA         Separated from client.</span>
00011 <span class="comment">\***************************************************************************/</span>
00012 
00013 <span class="comment">/***************************************************************************\</span>
00014 <span class="comment">* FindNCHit</span>
00015 <span class="comment">*</span>
00016 <span class="comment">* History:</span>
00017 <span class="comment">* 11-09-90 DavidPe      Ported.</span>
00018 <span class="comment">\***************************************************************************/</span>
<a name="l00019"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a0">00019</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a0">FindNCHit</a>(
00020     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
00021     LONG lPt)
00022 {
00023     POINT pt;
00024     RECT rcWindow;
00025     RECT rcClient;
00026     RECT rcClientAdj;
00027     <span class="keywordtype">int</span> cBorders;
00028     <span class="keywordtype">int</span> dxButton;
00029 
00030     pt.x = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a7">GET_X_LPARAM</a>(lPt);
00031     pt.y = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a8">GET_Y_LPARAM</a>(lPt);
00032 
00033     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;((<a class="code" href="../../d6/d9/structtagWND.html">WND</a> *)pwnd)-&gt;rcWindow, pt))
00034         <span class="keywordflow">return</span> HTNOWHERE;
00035 
00036     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a653">WFMINIMIZED</a>)) {
00037         <a class="code" href="../../d3/d6/rect_8c.html#a2">CopyInflateRect</a>(&amp;rcWindow, &amp;((<a class="code" href="../../d6/d9/structtagWND.html">WND</a> *)pwnd)-&gt;rcWindow,
00038             -(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXFIXEDFRAME) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXBORDER)), -(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYFIXEDFRAME) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYBORDER)));
00039 
00040         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;rcWindow, pt))
00041             <span class="keywordflow">return</span> HTCAPTION;
00042 
00043         <span class="keywordflow">goto</span> CaptionHit;
00044     }
00045 
00046     <span class="comment">// Get client rectangle</span>
00047     rcClient = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>;
00048     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;rcClient, pt))
00049         <span class="keywordflow">return</span> HTCLIENT;
00050 
00051     <span class="comment">// Are we in "pseudo" client, i.e. the client &amp; scrollbars &amp; border</span>
00052     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a621">WEFCLIENTEDGE</a>))
00053         <a class="code" href="../../d3/d6/rect_8c.html#a2">CopyInflateRect</a>(&amp;rcClientAdj, &amp;rcClient, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXEDGE), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYEDGE));
00054     <span class="keywordflow">else</span>
00055         rcClientAdj = rcClient;
00056 
00057     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a551">WFVPRESENT</a>)) {
00058 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00059 <span class="preprocessor"></span>       <span class="keywordflow">if</span> ((!!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a626">WEFLEFTSCROLL</a>)) ^ (!!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYOUTRTL)))
00060 <span class="preprocessor">#else</span>
00061 <span class="preprocessor"></span>       <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a626">WEFLEFTSCROLL</a>))
00062 <span class="preprocessor">#endif</span>
00063 <span class="preprocessor"></span>           rcClientAdj.left -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXVSCROLL);
00064        <span class="keywordflow">else</span>
00065            rcClientAdj.right += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXVSCROLL);
00066     }
00067     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a552">WFHPRESENT</a>))
00068         rcClientAdj.bottom += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYHSCROLL);
00069 
00070     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;rcClientAdj, pt))
00071     {
00072         <span class="comment">// Subtract out window borders</span>
00073         cBorders = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a7">GetWindowBorders</a>(pwnd-&gt;style, pwnd-&gt;ExStyle, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00074         <a class="code" href="../../d3/d6/rect_8c.html#a2">CopyInflateRect</a>(&amp;rcWindow, &amp;((<a class="code" href="../../d6/d9/structtagWND.html">WND</a> *)pwnd)-&gt;rcWindow,
00075             -cBorders*<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXBORDER), -cBorders*<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYBORDER));
00076 
00077         <span class="comment">// Are we on the border?</span>
00078         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;rcWindow, pt))
00079         {
00080             <span class="comment">// On a sizing border?</span>
00081             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a638">WFSIZEBOX</a>)) {
00082                 <span class="comment">//</span>
00083                 <span class="comment">// Old compatibility thing:  For 3.x windows that just had</span>
00084                 <span class="comment">// a border, we returned HTNOWHERE, believe it or not,</span>
00085                 <span class="comment">// because our hit-testing code was so brain dead.</span>
00086                 <span class="comment">//</span>
00087                 <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>) &amp;&amp;
00088                         !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a642">WFDLGFRAME</a>)    &amp;&amp;
00089                         !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a612">WEFDLGMODALFRAME</a>)) {
00090                     <span class="keywordflow">return</span>(HTNOWHERE);
00091 
00092                 } <span class="keywordflow">else</span> {
00093                     <span class="keywordflow">return</span>(HTBORDER);  <span class="comment">// We are on a dlg frame.</span>
00094                 }
00095             } <span class="keywordflow">else</span> {
00096 
00097                 <span class="keywordtype">int</span> ht;
00098 
00099                 <span class="comment">//</span>
00100                 <span class="comment">// Note this improvement.  The HT codes are numbered so that</span>
00101                 <span class="comment">// if you subtract HTSIZEFIRST-1 from them all, they sum up.  I.E.,</span>
00102                 <span class="comment">// (HTLEFT - HTSIZEFIRST + 1) + (HTTOP - HTSIZEFIRST + 1) ==</span>
00103                 <span class="comment">// (HTTOPLEFT - HTSIZEFIRST + 1).</span>
00104                 <span class="comment">//</span>
00105 
00106                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a619">WEFTOOLWINDOW</a>))
00107                     <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcWindow, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXSMSIZE), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYSMSIZE));
00108                 <span class="keywordflow">else</span>
00109                     <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcWindow, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXSIZE), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYSIZE));
00110 
00111                 <span class="keywordflow">if</span> (pt.y &lt; rcWindow.top)
00112                     ht = (HTTOP - HTSIZEFIRST + 1);
00113                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pt.y &gt;= rcWindow.bottom)
00114                     ht = (HTBOTTOM - HTSIZEFIRST + 1);
00115                 <span class="keywordflow">else</span>
00116                     ht = 0;
00117 
00118                 <span class="keywordflow">if</span> (pt.x &lt; rcWindow.left)
00119                     ht += (HTLEFT - HTSIZEFIRST + 1);
00120                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pt.x &gt;= rcWindow.right)
00121                     ht += (HTRIGHT - HTSIZEFIRST + 1);
00122 
00123                 <span class="keywordflow">return</span> (ht + HTSIZEFIRST - 1);
00124             }
00125         }
00126 
00127         <span class="comment">// Are we above the client area?</span>
00128         <span class="keywordflow">if</span> (pt.y &lt; rcClientAdj.top)
00129         {
00130             <span class="comment">// Are we in the caption?</span>
00131             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a645">WFBORDERMASK</a>) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a646">WFCAPTION</a>))
00132             {
00133 CaptionHit:
00134 
00135 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00136 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYOUTRTL)) {
00137                     pt.x = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - (pt.x - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left);
00138                 }
00139 <span class="preprocessor">#endif</span>
00140 <span class="preprocessor"></span>
00141                 <span class="keywordflow">if</span> (pt.y &gt;= rcWindow.top)
00142                 {
00143                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a619">WEFTOOLWINDOW</a>))
00144                     {
00145                         rcWindow.top += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYSMCAPTION);
00146                         dxButton = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXSMSIZE);
00147                     }
00148                     <span class="keywordflow">else</span>
00149                     {
00150                         rcWindow.top += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYCAPTION);
00151                         dxButton = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXSIZE);
00152                     }
00153 
00154                     <span class="keywordflow">if</span> ((pt.y &gt;= rcWindow.top) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a550">WFMPRESENT</a>))
00155                         <span class="keywordflow">return</span>(HTMENU);
00156 
00157                     <span class="keywordflow">if</span> ((pt.x &gt;= rcWindow.left)  &amp;&amp;
00158                         (pt.x &lt;  rcWindow.right) &amp;&amp;
00159                         (pt.y &lt;  rcWindow.top))
00160                     {
00161                         <span class="comment">// Are we in the window menu?</span>
00162                         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a639">WFSYSMENU</a>))
00163                         {
00164                             rcWindow.left += dxButton;
00165                             <span class="keywordflow">if</span> (pt.x &lt; rcWindow.left)
00166                             {
00167                                 <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a10">_HasCaptionIcon</a>(pwnd))
00168                                 <span class="comment">// iconless windows have no sysmenu hit rect</span>
00169                                     <span class="keywordflow">return</span>(HTCAPTION);
00170 
00171                                 <span class="keywordflow">return</span>(HTSYSMENU);
00172                             }
00173                         }
00174                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>))
00175                             <span class="keywordflow">return</span>(HTCAPTION);
00176 
00177                         <span class="comment">// only a close button if window has a system menu</span>
00178 
00179                         <span class="comment">// Are we in the close button?</span>
00180                         rcWindow.right -= dxButton;
00181                         <span class="keywordflow">if</span> (pt.x &gt;= rcWindow.right)
00182                             <span class="keywordflow">return</span> HTCLOSE;
00183 
00184                         <span class="keywordflow">if</span> ((pt.x &lt; rcWindow.right) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a619">WEFTOOLWINDOW</a>))
00185                         {
00186                             <span class="comment">// Are we in the maximize/restore button?</span>
00187                             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a634">WFMAXBOX</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a636">WFMINBOX</a>)))
00188                             {
00189                                 <span class="comment">// Note that sizing buttons are same width for both</span>
00190                                 <span class="comment">// big captions and small captions.</span>
00191                                 rcWindow.right -= dxButton;
00192                                 <span class="keywordflow">if</span> (pt.x &gt;= rcWindow.right)
00193                                     <span class="keywordflow">return</span> HTZOOM;
00194 
00195                                 <span class="comment">// Are we in the minimize button?</span>
00196                                 rcWindow.right -= dxButton;
00197                                 <span class="keywordflow">if</span> (pt.x &gt;= rcWindow.right)
00198                                     <span class="keywordflow">return</span> HTREDUCE;
00199                             }
00200                             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a623">WEFCONTEXTHELP</a>))
00201                             {
00202                                 rcWindow.right -= dxButton;
00203                                 <span class="keywordflow">if</span> (pt.x &gt;= rcWindow.right)
00204                                     <span class="keywordflow">return</span> HTHELP;
00205                             }
00206                         }
00207                     }
00208                 }
00209 
00210                 <span class="comment">// We're in the caption proper</span>
00211                 <span class="keywordflow">return</span> HTCAPTION;
00212             }
00213 
00214             <span class="comment">//</span>
00215             <span class="comment">// Are we in the menu?</span>
00216             <span class="comment">//</span>
00217             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a550">WFMPRESENT</a>))
00218                 <span class="keywordflow">return</span> HTMENU;
00219         }
00220     }
00221     <span class="keywordflow">else</span>
00222     {
00223         <span class="comment">//</span>
00224         <span class="comment">// NOTE:</span>
00225         <span class="comment">// We can only be here if we are on the client edge, horz scroll,</span>
00226         <span class="comment">// sizebox, or vert scroll.  Hence, if we are not on the first 3,</span>
00227         <span class="comment">// we must be on the last one.</span>
00228         <span class="comment">//</span>
00229 
00230         <span class="comment">//</span>
00231         <span class="comment">// Are we on the client edge?</span>
00232         <span class="comment">//</span>
00233         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a621">WEFCLIENTEDGE</a>))
00234         {
00235             <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcClientAdj, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXEDGE), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYEDGE));
00236             <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;rcClientAdj, pt))
00237                 <span class="keywordflow">return</span>(HTBORDER);
00238         }
00239 
00240         <span class="comment">//</span>
00241         <span class="comment">// Are we on the scrollbars?</span>
00242         <span class="comment">//</span>
00243         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a552">WFHPRESENT</a>) &amp;&amp; (pt.y &gt;= rcClient.bottom))
00244         {
00245             <span class="keywordtype">int</span> iHitTest=HTHSCROLL;
00246             UserAssert(pt.y &lt; rcClientAdj.bottom);
00247 
00248             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a551">WFVPRESENT</a>)) {
00249                 <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndSizeBox = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a8">SizeBoxHwnd</a>(pwnd);
00250 
00251                 <span class="keywordflow">if</span>(pt.x &gt;= rcClient.right)
00252                     <span class="keywordflow">return</span>(pwndSizeBox ? HTBOTTOMRIGHT : HTGROWBOX);
00253 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00254 <span class="preprocessor"></span>                <span class="comment">//</span>
00255                 <span class="comment">// Mirror the grip box location so that it becomes</span>
00256                 <span class="comment">// on the bottom-left side if this is a RTL mirrrored</span>
00257                 <span class="comment">// windows.</span>
00258                 <span class="comment">//</span>
00259                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYOUTRTL) &amp;&amp; (pt.x &lt; rcClient.left))
00260                     <span class="keywordflow">return</span>(pwndSizeBox ? HTBOTTOMLEFT : HTGROWBOX);
00261 <span class="preprocessor">#endif</span>
00262 <span class="preprocessor"></span>            }
00263 
00264             <span class="keywordflow">return</span>(iHitTest);
00265         }
00266         <span class="keywordflow">else</span>
00267         {
00268             UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a551">WFVPRESENT</a>));
00269 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00270 <span class="preprocessor"></span>            <span class="keywordflow">if</span> ((!!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a626">WEFLEFTSCROLL</a>)) ^ (!!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYOUTRTL))) {
00271 <span class="preprocessor">#else</span>
00272 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a626">WEFLEFTSCROLL</a>)) {
00273 <span class="preprocessor">#endif</span>
00274 <span class="preprocessor"></span>                UserAssert(pt.x &lt; rcClient.left);
00275                 UserAssert(pt.x &gt;= rcClientAdj.left);
00276             } <span class="keywordflow">else</span> {
00277                 UserAssert(pt.x &gt;= rcClient.right);
00278                 UserAssert(pt.x &lt; rcClientAdj.right);
00279             }
00280             <span class="keywordflow">return</span>(HTVSCROLL);
00281         }
00282     }
00283 
00284     <span class="comment">//</span>
00285     <span class="comment">// We give up.</span>
00286     <span class="comment">//</span>
00287     <span class="comment">// Win31 returned HTNOWHERE in this case; For compatibility, we will</span>
00288     <span class="comment">// keep it that way.</span>
00289     <span class="comment">//</span>
00290     <span class="keywordflow">return</span>(HTNOWHERE);
00291 
00292 }
00293 
<a name="l00294"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a1">00294</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a1">_FChildVisible</a>(
00295     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00296 {
00297     <span class="keywordflow">while</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd)) {
00298         pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
00299         <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00300             <span class="keywordflow">break</span>;
00301         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>))
00302             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00303     }
00304 
00305     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00306 }
00307 
00308 <span class="comment">/***************************************************************************\</span>
00309 <span class="comment">* _MapWindowPoints</span>
00310 <span class="comment">*</span>
00311 <span class="comment">*</span>
00312 <span class="comment">* History:</span>
00313 <span class="comment">* 03-03-92 JimA             Ported from Win 3.1 sources.</span>
00314 <span class="comment">\***************************************************************************/</span>
00315 
<a name="l00316"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a2">00316</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a2">_MapWindowPoints</a>(
00317     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndFrom,
00318     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndTo,
00319     LPPOINT lppt,
00320     DWORD cpt)
00321 {
00322 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00323 <span class="preprocessor"></span>    <span class="keywordtype">int</span>     dx = 0, dy = 0;
00324     <span class="keywordtype">int</span>     SaveLeft, Sign = 1;
00325     RECT    *pR      = (RECT *)lppt;
00326     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    bMirrored = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00327 <span class="preprocessor">#else</span>
00328 <span class="preprocessor"></span>    <span class="keywordtype">int</span> dx, dy;
00329     LPPOINT pptFrom, pptTo;
00330 <span class="preprocessor">#endif</span>
00331 <span class="preprocessor"></span>
00332     <span class="comment">/*</span>
00333 <span class="comment">     * If a window is NULL, use the desktop window.</span>
00334 <span class="comment">     * If the window is the desktop, don't offset by</span>
00335 <span class="comment">     * the client rect, since it won't work if the screen</span>
00336 <span class="comment">     * origin is not (0,0) - use zero instead.</span>
00337 <span class="comment">     */</span>
00338 
00339     <span class="comment">/*</span>
00340 <span class="comment">     * Compute deltas</span>
00341 <span class="comment">     */</span>
00342 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00343 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (pwndFrom &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndFrom) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>) {
00344         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndFrom, WEFLAYOUTRTL)) {
00345             Sign      = -Sign;
00346             dx        = -pwndFrom-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right;
00347             bMirrored = (cpt == 2);
00348         } <span class="keywordflow">else</span> {
00349             dx   = pwndFrom-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left;
00350         }
00351         dy   = pwndFrom-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top;
00352     }
00353 
00354     <span class="keywordflow">if</span> (pwndTo &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndTo) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>) {
00355         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndTo, WEFLAYOUTRTL)) {
00356             Sign      = -Sign;
00357             dx        = dx + Sign * pwndTo-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right;
00358             bMirrored = (cpt == 2);
00359         } <span class="keywordflow">else</span> {
00360             dx   = dx - Sign * pwndTo-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left;
00361         }
00362         dy   = dy - pwndTo-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top;
00363     }
00364 
00365 <span class="preprocessor">#else</span>
00366 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (pwndFrom == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndFrom) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>) {
00367         pptFrom = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a6">PZERO</a>(POINT);
00368     } <span class="keywordflow">else</span> {
00369         pptFrom = (LPPOINT) &amp;pwndFrom-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>;
00370     }
00371 
00372     <span class="keywordflow">if</span> (pwndTo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndTo) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>) {
00373         pptTo = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a6">PZERO</a>(POINT);
00374     } <span class="keywordflow">else</span> {
00375         pptTo = (LPPOINT) &amp;pwndTo-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>;
00376     }
00377     dx = pptFrom-&gt;x - pptTo-&gt;x;
00378     dy = pptFrom-&gt;y - pptTo-&gt;y;
00379 <span class="preprocessor">#endif</span>
00380 <span class="preprocessor"></span>
00381     <span class="comment">/*</span>
00382 <span class="comment">     * Map the points</span>
00383 <span class="comment">     */</span>
00384     <span class="keywordflow">while</span> (cpt--) {
00385         lppt-&gt;x += dx;
00386 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00387 <span class="preprocessor"></span>        lppt-&gt;x *= Sign;
00388 <span class="preprocessor">#endif</span>
00389 <span class="preprocessor"></span>        lppt-&gt;y += dy;
00390         ++lppt;
00391     }
00392 
00393 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00394 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (bMirrored) {     <span class="comment">//Special case for Rect</span>
00395         SaveLeft  = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a> (pR-&gt;left, pR-&gt;right);
00396         pR-&gt;right = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a> (pR-&gt;left, pR-&gt;right);
00397         pR-&gt;left  = SaveLeft;
00398     }
00399 <span class="preprocessor">#endif</span>
00400 <span class="preprocessor"></span>    <span class="keywordflow">return</span> MAKELONG(dx, dy);
00401 }
00402 
00403 
00404 <span class="comment">/***************************************************************************\</span>
00405 <span class="comment">*</span>
00406 <span class="comment">* GetRealClientRect()</span>
00407 <span class="comment">*</span>
00408 <span class="comment">* Gets real client rectangle, inc. scrolls and excl. one row or column</span>
00409 <span class="comment">* of minimized windows.</span>
00410 <span class="comment">*</span>
00411 <span class="comment">* If hwndParent is the desktop, then</span>
00412 <span class="comment">*     * If pMonitor is NULL, use the primary monitor</span>
00413 <span class="comment">*     * Otherwise use the appropriate monitor's rectangles</span>
00414 <span class="comment">*</span>
00415 <span class="comment">\***************************************************************************/</span>
00416 
<a name="l00417"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a3">00417</a> <span class="keywordtype">void</span> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a3">GetRealClientRect</a>(
00418     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>        pwnd,
00419     LPRECT      prc,
00420     UINT        uFlags,
00421     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>    pMonitor
00422     )
00423 {
00424     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>) {
00425         <span class="keywordflow">if</span> (!pMonitor) {
00426             pMonitor = <a class="code" href="../../d6/d0/usercli_8h.html#a793">GetPrimaryMonitor</a>();
00427         }
00428         *prc = (uFlags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a875">GRC_FULLSCREEN</a>) ? pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a> : pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>;
00429     } <span class="keywordflow">else</span> {
00430         <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a12">GetRect</a>(pwnd, prc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a902">GRECT_CLIENT</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a905">GRECT_CLIENTCOORDS</a>);
00431         <span class="keywordflow">if</span> (uFlags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a873">GRC_SCROLLS</a>) {
00432             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a552">WFHPRESENT</a>)){
00433                 prc-&gt;bottom += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYHSCROLL);
00434             }
00435 
00436             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a551">WFVPRESENT</a>)) {
00437                 prc-&gt;right += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXVSCROLL);
00438             }
00439         }
00440     }
00441 
00442     <span class="keywordflow">if</span> (uFlags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a874">GRC_MINWNDS</a>) {
00443         <span class="keywordflow">switch</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(ARRANGE) &amp; ~ARW_HIDE) {
00444             <span class="keywordflow">case</span> ARW_TOPLEFT | ARW_RIGHT:
00445             <span class="keywordflow">case</span> ARW_TOPRIGHT | ARW_LEFT:
00446                 <span class="comment">//</span>
00447                 <span class="comment">// Leave space on top for one row of min windows</span>
00448                 <span class="comment">//</span>
00449                 prc-&gt;top += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYMINSPACING);
00450                 <span class="keywordflow">break</span>;
00451 
00452             <span class="keywordflow">case</span> ARW_TOPLEFT | ARW_DOWN:
00453             <span class="keywordflow">case</span> ARW_BOTTOMLEFT | ARW_UP:
00454                 <span class="comment">//</span>
00455                 <span class="comment">// Leave space on left for one column of min windows</span>
00456                 <span class="comment">//</span>
00457                 prc-&gt;left += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXMINSPACING);
00458                 <span class="keywordflow">break</span>;
00459 
00460             <span class="keywordflow">case</span> ARW_TOPRIGHT | ARW_DOWN:
00461             <span class="keywordflow">case</span> ARW_BOTTOMRIGHT | ARW_UP:
00462                 <span class="comment">//</span>
00463                 <span class="comment">// Leave space on right for one column of min windows</span>
00464                 <span class="comment">//</span>
00465                 prc-&gt;right -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXMINSPACING);
00466                 <span class="keywordflow">break</span>;
00467 
00468             <span class="keywordflow">case</span> ARW_BOTTOMLEFT | ARW_RIGHT:
00469             <span class="keywordflow">case</span> ARW_BOTTOMRIGHT | ARW_LEFT:
00470                 <span class="comment">//</span>
00471                 <span class="comment">// Leave space on bottom for one row of min windows</span>
00472                 <span class="comment">//</span>
00473                 prc-&gt;bottom -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYMINSPACING);
00474                 <span class="keywordflow">break</span>;
00475         }
00476     }
00477 }
00478 
00479 
00480 <span class="comment">/***************************************************************************\</span>
00481 <span class="comment">* _GetLastActivePopup (API)</span>
00482 <span class="comment">*</span>
00483 <span class="comment">*</span>
00484 <span class="comment">*</span>
00485 <span class="comment">* History:</span>
00486 <span class="comment">* 11-27-90 darrinm      Ported from Win 3.0 sources.</span>
00487 <span class="comment">* 02-19-91 JimA         Added enum access check</span>
00488 <span class="comment">\***************************************************************************/</span>
00489 
<a name="l00490"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a4">00490</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a4">_GetLastActivePopup</a>(
00491     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00492 {
00493     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o12">spwndLastActive</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00494         <span class="keywordflow">return</span> pwnd;
00495 
00496     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndLastActive);
00497 }
00498 
00499 
00500 <span class="comment">/***************************************************************************\</span>
00501 <span class="comment">* IsDescendant</span>
00502 <span class="comment">*</span>
00503 <span class="comment">* Internal version if IsChild that is a bit faster and ignores the WFCHILD</span>
00504 <span class="comment">* business.</span>
00505 <span class="comment">*</span>
00506 <span class="comment">* Returns TRUE if pwndChild == pwndParent (IsChild doesn't).</span>
00507 <span class="comment">*</span>
00508 <span class="comment">* History:</span>
00509 <span class="comment">* 07-22-91 darrinm      Translated from Win 3.1 ASM code.</span>
00510 <span class="comment">* 03-03-94 Johnl        Moved from server</span>
00511 <span class="comment">\***************************************************************************/</span>
00512 
<a name="l00513"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a5">00513</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a5">_IsDescendant</a>(
00514     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent,
00515     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndChild)
00516 {
00517     <span class="keywordflow">while</span> (1) {
00518         <span class="keywordflow">if</span> (pwndParent == pwndChild)
00519             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00520         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndChild) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>)
00521             <span class="keywordflow">break</span>;
00522         pwndChild = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndChild, spwndParent);
00523     }
00524 
00525     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00526 }
00527 
00528 <span class="comment">/***************************************************************************\</span>
00529 <span class="comment">* IsVisible</span>
00530 <span class="comment">*</span>
00531 <span class="comment">* Return whether or not a given window can be drawn in or not.</span>
00532 <span class="comment">*</span>
00533 <span class="comment">* History:</span>
00534 <span class="comment">* 07-22-91 darrinm      Translated from Win 3.1 ASM code.</span>
00535 <span class="comment">\***************************************************************************/</span>
00536 
<a name="l00537"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a6">00537</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a6">IsVisible</a>(
00538     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00539 {
00540     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT;
00541 
00542     <span class="keywordflow">for</span> (pwndT = pwnd; pwndT; pwndT = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwndT, spwndParent)) {
00543 
00544         <span class="comment">/*</span>
00545 <span class="comment">         * Invisible windows are always invisible</span>
00546 <span class="comment">         */</span>
00547         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndT, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>))
00548             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00549 
00550         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndT, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a653">WFMINIMIZED</a>)) {
00551 
00552             <span class="comment">/*</span>
00553 <span class="comment">             * Children of minimized windows are always invisible.</span>
00554 <span class="comment">             */</span>
00555             <span class="keywordflow">if</span> (pwndT != pwnd)
00556                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00557         }
00558 
00559         <span class="comment">/*</span>
00560 <span class="comment">         * If we're at the desktop, then we don't want to go any further.</span>
00561 <span class="comment">         */</span>
00562         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndT) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>)
00563             <span class="keywordflow">break</span>;
00564     }
00565 
00566     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00567 }
00568 
00569 
00570 <span class="comment">/***************************************************************************\</span>
00571 <span class="comment">*</span>
00572 <span class="comment">*  Function:       GetWindowBorders</span>
00573 <span class="comment">*</span>
00574 <span class="comment">*  Synopsis:       Calculates # of borders around window</span>
00575 <span class="comment">*</span>
00576 <span class="comment">*  Algorithm:      Calculate # of window borders and # of client borders</span>
00577 <span class="comment">*</span>
00578 <span class="comment">*   This routine is ported from Chicago wmclient.c -- FritzS</span>
00579 <span class="comment">*</span>
00580 <span class="comment">\***************************************************************************/</span>
00581 
<a name="l00582"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a7">00582</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a7">GetWindowBorders</a>(LONG lStyle, DWORD dwExStyle, BOOL fWindow, BOOL fClient)
00583 {
00584     <span class="keywordtype">int</span> cBorders = 0;
00585 
00586     <span class="keywordflow">if</span> (fWindow) {
00587         <span class="comment">//</span>
00588         <span class="comment">// Is there a 3D border around the window?</span>
00589         <span class="comment">//</span>
00590         <span class="keywordflow">if</span> (dwExStyle &amp; WS_EX_WINDOWEDGE)
00591             cBorders += 2;
00592         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwExStyle &amp; WS_EX_STATICEDGE)
00593             ++cBorders;
00594 
00595         <span class="comment">//</span>
00596         <span class="comment">// Is there a single flat border around the window?  This is true for</span>
00597         <span class="comment">// WS_BORDER, WS_DLGFRAME, and WS_EX_DLGMODALFRAME windows.</span>
00598         <span class="comment">//</span>
00599         <span class="keywordflow">if</span> ( (lStyle &amp; WS_CAPTION) || (dwExStyle &amp; WS_EX_DLGMODALFRAME) )
00600                 ++cBorders;
00601 
00602         <span class="comment">//</span>
00603         <span class="comment">// Is there a sizing flat border around the window?</span>
00604         <span class="comment">//</span>
00605         <span class="keywordflow">if</span> (lStyle &amp; WS_SIZEBOX)
00606                 cBorders += <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder;
00607     }
00608 
00609     <span class="keywordflow">if</span> (fClient) {
00610             <span class="comment">//</span>
00611             <span class="comment">// Is there a 3D border around the client?</span>
00612             <span class="comment">//</span>
00613             <span class="keywordflow">if</span> (dwExStyle &amp; WS_EX_CLIENTEDGE)
00614             cBorders += 2;
00615     }
00616 
00617     <span class="keywordflow">return</span>(cBorders);
00618 }
00619 
00620 
00621 
00622 <span class="comment">/***************************************************************************\</span>
00623 <span class="comment">*  SizeBoxHwnd()</span>
00624 <span class="comment">*</span>
00625 <span class="comment">*  Returns the HWND that will be sized if the user drags in the given window's</span>
00626 <span class="comment">*  sizebox -- If NULL, then the sizebox is not needed</span>
00627 <span class="comment">*</span>
00628 <span class="comment">*  Criteria for choosing what window will be sized:</span>
00629 <span class="comment">*  find first sizeable parent; if that parent is not maximized and the child's</span>
00630 <span class="comment">*  bottom, right corner is within a scroll bar height and width of the parent's</span>
00631 <span class="comment">*  bottom, right corner, that parent will be sized.</span>
00632 <span class="comment">*</span>
00633 <span class="comment">*   From Chicago</span>
00634 <span class="comment">\***************************************************************************/</span>
00635 
<a name="l00636"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a8">00636</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a8">SizeBoxHwnd</a>(
00637     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00638 {
00639 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00640 <span class="preprocessor"></span>    <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bMirroredSizeBox = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>) <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYOUTRTL);
00641 <span class="preprocessor">#endif</span>
00642 <span class="preprocessor"></span>
00643     <span class="keywordtype">int</span> xbrChild;
00644     <span class="keywordtype">int</span> ybrChild = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom;
00645 
00646 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00647 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (bMirroredSizeBox) {
00648         xbrChild = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00649     } <span class="keywordflow">else</span> 
00650 <span class="preprocessor">#endif</span>
00651 <span class="preprocessor"></span>    {
00652         xbrChild = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right;
00653     }
00654 
00655     <span class="keywordflow">while</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>) {
00656         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a638">WFSIZEBOX</a>)) {
00657             <span class="comment">// First sizeable parent found</span>
00658             <span class="keywordtype">int</span> xbrParent;
00659             <span class="keywordtype">int</span> ybrParent;
00660 
00661             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a648">WFMAXIMIZED</a>))
00662                 <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00663 
00664 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00665 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (bMirroredSizeBox) {
00666                 xbrParent = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left;
00667             } <span class="keywordflow">else</span> 
00668 <span class="preprocessor">#endif</span>
00669 <span class="preprocessor"></span>            {
00670                 xbrParent = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right;
00671             }
00672             ybrParent = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.bottom;
00673 
00674             <span class="comment">/*  If the sizebox dude is within an EDGE of the client's bottom</span>
00675 <span class="comment">             *  right corner (left corner for mirrored windows), let this succeed.  </span>
00676 <span class="comment">             *  That way people who draw their own sunken clients will be happy.</span>
00677 <span class="comment">             */</span>
00678 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00679 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (bMirroredSizeBox) {
00680                 <span class="keywordflow">if</span> ((xbrChild - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXEDGE) &gt; xbrParent) || (ybrChild + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYEDGE) &lt; ybrParent)) {
00681                     <span class="comment">//</span>
00682                     <span class="comment">// Child's bottom, left corner of SIZEBOX isn't close enough</span>
00683                     <span class="comment">// to bottom left of parent's client.</span>
00684                     <span class="comment">//</span>
00685                     <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00686                 }
00687             } <span class="keywordflow">else</span> 
00688 <span class="preprocessor">#endif</span>
00689 <span class="preprocessor"></span>            {
00690                 <span class="keywordflow">if</span> ((xbrChild + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CXEDGE) &lt; xbrParent) || (ybrChild + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a19">SYSMETRTL</a>(CYEDGE) &lt; ybrParent)) {
00691                     <span class="comment">//</span>
00692                     <span class="comment">// Child's bottom, right corner of SIZEBOX isn't close enough</span>
00693                     <span class="comment">// to bottom right of parent's client.</span>
00694                     <span class="comment">//</span>
00695                     <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00696                 }
00697             }
00698 
00699             <span class="keywordflow">return</span>(pwnd);
00700         }
00701 
00702         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a654">WFCHILD</a>) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a553">WFCPRESENT</a>))
00703             <span class="keywordflow">break</span>;
00704 
00705         pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
00706     }
00707     <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00708 }
00709 
00710 
00711 
00712 <span class="comment">// --------------------------------------------------------------------------</span>
00713 <span class="comment">//</span>
00714 <span class="comment">//  NeedsWindowEdge()</span>
00715 <span class="comment">//</span>
00716 <span class="comment">//  Modifies style/extended style to enforce WS_EX_WINDOWEDGE when we want</span>
00717 <span class="comment">//  it.</span>
00718 <span class="comment">//</span>
00719 <span class="comment">//</span>
00720 <span class="comment">// When do we want WS_EX_WINDOWEDGE on a window?</span>
00721 <span class="comment">//      (1) If the window has a caption</span>
00722 <span class="comment">//      (2) If the window has the WS_DLGFRAME or WS_EX_DLGFRAME style (note</span>
00723 <span class="comment">//          that this takes care of (1))</span>
00724 <span class="comment">//      (3) If the window has WS_THICKFRAME</span>
00725 <span class="comment">//</span>
00726 <span class="comment">// --------------------------------------------------------------------------</span>
<a name="l00727"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a9">00727</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a9">NeedsWindowEdge</a>(DWORD dwStyle, DWORD dwExStyle, BOOL fNewApp)
00728 {
00729     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fGetsWindowEdge;
00730 
00731     fGetsWindowEdge = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00732 
00733     <span class="keywordflow">if</span> (dwExStyle &amp; WS_EX_DLGMODALFRAME)
00734         fGetsWindowEdge = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00735     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwExStyle &amp; WS_EX_STATICEDGE)
00736         fGetsWindowEdge = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00737     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwStyle &amp; WS_THICKFRAME)
00738         fGetsWindowEdge = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00739     <span class="keywordflow">else</span> <span class="keywordflow">switch</span> (dwStyle &amp; WS_CAPTION)
00740     {
00741         <span class="keywordflow">case</span> WS_DLGFRAME:
00742             fGetsWindowEdge = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00743             <span class="keywordflow">break</span>;
00744 
00745         <span class="keywordflow">case</span> WS_CAPTION:
00746             fGetsWindowEdge = fNewApp;
00747             <span class="keywordflow">break</span>;
00748     }
00749 
00750     <span class="keywordflow">return</span>(fGetsWindowEdge);
00751 }
00752 
00753 
00754 <span class="comment">// --------------------------------------------------------------------------</span>
00755 <span class="comment">//</span>
00756 <span class="comment">//  HasCaptionIcon()</span>
00757 <span class="comment">//</span>
00758 <span class="comment">//  TRUE if this is a window that should have an icon drawn in its caption</span>
00759 <span class="comment">//  FALSE otherwise</span>
00760 <span class="comment">//</span>
00761 <span class="comment">// --------------------------------------------------------------------------</span>
00762 
<a name="l00763"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a10">00763</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a10">_HasCaptionIcon</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00764 {
00765     HICON hIcon;
00766     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls;
00767 
00768     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a619">WEFTOOLWINDOW</a>))
00769         <span class="comment">// it's a tool window -- it doesn't get an icon</span>
00770         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00771 
00772     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a645">WFBORDERMASK</a>) != (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a642">WFDLGFRAME</a>)) &amp;&amp;
00773             !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a612">WEFDLGMODALFRAME</a>))
00774         <span class="comment">// they are not trying to look like a dialog, they get an icon</span>
00775         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00776 
00777     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>) &amp;&amp;
00778         (((<a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a>)<a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwnd, pcls))-&gt;atomClassName == (ATOM)(ULONG_PTR)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a40">DIALOGCLASS</a>))
00779         <span class="comment">// it's an older REAL dialog -- it doesn't get an icon</span>
00780         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00781 
00782     hIcon = (HICON) <a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o28">atomIconSmProp</a>), <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00783 
00784     <span class="keywordflow">if</span> (hIcon) {
00785         <span class="comment">// it's a 4.0 dialog with a small icon -- if that small icon is</span>
00786         <span class="comment">// something other than the generic small windows icon, it gets an icon</span>
00787         <span class="keywordflow">return</span>(hIcon != <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hIconSmWindows);
00788     }
00789     hIcon = (HICON) <a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o29">atomIconProp</a>), <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00790 
00791     <span class="keywordflow">if</span> (hIcon &amp;&amp; (hIcon != <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hIcoWindows))
00792         <span class="comment">// it's a 4.0 dialog with no small icon, but instead a large icon</span>
00793         <span class="comment">// that's not the generic windows icon -- it gets an icon</span>
00794         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00795 
00796     pcls = <a class="code" href="../../d6/d0/usercli_8h.html#a24">REBASEALWAYS</a>(pwnd, pcls);
00797     <span class="keywordflow">if</span> (pcls-&gt;spicnSm) {
00798         <span class="keywordflow">if</span> (pcls-&gt;spicnSm != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a447">HMObjectFromHandle</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hIconSmWindows)) {
00799             <span class="comment">// it's a 4.0 dialog with a class icon that's not the generic windows</span>
00800             <span class="comment">// icon -- it gets an icon</span>
00801             <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00802         }
00803     }
00804 
00805     <span class="comment">// it's a 4.0 dialog with no small or large icon -- it doesn't get an icon</span>
00806     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00807 }
00808 
00809 
00810 <span class="comment">/***************************************************************************\</span>
00811 <span class="comment">* GetTopLevelWindow</span>
00812 <span class="comment">*</span>
00813 <span class="comment">* History:</span>
00814 <span class="comment">* 10-19-90 darrinm      Ported from Win 3.0 sources.</span>
00815 <span class="comment">\***************************************************************************/</span>
00816 
<a name="l00817"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a11">00817</a> <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a11">GetTopLevelWindow</a>(
00818     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00819 {
00820     <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00821         <span class="keywordflow">while</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a735">TestwndChild</a>(pwnd))
00822             pwnd = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
00823     }
00824 
00825     <span class="keywordflow">return</span> pwnd;
00826 }
00827 
00828 
00829 
00830 <span class="comment">/***************************************************************************\</span>
00831 <span class="comment">* GetRect</span>
00832 <span class="comment">*</span>
00833 <span class="comment">* Returns a rect from pwnd (client or window) and returns it in</span>
00834 <span class="comment">* one of these coordinate schemes:</span>
00835 <span class="comment">*</span>
00836 <span class="comment">*      (a) Own Client</span>
00837 <span class="comment">*      (b) Own Window</span>
00838 <span class="comment">*      (c) Parent Client</span>
00839 <span class="comment">*</span>
00840 <span class="comment">* Moreover, it does the right thing for case (d) when pwnd is top level.</span>
00841 <span class="comment">* In that case, we never want to offset by origin of the parent, which is the</span>
00842 <span class="comment">* desktop, since that will not work when the virtual screen has a</span>
00843 <span class="comment">* negative origin.  And it does the right thing for cases (b) and (c)</span>
00844 <span class="comment">* if pwnd is the desktop.</span>
00845 <span class="comment">*</span>
00846 <span class="comment">* NOTE: The Win95 version of this function had a flag GRECT_SCREENCOORDS,</span>
00847 <span class="comment">* which would return the rectangle in screen coords. There's no reason to</span>
00848 <span class="comment">* call a function to do this, since the smallest and fastest to copy a</span>
00849 <span class="comment">* rectangle is simple assignment. Therefore, I removed GRECT_SCREENCOORDS.</span>
00850 <span class="comment">*</span>
00851 <span class="comment">* History:</span>
00852 <span class="comment">* 19-Sep-1996 adams     Created.</span>
00853 <span class="comment">\***************************************************************************/</span>
00854 
00855 <span class="keywordtype">void</span>
<a name="l00856"></a><a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a12">00856</a> <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a12">GetRect</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, LPRECT lprc, UINT uCoords)
00857 {
00858     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>    pwndParent;
00859     LPRECT  lprcOffset;
00860 
00861     UserAssert(lprc);
00862     UserAssert((uCoords &amp; ~(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a908">GRECT_COORDMASK</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a904">GRECT_RECTMASK</a>)) == 0);
00863     UserAssert(uCoords &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a908">GRECT_COORDMASK</a>);
00864     UserAssert(uCoords &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a904">GRECT_RECTMASK</a>);
00865 
00866     *lprc = (uCoords &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a903">GRECT_WINDOW</a>) ? pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a> : pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>;
00867 
00868     <span class="comment">/*</span>
00869 <span class="comment">     * If this is the desktop window, we have what we want, whether we</span>
00870 <span class="comment">     * are asking for GRECT_PARENTCOORDS, WINDOWCOORD or CLIENTCOORDS</span>
00871 <span class="comment">     */</span>
00872     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>)
00873         <span class="keywordflow">return</span>;
00874 
00875     <span class="keywordflow">switch</span> (uCoords &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a908">GRECT_COORDMASK</a>) {
00876     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a907">GRECT_PARENTCOORDS</a>:
00877         pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
00878         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndParent) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>)
00879             <span class="keywordflow">return</span>;
00880 
00881         lprcOffset = &amp;pwndParent-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>;
00882 
00883 <span class="preprocessor">#if defined(USE_MIRRORING)</span>
00884 <span class="preprocessor"></span>        <span class="comment">//</span>
00885         <span class="comment">// Let's mirror the edges of the child's window since the parent</span>
00886         <span class="comment">// is mirrored, so should the child window be. [samera]</span>
00887         <span class="comment">//</span>
00888         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwndParent,WEFLAYOUTRTL) &amp;&amp;
00889                 (uCoords &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a903">GRECT_WINDOW</a>) &amp;&amp;
00890                 (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd,<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a654">WFCHILD</a>))) {
00891             <span class="keywordtype">int</span> iLeft;
00892 
00893             <span class="comment">//</span>
00894             <span class="comment">// I am using OffsetRect instead of implementing a new</span>
00895             <span class="comment">// OffsetMirrorRect API since this is the only place I am</span>
00896             <span class="comment">// doing it in.</span>
00897             <span class="comment">//</span>
00898             <span class="comment">// Since screen coordinates are not mirrored, the rect offsetting</span>
00899             <span class="comment">// should be done relative to prcOffset-&gt;right since it is the</span>
00900             <span class="comment">// leading edge for mirrored windows. [samera]</span>
00901             <span class="comment">//</span>
00902 
00903             UserVerify(<a class="code" href="../../d3/d6/rect_8c.html#a6">OffsetRect</a>(lprc, -lprcOffset-&gt;right, -lprcOffset-&gt;top));
00904 
00905             iLeft = lprc-&gt;left;
00906             lprc-&gt;left  = (lprc-&gt;right * -1);
00907             lprc-&gt;right = (iLeft * -1);
00908 
00909             <span class="keywordflow">return</span>;
00910         }
00911 <span class="preprocessor">#endif</span>
00912 <span class="preprocessor"></span>
00913         <span class="keywordflow">break</span>;
00914 
00915     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a906">GRECT_WINDOWCOORDS</a>:
00916         lprcOffset = &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>;
00917         <span class="keywordflow">break</span>;
00918 
00919     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a905">GRECT_CLIENTCOORDS</a>:
00920         lprcOffset = &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>;
00921         <span class="keywordflow">break</span>;
00922 
00923     <span class="keywordflow">default</span>:
00924         UserAssert(0 &amp;&amp; <span class="stringliteral">"Logic error in _GetRect - invalid uCoords"</span>);
00925     }
00926 
00927     UserVerify(<a class="code" href="../../d3/d6/rect_8c.html#a6">OffsetRect</a>(lprc, -lprcOffset-&gt;left, -lprcOffset-&gt;top));
00928 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:25 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
