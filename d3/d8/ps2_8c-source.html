<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ps2.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ps2.c</h1><a href="../../d2/d9/ps2_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************Module*Header******************************\</span>
00002 <span class="comment">* Module Name: PS2.C</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Module Descripton: Functions for retrieving or creating PostScript</span>
00005 <span class="comment">*    Level 2 operators from a profile. It is shared by mscms &amp; pscript5</span>
00006 <span class="comment">*</span>
00007 <span class="comment">* Warnings:</span>
00008 <span class="comment">*</span>
00009 <span class="comment">* Issues:</span>
00010 <span class="comment">*</span>
00011 <span class="comment">* Public Routines:</span>
00012 <span class="comment">*</span>
00013 <span class="comment">* Created:  13 May 1996</span>
00014 <span class="comment">* Author:   Srinivasan Chandrasekar    [srinivac]</span>
00015 <span class="comment">*</span>
00016 <span class="comment">* Copyright (c) 1996, 1997  Microsoft Corporation</span>
00017 <span class="comment">\***********************************************************************/</span>
00018 
00019 <span class="preprocessor">#include &lt;math.h&gt;</span>
00020 
<a name="l00021"></a><a class="code" href="../../d2/d9/ps2_8c.html#a0">00021</a> <span class="preprocessor">#define MAX_LINELEN             240</span>
<a name="l00022"></a><a class="code" href="../../d2/d9/ps2_8c.html#a1">00022</a> <span class="preprocessor"></span><span class="preprocessor">#define REVCURVE_RATIO          1</span>
<a name="l00023"></a><a class="code" href="../../d2/d9/ps2_8c.html#a2">00023</a> <span class="preprocessor"></span><span class="preprocessor">#define CIEXYZRange             0x1FFEC       // 1.9997 in 16.16 notation</span>
<a name="l00024"></a><a class="code" href="../../d2/d9/ps2_8c.html#a3">00024</a> <span class="preprocessor"></span><span class="preprocessor">#define ALIGN_DWORD(nBytes)     (((nBytes) + 3) &amp; ~3)</span>
00025 <span class="preprocessor"></span>
<a name="l00026"></a><a class="code" href="../../d2/d9/ps2_8c.html#a4">00026</a> <span class="preprocessor">#define FIX_16_16_SHIFT         16</span>
<a name="l00027"></a><a class="code" href="../../d2/d9/ps2_8c.html#a5">00027</a> <span class="preprocessor"></span><span class="preprocessor">#define FIX_16_16_SCALE         (1 &lt;&lt; (FIX_16_16_SHIFT))</span>
00028 <span class="preprocessor"></span>
<a name="l00029"></a><a class="code" href="../../d2/d9/ps2_8c.html#a6">00029</a> <span class="preprocessor">#define TO_FIX(x)               ((x) &lt;&lt; FIX_16_16_SHIFT)</span>
<a name="l00030"></a><a class="code" href="../../d2/d9/ps2_8c.html#a7">00030</a> <span class="preprocessor"></span><span class="preprocessor">#define TO_INT(x)               ((x) &gt;&gt; FIX_16_16_SHIFT)</span>
<a name="l00031"></a><a class="code" href="../../d2/d9/ps2_8c.html#a8">00031</a> <span class="preprocessor"></span><span class="preprocessor">#define FIX_MUL(x, y)           MulDiv((x), (y), FIX_16_16_SCALE)</span>
<a name="l00032"></a><a class="code" href="../../d2/d9/ps2_8c.html#a9">00032</a> <span class="preprocessor"></span><span class="preprocessor">#define FIX_DIV(x, y)           MulDiv((x), FIX_16_16_SCALE, (y))</span>
00033 <span class="preprocessor"></span>
<a name="l00034"></a><a class="code" href="../../d2/d9/ps2_8c.html#a10">00034</a> <span class="preprocessor">#define FLOOR(x)                ((x) &gt;&gt; FIX_16_16_SHIFT &lt;&lt; FIX_16_16_SHIFT)</span>
00035 <span class="preprocessor"></span>
<a name="l00036"></a><a class="code" href="../../d2/d9/ps2_8c.html#a11">00036</a> <span class="preprocessor">#define TYPE_CIEBASEDDEF        1</span>
<a name="l00037"></a><a class="code" href="../../d2/d9/ps2_8c.html#a12">00037</a> <span class="preprocessor"></span><span class="preprocessor">#define TYPE_CIEBASEDDEFG       2</span>
00038 <span class="preprocessor"></span>
<a name="l00039"></a><a class="code" href="../../d2/d9/ps2_8c.html#a13">00039</a> <span class="preprocessor">#define TAG_PS2CSA              'ps2s'</span>
<a name="l00040"></a><a class="code" href="../../d2/d9/ps2_8c.html#a14">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_REDCOLORANT         'rXYZ'</span>
<a name="l00041"></a><a class="code" href="../../d2/d9/ps2_8c.html#a15">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_GREENCOLORANT       'gXYZ'</span>
<a name="l00042"></a><a class="code" href="../../d2/d9/ps2_8c.html#a16">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_BLUECOLORANT        'bXYZ'</span>
<a name="l00043"></a><a class="code" href="../../d2/d9/ps2_8c.html#a17">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_REDTRC              'rTRC'</span>
<a name="l00044"></a><a class="code" href="../../d2/d9/ps2_8c.html#a18">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_GREENTRC            'gTRC'</span>
<a name="l00045"></a><a class="code" href="../../d2/d9/ps2_8c.html#a19">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_BLUETRC             'bTRC'</span>
<a name="l00046"></a><a class="code" href="../../d2/d9/ps2_8c.html#a20">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_GRAYTRC             'kTRC'</span>
<a name="l00047"></a><a class="code" href="../../d2/d9/ps2_8c.html#a21">00047</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_MEDIAWHITEPOINT     'wtpt'</span>
<a name="l00048"></a><a class="code" href="../../d2/d9/ps2_8c.html#a22">00048</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_AToB0               'A2B0'</span>
<a name="l00049"></a><a class="code" href="../../d2/d9/ps2_8c.html#a23">00049</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_AToB1               'A2B1'</span>
<a name="l00050"></a><a class="code" href="../../d2/d9/ps2_8c.html#a24">00050</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_AToB2               'A2B2'</span>
<a name="l00051"></a><a class="code" href="../../d2/d9/ps2_8c.html#a25">00051</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_PS2INTENT0          'psi0'</span>
<a name="l00052"></a><a class="code" href="../../d2/d9/ps2_8c.html#a26">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_PS2INTENT1          'psi1'</span>
<a name="l00053"></a><a class="code" href="../../d2/d9/ps2_8c.html#a27">00053</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_PS2INTENT2          'psi2'</span>
<a name="l00054"></a><a class="code" href="../../d2/d9/ps2_8c.html#a28">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_PS2INTENT3          'psi3'</span>
<a name="l00055"></a><a class="code" href="../../d2/d9/ps2_8c.html#a29">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_CRDINTENT0          'psd0'</span>
<a name="l00056"></a><a class="code" href="../../d2/d9/ps2_8c.html#a30">00056</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_CRDINTENT1          'psd1'</span>
<a name="l00057"></a><a class="code" href="../../d2/d9/ps2_8c.html#a31">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_CRDINTENT2          'psd2'</span>
<a name="l00058"></a><a class="code" href="../../d2/d9/ps2_8c.html#a32">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_CRDINTENT3          'psd3'</span>
<a name="l00059"></a><a class="code" href="../../d2/d9/ps2_8c.html#a33">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_BToA0               'B2A0'</span>
<a name="l00060"></a><a class="code" href="../../d2/d9/ps2_8c.html#a34">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_BToA1               'B2A1'</span>
<a name="l00061"></a><a class="code" href="../../d2/d9/ps2_8c.html#a35">00061</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_BToA2               'B2A2'</span>
<a name="l00062"></a><a class="code" href="../../d2/d9/ps2_8c.html#a36">00062</a> <span class="preprocessor"></span><span class="preprocessor">#define TAG_BToA3               'B2A3'</span>
00063 <span class="preprocessor"></span>
<a name="l00064"></a><a class="code" href="../../d2/d9/ps2_8c.html#a37">00064</a> <span class="preprocessor">#define LUT8_TYPE               'mft1'</span>
<a name="l00065"></a><a class="code" href="../../d2/d9/ps2_8c.html#a38">00065</a> <span class="preprocessor"></span><span class="preprocessor">#define LUT16_TYPE              'mft2'</span>
00066 <span class="preprocessor"></span>
<a name="l00067"></a><a class="code" href="../../d2/d9/ps2_8c.html#a39">00067</a> <span class="preprocessor">#define SIG_CURVE_TYPE          'curv'</span>
00068 <span class="preprocessor"></span>
<a name="l00069"></a><a class="code" href="../../d2/d9/ps2_8c.html#a40">00069</a> <span class="preprocessor">#define GetCPConnSpace(pProfile)     (FIX_ENDIAN(((PPROFILEHEADER)pProfile)-&gt;phConnectionSpace))</span>
<a name="l00070"></a><a class="code" href="../../d2/d9/ps2_8c.html#a41">00070</a> <span class="preprocessor"></span><span class="preprocessor">#define GetCPDevSpace(pProfile)      (FIX_ENDIAN(((PPROFILEHEADER)pProfile)-&gt;phDataColorSpace))</span>
<a name="l00071"></a><a class="code" href="../../d2/d9/ps2_8c.html#a42">00071</a> <span class="preprocessor"></span><span class="preprocessor">#define GetCPRenderIntent(pProfile)  (FIX_ENDIAN(((PPROFILEHEADER)pProfile)-&gt;phRenderingIntent))</span>
<a name="l00072"></a><a class="code" href="../../d2/d9/ps2_8c.html#a43">00072</a> <span class="preprocessor"></span><span class="preprocessor">#define WriteObject(pBuf, pStr)      (STRCPY(pBuf, pStr), STRLEN(pStr))</span>
00073 <span class="preprocessor"></span>
00074 <span class="preprocessor">#ifdef KERNEL_MODE</span>
00075 <span class="preprocessor"></span><span class="preprocessor">#define WriteInt(pBuf, i)            OPSprintf(pBuf, "%l ", (i))</span>
00076 <span class="preprocessor"></span><span class="preprocessor">#define WriteHex(pBuf, x)            OPSprintf(pBuf, "%x", ((x) &amp; 0x00FF))</span>
00077 <span class="preprocessor"></span><span class="preprocessor">#define STRLEN                       strlen</span>
00078 <span class="preprocessor"></span><span class="preprocessor">#define STRCPY                       strcpy</span>
00079 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00080"></a><a class="code" href="../../d2/d9/ps2_8c.html#a44">00080</a> <span class="preprocessor"></span><span class="preprocessor">#define WriteInt(pBuf, i)            wsprintfA(pBuf, "%lu ", (i))</span>
<a name="l00081"></a><a class="code" href="../../d2/d9/ps2_8c.html#a45">00081</a> <span class="preprocessor"></span><span class="preprocessor">#define WriteHex(pBuf, x)            wsprintfA(pBuf, "%2.2x", ((x) &amp; 0x00FF))</span>
<a name="l00082"></a><a class="code" href="../../d2/d9/ps2_8c.html#a46">00082</a> <span class="preprocessor"></span><span class="preprocessor">#define STRLEN                       lstrlenA</span>
<a name="l00083"></a><a class="code" href="../../d2/d9/ps2_8c.html#a47">00083</a> <span class="preprocessor"></span><span class="preprocessor">#define STRCPY                       lstrcpyA</span>
00084 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00085 <span class="preprocessor"></span>
<a name="l00086"></a><a class="code" href="../../d2/d9/ps2_8c.html#a48">00086</a> <span class="preprocessor">#define MAXCHANNELS             4</span>
<a name="l00087"></a><a class="code" href="../../d2/d9/ps2_8c.html#a49">00087</a> <span class="preprocessor"></span><span class="preprocessor">#define PREVIEWCRDGRID          16</span>
<a name="l00088"></a><a class="code" href="../../d2/d9/ps2_8c.html#a50">00088</a> <span class="preprocessor"></span><span class="preprocessor">#define MAXCOLOR8               255</span>
00089 <span class="preprocessor"></span>
<a name="l00090"></a><a class="code" href="../../d2/d9/ps2_8c.html#a51">00090</a> <span class="preprocessor">#define DATATYPE_LUT            0</span>
<a name="l00091"></a><a class="code" href="../../d2/d9/ps2_8c.html#a52">00091</a> <span class="preprocessor"></span><span class="preprocessor">#define DATATYPE_MATRIX         1</span>
00092 <span class="preprocessor"></span>
<a name="l00093"></a><a class="code" href="../../d2/d9/ps2_8c.html#a53">00093</a> <span class="preprocessor">#define sRGB_CRC                0xa3d777b4L</span>
<a name="l00094"></a><a class="code" href="../../d2/d9/ps2_8c.html#a54">00094</a> <span class="preprocessor"></span><span class="preprocessor">#define sRGB_TAGSIZE            6168</span>
00095 <span class="preprocessor"></span>
00096 <span class="comment">//</span>
00097 <span class="comment">// Local typedefs</span>
00098 <span class="comment">//</span>
00099 
<a name="l00100"></a><a class="code" href="../../d2/d9/ps2_8c.html#a56">00100</a> <span class="keyword">typedef</span> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>, *<a class="code" href="../../d2/d9/ps2_8c.html#a56">PFIX_16_16</a>;
00101 
<a name="l00102"></a><a class="code" href="../../d1/d2/structtagCURVETYPE.html">00102</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d1/d2/structtagCURVETYPE.html">tagCURVETYPE</a> {
<a name="l00103"></a><a class="code" href="../../d1/d2/structtagCURVETYPE.html#o0">00103</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d1/d2/structtagCURVETYPE.html#o0">dwSignature</a>;
<a name="l00104"></a><a class="code" href="../../d1/d2/structtagCURVETYPE.html#o1">00104</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d1/d2/structtagCURVETYPE.html#o1">dwReserved</a>;
<a name="l00105"></a><a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">00105</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>;
<a name="l00106"></a><a class="code" href="../../d1/d2/structtagCURVETYPE.html#o3">00106</a>     WORD  <a class="code" href="../../d1/d2/structtagCURVETYPE.html#o3">data</a>[0];
00107 } <a class="code" href="../../d1/d2/structtagCURVETYPE.html">CURVETYPE</a>, *<a class="code" href="../../d1/d2/structtagCURVETYPE.html">PCURVETYPE</a>;
00108 
<a name="l00109"></a><a class="code" href="../../d2/d0/structtagXYZTYPE.html">00109</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d2/d0/structtagXYZTYPE.html">tagXYZTYPE</a> {
<a name="l00110"></a><a class="code" href="../../d2/d0/structtagXYZTYPE.html#o0">00110</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     <a class="code" href="../../d2/d0/structtagXYZTYPE.html#o0">dwSignature</a>;
<a name="l00111"></a><a class="code" href="../../d2/d0/structtagXYZTYPE.html#o1">00111</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     <a class="code" href="../../d2/d0/structtagXYZTYPE.html#o1">dwReserved</a>;
<a name="l00112"></a><a class="code" href="../../d2/d0/structtagXYZTYPE.html#o2">00112</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d2/d0/structtagXYZTYPE.html#o2">afxData</a>[0];
00113 } <a class="code" href="../../d2/d0/structtagXYZTYPE.html">XYZTYPE</a>, *<a class="code" href="../../d2/d0/structtagXYZTYPE.html">PXYZTYPE</a>;
00114 
<a name="l00115"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html">00115</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d4/d0/structtagLUT8TYPE.html">tagLUT8TYPE</a> {
<a name="l00116"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o0">00116</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o0">dwSignature</a>;
<a name="l00117"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o1">00117</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o1">dwReserved</a>;
<a name="l00118"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o2">00118</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>      <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o2">nInputChannels</a>;
<a name="l00119"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o3">00119</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>      <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o3">nOutputChannels</a>;
<a name="l00120"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o4">00120</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>      <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o4">nClutPoints</a>;
<a name="l00121"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o5">00121</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>      <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o5">padding</a>;
<a name="l00122"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o6">00122</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o6">e00</a>;
<a name="l00123"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o7">00123</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o7">e01</a>;
<a name="l00124"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o8">00124</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o8">e02</a>;
<a name="l00125"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o9">00125</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o9">e10</a>;
<a name="l00126"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o10">00126</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o10">e11</a>;
<a name="l00127"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o11">00127</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o11">e12</a>;
<a name="l00128"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o12">00128</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o12">e20</a>;
<a name="l00129"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o13">00129</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o13">e21</a>;
<a name="l00130"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o14">00130</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o14">e22</a>;
<a name="l00131"></a><a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o15">00131</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>      <a class="code" href="../../d4/d0/structtagLUT8TYPE.html#o15">data</a>[0];
00132 } <a class="code" href="../../d4/d0/structtagLUT8TYPE.html">LUT8TYPE</a>, *<a class="code" href="../../d4/d0/structtagLUT8TYPE.html">PLUT8TYPE</a>;
00133 
<a name="l00134"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html">00134</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d0/structtagLUT16TYPE.html">tagLUT16TYPE</a> {
<a name="l00135"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o0">00135</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o0">dwSignature</a>;
<a name="l00136"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o1">00136</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o1">dwReserved</a>;
<a name="l00137"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o2">00137</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>      <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o2">nInputChannels</a>;
<a name="l00138"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o3">00138</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>      <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o3">nOutputChannels</a>;
<a name="l00139"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o4">00139</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>      <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o4">nClutPoints</a>;
<a name="l00140"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o5">00140</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>      <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o5">padding</a>;
<a name="l00141"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o6">00141</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o6">e00</a>;
<a name="l00142"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o7">00142</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o7">e01</a>;
<a name="l00143"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o8">00143</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o8">e02</a>;
<a name="l00144"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o9">00144</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o9">e10</a>;
<a name="l00145"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o10">00145</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o10">e11</a>;
<a name="l00146"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o11">00146</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o11">e12</a>;
<a name="l00147"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o12">00147</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o12">e20</a>;
<a name="l00148"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o13">00148</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o13">e21</a>;
<a name="l00149"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o14">00149</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o14">e22</a>;
<a name="l00150"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o15">00150</a>     WORD      <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o15">wInputEntries</a>;
<a name="l00151"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o16">00151</a>     WORD      <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o16">wOutputEntries</a>;
<a name="l00152"></a><a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o17">00152</a>     WORD      <a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o17">data</a>[0];
00153 } <a class="code" href="../../d3/d0/structtagLUT16TYPE.html">LUT16TYPE</a>, *<a class="code" href="../../d3/d0/structtagLUT16TYPE.html">PLUT16TYPE</a>;
00154 
00155 <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d7/d6/structtagHOSTCLUT.html">tagHOSTCLUT</a> {
<a name="l00156"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o18">00156</a>     WORD        <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o18">wSize</a>;
<a name="l00157"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o19">00157</a>     WORD        <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o19">wDataType</a>;
<a name="l00158"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o20">00158</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o20">dwDev</a>;
<a name="l00159"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o21">00159</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o21">dwPCS</a>;
<a name="l00160"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o22">00160</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o22">dwIntent</a>;
<a name="l00161"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o23">00161</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>   <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o23">afxIlluminantWP</a>[3];
<a name="l00162"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o24">00162</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>   <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o24">afxMediaWP</a>[3];
<a name="l00163"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o25">00163</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>        <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o25">nInputCh</a>;
<a name="l00164"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o26">00164</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>        <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o26">nOutputCh</a>;
<a name="l00165"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o27">00165</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>        <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o27">nClutPoints</a>;
<a name="l00166"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o28">00166</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>        <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o28">nLutBits</a>;
<a name="l00167"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o29">00167</a>     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>   <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o11">e</a>[9];
<a name="l00168"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o30">00168</a>     WORD        <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o30">nInputEntries</a>;
<a name="l00169"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o31">00169</a>     WORD        <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o31">nOutputEntries</a>;
<a name="l00170"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o32">00170</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>       <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o14">inputArray</a>[<a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a0">MAXCHANNELS</a>];
<a name="l00171"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o33">00171</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>       <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o15">outputArray</a>[<a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a0">MAXCHANNELS</a>];
<a name="l00172"></a><a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o34">00172</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>       <a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o16">clut</a>;
00173 } <a class="code" href="../../d7/d6/structtagHOSTCLUT.html">HOSTCLUT</a>, *<a class="code" href="../../d7/d6/structtagHOSTCLUT.html">PHOSTCLUT</a>;
00174 
00175 <span class="comment">//</span>
00176 <span class="comment">// Internal functions</span>
00177 <span class="comment">//</span>
00178 
00179 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a181">IsSRGBColorProfile</a>(PBYTE);
00180 
00181 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a182">GetCSAFromProfile</a> (PBYTE, DWORD, DWORD, PBYTE, PDWORD, PBOOL);
00182 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a183">GetPS2CSA_MONO_A</a>(PBYTE, PBYTE, PDWORD, DWORD, PBOOL);
00183 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a184">GetPS2CSA_ABC</a>(PBYTE, PBYTE, PDWORD, DWORD, PBOOL, BOOL);
00184 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a185">GetPS2CSA_ABC_Lab</a>(PBYTE, PBYTE, PDWORD, DWORD, PBOOL);
00185 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a186">GetPS2CSA_DEFG</a>(PBYTE, PBYTE, PDWORD, DWORD, DWORD, PBOOL);
00186 
00187 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a187">CreateMonoCRD</a>(PBYTE, DWORD, PBYTE, PDWORD, DWORD);
00188 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a188">CreateLutCRD</a>(PBYTE, DWORD, PBYTE, PDWORD, DWORD, BOOL);
00189 
00190 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(PBYTE, DWORD, PDWORD);
00191 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a190">DoesTRCAndColorantTagExist</a>(PBYTE);
00192 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(PBYTE, PFIX_16_16);
00193 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a192">GetCPMediaWhitePoint</a>(PBYTE, PFIX_16_16);
00194 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(PBYTE, DWORD, PDWORD);
00195 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a194">GetCPElementSize</a>(PBYTE, DWORD, PDWORD);
00196 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a195">GetCPElementDataType</a>(PBYTE, DWORD, PDWORD);
00197 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(PBYTE, DWORD, PBYTE, PDWORD);
00198 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a197">GetTRCElementSize</a>(PBYTE, DWORD, PDWORD, PDWORD);
00199 
00200 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a198">Ascii85Encode</a>(PBYTE, DWORD, DWORD);
00201 
00202 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a199">GetCRDInputOutputArraySize</a>(PBYTE, DWORD, PDWORD, PDWORD, PDWORD, PDWORD);
00203 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a200">GetHostCSA</a>(PBYTE, PBYTE, PDWORD, DWORD, DWORD);
00204 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a201">GetHostColorRenderingDictionary</a>(PBYTE, DWORD, PBYTE, PDWORD);
00205 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a202">GetHostColorSpaceArray</a>(PBYTE, DWORD, PBYTE, PDWORD);
00206 
00207 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a203">SendCRDBWPoint</a>(PBYTE, PFIX_16_16);
00208 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a204">SendCRDPQR</a>(PBYTE, DWORD, PFIX_16_16);
00209 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a205">SendCRDLMN</a>(PBYTE, DWORD, PFIX_16_16, PFIX_16_16, DWORD);
00210 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a206">SendCRDABC</a>(PBYTE, PBYTE, DWORD, DWORD, PBYTE, PFIX_16_16, DWORD, BOOL);
00211 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a207">SendCRDOutputTable</a>(PBYTE, PBYTE, DWORD, DWORD, BOOL, BOOL);
00212 
00213 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a208">SendCSABWPoint</a>(PBYTE, DWORD, PFIX_16_16, PFIX_16_16);
00214 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a209">GetMediaWP</a>(PBYTE, DWORD, PFIX_16_16, PFIX_16_16);
00215 
00216 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a210">CreateCRDRevArray</a>(PBYTE, PBYTE, PCURVETYPE, PWORD, DWORD, BOOL);
00217 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a211">SendCRDRevArray</a>(PBYTE, PBYTE, PCURVETYPE, DWORD, BOOL);
00218 
00219 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a212">CreateColSpArray</a>(PBYTE, PBYTE, DWORD, BOOL);
00220 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a213">CreateColSpProc</a>(PBYTE, PBYTE, DWORD, BOOL);
00221 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a214">CreateFloatString</a>(PBYTE, PBYTE, DWORD);
00222 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a215">CreateInputArray</a>(PBYTE, DWORD, DWORD, PBYTE, DWORD, PBYTE, BOOL, PBYTE);
00223 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a216">CreateOutputArray</a>(PBYTE, DWORD, DWORD, DWORD, PBYTE, DWORD, PBYTE, BOOL, PBYTE);
00224 
00225 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a217">GetPublicArrayName</a>(DWORD, PBYTE);
00226 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a218">GetRevCurve</a>(PCURVETYPE, PWORD, PWORD);
00227 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a219">GetCLUTInfo</a>(DWORD, PBYTE, PDWORD, PDWORD, PDWORD, PDWORD, PDWORD, PDWORD);
00228 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a220">EnableGlobalDict</a>(PBYTE);
00229 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a221">BeginGlobalDict</a>(PBYTE);
00230 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a222">EndGlobalDict</a>(PBYTE);
00231 
00232 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(PBYTE, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
00233 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a224">WriteHNAToken</a>(PBYTE, BYTE, DWORD);
00234 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a225">WriteIntStringU2S</a>(PBYTE, PBYTE, DWORD);
00235 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a226">WriteIntStringU2S_L</a>(PBYTE, PBYTE, DWORD);
00236 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a227">WriteHexBuffer</a>(PBYTE, PBYTE, PBYTE, DWORD);
00237 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a228">WriteStringToken</a>(PBYTE, BYTE, DWORD);
00238 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a229">WriteByteString</a>(PBYTE, PBYTE, DWORD);
00239 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a230">WriteInt2ByteString</a>(PBYTE, PBYTE, DWORD);
00240 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(PBYTE, FIX_16_16);
00241 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a232">WriteFixed2dot30</a>(PBYTE, DWORD);
00242 <span class="preprocessor">#if !defined(KERNEL_MODE) || defined(USERMODE_DRIVER)</span>
00243 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a233">WriteDouble</a>(PBYTE, <span class="keywordtype">double</span>);
00244 
00245 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a234">CreateMatrixCRD</a>(PBYTE, PBYTE, PDWORD, DWORD, BOOL);
00246 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a235">CreateHostLutCRD</a>(PBYTE, DWORD, PBYTE, DWORD);
00247 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a236">CreateHostMatrixCSAorCRD</a>(PBYTE, PBYTE, PDWORD, DWORD, BOOL);
00248 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a237">CreateHostInputOutputArray</a>(PBYTE, PBYTE*, DWORD, DWORD, DWORD, DWORD, PBYTE);
00249 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a238">CreateHostTRCInputTable</a>(PBYTE, PHOSTCLUT, PCURVETYPE, PCURVETYPE, PCURVETYPE);
00250 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a239">CreateHostRevTRCInputTable</a>(PBYTE, PHOSTCLUT, PCURVETYPE, PCURVETYPE, PCURVETYPE);
00251 
00252 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a240">CheckInputOutputTable</a>(PHOSTCLUT, <span class="keywordtype">float</span>*, BOOL, BOOL);
00253 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a241">CheckColorLookupTable</a>(PHOSTCLUT, <span class="keywordtype">float</span>*);
00254 
00255 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a242">DoHostConversionCSA</a>(PHOSTCLUT, <span class="keywordtype">float</span>*, <span class="keywordtype">float</span>*);
00256 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a243">DoHostConversionCRD</a>(PHOSTCLUT, PHOSTCLUT, <span class="keywordtype">float</span>*, <span class="keywordtype">float</span>*, BOOL);
00257 
00258 <span class="keywordtype">float</span> <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a>(<span class="keywordtype">float</span>);
00259 <span class="keywordtype">float</span> <a class="code" href="../../d2/d9/ps2_8c.html#a245">inverse_g</a>(<span class="keywordtype">float</span>);
00260 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a246">TableInterp3</a>(PHOSTCLUT, <span class="keywordtype">float</span>*);
00261 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a247">TableInterp4</a>(PHOSTCLUT, <span class="keywordtype">float</span>*);
00262 <span class="keywordtype">void</span>  <a class="code" href="../../d2/d9/ps2_8c.html#a248">LabToXYZ</a>(<span class="keywordtype">float</span>*, <span class="keywordtype">float</span>*, PFIX_16_16);
00263 <span class="keywordtype">void</span>  <a class="code" href="../../d2/d9/ps2_8c.html#a249">XYZToLab</a>(<span class="keywordtype">float</span>*, <span class="keywordtype">float</span>*, PFIX_16_16);
00264 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a250">ApplyMatrix</a>(FIX_16_16 *e, <span class="keywordtype">float</span> *Input, <span class="keywordtype">float</span> *Output);
00265 
00266 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a251">CreateColorantArray</a>(PBYTE, <span class="keywordtype">double</span> *, DWORD);
00267 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a252">InvertColorantArray</a>(<span class="keywordtype">double</span> *, <span class="keywordtype">double</span> *);
00268 <span class="preprocessor">#endif</span>
00269 <span class="preprocessor"></span>
00270 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a253">crc32</a>(PBYTE buff, DWORD length);
00271 
00272 <span class="comment">//</span>
00273 <span class="comment">// Global variables</span>
00274 <span class="comment">//</span>
00275 
<a name="l00276"></a><a class="code" href="../../d2/d9/ps2_8c.html#a67">00276</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d2/d9/ps2_8c.html#a67">ASCII85DecodeBegin</a>[] = <span class="stringliteral">"&lt;~"</span>;
<a name="l00277"></a><a class="code" href="../../d2/d9/ps2_8c.html#a68">00277</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d2/d9/ps2_8c.html#a68">ASCII85DecodeEnd</a>[]   = <span class="stringliteral">"~&gt; cvx exec "</span>;
<a name="l00278"></a><a class="code" href="../../d2/d9/ps2_8c.html#a69">00278</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a85">TestingDEFG</a>[]       = <span class="stringliteral">"/SupportDEFG? {/CIEBasedDEFG \</span>
00279 <span class="stringliteral"> /ColorSpaceFamily resourcestatus { pop pop languagelevel 3 ge}{false} ifelse} def"</span>;
<a name="l00280"></a><a class="code" href="../../d2/d9/ps2_8c.html#a70">00280</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a86">SupportDEFG_S</a>[]     = <span class="stringliteral">"SupportDEFG? { "</span>;
<a name="l00281"></a><a class="code" href="../../d2/d9/ps2_8c.html#a71">00281</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a87">NotSupportDEFG_S</a>[]  = <span class="stringliteral">"SupportDEFG? not { "</span>;
<a name="l00282"></a><a class="code" href="../../d2/d9/ps2_8c.html#a72">00282</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a88">SupportDEFG_E</a>[]     = <span class="stringliteral">"}if "</span>;
<a name="l00283"></a><a class="code" href="../../d2/d9/ps2_8c.html#a73">00283</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a83">IndexArray16b</a>[]     = <span class="stringliteral">" dup length 1 sub 3 -1 roll mul dup dup floor cvi\</span>
00284 <span class="stringliteral"> exch ceiling cvi 3 index exch get 32768 add 4 -1 roll 3 -1 roll get 32768 add\</span>
00285 <span class="stringliteral"> dup 3 1 roll sub 3 -1 roll dup floor cvi sub mul add "</span>;
00286 
<a name="l00287"></a><a class="code" href="../../d2/d9/ps2_8c.html#a74">00287</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>[]        = <span class="stringliteral">" dup length 1 sub 3 -1 roll mul dup dup floor cvi\</span>
00288 <span class="stringliteral"> exch ceiling cvi 3 index exch get 4 -1 roll 3 -1 roll get\</span>
00289 <span class="stringliteral"> dup 3 1 roll sub 3 -1 roll dup floor cvi sub mul add "</span>;
<a name="l00290"></a><a class="code" href="../../d2/d9/ps2_8c.html#a75">00290</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a89">StartClip</a>[]         = <span class="stringliteral">"dup 1.0 le{dup 0.0 ge{"</span> ;
<a name="l00291"></a><a class="code" href="../../d2/d9/ps2_8c.html#a76">00291</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a90">EndClip</a>[]           = <span class="stringliteral">"}if}if "</span> ;
<a name="l00292"></a><a class="code" href="../../d2/d9/ps2_8c.html#a77">00292</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a2">BeginString</a>[]       = <span class="stringliteral">"&lt;"</span>;
<a name="l00293"></a><a class="code" href="../../d2/d9/ps2_8c.html#a78">00293</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a3">EndString</a>[]         = <span class="stringliteral">"&gt;"</span>;
<a name="l00294"></a><a class="code" href="../../d2/d9/ps2_8c.html#a79">00294</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>[]        = <span class="stringliteral">"["</span>;
<a name="l00295"></a><a class="code" href="../../d2/d9/ps2_8c.html#a80">00295</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>[]          = <span class="stringliteral">"]"</span>;
<a name="l00296"></a><a class="code" href="../../d2/d9/ps2_8c.html#a81">00296</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>[]     = <span class="stringliteral">"{"</span>;
<a name="l00297"></a><a class="code" href="../../d2/d9/ps2_8c.html#a82">00297</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>[]       = <span class="stringliteral">"}bind "</span>;
<a name="l00298"></a><a class="code" href="../../d2/d9/ps2_8c.html#a83">00298</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a8">BeginDict</a>[]         = <span class="stringliteral">"&lt;&lt;"</span> ;
<a name="l00299"></a><a class="code" href="../../d2/d9/ps2_8c.html#a84">00299</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a9">EndDict</a>[]           = <span class="stringliteral">"&gt;&gt;"</span> ;
<a name="l00300"></a><a class="code" href="../../d2/d9/ps2_8c.html#a85">00300</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a10">BlackPoint</a>[]        = <span class="stringliteral">"[0 0 0]"</span> ;
<a name="l00301"></a><a class="code" href="../../d2/d9/ps2_8c.html#a86">00301</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a11">DictType</a>[]          = <span class="stringliteral">"/ColorRenderingType 1 "</span>;
<a name="l00302"></a><a class="code" href="../../d2/d9/ps2_8c.html#a87">00302</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>[]        = <span class="stringliteral">"/RenderingIntent "</span>;
<a name="l00303"></a><a class="code" href="../../d2/d9/ps2_8c.html#a88">00303</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a13">IntentPer</a>[]         = <span class="stringliteral">"/Perceptual"</span>;
<a name="l00304"></a><a class="code" href="../../d2/d9/ps2_8c.html#a89">00304</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a14">IntentSat</a>[]         = <span class="stringliteral">"/Saturation"</span>;
<a name="l00305"></a><a class="code" href="../../d2/d9/ps2_8c.html#a90">00305</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a15">IntentACol</a>[]        = <span class="stringliteral">"/AbsoluteColorimetric"</span>;
<a name="l00306"></a><a class="code" href="../../d2/d9/ps2_8c.html#a91">00306</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a16">IntentRCol</a>[]        = <span class="stringliteral">"/RelativeColorimetric"</span>;
00307 
<a name="l00308"></a><a class="code" href="../../d2/d9/ps2_8c.html#a92">00308</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a17">WhitePointTag</a>[]     = <span class="stringliteral">"/WhitePoint "</span> ;
<a name="l00309"></a><a class="code" href="../../d2/d9/ps2_8c.html#a93">00309</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a18">BlackPointTag</a>[]     = <span class="stringliteral">"/BlackPoint "</span> ;
<a name="l00310"></a><a class="code" href="../../d2/d9/ps2_8c.html#a94">00310</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a19">RangePQRTag</a>[]       = <span class="stringliteral">"/RangePQR "</span> ;
<a name="l00311"></a><a class="code" href="../../d2/d9/ps2_8c.html#a95">00311</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a20">TransformPQRTag</a>[]   = <span class="stringliteral">"/TransformPQR "</span> ;
<a name="l00312"></a><a class="code" href="../../d2/d9/ps2_8c.html#a96">00312</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a21">MatrixPQRTag</a>[]      = <span class="stringliteral">"/MatrixPQR "</span> ;
<a name="l00313"></a><a class="code" href="../../d2/d9/ps2_8c.html#a97">00313</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a106">RangePQR</a>[]          = <span class="stringliteral">"[ -0.07 2.2 -0.02 1.4 -0.2 4.8 ]"</span>;
<a name="l00314"></a><a class="code" href="../../d2/d9/ps2_8c.html#a98">00314</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a107">MatrixPQR</a>[]         = <span class="stringliteral">"[0.8951 -0.7502 0.0389 0.2664 1.7135 -0.0685 -0.1614 0.0367 1.0296]"</span>;
00315 <span class="preprocessor">#ifdef BARDFORD_TRANSFORM</span>
00316 <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a108">TransformPQR</a>[3]    = {<span class="stringliteral">"exch pop exch 3 get mul exch pop exch 3 get div "</span>,
00317                                    <span class="stringliteral">"exch pop exch 4 get mul exch pop exch 4 get div "</span>,
00318                                    <span class="stringliteral">"exch pop exch 5 get mul exch pop exch 5 get div "</span> };
00319 <span class="preprocessor">#else</span>
<a name="l00320"></a><a class="code" href="../../d2/d9/ps2_8c.html#a99">00320</a> <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a108">TransformPQR</a>[3]    = {<span class="stringliteral">"4 index 0 get div 2 index 0 get mul 4 {exch pop} repeat "</span>,
00321                                    <span class="stringliteral">"4 index 1 get div 2 index 1 get mul 4 {exch pop} repeat "</span>,
00322                                    <span class="stringliteral">"4 index 2 get div 2 index 2 get mul 4 {exch pop} repeat "</span> };
00323 <span class="preprocessor">#endif</span>
<a name="l00324"></a><a class="code" href="../../d2/d9/ps2_8c.html#a100">00324</a> <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a22">RangeABCTag</a>[]       = <span class="stringliteral">"/RangeABC "</span> ;
<a name="l00325"></a><a class="code" href="../../d2/d9/ps2_8c.html#a101">00325</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a23">MatrixATag</a>[]        = <span class="stringliteral">"/MatrixA "</span>;
<a name="l00326"></a><a class="code" href="../../d2/d9/ps2_8c.html#a102">00326</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a24">MatrixABCTag</a>[]      = <span class="stringliteral">"/MatrixABC "</span>;
<a name="l00327"></a><a class="code" href="../../d2/d9/ps2_8c.html#a103">00327</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a25">EncodeABCTag</a>[]      = <span class="stringliteral">"/EncodeABC "</span> ;
<a name="l00328"></a><a class="code" href="../../d2/d9/ps2_8c.html#a104">00328</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a26">RangeLMNTag</a>[]       = <span class="stringliteral">"/RangeLMN "</span> ;
<a name="l00329"></a><a class="code" href="../../d2/d9/ps2_8c.html#a105">00329</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a27">MatrixLMNTag</a>[]      = <span class="stringliteral">"/MatrixLMN "</span> ;
<a name="l00330"></a><a class="code" href="../../d2/d9/ps2_8c.html#a106">00330</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a28">EncodeLMNTag</a>[]      = <span class="stringliteral">"/EncodeLMN "</span> ;
<a name="l00331"></a><a class="code" href="../../d2/d9/ps2_8c.html#a107">00331</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a29">RenderTableTag</a>[]    = <span class="stringliteral">"/RenderTable "</span> ;
<a name="l00332"></a><a class="code" href="../../d2/d9/ps2_8c.html#a108">00332</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a30">CIEBasedATag</a>[]      = <span class="stringliteral">"/CIEBasedA "</span> ;
<a name="l00333"></a><a class="code" href="../../d2/d9/ps2_8c.html#a109">00333</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a31">CIEBasedABCTag</a>[]    = <span class="stringliteral">"/CIEBasedABC "</span> ;
<a name="l00334"></a><a class="code" href="../../d2/d9/ps2_8c.html#a110">00334</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a32">CIEBasedDEFGTag</a>[]   = <span class="stringliteral">"/CIEBasedDEFG "</span> ;
<a name="l00335"></a><a class="code" href="../../d2/d9/ps2_8c.html#a111">00335</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a33">CIEBasedDEFTag</a>[]    = <span class="stringliteral">"/CIEBasedDEF "</span> ;
<a name="l00336"></a><a class="code" href="../../d2/d9/ps2_8c.html#a112">00336</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a34">DecodeATag</a>[]        = <span class="stringliteral">"/DecodeA "</span> ;
<a name="l00337"></a><a class="code" href="../../d2/d9/ps2_8c.html#a113">00337</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a35">DecodeABCTag</a>[]      = <span class="stringliteral">"/DecodeABC "</span> ;
<a name="l00338"></a><a class="code" href="../../d2/d9/ps2_8c.html#a114">00338</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a36">DecodeLMNTag</a>[]      = <span class="stringliteral">"/DecodeLMN "</span> ;
<a name="l00339"></a><a class="code" href="../../d2/d9/ps2_8c.html#a115">00339</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a37">DeviceRGBTag</a>[]      = <span class="stringliteral">"/DeviceRGB "</span> ;
<a name="l00340"></a><a class="code" href="../../d2/d9/ps2_8c.html#a116">00340</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a38">DeviceCMYKTag</a>[]     = <span class="stringliteral">"/DeviceCMYK "</span> ;
<a name="l00341"></a><a class="code" href="../../d2/d9/ps2_8c.html#a117">00341</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a39">DeviceGrayTag</a>[]     = <span class="stringliteral">"/DeviceGray "</span> ;
<a name="l00342"></a><a class="code" href="../../d2/d9/ps2_8c.html#a118">00342</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a40">TableTag</a>[]          = <span class="stringliteral">"/Table "</span> ;
<a name="l00343"></a><a class="code" href="../../d2/d9/ps2_8c.html#a119">00343</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a41">DecodeDEFGTag</a>[]     = <span class="stringliteral">"/DecodeDEFG "</span> ;
<a name="l00344"></a><a class="code" href="../../d2/d9/ps2_8c.html#a120">00344</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a42">DecodeDEFTag</a>[]      = <span class="stringliteral">"/DecodeDEF "</span> ;
00345 
<a name="l00346"></a><a class="code" href="../../d2/d9/ps2_8c.html#a121">00346</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a43">NullOp</a>[]            = <span class="stringliteral">""</span>;
<a name="l00347"></a><a class="code" href="../../d2/d9/ps2_8c.html#a122">00347</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a44">DupOp</a>[]             = <span class="stringliteral">"dup "</span>;
<a name="l00348"></a><a class="code" href="../../d2/d9/ps2_8c.html#a123">00348</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a45">UserDictOp</a>[]        = <span class="stringliteral">"userdict "</span>;
<a name="l00349"></a><a class="code" href="../../d2/d9/ps2_8c.html#a124">00349</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a46">GlobalDictOp</a>[]      = <span class="stringliteral">"globaldict "</span>;
<a name="l00350"></a><a class="code" href="../../d2/d9/ps2_8c.html#a125">00350</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a47">CurrentGlobalOp</a>[]   = <span class="stringliteral">"currentglobal "</span>;
<a name="l00351"></a><a class="code" href="../../d2/d9/ps2_8c.html#a126">00351</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a48">SetGlobalOp</a>[]       = <span class="stringliteral">"setglobal "</span>;
<a name="l00352"></a><a class="code" href="../../d2/d9/ps2_8c.html#a127">00352</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a49">DefOp</a>[]             = <span class="stringliteral">"def "</span>;
<a name="l00353"></a><a class="code" href="../../d2/d9/ps2_8c.html#a128">00353</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a50">BeginOp</a>[]           = <span class="stringliteral">"begin "</span>;
<a name="l00354"></a><a class="code" href="../../d2/d9/ps2_8c.html#a129">00354</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a51">EndOp</a>[]             = <span class="stringliteral">"end "</span>;
<a name="l00355"></a><a class="code" href="../../d2/d9/ps2_8c.html#a130">00355</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a52">TrueOp</a>[]            = <span class="stringliteral">"true "</span>;
<a name="l00356"></a><a class="code" href="../../d2/d9/ps2_8c.html#a131">00356</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a53">FalseOp</a>[]           = <span class="stringliteral">"false "</span>;
<a name="l00357"></a><a class="code" href="../../d2/d9/ps2_8c.html#a132">00357</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a54">MulOp</a>[]             = <span class="stringliteral">"mul "</span>;
<a name="l00358"></a><a class="code" href="../../d2/d9/ps2_8c.html#a133">00358</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a55">DivOp</a>[]             = <span class="stringliteral">"div "</span>;
00359 
<a name="l00360"></a><a class="code" href="../../d2/d9/ps2_8c.html#a134">00360</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>[]           = <span class="stringliteral">"\r\n"</span> ;
<a name="l00361"></a><a class="code" href="../../d2/d9/ps2_8c.html#a135">00361</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a57">Slash</a>[]             = <span class="stringliteral">"/"</span> ;
<a name="l00362"></a><a class="code" href="../../d2/d9/ps2_8c.html#a136">00362</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d7/d0/cmdat2_8c.html#a32">Space</a>[]             = <span class="stringliteral">" "</span> ;
<a name="l00363"></a><a class="code" href="../../d2/d9/ps2_8c.html#a137">00363</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a59">CRDBegin</a>[]          = <span class="stringliteral">"%** CRD Begin "</span>;
<a name="l00364"></a><a class="code" href="../../d2/d9/ps2_8c.html#a138">00364</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a60">CRDEnd</a>[]            = <span class="stringliteral">"%** CRD End "</span>;
<a name="l00365"></a><a class="code" href="../../d2/d9/ps2_8c.html#a139">00365</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a61">CieBasedDEFGBegin</a>[] = <span class="stringliteral">"%** CieBasedDEFG CSA Begin "</span>;
<a name="l00366"></a><a class="code" href="../../d2/d9/ps2_8c.html#a140">00366</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a62">CieBasedDEFBegin</a>[]  = <span class="stringliteral">"%** CieBasedDEF CSA Begin "</span>;
<a name="l00367"></a><a class="code" href="../../d2/d9/ps2_8c.html#a141">00367</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a63">CieBasedABCBegin</a>[]  = <span class="stringliteral">"%** CieBasedABC CSA Begin "</span>;
<a name="l00368"></a><a class="code" href="../../d2/d9/ps2_8c.html#a142">00368</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a64">CieBasedABegin</a>[]    = <span class="stringliteral">"%** CieBasedA CSA Begin "</span>;
<a name="l00369"></a><a class="code" href="../../d2/d9/ps2_8c.html#a143">00369</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a65">CieBasedDEFGEnd</a>[]   = <span class="stringliteral">"%** CieBasedDEFG CSA End "</span>;
<a name="l00370"></a><a class="code" href="../../d2/d9/ps2_8c.html#a144">00370</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a66">CieBasedDEFEnd</a>[]    = <span class="stringliteral">"%** CieBasedDEF CSA End "</span>;
<a name="l00371"></a><a class="code" href="../../d2/d9/ps2_8c.html#a145">00371</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a67">CieBasedABCEnd</a>[]    = <span class="stringliteral">"%** CieBasedABC CSA End "</span>;
<a name="l00372"></a><a class="code" href="../../d2/d9/ps2_8c.html#a146">00372</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a68">CieBasedAEnd</a>[]      = <span class="stringliteral">"%** CieBasedA CSA End "</span>;
<a name="l00373"></a><a class="code" href="../../d2/d9/ps2_8c.html#a147">00373</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a69">RangeABC</a>[]          = <span class="stringliteral">"[ 0 1 0 1 0 1 ] "</span>;
<a name="l00374"></a><a class="code" href="../../d2/d9/ps2_8c.html#a148">00374</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a70">RangeLMN</a>[]          = <span class="stringliteral">"[ 0 2 0 2 0 2 ] "</span>;
<a name="l00375"></a><a class="code" href="../../d2/d9/ps2_8c.html#a149">00375</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a71">Identity</a>[]          = <span class="stringliteral">"[1 0 0 0 1 0 0 0 1]"</span>;
<a name="l00376"></a><a class="code" href="../../d2/d9/ps2_8c.html#a150">00376</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a72">RangeABC_Lab</a>[]      = <span class="stringliteral">"[0 100 -128 127 -128 127]"</span>;
<a name="l00377"></a><a class="code" href="../../d2/d9/ps2_8c.html#a151">00377</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a73">Clip01</a>[]            = <span class="stringliteral">"dup 1.0 ge{pop 1.0}{dup 0.0 lt{pop 0.0}if}ifelse "</span> ;
<a name="l00378"></a><a class="code" href="../../d2/d9/ps2_8c.html#a152">00378</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a74">DecodeA3</a>[]          = <span class="stringliteral">"256 div exp "</span>;
<a name="l00379"></a><a class="code" href="../../d2/d9/ps2_8c.html#a153">00379</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a75">DecodeA3Rev</a>[]       = <span class="stringliteral">"256 div 1.0 exch div exp "</span>;
<a name="l00380"></a><a class="code" href="../../d2/d9/ps2_8c.html#a154">00380</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a76">DecodeABCArray</a>[]    = <span class="stringliteral">"DecodeABC_"</span>;
<a name="l00381"></a><a class="code" href="../../d2/d9/ps2_8c.html#a155">00381</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a77">InputArray</a>[]        = <span class="stringliteral">"Inp_"</span>;
<a name="l00382"></a><a class="code" href="../../d2/d9/ps2_8c.html#a156">00382</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a78">OutputArray</a>[]       = <span class="stringliteral">"Out_"</span>;
<a name="l00383"></a><a class="code" href="../../d2/d9/ps2_8c.html#a157">00383</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a91">Scale8</a>[]            = <span class="stringliteral">"255 div "</span> ;
<a name="l00384"></a><a class="code" href="../../d2/d9/ps2_8c.html#a158">00384</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a92">Scale16</a>[]           = <span class="stringliteral">"65535 div "</span> ;
<a name="l00385"></a><a class="code" href="../../d2/d9/ps2_8c.html#a159">00385</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a93">Scale16XYZ</a>[]        = <span class="stringliteral">"32768 div "</span> ;
<a name="l00386"></a><a class="code" href="../../d2/d9/ps2_8c.html#a160">00386</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a94">TFunction8</a>[]        = <span class="stringliteral">"exch 255 mul round cvi get 255 div "</span> ;
<a name="l00387"></a><a class="code" href="../../d2/d9/ps2_8c.html#a161">00387</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a95">TFunction8XYZ</a>[]     = <span class="stringliteral">"exch 255 mul round cvi get 128 div "</span> ;
<a name="l00388"></a><a class="code" href="../../d2/d9/ps2_8c.html#a162">00388</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a96">MatrixABCLab</a>[]      = <span class="stringliteral">"[1 1 1 1 0 0 0 0 -1]"</span> ;
<a name="l00389"></a><a class="code" href="../../d2/d9/ps2_8c.html#a163">00389</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a97">DecodeABCLab1</a>[]     = <span class="stringliteral">"[{16 add 116 div} bind {500 div} bind {200 div} bind]"</span>;
<a name="l00390"></a><a class="code" href="../../d2/d9/ps2_8c.html#a164">00390</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a98">DecodeALab</a>[]        = <span class="stringliteral">" 50 mul 16 add 116 div "</span>;
<a name="l00391"></a><a class="code" href="../../d2/d9/ps2_8c.html#a165">00391</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a99">DecodeLMNLab</a>[]      = <span class="stringliteral">"dup 0.206897 ge{dup dup mul mul}{0.137931 sub 0.128419 mul} ifelse "</span>;
00392 
<a name="l00393"></a><a class="code" href="../../d2/d9/ps2_8c.html#a166">00393</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a100">RangeLMNLab</a>[]       = <span class="stringliteral">"[0 1 0 1 0 1]"</span> ;
<a name="l00394"></a><a class="code" href="../../d2/d9/ps2_8c.html#a167">00394</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a101">EncodeLMNLab</a>[]      = <span class="stringliteral">"dup 0.008856 le{7.787 mul 0.13793 add}{0.3333 exp}ifelse "</span> ;
00395 
<a name="l00396"></a><a class="code" href="../../d2/d9/ps2_8c.html#a168">00396</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a102">MatrixABCLabCRD</a>[]   = <span class="stringliteral">"[0 500 0 116 -500 200 0 0 -200]"</span> ;
<a name="l00397"></a><a class="code" href="../../d2/d9/ps2_8c.html#a169">00397</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a103">MatrixABCXYZCRD</a>[]   = <span class="stringliteral">"[0 1 0 1 0 0 0 0 1]"</span> ;
<a name="l00398"></a><a class="code" href="../../d2/d9/ps2_8c.html#a170">00398</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a104">EncodeABCLab1</a>[]     = <span class="stringliteral">"16 sub 100 div "</span> ;
<a name="l00399"></a><a class="code" href="../../d2/d9/ps2_8c.html#a171">00399</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a105">EncodeABCLab2</a>[]     = <span class="stringliteral">"128 add 255 div "</span> ;
<a name="l00400"></a><a class="code" href="../../d2/d9/ps2_8c.html#a172">00400</a> <span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="../../d2/d9/ps2_8c.html#a172">DecodeABCLab</a>[]     = {<span class="stringliteral">"50 mul 16 add 116 div "</span>,
00401                                    <span class="stringliteral">"128 mul 128 sub 500 div"</span>,
00402                                    <span class="stringliteral">"128 mul 128 sub 200 div"</span>};
00403 
<a name="l00404"></a><a class="code" href="../../d2/d9/ps2_8c.html#a173">00404</a> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d2/d9/ps2_8c.html#a173">ColorSpace1</a>[]        = <span class="stringliteral">"/CIEBasedABC &lt;&lt; /DecodeLMN "</span>;
<a name="l00405"></a><a class="code" href="../../d2/d9/ps2_8c.html#a174">00405</a> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d2/d9/ps2_8c.html#a174">ColorSpace3</a>[]        = <span class="stringliteral">" exp} bind "</span>;
<a name="l00406"></a><a class="code" href="../../d2/d9/ps2_8c.html#a175">00406</a> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d2/d9/ps2_8c.html#a175">ColorSpace5</a>[]        = <span class="stringliteral">"/WhitePoint [0.9642 1 0.8249] "</span>;
00407 
<a name="l00408"></a><a class="code" href="../../d2/d9/ps2_8c.html#a176">00408</a> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a79">PreViewInArray</a>[]     = <span class="stringliteral">"IPV_"</span>;
<a name="l00409"></a><a class="code" href="../../d2/d9/ps2_8c.html#a177">00409</a> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a80">PreViewOutArray</a>[]    = <span class="stringliteral">"OPV_"</span>;
00410 
<a name="l00411"></a><a class="code" href="../../d2/d9/ps2_8c.html#a178">00411</a> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d2/d9/ps2_8c.html#a178">sRGBColorSpaceArray</a>[] = <span class="stringliteral">"[/CIEBasedABC &lt;&lt; \r\n\</span>
00412 <span class="stringliteral">/DecodeLMN [{dup 0.03928 le {12.92321 div}{0.055 add 1.055 div 2.4 exp}ifelse} bind dup dup ] \r\n\</span>
00413 <span class="stringliteral">/MatrixLMN [0.412457 0.212673 0.019334 0.357576 0.715152 0.119192 0.180437 0.072175 0.950301] \r\n\</span>
00414 <span class="stringliteral">/WhitePoint [ 0.9505 1 1.0890 ] &gt;&gt; ]"</span>;
00415 
00416 <span class="preprocessor">#ifdef BRADFORD_TRANSFORM</span>
00417 <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d2/d9/ps2_8c.html#a179">sRGBColorRenderingDictionary</a>[] = <span class="stringliteral">"\</span>
00418 <span class="stringliteral">/RangePQR [ -0.5 2 -0.5 2 -0.5 2 ] \r\n\</span>
00419 <span class="stringliteral">/MatrixPQR [0.8951 -0.7502  0.0389 0.2664  1.7135 -0.0685 -0.1614  0.0367  1.0296] \r\n\</span>
00420 <span class="stringliteral">/TransformPQR [\</span>
00421 <span class="stringliteral">{exch pop exch 3 get mul exch pop exch 3 get div} bind \</span>
00422 <span class="stringliteral">{exch pop exch 4 get mul exch pop exch 4 get div} bind \</span>
00423 <span class="stringliteral">{exch pop exch 5 get mul exch pop exch 5 get div} bind] \r\n\</span>
00424 <span class="stringliteral">/MatrixLMN [3.240449 -0.969265  0.055643 -1.537136  1.876011 -0.204026 -0.498531  0.041556  1.057229] \r\n\</span>
00425 <span class="stringliteral">/EncodeABC [{dup 0.00304 le {12.92321 mul}{1 2.4 div exp 1.055 mul 0.055 sub}ifelse} bind dup dup] \r\n\</span>
00426 <span class="stringliteral">/WhitePoint[0.9505 1 1.0890] &gt;&gt;"</span>;
00427 <span class="preprocessor">#else</span>
<a name="l00428"></a><a class="code" href="../../d2/d9/ps2_8c.html#a179">00428</a> <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d2/d9/ps2_8c.html#a179">sRGBColorRenderingDictionary</a>[] = <span class="stringliteral">"\</span>
00429 <span class="stringliteral">/RangePQR [ -0.5 2 -0.5 2 -0.5 2 ] \r\n\</span>
00430 <span class="stringliteral">/MatrixPQR [0.8951 -0.7502  0.0389 0.2664  1.7135 -0.0685 -0.1614  0.0367  1.0296] \r\n\</span>
00431 <span class="stringliteral">/TransformPQR [\</span>
00432 <span class="stringliteral">{4 index 0 get div 2 index 0 get mul 4 {exch pop} repeat} \</span>
00433 <span class="stringliteral">{4 index 1 get div 2 index 1 get mul 4 {exch pop} repeat} \</span>
00434 <span class="stringliteral">{4 index 2 get div 2 index 2 get mul 4 {exch pop} repeat}] \r\n\</span>
00435 <span class="stringliteral">/MatrixLMN [3.240449 -0.969265  0.055643 -1.537136  1.876011 -0.204026 -0.498531  0.041556  1.057229] \r\n\</span>
00436 <span class="stringliteral">/EncodeABC [{dup 0.00304 le {12.92321 mul}{1 2.4 div exp 1.055 mul 0.055 sub}ifelse} bind dup dup] \r\n\</span>
00437 <span class="stringliteral">/WhitePoint[0.9505 1 1.0890] &gt;&gt;"</span>;
00438 <span class="preprocessor">#endif</span>
00439 <span class="preprocessor"></span>
00440 <span class="comment">/******************************************************************************</span>
00441 <span class="comment"> *</span>
00442 <span class="comment"> *                       InternalGetPS2ColorSpaceArray</span>
00443 <span class="comment"> *</span>
00444 <span class="comment"> *  Function:</span>
00445 <span class="comment"> *       This functions retrieves the PostScript Level 2 CSA from the profile,</span>
00446 <span class="comment"> *       or creates it if the profile tag is not present</span>
00447 <span class="comment"> *</span>
00448 <span class="comment"> *  Arguments:</span>
00449 <span class="comment"> *       hProfile  - handle identifing the profile object</span>
00450 <span class="comment"> *       dwIntent  - rendering intent of CSA</span>
00451 <span class="comment"> *       dwCSAType - type of CSA</span>
00452 <span class="comment"> *       pbuffer   - pointer to receive the CSA</span>
00453 <span class="comment"> *       pcbSize   - pointer to size of buffer. If function fails because</span>
00454 <span class="comment"> *                   buffer is not big enough, it is filled with required size.</span>
00455 <span class="comment"> *       pcbBinary - TRUE if binary data is requested. On return it is set to</span>
00456 <span class="comment"> *                   reflect the data returned</span>
00457 <span class="comment"> *</span>
00458 <span class="comment"> *  Returns:</span>
00459 <span class="comment"> *       TRUE if successful, FALSE otherwise</span>
00460 <span class="comment"> *</span>
00461 <span class="comment"> ******************************************************************************/</span>
00462 
00463 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00464"></a><a class="code" href="../../d2/d9/ps2_8c.html#a254">00464</a> <a class="code" href="../../d2/d9/ps2_8c.html#a254">InternalGetPS2ColorSpaceArray</a> (
00465     PBYTE     pProfile,
00466     DWORD     dwIntent,
00467     DWORD     dwCSAType,
00468     PBYTE     pBuffer,
00469     PDWORD    pcbSize,
00470     LPBOOL    pbBinary
00471     )
00472 {
00473     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwInpBufSize;
00474     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  bRc;
00475 
00476     <span class="comment">//</span>
00477     <span class="comment">// If profile has a CSA tag, get it directly</span>
00478     <span class="comment">//</span>
00479 
00480     bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a182">GetCSAFromProfile</a>(pProfile, dwIntent, dwCSAType, pBuffer,
00481               pcbSize, pbBinary);
00482 
00483     <span class="keywordflow">if</span> (! bRc &amp;&amp; (GetLastError() != ERROR_INSUFFICIENT_BUFFER))
00484     {
00485         <span class="comment">//</span>
00486         <span class="comment">// Create a CSA from the profile data</span>
00487         <span class="comment">//</span>
00488 
00489         <span class="keywordflow">switch</span> (dwCSAType)
00490         {
00491         <span class="keywordflow">case</span> CSA_ABC:
00492             bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a184">GetPS2CSA_ABC</a>(pProfile, pBuffer, pcbSize,
00493                       dwIntent, pbBinary, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00494             <span class="keywordflow">break</span>;
00495 
00496         <span class="keywordflow">case</span> CSA_DEF:
00497             bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a186">GetPS2CSA_DEFG</a>(pProfile, pBuffer, pcbSize, dwIntent,
00498                       <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a0">TYPE_CIEBASEDDEF</a>, pbBinary);
00499             <span class="keywordflow">break</span>;
00500 
00501         <span class="keywordflow">case</span> CSA_RGB:
00502         <span class="keywordflow">case</span> CSA_Lab:
00503 
00504             dwInpBufSize = *pcbSize;
00505 
00506             <span class="comment">//</span>
00507             <span class="comment">// We get a DEF CSA followed by an ABC CSA and set it up so that</span>
00508             <span class="comment">// on PS interpreters that do not support the DEF CSA, the ABC one</span>
00509             <span class="comment">// is active</span>
00510             <span class="comment">//</span>
00511 
00512             bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a186">GetPS2CSA_DEFG</a>(pProfile, pBuffer, pcbSize, dwIntent,
00513                       <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a0">TYPE_CIEBASEDDEF</a>, pbBinary);
00514 
00515             <span class="keywordflow">if</span> (bRc)
00516             {
00517                 <span class="comment">//</span>
00518                 <span class="comment">// Create CieBasedABC for printers that do not support CieBasedDEF</span>
00519                 <span class="comment">//</span>
00520 
00521                 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbNewSize = 0;
00522                 <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pNewBuffer;
00523                 <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pOldBuffer;
00524 
00525                 <span class="keywordflow">if</span> (pBuffer)
00526                 {
00527                     pNewBuffer = pBuffer + *pcbSize;
00528                     pOldBuffer = pNewBuffer;
00529                     pNewBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pNewBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
00530                     <span class="keywordflow">if</span> (dwCSAType == CSA_Lab)
00531                     {
00532                         pNewBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pNewBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a87">NotSupportDEFG_S</a>);
00533                     }
00534                     cbNewSize = dwInpBufSize - (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pNewBuffer - pBuffer);
00535                 }
00536                 <span class="keywordflow">else</span>
00537                 {
00538                     pNewBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00539                 }
00540 
00541                 bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a184">GetPS2CSA_ABC</a>(pProfile, pNewBuffer, &amp;cbNewSize,
00542                           dwIntent, pbBinary, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00543 
00544                 <span class="keywordflow">if</span> (pBuffer)
00545                 {
00546                     pNewBuffer += cbNewSize;
00547                     <span class="keywordflow">if</span> (dwCSAType == CSA_Lab)
00548                     {
00549                         pNewBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pNewBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a88">SupportDEFG_E</a>);
00550                     }
00551                     *pcbSize += (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pNewBuffer - pOldBuffer);
00552                 }
00553                 <span class="keywordflow">else</span>
00554                 {
00555                     *pcbSize += cbNewSize;
00556                 }
00557 
00558             }
00559             <span class="keywordflow">else</span>
00560             {
00561                 *pcbSize = dwInpBufSize;
00562 
00563                 bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a184">GetPS2CSA_ABC</a>(pProfile, pBuffer, pcbSize, dwIntent, pbBinary, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00564             }
00565 
00566             <span class="keywordflow">break</span>;
00567 
00568         <span class="keywordflow">case</span> CSA_CMYK:
00569         <span class="keywordflow">case</span> CSA_DEFG:
00570             bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a186">GetPS2CSA_DEFG</a>(pProfile, pBuffer, pcbSize, dwIntent,
00571                       <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>, pbBinary);
00572             <span class="keywordflow">break</span>;
00573 
00574         <span class="keywordflow">case</span> CSA_GRAY:
00575         <span class="keywordflow">case</span> CSA_A:
00576             bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a183">GetPS2CSA_MONO_A</a>(pProfile, pBuffer, pcbSize, dwIntent, pbBinary);
00577             <span class="keywordflow">break</span>;
00578 
00579         <span class="keywordflow">default</span>:
00580             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid CSA type passed to GetPS2ColorSpaceArray: %d\n"</span>), dwCSAType));
00581             SetLastError(ERROR_INVALID_PARAMETER);
00582             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00583         }
00584     }
00585 
00586     <span class="keywordflow">return</span> bRc;
00587 }
00588 
00589 
00590 <span class="comment">/******************************************************************************</span>
00591 <span class="comment"> *</span>
00592 <span class="comment"> *                       InternalGetPS2ColorRenderingIntent</span>
00593 <span class="comment"> *</span>
00594 <span class="comment"> *  Function:</span>
00595 <span class="comment"> *       This functions retrieves the PostScript Level 2 color rendering intent</span>
00596 <span class="comment"> *       from the profile, or creates it if the profile tag is not present</span>
00597 <span class="comment"> *</span>
00598 <span class="comment"> *  Arguments:</span>
00599 <span class="comment"> *       hProfile  - handle identifing the profile object</span>
00600 <span class="comment"> *       pbuffer   - pointer to receive the color rendering intent</span>
00601 <span class="comment"> *       pcbSize   - pointer to size of buffer. If function fails because</span>
00602 <span class="comment"> *                   buffer is not big enough, it is filled with required size.</span>
00603 <span class="comment"> *       pcbBinary - TRUE if binary data is requested. On return it is set to</span>
00604 <span class="comment"> *                   reflect the data returned</span>
00605 <span class="comment"> *</span>
00606 <span class="comment"> *  Returns:</span>
00607 <span class="comment"> *       TRUE if successful, FALSE otherwise</span>
00608 <span class="comment"> *</span>
00609 <span class="comment"> ******************************************************************************/</span>
00610 
00611 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00612"></a><a class="code" href="../../d2/d9/ps2_8c.html#a255">00612</a> <a class="code" href="../../d2/d9/ps2_8c.html#a255">InternalGetPS2ColorRenderingIntent</a>(
00613     PBYTE     pProfile,
00614     DWORD     dwIntent,
00615     PBYTE     pBuffer,
00616     PDWORD    pcbSize
00617     )
00618 {
00619     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwIndex, dwTag, dwSize;
00620     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00621 
00622     <span class="keywordflow">switch</span> (dwIntent)
00623     {
00624     <span class="keywordflow">case</span> INTENT_PERCEPTUAL:
00625         dwTag = <a class="code" href="../../d2/d9/ps2_8c.html#a25">TAG_PS2INTENT0</a>;
00626         <span class="keywordflow">break</span>;
00627 
00628     <span class="keywordflow">case</span> INTENT_RELATIVE_COLORIMETRIC:
00629         dwTag = <a class="code" href="../../d2/d9/ps2_8c.html#a26">TAG_PS2INTENT1</a>;
00630         <span class="keywordflow">break</span>;
00631 
00632     <span class="keywordflow">case</span> INTENT_SATURATION:
00633         dwTag = <a class="code" href="../../d2/d9/ps2_8c.html#a27">TAG_PS2INTENT2</a>;
00634         <span class="keywordflow">break</span>;
00635 
00636     <span class="keywordflow">case</span> INTENT_ABSOLUTE_COLORIMETRIC:
00637         dwTag = <a class="code" href="../../d2/d9/ps2_8c.html#a28">TAG_PS2INTENT3</a>;
00638         <span class="keywordflow">break</span>;
00639 
00640     <span class="keywordflow">default</span>:
00641         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid intent passed to GetPS2ColorRenderingIntent: %d\n"</span>), dwIntent));
00642         SetLastError(ERROR_INVALID_PARAMETER);
00643         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00644     }
00645 
00646     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, dwTag, &amp;dwIndex))
00647     {
00648         (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(pProfile, dwIndex, &amp;dwSize);
00649 
00650         <span class="keywordflow">if</span> (pBuffer)
00651         {
00652             <span class="keywordflow">if</span> (*pcbSize &gt;= dwSize + 1) <span class="comment">// for NULL terminating</span>
00653             {
00654                 bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(pProfile, dwIndex, pBuffer, &amp;dwSize);
00655             }
00656             <span class="keywordflow">else</span>
00657             {
00658                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get CRI\n"</span>)));
00659                 SetLastError(ERROR_INSUFFICIENT_BUFFER);
00660             }
00661         }
00662         <span class="keywordflow">else</span>
00663             bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00664 
00665         *pcbSize = dwSize;
00666     }
00667     <span class="keywordflow">else</span>
00668     {
00669         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"psi tag not present for intent %d in profile\n"</span>), dwIntent));
00670         SetLastError(ERROR_TAG_NOT_PRESENT);
00671     }
00672 
00673     <span class="comment">//</span>
00674     <span class="comment">// NULL terminate</span>
00675     <span class="comment">//</span>
00676 
00677     <span class="keywordflow">if</span> (bRc)
00678     {
00679         <span class="keywordflow">if</span> (pBuffer)
00680         {
00681             pBuffer[*pcbSize] = <span class="charliteral">'\0'</span>;
00682         }
00683         (*pcbSize)++;
00684     }
00685 
00686     <span class="keywordflow">return</span> bRc;
00687 }
00688 
00689 
00690 <span class="comment">/******************************************************************************</span>
00691 <span class="comment"> *</span>
00692 <span class="comment"> *                       InternalGetPS2ColorRenderingDictionary</span>
00693 <span class="comment"> *</span>
00694 <span class="comment"> *  Function:</span>
00695 <span class="comment"> *       This functions retrieves the PostScript Level 2 CRD from the profile,</span>
00696 <span class="comment"> *       or creates it if the profile tag is not preesnt</span>
00697 <span class="comment"> *</span>
00698 <span class="comment"> *  Arguments:</span>
00699 <span class="comment"> *       hProfile  - handle identifing the profile object</span>
00700 <span class="comment"> *       dwIntent  - intent whose CRD is required</span>
00701 <span class="comment"> *       pbuffer   - pointer to receive the CSA</span>
00702 <span class="comment"> *       pcbSize   - pointer to size of buffer. If function fails because</span>
00703 <span class="comment"> *                   buffer is not big enough, it is filled with required size.</span>
00704 <span class="comment"> *       pcbBinary - TRUE if binary data is requested. On return it is set to</span>
00705 <span class="comment"> *                   reflect the data returned</span>
00706 <span class="comment"> *</span>
00707 <span class="comment"> *  Returns:</span>
00708 <span class="comment"> *       TRUE if successful, FALSE otherwise</span>
00709 <span class="comment"> *</span>
00710 <span class="comment"> ******************************************************************************/</span>
00711 
00712 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00713"></a><a class="code" href="../../d2/d9/ps2_8c.html#a256">00713</a> <a class="code" href="../../d2/d9/ps2_8c.html#a256">InternalGetPS2ColorRenderingDictionary</a>(
00714     PBYTE     pProfile,
00715     DWORD     dwIntent,
00716     PBYTE     pBuffer,
00717     PDWORD    pcbSize,
00718     PBOOL     pbBinary
00719     )
00720 {
00721     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwIndex, dwSize, dwDataType;
00722     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCRDTag, dwBToATag;
00723     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00724 
00725     <span class="keywordflow">switch</span> (dwIntent)
00726     {
00727     <span class="keywordflow">case</span> INTENT_PERCEPTUAL:
00728         dwCRDTag = <a class="code" href="../../d2/d9/ps2_8c.html#a29">TAG_CRDINTENT0</a>;
00729         dwBToATag = <a class="code" href="../../d2/d9/ps2_8c.html#a33">TAG_BToA0</a>;
00730         <span class="keywordflow">break</span>;
00731 
00732     <span class="keywordflow">case</span> INTENT_RELATIVE_COLORIMETRIC:
00733         dwCRDTag = <a class="code" href="../../d2/d9/ps2_8c.html#a30">TAG_CRDINTENT1</a>;
00734         dwBToATag = <a class="code" href="../../d2/d9/ps2_8c.html#a34">TAG_BToA1</a>;
00735         <span class="keywordflow">break</span>;
00736 
00737     <span class="keywordflow">case</span> INTENT_SATURATION:
00738         dwCRDTag = <a class="code" href="../../d2/d9/ps2_8c.html#a31">TAG_CRDINTENT2</a>;
00739         dwBToATag = <a class="code" href="../../d2/d9/ps2_8c.html#a35">TAG_BToA2</a>;
00740         <span class="keywordflow">break</span>;
00741 
00742     <span class="keywordflow">case</span> INTENT_ABSOLUTE_COLORIMETRIC:
00743         dwCRDTag = <a class="code" href="../../d2/d9/ps2_8c.html#a32">TAG_CRDINTENT3</a>;
00744         dwBToATag = <a class="code" href="../../d2/d9/ps2_8c.html#a34">TAG_BToA1</a>;
00745         <span class="keywordflow">break</span>;
00746 
00747     <span class="keywordflow">default</span>:
00748         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid intent passed to GetPS2ColorRenderingDictionary: %d\n"</span>), dwIntent));
00749         SetLastError(ERROR_INVALID_PARAMETER);
00750         <span class="keywordflow">return</span> bRc;
00751     }
00752 
00753     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, dwCRDTag, &amp;dwIndex))
00754     {
00755         (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(pProfile, dwIndex, &amp;dwSize);
00756 
00757         (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a195">GetCPElementDataType</a>(pProfile, dwIndex, &amp;dwDataType);
00758 
00759         <span class="keywordflow">if</span> (! *pbBinary &amp;&amp; dwDataType == 1)
00760         {
00761             <span class="comment">//</span>
00762             <span class="comment">// Profile has binary data, user asked for ASCII, so we have to</span>
00763             <span class="comment">// ASCII 85 encode it</span>
00764             <span class="comment">//</span>
00765 
00766             dwSize = dwSize * 5 / 4 + <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d9/ps2_8c.html#a67">ASCII85DecodeBegin</a>) + <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d9/ps2_8c.html#a68">ASCII85DecodeEnd</a>) + 2048;
00767         }
00768 
00769         <span class="keywordflow">if</span> (pBuffer)
00770         {
00771             <span class="keywordflow">if</span> (*pcbSize &gt;= dwSize)
00772             {
00773                 (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(pProfile, dwIndex, pBuffer, &amp;dwSize);
00774 
00775                 <span class="keywordflow">if</span> (! *pbBinary &amp;&amp; dwDataType == 1)
00776                 {
00777                     dwSize = <a class="code" href="../../d2/d9/ps2_8c.html#a198">Ascii85Encode</a>(pBuffer, dwSize, *pcbSize);
00778                 }
00779                 bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00780             }
00781             <span class="keywordflow">else</span>
00782             {
00783                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get CRD\n"</span>)));
00784                 SetLastError(ERROR_INSUFFICIENT_BUFFER);
00785             }
00786         }
00787         <span class="keywordflow">else</span>
00788             bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00789 
00790         *pcbSize = dwSize;
00791     }
00792     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, dwBToATag, &amp;dwIndex))
00793     {
00794         bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a188">CreateLutCRD</a>(pProfile, dwIndex, pBuffer, pcbSize, dwIntent, *pbBinary);
00795     }
00796     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a20">TAG_GRAYTRC</a>, &amp;dwIndex))
00797     {
00798         bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a187">CreateMonoCRD</a>(pProfile, dwIndex, pBuffer, pcbSize, dwIntent);
00799     }
00800 <span class="preprocessor">#if !defined(KERNEL_MODE) || defined(USERMODE_DRIVER)</span>
00801 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a190">DoesTRCAndColorantTagExist</a>(pProfile))
00802     {
00803         bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a234">CreateMatrixCRD</a>(pProfile, pBuffer, pcbSize, dwIntent, *pbBinary);
00804     }
00805 <span class="preprocessor">#endif // !defined(KERNEL_MODE) || defined(USERMODE_DRIVER)</span>
00806 <span class="preprocessor"></span>    <span class="keywordflow">else</span>
00807     {
00808         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Profile doesn't have tags to create CRD\n"</span>)));
00809         SetLastError(ERROR_INVALID_PROFILE);
00810     }
00811 
00812     <span class="keywordflow">return</span> bRc;
00813 }
00814 
00815 <span class="preprocessor">#if !defined(KERNEL_MODE) || defined(USERMODE_DRIVER)</span>
00816 <span class="preprocessor"></span>
00817 <span class="comment">/******************************************************************************</span>
00818 <span class="comment"> *</span>
00819 <span class="comment"> *                    InternalGetPS2PreviewCRD</span>
00820 <span class="comment"> *</span>
00821 <span class="comment"> *  Function:</span>
00822 <span class="comment"> *       This functions creates a preview PostScript Level 2 CRD from the</span>
00823 <span class="comment"> *       specified destination and target profiles</span>
00824 <span class="comment"> *       To do this, it does the following:</span>
00825 <span class="comment"> *           1) Creates host deviceCRD deviceCSA targetCRD.</span>
00826 <span class="comment"> *           2) Creates proofing CRD by sampling deviceCRD deviceCSA and targetCRD.</span>
00827 <span class="comment"> *           3) Uses deviceCRD's input table as proofingCRD's input table.</span>
00828 <span class="comment"> *           4) Uses targetCRD's output table as proofingCRD's output table.</span>
00829 <span class="comment"> *           5) Sample data is XYZ or Lab, depends on PCS of targetCRD.</span>
00830 <span class="comment"> *</span>
00831 <span class="comment"> *  Arguments:</span>
00832 <span class="comment"> *       pDestProf    - memory mapped pointer to destination profile</span>
00833 <span class="comment"> *       pTargetProf  - memory mapped pointer to target profile</span>
00834 <span class="comment"> *       dwIntent     - intent whose CRD is required</span>
00835 <span class="comment"> *       pbuffer      - pointer to receive the CSA</span>
00836 <span class="comment"> *       pcbSize      - pointer to size of buffer. If function fails because</span>
00837 <span class="comment"> *                      buffer is not big enough, it is filled with required size.</span>
00838 <span class="comment"> *       pcbBinary    - TRUE if binary data is requested. On return it is set to</span>
00839 <span class="comment"> *                      reflect the data returned</span>
00840 <span class="comment"> *</span>
00841 <span class="comment"> *  Returns:</span>
00842 <span class="comment"> *       TRUE if successful, FALSE otherwise</span>
00843 <span class="comment"> *</span>
00844 <span class="comment"> ******************************************************************************/</span>
00845 
00846 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00847"></a><a class="code" href="../../d2/d9/ps2_8c.html#a257">00847</a> <a class="code" href="../../d2/d9/ps2_8c.html#a257">InternalGetPS2PreviewCRD</a>(
00848     PBYTE   pDestProf,
00849     PBYTE   pTargetProf,
00850     DWORD   dwIntent,
00851     PBYTE   pBuffer,
00852     PDWORD  pcbSize,
00853     PBOOL   pbBinary
00854     )
00855 {
00856     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      i, j, k, l, dwDev, dwTag, dwPCS;
00857     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwInArraySize, dwOutArraySize;
00858     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      nDevGrids, nTargetGrids, nPreviewCRDGrids;
00859     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      cbDevCRD, cbTargetCSA, cbTargetCRD;
00860     <span class="keywordtype">float</span>      fInput[<a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a0">MAXCHANNELS</a>];
00861     <span class="keywordtype">float</span>      fOutput[<a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a0">MAXCHANNELS</a>];
00862     <span class="keywordtype">float</span>      fTemp[<a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a0">MAXCHANNELS</a>];
00863     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pLineStart, pStart = pBuffer;
00864     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      lpDevCRD = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, lpTargetCSA = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, lpTargetCRD = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00865     <span class="keywordtype">char</span>       pPublicArrayName[5];
00866     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>       bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00867 
00868     dwDev = <a class="code" href="../../d2/d9/ps2_8c.html#a41">GetCPDevSpace</a>(pTargetProf);
00869     i = (dwDev == SPACE_CMYK) ? 4 : 3;
00870 
00871     <span class="comment">//</span>
00872     <span class="comment">// Get the input array size IntentTag and Grid of the destination profile</span>
00873     <span class="comment">//</span>
00874 
00875     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d9/ps2_8c.html#a199">GetCRDInputOutputArraySize</a>(
00876             pTargetProf,
00877             dwIntent,
00878             &amp;dwInArraySize,
00879             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00880             &amp;dwTag,
00881             &amp;nTargetGrids))
00882         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00883 
00884     <span class="comment">//</span>
00885     <span class="comment">// Get the output array size IntentTag and Grid of the target profile</span>
00886     <span class="comment">//</span>
00887 
00888     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d9/ps2_8c.html#a199">GetCRDInputOutputArraySize</a>(
00889             pDestProf,
00890             dwIntent,
00891             <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00892             &amp;dwOutArraySize,
00893             &amp;dwTag,
00894             &amp;nDevGrids))
00895         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00896 
00897     nPreviewCRDGrids = (nTargetGrids &gt; nDevGrids) ? nTargetGrids : nDevGrids;
00898 
00899     <span class="comment">//</span>
00900     <span class="comment">// Min proofing CRD grid will be PREVIEWCRDGRID</span>
00901     <span class="comment">//</span>
00902 
00903     <span class="keywordflow">if</span> (nPreviewCRDGrids &lt; <a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a1">PREVIEWCRDGRID</a>)
00904         nPreviewCRDGrids = <a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a1">PREVIEWCRDGRID</a>;
00905 
00906     <span class="keywordflow">if</span> (pBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00907     {
00908         <span class="comment">//</span>
00909         <span class="comment">// Return size of buffer needed</span>
00910         <span class="comment">//</span>
00911 
00912         *pcbSize = nPreviewCRDGrids * nPreviewCRDGrids * nPreviewCRDGrids *
00913                    i * 2        +    <span class="comment">// CLUT size (Hex output)</span>
00914                    dwOutArraySize +  <span class="comment">// Output Array size</span>
00915                    dwInArraySize  +  <span class="comment">// Input Array size</span>
00916                    4096;             <span class="comment">// Extra PostScript stuff</span>
00917 
00918         <span class="comment">//</span>
00919         <span class="comment">// Add space for new line.</span>
00920         <span class="comment">//</span>
00921 
00922         *pcbSize += (((*pcbSize) / <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>) + 1) * <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
00923 
00924         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00925     }
00926 
00927     <span class="comment">//</span>
00928     <span class="comment">// Query the sizes of host target CRD, target CSA and device CRD</span>
00929     <span class="comment">//</span>
00930 
00931     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d9/ps2_8c.html#a201">GetHostColorRenderingDictionary</a>(pTargetProf, dwIntent, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, &amp;cbTargetCRD) ||
00932         !<a class="code" href="../../d2/d9/ps2_8c.html#a202">GetHostColorSpaceArray</a>(pTargetProf, dwIntent, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, &amp;cbTargetCSA) ||
00933         !<a class="code" href="../../d2/d9/ps2_8c.html#a201">GetHostColorRenderingDictionary</a>(pDestProf, dwIntent, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, &amp;cbDevCRD))
00934     {
00935         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00936     }
00937 
00938     <span class="comment">//</span>
00939     <span class="comment">// Allocate buffers for host target CRD, target CSA and device CRD</span>
00940     <span class="comment">//</span>
00941 
00942     <span class="keywordflow">if</span> (((lpTargetCRD = <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(cbTargetCRD)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00943         ((lpTargetCSA = <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(cbTargetCSA)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||
00944         ((lpDevCRD = <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(cbDevCRD)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>))
00945     {
00946         <span class="keywordflow">goto</span> Done;
00947     }
00948 
00949     <span class="comment">//</span>
00950     <span class="comment">// Build host target CRD, target CSA and device CRD</span>
00951     <span class="comment">//</span>
00952 
00953     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d9/ps2_8c.html#a201">GetHostColorRenderingDictionary</a>(pTargetProf, dwIntent, lpTargetCRD, &amp;cbTargetCRD) ||
00954         !<a class="code" href="../../d2/d9/ps2_8c.html#a202">GetHostColorSpaceArray</a>(pTargetProf, dwIntent, lpTargetCSA, &amp;cbTargetCSA) ||
00955         !<a class="code" href="../../d2/d9/ps2_8c.html#a201">GetHostColorRenderingDictionary</a>(pDestProf, dwIntent, lpDevCRD, &amp;cbDevCRD))
00956     {
00957         <span class="keywordflow">goto</span> Done;
00958     }
00959 
00960     <span class="comment">//</span>
00961     <span class="comment">// Create global data</span>
00962     <span class="comment">//</span>
00963 
00964     <a class="code" href="../../d2/d9/ps2_8c.html#a217">GetPublicArrayName</a>(dwTag, pPublicArrayName);
00965 
00966     <span class="comment">//</span>
00967     <span class="comment">// Build Proofing CRD based on Host target CRD, target CSA and dest CRD.</span>
00968     <span class="comment">// We use target CRD input tables and matrix as the input tables and</span>
00969     <span class="comment">// matrix of the ProofCRD. We use dest CRD output tables as the</span>
00970     <span class="comment">// output tables of the ProofCRD.</span>
00971     <span class="comment">//</span>
00972 
00973     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a59">CRDBegin</a>);
00974 
00975     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a220">EnableGlobalDict</a>(pBuffer);
00976     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a221">BeginGlobalDict</a>(pBuffer);
00977 
00978     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a215">CreateInputArray</a>(pBuffer, 0, 0, pPublicArrayName,
00979                     0, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, *pbBinary, lpTargetCRD);
00980 
00981     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a216">CreateOutputArray</a>(pBuffer, 0, 0, 0,
00982                     pPublicArrayName, 0, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, *pbBinary, lpDevCRD);
00983 
00984     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a222">EndGlobalDict</a>(pBuffer);
00985 
00986     <span class="comment">//</span>
00987     <span class="comment">// Start writing the CRD</span>
00988     <span class="comment">//</span>
00989 
00990     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a8">BeginDict</a>);     <span class="comment">// Begin dictionary</span>
00991     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a11">DictType</a>);      <span class="comment">// Dictionary type</span>
00992 
00993     <span class="comment">//</span>
00994     <span class="comment">// Send /RenderingIntent</span>
00995     <span class="comment">//</span>
00996 
00997     <span class="keywordflow">switch</span> (dwIntent)
00998     {
00999         <span class="keywordflow">case</span> INTENT_PERCEPTUAL:
01000             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
01001             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a13">IntentPer</a>);
01002             <span class="keywordflow">break</span>;
01003 
01004         <span class="keywordflow">case</span> INTENT_SATURATION:
01005             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
01006             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a14">IntentSat</a>);
01007             <span class="keywordflow">break</span>;
01008 
01009         <span class="keywordflow">case</span> INTENT_RELATIVE_COLORIMETRIC:
01010             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
01011             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a16">IntentRCol</a>);
01012             <span class="keywordflow">break</span>;
01013 
01014         <span class="keywordflow">case</span> INTENT_ABSOLUTE_COLORIMETRIC:
01015             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
01016             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a15">IntentACol</a>);
01017             <span class="keywordflow">break</span>;
01018     }
01019 
01020     <span class="comment">//</span>
01021     <span class="comment">// /BlackPoint &amp; /WhitePoint</span>
01022     <span class="comment">//</span>
01023 
01024     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a203">SendCRDBWPoint</a>(pBuffer, ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpTargetCRD)-&gt;afxIlluminantWP);
01025 
01026     <span class="comment">//</span>
01027     <span class="comment">// Send PQR - used for Absolute Colorimetric</span>
01028     <span class="comment">//</span>
01029 
01030     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a204">SendCRDPQR</a>(pBuffer, dwIntent, ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpTargetCRD)-&gt;afxIlluminantWP);
01031 
01032     <span class="comment">//</span>
01033     <span class="comment">// Send LMN - For Absolute Colorimetric use WhitePoint's XYZs</span>
01034     <span class="comment">//</span>
01035 
01036     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a205">SendCRDLMN</a>(pBuffer, dwIntent,
01037                    ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpTargetCRD)-&gt;afxIlluminantWP,
01038                    ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpTargetCRD)-&gt;afxMediaWP,
01039                    ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpTargetCRD)-&gt;dwPCS);
01040 
01041     <span class="comment">//</span>
01042     <span class="comment">// Send ABC</span>
01043     <span class="comment">//</span>
01044 
01045     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a206">SendCRDABC</a>(pBuffer, pPublicArrayName,
01046                    ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpTargetCRD)-&gt;dwPCS,
01047                    ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpTargetCRD)-&gt;nInputCh,
01048                    <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01049                    ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpTargetCRD)-&gt;e,
01050                    (((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpTargetCRD)-&gt;nLutBits == 8)? <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a> : <a class="code" href="../../d2/d9/ps2_8c.html#a38">LUT16_TYPE</a>,
01051                    *pbBinary);
01052 
01053     <span class="comment">//</span>
01054     <span class="comment">// /RenderTable</span>
01055     <span class="comment">//</span>
01056 
01057     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a29">RenderTableTag</a>);
01058     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
01059 
01060     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, nPreviewCRDGrids);  <span class="comment">// Send down Na</span>
01061     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, nPreviewCRDGrids);  <span class="comment">// Send down Nb</span>
01062     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, nPreviewCRDGrids);  <span class="comment">// Send down Nc</span>
01063 
01064     pLineStart = pBuffer;
01065     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
01066     dwPCS = ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpDevCRD)-&gt;dwPCS;
01067 
01068     <span class="keywordflow">for</span> (i=0; i&lt;nPreviewCRDGrids; i++)        <span class="comment">// Na strings should be sent</span>
01069     {
01070         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01071         pLineStart = pBuffer;
01072         <span class="keywordflow">if</span> (*pbBinary)
01073         {
01074             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a228">WriteStringToken</a>(pBuffer, 143,
01075                 nPreviewCRDGrids * nPreviewCRDGrids * ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpDevCRD)-&gt;nOutputCh);
01076         }
01077         <span class="keywordflow">else</span>
01078         {
01079             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a2">BeginString</a>);
01080         }
01081         fInput[0] = ((<span class="keywordtype">float</span>)i) / (nPreviewCRDGrids - 1);
01082         <span class="keywordflow">for</span> (j=0; j&lt;nPreviewCRDGrids; j++)
01083         {
01084             fInput[1] = ((<span class="keywordtype">float</span>)j) / (nPreviewCRDGrids - 1);
01085             <span class="keywordflow">for</span> (k=0; k&lt;nPreviewCRDGrids; k++)
01086             {
01087                 fInput[2] = ((<span class="keywordtype">float</span>)k) / (nPreviewCRDGrids - 1);
01088 
01089                 <a class="code" href="../../d2/d9/ps2_8c.html#a243">DoHostConversionCRD</a>((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpTargetCRD, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, fInput, fOutput, 1);
01090                 <a class="code" href="../../d2/d9/ps2_8c.html#a242">DoHostConversionCSA</a>((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpTargetCSA, fOutput, fTemp);
01091                 <a class="code" href="../../d2/d9/ps2_8c.html#a243">DoHostConversionCRD</a>((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpDevCRD, (<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpTargetCSA,
01092                                      fTemp, fOutput, 0);
01093                 <span class="keywordflow">for</span> (l=0; l&lt;((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpDevCRD)-&gt;nOutputCh; l++)
01094                 {
01095                     <span class="keywordflow">if</span> (*pbBinary)
01096                     {
01097                         *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(fOutput[l] * 255);
01098                     }
01099                     <span class="keywordflow">else</span>
01100                     {
01101                         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a45">WriteHex</a>(pBuffer, (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(fOutput[l] * 255));
01102                         <span class="keywordflow">if</span> ((pBuffer - pLineStart) &gt; <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>)
01103                         {
01104                             pLineStart = pBuffer;
01105                             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01106                         }
01107                     }
01108                 }
01109             }
01110         }
01111         <span class="keywordflow">if</span> (!*pbBinary)
01112             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a3">EndString</a>);
01113     }
01114     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
01115     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpDevCRD)-&gt;nOutputCh);
01116 
01117     <span class="comment">//</span>
01118     <span class="comment">// Send output table</span>
01119     <span class="comment">//</span>
01120 
01121     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a207">SendCRDOutputTable</a>(pBuffer, pPublicArrayName,
01122                     ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpDevCRD)-&gt;nOutputCh,
01123                     (((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)lpDevCRD)-&gt;nLutBits == 8)? <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a> : <a class="code" href="../../d2/d9/ps2_8c.html#a38">LUT16_TYPE</a>,
01124                     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
01125                     *pbBinary);
01126 
01127     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
01128     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a9">EndDict</a>); <span class="comment">// End dictionary definition</span>
01129     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a60">CRDEnd</a>);
01130     bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01131 
01132 Done:
01133     *pcbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
01134 
01135     <span class="keywordflow">if</span> (lpTargetCRD)
01136          <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(lpTargetCRD);
01137     <span class="keywordflow">if</span> (lpTargetCSA)
01138          <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(lpTargetCSA);
01139     <span class="keywordflow">if</span> (lpDevCRD)
01140          <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(lpDevCRD);
01141 
01142     <span class="keywordflow">return</span> bRc;
01143 }
01144 
01145 <span class="preprocessor">#endif //  !defined(KERNEL_MODE) || defined(USERMODE_DRIVER)</span>
01146 <span class="preprocessor"></span>
01147 
01148 <span class="comment">/******************************************************************************</span>
01149 <span class="comment"> *</span>
01150 <span class="comment"> *                               GetCSAFromProfile</span>
01151 <span class="comment"> *</span>
01152 <span class="comment"> *  Function:</span>
01153 <span class="comment"> *       This function gets the Color Space Array from the profile if the</span>
01154 <span class="comment"> *       tag is present</span>
01155 <span class="comment"> *</span>
01156 <span class="comment"> *  Arguments:</span>
01157 <span class="comment"> *       pProfile  - pointer to the memory mapped  profile</span>
01158 <span class="comment"> *       dwIntent  - rendering intent of CSA requested</span>
01159 <span class="comment"> *       dwCSAType - type of CSA requested</span>
01160 <span class="comment"> *       pBuffer   - pointer to receive the CSA</span>
01161 <span class="comment"> *       pcbSize   - pointer to size of buffer. If function fails because</span>
01162 <span class="comment"> *                   buffer is not big enough, it is filled with required size.</span>
01163 <span class="comment"> *       pcbBinary - TRUE if binary data is requested. On return it is set to</span>
01164 <span class="comment"> *                   reflect the data returned</span>
01165 <span class="comment"> *</span>
01166 <span class="comment"> *  Returns:</span>
01167 <span class="comment"> *       TRUE if successful, FALSE otherwise</span>
01168 <span class="comment"> *</span>
01169 <span class="comment"> ******************************************************************************/</span>
01170 
01171 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l01172"></a><a class="code" href="../../d2/d9/ps2_8c.html#a182">01172</a> <a class="code" href="../../d2/d9/ps2_8c.html#a182">GetCSAFromProfile</a> (
01173     PBYTE  pProfile,
01174     DWORD  dwIntent,
01175     DWORD  dwCSAType,
01176     PBYTE  pBuffer,
01177     PDWORD pcbSize,
01178     PBOOL  pbBinary
01179     )
01180 {
01181     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDev, dwProfileIntent;
01182     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwIndex, dwSize, dwDataType;
01183     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01184 
01185     <span class="comment">//</span>
01186     <span class="comment">// This function can fail without setting an error, so reset error</span>
01187     <span class="comment">// here to prevent confusion later</span>
01188     <span class="comment">//</span>
01189 
01190     SetLastError(0);
01191 
01192     <span class="comment">//</span>
01193     <span class="comment">// Get the profile's color space and rendering intent</span>
01194     <span class="comment">//</span>
01195 
01196     dwDev = <a class="code" href="../../d2/d9/ps2_8c.html#a41">GetCPDevSpace</a>(pProfile);
01197     dwProfileIntent = <a class="code" href="../../d2/d9/ps2_8c.html#a42">GetCPRenderIntent</a>(pProfile);
01198 
01199     <span class="comment">//</span>
01200     <span class="comment">// If the rendering intents don't match, or the profile's color space</span>
01201     <span class="comment">// is incompatible with requested CSA type, fail</span>
01202     <span class="comment">//</span>
01203 
01204     <span class="keywordflow">if</span>  ((dwIntent != dwProfileIntent) ||
01205          ((dwDev == SPACE_GRAY) &amp;&amp;
01206          ((dwCSAType != CSA_GRAY) &amp;&amp; (dwCSAType != CSA_A))))
01207     {
01208         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Can't use profile's CSA tag due to different rendering intents\n"</span>)));
01209         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01210     }
01211 
01212     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a13">TAG_PS2CSA</a>, &amp;dwIndex))
01213     {
01214         (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(pProfile, dwIndex, &amp;dwSize);
01215 
01216         (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a195">GetCPElementDataType</a>(pProfile, dwIndex, &amp;dwDataType);
01217 
01218         <span class="keywordflow">if</span> (! *pbBinary &amp;&amp; dwDataType == 1)
01219         {
01220             <span class="comment">//</span>
01221             <span class="comment">// Profile has binary data, user asked for ASCII, so we have to</span>
01222             <span class="comment">// ASCII 85 encode it</span>
01223             <span class="comment">//</span>
01224 
01225             dwSize = dwSize * 5 / 4 + <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d9/ps2_8c.html#a67">ASCII85DecodeBegin</a>) + <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d9/ps2_8c.html#a68">ASCII85DecodeEnd</a>) + 2048;
01226         }
01227 
01228         <span class="keywordflow">if</span> (pBuffer)
01229         {
01230             <span class="keywordflow">if</span> (*pcbSize &gt;= dwSize)
01231             {
01232                 (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(pProfile, dwIndex, pBuffer, &amp;dwSize);
01233 
01234                 <span class="keywordflow">if</span> (! *pbBinary &amp;&amp; dwDataType == 1)
01235                 {
01236                     dwSize = <a class="code" href="../../d2/d9/ps2_8c.html#a198">Ascii85Encode</a>(pBuffer, dwSize, *pcbSize);
01237                 }
01238                 bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01239             }
01240             <span class="keywordflow">else</span>
01241             {
01242                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get CSA\n"</span>)));
01243                 SetLastError(ERROR_INSUFFICIENT_BUFFER);
01244             }
01245         }
01246         <span class="keywordflow">else</span>
01247             bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01248 
01249         *pcbSize = dwSize;
01250     }
01251 
01252     <span class="keywordflow">return</span> bRc;
01253 }
01254 
01255 
01256 <span class="comment">/******************************************************************************</span>
01257 <span class="comment"> *</span>
01258 <span class="comment"> *                              GetPS2CSA_MONO_A</span>
01259 <span class="comment"> *</span>
01260 <span class="comment"> *  Function:</span>
01261 <span class="comment"> *       This function creates a CIEBasedA colorspace array from an input</span>
01262 <span class="comment"> *       GRAY profile</span>
01263 <span class="comment"> *</span>
01264 <span class="comment"> *  Arguments:</span>
01265 <span class="comment"> *       pProfile  - pointer to the memory mapped profile</span>
01266 <span class="comment"> *       pBuffer   - pointer to receive the CSA</span>
01267 <span class="comment"> *       pcbSize   - pointer to size of buffer. If function fails because</span>
01268 <span class="comment"> *                   buffer is not big enough, it is filled with required size.</span>
01269 <span class="comment"> *       dwIntent  - rendering intent of CSA requested</span>
01270 <span class="comment"> *       pcbBinary - TRUE if binary data is requested. On return it is set to</span>
01271 <span class="comment"> *                   reflect the data returned</span>
01272 <span class="comment"> *</span>
01273 <span class="comment"> *  Returns:</span>
01274 <span class="comment"> *       TRUE if successful, FALSE otherwise</span>
01275 <span class="comment"> *</span>
01276 <span class="comment"> ******************************************************************************/</span>
01277 
01278 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l01279"></a><a class="code" href="../../d2/d9/ps2_8c.html#a183">01279</a> <a class="code" href="../../d2/d9/ps2_8c.html#a183">GetPS2CSA_MONO_A</a>(
01280     PBYTE  pProfile,
01281     PBYTE  pBuffer,
01282     PDWORD pcbSize,
01283     DWORD  dwIntent,
01284     PBOOL  pbBinary
01285     )
01286 {
01287     <a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a> pData;
01288     PTAGDATA   pTagData;
01289     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pLineStart, pStart = pBuffer;
01290     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pTable;
01291     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      i, dwPCS, nCount;
01292     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwIndex, dwSize;
01293     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      afxIlluminantWP[3];
01294     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      afxMediaWP[3];
01295 
01296     <span class="comment">//</span>
01297     <span class="comment">// Check if we can generate the CSA</span>
01298     <span class="comment">// Required tag is gray TRC</span>
01299     <span class="comment">//</span>
01300 
01301     <span class="keywordflow">if</span> (! <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a20">TAG_GRAYTRC</a>, &amp;dwIndex))
01302     {
01303         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Gray TRC tag not present to create MONO_A CSA\n"</span>)));
01304         SetLastError(ERROR_TAG_NOT_PRESENT);
01305         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01306     }
01307 
01308     dwPCS = <a class="code" href="../../d2/d9/ps2_8c.html#a40">GetCPConnSpace</a>(pProfile);
01309 
01310     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a194">GetCPElementSize</a>(pProfile, dwIndex, &amp;dwSize);
01311 
01312     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
01313                dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
01314 
01315     pData = (<a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
01316 
01317     nCount = FIX_ENDIAN(pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
01318 
01319     <span class="comment">//</span>
01320     <span class="comment">// Estimate size required to hold the CSA</span>
01321     <span class="comment">//</span>
01322 
01323     dwSize = nCount * 6 +               <span class="comment">// Number of INT elements</span>
01324         3 * (<a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>) +
01325              <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a89">StartClip</a>) +
01326              <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a90">EndClip</a>)) +
01327         2048;                           <span class="comment">// + other PS stuff</span>
01328 
01329     <span class="comment">//</span>
01330     <span class="comment">// Add space for new line.</span>
01331     <span class="comment">//</span>
01332 
01333     dwSize += (((dwSize) / <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>) + 1) * <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01334 
01335     <span class="keywordflow">if</span> (! pBuffer)
01336     {
01337         *pcbSize = dwSize;
01338         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01339     }
01340     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*pcbSize &lt; dwSize)
01341     {
01342         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get MONO_A CSA\n"</span>)));
01343         SetLastError(ERROR_INSUFFICIENT_BUFFER);
01344         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01345     }
01346 
01347     <span class="comment">//</span>
01348     <span class="comment">// Get info about Illuminant White Point from the header</span>
01349     <span class="comment">//</span>
01350 
01351     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(pProfile, afxIlluminantWP);
01352 
01353     <span class="comment">//</span>
01354     <span class="comment">// Support absolute whitePoint</span>
01355     <span class="comment">//</span>
01356 
01357     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a209">GetMediaWP</a>(pProfile, dwIntent, afxIlluminantWP, afxMediaWP);
01358 
01359     <span class="comment">//</span>
01360     <span class="comment">// Start creating the ColorSpace</span>
01361     <span class="comment">//</span>
01362 
01363     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a64">CieBasedABegin</a>);
01364 
01365     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);   <span class="comment">// Begin array</span>
01366 
01367     <span class="comment">//</span>
01368     <span class="comment">// /CIEBasedA</span>
01369     <span class="comment">//</span>
01370 
01371     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a30">CIEBasedATag</a>); <span class="comment">// Create entry</span>
01372     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a8">BeginDict</a>);    <span class="comment">// Begin dictionary</span>
01373 
01374     <span class="comment">//</span>
01375     <span class="comment">// Send /BlackPoint &amp; /WhitePoint</span>
01376     <span class="comment">//</span>
01377 
01378     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a208">SendCSABWPoint</a>(pBuffer, dwIntent, afxIlluminantWP, afxMediaWP);
01379 
01380     <span class="comment">//</span>
01381     <span class="comment">// /DecodeA</span>
01382     <span class="comment">//</span>
01383 
01384     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01385     pLineStart = pBuffer;
01386 
01387     <span class="keywordflow">if</span> (nCount != 0)
01388     {
01389         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a34">DecodeATag</a>);
01390         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
01391 
01392         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
01393 
01394         pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o3">data</a>);
01395 
01396         <span class="keywordflow">if</span> (nCount == 1)                <span class="comment">// Gamma supplied in ui16 format</span>
01397         {
01398             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, FIX_ENDIAN16(*((PWORD)pTable)));
01399             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a74">DecodeA3</a>);
01400 
01401             <span class="comment">//</span>
01402             <span class="comment">// If the PCS is Lab, we need to convert Lab to XYZ</span>
01403             <span class="comment">// Now, the range is from 0 --&gt; 0.99997.</span>
01404             <span class="comment">// Actually, the conversion from Lab to XYZ is not needed</span>
01405             <span class="comment">//</span>
01406 
01407             <span class="keywordflow">if</span> (dwPCS == SPACE_Lab)
01408             {
01409                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a98">DecodeALab</a>);
01410                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a99">DecodeLMNLab</a>);
01411             }
01412         }
01413         <span class="keywordflow">else</span>
01414         {
01415             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a89">StartClip</a>);
01416             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
01417             <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
01418             {
01419                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, FIX_ENDIAN16(*((PWORD)pTable)));
01420                 pTable += <span class="keyword">sizeof</span>(WORD);
01421                 <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pLineStart)) &gt; <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>)
01422                 {
01423                     pLineStart = pBuffer;
01424                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a> (pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01425                 }
01426             }
01427             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
01428             pLineStart = pBuffer;
01429             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01430 
01431             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>);
01432             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a92">Scale16</a>);
01433 
01434             <span class="comment">//</span>
01435             <span class="comment">// If the PCS is Lab, we need to convert Lab to XYZ</span>
01436             <span class="comment">// Now, the range is from 0 --&gt; .99997.</span>
01437             <span class="comment">// Actually, the conversion from Lab to XYZ is not needed.</span>
01438             <span class="comment">//</span>
01439 
01440             <span class="keywordflow">if</span> (dwPCS == SPACE_Lab)
01441             {
01442                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a98">DecodeALab</a>);
01443                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a99">DecodeLMNLab</a>);
01444             }
01445             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a90">EndClip</a>);
01446         }
01447 
01448         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
01449         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
01450     }
01451 
01452     <span class="comment">//</span>
01453     <span class="comment">// /MatrixA</span>
01454     <span class="comment">//</span>
01455 
01456     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a23">MatrixATag</a>);
01457     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
01458     <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
01459     {
01460         <span class="keywordflow">if</span> (dwIntent == INTENT_ABSOLUTE_COLORIMETRIC)
01461         {
01462             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, afxMediaWP[i]);
01463         }
01464         <span class="keywordflow">else</span>
01465         {
01466             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, afxIlluminantWP[i]);
01467         }
01468     }
01469     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
01470 
01471     <span class="comment">//</span>
01472     <span class="comment">// /RangeLMN</span>
01473     <span class="comment">//</span>
01474 
01475     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a26">RangeLMNTag</a>);
01476     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a70">RangeLMN</a>);
01477 
01478     <span class="comment">//</span>
01479     <span class="comment">// /End dictionary</span>
01480     <span class="comment">//</span>
01481 
01482     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a9">EndDict</a>);  <span class="comment">// End dictionary definition</span>
01483     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
01484 
01485     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a68">CieBasedAEnd</a>);
01486 
01487     *pcbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
01488 
01489     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01490 }
01491 
01492 
01493 <span class="comment">/******************************************************************************</span>
01494 <span class="comment"> *</span>
01495 <span class="comment"> *                              GetPS2CSA_ABC</span>
01496 <span class="comment"> *</span>
01497 <span class="comment"> *  Function:</span>
01498 <span class="comment"> *       This function creates a CIEBasedABC colorspace array from an input</span>
01499 <span class="comment"> *       RGB profile</span>
01500 <span class="comment"> *</span>
01501 <span class="comment"> *  Arguments:</span>
01502 <span class="comment"> *       pProfile  - pointer to the memory mapped profile</span>
01503 <span class="comment"> *       pBuffer   - pointer to receive the CSA</span>
01504 <span class="comment"> *       pcbSize   - pointer to size of buffer. If function fails because</span>
01505 <span class="comment"> *                   buffer is not big enough, it is filled with required size.</span>
01506 <span class="comment"> *       dwIntent  - rendering intent of CSA requested</span>
01507 <span class="comment"> *       pcbBinary - TRUE if binary data is requested. On return it is set to</span>
01508 <span class="comment"> *                   reflect the data returned</span>
01509 <span class="comment"> *       bBackup   - TRUE: A CIEBasedDEF has been created, this CSA is a backup</span>
01510 <span class="comment"> *                          in case some old printer can not support CIEBasedDEF.</span>
01511 <span class="comment"> *                   FALSE: No CIEBasedDEF. This is the only CSA.</span>
01512 <span class="comment"> *</span>
01513 <span class="comment"> *  Returns:</span>
01514 <span class="comment"> *       TRUE if successful, FALSE otherwise</span>
01515 <span class="comment"> *</span>
01516 <span class="comment"> ******************************************************************************/</span>
01517 
01518 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l01519"></a><a class="code" href="../../d2/d9/ps2_8c.html#a184">01519</a> <a class="code" href="../../d2/d9/ps2_8c.html#a184">GetPS2CSA_ABC</a>(
01520     PBYTE  pProfile,
01521     PBYTE  pBuffer,
01522     PDWORD pcbSize,
01523     DWORD  dwIntent,
01524     PBOOL  pbBinary,
01525     BOOL   bBackup
01526     )
01527 {
01528     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>     pStart = pBuffer;
01529     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     i, dwPCS, dwDev, dwSize;
01530     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> afxIlluminantWP[3];
01531     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> afxMediaWP[3];
01532 
01533     <span class="comment">//</span>
01534     <span class="comment">// Check if we can generate the CSA:</span>
01535     <span class="comment">// Required  tags are red, green and blue Colorants &amp; TRCs</span>
01536     <span class="comment">//</span>
01537 
01538     dwPCS = <a class="code" href="../../d2/d9/ps2_8c.html#a40">GetCPConnSpace</a>(pProfile);
01539     dwDev = <a class="code" href="../../d2/d9/ps2_8c.html#a41">GetCPDevSpace</a>(pProfile);
01540 
01541     <span class="comment">//</span>
01542     <span class="comment">// Call another function to handle Lab profiles</span>
01543     <span class="comment">//</span>
01544 
01545     <span class="keywordflow">if</span> (dwDev == SPACE_Lab)
01546     {
01547         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/ps2_8c.html#a185">GetPS2CSA_ABC_Lab</a>(pProfile, pBuffer, pcbSize, dwIntent, pbBinary);
01548     }
01549 
01550     <span class="comment">//</span>
01551     <span class="comment">// We only handle RGB profiles in this function</span>
01552     <span class="comment">//</span>
01553 
01554     <span class="keywordflow">if</span> ((dwDev != SPACE_RGB)                   ||
01555         !<a class="code" href="../../d2/d9/ps2_8c.html#a190">DoesTRCAndColorantTagExist</a>(pProfile))
01556     {
01557         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Colorant or TRC tag not present to create ABC CSA\n"</span>)));
01558         SetLastError(ERROR_TAG_NOT_PRESENT);
01559         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01560     }
01561 
01562     <span class="comment">//</span>
01563     <span class="comment">// Estimate size required to hold the CSA</span>
01564     <span class="comment">//</span>
01565 
01566     dwSize = 65530;
01567 
01568     <span class="keywordflow">if</span> (! pBuffer)
01569     {
01570         *pcbSize = dwSize;
01571         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01572     }
01573     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*pcbSize &lt; dwSize)
01574     {
01575         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get ABC CSA\n"</span>)));
01576         SetLastError(ERROR_INSUFFICIENT_BUFFER);
01577         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01578     }
01579 
01580     <span class="comment">//</span>
01581     <span class="comment">// Get info about Illuminant White Point from the header</span>
01582     <span class="comment">//</span>
01583 
01584     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(pProfile, afxIlluminantWP);
01585 
01586     <span class="comment">//</span>
01587     <span class="comment">// Support absolute whitePoint</span>
01588     <span class="comment">//</span>
01589 
01590     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a209">GetMediaWP</a>(pProfile, dwIntent, afxIlluminantWP, afxMediaWP);
01591 
01592     <span class="comment">//</span>
01593     <span class="comment">// Create global data</span>
01594     <span class="comment">//</span>
01595 
01596     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a63">CieBasedABCBegin</a>);
01597 
01598     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a181">IsSRGBColorProfile</a>(pProfile))
01599     {
01600         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a178">sRGBColorSpaceArray</a>);
01601     }
01602     <span class="keywordflow">else</span>
01603     {
01604         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a220">EnableGlobalDict</a>(pBuffer);
01605 
01606         <span class="keywordflow">if</span> (bBackup)
01607         {
01608             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a87">NotSupportDEFG_S</a>);
01609         }
01610 
01611         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a221">BeginGlobalDict</a>(pBuffer);
01612 
01613         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a212">CreateColSpArray</a>(pProfile, pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a17">TAG_REDTRC</a>, *pbBinary);
01614         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a212">CreateColSpArray</a>(pProfile, pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a18">TAG_GREENTRC</a>, *pbBinary);
01615         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a212">CreateColSpArray</a>(pProfile, pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a19">TAG_BLUETRC</a>, *pbBinary);
01616 
01617         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a51">EndOp</a>);
01618 
01619         <span class="keywordflow">if</span> (bBackup)
01620         {
01621             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a88">SupportDEFG_E</a>);
01622         }
01623 
01624         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a48">SetGlobalOp</a>);
01625 
01626         <span class="keywordflow">if</span> (bBackup)
01627         {
01628             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a87">NotSupportDEFG_S</a>);
01629         }
01630 
01631         <span class="comment">//</span>
01632         <span class="comment">// Start creating the ColorSpace</span>
01633         <span class="comment">//</span>
01634 
01635         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);       <span class="comment">// Begin array</span>
01636 
01637         <span class="comment">//</span>
01638         <span class="comment">// /CIEBasedABC</span>
01639         <span class="comment">//</span>
01640 
01641         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a31">CIEBasedABCTag</a>);   <span class="comment">// Create entry</span>
01642         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a8">BeginDict</a>);        <span class="comment">// Begin dictionary</span>
01643 
01644         <span class="comment">//</span>
01645         <span class="comment">// /BlackPoint &amp; /WhitePoint</span>
01646         <span class="comment">//</span>
01647 
01648         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a208">SendCSABWPoint</a>(pBuffer, dwIntent, afxIlluminantWP, afxMediaWP);
01649 
01650         <span class="comment">//</span>
01651         <span class="comment">// /DecodeABC</span>
01652         <span class="comment">//</span>
01653 
01654         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a35">DecodeABCTag</a>);
01655         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
01656 
01657         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01658         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a213">CreateColSpProc</a>(pProfile, pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a17">TAG_REDTRC</a>, *pbBinary);
01659         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01660         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a213">CreateColSpProc</a>(pProfile, pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a18">TAG_GREENTRC</a>, *pbBinary);
01661         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01662         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a213">CreateColSpProc</a>(pProfile, pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a19">TAG_BLUETRC</a>, *pbBinary);
01663         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
01664 
01665         <span class="comment">//</span>
01666         <span class="comment">// /MatrixABC</span>
01667         <span class="comment">//</span>
01668 
01669         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a24">MatrixABCTag</a>);
01670         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
01671 
01672         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a214">CreateFloatString</a>(pProfile, pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a14">TAG_REDCOLORANT</a>);
01673         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a214">CreateFloatString</a>(pProfile, pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a15">TAG_GREENCOLORANT</a>);
01674         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a214">CreateFloatString</a>(pProfile, pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a16">TAG_BLUECOLORANT</a>);
01675 
01676         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
01677 
01678         <span class="comment">//</span>
01679         <span class="comment">// /RangeLMN</span>
01680         <span class="comment">//</span>
01681 
01682         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01683         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a26">RangeLMNTag</a>);
01684         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a70">RangeLMN</a>);
01685 
01686         <span class="comment">//</span>
01687         <span class="comment">// /DecodeLMN</span>
01688         <span class="comment">//</span>
01689 
01690         <span class="keywordflow">if</span> (dwIntent == INTENT_ABSOLUTE_COLORIMETRIC)
01691         {
01692             <span class="comment">//</span>
01693             <span class="comment">// Support absolute whitePoint</span>
01694             <span class="comment">//</span>
01695 
01696             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a36">DecodeLMNTag</a>);
01697             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
01698             <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
01699             {
01700                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
01701                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a9">FIX_DIV</a>(afxMediaWP[i], afxIlluminantWP[i]));
01702                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a54">MulOp</a>);
01703                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
01704             }
01705             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a> (pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
01706         }
01707 
01708         <span class="comment">//</span>
01709         <span class="comment">// End dictionary definition</span>
01710         <span class="comment">//</span>
01711 
01712         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a9">EndDict</a>);
01713         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
01714 
01715         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a67">CieBasedABCEnd</a>);
01716     }
01717 
01718     *pcbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
01719 
01720     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01721 }
01722 
01723 
01724 <span class="comment">/******************************************************************************</span>
01725 <span class="comment"> *</span>
01726 <span class="comment"> *                              GetPS2CSA_ABC_Lab</span>
01727 <span class="comment"> *</span>
01728 <span class="comment"> *  Function:</span>
01729 <span class="comment"> *       This function creates a CIEBasedABC colorspace array from an input</span>
01730 <span class="comment"> *       Lab profile</span>
01731 <span class="comment"> *</span>
01732 <span class="comment"> *  Arguments:</span>
01733 <span class="comment"> *       pProfile  - pointer to the memory mapped profile</span>
01734 <span class="comment"> *       pBuffer   - pointer to receive the CSA</span>
01735 <span class="comment"> *       pcbSize   - pointer to size of buffer. If function fails because</span>
01736 <span class="comment"> *                   buffer is not big enough, it is filled with required size.</span>
01737 <span class="comment"> *       dwIntent  - rendering intent of CSA requested</span>
01738 <span class="comment"> *       pcbBinary - TRUE if binary data is requested. On return it is set to</span>
01739 <span class="comment"> *                   reflect the data returned</span>
01740 <span class="comment"> *</span>
01741 <span class="comment"> *  Returns:</span>
01742 <span class="comment"> *       TRUE if successful, FALSE otherwise</span>
01743 <span class="comment"> *</span>
01744 <span class="comment"> ******************************************************************************/</span>
01745 
01746 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l01747"></a><a class="code" href="../../d2/d9/ps2_8c.html#a185">01747</a> <a class="code" href="../../d2/d9/ps2_8c.html#a185">GetPS2CSA_ABC_Lab</a>(
01748     PBYTE  pProfile,
01749     PBYTE  pBuffer,
01750     PDWORD pcbSize,
01751     DWORD  dwIntent,
01752     PBOOL  pbBinary
01753     )
01754 {
01755     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>     pStart = pBuffer;
01756     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     i, dwSize;
01757     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> afxIlluminantWP[3];
01758     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> afxMediaWP[3];
01759 
01760     <span class="comment">//</span>
01761     <span class="comment">// Estimate size required to hold the CSA</span>
01762     <span class="comment">//</span>
01763 
01764     dwSize = 65530;
01765 
01766     <span class="keywordflow">if</span> (! pBuffer)
01767     {
01768         *pcbSize = dwSize;
01769         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01770     }
01771     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*pcbSize &lt; dwSize)
01772     {
01773         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get ABC_Lab CSA\n"</span>)));
01774         SetLastError(ERROR_INSUFFICIENT_BUFFER);
01775         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01776     }
01777 
01778     <span class="comment">//</span>
01779     <span class="comment">// Get info about Illuminant White Point from the header</span>
01780     <span class="comment">//</span>
01781 
01782     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(pProfile, afxIlluminantWP);
01783 
01784     <span class="comment">//</span>
01785     <span class="comment">// Support absolute whitePoint</span>
01786     <span class="comment">//</span>
01787 
01788     <a class="code" href="../../d2/d9/ps2_8c.html#a209">GetMediaWP</a>(pProfile, dwIntent, afxIlluminantWP, afxMediaWP);
01789 
01790     <span class="comment">//</span>
01791     <span class="comment">// Start creating the ColorSpace</span>
01792     <span class="comment">//</span>
01793 
01794     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);       <span class="comment">// Begin array</span>
01795 
01796     <span class="comment">//</span>
01797     <span class="comment">// /CIEBasedABC</span>
01798     <span class="comment">//</span>
01799 
01800     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a31">CIEBasedABCTag</a>);   <span class="comment">// Create entry</span>
01801     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a8">BeginDict</a>);        <span class="comment">// Begin dictionary</span>
01802 
01803     <span class="comment">//</span>
01804     <span class="comment">// /BlackPoint &amp; /WhitePoint</span>
01805     <span class="comment">//</span>
01806 
01807     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a208">SendCSABWPoint</a>(pBuffer, dwIntent, afxIlluminantWP, afxMediaWP);
01808 
01809     <span class="comment">//</span>
01810     <span class="comment">// /RangeABC</span>
01811     <span class="comment">//</span>
01812 
01813     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a22">RangeABCTag</a>);
01814     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a72">RangeABC_Lab</a>);
01815 
01816     <span class="comment">//</span>
01817     <span class="comment">// /DecodeABC</span>
01818     <span class="comment">//</span>
01819 
01820     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a35">DecodeABCTag</a>);
01821     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a97">DecodeABCLab1</a>);
01822 
01823     <span class="comment">//</span>
01824     <span class="comment">// /MatrixABC</span>
01825     <span class="comment">//</span>
01826 
01827     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a24">MatrixABCTag</a>);
01828     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a96">MatrixABCLab</a>);
01829 
01830     <span class="comment">//</span>
01831     <span class="comment">// /DecodeLMN</span>
01832     <span class="comment">//</span>
01833 
01834     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a36">DecodeLMNTag</a>);
01835     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
01836     <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
01837     {
01838         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
01839         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a99">DecodeLMNLab</a>);
01840 
01841         <span class="keywordflow">if</span> (dwIntent == INTENT_ABSOLUTE_COLORIMETRIC)
01842         {
01843             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, afxMediaWP[i]);
01844         }
01845         <span class="keywordflow">else</span>
01846         {
01847             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, afxIlluminantWP[i]);
01848         }
01849         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a54">MulOp</a>);
01850         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
01851         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
01852     }
01853     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
01854 
01855 
01856     <span class="comment">//</span>
01857     <span class="comment">// End dictionary definition</span>
01858     <span class="comment">//</span>
01859 
01860     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a9">EndDict</a>);
01861     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
01862 
01863     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a67">CieBasedABCEnd</a>);
01864 
01865     *pcbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
01866 
01867     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01868 }
01869 
01870 
01871 <span class="comment">/******************************************************************************</span>
01872 <span class="comment"> *</span>
01873 <span class="comment"> *                           GetPS2CSA_DEFG</span>
01874 <span class="comment"> *</span>
01875 <span class="comment"> *  Function:</span>
01876 <span class="comment"> *       This function creates DEF and DEFG based CSAs from the data supplied</span>
01877 <span class="comment"> *       in the RGB or CMYK profiles respectively</span>
01878 <span class="comment"> *</span>
01879 <span class="comment"> *  Arguments:</span>
01880 <span class="comment"> *       pProfile  - pointer to the memory mapped profile</span>
01881 <span class="comment"> *       pBuffer   - pointer to receive the CSA</span>
01882 <span class="comment"> *       pcbSize   - pointer to size of buffer. If function fails because</span>
01883 <span class="comment"> *                   buffer is not big enough, it is filled with required size.</span>
01884 <span class="comment"> *       dwIntent  - rendering intent of CSA requested</span>
01885 <span class="comment"> *       dwType    - whether DEF CSA or DEFG CSA is required</span>
01886 <span class="comment"> *       pcbBinary - TRUE if binary data is requested. On return it is set to</span>
01887 <span class="comment"> *                   reflect the data returned</span>
01888 <span class="comment"> *</span>
01889 <span class="comment"> *  Returns:</span>
01890 <span class="comment"> *       TRUE if successful, FALSE otherwise</span>
01891 <span class="comment"> *</span>
01892 <span class="comment"> ******************************************************************************/</span>
01893 
01894 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l01895"></a><a class="code" href="../../d2/d9/ps2_8c.html#a186">01895</a> <a class="code" href="../../d2/d9/ps2_8c.html#a186">GetPS2CSA_DEFG</a>(
01896     PBYTE  pProfile,
01897     PBYTE  pBuffer,
01898     PDWORD pcbSize,
01899     DWORD  dwIntent,
01900     DWORD  dwType,
01901     PBOOL  pbBinary
01902     )
01903 {
01904     <a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a> pLut;
01905     PTAGDATA   pTagData;
01906     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pLineStart, pStart = pBuffer;
01907     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pTable;
01908     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      i, j, k, dwPCS, dwDev, dwIndex, dwTag, dwLutSig, SecondGrids, dwSize;
01909     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      nInputCh, nOutputCh, nGrids, nInputTable, nOutputTable, nNumbers;
01910     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>  afxIlluminantWP[3];
01911     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>  afxMediaWP[3];
01912     <span class="keywordtype">char</span>       pPublicArrayName[5];
01913 
01914     <span class="comment">//</span>
01915     <span class="comment">// Make sure required tags exist</span>
01916     <span class="comment">//</span>
01917 
01918     <span class="keywordflow">switch</span> (dwIntent)
01919     {
01920     <span class="keywordflow">case</span> INTENT_PERCEPTUAL:
01921         dwTag = <a class="code" href="../../d2/d9/ps2_8c.html#a22">TAG_AToB0</a>;
01922         <span class="keywordflow">break</span>;
01923 
01924     <span class="keywordflow">case</span> INTENT_RELATIVE_COLORIMETRIC:
01925         dwTag = <a class="code" href="../../d2/d9/ps2_8c.html#a23">TAG_AToB1</a>;
01926         <span class="keywordflow">break</span>;
01927 
01928     <span class="keywordflow">case</span> INTENT_SATURATION:
01929         dwTag = <a class="code" href="../../d2/d9/ps2_8c.html#a24">TAG_AToB2</a>;
01930         <span class="keywordflow">break</span>;
01931 
01932     <span class="keywordflow">case</span> INTENT_ABSOLUTE_COLORIMETRIC:
01933         dwTag = <a class="code" href="../../d2/d9/ps2_8c.html#a23">TAG_AToB1</a>;
01934         <span class="keywordflow">break</span>;
01935 
01936     <span class="keywordflow">default</span>:
01937         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid intent passed to GetPS2CSA_DEFG: %d\n"</span>), dwIntent));
01938         SetLastError(ERROR_INVALID_PARAMETER);
01939         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01940     }
01941 
01942     <span class="keywordflow">if</span> (! <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, dwTag, &amp;dwIndex))
01943     {
01944         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"AToB%d tag not present to create DEF(G) CSA\n"</span>), dwIntent));
01945         SetLastError(ERROR_TAG_NOT_PRESENT);
01946         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01947     }
01948 
01949     <span class="comment">//</span>
01950     <span class="comment">// Check if we can generate the CSA</span>
01951     <span class="comment">// Required  tags is AToBi, where i is the rendering intent</span>
01952     <span class="comment">//</span>
01953 
01954     dwPCS = <a class="code" href="../../d2/d9/ps2_8c.html#a40">GetCPConnSpace</a>(pProfile);
01955     dwDev = <a class="code" href="../../d2/d9/ps2_8c.html#a41">GetCPDevSpace</a>(pProfile);
01956 
01957     <span class="keywordflow">if</span> ((dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a0">TYPE_CIEBASEDDEF</a>  &amp;&amp; dwDev != SPACE_RGB) ||
01958         (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a> &amp;&amp; dwDev != SPACE_CMYK))
01959     {
01960         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"RGB profile &amp; requesting CMYK CSA or vice versa\n"</span>)));
01961         SetLastError(ERROR_TAG_NOT_PRESENT);
01962         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01963     }
01964 
01965     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
01966                dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
01967 
01968     pLut = (<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
01969 
01970     dwLutSig = FIX_ENDIAN(pLut-&gt;<a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o0">dwSignature</a>);
01971 
01972     <span class="keywordflow">if</span> (((dwPCS != SPACE_Lab) &amp;&amp; (dwPCS != SPACE_XYZ)) ||
01973         ((dwLutSig != <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>) &amp;&amp; (dwLutSig != <a class="code" href="../../d2/d9/ps2_8c.html#a38">LUT16_TYPE</a>)))
01974     {
01975         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid color space - unable to create DEF(G) CSA\n"</span>)));
01976         SetLastError(ERROR_INVALID_PROFILE);
01977         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01978     }
01979 
01980     <span class="comment">//</span>
01981     <span class="comment">// Estimate size required to hold the CSA</span>
01982     <span class="comment">//</span>
01983 
01984     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a219">GetCLUTInfo</a>(dwLutSig, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut, &amp;nInputCh, &amp;nOutputCh, &amp;nGrids,
01985                 &amp;nInputTable, &amp;nOutputTable, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01986 
01987     <span class="comment">//</span>
01988     <span class="comment">// Calculate size of buffer needed</span>
01989     <span class="comment">//</span>
01990 
01991     <span class="keywordflow">if</span> (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)
01992     {
01993         dwSize = nOutputCh * nGrids * nGrids * nGrids * nGrids * 2;
01994     }
01995     <span class="keywordflow">else</span>
01996     {
01997         dwSize = nOutputCh * nGrids * nGrids * nGrids * 2;
01998     }
01999 
02000     dwSize = dwSize +
02001         nInputCh * nInputTable * 6 +
02002         nOutputCh * nOutputTable * 6 +      <span class="comment">// Number of INT bytes</span>
02003         nInputCh * (<a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>) +
02004                     <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a89">StartClip</a>) +
02005                     <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a90">EndClip</a>)) +
02006         nOutputCh * (<a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>) +
02007                      <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a89">StartClip</a>) +
02008                      <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a90">EndClip</a>)) +
02009         4096;                               <span class="comment">// + other PS stuff</span>
02010 
02011     <span class="comment">//</span>
02012     <span class="comment">// Add space for new line.</span>
02013     <span class="comment">//</span>
02014 
02015     dwSize += (((dwSize) / <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>) + 1) * <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
02016 
02017     <span class="keywordflow">if</span> (! pBuffer)
02018     {
02019         *pcbSize = dwSize;
02020         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02021     }
02022     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*pcbSize &lt; dwSize)
02023     {
02024         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get DEFG CSA\n"</span>)));
02025         SetLastError(ERROR_INSUFFICIENT_BUFFER);
02026         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02027     }
02028 
02029     <span class="comment">//</span>
02030     <span class="comment">// Get info about Illuminant White Point from the header</span>
02031     <span class="comment">//</span>
02032 
02033     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(pProfile, afxIlluminantWP);
02034 
02035     <span class="comment">//</span>
02036     <span class="comment">// Support absolute whitePoint</span>
02037     <span class="comment">//</span>
02038 
02039     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a209">GetMediaWP</a>(pProfile, dwIntent, afxIlluminantWP, afxMediaWP);
02040 
02041     <span class="comment">//</span>
02042     <span class="comment">// Testing CieBasedDEFG support</span>
02043     <span class="comment">//</span>
02044 
02045     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a85">TestingDEFG</a>);
02046 
02047     <span class="comment">//</span>
02048     <span class="comment">// Create global data</span>
02049     <span class="comment">//</span>
02050 
02051     <a class="code" href="../../d2/d9/ps2_8c.html#a217">GetPublicArrayName</a>(dwTag, pPublicArrayName);
02052 
02053     <span class="keywordflow">if</span> (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)
02054     {
02055         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a61">CieBasedDEFGBegin</a>);
02056     }
02057     <span class="keywordflow">else</span>
02058     {
02059         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a62">CieBasedDEFBegin</a>);
02060     }
02061 
02062     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a220">EnableGlobalDict</a>(pBuffer);
02063     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a86">SupportDEFG_S</a>);
02064     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a221">BeginGlobalDict</a>(pBuffer);
02065 
02066     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a215">CreateInputArray</a>(pBuffer, nInputCh, nInputTable,
02067                  pPublicArrayName, dwLutSig, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut, *pbBinary, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
02068 
02069     <span class="keywordflow">if</span> (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)
02070     {
02071         i = nInputTable * nInputCh +
02072             nGrids * nGrids * nGrids * nGrids * nOutputCh;
02073     }
02074     <span class="keywordflow">else</span>
02075     {
02076         i = nInputTable * nInputCh +
02077             nGrids * nGrids * nGrids * nOutputCh;
02078     }
02079     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a216">CreateOutputArray</a>(pBuffer, nOutputCh, nOutputTable, i,
02080                  pPublicArrayName, dwLutSig, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut, *pbBinary, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
02081 
02082     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a51">EndOp</a>);
02083     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a88">SupportDEFG_E</a>);
02084     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a48">SetGlobalOp</a>);
02085     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a86">SupportDEFG_S</a>);
02086 
02087     <span class="comment">//</span>
02088     <span class="comment">// Start creating the ColorSpace</span>
02089     <span class="comment">//</span>
02090 
02091     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);   <span class="comment">// Begin array</span>
02092 
02093     <span class="comment">//</span>
02094     <span class="comment">// /CIEBasedDEF(G)</span>
02095     <span class="comment">//</span>
02096 
02097     <span class="keywordflow">if</span> (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)
02098     {
02099         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a32">CIEBasedDEFGTag</a>);
02100     }
02101     <span class="keywordflow">else</span>
02102     {
02103         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a33">CIEBasedDEFTag</a>);
02104     }
02105 
02106     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a8">BeginDict</a>);    <span class="comment">// Begin dictionary</span>
02107 
02108     <span class="comment">//</span>
02109     <span class="comment">// /BlackPoint &amp; /WhitePoint</span>
02110     <span class="comment">//</span>
02111 
02112     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a208">SendCSABWPoint</a>(pBuffer, dwIntent, afxIlluminantWP, afxMediaWP);
02113 
02114     <span class="comment">//</span>
02115     <span class="comment">// /DecodeDEF(G)</span>
02116     <span class="comment">//</span>
02117 
02118     pLineStart = pBuffer;
02119 
02120     <span class="keywordflow">if</span> (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)
02121     {
02122         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a41">DecodeDEFGTag</a>);
02123     }
02124     <span class="keywordflow">else</span>
02125     {
02126         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a42">DecodeDEFTag</a>);
02127     }
02128 
02129     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
02130     <span class="keywordflow">for</span> (i=0; i&lt;nInputCh; i++)
02131     {
02132         pLineStart = pBuffer;
02133 
02134         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
02135         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a89">StartClip</a>);
02136         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a77">InputArray</a>);
02137         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, pPublicArrayName);
02138         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, i);
02139 
02140         <span class="keywordflow">if</span> (! *pbBinary)               <span class="comment">// Output ASCII</span>
02141         {
02142             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>);
02143         }
02144         <span class="keywordflow">else</span>
02145         {                               <span class="comment">// Output BINARY</span>
02146             <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
02147             {
02148                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>);
02149             }
02150             <span class="keywordflow">else</span>
02151             {
02152                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a83">IndexArray16b</a>);
02153             }
02154         }
02155         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>) ? <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a91">Scale8</a> : <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a92">Scale16</a>);
02156         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a90">EndClip</a>);
02157         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
02158     }
02159     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
02160 
02161     <span class="comment">//</span>
02162     <span class="comment">// /Table</span>
02163     <span class="comment">//</span>
02164 
02165     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a40">TableTag</a>);
02166     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
02167 
02168     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, nGrids);  <span class="comment">// Send down Nh</span>
02169     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, nGrids);  <span class="comment">// Send down Ni</span>
02170     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, nGrids);  <span class="comment">// Send down Nj</span>
02171     nNumbers = nGrids * nGrids * nOutputCh;
02172     SecondGrids = 1;
02173 
02174     <span class="keywordflow">if</span> (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)
02175     {
02176         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a> (pBuffer, nGrids);  <span class="comment">// Send down Nk</span>
02177         SecondGrids = nGrids;
02178     }
02179     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
02180 
02181     <span class="keywordflow">for</span> (i=0; i&lt;nGrids; i++)        <span class="comment">// Nh strings should be sent</span>
02182     {
02183         <span class="keywordflow">if</span> (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)
02184         {
02185             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
02186         }
02187         <span class="keywordflow">for</span> (k=0; k&lt;SecondGrids; k++)
02188         {
02189             pLineStart = pBuffer;
02190             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
02191             <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
02192             {
02193                 pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(((<a class="code" href="../../d2/d9/ps2_8c.html#a62">PLUT8TYPE</a>)pLut)-&gt;data) +
02194                     nInputTable * nInputCh +
02195                     nNumbers * (i * SecondGrids + k);
02196             }
02197             <span class="keywordflow">else</span>
02198             {
02199                 pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;data) +
02200                     2 * nInputTable * nInputCh +
02201                     2 * nNumbers * (i * SecondGrids + k);
02202             }
02203 
02204             <span class="keywordflow">if</span> (! *pbBinary)           <span class="comment">// Output ASCII</span>
02205             {
02206                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a2">BeginString</a>);
02207                 <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
02208                 {
02209                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a227">WriteHexBuffer</a>(pBuffer, pTable, pLineStart, nNumbers);
02210                 }
02211                 <span class="keywordflow">else</span>
02212                 {
02213                     <span class="keywordflow">for</span> (j=0; j&lt;nNumbers; j++)
02214                     {
02215                         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a45">WriteHex</a>(pBuffer, FIX_ENDIAN16(*((PWORD)pTable)) / 256);
02216                         pTable += <span class="keyword">sizeof</span>(WORD);
02217 
02218                         <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pLineStart)) &gt; <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>)
02219                         {
02220                             pLineStart = pBuffer;
02221                             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
02222                         }
02223                     }
02224                 }
02225                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a3">EndString</a>);
02226             }
02227             <span class="keywordflow">else</span>
02228             {                           <span class="comment">// Output BINARY</span>
02229                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a228">WriteStringToken</a>(pBuffer, 143, nNumbers);
02230                 <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
02231                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a229">WriteByteString</a>(pBuffer, pTable, nNumbers);
02232                 <span class="keywordflow">else</span>
02233                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a230">WriteInt2ByteString</a>(pBuffer, pTable, nNumbers);
02234             }
02235             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a> (pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
02236         }
02237         <span class="keywordflow">if</span> (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)
02238         {
02239             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
02240         }
02241     }
02242     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
02243     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>); <span class="comment">// End array</span>
02244 
02245     <span class="comment">//</span>
02246     <span class="comment">// /DecodeABC</span>
02247     <span class="comment">//</span>
02248 
02249     pLineStart = pBuffer;
02250     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a35">DecodeABCTag</a>);
02251     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
02252     <span class="keywordflow">for</span> (i=0; i&lt;nOutputCh; i++)
02253     {
02254         pLineStart = pBuffer;
02255 
02256         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
02257         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a73">Clip01</a>);
02258         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a78">OutputArray</a>);
02259         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, pPublicArrayName);
02260         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, i);
02261 
02262         <span class="keywordflow">if</span> (! *pbBinary)
02263         {
02264             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
02265 
02266             <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
02267             {
02268                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a95">TFunction8XYZ</a>);
02269             }
02270             <span class="keywordflow">else</span>
02271             {
02272                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>);
02273                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a93">Scale16XYZ</a>);
02274             }
02275         }
02276         <span class="keywordflow">else</span>
02277         {
02278             <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
02279             {
02280                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a95">TFunction8XYZ</a>);
02281             }
02282             <span class="keywordflow">else</span>
02283             {
02284                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a83">IndexArray16b</a>);
02285                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a93">Scale16XYZ</a>);
02286             }
02287         }
02288 
02289         <span class="comment">//</span>
02290         <span class="comment">// Now, We get CieBasedXYZ output. Output range 0 --&gt; 1.99997</span>
02291         <span class="comment">// If the connection space is absolute XYZ, We need to convert</span>
02292         <span class="comment">// from relative XYZ to absolute XYZ.</span>
02293         <span class="comment">//</span>
02294 
02295         <span class="keywordflow">if</span> ((dwPCS == SPACE_XYZ) &amp;&amp; (dwIntent == INTENT_ABSOLUTE_COLORIMETRIC))
02296         {
02297             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a9">FIX_DIV</a>(afxMediaWP[i], afxIlluminantWP[i]));
02298             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a54">MulOp</a>);
02299         }
02300         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwPCS == SPACE_Lab)
02301         {
02302             <span class="comment">//</span>
02303             <span class="comment">// If the connection space is Lab, We need to convert XYZ to Lab</span>
02304             <span class="comment">//</span>
02305 
02306             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a172">DecodeABCLab</a>[i]);
02307         }
02308         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
02309     }
02310     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
02311 
02312     <span class="keywordflow">if</span> (dwPCS == SPACE_Lab)
02313     {
02314         <span class="comment">//</span>
02315         <span class="comment">// /MatrixABC</span>
02316         <span class="comment">//</span>
02317 
02318         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a24">MatrixABCTag</a>);
02319         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a96">MatrixABCLab</a>);
02320 
02321         <span class="comment">//</span>
02322         <span class="comment">// /DecodeLMN</span>
02323         <span class="comment">//</span>
02324 
02325         pLineStart = pBuffer;
02326         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a36">DecodeLMNTag</a>);
02327         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
02328         <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
02329         {
02330             pLineStart = pBuffer;
02331 
02332             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
02333             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a99">DecodeLMNLab</a>);
02334             <span class="keywordflow">if</span> (dwIntent == INTENT_ABSOLUTE_COLORIMETRIC)
02335             {
02336                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, afxMediaWP[i]);
02337             }
02338             <span class="keywordflow">else</span>
02339             {
02340                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, afxIlluminantWP[i]);
02341             }
02342             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a54">MulOp</a>);
02343             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
02344         }
02345         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
02346     }
02347     <span class="keywordflow">else</span>
02348     {
02349         <span class="comment">//</span>
02350         <span class="comment">// /RangeLMN</span>
02351         <span class="comment">//</span>
02352 
02353         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a26">RangeLMNTag</a>);
02354         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a70">RangeLMN</a>);
02355     }
02356 
02357     <span class="comment">//</span>
02358     <span class="comment">// End dictionary definition</span>
02359     <span class="comment">//</span>
02360 
02361     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a9">EndDict</a>);
02362     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
02363 
02364     <span class="keywordflow">if</span> (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)
02365     {
02366         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a65">CieBasedDEFGEnd</a>);
02367     }
02368     <span class="keywordflow">else</span>
02369     {
02370         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a66">CieBasedDEFEnd</a>);
02371     }
02372 
02373     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a88">SupportDEFG_E</a>);
02374 
02375     *pcbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
02376 
02377     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02378 }
02379 
02380 
02381 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l02382"></a><a class="code" href="../../d2/d9/ps2_8c.html#a258">02382</a> <a class="code" href="../../d2/d9/ps2_8c.html#a258">InternalGetPS2CSAFromLCS</a>(
02383     LPLOGCOLORSPACE pLogColorSpace,
02384     PBYTE           pBuffer,
02385     PDWORD          pcbSize,
02386     PBOOL           pbBinary
02387     )
02388 {
02389     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>  pStart = pBuffer;
02390     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  dwSize = 1024*2; <span class="comment">// same value as in pscript/icm.c</span>
02391 
02392     <span class="keywordflow">if</span> (! pBuffer)
02393     {
02394         *pcbSize = dwSize;
02395 
02396         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02397     }
02398 
02399     <span class="keywordflow">if</span> (*pcbSize &lt; dwSize)
02400     {
02401         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get CSA from LCS\n"</span>)));
02402         SetLastError(ERROR_INSUFFICIENT_BUFFER);
02403         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02404     }
02405 
02406     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
02407     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);    <span class="comment">// Begin array</span>
02408 
02409     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a173">ColorSpace1</a>);
02410     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);    <span class="comment">// [</span>
02411 
02412     <span class="comment">//</span>
02413     <span class="comment">// Red gamma</span>
02414     <span class="comment">//</span>
02415 
02416     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
02417     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, pLogColorSpace-&gt;lcsGammaRed);
02418     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a174">ColorSpace3</a>);
02419 
02420     <span class="comment">//</span>
02421     <span class="comment">// Green gamma</span>
02422     <span class="comment">//</span>
02423 
02424     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
02425     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, pLogColorSpace-&gt;lcsGammaGreen);
02426     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a174">ColorSpace3</a>);
02427 
02428     <span class="comment">//</span>
02429     <span class="comment">// Blue Gamma</span>
02430     <span class="comment">//</span>
02431 
02432     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
02433     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, pLogColorSpace-&gt;lcsGammaBlue);
02434     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a174">ColorSpace3</a>);
02435 
02436     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);      <span class="comment">// ]</span>
02437 
02438     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a175">ColorSpace5</a>);   <span class="comment">// /WhitePoint</span>
02439 
02440     <span class="comment">//</span>
02441     <span class="comment">// Matrix LMN</span>
02442     <span class="comment">//</span>
02443 
02444     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a27">MatrixLMNTag</a>);
02445     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
02446 
02447     <span class="comment">//</span>
02448     <span class="comment">// Red Value</span>
02449     <span class="comment">//</span>
02450 
02451     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a232">WriteFixed2dot30</a>(pBuffer, pLogColorSpace-&gt;lcsEndpoints.ciexyzRed.ciexyzX);
02452     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a232">WriteFixed2dot30</a>(pBuffer, pLogColorSpace-&gt;lcsEndpoints.ciexyzRed.ciexyzY);
02453     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a232">WriteFixed2dot30</a>(pBuffer, pLogColorSpace-&gt;lcsEndpoints.ciexyzRed.ciexyzZ);
02454 
02455     <span class="comment">//</span>
02456     <span class="comment">// Green Value</span>
02457     <span class="comment">//</span>
02458 
02459     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a232">WriteFixed2dot30</a>(pBuffer, pLogColorSpace-&gt;lcsEndpoints.ciexyzGreen.ciexyzX);
02460     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a232">WriteFixed2dot30</a>(pBuffer, pLogColorSpace-&gt;lcsEndpoints.ciexyzGreen.ciexyzY);
02461     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a232">WriteFixed2dot30</a>(pBuffer, pLogColorSpace-&gt;lcsEndpoints.ciexyzGreen.ciexyzZ);
02462 
02463     <span class="comment">//</span>
02464     <span class="comment">// Blue Value</span>
02465     <span class="comment">//</span>
02466 
02467     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a232">WriteFixed2dot30</a>(pBuffer, pLogColorSpace-&gt;lcsEndpoints.ciexyzBlue.ciexyzX);
02468     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a232">WriteFixed2dot30</a>(pBuffer, pLogColorSpace-&gt;lcsEndpoints.ciexyzBlue.ciexyzY);
02469     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a232">WriteFixed2dot30</a>(pBuffer, pLogColorSpace-&gt;lcsEndpoints.ciexyzBlue.ciexyzZ);
02470 
02471     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);      <span class="comment">// ]</span>
02472     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a9">EndDict</a>);       <span class="comment">// End dictionary</span>
02473 
02474     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);      <span class="comment">// ]</span>
02475 
02476     *pcbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
02477 
02478     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02479 }
02480 
02481 
02482 <span class="comment">/******************************************************************************</span>
02483 <span class="comment"> *</span>
02484 <span class="comment"> *                           CreateColorSpArray</span>
02485 <span class="comment"> *</span>
02486 <span class="comment"> *  Function:</span>
02487 <span class="comment"> *       This function creates an array that is used in /DecodeABC</span>
02488 <span class="comment"> *</span>
02489 <span class="comment"> *  Arguments:</span>
02490 <span class="comment"> *       pProfile  - pointer to the memory mapped profile</span>
02491 <span class="comment"> *       pBuffer   - pointer to receive the array</span>
02492 <span class="comment"> *       dwCPTag   - Channel TRC tag</span>
02493 <span class="comment"> *       bBinary   - TRUE if binary data is requested</span>
02494 <span class="comment"> *</span>
02495 <span class="comment"> *  Returns:</span>
02496 <span class="comment"> *       Length of the data created in bytes</span>
02497 <span class="comment"> *</span>
02498 <span class="comment"> ******************************************************************************/</span>
02499 
02500 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l02501"></a><a class="code" href="../../d2/d9/ps2_8c.html#a212">02501</a> <a class="code" href="../../d2/d9/ps2_8c.html#a212">CreateColSpArray</a>(
02502     PBYTE pProfile,
02503     PBYTE pBuffer,
02504     DWORD dwCPTag,
02505     BOOL  bBinary
02506     )
02507 {
02508     <a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a> pData;
02509     PTAGDATA   pTagData;
02510     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pLineStart, pStart = pBuffer;
02511     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pTable;
02512     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      i, nCount, dwIndex;
02513 
02514     pLineStart = pBuffer;
02515 
02516     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, dwCPTag, &amp;dwIndex))
02517     {
02518         pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
02519                    dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
02520 
02521         pData = (<a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
02522 
02523         nCount = FIX_ENDIAN(pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
02524 
02525         <span class="keywordflow">if</span> (nCount &gt; 1)
02526         {
02527             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a57">Slash</a>);
02528             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a76">DecodeABCArray</a>);
02529             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, dwCPTag);
02530 
02531             pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o3">data</a>);
02532 
02533             <span class="keywordflow">if</span> (! bBinary)           <span class="comment">// Output ASCII CS</span>
02534             {
02535                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
02536                 <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
02537                 {
02538                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, FIX_ENDIAN16(*((PWORD)pTable)));
02539                     pTable += <span class="keyword">sizeof</span>(WORD);
02540 
02541                     <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pLineStart)) &gt; <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>)
02542                     {
02543                         pLineStart = pBuffer;
02544                         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
02545                     }
02546                 }
02547                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
02548             }
02549             <span class="keywordflow">else</span>
02550             {                           <span class="comment">// Output BINARY CS</span>
02551                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a224">WriteHNAToken</a>(pBuffer, 149, nCount);
02552                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a225">WriteIntStringU2S</a>(pBuffer, pTable, nCount);
02553             }
02554 
02555             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a49">DefOp</a>);
02556         }
02557     }
02558     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
02559 }
02560 
02561 
02562 <span class="comment">/******************************************************************************</span>
02563 <span class="comment"> *</span>
02564 <span class="comment"> *                           CreateColorSpProc</span>
02565 <span class="comment"> *</span>
02566 <span class="comment"> *  Function:</span>
02567 <span class="comment"> *       This function creates a PostScript procedure for the color space</span>
02568 <span class="comment"> *</span>
02569 <span class="comment"> *  Arguments:</span>
02570 <span class="comment"> *       pProfile  - pointer to the memory mapped profile</span>
02571 <span class="comment"> *       pBuffer   - pointer to receive the procedure</span>
02572 <span class="comment"> *       dwCPTag   - Channel TRC tag</span>
02573 <span class="comment"> *       bBinary   - TRUE if binary data is requested</span>
02574 <span class="comment"> *</span>
02575 <span class="comment"> *  Returns:</span>
02576 <span class="comment"> *       Length of the data created in bytes</span>
02577 <span class="comment"> *</span>
02578 <span class="comment"> ******************************************************************************/</span>
02579 
02580 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l02581"></a><a class="code" href="../../d2/d9/ps2_8c.html#a213">02581</a> <a class="code" href="../../d2/d9/ps2_8c.html#a213">CreateColSpProc</a>(
02582     PBYTE pProfile,
02583     PBYTE pBuffer,
02584     DWORD dwCPTag,
02585     BOOL  bBinary
02586     )
02587 {
02588     <a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a> pData;
02589     PTAGDATA   pTagData;
02590     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pStart = pBuffer;
02591     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pTable;
02592     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      nCount, dwIndex;
02593 
02594     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
02595 
02596     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, dwCPTag, &amp;dwIndex))
02597     {
02598         pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
02599                    dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
02600 
02601         pData = (<a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
02602 
02603         nCount = FIX_ENDIAN(pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
02604 
02605         <span class="keywordflow">if</span> (nCount != 0)
02606         {
02607             <span class="keywordflow">if</span> (nCount == 1)            <span class="comment">// Gamma supplied in ui16 format</span>
02608             {
02609                 pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o3">data</a>);
02610                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, FIX_ENDIAN16(*((PWORD)pTable)));
02611                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a74">DecodeA3</a>);
02612             }
02613             <span class="keywordflow">else</span>
02614             {
02615                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a89">StartClip</a>);
02616                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a76">DecodeABCArray</a>);
02617                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, dwCPTag);
02618 
02619                 <span class="keywordflow">if</span> (! bBinary)       <span class="comment">// Output ASCII CS</span>
02620                 {
02621                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>);
02622                 }
02623                 <span class="keywordflow">else</span>
02624                 {                    <span class="comment">// Output BINARY CS</span>
02625                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a83">IndexArray16b</a>);
02626                 }
02627                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a92">Scale16</a>);
02628                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a90">EndClip</a>);
02629             }
02630         }
02631     }
02632     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
02633 
02634     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
02635 }
02636 
02637 
02638 <span class="comment">/******************************************************************************</span>
02639 <span class="comment"> *</span>
02640 <span class="comment"> *                           CreateFloatString</span>
02641 <span class="comment"> *</span>
02642 <span class="comment"> *  Function:</span>
02643 <span class="comment"> *       This function creates a string of floating point numbers for</span>
02644 <span class="comment"> *       the X, Y and Z values of the specified colorant.</span>
02645 <span class="comment"> *</span>
02646 <span class="comment"> *  Arguments:</span>
02647 <span class="comment"> *       pProfile  - pointer to the memory mapped profile</span>
02648 <span class="comment"> *       pBuffer   - pointer to receive the string</span>
02649 <span class="comment"> *       dwCPTag   - Colorant tag</span>
02650 <span class="comment"> *</span>
02651 <span class="comment"> *  Returns:</span>
02652 <span class="comment"> *       Length of the data created in bytes</span>
02653 <span class="comment"> *</span>
02654 <span class="comment"> ******************************************************************************/</span>
02655 
02656 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l02657"></a><a class="code" href="../../d2/d9/ps2_8c.html#a214">02657</a> <a class="code" href="../../d2/d9/ps2_8c.html#a214">CreateFloatString</a>(
02658     PBYTE pProfile,
02659     PBYTE pBuffer,
02660     DWORD dwCPTag
02661     )
02662 {
02663     PTAGDATA   pTagData;
02664     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pStart = pBuffer;
02665     PDWORD     pTable;
02666     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      i, dwIndex;
02667 
02668     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, dwCPTag, &amp;dwIndex))
02669     {
02670         pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
02671                    dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
02672 
02673         pTable = (PDWORD)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset)) + 2;
02674 
02675         <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
02676         {
02677             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, FIX_ENDIAN(*pTable));
02678             pTable ++;
02679         }
02680     }
02681 
02682     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
02683 }
02684 
02685 
02686 <span class="comment">/******************************************************************************</span>
02687 <span class="comment"> *</span>
02688 <span class="comment"> *                           CreateInputArray</span>
02689 <span class="comment"> *</span>
02690 <span class="comment"> *  Function:</span>
02691 <span class="comment"> *       This function creates the Color Rendering Dictionary (CRD)</span>
02692 <span class="comment"> *       from the data supplied in the ColorProfile's LUT8 or LUT16 tag.</span>
02693 <span class="comment"> *</span>
02694 <span class="comment"> *  Arguments:</span>
02695 <span class="comment"> *       pBuffer        - pointer to receive the data</span>
02696 <span class="comment"> *       nInputChannels - number of input channels</span>
02697 <span class="comment"> *       nInputTable    - size of input table</span>
02698 <span class="comment"> *       pIntent        - rendering intent signature (eg. A2B0)</span>
02699 <span class="comment"> *       dwTag          - signature of the look up table (8 or 16 bits)</span>
02700 <span class="comment"> *       pLut           - pointer to the look up table</span>
02701 <span class="comment"> *       bBinary        - TRUE if binary data is requested</span>
02702 <span class="comment"> *</span>
02703 <span class="comment"> *  Returns:</span>
02704 <span class="comment"> *       Length of the data created in bytes</span>
02705 <span class="comment"> *</span>
02706 <span class="comment"> ******************************************************************************/</span>
02707 
02708 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l02709"></a><a class="code" href="../../d2/d9/ps2_8c.html#a215">02709</a> <a class="code" href="../../d2/d9/ps2_8c.html#a215">CreateInputArray</a>(
02710     PBYTE pBuffer,
02711     DWORD nInputChannels,
02712     DWORD nInputTable,
02713     PBYTE pIntent,
02714     DWORD dwTag,
02715     PBYTE pLut,
02716     BOOL  bBinary,
02717     PBYTE pHostClut
02718     )
02719 {
02720     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i, j;
02721     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pLineStart, pStart = pBuffer;
02722     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pTable;
02723 
02724     <span class="keywordflow">if</span> (pHostClut)
02725     {
02726         nInputChannels = ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)pHostClut)-&gt;nInputCh;
02727         nInputTable = ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)pHostClut)-&gt;nInputEntries;
02728         dwTag = ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)pHostClut)-&gt;nLutBits == 8 ? <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a> : <a class="code" href="../../d2/d9/ps2_8c.html#a38">LUT16_TYPE</a>;
02729     }
02730 
02731     <span class="keywordflow">for</span> (i=0; i&lt;nInputChannels; i++)
02732     {
02733         pLineStart = pBuffer;
02734         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a57">Slash</a>);
02735         <span class="keywordflow">if</span> (pHostClut)
02736             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a79">PreViewInArray</a>);
02737         <span class="keywordflow">else</span>
02738             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a77">InputArray</a>);
02739 
02740         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, pIntent);
02741         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, i);
02742 
02743         <span class="keywordflow">if</span> (pHostClut)
02744         {
02745             pTable = ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)pHostClut)-&gt;inputArray[i];
02746         }
02747         <span class="keywordflow">else</span>
02748         {
02749             <span class="keywordflow">if</span> (dwTag == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
02750             {
02751                 pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(((<a class="code" href="../../d2/d9/ps2_8c.html#a62">PLUT8TYPE</a>)pLut)-&gt;data) + nInputTable * i;
02752             }
02753             <span class="keywordflow">else</span>
02754             {
02755                 pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;data) + 2 * nInputTable * i;
02756             }
02757         }
02758 
02759         <span class="keywordflow">if</span> (! bBinary)
02760         {
02761             <span class="keywordflow">if</span> (dwTag == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
02762             {
02763                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a2">BeginString</a>);
02764                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a227">WriteHexBuffer</a>(pBuffer, pTable, pLineStart, nInputTable);
02765                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a3">EndString</a>);
02766             }
02767             <span class="keywordflow">else</span>
02768             {
02769                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
02770                 <span class="keywordflow">for</span> (j=0; j&lt;nInputTable; j++)
02771                 {
02772                     <span class="keywordflow">if</span> (pHostClut)
02773                         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, *((PWORD)pTable));
02774                     <span class="keywordflow">else</span>
02775                         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, FIX_ENDIAN16(*((PWORD)pTable)));
02776                     pTable += <span class="keyword">sizeof</span>(WORD);
02777                     <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pLineStart)) &gt; <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>)
02778                     {
02779                         pLineStart = pBuffer;
02780                         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
02781                     }
02782                 }
02783                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
02784             }
02785         }
02786         <span class="keywordflow">else</span>
02787         {
02788             <span class="keywordflow">if</span> (dwTag == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
02789             {
02790                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a228">WriteStringToken</a>(pBuffer, 143, nInputTable);
02791                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a229">WriteByteString</a>(pBuffer, pTable, nInputTable);
02792             }
02793             <span class="keywordflow">else</span>
02794             {
02795                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a224">WriteHNAToken</a>(pBuffer, 149, nInputTable);
02796                 <span class="keywordflow">if</span> (pHostClut)
02797                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a226">WriteIntStringU2S_L</a>(pBuffer, pTable, nInputTable);
02798                 <span class="keywordflow">else</span>
02799                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a225">WriteIntStringU2S</a>(pBuffer, pTable, nInputTable);
02800             }
02801         }
02802         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a49">DefOp</a>);
02803     }
02804 
02805     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
02806 }
02807 
02808 
02809 
02810 <span class="comment">/******************************************************************************</span>
02811 <span class="comment"> *</span>
02812 <span class="comment"> *                           CreateOutputArray</span>
02813 <span class="comment"> *</span>
02814 <span class="comment"> *  Function:</span>
02815 <span class="comment"> *       This function creates the Color Rendering Dictionary (CRD)</span>
02816 <span class="comment"> *       from the data supplied in the ColorProfile's LUT8 or LUT16 tag.</span>
02817 <span class="comment"> *</span>
02818 <span class="comment"> *  Arguments:</span>
02819 <span class="comment"> *       pBuffer        - pointer to receive the data</span>
02820 <span class="comment"> *       nOutputChannels- number of output channels</span>
02821 <span class="comment"> *       nOutputTable   - size of output table</span>
02822 <span class="comment"> *       dwOffset       - offset into the output table</span>
02823 <span class="comment"> *       pIntent        - rendering intent signature (eg. A2B0)</span>
02824 <span class="comment"> *       dwTag          - signature of the look up table (8 or 16 bits)</span>
02825 <span class="comment"> *       pLut           - pointer to the look up table</span>
02826 <span class="comment"> *       bBinary        - TRUE if binary data is requested</span>
02827 <span class="comment"> *</span>
02828 <span class="comment"> *  Returns:</span>
02829 <span class="comment"> *       Length of the data created in bytes</span>
02830 <span class="comment"> *</span>
02831 <span class="comment"> ******************************************************************************/</span>
02832 
02833 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l02834"></a><a class="code" href="../../d2/d9/ps2_8c.html#a216">02834</a> <a class="code" href="../../d2/d9/ps2_8c.html#a216">CreateOutputArray</a>(
02835     PBYTE pBuffer,
02836     DWORD nOutputChannels,
02837     DWORD nOutputTable,
02838     DWORD dwOffset,
02839     PBYTE pIntent,
02840     DWORD dwTag,
02841     PBYTE pLut,
02842     BOOL  bBinary,
02843     PBYTE pHostClut
02844     )
02845 {
02846     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i, j;
02847     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pLineStart, pStart = pBuffer;
02848     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pTable;
02849 
02850     <span class="keywordflow">if</span> (pHostClut)
02851     {
02852         nOutputChannels = ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)pHostClut)-&gt;nOutputCh;
02853         nOutputTable = ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)pHostClut)-&gt;nOutputEntries;
02854         dwTag = ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)pHostClut)-&gt;nLutBits == 8 ? <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a> : <a class="code" href="../../d2/d9/ps2_8c.html#a38">LUT16_TYPE</a>;
02855     }
02856 
02857     <span class="keywordflow">for</span> (i=0; i&lt;nOutputChannels; i++)
02858     {
02859         pLineStart = pBuffer;
02860         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a57">Slash</a>);
02861         <span class="keywordflow">if</span> (pHostClut)
02862             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a80">PreViewOutArray</a>);
02863         <span class="keywordflow">else</span>
02864             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a78">OutputArray</a>);
02865         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, pIntent);
02866         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, i);
02867 
02868         <span class="keywordflow">if</span> (pHostClut)
02869         {
02870             pTable = ((<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)pHostClut)-&gt;outputArray[i];
02871         }
02872         <span class="keywordflow">else</span>
02873         {
02874             <span class="keywordflow">if</span> (dwTag == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
02875             {
02876                 pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(((<a class="code" href="../../d2/d9/ps2_8c.html#a62">PLUT8TYPE</a>)pLut)-&gt;data) +
02877                     dwOffset + nOutputTable * i;
02878             }
02879             <span class="keywordflow">else</span>
02880             {
02881                 pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;data) +
02882                     2 * dwOffset + 2 * nOutputTable * i;
02883             }
02884         }
02885 
02886         <span class="keywordflow">if</span> (! bBinary)
02887         {
02888             <span class="keywordflow">if</span> (dwTag == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
02889             {
02890                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a2">BeginString</a>);
02891                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a227">WriteHexBuffer</a>(pBuffer, pTable, pLineStart, nOutputTable);
02892                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a3">EndString</a>);
02893             }
02894             <span class="keywordflow">else</span>
02895             {
02896                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
02897                 <span class="keywordflow">for</span> (j=0; j&lt;nOutputTable; j++)
02898                 {
02899                     <span class="keywordflow">if</span> (pHostClut)
02900                         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, *((PWORD)pTable));
02901                     <span class="keywordflow">else</span>
02902                         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, FIX_ENDIAN16(*((PWORD)pTable)));
02903                     pTable += <span class="keyword">sizeof</span>(WORD);
02904                     <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pLineStart)) &gt; <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>)
02905                     {
02906                         pLineStart = pBuffer;
02907                         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
02908                     }
02909                 }
02910                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
02911             }
02912         }
02913         <span class="keywordflow">else</span>
02914         {
02915             <span class="keywordflow">if</span> (dwTag == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
02916             {
02917                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a228">WriteStringToken</a>(pBuffer, 143, 256);
02918                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a229">WriteByteString</a>(pBuffer, pTable, 256<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
02919             }
02920             <span class="keywordflow">else</span>
02921             {
02922                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a224">WriteHNAToken</a>(pBuffer, 149, nOutputTable);
02923                 <span class="keywordflow">if</span> (pHostClut)
02924                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a226">WriteIntStringU2S_L</a>(pBuffer, pTable, nOutputTable);
02925                 <span class="keywordflow">else</span>
02926                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a225">WriteIntStringU2S</a>(pBuffer, pTable, nOutputTable);
02927             }
02928         }
02929         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a49">DefOp</a>);
02930     }
02931 
02932     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
02933 }
02934 
02935 
02936 <span class="comment">/******************************************************************************</span>
02937 <span class="comment"> *</span>
02938 <span class="comment"> *                           GetPublicArrayName</span>
02939 <span class="comment"> *</span>
02940 <span class="comment"> *  Function:</span>
02941 <span class="comment"> *       This function creates a string with the lookup table's signature</span>
02942 <span class="comment"> *</span>
02943 <span class="comment"> *  Arguments:</span>
02944 <span class="comment"> *       dwIntentSig      - the look up table signature</span>
02945 <span class="comment"> *       pPublicArrayName - pointer to buffer</span>
02946 <span class="comment"> *</span>
02947 <span class="comment"> *  Returns:</span>
02948 <span class="comment"> *       Length of the data created in bytes</span>
02949 <span class="comment"> *</span>
02950 <span class="comment"> ******************************************************************************/</span>
02951 
02952 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l02953"></a><a class="code" href="../../d2/d9/ps2_8c.html#a217">02953</a> <a class="code" href="../../d2/d9/ps2_8c.html#a217">GetPublicArrayName</a>(
02954     DWORD   dwIntentSig,
02955     PBYTE   pPublicArrayName
02956     )
02957 {
02958     *((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)pPublicArrayName) = dwIntentSig;
02959     pPublicArrayName[<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)] = <span class="charliteral">'\0'</span>;
02960 
02961     <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) + 1;
02962 }
02963 
02964 
02965 <span class="comment">/***************************************************************************</span>
02966 <span class="comment">*                               CreateMonoCRD</span>
02967 <span class="comment">*  function:</span>
02968 <span class="comment">*    this is the function which creates the Color Rendering Dictionary (CRD)</span>
02969 <span class="comment">*    from the data supplied in the GrayTRC tag.</span>
02970 <span class="comment">*</span>
02971 <span class="comment">*  returns:</span>
02972 <span class="comment">*       BOOL        --  !=0 if the function was successful,</span>
02973 <span class="comment">*                         0 otherwise.</span>
02974 <span class="comment">*                       Returns number of bytes required/transferred</span>
02975 <span class="comment">***************************************************************************/</span>
02976 
02977 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l02978"></a><a class="code" href="../../d2/d9/ps2_8c.html#a187">02978</a> <a class="code" href="../../d2/d9/ps2_8c.html#a187">CreateMonoCRD</a>(
02979     PBYTE  pProfile,
02980     DWORD  dwIndex,
02981     PBYTE  pBuffer,
02982     PDWORD pcbSize,
02983     DWORD  dwIntent
02984     )
02985 {
02986     PTAGDATA   pTagData;
02987     <a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a> pData;
02988     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pLineStart, pStart = pBuffer;
02989     PWORD      pCurve, pRevCurve, pRevCurveStart;
02990     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwPCS, dwSize, nCount, i;
02991     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>  afxIlluminantWP[3];
02992     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>  afxMediaWP[3];
02993 
02994     dwPCS = <a class="code" href="../../d2/d9/ps2_8c.html#a40">GetCPConnSpace</a>(pProfile);
02995 
02996     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
02997                dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
02998 
02999     pData = (<a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
03000 
03001     nCount = FIX_ENDIAN(pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
03002 
03003     <span class="comment">//</span>
03004     <span class="comment">// Estimate size required to hold the CRD</span>
03005     <span class="comment">//</span>
03006 
03007     dwSize = nCount * 6 * <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a> + <span class="comment">// Number of INT elements</span>
03008         2048;                              <span class="comment">// + other PS stuff</span>
03009 
03010     <span class="comment">//</span>
03011     <span class="comment">// Add space for new line.</span>
03012     <span class="comment">//</span>
03013 
03014     dwSize += (((dwSize) / <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>) + 1) * <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
03015 
03016     <span class="keywordflow">if</span> (! pBuffer)
03017     {
03018         *pcbSize = dwSize;
03019         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03020     }
03021     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*pcbSize &lt; dwSize)
03022     {
03023         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get Mono CRD\n"</span>)));
03024         SetLastError(ERROR_INSUFFICIENT_BUFFER);
03025         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03026     }
03027 
03028     <span class="comment">//</span>
03029     <span class="comment">// Allocate memory, each entry occupy 2 bytes (1 word),</span>
03030     <span class="comment">//</span>
03031     <span class="comment">// input buffer  = (nCount * sizeof(WORD)</span>
03032     <span class="comment">// output buffer = (nCount * sizeof(WORD) * REVCURVE_RATIO)</span>
03033     <span class="comment">//</span>
03034 
03035     <span class="keywordflow">if</span> ((pRevCurveStart = <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(nCount * <span class="keyword">sizeof</span>(WORD) * (<a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a> + 1))) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
03036     {
03037         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Unable to allocate memory for reverse curve\n"</span>)));
03038         SetLastError(ERROR_NOT_ENOUGH_MEMORY);
03039         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03040     }
03041 
03042     <span class="comment">//</span>
03043     <span class="comment">// pCurve will points input buffer (which used in GetRevCurve)</span>
03044     <span class="comment">//</span>
03045 
03046     pCurve    = pRevCurveStart + nCount * <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a>;
03047     pRevCurve = pRevCurveStart;
03048 
03049     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a218">GetRevCurve</a>(pData, pCurve, pRevCurve);
03050 
03051     <span class="comment">//</span>
03052     <span class="comment">// Get info about Illuminant White Point from the header</span>
03053     <span class="comment">//</span>
03054 
03055     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(pProfile, afxIlluminantWP);
03056 
03057     <span class="comment">//</span>
03058     <span class="comment">// Support absolute whitePoint</span>
03059     <span class="comment">//</span>
03060 
03061     <span class="keywordflow">if</span> (dwIntent == INTENT_ABSOLUTE_COLORIMETRIC)
03062     {
03063         <span class="keywordflow">if</span> (! <a class="code" href="../../d2/d9/ps2_8c.html#a192">GetCPMediaWhitePoint</a>(pProfile, afxMediaWP))
03064         {
03065             afxMediaWP[0] = afxIlluminantWP[0];
03066             afxMediaWP[1] = afxIlluminantWP[1];
03067             afxMediaWP[2] = afxIlluminantWP[2];
03068         }
03069     }
03070 
03071     <span class="comment">//</span>
03072     <span class="comment">// Start writing the CRD</span>
03073     <span class="comment">//</span>
03074 
03075     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a8">BeginDict</a>); <span class="comment">// Begin dictionary</span>
03076     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a11">DictType</a>); <span class="comment">// Dictionary type</span>
03077 
03078     <span class="comment">//</span>
03079     <span class="comment">// Send /RenderingIntent</span>
03080     <span class="comment">//</span>
03081 
03082     <span class="keywordflow">switch</span> (dwIntent)
03083     {
03084         <span class="keywordflow">case</span> INTENT_PERCEPTUAL:
03085             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03086             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a13">IntentPer</a>);
03087             <span class="keywordflow">break</span>;
03088 
03089         <span class="keywordflow">case</span> INTENT_SATURATION:
03090             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03091             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a14">IntentSat</a>);
03092             <span class="keywordflow">break</span>;
03093 
03094         <span class="keywordflow">case</span> INTENT_RELATIVE_COLORIMETRIC:
03095             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03096             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a16">IntentRCol</a>);
03097             <span class="keywordflow">break</span>;
03098 
03099         <span class="keywordflow">case</span> INTENT_ABSOLUTE_COLORIMETRIC:
03100             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03101             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a15">IntentACol</a>);
03102             <span class="keywordflow">break</span>;
03103     }
03104 
03105     <span class="comment">//</span>
03106     <span class="comment">// Send /BlackPoint &amp; /WhitePoint</span>
03107     <span class="comment">//</span>
03108 
03109     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a203">SendCRDBWPoint</a>(pBuffer, afxIlluminantWP);
03110 
03111     <span class="comment">//</span>
03112     <span class="comment">// Send PQR</span>
03113     <span class="comment">//</span>
03114 
03115     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a204">SendCRDPQR</a>(pBuffer, dwIntent, afxIlluminantWP);
03116 
03117     <span class="comment">//</span>
03118     <span class="comment">// Send LMN</span>
03119     <span class="comment">//</span>
03120 
03121     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a205">SendCRDLMN</a>(pBuffer, dwIntent, afxIlluminantWP, afxMediaWP, dwPCS);
03122 
03123     <span class="comment">//</span>
03124     <span class="comment">// /MatrixABC</span>
03125     <span class="comment">//</span>
03126 
03127     <span class="keywordflow">if</span> (dwPCS == SPACE_XYZ)
03128     {
03129         <span class="comment">//</span>
03130         <span class="comment">// Switch ABC to BAC, since we want to output B</span>
03131         <span class="comment">// which is converted from Y</span>
03132         <span class="comment">//</span>
03133 
03134         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a24">MatrixABCTag</a>);
03135         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a103">MatrixABCXYZCRD</a>);
03136     }
03137     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dwPCS == SPACE_Lab)
03138     {
03139         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a24">MatrixABCTag</a>);
03140         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a102">MatrixABCLabCRD</a>);
03141     }
03142 
03143     <span class="comment">//</span>
03144     <span class="comment">// /EncodeABC</span>
03145     <span class="comment">//</span>
03146 
03147     <span class="keywordflow">if</span> (nCount != 0)
03148     {
03149         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
03150         pLineStart = pBuffer;
03151         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a25">EncodeABCTag</a>);
03152         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
03153         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
03154         <span class="keywordflow">if</span> (nCount == 1)                <span class="comment">// Gamma supplied in ui16 format</span>
03155         {
03156             <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pTable;
03157 
03158             pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) (pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o3">data</a>);
03159             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, FIX_ENDIAN16(*((PWORD)pTable)));
03160             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a75">DecodeA3Rev</a>);
03161         }
03162         <span class="keywordflow">else</span>
03163         {
03164             <span class="keywordflow">if</span> (dwPCS == SPACE_Lab)
03165             {
03166                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a104">EncodeABCLab1</a>);
03167             }
03168             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a89">StartClip</a>);
03169             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
03170             <span class="keywordflow">for</span> (i=0; i&lt;nCount * <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a>; i++)
03171             {
03172                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, *((WORD *)pRevCurve));
03173                 pRevCurve++;
03174                 <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pLineStart)) &gt; <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>)
03175                 {
03176                     pLineStart = pBuffer;
03177                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
03178                 }
03179             }
03180             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
03181             pLineStart = pBuffer;
03182 
03183             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>);
03184             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a92">Scale16</a>);
03185             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a90">EndClip</a>);
03186         }
03187         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a> (pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
03188         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a> (pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a44">DupOp</a>);
03189         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a> (pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a44">DupOp</a>);
03190         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a> (pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
03191     }
03192     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a9">EndDict</a>);  <span class="comment">// End dictionary definition</span>
03193 
03194     <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(pRevCurveStart);
03195 
03196     *pcbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
03197 
03198     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03199 }
03200 
03201 
03202 <span class="comment">/***************************************************************************</span>
03203 <span class="comment">*                               CreateLutCRD</span>
03204 <span class="comment">*  function:</span>
03205 <span class="comment">*    this is the function which creates the Color Rendering Dictionary (CRD)</span>
03206 <span class="comment">*    from the data supplied in the ColorProfile's LUT8 or LUT16 tag.</span>
03207 <span class="comment">*</span>
03208 <span class="comment">*  returns:</span>
03209 <span class="comment">*       BOOL        --  !=0 if the function was successful,</span>
03210 <span class="comment">*                         0 otherwise.</span>
03211 <span class="comment">*                       Returns number of bytes required/transferred</span>
03212 <span class="comment">***************************************************************************/</span>
03213 
03214 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l03215"></a><a class="code" href="../../d2/d9/ps2_8c.html#a188">03215</a> <a class="code" href="../../d2/d9/ps2_8c.html#a188">CreateLutCRD</a>(
03216     PBYTE  pProfile,
03217     DWORD  dwIndex,
03218     PBYTE  pBuffer,
03219     PDWORD pcbSize,
03220     DWORD  dwIntent,
03221     BOOL   bBinary
03222     )
03223 {
03224     PTAGDATA   pTagData;
03225     <a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a> pLut;
03226     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pTable;
03227     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pLineStart, pStart = pBuffer;
03228     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwPCS, dwSize, dwLutSig, dwTag, i, j;
03229     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      nInputCh, nOutputCh, nGrids, nInputTable, nOutputTable, nNumbers;
03230     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>  afxIlluminantWP[3];
03231     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>  afxMediaWP[3];
03232     <span class="keywordtype">char</span>       pPublicArrayName[5];
03233 
03234     <span class="comment">//</span>
03235     <span class="comment">// Check if we can generate the CSA</span>
03236     <span class="comment">// Required  tags is AToBi, where i is the rendering intent</span>
03237     <span class="comment">//</span>
03238 
03239     dwPCS = <a class="code" href="../../d2/d9/ps2_8c.html#a40">GetCPConnSpace</a>(pProfile);
03240 
03241     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
03242                dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
03243 
03244     dwTag = FIX_ENDIAN(pTagData-&gt;tagType);
03245 
03246     pLut = (<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
03247 
03248     dwLutSig = FIX_ENDIAN(pLut-&gt;<a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o0">dwSignature</a>);
03249 
03250     <span class="keywordflow">if</span> ((dwLutSig != <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>) &amp;&amp; (dwLutSig != <a class="code" href="../../d2/d9/ps2_8c.html#a38">LUT16_TYPE</a>))
03251     {
03252         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile - unable to create Lut CRD\n"</span>)));
03253         SetLastError(ERROR_INVALID_PROFILE);
03254         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03255     }
03256 
03257     <span class="comment">//</span>
03258     <span class="comment">// Estimate size required to hold the CSA</span>
03259     <span class="comment">//</span>
03260 
03261     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a219">GetCLUTInfo</a>(dwLutSig, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut, &amp;nInputCh, &amp;nOutputCh, &amp;nGrids,
03262                 &amp;nInputTable, &amp;nOutputTable, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
03263 
03264     <span class="comment">//</span>
03265     <span class="comment">// Calculate size of buffer needed</span>
03266     <span class="comment">//</span>
03267 
03268     dwSize = nInputCh * nInputTable * 6 +
03269         nOutputCh * nOutputTable * 6 +               <span class="comment">// Number of INT bytes</span>
03270         nOutputCh * nGrids * nGrids * nGrids * 2 +   <span class="comment">// LUT HEX bytes</span>
03271         nInputCh * (<a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>) +
03272                     <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a89">StartClip</a>) +
03273                     <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a90">EndClip</a>)) +
03274         nOutputCh * (<a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>) +
03275                      <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a89">StartClip</a>) +
03276                      <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a90">EndClip</a>)) +
03277         2048;                                        <span class="comment">// + other PS stuff</span>
03278 
03279     <span class="comment">//</span>
03280     <span class="comment">// Add space for new line.</span>
03281     <span class="comment">//</span>
03282 
03283     dwSize += (((dwSize) / <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>) + 1) * <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
03284 
03285     <span class="keywordflow">if</span> (! pBuffer)
03286     {
03287         *pcbSize = dwSize;
03288         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03289     }
03290     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*pcbSize &lt; dwSize)
03291     {
03292         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get DEFG CSA\n"</span>)));
03293         SetLastError(ERROR_INSUFFICIENT_BUFFER);
03294         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03295     }
03296 
03297     <span class="comment">//</span>
03298     <span class="comment">// Get info about Illuminant White Point from the header</span>
03299     <span class="comment">//</span>
03300 
03301     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(pProfile, afxIlluminantWP);
03302 
03303     <span class="comment">//</span>
03304     <span class="comment">// Support absolute whitePoint</span>
03305     <span class="comment">//</span>
03306 
03307     <span class="keywordflow">if</span> (dwIntent == INTENT_ABSOLUTE_COLORIMETRIC)
03308     {
03309         <span class="keywordflow">if</span> (! <a class="code" href="../../d2/d9/ps2_8c.html#a192">GetCPMediaWhitePoint</a>(pProfile, afxMediaWP))
03310         {
03311             afxMediaWP[0] = afxIlluminantWP[0];
03312             afxMediaWP[1] = afxIlluminantWP[1];
03313             afxMediaWP[2] = afxIlluminantWP[2];
03314         }
03315     }
03316 
03317     <span class="comment">//</span>
03318     <span class="comment">// Define global array used in EncodeABC and RenderTable</span>
03319     <span class="comment">//</span>
03320 
03321     <a class="code" href="../../d2/d9/ps2_8c.html#a217">GetPublicArrayName</a>(dwTag, pPublicArrayName);
03322     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a59">CRDBegin</a>);
03323 
03324     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a220">EnableGlobalDict</a>(pBuffer);
03325     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a221">BeginGlobalDict</a>(pBuffer);
03326 
03327     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a215">CreateInputArray</a>(pBuffer, nInputCh, nInputTable,
03328                  pPublicArrayName, dwLutSig, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut, bBinary, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
03329 
03330     i = nInputTable * nInputCh +
03331         nGrids * nGrids * nGrids * nOutputCh;
03332     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a216">CreateOutputArray</a>(pBuffer, nOutputCh, nOutputTable, i,
03333                  pPublicArrayName, dwLutSig, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut, bBinary, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
03334 
03335     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a222">EndGlobalDict</a>(pBuffer);
03336 
03337     <span class="comment">//</span>
03338     <span class="comment">// Start writing the CRD</span>
03339     <span class="comment">//</span>
03340 
03341     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a8">BeginDict</a>); <span class="comment">// Begin dictionary</span>
03342     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a11">DictType</a>); <span class="comment">// Dictionary type</span>
03343 
03344     <span class="comment">//</span>
03345     <span class="comment">// Send /RenderingIntent</span>
03346     <span class="comment">//</span>
03347 
03348     <span class="keywordflow">switch</span> (dwIntent)
03349     {
03350         <span class="keywordflow">case</span> INTENT_PERCEPTUAL:
03351             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03352             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a13">IntentPer</a>);
03353             <span class="keywordflow">break</span>;
03354 
03355         <span class="keywordflow">case</span> INTENT_SATURATION:
03356             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03357             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a14">IntentSat</a>);
03358             <span class="keywordflow">break</span>;
03359 
03360         <span class="keywordflow">case</span> INTENT_RELATIVE_COLORIMETRIC:
03361             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03362             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a16">IntentRCol</a>);
03363             <span class="keywordflow">break</span>;
03364 
03365         <span class="keywordflow">case</span> INTENT_ABSOLUTE_COLORIMETRIC:
03366             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03367             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a15">IntentACol</a>);
03368             <span class="keywordflow">break</span>;
03369     }
03370 
03371     <span class="comment">//</span>
03372     <span class="comment">// Send /BlackPoint &amp; /WhitePoint</span>
03373     <span class="comment">//</span>
03374 
03375     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a203">SendCRDBWPoint</a>(pBuffer, afxIlluminantWP);
03376 
03377     <span class="comment">//</span>
03378     <span class="comment">// Send PQR</span>
03379     <span class="comment">//</span>
03380 
03381     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a204">SendCRDPQR</a>(pBuffer, dwIntent, afxIlluminantWP);
03382 
03383     <span class="comment">//</span>
03384     <span class="comment">// Send LMN</span>
03385     <span class="comment">//</span>
03386 
03387     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a205">SendCRDLMN</a>(pBuffer, dwIntent, afxIlluminantWP, afxMediaWP, dwPCS);
03388 
03389     <span class="comment">//</span>
03390     <span class="comment">// Send ABC</span>
03391     <span class="comment">//</span>
03392 
03393     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a206">SendCRDABC</a>(pBuffer, pPublicArrayName, dwPCS, nInputCh,
03394                     (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, dwLutSig, bBinary);
03395 
03396     <span class="comment">//</span>
03397     <span class="comment">// /RenderTable</span>
03398     <span class="comment">//</span>
03399 
03400     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a29">RenderTableTag</a>);
03401     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
03402 
03403     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, nGrids);  <span class="comment">// Send down Na</span>
03404     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, nGrids);  <span class="comment">// Send down Nb</span>
03405     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, nGrids);  <span class="comment">// Send down Nc</span>
03406 
03407     pLineStart = pBuffer;
03408     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
03409     nNumbers = nGrids * nGrids * nOutputCh;
03410 
03411     <span class="keywordflow">for</span> (i=0; i&lt;nGrids; i++)        <span class="comment">// Na strings should be sent</span>
03412     {
03413         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
03414         pLineStart = pBuffer;
03415         <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
03416         {
03417             pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(((<a class="code" href="../../d2/d9/ps2_8c.html#a62">PLUT8TYPE</a>)pLut)-&gt;data) + nInputTable * nInputCh + nNumbers * i;
03418         }
03419         <span class="keywordflow">else</span>
03420         {
03421             pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;data) + 2 * nInputTable * nInputCh + 2 * nNumbers * i;
03422         }
03423 
03424         <span class="keywordflow">if</span> (! bBinary)
03425         {
03426             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a2">BeginString</a>);
03427             <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
03428             {
03429                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a227">WriteHexBuffer</a>(pBuffer, pTable, pLineStart, nNumbers);
03430             }
03431             <span class="keywordflow">else</span>
03432             {
03433                 <span class="keywordflow">for</span> (j=0; j&lt;nNumbers; j++)
03434                 {
03435                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a45">WriteHex</a>(pBuffer, FIX_ENDIAN16(*((PWORD)pTable)) / 256);
03436                     pTable += <span class="keyword">sizeof</span>(WORD);
03437                     <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pLineStart)) &gt; <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>)
03438                     {
03439                         pLineStart = pBuffer;
03440                         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
03441                     }
03442                 }
03443             }
03444             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a3">EndString</a>);
03445         }
03446         <span class="keywordflow">else</span>
03447         {
03448             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a228">WriteStringToken</a>(pBuffer, 143, nNumbers);
03449             <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
03450             {
03451                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a229">WriteByteString</a>(pBuffer, pTable, nNumbers);
03452             }
03453             <span class="keywordflow">else</span>
03454             {
03455                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a230">WriteInt2ByteString</a>(pBuffer, pTable, nNumbers);
03456             }
03457         }
03458     }
03459 
03460     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>); <span class="comment">// End array</span>
03461     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, nOutputCh);   <span class="comment">// Send down m</span>
03462 
03463     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a207">SendCRDOutputTable</a>(pBuffer, pPublicArrayName,
03464                     nOutputCh, dwLutSig, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, bBinary);
03465 
03466     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>); <span class="comment">// End array</span>
03467     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a9">EndDict</a>);  <span class="comment">// End dictionary definition</span>
03468 
03469     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a60">CRDEnd</a>);
03470 
03471     *pcbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
03472 
03473     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03474 }
03475 
03476 <span class="preprocessor">#if !defined(KERNEL_MODE) || defined(USERMODE_DRIVER)</span>
03477 <span class="preprocessor"></span>
03478 <span class="comment">/***************************************************************************</span>
03479 <span class="comment">*                           CreateMatrixCRD</span>
03480 <span class="comment">*  function:</span>
03481 <span class="comment">*    this is the function which creates the Color Rendering Dictionary (CRD)</span>
03482 <span class="comment">*    from the data supplied in the redTRC, greenTRC, blueTRA, redColorant,</span>
03483 <span class="comment">*    greenColorant and BlueColorant tags</span>
03484 <span class="comment">*</span>
03485 <span class="comment">*  returns:</span>
03486 <span class="comment">*       BOOL        --  !=0 if the function was successful,</span>
03487 <span class="comment">*                         0 otherwise.</span>
03488 <span class="comment">*                       Returns number of bytes required/transferred</span>
03489 <span class="comment">***************************************************************************/</span>
03490 
03491 <span class="comment">// With matrix/TRC model, only the CIEXYZ encoding of the PCS can be used.</span>
03492 <span class="comment">// So, we don't need to worry about CIELAB.</span>
03493 
03494 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l03495"></a><a class="code" href="../../d2/d9/ps2_8c.html#a234">03495</a> <a class="code" href="../../d2/d9/ps2_8c.html#a234">CreateMatrixCRD</a>(
03496     PBYTE  pProfile,
03497     PBYTE  pBuffer,
03498     PDWORD pcbSize,
03499     DWORD  dwIntent,
03500     BOOL   bBinary
03501     )
03502 {
03503     PTAGDATA   pTagData;
03504     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwRedTRCIndex, dwGreenTRCIndex, dwBlueTRCIndex;
03505     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwRedCount, dwGreenCount, dwBlueCount;
03506     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pMem = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03507     <a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a> pRed, pGreen, pBlue;
03508     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      i, dwSize;
03509     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pStart = pBuffer;
03510     PWORD      pRevCurve;
03511     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>  afxIlluminantWP[3];
03512     <span class="keywordtype">double</span>     adColorant[9];
03513     <span class="keywordtype">double</span>     adRevColorant[9];
03514 
03515     <span class="comment">//</span>
03516     <span class="comment">// Check this is sRGB color profile or not.</span>
03517     <span class="comment">//</span>
03518 
03519     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a181">IsSRGBColorProfile</a>(pProfile))
03520     {
03521         dwSize = 4096; <span class="comment">// hack - approx.</span>
03522 
03523         <span class="comment">//</span>
03524         <span class="comment">// Return buffer size, if this is a size request</span>
03525         <span class="comment">//</span>
03526 
03527         <span class="keywordflow">if</span> (! pBuffer)
03528         {
03529             *pcbSize = dwSize;
03530             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03531         }
03532 
03533         <span class="comment">//</span>
03534         <span class="comment">// Check buffer size.</span>
03535         <span class="comment">//</span>
03536 
03537         <span class="keywordflow">if</span> (*pcbSize &lt; dwSize)
03538         {
03539             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get sRGB CRD\n"</span>)));
03540             SetLastError(ERROR_INSUFFICIENT_BUFFER);
03541             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03542         }
03543 
03544         <span class="comment">//</span>
03545         <span class="comment">// Start writing the CRD</span>
03546         <span class="comment">//</span>
03547 
03548         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a59">CRDBegin</a>);
03549         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a8">BeginDict</a>);  <span class="comment">// Begin dictionary</span>
03550         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a11">DictType</a>);          <span class="comment">// Dictionary type</span>
03551 
03552         <span class="comment">//</span>
03553         <span class="comment">// Send /RenderingIntent</span>
03554         <span class="comment">//</span>
03555 
03556         <span class="keywordflow">switch</span> (dwIntent)
03557         {
03558             <span class="keywordflow">case</span> INTENT_PERCEPTUAL:
03559                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03560                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a13">IntentPer</a>);
03561                 <span class="keywordflow">break</span>;
03562 
03563             <span class="keywordflow">case</span> INTENT_SATURATION:
03564                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03565                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a14">IntentSat</a>);
03566                 <span class="keywordflow">break</span>;
03567 
03568             <span class="keywordflow">case</span> INTENT_RELATIVE_COLORIMETRIC:
03569                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03570                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a16">IntentRCol</a>);
03571                 <span class="keywordflow">break</span>;
03572 
03573             <span class="keywordflow">case</span> INTENT_ABSOLUTE_COLORIMETRIC:
03574                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03575                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a15">IntentACol</a>);
03576                 <span class="keywordflow">break</span>;
03577         }
03578 
03579         <span class="comment">//</span>
03580         <span class="comment">// Write prepaired sRGB CRD.</span>
03581         <span class="comment">//</span>
03582 
03583         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a179">sRGBColorRenderingDictionary</a>);
03584 
03585         <span class="comment">//</span>
03586         <span class="comment">// End CRD.</span>
03587         <span class="comment">//</span>
03588 
03589         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a60">CRDEnd</a>);
03590     }
03591     <span class="keywordflow">else</span>
03592     {
03593         <span class="comment">//</span>
03594         <span class="comment">// Get each TRC index for Red, Green and Blue.</span>
03595         <span class="comment">//</span>
03596 
03597         <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a17">TAG_REDTRC</a>, &amp;dwRedTRCIndex) ||
03598             !<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a18">TAG_GREENTRC</a>, &amp;dwGreenTRCIndex) ||
03599             !<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a19">TAG_BLUETRC</a>, &amp;dwBlueTRCIndex))
03600         {
03601             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03602         }
03603 
03604         <span class="comment">//</span>
03605         <span class="comment">// Get CURVETYPE data for each Red, Green and Blue</span>
03606         <span class="comment">//</span>
03607 
03608         pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
03609                    dwRedTRCIndex * <span class="keyword">sizeof</span>(TAGDATA));
03610 
03611         pRed = (<a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
03612 
03613         pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
03614                    dwGreenTRCIndex * <span class="keyword">sizeof</span>(TAGDATA));
03615 
03616         pGreen = (<a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
03617 
03618         pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
03619                    dwBlueTRCIndex * <span class="keyword">sizeof</span>(TAGDATA));
03620 
03621         pBlue = (<a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
03622 
03623         <span class="comment">//</span>
03624         <span class="comment">// Get curve count for each Red, Green and Blue.</span>
03625         <span class="comment">//</span>
03626 
03627         dwRedCount   = FIX_ENDIAN(pRed-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
03628         dwGreenCount = FIX_ENDIAN(pGreen-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
03629         dwBlueCount  = FIX_ENDIAN(pBlue-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
03630 
03631         <span class="comment">//</span>
03632         <span class="comment">// Estimate the memory size required to hold CRD</span>
03633         <span class="comment">//</span>
03634 
03635         dwSize = (dwRedCount + dwGreenCount + dwBlueCount) * 6 * <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a> +
03636                  4096;  <span class="comment">// Number of INT elements + other PS stuff</span>
03637 
03638         <span class="comment">//</span>
03639         <span class="comment">// Add space for new line.</span>
03640         <span class="comment">//</span>
03641 
03642         dwSize += (((dwSize) / <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>) + 1) * <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
03643 
03644         <span class="keywordflow">if</span> (pBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)     <span class="comment">// This is a size request</span>
03645         {
03646             *pcbSize = dwSize;
03647             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03648         }
03649 
03650         <span class="comment">//</span>
03651         <span class="comment">// Check buffer size.</span>
03652         <span class="comment">//</span>
03653 
03654         <span class="keywordflow">if</span> (*pcbSize &lt; dwSize)
03655         {
03656             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get sRGB CRD\n"</span>)));
03657             SetLastError(ERROR_INSUFFICIENT_BUFFER);
03658             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03659         }
03660 
03661         <span class="comment">//</span>
03662         <span class="comment">// Allocate buffer for curves</span>
03663         <span class="comment">//</span>
03664 
03665         <span class="keywordflow">if</span> ((pRevCurve = <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(dwRedCount * <span class="keyword">sizeof</span>(WORD) * (<a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a> + 1))) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
03666         {
03667             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Unable to allocate memory for reserved curve\n"</span>)));
03668             SetLastError(ERROR_NOT_ENOUGH_MEMORY);
03669             <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(pMem);
03670             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03671         }
03672 
03673         <span class="comment">//</span>
03674         <span class="comment">// Get info about Illuminant White Point from the header</span>
03675         <span class="comment">//</span>
03676 
03677         (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(pProfile, afxIlluminantWP);
03678 
03679         <span class="comment">//</span>
03680         <span class="comment">// Start writing the CRD</span>
03681         <span class="comment">//</span>
03682 
03683         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a220">EnableGlobalDict</a>(pBuffer);
03684         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a221">BeginGlobalDict</a>(pBuffer);
03685 
03686         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a210">CreateCRDRevArray</a>(pProfile, pBuffer, pRed, pRevCurve, <a class="code" href="../../d2/d9/ps2_8c.html#a17">TAG_REDTRC</a>, bBinary);
03687         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a210">CreateCRDRevArray</a>(pProfile, pBuffer, pGreen, pRevCurve, <a class="code" href="../../d2/d9/ps2_8c.html#a18">TAG_GREENTRC</a>, bBinary);
03688         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a210">CreateCRDRevArray</a>(pProfile, pBuffer, pBlue, pRevCurve, <a class="code" href="../../d2/d9/ps2_8c.html#a19">TAG_BLUETRC</a>, bBinary);
03689 
03690         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a222">EndGlobalDict</a>(pBuffer);
03691 
03692         <span class="comment">//</span>
03693         <span class="comment">// Start writing the CRD</span>
03694         <span class="comment">//</span>
03695 
03696         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a59">CRDBegin</a>);
03697         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a8">BeginDict</a>);  <span class="comment">// Begin dictionary</span>
03698         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a11">DictType</a>);          <span class="comment">// Dictionary type</span>
03699 
03700         <span class="comment">//</span>
03701         <span class="comment">// Send /RenderingIntent</span>
03702         <span class="comment">//</span>
03703 
03704         <span class="keywordflow">switch</span> (dwIntent)
03705         {
03706             <span class="keywordflow">case</span> INTENT_PERCEPTUAL:
03707                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03708                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a13">IntentPer</a>);
03709                 <span class="keywordflow">break</span>;
03710 
03711             <span class="keywordflow">case</span> INTENT_SATURATION:
03712                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03713                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a14">IntentSat</a>);
03714                 <span class="keywordflow">break</span>;
03715 
03716             <span class="keywordflow">case</span> INTENT_RELATIVE_COLORIMETRIC:
03717                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03718                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a16">IntentRCol</a>);
03719                 <span class="keywordflow">break</span>;
03720 
03721             <span class="keywordflow">case</span> INTENT_ABSOLUTE_COLORIMETRIC:
03722                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a12">IntentType</a>);
03723                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a15">IntentACol</a>);
03724                 <span class="keywordflow">break</span>;
03725         }
03726 
03727         <span class="comment">//</span>
03728         <span class="comment">// Send /BlackPoint &amp; /WhitePoint</span>
03729         <span class="comment">//</span>
03730 
03731         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a203">SendCRDBWPoint</a>(pBuffer, afxIlluminantWP);
03732 
03733         <span class="comment">//</span>
03734         <span class="comment">// Send PQR</span>
03735         <span class="comment">//</span>
03736 
03737         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a204">SendCRDPQR</a>(pBuffer, dwIntent, afxIlluminantWP);
03738 
03739         <span class="comment">//</span>
03740         <span class="comment">// Send LMN</span>
03741         <span class="comment">//</span>
03742 
03743         <a class="code" href="../../d2/d9/ps2_8c.html#a251">CreateColorantArray</a>(pProfile, &amp;adColorant[0], <a class="code" href="../../d2/d9/ps2_8c.html#a14">TAG_REDCOLORANT</a>);
03744         <a class="code" href="../../d2/d9/ps2_8c.html#a251">CreateColorantArray</a>(pProfile, &amp;adColorant[3], <a class="code" href="../../d2/d9/ps2_8c.html#a15">TAG_GREENCOLORANT</a>);
03745         <a class="code" href="../../d2/d9/ps2_8c.html#a251">CreateColorantArray</a>(pProfile, &amp;adColorant[6], <a class="code" href="../../d2/d9/ps2_8c.html#a16">TAG_BLUECOLORANT</a>);
03746         <a class="code" href="../../d2/d9/ps2_8c.html#a252">InvertColorantArray</a>(adColorant, adRevColorant);
03747 
03748         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a27">MatrixLMNTag</a>);
03749 
03750         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
03751         <span class="keywordflow">for</span> (i = 0; i &lt; 9; i++)
03752         {
03753             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a233">WriteDouble</a>(pBuffer, adRevColorant[i]);
03754         }
03755         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
03756 
03757         <span class="comment">//</span>
03758         <span class="comment">// /EncodeABC</span>
03759         <span class="comment">//</span>
03760 
03761         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a25">EncodeABCTag</a>);
03762         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
03763 
03764         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
03765         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a211">SendCRDRevArray</a>(pProfile, pBuffer, pRed, <a class="code" href="../../d2/d9/ps2_8c.html#a17">TAG_REDTRC</a>, bBinary);
03766 
03767         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
03768         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a211">SendCRDRevArray</a>(pProfile, pBuffer, pGreen, <a class="code" href="../../d2/d9/ps2_8c.html#a18">TAG_GREENTRC</a>, bBinary);
03769 
03770         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
03771         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a211">SendCRDRevArray</a>(pProfile, pBuffer, pBlue, <a class="code" href="../../d2/d9/ps2_8c.html#a19">TAG_BLUETRC</a>, bBinary);
03772 
03773         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
03774         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a9">EndDict</a>);  <span class="comment">// End dictionary definition</span>
03775 
03776         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a60">CRDEnd</a>);
03777 
03778         <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a> (pRevCurve);
03779     }
03780 
03781     *pcbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
03782 
03783     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03784 }
03785 
03786 
03787 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l03788"></a><a class="code" href="../../d2/d9/ps2_8c.html#a210">03788</a> <a class="code" href="../../d2/d9/ps2_8c.html#a210">CreateCRDRevArray</a>(
03789     PBYTE      pProfile,
03790     PBYTE      pBuffer,
03791     PCURVETYPE pData,
03792     PWORD      pRevCurve,
03793     DWORD      dwTag,
03794     BOOL       bBinary
03795     )
03796 {
03797     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i, nCount;
03798     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart, pLineStart;
03799     PWORD pCurve;
03800 
03801     pStart = pBuffer;
03802     pLineStart = pBuffer;
03803 
03804     nCount = FIX_ENDIAN(pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
03805     <span class="keywordflow">if</span> (nCount &gt; 1)
03806     {
03807         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a57">Slash</a>);
03808         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a77">InputArray</a>);
03809         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>) dwTag);
03810 
03811         pCurve = pRevCurve + (<a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a> * nCount);
03812 
03813         <a class="code" href="../../d2/d9/ps2_8c.html#a218">GetRevCurve</a> (pData, pCurve, pRevCurve);
03814 
03815         <span class="keywordflow">if</span> (!bBinary)  <span class="comment">// Output ASCII DATA</span>
03816         {
03817             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
03818             <span class="keywordflow">for</span> (i = 0; i &lt; nCount * <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a>; i++)
03819             {
03820                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, *pRevCurve);
03821                 pRevCurve++;
03822                 <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pLineStart)) &gt; <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>)
03823                 {
03824                     pLineStart = pBuffer;
03825                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
03826                 }
03827             }
03828             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
03829         }
03830         <span class="keywordflow">else</span> <span class="comment">// Output BINARY DATA</span>
03831         {
03832             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a224">WriteHNAToken</a>(pBuffer, 149, nCount);
03833             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a226">WriteIntStringU2S_L</a>(pBuffer, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) pRevCurve, nCount);
03834         }
03835         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a49">DefOp</a>);
03836     }
03837 
03838     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
03839 }
03840 
03841 
03842 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l03843"></a><a class="code" href="../../d2/d9/ps2_8c.html#a211">03843</a> <a class="code" href="../../d2/d9/ps2_8c.html#a211">SendCRDRevArray</a>(
03844     PBYTE pProfile,
03845     PBYTE pBuffer,
03846     PCURVETYPE pData,
03847     DWORD dwTag,
03848     BOOL  bBinary
03849     )
03850 {
03851     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nCount;
03852     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart;
03853     PWORD pTable;
03854 
03855     pStart = pBuffer;
03856 
03857     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
03858     nCount = FIX_ENDIAN(pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
03859     <span class="keywordflow">if</span> (nCount != 0)
03860     {
03861         <span class="keywordflow">if</span> (nCount == 1)            <span class="comment">// Gamma supplied in ui16 format</span>
03862         {
03863             pTable = pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o3">data</a>;
03864             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, FIX_ENDIAN16(*pTable));
03865             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a75">DecodeA3Rev</a>);
03866         }
03867         <span class="keywordflow">else</span>
03868         {
03869             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a89">StartClip</a>);
03870             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a77">InputArray</a>);
03871             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, dwTag);
03872 
03873             <span class="keywordflow">if</span> (!bBinary)       <span class="comment">// Output ASCII CS</span>
03874             {
03875                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>);
03876             }
03877             <span class="keywordflow">else</span>                <span class="comment">// Output BINARY CS</span>
03878             {
03879                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a83">IndexArray16b</a>);
03880             }
03881 
03882             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a92">Scale16</a>);
03883             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a90">EndClip</a>);
03884         }
03885     }
03886     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
03887 
03888     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
03889 }
03890 
03891 
03892 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l03893"></a><a class="code" href="../../d2/d9/ps2_8c.html#a251">03893</a> <a class="code" href="../../d2/d9/ps2_8c.html#a251">CreateColorantArray</a>(
03894     PBYTE pProfile,
03895     <span class="keywordtype">double</span> *lpArray,
03896     DWORD dwTag
03897     )
03898 {
03899     PTAGDATA pTagData;
03900     <a class="code" href="../../d2/d9/ps2_8c.html#a60">PXYZTYPE</a> pData;
03901     <a class="code" href="../../d2/d9/ps2_8c.html#a56">PFIX_16_16</a> pTable;
03902     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i, dwIndex;
03903     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> buffer[1000];
03904 
03905     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, dwTag, &amp;dwIndex))
03906     {
03907         pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
03908                    dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
03909 
03910         pData = (<a class="code" href="../../d2/d9/ps2_8c.html#a60">PXYZTYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
03911 
03912         pTable = pData-&gt;<a class="code" href="../../d2/d0/structtagXYZTYPE.html#o2">afxData</a>;
03913 
03914         <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++)
03915         {
03916             <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a> afxData = FIX_ENDIAN(*pTable);
03917 
03918             <span class="comment">//</span>
03919             <span class="comment">// Convert Fix 16.16 to double.</span>
03920             <span class="comment">//</span>
03921 
03922             *lpArray = ((<span class="keywordtype">double</span>) afxData) / ((<span class="keywordtype">double</span>) <a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a>);
03923 
03924             pTable++; lpArray++;
03925         }
03926 
03927         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
03928     }
03929 
03930     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
03931 }
03932 
03933 <span class="preprocessor">#endif // !defined(KERNEL_MODE) || defined(USERMODE_DRIVER)</span>
03934 <span class="preprocessor"></span>
03935 <span class="comment">/***************************************************************************</span>
03936 <span class="comment">*                               GetRevCurve</span>
03937 <span class="comment">*  function:</span>
03938 <span class="comment">*  returns:</span>
03939 <span class="comment">*       BOOL        --  TRUE:  successful,</span>
03940 <span class="comment">*                       FALSE: otherwise.</span>
03941 <span class="comment">***************************************************************************/</span>
03942 
03943 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l03944"></a><a class="code" href="../../d2/d9/ps2_8c.html#a218">03944</a> <a class="code" href="../../d2/d9/ps2_8c.html#a218">GetRevCurve</a>(
03945     PCURVETYPE pData,
03946     PWORD      pInput,
03947     PWORD      pOutput
03948     )
03949 {
03950     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>       pTable;
03951     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       nCount, dwStore, i, j;
03952     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       dwBegin, dwEnd, dwTemp;
03953 
03954     nCount = FIX_ENDIAN(pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
03955     pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pData-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o3">data</a>;
03956 
03957     <span class="keywordflow">for</span> (i=0; i&lt;nCount; i++)
03958     {
03959         pInput[i] = FIX_ENDIAN16(*((PWORD)pTable));
03960         pTable += <span class="keyword">sizeof</span>(WORD);
03961     }
03962 
03963     j = nCount * <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a>;
03964     <span class="keywordflow">for</span> (i=0; i&lt;j; i++)
03965     {
03966         dwStore = i * 65535 / (j - 1);
03967         pOutput[i] = (dwStore &lt; 65535) ? (WORD) dwStore : 65535;
03968     }
03969 
03970     <span class="keywordflow">for</span> (i=0; i&lt;j; i++)
03971     {
03972         dwBegin = 0;
03973         dwEnd = nCount - 1;
03974         <span class="keywordflow">for</span> (;;)
03975         {
03976             <span class="keywordflow">if</span> ((dwEnd - dwBegin) &lt;= 1)
03977                 <span class="keywordflow">break</span>;
03978             dwTemp = (dwEnd + dwBegin) / 2;
03979             <span class="keywordflow">if</span> (pOutput[i] &lt; pInput[dwTemp])
03980                 dwEnd = dwTemp;
03981             <span class="keywordflow">else</span>
03982                 dwBegin = dwTemp;
03983         }
03984         <span class="keywordflow">if</span> (pOutput[i] &lt;= pInput[dwBegin])
03985         {
03986             dwStore = dwBegin;
03987         }
03988         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pOutput[i] &gt;= pInput[dwEnd])
03989         {
03990             dwStore = dwEnd;
03991         }
03992         <span class="keywordflow">else</span>
03993         {
03994             dwStore = (pInput[dwEnd] - pOutput[i]) / (pOutput[i] - pInput[dwBegin]);
03995             dwStore = (dwBegin * dwStore + dwEnd) / (dwStore + 1);
03996         }
03997 
03998         dwStore = dwStore * 65535 / (nCount - 1);
03999         pOutput[i] = (dwStore &lt; 65535) ? (WORD) dwStore : 65535;
04000     }
04001 
04002     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04003 }
04004 
04005 
04006 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l04007"></a><a class="code" href="../../d2/d9/ps2_8c.html#a189">04007</a> <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(
04008     PBYTE     pProfile,
04009     DWORD     dwTag,
04010     PDWORD    pdwIndex
04011     )
04012 {
04013     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    i, dwCount;
04014     PTAGDATA pTagData;
04015     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>     bRc;
04016 
04017     <span class="comment">//</span>
04018     <span class="comment">// Get count of tag items - it is right after the profile header</span>
04019     <span class="comment">//</span>
04020 
04021     dwCount = FIX_ENDIAN(*((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER))));
04022 
04023     <span class="comment">//</span>
04024     <span class="comment">// Tag data records follow the count.</span>
04025     <span class="comment">//</span>
04026 
04027     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>));
04028 
04029     <span class="comment">//</span>
04030     <span class="comment">// Check if any of these records match the tag passed in.</span>
04031     <span class="comment">//</span>
04032 
04033     bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04034     dwTag = FIX_ENDIAN(dwTag);      <span class="comment">// to match tags in profile</span>
04035     <span class="keywordflow">for</span> (i=0; i&lt;dwCount; i++)
04036     {
04037         <span class="keywordflow">if</span> (pTagData-&gt;tagType == dwTag)
04038         {
04039             <span class="keywordflow">if</span> (pdwIndex)
04040             {
04041                 *pdwIndex = i;
04042             }
04043 
04044             bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04045             <span class="keywordflow">break</span>;
04046         }
04047         pTagData++;                     <span class="comment">// Next record</span>
04048     }
04049 
04050     <span class="keywordflow">return</span> bRc;
04051 }
04052 
04053 
04054 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l04055"></a><a class="code" href="../../d2/d9/ps2_8c.html#a190">04055</a> <a class="code" href="../../d2/d9/ps2_8c.html#a190">DoesTRCAndColorantTagExist</a>(
04056     PBYTE pProfile
04057     )
04058 {
04059     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile,<a class="code" href="../../d2/d9/ps2_8c.html#a14">TAG_REDCOLORANT</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
04060         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile,<a class="code" href="../../d2/d9/ps2_8c.html#a17">TAG_REDTRC</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
04061         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile,<a class="code" href="../../d2/d9/ps2_8c.html#a15">TAG_GREENCOLORANT</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
04062         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile,<a class="code" href="../../d2/d9/ps2_8c.html#a18">TAG_GREENTRC</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
04063         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile,<a class="code" href="../../d2/d9/ps2_8c.html#a16">TAG_BLUECOLORANT</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp;
04064         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile,<a class="code" href="../../d2/d9/ps2_8c.html#a19">TAG_BLUETRC</a>,<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>))
04065     {
04066         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04067     }
04068 
04069     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04070 }
04071 
04072 
04073 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l04074"></a><a class="code" href="../../d2/d9/ps2_8c.html#a191">04074</a> <a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(
04075     PBYTE      pProfile,
04076     PFIX_16_16 pafxWP
04077     )
04078 {
04079     pafxWP[0]  = FIX_ENDIAN(((PPROFILEHEADER)pProfile)-&gt;phIlluminant.ciexyzX);
04080     pafxWP[1]  = FIX_ENDIAN(((PPROFILEHEADER)pProfile)-&gt;phIlluminant.ciexyzY);
04081     pafxWP[2]  = FIX_ENDIAN(((PPROFILEHEADER)pProfile)-&gt;phIlluminant.ciexyzZ);
04082 
04083     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04084 }
04085 
04086 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l04087"></a><a class="code" href="../../d2/d9/ps2_8c.html#a192">04087</a> <a class="code" href="../../d2/d9/ps2_8c.html#a192">GetCPMediaWhitePoint</a>(
04088     PBYTE      pProfile,
04089     PFIX_16_16 pafxMediaWP
04090     )
04091 {
04092     PTAGDATA pTagData;
04093     PDWORD   pTable;
04094     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    dwIndex, i;
04095 
04096     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a> (pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a21">TAG_MEDIAWHITEPOINT</a>, &amp;dwIndex))
04097     {
04098         pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
04099                dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
04100 
04101         <span class="comment">//</span>
04102         <span class="comment">// Skip the first 2 DWORDs to get to the real data</span>
04103         <span class="comment">//</span>
04104 
04105         pTable = (PDWORD)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset)) + 2;
04106 
04107         <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
04108         {
04109             pafxMediaWP[i] = FIX_ENDIAN(*pTable);
04110             pTable++;
04111         }
04112 
04113         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04114     }
04115 
04116     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04117 }
04118 
04119 
04120 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l04121"></a><a class="code" href="../../d2/d9/ps2_8c.html#a193">04121</a> <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(
04122     PBYTE  pProfile,
04123     DWORD  dwIndex,
04124     PDWORD pcbSize)
04125 {
04126     PTAGDATA pTagData;
04127 
04128     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
04129                dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
04130 
04131     <span class="comment">//</span>
04132     <span class="comment">// Actual data Size of elements of type 'dataType' is 3 DWORDs less than the</span>
04133     <span class="comment">// total tag data size</span>
04134     <span class="comment">//</span>
04135 
04136     *pcbSize = FIX_ENDIAN(pTagData-&gt;cbSize) - 3 * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
04137 
04138     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04139 }
04140 
04141 
04142 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l04143"></a><a class="code" href="../../d2/d9/ps2_8c.html#a194">04143</a> <a class="code" href="../../d2/d9/ps2_8c.html#a194">GetCPElementSize</a>(
04144     PBYTE  pProfile,
04145     DWORD  dwIndex,
04146     PDWORD pcbSize)
04147 {
04148     PTAGDATA pTagData;
04149 
04150     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
04151                dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
04152 
04153     *pcbSize = FIX_ENDIAN(pTagData-&gt;cbSize);
04154 
04155     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04156 }
04157 
04158 
04159 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l04160"></a><a class="code" href="../../d2/d9/ps2_8c.html#a195">04160</a> <a class="code" href="../../d2/d9/ps2_8c.html#a195">GetCPElementDataType</a>(
04161     PBYTE  pProfile,
04162     DWORD  dwIndex,
04163     PDWORD pdwDataType)
04164 {
04165     PTAGDATA pTagData;
04166     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>    pData;
04167 
04168     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
04169                dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
04170 
04171     pData = pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset);
04172 
04173     *pdwDataType = FIX_ENDIAN(*((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)(pData + 2 * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>))));
04174 
04175     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04176 }
04177 
04178 
04179 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l04180"></a><a class="code" href="../../d2/d9/ps2_8c.html#a196">04180</a> <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(
04181     PBYTE  pProfile,
04182     DWORD  dwIndex,
04183     PBYTE  pBuffer,
04184     PDWORD pdwSize
04185     )
04186 {
04187     PTAGDATA pTagData;
04188     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>    pData;
04189 
04190     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
04191                dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
04192 
04193     pData = pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset);
04194 
04195     <span class="comment">//</span>
04196     <span class="comment">// Actual data Size of elements of type 'dataType' is 3 DWORDs less than the</span>
04197     <span class="comment">// total tag data size</span>
04198     <span class="comment">//</span>
04199 
04200     *pdwSize = FIX_ENDIAN(pTagData-&gt;cbSize) - 3 * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
04201 
04202     <span class="keywordflow">if</span> (pBuffer)
04203     {
04204         CopyMemory(pBuffer, (pData + 3*<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)), *pdwSize);
04205     }
04206 
04207     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04208 }
04209 
04210 
04211 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l04212"></a><a class="code" href="../../d2/d9/ps2_8c.html#a197">04212</a> <a class="code" href="../../d2/d9/ps2_8c.html#a197">GetTRCElementSize</a>(
04213     PBYTE  pProfile,
04214     DWORD  dwTag,
04215     PDWORD pdwIndex,
04216     PDWORD pdwSize
04217     )
04218 {
04219     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDataType;
04220 
04221     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, dwTag, pdwIndex) ||
04222         !<a class="code" href="../../d2/d9/ps2_8c.html#a195">GetCPElementDataType</a>(pProfile, *pdwIndex, &amp;dwDataType) ||
04223         !(dwDataType != <a class="code" href="../../d2/d9/ps2_8c.html#a39">SIG_CURVE_TYPE</a>) ||
04224         !<a class="code" href="../../d2/d9/ps2_8c.html#a194">GetCPElementSize</a>(pProfile, *pdwIndex, pdwSize))
04225     {
04226         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04227     }
04228 
04229     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04230 }
04231 
04232 
04233 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04234"></a><a class="code" href="../../d2/d9/ps2_8c.html#a198">04234</a> <a class="code" href="../../d2/d9/ps2_8c.html#a198">Ascii85Encode</a>(
04235     PBYTE pBuffer,
04236     DWORD dwDataSize,
04237     DWORD dwBufSize
04238     )
04239 {
04240     <span class="comment">// BUGBUG - To be done</span>
04241 
04242 <span class="preprocessor">#if 0</span>
04243 <span class="preprocessor"></span>    <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>     pTempBuf, pPtr;
04244     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     dwASCII85Size = 0;
04245     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     dwBufSize = DataSize * 5 / 4 + <span class="keyword">sizeof</span>(<a class="code" href="../../d2/d9/ps2_8c.html#a67">ASCII85DecodeBegin</a>)+<span class="keyword">sizeof</span>(<a class="code" href="../../d2/d9/ps2_8c.html#a68">ASCII85DecodeEnd</a>) + 2048;
04246 
04247     <span class="keywordflow">if</span> ((pTempBuf = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)<a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(dwBufSize)))
04248     {
04249         pPtr = pTempBuf;
04250         pPtr += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pPtr,  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
04251         pPtr += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pPtr,  <a class="code" href="../../d2/d9/ps2_8c.html#a67">ASCII85DecodeBegin</a>);
04252         pPtr += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pPtr,  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
04253         pPtr += <a class="code" href="../../d1/d9/jul98_2dll32_2csprof_8c.html#a55">WriteASCII85Cont</a>(pPtr, dwBufSize, pBuffer, dwDataSize);
04254         pPtr += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pPtr,  <a class="code" href="../../d2/d9/ps2_8c.html#a68">ASCII85DecodeEnd</a>);
04255         dwAscii85Size = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pPtr - pTempBuf);
04256         lstrcpyn(pBuffer, pTempBuf, dwAscii85Size);
04257 
04258         <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(pTempBuf);
04259     }
04260 
04261     <span class="keywordflow">return</span> dwAscii85Size;
04262 <span class="preprocessor">#else</span>
04263 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
04264 <span class="preprocessor">#endif</span>
04265 <span class="preprocessor"></span>}
04266 
04267 <span class="comment">/***************************************************************************</span>
04268 <span class="comment">*</span>
04269 <span class="comment">*   Function to write the Homogeneous Number Array token into the buffer</span>
04270 <span class="comment">*</span>
04271 <span class="comment">***************************************************************************/</span>
04272 
04273 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04274"></a><a class="code" href="../../d2/d9/ps2_8c.html#a224">04274</a> <a class="code" href="../../d2/d9/ps2_8c.html#a224">WriteHNAToken</a>(
04275     PBYTE pBuffer,
04276     BYTE  token,
04277     DWORD dwNum
04278     )
04279 {
04280     *pBuffer++ = token;
04281     *pBuffer++ = 32;       <span class="comment">// 16-bit fixed integer, high-order byte first</span>
04282     *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)((dwNum &amp; 0xFF00) &gt;&gt; 8);
04283     *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(dwNum &amp; 0x00FF);
04284 
04285     <span class="keywordflow">return</span> 4;
04286 }
04287 
04288 <span class="comment">/***************************************************************************</span>
04289 <span class="comment">*</span>
04290 <span class="comment">*   Function to convert 2-bytes unsigned integer to 2-bytes signed</span>
04291 <span class="comment">*   integer(-32768) and write them to the buffer. High byte first.</span>
04292 <span class="comment">*</span>
04293 <span class="comment">***************************************************************************/</span>
04294 
04295 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04296"></a><a class="code" href="../../d2/d9/ps2_8c.html#a225">04296</a> <a class="code" href="../../d2/d9/ps2_8c.html#a225">WriteIntStringU2S</a>(
04297     PBYTE pBuffer,
04298     PBYTE pData,
04299     DWORD dwNum
04300     )
04301 {
04302     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i, dwTemp;
04303 
04304     <span class="keywordflow">for</span> (i=0; i&lt;dwNum; i++)
04305     {
04306         dwTemp = FIX_ENDIAN16(*((PWORD)pData)) - 32768;
04307         *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)((dwTemp &amp; 0xFF00) &gt;&gt; 8);
04308         *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(dwTemp &amp; 0x00FF);
04309         pData += <span class="keyword">sizeof</span>(WORD);
04310     }
04311 
04312     <span class="keywordflow">return</span> dwNum * 2;
04313 }
04314 
04315 
04316 <span class="comment">/***************************************************************************</span>
04317 <span class="comment">*</span>
04318 <span class="comment">*   Function to convert 2-bytes unsigned integer to 2-bytes signed</span>
04319 <span class="comment">*   integer(-32768) and write them to the buffer. Low-order byte first.</span>
04320 <span class="comment">*</span>
04321 <span class="comment">***************************************************************************/</span>
04322 
04323 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04324"></a><a class="code" href="../../d2/d9/ps2_8c.html#a226">04324</a> <a class="code" href="../../d2/d9/ps2_8c.html#a226">WriteIntStringU2S_L</a>(
04325     PBYTE pBuffer,
04326     PBYTE pData,
04327     DWORD dwNum
04328     )
04329 {
04330     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i, dwTemp;
04331 
04332     <span class="keywordflow">for</span> (i=0; i&lt;dwNum; i++)
04333     {
04334         dwTemp = *((PWORD)pData) - 32768;
04335         *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)((dwTemp &amp; 0xFF00) &gt;&gt; 8);
04336         *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(dwTemp &amp; 0x00FF);
04337         pData += <span class="keyword">sizeof</span>(WORD);
04338     }
04339 
04340     <span class="keywordflow">return</span> dwNum * 2;
04341 }
04342 
04343 
04344 <span class="comment">/***************************************************************************</span>
04345 <span class="comment">*</span>
04346 <span class="comment">*   Function to put the chunk of memory as string of Hex</span>
04347 <span class="comment">*</span>
04348 <span class="comment">***************************************************************************/</span>
04349 
04350 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04351"></a><a class="code" href="../../d2/d9/ps2_8c.html#a227">04351</a> <a class="code" href="../../d2/d9/ps2_8c.html#a227">WriteHexBuffer</a>(
04352     PBYTE pBuffer,
04353     PBYTE pData,
04354     PBYTE pLineStart,
04355     DWORD dwBytes
04356     )
04357 {
04358     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>  pStart = pBuffer;
04359 
04360     <span class="keywordflow">for</span> ( ; dwBytes ; dwBytes-- )
04361     {
04362         <a class="code" href="../../d2/d9/ps2_8c.html#a45">WriteHex</a>(pBuffer, *pData);
04363         pBuffer += 2;
04364         pData++;
04365         <span class="keywordflow">if</span> (((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pLineStart)) &gt; <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>)
04366         {
04367             pLineStart = pBuffer;
04368             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer,  <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
04369         }
04370     }
04371     <span class="keywordflow">return</span>( (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart));
04372 }
04373 
04374 <span class="comment">/***************************************************************************</span>
04375 <span class="comment">*</span>
04376 <span class="comment">*   Function to write the string token into the buffer</span>
04377 <span class="comment">*</span>
04378 <span class="comment">***************************************************************************/</span>
04379 
04380 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04381"></a><a class="code" href="../../d2/d9/ps2_8c.html#a228">04381</a> <a class="code" href="../../d2/d9/ps2_8c.html#a228">WriteStringToken</a>(
04382     PBYTE pBuffer,
04383     BYTE  token,
04384     DWORD dwNum
04385     )
04386 {
04387     *pBuffer++ = token;
04388     *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)((dwNum &amp; 0xFF00) &gt;&gt; 8);
04389     *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(dwNum &amp; 0x00FF);
04390 
04391     <span class="keywordflow">return</span> 3;
04392 }
04393 
04394 <span class="comment">/***************************************************************************</span>
04395 <span class="comment">*</span>
04396 <span class="comment">*   Function to put the chunk of memory into buffer</span>
04397 <span class="comment">*</span>
04398 <span class="comment">***************************************************************************/</span>
04399 
04400 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04401"></a><a class="code" href="../../d2/d9/ps2_8c.html#a229">04401</a> <a class="code" href="../../d2/d9/ps2_8c.html#a229">WriteByteString</a>(
04402     PBYTE pBuffer,
04403     PBYTE pData,
04404     DWORD dwBytes
04405     )
04406 {
04407     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  i;
04408 
04409     <span class="keywordflow">for</span> (i=0; i&lt;dwBytes; i++)
04410         *pBuffer++ = *pData++;
04411 
04412     <span class="keywordflow">return</span> dwBytes;
04413 }
04414 
04415 <span class="comment">/***************************************************************************</span>
04416 <span class="comment">*</span>
04417 <span class="comment">*   Function to put the chunk of memory into buffer</span>
04418 <span class="comment">*</span>
04419 <span class="comment">***************************************************************************/</span>
04420 
04421 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04422"></a><a class="code" href="../../d2/d9/ps2_8c.html#a230">04422</a> <a class="code" href="../../d2/d9/ps2_8c.html#a230">WriteInt2ByteString</a>(
04423     PBYTE pBuffer,
04424     PBYTE pData,
04425     DWORD dwBytes
04426     )
04427 {
04428     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  i;
04429 
04430     <span class="keywordflow">for</span> (i=0; i&lt;dwBytes ; i++)
04431     {
04432         *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(FIX_ENDIAN16(*((PWORD)pData))/256);
04433         pData += <span class="keyword">sizeof</span>(WORD);
04434     }
04435 
04436     <span class="keywordflow">return</span> dwBytes;
04437 }
04438 
04439 <span class="preprocessor">#ifndef KERNEL_MODE</span>
04440 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04441"></a><a class="code" href="../../d2/d9/ps2_8c.html#a231">04441</a> <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(
04442     PBYTE     pBuffer,
04443     FIX_16_16 fxNum
04444     )
04445 {
04446     <span class="keywordtype">double</span> dFloat = (<span class="keywordtype">double</span>) ((<span class="keywordtype">long</span>) fxNum) / (<span class="keywordtype">double</span>) <a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a>;
04447 
04448     <span class="keywordflow">return</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a233">WriteDouble</a>(pBuffer,dFloat));
04449 }
04450 <span class="preprocessor">#else</span>
04451 <span class="preprocessor"></span><a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
04452 <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(
04453     PBYTE     pBuffer,
04454     FIX_16_16 fxNum
04455     )
04456 {
04457     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart = pBuffer;
04458     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
04459 
04460     <span class="comment">//</span>
04461     <span class="comment">// Integer portion</span>
04462     <span class="comment">//</span>
04463 
04464 <span class="preprocessor">    #ifndef KERNEL_MODE</span>
04465 <span class="preprocessor"></span>    pBuffer += <a class="code" href="../../d6/d0/wsprintf_8c.html#a6">wsprintfA</a>(pBuffer, <span class="stringliteral">"%lu"</span>, fxNum &gt;&gt; FIX_16_16_SHIFT);
04466 <span class="preprocessor">    #else</span>
04467 <span class="preprocessor"></span>    pBuffer += OPSprintf(pBuffer, <span class="stringliteral">"%l"</span>, fxNum &gt;&gt; FIX_16_16_SHIFT);
04468 <span class="preprocessor">    #endif</span>
04469 <span class="preprocessor"></span>
04470     <span class="comment">//</span>
04471     <span class="comment">// Fractional part</span>
04472     <span class="comment">//</span>
04473 
04474     fxNum &amp;= 0xffff;
04475     <span class="keywordflow">if</span> (fxNum != 0)
04476     {
04477         <span class="comment">//</span>
04478         <span class="comment">// We output a maximum of 6 digits after the</span>
04479         <span class="comment">// decimal point</span>
04480         <span class="comment">//</span>
04481 
04482         *pBuffer++ = <span class="charliteral">'.'</span>;
04483 
04484         i = 0;
04485         <span class="keywordflow">while</span> (fxNum &amp;&amp; i++ &lt; 6)
04486         {
04487             fxNum *= 10;
04488             *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(fxNum &gt;&gt; <a class="code" href="../../d2/d9/ps2_8c.html#a4">FIX_16_16_SHIFT</a>) + <span class="charliteral">'0'</span>;  <span class="comment">// quotient + '0'</span>
04489             fxNum -= <a class="code" href="../../d2/d9/ps2_8c.html#a10">FLOOR</a>(fxNum);          <span class="comment">// remainder</span>
04490         }
04491     }
04492 
04493     *pBuffer++ = <span class="charliteral">' '</span>;
04494 
04495     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
04496 }
04497 <span class="preprocessor">#endif</span>
04498 <span class="preprocessor"></span>
04499 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04500"></a><a class="code" href="../../d2/d9/ps2_8c.html#a232">04500</a> <a class="code" href="../../d2/d9/ps2_8c.html#a232">WriteFixed2dot30</a>(
04501     PBYTE pBuffer,
04502     DWORD fxNum
04503     )
04504 {
04505     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart = pBuffer;
04506     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
04507 
04508     <span class="comment">//</span>
04509     <span class="comment">// Integer portion</span>
04510     <span class="comment">//</span>
04511 
04512 <span class="preprocessor">    #ifndef KERNEL_MODE</span>
04513 <span class="preprocessor"></span>    pBuffer += <a class="code" href="../../d6/d0/wsprintf_8c.html#a6">wsprintfA</a>(pBuffer, <span class="stringliteral">"%lu"</span>, fxNum &gt;&gt; 30);
04514 <span class="preprocessor">    #else</span>
04515 <span class="preprocessor"></span>    pBuffer += OPSprintf(pBuffer, <span class="stringliteral">"%l"</span>, fxNum &gt;&gt; 30);
04516 <span class="preprocessor">    #endif</span>
04517 <span class="preprocessor"></span>
04518     <span class="comment">//</span>
04519     <span class="comment">// Fractional part</span>
04520     <span class="comment">//</span>
04521 
04522     fxNum &amp;= 0x3fffffff<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
04523     <span class="keywordflow">if</span> (fxNum != 0)
04524     {
04525         <span class="comment">//</span>
04526         <span class="comment">// We output a maximum of 10 digits after the</span>
04527         <span class="comment">// decimal point</span>
04528         <span class="comment">//</span>
04529 
04530         *pBuffer++ = <span class="charliteral">'.'</span>;
04531 
04532         i = 0;
04533         <span class="keywordflow">while</span> (fxNum &amp;&amp; i++ &lt; 10)
04534         {
04535             fxNum *= 10;
04536             *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(fxNum &gt;&gt; 30) + <span class="charliteral">'0'</span>;  <span class="comment">// quotient + '0'</span>
04537             fxNum -= ((fxNum &gt;&gt; 30) &lt;&lt; 30);          <span class="comment">// remainder</span>
04538         }
04539     }
04540 
04541     *pBuffer++ = <span class="charliteral">' '</span>;
04542 
04543     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
04544 }
04545 
04546 <span class="preprocessor">#if !defined(KERNEL_MODE) || defined(USERMODE_DRIVER)</span>
04547 <span class="preprocessor"></span>
04548 <span class="comment">/***************************************************************************</span>
04549 <span class="comment">*</span>
04550 <span class="comment">*   Function to write the float into the buffer</span>
04551 <span class="comment">*</span>
04552 <span class="comment">***************************************************************************/</span>
04553 
<a name="l04554"></a><a class="code" href="../../d2/d9/ps2_8c.html#a233">04554</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a233">WriteDouble</a>(PBYTE pBuffer, <span class="keywordtype">double</span> dFloat)
04555 {
04556     LONG   lFloat  = (LONG) floor(dFloat * 10000.0 + 0.5);
04557     <span class="keywordtype">double</span> dFloat1 = lFloat  / 10000.0 ;
04558     <span class="keywordtype">double</span> dInt    = floor(fabs(dFloat1));
04559     <span class="keywordtype">double</span> dFract =  fabs(dFloat1) - dInt ;
04560     <span class="keywordtype">char</span>   cSign  = <span class="charliteral">' '</span> ;
04561 
04562     <span class="keywordflow">if</span> (dFloat1 &lt; 0)
04563     {
04564         cSign = <span class="charliteral">'-'</span> ;
04565     }
04566 
04567     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d0/wsprintf_8c.html#a6">wsprintfA</a>(pBuffer, (LPSTR) <span class="stringliteral">"%c%d.%0.4lu "</span>,
04568                         cSign, (WORD) dInt , (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (dFract * 10000.0)));
04569 }
04570 
04571 <span class="preprocessor">#endif // !defined(KERNEL_MODE) || defined(USERMODE_DRIVER)</span>
04572 <span class="preprocessor"></span>
<a name="l04573"></a><a class="code" href="../../d2/d9/ps2_8c.html#a223">04573</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(
04574     PBYTE       pBuffer,
04575     <span class="keyword">const</span> <span class="keywordtype">char</span> *pData)
04576 {
04577     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart = pBuffer;
04578 
04579     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
04580     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, pData);
04581 
04582     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
04583 }
04584 
04585 
04586 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04587"></a><a class="code" href="../../d2/d9/ps2_8c.html#a203">04587</a> <a class="code" href="../../d2/d9/ps2_8c.html#a203">SendCRDBWPoint</a>(
04588     PBYTE      pBuffer,
04589     PFIX_16_16 pafxWP
04590     )
04591 {
04592     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart = pBuffer;
04593     <span class="keywordtype">int</span>   i;
04594 
04595     <span class="comment">//</span>
04596     <span class="comment">// /BlackPoint</span>
04597     <span class="comment">//</span>
04598 
04599     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
04600     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a18">BlackPointTag</a>);
04601     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a10">BlackPoint</a>);
04602 
04603     <span class="comment">//</span>
04604     <span class="comment">// /WhitePoint</span>
04605     <span class="comment">//</span>
04606 
04607     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
04608     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a17">WhitePointTag</a>);
04609     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
04610     <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
04611     {
04612         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, pafxWP[i]);
04613     }
04614     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
04615 
04616     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
04617 }
04618 
04619 
04620 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04621"></a><a class="code" href="../../d2/d9/ps2_8c.html#a204">04621</a> <a class="code" href="../../d2/d9/ps2_8c.html#a204">SendCRDPQR</a>(
04622     PBYTE      pBuffer,
04623     DWORD      dwIntent,
04624     PFIX_16_16 pafxWP
04625     )
04626 {
04627     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart = pBuffer;
04628     <span class="keywordtype">int</span>   i;
04629 
04630     <span class="keywordflow">if</span> (dwIntent != INTENT_ABSOLUTE_COLORIMETRIC)
04631     {
04632         <span class="comment">//</span>
04633         <span class="comment">// /RangePQR</span>
04634         <span class="comment">//</span>
04635 
04636         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a19">RangePQRTag</a>);
04637         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a106">RangePQR</a>);
04638 
04639         <span class="comment">//</span>
04640         <span class="comment">// /MatrixPQR</span>
04641         <span class="comment">//</span>
04642 
04643         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a21">MatrixPQRTag</a>);
04644         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a107">MatrixPQR</a>);
04645     }
04646     <span class="keywordflow">else</span>
04647     {
04648         <span class="comment">//</span>
04649         <span class="comment">// /RangePQR</span>
04650         <span class="comment">//</span>
04651 
04652         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a19">RangePQRTag</a>);
04653         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
04654         <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
04655         {
04656             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, 0);
04657             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, pafxWP[i]);
04658         }
04659         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
04660 
04661         <span class="comment">//</span>
04662         <span class="comment">// /MatrixPQR</span>
04663         <span class="comment">//</span>
04664 
04665         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a21">MatrixPQRTag</a>);
04666         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a71">Identity</a>);
04667     }
04668 
04669     <span class="comment">//</span>
04670     <span class="comment">// /TransformPQR</span>
04671     <span class="comment">//</span>
04672 
04673     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a20">TransformPQRTag</a>);
04674     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
04675     <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
04676     {
04677         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
04678         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer,
04679             (dwIntent != INTENT_ABSOLUTE_COLORIMETRIC) ? <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a108">TransformPQR</a>[i] : <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a43">NullOp</a>);
04680         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
04681     }
04682     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
04683 
04684     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
04685 }
04686 
04687 
04688 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04689"></a><a class="code" href="../../d2/d9/ps2_8c.html#a205">04689</a> <a class="code" href="../../d2/d9/ps2_8c.html#a205">SendCRDLMN</a>(
04690     PBYTE      pBuffer,
04691     DWORD      dwIntent,
04692     PFIX_16_16 pafxIlluminantWP,
04693     PFIX_16_16 pafxMediaWP,
04694     DWORD      dwPCS
04695     )
04696 {
04697     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart = pBuffer;
04698     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i, j;
04699 
04700     <span class="comment">//</span>
04701     <span class="comment">// /MatrixLMN</span>
04702     <span class="comment">//</span>
04703 
04704     <span class="keywordflow">if</span> (dwIntent == INTENT_ABSOLUTE_COLORIMETRIC)
04705     {
04706         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a27">MatrixLMNTag</a>);
04707 
04708         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
04709         <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
04710         {
04711             <span class="keywordflow">for</span> (j=0; j&lt;3; j++)
04712                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer,
04713                     (i == j) ? <a class="code" href="../../d2/d9/ps2_8c.html#a9">FIX_DIV</a>(pafxIlluminantWP[i], pafxMediaWP[i]) : 0);
04714         }
04715         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
04716     }
04717 
04718     <span class="comment">//</span>
04719     <span class="comment">// /RangeLMN</span>
04720     <span class="comment">//</span>
04721 
04722     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a26">RangeLMNTag</a>);
04723     <span class="keywordflow">if</span> (dwPCS == SPACE_XYZ)
04724     {
04725         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
04726         <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
04727         {
04728             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, 0);
04729             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, pafxIlluminantWP[i]);
04730         }
04731         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
04732     }
04733     <span class="keywordflow">else</span>
04734     {
04735         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a100">RangeLMNLab</a>);
04736     }
04737 
04738     <span class="comment">//</span>
04739     <span class="comment">// /EncodeLMN</span>
04740     <span class="comment">//</span>
04741 
04742     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a28">EncodeLMNTag</a>);
04743     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
04744     <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
04745     {
04746         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
04747         <span class="keywordflow">if</span> (dwPCS != SPACE_XYZ)
04748         {
04749             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, pafxIlluminantWP[i]);
04750             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a55">DivOp</a>);
04751             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a101">EncodeLMNLab</a>);
04752         }
04753         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
04754     }
04755     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
04756 
04757     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
04758 }
04759 
04760 
04761 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04762"></a><a class="code" href="../../d2/d9/ps2_8c.html#a206">04762</a> <a class="code" href="../../d2/d9/ps2_8c.html#a206">SendCRDABC</a>(
04763     PBYTE       pBuffer,
04764     PBYTE       pPublicArrayName,
04765     DWORD       dwPCS,
04766     DWORD       nInputCh,
04767     PBYTE       pLut,
04768     PFIX_16_16  e,
04769     DWORD       dwLutSig,
04770     BOOL        bBinary
04771     )
04772 {
04773     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pLineStart, pStart = pBuffer;
04774     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pTable;
04775     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      i, j;
04776     <a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>  fxTempMatrixABC[9];
04777 
04778     <span class="comment">//</span>
04779     <span class="comment">// /RangeABC</span>
04780     <span class="comment">//</span>
04781 
04782     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a22">RangeABCTag</a>);
04783     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a69">RangeABC</a>);
04784 
04785     <span class="comment">//</span>
04786     <span class="comment">// /MatrixABC</span>
04787     <span class="comment">//</span>
04788 
04789     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a24">MatrixABCTag</a>);
04790     <span class="keywordflow">if</span> (dwPCS == SPACE_XYZ)
04791     {
04792         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
04793         <span class="keywordflow">if</span> (e)
04794         {
04795             <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
04796             {
04797                 <span class="keywordflow">for</span> (j=0; j&lt;3; j++)
04798                 {
04799                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, e[i + j * 3]);
04800                 }
04801             }
04802         }
04803         <span class="keywordflow">else</span>
04804         {
04805             <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
04806             {
04807                 pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) &amp;((<a class="code" href="../../d2/d9/ps2_8c.html#a62">PLUT8TYPE</a>)pLut)-&gt;e00;
04808             }
04809             <span class="keywordflow">else</span>
04810             {
04811                 pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) &amp;((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;e00;
04812             }
04813 
04814             <span class="keywordflow">for</span> (i=0; i&lt;9; i++)
04815             {
04816                 fxTempMatrixABC[i] = <a class="code" href="../../d2/d9/ps2_8c.html#a9">FIX_DIV</a>(FIX_ENDIAN(*((PDWORD)pTable)), <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a3">CIEXYZRange</a>);
04817                 pTable += <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
04818             }
04819             <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
04820             {
04821                 <span class="keywordflow">for</span> (j=0; j&lt;3; j++)
04822                 {
04823                     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, fxTempMatrixABC[i + j * 3]);
04824                 }
04825             }
04826         }
04827         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
04828     }
04829     <span class="keywordflow">else</span>
04830     {
04831         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a102">MatrixABCLabCRD</a>);
04832     }
04833 
04834     <span class="comment">//</span>
04835     <span class="comment">// /EncodeABC</span>
04836     <span class="comment">//</span>
04837 
04838     <span class="keywordflow">if</span> (nInputCh == 0)
04839     {
04840         <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
04841     }
04842 
04843     pLineStart = pBuffer;
04844     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a25">EncodeABCTag</a>);
04845     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
04846     <span class="keywordflow">for</span> (i=0; i&lt;nInputCh; i++)
04847     {
04848         pLineStart = pBuffer;
04849 
04850         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
04851         <span class="keywordflow">if</span> (dwPCS == SPACE_Lab)
04852         {
04853             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, (i == 0) ? <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a104">EncodeABCLab1</a> : <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a105">EncodeABCLab2</a>);
04854         }
04855 
04856         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a89">StartClip</a>);
04857         <span class="keywordflow">if</span> (e)
04858             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a79">PreViewInArray</a>);
04859         <span class="keywordflow">else</span>
04860             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a77">InputArray</a>);
04861 
04862         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, pPublicArrayName);
04863         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, i);
04864 
04865         <span class="keywordflow">if</span> (!bBinary)              <span class="comment">// Output ASCII CRD</span>
04866         {
04867             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>);
04868         }
04869         <span class="keywordflow">else</span>
04870         {                               <span class="comment">// Output BINARY CRD</span>
04871             <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
04872             {
04873                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>);
04874             }
04875             <span class="keywordflow">else</span>
04876             {
04877                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a83">IndexArray16b</a>);
04878             }
04879         }
04880 
04881         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>) ?
04882                          <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a91">Scale8</a> : <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a92">Scale16</a>);
04883         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a90">EndClip</a>);
04884         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
04885     }
04886     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
04887 
04888     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
04889 }
04890 
04891 
04892 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04893"></a><a class="code" href="../../d2/d9/ps2_8c.html#a207">04893</a> <a class="code" href="../../d2/d9/ps2_8c.html#a207">SendCRDOutputTable</a>(
04894     PBYTE pBuffer,
04895     PBYTE pPublicArrayName,
04896     DWORD nOutputCh,
04897     DWORD dwLutSig,
04898     BOOL  bHost,
04899     BOOL  bBinary
04900     )
04901 {
04902     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart = pBuffer;
04903     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
04904 
04905     <span class="keywordflow">for</span> (i=0; i&lt;nOutputCh; i++)
04906     {
04907         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a6">BeginFunction</a>);
04908         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a73">Clip01</a>);
04909         <span class="keywordflow">if</span> (bHost)
04910             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a80">PreViewOutArray</a>);
04911         <span class="keywordflow">else</span>
04912             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a78">OutputArray</a>);
04913 
04914         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, pPublicArrayName);
04915         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a44">WriteInt</a>(pBuffer, i);
04916 
04917         <span class="keywordflow">if</span> (! bBinary)
04918         {
04919             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
04920             <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
04921             {
04922                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a94">TFunction8</a>);
04923             }
04924             <span class="keywordflow">else</span>
04925             {
04926                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a84">IndexArray</a>);
04927                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a92">Scale16</a>);
04928             }
04929         }
04930         <span class="keywordflow">else</span>
04931         {
04932             <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
04933             {
04934                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a94">TFunction8</a>);
04935             }
04936             <span class="keywordflow">else</span>
04937             {
04938                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a83">IndexArray16b</a>);
04939                 pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a92">Scale16</a>);
04940             }
04941         }
04942 
04943         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a7">EndFunction</a>);
04944     }
04945 
04946     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
04947 }
04948 
04949 
04950 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l04951"></a><a class="code" href="../../d2/d9/ps2_8c.html#a219">04951</a> <a class="code" href="../../d2/d9/ps2_8c.html#a219">GetCLUTInfo</a>(
04952     DWORD  dwLutSig,
04953     PBYTE  pLut,
04954     PDWORD pnInputCh,
04955     PDWORD pnOutputCh,
04956     PDWORD pnGrids,
04957     PDWORD pnInputTable,
04958     PDWORD pnOutputTable,
04959     PDWORD pdwSize
04960     )
04961 {
04962     <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
04963     {
04964         *pnInputCh = ((<a class="code" href="../../d2/d9/ps2_8c.html#a62">PLUT8TYPE</a>)pLut)-&gt;nInputChannels;
04965         *pnOutputCh = ((<a class="code" href="../../d2/d9/ps2_8c.html#a62">PLUT8TYPE</a>)pLut)-&gt;nOutputChannels;
04966         *pnGrids = ((<a class="code" href="../../d2/d9/ps2_8c.html#a62">PLUT8TYPE</a>)pLut)-&gt;nClutPoints;
04967         *pnInputTable = 256<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
04968         *pnOutputTable = 256<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
04969         <span class="keywordflow">if</span> (pdwSize)
04970             *pdwSize = 1;
04971     }
04972     <span class="keywordflow">else</span>
04973     {
04974         *pnInputCh = ((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;nInputChannels;
04975         *pnOutputCh = ((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;nOutputChannels;
04976         *pnGrids =  ((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;nClutPoints;
04977         *pnInputTable = FIX_ENDIAN16(((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;wInputEntries);
04978         *pnOutputTable = FIX_ENDIAN16(((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;wOutputEntries);
04979         <span class="keywordflow">if</span> (pdwSize)
04980             *pdwSize = 2;
04981     }
04982 
04983     <span class="keywordflow">return</span>;
04984 }
04985 
04986 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l04987"></a><a class="code" href="../../d2/d9/ps2_8c.html#a220">04987</a> <a class="code" href="../../d2/d9/ps2_8c.html#a220">EnableGlobalDict</a>(
04988     PBYTE pBuffer
04989     )
04990 {
04991     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart = pBuffer;
04992 
04993     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a47">CurrentGlobalOp</a>);
04994     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a52">TrueOp</a>);
04995     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a48">SetGlobalOp</a>);
04996 
04997     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
04998 }
04999 
05000 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l05001"></a><a class="code" href="../../d2/d9/ps2_8c.html#a221">05001</a> <a class="code" href="../../d2/d9/ps2_8c.html#a221">BeginGlobalDict</a>(
05002     PBYTE pBuffer
05003     )
05004 {
05005     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart = pBuffer;
05006 
05007     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a46">GlobalDictOp</a>);
05008     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a50">BeginOp</a>);
05009 
05010     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
05011 }
05012 
05013 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l05014"></a><a class="code" href="../../d2/d9/ps2_8c.html#a222">05014</a> <a class="code" href="../../d2/d9/ps2_8c.html#a222">EndGlobalDict</a>(
05015     PBYTE pBuffer
05016     )
05017 {
05018     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart = pBuffer;
05019 
05020     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a51">EndOp</a>);
05021     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a48">SetGlobalOp</a>);
05022 
05023     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
05024 }
05025 
05026 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l05027"></a><a class="code" href="../../d2/d9/ps2_8c.html#a208">05027</a> <a class="code" href="../../d2/d9/ps2_8c.html#a208">SendCSABWPoint</a>(
05028     PBYTE      pBuffer,
05029     DWORD      dwIntent,
05030     PFIX_16_16 pafxIlluminantWP,
05031     PFIX_16_16 pafxMediaWP
05032     )
05033 {
05034     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pStart = pBuffer;
05035     <span class="keywordtype">int</span>   i;
05036 
05037     <span class="comment">//</span>
05038     <span class="comment">// /BlackPoint</span>
05039     <span class="comment">//</span>
05040 
05041     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a18">BlackPointTag</a>);
05042     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a10">BlackPoint</a>);
05043 
05044     <span class="comment">//</span>
05045     <span class="comment">// /WhitePoint</span>
05046     <span class="comment">//</span>
05047 
05048     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a223">WriteNewLineObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a17">WhitePointTag</a>);
05049     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a4">BeginArray</a>);
05050     <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
05051     {
05052         <span class="keywordflow">if</span> (dwIntent == INTENT_ABSOLUTE_COLORIMETRIC)
05053         {
05054             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, pafxMediaWP[i]);
05055         }
05056         <span class="keywordflow">else</span>
05057         {
05058             pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a231">WriteFixed</a>(pBuffer, pafxIlluminantWP[i]);
05059         }
05060     }
05061     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a43">WriteObject</a>(pBuffer, <a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a5">EndArray</a>);
05062 
05063     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
05064 }
05065 
05066 
05067 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l05068"></a><a class="code" href="../../d2/d9/ps2_8c.html#a209">05068</a> <a class="code" href="../../d2/d9/ps2_8c.html#a209">GetMediaWP</a>(
05069     PBYTE      pProfile,
05070     DWORD      dwIntent,
05071     PFIX_16_16 pafxIlluminantWP,
05072     PFIX_16_16 pafxMediaWP
05073     )
05074 {
05075     <span class="keywordflow">if</span> (dwIntent == INTENT_ABSOLUTE_COLORIMETRIC)
05076     {
05077         <span class="keywordflow">if</span> (! <a class="code" href="../../d2/d9/ps2_8c.html#a192">GetCPMediaWhitePoint</a>(pProfile, pafxMediaWP))
05078         {
05079             pafxMediaWP[0] = pafxIlluminantWP[0];
05080             pafxMediaWP[1] = pafxIlluminantWP[1];
05081             pafxMediaWP[2] = pafxIlluminantWP[2];
05082         }
05083     }
05084 
05085     <span class="keywordflow">return</span>;
05086 }
05087 
05088 
05089 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l05090"></a><a class="code" href="../../d2/d9/ps2_8c.html#a199">05090</a> <a class="code" href="../../d2/d9/ps2_8c.html#a199">GetCRDInputOutputArraySize</a>(
05091     PBYTE  pProfile,
05092     DWORD  dwIntent,
05093     PDWORD pdwInTblSize,
05094     PDWORD pdwOutTblSize,
05095     PDWORD pdwTag,
05096     PDWORD pnGrids
05097     )
05098 {
05099     PTAGDATA   pTagData;
05100     <a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a> pLut;
05101     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwIndex, dwLutSig;
05102     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      nInputEntries, nOutputEntries;
05103     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      nInputCh, nOutputCh, nGrids;
05104     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>       bRet;
05105 
05106     <span class="comment">//</span>
05107     <span class="comment">// Make sure required tags exist</span>
05108     <span class="comment">//</span>
05109 
05110     <span class="keywordflow">switch</span> (dwIntent)
05111     {
05112     <span class="keywordflow">case</span> INTENT_PERCEPTUAL:
05113         *pdwTag = <a class="code" href="../../d2/d9/ps2_8c.html#a33">TAG_BToA0</a>;
05114         <span class="keywordflow">break</span>;
05115 
05116     <span class="keywordflow">case</span> INTENT_RELATIVE_COLORIMETRIC:
05117     <span class="keywordflow">case</span> INTENT_ABSOLUTE_COLORIMETRIC:
05118         *pdwTag = <a class="code" href="../../d2/d9/ps2_8c.html#a34">TAG_BToA1</a>;
05119         <span class="keywordflow">break</span>;
05120 
05121     <span class="keywordflow">case</span> INTENT_SATURATION:
05122         *pdwTag = <a class="code" href="../../d2/d9/ps2_8c.html#a35">TAG_BToA2</a>;
05123         <span class="keywordflow">break</span>;
05124 
05125     <span class="keywordflow">default</span>:
05126         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid intent passed to GetCRDInputOutputArraySize: %d\n"</span>), dwIntent));
05127         SetLastError(ERROR_INVALID_PARAMETER);
05128         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05129     }
05130 
05131     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, *pdwTag, &amp;dwIndex))
05132     {
05133         pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
05134                    dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
05135 
05136         pLut = (<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
05137 
05138         dwLutSig = FIX_ENDIAN(pLut-&gt;<a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o0">dwSignature</a>);
05139 
05140         <span class="keywordflow">if</span> ((dwLutSig != <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>) &amp;&amp; (dwLutSig != <a class="code" href="../../d2/d9/ps2_8c.html#a38">LUT16_TYPE</a>))
05141         {
05142             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid Lut type - unable to create proofing CRD\n"</span>)));
05143             SetLastError(ERROR_INVALID_PROFILE);
05144             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05145         }
05146 
05147         (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a219">GetCLUTInfo</a>(dwLutSig, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut, &amp;nInputCh, &amp;nOutputCh,
05148                 &amp;nGrids, &amp;nInputEntries, &amp;nOutputEntries, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
05149 
05150         <span class="keywordflow">if</span> (pdwInTblSize)
05151         {
05152             <span class="keywordflow">if</span> (nInputCh != 3)
05153             {
05154                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05155             }
05156 
05157             *pdwInTblSize = nInputCh * nInputEntries * 6;  <span class="comment">// Number of INT bytes</span>
05158             *pnGrids = nGrids;
05159         }
05160 
05161         <span class="keywordflow">if</span> (pdwOutTblSize)
05162         {
05163             <span class="keywordflow">if</span> ((nOutputCh != 3) &amp;&amp; (nOutputCh != 4))
05164             {
05165                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05166             }
05167 
05168             *pdwOutTblSize = nOutputCh * nOutputEntries * 6; <span class="comment">// Number of INT bytes</span>
05169             *pnGrids = nGrids;
05170         }
05171 
05172         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05173     }
05174     <span class="keywordflow">else</span>
05175     {
05176         <span class="comment">//</span>
05177         <span class="comment">// Matrix icc profile.</span>
05178         <span class="comment">//</span>
05179 
05180         *pnGrids = 2;
05181 
05182         <span class="keywordflow">if</span> (pdwInTblSize)
05183         {
05184             bRet = <a class="code" href="../../d2/d9/ps2_8c.html#a200">GetHostCSA</a>(pProfile, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, pdwInTblSize,
05185                               dwIntent, <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a0">TYPE_CIEBASEDDEF</a>);
05186             *pdwInTblSize = *pdwInTblSize * 3;
05187         }
05188 
05189         <span class="keywordflow">if</span> (bRet &amp;&amp; pdwOutTblSize)
05190         {
05191             bRet = <a class="code" href="../../d2/d9/ps2_8c.html#a200">GetHostCSA</a>(pProfile, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, pdwInTblSize,
05192                               dwIntent, <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a0">TYPE_CIEBASEDDEF</a>);
05193             *pdwOutTblSize = *pdwOutTblSize * 3;
05194         }
05195 
05196         <span class="keywordflow">return</span> bRet;
05197     }
05198 }
05199 
05200 <span class="preprocessor">#if !defined(KERNEL_MODE) || defined(USERMODE_DRIVER)</span>
05201 <span class="preprocessor"></span>
05202 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l05203"></a><a class="code" href="../../d2/d9/ps2_8c.html#a235">05203</a> <a class="code" href="../../d2/d9/ps2_8c.html#a235">CreateHostLutCRD</a>(
05204     PBYTE  pProfile,
05205     DWORD  dwIndex,
05206     PBYTE  pBuffer,
05207     DWORD  dwIntent
05208     )
05209 {
05210     <a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a> pLut;
05211     <a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>  pHostClut;
05212     PTAGDATA   pTagData;
05213     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pTable;
05214     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      nInputCh, nOutputCh, nGrids;
05215     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      nInputEntries, nOutputEntries, nNumbers;
05216     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwPCS, dwLutSig;
05217     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwSize, i, j;
05218     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pStart = pBuffer;
05219 
05220     <span class="comment">//</span>
05221     <span class="comment">// Check if we can generate the CSA</span>
05222     <span class="comment">// Required  tags is AToBi, where i is the rendering intent</span>
05223     <span class="comment">//</span>
05224 
05225     dwPCS = <a class="code" href="../../d2/d9/ps2_8c.html#a40">GetCPConnSpace</a>(pProfile);
05226 
05227     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
05228                dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
05229 
05230     pLut = (<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
05231 
05232     dwLutSig = FIX_ENDIAN(pLut-&gt;<a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o0">dwSignature</a>);
05233 
05234     <span class="keywordflow">if</span> ((dwLutSig != <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>) &amp;&amp; (dwLutSig != <a class="code" href="../../d2/d9/ps2_8c.html#a38">LUT16_TYPE</a>))
05235     {
05236         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid profile - unable to create Lut CRD\n"</span>)));
05237         SetLastError(ERROR_INVALID_PROFILE);
05238         <span class="keywordflow">return</span> 0;
05239     }
05240 
05241     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a219">GetCLUTInfo</a>(dwLutSig, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut, &amp;nInputCh, &amp;nOutputCh,
05242             &amp;nGrids, &amp;nInputEntries, &amp;nOutputEntries, &amp;i);
05243 
05244     <span class="keywordflow">if</span> (((nOutputCh != 3) &amp;&amp; (nOutputCh != 4)) ||  (nInputCh != 3))
05245     {
05246         <span class="keywordflow">return</span> 0;
05247     }
05248 
05249     <span class="keywordflow">if</span> (pBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
05250     {
05251         <span class="comment">//</span>
05252         <span class="comment">// Return size</span>
05253         <span class="comment">//</span>
05254 
05255         dwSize = nInputCh * nInputEntries * i    +  <span class="comment">// Input table 8/16-bits</span>
05256             nOutputCh * nOutputEntries * i       +  <span class="comment">// Output table 8/16-bits</span>
05257             nOutputCh * nGrids * nGrids * nGrids +  <span class="comment">// CLUT 8-bits only</span>
05258             <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6/structtagHOSTCLUT.html">HOSTCLUT</a>)                     +  <span class="comment">// Data structure</span>
05259             2048;                                   <span class="comment">// Other PS stuff</span>
05260 
05261         <span class="comment">//</span>
05262         <span class="comment">// Add space for new line.</span>
05263         <span class="comment">//</span>
05264 
05265         dwSize += (((dwSize) / <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>) + 1) * <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
05266 
05267         <span class="keywordflow">return</span> dwSize;
05268     }
05269         
05270     pHostClut = (<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)pBuffer;
05271     pBuffer += <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6/structtagHOSTCLUT.html">HOSTCLUT</a>);
05272     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o18">wSize</a> = <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6/structtagHOSTCLUT.html">HOSTCLUT</a>);
05273     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o19">wDataType</a> = <a class="code" href="../../d2/d9/ps2_8c.html#a51">DATATYPE_LUT</a>;
05274     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o21">dwPCS</a> = dwPCS;
05275     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o22">dwIntent</a> = dwIntent;
05276     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o28">nLutBits</a> = (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>) ? 8 : 16;
05277 
05278     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(pProfile, pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o23">afxIlluminantWP</a>);
05279 
05280     <span class="comment">//</span>
05281     <span class="comment">// Support absolute whitePoint</span>
05282     <span class="comment">//</span>
05283 
05284     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d9/ps2_8c.html#a192">GetCPMediaWhitePoint</a>(pProfile, pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o24">afxMediaWP</a>))
05285     {
05286         pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o24">afxMediaWP</a>[0] = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o23">afxIlluminantWP</a>[0];
05287         pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o24">afxMediaWP</a>[1] = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o23">afxIlluminantWP</a>[1];
05288         pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o24">afxMediaWP</a>[2] = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o23">afxIlluminantWP</a>[2];
05289     }
05290 
05291     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o25">nInputCh</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)nInputCh;
05292     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o26">nOutputCh</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)nOutputCh;
05293     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o27">nClutPoints</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)nGrids;
05294     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o30">nInputEntries</a> = (WORD)nInputEntries;
05295     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o31">nOutputEntries</a> = (WORD)nOutputEntries;
05296 
05297     <span class="comment">//</span>
05298     <span class="comment">// Input array</span>
05299     <span class="comment">//</span>
05300 
05301     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a237">CreateHostInputOutputArray</a>(
05302                         pBuffer,
05303                         pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o14">inputArray</a>,
05304                         nInputCh,
05305                         nInputEntries,
05306                         0,
05307                         dwLutSig,
05308                         (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut);
05309 
05310     <span class="comment">//</span>
05311     <span class="comment">// The offset to the position of output array.</span>
05312     <span class="comment">//</span>
05313 
05314     i = nInputEntries * nInputCh +
05315         nGrids * nGrids * nGrids * nOutputCh;
05316 
05317     <span class="comment">//</span>
05318     <span class="comment">// Output array</span>
05319     <span class="comment">//</span>
05320 
05321     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a237">CreateHostInputOutputArray</a>(
05322                         pBuffer,
05323                         pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o15">outputArray</a>,
05324                         nOutputCh,
05325                         nOutputEntries,
05326                         i,
05327                         dwLutSig,
05328                         (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut);
05329 
05330     <span class="comment">//</span>
05331     <span class="comment">// Matrix</span>
05332     <span class="comment">//</span>
05333 
05334     <span class="keywordflow">if</span> (dwPCS == SPACE_XYZ)
05335     {
05336         <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
05337         {
05338             pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) &amp;((<a class="code" href="../../d2/d9/ps2_8c.html#a62">PLUT8TYPE</a>)pLut)-&gt;e00;
05339         } <span class="keywordflow">else</span>
05340         {
05341             pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) &amp;((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;e00;
05342         }
05343 
05344         <span class="keywordflow">for</span> (i=0; i&lt;9; i++)
05345         {
05346             pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o11">e</a>[i] = <a class="code" href="../../d2/d9/ps2_8c.html#a9">FIX_DIV</a>(FIX_ENDIAN(*((PDWORD)pTable)), <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a3">CIEXYZRange</a>);
05347             pTable += <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
05348         }
05349     }
05350 
05351     <span class="comment">//</span>
05352     <span class="comment">// RenderTable</span>
05353     <span class="comment">//</span>
05354 
05355     nNumbers = nGrids * nGrids * nOutputCh;
05356     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o16">clut</a> = pBuffer;
05357 
05358     <span class="keywordflow">for</span> (i=0; i&lt;nGrids; i++)        <span class="comment">// Na strings should be sent</span>
05359     {
05360         <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
05361         {
05362             pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(((<a class="code" href="../../d2/d9/ps2_8c.html#a62">PLUT8TYPE</a>)pLut)-&gt;data) +
05363                 nInputEntries * nInputCh +
05364                 nNumbers * i;
05365         }
05366         <span class="keywordflow">else</span>
05367         {
05368             pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;data) +
05369                 2 * nInputEntries * nInputCh +
05370                 2 * nNumbers * i;
05371         }
05372 
05373         <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
05374         {
05375             CopyMemory(pBuffer, pTable, nNumbers);
05376             pBuffer += nNumbers;
05377         }
05378         <span class="keywordflow">else</span>
05379         {
05380             <span class="keywordflow">for</span> (j=0; j&lt;nNumbers; j++)
05381             {
05382                 *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(FIX_ENDIAN16(*((PWORD)pTable)) / 256);
05383                 pTable += <span class="keyword">sizeof</span>(WORD);
05384             }
05385         }
05386     }
05387 
05388     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
05389 }
05390 
05391 
05392 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l05393"></a><a class="code" href="../../d2/d9/ps2_8c.html#a236">05393</a> <a class="code" href="../../d2/d9/ps2_8c.html#a236">CreateHostMatrixCSAorCRD</a>(
05394     PBYTE pProfile,
05395     PBYTE pBuffer,
05396     PDWORD pcbSize,
05397     DWORD dwIntent,
05398     BOOL bCSA
05399     )
05400 {
05401     PTAGDATA   pTagData;
05402     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwRedTRCIndex, dwGreenTRCIndex, dwBlueTRCIndex;
05403     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwRedCount, dwGreenCount, dwBlueCount;
05404     <a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a> pRed, pGreen, pBlue;
05405     <a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>  pHostClut;
05406     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pStart = pBuffer;
05407     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      i, dwSize;
05408     <span class="keywordtype">double</span>     adArray[9], adRevArray[9], adTemp[9];
05409 
05410     <span class="comment">//</span>
05411     <span class="comment">// Get each TRC index for Red, Green and Blue.</span>
05412     <span class="comment">//</span>
05413 
05414     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a17">TAG_REDTRC</a>, &amp;dwRedTRCIndex) ||
05415         !<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a18">TAG_GREENTRC</a>, &amp;dwGreenTRCIndex) ||
05416         !<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a19">TAG_BLUETRC</a>, &amp;dwBlueTRCIndex))
05417     {
05418         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05419     }
05420 
05421     <span class="comment">//</span>
05422     <span class="comment">// Get CURVETYPE data for each Red, Green and Blue</span>
05423     <span class="comment">//</span>
05424 
05425     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
05426                dwRedTRCIndex * <span class="keyword">sizeof</span>(TAGDATA));
05427 
05428     pRed = (<a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
05429 
05430     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
05431                dwGreenTRCIndex * <span class="keyword">sizeof</span>(TAGDATA));
05432 
05433     pGreen = (<a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
05434 
05435     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
05436                dwBlueTRCIndex * <span class="keyword">sizeof</span>(TAGDATA));
05437 
05438     pBlue = (<a class="code" href="../../d2/d9/ps2_8c.html#a58">PCURVETYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
05439 
05440     <span class="comment">//</span>
05441     <span class="comment">// Get curve count for each Red, Green and Blue.</span>
05442     <span class="comment">//</span>
05443 
05444     dwRedCount   = FIX_ENDIAN(pRed-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
05445     dwGreenCount = FIX_ENDIAN(pGreen-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
05446     dwBlueCount  = FIX_ENDIAN(pBlue-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o2">nCount</a>);
05447 
05448     <span class="comment">//</span>
05449     <span class="comment">// Estimate the memory size required to hold CRD</span>
05450     <span class="comment">//</span>
05451 
05452     dwSize = (dwRedCount + dwGreenCount + dwBlueCount) * 2 +
05453              <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6/structtagHOSTCLUT.html">HOSTCLUT</a>) + 2048;   <span class="comment">// data structure + extra safe space</span>
05454 
05455     <span class="comment">//</span>
05456     <span class="comment">// Add space for new line.</span>
05457     <span class="comment">//</span>
05458 
05459     dwSize += (((dwSize) / <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>) + 1) * <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
05460 
05461     <span class="keywordflow">if</span> (pBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)     <span class="comment">// This is a size request</span>
05462     {
05463         *pcbSize = dwSize;
05464         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05465     }
05466 
05467     <span class="comment">//</span>
05468     <span class="comment">// Check buffer size.</span>
05469     <span class="comment">//</span>
05470 
05471     <span class="keywordflow">if</span> (*pcbSize &lt; dwSize)
05472     {
05473         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Buffer too small to get Host Matrix CSA/CRD\n"</span>)));
05474         SetLastError(ERROR_INSUFFICIENT_BUFFER);
05475         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05476     }
05477 
05478     pHostClut = (<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)pBuffer;
05479     pBuffer += <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6/structtagHOSTCLUT.html">HOSTCLUT</a>);
05480     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o18">wSize</a> = <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6/structtagHOSTCLUT.html">HOSTCLUT</a>);
05481     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o19">wDataType</a> = <a class="code" href="../../d2/d9/ps2_8c.html#a52">DATATYPE_MATRIX</a>;
05482     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o21">dwPCS</a> = SPACE_XYZ;
05483     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o22">dwIntent</a> = dwIntent;
05484     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o27">nClutPoints</a> = 2;
05485 
05486     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(pProfile, pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o23">afxIlluminantWP</a>);
05487 
05488     <span class="keywordflow">if</span> (bCSA)
05489     {
05490         pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o30">nInputEntries</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) dwRedCount;
05491         pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o25">nInputCh</a>      = 3;
05492 
05493         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a238">CreateHostTRCInputTable</a>(pBuffer, pHostClut,
05494                                            pRed, pGreen, pBlue);
05495     }
05496     <span class="keywordflow">else</span>
05497     {
05498         pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o31">nOutputEntries</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) dwRedCount;
05499         pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o26">nOutputCh</a> = 3;
05500 
05501         pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a239">CreateHostRevTRCInputTable</a>(pBuffer, pHostClut,
05502                                               pRed, pGreen, pBlue);
05503     }
05504 
05505     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d9/ps2_8c.html#a251">CreateColorantArray</a>(pProfile, &amp;adTemp[0], <a class="code" href="../../d2/d9/ps2_8c.html#a14">TAG_REDCOLORANT</a>) ||
05506         !<a class="code" href="../../d2/d9/ps2_8c.html#a251">CreateColorantArray</a>(pProfile, &amp;adTemp[3], <a class="code" href="../../d2/d9/ps2_8c.html#a15">TAG_GREENCOLORANT</a>) ||
05507         !<a class="code" href="../../d2/d9/ps2_8c.html#a251">CreateColorantArray</a>(pProfile, &amp;adTemp[6], <a class="code" href="../../d2/d9/ps2_8c.html#a16">TAG_BLUECOLORANT</a>))
05508     {
05509         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Fail to create colorant array for Host Matrix CSA/CRD\n"</span>)));
05510         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05511     }
05512 
05513     <span class="keywordflow">for</span> (i = 0; i &lt; 9; i++)
05514     {
05515         adArray[i] = adTemp[i/8*8 + i*3%8];
05516     }
05517 
05518     <span class="keywordflow">if</span> (bCSA)
05519     {
05520         <span class="keywordflow">for</span> (i = 0; i &lt; 9; i++)
05521         {
05522             <span class="comment">//</span>
05523             <span class="comment">// Convert double to Fix 16.16</span>
05524             <span class="comment">//</span>
05525 
05526             pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o11">e</a>[i] = (<a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>)(adArray[i] * (<span class="keywordtype">double</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a>);
05527         }
05528     }
05529     <span class="keywordflow">else</span>
05530     {
05531         <a class="code" href="../../d2/d9/ps2_8c.html#a252">InvertColorantArray</a>(adArray, adRevArray);
05532         <span class="keywordflow">for</span> (i = 0; i &lt; 9; i++)
05533         {
05534             <span class="comment">//</span>
05535             <span class="comment">// Convert double to Fix 16.16</span>
05536             <span class="comment">//</span>
05537 
05538             pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o11">e</a>[i] = (<a class="code" href="../../d2/d9/ps2_8c.html#a55">FIX_16_16</a>)(adRevArray[i] * (<span class="keywordtype">double</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a>);
05539         }
05540     }
05541 
05542     *pcbSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(pBuffer - pStart);
05543 
05544     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05545 }
05546 
05547 
05548 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l05549"></a><a class="code" href="../../d2/d9/ps2_8c.html#a238">05549</a> <a class="code" href="../../d2/d9/ps2_8c.html#a238">CreateHostTRCInputTable</a>(
05550     PBYTE pBuffer,
05551     PHOSTCLUT pHostClut,
05552     PCURVETYPE pRed,
05553     PCURVETYPE pGreen,
05554     PCURVETYPE pBlue
05555     )
05556 {
05557     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
05558     PWORD pBuffer16 = (PWORD) pBuffer;
05559     PWORD pTable;
05560 
05561     <span class="comment">//</span>
05562     <span class="comment">// Red</span>
05563     <span class="comment">//</span>
05564 
05565     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o14">inputArray</a>[0] = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) pBuffer16;
05566     pTable = pRed-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o3">data</a>;
05567     <span class="keywordflow">for</span> (i = 0; i &lt; pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o30">nInputEntries</a>; i++)
05568     {
05569         *pBuffer16++ = FIX_ENDIAN16(*pTable);
05570         pTable++;
05571     }
05572 
05573     <span class="comment">//</span>
05574     <span class="comment">// Green</span>
05575     <span class="comment">//</span>
05576 
05577     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o14">inputArray</a>[1] = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) pBuffer16;
05578     pTable = pGreen-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o3">data</a>;
05579     <span class="keywordflow">for</span> (i = 0; i &lt; pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o30">nInputEntries</a>; i++)
05580     {
05581         *pBuffer16++ = FIX_ENDIAN16(*pTable);
05582         pTable++;
05583     }
05584 
05585     <span class="comment">//</span>
05586     <span class="comment">// Blue</span>
05587     <span class="comment">//</span>
05588 
05589     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o14">inputArray</a>[2] = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) pBuffer16;
05590     pTable = pBlue-&gt;<a class="code" href="../../d1/d2/structtagCURVETYPE.html#o3">data</a>;
05591     <span class="keywordflow">for</span> (i = 0; i &lt; pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o30">nInputEntries</a>; i++)
05592     {
05593         *pBuffer16++ = FIX_ENDIAN16(*pTable);
05594         pTable++;
05595     }
05596 
05597     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pBuffer16 - pBuffer);
05598 }
05599 
05600 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l05601"></a><a class="code" href="../../d2/d9/ps2_8c.html#a239">05601</a> <a class="code" href="../../d2/d9/ps2_8c.html#a239">CreateHostRevTRCInputTable</a>(
05602     PBYTE pBuffer,
05603     PHOSTCLUT pHostClut,
05604     PCURVETYPE pRed,
05605     PCURVETYPE pGreen,
05606     PCURVETYPE pBlue
05607     )
05608 {
05609     PWORD pTemp = <a class="code" href="../../d2/d1/object_8c.html#a7">MemAlloc</a>(pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o31">nOutputEntries</a> * (<a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a> + 1) * 2);
05610 
05611     <span class="keywordflow">if</span> (! pTemp)
05612     {
05613         <span class="keywordflow">return</span> 0;
05614     }
05615 
05616     <span class="comment">//</span>
05617     <span class="comment">// Red</span>
05618     <span class="comment">//</span>
05619 
05620     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o15">outputArray</a>[0] = pBuffer;
05621     <a class="code" href="../../d2/d9/ps2_8c.html#a218">GetRevCurve</a>(pRed, pTemp, (PWORD) pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o15">outputArray</a>[0]);
05622 
05623     <span class="comment">//</span>
05624     <span class="comment">// Green</span>
05625     <span class="comment">//</span>
05626 
05627     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o15">outputArray</a>[1] = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o15">outputArray</a>[0] +
05628                                 2 * <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a> * pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o31">nOutputEntries</a>;
05629     <a class="code" href="../../d2/d9/ps2_8c.html#a218">GetRevCurve</a>(pGreen, pTemp, (PWORD) pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o15">outputArray</a>[1]);
05630 
05631     <span class="comment">//</span>
05632     <span class="comment">// Blue</span>
05633     <span class="comment">//</span>
05634 
05635     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o15">outputArray</a>[2] = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o15">outputArray</a>[1] +
05636                                 2 * <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a> * pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o31">nOutputEntries</a>;
05637     <a class="code" href="../../d2/d9/ps2_8c.html#a218">GetRevCurve</a>(pBlue, pTemp, (PWORD) pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o15">outputArray</a>[2]);
05638 
05639     <a class="code" href="../../d2/d1/object_8c.html#a9">MemFree</a>(pTemp);
05640 
05641     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(2 * <a class="code" href="../../d1/d6/aug98_2dll32_2icm_8h.html#a32">REVCURVE_RATIO</a> * pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o31">nOutputEntries</a> * 3);
05642 }
05643 
05644 <span class="comment">/***************************************************************************</span>
05645 <span class="comment">*                      GetHostColorRenderingDictionary</span>
05646 <span class="comment">*  function:</span>
05647 <span class="comment">*    this is the main function which creates the Host CRD</span>
05648 <span class="comment">*  parameters:</span>
05649 <span class="comment">*       cp          --  Color Profile handle</span>
05650 <span class="comment">*       Intent      --  Intent.</span>
05651 <span class="comment">*       lpMem       --  Pointer to the memory block.If this point is NULL,</span>
05652 <span class="comment">*                       require buffer size.</span>
05653 <span class="comment">*       lpcbSize    --  size of memory block.</span>
05654 <span class="comment">*</span>
05655 <span class="comment">*  returns:</span>
05656 <span class="comment">*       SINT        --  !=0 if the function was successful,</span>
05657 <span class="comment">*                         0 otherwise.</span>
05658 <span class="comment">*                       Returns number of bytes required/transferred</span>
05659 <span class="comment">***************************************************************************/</span>
05660 
05661 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l05662"></a><a class="code" href="../../d2/d9/ps2_8c.html#a201">05662</a> <a class="code" href="../../d2/d9/ps2_8c.html#a201">GetHostColorRenderingDictionary</a>(
05663     PBYTE  pProfile,
05664     DWORD  dwIntent,
05665     PBYTE  pBuffer,
05666     PDWORD pdwSize
05667     )
05668 {
05669     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwBToATag, dwIndex;
05670 
05671     <span class="keywordflow">switch</span> (dwIntent)
05672     {
05673     <span class="keywordflow">case</span> INTENT_PERCEPTUAL:
05674         dwBToATag = <a class="code" href="../../d2/d9/ps2_8c.html#a33">TAG_BToA0</a>;
05675         <span class="keywordflow">break</span>;
05676 
05677     <span class="keywordflow">case</span> INTENT_RELATIVE_COLORIMETRIC:
05678     <span class="keywordflow">case</span> INTENT_ABSOLUTE_COLORIMETRIC:
05679         dwBToATag = <a class="code" href="../../d2/d9/ps2_8c.html#a34">TAG_BToA1</a>;
05680         <span class="keywordflow">break</span>;
05681 
05682     <span class="keywordflow">case</span> INTENT_SATURATION:
05683         dwBToATag = <a class="code" href="../../d2/d9/ps2_8c.html#a35">TAG_BToA2</a>;
05684         <span class="keywordflow">break</span>;
05685 
05686     <span class="keywordflow">default</span>:
05687         *pdwSize = 0;
05688         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05689     }
05690 
05691     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, dwBToATag, &amp;dwIndex))
05692     {
05693         *pdwSize = <a class="code" href="../../d2/d9/ps2_8c.html#a235">CreateHostLutCRD</a>(pProfile, dwIndex, pBuffer, dwIntent);
05694 
05695         <span class="keywordflow">return</span> *pdwSize &gt; 0;
05696     }
05697     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a190">DoesTRCAndColorantTagExist</a>(pProfile))
05698     {
05699         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/ps2_8c.html#a236">CreateHostMatrixCSAorCRD</a>(pProfile, pBuffer, pdwSize, dwIntent, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
05700     }
05701     <span class="keywordflow">else</span>
05702     {
05703         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05704     }
05705 }
05706 
05707 
05708 <span class="comment">/***************************************************************************</span>
05709 <span class="comment">*                           CreateHostInputOutputArray</span>
05710 <span class="comment">*  function:</span>
05711 <span class="comment">*    this is the function which creates the output array from the data</span>
05712 <span class="comment">*    supplied in the ColorProfile's LUT8 or LUT16 tag.</span>
05713 <span class="comment">*  parameters:</span>
05714 <span class="comment">*    MEMPTR     lpMem        : The buffer to save output array.</span>
05715 <span class="comment">*    LPHOSTCLUT lpHostClut   :</span>
05716 <span class="comment">*    SINT       nOutputCh    : Number of input channel.</span>
05717 <span class="comment">*    SINT       nOutputTable : The size of each input table.</span>
05718 <span class="comment">*    SINT       Offset       : The position of source output data(in icc profile).</span>
05719 <span class="comment">*    CSIG       Tag          : To determin the Output table is 8 or 16 bits.</span>
05720 <span class="comment">*    MEMPTR     Buff         : The buffer that contains source data(copyed from icc profile)</span>
05721 <span class="comment">*</span>
05722 <span class="comment">*  returns:</span>
05723 <span class="comment">*       SINT    Returns number of bytes of Output Array</span>
05724 <span class="comment">*</span>
05725 <span class="comment">***************************************************************************/</span>
05726 
05727 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l05728"></a><a class="code" href="../../d2/d9/ps2_8c.html#a237">05728</a> <a class="code" href="../../d2/d9/ps2_8c.html#a237">CreateHostInputOutputArray</a>(
05729     PBYTE  pBuffer,
05730     PBYTE  *ppArray,
05731     DWORD  nNumChan,
05732     DWORD  nTableSize,
05733     DWORD  dwOffset,
05734     DWORD  dwLutSig,
05735     PBYTE  pLut
05736     )
05737 {
05738     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>   pStart = pBuffer;
05739     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>   pTable;
05740     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   i, j;
05741 
05742     <span class="keywordflow">for</span> (i=0; i&lt;nNumChan; i++)
05743     {
05744         ppArray[i] = pBuffer;
05745 
05746         <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
05747         {
05748             pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) (((<a class="code" href="../../d2/d9/ps2_8c.html#a62">PLUT8TYPE</a>)pLut)-&gt;data) +
05749                 dwOffset + nTableSize * i;
05750 
05751             CopyMemory(pBuffer, pTable, nTableSize);
05752 
05753             pBuffer += nTableSize;
05754         }
05755         <span class="keywordflow">else</span>
05756         {
05757             pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) (((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;data) +
05758                 2 * dwOffset +
05759                 2 * nTableSize * i;
05760 
05761             <span class="keywordflow">for</span> (j=0; j&lt;nTableSize; j++)
05762             {
05763                 *((PWORD)pBuffer) = FIX_ENDIAN16(*((PWORD)pTable));
05764                 pBuffer += <span class="keyword">sizeof</span>(WORD);
05765                 pTable += <span class="keyword">sizeof</span>(WORD);
05766             }
05767         }
05768     }
05769 
05770     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
05771 }
05772 
05773 
05774 <span class="comment">/***************************************************************************</span>
05775 <span class="comment">*                           GetHostCSA</span>
05776 <span class="comment">*  function:</span>
05777 <span class="comment">*    this is the function which creates a Host CSA</span>
05778 <span class="comment">*  parameters:</span>
05779 <span class="comment">*       CHANDLE cp       --  Color Profile handle</span>
05780 <span class="comment">*       MEMPTR lpMem     --  Pointer to the memory block. If this point is NULL,</span>
05781 <span class="comment">*                            require buffer size.</span>
05782 <span class="comment">*       LPDWORD lpcbSize --  Size of the memory block</span>
05783 <span class="comment">*       CSIG InputIntent --</span>
05784 <span class="comment">*       SINT Index       --  to the icc profile tag that contains the data of Intent</span>
05785 <span class="comment">*       int  Type        --  DEF or DEFG</span>
05786 <span class="comment">*  returns:</span>
05787 <span class="comment">*       BOOL        --  TRUE if the function was successful,</span>
05788 <span class="comment">*                       FALSE otherwise.</span>
05789 <span class="comment">***************************************************************************/</span>
05790 
05791 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l05792"></a><a class="code" href="../../d2/d9/ps2_8c.html#a200">05792</a> <a class="code" href="../../d2/d9/ps2_8c.html#a200">GetHostCSA</a>(
05793     PBYTE  pProfile,
05794     PBYTE  pBuffer,
05795     PDWORD pdwSize,
05796     DWORD  dwIntent,
05797     DWORD  dwType
05798     )
05799 {
05800     <a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>  pHostClut;
05801     PTAGDATA   pTagData;
05802     <a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a> pLut;
05803     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwAToBTag;
05804     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwPCS, dwLutSig;
05805     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      nInputCh, nOutputCh, nGrids, SecondGrids;
05806     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      nInputTable, nOutputTable, nNumbers;
05807     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwIndex, i, j, k;
05808     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pTable;
05809     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      pStart = pBuffer;
05810 
05811     <span class="keywordflow">switch</span> (dwIntent)
05812     {
05813     <span class="keywordflow">case</span> INTENT_PERCEPTUAL:
05814         dwAToBTag = <a class="code" href="../../d2/d9/ps2_8c.html#a22">TAG_AToB0</a>;
05815         <span class="keywordflow">break</span>;
05816 
05817     <span class="keywordflow">case</span> INTENT_RELATIVE_COLORIMETRIC:
05818     <span class="keywordflow">case</span> INTENT_ABSOLUTE_COLORIMETRIC:
05819         dwAToBTag = <a class="code" href="../../d2/d9/ps2_8c.html#a23">TAG_AToB1</a>;
05820         <span class="keywordflow">break</span>;
05821 
05822     <span class="keywordflow">case</span> INTENT_SATURATION:
05823         dwAToBTag = <a class="code" href="../../d2/d9/ps2_8c.html#a24">TAG_AToB2</a>;
05824         <span class="keywordflow">break</span>;
05825 
05826     <span class="keywordflow">default</span>:
05827         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid intent passed to GetHostCSA: %d\n"</span>), dwIntent));
05828         SetLastError(ERROR_INVALID_PARAMETER);
05829         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05830         <span class="keywordflow">break</span>;
05831     }
05832 
05833     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, dwAToBTag, &amp;dwIndex))
05834     {
05835         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a190">DoesTRCAndColorantTagExist</a>(pProfile) &amp;&amp; (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a0">TYPE_CIEBASEDDEF</a>))
05836         {
05837             <span class="comment">//</span>
05838             <span class="comment">// Create Host CSA from Matrix.</span>
05839             <span class="comment">//</span>
05840 
05841             <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/ps2_8c.html#a236">CreateHostMatrixCSAorCRD</a>(pProfile,pBuffer,pdwSize,dwIntent,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
05842         }
05843         <span class="keywordflow">else</span>
05844         {
05845             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"AToB tag not present for intent %d\n"</span>), dwIntent));
05846             SetLastError(ERROR_TAG_NOT_PRESENT);
05847             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05848         }
05849     }
05850 
05851     <span class="comment">//</span>
05852     <span class="comment">// Check if we can generate the CSA</span>
05853     <span class="comment">//</span>
05854 
05855     dwPCS = <a class="code" href="../../d2/d9/ps2_8c.html#a40">GetCPConnSpace</a>(pProfile);
05856 
05857     pTagData = (PTAGDATA)(pProfile + <span class="keyword">sizeof</span>(PROFILEHEADER) + <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) +
05858                dwIndex * <span class="keyword">sizeof</span>(TAGDATA));
05859 
05860     pLut = (<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)(pProfile + FIX_ENDIAN(pTagData-&gt;dwOffset));
05861 
05862     dwLutSig = FIX_ENDIAN(pLut-&gt;<a class="code" href="../../d3/d0/structtagLUT16TYPE.html#o0">dwSignature</a>);
05863 
05864     <span class="keywordflow">if</span> (((dwPCS != SPACE_Lab) &amp;&amp; (dwPCS != SPACE_XYZ)) ||
05865         ((dwLutSig != <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>) &amp;&amp; (dwLutSig != <a class="code" href="../../d2/d9/ps2_8c.html#a38">LUT16_TYPE</a>)))
05866     {
05867         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a4">WARNING</a>((__TEXT(<span class="stringliteral">"Invalid color space - unable to create DEF(G) host CSA\n"</span>)));
05868         SetLastError(ERROR_INVALID_PROFILE);
05869         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05870     }
05871 
05872     <span class="comment">//</span>
05873     <span class="comment">// Estimate the memory size required to hold CSA</span>
05874     <span class="comment">//</span>
05875 
05876     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a219">GetCLUTInfo</a>(dwLutSig, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut, &amp;nInputCh, &amp;nOutputCh, &amp;nGrids,
05877                 &amp;nInputTable, &amp;nOutputTable, &amp;i);
05878 
05879     <span class="keywordflow">if</span> (!(nOutputCh == 3) ||
05880         !((nInputCh == 3) &amp;&amp; (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a0">TYPE_CIEBASEDDEF</a>)) &amp;&amp;
05881         !((nInputCh == 4) &amp;&amp; (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)))
05882     {
05883         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05884     }
05885         
05886     <span class="keywordflow">if</span> (pBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
05887     {
05888         <span class="comment">//</span>
05889         <span class="comment">// Return size</span>
05890         <span class="comment">//</span>
05891 
05892         <span class="keywordflow">if</span> (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)
05893             *pdwSize = nOutputCh * nGrids * nGrids * nGrids * nGrids;
05894         <span class="keywordflow">else</span>
05895             *pdwSize = nOutputCh * nGrids * nGrids * nGrids;
05896 
05897         *pdwSize +=                           <span class="comment">// size of RenderTable 8-bits only</span>
05898             nInputCh * nInputTable * i    +   <span class="comment">// size of input table 8/16-bits</span>
05899             nOutputCh * nOutputTable * i  +   <span class="comment">// size of output table 8/16-bits</span>
05900             <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6/structtagHOSTCLUT.html">HOSTCLUT</a>) + 2048;          <span class="comment">// data structure + other PS stuff</span>
05901 
05902         <span class="comment">//</span>
05903         <span class="comment">// Add space for new line.</span>
05904         <span class="comment">//</span>
05905 
05906         *pdwSize += (((*pdwSize) / <a class="code" href="../../d2/d9/ps2_8c.html#a0">MAX_LINELEN</a>) + 1) * <a class="code" href="../../d2/d9/ps2_8c.html#a46">STRLEN</a>(<a class="code" href="../../d6/d2/aug98_2dll32_2getcrd_8c.html#a56">NewLine</a>);
05907 
05908         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05909     }
05910 
05911     pHostClut = (<a class="code" href="../../d2/d9/ps2_8c.html#a66">PHOSTCLUT</a>)pBuffer;
05912     pBuffer += <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6/structtagHOSTCLUT.html">HOSTCLUT</a>);
05913     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o18">wSize</a> = <span class="keyword">sizeof</span>(<a class="code" href="../../d7/d6/structtagHOSTCLUT.html">HOSTCLUT</a>);
05914     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o19">wDataType</a> = <a class="code" href="../../d2/d9/ps2_8c.html#a51">DATATYPE_LUT</a>;
05915     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o21">dwPCS</a> = dwPCS;
05916     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o22">dwIntent</a> = dwIntent;
05917     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o28">nLutBits</a> = (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>) ? 8 : 16;
05918 
05919     <span class="comment">//</span>
05920     <span class="comment">// Get info about Illuminant White Point from the header</span>
05921     <span class="comment">//</span>
05922 
05923     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a191">GetCPWhitePoint</a>(pProfile, pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o23">afxIlluminantWP</a>);
05924 
05925     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o25">nInputCh</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)nInputCh;
05926     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o26">nOutputCh</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)nOutputCh;
05927     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o27">nClutPoints</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)nGrids;
05928     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o30">nInputEntries</a> = (WORD)nInputTable;
05929     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o31">nOutputEntries</a> = (WORD)nOutputTable;
05930 
05931     <span class="comment">//</span>
05932     <span class="comment">// Input Array</span>
05933     <span class="comment">//</span>
05934 
05935     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a237">CreateHostInputOutputArray</a>(pBuffer, pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o14">inputArray</a>,
05936              nInputCh, nInputTable, 0, dwLutSig, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut);
05937 
05938     <span class="keywordflow">if</span> (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)
05939     {
05940         i = nInputTable * nInputCh +
05941             nGrids * nGrids * nGrids * nGrids * nOutputCh;
05942     }
05943     <span class="keywordflow">else</span>
05944     {
05945         i = nInputTable * nInputCh +
05946             nGrids * nGrids * nGrids * nOutputCh;
05947     }
05948 
05949     <span class="comment">//</span>
05950     <span class="comment">// Output Array</span>
05951     <span class="comment">//</span>
05952 
05953     pBuffer += <a class="code" href="../../d2/d9/ps2_8c.html#a237">CreateHostInputOutputArray</a>(pBuffer, pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o15">outputArray</a>,
05954              nOutputCh, nOutputTable, i, dwLutSig, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pLut);
05955 
05956     <span class="comment">//</span>
05957     <span class="comment">// /Table</span>
05958     <span class="comment">//</span>
05959 
05960     pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o16">clut</a> = pBuffer;
05961     nNumbers = nGrids * nGrids * nOutputCh;
05962     SecondGrids = 1;
05963     <span class="keywordflow">if</span> (dwType == <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>)
05964     {
05965         SecondGrids = nGrids;
05966     }
05967 
05968     <span class="keywordflow">for</span> (i=0; i&lt;nGrids; i++)        <span class="comment">// Nh strings should be sent</span>
05969     {
05970         <span class="keywordflow">for</span> (k=0; k&lt;SecondGrids; k++)
05971         {
05972             <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
05973             {
05974                 pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) (((<a class="code" href="../../d2/d9/ps2_8c.html#a62">PLUT8TYPE</a>)pLut)-&gt;data) +
05975                     nInputTable * nInputCh +
05976                     nNumbers * (i * SecondGrids + k);
05977             }
05978             <span class="keywordflow">else</span>
05979             {
05980                 pTable = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>) (((<a class="code" href="../../d2/d9/ps2_8c.html#a64">PLUT16TYPE</a>)pLut)-&gt;data) +
05981                     2 * nInputTable * nInputCh +
05982                     2 * nNumbers * (i * SecondGrids + k);
05983             }
05984 
05985             <span class="keywordflow">if</span> (dwLutSig == <a class="code" href="../../d2/d9/ps2_8c.html#a37">LUT8_TYPE</a>)
05986             {
05987                 CopyMemory(pBuffer, pTable, nNumbers);
05988                 pBuffer += nNumbers;
05989             }
05990             <span class="keywordflow">else</span>
05991             {
05992                 <span class="keywordflow">for</span> (j=0; j&lt;nNumbers; j++)
05993                 {
05994                     *pBuffer++ = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)(FIX_ENDIAN16(*((PWORD)pTable)) / 256);
05995                     pTable += <span class="keyword">sizeof</span>(WORD);
05996                 }
05997             }
05998         }
05999     }
06000 
06001     *pdwSize = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) (pBuffer - pStart);
06002 
06003     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06004 }
06005 
06006 
06007 <span class="comment">/***************************************************************************</span>
06008 <span class="comment">*                            GetHostColorSpaceArray</span>
06009 <span class="comment">*  function:</span>
06010 <span class="comment">*    This is the main function which creates the Host CSA</span>
06011 <span class="comment">*    from the data supplied in the Profile.</span>
06012 <span class="comment">*  parameters:</span>
06013 <span class="comment">*       cp          --  Color Profile handle</span>
06014 <span class="comment">*       InputIntent --  Intent.</span>
06015 <span class="comment">*       lpBuffer    --  Pointer to the memory block. If this point is NULL,</span>
06016 <span class="comment">*                       require buffer size.</span>
06017 <span class="comment">*       lpcbSize    --  Size of the memory block</span>
06018 <span class="comment">*  returns:</span>
06019 <span class="comment">*       BOOL        --  TRUE if the function was successful,</span>
06020 <span class="comment">*                       FALSE otherwise.</span>
06021 <span class="comment">***************************************************************************/</span>
06022 
06023 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l06024"></a><a class="code" href="../../d2/d9/ps2_8c.html#a202">06024</a> <a class="code" href="../../d2/d9/ps2_8c.html#a202">GetHostColorSpaceArray</a>(
06025     PBYTE  pProfile,
06026     DWORD  dwIntent,
06027     PBYTE  pBuffer,
06028     PDWORD pdwSize
06029     )
06030 {
06031     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwDev;
06032     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bRc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
06033 
06034     dwDev = <a class="code" href="../../d2/d9/ps2_8c.html#a41">GetCPDevSpace</a>(pProfile);
06035 
06036     <span class="keywordflow">switch</span> (dwDev)
06037     {
06038     <span class="keywordflow">case</span> SPACE_RGB:
06039         bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a200">GetHostCSA</a>(pProfile, pBuffer, pdwSize,
06040                   dwIntent, <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a0">TYPE_CIEBASEDDEF</a>);
06041         <span class="keywordflow">break</span>;
06042     <span class="keywordflow">case</span> SPACE_CMYK:
06043         bRc = <a class="code" href="../../d2/d9/ps2_8c.html#a200">GetHostCSA</a>(pProfile, pBuffer, pdwSize,
06044                   dwIntent, <a class="code" href="../../d2/d9/aug98_2dll32_2csprof_8h.html#a1">TYPE_CIEBASEDDEFG</a>);
06045         <span class="keywordflow">break</span>;
06046     <span class="keywordflow">default</span>:
06047         <span class="keywordflow">break</span>;
06048     }
06049 
06050     <span class="keywordflow">return</span> bRc;
06051 }
06052 
06053 
06054 <span class="comment">/***************************************************************************</span>
06055 <span class="comment">*                         DoHostConversionCRD</span>
06056 <span class="comment">*  function:</span>
06057 <span class="comment">*    This function converts XYZ/Lab to RGB/CMYK by using HostCRD</span>
06058 <span class="comment">*  parameters:</span>
06059 <span class="comment">*       LPHOSTCLUT lpHostCRD  -- pointer to a HostCRD</span>
06060 <span class="comment">*       LPHOSTCLUT lpHostCSA  -- pointer to a HostCSA</span>
06061 <span class="comment">*       float far *Input      -- Input XYZ/Lab</span>
06062 <span class="comment">*       float far *Output     -- Output RGB/CMYK</span>
06063 <span class="comment">*  returns:</span>
06064 <span class="comment">*       BOOL                  -- TRUE</span>
06065 <span class="comment">***************************************************************************/</span>
06066 
06067 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l06068"></a><a class="code" href="../../d2/d9/ps2_8c.html#a243">06068</a> <a class="code" href="../../d2/d9/ps2_8c.html#a243">DoHostConversionCRD</a>(
06069     PHOSTCLUT   pHostCRD,
06070     PHOSTCLUT   pHostCSA,
06071     <span class="keywordtype">float</span>       *pfInput,
06072     <span class="keywordtype">float</span>       *pfOutput,
06073     BOOL        bCheckOutputTable
06074     )
06075 {
06076     <span class="keywordtype">float</span>      fTemp[<a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a0">MAXCHANNELS</a>];
06077     <span class="keywordtype">float</span>      fTemp1[<a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a0">MAXCHANNELS</a>];
06078     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      i, j;
06079 
06080     <span class="comment">//</span>
06081     <span class="comment">// Input XYZ or Lab in range [0 2]</span>
06082     <span class="comment">//</span>
06083     <span class="comment">// When sampling the deviceCRD, skip the input table.</span>
06084     <span class="comment">// If pHostCSA is not NULL, the current CRD is targetCRD, we</span>
06085     <span class="comment">// need to do input table conversion</span>
06086     <span class="comment">//</span>
06087 
06088     <span class="keywordflow">if</span> (pHostCSA)
06089     {
06090         <span class="comment">//</span>
06091         <span class="comment">// Convert Lab to XYZ  in range [ 0 whitePoint ]</span>
06092         <span class="comment">//</span>
06093 
06094         <span class="keywordflow">if</span> ((pHostCRD-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o21">dwPCS</a> == SPACE_XYZ) &amp;&amp;
06095             (pHostCSA-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o21">dwPCS</a> == SPACE_Lab))
06096         {
06097             <a class="code" href="../../d2/d9/ps2_8c.html#a248">LabToXYZ</a>(pfInput, fTemp1, pHostCRD-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o23">afxIlluminantWP</a>);
06098         }
06099         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pHostCRD-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o21">dwPCS</a> == SPACE_Lab) &amp;&amp;
06100                  (pHostCSA-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o21">dwPCS</a> == SPACE_XYZ))
06101         {
06102             <span class="comment">//</span>
06103             <span class="comment">// Convert XYZ to Lab in range [ 0 1]</span>
06104             <span class="comment">//</span>
06105 
06106             <a class="code" href="../../d2/d9/ps2_8c.html#a249">XYZToLab</a>(pfInput, fTemp, pHostCSA-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o23">afxIlluminantWP</a>);
06107         }
06108         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((pHostCRD-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o21">dwPCS</a> == SPACE_Lab) &amp;&amp;
06109                  (pHostCSA-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o21">dwPCS</a> == SPACE_Lab))
06110         {
06111             <span class="comment">//</span>
06112             <span class="comment">// Convert Lab to range [ 0 1]</span>
06113             <span class="comment">//</span>
06114 
06115             <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
06116                 fTemp[i] = pfInput[i] / 2;
06117         }
06118         <span class="keywordflow">else</span>
06119         {
06120             <span class="comment">//</span>
06121             <span class="comment">// Convert XYZ to XYZ (based on white point) to range [0 1]</span>
06122             <span class="comment">//</span>
06123             <span class="comment">// TODO:</span>
06124             <span class="comment">//   different intents using different conversion.</span>
06125             <span class="comment">//   icRelativeColorimetric: using Bradford transform.</span>
06126             <span class="comment">//   icAbsoluteColorimetric: using scaling.</span>
06127             <span class="comment">//</span>
06128 
06129             <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
06130                 fTemp1[i] = (pfInput[i] * pHostCRD-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o23">afxIlluminantWP</a>[i]) / pHostCSA-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o23">afxIlluminantWP</a>[i];
06131         }
06132 
06133         <span class="comment">//</span>
06134         <span class="comment">// Matrix, used for XYZ data only.</span>
06135         <span class="comment">//</span>
06136 
06137         <span class="keywordflow">if</span> (pHostCRD-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o21">dwPCS</a> == SPACE_XYZ)
06138         {
06139             <a class="code" href="../../d2/d9/ps2_8c.html#a250">ApplyMatrix</a>(pHostCRD-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o11">e</a>, fTemp1, fTemp);
06140         }
06141 
06142         <span class="keywordflow">if</span> (pHostCRD-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o19">wDataType</a> != <a class="code" href="../../d2/d9/ps2_8c.html#a52">DATATYPE_MATRIX</a>)
06143         {
06144             <span class="comment">//</span>
06145             <span class="comment">// Search input Table</span>
06146             <span class="comment">//</span>
06147 
06148             (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a240">CheckInputOutputTable</a>(pHostCRD, fTemp, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
06149         }
06150     }
06151 
06152     <span class="comment">//</span>
06153     <span class="comment">// If the current CRD is device CRD, we do not need to do input</span>
06154     <span class="comment">// table conversion</span>
06155     <span class="comment">//</span>
06156 
06157     <span class="keywordflow">else</span>
06158     {
06159         WORD nGrids;
06160 
06161         nGrids = pHostCRD-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o27">nClutPoints</a>;
06162 
06163         <span class="comment">//</span>
06164         <span class="comment">// Sample data may be XYZ or Lab. It depends on Target icc profile.</span>
06165         <span class="comment">// If the PCS of the target icc profile is XYZ, input data will be XYZ.</span>
06166         <span class="comment">// If the PCS of the target icc profile is Lab, input data will be Lab.</span>
06167         <span class="comment">//</span>
06168 
06169         <span class="keywordflow">if</span> (pHostCRD-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o19">wDataType</a> == <a class="code" href="../../d2/d9/ps2_8c.html#a52">DATATYPE_MATRIX</a>)
06170         {
06171             <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++)
06172             {
06173                 fTemp[i] = pfInput[i];
06174             }
06175         }
06176         <span class="keywordflow">else</span>
06177         {
06178             <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
06179             {
06180                 fTemp[i] = pfInput[i] * (nGrids - 1);
06181                 <span class="keywordflow">if</span> (fTemp[i] &gt; (nGrids - 1))
06182                     fTemp[i] = (<span class="keywordtype">float</span>)(nGrids - 1);
06183             }
06184         }
06185     }
06186 
06187     <span class="keywordflow">if</span> (pHostCRD-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o19">wDataType</a> != <a class="code" href="../../d2/d9/ps2_8c.html#a52">DATATYPE_MATRIX</a>)
06188     {
06189         <span class="comment">//</span>
06190         <span class="comment">// Rendering table</span>
06191         <span class="comment">//</span>
06192 
06193         (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a241">CheckColorLookupTable</a>(pHostCRD, fTemp);
06194     }
06195 
06196     <span class="comment">//</span>
06197     <span class="comment">// Output RGB or CMYK in range [0 1]</span>
06198     <span class="comment">//</span>
06199 
06200     <span class="keywordflow">if</span> (bCheckOutputTable)
06201     {
06202         (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a240">CheckInputOutputTable</a>(pHostCRD, fTemp, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
06203     }
06204 
06205     <span class="keywordflow">for</span> (i=0; (i&lt;=<a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a0">MAXCHANNELS</a>) &amp;&amp; (i&lt;pHostCRD-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o26">nOutputCh</a>); i++)
06206     {
06207         pfOutput[i] = fTemp[i];
06208     }
06209 
06210     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06211 }
06212 
06213 <span class="comment">/***************************************************************************</span>
06214 <span class="comment">*                         DoHostConversionCSA</span>
06215 <span class="comment">*  function:</span>
06216 <span class="comment">*    This function converts RGB/CMYK to XYZ/Lab by using HostCSA</span>
06217 <span class="comment">*  parameters:</span>
06218 <span class="comment">*       LPHOSTCLUT lpHostCLUT -- pointer to a HostCSA</span>
06219 <span class="comment">*       float far *Input      -- Input XYZ/Lab</span>
06220 <span class="comment">*       float far *Output     -- Output RGB/CMYK</span>
06221 <span class="comment">*  returns:</span>
06222 <span class="comment">*       BOOL                  -- TRUE</span>
06223 <span class="comment">***************************************************************************/</span>
06224 
06225 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l06226"></a><a class="code" href="../../d2/d9/ps2_8c.html#a242">06226</a> <a class="code" href="../../d2/d9/ps2_8c.html#a242">DoHostConversionCSA</a>(
06227     PHOSTCLUT     pHostClut,
06228     <span class="keywordtype">float</span>         *pfInput,
06229     <span class="keywordtype">float</span>         *pfOutput
06230     )
06231 {
06232     <span class="keywordtype">float</span>      fTemp[<a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a0">MAXCHANNELS</a>];
06233     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      i;
06234 
06235     <span class="comment">//</span>
06236     <span class="comment">// Input RGB or CMYK in range [0 1]</span>
06237     <span class="comment">//</span>
06238 
06239     <span class="keywordflow">for</span> (i=0; (i&lt;=<a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a0">MAXCHANNELS</a>) &amp;&amp; (i&lt;pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o25">nInputCh</a>); i++)
06240     {
06241         fTemp[i] = pfInput[i];
06242     }
06243 
06244     <span class="comment">//</span>
06245     <span class="comment">// Search input Table</span>
06246     <span class="comment">//</span>
06247 
06248     (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a240">CheckInputOutputTable</a>(pHostClut, fTemp, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
06249 
06250     <span class="keywordflow">if</span> (pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o19">wDataType</a> == <a class="code" href="../../d2/d9/ps2_8c.html#a52">DATATYPE_MATRIX</a>)
06251     {
06252         <a class="code" href="../../d2/d9/ps2_8c.html#a250">ApplyMatrix</a>(pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o11">e</a>, fTemp, pfOutput);
06253     }
06254     <span class="keywordflow">else</span>
06255     {
06256         <span class="comment">//</span>
06257         <span class="comment">// Rendering table</span>
06258         <span class="comment">//</span>
06259 
06260         (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a241">CheckColorLookupTable</a>(pHostClut, fTemp);
06261 
06262         <span class="comment">//</span>
06263         <span class="comment">// Output Table</span>
06264         <span class="comment">//</span>
06265 
06266         (<span class="keywordtype">void</span>)<a class="code" href="../../d2/d9/ps2_8c.html#a240">CheckInputOutputTable</a>(pHostClut, fTemp, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
06267 
06268         <span class="comment">//</span>
06269         <span class="comment">// Output XYZ or Lab in range [0 2]</span>
06270         <span class="comment">//</span>
06271 
06272         <span class="keywordflow">for</span> (i=0; (i&lt;=<a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a0">MAXCHANNELS</a>) &amp;&amp; (i&lt;pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o26">nOutputCh</a>); i++)
06273         {
06274             pfOutput[i] = fTemp[i];
06275         }
06276     }
06277 
06278     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06279 }                               
06280 
06281 
06282 
06283 <span class="comment">/***************************************************************************</span>
06284 <span class="comment">*                         CheckInputOutputTable</span>
06285 <span class="comment">*  function:</span>
06286 <span class="comment">*    This function check inputTable.</span>
06287 <span class="comment">*  parameters:</span>
06288 <span class="comment">*       LPHOSTCLUT lpHostClut --</span>
06289 <span class="comment">*       float far  *fTemp     --  Input / output data</span>
06290 <span class="comment">*  returns:</span>
06291 <span class="comment">*       BOOL                  -- TRUE</span>
06292 <span class="comment">***************************************************************************/</span>
06293 
06294 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l06295"></a><a class="code" href="../../d2/d9/ps2_8c.html#a240">06295</a> <a class="code" href="../../d2/d9/ps2_8c.html#a240">CheckInputOutputTable</a>(
06296     PHOSTCLUT    pHostClut,
06297     <span class="keywordtype">float</span>        *pfTemp,
06298     BOOL         bCSA,
06299     BOOL         bInputTable
06300     )
06301 {
06302     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>      *ppArray;
06303     <span class="keywordtype">float</span>      fIndex;
06304     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      nNumCh;
06305     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      nNumEntries, i;
06306     WORD       nGrids;
06307     WORD       floor1, ceiling1;
06308 
06309     <span class="keywordflow">if</span> (bInputTable)
06310     {
06311         nNumCh = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o25">nInputCh</a>;
06312         nNumEntries = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o30">nInputEntries</a> - 1;
06313         ppArray = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o14">inputArray</a>;
06314     }
06315     <span class="keywordflow">else</span>
06316     {
06317         nNumCh = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o26">nOutputCh</a>;
06318         nNumEntries = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o31">nOutputEntries</a> - 1;
06319         ppArray = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o15">outputArray</a>;
06320     }
06321 
06322     nGrids = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o27">nClutPoints</a>;
06323     <span class="keywordflow">for</span> (i=0; (i&lt;=<a class="code" href="../../d2/d6/aug98_2dll32_2profcrd_8h.html#a0">MAXCHANNELS</a>) &amp;&amp; (i&lt;nNumCh); i++)
06324     {
06325         pfTemp[i] = (pfTemp[i] &lt; 0) ? 0 : ((pfTemp[i] &gt; 1) ? 1 : pfTemp[i]);
06326 
06327         fIndex = pfTemp[i] * nNumEntries;
06328 
06329         <span class="keywordflow">if</span> (pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o28">nLutBits</a> == 8)
06330         {
06331             floor1 = ppArray[i][(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)fIndex];
06332             ceiling1 = ppArray[i][((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)fIndex) + 1];
06333 
06334             pfTemp[i] = (<span class="keywordtype">float</span>)(floor1 + (ceiling1 - floor1) * (fIndex - floor(fIndex)));
06335 
06336             <span class="keywordflow">if</span> (bCSA &amp;&amp; !bInputTable)
06337                 pfTemp[i] = pfTemp[i] / 127.0f;
06338             <span class="keywordflow">else</span>
06339                 pfTemp[i] = pfTemp[i] / 255.0f;
06340         }
06341         <span class="keywordflow">else</span>
06342         {
06343             floor1 = ((PWORD)(ppArray[i]))[(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)fIndex];
06344             ceiling1 = ((PWORD)(ppArray[i]))[((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)fIndex) + 1];
06345 
06346             pfTemp[i] = (<span class="keywordtype">float</span>)(floor1 + (ceiling1 - floor1) * (fIndex - floor(fIndex)));
06347 
06348             <span class="keywordflow">if</span> (bCSA &amp;&amp; !bInputTable)
06349                 pfTemp[i] = pfTemp[i] / 32767.0f;
06350             <span class="keywordflow">else</span>
06351                 pfTemp[i] = pfTemp[i] / 65535.0f;
06352 
06353         }
06354 
06355         <span class="keywordflow">if</span> (bInputTable)
06356         {
06357             pfTemp[i] *= (nGrids - 1);
06358             <span class="keywordflow">if</span> (pfTemp[i] &gt; (nGrids - 1))
06359                 pfTemp[i] =  (<span class="keywordtype">float</span>)(nGrids - 1);
06360         }
06361     }
06362 
06363     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06364 }
06365 
06366 
06367 <span class="comment">/***************************************************************************</span>
06368 <span class="comment">*                               g</span>
06369 <span class="comment">*  function:</span>
06370 <span class="comment">*    Calculate function y = g(x). used in Lab-&gt;XYZ conversion</span>
06371 <span class="comment">*    y = g(x):      g(x) = x*x*x             if x &gt;= 6/29</span>
06372 <span class="comment">*                   g(x) = 108/841*(x-4/29)  otherwise</span>
06373 <span class="comment">*  parameters:</span>
06374 <span class="comment">*       f           --  x</span>
06375 <span class="comment">*  returns:</span>
06376 <span class="comment">*       SINT        --  y</span>
06377 <span class="comment">***************************************************************************/</span>
06378 
<a name="l06379"></a><a class="code" href="../../d2/d9/ps2_8c.html#a244">06379</a> <span class="keywordtype">float</span> <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a>(
06380     <span class="keywordtype">float</span> f
06381     )
06382 {
06383     <span class="keywordtype">float</span> fRc;
06384 
06385     <span class="keywordflow">if</span> (f &gt;= (6.0f/29.0f))
06386     {
06387         fRc = f * f * f;
06388     }
06389     <span class="keywordflow">else</span>
06390     {
06391         fRc = f - (4.0f / 29.0f) * (108.0f / 841.0f);
06392     }
06393 
06394     <span class="keywordflow">return</span> fRc;
06395 }
06396 
06397 <span class="comment">/***************************************************************************</span>
06398 <span class="comment">*                          inverse_g</span>
06399 <span class="comment">*  function:</span>
06400 <span class="comment">*    Calculate inverse function y = g(x). used in XYZ-&gt;Lab conversion</span>
06401 <span class="comment">*  parameters:</span>
06402 <span class="comment">*       f           --  y</span>
06403 <span class="comment">*  returns:</span>
06404 <span class="comment">*       SINT        --  x</span>
06405 <span class="comment">***************************************************************************/</span>
06406 
06407 <span class="keywordtype">float</span>
<a name="l06408"></a><a class="code" href="../../d2/d9/ps2_8c.html#a245">06408</a> <a class="code" href="../../d2/d9/ps2_8c.html#a245">inverse_g</a>(
06409     <span class="keywordtype">float</span> f
06410     )
06411 {
06412     <span class="keywordtype">double</span> fRc;
06413 
06414     <span class="keywordflow">if</span> (f &gt;= (6.0f*6.0f*6.0f)/(29.0f*29.0f*29.0f))
06415     {
06416         fRc = pow(f, 1.0 / 3.0);
06417     }
06418     <span class="keywordflow">else</span>
06419     {
06420         fRc = f * (841.0f / 108.0f) + (4.0f / 29.0f);
06421     }
06422 
06423     <span class="keywordflow">return</span> (<span class="keywordtype">float</span>)fRc;
06424 }
06425 
06426 
06427 <span class="keywordtype">void</span>
<a name="l06428"></a><a class="code" href="../../d2/d9/ps2_8c.html#a248">06428</a> <a class="code" href="../../d2/d9/ps2_8c.html#a248">LabToXYZ</a>(
06429     <span class="keywordtype">float</span>      *pfInput,
06430     <span class="keywordtype">float</span>      *pfOutput,
06431     PFIX_16_16 pafxWP
06432     )
06433 {
06434     <span class="keywordtype">float</span>   fL, fa, fb;
06435 
06436     fL = (pfInput[0] * 50 + 16) / 116;
06437     fa = (pfInput[1] * 128 - 128) / 500;
06438     fb = (pfInput[2] * 128 - 128) / 200;
06439 
06440     pfOutput[0] = pafxWP[0] * <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a>(fL + fa) / <a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a>;
06441     pfOutput[1] = pafxWP[1] * <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a>(fL) / <a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a>;
06442     pfOutput[2] = pafxWP[2] * <a class="code" href="../../d2/d9/ps2_8c.html#a244">g</a>(fL - fb) / <a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a>;
06443 
06444     <span class="keywordflow">return</span>;
06445 }
06446 
06447 
06448 <span class="keywordtype">void</span>
<a name="l06449"></a><a class="code" href="../../d2/d9/ps2_8c.html#a249">06449</a> <a class="code" href="../../d2/d9/ps2_8c.html#a249">XYZToLab</a>(
06450     <span class="keywordtype">float</span>      *pfInput,
06451     <span class="keywordtype">float</span>      *pfOutput,
06452     PFIX_16_16 pafxWP
06453     )
06454 {
06455     <span class="keywordtype">float</span>  fL, fa, fb;
06456 
06457     fL = <a class="code" href="../../d2/d9/ps2_8c.html#a245">inverse_g</a>(pfInput[0] * <a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a> / pafxWP[0]);
06458     fa = <a class="code" href="../../d2/d9/ps2_8c.html#a245">inverse_g</a>(pfInput[1] * <a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a> / pafxWP[1]);
06459     fb = <a class="code" href="../../d2/d9/ps2_8c.html#a245">inverse_g</a>(pfInput[2] * <a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a> / pafxWP[2]);
06460 
06461     pfOutput[0] = (fa * 116 - 16) / 100;
06462     pfOutput[1] = (fL * 500 - fa * 500 + 128) / 255;
06463     pfOutput[2] = (fa * 200 - fb * 200 + 128) / 255;
06464 
06465     <span class="keywordflow">return</span>;
06466 }
06467 
06468 
06469 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l06470"></a><a class="code" href="../../d2/d9/ps2_8c.html#a246">06470</a> <a class="code" href="../../d2/d9/ps2_8c.html#a246">TableInterp3</a>(
06471     PHOSTCLUT  pHostClut,
06472     <span class="keywordtype">float</span>      *pfTemp
06473     )
06474 {
06475 
06476     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>        v000, v001, v010, v011;
06477     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>        v100, v101, v110, v111;
06478     <span class="keywordtype">float</span>        fA, fB, fC;
06479     <span class="keywordtype">float</span>        fVx0x, fVx1x;
06480     <span class="keywordtype">float</span>        fV0xx, fV1xx;
06481     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        tmpA, tmpBC;
06482     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        cellA, cellB, cellC;
06483     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        idx;
06484     WORD         nGrids;
06485     WORD         nOutputCh;
06486 
06487     cellA = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)pfTemp[0];
06488     fA = pfTemp[0] - cellA;
06489 
06490     cellB = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)pfTemp[1];
06491     fB = pfTemp[1] - cellB;
06492 
06493     cellC = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)pfTemp[2];
06494     fC = pfTemp[2] - cellC;
06495 
06496     nGrids = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o27">nClutPoints</a>;
06497     nOutputCh = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o26">nOutputCh</a>;
06498     tmpA  = nOutputCh * nGrids * nGrids;
06499     tmpBC = nOutputCh * (nGrids * cellB + cellC);
06500 
06501     <span class="comment">//</span>
06502     <span class="comment">// Calculate 8 surrounding cells.</span>
06503     <span class="comment">//</span>
06504 
06505     v000 = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o16">clut</a> + tmpA * cellA + tmpBC;
06506     v001 = (cellC &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1)) ? v000 + nOutputCh : v000;
06507     v010 = (cellB &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1)) ? v000 + nOutputCh * nGrids : v000;
06508     v011 = (cellC &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1)) ? v010 + nOutputCh : v010 ;
06509 
06510     v100 = (cellA &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1)) ? v000 + tmpA : v000;
06511     v101 = (cellC &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1)) ? v100 + nOutputCh : v100;
06512     v110 = (cellB &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1)) ? v100 + nOutputCh * nGrids : v100;
06513     v111 = (cellC &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1)) ? v110 + nOutputCh : v110;
06514 
06515     <span class="keywordflow">for</span> (idx=0; idx&lt;nOutputCh; idx++)
06516     {
06517         <span class="comment">//</span>
06518         <span class="comment">// Calculate the average of 4 bottom cells.</span>
06519         <span class="comment">//</span>
06520 
06521         fVx0x = *v000 + fC * (<span class="keywordtype">int</span>)((<span class="keywordtype">int</span>)*v001 - (<span class="keywordtype">int</span>)*v000);
06522         fVx1x = *v010 + fC * (<span class="keywordtype">int</span>)((<span class="keywordtype">int</span>)*v011 - (<span class="keywordtype">int</span>)*v010);
06523         fV0xx = fVx0x + fB * (fVx1x - fVx0x);
06524 
06525         <span class="comment">//</span>
06526         <span class="comment">// Calculate the average of 4 upper cells.</span>
06527         <span class="comment">//</span>
06528 
06529         fVx0x = *v100 + fC * (<span class="keywordtype">int</span>)((<span class="keywordtype">int</span>)*v101 - (<span class="keywordtype">int</span>)*v100);
06530         fVx1x = *v110 + fC * (<span class="keywordtype">int</span>)((<span class="keywordtype">int</span>)*v111 - (<span class="keywordtype">int</span>)*v110);
06531         fV1xx = fVx0x + fB * (fVx1x - fVx0x);
06532 
06533         <span class="comment">//</span>
06534         <span class="comment">// Calculate the bottom and upper average.</span>
06535         <span class="comment">//</span>
06536 
06537         pfTemp[idx] = (fV0xx + fA * (fV1xx - fV0xx)) / <a class="code" href="../../d8/d5/aug98_2dll32_2profcrd_8c.html#a1">MAXCOLOR8</a>;
06538 
06539         <span class="keywordflow">if</span> ( idx &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nOutputCh - 1))
06540         {
06541             v000++;
06542             v001++;
06543             v010++;
06544             v011++;
06545             v100++;
06546             v101++;
06547             v110++;
06548             v111++;
06549         }
06550     }
06551 
06552     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06553 }
06554 
06555 
06556 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l06557"></a><a class="code" href="../../d2/d9/ps2_8c.html#a247">06557</a> <a class="code" href="../../d2/d9/ps2_8c.html#a247">TableInterp4</a>(
06558     PHOSTCLUT  pHostClut,
06559     <span class="keywordtype">float</span>      *pfTemp
06560     )
06561 {
06562     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>     v0000, v0001, v0010, v0011;
06563     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>     v0100, v0101, v0110, v0111;
06564     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>     v1000, v1001, v1010, v1011;
06565     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>     v1100, v1101, v1110, v1111;
06566     <span class="keywordtype">float</span>     fH, fI, fJ, fK;
06567     <span class="keywordtype">float</span>     fVxx0x, fVxx1x;
06568     <span class="keywordtype">float</span>     fVx0xx, fVx1xx;
06569     <span class="keywordtype">float</span>     fV0xxx, fV1xxx;
06570     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     tmpH, tmpI, tmpJK;
06571     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     cellH, cellI, cellJ, cellK;
06572     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>     idx;
06573     WORD      nGrids;
06574     WORD      nOutputCh;
06575 
06576     cellH = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)pfTemp[0];
06577     fH = pfTemp[0] - cellH;
06578 
06579     cellI = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)pfTemp[1];
06580     fI = pfTemp[1] - cellI;
06581 
06582     cellJ = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)pfTemp[2];
06583     fJ = pfTemp[2] - cellJ;
06584 
06585     cellK = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)pfTemp[3];
06586     fK = pfTemp[3] - cellK;
06587 
06588     nGrids = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o27">nClutPoints</a>;
06589     nOutputCh = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o26">nOutputCh</a>;
06590     tmpI  = nOutputCh * nGrids * nGrids;
06591     tmpH  = tmpI * nGrids;
06592     tmpJK = nOutputCh * (nGrids * cellJ + cellK);
06593 
06594     <span class="comment">//</span>
06595     <span class="comment">// Calculate 16 surrounding cells.</span>
06596     <span class="comment">//</span>
06597 
06598     v0000 = pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o16">clut</a> + tmpH * cellH + tmpI * cellI + tmpJK;
06599     v0001 = (cellK &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v0000 + nOutputCh : v0000;
06600     v0010 = (cellJ &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v0000 + nOutputCh * nGrids : v0000;
06601     v0011 = (cellK &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v0010 + nOutputCh : v0010;
06602 
06603     v0100 = (cellI &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v0000 + tmpI : v0000;
06604     v0101 = (cellK &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v0100 + nOutputCh : v0100;
06605     v0110 = (cellJ &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v0100 + nOutputCh * nGrids : v0100;
06606     v0111 = (cellK &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v0110 + nOutputCh : v0110;
06607 
06608     v1000 = (cellH &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v0000 + tmpH : v0000;
06609     v1001 = (cellK &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v1000 + nOutputCh : v1000;
06610     v1010 = (cellJ &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v1000 + nOutputCh * nGrids : v1000;
06611     v1011 = (cellK &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v1010 + nOutputCh : v1010;
06612 
06613     v1100 = (cellI &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v1000 + tmpI : v1000;
06614     v1101 = (cellK &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v1100 + nOutputCh : v1100;
06615     v1110 = (cellJ &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v1100 + nOutputCh * nGrids : v1100;
06616     v1111 = (cellK &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nGrids - 1))? v1110 + nOutputCh : v1110;
06617 
06618 
06619     <span class="keywordflow">for</span> (idx=0; idx&lt;nOutputCh; idx++)
06620     {
06621         <span class="comment">//</span>
06622         <span class="comment">// Calculate the average of 8 bottom cells.</span>
06623         <span class="comment">//</span>
06624 
06625         fVxx0x = *v0000 + fK * (<span class="keywordtype">int</span>)((<span class="keywordtype">int</span>)*v0001 - (<span class="keywordtype">int</span>)*v0000);
06626         fVxx1x = *v0010 + fK * (<span class="keywordtype">int</span>)((<span class="keywordtype">int</span>)*v0011 - (<span class="keywordtype">int</span>)*v0010);
06627         fVx0xx = fVxx0x + fJ * (fVxx1x - fVxx0x);
06628         fVxx0x = *v0100 + fK * (<span class="keywordtype">int</span>)((<span class="keywordtype">int</span>)*v0101 - (<span class="keywordtype">int</span>)*v0100);
06629         fVxx1x = *v0110 + fK * (<span class="keywordtype">int</span>)((<span class="keywordtype">int</span>)*v0111 - (<span class="keywordtype">int</span>)*v0110);
06630         fVx1xx = fVxx0x + fJ * (fVxx1x - fVxx0x);
06631         fV0xxx = fVx0xx + fI * (fVx1xx - fVx0xx);
06632 
06633         <span class="comment">//</span>
06634         <span class="comment">// Calculate the average of 8 upper cells.</span>
06635         <span class="comment">//</span>
06636 
06637         fVxx0x = *v1000 + fK * (<span class="keywordtype">int</span>)((<span class="keywordtype">int</span>)*v1001 - (<span class="keywordtype">int</span>)*v1000);
06638         fVxx1x = *v1010 + fK * (<span class="keywordtype">int</span>)((<span class="keywordtype">int</span>)*v1011 - (<span class="keywordtype">int</span>)*v1010);
06639         fVx0xx = fVxx0x + fJ * (fVxx1x - fVxx0x);
06640         fVxx0x = *v1100 + fK * (<span class="keywordtype">int</span>)((<span class="keywordtype">int</span>)*v1101 - (<span class="keywordtype">int</span>)*v1100);
06641         fVxx1x = *v1110 + fK * (<span class="keywordtype">int</span>)((<span class="keywordtype">int</span>)*v1111 - (<span class="keywordtype">int</span>)*v1110);
06642         fVx1xx = fVxx0x + fJ * (fVxx1x - fVxx0x);
06643         fV1xxx = fVx0xx + fI * (fVx1xx - fVx0xx);
06644 
06645         <span class="comment">//</span>
06646         <span class="comment">// Calculate the bottom and upper average.</span>
06647         <span class="comment">//</span>
06648 
06649         pfTemp[idx] = (fV0xxx + fH * (fV1xxx - fV0xxx)) / <a class="code" href="../../d8/d5/aug98_2dll32_2profcrd_8c.html#a1">MAXCOLOR8</a>;
06650 
06651         <span class="keywordflow">if</span> (idx &lt; (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(nOutputCh - 1))
06652         {
06653             v0000++;
06654             v0001++;
06655             v0010++;
06656             v0011++;
06657             v0100++;
06658             v0101++;
06659             v0110++;
06660             v0111++;
06661             v1000++;
06662             v1001++;
06663             v1010++;
06664             v1011++;
06665             v1100++;
06666             v1101++;
06667             v1110++;
06668             v1111++;
06669         }
06670     }
06671 
06672     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06673 }
06674 
06675 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l06676"></a><a class="code" href="../../d2/d9/ps2_8c.html#a252">06676</a> <a class="code" href="../../d2/d9/ps2_8c.html#a252">InvertColorantArray</a>(
06677     <span class="keywordtype">double</span> *lpInMatrix,
06678     <span class="keywordtype">double</span> *lpOutMatrix)
06679 {
06680     <span class="keywordtype">double</span> det;
06681 
06682     <span class="keywordtype">double</span> *a;
06683     <span class="keywordtype">double</span> *b;
06684     <span class="keywordtype">double</span> *<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
06685 
06686     a = &amp;(lpInMatrix[0]);
06687     b = &amp;(lpInMatrix[3]);
06688     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = &amp;(lpInMatrix[6]);
06689 
06690     det = a[0] * b[1] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[2] + a[1] * b[2] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[0] + a[2] * b[0] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[1] -
06691          (a[2] * b[1] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[0] + a[1] * b[0] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[2] + a[0] * b[2] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[1]);
06692 
06693     <span class="keywordflow">if</span> (det == 0.0)    <span class="comment">// What to do?</span>
06694     {
06695         lpOutMatrix[0] = 1.0;
06696         lpOutMatrix[1] = 0.0;
06697         lpOutMatrix[2] = 0.0;
06698 
06699         lpOutMatrix[3] = 0.0;
06700         lpOutMatrix[4] = 1.0;
06701         lpOutMatrix[5] = 0.0;
06702 
06703         lpOutMatrix[6] = 0.0;
06704         lpOutMatrix[7] = 0.0;
06705         lpOutMatrix[8] = 1.0;
06706     }
06707     <span class="keywordflow">else</span>
06708     {
06709         lpOutMatrix[0] = (b[1] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[2] - b[2] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[1]) / det;
06710         lpOutMatrix[3] = -(b[0] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[2] - b[2] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[0]) / det;
06711         lpOutMatrix[6] = (b[0] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[1] - b[1] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[0]) / det;
06712 
06713         lpOutMatrix[1] = -(a[1] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[2] - a[2] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[1]) / det;
06714         lpOutMatrix[4] = (a[0] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[2] - a[2] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[0]) / det;
06715         lpOutMatrix[7] = -(a[0] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[1] - a[1] * <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>[0]) / det;
06716 
06717         lpOutMatrix[2] = (a[1] * b[2] - a[2] * b[1]) / det;
06718         lpOutMatrix[5] = -(a[0] * b[2] - a[2] * b[0]) / det;
06719         lpOutMatrix[8] = (a[0] * b[1] - a[1] * b[0]) / det;
06720     }
06721 
06722     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
06723 }
06724 
06725 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l06726"></a><a class="code" href="../../d2/d9/ps2_8c.html#a250">06726</a> <a class="code" href="../../d2/d9/ps2_8c.html#a250">ApplyMatrix</a>(
06727     FIX_16_16 *e,
06728     <span class="keywordtype">float</span> *Input,
06729     <span class="keywordtype">float</span> *Output)
06730 {
06731     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i, j;
06732 
06733     <span class="keywordflow">for</span> (i=0; i&lt;3; i++)
06734     {
06735         j = i * 3;
06736 
06737         Output[i] = ((e[j]     * Input[0]) / <a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a>) +
06738                     ((e[j + 1] * Input[1]) / <a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a>) +
06739                     ((e[j + 2] * Input[2]) / <a class="code" href="../../d2/d9/ps2_8c.html#a5">FIX_16_16_SCALE</a>);
06740     }
06741 }
06742 
06743 
06744 <span class="comment">/***************************************************************************</span>
06745 <span class="comment">*                         CheckColorLookupTable</span>
06746 <span class="comment">*  function:</span>
06747 <span class="comment">*    This function check RenderTable.</span>
06748 <span class="comment">*  parameters:</span>
06749 <span class="comment">*       LPHOSTCLUT lpHostClut --</span>
06750 <span class="comment">*       float far  *fTemp     --  Input (in range [0 gred-1]) /</span>
06751 <span class="comment">*                                 output(in range [0 1)</span>
06752 <span class="comment">*  returns:</span>
06753 <span class="comment">*       BOOL                  -- TRUE</span>
06754 <span class="comment">***************************************************************************/</span>
06755 
06756 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l06757"></a><a class="code" href="../../d2/d9/ps2_8c.html#a241">06757</a> <a class="code" href="../../d2/d9/ps2_8c.html#a241">CheckColorLookupTable</a>(
06758     PHOSTCLUT   pHostClut,
06759     <span class="keywordtype">float</span>       *pfTemp
06760     )
06761 {
06762     <span class="keywordflow">if</span> (pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o25">nInputCh</a> == 3)
06763     {
06764         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/ps2_8c.html#a246">TableInterp3</a>(pHostClut, pfTemp);
06765     }
06766     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pHostClut-&gt;<a class="code" href="../../d7/d6/structtagHOSTCLUT.html#o25">nInputCh</a> == 4)
06767     {
06768         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/ps2_8c.html#a247">TableInterp4</a>(pHostClut, pfTemp);
06769     }
06770     <span class="keywordflow">else</span>
06771         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
06772 }
06773 
06774 <span class="comment">//</span>
06775 <span class="comment">// For testing purposes</span>
06776 <span class="comment">//</span>
06777 
06778 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI
<a name="l06779"></a><a class="code" href="../../d2/d9/ps2_8c.html#a259">06779</a> <a class="code" href="../../d2/d9/ps2_8c.html#a259">GetPS2PreviewCRD</a> (
06780     HPROFILE  hDestProfile,
06781     HPROFILE  hTargetProfile,
06782     DWORD     dwIntent,
06783     PBYTE     pBuffer,
06784     PDWORD    pcbSize,
06785     LPBOOL    pbBinary
06786     )
06787 {
06788     PPROFOBJ pDestProfObj;
06789     PPROFOBJ pTargetProfObj;
06790 
06791     pDestProfObj = (PPROFOBJ)HDLTOPTR(hDestProfile);
06792     pTargetProfObj = (PPROFOBJ)HDLTOPTR(hTargetProfile);
06793 
06794 
06795     <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/ps2_8c.html#a257">InternalGetPS2PreviewCRD</a>(pDestProfObj-&gt;pView, pTargetProfObj-&gt;pView, dwIntent, pBuffer, pcbSize, pbBinary);
06796 }
06797 
06798 <span class="preprocessor">#endif // !defined(KERNEL_MODE) || defined(USERMODE_DRIVER)</span>
06799 <span class="preprocessor"></span>
06800 <span class="comment">/*</span>
06801 <span class="comment"> *  Crc - 32 BIT ANSI X3.66 CRC checksum files</span>
06802 <span class="comment"> *</span>
06803 <span class="comment"> *</span>
06804 <span class="comment"> * Copyright (C) 1986 Gary S. Brown.  You may use this program, or</span>
06805 <span class="comment"> * code or tables extracted from it, as desired without restriction.</span>
06806 <span class="comment"> */</span>
06807 
<a name="l06808"></a><a class="code" href="../../d2/d9/ps2_8c.html#a180">06808</a> <span class="keyword">static</span> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>  <a class="code" href="../../d2/d9/ps2_8c.html#a180">crc_32_tab</a>[] = { <span class="comment">/* CRC polynomial 0xedb88320 */</span>
06809 0x00000000, 0x77073096, 0xee0e612c, 0x990951ba, 0x076dc419, 0x706af48f, 0xe963a535, 0x9e6495a3,
06810 0x0edb8832, 0x79dcb8a4, 0xe0d5e91e, 0x97d2d988, 0x09b64c2b, 0x7eb17cbd, 0xe7b82d07, 0x90bf1d91,
06811 0x1db71064, 0x6ab020f2, 0xf3b97148, 0x84be41de, 0x1adad47d, 0x6ddde4eb, 0xf4d4b551, 0x83d385c7,
06812 0x136c9856, 0x646ba8c0, 0xfd62f97a, 0x8a65c9ec, 0x14015c4f, 0x63066cd9, 0xfa0f3d63, 0x8d080df5,
06813 0x3b6e20c8, 0x4c69105e, 0xd56041e4, 0xa2677172, 0x3c03e4d1, 0x4b04d447, 0xd20d85fd, 0xa50ab56b,
06814 0x35b5a8fa, 0x42b2986c, 0xdbbbc9d6, 0xacbcf940, 0x32d86ce3, 0x45df5c75, 0xdcd60dcf, 0xabd13d59,
06815 0x26d930ac, 0x51de003a, 0xc8d75180, 0xbfd06116, 0x21b4f4b5, 0x56b3c423, 0xcfba9599, 0xb8bda50f,
06816 0x2802b89e, 0x5f058808, 0xc60cd9b2, 0xb10be924, 0x2f6f7c87, 0x58684c11, 0xc1611dab, 0xb6662d3d,
06817 0x76dc4190, 0x01db7106, 0x98d220bc, 0xefd5102a, 0x71b18589, 0x06b6b51f, 0x9fbfe4a5, 0xe8b8d433,
06818 0x7807c9a2, 0x0f00f934, 0x9609a88e, 0xe10e9818, 0x7f6a0dbb, 0x086d3d2d, 0x91646c97, 0xe6635c01,
06819 0x6b6b51f4, 0x1c6c6162, 0x856530d8, 0xf262004e, 0x6c0695ed, 0x1b01a57b, 0x8208f4c1, 0xf50fc457,
06820 0x65b0d9c6, 0x12b7e950, 0x8bbeb8ea, 0xfcb9887c, 0x62dd1ddf, 0x15da2d49, 0x8cd37cf3, 0xfbd44c65,
06821 0x4db26158, 0x3ab551ce, 0xa3bc0074, 0xd4bb30e2, 0x4adfa541, 0x3dd895d7, 0xa4d1c46d, 0xd3d6f4fb,
06822 0x4369e96a, 0x346ed9fc, 0xad678846, 0xda60b8d0, 0x44042d73, 0x33031de5, 0xaa0a4c5f, 0xdd0d7cc9,
06823 0x5005713c, 0x270241aa, 0xbe0b1010, 0xc90c2086, 0x5768b525, 0x206f85b3, 0xb966d409, 0xce61e49f,
06824 0x5edef90e, 0x29d9c998, 0xb0d09822, 0xc7d7a8b4, 0x59b33d17, 0x2eb40d81, 0xb7bd5c3b, 0xc0ba6cad,
06825 0xedb88320, 0x9abfb3b6, 0x03b6e20c, 0x74b1d29a, 0xead54739, 0x9dd277af, 0x04db2615, 0x73dc1683,
06826 0xe3630b12, 0x94643b84, 0x0d6d6a3e, 0x7a6a5aa8, 0xe40ecf0b, 0x9309ff9d, 0x0a00ae27, 0x7d079eb1,
06827 0xf00f9344, 0x8708a3d2, 0x1e01f268, 0x6906c2fe, 0xf762575d, 0x806567cb, 0x196c3671, 0x6e6b06e7,
06828 0xfed41b76, 0x89d32be0, 0x10da7a5a, 0x67dd4acc, 0xf9b9df6f, 0x8ebeeff9, 0x17b7be43, 0x60b08ed5,
06829 0xd6d6a3e8, 0xa1d1937e, 0x38d8c2c4, 0x4fdff252, 0xd1bb67f1, 0xa6bc5767, 0x3fb506dd, 0x48b2364b,
06830 0xd80d2bda, 0xaf0a1b4c, 0x36034af6, 0x41047a60, 0xdf60efc3, 0xa867df55, 0x316e8eef, 0x4669be79,
06831 0xcb61b38c, 0xbc66831a, 0x256fd2a0, 0x5268e236, 0xcc0c7795, 0xbb0b4703, 0x220216b9, 0x5505262f,
06832 0xc5ba3bbe, 0xb2bd0b28, 0x2bb45a92, 0x5cb36a04, 0xc2d7ffa7, 0xb5d0cf31, 0x2cd99e8b, 0x5bdeae1d,
06833 0x9b64c2b0, 0xec63f226, 0x756aa39c, 0x026d930a, 0x9c0906a9, 0xeb0e363f, 0x72076785, 0x05005713,
06834 0x95bf4a82, 0xe2b87a14, 0x7bb12bae, 0x0cb61b38, 0x92d28e9b, 0xe5d5be0d, 0x7cdcefb7, 0x0bdbdf21,
06835 0x86d3d2d4, 0xf1d4e242, 0x68ddb3f8, 0x1fda836e, 0x81be16cd, 0xf6b9265b, 0x6fb077e1, 0x18b74777,
06836 0x88085ae6, 0xff0f6a70, 0x66063bca, 0x11010b5c, 0x8f659eff, 0xf862ae69, 0x616bffd3, 0x166ccf45,
06837 0xa00ae278, 0xd70dd2ee, 0x4e048354, 0x3903b3c2, 0xa7672661, 0xd06016f7, 0x4969474d, 0x3e6e77db,
06838 0xaed16a4a, 0xd9d65adc, 0x40df0b66, 0x37d83bf0, 0xa9bcae53, 0xdebb9ec5, 0x47b2cf7f, 0x30b5ffe9,
06839 0xbdbdf21c, 0xcabac28a, 0x53b39330, 0x24b4a3a6, 0xbad03605, 0xcdd70693, 0x54de5729, 0x23d967bf,
06840 0xb3667a2e, 0xc4614ab8, 0x5d681b02, 0x2a6f2b94, 0xb40bbe37, 0xc30c8ea1, 0x5a05df1b, 0x2d02ef8d
06841 };
06842 
<a name="l06843"></a><a class="code" href="../../d2/d9/ps2_8c.html#a253">06843</a> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d9/ps2_8c.html#a253">crc32</a>(PBYTE buff, DWORD length)
06844 {
06845     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> crc, charcnt;
06846     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>  <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
06847 
06848     crc = 0xFFFFFFFF;
06849     charcnt = 0;
06850 
06851     <span class="keywordflow">for</span> (charcnt = 0 ; charcnt &lt; length ; charcnt++)
06852     {
06853         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = buff[charcnt];
06854         crc = <a class="code" href="../../d2/d9/ps2_8c.html#a180">crc_32_tab</a>[(crc ^ <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>) &amp; 0xff] ^ (crc &gt;&gt; 8);
06855     }
06856 
06857     <span class="keywordflow">return</span> crc;
06858 }
06859 
06860 <span class="comment">/***************************************************************************</span>
06861 <span class="comment">*                           IsSRGBColorProfile</span>
06862 <span class="comment">*</span>
06863 <span class="comment">*  function: check if the profile is sRGB</span>
06864 <span class="comment">*</span>
06865 <span class="comment">*  parameters:</span>
06866 <span class="comment">*       cp          --  Color Profile handle</span>
06867 <span class="comment">*</span>
06868 <span class="comment">*  returns:</span>
06869 <span class="comment">*       BOOL        --  TRUE if the profile is sRGB</span>
06870 <span class="comment">*                       FALSE otherwise.</span>
06871 <span class="comment">***************************************************************************/</span>
06872 
<a name="l06873"></a><a class="code" href="../../d2/d9/ps2_8c.html#a181">06873</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d9/ps2_8c.html#a181">IsSRGBColorProfile</a>(
06874     PBYTE pProfile
06875     )
06876 {
06877     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  bMatch = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
06878     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRedTRCIndex, dwGreenTRCIndex, dwBlueTRCIndex;
06879     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRedCIndex, dwGreenCIndex, dwBlueCIndex;
06880     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwSize;
06881     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRedTRCSize=0, dwGreenTRCSize=0, dwBlueTRCSize=0;
06882     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRedCSize=0, dwGreenCSize=0, dwBlueCSize=0;
06883     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pRed, pGreen, pBlue, pRedC, pGreenC, pBlueC;
06884     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>  DataBuffer[<a class="code" href="../../d2/d9/ps2_8c.html#a3">ALIGN_DWORD</a>(<a class="code" href="../../d2/d9/ps2_8c.html#a54">sRGB_TAGSIZE</a>)];
06885 
06886     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a17">TAG_REDTRC</a>, &amp;dwRedTRCIndex)             &amp;&amp;
06887         <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(pProfile, dwRedTRCIndex, &amp;dwRedTRCSize)     &amp;&amp;
06888 
06889         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a18">TAG_GREENTRC</a>, &amp;dwGreenTRCIndex)         &amp;&amp;
06890         <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(pProfile, dwGreenTRCIndex, &amp;dwGreenTRCSize) &amp;&amp;
06891 
06892         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a19">TAG_BLUETRC</a>, &amp;dwBlueTRCIndex)           &amp;&amp;
06893         <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(pProfile, dwBlueTRCIndex, &amp;dwBlueTRCSize)   &amp;&amp;
06894 
06895         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a14">TAG_REDCOLORANT</a>, &amp;dwRedCIndex)          &amp;&amp;
06896         <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(pProfile, dwRedCIndex, &amp;dwRedCSize)         &amp;&amp;
06897 
06898         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a15">TAG_GREENCOLORANT</a>, &amp;dwGreenCIndex)      &amp;&amp;
06899         <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(pProfile, dwGreenCIndex, &amp;dwGreenCSize)     &amp;&amp;
06900 
06901         <a class="code" href="../../d2/d9/ps2_8c.html#a189">DoesCPTagExist</a>(pProfile, <a class="code" href="../../d2/d9/ps2_8c.html#a16">TAG_BLUECOLORANT</a>, &amp;dwBlueCIndex)        &amp;&amp;
06902         <a class="code" href="../../d2/d9/ps2_8c.html#a193">GetCPElementDataSize</a>(pProfile, dwBlueCIndex, &amp;dwBlueCSize))
06903     {
06904         dwSize = dwRedTRCSize + dwGreenTRCSize + dwBlueTRCSize +
06905                  dwRedCSize   + dwGreenCSize   + dwBlueCSize;
06906 
06907         <span class="keywordflow">if</span> (dwSize == <a class="code" href="../../d2/d9/ps2_8c.html#a54">sRGB_TAGSIZE</a>)
06908         {
06909             ZeroMemory(DataBuffer,<span class="keyword">sizeof</span>(DataBuffer));
06910 
06911             pRed    = DataBuffer;
06912             pGreen  = pRed    + dwRedTRCSize;
06913             pBlue   = pGreen  + dwGreenTRCSize;
06914             pRedC   = pBlue   + dwBlueTRCSize;
06915             pGreenC = pRedC   + dwRedCSize;
06916             pBlueC  = pGreenC + dwGreenCSize;
06917 
06918             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(pProfile, dwRedTRCIndex, pRed, &amp;dwRedTRCSize)       &amp;&amp;
06919                 <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(pProfile, dwGreenTRCIndex, pGreen, &amp;dwGreenTRCSize) &amp;&amp;
06920                 <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(pProfile, dwBlueTRCIndex, pBlue, &amp;dwBlueTRCSize)    &amp;&amp;
06921                 <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(pProfile, dwRedCIndex, pRedC, &amp;dwRedCSize)          &amp;&amp;
06922                 <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(pProfile, dwGreenCIndex, pGreenC, &amp;dwGreenCSize)    &amp;&amp;
06923                 <a class="code" href="../../d2/d9/ps2_8c.html#a196">GetCPElementData</a>(pProfile, dwBlueCIndex, pBlueC, &amp;dwBlueCSize))
06924             {
06925                 bMatch = (<a class="code" href="../../d2/d9/ps2_8c.html#a253">crc32</a>(DataBuffer, <a class="code" href="../../d2/d9/ps2_8c.html#a54">sRGB_TAGSIZE</a>) == <a class="code" href="../../d2/d9/ps2_8c.html#a53">sRGB_CRC</a>);
06926             }
06927         }
06928     }
06929 
06930     <span class="keywordflow">return</span> (bMatch);
06931 }
06932 
06933 
06934 
06935 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:31 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
