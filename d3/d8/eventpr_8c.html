<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: eventpr.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>eventpr.c File Reference</h1><code>#include "<a class="el" href="../../d5/d9/exp_8h-source.html">exp.h</a>"</code><br>

<p>
<a href="../../d4/d7/eventpr_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a4">ExpEventPairInitialization</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a5">NtCreateEventPair</a> (OUT PHANDLE EventPairHandle, IN ACCESS_MASK DesiredAccess, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a> OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a6">NtOpenEventPair</a> (OUT PHANDLE EventPairHandle, IN ACCESS_MASK DesiredAccess, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a7">NtWaitLowEventPair</a> (IN HANDLE EventPairHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a8">NtWaitHighEventPair</a> (IN HANDLE EventPairHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a9">NtSetLowWaitHighEventPair</a> (IN HANDLE EventPairHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a10">NtSetHighWaitLowEventPair</a> (IN HANDLE EventPairHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a11">NtSetLowEventPair</a> (IN HANDLE EventPairHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a12">NtSetHighEventPair</a> (IN HANDLE EventPairHandle)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a0">EvPrSetHigh</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a1">EvPrSetLow</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a2">ExEventPairObjectType</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>GENERIC_MAPPING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d8/eventpr_8c.html#a3">ExpEventPairMapping</a></td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a4" doxytag="eventpr.c::ExpEventPairInitialization" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN ExpEventPairInitialization           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00070">70</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
References <a class="el" href="../../d5/d8/ex_8h.html#a94">EEVENT_PAIR</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00040">ExEventPairObjectType</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00047">ExpEventPairMapping</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d1/obtype_8c-source.html#l00069">ObCreateObjectType()</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00033">Offset</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00075                    :
00076 
00077     This function creates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> event pair object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> descriptor at system
00078     initialization and stores <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> descriptor
00079     in global storage.
00080 
00081 Arguments:
00082 
00083     None.
00084 
00085 Return Value:
00086 
00087     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> event pair object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00088     successfully initialized. Otherwise a value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00089 
00090 --*/
00091 
00092 {
00093 
00094     <a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html">OBJECT_TYPE_INITIALIZER</a> ObjectTypeInitializer;
00095     ULONG <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = 0;
00096     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00097     UNICODE_STRING TypeName;
00098 
00099     <span class="comment">//</span>
00100     <span class="comment">// Initialize string descriptor.</span>
00101     <span class="comment">//</span>
00102 
00103     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;TypeName, L<span class="stringliteral">"EventPair"</span>);
00104 
00105     <span class="comment">//</span>
00106     <span class="comment">// Create event object type descriptor.</span>
00107     <span class="comment">//</span>
00108 
00109     RtlZeroMemory(&amp;ObjectTypeInitializer, <span class="keyword">sizeof</span>(ObjectTypeInitializer));
00110     ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o0">Length</a> = <span class="keyword">sizeof</span>(ObjectTypeInitializer);
00111     ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o3">InvalidAttributes</a> = OBJ_OPENLINK;
00112     ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o4">GenericMapping</a> = <a class="code" href="../../d3/d8/eventpr_8c.html#a3">ExpEventPairMapping</a>;
00113     ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o9">PoolType</a> = <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>;
00114     ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o11">DefaultNonPagedPoolCharge</a> = <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">EEVENT_PAIR</a>);
00115     ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o5">ValidAccessMask</a> = EVENT_PAIR_ALL_ACCESS;
00116     ObjectTypeInitializer.<a class="code" href="../../d5/d6/struct__OBJECT__TYPE__INITIALIZER.html#o1">UseDefaultObject</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00117     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d2/obtype_8c.html#a2">ObCreateObjectType</a>(&amp;TypeName,
00118                                 &amp;ObjectTypeInitializer,
00119                                 (PSECURITY_DESCRIPTOR)NULL,
00120                                 &amp;ExEventPairObjectType);
00121 
00122     <span class="comment">//</span>
00123     <span class="comment">// If the event pair object type descriptor was successfully created, then</span>
00124     <span class="comment">// return a value of TRUE. Otherwise return a value of FALSE.</span>
00125     <span class="comment">//</span>
00126 
00127     <span class="keywordflow">return</span> (BOOLEAN)(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00128 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="eventpr.c::NtCreateEventPair" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtCreateEventPair           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>EventPairHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00131">131</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
References <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00040">ExEventPairObjectType</a>, <a class="el" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter()</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00096">KeInitializeEventPair()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00055">ObCreateObject()</a>, <a class="el" href="../../d2/d0/obinsert_8c-source.html#l00029">ObInsertObject()</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d5/d8/ex_8h.html#a95">PEEVENT_PAIR</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01564">ProbeForWriteHandle</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/dll_2query_8c-source.html#l00316">RtlCreateQueryDebugBuffer()</a>.
<p>
<pre class="fragment"><div>00139                    :
00140 
00141     This function creates an event pair object, sets <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> initial state,
00142     and opens a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified desired access.
00143 
00144 Arguments:
00145 
00146     EventPairHandle - Supplies a pointer to a variable that will receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00147         event pair object handle.
00148 
00149     DesiredAccess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired types of access <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> event
00150         pair object.
00151 
00152     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a> - Supplies a pointer to an object attributes
00153         structure.
00154 
00155 Return Value:
00156 
00157     TBS
00158 
00159 --*/
00160 
00161 {
00162 
00163     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00164     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00165     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00166     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00167 
00168     <span class="comment">//</span>
00169     <span class="comment">// Establish an exception handler, probe the output handle address, and</span>
00170     <span class="comment">// attempt to create an event object. If the probe fails, then return the</span>
00171     <span class="comment">// exception code as the service status. Otherwise return the status value</span>
00172     <span class="comment">// returned by the object insertion routine.</span>
00173     <span class="comment">//</span>
00174 
00175     <span class="keywordflow">try</span> {
00176 
00177         <span class="comment">//</span>
00178         <span class="comment">// Get previous processor mode and probe output handle address if</span>
00179         <span class="comment">// necessary.</span>
00180         <span class="comment">//</span>
00181 
00182         PreviousMode = KeGetPreviousMode();
00183         <span class="keywordflow">if</span> (PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00184             <a class="code" href="../../d5/d8/ex_8h.html#a35">ProbeForWriteHandle</a>(EventPairHandle);
00185         }
00186 
00187         <span class="comment">//</span>
00188         <span class="comment">// Allocate event object.</span>
00189         <span class="comment">//</span>
00190 
00191         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d0/obcreate_8c.html#a5">ObCreateObject</a>(PreviousMode,
00192                                 ExEventPairObjectType,
00193                                 ObjectAttributes,
00194                                 PreviousMode,
00195                                 NULL,
00196                                 <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">EEVENT_PAIR</a>),
00197                                 0,
00198                                 0,
00199                                 (PVOID *)&amp;EventPair);
00200 
00201         <span class="comment">//</span>
00202         <span class="comment">// If the event pair object was successfully allocated, then</span>
00203         <span class="comment">// initialize the event pair object and attempt to insert the</span>
00204         <span class="comment">// event pair object in the current process' handle table.</span>
00205         <span class="comment">//</span>
00206 
00207         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00208             <a class="code" href="../../d2/d8/eventobj_8c.html#a3">KeInitializeEventPair</a>(&amp;EventPair-&gt;<a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html#o0">KernelEventPair</a>);
00209             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d1/obinsert_8c.html#a0">ObInsertObject</a>((PVOID)EventPair,
00210                                     NULL,
00211                                     DesiredAccess,
00212                                     0,
00213                                     (PVOID *)NULL,
00214                                     &amp;Handle);
00215 
00216             <span class="comment">//</span>
00217             <span class="comment">// If the event pair object was successfully inserted in the</span>
00218             <span class="comment">// current process' handle table, then attempt to write the</span>
00219             <span class="comment">// event pair object handle value.  If the write attempt</span>
00220             <span class="comment">// fails, then do not report an error.  When the caller</span>
00221             <span class="comment">// attempts to access the handle value, an access violation</span>
00222             <span class="comment">// will occur.</span>
00223 
00224             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00225                 <span class="keywordflow">try</span> {
00226                     *EventPairHandle = <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00227 
00228                 } except(<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00229                 }
00230             }
00231         }
00232 
00233         <span class="comment">//</span>
00234         <span class="comment">// If an exception occurs during the probe of the output handle address,</span>
00235         <span class="comment">// then always handle the exception and return the exception code as the</span>
00236         <span class="comment">// status value.</span>
00237         <span class="comment">//</span>
00238 
00239     } except (<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00240         <span class="keywordflow">return</span> GetExceptionCode();
00241     }
00242 
00243     <span class="comment">//</span>
00244     <span class="comment">// Return service status.</span>
00245     <span class="comment">//</span>
00246 
00247     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00248 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="eventpr.c::NtOpenEventPair" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtOpenEventPair           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>EventPairHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectAttributes</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00251">251</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
References <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00040">ExEventPairObjectType</a>, <a class="el" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter()</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00095">ObOpenObjectByName()</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01564">ProbeForWriteHandle</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00259                    :
00260 
00261     This function opens a handle to an event pair object with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00262     desired access.
00263 
00264 Arguments:
00265 
00266     EventPairHandle - Supplies a pointer to a variable that will receive
00267         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> event pair object handle.
00268 
00269     DesiredAccess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> desired types of access <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> event
00270         pair object.
00271 
00272     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a> - Supplies a pointer to an object attributes structure.
00273 
00274 Return Value:
00275 
00276     TBS
00277 
00278 --*/
00279 
00280 {
00281 
00282     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00283     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00284     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00285 
00286     <span class="comment">//</span>
00287     <span class="comment">// Establish an exception handler, probe the output handle address, and</span>
00288     <span class="comment">// attempt to open the event object. If the probe fails, then return the</span>
00289     <span class="comment">// exception code as the service status. Otherwise return the status value</span>
00290     <span class="comment">// returned by the object open routine.</span>
00291     <span class="comment">//</span>
00292 
00293     <span class="keywordflow">try</span> {
00294 
00295         <span class="comment">//</span>
00296         <span class="comment">// Get previous processor mode and probe output handle address</span>
00297         <span class="comment">// if necessary.</span>
00298         <span class="comment">//</span>
00299 
00300         PreviousMode = KeGetPreviousMode();
00301         <span class="keywordflow">if</span> (PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00302             <a class="code" href="../../d5/d8/ex_8h.html#a35">ProbeForWriteHandle</a>(EventPairHandle);
00303         }
00304 
00305         <span class="comment">//</span>
00306         <span class="comment">// Open handle to the event pair object with the specified</span>
00307         <span class="comment">// desired access.</span>
00308         <span class="comment">//</span>
00309 
00310         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a2">ObOpenObjectByName</a>(ObjectAttributes,
00311                                     ExEventPairObjectType,
00312                                     PreviousMode,
00313                                     NULL,
00314                                     DesiredAccess,
00315                                     NULL,
00316                                     &amp;Handle);
00317 
00318 
00319         <span class="comment">//</span>
00320         <span class="comment">// If the open was successful, then attempt to write the event</span>
00321         <span class="comment">// pair object handle value.  If the write attempt fails, then do</span>
00322         <span class="comment">// not report an error.  When the caller attempts to access the</span>
00323         <span class="comment">// handle value, an access violation will occur.</span>
00324         <span class="comment">//</span>
00325 
00326         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00327             <span class="keywordflow">try</span> {
00328                 *EventPairHandle = <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00329 
00330             } except(<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00331             }
00332         }
00333 
00334         <span class="comment">//</span>
00335         <span class="comment">// If an exception occurs during the probe of the output event handle,</span>
00336         <span class="comment">// then always handle the exception and return the exception code as the</span>
00337         <span class="comment">// status value.</span>
00338         <span class="comment">//</span>
00339 
00340     } except (<a class="code" href="../../d5/d8/ex_8h.html#a307">ExSystemExceptionFilter</a>()) {
00341         <span class="keywordflow">return</span> GetExceptionCode();
00342     }
00343 
00344     <span class="comment">//</span>
00345     <span class="comment">// Return service status.</span>
00346     <span class="comment">//</span>
00347 
00348     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00349 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="eventpr.c::NtSetHighEventPair" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtSetHighEventPair           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>EventPairHandle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00651">651</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
References <a class="el" href="../../d8/d7/exboosts_8h-source.html#l00041">EVENT_PAIR_INCREMENT</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00033">EvPrSetHigh</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00040">ExEventPairObjectType</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01124">KeSetHighEventPair</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00657                    :
00658 
00659     This function sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a> event of an event pair object.
00660 
00661 Arguments:
00662 
00663     EventPairHandle - Supplies a handle to an event pair object.
00664 
00665 Return Value:
00666 
00667     TBS
00668 
00669 --*/
00670 
00671 {
00672 
00673     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00674     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00675     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00676 
00677     <span class="comment">//</span>
00678     <span class="comment">// Reference event pair object by handle.</span>
00679     <span class="comment">//</span>
00680 
00681     PreviousMode = KeGetPreviousMode();
00682     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(EventPairHandle,
00683                                        SYNCHRONIZE,
00684                                        ExEventPairObjectType,
00685                                        PreviousMode,
00686                                        (PVOID *)&amp;EventPair,
00687                                        NULL);
00688 
00689     <span class="comment">//</span>
00690     <span class="comment">// If the reference was successful, then wait on the Low event</span>
00691     <span class="comment">// of the event pair.</span>
00692     <span class="comment">//</span>
00693 
00694     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00695         <a class="code" href="../../d3/d8/eventpr_8c.html#a0">EvPrSetHigh</a>++;
00696         <a class="code" href="../../d4/d9/ke_8h.html#a22">KeSetHighEventPair</a>(&amp;EventPair-&gt;<a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html#o0">KernelEventPair</a>,
00697                            EVENT_PAIR_INCREMENT,FALSE);
00698 
00699         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(EventPair);
00700     }
00701 
00702     <span class="comment">//</span>
00703     <span class="comment">// Return service status.</span>
00704     <span class="comment">//</span>
00705 
00706     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00707 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="eventpr.c::NtSetHighWaitLowEventPair" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtSetHighWaitLowEventPair           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>EventPairHandle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00532">532</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
References <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00033">EvPrSetHigh</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00040">ExEventPairObjectType</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01720">KeSetHighWaitLowEventPair</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/dll_2query_8c-source.html#l00032">RtlpQueryProcessDebugInformationRemote()</a>.
<p>
<pre class="fragment"><div>00538                    :
00539 
00540     This function sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a> event of an event pair and then
00541     waits on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a> event of an event pair object.
00542 
00543 Arguments:
00544 
00545     EventPairHandle - Supplies a handle to an event pair object.
00546 
00547 Return Value:
00548 
00549     TBS
00550 
00551 --*/
00552 
00553 {
00554 
00555     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00556     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00557     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00558 
00559     <span class="comment">//</span>
00560     <span class="comment">// Reference event pair object by handle.</span>
00561     <span class="comment">//</span>
00562 
00563     PreviousMode = KeGetPreviousMode();
00564     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(EventPairHandle,
00565                                        SYNCHRONIZE,
00566                                        ExEventPairObjectType,
00567                                        PreviousMode,
00568                                        (PVOID *)&amp;EventPair,
00569                                        NULL);
00570 
00571     <span class="comment">//</span>
00572     <span class="comment">// If the reference was successful, then wait on the Low event</span>
00573     <span class="comment">// of the event pair.</span>
00574     <span class="comment">//</span>
00575 
00576     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00577         <a class="code" href="../../d3/d8/eventpr_8c.html#a0">EvPrSetHigh</a>++;
00578         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d9/ke_8h.html#a30">KeSetHighWaitLowEventPair</a>(&amp;EventPair-&gt;<a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html#o0">KernelEventPair</a>,
00579                                            PreviousMode);
00580 
00581         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(EventPair);
00582     }
00583 
00584     <span class="comment">//</span>
00585     <span class="comment">// Return service status.</span>
00586     <span class="comment">//</span>
00587 
00588     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00589 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="eventpr.c::NtSetLowEventPair" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtSetLowEventPair           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>EventPairHandle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00592">592</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
References <a class="el" href="../../d8/d7/exboosts_8h-source.html#l00041">EVENT_PAIR_INCREMENT</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00034">EvPrSetLow</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00040">ExEventPairObjectType</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01129">KeSetLowEventPair</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/dll_2query_8c-source.html#l00399">RtlDestroyQueryDebugBuffer()</a>.
<p>
<pre class="fragment"><div>00598                    :
00599 
00600     This function sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a> event of an event pair object.
00601 
00602 Arguments:
00603 
00604     EventPairHandle - Supplies a handle to an event pair object.
00605 
00606 Return Value:
00607 
00608     TBS
00609 
00610 --*/
00611 
00612 {
00613 
00614     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00615     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00616     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00617 
00618     <span class="comment">//</span>
00619     <span class="comment">// Reference event pair object by handle.</span>
00620     <span class="comment">//</span>
00621 
00622     PreviousMode = KeGetPreviousMode();
00623     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(EventPairHandle,
00624                                        SYNCHRONIZE,
00625                                        ExEventPairObjectType,
00626                                        PreviousMode,
00627                                        (PVOID *)&amp;EventPair,
00628                                        NULL);
00629 
00630     <span class="comment">//</span>
00631     <span class="comment">// If the reference was successful, then wait on the Low event</span>
00632     <span class="comment">// of the event pair.</span>
00633     <span class="comment">//</span>
00634 
00635     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00636         <a class="code" href="../../d3/d8/eventpr_8c.html#a1">EvPrSetLow</a>++;
00637         <a class="code" href="../../d4/d9/ke_8h.html#a23">KeSetLowEventPair</a>(&amp;EventPair-&gt;<a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html#o0">KernelEventPair</a>,
00638                           EVENT_PAIR_INCREMENT,FALSE);
00639 
00640         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(EventPair);
00641     }
00642 
00643     <span class="comment">//</span>
00644     <span class="comment">// Return service status.</span>
00645     <span class="comment">//</span>
00646 
00647     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00648 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="eventpr.c::NtSetLowWaitHighEventPair" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtSetLowWaitHighEventPair           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>EventPairHandle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00472">472</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
References <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00034">EvPrSetLow</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00040">ExEventPairObjectType</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01725">KeSetLowWaitHighEventPair</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/dll_2query_8c-source.html#l00469">RtlQueryProcessDebugInformation()</a>.
<p>
<pre class="fragment"><div>00478                    :
00479 
00480     This function sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a> event of an event pair and then
00481     waits on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a> event of an event pair object.
00482 
00483 Arguments:
00484 
00485     EventPairHandle - Supplies a handle to an event pair object.
00486 
00487 Return Value:
00488 
00489     TBS
00490 
00491 --*/
00492 
00493 {
00494 
00495     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00496     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00497     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00498 
00499     <span class="comment">//</span>
00500     <span class="comment">// Reference event pair object by handle.</span>
00501     <span class="comment">//</span>
00502 
00503     PreviousMode = KeGetPreviousMode();
00504     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(EventPairHandle,
00505                                        SYNCHRONIZE,
00506                                        ExEventPairObjectType,
00507                                        PreviousMode,
00508                                        (PVOID *)&amp;EventPair,
00509                                        NULL);
00510 
00511     <span class="comment">//</span>
00512     <span class="comment">// If the reference was successful, then wait on the Low event</span>
00513     <span class="comment">// of the event pair.</span>
00514     <span class="comment">//</span>
00515 
00516     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00517         <a class="code" href="../../d3/d8/eventpr_8c.html#a1">EvPrSetLow</a>++;
00518         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d9/ke_8h.html#a31">KeSetLowWaitHighEventPair</a>(&amp;EventPair-&gt;<a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html#o0">KernelEventPair</a>,
00519                                            PreviousMode);
00520 
00521         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(EventPair);
00522     }
00523 
00524     <span class="comment">//</span>
00525     <span class="comment">// Return service status.</span>
00526     <span class="comment">//</span>
00527 
00528     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00529 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="eventpr.c::NtWaitHighEventPair" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtWaitHighEventPair           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>EventPairHandle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00412">412</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
References <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00040">ExEventPairObjectType</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01730">KeWaitForHighEventPair</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00418                    :
00419 
00420     This function waits on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a> event of an event pair object.
00421 
00422 Arguments:
00423 
00424     EventPairHandle - Supplies a handle to an event pair object.
00425 
00426 Return Value:
00427 
00428     TBS
00429 
00430 --*/
00431 
00432 {
00433 
00434     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00435     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00436     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00437 
00438     <span class="comment">//</span>
00439     <span class="comment">// Reference event pair object by handle.</span>
00440     <span class="comment">//</span>
00441 
00442     PreviousMode = KeGetPreviousMode();
00443     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(EventPairHandle,
00444                                        SYNCHRONIZE,
00445                                        ExEventPairObjectType,
00446                                        PreviousMode,
00447                                        (PVOID *)&amp;EventPair,
00448                                        NULL);
00449 
00450     <span class="comment">//</span>
00451     <span class="comment">// If the reference was successful, then wait on the Low event</span>
00452     <span class="comment">// of the event pair.</span>
00453     <span class="comment">//</span>
00454 
00455     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00456         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d9/ke_8h.html#a32">KeWaitForHighEventPair</a>(&amp;EventPair-&gt;<a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html#o0">KernelEventPair</a>,
00457                                         PreviousMode,
00458                                         FALSE,
00459                                         NULL);
00460 
00461         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(EventPair);
00462     }
00463 
00464     <span class="comment">//</span>
00465     <span class="comment">// Return service status.</span>
00466     <span class="comment">//</span>
00467 
00468     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00469 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="eventpr.c::NtWaitLowEventPair" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtWaitLowEventPair           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>EventPairHandle</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00352">352</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
References <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00040">ExEventPairObjectType</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01737">KeWaitForLowEventPair</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d2/dll_2query_8c-source.html#l00032">RtlpQueryProcessDebugInformationRemote()</a>.
<p>
<pre class="fragment"><div>00358                    :
00359 
00360     This function waits on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a> event of an event pair object.
00361 
00362 Arguments:
00363 
00364     EventPairHandle - Supplies a handle to an event pair object.
00365 
00366 Return Value:
00367 
00368     TBS
00369 
00370 --*/
00371 
00372 {
00373 
00374     <a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html">PEEVENT_PAIR</a> EventPair;
00375     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> PreviousMode;
00376     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00377 
00378     <span class="comment">//</span>
00379     <span class="comment">// Reference event pair object by handle.</span>
00380     <span class="comment">//</span>
00381 
00382     PreviousMode = KeGetPreviousMode();
00383     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(EventPairHandle,
00384                                        SYNCHRONIZE,
00385                                        ExEventPairObjectType,
00386                                        PreviousMode,
00387                                        (PVOID *)&amp;EventPair,
00388                                        NULL);
00389 
00390     <span class="comment">//</span>
00391     <span class="comment">// If the reference was successful, then wait on the Low event</span>
00392     <span class="comment">// of the event pair.</span>
00393     <span class="comment">//</span>
00394 
00395     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00396         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d9/ke_8h.html#a33">KeWaitForLowEventPair</a>(&amp;EventPair-&gt;<a class="code" href="../../d0/d2/struct__EEVENT__PAIR.html#o0">KernelEventPair</a>,
00397                                        PreviousMode,
00398                                        FALSE,
00399                                        NULL);
00400 
00401         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(EventPair);
00402     }
00403 
00404     <span class="comment">//</span>
00405     <span class="comment">// Return service status.</span>
00406     <span class="comment">//</span>
00407 
00408     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00409 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a0" doxytag="eventpr.c::EvPrSetHigh" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d8/ex_8h.html#a148">EvPrSetHigh</a> = 0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00033">33</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00651">NtSetHighEventPair()</a>, and <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00532">NtSetHighWaitLowEventPair()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="eventpr.c::EvPrSetLow" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d8/ex_8h.html#a149">EvPrSetLow</a> = 0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00034">34</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00592">NtSetLowEventPair()</a>, and <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00472">NtSetLowWaitHighEventPair()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="eventpr.c::ExEventPairObjectType" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> <a class="el" href="../../d9/d8/ntos_8h.html#a1">ExEventPairObjectType</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00040">40</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00070">ExpEventPairInitialization()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00131">NtCreateEventPair()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00251">NtOpenEventPair()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00651">NtSetHighEventPair()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00532">NtSetHighWaitLowEventPair()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00592">NtSetLowEventPair()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00472">NtSetLowWaitHighEventPair()</a>, <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00412">NtWaitHighEventPair()</a>, and <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00352">NtWaitLowEventPair()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="eventpr.c::ExpEventPairMapping" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> GENERIC_MAPPING <a class="el" href="../../d3/d8/eventpr_8c.html#a3">ExpEventPairMapping</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Initial value:</b><pre class="fragment"><div> {
    STANDARD_RIGHTS_READ |
        SYNCHRONIZE,
    STANDARD_RIGHTS_WRITE |
        SYNCHRONIZE,
    STANDARD_RIGHTS_EXECUTE |
        SYNCHRONIZE,
    EVENT_PAIR_ALL_ACCESS
}
</div></pre>
<p>
Definition at line <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00047">47</a> of file <a class="el" href="../../d4/d7/eventpr_8c-source.html">eventpr.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d7/eventpr_8c-source.html#l00070">ExpEventPairInitialization()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:33 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
