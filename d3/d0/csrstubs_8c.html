<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: csrstubs.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>csrstubs.c File Reference</h1><code>#include "<a class="el" href="../../d8/d2/w32_2ntuser_2client_2precomp_8h-source.html">precomp.h</a>"</code><br>
<code>#include "<a class="el" href="../../d3/d9/csrmsg_8h-source.html">csrmsg.h</a>"</code><br>
<code>#include "dbt.h"</code><br>
<code>#include "<a class="el" href="../../d1/d9/csrhlpr_8h-source.html">csrhlpr.h</a>"</code><br>

<p>
<a href="../../d4/d9/csrstubs_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d9/struct__EXITWINDOWSDATA.html">_EXITWINDOWSDATA</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a0">SET_LAST_ERROR_RETURNED</a>()&nbsp;&nbsp;&nbsp;if (a-&gt;dwLastError) RIPERR0(a-&gt;dwLastError, RIP_VERBOSE, "")</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d9/struct__EXITWINDOWSDATA.html">_EXITWINDOWSDATA</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a1">EXITWINDOWSDATA</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d9/struct__EXITWINDOWSDATA.html">_EXITWINDOWSDATA</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a2">PEXITWINDOWSDATA</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a4">CallUserpExitWindowsEx</a> (IN UINT uFlags, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwReserved, OUT PBOOL pfSuccess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a5">ExitWindowsThread</a> (PVOID pvParam)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a6">ExitWindowsWorker</a> (UINT uFlags, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwReserved, BOOL fSecondThread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a7">ExitWindowsEx</a> (UINT uFlags, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwReserved)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a8">EndTask</a> (HWND hwnd, BOOL fShutdown, BOOL fForce)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a9">Logon</a> (BOOL fLogon)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a10">CallUserpRegisterLogonProcess</a> (IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwProcessId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a11">RegisterLogonProcess</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwProcessId, BOOL fSecure)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a12">RegisterServicesProcess</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwProcessId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HDESK WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a13">GetThreadDesktop</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwThreadId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG WINAPI&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a14">DeviceEventWorker</a> (IN HWND <a class="el" href="../../d5/d8/jul98_2test_2main_8c.html#a29">hWnd</a>, IN WPARAM wParam, IN LPARAM lParam, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>, OUT PDWORD pdwResult)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/csrstubs_8c.html#a3">gfLogonProcess</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="csrstubs.c::SET_LAST_ERROR_RETURNED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SET_LAST_ERROR_RETURNED          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;if (a-&gt;dwLastError) RIPERR0(a-&gt;dwLastError, RIP_VERBOSE, "")</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00036">36</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00042">CallUserpExitWindowsEx()</a>, <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00181">EndTask()</a>, and <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00275">RegisterServicesProcess()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a1" doxytag="csrstubs.c::EXITWINDOWSDATA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d9/struct__EXITWINDOWSDATA.html">_EXITWINDOWSDATA</a>  <a class="el" href="../../d0/d9/struct__EXITWINDOWSDATA.html">EXITWINDOWSDATA</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="csrstubs.c::PEXITWINDOWSDATA" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d9/struct__EXITWINDOWSDATA.html">_EXITWINDOWSDATA</a> * <a class="el" href="../../d0/d9/struct__EXITWINDOWSDATA.html">PEXITWINDOWSDATA</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00156">ExitWindowsThread()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a4" doxytag="csrstubs.c::CallUserpExitWindowsEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS APIENTRY CallUserpExitWindowsEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwReserved</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>pfSuccess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00042">42</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
References <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00033">_EXITWINDOWSEXMSG::dwReserved</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00036">SET_LAST_ERROR_RETURNED</a>, <a class="el" href="../../d3/d4/struct__USER__API__MSG.html#o15">_USER_API_MSG::u</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00032">_EXITWINDOWSEXMSG::uFlags</a>, and <a class="el" href="../../d2/d0/csrmsg_8h.html#a35a24">UserpExitWindowsEx</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00084">ExitWindowsWorker()</a>.
<p>
<pre class="fragment"><div>00046 {
00047 
00048     <a class="code" href="../../d3/d4/struct__USER__API__MSG.html">USER_API_MSG</a> m;
00049     <a class="code" href="../../d1/d9/struct__EXITWINDOWSEXMSG.html">PEXITWINDOWSEXMSG</a> a = &amp;m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o15">u</a>.ExitWindowsEx;
00050 
00051     a-&gt;<a class="code" href="../../d1/d9/struct__EXITWINDOWSEXMSG.html#o1">uFlags</a> = uFlags;
00052     a-&gt;<a class="code" href="../../d1/d9/struct__EXITWINDOWSEXMSG.html#o2">dwReserved</a> = dwReserved;
00053     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00054                          NULL,
00055                          CSR_MAKE_API_NUMBER( USERSRV_SERVERDLL_INDEX,
00056                                               UserpExitWindowsEx
00057                                             ),
00058                          <span class="keyword">sizeof</span>( *a )
00059                        );
00060 
00061     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue ) || m.ReturnValue == STATUS_CANT_WAIT) {
00062         <a class="code" href="../../d3/d0/csrstubs_8c.html#a0">SET_LAST_ERROR_RETURNED</a>();
00063         *pfSuccess = a-&gt;<a class="code" href="../../d1/d9/struct__EXITWINDOWSEXMSG.html#o3">fSuccess</a>;
00064     } <span class="keywordflow">else</span> {
00065         RIPNTERR0(m.ReturnValue, RIP_VERBOSE, <span class="stringliteral">""</span>);
00066         *pfSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00067     }
00068 
00069     <span class="keywordflow">return</span> m.ReturnValue;
00070 
00071 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="csrstubs.c::CallUserpRegisterLogonProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS APIENTRY CallUserpRegisterLogonProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dwProcessId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00228">228</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
References <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d3/d4/struct__USER__API__MSG.html#o15">_USER_API_MSG::u</a>, and <a class="el" href="../../d2/d0/csrmsg_8h.html#a35a31">UserpRegisterLogonProcess</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00252">RegisterLogonProcess()</a>.
<p>
<pre class="fragment"><div>00230 {
00231 
00232     <a class="code" href="../../d3/d4/struct__USER__API__MSG.html">USER_API_MSG</a> m;
00233     <a class="code" href="../../d4/d3/struct__LOGONMSG.html">PLOGONMSG</a> a = &amp;m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o15">u</a>.Logon;
00234     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00235 
00236     m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o15">u</a>.IdLogon = dwProcessId;
00237     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00238                                   NULL,
00239                                   CSR_MAKE_API_NUMBER( USERSRV_SERVERDLL_INDEX,
00240                                                        UserpRegisterLogonProcess),
00241                                   <span class="keyword">sizeof</span>(*a));
00242 
00243     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00244 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="csrstubs.c::DeviceEventWorker" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG WINAPI DeviceEventWorker           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hWnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>wParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pdwResult</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00338">338</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
References <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00088">CsrAllocateCaptureBuffer()</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00122">CsrCaptureMessageBuffer()</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00098">CsrFreeCaptureBuffer()</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00084">_DEVICEEVENTMSG::dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00085">_DEVICEEVENTMSG::dwResult</a>, <a class="el" href="../../d4/d7/aug98_2test_2main_8c-source.html#l00110">hWnd</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00081">_DEVICEEVENTMSG::hWnd</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00083">_DEVICEEVENTMSG::lParam</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00092">_USER_API_MSG::ReturnValue</a>, <a class="el" href="../../d3/d4/struct__USER__API__MSG.html#o15">_USER_API_MSG::u</a>, <a class="el" href="../../d2/d0/csrmsg_8h.html#a35a30">UserpDeviceEvent</a>, and <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00082">_DEVICEEVENTMSG::wParam</a>.
<p>
<pre class="fragment"><div>00345 {
00346     <a class="code" href="../../d3/d4/struct__USER__API__MSG.html">USER_API_MSG</a> m;
00347     <a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html">PDEVICEEVENTMSG</a> a = &amp;m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o15">u</a>.DeviceEvent;
00348     PCSR_CAPTURE_HEADER CaptureBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00349     <span class="keywordtype">int</span> cb = 0;
00350 
00351     a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o0">hWnd</a>     = <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>;
00352     a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o1">wParam</a>   = wParam;
00353     a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o2">lParam</a>   = lParam;
00354     a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o3">dwFlags</a>  = <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
00355     a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o4">dwResult</a> = 0;
00356 
00357     <span class="comment">//</span>
00358     <span class="comment">// If lParam is specified, it must be marshalled (see the defines</span>
00359     <span class="comment">// for this structure in dbt.h - the structure always starts with</span>
00360     <span class="comment">// DEV_BROADCAST_HDR structure).</span>
00361     <span class="comment">//</span>
00362 
00363     <span class="keywordflow">if</span> (lParam) {
00364 
00365         cb = ((PDEV_BROADCAST_HDR)lParam)-&gt;dbch_size;
00366 
00367         CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>(1, cb);
00368         <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00369             <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00370         }
00371 
00372         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>(CaptureBuffer,
00373                                 (PCHAR)lParam,
00374                                 cb,
00375                                 (PVOID *)&amp;a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o2">lParam</a>);
00376 
00377         <span class="comment">//</span>
00378         <span class="comment">// This ends up calling SrvDeviceEvent routine in the server.</span>
00379         <span class="comment">//</span>
00380 
00381         <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>((PCSR_API_MSG)&amp;m,
00382                             CaptureBuffer,
00383                             CSR_MAKE_API_NUMBER(USERSRV_SERVERDLL_INDEX,
00384                                                 UserpDeviceEvent),
00385                             <span class="keyword">sizeof</span>(*a));
00386 
00387         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>(CaptureBuffer);
00388 
00389     } <span class="keywordflow">else</span> {
00390 
00391         <span class="comment">//</span>
00392         <span class="comment">// This ends up calling SrvDeviceEvent routine in the server.</span>
00393         <span class="comment">//</span>
00394 
00395         <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>((PCSR_API_MSG)&amp;m,
00396                             NULL,
00397                             CSR_MAKE_API_NUMBER(USERSRV_SERVERDLL_INDEX,
00398                                                 UserpDeviceEvent),
00399                             <span class="keyword">sizeof</span>(*a));
00400     }
00401 
00402 
00403     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(m.ReturnValue)) {
00404         *pdwResult = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)a-&gt;<a class="code" href="../../d2/d5/struct__DEVICEEVENTMSG.html#o4">dwResult</a>;
00405     } <span class="keywordflow">else</span> {
00406         RIPMSG0(RIP_WARNING, <span class="stringliteral">"DeviceEventWorker failed."</span>);
00407     }
00408 
00409     <span class="keywordflow">return</span> m.ReturnValue;
00410 
00411 } <span class="comment">// DeviceEventWorker</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="csrstubs.c::EndTask" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI EndTask           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fShutdown</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fForce</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00181">181</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00041">_ENDTASKMSG::fForce</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00040">_ENDTASKMSG::fShutdown</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00039">_ENDTASKMSG::hwnd</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00036">SET_LAST_ERROR_RETURNED</a>, <a class="el" href="../../d3/d4/struct__USER__API__MSG.html#o15">_USER_API_MSG::u</a>, and <a class="el" href="../../d2/d0/csrmsg_8h.html#a35a25">UserpEndTask</a>.
<p>
<pre class="fragment"><div>00185 {
00186     <a class="code" href="../../d3/d4/struct__USER__API__MSG.html">USER_API_MSG</a> m;
00187     <a class="code" href="../../d5/d3/struct__ENDTASKMSG.html">PENDTASKMSG</a> a = &amp;m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o15">u</a>.EndTask;
00188 
00189     a-&gt;<a class="code" href="../../d5/d3/struct__ENDTASKMSG.html#o1">hwnd</a> = hwnd;
00190     a-&gt;<a class="code" href="../../d5/d3/struct__ENDTASKMSG.html#o2">fShutdown</a> = fShutdown;
00191     a-&gt;<a class="code" href="../../d5/d3/struct__ENDTASKMSG.html#o3">fForce</a> = fForce;
00192     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00193                          NULL,
00194                          CSR_MAKE_API_NUMBER( USERSRV_SERVERDLL_INDEX,
00195                                               UserpEndTask
00196                                             ),
00197                          <span class="keyword">sizeof</span>( *a )
00198                        );
00199     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00200         <a class="code" href="../../d3/d0/csrstubs_8c.html#a0">SET_LAST_ERROR_RETURNED</a>();
00201         <span class="keywordflow">return</span> a-&gt;<a class="code" href="../../d5/d3/struct__ENDTASKMSG.html#o4">fSuccess</a>;
00202     } <span class="keywordflow">else</span> {
00203         RIPNTERR0(m.ReturnValue, RIP_VERBOSE, <span class="stringliteral">""</span>);
00204         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00205     }
00206 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="csrstubs.c::ExitWindowsEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI ExitWindowsEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwReserved</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00170">170</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00084">ExitWindowsWorker()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>.
<p>
<pre class="fragment"><div>00173 {
00174     <span class="keywordflow">return</span> <a class="code" href="../../d3/d0/csrstubs_8c.html#a6">ExitWindowsWorker</a>(uFlags, dwReserved, FALSE);
00175 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="csrstubs.c::ExitWindowsThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> ExitWindowsThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pvParam</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00156">156</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00079">_EXITWINDOWSDATA::dwReserved</a>, <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00084">ExitWindowsWorker()</a>, <a class="el" href="../../d3/d0/csrstubs_8c.html#a2">PEXITWINDOWSDATA</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00078">_EXITWINDOWSDATA::uFlags</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00084">ExitWindowsWorker()</a>.
<p>
<pre class="fragment"><div>00158 {
00159     <a class="code" href="../../d0/d9/struct__EXITWINDOWSDATA.html">PEXITWINDOWSDATA</a> pewd = pvParam;
00160     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwExitCode;
00161 
00162     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d0/csrstubs_8c.html#a6">ExitWindowsWorker</a>(pewd-&gt;<a class="code" href="../../d0/d9/struct__EXITWINDOWSDATA.html#o0">uFlags</a>, pewd-&gt;<a class="code" href="../../d0/d9/struct__EXITWINDOWSDATA.html#o1">dwReserved</a>, TRUE))
00163         dwExitCode = 0;
00164     <span class="keywordflow">else</span>
00165         dwExitCode = GetLastError();
00166     ExitThread(dwExitCode);
00167     <span class="keywordflow">return</span> 0;
00168 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="csrstubs.c::ExitWindowsWorker" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI ExitWindowsWorker           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwReserved</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fSecondThread</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00084">84</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00042">CallUserpExitWindowsEx()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00874">DispatchMessage()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00079">_EXITWINDOWSDATA::dwReserved</a>, <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00156">ExitWindowsThread()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l01486">MsgWaitForMultipleObjectsEx()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04526">NtUserCallOneParam()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00483">PeekMessage()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00078">_EXITWINDOWSDATA::uFlags</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00170">ExitWindowsEx()</a>, and <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00156">ExitWindowsThread()</a>.
<p>
<pre class="fragment"><div>00088 {
00089     <a class="code" href="../../d0/d9/struct__EXITWINDOWSDATA.html">EXITWINDOWSDATA</a> ewd;
00090     HANDLE hThread;
00091     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwThreadId;
00092     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwExitCode;
00093     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idWait;
00094     MSG <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00095     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSuccess;
00096     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00097 
00098     <span class="comment">/*</span>
00099 <span class="comment">     * Force a connection so apps will have a windowstation</span>
00100 <span class="comment">     * to log off of.</span>
00101 <span class="comment">     */</span>
00102     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>() == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00103         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00104 
00105     <span class="comment">/*</span>
00106 <span class="comment">     * Check for UI restrictions</span>
00107 <span class="comment">     */</span>
00108 
00109     <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a174">NtUserCallOneParam</a>((ULONG_PTR)uFlags, SFI_PREPAREFORLOGOFF)) {
00110         RIPMSG0(RIP_WARNING, <span class="stringliteral">"ExitWindows called by a restricted thread\n"</span>);
00111         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00112     }
00113 
00114     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d0/csrhlpr_8h.html#a0">CallUserpExitWindowsEx</a>(uFlags, dwReserved, &amp;fSuccess);
00115 
00116     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00117         <span class="keywordflow">return</span> fSuccess;
00118     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_CANT_WAIT &amp;&amp; !fSecondThread) {
00119         ewd.<a class="code" href="../../d0/d9/struct__EXITWINDOWSDATA.html#o0">uFlags</a> = uFlags;
00120         ewd.<a class="code" href="../../d0/d9/struct__EXITWINDOWSDATA.html#o1">dwReserved</a> = dwReserved;
00121         hThread = CreateThread(NULL, 0, ExitWindowsThread, &amp;ewd,
00122                 0, &amp;dwThreadId);
00123         <span class="keywordflow">if</span> (hThread == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00124             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00125         }
00126         <span class="keywordflow">while</span> (1) {
00127             idWait = <a class="code" href="../../d3/d8/client_8c.html#a58">MsgWaitForMultipleObjectsEx</a>(1, &amp;hThread,
00128                     INFINITE, QS_ALLINPUT, 0);
00129 
00130             <span class="comment">/*</span>
00131 <span class="comment">             * If the thread was signaled, we're done.</span>
00132 <span class="comment">             */</span>
00133             <span class="keywordflow">if</span> (idWait == WAIT_OBJECT_0)
00134                 <span class="keywordflow">break</span>;
00135 
00136             <span class="comment">/*</span>
00137 <span class="comment">             * Process any waiting messages</span>
00138 <span class="comment">             */</span>
00139             <span class="keywordflow">while</span> (<a class="code" href="../../d5/d9/cltxt_8h.html#a14">PeekMessage</a>(&amp;msg, NULL, 0, 0, PM_REMOVE))
00140                 <a class="code" href="../../d5/d9/cltxt_8h.html#a24">DispatchMessage</a>(&amp;msg);
00141         }
00142         GetExitCodeThread(hThread, &amp;dwExitCode);
00143         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(hThread);
00144         <span class="keywordflow">if</span> (dwExitCode == ERROR_SUCCESS)
00145             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00146         <span class="keywordflow">else</span> {
00147             RIPERR0(dwExitCode, RIP_VERBOSE, <span class="stringliteral">""</span>);
00148             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00149         }
00150     } <span class="keywordflow">else</span> {
00151         RIPNTERR0(Status, RIP_VERBOSE, <span class="stringliteral">""</span>);
00152         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00153     }
00154 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="csrstubs.c::GetThreadDesktop" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HDESK WINAPI GetThreadDesktop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dwThreadId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00298">298</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
References <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00065">_GETTHREADCONSOLEDESKTOPMSG::dwThreadId</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l01455">NtUserGetThreadDesktop()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d4/struct__USER__API__MSG.html#o15">_USER_API_MSG::u</a>, and <a class="el" href="../../d2/d0/csrmsg_8h.html#a35a29">UserpGetThreadConsoleDesktop</a>.
<p>
<pre class="fragment"><div>00300 {
00301     <a class="code" href="../../d3/d4/struct__USER__API__MSG.html">USER_API_MSG</a> m;
00302     <a class="code" href="../../d2/d2/struct__GETTHREADCONSOLEDESKTOPMSG.html">PGETTHREADCONSOLEDESKTOPMSG</a> a = &amp;m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o15">u</a>.GetThreadConsoleDesktop;
00303 
00304     a-&gt;<a class="code" href="../../d2/d2/struct__GETTHREADCONSOLEDESKTOPMSG.html#o0">dwThreadId</a> = dwThreadId;
00305     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00306                          NULL,
00307                          CSR_MAKE_API_NUMBER( USERSRV_SERVERDLL_INDEX,
00308                                               UserpGetThreadConsoleDesktop
00309                                             ),
00310                          <span class="keyword">sizeof</span>( *a )
00311                        );
00312     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00313         <span class="keywordflow">return</span> <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a100">NtUserGetThreadDesktop</a>(dwThreadId, a-&gt;<a class="code" href="../../d2/d2/struct__GETTHREADCONSOLEDESKTOPMSG.html#o1">hdeskConsole</a>);
00314     } <span class="keywordflow">else</span> {
00315         RIPNTERR0(m.ReturnValue, RIP_VERBOSE, <span class="stringliteral">""</span>);
00316         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00317     }
00318 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="csrstubs.c::Logon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID APIENTRY Logon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">BOOL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fLogon</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00210">210</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
References <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00046">_LOGONMSG::fLogon</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d4/struct__USER__API__MSG.html#o15">_USER_API_MSG::u</a>, and <a class="el" href="../../d2/d0/csrmsg_8h.html#a35a26">UserpLogon</a>.
<p>
<pre class="fragment"><div>00212 {
00213     <a class="code" href="../../d3/d4/struct__USER__API__MSG.html">USER_API_MSG</a> m;
00214     <a class="code" href="../../d4/d3/struct__LOGONMSG.html">PLOGONMSG</a> a = &amp;m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o15">u</a>.Logon;
00215 
00216     a-&gt;<a class="code" href="../../d4/d3/struct__LOGONMSG.html#o0">fLogon</a> = fLogon;
00217     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00218                          NULL,
00219                          CSR_MAKE_API_NUMBER( USERSRV_SERVERDLL_INDEX,
00220                                               UserpLogon
00221                                             ),
00222                          <span class="keyword">sizeof</span>(*a)
00223                        );
00224 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="csrstubs.c::RegisterLogonProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL RegisterLogonProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwProcessId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fSecure</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00252">252</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00228">CallUserpRegisterLogonProcess()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l00079">gfLogonProcess</a>, and <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04648">NtUserCallTwoParam()</a>.
<p>
<pre class="fragment"><div>00255 {
00256     <a class="code" href="../../d3/d8/client_8c.html#a18">gfLogonProcess</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a180">NtUserCallTwoParam</a>(dwProcessId, fSecure,
00257             SFI__REGISTERLOGONPROCESS);
00258 
00259     <span class="comment">/*</span>
00260 <span class="comment">     * Now, register the logon process into winsrv.</span>
00261 <span class="comment">     */</span>
00262     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/client_8c.html#a18">gfLogonProcess</a>) {
00263         <a class="code" href="../../d0/d0/csrhlpr_8h.html#a1">CallUserpRegisterLogonProcess</a>(dwProcessId);
00264     }
00265 
00266     <span class="keywordflow">return</span> <a class="code" href="../../d3/d8/client_8c.html#a18">gfLogonProcess</a>;
00267 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="csrstubs.c::RegisterServicesProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL WINAPI RegisterServicesProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dwProcessId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00275">275</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
References <a class="el" href="../../d9/d8/wow64csr_8c-source.html#l00075">CsrClientCallServer()</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00056">_REGISTERSERVICESPROCESSMSG::dwProcessId</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00036">SET_LAST_ERROR_RETURNED</a>, <a class="el" href="../../d3/d4/struct__USER__API__MSG.html#o15">_USER_API_MSG::u</a>, and <a class="el" href="../../d2/d0/csrmsg_8h.html#a35a27">UserpRegisterServicesProcess</a>.
<p>
<pre class="fragment"><div>00277 {
00278     <a class="code" href="../../d3/d4/struct__USER__API__MSG.html">USER_API_MSG</a> m;
00279     <a class="code" href="../../d3/d3/struct__REGISTERSERVICESPROCESSMSG.html">PREGISTERSERVICESPROCESSMSG</a> a = &amp;m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o15">u</a>.RegisterServicesProcess;
00280 
00281     a-&gt;<a class="code" href="../../d3/d3/struct__REGISTERSERVICESPROCESSMSG.html#o1">dwProcessId</a> = dwProcessId;
00282     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00283                          NULL,
00284                          CSR_MAKE_API_NUMBER( USERSRV_SERVERDLL_INDEX,
00285                                               UserpRegisterServicesProcess
00286                                             ),
00287                          <span class="keyword">sizeof</span>( *a )
00288                        );
00289     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00290         <a class="code" href="../../d3/d0/csrstubs_8c.html#a0">SET_LAST_ERROR_RETURNED</a>();
00291         <span class="keywordflow">return</span> a-&gt;<a class="code" href="../../d3/d3/struct__REGISTERSERVICESPROCESSMSG.html#o2">fSuccess</a>;
00292     } <span class="keywordflow">else</span> {
00293         RIPNTERR0(m.ReturnValue, RIP_VERBOSE, <span class="stringliteral">""</span>);
00294         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00295     }
00296 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a3" doxytag="csrstubs.c::gfLogonProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL <a class="el" href="../../d3/d0/csrstubs_8c.html#a3">gfLogonProcess</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00250">250</a> of file <a class="el" href="../../d4/d9/csrstubs_8c-source.html">csrstubs.c</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/imectl_8c-source.html#l00272">ImeWndCreateHandler()</a>, <a class="el" href="../../d7/d7/clinit_8c-source.html#l00933">LoadAppDlls()</a>, and <a class="el" href="../../d4/d9/csrstubs_8c-source.html#l00252">RegisterLogonProcess()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:20 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
