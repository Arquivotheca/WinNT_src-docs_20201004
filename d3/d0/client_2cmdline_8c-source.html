<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: cmdline.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>cmdline.c</h1><a href="../../d2/d1/client_2cmdline_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    cmdline.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">        This file implements command line editing and aliasing.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Author:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    Therese Stowell (thereses) 22-Mar-1991</span>
00016 <span class="comment"></span>
00017 <span class="comment">Revision History:</span>
00018 <span class="comment"></span>
00019 <span class="comment">--*/</span>
00020 
00021 <span class="preprocessor">#include "<a class="code" href="../../d4/d3/w32_2ntcon_2client_2precomp_8h.html">precomp.h</a>"</span>
00022 <span class="preprocessor">#pragma hdrstop</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#pragma hdrstop</span>
00024 <span class="preprocessor"></span>
<a name="l00025"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a0">00025</a> <span class="preprocessor">#define CONSOLE_NAME_PATH_SEPARATOR ((WCHAR)L'\\')</span>
<a name="l00026"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a1">00026</a> <span class="preprocessor"></span><span class="preprocessor">#define CONSOLE_NAME_PATH_TERMINATOR ((WCHAR)L'\0')</span>
00027 <span class="preprocessor"></span>
00028 <span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00029 <span class="preprocessor"></span>
<a name="l00030"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a2">00030</a> <span class="preprocessor">#define FNAME_LENGTH 256</span>
<a name="l00031"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a3">00031</a> <span class="preprocessor"></span>BOOLEAN <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a3">ExeNameInitialized</a>;
<a name="l00032"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a4">00032</a> RTL_CRITICAL_SECTION <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a4">ExeNameCriticalSection</a>;
<a name="l00033"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a5">00033</a> WCHAR <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a5">ExeNameBuffer</a>[<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a2">FNAME_LENGTH</a>];
<a name="l00034"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">00034</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a>;       <span class="comment">// in chars, not bytes</span>
<a name="l00035"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a7">00035</a> WCHAR <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a7">StartDirBuffer</a>[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>+1];
<a name="l00036"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a8">00036</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a8">StartDirLength</a>;      <span class="comment">// in chars, not bytes</span>
00037 
00038 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00039"></a><a class="code" href="../../d8/d9/dllinit_8c.html#a10">00039</a> <a class="code" href="../../d8/d9/dllinit_8c.html#a10">InitExeName</a>( VOID )
00040 {
00041 
00042     PPEB Peb;
00043     PLDR_DATA_TABLE_ENTRY ImageEntry;
00044 
00045     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a3">ExeNameInitialized</a>) {
00046         <span class="keywordflow">return</span>;
00047     }
00048 
00049     <a class="code" href="../../d7/d8/dll_2resource_8c.html#a24">RtlInitializeCriticalSection</a>(&amp;<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a4">ExeNameCriticalSection</a>);
00050     <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a3">ExeNameInitialized</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00051     Peb = NtCurrentPeb();
00052     ImageEntry = (PLDR_DATA_TABLE_ENTRY)Peb-&gt;Ldr-&gt;InLoadOrderModuleList.Flink;
00053     ImageEntry = CONTAINING_RECORD(ImageEntry, LDR_DATA_TABLE_ENTRY, InLoadOrderLinks);
00054     <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a> = ImageEntry-&gt;BaseDllName.Length/<span class="keyword">sizeof</span>(WCHAR);
00055     RtlCopyMemory(<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a5">ExeNameBuffer</a>,
00056            ImageEntry-&gt;BaseDllName.Buffer,
00057            ImageEntry-&gt;BaseDllName.Length
00058           );
00059     <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a5">ExeNameBuffer</a>[<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a>] = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a1">CONSOLE_NAME_PATH_TERMINATOR</a>;
00060     <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a8">StartDirLength</a> = Peb-&gt;ProcessParameters-&gt;CurrentDirectory.DosPath.Length/<span class="keyword">sizeof</span>(WCHAR);
00061     RtlCopyMemory(<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a7">StartDirBuffer</a>,
00062            Peb-&gt;ProcessParameters-&gt;CurrentDirectory.DosPath.Buffer,
00063            Peb-&gt;ProcessParameters-&gt;CurrentDirectory.DosPath.Length
00064           );
00065     <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a7">StartDirBuffer</a>[<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a8">StartDirLength</a>] = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a1">CONSOLE_NAME_PATH_TERMINATOR</a>;
00066 }
00067 
00068 
00069 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>
<a name="l00070"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a10">00070</a> <a class="code" href="../../d6/d4/condll_8h.html#a13">GetCurrentExeName</a>(
00071     OUT LPWSTR Buffer,
00072     IN ULONG BufferLength
00073     )
00074 {
00075     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a3">ExeNameInitialized</a>) {
00076         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[0] = UNICODE_NULL;
00077         <span class="keywordflow">return</span> 0;
00078     }
00079 
00080     RtlEnterCriticalSection(&amp;<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a4">ExeNameCriticalSection</a>);
00081     <span class="keywordflow">if</span> (BufferLength &gt; <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a> * <span class="keyword">sizeof</span>( WCHAR )) {
00082         BufferLength = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a> * <span class="keyword">sizeof</span>( WCHAR );
00083     }
00084     RtlCopyMemory(<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>,<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a5">ExeNameBuffer</a>,BufferLength);
00085     RtlLeaveCriticalSection(&amp;<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a4">ExeNameCriticalSection</a>);
00086     <span class="keywordflow">return</span> (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)BufferLength;
00087 }
00088 
00089 <span class="preprocessor">#endif </span>
00090 <span class="preprocessor"></span>
00091 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00092 <span class="preprocessor"></span>
00093 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>
<a name="l00094"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a11">00094</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a11">GetExeName</a>(
00095     IN OUT LPVOID *ExeName,
00096     IN BOOLEAN UnicodeApi,
00097     OUT PBOOLEAN UnicodeExe
00098     )
00099 {
00100 
00101     *UnicodeExe = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00102     <span class="keywordflow">if</span> (*ExeName == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00103         <span class="comment">// Should not get here</span>
00104         <span class="keywordflow">return</span> 0;
00105     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!UnicodeApi) {
00106         *UnicodeExe = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00107     }
00108 
00109     <span class="keywordflow">if</span> (ExeName == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00110        <span class="keywordflow">return</span> 0;
00111     }
00112     
00113     <span class="keywordflow">try</span> {
00114        <span class="keywordflow">if</span> (*UnicodeExe) 
00115            <span class="keywordflow">return</span> (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)wcslen(*ExeName)*<span class="keyword">sizeof</span>(WCHAR);  <span class="comment">// returns bytes, not chars</span>
00116        <span class="keywordflow">else</span>
00117            <span class="keywordflow">return</span> (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(*ExeName);  <span class="comment">// returns bytes, not chars</span>
00118     }
00119     except(<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>) {
00120        <span class="keywordflow">return</span> 0;
00121     }
00122 }
00123 
00124 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00125 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00126"></a><a class="code" href="../../d6/d4/condll_8h.html#a35">00126</a> <a class="code" href="../../d6/d4/condll_8h.html#a35">AddConsoleAliasInternal</a>(
00127     IN LPVOID Source,
00128     IN UINT   SourceLength,
00129     IN LPVOID Target,
00130     IN UINT   TargetLength,
00131     IN LPVOID ExeName,
00132     IN BOOLEAN Unicode
00133     )
00134 
00135 <span class="comment">/*++</span>
00136 <span class="comment"></span>
00137 <span class="comment">Parameters:</span>
00138 <span class="comment"></span>
00139 <span class="comment">    Source - String to substitute alias string for, in input stream.</span>
00140 <span class="comment"></span>
00141 <span class="comment">    Target - String to substitute for source.  NULL to delete an existing</span>
00142 <span class="comment">        alias.</span>
00143 <span class="comment"></span>
00144 <span class="comment">    ExeName - Exe to set alias in.</span>
00145 <span class="comment"></span>
00146 <span class="comment">Return Value:</span>
00147 <span class="comment"></span>
00148 <span class="comment">    TRUE - The operation was successful.</span>
00149 <span class="comment"></span>
00150 <span class="comment">    FALSE/NULL - The operation failed. Extended error status is available</span>
00151 <span class="comment">        using GetLastError.</span>
00152 <span class="comment"></span>
00153 <span class="comment">--*/</span>
00154 
00155 {
00156     PCSR_CAPTURE_HEADER CaptureBuffer;
00157     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00158     ULONG CapturedMsgPointers;
00159     <a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html">PCONSOLE_ADDALIAS_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.AddConsoleAliasW;
00160 
00161     a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00162     a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)SourceLength;
00163     a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o7">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00164     CapturedMsgPointers = 2;
00165 
00166     a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o3">ExeLength</a> = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a11">GetExeName</a>(&amp;ExeName,<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>,&amp;a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o8">UnicodeExe</a>);
00167 
00168     <span class="keywordflow">if</span> (Target != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00169         a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)TargetLength;
00170         CapturedMsgPointers += 1;
00171     }
00172     <span class="keywordflow">else</span> {
00173         a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o5">Target</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00174         a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a> = 0;
00175     }
00176 
00177     CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( CapturedMsgPointers,
00178                                               a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a> + a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a> + a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o3">ExeLength</a>
00179                                             );
00180     <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00181         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00182         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00183     }
00184     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00185                              (PCHAR) Source,
00186                              a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>,
00187                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o4">Source</a>
00188                            );
00189 
00190     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00191                              (PCHAR) ExeName,
00192                              a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o3">ExeLength</a>,
00193                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o6">Exe</a>
00194                            );
00195 
00196     <span class="keywordflow">if</span> (Target != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00197         <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00198                                  (PCHAR) Target,
00199                                  a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>,
00200                                  (PVOID *) &amp;a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o5">Target</a>
00201                                );
00202     }
00203 
00204     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00205                          CaptureBuffer,
00206                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00207                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a215">ConsolepAddAlias</a>
00208                                             ),
00209                          <span class="keyword">sizeof</span>( *a )
00210                        );
00211 
00212     <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00213 
00214     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00215         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00216         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00217     }
00218     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00219 
00220 }
00221 
00222 <span class="preprocessor">#endif </span>
00223 <span class="preprocessor"></span>
00224 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00225 <span class="preprocessor"></span>
00226 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00227 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00228"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a13">00228</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a13">AddConsoleAliasW</a>(
00229     IN LPWSTR Source,
00230     IN LPWSTR Target,
00231     IN LPWSTR ExeName
00232     )
00233 {
00234     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> TargetLength;
00235 
00236     <span class="keywordflow">if</span> (Target != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00237         TargetLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) (lstrlenW(Target)*<span class="keyword">sizeof</span>(WCHAR));
00238     } <span class="keywordflow">else</span> {
00239         TargetLength = 0;
00240     }
00241     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a35">AddConsoleAliasInternal</a>(Source,
00242                                    lstrlenW(Source)*<span class="keyword">sizeof</span>(WCHAR),
00243                                    Target,
00244                                    TargetLength,
00245                                    ExeName,
00246                                    <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00247                                   );
00248 }
00249 
00250 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00251 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00252"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a14">00252</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a14">AddConsoleAliasA</a>(
00253     IN LPTSTR Source,
00254     IN LPTSTR Target,
00255     IN LPTSTR ExeName
00256     )
00257 {
00258     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> TargetLength;
00259 
00260     <span class="keywordflow">if</span> (Target != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00261         TargetLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) lstrlenA(Target);
00262     } <span class="keywordflow">else</span> {
00263         TargetLength = 0;
00264     }
00265     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a35">AddConsoleAliasInternal</a>(Source,
00266                                    lstrlenA(Source),
00267                                    Target,
00268                                    TargetLength,
00269                                    ExeName,
00270                                    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00271                                   );
00272 }
00273 
00274 <span class="preprocessor">#endif </span>
00275 <span class="preprocessor"></span>
00276 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00277 <span class="preprocessor"></span>
00278 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00279 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00280"></a><a class="code" href="../../d6/d4/condll_8h.html#a36">00280</a> <a class="code" href="../../d6/d4/condll_8h.html#a36">GetConsoleAliasInternal</a>(
00281     IN LPVOID Source,
00282     IN UINT   SourceLength,
00283     OUT LPVOID TargetBuffer,
00284     IN UINT   TargetBufferLength,
00285     IN LPVOID ExeName,
00286     IN BOOLEAN Unicode
00287     )
00288 
00289 <span class="comment">/*++</span>
00290 <span class="comment"></span>
00291 <span class="comment">Parameters:</span>
00292 <span class="comment"></span>
00293 <span class="comment">    Source - Name of alias to query.  NULL means query all alias names.</span>
00294 <span class="comment"></span>
00295 <span class="comment">    Target - Where to store value of alias.  If Source is NULL, then</span>
00296 <span class="comment">        value is one or more null terminated strings terminated by an extra</span>
00297 <span class="comment">        null byte.  Each null terminated string is the name of an alias.</span>
00298 <span class="comment"></span>
00299 <span class="comment">Return Value:</span>
00300 <span class="comment"></span>
00301 <span class="comment">    Non-zero - The operation was successful, and the return value is the</span>
00302 <span class="comment">        number of characters stored in the Target buffer.</span>
00303 <span class="comment"></span>
00304 <span class="comment">    Zero - The operation failed. Extended error status is available</span>
00305 <span class="comment">        using GetLastError.</span>
00306 <span class="comment"></span>
00307 <span class="comment">--*/</span>
00308 
00309 {
00310     PCSR_CAPTURE_HEADER CaptureBuffer;
00311     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00312     ULONG CapturedMsgPointers;
00313     <a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html">PCONSOLE_GETALIAS_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetConsoleAliasW;
00314 
00315     <span class="keywordflow">if</span> (Source == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00316         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_PARAMETER);
00317         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00318     }
00319     a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00320     a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o7">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00321 
00322     CapturedMsgPointers = 3;
00323 
00324     a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o3">ExeLength</a> = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a11">GetExeName</a>(&amp;ExeName,<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>,&amp;a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o8">UnicodeExe</a>);
00325 
00326     a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) SourceLength;
00327     a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>) TargetBufferLength;
00328 
00329     CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( CapturedMsgPointers,
00330                                               a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a> + a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a> + a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o3">ExeLength</a>
00331                                             );
00332     <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00333         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00334         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00335     }
00336 
00337     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00338                              (PCHAR) ExeName,
00339                              a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o3">ExeLength</a>,
00340                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o6">Exe</a>
00341                            );
00342 
00343     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00344                              (PCHAR) Source,
00345                              a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a>,
00346                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o4">Source</a>
00347                            );
00348 
00349     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00350                              (PCHAR) <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00351                              a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a>,
00352                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o5">Target</a>
00353                            );
00354 
00355     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00356                          CaptureBuffer,
00357                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00358                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a216">ConsolepGetAlias</a>
00359                                             ),
00360                          <span class="keyword">sizeof</span>( *a )
00361                        );
00362 
00363     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00364         RtlCopyMemory( TargetBuffer, a-&gt;Target, a-&gt;TargetLength );
00365     }
00366     <span class="keywordflow">else</span> {
00367         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00368         <span class="keywordflow">if</span> (m.ReturnValue != STATUS_BUFFER_TOO_SMALL) {
00369             a-&gt;TargetLength = 0;
00370         }
00371     }
00372 
00373     <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00374 
00375     <span class="keywordflow">return</span> a-&gt;TargetLength;
00376 
00377 }
00378 
00379 <span class="preprocessor">#endif !defined(BUILD_WOW6432)</span>
00380 <span class="preprocessor"></span>
00381 <span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00382 <span class="preprocessor"></span>
00383 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00384 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00385"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a16">00385</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a16">GetConsoleAliasW</a>(
00386     IN LPWSTR Source,
00387     OUT LPWSTR TargetBuffer,
00388     IN DWORD TargetBufferLength,
00389     IN LPWSTR ExeName
00390     )
00391 {
00392     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a36">GetConsoleAliasInternal</a>(Source,
00393                                    lstrlenW(Source)*<span class="keyword">sizeof</span>(WCHAR),
00394                                    TargetBuffer,
00395                                    TargetBufferLength,
00396                                    ExeName,
00397                                    <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00398                                   );
00399 }
00400 
00401 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00402 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00403"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a17">00403</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a17">GetConsoleAliasA</a>(
00404     IN LPTSTR Source,
00405     OUT LPTSTR TargetBuffer,
00406     IN DWORD TargetBufferLength,
00407     IN LPTSTR ExeName
00408     )
00409 {
00410     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a36">GetConsoleAliasInternal</a>(Source,
00411                                    lstrlenA(Source),
00412                                    TargetBuffer,
00413                                    TargetBufferLength,
00414                                    ExeName,
00415                                    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00416                                   );
00417 }
00418 
00419 <span class="preprocessor">#endif </span>
00420 <span class="preprocessor"></span>
00421 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00422 <span class="preprocessor"></span>
00423 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00424 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00425"></a><a class="code" href="../../d6/d4/condll_8h.html#a37">00425</a> <a class="code" href="../../d6/d4/condll_8h.html#a37">GetConsoleAliasesLengthInternal</a>(
00426     IN LPVOID ExeName,
00427     IN BOOLEAN Unicode
00428     )
00429 {
00430     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00431     <a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html">PCONSOLE_GETALIASESLENGTH_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetConsoleAliasesLengthW;
00432     PCSR_CAPTURE_HEADER CaptureBuffer;
00433 
00434     a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00435     a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o1">ExeLength</a> = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a11">GetExeName</a>(&amp;ExeName,<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>,&amp;a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o5">UnicodeExe</a>);
00436     a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o4">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00437 
00438     CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
00439                                               a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o1">ExeLength</a>
00440                                             );
00441     <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00442         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00443         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00444     }
00445 
00446     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00447                              (PCHAR) ExeName,
00448                              a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o1">ExeLength</a>,
00449                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o2">Exe</a>
00450                            );
00451     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00452                          CaptureBuffer,
00453                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00454                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a217">ConsolepGetAliasesLength</a>
00455                                             ),
00456                          <span class="keyword">sizeof</span>( *a )
00457                        );
00458     <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00459     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00460         <span class="keywordflow">return</span> a-&gt;AliasesLength;
00461     } <span class="keywordflow">else</span> {
00462         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00463         <span class="keywordflow">return</span> 0;
00464     }
00465 
00466 }
00467 
00468 <span class="preprocessor">#endif </span>
00469 <span class="preprocessor"></span>
00470 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00471 <span class="preprocessor"></span>
00472 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00473 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00474"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a19">00474</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a19">GetConsoleAliasesLengthW</a>(
00475     IN LPWSTR ExeName
00476     )
00477 {
00478     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a37">GetConsoleAliasesLengthInternal</a>(ExeName,
00479                                            <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00480                                           );
00481 }
00482 
00483 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00484 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00485"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a20">00485</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a20">GetConsoleAliasesLengthA</a>(
00486     IN LPTSTR ExeName
00487     )
00488 {
00489     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a37">GetConsoleAliasesLengthInternal</a>(ExeName,
00490                                            <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00491                                           );
00492 }
00493 
00494 <span class="preprocessor">#endif </span>
00495 <span class="preprocessor"></span>
00496 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00497 <span class="preprocessor"></span>
00498 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00499 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00500"></a><a class="code" href="../../d6/d4/condll_8h.html#a38">00500</a> <a class="code" href="../../d6/d4/condll_8h.html#a38">GetConsoleAliasExesLengthInternal</a>(
00501     IN BOOLEAN Unicode
00502     )
00503 {
00504     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00505     <a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html">PCONSOLE_GETALIASEXESLENGTH_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetConsoleAliasExesLengthW;
00506 
00507     a-&gt;<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00508     a-&gt;<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html#o2">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00509 
00510     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00511                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00512                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00513                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a218">ConsolepGetAliasExesLength</a>
00514                                             ),
00515                          <span class="keyword">sizeof</span>( *a )
00516                        );
00517     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00518         <span class="keywordflow">return</span> a-&gt;AliasExesLength;
00519     } <span class="keywordflow">else</span> {
00520         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00521         <span class="keywordflow">return</span> 0;
00522     }
00523 
00524 }
00525 
00526 <span class="preprocessor">#endif </span>
00527 <span class="preprocessor"></span>
00528 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00529 <span class="preprocessor"></span>
00530 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00531 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00532"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a22">00532</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a22">GetConsoleAliasExesLengthW</a>( VOID )
00533 {
00534     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a38">GetConsoleAliasExesLengthInternal</a>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00535 }
00536 
00537 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00538 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00539"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a23">00539</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a23">GetConsoleAliasExesLengthA</a>( VOID )
00540 {
00541     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a38">GetConsoleAliasExesLengthInternal</a>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00542 }
00543 
00544 <span class="preprocessor">#endif </span>
00545 <span class="preprocessor"></span>
00546 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00547 <span class="preprocessor"></span>
00548 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00549 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00550"></a><a class="code" href="../../d6/d4/condll_8h.html#a39">00550</a> <a class="code" href="../../d6/d4/condll_8h.html#a39">GetConsoleAliasesInternal</a>(
00551     OUT LPVOID AliasBuffer,
00552     IN DWORD AliasBufferLength,
00553     IN LPVOID ExeName,
00554     IN BOOLEAN Unicode
00555     )
00556 {
00557     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00558     <a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html">PCONSOLE_GETALIASES_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetConsoleAliasesW;
00559     PCSR_CAPTURE_HEADER CaptureBuffer;
00560 
00561     a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00562     a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o1">ExeLength</a> = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a11">GetExeName</a>(&amp;ExeName,<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>,&amp;a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o4">UnicodeExe</a>);
00563     a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o3">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00564     a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a> = AliasBufferLength;
00565 
00566     CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 2,
00567                                               a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o1">ExeLength</a> + AliasBufferLength
00568                                             );
00569     <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00570         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00571         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00572     }
00573 
00574     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00575                              (PCHAR) ExeName,
00576                              a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o1">ExeLength</a>,
00577                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o2">Exe</a>
00578                            );
00579     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00580                              (PCHAR) <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00581                              a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a>,
00582                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o6">AliasesBuffer</a>
00583                            );
00584     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00585                          CaptureBuffer,
00586                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00587                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a219">ConsolepGetAliases</a>
00588                                             ),
00589                          <span class="keyword">sizeof</span>( *a )
00590                        );
00591     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00592         <span class="keywordflow">try</span> {
00593             RtlCopyMemory( AliasBuffer, a-&gt;AliasesBuffer, a-&gt;AliasesBufferLength );
00594         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00595             <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00596             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00597             <span class="keywordflow">return</span> 0;
00598         }
00599         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00600         <span class="keywordflow">return</span> a-&gt;AliasesBufferLength;
00601     } <span class="keywordflow">else</span> {
00602         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00603         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00604         <span class="keywordflow">return</span> 0;
00605     }
00606 
00607 }
00608 
00609 <span class="preprocessor">#endif </span>
00610 <span class="preprocessor"></span>
00611 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00612 <span class="preprocessor"></span>
00613 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00614"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a25">00614</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a25">GetConsoleAliasesW</a>(
00615     OUT LPWSTR AliasBuffer,
00616     IN DWORD AliasBufferLength,
00617     IN LPWSTR ExeName
00618     )
00619 {
00620     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a39">GetConsoleAliasesInternal</a>(AliasBuffer,
00621                                      AliasBufferLength,
00622                                      ExeName,
00623                                      <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00624                                     );
00625 }
00626 
00627 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00628"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a26">00628</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a26">GetConsoleAliasesA</a>(
00629     OUT LPTSTR AliasBuffer,
00630     IN DWORD AliasBufferLength,
00631     IN LPTSTR ExeName
00632     )
00633 {
00634     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a39">GetConsoleAliasesInternal</a>(AliasBuffer,
00635                                      AliasBufferLength,
00636                                      ExeName,
00637                                      <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00638                                     );
00639 }
00640 
00641 <span class="preprocessor">#endif </span>
00642 <span class="preprocessor"></span>
00643 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00644 <span class="preprocessor"></span>
00645 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00646 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00647"></a><a class="code" href="../../d6/d4/condll_8h.html#a40">00647</a> <a class="code" href="../../d6/d4/condll_8h.html#a40">GetConsoleAliasExesInternal</a>(
00648     OUT LPVOID ExeNameBuffer,
00649     IN DWORD ExeNameBufferLength,
00650     IN BOOLEAN Unicode
00651     )
00652 {
00653     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00654     <a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html">PCONSOLE_GETALIASEXES_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetConsoleAliasExesW;
00655     PCSR_CAPTURE_HEADER CaptureBuffer;
00656 
00657     a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00658     a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a> = ExeNameBufferLength;
00659     a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o3">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00660     CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
00661                                               ExeNameBufferLength
00662                                             );
00663     <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00664         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00665         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00666     }
00667 
00668     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00669                              (PCHAR) <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00670                              a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a>,
00671                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o2">AliasExesBuffer</a>
00672                            );
00673 
00674     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00675                          CaptureBuffer,
00676                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00677                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a220">ConsolepGetAliasExes</a>
00678                                             ),
00679                          <span class="keyword">sizeof</span>( *a )
00680                        );
00681     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00682         <span class="keywordflow">try</span> {
00683             RtlCopyMemory( <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a5">ExeNameBuffer</a>, a-&gt;AliasExesBuffer, a-&gt;AliasExesBufferLength );
00684         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00685             <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00686             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00687             <span class="keywordflow">return</span> 0;
00688         }
00689         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00690         <span class="keywordflow">return</span> a-&gt;AliasExesBufferLength;
00691     } <span class="keywordflow">else</span> {
00692         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00693         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00694         <span class="keywordflow">return</span> 0;
00695     }
00696 
00697 }
00698 
00699 <span class="preprocessor">#endif </span>
00700 <span class="preprocessor"></span>
00701 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00702 <span class="preprocessor"></span>
00703 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00704"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a28">00704</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a28">GetConsoleAliasExesW</a>(
00705     OUT LPWSTR ExeNameBuffer,
00706     IN DWORD ExeNameBufferLength
00707     )
00708 {
00709     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a40">GetConsoleAliasExesInternal</a>(<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a5">ExeNameBuffer</a>,
00710                                        ExeNameBufferLength,
00711                                        <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00712                                       );
00713 }
00714 
00715 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00716"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a29">00716</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a29">GetConsoleAliasExesA</a>(
00717     OUT LPTSTR ExeNameBuffer,
00718     IN DWORD ExeNameBufferLength
00719     )
00720 {
00721     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a40">GetConsoleAliasExesInternal</a>(<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a5">ExeNameBuffer</a>,
00722                                        ExeNameBufferLength,
00723                                        <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00724                                       );
00725 }
00726 
00727 <span class="preprocessor">#endif </span>
00728 <span class="preprocessor"></span>
00729 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00730 <span class="preprocessor"></span>
00731 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00732 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00733"></a><a class="code" href="../../d6/d4/condll_8h.html#a41">00733</a> <a class="code" href="../../d6/d4/condll_8h.html#a41">ExpungeConsoleCommandHistoryInternal</a>(
00734     IN LPVOID ExeName,
00735     IN BOOLEAN Unicode
00736     )
00737 {
00738     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00739     <a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html">PCONSOLE_EXPUNGECOMMANDHISTORY_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.ExpungeConsoleCommandHistoryW;
00740     PCSR_CAPTURE_HEADER CaptureBuffer;
00741 
00742     a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00743     a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o1">ExeLength</a> = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a11">GetExeName</a>(&amp;ExeName,<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>,&amp;a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o4">UnicodeExe</a>);
00744     a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o3">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00745 
00746     CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
00747                                               a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o1">ExeLength</a>
00748                                             );
00749     <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00750         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00751         <span class="keywordflow">return</span>;
00752     }
00753 
00754     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00755                              (PCHAR) ExeName,
00756                              a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o1">ExeLength</a>,
00757                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o2">Exe</a>
00758                            );
00759 
00760     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00761                          CaptureBuffer,
00762                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00763                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a221">ConsolepExpungeCommandHistory</a>
00764                                             ),
00765                          <span class="keyword">sizeof</span>( *a )
00766                        );
00767     <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00768 
00769 }
00770 
00771 
00772 <span class="preprocessor">#endif </span>
00773 <span class="preprocessor"></span>
00774 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00775 <span class="preprocessor"></span>
00776 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00777"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a31">00777</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a31">ExpungeConsoleCommandHistoryW</a>(
00778     IN LPWSTR ExeName
00779     )
00780 {
00781     <a class="code" href="../../d6/d4/condll_8h.html#a41">ExpungeConsoleCommandHistoryInternal</a>(ExeName,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00782 }
00783 
00784 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00785"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a32">00785</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a32">ExpungeConsoleCommandHistoryA</a>(
00786     IN LPTSTR ExeName
00787     )
00788 {
00789     <a class="code" href="../../d6/d4/condll_8h.html#a41">ExpungeConsoleCommandHistoryInternal</a>(ExeName,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00790 }
00791 
00792 <span class="preprocessor">#endif </span>
00793 <span class="preprocessor"></span>
00794 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00795 <span class="preprocessor"></span>
00796 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
00797 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00798"></a><a class="code" href="../../d6/d4/condll_8h.html#a42">00798</a> <a class="code" href="../../d6/d4/condll_8h.html#a42">SetConsoleNumberOfCommandsInternal</a>(
00799     IN DWORD Number,
00800     IN LPVOID ExeName,
00801     IN BOOLEAN Unicode
00802     )
00803 {
00804     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00805     <a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html">PCONSOLE_SETNUMBEROFCOMMANDS_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.SetConsoleNumberOfCommandsW;
00806     PCSR_CAPTURE_HEADER CaptureBuffer;
00807 
00808     a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00809     a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o1">NumCommands</a> = Number;
00810     a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o2">ExeLength</a> = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a11">GetExeName</a>(&amp;ExeName,<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>,&amp;a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o5">UnicodeExe</a>);
00811     a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o4">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00812     CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
00813                                               a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o2">ExeLength</a>
00814                                             );
00815     <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00816         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00817         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00818     }
00819 
00820     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00821                              (PCHAR) ExeName,
00822                              a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o2">ExeLength</a>,
00823                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o3">Exe</a>
00824                            );
00825 
00826     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00827                          CaptureBuffer,
00828                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00829                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a222">ConsolepSetNumberOfCommands</a>
00830                                             ),
00831                          <span class="keyword">sizeof</span>( *a )
00832                        );
00833     <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00834     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00835         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00836     } <span class="keywordflow">else</span> {
00837         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
00838         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00839     }
00840 
00841 }
00842 
00843 <span class="preprocessor">#endif </span>
00844 <span class="preprocessor"></span>
00845 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00846 <span class="preprocessor"></span>
00847 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00848"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a34">00848</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a34">SetConsoleNumberOfCommandsW</a>(
00849     IN DWORD Number,
00850     IN LPWSTR ExeName
00851     )
00852 {
00853     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a42">SetConsoleNumberOfCommandsInternal</a>(Number,
00854                                               ExeName,
00855                                               <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00856                                              );
00857 }
00858 
00859 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00860"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a35">00860</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a35">SetConsoleNumberOfCommandsA</a>(
00861     IN DWORD Number,
00862     IN LPTSTR ExeName
00863     )
00864 {
00865     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a42">SetConsoleNumberOfCommandsInternal</a>(Number,
00866                                               ExeName,
00867                                               <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00868                                              );
00869 }
00870 
00871 <span class="preprocessor">#endif </span>
00872 <span class="preprocessor"></span>
00873 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00874 <span class="preprocessor"></span>
00875 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00876 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00877"></a><a class="code" href="../../d6/d4/condll_8h.html#a43">00877</a> <a class="code" href="../../d6/d4/condll_8h.html#a43">GetConsoleCommandHistoryLengthInternal</a>(
00878     IN LPVOID ExeName,
00879     IN BOOLEAN Unicode
00880     )
00881 {    
00882     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00883     <a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html">PCONSOLE_GETCOMMANDHISTORYLENGTH_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetConsoleCommandHistoryLengthW;
00884     PCSR_CAPTURE_HEADER CaptureBuffer;
00885 
00886     a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00887     a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o2">ExeLength</a> = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a11">GetExeName</a>(&amp;ExeName,<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>,&amp;a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o5">UnicodeExe</a>);
00888     a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o4">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00889     CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
00890                                               a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o2">ExeLength</a>
00891                                             );
00892     <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00893         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00894         <span class="keywordflow">return</span> 0;
00895     }
00896 
00897     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00898                              (PCHAR) ExeName,
00899                              a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o2">ExeLength</a>,
00900                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o3">Exe</a>
00901                            );
00902 
00903     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00904                          CaptureBuffer,
00905                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00906                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a223">ConsolepGetCommandHistoryLength</a>
00907                                             ),
00908                          <span class="keyword">sizeof</span>( *a )
00909                        );
00910     <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00911     <span class="keywordflow">return</span> a-&gt;CommandHistoryLength;
00912 
00913 }
00914 
00915 <span class="preprocessor">#endif </span>
00916 <span class="preprocessor"></span>
00917 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
00918 <span class="preprocessor"></span>
00919 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00920"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a37">00920</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a37">GetConsoleCommandHistoryLengthW</a>(
00921     IN LPWSTR ExeName
00922     )
00923 {
00924     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a43">GetConsoleCommandHistoryLengthInternal</a>(ExeName,
00925                                                   <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00926                                                  );
00927 }
00928 
00929 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00930"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a38">00930</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a38">GetConsoleCommandHistoryLengthA</a>(
00931     IN LPTSTR ExeName
00932     )
00933 {
00934     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a43">GetConsoleCommandHistoryLengthInternal</a>(ExeName,
00935                                                   <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00936                                                  );
00937 }
00938 
00939 <span class="preprocessor">#endif </span>
00940 <span class="preprocessor"></span>
00941 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
00942 <span class="preprocessor"></span>
00943 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
00944 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l00945"></a><a class="code" href="../../d6/d4/condll_8h.html#a44">00945</a> <a class="code" href="../../d6/d4/condll_8h.html#a44">GetConsoleCommandHistoryInternal</a>(
00946     OUT LPVOID Commands,
00947     IN DWORD CommandBufferLength,
00948     IN LPVOID ExeName,
00949     IN BOOLEAN Unicode
00950     )
00951 {
00952     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
00953     <a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html">PCONSOLE_GETCOMMANDHISTORY_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetConsoleCommandHistoryW;
00954     PCSR_CAPTURE_HEADER CaptureBuffer;
00955 
00956     a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
00957     a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o1">CommandBufferLength</a> = CommandBufferLength;
00958     a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o3">ExeLength</a> = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a11">GetExeName</a>(&amp;ExeName,<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>,&amp;a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o6">UnicodeExe</a>);
00959     a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o5">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
00960     CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 2,
00961                                               CommandBufferLength + a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o3">ExeLength</a>
00962                                             );
00963     <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00964         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_NOT_ENOUGH_MEMORY);
00965         <span class="keywordflow">return</span> 0;
00966     }
00967 
00968 
00969     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00970                              (PCHAR) ExeName,
00971                              a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o3">ExeLength</a>,
00972                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o4">Exe</a>
00973                            );
00974 
00975     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
00976                              (PCHAR) <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00977                              a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o1">CommandBufferLength</a>,
00978                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o2">CommandBuffer</a>
00979                            );
00980     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
00981                          CaptureBuffer,
00982                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
00983                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a224">ConsolepGetCommandHistory</a>
00984                                             ),
00985                          <span class="keyword">sizeof</span>( *a )
00986                        );
00987     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
00988         <span class="keywordflow">try</span> {
00989             RtlCopyMemory( <a class="code" href="../../d2/d5/editreg_8c.html#a43">Commands</a>, a-&gt;CommandBuffer, a-&gt;CommandBufferLength );
00990         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
00991             <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00992             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
00993             <span class="keywordflow">return</span> 0;
00994         }
00995         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00996         <span class="keywordflow">return</span> a-&gt;CommandBufferLength;
00997     } <span class="keywordflow">else</span> {
00998         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
00999         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
01000         <span class="keywordflow">return</span> 0;
01001     }
01002 
01003 }
01004 
01005 <span class="preprocessor">#endif </span>
01006 <span class="preprocessor"></span>
01007 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
01008 <span class="preprocessor"></span>
01009 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l01010"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a40">01010</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a40">GetConsoleCommandHistoryW</a>(
01011     OUT LPWSTR Commands,
01012     IN DWORD CommandBufferLength,
01013     IN LPWSTR ExeName
01014     )
01015 {
01016     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a44">GetConsoleCommandHistoryInternal</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a43">Commands</a>,
01017                                             CommandBufferLength,
01018                                             ExeName,
01019                                             <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
01020                                            );
01021 }
01022 
01023 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l01024"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a41">01024</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a41">GetConsoleCommandHistoryA</a>(
01025     OUT LPTSTR Commands,
01026     IN DWORD CommandBufferLength,
01027     IN LPTSTR ExeName
01028     )
01029 {
01030     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a44">GetConsoleCommandHistoryInternal</a>(<a class="code" href="../../d2/d5/editreg_8c.html#a43">Commands</a>,
01031                                             CommandBufferLength,
01032                                             ExeName,
01033                                             <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
01034                                            );
01035 }
01036 
01037 <span class="preprocessor">#endif </span>
01038 <span class="preprocessor"></span>
01039 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
01040 <span class="preprocessor"></span>
01041 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01042 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01043"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a42">01043</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a42">SetConsoleCommandHistoryMode</a>(
01044     IN DWORD Flags
01045     )
01046 {
01047     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
01048     <a class="code" href="../../d0/d5/struct__CONSOLE__SETCOMMANDHISTORYMODE__MSG.html">PCONSOLE_SETCOMMANDHISTORYMODE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.SetConsoleCommandHistoryMode;
01049 
01050     a-&gt;<a class="code" href="../../d0/d5/struct__CONSOLE__SETCOMMANDHISTORYMODE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
01051     a-&gt;<a class="code" href="../../d0/d5/struct__CONSOLE__SETCOMMANDHISTORYMODE__MSG.html#o1">Flags</a> = Flags;
01052 
01053     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
01054                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01055                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
01056                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a225">ConsolepSetCommandHistoryMode</a>
01057                                             ),
01058                          <span class="keyword">sizeof</span>( *a )
01059                        );
01060     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
01061         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01062     } <span class="keywordflow">else</span> {
01063         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a>(m.ReturnValue);
01064         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01065     }
01066 }
01067 
01068 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
01069 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01070"></a><a class="code" href="../../d6/d4/condll_8h.html#a45">01070</a> <a class="code" href="../../d6/d4/condll_8h.html#a45">GetConsoleTitleInternal</a>(
01071     OUT PVOID lpConsoleTitle,
01072     IN DWORD nSize,
01073     IN BOOLEAN Unicode
01074     )
01075 {
01076     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
01077     <a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html">PCONSOLE_GETTITLE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.GetConsoleTitle;
01078     PCSR_CAPTURE_HEADER CaptureBuffer;
01079 
01080     <span class="keywordflow">if</span> (nSize == 0) {
01081         <span class="keywordflow">return</span> 0;
01082     }
01083     a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
01084     a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a> = nSize;
01085     a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o3">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
01086     CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
01087                                               a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a>
01088                                             );
01089     <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01090         <span class="keywordflow">return</span> 0;
01091     }
01092     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
01093                              <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01094                              a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a>,
01095                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o2">Title</a>
01096                            );
01097     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
01098                          CaptureBuffer,
01099                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
01100                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a201">ConsolepGetTitle</a>
01101                                             ),
01102                          <span class="keyword">sizeof</span>( *a )
01103                        );
01104     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
01105         <span class="keywordflow">try</span> {
01106             RtlCopyMemory( lpConsoleTitle, a-&gt;Title, a-&gt;TitleLength);
01107         } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01108             <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
01109             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
01110             <span class="keywordflow">return</span> 0;
01111         }
01112     }
01113     <span class="keywordflow">else</span> {
01114         <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
01115         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a> (m.ReturnValue);
01116         <span class="keywordflow">return</span> 0;
01117     }
01118     <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
01119     <span class="keywordflow">return</span> a-&gt;TitleLength;
01120 
01121 }
01122 
01123 <span class="preprocessor">#endif </span>
01124 <span class="preprocessor"></span>
01125 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
01126 <span class="preprocessor"></span>
01127 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
01128 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01129"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a44">01129</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a44">GetConsoleTitleA</a>(
01130     LPSTR lpConsoleTitle,
01131     DWORD nSize
01132     )
01133 {
01134     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> NumBytes;
01135     NumBytes = <a class="code" href="../../d6/d4/condll_8h.html#a45">GetConsoleTitleInternal</a>(lpConsoleTitle,
01136                                    nSize-<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>), <span class="comment">// allow room for null</span>
01137                                    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
01138                                   );
01139     <span class="keywordflow">if</span> (NumBytes) {
01140         lpConsoleTitle[NumBytes] = <span class="charliteral">'\0'</span>;   <span class="comment">// NULL terminate</span>
01141     }
01142     <span class="keywordflow">return</span> NumBytes;
01143 }
01144 
01145 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
01146 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01147"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a45">01147</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a45">GetConsoleTitleW</a>(
01148     LPWSTR lpConsoleTitle,
01149     DWORD nSize
01150     )
01151 {
01152     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> NumBytes;
01153     NumBytes = <a class="code" href="../../d6/d4/condll_8h.html#a45">GetConsoleTitleInternal</a>(lpConsoleTitle,
01154                                    (nSize-1)*<span class="keyword">sizeof</span>(WCHAR), <span class="comment">// allow room for null</span>
01155                                    <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
01156                                   );
01157     <span class="keywordflow">if</span> (NumBytes) {
01158         NumBytes /= <span class="keyword">sizeof</span>(WCHAR);
01159         lpConsoleTitle[NumBytes] = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a1">CONSOLE_NAME_PATH_TERMINATOR</a>;   <span class="comment">// NULL terminate</span>
01160     }
01161     <span class="keywordflow">return</span> NumBytes;
01162 }
01163 
01164 <span class="preprocessor">#endif </span>
01165 <span class="preprocessor"></span>
01166 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW6432)</span>
01167 <span class="preprocessor"></span>
01168 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01169 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01170"></a><a class="code" href="../../d6/d4/condll_8h.html#a46">01170</a> <a class="code" href="../../d6/d4/condll_8h.html#a46">SetConsoleTitleInternal</a>(
01171     IN CONST VOID *lpConsoleTitle,
01172     IN DWORD TitleLength,  <span class="comment">// in bytes</span>
01173     IN BOOLEAN Unicode
01174     )
01175 {
01176     <a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html">CONSOLE_API_MSG</a> m;
01177     <a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html">PCONSOLE_SETTITLE_MSG</a> a = &amp;m.<a class="code" href="../../d5/d9/struct__CONSOLE__API__MSG.html#o77">u</a>.SetConsoleTitle;
01178     PCSR_CAPTURE_HEADER CaptureBuffer;
01179 
01180     a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o0">ConsoleHandle</a> = <a class="code" href="../../d6/d4/condll_8h.html#a1">GET_CONSOLE_HANDLE</a>;
01181     a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a> = TitleLength;
01182     a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o3">Unicode</a> = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
01183     CaptureBuffer = <a class="code" href="../../d8/d9/wow64csr_8c.html#a5">CsrAllocateCaptureBuffer</a>( 1,
01184                                               a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>
01185                                             );
01186     <span class="keywordflow">if</span> (CaptureBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01187         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01188     }
01189     <a class="code" href="../../d8/d9/wow64csr_8c.html#a8">CsrCaptureMessageBuffer</a>( CaptureBuffer,
01190                              (PCHAR) lpConsoleTitle,
01191                              a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>,
01192                              (PVOID *) &amp;a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o2">Title</a>
01193                            );
01194     <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
01195                          CaptureBuffer,
01196                          CSR_MAKE_API_NUMBER( CONSRV_SERVERDLL_INDEX,
01197                                               <a class="code" href="../../d5/d5/conmsg_8h.html#a236a202">ConsolepSetTitle</a>
01198                                             ),
01199                          <span class="keyword">sizeof</span>( *a )
01200                        );
01201 
01202     <a class="code" href="../../d8/d9/wow64csr_8c.html#a6">CsrFreeCaptureBuffer</a>( CaptureBuffer );
01203 
01204     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( m.ReturnValue )) {
01205         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01206     }
01207     <span class="keywordflow">else</span> {
01208         <a class="code" href="../../d6/d4/condll_8h.html#a3">SET_LAST_NT_ERROR</a> (m.ReturnValue);
01209         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01210     }
01211 
01212 }
01213 
01214 <span class="preprocessor">#endif </span>
01215 <span class="preprocessor"></span>
01216 <span class="preprocessor"></span><span class="preprocessor">#if !defined(BUILD_WOW64)</span>
01217 <span class="preprocessor"></span>
01218 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01219 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01220"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a47">01220</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a47">SetConsoleTitleA</a>(
01221     LPCSTR lpConsoleTitle
01222     )
01223 {
01224     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> TitleLength;
01225     <span class="keywordflow">try</span> {
01226         TitleLength = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(lpConsoleTitle);
01227     } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01228         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
01229         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01230     }
01231     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a46">SetConsoleTitleInternal</a>(lpConsoleTitle,
01232                                    TitleLength,
01233                                    <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01234 }
01235 
01236 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01237 <a class="code" href="../../d1/d1/bench_8c.html#a0">APIENTRY</a>
<a name="l01238"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a48">01238</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a48">SetConsoleTitleW</a>(
01239     LPCWSTR lpConsoleTitle
01240     )
01241 {
01242     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> TitleLength;
01243     <span class="keywordflow">try</span> {
01244         TitleLength = wcslen(lpConsoleTitle)*<span class="keyword">sizeof</span>(WCHAR);
01245     } except( <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a> ) {
01246         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_ACCESS);
01247         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01248     }
01249     <span class="keywordflow">return</span> <a class="code" href="../../d6/d4/condll_8h.html#a46">SetConsoleTitleInternal</a>(lpConsoleTitle,
01250                                    TitleLength,
01251                                    <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01252 }
01253 
01254 
01255 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l01256"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a49">01256</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a49">GetConsoleInputExeNameA</a>(
01257     IN DWORD nBufferLength,
01258     OUT LPSTR lpBuffer
01259     )
01260 {
01261     PUNICODE_STRING <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
01262     ANSI_STRING AnsiString;
01263     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01264     UNICODE_STRING UnicodeString;
01265     WCHAR TempExeNameBuffer[<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a2">FNAME_LENGTH</a>];
01266     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
01267 
01268     <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a50">GetConsoleInputExeNameW</a>(<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a2">FNAME_LENGTH</a>, TempExeNameBuffer);
01269     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> != 0 &amp;&amp; <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> &lt; <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a2">FNAME_LENGTH</a>) {
01270         <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;UnicodeString, TempExeNameBuffer);
01271         AnsiString.Buffer = lpBuffer;
01272         AnsiString.Length = 0;
01273         AnsiString.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)nBufferLength;
01274         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a23">RtlUnicodeStringToAnsiString</a>(&amp;AnsiString, &amp;UnicodeString, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01275         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01276             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW) {
01277                 <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_BUFFER_OVERFLOW);
01278                 <span class="keywordflow">return</span> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>+1;
01279             } <span class="keywordflow">else</span> {
01280                 <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_PARAMETER);
01281             }
01282         }
01283     }
01284     <span class="keywordflow">return</span> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
01285 }
01286 
01287 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l01288"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a50">01288</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a50">GetConsoleInputExeNameW</a>(
01289     IN DWORD nBufferLength,
01290     OUT LPWSTR lpBuffer
01291     )
01292 {
01293     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
01294 
01295     <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a>;
01296     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> &gt;= nBufferLength) {
01297         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_BUFFER_OVERFLOW);
01298         <span class="keywordflow">return</span> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>+1;
01299     }
01300 
01301     <span class="keywordflow">try</span> {
01302         RtlEnterCriticalSection(&amp;<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a4">ExeNameCriticalSection</a>);
01303         RtlCopyMemory(lpBuffer, <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a5">ExeNameBuffer</a>, <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>*<span class="keyword">sizeof</span>(WCHAR));
01304         lpBuffer[<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>] = UNICODE_NULL;
01305     } finally {
01306         RtlLeaveCriticalSection(&amp;<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a4">ExeNameCriticalSection</a>);
01307     }
01308 
01309     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01310 }
01311 
01312 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l01313"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a51">01313</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a51">SetConsoleInputExeNameA</a>(
01314     IN LPSTR lpExeName
01315     )
01316 {
01317     PUNICODE_STRING <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>;
01318     ANSI_STRING AnsiString;
01319     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01320 
01321     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a> = &amp;NtCurrentTeb()-&gt;StaticUnicodeString;
01322     <a class="code" href="../../d2/d7/string_8c.html#a6">RtlInitAnsiString</a>(&amp;AnsiString,lpExeName);
01323     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d6/nls_8c.html#a21">RtlAnsiStringToUnicodeString</a>(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>,&amp;AnsiString,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01324     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>)) {
01325         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_BUFFER_OVERFLOW) {
01326             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_FILENAME_EXCED_RANGE);
01327         } <span class="keywordflow">else</span> {
01328             <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_PARAMETER);
01329         }
01330         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01331     }
01332 
01333     <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a52">SetConsoleInputExeNameW</a>(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>-&gt;Buffer);
01334 }
01335 
01336 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l01337"></a><a class="code" href="../../d2/d1/client_2cmdline_8c.html#a52">01337</a> <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a52">SetConsoleInputExeNameW</a>(
01338     IN LPWSTR lpExeName
01339     )
01340 {
01341     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
01342 
01343     <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = lstrlenW(lpExeName);
01344     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> == 0 || <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> &gt;= <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a2">FNAME_LENGTH</a>) {
01345         <a class="code" href="../../d6/d4/condll_8h.html#a2">SET_LAST_ERROR</a>(ERROR_INVALID_PARAMETER);
01346         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01347     }
01348 
01349     RtlEnterCriticalSection(&amp;<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a4">ExeNameCriticalSection</a>);
01350     <span class="keywordflow">try</span> {
01351         RtlCopyMemory(<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a5">ExeNameBuffer</a>,lpExeName,<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>*<span class="keyword">sizeof</span>(WCHAR));
01352         <a class="code" href="../../d2/d1/client_2cmdline_8c.html#a6">ExeNameLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
01353     } finally {
01354         RtlLeaveCriticalSection(&amp;<a class="code" href="../../d2/d1/client_2cmdline_8c.html#a4">ExeNameCriticalSection</a>);
01355     }
01356 
01357     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01358 }
01359 
01360 <span class="preprocessor">#endif </span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:27 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
