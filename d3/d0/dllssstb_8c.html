<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: dllssstb.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dllssstb.c File Reference</h1><code>#include "<a class="el" href="../../d4/d2/dbgdllp_8h-source.html">dbgdllp.h</a>"</code><br>
<code>#include "<a class="el" href="../../d0/d2/ldrp_8h-source.html">ldrp.h</a>"</code><br>

<p>
<a href="../../d4/d9/dllssstb_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/dllssstb_8c.html#a0">DbgSspConnectToDbg</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/dllssstb_8c.html#a1">DbgSspException</a> (IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey, IN PCLIENT_ID AppClientId, IN PDBGKM_EXCEPTION Exception)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/dllssstb_8c.html#a2">DbgSspCreateThread</a> (IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey, IN PCLIENT_ID AppClientId, IN PDBGKM_CREATE_THREAD NewThread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/dllssstb_8c.html#a3">DbgSspCreateProcess</a> (IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey, IN PCLIENT_ID AppClientId, IN PCLIENT_ID DebugUiClientId, IN PDBGKM_CREATE_PROCESS NewProcess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/dllssstb_8c.html#a4">DbgSspExitThread</a> (IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey, IN PCLIENT_ID AppClientId, IN PDBGKM_EXIT_THREAD ExitThread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/dllssstb_8c.html#a5">DbgSspExitProcess</a> (IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey, IN PCLIENT_ID AppClientId, IN PDBGKM_EXIT_PROCESS ExitProcess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/dllssstb_8c.html#a6">DbgSspLoadDll</a> (IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey, IN PCLIENT_ID AppClientId, IN PDBGKM_LOAD_DLL LoadDll)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/dllssstb_8c.html#a7">DbgSspUnloadDll</a> (IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey, IN PCLIENT_ID AppClientId, IN PDBGKM_UNLOAD_DLL UnloadDll)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/dllssstb_8c.html#a8">DbgSsInitialize</a> (IN HANDLE KmReplyPort, IN PDBGSS_UI_LOOKUP UiLookUpRoutine, IN PDBGSS_SUBSYSTEMKEY_LOOKUP SubsystemKeyLookupRoutine OPTIONAL, IN PDBGSS_DBGKM_APIMSG_FILTER KmApiMsgFilter OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/dllssstb_8c.html#a9">DbgSsHandleKmApiMsg</a> (IN PDBGKM_APIMSG ApiMsg, IN HANDLE ReplyEvent OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d0/dllssstb_8c.html#a10">DbgSspSrvApiLoop</a> (IN PVOID ThreadParameter)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a9" doxytag="dllssstb.c::DbgSsHandleKmApiMsg" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DbgSsHandleKmApiMsg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PDBGKM_APIMSG&nbsp;</td>
          <td class="mdname" nowrap> <em>ApiMsg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE ReplyEvent&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00517">517</a> of file <a class="el" href="../../d4/d9/dllssstb_8c-source.html">dllssstb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00463">DBG_TAG</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00176">DbgSspCreateProcess()</a>, <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00126">DbgSspCreateThread()</a>, <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00077">DbgSspException()</a>, <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00281">DbgSspExitProcess()</a>, <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00233">DbgSspExitThread()</a>, <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00042">DbgSspKmApiMsgFilter</a>, <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00039">DbgSspKmReplyPort</a>, <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00330">DbgSspLoadDll()</a>, <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00041">DbgSspSubsystemKeyLookupRoutine</a>, <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00040">DbgSspUiLookUpRoutine</a>, <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00379">DbgSspUnloadDll()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00044">NtReplyPort()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00022">RtlAllocateHeap</a>, <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00524                    :
00525 
00526     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by a subsystem upon receipt of a message whose
00527     <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> LPC_DEBUG_EVENT. The purpose of <span class="keyword">this</span> function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to propagate
00528     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debug event message to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debug server.
00529 
00530     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> number of callouts are performed prior to propagating <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message:
00531 
00532       - For all messages, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> KmApiMsgFilter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called (<span class="keywordflow">if</span> it was
00533         supplied during <a class="code" href="../../d3/d0/dllssstb_8c.html#a8">DbgSsInitialize</a>.  If <span class="keyword">this</span> returns anything other
00534         that DBG_CONTINUE, the message is not propagated by <span class="keyword">this</span>
00535         function.  The caller is responsible <span class="keywordflow">for</span> event propagation, and
00536         <span class="keywordflow">for</span> replying to the thread reporting the debug event.
00537 
00538       - For create process messages, the UiLookupRoutine is called.  If
00539         a success code is returned than message is propagated.
00540         Otherwise, a reply is generated to the thread reporting the
00541         debug event.
00542 
00543      -  For create process and create thread messages,
00544         SubsystemKeyLookupRoutine is called.  Failure does not effect
00545         propagation.  It simply inhibits the update of messages
00546         SubSystemKey field.
00547 
00548     Based on the debug event type, a DBGSS_APIMSG is formated and sent
00549     as a datagram to the debug server.
00550 
00551 Arguments:
00552 
00553     ApiMsg - Supplies the debug event message to propagate to the debug
00554         server.
00555 
00556     ReplyEvent - An optional parameter, that <span class="keywordflow">if</span> specified supplies a handle
00557         to an event that is to be signaled rather that generating a reply
00558         to <span class="keyword">this</span> message.
00559 
00560 Return Value:
00561 
00562     None.
00563 
00564 --*/
00565 
00566 
00567 {
00568     NTSTATUS st;
00569     CLIENT_ID DebugUiClientId;
00570     ULONG SubsystemKey;
00571     <a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey;
00572 
00573     ApiMsg-&gt;ReturnedStatus = STATUS_PENDING;
00574 
00575 #<span class="keywordflow">if</span> DBG &amp;&amp; 0
00576     if (ApiMsg-&gt;ApiNumber &gt;= DbgKmMaxApiNumber ) {
00577         ApiMsg-&gt;ApiNumber = DbgKmMaxApiNumber;
00578     }
00579     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"DBG:  %s Api Request received from %lx.%lx\n"</span>,
00580               DbgpKmApiName[ ApiMsg-&gt;ApiNumber ],
00581               ApiMsg-&gt;h.ClientId.UniqueProcess,
00582               ApiMsg-&gt;h.ClientId.UniqueThread
00583            );
00584 <span class="preprocessor">#endif // DBG</span>
00585 <span class="preprocessor"></span>
00586     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d3/dbgdllp_8h.html#a5">DbgSspKmApiMsgFilter</a>) {
00587         <span class="keywordflow">if</span> ( (<a class="code" href="../../d3/d3/dbgdllp_8h.html#a5">DbgSspKmApiMsgFilter</a>)(ApiMsg) != DBG_CONTINUE ) {
00588             <span class="keywordflow">return</span>;
00589         }
00590     }
00591 
00592     ContinueKey = (<a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a>) <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a0">RtlAllocateHeap</a>(RtlProcessHeap(), <a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( DBG_TAG ), <span class="keyword">sizeof</span>(*ContinueKey));
00593     <span class="keywordflow">if</span> ( !ContinueKey ) {
00594         ApiMsg-&gt;ReturnedStatus = STATUS_NO_MEMORY;
00595         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT(ReplyEvent) ) {
00596             st = <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(ReplyEvent,NULL);
00597         } <span class="keywordflow">else</span> {
00598             st = <a class="code" href="../../d5/d7/lpcreply_8c.html#a1">NtReplyPort</a>(DbgSspKmReplyPort,
00599                              (PPORT_MESSAGE)ApiMsg
00600                             );
00601         }
00602         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st));
00603         <span class="keywordflow">return</span>;
00604     }
00605     ContinueKey-&gt;KmApiMsg = *ApiMsg;
00606 
00607     ContinueKey-&gt;ReplyEvent = ReplyEvent;
00608 
00609     <span class="keywordflow">switch</span> (ApiMsg-&gt;ApiNumber) {
00610 
00611     <span class="keywordflow">case</span> DbgKmExceptionApi :
00612         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a1">DbgSspException</a>(
00613                 ContinueKey,
00614                 &amp;ApiMsg-&gt;h.ClientId,
00615                 &amp;ApiMsg-&gt;u.Exception
00616                 );
00617 
00618         <span class="keywordflow">break</span>;
00619 
00620     <span class="keywordflow">case</span> DbgKmCreateThreadApi :
00621 
00622         <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d3/dbgdllp_8h.html#a4">DbgSspSubsystemKeyLookupRoutine</a> ) {
00623 
00624             st = (<a class="code" href="../../d3/d3/dbgdllp_8h.html#a4">DbgSspSubsystemKeyLookupRoutine</a>)(
00625                     &amp;ApiMsg-&gt;h.ClientId,
00626                     &amp;SubsystemKey,
00627                     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00628                     );
00629 
00630             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
00631                 ApiMsg-&gt;u.CreateThread.SubSystemKey = SubsystemKey;
00632             }
00633         }
00634 
00635         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a2">DbgSspCreateThread</a>(
00636                 ContinueKey,
00637                 &amp;ApiMsg-&gt;h.ClientId,
00638                 &amp;ApiMsg-&gt;u.CreateThread
00639                 );
00640 
00641         <span class="keywordflow">break</span>;
00642 
00643     <span class="keywordflow">case</span> DbgKmCreateProcessApi :
00644 
00645         st = (<a class="code" href="../../d3/d3/dbgdllp_8h.html#a3">DbgSspUiLookUpRoutine</a>)(
00646                 &amp;ApiMsg-&gt;h.ClientId,
00647                 &amp;DebugUiClientId
00648                 );
00649         <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
00650             <span class="keywordflow">break</span>;
00651         }
00652 
00653         <span class="keywordflow">if</span> ( <a class="code" href="../../d3/d3/dbgdllp_8h.html#a4">DbgSspSubsystemKeyLookupRoutine</a> ) {
00654 
00655             st = (<a class="code" href="../../d3/d3/dbgdllp_8h.html#a4">DbgSspSubsystemKeyLookupRoutine</a>)(
00656                     &amp;ApiMsg-&gt;h.ClientId,
00657                     &amp;SubsystemKey,
00658                     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00659                     );
00660 
00661             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
00662                 ApiMsg-&gt;u.CreateProcessInfo.SubSystemKey = SubsystemKey;
00663             }
00664 
00665             st = (<a class="code" href="../../d3/d3/dbgdllp_8h.html#a4">DbgSspSubsystemKeyLookupRoutine</a>)(
00666                     &amp;ApiMsg-&gt;h.ClientId,
00667                     &amp;SubsystemKey,
00668                     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
00669                     );
00670 
00671             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
00672                 ApiMsg-&gt;u.CreateProcessInfo.InitialThread.SubSystemKey = SubsystemKey;
00673             }
00674         }
00675 
00676         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a3">DbgSspCreateProcess</a>(
00677                 ContinueKey,
00678                 &amp;ApiMsg-&gt;h.ClientId,
00679                 &amp;DebugUiClientId,
00680                 &amp;ApiMsg-&gt;u.CreateProcessInfo
00681                 );
00682         <span class="keywordflow">break</span>;
00683 
00684 
00685     <span class="keywordflow">case</span> DbgKmExitThreadApi :
00686         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a4">DbgSspExitThread</a>(
00687                 ContinueKey,
00688                 &amp;ApiMsg-&gt;h.ClientId,
00689                 &amp;ApiMsg-&gt;u.ExitThread
00690                 );
00691         <span class="keywordflow">break</span>;
00692 
00693     <span class="keywordflow">case</span> DbgKmExitProcessApi :
00694         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a5">DbgSspExitProcess</a>(
00695                 ContinueKey,
00696                 &amp;ApiMsg-&gt;h.ClientId,
00697                 &amp;ApiMsg-&gt;u.ExitProcess
00698                 );
00699         <span class="keywordflow">break</span>;
00700 
00701     <span class="keywordflow">case</span> DbgKmLoadDllApi :
00702         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a6">DbgSspLoadDll</a>(
00703                 ContinueKey,
00704                 &amp;ApiMsg-&gt;h.ClientId,
00705                 &amp;ApiMsg-&gt;u.LoadDll
00706                 );
00707         <span class="keywordflow">break</span>;
00708 
00709     <span class="keywordflow">case</span> DbgKmUnloadDllApi :
00710         st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a7">DbgSspUnloadDll</a>(
00711                 ContinueKey,
00712                 &amp;ApiMsg-&gt;h.ClientId,
00713                 &amp;ApiMsg-&gt;u.UnloadDll
00714                 );
00715         <span class="keywordflow">break</span>;
00716 
00717     <span class="keywordflow">default</span> :
00718         st = STATUS_NOT_IMPLEMENTED;
00719     }
00720 
00721     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
00722         ApiMsg-&gt;ReturnedStatus = st;
00723         <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>(RtlProcessHeap(), 0, ContinueKey);
00724         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT(ReplyEvent) ) {
00725             st = <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(ReplyEvent,NULL);
00726         } <span class="keywordflow">else</span> {
00727             st = <a class="code" href="../../d5/d7/lpcreply_8c.html#a1">NtReplyPort</a>(DbgSspKmReplyPort,
00728                              (PPORT_MESSAGE)ApiMsg
00729                             );
00730         }
00731         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st));
00732     }
00733 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="dllssstb.c::DbgSsInitialize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DbgSsInitialize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>KmReplyPort</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PDBGSS_UI_LOOKUP&nbsp;</td>
          <td class="mdname" nowrap> <em>UiLookUpRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PDBGSS_SUBSYSTEMKEY_LOOKUP SubsystemKeyLookupRoutine&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PDBGSS_DBGKM_APIMSG_FILTER KmApiMsgFilter&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00429">429</a> of file <a class="el" href="../../d4/d9/dllssstb_8c-source.html">dllssstb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00025">DbgSspConnectToDbg()</a>, <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00042">DbgSspKmApiMsgFilter</a>, <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00039">DbgSspKmReplyPort</a>, <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00737">DbgSspSrvApiLoop()</a>, <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00041">DbgSspSubsystemKeyLookupRoutine</a>, <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00040">DbgSspUiLookUpRoutine</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d1/d1/rtlexec_8c-source.html#l01241">RtlCreateUserThread()</a>.
<p>
<pre class="fragment"><div>00438                    :
00439 
00440     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by a subsystem to initialize
00441     portions of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debug subsystem dll. The <a class="code" href="../../d3/d9/arcinst_8c.html#a19">main</a> purpose of
00442     <span class="keyword">this</span> function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to set up callouts that are needed in order
00443     to use <a class="code" href="../../d3/d0/dllssstb_8c.html#a9">DbgSsHandleKmApiMsg</a>, and to connect to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debug server.
00444 
00445 Arguments:
00446 
00447     KmReplyPort - Supplies a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> port that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subsystem
00448         receives DbgKm API messages on.
00449 
00450     UiLookupRoutine - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a function that will
00451         be called upon receipt of a process creation message. The
00452         purpose of <span class="keyword">this</span> function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to identify <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client <span class="keywordtype">id</span> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00453         debug ui controlling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process.
00454 
00455     SubsystemKeyLookupRoutine - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a function that
00456         will be called upon receipt of process creation and thread
00457         creation messages.  The purpose of <span class="keyword">this</span> function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to allow a
00458         subsystem to correlate a key value with a given process or
00459         thread.
00460 
00461     KmApiMsgFilter - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a function that will be
00462         called upon receipt of a DbgKm Api message. This function can
00463         take any action. If <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> returns any value other than DBG_CONTINUE,
00464         <a class="code" href="../../d3/d0/dllssstb_8c.html#a9">DbgSsHandleKmApiMsg</a> will not process <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> message. This function
00465         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called before any other call outs occur.
00466 
00467 Return Value:
00468 
00469     Return code of DbgSsConnectToDbg.
00470 
00471 --*/
00472 
00473 {
00474     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00475 
00476     st = <a class="code" href="../../d3/d0/dllssstb_8c.html#a0">DbgSspConnectToDbg</a>();
00477 
00478     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st)) {
00479         <a class="code" href="../../d3/d3/dbgdllp_8h.html#a2">DbgSspKmReplyPort</a> = KmReplyPort;
00480         <a class="code" href="../../d3/d3/dbgdllp_8h.html#a3">DbgSspUiLookUpRoutine</a> = UiLookUpRoutine;
00481         <a class="code" href="../../d3/d3/dbgdllp_8h.html#a4">DbgSspSubsystemKeyLookupRoutine</a> = SubsystemKeyLookupRoutine;
00482         <a class="code" href="../../d3/d3/dbgdllp_8h.html#a5">DbgSspKmApiMsgFilter</a> = KmApiMsgFilter;
00483 
00484         st = <a class="code" href="../../d0/d2/rtlexec_8c.html#a13">RtlCreateUserThread</a>(
00485                 NtCurrentProcess(),
00486                 NULL,
00487                 FALSE,
00488                 0L,
00489                 0L,
00490                 0L,
00491                 DbgSspSrvApiLoop,
00492                 NULL,
00493                 NULL,
00494                 NULL
00495                 );
00496         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) );
00497     }
00498 
00499     <span class="keywordflow">return</span> st;
00500 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="dllssstb.c::DbgSspConnectToDbg" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DbgSspConnectToDbg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00025">25</a> of file <a class="el" href="../../d4/d9/dllssstb_8c-source.html">dllssstb.c</a>.
<p>
References <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00038">DbgSspApiPort</a>, <a class="el" href="../../d4/d8/ulpc_8h-source.html#l00049">DynamicQos</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00043">NtConnectPort()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d8/ulpc_8h-source.html#l00032">PortName</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00429">DbgSsInitialize()</a>.
<p>
<pre class="fragment"><div>00029                    :
00030 
00031     This routine makes a connection between <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00032     DbgSs port in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a> subsystem.
00033 
00034 Arguments:
00035 
00036     None.
00037 
00038 Return Value:
00039 
00040     TBD.
00041 
00042 --*/
00043 
00044 {
00045     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00046     UNICODE_STRING <a class="code" href="../../d3/d9/ulpc_8h.html#a2">PortName</a>;
00047     SECURITY_QUALITY_OF_SERVICE <a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>;
00048 
00049     <span class="comment">//</span>
00050     <span class="comment">// Set up the security quality of service parameters to use over the</span>
00051     <span class="comment">// port.  Use the most efficient (least overhead) - which is dynamic</span>
00052     <span class="comment">// rather than static tracking.</span>
00053     <span class="comment">//</span>
00054 
00055     <a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>.ImpersonationLevel = SecurityImpersonation;
00056     <a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>.ContextTrackingMode = SECURITY_DYNAMIC_TRACKING;
00057     <a class="code" href="../../d3/d9/ulpc_8h.html#a4">DynamicQos</a>.EffectiveOnly = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00058 
00059 
00060     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;PortName,L<span class="stringliteral">"\\DbgSsApiPort"</span>);
00061     st = <a class="code" href="../../d5/d6/lpcconn_8c.html#a1">NtConnectPort</a>(
00062             &amp;DbgSspApiPort,
00063             &amp;PortName,
00064             &amp;DynamicQos,
00065             NULL,
00066             NULL,
00067             NULL,
00068             NULL,
00069             0L
00070             );
00071 
00072     <span class="keywordflow">return</span> st;
00073 
00074 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="dllssstb.c::DbgSspCreateProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DbgSspCreateProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ContinueKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCLIENT_ID&nbsp;</td>
          <td class="mdname" nowrap> <em>AppClientId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCLIENT_ID&nbsp;</td>
          <td class="mdname" nowrap> <em>DebugUiClientId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PDBGKM_CREATE_PROCESS&nbsp;</td>
          <td class="mdname" nowrap> <em>NewProcess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00176">176</a> of file <a class="el" href="../../d4/d9/dllssstb_8c-source.html">dllssstb.c</a>.
<p>
References <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00038">DbgSspApiPort</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00032">NtRequestPort()</a>, and <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00517">DbgSsHandleKmApiMsg()</a>.
<p>
<pre class="fragment"><div>00185                    :
00186 
00187     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by emulation subsystems to report <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00188     creation of a <span class="keyword">new</span> process to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a> subsystem.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00189     responsibility of individual subsystems to track a process and its
00190     controlling DebugUi.
00191 
00192 Arguments:
00193 
00194     ContinueKey - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured DbgKm API message that needs a reply
00195         should <span class="keyword">this</span> API complete successfully.
00196 
00197     AppClientId - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> thread's ClientId.
00198 
00199     DebugUiClientId - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ClientId of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user
00200         interface controlling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> thread.
00201 
00202     NewProcess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> NewProcess message as sent through
00203         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> applications <a class="code" href="../../d8/d7/udbgk_8c.html#a0">DebugPort</a>. The calling subsystem may modify <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00204         SubSystemKey fields of <span class="keyword">this</span> message.
00205 
00206 Return Value:
00207 
00208     TBD
00209 
00210 --*/
00211 
00212 {
00213 
00214     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00215     DBGSS_APIMSG ApiMsg;
00216 
00217     PDBGSS_CREATE_PROCESS args;
00218 
00219     args = &amp;ApiMsg.u.CreateProcessInfo;
00220 
00221     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsCreateProcessApi,<span class="keyword">sizeof</span>(*args),AppClientId,ContinueKey);
00222 
00223     args-&gt;DebugUiClientId = *DebugUiClientId;
00224     args-&gt;NewProcess = *NewProcess;
00225 
00226     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(DbgSspApiPort, (PPORT_MESSAGE) &amp;ApiMsg);
00227 
00228     <span class="keywordflow">return</span> st;
00229 
00230 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="dllssstb.c::DbgSspCreateThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DbgSspCreateThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ContinueKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCLIENT_ID&nbsp;</td>
          <td class="mdname" nowrap> <em>AppClientId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PDBGKM_CREATE_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>NewThread</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00126">126</a> of file <a class="el" href="../../d4/d9/dllssstb_8c-source.html">dllssstb.c</a>.
<p>
References <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00038">DbgSspApiPort</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00032">NtRequestPort()</a>, and <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00517">DbgSsHandleKmApiMsg()</a>.
<p>
<pre class="fragment"><div>00134                    :
00135 
00136     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by emulation subsystems to report <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00137     creation of a <span class="keyword">new</span> thread to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a> subsystem.
00138 
00139 Arguments:
00140 
00141     ContinueKey - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured DbgKm API message that needs a reply
00142         should <span class="keyword">this</span> API complete successfully.
00143 
00144     AppClientId - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> thread's ClientId.
00145 
00146     NewThread - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> NewThread message as sent through
00147         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> applications <a class="code" href="../../d8/d7/udbgk_8c.html#a0">DebugPort</a>. The calling subsystem may modify <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00148         SubSystemKey field of <span class="keyword">this</span> message.
00149 
00150 Return Value:
00151 
00152     TBD
00153 
00154 --*/
00155 
00156 {
00157 
00158     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00159     DBGSS_APIMSG ApiMsg;
00160 
00161     PDBGKM_CREATE_THREAD args;
00162 
00163     args = &amp;ApiMsg.u.CreateThread;
00164 
00165     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsCreateThreadApi,<span class="keyword">sizeof</span>(*args),AppClientId, ContinueKey);
00166 
00167     *args = *NewThread;
00168 
00169     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(DbgSspApiPort, (PPORT_MESSAGE) &amp;ApiMsg);
00170 
00171     <span class="keywordflow">return</span> st;
00172 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="dllssstb.c::DbgSspException" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DbgSspException           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ContinueKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCLIENT_ID&nbsp;</td>
          <td class="mdname" nowrap> <em>AppClientId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PDBGKM_EXCEPTION&nbsp;</td>
          <td class="mdname" nowrap> <em>Exception</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00077">77</a> of file <a class="el" href="../../d4/d9/dllssstb_8c-source.html">dllssstb.c</a>.
<p>
References <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00038">DbgSspApiPort</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00032">NtRequestPort()</a>, and <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00517">DbgSsHandleKmApiMsg()</a>.
<p>
<pre class="fragment"><div>00085                    :
00086 
00087     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by emulation subsystems to report that
00088     an exception occured in a thread.
00089 
00090 Arguments:
00091 
00092     ContinueKey - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured DbgKm API message that needs a reply
00093         should <span class="keyword">this</span> API complete successfully.
00094 
00095     AppClientId - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ClientId of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread that
00096         encountered an exception.
00097 
00098     Exception - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Exception message as sent
00099         through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> applications <a class="code" href="../../d8/d7/udbgk_8c.html#a0">DebugPort</a>.
00100 
00101 Return Value:
00102 
00103     TBD
00104 
00105 --*/
00106 
00107 {
00108 
00109     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00110     DBGSS_APIMSG ApiMsg;
00111 
00112     PDBGKM_EXCEPTION args;
00113 
00114     args = &amp;ApiMsg.u.Exception;
00115 
00116     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsExceptionApi,<span class="keyword">sizeof</span>(*args),AppClientId,ContinueKey);
00117 
00118     *args = *Exception;
00119 
00120     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(DbgSspApiPort, (PPORT_MESSAGE) &amp;ApiMsg);
00121 
00122     <span class="keywordflow">return</span> st;
00123 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="dllssstb.c::DbgSspExitProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DbgSspExitProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ContinueKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCLIENT_ID&nbsp;</td>
          <td class="mdname" nowrap> <em>AppClientId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PDBGKM_EXIT_PROCESS&nbsp;</td>
          <td class="mdname" nowrap> <em>ExitProcess</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00281">281</a> of file <a class="el" href="../../d4/d9/dllssstb_8c-source.html">dllssstb.c</a>.
<p>
References <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00038">DbgSspApiPort</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00032">NtRequestPort()</a>, and <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00517">DbgSsHandleKmApiMsg()</a>.
<p>
<pre class="fragment"><div>00289                    :
00290 
00291     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by emulation subsystems to report that
00292     a process <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> exiting.
00293 
00294 Arguments:
00295 
00296     ContinueKey - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured DbgKm API message that needs a reply
00297         should <span class="keyword">this</span> API complete successfully.
00298 
00299     AppClientId - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ClientId of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last thread
00300         in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process to <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>.
00301 
00302     ExitProcess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ExitProcess message as sent
00303         through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> applications <a class="code" href="../../d8/d7/udbgk_8c.html#a0">DebugPort</a>.
00304 
00305 Return Value:
00306 
00307     TBD
00308 
00309 --*/
00310 
00311 {
00312 
00313     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00314     DBGSS_APIMSG ApiMsg;
00315 
00316     PDBGKM_EXIT_PROCESS args;
00317 
00318     args = &amp;ApiMsg.u.ExitProcess;
00319 
00320     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsExitProcessApi,<span class="keyword">sizeof</span>(*args),AppClientId,ContinueKey);
00321 
00322     *args = *ExitProcess;
00323 
00324     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(DbgSspApiPort, (PPORT_MESSAGE) &amp;ApiMsg);
00325 
00326     <span class="keywordflow">return</span> st;
00327 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="dllssstb.c::DbgSspExitThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DbgSspExitThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ContinueKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCLIENT_ID&nbsp;</td>
          <td class="mdname" nowrap> <em>AppClientId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PDBGKM_EXIT_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExitThread</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00233">233</a> of file <a class="el" href="../../d4/d9/dllssstb_8c-source.html">dllssstb.c</a>.
<p>
References <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00038">DbgSspApiPort</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00032">NtRequestPort()</a>, and <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00517">DbgSsHandleKmApiMsg()</a>.
<p>
<pre class="fragment"><div>00241                    :
00242 
00243     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by emulation subsystems to report that
00244     a thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> exiting.
00245 
00246 Arguments:
00247 
00248     ContinueKey - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured DbgKm API message that needs a reply
00249         should <span class="keyword">this</span> API complete successfully.
00250 
00251     AppClientId - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exiting thread's ClientId.
00252 
00253     ExitThread - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ExitThread message as sent
00254         through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> applications <a class="code" href="../../d8/d7/udbgk_8c.html#a0">DebugPort</a>.
00255 
00256 Return Value:
00257 
00258     TBD
00259 
00260 --*/
00261 
00262 {
00263 
00264     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00265     DBGSS_APIMSG ApiMsg;
00266 
00267     PDBGKM_EXIT_THREAD args;
00268 
00269     args = &amp;ApiMsg.u.ExitThread;
00270 
00271     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsExitThreadApi,<span class="keyword">sizeof</span>(*args),AppClientId,ContinueKey);
00272 
00273     *args = *ExitThread;
00274 
00275     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(DbgSspApiPort, (PPORT_MESSAGE) &amp;ApiMsg);
00276 
00277     <span class="keywordflow">return</span> st;
00278 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="dllssstb.c::DbgSspLoadDll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DbgSspLoadDll           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ContinueKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCLIENT_ID&nbsp;</td>
          <td class="mdname" nowrap> <em>AppClientId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PDBGKM_LOAD_DLL&nbsp;</td>
          <td class="mdname" nowrap> <em>LoadDll</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00330">330</a> of file <a class="el" href="../../d4/d9/dllssstb_8c-source.html">dllssstb.c</a>.
<p>
References <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00038">DbgSspApiPort</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00032">NtRequestPort()</a>, and <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00517">DbgSsHandleKmApiMsg()</a>.
<p>
<pre class="fragment"><div>00338                    :
00339 
00340     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by emulation subsystems to report that
00341     a a process has loaded a DLL
00342 
00343 Arguments:
00344 
00345     ContinueKey - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured DbgKm API message that needs a reply
00346         should <span class="keyword">this</span> API complete successfully.
00347 
00348     AppClientId - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ClientId of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread
00349         that mapped <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section.
00350 
00351     LoadDll - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LoadDll message as sent
00352         through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> applications <a class="code" href="../../d8/d7/udbgk_8c.html#a0">DebugPort</a>.
00353 
00354 Return Value:
00355 
00356     TBD
00357 
00358 --*/
00359 
00360 {
00361 
00362     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00363     DBGSS_APIMSG ApiMsg;
00364 
00365     PDBGKM_LOAD_DLL args;
00366 
00367     args = &amp;ApiMsg.u.LoadDll;
00368 
00369     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsLoadDllApi,<span class="keyword">sizeof</span>(*args),AppClientId,ContinueKey);
00370 
00371     *args = *LoadDll;
00372 
00373     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(DbgSspApiPort, (PPORT_MESSAGE) &amp;ApiMsg);
00374 
00375     <span class="keywordflow">return</span> st;
00376 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="dllssstb.c::DbgSspSrvApiLoop" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DbgSspSrvApiLoop           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ThreadParameter</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00737">737</a> of file <a class="el" href="../../d4/d9/dllssstb_8c-source.html">dllssstb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00038">DbgSspApiPort</a>, <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00039">DbgSspKmReplyPort</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00045">_DBGSS_CONTINUE_KEY::KmApiMsg</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00044">NtReplyPort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00029">NtReplyWaitReceivePort()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00046">_DBGSS_CONTINUE_KEY::ReplyEvent</a>, and <a class="el" href="../../d4/d6/config_2utils_2regutil_8c-source.html#l00023">RtlFreeHeap</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00429">DbgSsInitialize()</a>.
<p>
<pre class="fragment"><div>00743                    :
00744 
00745     This loop services <a class="code" href="../../d9/d5/cdfs__rec_8c.html#a0">Dbg</a> Subsystem server originated messages.
00746 
00747 Arguments:
00748 
00749     ThreadParameter - Not used.
00750 
00751 Return Value:
00752 
00753     None.
00754 
00755 --*/
00756 
00757 {
00758     DBGSRV_APIMSG DbgSrvApiMsg;
00759     <a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a> ContinueKey;
00760     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00761 
00762     <span class="keywordflow">for</span>(;;) {
00763 
00764         st = <a class="code" href="../../d4/d7/lpcrecv_8c.html#a0">NtReplyWaitReceivePort</a>(
00765                 DbgSspApiPort,
00766                 NULL,
00767                 NULL,
00768                 (PPORT_MESSAGE) &amp;DbgSrvApiMsg
00769                 );
00770 
00771         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( st )) {
00772             <span class="keywordflow">continue</span>;
00773             }
00774 
00775         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(DbgSrvApiMsg.ApiNumber &lt; DbgSrvMaxApiNumber);
00776 
00777         <span class="keywordflow">switch</span> (DbgSrvApiMsg.ApiNumber ) {
00778         <span class="keywordflow">case</span> DbgSrvContinueApi :
00779 
00780             <span class="comment">//</span>
00781             <span class="comment">// Might want to implement continue status based callout</span>
00782             <span class="comment">// like DBG_TERMINATE_PROCESS/THREAD</span>
00783             <span class="comment">//</span>
00784 
00785             ContinueKey = (<a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a>) DbgSrvApiMsg.ContinueKey;
00786             ContinueKey-&gt;<a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html#o0">KmApiMsg</a>.ReturnedStatus = DbgSrvApiMsg.ReturnedStatus;
00787 
00788             <span class="keywordflow">if</span> ( ContinueKey-&gt;<a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html#o1">ReplyEvent</a> ) {
00789                 st = <a class="code" href="../../d0/d8/ex_2event_8c.html#a10">NtSetEvent</a>(ContinueKey-&gt;<a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html#o1">ReplyEvent</a>,NULL);
00790             } <span class="keywordflow">else</span> {
00791                 st = <a class="code" href="../../d5/d7/lpcreply_8c.html#a1">NtReplyPort</a>(DbgSspKmReplyPort,
00792                                  (PPORT_MESSAGE) &amp;ContinueKey-&gt;<a class="code" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html#o0">KmApiMsg</a>
00793                                 );
00794             }
00795 
00796             <a class="code" href="../../d3/d7/config_2utils_2regutil_8c.html#a1">RtlFreeHeap</a>(RtlProcessHeap(), 0, ContinueKey);
00797             <span class="keywordflow">break</span>;
00798         <span class="keywordflow">default</span> :
00799             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
00800         }
00801     }
00802 
00803     <span class="comment">//</span>
00804     <span class="comment">// Make the compiler happy</span>
00805     <span class="comment">//</span>
00806 
00807     <span class="keywordflow">return</span> st;
00808 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="dllssstb.c::DbgSspUnloadDll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS DbgSspUnloadDll           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d0/struct__DBGSS__CONTINUE__KEY.html">PDBGSS_CONTINUE_KEY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ContinueKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCLIENT_ID&nbsp;</td>
          <td class="mdname" nowrap> <em>AppClientId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PDBGKM_UNLOAD_DLL&nbsp;</td>
          <td class="mdname" nowrap> <em>UnloadDll</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00379">379</a> of file <a class="el" href="../../d4/d9/dllssstb_8c-source.html">dllssstb.c</a>.
<p>
References <a class="el" href="../../d4/d2/dbgdllp_8h-source.html#l00038">DbgSspApiPort</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00032">NtRequestPort()</a>, and <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>.
<p>
Referenced by <a class="el" href="../../d4/d9/dllssstb_8c-source.html#l00517">DbgSsHandleKmApiMsg()</a>.
<p>
<pre class="fragment"><div>00387                    :
00388 
00389     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by emulation subsystems to report that
00390     a a process has un-mapped a view of a section
00391 
00392 Arguments:
00393 
00394     ContinueKey - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> captured DbgKm API message that needs a reply
00395         should <span class="keyword">this</span> API complete successfully.
00396 
00397     AppClientId - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ClientId of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread
00398         that mapped <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> section.
00399 
00400     UnloadDll - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> UnloadDll message as sent
00401         through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> applications <a class="code" href="../../d8/d7/udbgk_8c.html#a0">DebugPort</a>.
00402 
00403 Return Value:
00404 
00405     TBD
00406 
00407 --*/
00408 
00409 {
00410 
00411     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00412     DBGSS_APIMSG ApiMsg;
00413 
00414     PDBGKM_UNLOAD_DLL args;
00415 
00416     args = &amp;ApiMsg.u.UnloadDll;
00417 
00418     DBGSS_FORMAT_API_MSG(ApiMsg,DbgSsUnloadDllApi,<span class="keyword">sizeof</span>(*args),AppClientId,ContinueKey);
00419 
00420     *args = *UnloadDll;
00421 
00422     st = <a class="code" href="../../d6/d7/lpcsend_8c.html#a0">NtRequestPort</a>(DbgSspApiPort, (PPORT_MESSAGE) &amp;ApiMsg);
00423 
00424     <span class="keywordflow">return</span> st;
00425 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:28 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
