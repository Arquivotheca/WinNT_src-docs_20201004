<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: userexts.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>userexts.c</h1><a href="../../d2/d1/userexts_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/****************************** Module Header ******************************\</span>
00002 <span class="comment">* Module Name: userexts.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* This module contains user related debugging extensions.</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 17-May-1991 DarrinM   Created.</span>
00010 <span class="comment">* 22-Jan-1992 IanJa     ANSI/Unicode neutral (all debug output is ANSI)</span>
00011 <span class="comment">* 23-Mar-1993 JerrySh   Moved from winsrv.dll to userexts.dll</span>
00012 <span class="comment">* 21-Oct-1993 JerrySh   Modified to work with WinDbg</span>
00013 <span class="comment">* 18-Oct-1994 ChrisWil  Added Object Tracking extent.</span>
00014 <span class="comment">* 26-May-1995 Sanfords  Made it more general for the good of humanity.</span>
00015 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif and to dual compile for</span>
00016 <span class="comment">*                       either USER or KERNEL mode.</span>
00017 <span class="comment">\***************************************************************************/</span>
00018 <span class="preprocessor">#include "<a class="code" href="../../d5/d1/userkdx_8h.html">userkdx.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="../../d4/d6/vkoem_8h.html">vkoem.h</a>"</span>
00020 
00021 <span class="preprocessor">#ifdef KERNEL</span>
00022 <span class="preprocessor"></span>PSTR <a class="code" href="../../d2/d1/userexts_8c.html#a60">pszExtName</a>         = <span class="stringliteral">"USERKDX"</span>;
00023 <span class="preprocessor">#else</span>
<a name="l00024"></a><a class="code" href="../../d2/d1/userexts_8c.html#a60">00024</a> <span class="preprocessor"></span>PSTR <a class="code" href="../../d2/d1/userexts_8c.html#a60">pszExtName</a>         = <span class="stringliteral">"USEREXTS"</span>;
00025 <span class="preprocessor">#endif</span>
00026 <span class="preprocessor"></span>
00027 <span class="preprocessor">#include &lt;stdexts.h&gt;</span>
00028 <span class="preprocessor">#include &lt;stdexts.c&gt;</span>
00029 
00030 <span class="comment">/***************************************************************************\</span>
00031 <span class="comment">* Constants</span>
00032 <span class="comment">\***************************************************************************/</span>
<a name="l00033"></a><a class="code" href="../../d2/d1/userexts_8c.html#a0">00033</a> <span class="preprocessor">#define CDWORDS 16</span>
<a name="l00034"></a><a class="code" href="../../d2/d1/userexts_8c.html#a1">00034</a> <span class="preprocessor"></span><span class="preprocessor">#define BF_MAX_WIDTH    80</span>
<a name="l00035"></a><a class="code" href="../../d2/d1/userexts_8c.html#a2">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define BF_COLUMN_WIDTH 19</span>
00036 <span class="preprocessor"></span>
00037 
00038 <span class="comment">/***************************************************************************\</span>
00039 <span class="comment">* Global variables</span>
00040 <span class="comment">\***************************************************************************/</span>
<a name="l00041"></a><a class="code" href="../../d2/d1/userexts_8c.html#a61">00041</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a61">bServerDebug</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
<a name="l00042"></a><a class="code" href="../../d2/d1/userexts_8c.html#a62">00042</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a62">bShowFlagNames</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
<a name="l00043"></a><a class="code" href="../../d2/d1/userexts_8c.html#a63">00043</a> <span class="keywordtype">char</span> <a class="code" href="../../d2/d1/userexts_8c.html#a63">gach1</a>[80];
<a name="l00044"></a><a class="code" href="../../d2/d1/userexts_8c.html#a64">00044</a> <span class="keywordtype">char</span> <a class="code" href="../../d2/d1/userexts_8c.html#a64">gach2</a>[80];
<a name="l00045"></a><a class="code" href="../../d2/d1/userexts_8c.html#a65">00045</a> <a class="code" href="../../d7/d0/structtagCLS.html">CLS</a> <a class="code" href="../../d2/d1/userexts_8c.html#a65">gcls</a>;
<a name="l00046"></a><a class="code" href="../../d2/d1/userexts_8c.html#a66">00046</a> <a class="code" href="../../d9/d3/w32_2ntuser_2kdexts_2precomp_8h.html#a7">PGETEPROCESSDATAFUNC</a> <a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>;
<a name="l00047"></a><a class="code" href="../../d2/d1/userexts_8c.html#a67">00047</a> <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">SHAREDINFO</a> <a class="code" href="../../d2/d1/userexts_8c.html#a67">gShi</a>;
<a name="l00048"></a><a class="code" href="../../d2/d1/userexts_8c.html#a68">00048</a> <a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a> <a class="code" href="../../d2/d1/userexts_8c.html#a68">gSi</a>;
<a name="l00049"></a><a class="code" href="../../d2/d1/userexts_8c.html#a69">00049</a> <span class="keywordtype">int</span> <a class="code" href="../../d2/d1/userexts_8c.html#a69">giBFColumn</a>;                     <span class="comment">// bit field: current column</span>
<a name="l00050"></a><a class="code" href="../../d2/d1/userexts_8c.html#a70">00050</a> <span class="keywordtype">char</span> <a class="code" href="../../d2/d1/userexts_8c.html#a70">gaBFBuff</a>[<a class="code" href="../../d2/d1/userexts_8c.html#a1">BF_MAX_WIDTH</a> + 1];    <span class="comment">// bit field: buffer</span>
00051 
00052 <span class="comment">// used in dsi() and dinp()</span>
<a name="l00053"></a><a class="code" href="../../d7/d7/structSYSMET__ENTRY.html">00053</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00054"></a><a class="code" href="../../d7/d7/structSYSMET__ENTRY.html#o0">00054</a>     <span class="keywordtype">int</span>     iMetric;
<a name="l00055"></a><a class="code" href="../../d7/d7/structSYSMET__ENTRY.html#o1">00055</a>     LPSTR   pstrMetric;
00056 } <a class="code" href="../../d7/d7/structSYSMET__ENTRY.html">SYSMET_ENTRY</a>;
<a name="l00057"></a><a class="code" href="../../d2/d1/userexts_8c.html#a3">00057</a> <span class="preprocessor">#define SMENTRY(sm) {SM_##sm, #sm}</span>
00058 <span class="preprocessor"></span>
<a name="l00059"></a><a class="code" href="../../d2/d1/userexts_8c.html#a71">00059</a> <span class="keyword">extern</span> ULONG_PTR <a class="code" href="../../d3/d6/kdexts_8c.html#a10">UserProbeAddress</a>;
<a name="l00060"></a><a class="code" href="../../d2/d1/userexts_8c.html#a72">00060</a> <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a>; <span class="comment">// indentation of !dso</span>
00061 <span class="comment">/***************************************************************************\</span>
00062 <span class="comment">* Macros</span>
00063 <span class="comment">\***************************************************************************/</span>
00064 
<a name="l00065"></a><a class="code" href="../../d2/d1/userexts_8c.html#a4">00065</a> <span class="preprocessor">#define NELEM(array) (sizeof(array)/sizeof(array[0]))</span>
00066 <span class="preprocessor"></span>
00067 <span class="preprocessor">#ifdef KERNEL // ########### KERNEL MODE ONLY MACROS ###############</span>
00068 <span class="preprocessor"></span>
00069 <span class="preprocessor">#define VAR(v)  "win32k!" #v</span>
00070 <span class="preprocessor"></span><span class="preprocessor">#define FIXKP(p) p</span>
00071 <span class="preprocessor"></span><span class="preprocessor">#define RebaseSharedPtr(p)       (p)</span>
00072 <span class="preprocessor"></span>
00073 <span class="preprocessor">#define FOREACHWINDOWSTATION(pwinsta)           \</span>
00074 <span class="preprocessor">    moveExpValuePtr(&amp;pwinsta, VAR(grpWinStaList)); \</span>
00075 <span class="preprocessor">    SAFEWHILE (pwinsta != NULL) {</span>
00076 <span class="preprocessor"></span>
00077 <span class="preprocessor">#define NEXTEACHWINDOWSTATION(pwinsta)          \</span>
00078 <span class="preprocessor">        move(pwinsta, &amp;pwinsta-&gt;rpwinstaNext);  \</span>
00079 <span class="preprocessor">    }</span>
00080 <span class="preprocessor"></span>
00081 
00082 
00083 <span class="preprocessor">#define FOREACHDESKTOP(pdesk)                       \</span>
00084 <span class="preprocessor">    {                                               \</span>
00085 <span class="preprocessor">        WINDOWSTATION *pwinsta;                     \</span>
00086 <span class="preprocessor">                                                    \</span>
00087 <span class="preprocessor">        FOREACHWINDOWSTATION(pwinsta)               \</span>
00088 <span class="preprocessor">        move(pdesk, &amp;pwinsta-&gt;rpdeskList);          \</span>
00089 <span class="preprocessor">        SAFEWHILE (pdesk != NULL) {</span>
00090 <span class="preprocessor"></span>
00091 <span class="preprocessor">#define NEXTEACHDESKTOP(pdesk)                      \</span>
00092 <span class="preprocessor">            move(pdesk, &amp;pdesk-&gt;rpdeskNext);        \</span>
00093 <span class="preprocessor">        }                                           \</span>
00094 <span class="preprocessor">        NEXTEACHWINDOWSTATION(pwinsta)              \</span>
00095 <span class="preprocessor">    }</span>
00096 <span class="preprocessor"></span>
00097 
00098 
00099 <span class="preprocessor">#define FOREACHPPI(ppi)                                              \</span>
00100 <span class="preprocessor">    {                                                                \</span>
00101 <span class="preprocessor">    PLIST_ENTRY ProcessHead;                                         \</span>
00102 <span class="preprocessor">    LIST_ENTRY List;                                                 \</span>
00103 <span class="preprocessor">    PLIST_ENTRY NextProcess;                                         \</span>
00104 <span class="preprocessor">    PEPROCESS pEProcess;                                             \</span>
00105 <span class="preprocessor">    PW32PROCESS pW32Process;                                         \</span>
00106 <span class="preprocessor">                                                                     \</span>
00107 <span class="preprocessor">    ProcessHead = EvalExp( "PsActiveProcessHead" );                  \</span>
00108 <span class="preprocessor">    if (!ProcessHead) {                                              \</span>
00109 <span class="preprocessor">        Print("Unable to get value of PsActiveProcessHead\n");       \</span>
00110 <span class="preprocessor">        return FALSE;                                                \</span>
00111 <span class="preprocessor">    }                                                                \</span>
00112 <span class="preprocessor">                                                                     \</span>
00113 <span class="preprocessor">    if (!tryMove(List, ProcessHead)) {                               \</span>
00114 <span class="preprocessor">        Print("Unable to get value of PsActiveProcessHead\n");       \</span>
00115 <span class="preprocessor">        return FALSE;                                                \</span>
00116 <span class="preprocessor">    }                                                                \</span>
00117 <span class="preprocessor">    NextProcess = List.Flink;                                        \</span>
00118 <span class="preprocessor">    if (NextProcess == NULL) {                                       \</span>
00119 <span class="preprocessor">        Print("PsActiveProcessHead-&gt;Flink is NULL!\n");              \</span>
00120 <span class="preprocessor">        return FALSE;                                                \</span>
00121 <span class="preprocessor">    }                                                                \</span>
00122 <span class="preprocessor">                                                                     \</span>
00123 <span class="preprocessor">    SAFEWHILE(NextProcess != ProcessHead) {                          \</span>
00124 <span class="preprocessor">        pEProcess = GetEProcessData((PEPROCESS)NextProcess,          \</span>
00125 <span class="preprocessor">                                    PROCESS_PROCESSHEAD,             \</span>
00126 <span class="preprocessor">                                    NULL);                           \</span>
00127 <span class="preprocessor">                                                                     \</span>
00128 <span class="preprocessor">        if (GetEProcessData(pEProcess, PROCESS_PROCESSLINK,          \</span>
00129 <span class="preprocessor">                &amp;List) == NULL) {                                    \</span>
00130 <span class="preprocessor">            Print("Unable to read _EPROCESS at %lx\n",pEProcess);    \</span>
00131 <span class="preprocessor">            break;                                                   \</span>
00132 <span class="preprocessor">        }                                                            \</span>
00133 <span class="preprocessor">        NextProcess = List.Flink;                                    \</span>
00134 <span class="preprocessor">                                                                     \</span>
00135 <span class="preprocessor">        if (GetEProcessData(pEProcess, PROCESS_WIN32PROCESS,         \</span>
00136 <span class="preprocessor">                &amp;pW32Process) == NULL || pW32Process == NULL) {      \</span>
00137 <span class="preprocessor">            continue;                                                \</span>
00138 <span class="preprocessor">        }                                                            \</span>
00139 <span class="preprocessor">                                                                     \</span>
00140 <span class="preprocessor">        ppi = (PPROCESSINFO)pW32Process;</span>
00141 <span class="preprocessor"></span>
00142 
00143 <span class="preprocessor">#define NEXTEACHPPI() } }</span>
00144 <span class="preprocessor"></span>
00145 
00146 
00147 <span class="preprocessor">#define FOREACHPTI(pti) {                                            \</span>
00148 <span class="preprocessor">    PPROCESSINFO ppi;                                                \</span>
00149 <span class="preprocessor">                                                                     \</span>
00150 <span class="preprocessor">    FOREACHPPI(ppi)                                                  \</span>
00151 <span class="preprocessor">        if (!tryMove(pti, &amp;ppi-&gt;ptiList)) {                          \</span>
00152 <span class="preprocessor">            DEBUGPRINT("FOREACHPTI:Cant get ptiList from %x.\n", &amp;ppi-&gt;ptiList); \</span>
00153 <span class="preprocessor">        }                                                            \</span>
00154 <span class="preprocessor">        SAFEWHILE (pti != NULL) {</span>
00155 <span class="preprocessor"></span>
00156 
00157 <span class="preprocessor">#define NEXTEACHPTI(pti)                                                  \</span>
00158 <span class="preprocessor">            if (!tryMove(pti, &amp;pti-&gt;ptiSibling)) {                        \</span>
00159 <span class="preprocessor">                DEBUGPRINT("NEXTEACHPTI:Can't get ptiSibling from %x.\n", \</span>
00160 <span class="preprocessor">                            &amp;pti-&gt;ptiSibling);                            \</span>
00161 <span class="preprocessor">                pti = NULL;                                               \</span>
00162 <span class="preprocessor">            }                                                             \</span>
00163 <span class="preprocessor">        }                                                                 \</span>
00164 <span class="preprocessor">    NEXTEACHPPI()  }</span>
00165 <span class="preprocessor"></span>
00166 
00167 <span class="preprocessor">#else </span>
00168 <span class="preprocessor"></span>
00169 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="../../d2/d1/userexts_8c.html#a187">PrivateSetRipFlags</a>(DWORD dwRipFlags, DWORD pid);
00170 
<a name="l00171"></a><a class="code" href="../../d2/d1/userexts_8c.html#a5">00171</a> <span class="preprocessor">#define VAR(v)  "user32!" #v</span>
<a name="l00172"></a><a class="code" href="../../d2/d1/userexts_8c.html#a6">00172</a> <span class="preprocessor"></span><span class="preprocessor">#define FIXKP(p) FixKernelPointer(p)</span>
00173 <span class="preprocessor"></span>
00174 <span class="preprocessor">#endif </span>
00175 <span class="preprocessor"></span>
<a name="l00176"></a><a class="code" href="../../d2/d1/userexts_8c.html#a7">00176</a> <span class="preprocessor"></span><span class="preprocessor">#define GETSHAREDINFO(psi) moveExp(&amp;psi, VAR(gSharedInfo))</span>
00177 <span class="preprocessor"></span>
<a name="l00178"></a><a class="code" href="../../d2/d1/userexts_8c.html#a8">00178</a> <span class="preprocessor">#define FOREACHHANDLEENTRY(phe, he, i)                               \</span>
00179 <span class="preprocessor">    {                                                                \</span>
00180 <span class="preprocessor">        PSHAREDINFO pshi;                                            \</span>
00181 <span class="preprocessor">        SHAREDINFO shi;                                              \</span>
00182 <span class="preprocessor">        SERVERINFO si;                                               \</span>
00183 <span class="preprocessor">                                                                     \</span>
00184 <span class="preprocessor">        GETSHAREDINFO(pshi);                                         \</span>
00185 <span class="preprocessor">        if (!tryMove(shi, pshi)) {                                   \</span>
00186 <span class="preprocessor">            Print("FOREACHHANDLEENTRY:Could not get SHAREDINFO.\n"); \</span>
00187 <span class="preprocessor">            return FALSE;                                           \</span>
00188 <span class="preprocessor">        }                                                            \</span>
00189 <span class="preprocessor">        if (!tryMove(si, shi.psi)) {                                 \</span>
00190 <span class="preprocessor">            Print("FOREACHHANDLEENTRY:Could not get SERVERINFO.\n"); \</span>
00191 <span class="preprocessor">        }                                                            \</span>
00192 <span class="preprocessor">        phe = shi.aheList;                                           \</span>
00193 <span class="preprocessor">        for (i = 0; si.cHandleEntries; si.cHandleEntries--, i++, phe++) { \</span>
00194 <span class="preprocessor">            if (IsCtrlCHit()) {                                      \</span>
00195 <span class="preprocessor">                break;                                               \</span>
00196 <span class="preprocessor">            }                                                        \</span>
00197 <span class="preprocessor">            if (!tryMove(he, phe)) {                                 \</span>
00198 <span class="preprocessor">                Print("FOREACHHANDLEENTRY:Cant get handle entry from %x.\n", phe); \</span>
00199 <span class="preprocessor">                continue;                                            \</span>
00200 <span class="preprocessor">            }</span>
00201 <span class="preprocessor"></span>
<a name="l00202"></a><a class="code" href="../../d2/d1/userexts_8c.html#a9">00202</a> <span class="preprocessor">#define NEXTEACHHANDLEENTRY()                                        \</span>
00203 <span class="preprocessor">        }                                                            \</span>
00204 <span class="preprocessor">    }</span>
00205 <span class="preprocessor"></span>
00206 
<a name="l00207"></a><a class="code" href="../../d2/d1/userexts_8c.html#a10">00207</a> <span class="preprocessor">#define DUMPHOOKS(s, hk)   \</span>
00208 <span class="preprocessor">    if (di.aphkStart[hk + 1]) { \</span>
00209 <span class="preprocessor">        Print("\t" s " @0x%p\n", di.aphkStart[hk + 1]); \</span>
00210 <span class="preprocessor">        SAFEWHILE (di.aphkStart[hk + 1]) { \</span>
00211 <span class="preprocessor">            move(hook, di.aphkStart[hk + 1]); \</span>
00212 <span class="preprocessor">            if (di.aphkStart[hk + 1] == hook.phkNext) \</span>
00213 <span class="preprocessor">                break; \</span>
00214 <span class="preprocessor">            di.aphkStart[hk + 1] = hook.phkNext; \</span>
00215 <span class="preprocessor">            Print("\t  iHook %d, offPfn=0x%08lx, flags=0x%04lx, ihmod=%d\n", \</span>
00216 <span class="preprocessor">                    hook.iHook, hook.offPfn, hook.flags, hook.ihmod); \</span>
00217 <span class="preprocessor">        } \</span>
00218 <span class="preprocessor">    }</span>
00219 <span class="preprocessor"></span>
<a name="l00220"></a><a class="code" href="../../d2/d1/userexts_8c.html#a11">00220</a> <span class="preprocessor">#define DUMPLHOOKS(s, hk)   \</span>
00221 <span class="preprocessor">    if (ti.aphkStart[hk + 1]) { \</span>
00222 <span class="preprocessor">        Print("\t" s " @0x%p\n", ti.aphkStart[hk + 1]); \</span>
00223 <span class="preprocessor">        SAFEWHILE (ti.aphkStart[hk + 1]) { \</span>
00224 <span class="preprocessor">            move(hook, ti.aphkStart[hk + 1]); \</span>
00225 <span class="preprocessor">            if (ti.aphkStart[hk + 1] == hook.phkNext) \</span>
00226 <span class="preprocessor">                break; \</span>
00227 <span class="preprocessor">            ti.aphkStart[hk + 1] = hook.phkNext; \</span>
00228 <span class="preprocessor">            Print("\t  iHook %d, offPfn=0x%08lx, flags=0x%04lx, ihmod=%d\n", \</span>
00229 <span class="preprocessor">                    hook.iHook, hook.offPfn, hook.flags, hook.ihmod); \</span>
00230 <span class="preprocessor">        } \</span>
00231 <span class="preprocessor">    }</span>
00232 <span class="preprocessor"></span>
00233 
00234 <span class="comment">/*</span>
00235 <span class="comment"> * Use these macros to print field values, globals, local values, etc.</span>
00236 <span class="comment"> * This assures consistent formating plus make the extensions easier to read and to maintain.</span>
00237 <span class="comment"> */</span>
<a name="l00238"></a><a class="code" href="../../d2/d1/userexts_8c.html#a12">00238</a> <span class="preprocessor">#define STRWD1 "67"</span>
<a name="l00239"></a><a class="code" href="../../d2/d1/userexts_8c.html#a13">00239</a> <span class="preprocessor"></span><span class="preprocessor">#define STRWD2 "28"</span>
<a name="l00240"></a><a class="code" href="../../d2/d1/userexts_8c.html#a14">00240</a> <span class="preprocessor"></span><span class="preprocessor">#define DWSTR1 "%08lx %." STRWD1 "s"</span>
<a name="l00241"></a><a class="code" href="../../d2/d1/userexts_8c.html#a15">00241</a> <span class="preprocessor"></span><span class="preprocessor">#define DWSTR2 "%08lx %-" STRWD2 "." STRWD2 "s"</span>
<a name="l00242"></a><a class="code" href="../../d2/d1/userexts_8c.html#a16">00242</a> <span class="preprocessor"></span><span class="preprocessor">#define DWPSTR1 "%p %." STRWD1 "s"</span>
<a name="l00243"></a><a class="code" href="../../d2/d1/userexts_8c.html#a17">00243</a> <span class="preprocessor"></span><span class="preprocessor">#define DWPSTR2 "%p %-" STRWD2 "." STRWD2 "s"</span>
<a name="l00244"></a><a class="code" href="../../d2/d1/userexts_8c.html#a18">00244</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTFDW1(p, f1) Print(DWSTR1 "\n", (DWORD)##p##f1, #f1)</span>
<a name="l00245"></a><a class="code" href="../../d2/d1/userexts_8c.html#a19">00245</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTVDW1(s1, v1) Print(DWSTR1 "\n", v1, #s1)</span>
<a name="l00246"></a><a class="code" href="../../d2/d1/userexts_8c.html#a20">00246</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTFDW2(p, f1, f2) Print(DWSTR2 "\t" DWSTR2 "\n", (DWORD)##p##f1, #f1, (DWORD)##p##f2, #f2)</span>
<a name="l00247"></a><a class="code" href="../../d2/d1/userexts_8c.html#a21">00247</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTVDW2(s1, v1, s2, v2) Print(DWSTR2 "\t" DWSTR2 "\n", v1, #s1, v2, #s2)</span>
<a name="l00248"></a><a class="code" href="../../d2/d1/userexts_8c.html#a22">00248</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTFRC(p, rc) Print("%-" STRWD2 "s{%#lx, %#lx, %#lx, %#lx}\n", #rc, ##p##rc.left, ##p##rc.top, ##p##rc.right, ##p##rc.bottom)</span>
<a name="l00249"></a><a class="code" href="../../d2/d1/userexts_8c.html#a23">00249</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTFPT(p, pt) Print("%-" STRWD2 "s{%#lx, %#lx}\n", #pt, ##p##pt.x, ##p##pt.y)</span>
<a name="l00250"></a><a class="code" href="../../d2/d1/userexts_8c.html#a24">00250</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTVPT(s, pt) Print("%-" STRWD2 "s{%#lx, %#lx}\n", #s, pt.x, pt.y)</span>
<a name="l00251"></a><a class="code" href="../../d2/d1/userexts_8c.html#a25">00251</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTFDWP1(p, f1) Print(DWPSTR1 "\n", (DWORD_PTR)##p##f1, #f1)</span>
<a name="l00252"></a><a class="code" href="../../d2/d1/userexts_8c.html#a26">00252</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTFDWP2(p, f1, f2) Print(DWPSTR2 "\t" DWPSTR2 "\n", (DWORD_PTR)##p##f1, #f1, (DWORD_PTR)##p##f2, #f2)</span>
<a name="l00253"></a><a class="code" href="../../d2/d1/userexts_8c.html#a27">00253</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTFDWPDW(p, f1, f2) Print(DWPSTR2 "\t" DWSTR2 "\n", (DWORD_PTR)##p##f1, #f1, (DWORD)##p##f2, #f2)</span>
<a name="l00254"></a><a class="code" href="../../d2/d1/userexts_8c.html#a28">00254</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTFDWDWP(p, f1, f2) Print(DWSTR2 "\t" DWPSTR2 "\n", (DWORD)##p##f1, #f1, (DWORD_PTR)##p##f2, #f2)</span>
00255 <span class="preprocessor"></span>
00256 <span class="comment">/*</span>
00257 <span class="comment"> * Bit Fields</span>
00258 <span class="comment"> */</span>
<a name="l00259"></a><a class="code" href="../../d2/d1/userexts_8c.html#a29">00259</a> <span class="preprocessor">#define BEGIN_PRTFFLG()</span>
<a name="l00260"></a><a class="code" href="../../d2/d1/userexts_8c.html#a30">00260</a> <span class="preprocessor"></span><span class="preprocessor">#define PRTFFLG(p, f)   PrintBitField(#f, (BOOLEAN)!!(p.f))</span>
<a name="l00261"></a><a class="code" href="../../d2/d1/userexts_8c.html#a31">00261</a> <span class="preprocessor"></span><span class="preprocessor">#define END_PRTFFLG()   PrintEndBitField()</span>
00262 <span class="preprocessor"></span>
<a name="l00263"></a><a class="code" href="../../d2/d1/userexts_8c.html#a32">00263</a> <span class="preprocessor">#define PRTGDW1(g1) \</span>
00264 <span class="preprocessor">        { DWORD _dw1; \</span>
00265 <span class="preprocessor">            moveExpValue(&amp;_dw1, VAR(g1)); \</span>
00266 <span class="preprocessor">            Print(DWSTR1 "\n", _dw1, #g1); }</span>
00267 <span class="preprocessor"></span>
<a name="l00268"></a><a class="code" href="../../d2/d1/userexts_8c.html#a33">00268</a> <span class="preprocessor">#define PRTGDW2(g1, g2) \</span>
00269 <span class="preprocessor">        { DWORD _dw1, _dw2; \</span>
00270 <span class="preprocessor">            moveExpValue(&amp;_dw1, VAR(g1)); \</span>
00271 <span class="preprocessor">            moveExpValue(&amp;_dw2, VAR(g2)); \</span>
00272 <span class="preprocessor">            Print(DWSTR2 "\t" DWSTR2 "\n",  _dw1, #g1, _dw2, #g2); }</span>
00273 <span class="preprocessor"></span>
00274 <span class="comment">/* This macro requires char ach[80]; to be previously defined */</span>
<a name="l00275"></a><a class="code" href="../../d2/d1/userexts_8c.html#a34">00275</a> <span class="preprocessor">#define PRTWND(s, pwnd) \</span>
00276 <span class="preprocessor">        { DebugGetWindowTextA(pwnd, ach); \</span>
00277 <span class="preprocessor">            Print("%-" STRWD2 "s" DWSTR2 "\n", #s, pwnd, ach); }</span>
00278 <span class="preprocessor"></span>
<a name="l00279"></a><a class="code" href="../../d2/d1/userexts_8c.html#a35">00279</a> <span class="preprocessor">#define PRTGWND(gpwnd) \</span>
00280 <span class="preprocessor">        { PWND _pwnd; \</span>
00281 <span class="preprocessor">            moveExpValuePtr(&amp;_pwnd, VAR(gpwnd)); \</span>
00282 <span class="preprocessor">            DebugGetWindowTextA(_pwnd, ach); \</span>
00283 <span class="preprocessor">            Print("%-" STRWD2 "s" DWSTR2 "\n", #gpwnd, _pwnd, ach); }</span>
00284 <span class="preprocessor"></span>
00285 <span class="comment">/****************************************************************************\</span>
00286 <span class="comment">* PROTOTYPES</span>
00287 <span class="comment">*  Note that all Ixxx proc prototypes are generated by stdexts.h</span>
00288 <span class="comment">\****************************************************************************/</span>
00289 <span class="preprocessor">#ifdef KERNEL</span>
00290 <span class="preprocessor"></span>
00291 <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> DummyGetCurrentThreadAddress(USHORT Processor, HANDLE hCurrentThread);
00292 <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> GetCurrentProcessAddress(DWORD Processor, HANDLE hCurrentThread, <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> CurrentThread);
00293 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> PrintMessages(<a class="code" href="../../d8/d4/structtagQMSG.html">PQMSG</a> pqmsgRead);
00294 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a203">GetAndDumpHE</a>(ULONG_PTR dwT, <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">PHE</a> phe, BOOL fPointerTest);
00295 LPSTR <a class="code" href="../../d7/d7/uclient_8c.html#a2">ProcessName</a>(<a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a> ppi);
00296 
00297 <span class="preprocessor">#else // !KERNEL</span>
00298 <span class="preprocessor"></span>
00299 PVOID <a class="code" href="../../d2/d1/userexts_8c.html#a188">FixKernelPointer</a>(PVOID pKernel);
00300 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a189">DumpConvInfo</a>(<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a> pcoi);
00301 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a190">GetTargetTEB</a>(PTEB pteb, PTEB *ppteb);
00302 
00303 <span class="preprocessor">#endif // !KERNEL</span>
00304 <span class="preprocessor"></span>
00305 LPSTR <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(WORD wType, DWORD dwFlags, LPSTR pszBuf, BOOL fPrintZero);
00306 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a192">HtoHE</a>(ULONG_PTR h, <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> *phe, <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> **pphe);
00307 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a193">dbgPtoH</a>(PVOID p, ULONG_PTR *ph);
00308 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a194">dbgHtoP</a>(DWORD h, PVOID *pp);
00309 PVOID <a class="code" href="../../d2/d1/userexts_8c.html#a195">GetPfromH</a>(ULONG_PTR h, <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> **pphe, <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> *phe);
00310 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a196">getHEfromP</a>(<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> **pphe, <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> *phe, PVOID p);
00311 PVOID <a class="code" href="../../d2/d1/userexts_8c.html#a197">HorPtoP</a>(PVOID p, <span class="keywordtype">int</span> type);
00312 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <span class="keywordtype">char</span> *achDest);
00313 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a199">DebugGetClassNameA</a>(LPSTR lpszClassName, <span class="keywordtype">char</span> *achDest);
00314 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a200">dwrWorker</a>(<a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, <span class="keywordtype">int</span> tab);
00315 
<a name="l00316"></a><a class="code" href="../../d2/d1/userexts_8c.html#a201">00316</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a201">IsRemoteSession</a>(VOID)
00317 {
00318     PPEB ppeb;
00319 
00320     ppeb = NtCurrentPeb();
00321 
00322     <span class="keywordflow">return</span> (ppeb-&gt;SessionId != 0);
00323 }
00324 
00325 <span class="comment">/****************************************************************************\</span>
00326 <span class="comment">* Flags stuff</span>
00327 <span class="comment">\****************************************************************************/</span>
00328 
<a name="l00329"></a><a class="code" href="../../d3/d8/struct__WFLAGS.html">00329</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d3/d8/struct__WFLAGS.html">_WFLAGS</a> {
<a name="l00330"></a><a class="code" href="../../d3/d8/struct__WFLAGS.html#o0">00330</a>     PSZ     <a class="code" href="../../d3/d8/struct__WFLAGS.html#o0">pszText</a>;
<a name="l00331"></a><a class="code" href="../../d3/d8/struct__WFLAGS.html#o1">00331</a>     WORD    <a class="code" href="../../d3/d8/struct__WFLAGS.html#o1">wFlag</a>;
00332 } <a class="code" href="../../d3/d8/struct__WFLAGS.html">WFLAGS</a>;
00333 
<a name="l00334"></a><a class="code" href="../../d2/d1/userexts_8c.html#a36">00334</a> <span class="preprocessor">#define WF_ENTRY(flag)  #flag, flag</span>
00335 <span class="preprocessor"></span>
<a name="l00336"></a><a class="code" href="../../d2/d1/userexts_8c.html#a74">00336</a> <a class="code" href="../../d3/d8/struct__WFLAGS.html">WFLAGS</a> <a class="code" href="../../d2/d1/userexts_8c.html#a74">aWindowFlags</a>[] = { <span class="comment">// sorted alphabetically</span>
00337     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a662">BFBITMAP</a>),
00338     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a669">BFBOTTOM</a>),
00339     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a666">BFCENTER</a>),
00340     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a676">BFFLAT</a>),
00341     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a661">BFICON</a>),
00342     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a664">BFLEFT</a>),
00343     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a674">BFMULTILINE</a>),
00344     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a675">BFNOTIFY</a>),
00345     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a673">BFPUSHLIKE</a>),
00346     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a665">BFRIGHT</a>),
00347     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a660">BFRIGHTBUTTON</a>),
00348     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a668">BFTOP</a>),
00349     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a670">BFVCENTER</a>),
00350     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a686">CBFAUTOHSCROLL</a>),
00351     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a692">CBFBUTTONUPTRACK</a>),
00352     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a691">CBFDISABLENOSCROLL</a>),
00353     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a678">CBFDROPDOWN</a>),
00354     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a679">CBFDROPDOWNLIST</a>),
00355     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a681">CBFDROPPABLE</a>),
00356     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a682">CBFDROPTYPE</a>),
00357     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a680">CBFEDITABLE</a>),
00358     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a689">CBFHASSTRINGS</a>),
00359     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a694">CBFLOWERCASE</a>),
00360     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a690">CBFNOINTEGRALHEIGHT</a>),
00361     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a687">CBFOEMCONVERT</a>),
00362     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a685">CBFOWNERDRAW</a>),
00363     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a683">CBFOWNERDRAWFIXED</a>),
00364     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a684">CBFOWNERDRAWVAR</a>),
00365     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a677">CBFSIMPLE</a>),
00366     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a688">CBFSORT</a>),
00367     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a693">CBFUPPERCASE</a>),
00368     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a696">DF3DLOOK</a>),
00369     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a700">DFCONTROL</a>),
00370     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a698">DFLOCALEDIT</a>),
00371     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a697">DFNOFAILCREATE</a>),
00372     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a695">DFSYSMODAL</a>),
00373     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a706">EFAUTOHSCROLL</a>),
00374     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a705">EFAUTOVSCROLL</a>),
00375     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a708">EFCOMBOBOX</a>),
00376     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a703">EFLOWERCASE</a>),
00377     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a701">EFMULTILINE</a>),
00378     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a707">EFNOHIDESEL</a>),
00379     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a712">EFNUMBER</a>),
00380     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a709">EFOEMCONVERT</a>),
00381     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a704">EFPASSWORD</a>),
00382     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a710">EFREADONLY</a>),
00383     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a702">EFUPPERCASE</a>),
00384     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a711">EFWANTRETURN</a>),
00385     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a715">SBFSIZEBOX</a>),
00386     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a714">SBFSIZEBOXBOTTOMRIGHT</a>),
00387     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a713">SBFSIZEBOXTOPLEFT</a>),
00388     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a716">SBFSIZEGRIP</a>),
00389     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a720">SFCENTERIMAGE</a>),
00390     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a724">SFEDITCONTROL</a>),
00391     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a725">SFELLIPSISMASK</a>),
00392     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a718">SFNOPREFIX</a>),
00393     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a719">SFNOTIFY</a>),
00394     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a722">SFREALSIZEIMAGE</a>),
00395     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a721">SFRIGHTJUST</a>),
00396     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a723">SFSUNKEN</a>),
00397     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a616">WEFACCEPTFILES</a>),
00398     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a629">WEFAPPWINDOW</a>),
00399     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a621">WEFCLIENTEDGE</a>),
00400     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a623">WEFCONTEXTHELP</a>),
00401     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a627">WEFCONTROLPARENT</a>),
00402     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a612">WEFDLGMODALFRAME</a>),
00403     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a613">WEFDRAGOBJECT</a>),
00404     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a626">WEFLEFTSCROLL</a>),
00405     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a618">WEFMDICHILD</a>),
00406     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d1/d0/inc_2user_8h.html#a624">WEFNOACTIVATE</a>),
00407     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a614">WEFNOPARENTNOTIFY</a>),
00408     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a624">WEFRIGHT</a>),
00409     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a625">WEFRTLREADING</a>),
00410     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a628">WEFSTATICEDGE</a>),
00411     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d1/d0/inc_2user_8h.html#a621">WEFLAYERED</a>),
00412     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a619">WEFTOOLWINDOW</a>),
00413     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a615">WEFTOPMOST</a>),
00414     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a617">WEFTRANSPARENT</a>),
00415     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d1/d0/inc_2user_8h.html#a598">WEFTRUNCATEDCAPTION</a>),
00416     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a620">WEFWINDOWEDGE</a>),
00417     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a607">WFALWAYSSENDNCPAINT</a>),
00418     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a581">WFANSICREATOR</a>),
00419     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a570">WFANSIPROC</a>),
00420     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a580">WFANYHUNGREDRAW</a>),
00421     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a571">WFBEINGACTIVATED</a>),
00422     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a644">WFBORDER</a>),
00423     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a589">WFBOTTOMMOST</a>),
00424     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a646">WFCAPTION</a>),
00425     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a588">WFCEPRESENT</a>),
00426     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a654">WFCHILD</a>),
00427     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a649">WFCLIPCHILDREN</a>),
00428     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a650">WFCLIPSIBLINGS</a>),
00429     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a597">WFCLOSEBUTTONDOWN</a>),
00430     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a553">WFCPRESENT</a>),
00431     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a583">WFDESTROYED</a>),
00432     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a567">WFDIALOGWINDOW</a>),
00433     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a651">WFDISABLED</a>),
00434     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a642">WFDLGFRAME</a>),
00435     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a585">WFDONTVALIDATE</a>),
00436     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a561">WFERASEBKGND</a>),
00437     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a557">WFFRAMEON</a>),
00438     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a590">WFFULLSCREEN</a>),
00439     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a575">WFGOTQUERYSUSPENDMSG</a>),
00440     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a576">WFGOTSUSPENDMSG</a>),
00441     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a637">WFGROUP</a>),
00442     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a572">WFHASPALETTE</a>),
00443     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a558">WFHASSPB</a>),
00444     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a600">WFHELPBUTTONDOWN</a>),
00445     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a565">WFHIDDENPOPUP</a>),
00446     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a552">WFHPRESENT</a>),
00447     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a640">WFHSCROLL</a>),
00448     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a657">WFICONICPOPUP</a>),
00449     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a591">WFINDESTROY</a>),
00450     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a563">WFINTERNALPAINT</a>),
00451     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a604">WFLINEDNBUTTONDOWN</a>),
00452     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a601">WFLINEUPBUTTONDOWN</a>),
00453     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a634">WFMAXBOX</a>),
00454     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a596">WFMAXFAKEREGIONAL</a>),
00455     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a648">WFMAXIMIZED</a>),
00456     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a566">WFMENUDRAW</a>),
00457     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a636">WFMINBOX</a>),
00458     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a653">WFMINIMIZED</a>),
00459     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a550">WFMPRESENT</a>),
00460     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a556">WFMSGBOX</a>),
00461     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a631">WFNOANIMATE</a>),
00462     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a699">WFNOIDLEMSG</a>),
00463     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a559">WFNONCPAINT</a>),
00464     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a587">WFOLDUI</a>),
00465     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a602">WFPAGEUPBUTTONDOWN</a>),
00466     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a603">WFPAGEDNBUTTONDOWN</a>),
00467     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a573">WFPAINTNOTPROCESSED</a>),
00468     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a608">WFPIXIEHACK</a>),
00469     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a655">WFPOPUP</a>),
00470     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a582">WFREALLYMAXIMIZABLE</a>),
00471     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a579">WFREDRAWFRAMEIFHUNG</a>),
00472     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a578">WFREDRAWIFHUNG</a>),
00473     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a599">WFREDUCEBUTTONDOWN</a>),
00474     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a605">WFSCROLLBUTTONDOWN</a>),
00475     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a560">WFSENDERASEBKGND</a>),
00476     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a562">WFSENDNCPAINT</a>),
00477     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a555">WFSENDSIZEMOVE</a>),
00478     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a569">WFSERVERSIDEPROC</a>),
00479     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a633">WFSHELLHOOKWND</a>),
00480     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a638">WFSIZEBOX</a>),
00481     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a632">WFSMQUERYDRAGICON</a>),
00482     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a586">WFSTARTPAINT</a>),
00483     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a574">WFSYNCPAINTPENDING</a>),
00484     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a639">WFSYSMENU</a>),
00485     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a635">WFTABSTOP</a>),
00486     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a647">WFTILED</a>),
00487     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a568">WFTITLESET</a>),
00488     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a577">WFTOGGLETOPMOST</a>),
00489     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a643">WFTOPLEVEL</a>),
00490     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a564">WFUPDATEDIRTY</a>),
00491     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a606">WFVERTSCROLLTRACK</a>),
00492     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a652">WFVISIBLE</a>),
00493     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a551">WFVPRESENT</a>),
00494     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a641">WFVSCROLL</a>),
00495     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a592">WFWIN31COMPAT</a>),
00496     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>),
00497     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a594">WFWIN50COMPAT</a>),
00498     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a584">WFWMPAINTSENT</a>),
00499     <a class="code" href="../../d2/d1/userexts_8c.html#a36">WF_ENTRY</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a598">WFZOOMBUTTONDOWN</a>),
00500 };
00501 
<a name="l00502"></a><a class="code" href="../../d2/d1/userexts_8c.html#a75">00502</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a75">aszTypeNames</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>] = {
00503     <span class="stringliteral">"Free"</span>,
00504     <span class="stringliteral">"Window"</span>,
00505     <span class="stringliteral">"Menu"</span>,
00506     <span class="stringliteral">"Icon/Cursor"</span>,
00507     <span class="stringliteral">"WPI(SWP) struct"</span>,
00508     <span class="stringliteral">"Hook"</span>,
00509     <span class="stringliteral">"Clipboard Data"</span>,
00510     <span class="stringliteral">"CallProcData"</span>,
00511     <span class="stringliteral">"Accelerator"</span>,
00512     <span class="stringliteral">"DDE access"</span>,
00513     <span class="stringliteral">"DDE conv"</span>,
00514     <span class="stringliteral">"DDE Transaction"</span>,
00515     <span class="stringliteral">"Monitor"</span>,
00516     <span class="stringliteral">"Keyboard Layout"</span>,
00517     <span class="stringliteral">"Keyboard File"</span>,
00518     <span class="stringliteral">"WinEvent hook"</span>,
00519     <span class="stringliteral">"Timer"</span>,
00520     <span class="stringliteral">"Input Context"</span>,
00521 };
00522 
00523 <span class="preprocessor">#include "ptagdbg.h"</span>   <span class="comment">// derived from ntuser\kernel\ptag.lst and .\ptagdbg.bat</span>
00524 
<a name="l00525"></a><a class="code" href="../../d2/d1/userexts_8c.html#a37">00525</a> <span class="preprocessor">#define NO_FLAG (LPCSTR)(LONG_PTR)0xFFFFFFFF  // use this for non-meaningful entries.</span>
<a name="l00526"></a><a class="code" href="../../d2/d1/userexts_8c.html#a38">00526</a> <span class="preprocessor"></span><span class="preprocessor">#define _MASKENUM_START         (NO_FLAG-1)</span>
<a name="l00527"></a><a class="code" href="../../d2/d1/userexts_8c.html#a39">00527</a> <span class="preprocessor"></span><span class="preprocessor">#define _MASKENUM_END           (NO_FLAG-2)</span>
<a name="l00528"></a><a class="code" href="../../d2/d1/userexts_8c.html#a40">00528</a> <span class="preprocessor"></span><span class="preprocessor">#define _SHIFT_BITS             (NO_FLAG-3)</span>
<a name="l00529"></a><a class="code" href="../../d2/d1/userexts_8c.html#a41">00529</a> <span class="preprocessor"></span><span class="preprocessor">#define _CONTINUE_ON            (NO_FLAG-4)</span>
00530 <span class="preprocessor"></span>
<a name="l00531"></a><a class="code" href="../../d2/d1/userexts_8c.html#a42">00531</a> <span class="preprocessor">#define MASKENUM_START(mask)    _MASKENUM_START, (LPCSTR)(mask)</span>
<a name="l00532"></a><a class="code" href="../../d2/d1/userexts_8c.html#a43">00532</a> <span class="preprocessor"></span><span class="preprocessor">#define MASKENUM_END(shift)     _MASKENUM_END, (LPCSTR)(shift)</span>
<a name="l00533"></a><a class="code" href="../../d2/d1/userexts_8c.html#a44">00533</a> <span class="preprocessor"></span><span class="preprocessor">#define SHIFT_BITS(n)           _SHIFT_BITS, (LPCSTR)(n)</span>
<a name="l00534"></a><a class="code" href="../../d2/d1/userexts_8c.html#a45">00534</a> <span class="preprocessor"></span><span class="preprocessor">#define CONTINUE_ON(arr)        _CONTINUE_ON, (LPCSTR)(arr)</span>
00535 <span class="preprocessor"></span>
<a name="l00536"></a><a class="code" href="../../d2/d1/userexts_8c.html#a76">00536</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a76">apszSmsFlags</a>[] = {
00537    <span class="stringliteral">"SMF_REPLY"</span>                , <span class="comment">// 0x0001</span>
00538    <span class="stringliteral">"SMF_RECEIVERDIED"</span>         , <span class="comment">// 0x0002</span>
00539    <span class="stringliteral">"SMF_SENDERDIED"</span>           , <span class="comment">// 0x0004</span>
00540    <span class="stringliteral">"SMF_RECEIVERFREE"</span>         , <span class="comment">// 0x0008</span>
00541    <span class="stringliteral">"SMF_RECEIVEDMESSAGE"</span>      , <span class="comment">// 0x0010</span>
00542     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x0020</span>
00543     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x0040</span>
00544     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x0080</span>
00545    <span class="stringliteral">"SMF_CB_REQUEST"</span>           , <span class="comment">// 0x0100</span>
00546    <span class="stringliteral">"SMF_CB_REPLY"</span>             , <span class="comment">// 0x0200</span>
00547    <span class="stringliteral">"SMF_CB_CLIENT"</span>            , <span class="comment">// 0x0400</span>
00548    <span class="stringliteral">"SMF_CB_SERVER"</span>            , <span class="comment">// 0x0800</span>
00549    <span class="stringliteral">"SMF_WOWRECEIVE"</span>           , <span class="comment">// 0x1000</span>
00550    <span class="stringliteral">"SMF_WOWSEND"</span>              , <span class="comment">// 0x2000</span>
00551    <span class="stringliteral">"SMF_RECEIVERBUSY"</span>         , <span class="comment">// 0x4000</span>
00552     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>                        <span class="comment">// 0x8000</span>
00553 };
00554 
<a name="l00555"></a><a class="code" href="../../d2/d1/userexts_8c.html#a77">00555</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a77">apszTifFlags</a>[] = {
00556    <span class="stringliteral">"TIF_INCLEANUP"</span>                   , <span class="comment">// 0x00000001</span>
00557    <span class="stringliteral">"TIF_16BIT"</span>                       , <span class="comment">// 0x00000002</span>
00558    <span class="stringliteral">"TIF_SYSTEMTHREAD"</span>                , <span class="comment">// 0x00000004</span>
00559    <span class="stringliteral">"TIF_CSRSSTHREAD"</span>                 , <span class="comment">// 0x00000008</span>
00560    <span class="stringliteral">"TIF_TRACKRECTVISIBLE"</span>            , <span class="comment">// 0x00000010</span>
00561    <span class="stringliteral">"TIF_ALLOWFOREGROUNDACTIVATE"</span>     , <span class="comment">// 0x00000020</span>
00562    <span class="stringliteral">"TIF_DONTATTACHQUEUE"</span>             , <span class="comment">// 0x00000040</span>
00563    <span class="stringliteral">"TIF_DONTJOURNALATTACH"</span>           , <span class="comment">// 0x00000080</span>
00564    <span class="stringliteral">"TIF_WOW64"</span>                       , <span class="comment">// 0x00000100</span>
00565    <span class="stringliteral">"TIF_INACTIVATEAPPMSG"</span>            , <span class="comment">// 0x00000200</span>
00566    <span class="stringliteral">"TIF_SPINNING"</span>                    , <span class="comment">// 0x00000400</span>
00567    <span class="stringliteral">"TIF_PALETTEAWARE"</span>                , <span class="comment">// 0x00000800</span>
00568    <span class="stringliteral">"TIF_SHAREDWOW"</span>                   , <span class="comment">// 0x00001000</span>
00569    <span class="stringliteral">"TIF_FIRSTIDLE"</span>                   , <span class="comment">// 0x00002000</span>
00570    <span class="stringliteral">"TIF_WAITFORINPUTIDLE"</span>            , <span class="comment">// 0x00004000</span>
00571    <span class="stringliteral">"TIF_MOVESIZETRACKING"</span>            , <span class="comment">// 0x00008000</span>
00572    <span class="stringliteral">"TIF_VDMAPP"</span>                      , <span class="comment">// 0x00010000</span>
00573    <span class="stringliteral">"TIF_DOSEMULATOR"</span>                 , <span class="comment">// 0x00020000</span>
00574    <span class="stringliteral">"TIF_GLOBALHOOKER"</span>                , <span class="comment">// 0x00040000</span>
00575    <span class="stringliteral">"TIF_DELAYEDEVENT"</span>                , <span class="comment">// 0x00080000</span>
00576    <span class="stringliteral">"TIF_MSGPOSCHANGED"</span>               , <span class="comment">// 0x00100000</span>
00577    <span class="stringliteral">"TIF_SHUTDOWNCOMPLETE"</span>            , <span class="comment">// 0x00200000</span>
00578    <span class="stringliteral">"TIF_IGNOREPLAYBACKDELAY"</span>         , <span class="comment">// 0x00400000</span>
00579    <span class="stringliteral">"TIF_ALLOWOTHERACCOUNTHOOK"</span>       , <span class="comment">// 0x00800000</span>
00580    <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                           , <span class="comment">// 0x01000000</span>
00581    <span class="stringliteral">"TIF_GUITHREADINITIALIZED"</span>        , <span class="comment">// 0x02000000</span>
00582    <span class="stringliteral">"TIF_DISABLEIME"</span>                  , <span class="comment">// 0x04000000</span>
00583    <span class="stringliteral">"TIF_INGETTEXTLENGTH"</span>             , <span class="comment">// 0x08000000</span>
00584    <span class="stringliteral">"TIF_ANSILENGTH"</span>                  , <span class="comment">// 0x10000000</span>
00585    <span class="stringliteral">"TIF_DISABLEHOOKS"</span>                , <span class="comment">// 0x20000000</span>
00586     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>                               <span class="comment">// no more</span>
00587 };
00588 
<a name="l00589"></a><a class="code" href="../../d2/d1/userexts_8c.html#a78">00589</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a78">apszQsFlags</a>[] = {
00590      <span class="stringliteral">"QS_KEY"</span>             , <span class="comment">//  0x0001</span>
00591      <span class="stringliteral">"QS_MOUSEMOVE"</span>       , <span class="comment">//  0x0002</span>
00592      <span class="stringliteral">"QS_MOUSEBUTTON"</span>     , <span class="comment">//  0x0004</span>
00593      <span class="stringliteral">"QS_POSTMESSAGE"</span>     , <span class="comment">//  0x0008</span>
00594      <span class="stringliteral">"QS_TIMER"</span>           , <span class="comment">//  0x0010</span>
00595      <span class="stringliteral">"QS_PAINT"</span>           , <span class="comment">//  0x0020</span>
00596      <span class="stringliteral">"QS_SENDMESSAGE"</span>     , <span class="comment">//  0x0040</span>
00597      <span class="stringliteral">"QS_HOTKEY"</span>          , <span class="comment">//  0x0080</span>
00598      <span class="stringliteral">"QS_ALLPOSTMESSAGE"</span>  , <span class="comment">//  0x0100</span>
00599      <span class="stringliteral">"QS_SMSREPLY"</span>        , <span class="comment">//  0x0200</span>
00600      <span class="stringliteral">"QS_SYSEXPUNGE"</span>      , <span class="comment">//  0x0400</span>
00601      <span class="stringliteral">"QS_THREADATTACHED"</span>  , <span class="comment">//  0x0800</span>
00602      <span class="stringliteral">"QS_EXCLUSIVE"</span>       , <span class="comment">//  0x1000</span>
00603      <span class="stringliteral">"QS_EVENT"</span>           , <span class="comment">//  0x2000</span>
00604      <span class="stringliteral">"QS_TRANSFER"</span>        , <span class="comment">//  0X4000</span>
00605      <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>                   <span class="comment">//  0x8000</span>
00606 };
00607 
<a name="l00608"></a><a class="code" href="../../d2/d1/userexts_8c.html#a79">00608</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a79">apszMfFlags</a>[] = {
00609     <span class="stringliteral">"MF_GRAYED"</span>             , <span class="comment">// 0x0001</span>
00610     <span class="stringliteral">"MF_DISABLED"</span>           , <span class="comment">// 0x0002</span>
00611     <span class="stringliteral">"MF_BITMAP"</span>             , <span class="comment">// 0x0004</span>
00612     <span class="stringliteral">"MF_CHECKED"</span>            , <span class="comment">// 0x0008</span>
00613     <span class="stringliteral">"MF_POPUP"</span>              , <span class="comment">// 0x0010</span>
00614     <span class="stringliteral">"MF_MENUBARBREAK"</span>       , <span class="comment">// 0x0020</span>
00615     <span class="stringliteral">"MF_MENUBREAK"</span>          , <span class="comment">// 0x0040</span>
00616     <span class="stringliteral">"MF_HILITE"</span>             , <span class="comment">// 0x0080</span>
00617     <span class="stringliteral">"MF_OWNERDRAW"</span>          , <span class="comment">// 0x0100</span>
00618     <span class="stringliteral">"MF_USECHECKBITMAPS"</span>    , <span class="comment">// 0x0200</span>
00619     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                 , <span class="comment">// 0x0400</span>
00620     <span class="stringliteral">"MF_SEPARATOR"</span>          , <span class="comment">// 0x0800</span>
00621     <span class="stringliteral">"MF_DEFAULT"</span>            , <span class="comment">// 0x1000</span>
00622     <span class="stringliteral">"MF_SYSMENU"</span>            , <span class="comment">// 0x2000</span>
00623     <span class="stringliteral">"MF_RIGHTJUSTIFY"</span>       , <span class="comment">// 0x4000</span>
00624     <span class="stringliteral">"MF_MOUSESELECT"</span>        , <span class="comment">// 0x8000</span>
00625      <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00626 };
00627 
<a name="l00628"></a><a class="code" href="../../d2/d1/userexts_8c.html#a80">00628</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a80">apszCsfFlags</a>[] = {
00629     <span class="stringliteral">"CSF_SERVERSIDEPROC"</span>      , <span class="comment">// 0x0001</span>
00630     <span class="stringliteral">"CSF_ANSIPROC"</span>            , <span class="comment">// 0x0002</span>
00631     <span class="stringliteral">"CSF_WOWDEFERDESTROY"</span>     , <span class="comment">// 0x0004</span>
00632     <span class="stringliteral">"CSF_SYSTEMCLASS"</span>         , <span class="comment">// 0x0008</span>
00633     <span class="stringliteral">"CSF_WOWCLASS"</span>            , <span class="comment">// 0x0010</span>
00634     <span class="stringliteral">"CSF_WOWEXTRA"</span>            , <span class="comment">// 0x0020</span>
00635     <span class="stringliteral">"CSF_CACHEDSMICON"</span>        , <span class="comment">// 0x0040</span>
00636     <span class="stringliteral">"CSF_WIN40COMPAT"</span>         , <span class="comment">// 0x0080</span>
00637     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>                        <span class="comment">// 0x0100</span>
00638 };
00639 
<a name="l00640"></a><a class="code" href="../../d2/d1/userexts_8c.html#a81">00640</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a81">apszCsFlags</a>[] = {
00641     <span class="stringliteral">"CS_VREDRAW"</span>          , <span class="comment">// 0x0001</span>
00642     <span class="stringliteral">"CS_HREDRAW"</span>          , <span class="comment">// 0x0002</span>
00643     <span class="stringliteral">"CS_KEYCVTWINDOW"</span>     , <span class="comment">// 0x0004</span>
00644     <span class="stringliteral">"CS_DBLCLKS"</span>          , <span class="comment">// 0x0008</span>
00645     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0010</span>
00646     <span class="stringliteral">"CS_OWNDC"</span>            , <span class="comment">// 0x0020</span>
00647     <span class="stringliteral">"CS_CLASSDC"</span>          , <span class="comment">// 0x0040</span>
00648     <span class="stringliteral">"CS_PARENTDC"</span>         , <span class="comment">// 0x0080</span>
00649     <span class="stringliteral">"CS_NOKEYCVT"</span>         , <span class="comment">// 0x0100</span>
00650     <span class="stringliteral">"CS_NOCLOSE"</span>          , <span class="comment">// 0x0200</span>
00651     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0400</span>
00652     <span class="stringliteral">"CS_SAVEBITS"</span>         , <span class="comment">// 0x0800</span>
00653     <span class="stringliteral">"CS_BYTEALIGNCLIENT"</span>  , <span class="comment">// 0x1000</span>
00654     <span class="stringliteral">"CS_BYTEALIGNWINDOW"</span>  , <span class="comment">// 0x2000</span>
00655     <span class="stringliteral">"CS_GLOBALCLASS"</span>      , <span class="comment">// 0x4000</span>
00656     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x8000</span>
00657     <span class="stringliteral">"CS_IME"</span>              , <span class="comment">// 0x10000</span>
00658     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>                    <span class="comment">// no more</span>
00659 };
00660 
<a name="l00661"></a><a class="code" href="../../d2/d1/userexts_8c.html#a82">00661</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a82">apszQfFlags</a>[] = {
00662     <span class="stringliteral">"QF_UPDATEKEYSTATE"</span>         , <span class="comment">// 0x0000001</span>
00663     <span class="stringliteral">"used to be ALTTAB"</span>         , <span class="comment">// 0x0000002</span>
00664     <span class="stringliteral">"QF_FMENUSTATUSBREAK"</span>       , <span class="comment">// 0x0000004</span>
00665     <span class="stringliteral">"QF_FMENUSTATUS"</span>            , <span class="comment">// 0x0000008</span>
00666     <span class="stringliteral">"QF_FF10STATUS"</span>             , <span class="comment">// 0x0000010</span>
00667     <span class="stringliteral">"QF_MOUSEMOVED"</span>             , <span class="comment">// 0x0000020</span>
00668     <span class="stringliteral">"QF_ACTIVATIONCHANGE"</span>       , <span class="comment">// 0x0000040</span>
00669     <span class="stringliteral">"QF_TABSWITCHING"</span>           , <span class="comment">// 0x0000080</span>
00670     <span class="stringliteral">"QF_KEYSTATERESET"</span>          , <span class="comment">// 0x0000100</span>
00671     <span class="stringliteral">"QF_INDESTROY"</span>              , <span class="comment">// 0x0000200</span>
00672     <span class="stringliteral">"QF_LOCKNOREMOVE"</span>           , <span class="comment">// 0x0000400</span>
00673     <span class="stringliteral">"QF_FOCUSNULLSINCEACTIVE"</span>   , <span class="comment">// 0x0000800</span>
00674     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                     , <span class="comment">// 0x0001000</span>
00675     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                     , <span class="comment">// 0x0002000</span>
00676     <span class="stringliteral">"QF_DIALOGACTIVE"</span>           , <span class="comment">// 0x0004000</span>
00677     <span class="stringliteral">"QF_EVENTDEACTIVATEREMOVED"</span> , <span class="comment">// 0x0008000</span>
00678     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                     , <span class="comment">// 0x0010000</span>
00679     <span class="stringliteral">"QF_TRACKMOUSELEAVE"</span>        , <span class="comment">// 0x0020000</span>
00680     <span class="stringliteral">"QF_TRACKMOUSEHOVER"</span>        , <span class="comment">// 0x0040000</span>
00681     <span class="stringliteral">"QF_TRACKMOUSEFIRING"</span>       , <span class="comment">// 0x0080000</span>
00682     <span class="stringliteral">"QF_CAPTURELOCKED"</span>          , <span class="comment">// 0x00100000</span>
00683     <span class="stringliteral">"QF_ACTIVEWNDTRACKING"</span>      , <span class="comment">// 0x00200000</span>
00684     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00685 };
00686 
<a name="l00687"></a><a class="code" href="../../d2/d1/userexts_8c.html#a83">00687</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a83">apszW32pfFlags</a>[] = {
00688     <span class="stringliteral">"W32PF_CONSOLEAPPLICATION"</span>       , <span class="comment">// 0x00000001</span>
00689     <span class="stringliteral">"W32PF_FORCEOFFFEEDBACK"</span>         , <span class="comment">// 0x00000002</span>
00690     <span class="stringliteral">"W32PF_STARTGLASS"</span>               , <span class="comment">// 0x00000004</span>
00691     <span class="stringliteral">"W32PF_WOW"</span>                      , <span class="comment">// 0x00000008</span>
00692     <span class="stringliteral">"W32PF_READSCREENACCESSGRANTED"</span>  , <span class="comment">// 0x00000010</span>
00693     <span class="stringliteral">"W32PF_INITIALIZED"</span>              , <span class="comment">// 0x00000020</span>
00694     <span class="stringliteral">"W32PF_APPSTARTING"</span>              , <span class="comment">// 0x00000040</span>
00695     <span class="stringliteral">"W32PF_WOW64"</span>                    , <span class="comment">// 0x00000080</span>
00696     <span class="stringliteral">"W32PF_ALLOWFOREGROUNDACTIVATE"</span>  , <span class="comment">// 0x00000100</span>
00697     <span class="stringliteral">"W32PF_OWNDCCLEANUP"</span>             , <span class="comment">// 0x00000200</span>
00698     <span class="stringliteral">"W32PF_SHOWSTARTGLASSCALLED"</span>     , <span class="comment">// 0x00000400</span>
00699     <span class="stringliteral">"W32PF_FORCEBACKGROUNDPRIORITY"</span>  , <span class="comment">// 0x00000800</span>
00700     <span class="stringliteral">"W32PF_TERMINATED"</span>               , <span class="comment">// 0x00001000</span>
00701     <span class="stringliteral">"W32PF_CLASSESREGISTERED"</span>        , <span class="comment">// 0x00002000</span>
00702     <span class="stringliteral">"W32PF_THREADCONNECTED"</span>          , <span class="comment">// 0x00004000</span>
00703     <span class="stringliteral">"W32PF_PROCESSCONNECTED"</span>         , <span class="comment">// 0x00008000</span>
00704     <span class="stringliteral">"W32PF_WAKEWOWEXEC"</span>              , <span class="comment">// 0x00010000</span>
00705     <span class="stringliteral">"W32PF_WAITFORINPUTIDLE"</span>         , <span class="comment">// 0x00020000</span>
00706     <span class="stringliteral">"W32PF_IOWINSTA"</span>                 , <span class="comment">// 0x00040000</span>
00707     <span class="stringliteral">"W32PF_CONSOLEFOREGROUND"</span>        , <span class="comment">// 0x00080000</span>
00708     <span class="stringliteral">"W32PF_OLELOADED"</span>                , <span class="comment">// 0x00100000</span>
00709     <span class="stringliteral">"W32PF_SCREENSAVER"</span>              , <span class="comment">// 0x00200000</span>
00710     <span class="stringliteral">"W32PF_IDLESCREENSAVER"</span>          , <span class="comment">// 0x00400000</span>
00711     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00712 };
00713 
00714 
<a name="l00715"></a><a class="code" href="../../d2/d1/userexts_8c.html#a84">00715</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a84">apszHeFlags</a>[] = {
00716    <span class="stringliteral">"HANDLEF_DESTROY"</span>               , <span class="comment">// 0x0001</span>
00717    <span class="stringliteral">"HANDLEF_INDESTROY"</span>             , <span class="comment">// 0x0002</span>
00718    <span class="stringliteral">"HANDLEF_INWAITFORDEATH"</span>        , <span class="comment">// 0x0004</span>
00719    <span class="stringliteral">"HANDLEF_FINALDESTROY"</span>          , <span class="comment">// 0x0008</span>
00720    <span class="stringliteral">"HANDLEF_MARKED_OK"</span>             , <span class="comment">// 0x0010</span>
00721    <span class="stringliteral">"HANDLEF_GRANTED"</span>               , <span class="comment">// 0x0020</span>
00722     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>                             <span class="comment">// 0x0040</span>
00723 };
00724 
00725 
<a name="l00726"></a><a class="code" href="../../d2/d1/userexts_8c.html#a85">00726</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a85">apszHdataFlags</a>[] = {
00727      <span class="stringliteral">"HDATA_APPOWNED"</span>          , <span class="comment">// 0x0001</span>
00728      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x0002</span>
00729      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x0004</span>
00730      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x0008</span>
00731      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x0010</span>
00732      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x0020</span>
00733      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x0040</span>
00734      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x0080</span>
00735      <span class="stringliteral">"HDATA_EXECUTE"</span>           , <span class="comment">// 0x0100</span>
00736      <span class="stringliteral">"HDATA_INITIALIZED"</span>       , <span class="comment">// 0x0200</span>
00737      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x0400</span>
00738      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x0800</span>
00739      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x1000</span>
00740      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>                   , <span class="comment">// 0x2000</span>
00741      <span class="stringliteral">"HDATA_NOAPPFREE"</span>         , <span class="comment">// 0x4000</span>
00742      <span class="stringliteral">"HDATA_READONLY"</span>          , <span class="comment">// 0x8000</span>
00743      <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00744 };
00745 
<a name="l00746"></a><a class="code" href="../../d2/d1/userexts_8c.html#a86">00746</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a86">apszXiFlags</a>[] = {
00747      <span class="stringliteral">"XIF_SYNCHRONOUS"</span>    , <span class="comment">// 0x0001</span>
00748      <span class="stringliteral">"XIF_COMPLETE"</span>       , <span class="comment">// 0x0002</span>
00749      <span class="stringliteral">"XIF_ABANDONED"</span>      , <span class="comment">// 0x0004</span>
00750      <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00751 };
00752 
<a name="l00753"></a><a class="code" href="../../d2/d1/userexts_8c.html#a87">00753</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a87">apszIifFlags</a>[] = {
00754      <span class="stringliteral">"IIF_IN_SYNC_XACT"</span>   , <span class="comment">// 0x0001</span>
00755      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x0002</span>
00756      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x0004</span>
00757      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x0008</span>
00758      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x0010</span>
00759      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x0020</span>
00760      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x0040</span>
00761      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x0080</span>
00762      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x0100</span>
00763      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x0200</span>
00764      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x0400</span>
00765      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x0800</span>
00766      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x1000</span>
00767      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x2000</span>
00768      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x4000</span>
00769      <span class="stringliteral">"IIF_UNICODE"</span>        , <span class="comment">// 0x8000</span>
00770      <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00771 };
00772 
<a name="l00773"></a><a class="code" href="../../d2/d1/userexts_8c.html#a88">00773</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a88">apszTmrfFlags</a>[] = {
00774      <span class="stringliteral">"TMRF_READY"</span>         , <span class="comment">// 0x0001</span>
00775      <span class="stringliteral">"TMRF_SYSTEM"</span>        , <span class="comment">// 0x0002</span>
00776      <span class="stringliteral">"TMRF_RIT"</span>           , <span class="comment">// 0x0004</span>
00777      <span class="stringliteral">"TMRF_INIT"</span>          , <span class="comment">// 0x0008</span>
00778      <span class="stringliteral">"TMRF_ONESHOT"</span>       , <span class="comment">// 0x0010</span>
00779      <span class="stringliteral">"TMRF_WAITING"</span>       , <span class="comment">// 0x0020</span>
00780      <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>                 , <span class="comment">// 0x0040</span>
00781 };
00782 
00783 
<a name="l00784"></a><a class="code" href="../../d2/d1/userexts_8c.html#a89">00784</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a89">apszSbFlags</a>[] = {
00785     <span class="stringliteral">"SB_VERT"</span>             , <span class="comment">// 0x0001</span>
00786     <span class="stringliteral">"SB_CTL"</span>              , <span class="comment">// 0x0002</span>
00787      <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>                 , <span class="comment">// 0x0004</span>
00788 };
00789 
00790 
<a name="l00791"></a><a class="code" href="../../d2/d1/userexts_8c.html#a90">00791</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a90">apszCSFlags</a>[] = {
00792     <span class="stringliteral">"FS_LATIN1"</span>           , <span class="comment">// 0x00000001L</span>
00793     <span class="stringliteral">"FS_LATIN2"</span>           , <span class="comment">// 0x00000002L</span>
00794     <span class="stringliteral">"FS_CYRILLIC"</span>         , <span class="comment">// 0x00000004L</span>
00795     <span class="stringliteral">"FS_GREEK"</span>            , <span class="comment">// 0x00000008L</span>
00796     <span class="stringliteral">"FS_TURKISH"</span>          , <span class="comment">// 0x00000010L</span>
00797     <span class="stringliteral">"FS_HEBREW"</span>           , <span class="comment">// 0x00000020L</span>
00798     <span class="stringliteral">"FS_ARABIC"</span>           , <span class="comment">// 0x00000040L</span>
00799     <span class="stringliteral">"FS_BALTIC"</span>           , <span class="comment">// 0x00000080L</span>
00800     <span class="stringliteral">"FS_VIETNAMESE"</span>       , <span class="comment">// 0x00000100L</span>
00801      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x00000200L</span>
00802      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x00000400L</span>
00803      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x00000800L</span>
00804      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x00001000L</span>
00805      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x00002000L</span>
00806      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x00004000L</span>
00807      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x00008000L</span>
00808     <span class="stringliteral">"FS_THAI"</span>             , <span class="comment">// 0x00010000L</span>
00809     <span class="stringliteral">"FS_JISJAPAN"</span>         , <span class="comment">// 0x00020000L</span>
00810     <span class="stringliteral">"FS_CHINESESIMP"</span>      , <span class="comment">// 0x00040000L</span>
00811     <span class="stringliteral">"FS_WANSUNG"</span>          , <span class="comment">// 0x00080000L</span>
00812     <span class="stringliteral">"FS_CHINESETRAD"</span>      , <span class="comment">// 0x00100000L</span>
00813     <span class="stringliteral">"FS_JOHAB"</span>            , <span class="comment">// 0x00200000L</span>
00814      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x00400000L</span>
00815      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x00800000L</span>
00816      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x01000000L</span>
00817      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x02000000L</span>
00818      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x04000000L</span>
00819      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x08000000L</span>
00820      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x10000000L</span>
00821      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x20000000L</span>
00822      <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>              , <span class="comment">// 0x40000000L</span>
00823     <span class="stringliteral">"FS_SYMBOL"</span>           , <span class="comment">// 0x80000000L</span>
00824     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00825 };
00826 
00827 
<a name="l00828"></a><a class="code" href="../../d2/d1/userexts_8c.html#a91">00828</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a91">apszMenuTypeFlags</a>[] = {
00829     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0001</span>
00830     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0002</span>
00831     <span class="stringliteral">"MFT_BITMAP"</span>          , <span class="comment">// 0x0004 MF_BITMAP</span>
00832     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0008</span>
00833     <span class="stringliteral">"MF_POPUP"</span>            , <span class="comment">// 0x0010</span>
00834     <span class="stringliteral">"MFT_MENUBARBREAK"</span>    , <span class="comment">// 0x0020 MF_MENUBARBREAK</span>
00835     <span class="stringliteral">"MFT_MENUBREAK"</span>       , <span class="comment">// 0x0040 MF_MENUBREAK</span>
00836     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0080</span>
00837     <span class="stringliteral">"MFT_OWNERDRAW"</span>       , <span class="comment">// 0x0100 MF_OWNERDRAW</span>
00838     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0200</span>
00839     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0400</span>
00840     <span class="stringliteral">"MFT_SEPARATOR"</span>       , <span class="comment">// 0x0800 MF_SEPARATOR</span>
00841     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x1000</span>
00842     <span class="stringliteral">"MF_SYSMENU"</span>          , <span class="comment">// 0x2000</span>
00843     <span class="stringliteral">"MFT_RIGHTJUSTIFY"</span>    , <span class="comment">// 0x4000 MF_RIGHTJUSTIFY</span>
00844     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00845 };
00846 
<a name="l00847"></a><a class="code" href="../../d2/d1/userexts_8c.html#a92">00847</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a92">apszMenuStateFlags</a>[] = {
00848     <span class="stringliteral">"MF_GRAYED"</span>           , <span class="comment">// 0x0001</span>
00849     <span class="stringliteral">"MF_DISABLED"</span>         , <span class="comment">// 0x0002</span>
00850     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0004</span>
00851     <span class="stringliteral">"MFS_CHECKED"</span>         , <span class="comment">// 0x0008 MF_CHECKED</span>
00852     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0010</span>
00853     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0020</span>
00854     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0040</span>
00855     <span class="stringliteral">"MFS_HILITE"</span>          , <span class="comment">// 0x0080 MF_HILITE</span>
00856     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0100</span>
00857     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0200</span>
00858     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0400</span>
00859     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x0800</span>
00860     <span class="stringliteral">"MFS_DEFAULT"</span>         , <span class="comment">// 0x1000 MF_DEFAULT</span>
00861     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x2000</span>
00862     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">// 0x4000</span>
00863     <span class="stringliteral">"MF_MOUSESELECT"</span>      , <span class="comment">// 0x8000</span>
00864     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00865 };
00866 
00867 
<a name="l00868"></a><a class="code" href="../../d2/d1/userexts_8c.html#a93">00868</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a93">apszCursorfFlags</a>[] = {
00869     <span class="stringliteral">"CURSORF_FROMRESOURCE"</span>, <span class="comment">//    0x0001</span>
00870     <span class="stringliteral">"CURSORF_GLOBAL"</span>,       <span class="comment">//    0x0002</span>
00871     <span class="stringliteral">"CURSORF_LRSHARED"</span>,     <span class="comment">//    0x0004</span>
00872     <span class="stringliteral">"CURSORF_ACON"</span>,         <span class="comment">//    0x0008</span>
00873     <span class="stringliteral">"CURSORF_WOWCLEANUP"</span>  , <span class="comment">//    0x0010</span>
00874     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>               , <span class="comment">//    0x0020</span>
00875     <span class="stringliteral">"CURSORF_ACONFRAME"</span>,    <span class="comment">//    0x0040</span>
00876     <span class="stringliteral">"CURSORF_SECRET"</span>,       <span class="comment">//    0x0080</span>
00877     <span class="stringliteral">"CURSORF_LINKED"</span>,       <span class="comment">//    0x0100</span>
00878     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00879 };
00880 
<a name="l00881"></a><a class="code" href="../../d2/d1/userexts_8c.html#a94">00881</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a94">apszMonfFlags</a>[] = {
00882     <span class="stringliteral">"MONF_VISIBLE"</span>,         <span class="comment">// 0x01</span>
00883     <span class="stringliteral">"MONF_PALETTEDISPLAY"</span>,  <span class="comment">// 0x02</span>
00884     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00885 };
00886 
<a name="l00887"></a><a class="code" href="../../d2/d1/userexts_8c.html#a95">00887</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a95">apszSifFlags</a>[] = {
00888     <span class="stringliteral">"PUSIF_PALETTEDISPLAY"</span>,         <span class="comment">// 0x00000001</span>
00889     <span class="stringliteral">"PUSIF_SNAPTO"</span>,                 <span class="comment">// 0x00000002</span>
00890     <span class="stringliteral">"PUSIF_COMBOBOXANIMATION"</span>,      <span class="comment">// 0x00000004</span>
00891     <span class="stringliteral">"PUSIF_LISTBOXSMOOTHSCROLLING"</span>, <span class="comment">// 0x00000008</span>
00892     <span class="stringliteral">"PUSIF_KEYBOARDCUES"</span>,           <span class="comment">// 0x00000020</span>
00893     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00894 };
00895 
<a name="l00896"></a><a class="code" href="../../d2/d1/userexts_8c.html#a96">00896</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a96">apszRipFlags</a>[] = {
00897     <span class="stringliteral">"RIPF_PROMPTONERROR"</span>,   <span class="comment">// 0x0001</span>
00898     <span class="stringliteral">"RIPF_PROMPTONWARNING"</span>, <span class="comment">// 0x0002</span>
00899     <span class="stringliteral">"RIPF_PROMPTONVERBOSE"</span>, <span class="comment">// 0x0004</span>
00900     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                <span class="comment">// 0x0008</span>
00901     <span class="stringliteral">"RIPF_PRINTONERROR"</span>,    <span class="comment">// 0x0010</span>
00902     <span class="stringliteral">"RIPF_PRINTONWARNING"</span>,  <span class="comment">// 0x0020</span>
00903     <span class="stringliteral">"RIPF_PRINTONVERBOSE"</span>,  <span class="comment">// 0x0040</span>
00904     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                <span class="comment">// 0x0080</span>
00905     <span class="stringliteral">"RIPF_PRINTFILELINE"</span>,   <span class="comment">// 0x0100</span>
00906     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00907 };
00908 
<a name="l00909"></a><a class="code" href="../../d2/d1/userexts_8c.html#a97">00909</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a97">apszSRVIFlags</a>[] = {
00910     <span class="stringliteral">"SRVIF_CHECKED"</span>,        <span class="comment">// 0x0001</span>
00911     <span class="stringliteral">"SRVIF_WINEVENTHOOKS"</span>,  <span class="comment">// 0x0002</span>
00912     <span class="stringliteral">"SRVIF_DBCS"</span>,           <span class="comment">// 0x0004</span>
00913     <span class="stringliteral">"SRVIF_IME"</span>,            <span class="comment">// 0x0008</span>
00914     <span class="stringliteral">"SRVIF_MIDEAST"</span>,        <span class="comment">// 0x0010</span>
00915     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00916 };
00917 
<a name="l00918"></a><a class="code" href="../../d2/d1/userexts_8c.html#a98">00918</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a98">apszPROPFlags</a>[] = {
00919     <span class="stringliteral">"PROPF_INTERNAL"</span>,       <span class="comment">// 0x0001</span>
00920     <span class="stringliteral">"PROPF_STRING"</span>,         <span class="comment">// 0x0002</span>
00921     <span class="stringliteral">"PROPF_NOPOOL"</span>,         <span class="comment">// 0x0004</span>
00922 };
00923 
<a name="l00924"></a><a class="code" href="../../d2/d1/userexts_8c.html#a99">00924</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a99">apszLpkEntryPoints</a>[] = {
00925     <span class="stringliteral">"LpkTabbedTextOut"</span>    , <span class="comment">// 0x00000001L</span>
00926     <span class="stringliteral">"LpkPSMTextOut"</span>       , <span class="comment">// 0x00000002L</span>
00927     <span class="stringliteral">"LpkDrawTextEx"</span>       , <span class="comment">// 0x00000004L</span>
00928     <span class="stringliteral">"LpkEditControl"</span>      , <span class="comment">// 0x00000008L</span>
00929     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
00930 };
00931 
00932 <span class="comment">/*</span>
00933 <span class="comment"> * We need one of these per DWORD</span>
00934 <span class="comment"> */</span>
<a name="l00935"></a><a class="code" href="../../d2/d1/userexts_8c.html#a100">00935</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a100">aszUserPreferencesMask0</a>[<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) * 8] = {
00936     <span class="stringliteral">"ACTIVEWINDOWTRACKING"</span>,     <span class="comment">/*    0x1000 */</span>
00937     <span class="stringliteral">"MENUANIMATION"</span>,            <span class="comment">/*    0x1002 */</span>
00938     <span class="stringliteral">"COMBOBOXANIMATION"</span>,        <span class="comment">/*    0x1004 */</span>
00939     <span class="stringliteral">"LISTBOXSMOOTHSCROLLING"</span>,   <span class="comment">/*    0x1006 */</span>
00940     <span class="stringliteral">"GRADIENTCAPTIONS"</span>,         <span class="comment">/*    0x1008 */</span>
00941     <span class="stringliteral">"KEYBOARDCUES"</span>,             <span class="comment">/*    0x100A */</span>
00942     <span class="stringliteral">"ACTIVEWNDTRKZORDER"</span>,       <span class="comment">/*    0x100C */</span>
00943     <span class="stringliteral">"HOTTRACKING"</span>,              <span class="comment">/*    0x100E */</span>
00944     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x1010 */</span>
00945     <span class="stringliteral">"MENUFADE"</span>,                 <span class="comment">/*    0x1012 */</span>
00946     <span class="stringliteral">"SELECTIONFADE"</span>,            <span class="comment">/*    0x1014 */</span>
00947     <span class="stringliteral">"TOOLTIPANIMATION"</span>,         <span class="comment">/*    0x1016 */</span>
00948     <span class="stringliteral">"TOOLTIPFADE"</span>,              <span class="comment">/*    0x1018 */</span>
00949     <span class="stringliteral">"CURSORSHADOW"</span>,             <span class="comment">/*    0x101A */</span>
00950     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x101C */</span>
00951     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x101E */</span>
00952     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x1020 */</span>
00953     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x1022 */</span>
00954     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x1024 */</span>
00955     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x1026 */</span>
00956     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x1028 */</span>
00957     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x102A */</span>
00958     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x102C */</span>
00959     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x102E */</span>
00960     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x1030 */</span>
00961     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x1032 */</span>
00962     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x1034 */</span>
00963     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x1036 */</span>
00964     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x1038 */</span>
00965     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x103A */</span>
00966     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">/*    0x103C */</span>
00967     <span class="stringliteral">"UIEFFECTS"</span>,                <span class="comment">/*    0x103E */</span>
00968 };
00969 
<a name="l00970"></a><a class="code" href="../../d2/d1/userexts_8c.html#a101">00970</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a101">aszUserPreferences</a>[SPI_DWORDRANGECOUNT] = {
00971     <span class="stringliteral">"FOREGROUNDLOCKTIMEOUT"</span>,    <span class="comment">/*    0x2000 */</span>
00972     <span class="stringliteral">"ACTIVEWNDTRKTIMEOUT"</span>,      <span class="comment">/*    0x2002 */</span>
00973     <span class="stringliteral">"FOREGROUNDFLASHCOUNT"</span>,     <span class="comment">/*    0x2004 */</span>
00974     <span class="stringliteral">"CARETWIDTH"</span>,               <span class="comment">/*    0x2006 */</span>
00975 };
00976 
<a name="l00977"></a><a class="code" href="../../d2/d1/userexts_8c.html#a102">00977</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a102">aszKeyEventFlags</a>[] = {
00978     <span class="stringliteral">"KEYEVENTF_EXTENDEDKEY"</span>,    <span class="comment">// 0x0001</span>
00979     <span class="stringliteral">"KEYEVENTF_KEYUP"</span>,          <span class="comment">// 0x0002</span>
00980     <span class="stringliteral">"KEYEVENTF_UNICODE"</span>,        <span class="comment">// 0x0004</span>
00981     <span class="stringliteral">"KEYEVENTF_SCANCODE"</span>,       <span class="comment">// 0x0008</span>
00982     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00983 };
00984 
<a name="l00985"></a><a class="code" href="../../d2/d1/userexts_8c.html#a103">00985</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a103">aszMouseEventFlags</a>[] = {
00986     <span class="stringliteral">"MOUSEEVENTF_MOVE"</span>,         <span class="comment">// 0x0001</span>
00987     <span class="stringliteral">"MOUSEEVENTF_LEFTDOWN"</span>,     <span class="comment">// 0x0002</span>
00988     <span class="stringliteral">"MOUSEEVENTF_LEFTUP"</span>,       <span class="comment">// 0x0004</span>
00989     <span class="stringliteral">"MOUSEEVENTF_RIGHTDOWN"</span>,    <span class="comment">// 0x0008</span>
00990     <span class="stringliteral">"MOUSEEVENTF_RIGHTUP"</span>,      <span class="comment">// 0x0010</span>
00991     <span class="stringliteral">"MOUSEEVENTF_MIDDLEDOWN"</span>,   <span class="comment">// 0x0020</span>
00992     <span class="stringliteral">"MOUSEEVENTF_MIDDLEUP"</span>,     <span class="comment">// 0x0040</span>
00993     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x0080</span>
00994     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x0100</span>
00995     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x0200</span>
00996     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x0400</span>
00997     <span class="stringliteral">"MOUSEEVENTF_WHEEL"</span>,        <span class="comment">// 0x0800</span>
00998     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x1000</span>
00999     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x2000</span>
01000     <span class="stringliteral">"MOUSEEVENTF_VIRTUALDESK"</span>,  <span class="comment">// 0x4000</span>
01001     <span class="stringliteral">"MOUSEEVENTF_ABSOLUTE"</span>,     <span class="comment">// 0x8000</span>
01002     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01003 };
01004 
<a name="l01005"></a><a class="code" href="../../d2/d1/userexts_8c.html#a104">01005</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a104">aszWindowStyle</a>[] = {
01006     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000001</span>
01007     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000002</span>
01008     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000004</span>
01009     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000008</span>
01010     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000010</span>
01011     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000020</span>
01012     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000040</span>
01013     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000080</span>
01014     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000100</span>
01015     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000200</span>
01016     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000400</span>
01017     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000800</span>
01018     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00001000</span>
01019     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00002000</span>
01020     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00004000</span>
01021     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00008000</span>
01022     <span class="stringliteral">"WS_TABSTOP"</span>,               <span class="comment">// 0x00010000</span>
01023     <span class="stringliteral">"WS_GROUP"</span>,                 <span class="comment">// 0x00020000</span>
01024     <span class="stringliteral">"WS_THICKFRAME"</span>,            <span class="comment">// 0x00040000</span>
01025     <span class="stringliteral">"WS_SYSMENU"</span>,               <span class="comment">// 0x00080000</span>
01026     <span class="stringliteral">"WS_HSCROLL"</span>,               <span class="comment">// 0x00100000</span>
01027     <span class="stringliteral">"WS_VSCROLL"</span>,               <span class="comment">// 0x00200000</span>
01028     <span class="stringliteral">"WS_DLGFRAME"</span>,              <span class="comment">// 0x00400000</span>
01029     <span class="stringliteral">"WS_BORDER"</span>,                <span class="comment">// 0x00800000</span>
01030     <span class="stringliteral">"WS_MAXIMIZE"</span>,              <span class="comment">// 0x01000000</span>
01031     <span class="stringliteral">"WS_CLIPCHILDREN"</span>,          <span class="comment">// 0x02000000</span>
01032     <span class="stringliteral">"WS_CLIPSIBLINGS"</span>,          <span class="comment">// 0x04000000</span>
01033     <span class="stringliteral">"WS_DISABLED"</span>,              <span class="comment">// 0x08000000</span>
01034     <span class="stringliteral">"WS_VISIBLE"</span>,               <span class="comment">// 0x10000000</span>
01035     <span class="stringliteral">"WS_MINIMIZE"</span>,              <span class="comment">// 0x20000000</span>
01036     <span class="stringliteral">"WS_CHILD"</span>,                 <span class="comment">// 0x40000000</span>
01037     <span class="stringliteral">"WS_POPUP"</span>,                 <span class="comment">// 0x80000000</span>
01038     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01039 };
01040 
<a name="l01041"></a><a class="code" href="../../d2/d1/userexts_8c.html#a105">01041</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a105">aszDialogStyle</a>[] = {
01042     <span class="stringliteral">"DS_ABSALIGN"</span>,              <span class="comment">// 0x00000001</span>
01043     <span class="stringliteral">"DS_SYSMODAL"</span>,              <span class="comment">// 0x00000002</span>
01044     <span class="stringliteral">"DS_3DLOOK"</span>,                <span class="comment">// 0x00000004</span>
01045     <span class="stringliteral">"DS_FIXEDSYS"</span>,              <span class="comment">// 0x00000008</span>
01046     <span class="stringliteral">"DS_NOFAILCREATE"</span>,          <span class="comment">// 0x00000010</span>
01047     <span class="stringliteral">"DS_LOCALEDIT"</span>,             <span class="comment">// 0x00000020</span>
01048     <span class="stringliteral">"DS_SETFONT"</span>,               <span class="comment">// 0x00000040</span>
01049     <span class="stringliteral">"DS_MODALFRAME"</span>,            <span class="comment">// 0x00000080</span>
01050     <span class="stringliteral">"DS_NOIDLEMSG"</span>,             <span class="comment">// 0x00000100</span>
01051     <span class="stringliteral">"DS_SETFOREGROUND"</span>,         <span class="comment">// 0x00000200</span>
01052     <span class="stringliteral">"DS_CONTROL"</span>,               <span class="comment">// 0x00000400</span>
01053     <span class="stringliteral">"DS_CENTER"</span>,                <span class="comment">// 0x00000800</span>
01054     <span class="stringliteral">"DS_CENTERMOUSE"</span>,           <span class="comment">// 0x00001000</span>
01055     <span class="stringliteral">"DS_CONTEXTHELP"</span>,           <span class="comment">// 0x00002000</span>
01056     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00004000</span>
01057     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00008000</span>
01058 
01059     <a class="code" href="../../d2/d1/userexts_8c.html#a45">CONTINUE_ON</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a104">aszWindowStyle</a> + 16),
01060 };
01061 
01062 
<a name="l01063"></a><a class="code" href="../../d2/d1/userexts_8c.html#a106">01063</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a106">aszButtonStyle</a>[] = {
01064     <a class="code" href="../../d2/d1/userexts_8c.html#a42">MASKENUM_START</a>(BS_TYPEMASK),
01065     <span class="stringliteral">"BS_PUSHBUTTON"</span>,            <span class="comment">// 0</span>
01066     <span class="stringliteral">"BS_DEFPUSHBUTTON"</span>,         <span class="comment">// 1</span>
01067     <span class="stringliteral">"BS_CHECKBOX"</span>,              <span class="comment">// 2</span>
01068     <span class="stringliteral">"BS_AUTOCHECKBOX"</span>,          <span class="comment">// 3</span>
01069     <span class="stringliteral">"BS_RADIOBUTTON"</span>,           <span class="comment">// 4</span>
01070     <span class="stringliteral">"BS_3STATE"</span>,                <span class="comment">// 5</span>
01071     <span class="stringliteral">"BS_AUTO3STATE"</span>,            <span class="comment">// 6</span>
01072     <span class="stringliteral">"BS_GROUPBOX"</span>,              <span class="comment">// 7</span>
01073     <span class="stringliteral">"BS_USERBUTTON"</span>,            <span class="comment">// 8</span>
01074     <span class="stringliteral">"BS_AUTORADIOBUTTON"</span>,       <span class="comment">// 9</span>
01075     <span class="stringliteral">"BS_PUSHBOX"</span>,               <span class="comment">// a</span>
01076     <span class="stringliteral">"BS_OWNERDRAW"</span>,             <span class="comment">// b</span>
01077     <a class="code" href="../../d2/d1/userexts_8c.html#a43">MASKENUM_END</a>(4),
01078 
01079     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000010</span>
01080     <span class="stringliteral">"BS_LEFTTEXT"</span>,              <span class="comment">// 0x00000020</span>
01081 
01082     <a class="code" href="../../d2/d1/userexts_8c.html#a42">MASKENUM_START</a>(BS_IMAGEMASK),
01083     <span class="stringliteral">"BS_TEXT"</span>,                  <span class="comment">// 0</span>
01084     <span class="stringliteral">"BS_ICON"</span>,
01085     <span class="stringliteral">"BS_BITMAP"</span>,
01086     <a class="code" href="../../d2/d1/userexts_8c.html#a43">MASKENUM_END</a>(2),
01087 
01088     <a class="code" href="../../d2/d1/userexts_8c.html#a42">MASKENUM_START</a>(BS_HORZMASK),
01089     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,
01090     <span class="stringliteral">"BS_LEFT"</span>,
01091     <span class="stringliteral">"BS_RIGHT"</span>,
01092     <span class="stringliteral">"BS_CENTER"</span>,
01093     <a class="code" href="../../d2/d1/userexts_8c.html#a43">MASKENUM_END</a>(2),
01094 
01095     <a class="code" href="../../d2/d1/userexts_8c.html#a42">MASKENUM_START</a>(BS_VERTMASK),
01096     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,
01097     <span class="stringliteral">"BS_TOP"</span>, <span class="stringliteral">"BS_BOTTOM"</span>, <span class="stringliteral">"BS_VCENTER"</span>,
01098     <a class="code" href="../../d2/d1/userexts_8c.html#a43">MASKENUM_END</a>(2),
01099 
01100     <span class="stringliteral">"BS_PUSHLIKE"</span>,              <span class="comment">// 0x00001000</span>
01101     <span class="stringliteral">"BS_MULTILINE"</span>,             <span class="comment">// 0x00002000</span>
01102     <span class="stringliteral">"BS_NOTIFY"</span>,                <span class="comment">// 0x00004000</span>
01103     <span class="stringliteral">"BS_FLAT"</span>,                  <span class="comment">// 0x00008000</span>
01104 
01105     <a class="code" href="../../d2/d1/userexts_8c.html#a45">CONTINUE_ON</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a104">aszWindowStyle</a> + 16),
01106 };
01107 
<a name="l01108"></a><a class="code" href="../../d2/d1/userexts_8c.html#a107">01108</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a107">aszComboBoxStyle</a>[] = {
01109     <a class="code" href="../../d2/d1/userexts_8c.html#a42">MASKENUM_START</a>(0x0f),
01110     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0</span>
01111     <span class="stringliteral">"CBS_SIMPLE"</span>,               <span class="comment">// 1</span>
01112     <span class="stringliteral">"CBS_DROPDOWN"</span>,             <span class="comment">// 2</span>
01113     <span class="stringliteral">"CBS_DROPDOWNLIST"</span>,         <span class="comment">// 3</span>
01114     <a class="code" href="../../d2/d1/userexts_8c.html#a43">MASKENUM_END</a>(4),
01115 
01116     <span class="stringliteral">"CBS_OWNERDRAWFIXED"</span>,       <span class="comment">// 0x0010L</span>
01117     <span class="stringliteral">"CBS_OWNERDRAWVARIABLE"</span>,    <span class="comment">// 0x0020L</span>
01118     <span class="stringliteral">"CBS_AUTOHSCROLL"</span>,          <span class="comment">// 0x0040L</span>
01119     <span class="stringliteral">"CBS_OEMCONVERT"</span>,           <span class="comment">// 0x0080L</span>
01120     <span class="stringliteral">"CBS_SORT"</span>,                 <span class="comment">// 0x0100L</span>
01121     <span class="stringliteral">"CBS_HASSTRINGS"</span>,           <span class="comment">// 0x0200L</span>
01122     <span class="stringliteral">"CBS_NOINTEGRALHEIGHT"</span>,     <span class="comment">// 0x0400L</span>
01123     <span class="stringliteral">"CBS_DISABLENOSCROLL"</span>,      <span class="comment">// 0x0800L</span>
01124     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x1000L</span>
01125     <span class="stringliteral">"CBS_UPPERCASE"</span>,            <span class="comment">// 0x2000L</span>
01126     <span class="stringliteral">"CBS_LOWERCASE"</span>,            <span class="comment">// 0x4000L</span>
01127     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x8000L</span>
01128 
01129     <a class="code" href="../../d2/d1/userexts_8c.html#a45">CONTINUE_ON</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a104">aszWindowStyle</a> + 16),
01130 };
01131 
<a name="l01132"></a><a class="code" href="../../d2/d1/userexts_8c.html#a108">01132</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a108">aszStaticStyle</a>[] = {
01133     <a class="code" href="../../d2/d1/userexts_8c.html#a42">MASKENUM_START</a>(SS_TYPEMASK),
01134     <span class="stringliteral">"SS_LEFT"</span>,              <span class="comment">// 0x00000000L</span>
01135     <span class="stringliteral">"SS_CENTER"</span>,            <span class="comment">// 0x00000001L</span>
01136     <span class="stringliteral">"SS_RIGHT"</span>,             <span class="comment">// 0x00000002L</span>
01137     <span class="stringliteral">"SS_ICON"</span>,              <span class="comment">// 0x00000003L</span>
01138     <span class="stringliteral">"SS_BLACKRECT"</span>,         <span class="comment">// 0x00000004L</span>
01139     <span class="stringliteral">"SS_GRAYRECT"</span>,          <span class="comment">// 0x00000005L</span>
01140     <span class="stringliteral">"SS_WHITERECT"</span>,         <span class="comment">// 0x00000006L</span>
01141     <span class="stringliteral">"SS_BLACKFRAME"</span>,        <span class="comment">// 0x00000007L</span>
01142     <span class="stringliteral">"SS_GRAYFRAME"</span>,         <span class="comment">// 0x00000008L</span>
01143     <span class="stringliteral">"SS_WHITEFRAME"</span>,        <span class="comment">// 0x00000009L</span>
01144     <span class="stringliteral">"SS_USERITEM"</span>,          <span class="comment">// 0x0000000AL</span>
01145     <span class="stringliteral">"SS_SIMPLE"</span>,            <span class="comment">// 0x0000000BL</span>
01146     <span class="stringliteral">"SS_LEFTNOWORDWRAP"</span>,    <span class="comment">// 0x0000000CL</span>
01147     <span class="stringliteral">"SS_OWNERDRAW"</span>,         <span class="comment">// 0x0000000DL</span>
01148     <span class="stringliteral">"SS_BITMAP"</span>,            <span class="comment">// 0x0000000EL</span>
01149     <span class="stringliteral">"SS_ENHMETAFILE"</span>,       <span class="comment">// 0x0000000FL</span>
01150     <span class="stringliteral">"SS_ETCHEDHORZ"</span>,        <span class="comment">// 0x00000010L</span>
01151     <span class="stringliteral">"SS_ETCHEDVERT"</span>,        <span class="comment">// 0x00000011L</span>
01152     <span class="stringliteral">"SS_ETCHEDFRAME"</span>,       <span class="comment">// 0x00000012L</span>
01153     <a class="code" href="../../d2/d1/userexts_8c.html#a43">MASKENUM_END</a>(5),
01154 
01155     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                <span class="comment">// 0x00000020L</span>
01156     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                <span class="comment">// 0x00000040L</span>
01157     <span class="stringliteral">"SS_NOPREFIX"</span>,          <span class="comment">// 0x00000080L /* Don't do "&amp;" character translation */</span>
01158     <span class="stringliteral">"SS_NOTIFY"</span>,            <span class="comment">// 0x00000100L</span>
01159     <span class="stringliteral">"SS_CENTERIMAGE"</span>,       <span class="comment">// 0x00000200L</span>
01160     <span class="stringliteral">"SS_RIGHTJUST"</span>,         <span class="comment">// 0x00000400L</span>
01161     <span class="stringliteral">"SS_REALSIZEIMAGE"</span>,     <span class="comment">// 0x00000800L</span>
01162     <span class="stringliteral">"SS_SUNKEN"</span>,            <span class="comment">// 0x00001000L</span>
01163     <span class="stringliteral">"SS_EDITCONTROL"</span>,       <span class="comment">// 0x00002000L ;internal</span>
01164 
01165     <a class="code" href="../../d2/d1/userexts_8c.html#a42">MASKENUM_START</a>(SS_ELLIPSISMASK),
01166     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,
01167     <span class="stringliteral">"SS_ENDELLIPSIS"</span>,       <span class="comment">// 0x00004000L</span>
01168     <span class="stringliteral">"SS_PATHELLIPSIS"</span>,      <span class="comment">// 0x00008000L</span>
01169     <span class="stringliteral">"SS_WORDELLIPSIS"</span>,      <span class="comment">// 0x0000C000L</span>
01170     <a class="code" href="../../d2/d1/userexts_8c.html#a43">MASKENUM_END</a>(2),
01171 
01172     <a class="code" href="../../d2/d1/userexts_8c.html#a45">CONTINUE_ON</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a104">aszWindowStyle</a> + 16),
01173 };
01174 
<a name="l01175"></a><a class="code" href="../../d2/d1/userexts_8c.html#a109">01175</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a109">aszListBoxStyle</a>[] = {
01176     <span class="stringliteral">"LBS_NOTIFY"</span>,               <span class="comment">// 0x0001L</span>
01177     <span class="stringliteral">"LBS_SORT"</span>,                 <span class="comment">// 0x0002L</span>
01178     <span class="stringliteral">"LBS_NOREDRAW"</span>,             <span class="comment">// 0x0004L</span>
01179     <span class="stringliteral">"LBS_MULTIPLESEL"</span>,          <span class="comment">// 0x0008L</span>
01180     <span class="stringliteral">"LBS_OWNERDRAWFIXED"</span>,       <span class="comment">// 0x0010L</span>
01181     <span class="stringliteral">"LBS_OWNERDRAWVARIABLE"</span>,    <span class="comment">// 0x0020L</span>
01182     <span class="stringliteral">"LBS_HASSTRINGS"</span>,           <span class="comment">// 0x0040L</span>
01183     <span class="stringliteral">"LBS_USETABSTOPS"</span>,          <span class="comment">// 0x0080L</span>
01184     <span class="stringliteral">"LBS_NOINTEGRALHEIGHT"</span>,     <span class="comment">// 0x0100L</span>
01185     <span class="stringliteral">"LBS_MULTICOLUMN"</span>,          <span class="comment">// 0x0200L</span>
01186     <span class="stringliteral">"LBS_WANTKEYBOARDINPUT"</span>,    <span class="comment">// 0x0400L</span>
01187     <span class="stringliteral">"LBS_EXTENDEDSEL"</span>,          <span class="comment">// 0x0800L</span>
01188     <span class="stringliteral">"LBS_DISABLENOSCROLL"</span>,      <span class="comment">// 0x1000L</span>
01189     <span class="stringliteral">"LBS_NODATA"</span>,               <span class="comment">// 0x2000L</span>
01190     <span class="stringliteral">"LBS_NOSEL"</span>,                <span class="comment">// 0x4000L</span>
01191     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x8000L</span>
01192 
01193     <a class="code" href="../../d2/d1/userexts_8c.html#a45">CONTINUE_ON</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a104">aszWindowStyle</a> + 16),
01194 };
01195 
<a name="l01196"></a><a class="code" href="../../d2/d1/userexts_8c.html#a110">01196</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a110">aszEditStyle</a>[] = {
01197     <a class="code" href="../../d2/d1/userexts_8c.html#a42">MASKENUM_START</a>(ES_FMTMASK),
01198     <span class="stringliteral">"ES_LEFT"</span>,              <span class="comment">// 0x0000L</span>
01199     <span class="stringliteral">"ES_CENTER"</span>,            <span class="comment">// 0x0001L</span>
01200     <span class="stringliteral">"ES_RIGHT"</span>,             <span class="comment">// 0x0002L</span>
01201     <a class="code" href="../../d2/d1/userexts_8c.html#a43">MASKENUM_END</a>(2),
01202 
01203     <span class="stringliteral">"ES_MULTILINE"</span>,         <span class="comment">// 0x0004L</span>
01204     <span class="stringliteral">"ES_UPPERCASE"</span>,         <span class="comment">// 0x0008L</span>
01205     <span class="stringliteral">"ES_LOWERCASE"</span>,         <span class="comment">// 0x0010L</span>
01206     <span class="stringliteral">"ES_PASSWORD"</span>,          <span class="comment">// 0x0020L</span>
01207     <span class="stringliteral">"ES_AUTOVSCROLL"</span>,       <span class="comment">// 0x0040L</span>
01208     <span class="stringliteral">"ES_AUTOHSCROLL"</span>,       <span class="comment">// 0x0080L</span>
01209     <span class="stringliteral">"ES_NOHIDESEL"</span>,         <span class="comment">// 0x0100L</span>
01210     <span class="stringliteral">"ES_COMBOBOX"</span>,          <span class="comment">// 0x0200L     ;internal</span>
01211     <span class="stringliteral">"ES_OEMCONVERT"</span>,        <span class="comment">// 0x0400L</span>
01212     <span class="stringliteral">"ES_READONLY"</span>,          <span class="comment">// 0x0800L</span>
01213     <span class="stringliteral">"ES_WANTRETURN"</span>,        <span class="comment">// 0x1000L</span>
01214     <span class="stringliteral">"ES_NUMBER"</span>,            <span class="comment">// 0x2000L     ;public_winver_400</span>
01215     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                <span class="comment">// 0x4000L</span>
01216     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                <span class="comment">// 0x8000L</span>
01217 
01218     <a class="code" href="../../d2/d1/userexts_8c.html#a45">CONTINUE_ON</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a104">aszWindowStyle</a> + 16),
01219 };
01220 
<a name="l01221"></a><a class="code" href="../../d2/d1/userexts_8c.html#a111">01221</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a111">aszScrollBarStyle</a>[] = {
01222     <span class="stringliteral">"SBS_HORZ"</span>,                     <span class="comment">// 0x0000L</span>
01223     <span class="stringliteral">"SBS_VERT"</span>,                     <span class="comment">// 0x0001L</span>
01224     <span class="stringliteral">"SBS_TOPALIGN"</span>,                 <span class="comment">// 0x0002L</span>
01225     <span class="stringliteral">"SBS_LEFTALIGN"</span>,                <span class="comment">// 0x0002L</span>
01226     <span class="stringliteral">"SBS_BOTTOMALIGN"</span>,              <span class="comment">// 0x0004L</span>
01227     <span class="stringliteral">"SBS_RIGHTALIGN"</span>,               <span class="comment">// 0x0004L</span>
01228     <span class="stringliteral">"SBS_SIZEBOXTOPLEFTALIGN"</span>,      <span class="comment">// 0x0002L</span>
01229     <span class="stringliteral">"SBS_SIZEBOXBOTTOMRIGHTALIGN"</span>,  <span class="comment">// 0x0004L</span>
01230     <span class="stringliteral">"SBS_SIZEBOX"</span>,                  <span class="comment">// 0x0008L</span>
01231     <span class="stringliteral">"SBS_SIZEGRIP"</span>,                 <span class="comment">// 0x0010L</span>
01232     <a class="code" href="../../d2/d1/userexts_8c.html#a44">SHIFT_BITS</a>(8),                  <span class="comment">// 8 bits</span>
01233 
01234     <a class="code" href="../../d2/d1/userexts_8c.html#a45">CONTINUE_ON</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a104">aszWindowStyle</a> + 16),
01235 };
01236 
<a name="l01237"></a><a class="code" href="../../d2/d1/userexts_8c.html#a112">01237</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a112">aszWindowExStyle</a>[] = {
01238     <span class="stringliteral">"WS_EX_DLGMODALFRAME"</span>,      <span class="comment">// 0x00000001L</span>
01239     <span class="stringliteral">"WS_EX_DRAGOBJECT"</span>,         <span class="comment">// 0x00000002L  ;internal</span>
01240     <span class="stringliteral">"WS_EX_NOPARENTNOTIFY"</span>,     <span class="comment">// 0x00000004L</span>
01241     <span class="stringliteral">"WS_EX_TOPMOST"</span>,            <span class="comment">// 0x00000008L</span>
01242     <span class="stringliteral">"WS_EX_ACCEPTFILES"</span>,        <span class="comment">// 0x00000010L</span>
01243     <span class="stringliteral">"WS_EX_TRANSPARENT"</span>,        <span class="comment">// 0x00000020L</span>
01244     <span class="stringliteral">"WS_EX_MDICHILD"</span>,           <span class="comment">// 0x00000040L</span>
01245     <span class="stringliteral">"WS_EX_TOOLWINDOW"</span>,         <span class="comment">// 0x00000080L</span>
01246     <span class="stringliteral">"WS_EX_WINDOWEDGE"</span>,         <span class="comment">// 0x00000100L</span>
01247     <span class="stringliteral">"WS_EX_CLIENTEDGE"</span>,         <span class="comment">// 0x00000200L</span>
01248     <span class="stringliteral">"WS_EX_CONTEXTHELP"</span>,        <span class="comment">// 0x00000400L</span>
01249     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00000800L</span>
01250 
01251     <span class="stringliteral">"WS_EX_RIGHT"</span>,              <span class="comment">// 0x00001000L</span>
01252 <span class="comment">//  "WS_EX_LEFT",               // 0x00000000L</span>
01253     <span class="stringliteral">"WS_EX_RTLREADING"</span>,         <span class="comment">// 0x00002000L</span>
01254 <span class="comment">//  "WS_EX_LTRREADING",         // 0x00000000L</span>
01255     <span class="stringliteral">"WS_EX_LEFTSCROLLBAR"</span>,      <span class="comment">// 0x00004000L</span>
01256 <span class="comment">//  "WS_EX_RIGHTSCROLLBAR",     // 0x00000000L</span>
01257     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                    <span class="comment">// 0x00008000L</span>
01258 
01259     <span class="stringliteral">"WS_EX_CONTROLPARENT"</span>,      <span class="comment">// 0x00010000L</span>
01260     <span class="stringliteral">"WS_EX_STATICEDGE"</span>,         <span class="comment">// 0x00020000L</span>
01261     <span class="stringliteral">"WS_EX_APPWINDOW"</span>,          <span class="comment">// 0x00040000L</span>
01262     <span class="stringliteral">"WS_EX_LAYERED"</span>,            <span class="comment">// 0x00080000</span>
01263     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01264 };
01265 
<a name="l01266"></a><a class="code" href="../../d2/d1/userexts_8c.html#a113">01266</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a113">aszClientImcFlags</a>[] = {
01267     <span class="stringliteral">"IMCF_UNICODE"</span>,         <span class="comment">// 0x0001</span>
01268     <span class="stringliteral">"IMCF_ACTIVE"</span>,          <span class="comment">// 0x0002</span>
01269     <span class="stringliteral">"IMCF_CHGMSG"</span>,          <span class="comment">// 0x0004</span>
01270     <span class="stringliteral">"IMCF_SAVECTRL"</span>,        <span class="comment">// 0x0008</span>
01271     <span class="stringliteral">"IMCF_PROCESSEVENT"</span>,    <span class="comment">// 0x0010</span>
01272     <span class="stringliteral">"IMCF_FIRSTSELECT"</span>,     <span class="comment">// 0x0020</span>
01273     <span class="stringliteral">"IMCF_INDESTROY"</span>,       <span class="comment">// 0x0040</span>
01274     <span class="stringliteral">"IMCF_WINNLSDISABLE"</span>,   <span class="comment">// 0x0080</span>
01275     <span class="stringliteral">"IMCF_DEFAULTIMC"</span>,      <span class="comment">// 0x0100</span>
01276     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01277 };
01278 
<a name="l01279"></a><a class="code" href="../../d2/d1/userexts_8c.html#a114">01279</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a114">aszConversionModes</a>[] = {
01280     <span class="stringliteral">"IME_CMODE_NATIVE"</span>,                 <span class="comment">// 0x0001</span>
01281     <span class="stringliteral">"IME_CMODE_KATAKANA"</span>,               <span class="comment">// 0x0002  // only effect under IME_CMODE_NATIVE</span>
01282     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                            <span class="comment">// 0x0004</span>
01283     <span class="stringliteral">"IME_CMODE_FULLSHAPE"</span>,              <span class="comment">// 0x0008</span>
01284     <span class="stringliteral">"IME_CMODE_ROMAN"</span>,                  <span class="comment">// 0x0010</span>
01285     <span class="stringliteral">"IME_CMODE_CHARCODE"</span>,               <span class="comment">// 0x0020</span>
01286     <span class="stringliteral">"IME_CMODE_HANJACONVERT"</span>,           <span class="comment">// 0x0040</span>
01287     <span class="stringliteral">"IME_CMODE_SOFTKBD"</span>,                <span class="comment">// 0x0080</span>
01288     <span class="stringliteral">"IME_CMODE_NOCONVERSION"</span>,           <span class="comment">// 0x0100</span>
01289     <span class="stringliteral">"IME_CMODE_EUDC"</span>,                   <span class="comment">// 0x0200</span>
01290     <span class="stringliteral">"IME_CMODE_SYMBOL"</span>,                 <span class="comment">// 0x0400</span>
01291     <span class="stringliteral">"IME_CMODE_FIXED"</span>,                  <span class="comment">// 0x0800</span>
01292     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01293 };
01294 
<a name="l01295"></a><a class="code" href="../../d2/d1/userexts_8c.html#a115">01295</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a115">aszSentenceModes</a>[] = {
01296     <span class="stringliteral">"IME_SMODE_PLAURALCLAUSE"</span>,          <span class="comment">// 0x0001</span>
01297     <span class="stringliteral">"IME_SMODE_SINGLECONVERT"</span>,          <span class="comment">// 0x0002</span>
01298     <span class="stringliteral">"IME_SMODE_AUTOMATIC"</span>,              <span class="comment">// 0x0004</span>
01299     <span class="stringliteral">"IME_SMODE_PHRASEPREDICT"</span>,          <span class="comment">// 0x0008</span>
01300     <span class="stringliteral">"IME_SMODE_CONVERSATION"</span>,           <span class="comment">// 0x0010</span>
01301     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01302 };
01303 
<a name="l01304"></a><a class="code" href="../../d2/d1/userexts_8c.html#a116">01304</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a116">aszImeInit</a>[] = {
01305     <span class="stringliteral">"INIT_STATUSWNDPOS"</span>,            <span class="comment">// 0x00000001</span>
01306     <span class="stringliteral">"INIT_CONVERSION"</span>,              <span class="comment">// 0x00000002</span>
01307     <span class="stringliteral">"INIT_SENTENCE"</span>,                <span class="comment">// 0x00000004</span>
01308     <span class="stringliteral">"INIT_LOGFONT"</span>,                 <span class="comment">// 0x00000008</span>
01309     <span class="stringliteral">"INIT_COMPFORM"</span>,                <span class="comment">// 0x00000010</span>
01310     <span class="stringliteral">"INIT_SOFTKBDPOS"</span>,              <span class="comment">// 0x00000020</span>
01311     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01312 };
01313 
<a name="l01314"></a><a class="code" href="../../d2/d1/userexts_8c.html#a117">01314</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a117">aszImeSentenceMode</a>[] = {
01315     <span class="stringliteral">"IME_SMODE_PLAURALCLAUSE"</span>,      <span class="comment">// 0x0001</span>
01316     <span class="stringliteral">"IME_SMODE_SINGLECONVERT"</span>,      <span class="comment">// 0x0002</span>
01317     <span class="stringliteral">"IME_SMODE_AUTOMATIC"</span>,          <span class="comment">// 0x0004</span>
01318     <span class="stringliteral">"IME_SMODE_PHRASEPREDICT"</span>,      <span class="comment">// 0x0008</span>
01319     <span class="stringliteral">"IME_SMODE_CONVERSATION"</span>,       <span class="comment">// 0x0010</span>
01320     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01321 };
01322 
<a name="l01323"></a><a class="code" href="../../d2/d1/userexts_8c.html#a118">01323</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a118">aszImeConversionMode</a>[] = {
01324     <span class="stringliteral">"IME_CMODE_NATIVE"</span>,             <span class="comment">// 0x0001</span>
01325     <span class="stringliteral">"IME_CMODE_KATAKANA"</span>,           <span class="comment">// 0x0002  // only effect under IME_CMODE_NATIVE</span>
01326     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,
01327     <span class="stringliteral">"IME_CMODE_FULLSHAPE"</span>,          <span class="comment">// 0x0008</span>
01328     <span class="stringliteral">"IME_CMODE_ROMAN"</span>,              <span class="comment">// 0x0010</span>
01329     <span class="stringliteral">"IME_CMODE_CHARCODE"</span>,           <span class="comment">// 0x0020</span>
01330     <span class="stringliteral">"IME_CMODE_HANJACONVERT"</span>,       <span class="comment">// 0x0040</span>
01331     <span class="stringliteral">"IME_CMODE_SOFTKBD"</span>,            <span class="comment">// 0x0080</span>
01332     <span class="stringliteral">"IME_CMODE_NOCONVERSION"</span>,       <span class="comment">// 0x0100</span>
01333     <span class="stringliteral">"IME_CMODE_EUDC"</span>,               <span class="comment">// 0x0200</span>
01334     <span class="stringliteral">"IME_CMODE_SYMBOL"</span>,             <span class="comment">// 0x0400</span>
01335     <span class="stringliteral">"IME_CMODE_FIXED"</span>,              <span class="comment">// 0x0800</span>
01336     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01337 };
01338 
<a name="l01339"></a><a class="code" href="../../d2/d1/userexts_8c.html#a119">01339</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a119">aszImeDirtyFlags</a>[] = {
01340     <span class="stringliteral">"IMSS_UPDATE_OPEN"</span>,             <span class="comment">// 0x0001</span>
01341     <span class="stringliteral">"IMSS_UPDATE_CONVERSION"</span>,       <span class="comment">// 0x0002</span>
01342     <span class="stringliteral">"IMSS_UPDATE_SENTENCE"</span>,         <span class="comment">// 0x0004</span>
01343     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                        <span class="comment">// 0x0008</span>
01344     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                        <span class="comment">// 0x0010</span>
01345     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                        <span class="comment">// 0x0020</span>
01346     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                        <span class="comment">// 0x0040</span>
01347     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                        <span class="comment">// 0x0080</span>
01348     <span class="stringliteral">"IMSS_INIT_OPEN"</span>,               <span class="comment">// 0x0100</span>
01349     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01350 };
01351 
<a name="l01352"></a><a class="code" href="../../d2/d1/userexts_8c.html#a120">01352</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a120">aszImeCompFormFlags</a>[] = {
01353 <span class="comment">//  "CFS_DEFAULT",                  // 0x0000</span>
01354     <span class="stringliteral">"CFS_RECT"</span>,                     <span class="comment">// 0x0001</span>
01355     <span class="stringliteral">"CFS_POINT"</span>,                    <span class="comment">// 0x0002</span>
01356     <span class="stringliteral">"CFS_SCREEN"</span>,                   <span class="comment">// 0x0004          @Internal</span>
01357     <span class="stringliteral">"CFS_VERTICAL"</span>,                 <span class="comment">// 0x0008          @Internal</span>
01358     <span class="stringliteral">"CFS_HIDDEN"</span>,                   <span class="comment">// 0x0010          @Internal</span>
01359     <span class="stringliteral">"CFS_FORCE_POSITION"</span>,           <span class="comment">// 0x0020</span>
01360     <span class="stringliteral">"CFS_CANDIDATEPOS"</span>,             <span class="comment">// 0x0040</span>
01361     <span class="stringliteral">"CFS_EXCLUDE"</span>,                  <span class="comment">// 0x0080</span>
01362 };
01363 
01364 
<a name="l01365"></a><a class="code" href="../../d2/d1/userexts_8c.html#a121">01365</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a121">aszEdUndoType</a>[] = {
01366     <span class="stringliteral">"UNDO_INSERT"</span>,                  <span class="comment">// 0x0001</span>
01367     <span class="stringliteral">"UNDO_DELETE"</span>,                  <span class="comment">// 0x0002</span>
01368     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01369 };
01370 
<a name="l01371"></a><a class="code" href="../../d2/d1/userexts_8c.html#a122">01371</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a122">aszDeviceInfoActionFlags</a>[] = {
01372     <span class="stringliteral">"GDIAF_ARRIVED"</span>,                <span class="comment">// 0x0001</span>
01373     <span class="stringliteral">"GDIAF_QUERYREMOVE"</span>,            <span class="comment">// 0x0002</span>
01374     <span class="stringliteral">"GDIAF_REMOVECANCELLED"</span>,        <span class="comment">// 0x0004</span>
01375     <span class="stringliteral">"GDIAF_DEPARTED"</span>,               <span class="comment">// 0x0008</span>
01376     <span class="stringliteral">"GDIAF_IME_STATUS"</span>,             <span class="comment">// 0x0010</span>
01377     <span class="stringliteral">"GDIAF_REFRESH_MOUSE"</span>,          <span class="comment">// 0x0020</span>
01378     <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>,                        <span class="comment">// 0x0040</span>
01379     <span class="stringliteral">"GDIAF_FREEME"</span>,                 <span class="comment">// 0x0080</span>
01380     <span class="stringliteral">"GDIAF_PNPWAITING"</span>,             <span class="comment">// 0x0100</span>
01381     <span class="stringliteral">"GDIAF_RETRYREAD"</span>,              <span class="comment">// 0x0200</span>
01382     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01383 };
01384 
<a name="l01385"></a><a class="code" href="../../d2/d1/userexts_8c.html#a259">01385</a> <span class="keyword">enum</span> <a class="code" href="../../d2/d1/userexts_8c.html#a259">GF_FLAGS</a> {
01386     <a class="code" href="../../d2/d1/userexts_8c.html#a259a137">GF_SMS</a> = 0,
01387     <a class="code" href="../../d2/d1/userexts_8c.html#a259a138">GF_TIF</a>,
01388     <a class="code" href="../../d2/d1/userexts_8c.html#a259a139">GF_QS</a>,
01389     <a class="code" href="../../d2/d1/userexts_8c.html#a259a140">GF_MF</a>,
01390     <a class="code" href="../../d2/d1/userexts_8c.html#a259a141">GF_CSF</a>,
01391     <a class="code" href="../../d2/d1/userexts_8c.html#a259a142">GF_CS</a>,
01392     <a class="code" href="../../d2/d1/userexts_8c.html#a259a143">GF_QF</a>,
01393     <a class="code" href="../../d2/d1/userexts_8c.html#a259a144">GF_W32PF</a>,
01394     <a class="code" href="../../d2/d1/userexts_8c.html#a259a145">GF_HE</a>,
01395     <a class="code" href="../../d2/d1/userexts_8c.html#a259a146">GF_HDATA</a>,
01396     <a class="code" href="../../d2/d1/userexts_8c.html#a259a147">GF_XI</a>,
01397     <a class="code" href="../../d2/d1/userexts_8c.html#a259a148">GF_IIF</a>,
01398     <a class="code" href="../../d2/d1/userexts_8c.html#a259a149">GF_TMRF</a>,
01399     <a class="code" href="../../d2/d1/userexts_8c.html#a259a150">GF_SB</a>,
01400     <a class="code" href="../../d2/d1/userexts_8c.html#a259a151">GF_CHARSETS</a>,
01401     <a class="code" href="../../d2/d1/userexts_8c.html#a259a152">GF_MENUTYPE</a>,
01402     <a class="code" href="../../d2/d1/userexts_8c.html#a259a153">GF_MENUSTATE</a>,
01403     <a class="code" href="../../d2/d1/userexts_8c.html#a259a154">GF_CURSORF</a>,
01404     <a class="code" href="../../d2/d1/userexts_8c.html#a259a155">GF_MON</a>,
01405     <a class="code" href="../../d2/d1/userexts_8c.html#a259a156">GF_SI</a>,
01406     <a class="code" href="../../d2/d1/userexts_8c.html#a259a157">GF_RIP</a>,
01407     <a class="code" href="../../d2/d1/userexts_8c.html#a259a158">GF_SRVI</a>,
01408     <a class="code" href="../../d2/d1/userexts_8c.html#a259a159">GF_PROP</a>,
01409     <a class="code" href="../../d2/d1/userexts_8c.html#a259a160">GF_UPM0</a>,
01410     <a class="code" href="../../d2/d1/userexts_8c.html#a259a161">GF_KI</a>,
01411     <a class="code" href="../../d2/d1/userexts_8c.html#a259a162">GF_MI</a>,
01412     <a class="code" href="../../d2/d1/userexts_8c.html#a259a163">GF_DS</a>,
01413     <a class="code" href="../../d2/d1/userexts_8c.html#a259a164">GF_WS</a>,
01414     <a class="code" href="../../d2/d1/userexts_8c.html#a259a165">GF_ES</a>,
01415     <a class="code" href="../../d2/d1/userexts_8c.html#a259a166">GF_BS</a>,
01416     <a class="code" href="../../d2/d1/userexts_8c.html#a259a167">GF_CBS</a>,
01417     <a class="code" href="../../d2/d1/userexts_8c.html#a259a168">GF_SS</a>,
01418     <a class="code" href="../../d2/d1/userexts_8c.html#a259a169">GF_LBS</a>,
01419     <a class="code" href="../../d2/d1/userexts_8c.html#a259a170">GF_SBS</a>,
01420     <a class="code" href="../../d2/d1/userexts_8c.html#a259a171">GF_WSEX</a>,
01421     <a class="code" href="../../d2/d1/userexts_8c.html#a259a172">GF_CLIENTIMC</a>,
01422     <a class="code" href="../../d2/d1/userexts_8c.html#a259a173">GF_CONVERSION</a>,
01423     <a class="code" href="../../d2/d1/userexts_8c.html#a259a174">GF_SENTENCE</a>,
01424     <a class="code" href="../../d2/d1/userexts_8c.html#a259a175">GF_IMEINIT</a>,
01425     <a class="code" href="../../d2/d1/userexts_8c.html#a259a176">GF_IMEDIRTY</a>,
01426     <a class="code" href="../../d2/d1/userexts_8c.html#a259a177">GF_IMECOMPFORM</a>,
01427     <a class="code" href="../../d2/d1/userexts_8c.html#a259a178">GF_EDUNDO</a>,
01428     <a class="code" href="../../d2/d1/userexts_8c.html#a259a179">GF_DIAF</a>,
01429 
01430     <a class="code" href="../../d2/d1/userexts_8c.html#a259a180">GF_LPK</a>,
01431     <a class="code" href="../../d2/d1/userexts_8c.html#a259a181">GF_MAX</a>
01432 };
01433 
<a name="l01434"></a><a class="code" href="../../d2/d1/userexts_8c.html#a123">01434</a> LPCSTR* <a class="code" href="../../d2/d1/userexts_8c.html#a123">aapszFlag</a>[<a class="code" href="../../d2/d1/userexts_8c.html#a259a181">GF_MAX</a>] = {
01435     <a class="code" href="../../d2/d1/userexts_8c.html#a76">apszSmsFlags</a>,
01436     <a class="code" href="../../d2/d1/userexts_8c.html#a77">apszTifFlags</a>,
01437     <a class="code" href="../../d2/d1/userexts_8c.html#a78">apszQsFlags</a>,
01438     <a class="code" href="../../d2/d1/userexts_8c.html#a79">apszMfFlags</a>,
01439     <a class="code" href="../../d2/d1/userexts_8c.html#a80">apszCsfFlags</a>,
01440     <a class="code" href="../../d2/d1/userexts_8c.html#a81">apszCsFlags</a>,
01441     <a class="code" href="../../d2/d1/userexts_8c.html#a82">apszQfFlags</a>,
01442     <a class="code" href="../../d2/d1/userexts_8c.html#a83">apszW32pfFlags</a>,
01443     <a class="code" href="../../d2/d1/userexts_8c.html#a84">apszHeFlags</a>,
01444     <a class="code" href="../../d2/d1/userexts_8c.html#a85">apszHdataFlags</a>,
01445     <a class="code" href="../../d2/d1/userexts_8c.html#a86">apszXiFlags</a>,
01446     <a class="code" href="../../d2/d1/userexts_8c.html#a87">apszIifFlags</a>,
01447     <a class="code" href="../../d2/d1/userexts_8c.html#a88">apszTmrfFlags</a>,
01448     <a class="code" href="../../d2/d1/userexts_8c.html#a89">apszSbFlags</a>,
01449     <a class="code" href="../../d2/d1/userexts_8c.html#a90">apszCSFlags</a>,
01450     <a class="code" href="../../d2/d1/userexts_8c.html#a91">apszMenuTypeFlags</a>,
01451     <a class="code" href="../../d2/d1/userexts_8c.html#a92">apszMenuStateFlags</a>,
01452     <a class="code" href="../../d2/d1/userexts_8c.html#a93">apszCursorfFlags</a>,
01453     <a class="code" href="../../d2/d1/userexts_8c.html#a94">apszMonfFlags</a>,
01454     <a class="code" href="../../d2/d1/userexts_8c.html#a95">apszSifFlags</a>,
01455     <a class="code" href="../../d2/d1/userexts_8c.html#a96">apszRipFlags</a>,
01456     <a class="code" href="../../d2/d1/userexts_8c.html#a97">apszSRVIFlags</a>,
01457     <a class="code" href="../../d2/d1/userexts_8c.html#a98">apszPROPFlags</a>,
01458     <a class="code" href="../../d2/d1/userexts_8c.html#a100">aszUserPreferencesMask0</a>,
01459     <a class="code" href="../../d2/d1/userexts_8c.html#a102">aszKeyEventFlags</a>,
01460     <a class="code" href="../../d2/d1/userexts_8c.html#a103">aszMouseEventFlags</a>,
01461     <a class="code" href="../../d2/d1/userexts_8c.html#a105">aszDialogStyle</a>,
01462     <a class="code" href="../../d2/d1/userexts_8c.html#a104">aszWindowStyle</a>,
01463     <a class="code" href="../../d2/d1/userexts_8c.html#a110">aszEditStyle</a>,
01464     <a class="code" href="../../d2/d1/userexts_8c.html#a106">aszButtonStyle</a>,
01465     <a class="code" href="../../d2/d1/userexts_8c.html#a107">aszComboBoxStyle</a>,
01466     <a class="code" href="../../d2/d1/userexts_8c.html#a108">aszStaticStyle</a>,
01467     <a class="code" href="../../d2/d1/userexts_8c.html#a109">aszListBoxStyle</a>,
01468     <a class="code" href="../../d2/d1/userexts_8c.html#a111">aszScrollBarStyle</a>,
01469     <a class="code" href="../../d2/d1/userexts_8c.html#a112">aszWindowExStyle</a>,
01470     <a class="code" href="../../d2/d1/userexts_8c.html#a113">aszClientImcFlags</a>,
01471     <a class="code" href="../../d2/d1/userexts_8c.html#a114">aszConversionModes</a>,
01472     <a class="code" href="../../d2/d1/userexts_8c.html#a115">aszSentenceModes</a>,
01473     <a class="code" href="../../d2/d1/userexts_8c.html#a116">aszImeInit</a>,
01474     <a class="code" href="../../d2/d1/userexts_8c.html#a119">aszImeDirtyFlags</a>,
01475     <a class="code" href="../../d2/d1/userexts_8c.html#a120">aszImeCompFormFlags</a>,
01476     <a class="code" href="../../d2/d1/userexts_8c.html#a121">aszEdUndoType</a>,
01477     <a class="code" href="../../d2/d1/userexts_8c.html#a122">aszDeviceInfoActionFlags</a>,
01478 
01479     <a class="code" href="../../d2/d1/userexts_8c.html#a99">apszLpkEntryPoints</a>,
01480 };
01481 
01482 
01483 <span class="comment">/************************************************************************\</span>
01484 <span class="comment">* Procedure: GetFlags</span>
01485 <span class="comment">*</span>
01486 <span class="comment">* Description:</span>
01487 <span class="comment">*</span>
01488 <span class="comment">* Converts a 32bit set of flags into an appropriate string.</span>
01489 <span class="comment">* pszBuf should be large enough to hold this string, no checks are done.</span>
01490 <span class="comment">* pszBuf can be NULL, allowing use of a local static buffer but note that</span>
01491 <span class="comment">* this is not reentrant.</span>
01492 <span class="comment">* Output string has the form: "FLAG1 | FLAG2 ..." or "0"</span>
01493 <span class="comment">*</span>
01494 <span class="comment">* Returns: pointer to given or static buffer with string in it.</span>
01495 <span class="comment">*</span>
01496 <span class="comment">* 6/9/1995 Created SanfordS</span>
01497 <span class="comment">*</span>
01498 <span class="comment">\************************************************************************/</span>
<a name="l01499"></a><a class="code" href="../../d2/d1/userexts_8c.html#a191">01499</a> LPSTR <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(
01500     WORD    wType,
01501     DWORD   dwFlags,
01502     LPSTR   pszBuf,
01503     BOOL    fPrintZero)
01504 {
01505     <span class="keyword">static</span> <span class="keywordtype">char</span> szT[512];
01506     WORD i;
01507     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fFirst = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01508     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fNoMoreNames = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01509     LPCSTR *apszFlags;
01510     LPSTR apszFlagNames[<span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) * 8], pszT;
01511     <span class="keyword">const</span> <span class="keywordtype">char</span>** ppszNextFlag;
01512     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uFlagsCount, uNextFlag;
01513     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwUnnamedFlags, dwLoopFlag;
01514     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwShiftBits;
01515     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOrigFlags;
01516 
01517     <span class="keywordflow">if</span> (pszBuf == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01518         pszBuf = szT;
01519     }
01520     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/userexts_8c.html#a62">bShowFlagNames</a>) {
01521         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(pszBuf, <span class="stringliteral">"%x"</span>, <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>);
01522         <span class="keywordflow">return</span> pszBuf;
01523     }
01524 
01525     <span class="keywordflow">if</span> (wType &gt;= <a class="code" href="../../d2/d1/userexts_8c.html#a259a181">GF_MAX</a>) {
01526         strcpy(pszBuf, <span class="stringliteral">"Invalid flag type."</span>);
01527         <span class="keywordflow">return</span> pszBuf;
01528     }
01529 
01530     <span class="comment">/*</span>
01531 <span class="comment">     * Initialize output buffer and names array</span>
01532 <span class="comment">     */</span>
01533     *pszBuf = <span class="charliteral">'\0'</span>;
01534     RtlZeroMemory(apszFlagNames, <span class="keyword">sizeof</span>(apszFlagNames));
01535 
01536     apszFlags = <a class="code" href="../../d2/d1/userexts_8c.html#a123">aapszFlag</a>[wType];
01537 
01538     <span class="comment">/*</span>
01539 <span class="comment">     * Build a sorted array containing the names of the flags in dwFlags</span>
01540 <span class="comment">     */</span>
01541     uFlagsCount = 0;
01542     dwUnnamedFlags = dwOrigFlags = <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
01543     dwLoopFlag = 1;
01544     dwShiftBits = 0;
01545 
01546 reentry:
01547     <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &gt;&gt;= 1, i++, dwLoopFlag &lt;&lt;= 1, ++dwShiftBits) {
01548         <span class="keyword">const</span> <span class="keywordtype">char</span>* lpszFlagName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01549 
01550         <span class="comment">/*</span>
01551 <span class="comment">         * Bail if we reached the end of the flag names array</span>
01552 <span class="comment">         */</span>
01553         <span class="keywordflow">if</span> (apszFlags[i] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01554             <span class="keywordflow">break</span>;
01555         }
01556 
01557         <span class="keywordflow">if</span> (apszFlags[i] == <a class="code" href="../../d2/d1/userexts_8c.html#a38">_MASKENUM_START</a>) {
01558             <span class="comment">//</span>
01559             <span class="comment">// Masked enumerative items.</span>
01560             <span class="comment">//</span>
01561             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> en = 0;
01562             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwMask = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(ULONG_PTR)apszFlags[++i];
01563 
01564             <span class="comment">// First, clear up the handled bits.</span>
01565             dwUnnamedFlags &amp;= ~dwMask;
01566             lpszFlagName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01567             <span class="keywordflow">for</span> (++i; apszFlags[i] != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; apszFlags[i] != <a class="code" href="../../d2/d1/userexts_8c.html#a39">_MASKENUM_END</a>; ++i, ++en) {
01568                 <span class="keywordflow">if</span> ((dwOrigFlags &amp; dwMask) == (en &lt;&lt; dwShiftBits )) {
01569                     <span class="keywordflow">if</span> (apszFlags[i] != <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>) {
01570                         lpszFlagName = apszFlags[i];
01571                     }
01572                 }
01573             }
01574             <span class="comment">//</span>
01575             <span class="comment">// Shift the bits and get ready for the next item.</span>
01576             <span class="comment">// Next item right after _MASKENUM_END holds the bits to shift.</span>
01577             <span class="comment">//</span>
01578             <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &gt;&gt;= (<span class="keywordtype">int</span>)(ULONG_PTR)apszFlags[++i] - 1;
01579             dwLoopFlag &lt;&lt;= (<span class="keywordtype">int</span>)(ULONG_PTR)apszFlags[i] - 1;
01580             dwShiftBits += (<span class="keywordtype">int</span>)(ULONG_PTR)apszFlags[i] - 1;
01581             <span class="keywordflow">if</span> (lpszFlagName == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01582                 <span class="comment">//</span>
01583                 <span class="comment">// Could not find the match. Skip to the next item.</span>
01584                 <span class="comment">//</span>
01585                 <span class="keywordflow">continue</span>;
01586             }
01587         }
01588         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (apszFlags[i] == <a class="code" href="../../d2/d1/userexts_8c.html#a41">_CONTINUE_ON</a>) {
01589             <span class="comment">//</span>
01590             <span class="comment">// Refer the other item array. Pointer to the array is stored at [i+1].</span>
01591             <span class="comment">//</span>
01592             apszFlags = (LPSTR*)apszFlags[i + 1];
01593             <span class="keywordflow">goto</span> reentry;
01594         }
01595         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (apszFlags[i] == <a class="code" href="../../d2/d1/userexts_8c.html#a40">_SHIFT_BITS</a>) {
01596             <span class="comment">//</span>
01597             <span class="comment">// To save some space, just shift some bits..</span>
01598             <span class="comment">//</span>
01599             <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &gt;&gt;= (<span class="keywordtype">int</span>)(ULONG_PTR)apszFlags[++i] - 1;
01600             dwLoopFlag &lt;&lt;= (<span class="keywordtype">int</span>)(ULONG_PTR)apszFlags[i] - 1;
01601             dwShiftBits += (<span class="keywordtype">int</span>)(ULONG_PTR)apszFlags[i] - 1;
01602             <span class="keywordflow">continue</span>;
01603         }
01604         <span class="keywordflow">else</span> {
01605             <span class="comment">/*</span>
01606 <span class="comment">             * continue if this bit is not set or we don't have a name for it</span>
01607 <span class="comment">             */</span>
01608             <span class="keywordflow">if</span> (!(<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; 1) || (apszFlags[i] == <a class="code" href="../../d7/d4/conexts_8c.html#a6">NO_FLAG</a>)) {
01609                 <span class="keywordflow">continue</span>;
01610             }
01611             lpszFlagName = apszFlags[i];
01612         }
01613 
01614         <span class="comment">/*</span>
01615 <span class="comment">         * Find the sorted position where this name should go</span>
01616 <span class="comment">         */</span>
01617         ppszNextFlag = apszFlagNames;
01618         uNextFlag = 0;
01619         <span class="keywordflow">while</span> (uNextFlag &lt; uFlagsCount) {
01620             <span class="keywordflow">if</span> (strcmp(*ppszNextFlag, lpszFlagName) &gt; 0) {
01621                 <span class="keywordflow">break</span>;
01622             }
01623             ppszNextFlag++;
01624             uNextFlag++;
01625         }
01626         <span class="comment">/*</span>
01627 <span class="comment">         * Insert the new name</span>
01628 <span class="comment">         */</span>
01629         RtlMoveMemory((<span class="keywordtype">char</span>*)(ppszNextFlag + 1), ppszNextFlag, (uFlagsCount - uNextFlag) * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>));
01630         *ppszNextFlag = lpszFlagName;
01631         uFlagsCount++;
01632         <span class="comment">/*</span>
01633 <span class="comment">         * We got a name so clear it from the unnamed bits.</span>
01634 <span class="comment">         */</span>
01635         dwUnnamedFlags &amp;= ~dwLoopFlag;
01636     }
01637 
01638     <span class="comment">/*</span>
01639 <span class="comment">     * Build the string now</span>
01640 <span class="comment">     */</span>
01641     ppszNextFlag = apszFlagNames;
01642     pszT = pszBuf;
01643     <span class="comment">/*</span>
01644 <span class="comment">     * Add the first name</span>
01645 <span class="comment">     */</span>
01646     <span class="keywordflow">if</span> (uFlagsCount &gt; 0) {
01647         pszT += <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(pszT, <span class="stringliteral">"%s"</span>, *ppszNextFlag++);
01648         uFlagsCount--;
01649     }
01650     <span class="comment">/*</span>
01651 <span class="comment">     * Concatenate all other names with " |"</span>
01652 <span class="comment">     */</span>
01653     <span class="keywordflow">while</span> (uFlagsCount &gt; 0) {
01654         pszT += <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(pszT, <span class="stringliteral">" | %s"</span>, *ppszNextFlag++);
01655         uFlagsCount--;
01656     }
01657     <span class="comment">/*</span>
01658 <span class="comment">     * If there are unamed bits, add them at the end</span>
01659 <span class="comment">     */</span>
01660     <span class="keywordflow">if</span> (dwUnnamedFlags != 0) {
01661         pszT += <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(pszT, <span class="stringliteral">" | %#lx"</span>, dwUnnamedFlags);
01662     }
01663     <span class="comment">/*</span>
01664 <span class="comment">     * Print zero if needed and asked to do so</span>
01665 <span class="comment">     */</span>
01666     <span class="keywordflow">if</span> (fPrintZero &amp;&amp; (pszT == pszBuf)) {
01667         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(pszBuf, <span class="stringliteral">"0"</span>);
01668     }
01669 
01670     <span class="keywordflow">return</span> pszBuf;
01671 }
01672 
01674 <span class="comment">//</span>
01675 <span class="comment">// Enumerated items with mask</span>
01676 <span class="comment">//</span>
01678 <span class="comment"></span>
<a name="l01679"></a><a class="code" href="../../d0/d9/structEnumItem.html">01679</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l01680"></a><a class="code" href="../../d0/d9/structEnumItem.html#o0">01680</a>     LPCSTR  name;
<a name="l01681"></a><a class="code" href="../../d0/d9/structEnumItem.html#o1">01681</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   value;
01682 } <a class="code" href="../../d0/d9/structEnumItem.html">EnumItem</a>;
01683 
<a name="l01684"></a><a class="code" href="../../d2/d1/userexts_8c.html#a46">01684</a> <span class="preprocessor">#define EITEM(a)     { #a, a }</span>
01685 <span class="preprocessor"></span>
<a name="l01686"></a><a class="code" href="../../d2/d1/userexts_8c.html#a124">01686</a> <span class="keyword">const</span> <a class="code" href="../../d0/d9/structEnumItem.html">EnumItem</a> <a class="code" href="../../d2/d1/userexts_8c.html#a124">aClsTypes</a>[] = {
01687     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a68">ICLS_BUTTON</a>),
01688     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a69">ICLS_EDIT</a>),
01689     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a70">ICLS_STATIC</a>),
01690     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a71">ICLS_LISTBOX</a>),
01691     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a72">ICLS_SCROLLBAR</a>),
01692     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a73">ICLS_COMBOBOX</a>),
01693     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a74">ICLS_CTL_MAX</a>),
01694     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a75">ICLS_DESKTOP</a>),
01695     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a76">ICLS_DIALOG</a>),
01696     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a77">ICLS_MENU</a>),
01697     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a78">ICLS_SWITCH</a>),
01698     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a79">ICLS_ICONTITLE</a>),
01699     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a80">ICLS_MDICLIENT</a>),
01700     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a81">ICLS_COMBOLISTBOX</a>),
01701     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a82">ICLS_DDEMLEVENT</a>),
01702     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a83">ICLS_DDEMLMOTHER</a>),
01703     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a84">ICLS_DDEML16BIT</a>),
01704     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a85">ICLS_DDEMLCLIENTA</a>),
01705     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a86">ICLS_DDEMLCLIENTW</a>),
01706     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a87">ICLS_DDEMLSERVERA</a>),
01707     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a88">ICLS_DDEMLSERVERW</a>),
01708     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a89">ICLS_IME</a>),
01709     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a90">ICLS_TOOLTIP</a>),
01710     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01711 };
01712 
<a name="l01713"></a><a class="code" href="../../d2/d1/userexts_8c.html#a125">01713</a> <span class="keyword">const</span> <a class="code" href="../../d0/d9/structEnumItem.html">EnumItem</a> <a class="code" href="../../d2/d1/userexts_8c.html#a125">aCharSets</a>[] = {
01714     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(ANSI_CHARSET),
01715     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(DEFAULT_CHARSET),
01716     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(SYMBOL_CHARSET),
01717     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(SHIFTJIS_CHARSET),
01718     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(HANGEUL_CHARSET),
01719     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(HANGUL_CHARSET),
01720     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(GB2312_CHARSET),
01721     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(CHINESEBIG5_CHARSET),
01722     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(OEM_CHARSET),
01723     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(JOHAB_CHARSET),
01724     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(HEBREW_CHARSET),
01725     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(ARABIC_CHARSET),
01726     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(GREEK_CHARSET),
01727     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(TURKISH_CHARSET),
01728     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(VIETNAMESE_CHARSET),
01729     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(THAI_CHARSET),
01730     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(EASTEUROPE_CHARSET),
01731     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(RUSSIAN_CHARSET),
01732     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01733 };
01734 
<a name="l01735"></a><a class="code" href="../../d2/d1/userexts_8c.html#a126">01735</a> <span class="keyword">const</span> <a class="code" href="../../d0/d9/structEnumItem.html">EnumItem</a> <a class="code" href="../../d2/d1/userexts_8c.html#a126">aImeHotKeys</a>[] = {
01736     <span class="comment">// Windows for Simplified Chinese Edition hot key ID from 0x10 - 0x2F</span>
01737     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_CHOTKEY_IME_NONIME_TOGGLE),
01738     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_CHOTKEY_SHAPE_TOGGLE),
01739     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_CHOTKEY_SYMBOL_TOGGLE),
01740     <span class="comment">// Windows for Japanese Edition hot key ID from 0x30 - 0x4F</span>
01741     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_JHOTKEY_CLOSE_OPEN),
01742     <span class="comment">// Windows for Korean Edition hot key ID from 0x50 - 0x6F</span>
01743     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_KHOTKEY_SHAPE_TOGGLE),
01744     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_KHOTKEY_HANJACONVERT),
01745     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_KHOTKEY_ENGLISH),
01746     <span class="comment">// Windows for Traditional Chinese Edition hot key ID from 0x70 - 0x8F</span>
01747     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_THOTKEY_IME_NONIME_TOGGLE),
01748     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_THOTKEY_SHAPE_TOGGLE),
01749     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_THOTKEY_SYMBOL_TOGGLE),
01750     <span class="comment">// direct switch hot key ID from 0x100 - 0x11F</span>
01751     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_HOTKEY_DSWITCH_FIRST),
01752     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_HOTKEY_DSWITCH_LAST),
01753     <span class="comment">// IME private hot key from 0x200 - 0x21F</span>
01754     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_ITHOTKEY_RESEND_RESULTSTR),
01755     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_ITHOTKEY_PREVIOUS_COMPOSITION),
01756     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_ITHOTKEY_UISTYLE_TOGGLE),
01757     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_ITHOTKEY_RECONVERTSTRING),
01758     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_HOTKEY_PRIVATE_LAST),
01759     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
01760 };
01761 
<a name="l01762"></a><a class="code" href="../../d2/d1/userexts_8c.html#a127">01762</a> <span class="keyword">const</span> <a class="code" href="../../d0/d9/structEnumItem.html">EnumItem</a> <a class="code" href="../../d2/d1/userexts_8c.html#a127">aCandidateListStyle</a>[] = {
01763     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_CAND_UNKNOWN),<span class="comment">//                0x0000</span>
01764     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_CAND_READ),<span class="comment">//                   0x0001</span>
01765     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_CAND_CODE),<span class="comment">//                   0x0002</span>
01766     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_CAND_MEANING),<span class="comment">//                0x0003</span>
01767     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_CAND_RADICAL),<span class="comment">//                0x0004</span>
01768     <a class="code" href="../../d2/d1/userexts_8c.html#a46">EITEM</a>(IME_CAND_STROKE),<span class="comment">//                 0x0005</span>
01769     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>
01770 };
01771 
01772 
01773 
01774 <span class="keyword">enum</span> {
01775     <a class="code" href="../../d2/d1/userexts_8c.html#a260a182">EI_CLSTYPE</a> = 0,
01776     <a class="code" href="../../d2/d1/userexts_8c.html#a260a183">EI_CHARSETTYPE</a>,
01777     <a class="code" href="../../d2/d1/userexts_8c.html#a260a184">EI_IMEHOTKEYTYPE</a>,
01778     <a class="code" href="../../d2/d1/userexts_8c.html#a260a185">EI_IMECANDIDATESTYLE</a>,
01779     <a class="code" href="../../d2/d1/userexts_8c.html#a260a186">EI_MAX</a>
01780 };
01781 
<a name="l01782"></a><a class="code" href="../../d5/d9/structMaskedEnum.html">01782</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l01783"></a><a class="code" href="../../d5/d9/structMaskedEnum.html#o0">01783</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwMask;
<a name="l01784"></a><a class="code" href="../../d5/d9/structMaskedEnum.html#o1">01784</a>     <span class="keyword">const</span> <a class="code" href="../../d0/d9/structEnumItem.html">EnumItem</a>* items;
01785 } <a class="code" href="../../d5/d9/structMaskedEnum.html">MaskedEnum</a>;
01786 
<a name="l01787"></a><a class="code" href="../../d2/d1/userexts_8c.html#a128">01787</a> <span class="keyword">const</span> <a class="code" href="../../d5/d9/structMaskedEnum.html">MaskedEnum</a> <a class="code" href="../../d2/d1/userexts_8c.html#a128">aEnumItems</a>[] = {
01788     ~0,             <a class="code" href="../../d2/d1/userexts_8c.html#a124">aClsTypes</a>,
01789     ~0,             <a class="code" href="../../d2/d1/userexts_8c.html#a125">aCharSets</a>,
01790     ~0,             <a class="code" href="../../d2/d1/userexts_8c.html#a126">aImeHotKeys</a>,
01791     ~0,             <a class="code" href="../../d2/d1/userexts_8c.html#a127">aCandidateListStyle</a>,
01792 };
01793 
<a name="l01794"></a><a class="code" href="../../d2/d1/userexts_8c.html#a202">01794</a> LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a202">GetMaskedEnum</a>(WORD wType, DWORD dwValue, LPSTR buf)
01795 {
01796     <span class="keyword">const</span> <a class="code" href="../../d0/d9/structEnumItem.html">EnumItem</a>* item;
01797     <span class="keyword">static</span> <span class="keywordtype">char</span> ach[32];
01798 
01799     <span class="keywordflow">if</span> (wType &gt;= <a class="code" href="../../d2/d1/userexts_8c.html#a260a186">EI_MAX</a>) {
01800         strcpy(buf, <span class="stringliteral">"Invalid type."</span>);
01801         <span class="keywordflow">return</span> buf;
01802     }
01803 
01804     dwValue &amp;= <a class="code" href="../../d2/d1/userexts_8c.html#a128">aEnumItems</a>[wType].<a class="code" href="../../d5/d9/structMaskedEnum.html#o0">dwMask</a>;
01805 
01806     item = <a class="code" href="../../d2/d1/userexts_8c.html#a128">aEnumItems</a>[wType].<a class="code" href="../../d5/d9/structMaskedEnum.html#o1">items</a>;
01807 
01808     <span class="keywordflow">for</span> (; item-&gt;<a class="code" href="../../d0/d9/structEnumItem.html#o0">name</a>; ++item) {
01809         <span class="keywordflow">if</span> (item-&gt;<a class="code" href="../../d0/d9/structEnumItem.html#o1">value</a> == dwValue) {
01810             <span class="keywordflow">if</span> (buf) {
01811                 strcpy(buf, item-&gt;<a class="code" href="../../d0/d9/structEnumItem.html#o0">name</a>);
01812                 <span class="keywordflow">return</span> buf;
01813             }
01814             <span class="keywordflow">return</span> item-&gt;<a class="code" href="../../d0/d9/structEnumItem.html#o0">name</a>;
01815         }
01816     }
01817 
01818     <span class="keywordflow">if</span> (buf) {
01819         *buf = 0;
01820         <span class="keywordflow">return</span> buf;
01821     }
01822 
01823     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"%x"</span>, wType);
01824     <span class="keywordflow">return</span> ach;
01825 }
01826 
<a name="l01827"></a><a class="code" href="../../d2/d1/userexts_8c.html#a47">01827</a> <span class="preprocessor">#define WM_ITEM(x)  { x, #x }</span>
01828 <span class="preprocessor"></span>
01829 <span class="keyword">struct </span>{
<a name="l01830"></a><a class="code" href="../../d2/d1/userexts_8c.html#a129">01830</a>     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
<a name="l01831"></a><a class="code" href="../../d2/d1/userexts_8c.html#a130">01831</a>     LPSTR <a class="code" href="../../d2/d1/userexts_8c.html#a130">pszMsg</a>;
01832 } <a class="code" href="../../d2/d1/userexts_8c.html#a131">gaMsgs</a>[] = {
01833 <span class="preprocessor">    #include "wm.txt"</span>
01834 };
01835 
01836 <span class="preprocessor">#undef WM_ITEM</span>
01837 <span class="preprocessor"></span>
01838 
01839 <span class="preprocessor">#ifdef KERNEL</span>
01840 <span class="preprocessor"></span>
01841 <a class="code" href="../../d1/d0/inc_2user_8h.html#a906">PETHREAD</a> (*GetCurrentThreadAddress)(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>, HANDLE) = DummyGetCurrentThreadAddress;
01842 
01843 <span class="comment">/************************************************************************\</span>
01844 <span class="comment">* Procedure: DummyGetCurrentThreadAddress</span>
01845 <span class="comment">*</span>
01846 <span class="comment">* Description:</span>
01847 <span class="comment">*</span>
01848 <span class="comment">* Calls out to the default debug extension dll to get the current thread.</span>
01849 <span class="comment">*</span>
01850 <span class="comment">* Returns: pEThread of current thread.</span>
01851 <span class="comment">*</span>
01852 <span class="comment">* 6/9/1995 Created SanfordS</span>
01853 <span class="comment">*</span>
01854 <span class="comment">\************************************************************************/</span>
01855 <span class="comment">/*</span>
01856 <span class="comment"> */</span>
01857 <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>
01858 DummyGetCurrentThreadAddress(
01859     USHORT Processor,
01860     HANDLE hCurrentThread
01861     )
01862 {
01863     WCHAR awchKDName[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
01864     LPWSTR lpszKDExts;
01865     HANDLE hmodKDExts;
01866 
01867     <span class="comment">/*</span>
01868 <span class="comment">     * Get the kernel debugger name and map it to its</span>
01869 <span class="comment">     * debug extension dll.</span>
01870 <span class="comment">     */</span>
01871     GetModuleFileNameW(NULL, awchKDName, MAX_PATH);
01872     _wcslwr(awchKDName);
01873     <span class="keywordflow">if</span> (wcsstr(awchKDName, L<span class="stringliteral">"alphakd.exe"</span>))
01874         lpszKDExts = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"kdextalp.dll"</span>;
01875     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wcsstr(awchKDName, L<span class="stringliteral">"i386kd.exe"</span>))
01876         lpszKDExts = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"kdextx86.dll"</span>;
01877     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wcsstr(awchKDName, L<span class="stringliteral">"mipskd.exe"</span>))
01878         lpszKDExts = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"kdextmip.dll"</span>;
01879     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wcsstr(awchKDName, L<span class="stringliteral">"ppckd.exe"</span>))
01880         lpszKDExts = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"kdextppc.dll"</span>;
01881     <span class="keywordflow">else</span> {
01882         Print(<span class="stringliteral">"Unknown kernel debugger: %s\n"</span>, awchKDName);
01883         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01884     }
01885 
01886     <span class="comment">/*</span>
01887 <span class="comment">     * Load the extension dll and get the real procedure name</span>
01888 <span class="comment">     */</span>
01889     hmodKDExts = LoadLibraryW(lpszKDExts);
01890     <span class="keywordflow">if</span> (hmodKDExts == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01891         Print(<span class="stringliteral">"Could not load %s\n"</span>, lpszKDExts);
01892         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01893     }
01894     GetCurrentThreadAddress = (PVOID)GetProcAddress(hmodKDExts, <span class="stringliteral">"GetCurrentThreadAddress"</span>);
01895     <span class="keywordflow">if</span> (GetCurrentThreadAddress == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01896         Print(<span class="stringliteral">"Could not find GetCurrentThreadAddress\n"</span>);
01897         FreeLibrary(hmodKDExts);
01898         GetCurrentThreadAddress = DummyGetCurrentThreadAddress;
01899         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01900     }
01901 
01902     <span class="comment">/*</span>
01903 <span class="comment">     * Make the call</span>
01904 <span class="comment">     */</span>
01905     <span class="keywordflow">return</span> GetCurrentThreadAddress(Processor, hCurrentThread);
01906 }
01907 
01908 
01909 
01910 <span class="comment">/************************************************************************\</span>
01911 <span class="comment">* Procedure: GetCurrentProcessAddress</span>
01912 <span class="comment">*</span>
01913 <span class="comment">* Description:</span>
01914 <span class="comment">*</span>
01915 <span class="comment">* Returns: Current EProcess pointer.</span>
01916 <span class="comment">*</span>
01917 <span class="comment">* 6/9/1995 Created SanfordS</span>
01918 <span class="comment">*</span>
01919 <span class="comment">\************************************************************************/</span>
01920 <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>
01921 GetCurrentProcessAddress(
01922     DWORD    Processor,
01923     HANDLE   hCurrentThread,
01924     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> CurrentThread
01925     )
01926 {
01927     <a class="code" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a> Thread;
01928 
01929     <span class="keywordflow">if</span> (CurrentThread == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01930         CurrentThread = (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)GetCurrentThreadAddress( (USHORT)Processor, hCurrentThread );
01931         <span class="keywordflow">if</span> (CurrentThread == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01932             DEBUGPRINT(<span class="stringliteral">"GetCurrentProcessAddress: failed to get thread addr.\n"</span>);
01933             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01934         }
01935     }
01936 
01937     <span class="keywordflow">if</span> (!tryMove(Thread, CurrentThread)) {
01938         DEBUGPRINT(<span class="stringliteral">"GetCurrentProcessAddress: failed to read thread memory.\n"</span>);
01939         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01940     }
01941 
01942     <span class="keywordflow">return</span> CONTAINING_RECORD(Thread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o1">Process</a>,<a class="code" href="../../d0/d4/struct__EPROCESS.html">EPROCESS</a>,Pcb);
01943 }
01944 
01945 <span class="comment">/************************************************************************\</span>
01946 <span class="comment">* Procedure: GetProcessName</span>
01947 <span class="comment">*</span>
01948 <span class="comment">* 06/27/97 GerardoB Created</span>
01949 <span class="comment">*</span>
01950 <span class="comment">\************************************************************************/</span>
01951 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01952 GetProcessName(
01953     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> pEProcess,
01954     LPWSTR lpBuffer)
01955 {
01956     UCHAR ImageFileName[16];
01957     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(pEProcess, PROCESS_IMAGEFILENAME, ImageFileName)) {
01958         swprintf(lpBuffer, L<span class="stringliteral">"%.16hs"</span>, ImageFileName);
01959         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01960     } <span class="keywordflow">else</span> {
01961         Print(<span class="stringliteral">"Unable to read _EPROCESS at %lx\n"</span>, pEProcess);
01962         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01963     }
01964 }
01965 
01966 <span class="comment">/************************************************************************\</span>
01967 <span class="comment">* Procedure: GetAppName</span>
01968 <span class="comment">*</span>
01969 <span class="comment">* Description:</span>
01970 <span class="comment">*</span>
01971 <span class="comment">* Returns: TRUE for success, FALSE for failure.</span>
01972 <span class="comment">*</span>
01973 <span class="comment">* 10/6/1995 Created JimA</span>
01974 <span class="comment">*</span>
01975 <span class="comment">\************************************************************************/</span>
01976 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
01977 GetAppName(
01978     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> pEThread,
01979     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti,
01980     LPWSTR lpBuffer,
01981     DWORD cbBuffer)
01982 {
01983     PUNICODE_STRING pstrAppName;
01984     UNICODE_STRING strAppName;
01985     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fRead = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01986 
01987     <span class="keywordflow">if</span> (pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o10">pstrAppName</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01988         pstrAppName = pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o10">pstrAppName</a>;
01989         <span class="keywordflow">if</span> (pstrAppName != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; tryMove(strAppName, pstrAppName)) {
01990             cbBuffer = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(cbBuffer - <span class="keyword">sizeof</span>(WCHAR), strAppName.Length);
01991             <span class="keywordflow">if</span> (tryMoveBlock(lpBuffer, strAppName.Buffer, cbBuffer)) {
01992                 lpBuffer[cbBuffer / <span class="keyword">sizeof</span>(WCHAR)] = 0;
01993                 fRead = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01994             }
01995         }
01996     } <span class="keywordflow">else</span> {
01997         fRead = GetProcessName(pEThread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o28">ThreadsProcess</a>, lpBuffer);
01998     }
01999 
02000     <span class="keywordflow">if</span> (!fRead) {
02001         wcsncpy(lpBuffer, L<span class="stringliteral">"&lt;unknown name&gt;"</span>, cbBuffer / <span class="keyword">sizeof</span>(WCHAR));
02002     }
02003     <span class="keywordflow">return</span> fRead;
02004 }
02005 
02006 <span class="preprocessor">#endif // KERNEL</span>
02007 <span class="preprocessor"></span>
02008 
02009 <span class="preprocessor">#ifdef KERNEL</span>
02010 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
02011 <span class="comment">* Procedure: PrintMessages</span>
02012 <span class="comment">*</span>
02013 <span class="comment">* Description: Prints out qmsg structures.</span>
02014 <span class="comment">*</span>
02015 <span class="comment">* Returns: fSuccess</span>
02016 <span class="comment">*</span>
02017 <span class="comment">* 6/9/1995 Created SanfordS</span>
02018 <span class="comment">*</span>
02019 <span class="comment">\************************************************************************/</span>
02020 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> PrintMessages(
02021     <a class="code" href="../../d8/d4/structtagQMSG.html">PQMSG</a> pqmsgRead)
02022 {
02023     <a class="code" href="../../d8/d4/structtagQMSG.html">QMSG</a> qmsg;
02024     <a class="code" href="../../d5/d8/structtagASYNCSENDMSG.html">ASYNCSENDMSG</a> <span class="keyword">asm</span>;
02025     <span class="keywordtype">char</span> *aszEvents[] = {
02026         <span class="stringliteral">"MSG"</span>,  <span class="comment">// QEVENT_MESSAGE</span>
02027         <span class="stringliteral">"SHO"</span>,  <span class="comment">// QEVENT_SHOWWINDOW"</span>
02028         <span class="stringliteral">"CMD"</span>,  <span class="comment">// QEVENT_CANCLEMODE"</span>
02029         <span class="stringliteral">"SWP"</span>,  <span class="comment">// QEVENT_SETWINDOWPOS"</span>
02030         <span class="stringliteral">"UKS"</span>,  <span class="comment">// QEVENT_UPDATEKEYSTATE"</span>
02031         <span class="stringliteral">"DEA"</span>,  <span class="comment">// QEVENT_DEACTIVATE"</span>
02032         <span class="stringliteral">"ACT"</span>,  <span class="comment">// QEVENT_ACTIVATE"</span>
02033         <span class="stringliteral">"PST"</span>,  <span class="comment">// QEVENT_POSTMESSAGE"</span>
02034         <span class="stringliteral">"EXE"</span>,  <span class="comment">// QEVENT_EXECSHELL"</span>
02035         <span class="stringliteral">"CMN"</span>,  <span class="comment">// QEVENT_CANCELMENU"</span>
02036         <span class="stringliteral">"DSW"</span>,  <span class="comment">// QEVENT_DESTROYWINDOW"</span>
02037         <span class="stringliteral">"ASY"</span>,  <span class="comment">// QEVENT_ASYNCSENDMSG"</span>
02038         <span class="stringliteral">"HNG"</span>,  <span class="comment">// QEVENT_HUNGTHREAD"</span>
02039         <span class="stringliteral">"CMT"</span>,  <span class="comment">// QEVENT_CANCELMOUSEMOVETRK"</span>
02040         <span class="stringliteral">"NWE"</span>,  <span class="comment">// QEVENT_NOTIFYWINEVENT"</span>
02041         <span class="stringliteral">"RAC"</span>,  <span class="comment">// QEVENT_RITACCESSIBILITY"</span>
02042         <span class="stringliteral">"RSO"</span>,  <span class="comment">// QEVENT_RITSOUND"</span>
02043         <span class="stringliteral">"?  "</span>,  <span class="comment">// "?"</span>
02044         <span class="stringliteral">"?  "</span>,  <span class="comment">// "?"</span>
02045         <span class="stringliteral">"?  "</span>   <span class="comment">// "?"</span>
02046     };
02047 <span class="preprocessor">    #define NQEVENT (sizeof(aszEvents)/sizeof(aszEvents[0]))</span>
02048 <span class="preprocessor"></span>
02049     Print(<span class="stringliteral">"typ pqmsg    hwnd    msg  wParam   lParam   time     ExInfo   dwQEvent pti\n"</span>);
02050     Print(<span class="stringliteral">"-------------------------------------------------------------------------------\n"</span>);
02051 
02052     SAFEWHILE (TRUE) {
02053         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(qmsg, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(pqmsgRead));
02054         <span class="keywordflow">if</span> (qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o4">dwQEvent</a> &lt; NQEVENT)
02055             Print(<span class="stringliteral">"%s %08lx "</span>, aszEvents[qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o4">dwQEvent</a>], pqmsgRead);
02056         <span class="keywordflow">else</span>
02057             Print(<span class="stringliteral">"??? %08lx "</span>, pqmsgRead);
02058 
02059         <span class="keywordflow">switch</span> (qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o4">dwQEvent</a>) {
02060         <span class="keywordflow">case</span> <a class="code" href="../../d4/d1/userk_8h.html#a344">QEVENT_ASYNCSENDMSG</a>:
02061             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(<span class="keyword">asm</span>, (PVOID)qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o2">msg</a>.wParam);
02062 
02063             Print(<span class="stringliteral">"%07lx %04lx %08lx %08lx %08lx %08lx %08lx %08lx\n"</span>,
02064                 <span class="keyword">asm</span>.hwnd, <span class="keyword">asm</span>.message, <span class="keyword">asm</span>.wParam, <span class="keyword">asm</span>.lParam,
02065                 qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o2">msg</a>.time, qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o3">ExtraInfo</a>, qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o4">dwQEvent</a>, qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o5">pti</a>);
02066             <span class="keywordflow">break</span>;
02067 
02068         <span class="keywordflow">case</span> 0:
02069         <span class="keywordflow">default</span>:
02070             Print(<span class="stringliteral">"%07lx %04lx %08lx %08lx %08lx %08lx %08lx %08lx\n"</span>,
02071                 qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o2">msg</a>.hwnd, qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o2">msg</a>.message, qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o2">msg</a>.wParam, qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o2">msg</a>.lParam,
02072                 qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o2">msg</a>.time, qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o3">ExtraInfo</a>, qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o4">dwQEvent</a>, qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o5">pti</a>);
02073             <span class="keywordflow">break</span>;
02074 
02075         }
02076 
02077         <span class="keywordflow">if</span> (qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o0">pqmsgNext</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02078             <span class="keywordflow">if</span> (pqmsgRead == qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o0">pqmsgNext</a>) {
02079                 Print(<span class="stringliteral">"loop found in message list!"</span>);
02080                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02081             }
02082             pqmsgRead = qmsg.<a class="code" href="../../d8/d4/structtagQMSG.html#o0">pqmsgNext</a>;
02083         } <span class="keywordflow">else</span> {
02084             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02085         }
02086     }
02087     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02088 }
02089 <span class="preprocessor">#endif // KERNEL</span>
02090 <span class="preprocessor"></span>
02091 
02092 <span class="comment">/************************************************************************\</span>
02093 <span class="comment">* Procedure: GetAndDumpHE</span>
02094 <span class="comment">*</span>
02095 <span class="comment">* Description: Dumps given handle (dwT) and returns its phe.</span>
02096 <span class="comment">*</span>
02097 <span class="comment">* Returns: fSuccess</span>
02098 <span class="comment">*</span>
02099 <span class="comment">* 6/9/1995 Documented SanfordS</span>
02100 <span class="comment">*</span>
02101 <span class="comment">\************************************************************************/</span>
02102 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
02103 <a class="code" href="../../d2/d1/userexts_8c.html#a203">GetAndDumpHE</a>(
02104     ULONG_PTR dwT,
02105     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">PHE</a> phe,
02106     BOOL fPointerTest)
02107 {
02108 
02109     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dw;
02110     <a class="code" href="../../d4/d5/struct__HEAD.html">HEAD</a> head;
02111     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">PHE</a> pheT;
02112     <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">PSHAREDINFO</a> pshi;
02113     <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">SHAREDINFO</a> shi;
02114     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a> si;
02115     ULONG_PTR cHandleEntries;
02116 
02117 
02118     <span class="comment">/*</span>
02119 <span class="comment">     * Evaluate the argument string and get the address of the object to</span>
02120 <span class="comment">     * dump. Take either a handle or a pointer to the object.</span>
02121 <span class="comment">     */</span>
02122     dw = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a432">HMIndexFromHandle</a>(dwT);
02123 
02124     <span class="comment">/*</span>
02125 <span class="comment">     * First see if it is a pointer because the handle index is only part of</span>
02126 <span class="comment">     * the 32 bit DWORD, and we may mistake a pointer for a handle.</span>
02127 <span class="comment">     * HACK: If dwCurPc == 0, then we've recursed with a handle.</span>
02128 <span class="comment">     */</span>
02129     <span class="keywordflow">if</span> (!fPointerTest &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(dwT)) {
02130         head.<a class="code" href="../../d4/d5/struct__HEAD.html#o0">h</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02131         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(head, (PVOID)dwT);
02132         <span class="keywordflow">if</span> (head.<a class="code" href="../../d4/d5/struct__HEAD.html#o0">h</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02133             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a203">GetAndDumpHE</a>((ULONG_PTR)head.<a class="code" href="../../d4/d5/struct__HEAD.html#o0">h</a>, phe, TRUE)) {
02134                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02135             }
02136         }
02137     }
02138 
02139     <span class="comment">/*</span>
02140 <span class="comment">     * Is it a handle? Does it's index fit our table length?</span>
02141 <span class="comment">     */</span>
02142     <a class="code" href="../../d2/d1/userexts_8c.html#a7">GETSHAREDINFO</a>(pshi);
02143     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(shi, pshi);
02144     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(si, shi.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o0">psi</a>);
02145     cHandleEntries = si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o4">cHandleEntries</a>;
02146     <span class="keywordflow">if</span> (dw &gt;= cHandleEntries)
02147         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02148 
02149     <span class="comment">/*</span>
02150 <span class="comment">     * Grab the handle entry and see if it is ok.</span>
02151 <span class="comment">     */</span>
02152     pheT = shi.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o1">aheList</a>;
02153     pheT = &amp;pheT[dw];
02154     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(*phe, pheT);
02155 
02156     <span class="comment">/*</span>
02157 <span class="comment">     * If the type is too big, it's not a handle.</span>
02158 <span class="comment">     */</span>
02159     <span class="keywordflow">if</span> (phe-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a> &gt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>) {
02160         pheT = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02161     } <span class="keywordflow">else</span> {
02162         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(head, phe-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>);
02163         <span class="keywordflow">if</span> (phe-&gt;<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a> != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a236">TYPE_FREE</a>) {
02164             <span class="comment">/*</span>
02165 <span class="comment">             * See if the object references this handle entry: the clincher</span>
02166 <span class="comment">             * for a handle, if it is not FREE.</span>
02167 <span class="comment">             */</span>
02168             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a432">HMIndexFromHandle</a>(head.<a class="code" href="../../d4/d5/struct__HEAD.html#o0">h</a>) != dw)
02169                 pheT = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02170         }
02171     }
02172 
02173     <span class="keywordflow">if</span> (pheT == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02174         <span class="keywordflow">if</span> (!fPointerTest)
02175             Print(<span class="stringliteral">"0x%p is not a valid object or handle.\n"</span>, dwT);
02176         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02177     }
02178 
02179     <span class="comment">/*</span>
02180 <span class="comment">     * Dump the ownership info and the handle entry info</span>
02181 <span class="comment">     */</span>
02182     <a class="code" href="../../d2/d1/userexts_8c.html#a217">Idhe</a>(0, head.<a class="code" href="../../d4/d5/struct__HEAD.html#o0">h</a>, NULL);
02183     Print(<span class="stringliteral">"\n"</span>);
02184 
02185     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02186 }
02187 
02188 
02189 <span class="comment">/************************************************************************\</span>
02190 <span class="comment">* Procedure: HtoHE</span>
02191 <span class="comment">*</span>
02192 <span class="comment">* Description:</span>
02193 <span class="comment">*</span>
02194 <span class="comment">*   Extracts HE and phe from given handle.  Handle cao be just an index.</span>
02195 <span class="comment">*   Assumes h is a valid handle.  Returns FALSE only if it's totally wacko.</span>
02196 <span class="comment">*</span>
02197 <span class="comment">* Returns: fSuccess</span>
02198 <span class="comment">*</span>
02199 <span class="comment">* 6/9/1995 Created SanfordS</span>
02200 <span class="comment">*</span>
02201 <span class="comment">\************************************************************************/</span>
02202 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a192">HtoHE</a>(
02203 ULONG_PTR h,
02204 <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> *phe,
02205 <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> **pphe) <span class="comment">// Optional</span>
02206 {
02207     <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">SHAREDINFO</a> si, *psi;
02208     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a> svi;
02209     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> index;
02210 
02211     index = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a432">HMIndexFromHandle</a>(h);
02212     <a class="code" href="../../d2/d1/userexts_8c.html#a7">GETSHAREDINFO</a>(psi);
02213     <span class="keywordflow">if</span> (!tryMove(si, psi)) {
02214         DEBUGPRINT(<span class="stringliteral">"HtoHE(%x): SHAREDINFO move failed. Bad symbols?\n"</span>, h);
02215         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02216     }
02217     <span class="keywordflow">if</span> (!tryMove(svi, si.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o0">psi</a>)) {
02218         DEBUGPRINT(<span class="stringliteral">"HtoHE(%x): SERVERINFO move failed. Bad symbols?\n"</span>, h);
02219         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02220     }
02221     <span class="keywordflow">if</span> (index &gt;= svi.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o4">cHandleEntries</a>) {
02222         DEBUGPRINT(<span class="stringliteral">"HtoHE(%x): index %d is too large.\n"</span>, h, index);
02223         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02224     }
02225     <span class="keywordflow">if</span> (pphe != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02226         *pphe = &amp;si.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o1">aheList</a>[index];
02227     }
02228     <span class="keywordflow">if</span> (!tryMove(*phe, &amp;si.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o1">aheList</a>[index])) {
02229         DEBUGPRINT(<span class="stringliteral">"HtoHE(%x): aheList[%d] move failed.\n"</span>, h, index);
02230         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02231     }
02232     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02233 }
02234 
02235 
02236 <span class="comment">/************************************************************************\</span>
02237 <span class="comment">* Procedure: dbgPtoH</span>
02238 <span class="comment">*</span>
02239 <span class="comment">* Description: quick conversion of pointer to handle</span>
02240 <span class="comment">*</span>
02241 <span class="comment">* Returns: fSuccess</span>
02242 <span class="comment">*</span>
02243 <span class="comment">* 6/9/1995 Created SanfordS</span>
02244 <span class="comment">*</span>
02245 <span class="comment">\************************************************************************/</span>
02246 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a193">dbgPtoH</a>(
02247 PVOID p,
02248 ULONG_PTR *ph)
02249 {
02250     <a class="code" href="../../d1/d1/struct__THROBJHEAD.html">THROBJHEAD</a> head;
02251 
02252     <span class="keywordflow">if</span> (tryMove(head, p)) {
02253         *ph = (ULONG_PTR)head.h;
02254         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02255     }
02256     DEBUGPRINT(<span class="stringliteral">"dbgPtoH(%x): failed.\n"</span>, p);
02257     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02258 }
02259 
02260 
02261 <span class="comment">/************************************************************************\</span>
02262 <span class="comment">* Procedure: dbgHtoP</span>
02263 <span class="comment">*</span>
02264 <span class="comment">* Description: Quick conversion of handle to pointer</span>
02265 <span class="comment">*</span>
02266 <span class="comment">* Returns: fSuccess</span>
02267 <span class="comment">*</span>
02268 <span class="comment">* 6/9/1995 Created SanfordS</span>
02269 <span class="comment">*</span>
02270 <span class="comment">\************************************************************************/</span>
02271 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a194">dbgHtoP</a>(
02272 DWORD h,
02273 PVOID *pp)
02274 {
02275     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he;
02276 
02277     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a192">HtoHE</a>(h, &amp;he, NULL)) {
02278         *pp = <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>);
02279         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02280     }
02281     DEBUGPRINT(<span class="stringliteral">"dbgHtoP(%x): failed.\n"</span>, h);
02282     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02283 }
02284 
02285 
02286 <span class="comment">/************************************************************************\</span>
02287 <span class="comment">* Procedure: GetPfromH</span>
02288 <span class="comment">*</span>
02289 <span class="comment">* Description: Converts a handle to a pointer and extracts he and phe info.</span>
02290 <span class="comment">*</span>
02291 <span class="comment">* Returns: pointer for object or NULL on failure.</span>
02292 <span class="comment">*</span>
02293 <span class="comment">* 6/9/1995 Created SanfordS</span>
02294 <span class="comment">*</span>
02295 <span class="comment">\************************************************************************/</span>
02296 PVOID <a class="code" href="../../d2/d1/userexts_8c.html#a195">GetPfromH</a>(
02297 ULONG_PTR h,
02298 <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> **pphe, <span class="comment">// optional</span>
02299 <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> *phe)   <span class="comment">// optional</span>
02300 {
02301     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he, *pheT;
02302     <a class="code" href="../../d4/d5/struct__HEAD.html">HEAD</a> head;
02303 
02304     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/userexts_8c.html#a192">HtoHE</a>(h, &amp;he, &amp;pheT)) {
02305         DEBUGPRINT(<span class="stringliteral">"GetPfromH(%x): failed to get HE.\n"</span>, h);
02306         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02307     }
02308     <span class="keywordflow">if</span> (!tryMove(head, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>))) {
02309         DEBUGPRINT(<span class="stringliteral">"GetPfromH(%x): failed to get phead.\n"</span>, h);
02310         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02311     }
02312     <span class="keywordflow">if</span> (head.<a class="code" href="../../d4/d5/struct__HEAD.html#o0">h</a> != (HANDLE)h) {
02313         DEBUGPRINT(<span class="stringliteral">"WARNING: Full handle for 0x%x is 0x%08lx.\n"</span>, h, head.<a class="code" href="../../d4/d5/struct__HEAD.html#o0">h</a>);
02314     }
02315     <span class="keywordflow">if</span> (pphe != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02316         *pphe = pheT;
02317     }
02318     <span class="keywordflow">if</span> (phe != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02319         *phe = he;
02320     }
02321     <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>);
02322 }
02323 
02324 
02325 <span class="comment">/************************************************************************\</span>
02326 <span class="comment">* Procedure: getHEfromP</span>
02327 <span class="comment">*</span>
02328 <span class="comment">* Description: Converts a pointer to a handle and extracts the he and</span>
02329 <span class="comment">*   phe info.</span>
02330 <span class="comment">*</span>
02331 <span class="comment">* Returns: fSuccess</span>
02332 <span class="comment">*</span>
02333 <span class="comment">* 6/9/1995 Created SanfordS</span>
02334 <span class="comment">*</span>
02335 <span class="comment">\************************************************************************/</span>
02336 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a196">getHEfromP</a>(
02337 <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> **pphe, <span class="comment">// optional</span>
02338 <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> *phe,
02339 PVOID p)
02340 {
02341     PVOID pLookup;
02342     <a class="code" href="../../d1/d1/struct__THROBJHEAD.html">THROBJHEAD</a> head;
02343 
02344     p = <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(p);
02345     <span class="keywordflow">if</span> (!tryMove(head, p)) {
02346         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02347     }
02348 
02349     pLookup = <a class="code" href="../../d2/d1/userexts_8c.html#a195">GetPfromH</a>((ULONG_PTR)head.h, pphe, phe);
02350     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(pLookup) != p) {
02351         DEBUGPRINT(<span class="stringliteral">"getHEfromP(%x): invalid.\n"</span>, p);
02352         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02353     }
02354     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02355 }
02356 
02357 
02358 <span class="comment">/************************************************************************\</span>
02359 <span class="comment">* Procedure: HorPtoP</span>
02360 <span class="comment">*</span>
02361 <span class="comment">* Description:</span>
02362 <span class="comment">*</span>
02363 <span class="comment">* Generic function to accept either a user handle or pointer value and</span>
02364 <span class="comment">* validate it and convert it to a pointer.  type=-1 to allow any non-free</span>
02365 <span class="comment">* type.  type=-2 to allow any type.</span>
02366 <span class="comment">*</span>
02367 <span class="comment">* Returns: pointer or NULL on error.</span>
02368 <span class="comment">*</span>
02369 <span class="comment">* 6/9/1995 Created SanfordS</span>
02370 <span class="comment">*</span>
02371 <span class="comment">\************************************************************************/</span>
02372 PVOID <a class="code" href="../../d2/d1/userexts_8c.html#a197">HorPtoP</a>(
02373 PVOID p,
02374 <span class="keywordtype">int</span> type)
02375 {
02376     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he;
02377     PVOID pT;
02378 
02379     <span class="keywordflow">if</span> (p == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02380         DEBUGPRINT(<span class="stringliteral">"HorPtoP(%x, %d): failed.  got NULL.\n"</span>, p, type);
02381         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02382     }
02383 
02384     p = <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(p);
02385     <span class="keywordflow">if</span> (tryMove(pT, p) &amp;&amp; <a class="code" href="../../d2/d1/userexts_8c.html#a196">getHEfromP</a>(NULL, &amp;he, p)) {
02386         <span class="comment">/*</span>
02387 <span class="comment">         * It was a pointer</span>
02388 <span class="comment">         */</span>
02389         <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> == -2 || he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a> != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a236">TYPE_FREE</a>) &amp;&amp;
02390                 he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a> &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a> &amp;&amp;
02391                 ((<span class="keywordtype">int</span>)<a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> &lt; 0 || he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a> == <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>)) {
02392             <span class="keywordflow">return</span> (PVOID)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>);
02393         }
02394     }
02395 
02396     pT = <a class="code" href="../../d2/d1/userexts_8c.html#a195">GetPfromH</a>((ULONG_PTR)p, NULL, &amp;he);
02397     <span class="keywordflow">if</span> (pT == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02398         Print(<span class="stringliteral">"WARNING: dumping %#p even though is not a valid pointer or handle!\n"</span>, p);
02399         <span class="keywordflow">return</span> p;  <span class="comment">// let it pass anyway so we can see how it got corrupted.</span>
02400     }
02401 
02402     <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(pT);
02403 }
02404 
02405 
02406 <span class="comment">/************************************************************************\</span>
02407 <span class="comment">* Procedure: DebugGetWindowTextA</span>
02408 <span class="comment">*</span>
02409 <span class="comment">* Description: Places pwnd title into achDest.  No checks for size are</span>
02410 <span class="comment">*   made.</span>
02411 <span class="comment">*</span>
02412 <span class="comment">* Returns: fSuccess</span>
02413 <span class="comment">*</span>
02414 <span class="comment">* 6/9/1995 Created SanfordS</span>
02415 <span class="comment">*</span>
02416 <span class="comment">\************************************************************************/</span>
02417 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(
02418     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
02419     <span class="keywordtype">char</span> *achDest)
02420 {
02421     <a class="code" href="../../d6/d9/structtagWND.html">WND</a> wnd;
02422     WCHAR awch[80];
02423 
02424     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02425         achDest[0] = <span class="charliteral">'\0'</span>;
02426         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02427     }
02428 
02429     <span class="keywordflow">if</span> (!tryMove(wnd, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(pwnd))) {
02430         strcpy(achDest, <span class="stringliteral">"&lt;&lt; Can't get WND &gt;&gt;"</span>);
02431         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02432     }
02433 
02434     <span class="keywordflow">if</span> (wnd.<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o3">Buffer</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02435         strcpy(achDest, <span class="stringliteral">"&lt;null&gt;"</span>);
02436     } <span class="keywordflow">else</span> {
02437         ULONG cbText;
02438         cbText = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<span class="keyword">sizeof</span>(awch), wnd.<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a> + <span class="keyword">sizeof</span>(WCHAR));
02439         <span class="keywordflow">if</span> (!(tryMoveBlock(awch, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o3">Buffer</a>), cbText))) {
02440             strcpy(achDest, <span class="stringliteral">"&lt;&lt; Can't get title &gt;&gt;"</span>);
02441             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02442         }
02443         awch[<span class="keyword">sizeof</span>(awch) / <span class="keyword">sizeof</span>(WCHAR) - 1] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
02444         <a class="code" href="../../d9/d6/nlsxlat_8c.html#a37">RtlUnicodeToMultiByteN</a>(achDest, cbText / <span class="keyword">sizeof</span>(WCHAR), NULL,
02445                 awch, cbText);
02446     }
02447     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02448 }
02449 
02450 
02451 <span class="comment">/************************************************************************\</span>
02452 <span class="comment">* Procedure: DebugGetClassNameA</span>
02453 <span class="comment">*</span>
02454 <span class="comment">* Description: Placed pcls name into achDest.  No checks for size are</span>
02455 <span class="comment">*   made.</span>
02456 <span class="comment">*</span>
02457 <span class="comment">* Returns: fSuccess</span>
02458 <span class="comment">*</span>
02459 <span class="comment">* 6/9/1995 Created SanfordS</span>
02460 <span class="comment">*</span>
02461 <span class="comment">\************************************************************************/</span>
02462 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a199">DebugGetClassNameA</a>(
02463     LPSTR lpszClassName,
02464     <span class="keywordtype">char</span> *achDest)
02465 {
02466     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> ach[80];
02467 
02468     <span class="keywordflow">if</span> (lpszClassName == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02469         strcpy(achDest, <span class="stringliteral">"&lt;null&gt;"</span>);
02470     } <span class="keywordflow">else</span> {
02471         <span class="keywordflow">if</span> (!tryMove(ach, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(lpszClassName))) {
02472             strcpy(achDest, <span class="stringliteral">"&lt;inaccessible&gt;"</span>);
02473         } <span class="keywordflow">else</span> {
02474             strcpy(achDest, ach);
02475         }
02476         strcpy(achDest, ach);
02477     }
02478     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02479 }
02480 
02481 <span class="comment">/************************************************************************\</span>
02482 <span class="comment">* Procedure: PrintBitField, PrintEndBitField</span>
02483 <span class="comment">*</span>
02484 <span class="comment">* Description: Printout specified boolean value in a structure.</span>
02485 <span class="comment">*  Assuming strlen(pszFieldName) will not exceeds BF_COLUMN_WIDTH.</span>
02486 <span class="comment">*</span>
02487 <span class="comment">* Returns: None</span>
02488 <span class="comment">*</span>
02489 <span class="comment">* 10/12/1997 Created HiroYama</span>
02490 <span class="comment">*</span>
02491 <span class="comment">\************************************************************************/</span>
02492 <span class="keywordtype">void</span> <a class="code" href="../../d2/d1/userexts_8c.html#a204">PrintBitField</a>(LPSTR pszFieldName, BOOLEAN fValue)
02493 {
02494     <span class="keywordtype">int</span> iWidth;
02495     <span class="keywordtype">int</span> iStart = <a class="code" href="../../d2/d1/userexts_8c.html#a69">giBFColumn</a>;
02496 
02497     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(gach1, fValue ? <span class="stringliteral">"*%-s "</span> : <span class="stringliteral">" %-s "</span>, pszFieldName);
02498 
02499     iWidth = (<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(gach1) + <a class="code" href="../../d2/d1/userexts_8c.html#a2">BF_COLUMN_WIDTH</a> - 1) / <a class="code" href="../../d2/d1/userexts_8c.html#a2">BF_COLUMN_WIDTH</a>;
02500     iWidth *= <a class="code" href="../../d2/d1/userexts_8c.html#a2">BF_COLUMN_WIDTH</a>;
02501 
02502     <span class="keywordflow">if</span> ((<a class="code" href="../../d2/d1/userexts_8c.html#a69">giBFColumn</a> += iWidth) &gt;= <a class="code" href="../../d2/d1/userexts_8c.html#a1">BF_MAX_WIDTH</a>) {
02503         <a class="code" href="../../d2/d1/userexts_8c.html#a69">giBFColumn</a> = iWidth;
02504         Print(<span class="stringliteral">"%s\n"</span>, gaBFBuff);
02505         iStart = 0;
02506     }
02507 
02508     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(gaBFBuff + iStart, <span class="stringliteral">"%-*s"</span>, iWidth, gach1);
02509 }
02510 
02511 <span class="keywordtype">void</span> <a class="code" href="../../d2/d1/userexts_8c.html#a205">PrintEndBitField</a>()
02512 {
02513     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a69">giBFColumn</a> != 0) {
02514         <a class="code" href="../../d2/d1/userexts_8c.html#a69">giBFColumn</a> = 0;
02515         Print(<span class="stringliteral">"%s\n"</span>, gaBFBuff);
02516     }
02517 }
02518 
02519 
02520 <span class="keywordtype">char</span> *<a class="code" href="../../d2/d1/userexts_8c.html#a132">pszObjStr</a>[] = {
02521                      <span class="stringliteral">"Free"</span>,
02522                      <span class="stringliteral">"Window"</span>,
02523                      <span class="stringliteral">"Menu"</span>,
02524                      <span class="stringliteral">"Cursor"</span>,
02525                      <span class="stringliteral">"SetWindowPos"</span>,
02526                      <span class="stringliteral">"Hook"</span>,
02527                      <span class="stringliteral">"Thread Info"</span>,
02528                      <span class="stringliteral">"Clip Data"</span>,
02529                      <span class="stringliteral">"Call Proc"</span>,
02530                      <span class="stringliteral">"Accel Table"</span>,
02531                      <span class="stringliteral">"WindowStation"</span>,
02532                      <span class="stringliteral">"DeskTop"</span>,
02533                      <span class="stringliteral">"DdeAccess"</span>,
02534                      <span class="stringliteral">"DdeConv"</span>,
02535                      <span class="stringliteral">"DdeExact"</span>,
02536                      <span class="stringliteral">"Monitor"</span>,
02537                      <span class="stringliteral">"Ctypes"</span>,
02538                      <span class="stringliteral">"Console"</span>,
02539                      <span class="stringliteral">"Generic"</span>
02540                     };
02541 
02542 
02543 <span class="preprocessor">#ifdef KERNEL</span>
02544 <span class="preprocessor"></span><span class="comment">/***********************************************************************\</span>
02545 <span class="comment">* DumpGdiHandleType</span>
02546 <span class="comment">*</span>
02547 <span class="comment">* Returns: a static buffer address which will contain a &gt;0 length</span>
02548 <span class="comment">* string if the type makes sense.</span>
02549 <span class="comment">*</span>
02550 <span class="comment">* 12/1/1995 Created SanfordS</span>
02551 <span class="comment">\***********************************************************************/</span>
02552 
02553 LPCSTR GetGDIHandleType(
02554 HANDLE handle)
02555 {
02556     HOBJ    ho;                             <span class="comment">// dump this handle</span>
02557     PENTRY  pent;                           <span class="comment">// base address of hmgr entries</span>
02558     <a class="code" href="../../d6/d4/structtagENTRY.html">ENTRY</a>   ent;                            <span class="comment">// copy of handle entry</span>
02559     BASEOBJECT obj;
02560     ULONG ulTemp;
02561     <span class="keyword">static</span> <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> szT[20];
02562     ULONG gcMaxHmgr, index;
02563 
02564 <span class="comment">// filched from gre\hmgr.h</span>
02565 <span class="preprocessor">#define INDEX_MASK          ((1 &lt;&lt; INDEX_BITS) - 1)</span>
02566 <span class="preprocessor"></span><span class="preprocessor">#define HmgIfromH(h)          ((ULONG)(h) &amp; INDEX_MASK)</span>
02567 <span class="preprocessor"></span>
02568     szT[0] = <span class="charliteral">'\0'</span>;
02569     ho = (HOBJ) handle;
02570     moveExpValue(&amp;pent, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpentHmgr));
02571     moveExp(&amp;gcMaxHmgr, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gcMaxHmgr));
02572     index = HmgIfromH((ULONG_PTR) ho);
02573     <span class="keywordflow">if</span> (index &gt; gcMaxHmgr) {
02574         <span class="keywordflow">return</span> szT;
02575     }
02576     <span class="keywordflow">if</span> (!tryMove(ent,  &amp;(pent[index]))) {
02577         <span class="keywordflow">return</span> szT;
02578     }
02579     <span class="keywordflow">if</span> (ent.FullUnique != ((ULONG_PTR)ho &gt;&gt; 16)) {
02580         <span class="keywordflow">return</span> szT;
02581     }
02582     <span class="keywordflow">if</span> (!tryMove(obj, ent.einfo.pobj)) {
02583         <span class="keywordflow">return</span> szT;
02584     }
02585     <span class="keywordflow">if</span> (obj.hHmgr != ho) {
02586         <span class="keywordflow">return</span> szT;
02587     }
02588     ulTemp = (ULONG) ent.Objt;
02589 
02590     <span class="keywordflow">switch</span>(ulTemp) {
02591     <span class="keywordflow">case</span> DEF_TYPE:
02592         strcpy(szT, <span class="stringliteral">"DEF"</span>);
02593         <span class="keywordflow">break</span>;
02594 
02595     <span class="keywordflow">case</span> DC_TYPE:
02596         strcpy(szT, <span class="stringliteral">"DC"</span>);
02597         <span class="keywordflow">break</span>;
02598 
02599     <span class="keywordflow">case</span> RGN_TYPE:
02600         strcpy(szT, <span class="stringliteral">"RGN"</span>);
02601         <span class="keywordflow">break</span>;
02602 
02603     <span class="keywordflow">case</span> SURF_TYPE:
02604         strcpy(szT, <span class="stringliteral">"SURF"</span>);
02605         <span class="keywordflow">break</span>;
02606 
02607     <span class="keywordflow">case</span> PATH_TYPE:
02608         strcpy(szT, <span class="stringliteral">"PATH"</span>);
02609         <span class="keywordflow">break</span>;
02610 
02611     <span class="keywordflow">case</span> PAL_TYPE:
02612         strcpy(szT, <span class="stringliteral">"PAL"</span>);
02613         <span class="keywordflow">break</span>;
02614 
02615     <span class="keywordflow">case</span> ICMLCS_TYPE:
02616         strcpy(szT, <span class="stringliteral">"ICMLCS"</span>);
02617         <span class="keywordflow">break</span>;
02618 
02619     <span class="keywordflow">case</span> LFONT_TYPE:
02620         strcpy(szT, <span class="stringliteral">"LFONT"</span>);
02621         <span class="keywordflow">break</span>;
02622 
02623     <span class="keywordflow">case</span> RFONT_TYPE:
02624         strcpy(szT, <span class="stringliteral">"RFONT"</span>);
02625         <span class="keywordflow">break</span>;
02626 
02627     <span class="keywordflow">case</span> PFE_TYPE:
02628         strcpy(szT, <span class="stringliteral">"PFE"</span>);
02629         <span class="keywordflow">break</span>;
02630 
02631     <span class="keywordflow">case</span> PFT_TYPE:
02632         strcpy(szT, <span class="stringliteral">"PFT"</span>);
02633         <span class="keywordflow">break</span>;
02634 
02635     <span class="keywordflow">case</span> ICMCXF_TYPE:
02636         strcpy(szT, <span class="stringliteral">"ICMCXF"</span>);
02637         <span class="keywordflow">break</span>;
02638 
02639     <span class="keywordflow">case</span> SPRITE_TYPE:
02640         strcpy(szT, <span class="stringliteral">"SPRITE"</span>);
02641         <span class="keywordflow">break</span>;
02642 
02643     <span class="keywordflow">case</span> SPACE_TYPE:
02644         strcpy(szT, <span class="stringliteral">"SPACE"</span>);
02645         <span class="keywordflow">break</span>;
02646 
02647     <span class="keywordflow">case</span> META_TYPE:
02648         strcpy(szT, <span class="stringliteral">"META"</span>);
02649         <span class="keywordflow">break</span>;
02650 
02651     <span class="keywordflow">case</span> EFSTATE_TYPE:
02652         strcpy(szT, <span class="stringliteral">"EFSTATE"</span>);
02653         <span class="keywordflow">break</span>;
02654 
02655     <span class="keywordflow">case</span> BMFD_TYPE:
02656         strcpy(szT, <span class="stringliteral">"BMFD"</span>);
02657         <span class="keywordflow">break</span>;
02658 
02659     <span class="keywordflow">case</span> VTFD_TYPE:
02660         strcpy(szT, <span class="stringliteral">"VTFD"</span>);
02661         <span class="keywordflow">break</span>;
02662 
02663     <span class="keywordflow">case</span> TTFD_TYPE:
02664         strcpy(szT, <span class="stringliteral">"TTFD"</span>);
02665         <span class="keywordflow">break</span>;
02666 
02667     <span class="keywordflow">case</span> RC_TYPE:
02668         strcpy(szT, <span class="stringliteral">"RC"</span>);
02669         <span class="keywordflow">break</span>;
02670 
02671     <span class="keywordflow">case</span> TEMP_TYPE:
02672         strcpy(szT, <span class="stringliteral">"TEMP"</span>);
02673         <span class="keywordflow">break</span>;
02674 
02675     <span class="keywordflow">case</span> DRVOBJ_TYPE:
02676         strcpy(szT, <span class="stringliteral">"DRVOBJ"</span>);
02677         <span class="keywordflow">break</span>;
02678 
02679     <span class="keywordflow">case</span> DCIOBJ_TYPE:
02680         strcpy(szT, <span class="stringliteral">"DCIOBJ"</span>);
02681         <span class="keywordflow">break</span>;
02682 
02683     <span class="keywordflow">case</span> SPOOL_TYPE:
02684         strcpy(szT, <span class="stringliteral">"SPOOL"</span>);
02685         <span class="keywordflow">break</span>;
02686 
02687     <span class="keywordflow">default</span>:
02688         ulTemp = LO_TYPE(ent.FullUnique &lt;&lt; TYPE_SHIFT);
02689         <span class="keywordflow">switch</span> (ulTemp) {
02690         <span class="keywordflow">case</span> LO_BRUSH_TYPE:
02691             strcpy(szT, <span class="stringliteral">"BRUSH"</span>);
02692             <span class="keywordflow">break</span>;
02693 
02694         <span class="keywordflow">case</span> LO_PEN_TYPE:
02695             strcpy(szT, <span class="stringliteral">"LO_PEN"</span>);
02696             <span class="keywordflow">break</span>;
02697 
02698         <span class="keywordflow">case</span> LO_EXTPEN_TYPE:
02699             strcpy(szT, <span class="stringliteral">"LO_EXTPEN"</span>);
02700             <span class="keywordflow">break</span>;
02701 
02702         <span class="keywordflow">case</span> CLIENTOBJ_TYPE:
02703             strcpy(szT, <span class="stringliteral">"CLIENTOBJ"</span>);
02704             <span class="keywordflow">break</span>;
02705 
02706         <span class="keywordflow">case</span> LO_METAFILE16_TYPE:
02707             strcpy(szT, <span class="stringliteral">"LO_METAFILE16"</span>);
02708             <span class="keywordflow">break</span>;
02709 
02710         <span class="keywordflow">case</span> LO_METAFILE_TYPE:
02711             strcpy(szT, <span class="stringliteral">"LO_METAFILE"</span>);
02712             <span class="keywordflow">break</span>;
02713 
02714         <span class="keywordflow">case</span> LO_METADC16_TYPE:
02715             strcpy(szT, <span class="stringliteral">"LO_METADC16"</span>);
02716             <span class="keywordflow">break</span>;
02717         }
02718     }
02719     <span class="keywordflow">return</span> szT;
02720 }
02721 
02722 <span class="preprocessor">#endif // KERNEL</span>
02723 <span class="preprocessor"></span>
02724 
02725 <span class="comment">/***********************************************************************\</span>
02726 <span class="comment">* Isas</span>
02727 <span class="comment">*</span>
02728 <span class="comment">* Analyzes the stack.  Looks at a range of dwords and tries to make</span>
02729 <span class="comment">* sense out of them.  Identifies handles, user objects, and code</span>
02730 <span class="comment">* addresses.</span>
02731 <span class="comment">*</span>
02732 <span class="comment">* Returns: fSuccess</span>
02733 <span class="comment">*</span>
02734 <span class="comment">* 11/30/1995 Created SanfordS</span>
02735 <span class="comment">\***********************************************************************/</span>
02736 
02737 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d2/d1/userexts_8c.html#a206">DirectAnalyze</a>(
02738 ULONG_PTR dw,
02739 ULONG_PTR adw,
02740 BOOL fNoSym)
02741 {
02742     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">PHE</a>         phe;
02743     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he;
02744     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       index;
02745     DWORD_PTR   dwOffset;
02746     WORD        uniq, w, aw;
02747     <a class="code" href="../../d4/d5/struct__HEAD.html">HEAD</a>        head;
02748     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>        ach[80];
02749 <span class="preprocessor">#ifdef KERNEL</span>
02750 <span class="preprocessor"></span>    LPCSTR      psz;
02751 <span class="preprocessor">#endif</span>
02752 <span class="preprocessor"></span>
02753     Print(<span class="stringliteral">"0x%p "</span>, dw);
02754     <span class="keywordflow">if</span> (HIWORD(dw) != 0) {
02755         <span class="comment">/*</span>
02756 <span class="comment">         * See if its a handle</span>
02757 <span class="comment">         */</span>
02758         index = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a432">HMIndexFromHandle</a>(dw);
02759         <span class="keywordflow">if</span> (index &lt; <a class="code" href="../../d2/d1/userexts_8c.html#a68">gSi</a>.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o4">cHandleEntries</a>) {
02760             uniq = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a435">HMUniqFromHandle</a>(dw);
02761             phe = &amp;<a class="code" href="../../d2/d1/userexts_8c.html#a67">gShi</a>.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o1">aheList</a>[index];
02762             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(he, phe);
02763             <span class="keywordflow">if</span> (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o4">wUniq</a> == uniq) {
02764                 Print(<span class="stringliteral">"= a %s handle. "</span>, pszObjStr[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>]);
02765                 fNoSym = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02766             }
02767         }
02768 <span class="preprocessor">#ifdef KERNEL</span>
02769 <span class="preprocessor"></span>        <span class="comment">/*</span>
02770 <span class="comment">         * See if its a GDI object handle</span>
02771 <span class="comment">         */</span>
02772         psz = GetGDIHandleType((HANDLE)dw);
02773         <span class="keywordflow">if</span> (*psz) {
02774             Print(<span class="stringliteral">"= a GDI %s type handle. "</span>, psz);
02775             fNoSym = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02776         }
02777 <span class="preprocessor">#endif // KERNEL</span>
02778 <span class="preprocessor"></span>        <span class="comment">/*</span>
02779 <span class="comment">         * See if its an object pointer</span>
02780 <span class="comment">         */</span>
02781         <span class="keywordflow">if</span> (tryMove(head, (PVOID)dw)) {
02782             <span class="keywordflow">if</span> (head.<a class="code" href="../../d4/d5/struct__HEAD.html#o0">h</a>) {
02783                 index = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a432">HMIndexFromHandle</a>(head.<a class="code" href="../../d4/d5/struct__HEAD.html#o0">h</a>);
02784                 <span class="keywordflow">if</span> (index &lt; <a class="code" href="../../d2/d1/userexts_8c.html#a68">gSi</a>.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o4">cHandleEntries</a>) {
02785                     phe = &amp;<a class="code" href="../../d2/d1/userexts_8c.html#a67">gShi</a>.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o1">aheList</a>[index];
02786                     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(he, phe);
02787                     <span class="keywordflow">if</span> (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a> == (PVOID)dw) {
02788                         Print(<span class="stringliteral">"= a pointer to a %s."</span>, pszObjStr[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>]);
02789                         fNoSym = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02790                     }
02791                 }
02792             }
02793             <span class="comment">/*</span>
02794 <span class="comment">             * Does this reference the stack itself?</span>
02795 <span class="comment">             */</span>
02796             w = HIWORD(dw);
02797             aw = HIWORD(adw);
02798             <span class="keywordflow">if</span> (w == aw || w == aw - 1 || w == aw + 1) {
02799                 Print(<span class="stringliteral">"= Stack Reference "</span>);
02800                 fNoSym = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02801             }
02802             <span class="keywordflow">if</span> (!fNoSym) {
02803                 <span class="comment">/*</span>
02804 <span class="comment">                 * Its accessible so print its symbolic reference</span>
02805 <span class="comment">                 */</span>
02806                 GetSym((PVOID)dw, ach, &amp;dwOffset);
02807                 <span class="keywordflow">if</span> (*ach) {
02808                     Print(<span class="stringliteral">"= symbol \"%s\""</span>, ach);
02809                     <span class="keywordflow">if</span> (dwOffset) {
02810                         Print(<span class="stringliteral">" + %x"</span>, dwOffset);
02811                     }
02812                 }
02813             }
02814         }
02815     }
02816     Print(<span class="stringliteral">"\n"</span>);
02817 }
02818 
02819 
02820 
02821 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a207">Isas</a>(
02822 DWORD opts,
02823 PVOID param1,
02824 PVOID param2)
02825 {
02826     <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">PSHAREDINFO</a> pshi;
02827     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> count = PtrToUlong(param2);
02828     LPDWORD pdw;
02829     DWORD_PTR dw;
02830 
02831     <span class="keywordflow">if</span> (param1 == 0) {
02832         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02833     }
02834     <span class="comment">/*</span>
02835 <span class="comment">     * Set up globals for speed.</span>
02836 <span class="comment">     */</span>
02837     <a class="code" href="../../d2/d1/userexts_8c.html#a7">GETSHAREDINFO</a>(pshi);
02838     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(gShi, pshi);
02839 
02840     <span class="keywordflow">if</span> (!tryMove(gSi, <a class="code" href="../../d2/d1/userexts_8c.html#a67">gShi</a>.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o0">psi</a>)) {
02841         Print(<span class="stringliteral">"Could not access shared info\n"</span>);
02842         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02843     }
02844 
02845     <span class="keywordflow">if</span> (opts &amp; OFLAG(d)) {
02846         <a class="code" href="../../d2/d1/userexts_8c.html#a206">DirectAnalyze</a>((ULONG_PTR)param1, 0, OFLAG(s) &amp; opts);
02847     } <span class="keywordflow">else</span> {
02848         pdw = param1;
02849         <span class="keywordflow">if</span> (pdw == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02850             Print(<span class="stringliteral">"Hay bud, give me an address to look analyze.\n"</span>);
02851             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02852         }
02853         <span class="keywordflow">if</span> (count == 0) {
02854             count = 25;    <span class="comment">// default span</span>
02855         }
02856         Print(<span class="stringliteral">"--- Stack analysis ---\n"</span>);
02857         <span class="keywordflow">for</span> ( ; count; count--, pdw++) {
02858             <span class="keywordflow">if</span> (IsCtrlCHit()) {
02859                 <span class="keywordflow">break</span>;
02860             }
02861             Print(<span class="stringliteral">"[0x%p]: "</span>, pdw);
02862             <span class="keywordflow">if</span> (tryMove(dw, pdw))
02863                 <a class="code" href="../../d2/d1/userexts_8c.html#a206">DirectAnalyze</a>(dw, (DWORD_PTR)pdw, OFLAG(s) &amp; opts);
02864             <span class="keywordflow">else</span>
02865                 Print(<span class="stringliteral">"No access\n"</span>);
02866         }
02867     }
02868     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02869 }
02870 
02871 
02872 
02873 <span class="preprocessor">#ifdef KERNEL</span>
02874 <span class="preprocessor"></span>
02875 <span class="comment">/************************************************************************\</span>
02876 <span class="comment">* Procedure: DumpAtomTable</span>
02877 <span class="comment">*</span>
02878 <span class="comment">* Description: Dumps an atom or entire atom table.</span>
02879 <span class="comment">*</span>
02880 <span class="comment">* Returns:  fSuccess</span>
02881 <span class="comment">*</span>
02882 <span class="comment">* 6/9/1995 Created SanfordS</span>
02883 <span class="comment">*</span>
02884 <span class="comment">\************************************************************************/</span>
02885 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> DumpAtomTable(
02886 PRTL_ATOM_TABLE *ppat,
02887 ATOM a)
02888 {
02889     RTL_ATOM_TABLE at, *pat;
02890     RTL_ATOM_TABLE_ENTRY ate, *pate;
02891     <span class="keywordtype">int</span> iBucket;
02892     LPWSTR pwsz;
02893     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fFirst;
02894 
02895     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pat, ppat);
02896     <span class="keywordflow">if</span> (pat == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02897         Print(<span class="stringliteral">"is not initialized.\n"</span>);
02898         <span class="keywordflow">return</span>;
02899     }
02900     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(at, pat);
02901     <span class="keywordflow">if</span> (a) {
02902         Print(<span class="stringliteral">"\n"</span>);
02903     } <span class="keywordflow">else</span> {
02904         Print(<span class="stringliteral">"at %x\n"</span>, pat);
02905     }
02906     <span class="keywordflow">for</span> (iBucket = 0; iBucket &lt; (<span class="keywordtype">int</span>)at.NumberOfBuckets; iBucket++) {
02907         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pate, &amp;pat-&gt;Buckets[iBucket]);
02908         <span class="keywordflow">if</span> (pate != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; !a) {
02909             Print(<span class="stringliteral">"Bucket %2d:"</span>, iBucket);
02910         }
02911         fFirst = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02912         SAFEWHILE (pate != NULL) {
02913             <span class="keywordflow">if</span> (!fFirst &amp;&amp; !a) {
02914                 Print(<span class="stringliteral">"          "</span>);
02915             }
02916             fFirst = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02917             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ate, pate);
02918             pwsz = (LPWSTR)LocalAlloc(LPTR, (ate.NameLength + 1) * <span class="keyword">sizeof</span>(WCHAR));
02919             <a class="code" href="../../d7/d4/conexts_8c.html#a2">moveBlock</a>(pwsz, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(&amp;pate-&gt;Name), ate.NameLength * <span class="keyword">sizeof</span>(WCHAR));
02920             pwsz[ate.NameLength] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
02921             <span class="keywordflow">if</span> (a == 0 || a == (ATOM)(ate.HandleIndex | MAXINTATOM)) {
02922                 Print(<span class="stringliteral">"%hx(%2d) = %ls (%d)%s\n"</span>,
02923                         (ATOM)(ate.HandleIndex | MAXINTATOM),
02924                         ate.ReferenceCount,
02925                         pwsz, ate.NameLength,
02926                         ate.Flags &amp; RTL_ATOM_PINNED ? <span class="stringliteral">" pinned"</span> : <span class="stringliteral">""</span>);
02927 
02928                 <span class="keywordflow">if</span> (a) {
02929                     LocalFree(pwsz);
02930                     <span class="keywordflow">return</span>;
02931                 }
02932             }
02933             LocalFree(pwsz);
02934             <span class="keywordflow">if</span> (pate == ate.HashLink) {
02935                 Print(<span class="stringliteral">"Bogus hash link at %x\n"</span>, pate);
02936                 <span class="keywordflow">break</span>;
02937             }
02938             pate = ate.HashLink;
02939         }
02940     }
02941     <span class="keywordflow">if</span> (a)
02942         Print(<span class="stringliteral">"\n"</span>);
02943 }
02944 
02945 
02946 <span class="comment">/************************************************************************\</span>
02947 <span class="comment">* Procedure: Iatom</span>
02948 <span class="comment">*</span>
02949 <span class="comment">* Description: Dumps an atom or the entire local USER atom table.</span>
02950 <span class="comment">*</span>
02951 <span class="comment">* Returns:  fSuccess</span>
02952 <span class="comment">*</span>
02953 <span class="comment">* 6/9/1995 Created SanfordS</span>
02954 <span class="comment">*</span>
02955 <span class="comment">\************************************************************************/</span>
02956 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Iatom(
02957 DWORD opts,
02958 PVOID param1)
02959 {
02960     PRTL_ATOM_TABLE *ppat;
02961     ATOM a;
02962     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta;
02963 
02964     UNREFERENCED_PARAMETER(opts);
02965 
02966     <span class="keywordflow">try</span> {
02967         a = (ATOM)param1;
02968 
02969         ppat = EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(UserAtomTableHandle));
02970         <span class="keywordflow">if</span> (ppat != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02971             Print(<span class="stringliteral">"\nPrivate atom table for WIN32K "</span>);
02972             DumpAtomTable(ppat, a);
02973         }
02974 
02975         FOREACHWINDOWSTATION(pwinsta)
02976             ppat = (PRTL_ATOM_TABLE *)&amp;pwinsta-&gt;pGlobalAtomTable;
02977             if (ppat != NULL) {
02978                 Print(<span class="stringliteral">"\nGlobal atom table for window station %lx "</span>,
02979                       pwinsta);
02980                 DumpAtomTable(ppat, a);
02981             }
02982         NEXTEACHWINDOWSTATION(pwinsta);
02983     } except (EXCEPTION_EXECUTE_HANDLER) {
02984         ;
02985     }
02986     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02987 }
02988 <span class="preprocessor">#endif // KERNEL</span>
02989 <span class="preprocessor"></span>
02990 <span class="preprocessor">#ifndef KERNEL</span>
02991 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
02992 <span class="comment">* Procedure: DumpConvInfo</span>
02993 <span class="comment">*</span>
02994 <span class="comment">* Description: Dumps DDEML client conversation info structures.</span>
02995 <span class="comment">*</span>
02996 <span class="comment">* Returns: fSuccess</span>
02997 <span class="comment">*</span>
02998 <span class="comment">* 6/9/1995 Created SanfordS</span>
02999 <span class="comment">*</span>
03000 <span class="comment">\************************************************************************/</span>
03001 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a189">DumpConvInfo</a>(
03002 <a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a> pcoi)
03003 {
03004     <a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">CL_CONV_INFO</a> coi;
03005     <a class="code" href="../../d2/d8/structtagADVISE__LINK.html">ADVISE_LINK</a> al;
03006     <a class="code" href="../../d0/d0/structtagXACT__INFO.html">XACT_INFO</a> xi;
03007 
03008     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(coi, pcoi);
03009     Print(<span class="stringliteral">"    next              = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o0">next</a>);
03010     Print(<span class="stringliteral">"    pcii              = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o1">pcii</a>);
03011     Print(<span class="stringliteral">"    hUser             = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o2">hUser</a>);
03012     Print(<span class="stringliteral">"    hConv             = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o3">hConv</a>);
03013     Print(<span class="stringliteral">"    laService         = 0x%04x\n"</span>,  coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o4">laService</a>);
03014     Print(<span class="stringliteral">"    laTopic           = 0x%04x\n"</span>,  coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o5">laTopic</a>);
03015     Print(<span class="stringliteral">"    hwndPartner       = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o6">hwndPartner</a>);
03016     Print(<span class="stringliteral">"    hwndConv          = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o7">hwndConv</a>);
03017     Print(<span class="stringliteral">"    state             = 0x%04x\n"</span>,  coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a>);
03018     Print(<span class="stringliteral">"    laServiceRequested= 0x%04x\n"</span>,  coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o9">laServiceRequested</a>);
03019     Print(<span class="stringliteral">"    pxiIn             = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o10">pxiIn</a>);
03020     Print(<span class="stringliteral">"    pxiOut            = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o11">pxiOut</a>);
03021     SAFEWHILE (coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o11">pxiOut</a>) {
03022         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(xi, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o11">pxiOut</a>);
03023         Print(<span class="stringliteral">"      hXact           = (0x%08lx)-&gt;0x%08lx\n"</span>, xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o11">pxiOut</a>);
03024         coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o11">pxiOut</a> = xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a>;
03025     }
03026     Print(<span class="stringliteral">"    dmqIn             = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o12">dmqIn</a>);
03027     Print(<span class="stringliteral">"    dmqOut            = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o13">dmqOut</a>);
03028     Print(<span class="stringliteral">"    aLinks            = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o14">aLinks</a>);
03029     Print(<span class="stringliteral">"    cLinks            = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>);
03030     SAFEWHILE (coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>--) {
03031         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(al, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o14">aLinks</a>++);
03032         Print(<span class="stringliteral">"      pLinkCount = 0x%08x\n"</span>, al.<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o0">pLinkCount</a>);
03033         Print(<span class="stringliteral">"      wType      = 0x%08x\n"</span>, al.<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o3">wType</a>);
03034         Print(<span class="stringliteral">"      state      = 0x%08x\n"</span>, al.<a class="code" href="../../d2/d8/structtagADVISE__LINK.html#o4">state</a>);
03035         <span class="keywordflow">if</span> (coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o15">cLinks</a>) {
03036             Print(<span class="stringliteral">"      ---\n"</span>);
03037         }
03038     }
03039     <span class="keywordflow">if</span> (coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o8">state</a> &amp; ST_CLIENT) {
03040         Print(<span class="stringliteral">"    hwndReconnect     = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o1">hwndReconnect</a>);
03041         Print(<span class="stringliteral">"    hConvList         = 0x%08lx\n"</span>, coi.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o2">hConvList</a>);
03042     }
03043 
03044     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03045 }
03046 <span class="preprocessor">#endif // !KERNEL</span>
03047 <span class="preprocessor"></span>
03048 
03049 
03050 
03051 <span class="preprocessor">#ifndef KERNEL</span>
03052 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
03053 <span class="comment">* Procedure: GetTargetTEB</span>
03054 <span class="comment">*</span>
03055 <span class="comment">* Description: Retrieves the target thread's TEB</span>
03056 <span class="comment">*</span>
03057 <span class="comment">* Returns: fSuccess</span>
03058 <span class="comment">*</span>
03059 <span class="comment">* 6/15/1995 Created SanfordS</span>
03060 <span class="comment">*</span>
03061 <span class="comment">\************************************************************************/</span>
03062 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
03063 <a class="code" href="../../d2/d1/userexts_8c.html#a190">GetTargetTEB</a>(
03064 PTEB pteb,
03065 PTEB *ppteb) <span class="comment">// OPTIONAL</span>
03066 {
03067     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03068     THREAD_BASIC_INFORMATION ThreadInformation;
03069 
03070     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d1/psquery_8c.html#a20">NtQueryInformationThread</a>( hCurrentThread,
03071                                        ThreadBasicInformation,
03072                                        &amp;ThreadInformation,
03073                                        <span class="keyword">sizeof</span>( ThreadInformation ),
03074                                        NULL);
03075     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
03076         <span class="keywordflow">if</span> (ppteb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03077             *ppteb = (PTEB)ThreadInformation.TebBaseAddress;
03078         }
03079         <span class="keywordflow">return</span> tryMove(*pteb, (LPVOID)ThreadInformation.TebBaseAddress);
03080     }
03081     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03082 }
03083 <span class="preprocessor">#endif // !KERNEL</span>
03084 <span class="preprocessor"></span>
03085 
03086 
03087 <span class="preprocessor">#ifndef KERNEL</span>
03088 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
03089 <span class="comment">* Procedure: FixKernelPointer</span>
03090 <span class="comment">*</span>
03091 <span class="comment">* Description: Used to convert a kernel object pointer into its client-</span>
03092 <span class="comment">* side equivalent.  Client pointers and NULL are unchanged.</span>
03093 <span class="comment">*</span>
03094 <span class="comment">* Returns: pClient</span>
03095 <span class="comment">*</span>
03096 <span class="comment">* 6/15/1995 Created SanfordS</span>
03097 <span class="comment">*</span>
03098 <span class="comment">\************************************************************************/</span>
03099 PVOID
03100 <a class="code" href="../../d2/d1/userexts_8c.html#a188">FixKernelPointer</a>(
03101 PVOID pKernel)
03102 {
03103     <span class="keyword">static</span> TEB teb;
03104     <span class="keyword">static</span> PTEB pteb = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03105     <span class="keyword">static</span> PVOID HighestUserAddress;
03106 
03107     <span class="keywordflow">if</span> (pKernel == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03108         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03109     }
03110     <span class="keywordflow">if</span> (HighestUserAddress == 0) {
03111         SYSTEM_BASIC_INFORMATION SystemInformation;
03112 
03113         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d6/d8/sysinfo_8c.html#a49">NtQuerySystemInformation</a>(SystemBasicInformation,
03114                                                  &amp;SystemInformation,
03115                                                  <span class="keyword">sizeof</span>(SystemInformation),
03116                                                  NULL))) {
03117             HighestUserAddress = (PVOID)SystemInformation.MaximumUserModeAddress;
03118         } <span class="keywordflow">else</span> {
03119             <span class="comment">// Query failed.  Assume usermode is the low half of the address</span>
03120             <span class="comment">// space.</span>
03121             HighestUserAddress = (PVOID)MAXINT_PTR;
03122         }
03123     }
03124 
03125     <span class="keywordflow">if</span> (pKernel &lt;= HighestUserAddress) {
03126         <span class="keywordflow">return</span> pKernel;
03127     }
03128     <span class="keywordflow">if</span> (pteb == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03129         <a class="code" href="../../d2/d1/userexts_8c.html#a190">GetTargetTEB</a>(&amp;teb, &amp;pteb);
03130     }
03131     <span class="keywordflow">return</span> (PVOID)(((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pKernel) - ((<a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a>)(&amp;teb.Win32ClientInfo[0]))-&gt;ulClientDelta);
03132 }
03133 
03134 <span class="keywordtype">void</span> *
03135 <a class="code" href="../../d2/d1/userexts_8c.html#a208">RebaseSharedPtr</a>(<span class="keywordtype">void</span> * p)
03136 {
03137     <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">PSHAREDINFO</a>     pshi;
03138     ULONG_PTR       ulSharedDelta;
03139 
03140     moveExp(&amp;pshi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gSharedInfo));
03141     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ulSharedDelta, &amp;pshi-&gt;<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o3">ulSharedDelta</a>);
03142 
03143     <span class="keywordflow">return</span> (p) ? (PVOID)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(p) - ulSharedDelta) : <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03144 }
03145 
03146 <span class="preprocessor">#endif // !KERNEL</span>
03147 <span class="preprocessor"></span>
03148 <span class="comment">/************************************************************************\</span>
03149 <span class="comment">* Procedure: userexts_bsearch</span>
03150 <span class="comment">*</span>
03151 <span class="comment">* 08/09/98 HiroYama     Ported from VC5 CRT</span>
03152 <span class="comment">*</span>
03153 <span class="comment">\************************************************************************/</span>
03154 <span class="keywordtype">void</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a209">userexts_bsearch</a> (
03155         <span class="keyword">const</span> <span class="keywordtype">void</span> *key,
03156         <span class="keyword">const</span> <span class="keywordtype">void</span> *base,
03157         size_t num,
03158         size_t width,
03159         <span class="keywordtype">int</span> (*compare)(<span class="keyword">const</span> <span class="keywordtype">void</span>*, <span class="keyword">const</span> <span class="keywordtype">void</span>*))
03160 {
03161     <span class="keywordtype">char</span>* lo = (<span class="keywordtype">char</span>*)base;
03162     <span class="keywordtype">char</span>* hi = (<span class="keywordtype">char</span>*)base + (num - 1) * width;
03163     <span class="keywordtype">char</span>* mid;
03164     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> half;
03165     <span class="keywordtype">int</span> result;
03166 
03167     <span class="keywordflow">while</span> (lo &lt;= hi) {
03168         <span class="keywordflow">if</span> (half = num / 2) {
03169             mid = lo + ((num &amp; 1) ? half : (half - 1)) * width;
03170             <span class="keywordflow">if</span> (!(result = compare(key, mid)))
03171                 <span class="keywordflow">return</span> mid;
03172             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (result &lt; 0) {
03173                 hi = mid - width;
03174                 num = (num &amp; 1) ? half : half-1;
03175             }
03176             <span class="keywordflow">else</span> {
03177                 lo = mid + width;
03178                 num = half;
03179             }
03180         }
03181         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (num) {
03182             <span class="keywordflow">return</span> compare(key, lo) ? <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> : lo;
03183         }
03184         <span class="keywordflow">else</span> {
03185             <span class="keywordflow">break</span>;
03186         }
03187     }
03188 
03189     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03190 }
03191 
03192 
03193 <span class="comment">/************************************************************************\</span>
03194 <span class="comment">* Procedure: GetVKeyName</span>
03195 <span class="comment">*</span>
03196 <span class="comment">* 08/09/98 HiroYama     Created</span>
03197 <span class="comment">*</span>
03198 <span class="comment">\************************************************************************/</span>
03199 
03200 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
03201     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwVKey;
03202     <span class="keyword">const</span> <span class="keywordtype">char</span>* name;
03203 } <a class="code" href="../../d1/d2/structVKeyDef.html">VKeyDef</a>;
03204 
03205 <span class="keywordtype">int</span> <a class="code" href="../../d2/d1/userexts_8c.html#a210">compareVKey</a>(<span class="keyword">const</span> <a class="code" href="../../d1/d2/structVKeyDef.html">VKeyDef</a>* a, <span class="keyword">const</span> <a class="code" href="../../d1/d2/structVKeyDef.html">VKeyDef</a>* b)
03206 {
03207     <span class="keywordflow">return</span> a-&gt;<a class="code" href="../../d1/d2/structVKeyDef.html#o0">dwVKey</a> - b-&gt;<a class="code" href="../../d1/d2/structVKeyDef.html#o0">dwVKey</a>;
03208 }
03209 
03210 <span class="preprocessor">#define VKEY_ITEM(x) { x, #x }</span>
03211 <span class="preprocessor"></span>
03212 <span class="keyword">const</span> <a class="code" href="../../d1/d2/structVKeyDef.html">VKeyDef</a> <a class="code" href="../../d2/d1/userexts_8c.html#a133">gVKeyDef</a>[] = {
03213 <span class="preprocessor">#include "../vktbl.txt"</span>
03214 };
03215 
03216 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a211">_GetVKeyName</a>(DWORD dwVKey, <span class="keywordtype">int</span> n)
03217 {
03218     <span class="keywordtype">int</span> i;
03219 
03220     <span class="comment">/*</span>
03221 <span class="comment">     * If dwVKey is one of alphabets or numerics, there's no VK_ macro defined.</span>
03222 <span class="comment">     */</span>
03223     <span class="keywordflow">if</span> ((dwVKey &gt;= <span class="charliteral">'A'</span> &amp;&amp; dwVKey &lt;= 'Z') || (dwVKey &gt;= <span class="charliteral">'0'</span> &amp;&amp; dwVKey &lt;= <span class="charliteral">'9'</span>)) {
03224         <span class="keyword">static</span> <span class="keywordtype">char</span> buffer[] = <span class="stringliteral">"VK_*"</span>;
03225 
03226         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> != 0) {
03227             <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
03228         }
03229         buffer[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(buffer) - 2] = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)dwVKey;
03230         <span class="keywordflow">return</span> buffer;
03231     }
03232 
03233     <span class="comment">/*</span>
03234 <span class="comment">     * Search the VKEY table.</span>
03235 <span class="comment">     */</span>
03236     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(gVKeyDef); ++i) {
03237         <span class="keyword">const</span> <a class="code" href="../../d1/d2/structVKeyDef.html">VKeyDef</a>* result = <a class="code" href="../../d2/d1/userexts_8c.html#a133">gVKeyDef</a> + i;
03238 
03239         <span class="keywordflow">if</span> (result-&gt;<a class="code" href="../../d1/d2/structVKeyDef.html#o0">dwVKey</a> == dwVKey) {
03240             <span class="keywordflow">for</span> (; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(gVKeyDef); ++i) {
03241                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a133">gVKeyDef</a>[i].<a class="code" href="../../d1/d2/structVKeyDef.html#o0">dwVKey</a> != dwVKey) {
03242                     <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
03243                 }
03244                 <span class="keywordflow">if</span> (&amp;<a class="code" href="../../d2/d1/userexts_8c.html#a133">gVKeyDef</a>[i] - result == <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>) {
03245                     <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/userexts_8c.html#a133">gVKeyDef</a>[i].<a class="code" href="../../d1/d2/structVKeyDef.html#o1">name</a>;
03246                 }
<a name="l03247"></a><a class="code" href="../../d2/d1/userexts_8c.html#a203">03247</a>             }
03248         }
03249     }
03250 
03251     <span class="comment">/*</span>
03252 <span class="comment">     * VKey name is not found.</span>
03253 <span class="comment">     */</span>
03254     <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
03255 }
03256 
03257 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a212">GetVKeyName</a>(DWORD dwVKey)
03258 {
03259     <span class="keyword">static</span> <span class="keywordtype">char</span> buf[256];
03260     <span class="keyword">const</span> <span class="keywordtype">char</span>* delim = <span class="stringliteral">""</span>;
03261     <span class="keywordtype">int</span> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = 0;
03262 
03263     buf[0] = 0;
03264 
03265     <span class="keywordflow">for</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = 0; <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a133">gVKeyDef</a>); ++<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>) {
03266         <span class="keyword">const</span> <span class="keywordtype">char</span>* name = <a class="code" href="../../d2/d1/userexts_8c.html#a211">_GetVKeyName</a>(dwVKey, <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>);
03267         <span class="keywordflow">if</span> (*name) {
03268             strcat(buf, delim);
03269             strcat(buf, name);
03270             delim = <span class="stringliteral">" / "</span>;
03271         }
03272         <span class="keywordflow">else</span> {
03273             <span class="keywordflow">break</span>;
03274         }
03275     }
03276     <span class="keywordflow">return</span> buf;
03277 }
03278 
03279 <span class="preprocessor">#undef VKEY_ITEM</span>
03280 <span class="preprocessor"></span>
03281 
03282 
03283 
03284 
03285 <span class="preprocessor">#ifdef KERNEL</span>
03286 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
03287 <span class="comment">* Procedure: DumpClassList</span>
03288 <span class="comment">*</span>
03289 <span class="comment">*</span>
03290 <span class="comment">* 05/18/98 GerardoB     Extracted from Idcls</span>
03291 <span class="comment">\************************************************************************/</span>
03292 <span class="keywordtype">void</span> DumpClassList (DWORD opts, <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls, BOOL fPrivate)
03293 {
03294     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pclsClone;
03295     <a class="code" href="../../d7/d0/structtagCLS.html">CLS</a> cls, clsClone;
03296 
03297     SAFEWHILE (pcls != NULL) {
03298         <span class="keywordflow">if</span> (!tryMove(cls, pcls)) {
03299             Print(<span class="stringliteral">"  Private class\t\tPCLS @ 0x%lx - inaccessible, skipping...\n"</span>, pcls);
03300             <span class="keywordflow">break</span>;
03301         }
03302         Print(<span class="stringliteral">"  %s class\t\t"</span>, fPrivate ? <span class="stringliteral">"Private"</span> : <span class="stringliteral">"Public "</span>);
03303         Idcls(opts, pcls);
03304 
03305         <span class="keywordflow">if</span> (cls.<a class="code" href="../../d7/d0/structtagCLS.html#o12">pclsClone</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03306             pclsClone = cls.<a class="code" href="../../d7/d0/structtagCLS.html#o12">pclsClone</a>;
03307             SAFEWHILE (pclsClone != NULL) {
03308                 <span class="keywordflow">if</span> (!tryMove(clsClone, pclsClone)) {
03309                     Print(<span class="stringliteral">"Could not access clone class at %x, skipping clones...\n"</span>, pclsClone);
03310                     <span class="keywordflow">break</span>;
03311                 }
03312                 Print(<span class="stringliteral">"  %s class clone\t"</span>, fPrivate ? <span class="stringliteral">"Private"</span> : <span class="stringliteral">"Public "</span>);
03313                 Idcls(opts, pclsClone);
03314                 pclsClone = clsClone.<a class="code" href="../../d7/d0/structtagCLS.html#o0">pclsNext</a>;
03315             }
03316         }
03317 
03318         pcls = cls.<a class="code" href="../../d7/d0/structtagCLS.html#o0">pclsNext</a>;
03319     }
03320 }
03321 <span class="comment">/************************************************************************\</span>
03322 <span class="comment">* Procedure: Idcls</span>
03323 <span class="comment">*</span>
03324 <span class="comment">* Description: Dumps window class structures</span>
03325 <span class="comment">*</span>
03326 <span class="comment">* Returns: fSuccess</span>
03327 <span class="comment">*</span>
03328 <span class="comment">* 6/9/1995 Created SanfordS</span>
03329 <span class="comment">*</span>
03330 <span class="comment">\************************************************************************/</span>
03331 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idcls(
03332     DWORD opts,
03333     PVOID param1)
03334 {
03335     <span class="keywordtype">char</span> ach[120];
03336     DWORD_PTR dwOffset;
03337     <a class="code" href="../../d7/d0/structtagCLS.html">CLS</a> localCLS;
03338     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a> pcls = param1;
03339     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PROCESSINFO</a> pi;
03340     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a> ppi;
03341 
03342     <span class="keywordflow">if</span> (param1 == 0) {
03343 
03344         FOREACHPPI(ppi)
03345             Print("\nClasses for process %x:\n", ppi);
<a name="l03346"></a><a class="code" href="../../d2/d1/userexts_8c.html#a192">03346</a>             move(pi, ppi);
03347             DumpClassList(opts, pi.pclsPrivateList, TRUE);
03348             DumpClassList(opts, pi.pclsPublicList, FALSE);
03349         NEXTEACHPPI()
03350 
03351         Print("\nGlobal Classes:\n");
03352         moveExpValuePtr(&amp;pcls, VAR(gpclsList));
03353         SAFEWHILE (pcls) {
03354             Print(<span class="stringliteral">"  Global Class\t\t"</span>);
03355             Idcls(opts, pcls);
03356             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pcls, &amp;pcls-&gt;pclsNext);
03357         }
03358         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03359     }
03360 
03361     <span class="comment">/*</span>
03362 <span class="comment">     * Dump class list for a process</span>
03363 <span class="comment">     */</span>
03364     <span class="keywordflow">if</span> (opts &amp; OFLAG(p)) {
03365         opts &amp;= ~OFLAG(p);
03366         Print(<span class="stringliteral">"\nClasses for process %x:\n"</span>, param1);
03367         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pi, param1);
03368         DumpClassList(opts, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o4">pclsPrivateList</a>, TRUE);
03369         DumpClassList(opts, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o5">pclsPublicList</a>, FALSE);
03370         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03371     }
03372 
03373     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(localCLS, pcls);
03374 
03375     <a class="code" href="../../d2/d1/userexts_8c.html#a199">DebugGetClassNameA</a>(localCLS.lpszAnsiClassName, ach);
03376     Print(<span class="stringliteral">"PCLS @ 0x%lx \t(%s)\n"</span>, pcls, ach);
03377     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
03378         Print(<span class="stringliteral">"\t pclsNext          @0x%p\n"</span>
03379               <span class="stringliteral">"\t atomClassNameAtom  0x%04x\n"</span>
03380               <span class="stringliteral">"\t fnid               0x%04x\n"</span>
03381               <span class="stringliteral">"\t pDCE              @0x%p\n"</span>
03382               <span class="stringliteral">"\t cWndReferenceCount 0x%08lx\n"</span>
03383               <span class="stringliteral">"\t flags              %s\n"</span>,
03384 
03385               localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o0">pclsNext</a>,
03386               localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a>,
03387               localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o2">fnid</a>,
03388               localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o4">pdce</a>,
03389               localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o5">cWndReferenceCount</a>,
<a name="l03390"></a><a class="code" href="../../d2/d1/userexts_8c.html#a193">03390</a>               <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_CSF, (WORD)localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o7">CSF_flags</a>, NULL, TRUE));
03391 
03392         <span class="keywordflow">if</span> (localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o8">lpszClientAnsiMenuName</a>) {
03393             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ach, localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o8">lpszClientAnsiMenuName</a>);
03394             ach[<span class="keyword">sizeof</span>(ach) - 1] = <span class="charliteral">'\0'</span>;
03395         } <span class="keywordflow">else</span> {
03396             ach[0] = <span class="charliteral">'\0'</span>;
03397         }
03398         Print(<span class="stringliteral">"\t lpszClientMenu    @0x%p (%s)\n"</span>,
03399               localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o9">lpszClientUnicodeMenuName</a>,
03400               ach);
03401 
03402         Print(<span class="stringliteral">"\t hTaskWow           0x%08lx\n"</span>
03403               <span class="stringliteral">"\t spcpdFirst        @0x%p\n"</span>
03404               <span class="stringliteral">"\t pclsBase          @0x%p\n"</span>
03405               <span class="stringliteral">"\t pclsClone         @0x%p\n"</span>,
03406               localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o6">hTaskWow</a>,
03407               localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o10">spcpdFirst</a>,
03408               localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o11">pclsBase</a>,
03409               localCLS.<a class="code" href="../../d7/d0/structtagCLS.html#o12">pclsClone</a>);
03410 
03411         GetSym((LPVOID)localCLS.lpfnWndProc, ach, &amp;dwOffset);
03412         Print(<span class="stringliteral">"\t style              %s\n"</span>
03413               <span class="stringliteral">"\t lpfnWndProc       @0x%p = \"%s\" \n"</span>
03414               <span class="stringliteral">"\t cbclsExtra         0x%08lx\n"</span>
<a name="l03415"></a><a class="code" href="../../d2/d1/userexts_8c.html#a194">03415</a>               <span class="stringliteral">"\t cbwndExtra         0x%08lx\n"</span>
03416               <span class="stringliteral">"\t hModule            0x%08lx\n"</span>
03417               <span class="stringliteral">"\t spicn             @0x%p\n"</span>
03418               <span class="stringliteral">"\t spcur             @0x%p\n"</span>
03419               <span class="stringliteral">"\t hbrBackground      0x%08lx\n"</span>
03420               <span class="stringliteral">"\t spicnSm           @0x%p\n"</span>,
03421               <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_CS, localCLS.style, NULL, TRUE),
03422               localCLS.lpfnWndProc, ach,
03423               localCLS.cbclsExtra,
03424               localCLS.cbwndExtra,
03425               localCLS.hModule,
03426               localCLS.spicn,
03427               localCLS.spcur,
03428               localCLS.hbrBackground,
03429               localCLS.spicnSm);
03430     }
03431 
03432     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03433 }
03434 <span class="preprocessor">#endif // KERNEL</span>
03435 <span class="preprocessor"></span>
03436 
03437 
03438 <span class="preprocessor">#ifdef KERNEL</span>
03439 <span class="preprocessor"></span>
<a name="l03440"></a><a class="code" href="../../d2/d1/userexts_8c.html#a195">03440</a> 
03441 
03442 LPSTR <a class="code" href="../../d7/d7/uclient_8c.html#a2">ProcessName</a>(
03443     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a> ppi)
03444 {
03445     W32PROCESS w32p;
03446     <span class="keyword">static</span> UCHAR ImageFileName[16];
03447 
03448     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(w32p, ppi);
03449     <a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(w32p.Process, <a class="code" href="../../d9/d3/w32_2ntuser_2kdexts_2precomp_8h.html#a2">PROCESS_IMAGEFILENAME</a>, ImageFileName);
03450     <span class="keywordflow">if</span> (ImageFileName[0]) {
03451         <span class="keywordflow">return</span> ImageFileName;
03452     } <span class="keywordflow">else</span> {
03453         <span class="keywordflow">return</span> <span class="stringliteral">"System"</span>;
03454     }
03455 }
03456 
03457 
03458 
03459 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> PrintCurHeader()
03460 {
03461     Print(<span class="stringliteral">"P = Process Owned.\n"</span>);
03462     Print(<span class="stringliteral">"P .pcursor flg rt ..lpName aMod bpp ..cx ..cy xHot yHot .hbmMask hbmColor\n"</span>);
03463 }
03464 
03465 
03466 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> PrintCurData(
03467 <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcur,
03468 DWORD opts)
03469 {
03470     <a class="code" href="../../d6/d1/structtagCURSOR.html">CURSOR</a> cur;
03471 
03472     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cur, pcur);
03473 
03474     <span class="keywordflow">if</span> ((opts &amp; OFLAG(x)) &amp;&amp;
03475             cur.CURSORF_flags &amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a539">CURSORF_ACONFRAME</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a541">CURSORF_LINKED</a>)) {
03476         <span class="keywordflow">return</span>; <span class="comment">// skip acon frame or linked objects.</span>
03477     }
03478     <span class="keywordflow">if</span> (cur.CURSORF_flags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a537">CURSORF_ACON</a>) {
03479         <a class="code" href="../../d1/d8/structtagACON.html">ACON</a> acon;
<a name="l03480"></a><a class="code" href="../../d2/d1/userexts_8c.html#a196">03480</a> 
03481         <span class="keywordflow">if</span> (opts &amp; OFLAG(a)) {
03482             Print(<span class="stringliteral">"--------------\n"</span>);
03483         }
03484         <span class="keywordflow">if</span> (opts &amp; OFLAG(o)) {
03485             Print(<span class="stringliteral">"Owner:%#p(%s)\n"</span>, cur.head.ppi, <a class="code" href="../../d7/d7/uclient_8c.html#a2">ProcessName</a>(cur.head.ppi));
03486         }
03487         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(acon, pcur);
03488         <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
03489             Print(<span class="stringliteral">"\nACON @%x:\n"</span>, pcur);
03490             Print(<span class="stringliteral">"  ppiOwner       = %#p\n"</span>, (DWORD_PTR)cur.head.ppi);
03491             Print(<span class="stringliteral">"  CURSORF_flags  = %s\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_CURSORF, cur.CURSORF_flags, NULL, TRUE));
03492             Print(<span class="stringliteral">"  strName        = %#p\n"</span>, (DWORD_PTR)cur.strName.Buffer);
03493             Print(<span class="stringliteral">"  atomModName    = %x\n"</span>, cur.atomModName);
03494             Print(<span class="stringliteral">"  rt             = %x\n"</span>, cur.rt);
03495         } <span class="keywordflow">else</span> {
03496             Print(<span class="stringliteral">"%c %8x %3x %2x %8x %4x --- ACON (%d frames)\n"</span>,
03497                 cur.head.ppi ? <span class="charliteral">'P'</span> : <span class="charliteral">' '</span>,
03498                 pcur,
03499                 cur.CURSORF_flags,
03500                 cur.rt,
03501                 cur.strName.Buffer,
03502                 cur.atomModName,
03503                 acon.cpcur);
03504         }
03505         <span class="keywordflow">if</span> (opts &amp; OFLAG(a)) {
03506             Print(<span class="stringliteral">"%d animation sequences, currently at step %d.\n"</span>,
03507                     acon.cicur,
03508                     acon.iicur);
03509             <span class="keywordflow">while</span> (acon.cpcur--) {
03510                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pcur, acon.aspcur++);
03511                 PrintCurData(pcur, opts &amp; ~(OFLAG(x) | OFLAG(o)));
03512             }
03513             Print(<span class="stringliteral">"--------------\n"</span>);
03514         }
03515     } <span class="keywordflow">else</span> {
<a name="l03516"></a><a class="code" href="../../d2/d1/userexts_8c.html#a197">03516</a>         <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
03517             Print(<span class="stringliteral">"\nCursor/Icon @%x:\n"</span>, pcur);
03518             Print(<span class="stringliteral">"  ppiOwner       = %#p(%s)\n"</span>,
03519                   (DWORD_PTR)cur.head.ppi,
03520                   <a class="code" href="../../d7/d7/uclient_8c.html#a2">ProcessName</a>(cur.head.ppi));
03521             Print(<span class="stringliteral">"  pcurNext       = %x\n"</span>, cur.pcurNext);
03522             Print(<span class="stringliteral">"  CURSORF_flags  = %s\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a259a154">GF_CURSORF</a>, cur.CURSORF_flags, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>));
03523             Print(<span class="stringliteral">"  strName        = %#p\n"</span>, (DWORD_PTR)cur.strName.Buffer);
03524             Print(<span class="stringliteral">"  atomModName    = %x\n"</span>, cur.atomModName);
03525             Print(<span class="stringliteral">"  rt             = %x\n"</span>, cur.rt);
03526             Print(<span class="stringliteral">"  bpp            = %x\n"</span>, cur.bpp);
03527             Print(<span class="stringliteral">"  cx             = %x\n"</span>, cur.cx);
03528             Print(<span class="stringliteral">"  cy             = %x\n"</span>, cur.cy);
03529             Print(<span class="stringliteral">"  xHotspot       = %x\n"</span>, cur.xHotspot);
03530             Print(<span class="stringliteral">"  yHotspot       = %x\n"</span>, cur.yHotspot);
03531             Print(<span class="stringliteral">"  hbmMask        = %x\n"</span>, cur.hbmMask);
03532             Print(<span class="stringliteral">"  hbmColor       = %x\n"</span>, cur.hbmColor);
03533         } <span class="keywordflow">else</span> {
03534             <span class="keywordflow">if</span> (opts &amp; OFLAG(o)) {
03535                 Print(<span class="stringliteral">"Owner:%x(%s)\n"</span>, cur.head.ppi, <a class="code" href="../../d7/d7/uclient_8c.html#a2">ProcessName</a>(cur.head.ppi));
03536             }
03537             Print(<span class="stringliteral">"%c %8x %3x %2x %8x %4x %3x %4x %4x %4x %4x %8x %8x\n"</span>,
03538                 cur.head.ppi ? <span class="charliteral">'P'</span> : <span class="charliteral">' '</span>,
03539                 pcur,
03540                 cur.CURSORF_flags,
03541                 cur.rt,
03542                 cur.strName.Buffer,
03543                 cur.atomModName,
03544                 cur.bpp,
03545                 cur.cx,
03546                 cur.cy,
03547                 cur.xHotspot,
03548                 cur.yHotspot,
03549                 cur.hbmMask,
03550                 cur.hbmColor);
03551         }
03552     }
03553 }
03554 
03555 
03556 <span class="comment">/************************************************************************\</span>
03557 <span class="comment">* Procedure: Idcur</span>
03558 <span class="comment">*</span>
03559 <span class="comment">* Description: Dump cursor structures</span>
03560 <span class="comment">*</span>
<a name="l03561"></a><a class="code" href="../../d2/d1/userexts_8c.html#a198">03561</a> <span class="comment">* Returns: fSuccess</span>
03562 <span class="comment">*</span>
03563 <span class="comment">* 6/9/1995 Created SanfordS</span>
03564 <span class="comment">*</span>
03565 <span class="comment">\************************************************************************/</span>
03566 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idcur(
03567     DWORD opts,
03568     PVOID param1)
03569 {
03570     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PROCESSINFO</a> pi, *ppi, *ppiDesired = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03571     <a class="code" href="../../d6/d1/structtagCURSOR.html">CURSOR</a> cur, *pcur;
03572     <span class="keywordtype">int</span> cCursors = 0;
03573     INT_PTR idDesired = 0;
03574     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he, *phe;
03575     <span class="keywordtype">int</span> i;
03576 
03577     <span class="keywordflow">if</span> (OFLAG(p) &amp; opts) {
03578         ppiDesired = (<a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a>)param1;
03579         param1 = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03580     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (OFLAG(i) &amp; opts) {
03581         idDesired = (INT_PTR)param1;
03582         param1 = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03583     }
03584     <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03585         <span class="keywordflow">if</span> (!(OFLAG(v) &amp; opts)) {
03586             PrintCurHeader();
03587         }
03588         moveExpValuePtr(&amp;pcur, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a155">gpcurFirst</a>));
03589         <span class="keywordflow">if</span> (pcur != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; ppiDesired == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03590             Print(<span class="stringliteral">"Global cache:\n"</span>);
03591             <span class="keywordflow">while</span> (pcur) {
03592                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cur, pcur);
03593                 <span class="keywordflow">if</span> (!idDesired || ((INT_PTR)cur.strName.Buffer == idDesired)) {
03594                     <span class="keywordflow">if</span> (cur.head.ppi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03595                         Print(<span class="stringliteral">"Wrong cache! Owned by %x! --v\n"</span>, cur.head.ppi);
03596                     }
03597                     PrintCurData((<a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>)pcur, opts);
03598                 }
03599                 pcur = cur.pcurNext;
03600             }
03601         }
03602         FOREACHPPI(ppi)
03603             <span class="keywordflow">if</span> (ppiDesired == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || ppiDesired == ppi) {
03604                 <span class="keywordflow">if</span> (tryMove(pi, ppi)) {
03605                     <span class="keywordflow">if</span> (pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o22">pCursorCache</a>) {
<a name="l03606"></a><a class="code" href="../../d2/d1/userexts_8c.html#a199">03606</a>                         Print(<span class="stringliteral">"Cache for process %x(%s):\n"</span>, ppi, <a class="code" href="../../d7/d7/uclient_8c.html#a2">ProcessName</a>(ppi));
03607                         pcur = pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o22">pCursorCache</a>;
03608                         <span class="keywordflow">while</span> (pcur) {
03609                             <span class="keywordflow">if</span> (tryMove(cur, pcur)) {
03610                                 <span class="keywordflow">if</span> (!idDesired || ((INT_PTR)cur.strName.Buffer == idDesired)) {
03611                                     <span class="keywordflow">if</span> (cur.head.ppi != ppi) {
03612                                         Print(<span class="stringliteral">"Wrong cache! Owned by %x! --v\n"</span>, cur.head.ppi);
03613                                     }
03614                                     PrintCurData((<a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>)pcur, opts);
03615                                 }
03616                                 pcur = cur.pcurNext;
03617                             } <span class="keywordflow">else</span> {
03618                                 Print(<span class="stringliteral">"Could not access %x.\n"</span>, pcur);
03619                                 <span class="keywordflow">break</span>;
03620                             }
03621                         }
03622                     }
03623                 } <span class="keywordflow">else</span> {
03624                     Print(<span class="stringliteral">"Failed to access ppi %x.\n"</span>, ppi);
03625                 }
03626             }
03627         NEXTEACHPPI();
03628         Print(<span class="stringliteral">"Non-cached cursor objects:\n"</span>);
03629         <a class="code" href="../../d2/d1/userexts_8c.html#a8">FOREACHHANDLEENTRY</a>(phe, he, i)
03630             if (he.bType == TYPE_CURSOR) {
03631                 <a class="code" href="../../d6/d1/structtagCURSOR.html">CURSOR</a> cur;
03632 
03633                 <span class="keywordflow">if</span> (tryMove(cur, he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>)) {
03634                     <span class="keywordflow">if</span> (!(cur.CURSORF_flags &amp; (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a541">CURSORF_LINKED</a> | <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a539">CURSORF_ACONFRAME</a>)) &amp;&amp;
03635                             (!idDesired || (INT_PTR)cur.strName.Buffer == idDesired) &amp;&amp;
<a name="l03636"></a><a class="code" href="../../d2/d1/userexts_8c.html#a204">03636</a>                             (ppiDesired == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || ppiDesired == cur.head.ppi)) {
03637                         Print(<span class="stringliteral">"%x:"</span>, i);
03638                         PrintCurData((<a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>)he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>, opts | OFLAG(x) | OFLAG(o));
03639                     }
03640                 } <span class="keywordflow">else</span> {
03641                     Print(<span class="stringliteral">"Could not access phead(%x) of handle %x.\n"</span>, he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>, i);
03642                 }
03643                 cCursors++;
03644             }
03645         <a class="code" href="../../d2/d1/userexts_8c.html#a9">NEXTEACHHANDLEENTRY</a>()
03646         Print("%d Cursors/Icons Total.\n", cCursors);
03647         return TRUE;
03648     }
03649 
03650     pcur = HorPtoP(param1, TYPE_CURSOR);
03651     if (pcur == NULL) {
03652         Print(<span class="stringliteral">"%8x : Invalid cursor handle or pointer.\n"</span>, param1);
03653         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03654     }
<a name="l03655"></a><a class="code" href="../../d2/d1/userexts_8c.html#a205">03655</a> 
03656     <span class="keywordflow">if</span> (!(OFLAG(v) &amp; opts)) {
03657         PrintCurHeader();
03658     }
03659     PrintCurData(pcur, opts);
03660     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03661 }
03662 <span class="preprocessor">#endif // KERNEL</span>
03663 <span class="preprocessor"></span>
<a name="l03664"></a><a class="code" href="../../d2/d1/userexts_8c.html#a132">03664</a> 
03665 
03666 <span class="preprocessor">#ifdef KERNEL</span>
03667 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
03668 <span class="comment">* Procedure: ddeexact</span>
03669 <span class="comment">*</span>
03670 <span class="comment">* Description: Dumps DDEML transaction structures.</span>
03671 <span class="comment">*</span>
03672 <span class="comment">* Returns: fSuccess</span>
03673 <span class="comment">*</span>
03674 <span class="comment">* 6/9/1995 Created SanfordS</span>
03675 <span class="comment">*</span>
03676 <span class="comment">\************************************************************************/</span>
03677 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> dddexact(
03678     DWORD_PTR pOrg,
03679     <a class="code" href="../../d1/d0/structtagXSTATE.html">PXSTATE</a> pxs,
03680     DWORD opts)
03681 {
03682     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
03683         Print(<span class="stringliteral">"    XACT:0x%p\n"</span>, pOrg);
03684         Print(<span class="stringliteral">"      snext = 0x%08lx\n"</span>, pxs-&gt;<a class="code" href="../../d1/d0/structtagXSTATE.html#o1">snext</a>);
03685         Print(<span class="stringliteral">"      fnResponse = 0x%08lx\n"</span>, pxs-&gt;<a class="code" href="../../d1/d0/structtagXSTATE.html#o2">fnResponse</a>);
03686         Print(<span class="stringliteral">"      hClient = 0x%08lx\n"</span>, pxs-&gt;<a class="code" href="../../d1/d0/structtagXSTATE.html#o3">hClient</a>);
03687         Print(<span class="stringliteral">"      hServer = 0x%08lx\n"</span>, pxs-&gt;<a class="code" href="../../d1/d0/structtagXSTATE.html#o4">hServer</a>);
03688         Print(<span class="stringliteral">"      pIntDdeInfo = 0x%08lx\n"</span>, pxs-&gt;<a class="code" href="../../d1/d0/structtagXSTATE.html#o5">pIntDdeInfo</a>);
03689     } <span class="keywordflow">else</span> {
03690         Print(<span class="stringliteral">"0x%p(0x%08lx) "</span>, pOrg, pxs-&gt;<a class="code" href="../../d1/d0/structtagXSTATE.html#o6">flags</a>);
03691     }
03692     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03693 }
03694 <span class="preprocessor">#endif // KERNEL</span>
03695 <span class="preprocessor"></span>
03696 
03697 
03698 <span class="preprocessor">#ifdef KERNEL</span>
03699 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
03700 <span class="comment">* Procedure: ddeconv</span>
03701 <span class="comment">*</span>
03702 <span class="comment">* Description: Dumps DDE tracking layer conversation structures.</span>
03703 <span class="comment">*</span>
03704 <span class="comment">* Returns: fSuccess</span>
03705 <span class="comment">*</span>
03706 <span class="comment">* 6/9/1995 Created SanfordS</span>
03707 <span class="comment">*</span>
03708 <span class="comment">\************************************************************************/</span>
03709 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> dddeconv(
03710     DWORD_PTR pOrg,
03711     <a class="code" href="../../d6/d2/structtagDDECONV.html">PDDECONV</a> pddeconv,
03712     DWORD opts)
03713 {
03714     <a class="code" href="../../d7/d2/structtagDDEIMP.html">DDEIMP</a> ddei;
03715     <a class="code" href="../../d1/d0/structtagXSTATE.html">XSTATE</a> xs;
03716     <a class="code" href="../../d1/d0/structtagXSTATE.html">PXSTATE</a> pxs;
03717     <span class="keywordtype">int</span> cX;
03718 
03719 
03720     Print(<span class="stringliteral">"  CONVERSATION-PAIR(0x%p:0x%08lx)\n"</span>, pOrg, pddeconv-&gt;<a class="code" href="../../d6/d2/structtagDDECONV.html#o2">spartnerConv</a>);
03721     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
03722         Print(<span class="stringliteral">"    snext        = 0x%08lx\n"</span>, pddeconv-&gt;<a class="code" href="../../d6/d2/structtagDDECONV.html#o1">snext</a>);
03723         Print(<span class="stringliteral">"    spwnd        = 0x%08lx\n"</span>, pddeconv-&gt;<a class="code" href="../../d6/d2/structtagDDECONV.html#o3">spwnd</a>);
03724         Print(<span class="stringliteral">"    spwndPartner = 0x%08lx\n"</span>, pddeconv-&gt;<a class="code" href="../../d6/d2/structtagDDECONV.html#o4">spwndPartner</a>);
03725     }
03726     <span class="keywordflow">if</span> (opts &amp; (OFLAG(v) | OFLAG(r))) {
03727         <span class="keywordflow">if</span> (pddeconv-&gt;<a class="code" href="../../d6/d2/structtagDDECONV.html#o5">spxsOut</a>) {
03728             pxs = pddeconv-&gt;<a class="code" href="../../d6/d2/structtagDDECONV.html#o5">spxsOut</a>;
03729             cX = 0;
03730             SAFEWHILE (pxs) {
03731                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(xs, pxs);
03732                 <span class="keywordflow">if</span> ((opts &amp; OFLAG(r)) &amp;&amp; !cX++) {
03733                     Print(<span class="stringliteral">"    Transaction chain:"</span>);
03734                 } <span class="keywordflow">else</span> {
03735                     Print(<span class="stringliteral">"    "</span>);
03736                 }
03737                 dddexact((DWORD_PTR)pxs, &amp;xs, opts);
03738                 <span class="keywordflow">if</span> (opts &amp; OFLAG(r)) {
03739                     pxs = xs.<a class="code" href="../../d1/d0/structtagXSTATE.html#o1">snext</a>;
03740                 } <span class="keywordflow">else</span> {
03741                     pxs = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03742                 }
03743                 <span class="keywordflow">if</span> (!pxs) {
03744                     Print(<span class="stringliteral">"\n"</span>);
03745                 }
03746             }
03747         }
03748     }
03749     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
03750         Print(<span class="stringliteral">"    pfl          = 0x%08lx\n"</span>, pddeconv-&gt;<a class="code" href="../../d6/d2/structtagDDECONV.html#o7">pfl</a>);
03751         Print(<span class="stringliteral">"    flags        = 0x%08lx\n"</span>, pddeconv-&gt;<a class="code" href="../../d6/d2/structtagDDECONV.html#o8">flags</a>);
03752         <span class="keywordflow">if</span> ((opts &amp; OFLAG(v)) &amp;&amp; (opts &amp; OFLAG(r)) &amp;&amp; pddeconv-&gt;<a class="code" href="../../d6/d2/structtagDDECONV.html#o9">pddei</a>) {
03753             Print(<span class="stringliteral">"    pddei    = 0x%08lx\n"</span>, pddeconv-&gt;<a class="code" href="../../d6/d2/structtagDDECONV.html#o9">pddei</a>);
03754             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ddei, pddeconv-&gt;<a class="code" href="../../d6/d2/structtagDDECONV.html#o9">pddei</a>);
03755             Print(<span class="stringliteral">"    Impersonation info:\n"</span>);
03756             Print(<span class="stringliteral">"      qos.Length                 = 0x%08lx\n"</span>, ddei.<a class="code" href="../../d7/d2/structtagDDEIMP.html#o0">qos</a>.Length);
03757             Print(<span class="stringliteral">"      qos.ImpersonationLevel     = 0x%08lx\n"</span>, ddei.<a class="code" href="../../d7/d2/structtagDDEIMP.html#o0">qos</a>.ImpersonationLevel);
03758             Print(<span class="stringliteral">"      qos.ContextTrackingMode    = 0x%08lx\n"</span>, ddei.<a class="code" href="../../d7/d2/structtagDDEIMP.html#o0">qos</a>.ContextTrackingMode);
03759             Print(<span class="stringliteral">"      qos.EffectiveOnly          = 0x%08lx\n"</span>, ddei.<a class="code" href="../../d7/d2/structtagDDEIMP.html#o0">qos</a>.EffectiveOnly);
03760             Print(<span class="stringliteral">"      ClientContext              = 0x%08lx\n"</span>, &amp;ddei.<a class="code" href="../../d7/d2/structtagDDEIMP.html#o1">ClientContext</a>);
03761             Print(<span class="stringliteral">"      cRefInit                   = 0x%08lx\n"</span>, ddei.<a class="code" href="../../d7/d2/structtagDDEIMP.html#o2">cRefInit</a>);
03762             Print(<span class="stringliteral">"      cRefConv                   = 0x%08lx\n"</span>, ddei.<a class="code" href="../../d7/d2/structtagDDEIMP.html#o3">cRefConv</a>);
03763         }
03764     }
03765     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03766 }
03767 <span class="preprocessor">#endif // KERNEL</span>
03768 <span class="preprocessor"></span>
03769 
03770 
03771 <span class="preprocessor">#ifdef KERNEL</span>
03772 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
03773 <span class="comment">* Procedure: Idde</span>
03774 <span class="comment">*</span>
03775 <span class="comment">* Description: Dumps DDE tracking layer state and structures.</span>
03776 <span class="comment">*</span>
03777 <span class="comment">* Returns: fSuccess</span>
03778 <span class="comment">*</span>
03779 <span class="comment">* 6/9/1995 Created SanfordS</span>
03780 <span class="comment">*</span>
03781 <span class="comment">\************************************************************************/</span>
03782 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idde(
03783 DWORD opts,
03784 PVOID param1)
03785 {
03786     <a class="code" href="../../d4/d5/struct__HEAD.html">HEAD</a> head;
03787     <a class="code" href="../../d6/d2/structtagDDECONV.html">DDECONV</a> ddeconv;
03788     <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">PSHAREDINFO</a> pshi;
03789     <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">SHAREDINFO</a> shi;
03790     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a> si;
03791     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he;
03792     DWORD_PTR cHandleEntries;
03793     HANDLE h;
03794     <a class="code" href="../../d6/d9/structtagWND.html">WND</a> wnd;
03795     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> i;
03796     PVOID pObj = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03797     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">PHE</a> pheList;
03798     <a class="code" href="../../d1/d4/structtagPROP.html">PROP</a> prop;
03799     <a class="code" href="../../d5/d4/structtagPROPLIST.html">PROPLIST</a> propList;
03800     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> atomDdeTrack;
03801     <a class="code" href="../../d1/d0/structtagXSTATE.html">XSTATE</a> xs;
03802 
03803     moveExpValue(&amp;atomDdeTrack, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(atomDDETrack));
03804     <a class="code" href="../../d2/d1/userexts_8c.html#a7">GETSHAREDINFO</a>(pshi);
03805     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(shi, pshi);
03806     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(si, shi.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o0">psi</a>);
03807     cHandleEntries = si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o4">cHandleEntries</a>;
03808     pheList = shi.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o1">aheList</a>;
03809 
03810     <span class="keywordflow">if</span> (param1) {
03811         <span class="comment">/*</span>
03812 <span class="comment">         * get object param.</span>
03813 <span class="comment">         */</span>
03814         h = (HANDLE)param1;
03815         i = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a432">HMIndexFromHandle</a>(h);
03816         <span class="keywordflow">if</span> (i &gt;= cHandleEntries) {
03817             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(head, h);
03818             i = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a432">HMIndexFromHandle</a>(head.<a class="code" href="../../d4/d5/struct__HEAD.html#o0">h</a>);
03819         }
03820         <span class="keywordflow">if</span> (i &gt;= cHandleEntries) {
03821             Print(<span class="stringliteral">"0x%08lx is not a valid object.\n"</span>, h);
03822             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03823         }
03824         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(he, &amp;pheList[i]);
03825         pObj = <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>);
03826         <span class="comment">/*</span>
03827 <span class="comment">         * verify type.</span>
03828 <span class="comment">         */</span>
03829         <span class="keywordflow">switch</span> (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>) {
03830         <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a237">TYPE_WINDOW</a>:
03831             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wnd, pObj);
03832             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(propList, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o13">ppropList</a>);
03833             <span class="keywordflow">for</span> (i = 0; i &lt; propList.<a class="code" href="../../d5/d4/structtagPROPLIST.html#o1">iFirstFree</a>; i++) {
03834                 <span class="keywordflow">if</span> (i == 0) {
03835                     Print(<span class="stringliteral">"Window 0x%08lx conversations:\n"</span>, h);
03836                 }
03837                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(prop, &amp;propList.<a class="code" href="../../d5/d4/structtagPROPLIST.html#o2">aprop</a>[i]);
03838                 <span class="keywordflow">if</span> (prop.<a class="code" href="../../d1/d4/structtagPROP.html#o1">atomKey</a> == (ATOM)<a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(atomDdeTrack)) {
03839                     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ddeconv, (<a class="code" href="../../d6/d2/structtagDDECONV.html">PDDECONV</a>)prop.<a class="code" href="../../d1/d4/structtagPROP.html#o0">hData</a>);
03840                     Print(<span class="stringliteral">"  "</span>);
03841                     dddeconv((DWORD_PTR)prop.<a class="code" href="../../d1/d4/structtagPROP.html#o0">hData</a>,
03842                             &amp;ddeconv,
03843                             opts);
03844                 }
03845             }
03846             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03847 
03848         <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a246">TYPE_DDECONV</a>:
03849         <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a247">TYPE_DDEXACT</a>:
03850             <span class="keywordflow">break</span>;
03851 
03852         <span class="keywordflow">default</span>:
03853             Print(<span class="stringliteral">"0x%08lx is not a valid window, conversation or transaction object.\n"</span>, h);
03854             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03855         }
03856     }
03857 
03858     <span class="comment">/*</span>
03859 <span class="comment">     * look for all qualifying objects in the object table.</span>
03860 <span class="comment">     */</span>
03861 
03862     Print(<span class="stringliteral">"DDE objects:\n"</span>);
03863     <span class="keywordflow">for</span> (i = 0; i &lt; cHandleEntries; i++) {
03864         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(he, &amp;pheList[i]);
03865         <span class="keywordflow">if</span> (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a> == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a246">TYPE_DDECONV</a> &amp;&amp; (pObj == <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>) || pObj == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
03866             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ddeconv, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>));
03867             dddeconv((DWORD_PTR)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>),
03868                     (<a class="code" href="../../d6/d2/structtagDDECONV.html">PDDECONV</a>)&amp;ddeconv,
03869                     opts);
03870         }
03871 
03872         <span class="keywordflow">if</span> (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a> == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a247">TYPE_DDEXACT</a> &amp;&amp; (pObj == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || pObj == <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>))) {
03873             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(xs, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>));
03874             <span class="keywordflow">if</span> (!(opts &amp; OFLAG(v))) {
03875                 Print(<span class="stringliteral">"  XACT:"</span>);
03876             }
03877             dddexact((DWORD_PTR)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>),
03878                      (<a class="code" href="../../d1/d0/structtagXSTATE.html">PXSTATE</a>)&amp;xs,
03879                      opts);
03880             Print(<span class="stringliteral">"\n"</span>);
<a name="l03881"></a><a class="code" href="../../d2/d1/userexts_8c.html#a206">03881</a>         }
03882     }
03883     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03884 }
03885 <span class="preprocessor">#endif // KERNEL</span>
03886 <span class="preprocessor"></span>
03887 
03888 
03889 <span class="preprocessor">#ifndef KERNEL</span>
03890 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
03891 <span class="comment">* Procedure: Iddeml</span>
03892 <span class="comment">*</span>
03893 <span class="comment">* Description: Dumps the DDEML state for this client process.</span>
03894 <span class="comment">*</span>
03895 <span class="comment">* Returns: fSuccess</span>
03896 <span class="comment">*</span>
03897 <span class="comment">* 6/9/1995 Created SanfordS</span>
03898 <span class="comment">*</span>
03899 <span class="comment">\************************************************************************/</span>
03900 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a213">Iddeml</a>(
03901     DWORD opts,
03902     LPSTR lpas)
03903 {
03904     <a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html">CHANDLEENTRY</a> he, *phe;
03905     <span class="keywordtype">int</span> cHandles, ch, i;
03906     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Type;
03907     DWORD_PTR Instance, Object, Pointer;
03908     <a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html">CL_INSTANCE_INFO</a> cii, *pcii;
03909     ATOM ns;
03910     <a class="code" href="../../d1/d6/structtagSERVER__LOOKUP.html">SERVER_LOOKUP</a> sl;
03911     <a class="code" href="../../d0/d0/structtagLINK__COUNT.html">LINK_COUNT</a> lc;
03912     <a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">CL_CONV_INFO</a> cci;
03913     <a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a> pcci;
03914     <a class="code" href="../../d3/d1/structtagCONVLIST.html">CONVLIST</a> cl;
03915     HWND hwnd, *phwnd;
03916     <a class="code" href="../../d0/d0/structtagXACT__INFO.html">XACT_INFO</a> xi;
03917     <a class="code" href="../../d8/d2/structtagDDEMLDATA.html">DDEMLDATA</a> dd;
03918     <a class="code" href="../../d2/d1/structtagCONV__INFO.html">CONV_INFO</a> ci;
03919 
03920     moveExpValue(&amp;cHandles, <span class="stringliteral">"user32!cHandlesAllocated"</span>);
03921 
03922     Instance = 0;
03923     Type = 0;
03924     Object = 0;
03925     Pointer = 0;
03926     SAFEWHILE (*lpas) {
03927         SAFEWHILE (*lpas == <span class="charliteral">' '</span>)
03928             lpas++;
03929 
03930         <span class="keywordflow">if</span> (*lpas == <span class="charliteral">'i'</span>) {
03931             lpas++;
03932             Instance = (DWORD_PTR)EvalExp(lpas);
03933             SAFEWHILE (*lpas != <span class="charliteral">' '</span> &amp;&amp; *lpas != 0)
03934                 lpas++;
03935             <span class="keywordflow">continue</span>;
03936         }
03937         <span class="keywordflow">if</span> (*lpas == <span class="charliteral">'t'</span>) {
03938             lpas++;
03939             Type = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(DWORD_PTR)EvalExp(lpas);
03940             SAFEWHILE (*lpas != <span class="charliteral">' '</span> &amp;&amp; *lpas != 0)
03941                 lpas++;
03942             <span class="keywordflow">continue</span>;
03943         }
03944         <span class="keywordflow">if</span> (*lpas) {
03945             Object = Pointer = (DWORD_PTR)EvalExp(lpas);
03946             SAFEWHILE (*lpas != <span class="charliteral">' '</span> &amp;&amp; *lpas != 0)
03947                 lpas++;
03948         }
03949     }
03950 
03951     <span class="comment">/*</span>
03952 <span class="comment">     * for each instance for this process...</span>
03953 <span class="comment">     */</span>
03954 
03955     moveExpValuePtr(&amp;pcii, <span class="stringliteral">"user32!pciiList"</span>);
03956     <span class="keywordflow">if</span> (pcii == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
03957         Print(<span class="stringliteral">"No Instances exist.\n"</span>);
03958         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03959     }
03960     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cii, pcii);
03961     SAFEWHILE(pcii != NULL) {
03962         pcii = cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o0">next</a>;
03963         <span class="keywordflow">if</span> (Instance == 0 || (Instance == (DWORD_PTR)cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o2">hInstClient</a>)) {
03964             Print(<span class="stringliteral">"Objects for instance 0x%p:\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o2">hInstClient</a>);
<a name="l03965"></a><a class="code" href="../../d2/d1/userexts_8c.html#a207">03965</a>             ch = cHandles;
03966             moveExpValuePtr(&amp;phe, <span class="stringliteral">"user32!aHandleEntry"</span>);
03967             SAFEWHILE (ch--) {
03968                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(he, phe++);
03969                 <span class="keywordflow">if</span> (he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o0">handle</a> == 0) {
03970                     <span class="keywordflow">continue</span>;
03971                 }
03972                 <span class="keywordflow">if</span> (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a28">InstFromHandle</a>(cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o2">hInstClient</a>) != <a class="code" href="../../d0/d4/ddemlcli_8h.html#a28">InstFromHandle</a>(he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o0">handle</a>)) {
03973                     <span class="keywordflow">continue</span>;
03974                 }
03975                 <span class="keywordflow">if</span> (Type &amp;&amp; <a class="code" href="../../d0/d4/ddemlcli_8h.html#a27">TypeFromHandle</a>(he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o0">handle</a>) != Type) {
03976                     <span class="keywordflow">continue</span>;
03977                 }
03978                 <span class="keywordflow">if</span> (Object &amp;&amp; (he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o0">handle</a> != (HANDLE)Object) &amp;&amp;
03979                     Pointer &amp;&amp; he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o1">dwData</a> != Pointer) {
03980                     <span class="keywordflow">continue</span>;
03981                 }
03982                 Print(<span class="stringliteral">"  (0x%08lx)-&gt;0x%08lx "</span>, he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o0">handle</a>, he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o1">dwData</a>);
03983                 <span class="keywordflow">switch</span> (<a class="code" href="../../d0/d4/ddemlcli_8h.html#a27">TypeFromHandle</a>(he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o0">handle</a>)) {
03984                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d4/ddemlcli_8h.html#a34">HTYPE_INSTANCE</a>:
03985                     Print(<span class="stringliteral">"Instance\n"</span>);
03986                     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
03987                         Print(<span class="stringliteral">"    next               = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o0">next</a>);
03988                         Print(<span class="stringliteral">"    hInstServer        = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o1">hInstServer</a>);
03989                         Print(<span class="stringliteral">"    hInstClient        = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o2">hInstClient</a>);
03990                         Print(<span class="stringliteral">"    MonitorFlags       = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o3">MonitorFlags</a>);
03991                         Print(<span class="stringliteral">"    hwndMother         = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o4">hwndMother</a>);
03992                         Print(<span class="stringliteral">"    hwndEvent          = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o5">hwndEvent</a>);
03993                         Print(<span class="stringliteral">"    hwndTimeout        = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o6">hwndTimeout</a>);
03994                         Print(<span class="stringliteral">"    afCmd              = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o7">afCmd</a>);
03995                         Print(<span class="stringliteral">"    pfnCallback        = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o8">pfnCallback</a>);
03996                         Print(<span class="stringliteral">"    LastError          = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o9">LastError</a>);
03997                         Print(<span class="stringliteral">"    tid                = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o10">tid</a>);
03998                         Print(<span class="stringliteral">"    plaNameService     = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o11">plaNameService</a>);
03999                         Print(<span class="stringliteral">"    cNameServiceAlloc  = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o12">cNameServiceAlloc</a>);
04000                         SAFEWHILE (cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o12">cNameServiceAlloc</a>--) {
04001                             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ns, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o11">plaNameService</a>++);
04002                             Print(<span class="stringliteral">"      0x%04lx\n"</span>, ns);
04003                         }
04004                         Print(<span class="stringliteral">"    aServerLookup      = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o13">aServerLookup</a>);
04005                         Print(<span class="stringliteral">"    cServerLookupAlloc = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o14">cServerLookupAlloc</a>);
04006                         SAFEWHILE (cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o14">cServerLookupAlloc</a>--) {
04007                             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(sl, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o13">aServerLookup</a>++);
04008                             Print(<span class="stringliteral">"      laService  = 0x%04x\n"</span>, sl.<a class="code" href="../../d1/d6/structtagSERVER__LOOKUP.html#o0">laService</a>);
04009                             Print(<span class="stringliteral">"      laTopic    = 0x%04x\n"</span>, sl.<a class="code" href="../../d1/d6/structtagSERVER__LOOKUP.html#o1">laTopic</a>);
04010                             Print(<span class="stringliteral">"      hwndServer = 0x%08lx\n"</span>, sl.<a class="code" href="../../d1/d6/structtagSERVER__LOOKUP.html#o2">hwndServer</a>);
04011                             <span class="keywordflow">if</span> (cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o14">cServerLookupAlloc</a>) {
04012                                 Print(<span class="stringliteral">"      ---\n"</span>);
04013                             }
04014                         }
04015                         Print(<span class="stringliteral">"    ConvStartupState   = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o15">ConvStartupState</a>);
04016                         Print(<span class="stringliteral">"    flags              = %s\n"</span>,
04017                                 <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_IIF, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o16">flags</a>, NULL, TRUE));
04018                         Print(<span class="stringliteral">"    cInDDEMLCallback   = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o17">cInDDEMLCallback</a>);
04019                         Print(<span class="stringliteral">"    pLinkCount         = 0x%08lx\n"</span>, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o18">pLinkCount</a>);
04020                         SAFEWHILE (cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o18">pLinkCount</a>) {
04021                             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(lc, cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o18">pLinkCount</a>);
04022                             cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o18">pLinkCount</a> = lc.<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o0">next</a>;
04023                             Print(<span class="stringliteral">"      next    = 0x%08lx\n"</span>, lc.<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o0">next</a>);
04024                             Print(<span class="stringliteral">"      laTopic = 0x%04x\n"</span>, lc.<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o1">laTopic</a>);
04025                             Print(<span class="stringliteral">"      gaItem  = 0x%04x\n"</span>, lc.<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o2">gaItem</a>);
04026                             Print(<span class="stringliteral">"      laItem  = 0x%04x\n"</span>, lc.<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o3">laItem</a>);
04027                             Print(<span class="stringliteral">"      wFmt    = 0x%04x\n"</span>, lc.<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o4">wFmt</a>);
04028                             Print(<span class="stringliteral">"      Total   = 0x%04x\n"</span>, lc.<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o5">Total</a>);
04029                             Print(<span class="stringliteral">"      Count   = 0x%04x\n"</span>, lc.<a class="code" href="../../d0/d0/structtagLINK__COUNT.html#o6">Count</a>);
04030                             <span class="keywordflow">if</span> (cii.<a class="code" href="../../d2/d0/structtagCL__INSTANCE__INFO.html#o18">pLinkCount</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04031                                 Print(<span class="stringliteral">"      ---\n"</span>);
04032                             }
04033                         }
04034                     }
04035                     <span class="keywordflow">break</span>;
04036 
04037                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d4/ddemlcli_8h.html#a40">HTYPE_ZOMBIE_CONVERSATION</a>:
04038                     Print(<span class="stringliteral">"Zombie Conversation\n"</span>);
04039                     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
04040                         <a class="code" href="../../d2/d1/userexts_8c.html#a189">DumpConvInfo</a>((<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>)he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o1">dwData</a>);
04041                     }
04042                     <span class="keywordflow">break</span>;
04043 
04044                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d4/ddemlcli_8h.html#a35">HTYPE_SERVER_CONVERSATION</a>:
04045                     Print(<span class="stringliteral">"Server Conversation\n"</span>);
04046                     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
04047                         <a class="code" href="../../d2/d1/userexts_8c.html#a189">DumpConvInfo</a>((<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>)he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o1">dwData</a>);
04048                     }
04049                     <span class="keywordflow">break</span>;
04050 
04051                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d4/ddemlcli_8h.html#a36">HTYPE_CLIENT_CONVERSATION</a>:
04052                     Print(<span class="stringliteral">"Client Conversation\n"</span>);
04053                     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
04054                         <a class="code" href="../../d2/d1/userexts_8c.html#a189">DumpConvInfo</a>((<a class="code" href="../../d2/d1/structtagCONV__INFO.html">PCONV_INFO</a>)he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o1">dwData</a>);
04055                     }
04056                     <span class="keywordflow">break</span>;
04057 
04058                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d4/ddemlcli_8h.html#a37">HTYPE_CONVERSATION_LIST</a>:
04059 
04060                     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a201">IsRemoteSession</a>()) {
04061                         Print(<span class="stringliteral">"!ddeml for Conversation List doesn't work on HYDRA systems\n"</span>);
04062                     } <span class="keywordflow">else</span> {
04063                         Print(<span class="stringliteral">"Conversation List\n"</span>);
04064                         <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
04065                             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cl, (PVOID)he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o1">dwData</a>);
04066                             Print(<span class="stringliteral">"    pcl   = 0x%08lx\n"</span>, he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o1">dwData</a>);
04067                             Print(<span class="stringliteral">"    chwnd = 0x%08lx\n"</span>, cl.<a class="code" href="../../d3/d1/structtagCONVLIST.html#o0">chwnd</a>);
04068                             i = 0;
04069                             phwnd = (HWND *)&amp;((<a class="code" href="../../d3/d1/structtagCONVLIST.html">PCONVLIST</a>)he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o1">dwData</a>)-&gt;ahwnd;
04070                             SAFEWHILE(cl.<a class="code" href="../../d3/d1/structtagCONVLIST.html#o0">chwnd</a>--) {
04071                                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(hwnd, phwnd++);
04072                                 Print(<span class="stringliteral">"    ahwnd[%d] = 0x%08lx\n"</span>, i, hwnd);
04073                                 pcci = (<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)<a class="code" href="../../d5/d9/cltxt_8h.html#a11">GetWindowLongPtr</a>(hwnd, GWLP_PCI);
04074                                 SAFEWHILE (pcci) {
04075                                     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cci, pcci);
04076                                     pcci = (<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html">PCL_CONV_INFO</a>)cci.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o0">next</a>;
04077                                     Print(<span class="stringliteral">"      hConv = 0x%08lx\n"</span>, cci.<a class="code" href="../../d1/d0/structtagCL__CONV__INFO.html#o0">ci</a>.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o3">hConv</a>);
04078                                 }
04079                                 i++;
04080                             }
04081                         }
04082                     }
04083                     <span class="keywordflow">break</span>;
04084 
04085                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d4/ddemlcli_8h.html#a38">HTYPE_TRANSACTION</a>:
04086                     Print(<span class="stringliteral">"Transaction\n"</span>);
04087                     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
04088                         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(xi, (PVOID)he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o1">dwData</a>);
04089                         Print(<span class="stringliteral">"    next         = 0x%08lx\n"</span>, xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o0">next</a>);
04090                         Print(<span class="stringliteral">"    pcoi         = 0x%08lx\n"</span>, xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>);
04091                         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ci, xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o1">pcoi</a>);
04092                         Print(<span class="stringliteral">"      hConv      = 0x%08lx\n"</span>, ci.<a class="code" href="../../d2/d1/structtagCONV__INFO.html#o3">hConv</a>);
04093                         Print(<span class="stringliteral">"    hUser        = 0x%08lx\n"</span>, xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o2">hUser</a>);
04094                         Print(<span class="stringliteral">"    hXact        = 0x%08lx\n"</span>, xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o3">hXact</a>);
04095                         Print(<span class="stringliteral">"    pfnResponse  = 0x%08lx\n"</span>, xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o4">pfnResponse</a>);
04096                         Print(<span class="stringliteral">"    gaItem       = 0x%04x\n"</span>,  xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o5">gaItem</a>);
04097                         Print(<span class="stringliteral">"    wFmt         = 0x%04x\n"</span>,  xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o6">wFmt</a>);
04098                         Print(<span class="stringliteral">"    wType;       = 0x%04x\n"</span>,  xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o7">wType</a>);
04099                         Print(<span class="stringliteral">"    wStatus;     = 0x%04x\n"</span>,  xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o8">wStatus</a>);
04100                         Print(<span class="stringliteral">"    flags;       = %s\n"</span>,
04101                                 <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_XI, xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o9">flags</a>, NULL, TRUE));
04102                         Print(<span class="stringliteral">"    state;       = 0x%04x\n"</span>,  xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o10">state</a>);
04103                         Print(<span class="stringliteral">"    hDDESent     = 0x%08lx\n"</span>, xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o11">hDDESent</a>);
04104                         Print(<span class="stringliteral">"    hDDEResult   = 0x%08lx\n"</span>, xi.<a class="code" href="../../d0/d0/structtagXACT__INFO.html#o12">hDDEResult</a>);
04105                     }
04106                     <span class="keywordflow">break</span>;
04107 
04108                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d4/ddemlcli_8h.html#a39">HTYPE_DATA_HANDLE</a>:
04109                     Print(<span class="stringliteral">"Data Handle\n"</span>);
04110                     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
04111                         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dd, (PVOID)he.<a class="code" href="../../d8/d9/structtagCHANDLEENTRY.html#o1">dwData</a>);
04112                         Print(<span class="stringliteral">"    hDDE     = 0x%08lx\n"</span>, dd.<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o0">hDDE</a>);
04113                         Print(<span class="stringliteral">"    flags    = %s\n"</span>,
04114                                 <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_HDATA, (WORD)dd.<a class="code" href="../../d8/d2/structtagDDEMLDATA.html#o1">flags</a>, NULL, TRUE));
04115                     }
04116                     <span class="keywordflow">break</span>;
04117                 }
04118             }
04119         }
04120         <span class="keywordflow">if</span> (pcii != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04121             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cii, pcii);
04122         }
04123     }
04124     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04125 }
04126 <span class="preprocessor">#endif // !KERNEL</span>
04127 <span class="preprocessor"></span>
04128 
04129 <span class="preprocessor">#ifdef KERNEL</span>
04130 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
04131 <span class="comment">* ddesk           - dumps list of desktops</span>
04132 <span class="comment">* ddesk address   - dumps simple statistics for desktop</span>
04133 <span class="comment">* ddesk v address - dumps verbose statistics for desktop</span>
04134 <span class="comment">* ddesk h address - dumps statistics for desktop plus handle list</span>
04135 <span class="comment">*</span>
04136 <span class="comment">* Dump handle table statistics.</span>
04137 <span class="comment">*</span>
04138 <span class="comment">* 02-21-92 ScottLu      Created.</span>
04139 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
04140 <span class="comment">\***************************************************************************/</span>
04141 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Iddesk(
04142 DWORD opts,
04143 PVOID param1)
04144 {
<a name="l04145"></a><a class="code" href="../../d2/d1/userexts_8c.html#a189">04145</a> 
04146     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">PWINDOWSTATION</a> pwinsta = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04147     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">WINDOWSTATION</a> winsta;
04148     <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdesk;
04149     <a class="code" href="../../d0/d3/structtagDESKTOP.html">DESKTOP</a> desk;
04150     <a class="code" href="../../d6/d9/structtagWND.html">WND</a> wnd;
04151     <a class="code" href="../../d1/d1/structtagMENU.html">MENU</a> menu;
04152     <a class="code" href="../../d3/d7/struct__CALLPROCDATA.html">CALLPROCDATA</a> cpd;
04153     <a class="code" href="../../d5/d6/structtagHOOK.html">HOOK</a> hook;
04154     <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">DESKTOPINFO</a> <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>;
04155     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cClasses = 0;
04156     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> acHandles[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>];
04157     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> abTrack[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>];
04158     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he;
04159     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">PHE</a> phe;
04160     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
04161     WCHAR ach[80];
04162     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">OBJECT_HEADER</a> Head;
04163     <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">OBJECT_HEADER_NAME_INFO</a> NameInfo;
04164     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fMatch;
04165 
04166     <span class="comment">/*</span>
04167 <span class="comment">     * If there is no address, list all desktops on all terminals.</span>
04168 <span class="comment">     */</span>
04169     <span class="keywordflow">if</span> (!param1) {
04170 
04171         FOREACHWINDOWSTATION(pwinsta)
04172 
04173             DEBUGPRINT(<span class="stringliteral">"WINSTA @ %x\n"</span>, pwinsta);
04174             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(winsta, pwinsta);
04175             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Head, <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(pwinsta));
04176             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(NameInfo, ((PCHAR)(<a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(pwinsta)) - Head.<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o4">NameInfoOffset</a>));
04177             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ach, NameInfo.<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Buffer);
04178             ach[NameInfo.<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length / <span class="keyword">sizeof</span>(WCHAR)] = 0;
04179             Print(<span class="stringliteral">"Windowstation: %ws\n"</span>, ach);
04180             Print(<span class="stringliteral">"Other desktops:\n"</span>);
04181             pdesk = winsta.<a class="code" href="../../d4/d9/structtagWINDOWSTATION.html#o1">rpdeskList</a>;
04182 
04183             SAFEWHILE (pdesk) {
04184                 Print(<span class="stringliteral">"Desktop at %x\n"</span>, pdesk);
04185                 Iddesk(opts &amp; OFLAG(v) | OFLAG(h), pdesk);
04186                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(desk, pdesk);
04187                 pdesk = desk.<a class="code" href="../../d0/d3/structtagDESKTOP.html#o2">rpdeskNext</a>;
04188             }
04189 
04190             Print(<span class="stringliteral">"\n"</span>);
04191 
04192         NEXTEACHWINDOWSTATION(pwinsta)
04193 
04194         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04195     }
04196 
04197     pdesk = (<a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>)param1;
04198     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(desk, pdesk);
04199 
04200     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Head, <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(pdesk));
04201     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(NameInfo, ((PCHAR)(<a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(pdesk)) - Head.<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o4">NameInfoOffset</a>));
04202     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ach, NameInfo.<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Buffer);
04203     ach[NameInfo.<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length / <span class="keyword">sizeof</span>(WCHAR)] = 0;
04204     Print(<span class="stringliteral">"Name: %ws\n"</span>, ach);
04205 
04206     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Head, <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(pdesk));
<a name="l04207"></a><a class="code" href="../../d2/d1/userexts_8c.html#a190">04207</a>     Print(<span class="stringliteral">"# Opens         = %d\n"</span>, Head.<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o1">HandleCount</a>);
04208     Print(<span class="stringliteral">"Heap            = %08x\n"</span>, desk.<a class="code" href="../../d0/d3/structtagDESKTOP.html#o16">pheapDesktop</a>);
04209     Print(<span class="stringliteral">"Windowstation   = %08x\n"</span>, desk.<a class="code" href="../../d0/d3/structtagDESKTOP.html#o3">rpwinstaParent</a>);
04210     Print(<span class="stringliteral">"Message pwnd    = %08x\n"</span>, desk.<a class="code" href="../../d0/d3/structtagDESKTOP.html#o13">spwndMessage</a>);
04211     Print(<span class="stringliteral">"Menu pwnd       = %08x\n"</span>, desk.<a class="code" href="../../d0/d3/structtagDESKTOP.html#o6">spwndMenu</a>);
04212     Print(<span class="stringliteral">"System pmenu    = %08x\n"</span>, desk.<a class="code" href="../../d0/d3/structtagDESKTOP.html#o7">spmenuSys</a>);
04213     Print(<span class="stringliteral">"Console thread  = %x\n"</span>, desk.<a class="code" href="../../d0/d3/structtagDESKTOP.html#o17">dwConsoleThreadId</a>);
04214     Print(<span class="stringliteral">"PtiList.Flink   = %08x\n"</span>, desk.<a class="code" href="../../d0/d3/structtagDESKTOP.html#o20">PtiList</a>.Flink);
04215     <span class="keywordflow">if</span> (!tryMove(di, desk.<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>)) {
04216         Print(<span class="stringliteral">"Unable to get DESKTOPINFO at %x\n"</span>, desk.<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>);
04217     } <span class="keywordflow">else</span> {
04218         Print(<span class="stringliteral">"Desktop pwnd    = %08x\n"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.spwnd);
04219         Print(<span class="stringliteral">"\tfsHooks     = 0x%08lx\n"</span>
04220               <span class="stringliteral">"\taphkStart\n"</span>,
04221             <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.fsHooks);
04222 
04223         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_MSGFILTER"</span>, WH_MSGFILTER);
04224         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_JOURNALRECORD"</span>, WH_JOURNALRECORD);
04225         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_JOURNALPLAYBACK"</span>, WH_JOURNALPLAYBACK);
04226         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_KEYBOARD"</span>, WH_KEYBOARD);
04227         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_GETMESSAGE"</span>, WH_GETMESSAGE);
04228         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_CALLWNDPROC"</span>, WH_CALLWNDPROC);
04229         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_CALLWNDPROCRET"</span>, WH_CALLWNDPROCRET);
04230         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_CBT"</span>, WH_CBT);
04231         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_SYSMSGFILTER"</span>, WH_SYSMSGFILTER);
04232         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_MOUSE"</span>, WH_MOUSE);
04233         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_HARDWARE"</span>, WH_HARDWARE);
04234         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_DEBUG"</span>, WH_DEBUG);
04235         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_SHELL"</span>, WH_SHELL);
04236         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_FOREGROUNDIDLE"</span>, WH_FOREGROUNDIDLE);
04237         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_KEYBOARD_LL"</span>, WH_KEYBOARD_LL);
04238         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_MOUSE_LL"</span>, WH_MOUSE_LL);
04239     }
04240 
04241     <span class="comment">/*</span>
04242 <span class="comment">     * Find all objects allocated from the desktop.</span>
04243 <span class="comment">     */</span>
<a name="l04244"></a><a class="code" href="../../d2/d1/userexts_8c.html#a188">04244</a>     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>; i++) {
04245         abTrack[i] = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04246         acHandles[i] = 0;
04247     }
04248     abTrack[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a237">TYPE_WINDOW</a>] = abTrack[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a238">TYPE_MENU</a>] =
04249             abTrack[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a243">TYPE_CALLPROC</a>] =
04250             abTrack[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a241">TYPE_HOOK</a>] = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04251 
04252     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
04253         Print(<span class="stringliteral">"Handle          Type\n"</span>);
04254         Print(<span class="stringliteral">"--------------------\n"</span>);
04255     }
04256 
04257     <a class="code" href="../../d2/d1/userexts_8c.html#a8">FOREACHHANDLEENTRY</a>(phe, he, i)
04258         fMatch = FALSE;
04259         try {
04260             <span class="keywordflow">switch</span> (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>) {
04261                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a237">TYPE_WINDOW</a>:
04262                     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wnd, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>));
04263                     <span class="keywordflow">if</span> (wnd.<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.rpdesk == pdesk)
04264                         fMatch = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04265                     <span class="keywordflow">break</span>;
04266                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a238">TYPE_MENU</a>:
04267                     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(menu, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>));
04268                     <span class="keywordflow">if</span> (menu.<a class="code" href="../../d1/d1/structtagMENU.html#o0">head</a>.rpdesk == pdesk)
04269                         fMatch = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04270                     <span class="keywordflow">break</span>;
04271                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a243">TYPE_CALLPROC</a>:
04272                     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cpd, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>));
04273                     <span class="keywordflow">if</span> (cpd.<a class="code" href="../../d3/d7/struct__CALLPROCDATA.html#o0">head</a>.rpdesk == pdesk)
04274                         fMatch = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04275                     <span class="keywordflow">break</span>;
04276                 <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a241">TYPE_HOOK</a>:
04277                     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(hook, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>));
04278                     <span class="keywordflow">if</span> (hook.<a class="code" href="../../d5/d6/structtagHOOK.html#o0">head</a>.rpdesk == pdesk)
<a name="l04279"></a><a class="code" href="../../d2/d1/userexts_8c.html#a208">04279</a>                         fMatch = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04280                     <span class="keywordflow">break</span>;
04281                 <span class="keywordflow">default</span>:
04282                     <span class="keywordflow">break</span>;
04283             }
04284         } except (EXCEPTION_EXECUTE_HANDLER) {
04285             ;
04286         }
04287 
04288         <span class="keywordflow">if</span> (!fMatch)
04289             <span class="keywordflow">continue</span>;
04290 
04291         acHandles[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>]++;
04292 
04293         <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
04294             Print(<span class="stringliteral">"0x%08lx %c    %s\n"</span>,
04295                     i,
04296                     (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o3">bFlags</a> &amp; HANDLEF_DESTROY) ? <span class="charliteral">'*'</span> : <span class="charliteral">' '</span>,
04297                     aszTypeNames[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>]);
<a name="l04298"></a><a class="code" href="../../d2/d1/userexts_8c.html#a209">04298</a>         }
04299     <a class="code" href="../../d2/d1/userexts_8c.html#a9">NEXTEACHHANDLEENTRY</a>()
04300 
04301     if (!(opts &amp; OFLAG(v))) {
04302         Print(<span class="stringliteral">"Count           Type\n"</span>);
04303         Print(<span class="stringliteral">"--------------------\n"</span>);
04304         Print(<span class="stringliteral">"0x%08lx      Class\n"</span>, cClasses);
04305         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>; i++) {
04306             <span class="keywordflow">if</span> (abTrack[i])
04307                 Print(<span class="stringliteral">"0x%08lx      %s\n"</span>, acHandles[i], <a class="code" href="../../d2/d1/userexts_8c.html#a75">aszTypeNames</a>[i]);
04308         }
04309     }
04310 
04311     Print(<span class="stringliteral">"\n"</span>);
04312     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04313 }
04314 <span class="preprocessor">#endif // KERNEL</span>
04315 <span class="preprocessor"></span>
04316 
04317 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a214">IsNumChar</a>(<span class="keywordtype">int</span> c, <span class="keywordtype">int</span> base)
04318 {
04319     <span class="keywordflow">return</span> (<span class="charliteral">'0'</span> &lt;= <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &amp;&amp; <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &lt;= <span class="charliteral">'9'</span>) ||
04320            (base == 16 &amp;&amp; ((<span class="charliteral">'a'</span> &lt;= <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &amp;&amp; <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &lt;= <span class="charliteral">'f'</span>) || (<span class="charliteral">'A'</span> &lt;= <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &amp;&amp; <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> &lt;= <span class="charliteral">'F'</span>)));
04321 }
04322 
04323 
04324 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
04325 <a class="code" href="../../d2/d1/userexts_8c.html#a215">GetInteger</a>(LPSTR psz, <span class="keywordtype">int</span> base, <span class="keywordtype">int</span> * pi, LPSTR * ppsz)
04326 {
04327     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status = STATUS_INVALID_PARAMETER;
04328 
04329     <span class="keywordflow">for</span> (;;) {
04330         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a214">IsNumChar</a>(*psz, base)) {
04331             status = <a class="code" href="../../d9/d3/cnvint_8c.html#a3">RtlCharToInteger</a>(psz, base, pi);
04332             <span class="keywordflow">if</span> (ppsz &amp;&amp; <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
04333                 <span class="keywordflow">while</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a214">IsNumChar</a>(*psz++, base))
04334                     ;
04335 
04336                 *ppsz = psz;
04337             }
04338 
04339             <span class="keywordflow">break</span>;
04340         }
04341 
04342         <span class="keywordflow">if</span> (*psz != <span class="charliteral">' '</span> &amp;&amp; *psz != <span class="charliteral">'\t'</span>) {
04343             <span class="keywordflow">break</span>;
<a name="l04344"></a><a class="code" href="../../d1/d2/structVKeyDef.html">04344</a>         }
<a name="l04345"></a><a class="code" href="../../d1/d2/structVKeyDef.html#o0">04345</a> 
<a name="l04346"></a><a class="code" href="../../d1/d2/structVKeyDef.html#o1">04346</a>         psz++;
04347     }
04348 
<a name="l04349"></a><a class="code" href="../../d2/d1/userexts_8c.html#a210">04349</a>     <span class="keywordflow">return</span> status;
04350 }
04351 
04352 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a216">Idf</a>(DWORD opts, LPSTR pszName)
04353 {
<a name="l04354"></a><a class="code" href="../../d2/d1/userexts_8c.html#a48">04354</a>     <span class="keyword">static</span> <span class="keywordtype">char</span> *szLevels[8] = {
04355         <span class="stringliteral">"&lt;none&gt;"</span>,
<a name="l04356"></a><a class="code" href="../../d2/d1/userexts_8c.html#a133">04356</a>         <span class="stringliteral">"Errors"</span>,
04357         <span class="stringliteral">"Warnings"</span>,
04358         <span class="stringliteral">"Errors and Warnings"</span>,
04359         <span class="stringliteral">"Verbose"</span>,
<a name="l04360"></a><a class="code" href="../../d2/d1/userexts_8c.html#a211">04360</a>         <span class="stringliteral">"Errors and Verbose"</span>,
04361         <span class="stringliteral">"Warnings and Verbose"</span>,
04362         <span class="stringliteral">"Errors, Warnings, and Verbose"</span>
04363     };
04364 
04365     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    status;
04366     ULONG       ulFlags;
04367     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">PSERVERINFO</a> psi;
04368     WORD        wRipFlags;
04369     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       wPID;
04370 
04371 
04372     <span class="keywordflow">if</span> (opts &amp; OFLAG(x)) {
04373         <span class="comment">/*</span>
04374 <span class="comment">         * !df -x foo</span>
04375 <span class="comment">         * This is an undocumented way to start a remote CMD session named</span>
04376 <span class="comment">         * "foo" on the machine that the debugger is running on.</span>
04377 <span class="comment">         * Sometimes useful to assist in debugging.</span>
04378 <span class="comment">         * Sometimes useful when trying to do dev work from home: if you don't</span>
04379 <span class="comment">         * already have a remote cmd.exe session to connect to, you probably</span>
04380 <span class="comment">         * have a remote debug session.  You can use this debug extension to</span>
04381 <span class="comment">         * start a remote cmd session.</span>
04382 <span class="comment">         */</span>
04383         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bRet;
04384         <span class="keywordtype">char</span> ach[80];
04385         PROCESS_INFORMATION ProcessInfo;
04386         STARTUPINFOA StartupInfoA;
04387 
04388         <span class="keywordflow">if</span> (pszName[0] == <span class="charliteral">'\0'</span>) {
04389             Print(<span class="stringliteral">"must provide a name.  eg; \"!df -x fred\"\n"</span>);
04390             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04391         }
04392         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"remote.exe /s cmd.exe %s"</span>, pszName);
04393 
04394         <span class="comment">// GetStartupInfoA( &amp;StartupInfoA );</span>
04395 
04396         RtlZeroMemory(&amp;StartupInfoA, <span class="keyword">sizeof</span>(STARTUPINFOA));
04397         StartupInfoA.cb = <span class="keyword">sizeof</span>(STARTUPINFOA);
04398         StartupInfoA.lpTitle = pszName;
04399         StartupInfoA.dwFlags = STARTF_USESHOWWINDOW;
04400         StartupInfoA.wShowWindow = SW_SHOWMINIMIZED; <span class="comment">// SW_HIDE is *too* sneaky</span>
<a name="l04401"></a><a class="code" href="../../d2/d1/userexts_8c.html#a212">04401</a> <span class="preprocessor">#if 0</span>
04402 <span class="preprocessor"></span>        Print(<span class="stringliteral">"StartupInfoA:\n"</span>);
04403         Print(<span class="stringliteral">" cb = %d\n"</span>, StartupInfoA.cb);
04404         Print(<span class="stringliteral">" lpReserved = %s\n"</span>, StartupInfoA.lpReserved);
04405         Print(<span class="stringliteral">" lpDesktop = %s\n"</span>, StartupInfoA.lpDesktop);
04406         Print(<span class="stringliteral">" lpTitle = %s\n"</span>, StartupInfoA.lpTitle);
04407         Print(<span class="stringliteral">" dwX, dwY = %d,%d\n"</span>, StartupInfoA.dwX, StartupInfoA.dwY);
04408         Print(<span class="stringliteral">" dwXSize, dwYSize = %d,%d\n"</span>, StartupInfoA.dwXSize, StartupInfoA.dwYSize);
04409         Print(<span class="stringliteral">" dwXCountChars, dwYCountChars = %d,%d\n"</span>, StartupInfoA.dwXCountChars, StartupInfoA.dwYCountChars);
04410         Print(<span class="stringliteral">" dwFillAttribute = 0x%x\n"</span>, StartupInfoA.dwFillAttribute);
04411         Print(<span class="stringliteral">" dwFlags = 0x%x\n"</span>, StartupInfoA.dwFlags);
04412         Print(<span class="stringliteral">" wShowWindow = 0x%x\n"</span>, StartupInfoA.wShowWindow);
04413         Print(<span class="stringliteral">" hStdInput = 0x%x\n"</span>, StartupInfoA.hStdInput);
04414         Print(<span class="stringliteral">" hStdOutput = 0x%x\n"</span>, StartupInfoA.hStdOutput);
04415         Print(<span class="stringliteral">" hStdError = 0x%x\n"</span>, StartupInfoA.hStdError);
04416 <span class="preprocessor">#endif</span>
04417 <span class="preprocessor"></span>        bRet = CreateProcessA(
04418                 NULL,            <span class="comment">// get executable name from command line</span>
04419                 ach,             <span class="comment">// CommandLine</span>
04420                 NULL,            <span class="comment">// Process Attr's</span>
04421                 NULL,            <span class="comment">// Thread Attr's</span>
04422                 FALSE,           <span class="comment">// Inherit Handle</span>
04423                 CREATE_NEW_CONSOLE, <span class="comment">// Creation Flags</span>
04424                 NULL,            <span class="comment">// Environ</span>
04425                 NULL,            <span class="comment">// Cur Dir</span>
04426                 &amp;StartupInfoA,   <span class="comment">// StartupInfo</span>
04427                 &amp;ProcessInfo );  <span class="comment">// ProcessInfo</span>
04428 
04429         <span class="keywordflow">if</span> (bRet) {
04430             Print(<span class="stringliteral">"Successfully created a minimized remote cmd process\n"</span>);
04431             Print(<span class="stringliteral">"use \"remote /c &lt;machine&gt; %s\" to connect\n"</span>, pszName);
04432             Print(<span class="stringliteral">"use \"exit\" to kill the remote cmd process\n"</span>);
04433         }
04434 <span class="preprocessor">#if 0</span>
04435 <span class="preprocessor"></span>        Print(<span class="stringliteral">"CreateProcessA returns %x\n"</span>, bRet);
04436         Print(<span class="stringliteral">"Process handle %x\n"</span>
04437               <span class="stringliteral">"        hThread %x\n"</span>
04438               <span class="stringliteral">"        dwProcessId %x\n"</span>
04439               <span class="stringliteral">"        dwThreadId %x\n"</span>,
04440               ProcessInfo.hProcess,
04441               ProcessInfo.hThread,
04442               ProcessInfo.dwProcessId,
04443               ProcessInfo.dwThreadId);
04444 <span class="preprocessor">#endif</span>
04445 <span class="preprocessor"></span>        <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(ProcessInfo.hProcess);
04446         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(ProcessInfo.hThread);
04447         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04448     }
04449 
04450     moveExpValuePtr(&amp;psi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
04451 
04452     <span class="keywordflow">if</span> (opts &amp; OFLAG(p)) {
04453 
04454         status = <a class="code" href="../../d2/d1/userexts_8c.html#a215">GetInteger</a>(pszName, 16, &amp;wPID, NULL);
04455 
04456 <span class="preprocessor">#ifdef KERNEL</span>
04457 <span class="preprocessor"></span>
04458         (lpExtensionApis-&gt;lpWriteProcessMemoryRoutine)(
04459                 (ULONG_PTR) (&amp;psi-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o2">wRIPPID</a>),
04460                 (<span class="keywordtype">void</span> *) &amp;wPID,
04461                 <span class="keyword">sizeof</span>(wPID),
04462                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
04463 <span class="preprocessor">#else</span>
04464 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/userexts_8c.html#a201">IsRemoteSession</a>()) {
04465             <a class="code" href="../../d2/d1/userexts_8c.html#a187">PrivateSetRipFlags</a>(-1, (DWORD)wPID);
04466         } <span class="keywordflow">else</span> {
04467             Print(<span class="stringliteral">"!df -p doesn't work on HYDRA systems\n"</span>);
04468         }
04469 <span class="preprocessor">#endif</span>
04470 <span class="preprocessor"></span>
04471         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wPID, &amp;psi-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o2">wRIPPID</a>);
04472         Print(<span class="stringliteral">"Set Rip process to %ld (0x%lX)\n"</span>, (DWORD)wPID, (DWORD)wPID);
04473 
04474         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04475     }
04476 
04477 
04478 
04479     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wRipFlags, &amp;psi-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o0">wRIPFlags</a>);
04480     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wPID, &amp;psi-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o2">wRIPPID</a>);
04481 
04482     status = <a class="code" href="../../d2/d1/userexts_8c.html#a215">GetInteger</a>(pszName, 16, &amp;ulFlags, NULL);
04483 
04484 
04485     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status) &amp;&amp; !(ulFlags &amp; ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a398">RIPF_VALIDUSERFLAGS</a>)) {
04486 <span class="preprocessor">#ifdef KERNEL</span>
04487 <span class="preprocessor"></span>        wRipFlags = (WORD)((wRipFlags &amp; ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a398">RIPF_VALIDUSERFLAGS</a>) | ulFlags);
04488 
04489 
04490         (lpExtensionApis-&gt;lpWriteProcessMemoryRoutine)(
04491                 (ULONG_PTR) (&amp;psi-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o0">wRIPFlags</a>),
04492                 (<span class="keywordtype">void</span> *) &amp;wRipFlags,
04493                 <span class="keyword">sizeof</span>(wRipFlags),
04494                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
04495 <span class="preprocessor">#else</span>
04496 <span class="preprocessor"></span>        <a class="code" href="../../d2/d1/userexts_8c.html#a187">PrivateSetRipFlags</a>(ulFlags, -1);
04497 <span class="preprocessor">#endif</span>
04498 <span class="preprocessor"></span>
04499         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wRipFlags, &amp;psi-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o0">wRIPFlags</a>);
04500     }
04501 
04502     Print(<span class="stringliteral">"Flags = %.3x\n"</span>, wRipFlags &amp; RIPF_VALIDUSERFLAGS);
04503     Print(<span class="stringliteral">"  Print Process/Component %sabled\n"</span>, (wRipFlags &amp; RIPF_HIDEPID) ? <span class="stringliteral">"dis"</span> : <span class="stringliteral">"en"</span>);
04504     Print(<span class="stringliteral">"  Print File/Line %sabled\n"</span>, (wRipFlags &amp; RIPF_PRINTFILELINE) ? <span class="stringliteral">"en"</span> : <span class="stringliteral">"dis"</span>);
04505     Print(<span class="stringliteral">"  Print on %s\n"</span>,  szLevels[(wRipFlags &amp; RIPF_PRINT_MASK)  &gt;&gt; RIPF_PRINT_SHIFT]);
04506     Print(<span class="stringliteral">"  Prompt on %s\n"</span>, szLevels[(wRipFlags &amp; RIPF_PROMPT_MASK) &gt;&gt; RIPF_PROMPT_SHIFT]);
04507 
04508     <span class="keywordflow">if</span> (wPID == 0)
04509         Print(<span class="stringliteral">"  All process RIPs are shown\n"</span>);
04510     <span class="keywordflow">else</span>
04511         Print(<span class="stringliteral">"  RIPs shown for process %ld (0x%lX)\n"</span>, (DWORD)wPID, (DWORD)wPID);
04512 
04513     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04514 }
04515 
04516 
04517 <span class="preprocessor">#if DEBUGTAGS || DBG</span>
04518 <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Itag(DWORD opts, LPSTR pszName)
04519 {
04520     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>    status;
04521     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">PSERVERINFO</a> psi;
04522     <span class="keywordtype">int</span>         tag = -1;
04523     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       dwDBGTAGFlagsNew;
04524     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       dwDBGTAGFlags;
04525     <span class="keywordtype">int</span>         i;
04526     <span class="keywordtype">int</span>         iStart, iEnd;
04527     <span class="keywordtype">char</span>        szT[100];
04528     DBGTAG *    pdbgtag;
04529     DBGTAG      dbgtag;
04530 
04531     UNREFERENCED_PARAMETER(opts);
04532 
04533     <span class="comment">/*</span>
04534 <span class="comment">     * Get the tag index.</span>
04535 <span class="comment">     */</span>
04536     moveExpValuePtr(&amp;psi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
04537     status = <a class="code" href="../../d2/d1/userexts_8c.html#a215">GetInteger</a>(pszName, 10, &amp;tag, &amp;pszName);
04538 
04539     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status) || tag &lt; 0 || DBGTAG_Max &lt;= tag) {
04540         tag = -1;
04541     } <span class="keywordflow">else</span> {
04542         <span class="comment">/*</span>
04543 <span class="comment">         * Get the flag value.</span>
04544 <span class="comment">         */</span>
04545         status = <a class="code" href="../../d2/d1/userexts_8c.html#a215">GetInteger</a>(pszName, 16, &amp;dwDBGTAGFlagsNew, NULL);
04546         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status) &amp;&amp; !(dwDBGTAGFlagsNew &amp; ~DBGTAG_VALIDUSERFLAGS)) {
04547 
04548             <span class="comment">/*</span>
04549 <span class="comment">             * Set the flag value.</span>
04550 <span class="comment">             */</span>
04551 <span class="preprocessor">#ifdef KERNEL</span>
04552 <span class="preprocessor"></span>            <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dwDBGTAGFlags, &amp;psi-&gt;adwDBGTAGFlags[tag]);
04553             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a14">COPY_FLAG</a>(dwDBGTAGFlags, dwDBGTAGFlagsNew, DBGTAG_VALIDUSERFLAGS);
04554             (lpExtensionApis-&gt;lpWriteProcessMemoryRoutine)(
04555                     (DWORD_PTR) (&amp;psi-&gt;adwDBGTAGFlags[tag]),
04556                     (<span class="keywordtype">void</span> *) &amp;dwDBGTAGFlags,
04557                     <span class="keyword">sizeof</span>(dwDBGTAGFlags),
04558                     <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
04559 <span class="preprocessor">#else</span>
04560 <span class="preprocessor"></span>            <span class="keyword">extern</span> <span class="keywordtype">void</span> PrivateSetDbgTag(<span class="keywordtype">int</span> tag, DWORD dwDBGTAGFlags);
04561 
04562             <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/userexts_8c.html#a201">IsRemoteSession</a>()) {
04563                 PrivateSetDbgTag(tag, dwDBGTAGFlagsNew);
04564             } <span class="keywordflow">else</span> {
04565                 Print(<span class="stringliteral">"!tag doesn't work on HYDRA systems\n"</span>);
04566             }
04567 <span class="preprocessor">#endif</span>
04568 <span class="preprocessor"></span>
04569         }
04570     }
04571 
04572     <span class="comment">/*</span>
04573 <span class="comment">     * Print the header.</span>
04574 <span class="comment">     */</span>
04575     Print(  <span class="stringliteral">"%-5s%-7s%-*s%-*s\n"</span>,
04576             <span class="stringliteral">"Tag"</span>,
04577             <span class="stringliteral">"Flags"</span>,
04578             DBGTAG_NAMELENGTH,
04579             <span class="stringliteral">"Name"</span>,
04580             DBGTAG_DESCRIPTIONLENGTH,
04581             <span class="stringliteral">"Description"</span>);
04582 
04583     <span class="keywordflow">for</span> (i = 0; i &lt; 12 + DBGTAG_NAMELENGTH + DBGTAG_DESCRIPTIONLENGTH; i++) {
04584         szT[i] = <span class="charliteral">'-'</span>;
04585     }
04586     szT[i++] = <span class="charliteral">'\n'</span>;
04587     szT[i] = 0;
04588     Print(szT);
04589 
04590     <span class="keywordflow">if</span> (tag != -1) {
04591         iStart = iEnd = tag;
04592     } <span class="keywordflow">else</span> {
04593         iStart = 0;
04594         iEnd = DBGTAG_Max - 1;
04595     }
04596 
04597     <span class="keywordflow">for</span> (i = iStart; i &lt;= iEnd; i++) {
04598         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dwDBGTAGFlags, &amp;(psi-&gt;adwDBGTAGFlags[i]));
04599 
04600         pdbgtag = EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gadbgtag));
04601         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dbgtag, &amp;pdbgtag[i]);
04602 
04603         Print(  <span class="stringliteral">"%-5d%-7d%-*s%-*s\n"</span>,
04604                 i,
04605                 dwDBGTAGFlags &amp; DBGTAG_VALIDUSERFLAGS,
04606                 DBGTAG_NAMELENGTH,
04607                 dbgtag.achName,
04608                 DBGTAG_DESCRIPTIONLENGTH,
04609                 dbgtag.achDescription);
04610     }
04611 
04612     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04613 }
04614 
04615 <span class="preprocessor">#endif // if DEBUGTAGS</span>
04616 <span class="preprocessor"></span>
04617 <span class="comment">/************************************************************************\</span>
04618 <span class="comment">* Procedure: Idhe</span>
04619 <span class="comment">*</span>
04620 <span class="comment">* Description: Dump Handle Entry</span>
04621 <span class="comment">*</span>
04622 <span class="comment">* Returns: fSuccess</span>
04623 <span class="comment">*</span>
04624 <span class="comment">* 6/9/1995 Created SanfordS</span>
04625 <span class="comment">*</span>
04626 <span class="comment">\************************************************************************/</span>
04627 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a217">Idhe</a>(
04628     DWORD opts,
04629     PVOID param1,
04630     PVOID param2)
04631 {
04632                             <span class="comment">/* 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 */</span>
04633     <span class="keyword">static</span> <span class="keywordtype">char</span> szHeader [] = <span class="stringliteral">"Phe         Handle      phead       pOwner      cLockObj   Type           Flags\n"</span>;
04634     <span class="keyword">static</span> <span class="keywordtype">char</span> szFormat [] = <span class="stringliteral">"%#010lx  %#010lx  %#010lx  %#010lx  %#010lx %-15s %#4lx\n"</span>;
04635     <a class="code" href="../../d1/d1/struct__THROBJHEAD.html">THROBJHEAD</a> head;
04636     DWORD_PTR dw;
04637     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">PHE</a> pheT;
04638     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he, *phe;
04639     <span class="keywordtype">int</span> i;
04640     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uHandleCount = 0;
04641 <span class="preprocessor">#ifdef KERNEL</span>
04642 <span class="preprocessor"></span>    <a class="code" href="../../d1/d6/structtagHANDLETYPEINFO.html">PHANDLETYPEINFO</a> pahti = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04643     <a class="code" href="../../d1/d6/structtagHANDLETYPEINFO.html">HANDLETYPEINFO</a> ahti[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>];
04644     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a> ppi;
04645 <span class="preprocessor">#endif // KERNEL</span>
04646 <span class="preprocessor"></span>
04647     <span class="comment">/*</span>
04648 <span class="comment">     * If only the owner was provided, copy it to param2 so it's always in the same place</span>
04649 <span class="comment">     */</span>
04650     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(t)) &amp;&amp; (opts &amp; OFLAG(o))) {
04651         param2 = param1;
04652     }
04653     <span class="comment">/*</span>
04654 <span class="comment">     * If not a recursive call, print what we're dumping</span>
04655 <span class="comment">     */</span>
04656     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(r)) &amp;&amp; (opts &amp; (OFLAG(t) | OFLAG(o) | OFLAG(p)))) {
04657         Print(<span class="stringliteral">"Dumping handles "</span>);
04658         <span class="keywordflow">if</span> (opts &amp; OFLAG(t)) {
04659             <span class="keywordflow">if</span> ((UINT_PTR)param1 &gt;= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>) {
04660                 Print(<span class="stringliteral">"Invalid Type: %#lx\n"</span>, param1);
04661                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04662             }
04663             Print(<span class="stringliteral">"of type %d (%s)"</span>, param1, aszTypeNames[(UINT_PTR)param1]);
04664         }
04665         <span class="keywordflow">if</span> (opts &amp; OFLAG(o)) {
04666             Print(<span class="stringliteral">" owned by %#lx"</span>, param2);
04667         }
04668         <span class="keywordflow">if</span> (opts &amp; OFLAG(p)) {
04669             Print(<span class="stringliteral">" or any thread on this process"</span>);
04670         }
04671         Print(<span class="stringliteral">"\n"</span>);
04672     }
04673 
04674 <span class="preprocessor">#ifdef KERNEL</span>
04675 <span class="preprocessor"></span>    <span class="comment">/*</span>
04676 <span class="comment">     * If dumping handles for any thread in the process, we need the type flags</span>
04677 <span class="comment">     */</span>
04678     <span class="keywordflow">if</span> (opts &amp; OFLAG(p)) {
04679         pahti = EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gahti));
04680         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ahti, pahti);
04681     }
04682 
04683 
04684 <span class="preprocessor">#endif // KERNEL</span>
04685 <span class="preprocessor"></span>    <span class="comment">/*</span>
04686 <span class="comment">     * If a handle/phe was provided, just dump it.</span>
04687 <span class="comment">     */</span>
04688     <span class="keywordflow">if</span> (!(opts &amp; ~OFLAG(r)) &amp;&amp; (param1 != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
04689         dw = (DWORD_PTR)<a class="code" href="../../d2/d1/userexts_8c.html#a197">HorPtoP</a>(param1, -2);
04690         <span class="keywordflow">if</span> (dw == 0) {
04691             Print(<span class="stringliteral">"0x%p is not a valid object or handle.\n"</span>, param1);
04692             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04693         }
04694     } <span class="keywordflow">else</span> {
04695         <span class="comment">/*</span>
04696 <span class="comment">         * Walk the handle table</span>
04697 <span class="comment">         */</span>
04698         Print(szHeader);
04699         <a class="code" href="../../d2/d1/userexts_8c.html#a8">FOREACHHANDLEENTRY</a>(phe, he, i)
04700             <span class="comment">/* Skip free handles */</span>
04701             if (he.bType == TYPE_FREE) {
04702                 <span class="keywordflow">continue</span>;
04703             }
04704             <span class="comment">/* Type check */</span>
04705             <span class="keywordflow">if</span> ((opts &amp; OFLAG(t)) &amp;&amp; (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a> != (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)param1)) {
04706                 <span class="keywordflow">continue</span>;
04707             }
04708             <span class="comment">/* thread check */</span>
04709             <span class="keywordflow">if</span> ((opts &amp; OFLAG(o)) &amp;&amp; (<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a>) != param2)) {
04710                 <span class="comment">/* check for thread owned objects owned by the requested process */</span>
04711                 <span class="keywordflow">if</span> (opts &amp; OFLAG(p)) {
04712 <span class="preprocessor">                    #ifndef KERNEL</span>
04713 <span class="preprocessor"></span>                        <span class="keywordflow">continue</span>;
04714 <span class="preprocessor">                    #else</span>
04715 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (ahti[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>].<a class="code" href="../../d1/d6/structtagHANDLETYPEINFO.html#o2">bObjectCreateFlags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a414">OCF_PROCESSOWNED</a>) {
04716                             <span class="keywordflow">continue</span>;
04717                         }
04718                         <span class="keywordflow">if</span> (!(ahti[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>].<a class="code" href="../../d1/d6/structtagHANDLETYPEINFO.html#o2">bObjectCreateFlags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a413">OCF_THREADOWNED</a>)) {
04719                             <span class="keywordflow">continue</span>;
04720                         }
04721                         tryMove(ppi, &amp;((<a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>)he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a>)-&gt;ppi);
04722                         <span class="keywordflow">if</span> (ppi != param2) {
04723                             <span class="keywordflow">continue</span>;
04724                         }
04725 <span class="preprocessor">                    #endif</span>
04726 <span class="preprocessor"></span>                } <span class="keywordflow">else</span> {
04727                     <span class="keywordflow">continue</span>;
04728                 }
04729             }
04730 
04731             <a class="code" href="../../d2/d1/userexts_8c.html#a217">Idhe</a>(OFLAG(r), he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>, NULL);
04732             uHandleCount++;
04733         <a class="code" href="../../d2/d1/userexts_8c.html#a9">NEXTEACHHANDLEENTRY</a>()
04734         Print("%d handle(s)\n", uHandleCount);
04735         return TRUE;
04736     }
04737 
04738     if (!getHEfromP(&amp;pheT, &amp;he, (PVOID)dw)) {
04739         Print(<span class="stringliteral">"%x is not a USER handle manager object.\n"</span>, param1);
04740         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04741     }
04742 
04743 <span class="preprocessor">#ifdef KERNEL</span>
04744 <span class="preprocessor"></span>    <span class="comment">/*</span>
04745 <span class="comment">     * If printing only one entry, print info about the owner</span>
04746 <span class="comment">     */</span>
04747     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(r))) {
04748         <span class="keywordflow">if</span> (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04749             <span class="keywordflow">if</span> (!(opts &amp; OFLAG(p))) {
04750                 pahti = EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gahti));
04751                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ahti, pahti);
04752             }
04753             <span class="keywordflow">if</span> ((ahti[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>].<a class="code" href="../../d1/d6/structtagHANDLETYPEINFO.html#o2">bObjectCreateFlags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a414">OCF_PROCESSOWNED</a>)) {
04754                 Idp(OFLAG(p), (PVOID)he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a>);
04755             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ahti[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>].<a class="code" href="../../d1/d6/structtagHANDLETYPEINFO.html#o2">bObjectCreateFlags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a413">OCF_THREADOWNED</a>)) {
04756                 Idt(OFLAG(p), (PVOID)he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a>);
04757             }
04758         }
04759     }
04760 <span class="preprocessor">#endif // KERNEL</span>
04761 <span class="preprocessor"></span>
04762     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(head, (PVOID)dw);
04763 
04764     <span class="comment">/*</span>
04765 <span class="comment">     * If only dumping one, use !dso like format. Otherwise, print a table.</span>
04766 <span class="comment">     */</span>
04767     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(r))) {
04768         <a class="code" href="../../d2/d1/userexts_8c.html#a21">PRTVDW2</a>(phe, pheT, cLockObj, head.cLockObj);
04769         <a class="code" href="../../d2/d1/userexts_8c.html#a21">PRTVDW2</a>(wUniq, he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o4">wUniq</a>, handle, head.h);
04770         <a class="code" href="../../d2/d1/userexts_8c.html#a21">PRTVDW2</a>(phead, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>), pOwner, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a>));
04771         Print(DWSTR1 <span class="stringliteral">" - %s\n"</span>, he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>, <span class="stringliteral">"bType"</span>, aszTypeNames[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>]);
04772         Print(DWSTR1 <span class="stringliteral">" - %s\n"</span>, he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o3">bFlags</a>,<span class="stringliteral">"bFlags"</span>,  <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_HE, he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o3">bFlags</a>, NULL, TRUE));
04773     } <span class="keywordflow">else</span> {
04774         Print(szFormat,
04775               pheT, head.h, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>), <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a>),
04776               head.cLockObj, aszTypeNames[(DWORD)he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>], (DWORD)he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o3">bFlags</a>);
04777     }
04778 
04779     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04780 }
04781 
04782 <span class="preprocessor">#ifdef KERNEL</span>
04783 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
04784 <span class="comment">* dhk - dump hooks</span>
04785 <span class="comment">*</span>
04786 <span class="comment">* dhk           - dumps local hooks on the foreground thread</span>
04787 <span class="comment">* dhk g         - dumps global hooks</span>
04788 <span class="comment">* dhk address   - dumps local hooks on THREADINFO at address</span>
04789 <span class="comment">* dhk g address - dumps global hooks and local hooks on THREADINFO at address</span>
04790 <span class="comment">* dhk *         - dumps local hooks for all threads</span>
04791 <span class="comment">* dhk g *       - dumps global hooks and local hooks for all threads</span>
04792 <span class="comment">*</span>
04793 <span class="comment">* 10/21/94 IanJa        Created.</span>
04794 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
04795 <span class="comment">\***************************************************************************/</span>
04796 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idhk(
04797 DWORD opts,
04798 PVOID param1)
04799 {
04800 
04801     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
04802     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
04803     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">THREADINFO</a> ti;
04804     <a class="code" href="../../d5/d6/structtagHOOK.html">HOOK</a> hook;
04805 
04806 <span class="preprocessor">#define DHKF_GLOBAL_HOOKS   1</span>
04807 <span class="preprocessor"></span><span class="preprocessor">#define DHKF_PTI_GIVEN      2</span>
04808 <span class="preprocessor"></span>
04809     <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> = 0;
04810 
04811     pti = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04812     <span class="keywordflow">if</span> (opts &amp; OFLAG(g)) { <span class="comment">// global hooks</span>
04813         <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |= DHKF_GLOBAL_HOOKS;
04814     }
04815 
04816 <span class="preprocessor">#ifdef LATER</span>
04817 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (opts &amp; OFLAG(a)) {
04818         moveExpValuePtr(&amp;pti, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gptiFirst));
04819         SAFEWHILE (pti != NULL) {
04820             <span class="keywordtype">char</span> ach[80];
04821 
04822             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"%lx"</span>, pti);
04823             dhk(hCurrentProcess, hCurrentThread, dwCurPc,
04824                     dwCurrentPc, ach);
04825             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pti, &amp;(pti-&gt;ptiNext));
04826         }
04827         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; DHKF_GLOBAL_HOOKS) {
04828             dhk(hCurrentProcess, hCurrentThread, dwCurPc,
04829                     dwCurrentPc, <span class="stringliteral">"g"</span>);
04830         }
04831         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04832     }
04833 <span class="preprocessor">#endif</span>
04834 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04835         <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
04836         <a class="code" href="../../d7/d4/structtagQ.html">Q</a> q;
04837         moveExpValuePtr(&amp;pq, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpqForeground));
04838         <span class="keywordflow">if</span> (pq == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04839             <span class="comment">// Happens during winlogon</span>
04840             Print(<span class="stringliteral">"No foreground queue!\n"</span>);
04841             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04842         }
04843         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(q, pq);
04844         pti = q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>;
04845     } <span class="keywordflow">else</span> {
04846         <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> |= DHKF_PTI_GIVEN;
04847         pti = (<a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>)param1;
04848     }
04849 
04850     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ti, pti);
04851 
04852     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; DHKF_PTI_GIVEN || !(<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; DHKF_GLOBAL_HOOKS)) {
04853         Print(<span class="stringliteral">"Local hooks on PTHREADINFO @ 0x%p%s:\n"</span>, pti,
04854             (dwFlags &amp; DHKF_PTI_GIVEN ? <span class="stringliteral">""</span> : <span class="stringliteral">" (foreground thread)"</span>));
04855 
04856         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_MSGFILTER"</span>, WH_MSGFILTER);
04857         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_JOURNALRECORD"</span>, WH_JOURNALRECORD);
04858         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_JOURNALPLAYBACK"</span>, WH_JOURNALPLAYBACK);
04859         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_KEYBOARD"</span>, WH_KEYBOARD);
04860         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_GETMESSAGE"</span>, WH_GETMESSAGE);
04861         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_CALLWNDPROC"</span>, WH_CALLWNDPROC);
04862         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_CALLWNDPROCRET"</span>, WH_CALLWNDPROCRET);
04863         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_CBT"</span>, WH_CBT);
04864         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_SYSMSGFILTER"</span>, WH_SYSMSGFILTER);
04865         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_MOUSE"</span>, WH_MOUSE);
04866         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_HARDWARE"</span>, WH_HARDWARE);
04867         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_DEBUG"</span>, WH_DEBUG);
04868         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_SHELL"</span>, WH_SHELL);
04869         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_FOREGROUNDIDLE"</span>, WH_FOREGROUNDIDLE);
04870         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_KEYBOARD_LL"</span>, WH_KEYBOARD_LL);
04871         <a class="code" href="../../d2/d1/userexts_8c.html#a11">DUMPLHOOKS</a>(<span class="stringliteral">"WH_MOUSE_LL"</span>, WH_MOUSE_LL);
04872     }
04873 
04874     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; DHKF_GLOBAL_HOOKS) {
04875         <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">DESKTOPINFO</a> <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>;
04876 
04877         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(di, ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o7">pDeskInfo</a>);
04878 
04879         Print(<span class="stringliteral">"Global hooks for Desktop @ %lx:\n"</span>, ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>);
04880         Print(<span class="stringliteral">"\tfsHooks            0x%08lx\n"</span>
04881               <span class="stringliteral">"\taphkStart\n"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.fsHooks);
04882 
04883         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_MSGFILTER"</span>, WH_MSGFILTER);
04884         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_JOURNALRECORD"</span>, WH_JOURNALRECORD);
04885         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_JOURNALPLAYBACK"</span>, WH_JOURNALPLAYBACK);
04886         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_KEYBOARD"</span>, WH_KEYBOARD);
04887         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_GETMESSAGE"</span>, WH_GETMESSAGE);
04888         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_CALLWNDPROC"</span>, WH_CALLWNDPROC);
04889         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_CALLWNDPROCRET"</span>, WH_CALLWNDPROCRET);
04890         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_CBT"</span>, WH_CBT);
04891         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_SYSMSGFILTER"</span>, WH_SYSMSGFILTER);
04892         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_MOUSE"</span>, WH_MOUSE);
04893         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_HARDWARE"</span>, WH_HARDWARE);
04894         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_DEBUG"</span>, WH_DEBUG);
04895         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_SHELL"</span>, WH_SHELL);
04896         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_FOREGROUNDIDLE"</span>, WH_FOREGROUNDIDLE);
04897         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_KEYBOARD_LL"</span>, WH_KEYBOARD_LL);
04898         <a class="code" href="../../d2/d1/userexts_8c.html#a10">DUMPHOOKS</a>(<span class="stringliteral">"WH_MOUSE_LL"</span>, WH_MOUSE_LL);
04899     }
04900     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04901 }
04902 <span class="preprocessor">#endif // KERNEL</span>
04903 <span class="preprocessor"></span>
04904 
04905 <span class="preprocessor">#ifdef KERNEL</span>
04906 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
04907 <span class="comment">* dhot - dump hotkeys</span>
04908 <span class="comment">*</span>
04909 <span class="comment">* dhot       - dumps all hotkeys</span>
04910 <span class="comment">*</span>
04911 <span class="comment">* 10/21/94 IanJa        Created.</span>
04912 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
04913 <span class="comment">\***************************************************************************/</span>
04914 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idhot()
04915 {
04916     <a class="code" href="../../d8/d6/structtagHOTKEY.html">PHOTKEY</a>         phk;
04917     <a class="code" href="../../d8/d6/structtagHOTKEY.html">HOTKEY</a>          hk;
04918 
04919     moveExpValuePtr(&amp;phk, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gphkFirst));
04920     SAFEWHILE (phk != NULL) {
04921         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(hk, phk);
04922         Print(<span class="stringliteral">"fsModifiers %lx, vk %x - "</span>,
04923             hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o2">fsModifiers</a>, hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o4">vk</a>);
04924         Print(<span class="stringliteral">"%s%s%s%sVK:%x %s"</span>,
04925             hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o2">fsModifiers</a> &amp; MOD_SHIFT   ? <span class="stringliteral">"Shift + "</span> : <span class="stringliteral">""</span>,
04926             hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o2">fsModifiers</a> &amp; MOD_ALT     ? <span class="stringliteral">"Alt + "</span>   : <span class="stringliteral">""</span>,
04927             hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o2">fsModifiers</a> &amp; MOD_CONTROL ? <span class="stringliteral">"Ctrl + "</span>  : <span class="stringliteral">""</span>,
04928             hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o2">fsModifiers</a> &amp; MOD_WIN     ? <span class="stringliteral">"Win + "</span>   : <span class="stringliteral">""</span>,
04929             hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o4">vk</a>, <a class="code" href="../../d2/d1/userexts_8c.html#a212">GetVKeyName</a>(hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o4">vk</a>));
04930 
04931         Print(<span class="stringliteral">"\n  id   %x\n"</span>, hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o5">id</a>);
04932         Print(<span class="stringliteral">"  pti  %lx\n"</span>, hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o0">pti</a>);
04933         Print(<span class="stringliteral">"  pwnd %lx = "</span>, hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a>);
04934         <span class="keywordflow">if</span> (hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a> == <a class="code" href="../../d4/d1/userk_8h.html#a450">PWND_FOCUS</a>) {
04935             Print(<span class="stringliteral">"PWND_FOCUS\n"</span>);
04936         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a> == <a class="code" href="../../d4/d1/userk_8h.html#a449">PWND_INPUTOWNER</a>) {
04937             Print(<span class="stringliteral">"PWND_INPUTOWNER\n"</span>);
04938         } <span class="keywordflow">else</span> {
04939             <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> ach[80];
04940             <span class="comment">/*</span>
04941 <span class="comment">             * Print title string.</span>
04942 <span class="comment">             */</span>
04943             <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o1">spwnd</a>,ach);
04944             Print(<span class="stringliteral">"\"%s\"\n"</span>, ach);
04945         }
04946         Print(<span class="stringliteral">"\n"</span>);
04947 
04948         phk = hk.<a class="code" href="../../d8/d6/structtagHOTKEY.html#o6">phkNext</a>;
04949     }
04950     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04951 }
04952 <span class="preprocessor">#endif // KERNEL</span>
04953 <span class="preprocessor"></span>
04954 <span class="preprocessor">#ifdef KERNEL</span>
04955 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
04956 <span class="comment">* dhs           - dumps simple statistics for whole table</span>
04957 <span class="comment">* dhs t id      - dumps simple statistics for objects created by thread id</span>
04958 <span class="comment">* dhs p id      - dumps simple statistics for objects created by process id</span>
04959 <span class="comment">* dhs v         - dumps verbose statistics for whole table</span>
04960 <span class="comment">* dhs v t id    - dumps verbose statistics for objects created by thread id.</span>
04961 <span class="comment">* dhs v p id    - dumps verbose statistics for objects created by process id.</span>
04962 <span class="comment">* dhs y type    - just dumps that type</span>
04963 <span class="comment">*</span>
04964 <span class="comment">* Dump handle table statistics.</span>
04965 <span class="comment">*</span>
04966 <span class="comment">* 02-21-92 ScottLu      Created.</span>
04967 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
04968 <span class="comment">\***************************************************************************/</span>
04969 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idhs(
04970 DWORD opts,
04971 PVOID param1)
04972 {
04973     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> *phe, he;
04974     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwT;
04975     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> acHandles[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>];
04976     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cHandlesUsed, cHandlesSkipped;
04977     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idThread, idProcess;
04978     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
04979     <span class="keywordtype">int</span> Type, cHandleEntries = 0;
04980     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PROCESSINFO</a> pi;
04981     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">THREADINFO</a> ti;
04982 
04983     <a class="code" href="../../d1/d6/structtagHANDLETYPEINFO.html">PHANDLETYPEINFO</a> pahti = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04984     <a class="code" href="../../d1/d6/structtagHANDLETYPEINFO.html">HANDLETYPEINFO</a> ahti[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>];
04985 
04986     pahti = EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gahti));
04987     <span class="keywordflow">if</span> (!pahti) {
04988         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;;
04989     }
04990     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ahti, pahti);
04991 
04992     <span class="comment">/*</span>
04993 <span class="comment">     * Evaluate the argument string and get the address of the object to</span>
04994 <span class="comment">     * dump. Take either a handle or a pointer to the object.</span>
04995 <span class="comment">     */</span>
04996     <span class="keywordflow">if</span> (opts &amp; OFLAG(y)) {
04997         Type = PtrToUlong(param1);
04998     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opts &amp; (OFLAG(t) | OFLAG(p))) {
04999         dwT = PtrToUlong(param1);
05000     }
05001 
05002     cHandlesSkipped = 0;
05003     cHandlesUsed = 0;
05004     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>; i++)
05005         acHandles[i] = 0;
05006 
05007     <span class="keywordflow">if</span> (param1) {
05008         <span class="keywordflow">if</span> (opts &amp; OFLAG(p)) {
05009             Print(<span class="stringliteral">"Handle dump for client process id 0x%lx only:\n\n"</span>, dwT);
05010         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opts &amp; OFLAG(t)) {
05011             Print(<span class="stringliteral">"Handle dump for client thread id 0x%lx only:\n\n"</span>, dwT);
05012         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opts &amp; OFLAG(y)) {
05013             Print(<span class="stringliteral">"Handle dump for %s objects:\n\n"</span>, aszTypeNames[Type]);
05014         }
05015     } <span class="keywordflow">else</span> {
05016         Print(<span class="stringliteral">"Handle dump for all processes and threads:\n\n"</span>);
05017     }
05018 
05019     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
05020         Print(<span class="stringliteral">"Handle          Type\n"</span>);
05021         Print(<span class="stringliteral">"--------------------\n"</span>);
05022     }
05023 
05024     <a class="code" href="../../d2/d1/userexts_8c.html#a8">FOREACHHANDLEENTRY</a>(phe, he, i)
05025         cHandleEntries++;
05026 
05027         if ((opts &amp; OFLAG(y)) &amp;&amp; he.bType != Type) {
05028             <span class="keywordflow">continue</span>;
05029         }
05030 
05031         <span class="keywordflow">if</span> (opts &amp; OFLAG(p) &amp;&amp;
05032                 (ahti[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>].<a class="code" href="../../d1/d6/structtagHANDLETYPEINFO.html#o2">bObjectCreateFlags</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a414">OCF_PROCESSOWNED</a>)) {
05033 
05034             <span class="keywordflow">if</span> (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05035                 <span class="keywordflow">continue</span>;
05036             }
05037 
05038             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pi, he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a>);
05039             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(pi.Process, PROCESS_PROCESSID, &amp;idProcess) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05040                 Print(<span class="stringliteral">"Unable to read _EPROCESS at %lx\n"</span>,pi.Process);
05041                 <span class="keywordflow">continue</span>;
05042             }
05043             <span class="keywordflow">if</span> (idProcess != dwT) {
<a name="l05044"></a><a class="code" href="../../d2/d1/userexts_8c.html#a213">05044</a>                 <span class="keywordflow">continue</span>;
05045             }
05046 
05047         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((opts &amp; OFLAG(t)) &amp;&amp;
05048                 !(ahti[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>].bObjectCreateFlags &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a414">OCF_PROCESSOWNED</a>)) {
05049 
05050             <span class="keywordflow">if</span> (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05051                 <span class="keywordflow">continue</span>;
05052             }
05053 
05054             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ti, he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o1">pOwner</a>);
05055             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(idThread, &amp;(ti.pEThread-&gt;Cid.UniqueThread));
05056             <span class="keywordflow">if</span> (idThread != dwT) {
05057                 <span class="keywordflow">continue</span>;
05058             }
05059         }
05060 
05061         acHandles[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>]++;
05062 
05063         <span class="keywordflow">if</span> (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a> == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a236">TYPE_FREE</a>) {
05064             <span class="keywordflow">continue</span>;
05065         }
05066 
05067         cHandlesUsed++;
05068 
05069         <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
05070             Print(<span class="stringliteral">"0x%08lx %c    %s\n"</span>,
05071                     i,
05072                     (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o3">bFlags</a> &amp; HANDLEF_DESTROY) ? <span class="charliteral">'*'</span> : <span class="charliteral">' '</span>,
05073                     aszTypeNames[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>]);
05074         }
05075 
05076     <a class="code" href="../../d2/d1/userexts_8c.html#a9">NEXTEACHHANDLEENTRY</a>()
05077 
05078     if (!(opts &amp; OFLAG(v))) {
05079         Print(<span class="stringliteral">"Count           Type\n"</span>);
05080         Print(<span class="stringliteral">"--------------------\n"</span>);
05081         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>; i++) {
05082             <span class="keywordflow">if</span> ((opts &amp; OFLAG(y)) &amp;&amp; Type != (<span class="keywordtype">int</span>)i) {
05083                 <span class="keywordflow">continue</span>;
05084             }
05085             Print(<span class="stringliteral">"0x%08lx      (%d) %s\n"</span>, acHandles[i], i, aszTypeNames[i]);
05086         }
05087     }
05088 
05089     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(y))) {
05090         Print(<span class="stringliteral">"\nTotal Accessible Handles: 0x%lx\n"</span>, cHandleEntries);
05091         Print(<span class="stringliteral">"Used Accessible Handles: 0x%lx\n"</span>, cHandlesUsed);
05092         Print(<span class="stringliteral">"Free Accessible Handles: 0x%lx\n"</span>, cHandleEntries - cHandlesUsed);
05093     }
05094     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05095 }
05096 <span class="preprocessor">#endif // KERNEL</span>
05097 <span class="preprocessor"></span>
05098 <span class="preprocessor">#ifdef KERNEL</span>
05099 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
05100 <span class="comment">* di - dumps interesting globals in USER related to input.</span>
05101 <span class="comment">*</span>
05102 <span class="comment">*</span>
05103 <span class="comment">* 11-14-91 DavidPe      Created.</span>
05104 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
05105 <span class="comment">\***************************************************************************/</span>
05106 
05107 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idi()
05108 {
05109     <span class="keywordtype">char</span>            ach[80];
05110     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a>              pq;
05111     <a class="code" href="../../d7/d4/structtagQ.html">Q</a>               q;
05112     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>           dw, dw1;
05113     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">PSERVERINFO</a>     psi;
05114     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a>      si;
05115     <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>        pdesk;
05116     <a class="code" href="../../d0/d3/structtagDESKTOP.html">DESKTOP</a>         desk;
05117     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>            pwnd;
05118 
05119 
05120     <a class="code" href="../../d2/d1/userexts_8c.html#a33">PRTGDW2</a>(gptiCurrent, grpdeskRitInput);
05121     <a class="code" href="../../d2/d1/userexts_8c.html#a33">PRTGDW2</a>(gpqForeground, gpqForegroundPrev);
05122     <a class="code" href="../../d2/d1/userexts_8c.html#a33">PRTGDW2</a>(gptiForeground, gpqCursor);
05123 
05124     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"win32k!glinp + %#lx"</span>, FIELD_OFFSET(<a class="code" href="../../d5/d9/structtagLASTINPUT.html">LASTINPUT</a>, timeLastInputMessage));
05125     moveExpValue(&amp;dw, ach);
05126     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"win32k!glinp + %#lx"</span>, FIELD_OFFSET(<a class="code" href="../../d5/d9/structtagLASTINPUT.html">LASTINPUT</a>, ptiLastWoken));
05127     moveExpValue(&amp;dw1, ach);
05128     <a class="code" href="../../d2/d1/userexts_8c.html#a21">PRTVDW2</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a78">glinp</a>.<a class="code" href="../../d5/d9/structtagLASTINPUT.html#o0">timeLastInputMessage</a>, dw, <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a78">glinp</a>.<a class="code" href="../../d5/d9/structtagLASTINPUT.html#o2">ptiLastWoken</a>, dw1);
05129     <a class="code" href="../../d2/d1/userexts_8c.html#a32">PRTGDW1</a>(gwMouseOwnerButton);
05130 
05131     moveExpValuePtr(&amp;psi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
05132     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(si, psi);
05133     <a class="code" href="../../d2/d1/userexts_8c.html#a24">PRTVPT</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor, si.ptCursor);
05134 
05135     moveExpValuePtr(&amp;pdesk, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(grpdeskRitInput));
05136     <span class="keywordflow">if</span> (pdesk != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05137         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(desk, pdesk);
05138         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pwnd, &amp;(desk.<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>));
05139         <a class="code" href="../../d2/d1/userexts_8c.html#a34">PRTWND</a>(Desktop window, pwnd);
05140     }
05141 
05142     moveExpValuePtr(&amp;pq, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpqForeground));
05143     <span class="keywordflow">if</span> (pq != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05144         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(q, pq);
05145         <a class="code" href="../../d2/d1/userexts_8c.html#a34">PRTWND</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o7">spwndFocus</a>, q.<a class="code" href="../../d7/d4/structtagQ.html#o7">spwndFocus</a>);
05146         <a class="code" href="../../d2/d1/userexts_8c.html#a34">PRTWND</a>(<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>, q.<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>);
05147     }
05148 
05149     <a class="code" href="../../d2/d1/userexts_8c.html#a35">PRTGWND</a>(gspwndScreenCapture);
05150     <a class="code" href="../../d2/d1/userexts_8c.html#a35">PRTGWND</a>(gspwndInternalCapture);
05151     <a class="code" href="../../d2/d1/userexts_8c.html#a35">PRTGWND</a>(gspwndMouseOwner);
05152 
05153     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05154 }
05155 <span class="preprocessor">#endif // KERNEL</span>
05156 <span class="preprocessor"></span>
05157 
05158 
05159 <span class="comment">/************************************************************************\</span>
05160 <span class="comment">* Procedure: Idll</span>
05161 <span class="comment">*</span>
05162 <span class="comment">* Description: Dump Linked Lists</span>
05163 <span class="comment">*</span>
05164 <span class="comment">* Returns: fSuccess</span>
05165 <span class="comment">*</span>
05166 <span class="comment">* ???????? Scottlu  Created</span>
05167 <span class="comment">* 6/9/1995 SanfordS made to fit stdexts motif</span>
05168 <span class="comment">*</span>
05169 <span class="comment">\************************************************************************/</span>
05170 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a218">Idll</a>(
05171     DWORD opts,
05172     LPSTR lpas)
05173 {
05174     <span class="keyword">static</span> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> iOffset;
05175     <span class="keyword">static</span> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cStructs;
05176     <span class="keyword">static</span> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cDwords;
05177     <span class="keyword">static</span> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cDwordsBack;
05178     <span class="keyword">static</span> DWORD_PTR dw, dwHalfSpeed;
05179     DWORD_PTR dwT;
05180     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cBytesBack;
05181     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i, j;
05182     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fIndirectFirst;
05183     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fTestAndCountOnly;
05184     DWORD_PTR dwFind;
05185     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> adw[<a class="code" href="../../d2/d1/userexts_8c.html#a0">CDWORDS</a>];
05186     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
05187     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwValue;
05188 
05189     UNREFERENCED_PARAMETER(opts);
05190 
05191     <span class="comment">/*</span>
05192 <span class="comment">     * Evaluate the argument string and get the address of the object to</span>
05193 <span class="comment">     * dump. Take either a handle or a pointer to the object.</span>
05194 <span class="comment">     */</span>
05195     <span class="keywordflow">while</span> (*lpas == <span class="charliteral">' '</span>)
05196         lpas++;
05197 
05198     <span class="comment">/*</span>
05199 <span class="comment">     * If there are no arguments, keep walking from the last</span>
05200 <span class="comment">     * pointer.</span>
05201 <span class="comment">     */</span>
05202     <span class="keywordflow">if</span> (*lpas != 0) {
05203 
05204         <span class="comment">/*</span>
05205 <span class="comment">         * If the address has a '*' in front of it, it means start with the</span>
05206 <span class="comment">         * pointer stored at that address.</span>
05207 <span class="comment">         */</span>
05208         fIndirectFirst = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05209         <span class="keywordflow">if</span> (*lpas == <span class="charliteral">'*'</span>) {
05210             lpas++;
05211             fIndirectFirst = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05212         }
05213 
05214         <span class="comment">/*</span>
05215 <span class="comment">         * Scan past the address.</span>
05216 <span class="comment">         */</span>
05217         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d1/userexts_8c.html#a215">GetInteger</a>(lpas, 16, &amp;dwValue, &amp;lpas);
05218         dw = dwValue;
05219         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
05220             dw = (DWORD_PTR)EvalExp(lpas);
05221         }
05222         <span class="keywordflow">if</span> (fIndirectFirst)
05223             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dw, (PVOID)dw);
05224         dwHalfSpeed = dw;
05225 
05226         iOffset = 0;
05227         cStructs = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)25;
05228         cDwords = 8;
05229         cDwordsBack = 0;
05230         fTestAndCountOnly = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05231         dwFind = 0;
05232 
05233         SAFEWHILE (TRUE) {
05234             <span class="keywordflow">while</span> (*lpas == <span class="charliteral">' '</span>)
05235                 lpas++;
05236 
05237             <span class="keywordflow">switch</span>(*lpas) {
05238             <span class="keywordflow">case</span> <span class="charliteral">'l'</span>:
05239                 <span class="comment">/*</span>
05240 <span class="comment">                 * length of each structure.</span>
05241 <span class="comment">                 */</span>
05242                 lpas++;
05243                 cDwords = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(DWORD_PTR)EvalExp(lpas);
05244                 <span class="keywordflow">if</span> (cDwords &gt; <a class="code" href="../../d2/d1/userexts_8c.html#a0">CDWORDS</a>) {
05245                     Print(<span class="stringliteral">"\nl%d? - %d DWORDs maximum\n\n"</span>, cDwords, CDWORDS);
05246                     cDwords = <a class="code" href="../../d2/d1/userexts_8c.html#a0">CDWORDS</a>;
05247                 }
05248                 <span class="keywordflow">break</span>;
05249 
05250             <span class="keywordflow">case</span> <span class="charliteral">'b'</span>:
05251                 <span class="comment">/*</span>
05252 <span class="comment">                 * go back cDwordsBack and dump cDwords from there</span>
05253 <span class="comment">                 * (useful for LIST_ENTRYs, where Flink doesn't point to</span>
05254 <span class="comment">                 * the start of the struct)</span>
05255 <span class="comment">                 */</span>
05256                 lpas++;
05257                 cDwordsBack = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(DWORD_PTR)EvalExp(lpas);
05258                 <span class="keywordflow">if</span> (cDwordsBack &gt;= <a class="code" href="../../d2/d1/userexts_8c.html#a0">CDWORDS</a>) {
05259                     Print(<span class="stringliteral">"\nb%d? - %d DWORDs maximum\n\n"</span>, cDwordsBack, CDWORDS - 1);
05260                     cDwordsBack = <a class="code" href="../../d2/d1/userexts_8c.html#a0">CDWORDS</a> - 1;
05261                 }
05262                 <span class="keywordflow">break</span>;
05263 
05264             <span class="keywordflow">case</span> <span class="charliteral">'o'</span>:
05265                 <span class="comment">/*</span>
05266 <span class="comment">                 * Offset of 'next' pointer.</span>
05267 <span class="comment">                 */</span>
05268                 lpas++;
05269                 iOffset = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(DWORD_PTR)EvalExp(lpas);
05270                 <span class="keywordflow">break</span>;
05271 
05272             <span class="keywordflow">case</span> <span class="charliteral">'c'</span>:
05273                 <span class="comment">/*</span>
05274 <span class="comment">                 * Count of structures to dump</span>
05275 <span class="comment">                 */</span>
05276                 lpas++;
05277                 cStructs = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(DWORD_PTR)EvalExp(lpas);
05278                 <span class="keywordflow">break</span>;
05279 
05280             <span class="keywordflow">case</span> <span class="charliteral">'f'</span>:
05281                 <span class="comment">/*</span>
05282 <span class="comment">                 * Find element at given address</span>
05283 <span class="comment">                 */</span>
05284                 lpas++;
05285                 dwFind = (DWORD_PTR)EvalExp(lpas);
05286                 <span class="keywordflow">break</span>;
05287 
05288             <span class="keywordflow">case</span> <span class="charliteral">'t'</span>:
05289                 <span class="comment">/*</span>
05290 <span class="comment">                 * Test list for loop, and count</span>
05291 <span class="comment">                 */</span>
05292                 fTestAndCountOnly = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05293                 cStructs = 0x100000;
05294 
05295             <span class="keywordflow">default</span>:
05296                 <span class="keywordflow">break</span>;
05297             }
05298 
05299             <span class="keywordflow">while</span> (*lpas &amp;&amp; *lpas != <span class="charliteral">' '</span>)
05300                 lpas++;
05301 
05302             <span class="keywordflow">if</span> (*lpas == 0)
05303                 <span class="keywordflow">break</span>;
05304         }
05305 
05306         <span class="keywordflow">if</span> (cDwordsBack &gt; cDwords) {
05307             Print(<span class="stringliteral">"backing up %d DWORDS per struct (b%d): "</span>,
05308                     cDwordsBack, cDwordsBack);
05309             Print(<span class="stringliteral">"increasing l%d to l%d so next link is included\n"</span>,
05310                     cDwords, cDwordsBack + 1);
05311             cDwords = cDwordsBack + 1;
05312         }
05313 
05314         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d2/d1/userexts_8c.html#a0">CDWORDS</a>; i++)
05315             adw[i] = 0;
05316     }
05317 
05318     cBytesBack = cDwordsBack * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
05319 
05320     <span class="keywordflow">for</span> (i = 0; i &lt; cStructs; i++) {
05321         <a class="code" href="../../d7/d4/conexts_8c.html#a2">moveBlock</a>(adw, (PVOID)(dw - cBytesBack), <span class="keyword">sizeof</span>(DWORD) * cDwords);
05322 
05323         <span class="keywordflow">if</span> (!fTestAndCountOnly) {
05324             Print(<span class="stringliteral">"---- 0x%lx:\n"</span>, i);
05325             <span class="keywordflow">for</span> (j = 0; j &lt; cDwords; j += 4) {
05326                 <span class="keywordflow">switch</span> (cDwords - j) {
05327                 <span class="keywordflow">case</span> 1:
05328                     Print(<span class="stringliteral">"%08lx:  %08lx\n"</span>,
05329                             dw + j * <span class="keyword">sizeof</span>(DWORD),
05330                             adw[j + 0]);
05331                     <span class="keywordflow">break</span>;
05332 
05333                 <span class="keywordflow">case</span> 2:
05334                     Print(<span class="stringliteral">"%08lx:  %08lx %08lx\n"</span>,
05335                             dw + j * <span class="keyword">sizeof</span>(DWORD),
05336                             adw[j + 0], adw[j + 1]);
05337                     <span class="keywordflow">break</span>;
05338 
05339                 <span class="keywordflow">case</span> 3:
05340                     Print(<span class="stringliteral">"%08lx:  %08lx %08lx %08lx\n"</span>,
05341                             dw + j * <span class="keyword">sizeof</span>(DWORD),
05342                             adw[j + 0], adw[j + 1], adw[j + 2]);
05343                     <span class="keywordflow">break</span>;
05344 
05345                 <span class="keywordflow">default</span>:
05346                     Print(<span class="stringliteral">"%08lx:  %08lx %08lx %08lx %08lx\n"</span>,
05347                             dw + j * <span class="keyword">sizeof</span>(DWORD),
05348                             adw[j + 0], adw[j + 1], adw[j + 2], adw[j + 3]);
05349                 }
05350             }
05351         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((i &amp; 0xff) == 0xff) {
05352             Print(<span class="stringliteral">"item 0x%lx at %lx...\n"</span>, i+1, dw);
05353         }
05354 
05355         <span class="keywordflow">if</span> (dwFind == dw) {
05356             Print(<span class="stringliteral">"====== FOUND ITEM ======\n"</span>);
05357             <span class="keywordflow">break</span>;
05358         }
05359 
05360         <span class="comment">/*</span>
05361 <span class="comment">         * Give a chance to break out every 16 items</span>
05362 <span class="comment">         */</span>
05363         <span class="keywordflow">if</span> ((i &amp; 0xf) == 0xf) {
05364             <span class="keywordflow">if</span> (IsCtrlCHit()) {
05365                 Print(<span class="stringliteral">"terminated by Ctrl-C on item 0x%lx at %lx...\n"</span>, i, dw);
05366                 <span class="keywordflow">break</span>;
05367             }
05368         }
05369 
05370         <span class="comment">/*</span>
05371 <span class="comment">         * Advance to next item.</span>
05372 <span class="comment">         */</span>
05373         dwT = dw + iOffset * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
05374         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dw, (PVOID)dwT);
05375 
05376         <span class="keywordflow">if</span> (fTestAndCountOnly) {
05377             <span class="comment">/*</span>
05378 <span class="comment">             * Advance dwHalfSpeed every other time round the loop: if</span>
05379 <span class="comment">             * dw ever catches up to dwHalfSpeed, then we have a loop!</span>
05380 <span class="comment">             */</span>
05381             <span class="keywordflow">if</span> (i &amp; 1) {
05382                 dwT = dwHalfSpeed + iOffset * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
05383                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dwHalfSpeed, (PVOID)dwT);
05384             }
05385             <span class="keywordflow">if</span> (dw == dwHalfSpeed) {
05386                 Print(<span class="stringliteral">"!!! Loop Detected on item 0x%lx at %lx...\n"</span>, i, dw);
05387                 <span class="keywordflow">break</span>;
05388             }
05389         }
05390 
05391         <span class="keywordflow">if</span> (dw == 0)
05392             <span class="keywordflow">break</span>;
05393     }
05394     Print(<span class="stringliteral">"---- Total 0x%lx items ----\n"</span>, i+1);
05395     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05396 }
05397 
05398 <span class="comment">/************************************************************************\</span>
05399 <span class="comment">* Procedure: Ifind</span>
05400 <span class="comment">*</span>
05401 <span class="comment">* Description: Find Linked List Element</span>
05402 <span class="comment">*</span>
05403 <span class="comment">* Returns: fSuccess</span>
05404 <span class="comment">*</span>
05405 <span class="comment">* 11/22/95 JimA         Created.</span>
05406 <span class="comment">\************************************************************************/</span>
05407 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a219">Ifind</a>(
05408     DWORD opts,
05409     LPSTR lpas)
05410 {
05411     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> iOffset = 0;
05412     LPDWORD adw;
05413     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbDwords;
05414     DWORD_PTR dwBase;
05415     DWORD_PTR dwLast = 0;
05416     DWORD_PTR dwAddr;
05417     DWORD_PTR dwTest;
05418     DWORD_PTR dwT;
05419 
05420     UNREFERENCED_PARAMETER(opts);
05421 
05422     <span class="comment">/*</span>
05423 <span class="comment">     * Evaluate the argument string and get the address of the object to</span>
05424 <span class="comment">     * dump. Take either a handle or a pointer to the object.</span>
05425 <span class="comment">     */</span>
05426     <span class="keywordflow">while</span> (*lpas == <span class="charliteral">' '</span>)
05427         lpas++;
05428 
05429     <span class="comment">/*</span>
05430 <span class="comment">     * If there are no arguments, keep walking from the last</span>
05431 <span class="comment">     * pointer.</span>
05432 <span class="comment">     */</span>
05433     <span class="keywordflow">if</span> (*lpas != 0) {
05434 
05435         <span class="comment">/*</span>
05436 <span class="comment">         * Scan past the addresses.</span>
05437 <span class="comment">         */</span>
05438         dwBase = (DWORD_PTR)EvalExp(lpas);
05439         <span class="keywordflow">while</span> (*lpas &amp;&amp; *lpas != <span class="charliteral">' '</span>)
05440             lpas++;
05441         dwAddr = (DWORD_PTR)EvalExp(lpas);
05442         <span class="keywordflow">while</span> (*lpas &amp;&amp; *lpas != <span class="charliteral">' '</span>)
05443             lpas++;
05444 
05445         iOffset = 0;
05446 
05447         SAFEWHILE (TRUE) {
05448             <span class="keywordflow">if</span> (IsCtrlCHit())
05449                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05450             <span class="keywordflow">while</span> (*lpas == <span class="charliteral">' '</span>)
05451                 lpas++;
05452 
05453             <span class="keywordflow">switch</span>(*lpas) {
05454             <span class="keywordflow">case</span> <span class="charliteral">'o'</span>:
05455                 <span class="comment">/*</span>
05456 <span class="comment">                 * Offset of 'next' pointer.</span>
05457 <span class="comment">                 */</span>
05458                 lpas++;
05459                 iOffset = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(DWORD_PTR)EvalExp(lpas);
05460                 <span class="keywordflow">break</span>;
<a name="l05461"></a><a class="code" href="../../d2/d1/userexts_8c.html#a214">05461</a> 
05462             <span class="keywordflow">default</span>:
05463                 <span class="keywordflow">break</span>;
05464             }
05465 
05466             <span class="keywordflow">while</span> (*lpas &amp;&amp; *lpas != <span class="charliteral">' '</span>)
05467                 lpas++;
05468 
<a name="l05469"></a><a class="code" href="../../d2/d1/userexts_8c.html#a215">05469</a>             <span class="keywordflow">if</span> (*lpas == 0)
05470                 <span class="keywordflow">break</span>;
05471         }
05472     }
05473 
05474     cbDwords = (iOffset + 1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
05475     adw = LocalAlloc(LPTR, cbDwords);
05476     dwTest = dwBase;
05477 
05478     <span class="keywordflow">while</span> (dwTest &amp;&amp; dwTest != dwAddr) {
05479         <a class="code" href="../../d7/d4/conexts_8c.html#a2">moveBlock</a>(adw, (PVOID)dwTest, cbDwords);
05480 
05481         dwLast = dwTest;
05482         dwT = dwTest + iOffset * <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
05483         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dwTest, (PVOID)dwT);
05484     }
05485     <span class="keywordflow">if</span> (dwTest == 0)
05486         Print(<span class="stringliteral">"Address %#p not found\n"</span>, dwAddr);
05487     <span class="keywordflow">else</span>
05488         Print(<span class="stringliteral">"Address %#p found, previous = %#p\n"</span>, dwAddr, dwLast);
05489     LocalFree(adw);
05490     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05491 }
05492 
05493 
05494 <span class="preprocessor">#ifdef KERNEL</span>
05495 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
<a name="l05496"></a><a class="code" href="../../d2/d1/userexts_8c.html#a216">05496</a> <span class="comment">* dlr handle|pointer</span>
05497 <span class="comment">*</span>
05498 <span class="comment">* Dumps lock list for object</span>
05499 <span class="comment">*</span>
05500 <span class="comment">* 02-27-92 ScottLu      Created.</span>
05501 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
05502 <span class="comment">\***************************************************************************/</span>
05503 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idlr(
05504 DWORD opts,
05505 PVOID param1)
05506 {
05507     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he;
05508 <span class="preprocessor">#if DBG</span>
05509 <span class="preprocessor"></span>    <a class="code" href="../../d1/d3/struct__LOCKRECORD.html">PLR</a> plrT;
05510 <span class="preprocessor">#endif</span>
05511 <span class="preprocessor"></span>
05512 <span class="preprocessor">#if DEBUGTAGS</span>
05513 <span class="preprocessor"></span>    <a class="code" href="../../d2/d6/structtagSERVERINFO.html">PSERVERINFO</a> psi;
05514     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       dwDBGTAGFlags;
05515     moveExpValuePtr(&amp;psi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>));
05516     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dwDBGTAGFlags, &amp;(psi-&gt;adwDBGTAGFlags[DBGTAG_TrackLocks]));
05517     dwDBGTAGFlags &amp;= DBGTAG_VALIDUSERFLAGS;
05518     <span class="keywordflow">if</span> (dwDBGTAGFlags == DBGTAG_DISABLED) {
05519         Print(<span class="stringliteral">"dlr works better if tag TrackLocks is enabled.\n"</span>);
05520         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
05521     }
05522 
05523 <span class="preprocessor">#endif</span>
05524 <span class="preprocessor"></span>
05525     UNREFERENCED_PARAMETER(opts);
05526 
05527     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/userexts_8c.html#a203">GetAndDumpHE</a>((ULONG_PTR)param1, &amp;he, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>)) {
05528         Print(<span class="stringliteral">"!dlr: GetAndDumpHE failed\n"</span>);
05529         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05530     }
05531 
05532     <span class="comment">/*</span>
05533 <span class="comment">     * We have the handle entry: 'he' is filled in.  Now dump the</span>
05534 <span class="comment">     * lock records. Remember the 1st record is the last transaction!!</span>
05535 <span class="comment">     */</span>
05536 <span class="preprocessor">#if DBG</span>
05537 <span class="preprocessor"></span>    plrT = he.plr;
05538 
05539     <span class="keywordflow">if</span> (plrT != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05540         Print(<span class="stringliteral">"phe %x Dumping the lock records\n"</span>
05541               <span class="stringliteral">"----------------------------------------------\n"</span>
05542               <span class="stringliteral">"address  cLock\n"</span>
05543               <span class="stringliteral">"----------------------------------------------\n"</span>);
05544     }
05545 
05546     SAFEWHILE (plrT != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05547         DWORD_PTR   dw;
05548         <a class="code" href="../../d1/d3/struct__LOCKRECORD.html">LOCKRECORD</a>  lr;
05549         <span class="keywordtype">int</span>         i;
05550         <span class="keywordtype">char</span>        ach[80];
05551 
05552         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(lr, plrT);
05553 
05554         Print(<span class="stringliteral">"%08x %08d\n"</span>, lr.<a class="code" href="../../d1/d3/struct__LOCKRECORD.html#o2">ppobj</a>, lr.<a class="code" href="../../d1/d3/struct__LOCKRECORD.html#o1">cLockObj</a>);
05555 
05556         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d4/d1/userk_8h.html#a264">LOCKRECORD_STACK</a>; i++) {
05557             GetSym((<a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>)lr.<a class="code" href="../../d1/d3/struct__LOCKRECORD.html#o3">trace</a>[i], ach, &amp;dw);
05558             Print(<span class="stringliteral">"                  %s+%x\n"</span>,
05559                   ach, dw);
05560         }
05561 
05562         plrT = lr.<a class="code" href="../../d1/d3/struct__LOCKRECORD.html#o0">plrNext</a>;
05563     }
05564 <span class="preprocessor">#endif // DBG</span>
05565 <span class="preprocessor"></span>
05566     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05567 }
05568 <span class="preprocessor">#endif // KERNEL</span>
05569 <span class="preprocessor"></span>
05570 
05571 
05572 
05573 <span class="comment">/************************************************************************\</span>
05574 <span class="comment">* Procedure: Idm</span>
05575 <span class="comment">*</span>
05576 <span class="comment">* Description: Dumps Menu structures</span>
05577 <span class="comment">*</span>
05578 <span class="comment">* Returns: fSuccess</span>
05579 <span class="comment">*</span>
05580 <span class="comment">* 6/9/1995 Created SanfordS</span>
05581 <span class="comment">*</span>
05582 <span class="comment">\************************************************************************/</span>
05583 <span class="keywordtype">void</span> <a class="code" href="../../d2/d1/userexts_8c.html#a220">DumpMenu</a>( UINT uIndent, DWORD opts, <a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a> pMenu )
05584 {
05585     <a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>    localMenu;
05586     <a class="code" href="../../d0/d9/structtagITEM.html">ITEM</a>    localItem;
05587     <a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a>   pitem;
05588     LPDWORD lpdw;
05589     DWORD_PTR localDW;
05590     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>     i;
05591     WCHAR   szBufW[128];
05592     <span class="keywordtype">char</span>    szIndent[256];
05593 
05594     <span class="comment">/*</span>
05595 <span class="comment">     * Compute our indent</span>
05596 <span class="comment">     */</span>
05597     <span class="keywordflow">for</span> (i=0; i &lt; uIndent; szIndent[i++]=<span class="charliteral">' '</span>);
05598     szIndent[i] = <span class="charliteral">'\0'</span>;
05599 
05600     <span class="comment">/*</span>
05601 <span class="comment">     * Print the menu header</span>
05602 <span class="comment">     */</span>
05603     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(v))) {
05604         Print(<span class="stringliteral">"0x%p  %s"</span>, pMenu, szIndent);
05605     } <span class="keywordflow">else</span> {
05606         Print(<span class="stringliteral">"%sPMENU @0x%p:\n"</span>, szIndent, pMenu);
05607     }
05608 
05609     <span class="comment">/*</span>
05610 <span class="comment">     * Try and get the menu</span>
05611 <span class="comment">     */</span>
05612     <span class="keywordflow">if</span> (!tryMove(localMenu, pMenu)) {
05613         <span class="keywordflow">return</span>;
05614     }
05615 
05616 
05617     <span class="comment">/*</span>
05618 <span class="comment">     * Print the information for this menu</span>
05619 <span class="comment">     */</span>
05620     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(v))) {
05621         Print(<span class="stringliteral">"PMENU: fFlags=0x%lX, cItems=%lu, iItem=%lu, spwndNotify=0x%p\n"</span>,
05622               localMenu.<a class="code" href="../../d1/d1/structtagMENU.html#o1">fFlags</a>, localMenu.<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>, localMenu.<a class="code" href="../../d1/d1/structtagMENU.html#o2">iItem</a>, localMenu.<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>);
05623     } <span class="keywordflow">else</span> {
05624         Print(<span class="stringliteral">"%s     fFlags............ %s\n"</span>
05625               <span class="stringliteral">"%s     location.......... (%lu, %lu)\n"</span>,
05626               szIndent, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_MF, (WORD)localMenu.<a class="code" href="../../d1/d1/structtagMENU.html#o1">fFlags</a>, NULL, TRUE),
05627               szIndent, localMenu.<a class="code" href="../../d1/d1/structtagMENU.html#o5">cxMenu</a>, localMenu.<a class="code" href="../../d1/d1/structtagMENU.html#o6">cyMenu</a>);
05628         Print(<span class="stringliteral">"%s     spwndNotify....... 0x%p\n"</span>
05629               <span class="stringliteral">"%s     dwContextHelpId... 0x%08lX\n"</span>
05630               <span class="stringliteral">"%s     items............. %lu items in block of %lu\n"</span>,
05631               szIndent, localMenu.<a class="code" href="../../d1/d1/structtagMENU.html#o8">spwndNotify</a>,
05632               szIndent, localMenu.<a class="code" href="../../d1/d1/structtagMENU.html#o10">dwContextHelpId</a>,
05633               szIndent, localMenu.<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>, localMenu.<a class="code" href="../../d1/d1/structtagMENU.html#o3">cAlloced</a>);
05634     }
05635 
05636     lpdw = (LPDWORD)(((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pMenu) + FIELD_OFFSET(<a class="code" href="../../d1/d1/structtagMENU.html">MENU</a>, rgItems));
05637     <span class="keywordflow">if</span> (tryMove(localDW, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(lpdw))) {
05638         pitem = (<a class="code" href="../../d0/d9/structtagITEM.html">PITEM</a>)localDW;
05639         i = 0;
05640         SAFEWHILE (i &lt; localMenu.<a class="code" href="../../d1/d1/structtagMENU.html#o4">cItems</a>) {
05641             <span class="comment">/*</span>
05642 <span class="comment">             * Get the menu item</span>
05643 <span class="comment">             */</span>
05644             <span class="keywordflow">if</span> (tryMove(localItem, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(pitem))) {
05645                 <span class="keywordflow">if</span> (!(opts &amp; OFLAG(i))) {
05646                     <span class="comment">/*</span>
05647 <span class="comment">                     * Print the info for this item.</span>
05648 <span class="comment">                     */</span>
05649                     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(v))) {
05650                         Print(<span class="stringliteral">"0x%p      %s%lu: ID=0x%08lX hbmp=0x%08lX"</span>, pitem, szIndent, i, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o2">wID</a>, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o16">hbmp</a>);
05651                         <span class="keywordflow">if</span> (localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a> &amp;&amp; tryMoveBlock(szBufW, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a>), (localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a>*<span class="keyword">sizeof</span>(WCHAR)))) {
05652                             szBufW[localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a>] = 0;
05653                             Print(<span class="stringliteral">"  %ws%\n"</span>, szBufW);
05654                         } <span class="keywordflow">else</span> {
05655                             Print(<span class="stringliteral">", fType=%s"</span>,<a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_MENUTYPE, (WORD)localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o0">fType</a>, NULL, TRUE));
05656                             <span class="keywordflow">if</span> (! (localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o0">fType</a> &amp; MF_SEPARATOR)) {
05657                                  Print(<span class="stringliteral">", lpstr=0x%p"</span>, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a>);
05658                             }
05659                             Print(<span class="stringliteral">"\n"</span>);
05660                         }
05661                     } <span class="keywordflow">else</span> {
05662                         Print(<span class="stringliteral">"%s   Item #%d @0x%p:\n"</span>, szIndent, i, pitem);
05663                         <span class="comment">/*</span>
05664 <span class="comment">                         * Print the details for this item.</span>
05665 <span class="comment">                         */</span>
05666                         Print(<span class="stringliteral">"%s         ID........... 0x%08lX (%lu)\n"</span>
05667                               <span class="stringliteral">"%s         lpstr.... 0x%p"</span>,
05668                               szIndent, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o2">wID</a>, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o2">wID</a>,
05669                               szIndent, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a>);
05670                         <span class="keywordflow">if</span> (localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a> &amp;&amp; tryMoveBlock(szBufW, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o6">lpstr</a>), (localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a>*<span class="keyword">sizeof</span>(WCHAR)))) {
05671                             szBufW[localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o7">cch</a>] = 0;
05672                             Print(<span class="stringliteral">"  %ws%\n"</span>, szBufW);
05673                         } <span class="keywordflow">else</span> {
05674                             Print(<span class="stringliteral">"\n"</span>);
05675                         }
05676                         Print(<span class="stringliteral">"%s         fType........ %s\n"</span>
05677                               <span class="stringliteral">"%s         fState....... %s\n"</span>
05678                               <span class="stringliteral">"%s         dwItemData... 0x%p\n"</span>,
05679                               szIndent, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_MENUTYPE, (WORD)localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o0">fType</a>, NULL, TRUE),
05680                               szIndent, <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_MENUSTATE, (WORD)localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o1">fState</a>, NULL, TRUE),
05681                               szIndent, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o8">dwItemData</a>);
05682                         Print(<span class="stringliteral">"%s         checks....... on=0x%08lX, off=0x%08lX\n"</span>
05683                               <span class="stringliteral">"%s         location..... @(%lu,%lu) size=(%lu,%lu)\n"</span>,
05684                               szIndent, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o4">hbmpChecked</a>, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o5">hbmpUnchecked</a>,
05685                               szIndent, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o9">xItem</a>, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o10">yItem</a>, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o11">cxItem</a>, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o12">cyItem</a>);
05686                         Print(<span class="stringliteral">"%s         underline.... x=%lu, width=%lu\n"</span>
05687                               <span class="stringliteral">"%s         dxTab........ %lu\n"</span>
05688                               <span class="stringliteral">"%s         spSubMenu.... 0x%p\n"</span>,
05689                               szIndent, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o14">ulX</a>, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o15">ulWidth</a>,
05690                               szIndent, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o13">dxTab</a>,
05691                               szIndent, localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a>);
05692                     }
05693                 }
05694 
05695                 <span class="comment">/*</span>
05696 <span class="comment">                 * If requested, traverse through sub-menus</span>
05697 <span class="comment">                 */</span>
05698                 <span class="keywordflow">if</span> (opts &amp; OFLAG(r)) {
05699                     pMenu = <a class="code" href="../../d2/d1/userexts_8c.html#a197">HorPtoP</a>(localItem.<a class="code" href="../../d0/d9/structtagITEM.html#o3">spSubMenu</a>, TYPE_MENU);
05700                     <span class="keywordflow">if</span> (pMenu &amp;&amp; tryMove(localMenu, pMenu)) {
05701                         <a class="code" href="../../d2/d1/userexts_8c.html#a220">DumpMenu</a>(uIndent+8, opts, pMenu);
05702                     }
05703                 }
05704             }
05705             pitem++;
05706             i++;
05707         }
05708     }
05709 }
05710 
05711 
05712 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a221">Idm</a>(
05713     DWORD opts,
05714     PVOID param1)
05715 {
05716     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he;
05717     PVOID pvObject;
05718 
05719     <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
05720         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05721 
05722     pvObject = <a class="code" href="../../d2/d1/userexts_8c.html#a197">HorPtoP</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1), -1);
05723     <span class="keywordflow">if</span> (pvObject == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05724         Print(<span class="stringliteral">"dm: Could not convert 0x%p to an object.\n"</span>, pvObject);
05725         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05726     }
05727 
05728     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/userexts_8c.html#a196">getHEfromP</a>(NULL, &amp;he, pvObject)) {
05729         Print(<span class="stringliteral">"dm: Could not get header for object 0x%p.\n"</span>, pvObject);
05730         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05731     }
05732 
05733     <span class="keywordflow">switch</span> (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>) {
05734     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a237">TYPE_WINDOW</a>:
05735         {
05736             <a class="code" href="../../d6/d9/structtagWND.html">WND</a> wnd;
05737 
05738             Print(<span class="stringliteral">"--- Dump Menu for %s object @0x%p ---\n"</span>, pszObjStr[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>], <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(pvObject));
05739             <span class="keywordflow">if</span> (!tryMove(wnd, pvObject)) {
05740                 Print(<span class="stringliteral">"dm: Could not get copy of object 0x%p.\n"</span>, pvObject);
05741                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05742             }
05743 
05744             <span class="keywordflow">if</span> (opts &amp; OFLAG(s)) {
05745                 <span class="comment">/*</span>
05746 <span class="comment">                 * Display window's system menu</span>
05747 <span class="comment">                 */</span>
05748                 <span class="keywordflow">if</span> ((pvObject = <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05749                     Print(<span class="stringliteral">"dm: This window does not have a system menu.\n"</span>);
05750                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05751                 }
05752 
05753             } <span class="keywordflow">else</span> {
05754                 <span class="keywordflow">if</span> (wnd.style &amp; WS_CHILD) {
05755                     <span class="comment">/*</span>
05756 <span class="comment">                     * Child windows don't have menus</span>
05757 <span class="comment">                     */</span>
05758                     Print(<span class="stringliteral">"dm: Child windows do not have menus.\n"</span>);
05759                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05760                 }
05761 
05762                 <span class="keywordflow">if</span> ((pvObject = <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05763                     Print(<span class="stringliteral">"dm: This window does not have a menu.\n"</span>);
05764                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05765                 }
05766             }
05767         }
05768 
05769         <span class="comment">/* &gt;&gt;&gt;&gt;  F A L L   T H R O U G H   &lt;&lt;&lt;&lt; */</span>
05770 
<a name="l05771"></a><a class="code" href="../../d2/d1/userexts_8c.html#a217">05771</a>     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a238">TYPE_MENU</a>:
05772         <a class="code" href="../../d2/d1/userexts_8c.html#a220">DumpMenu</a>(0, opts, (<a class="code" href="../../d1/d1/structtagMENU.html">PMENU</a>)pvObject);
05773         <span class="keywordflow">break</span>;
05774 
05775     <span class="keywordflow">default</span>:
05776         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05777     }
05778 
05779     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05780 }
05781 
05782 
05783 
05784 
05785 
05786 <span class="preprocessor">#ifdef KERNEL</span>
05787 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
05788 <span class="comment">* dmq - dump messages on queue</span>
05789 <span class="comment">*</span>
05790 <span class="comment">* dmq address - dumps messages in queue structure at address.</span>
05791 <span class="comment">* dmq -a      - dump messages for all queues</span>
05792 <span class="comment">* dmq -c      - count messages for all queues</span>
05793 <span class="comment">*</span>
05794 <span class="comment">* 11-13-91 DavidPe      Created.</span>
05795 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
05796 <span class="comment">\***************************************************************************/</span>
05797 
05798 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idmq(
05799 DWORD opts,
05800 PVOID param1)
05801 {
05802     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">THREADINFO</a> ti;
05803     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
05804     <a class="code" href="../../d7/d4/structtagQ.html">Q</a> q;
05805     <span class="keyword">static</span> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwPosted;
05806     <span class="keyword">static</span> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwInput;
05807     <span class="keyword">static</span> <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwQueues, dwThreads;
05808     <span class="keyword">static</span> <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiStatic;
05809     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bMsgsPresent = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05810 
05811     <span class="keywordflow">if</span> (opts &amp; OFLAG(c)) {
05812         <span class="keywordflow">if</span> (param1 == 0) {
05813             Print(<span class="stringliteral">"Summary of all message queues (\"age\" is newest time - oldest time)\n"</span>);
05814         } <span class="keywordflow">else</span> {
05815             Print(<span class="stringliteral">"Summary of message queue (\"age\" is newest time - oldest time)\n"</span>);
05816         }
05817         Print(<span class="stringliteral">"Queue      # Input    age   \t Thread  # Posted    age\n"</span>);
05818         Print(<span class="stringliteral">"========  ========  ========\t======== ========  ========\n"</span>);
05819         dwInput = dwPosted = 0;
05820         dwThreads = dwQueues = 0;
05821     }
05822 
05823     <span class="keywordflow">if</span> (param1 == 0) {
05824         <span class="keywordflow">if</span> ((opts &amp; OFLAG(a)) || (opts &amp; OFLAG(c))) {
05825 
05826             FOREACHPTI(ptiStatic);
05827                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pq, &amp;ptiStatic-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>);
05828                 <span class="keywordflow">if</span> (pq == 0) {
05829                     Print(<span class="stringliteral">"Thread %lx has no queue\n"</span>, ptiStatic);
05830                 } <span class="keywordflow">else</span> {
05831                     Idmq(opts &amp; OFLAG(c), pq);
05832                 }
05833                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pq, &amp;ptiStatic-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o28">pqAttach</a>);
05834                 <span class="keywordflow">if</span> (pq) {
05835                     Print(<span class="stringliteral">"-&gt;"</span>);
05836                     Idmq(opts &amp; OFLAG(c), pq);
05837                 }
05838                 dwThreads++;
05839             NEXTEACHPTI(ptiStatic);
05840 
05841             <span class="keywordflow">if</span> (opts &amp; OFLAG(c)) {
05842                 Print(<span class="stringliteral">"Queues     # Input          \t Threads # Posted\n"</span>);
05843                 Print(<span class="stringliteral">"========  ========  ========\t======== ========\n"</span>);
05844                 Print(<span class="stringliteral">"%8x  %8x          \t%8x %8x\n"</span>,
05845                       dwQueues, dwPosted, dwThreads, dwPosted);
05846             }
05847             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05848         }
05849     }
05850 
05851     pq = (<a class="code" href="../../d7/d4/structtagQ.html">PQ</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
05852     <span class="keywordflow">if</span> (!tryMove(q, pq)) {
05853         <span class="keywordflow">if</span> ((opts &amp; OFLAG(c)) == 0) {
05854             Print(<span class="stringliteral">"* Cannot get queue 0x%p: (skipped)\n"</span>, pq);
05855             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
05856         } <span class="keywordflow">else</span> {
05857             Print(<span class="stringliteral">"%lx - cannot get queue \t%lx"</span>, pq, ptiStatic);
05858             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ti, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>));
05859             <span class="keywordflow">goto</span> ShowThreadCount;
05860         }
05861     }
05862     <span class="keywordflow">if</span> ((opts &amp; OFLAG(c)) == 0) {
05863         Print(<span class="stringliteral">"Messages for queue 0x%p\n"</span>, pq);
05864     }
05865 
05866     <span class="keywordflow">if</span> ((q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a> == ptiStatic) || (q.<a class="code" href="../../d7/d4/structtagQ.html#o4">ptiMouse</a> == ptiStatic)) {
05867         dwQueues++;
05868     }
05869 
05870     <span class="keywordflow">if</span> (q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05871         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ti, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>));
05872 
05873         <span class="keywordflow">if</span> (!(opts &amp; OFLAG(c)) &amp;&amp; ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o0">pqmsgRead</a>) {
05874             bMsgsPresent = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05875             Print(<span class="stringliteral">"==== PostMessage queue ====\n"</span>);
05876             <span class="keywordflow">if</span> (ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o0">pqmsgRead</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05877                 PrintMessages(<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o0">pqmsgRead</a>));
05878             }
05879         }
05880     }
05881 
05882     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(c)) &amp;&amp; q.<a class="code" href="../../d7/d4/structtagQ.html#o0">mlInput</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o0">pqmsgRead</a>) {
05883         bMsgsPresent = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05884         Print(    <span class="stringliteral">"==== Input queue ==========\n"</span>);
05885         <span class="keywordflow">if</span> (q.<a class="code" href="../../d7/d4/structtagQ.html#o0">mlInput</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o0">pqmsgRead</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05886             PrintMessages(<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(q.<a class="code" href="../../d7/d4/structtagQ.html#o0">mlInput</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o0">pqmsgRead</a>));
05887         }
05888     }
05889 
05890     <span class="keywordflow">if</span> (opts &amp; OFLAG(c)) {
05891         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwTimePosted;
05892         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwTimeInput = 0;
05893         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOldest, dwNewest;
05894 
05895         <span class="keywordflow">if</span> (q.<a class="code" href="../../d7/d4/structtagQ.html#o0">mlInput</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o2">cMsgs</a>) {
05896             dwInput += q.<a class="code" href="../../d7/d4/structtagQ.html#o0">mlInput</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o2">cMsgs</a>;
05897             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dwOldest, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(&amp;q.<a class="code" href="../../d7/d4/structtagQ.html#o0">mlInput</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o0">pqmsgRead</a>-&gt;<a class="code" href="../../d8/d4/structtagQMSG.html#o2">msg</a>.time));
05898             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dwNewest, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(&amp;q.<a class="code" href="../../d7/d4/structtagQ.html#o0">mlInput</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o1">pqmsgWriteLast</a>-&gt;<a class="code" href="../../d8/d4/structtagQMSG.html#o2">msg</a>.time));
05899             dwTimeInput = dwNewest - dwOldest;
05900         }
05901         Print(<span class="stringliteral">"%08x%c %8x  %8x\t%08x"</span>,
05902               pq,
05903               ((q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a> != ptiStatic) &amp;&amp; (q.<a class="code" href="../../d7/d4/structtagQ.html#o4">ptiMouse</a> != ptiStatic)) ? <span class="charliteral">'*'</span> : <span class="charliteral">' '</span>,
05904               q.<a class="code" href="../../d7/d4/structtagQ.html#o0">mlInput</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o2">cMsgs</a>, dwTimeInput,
05905               q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>);
05906         <span class="comment">// it would be good to print the ptiStatic too, maybe like this:</span>
05907         <span class="comment">// e1b978a8         0         0    e1ba3368        0         0</span>
05908         <span class="comment">// e1b9aca8*        0         0    e1b8b2e8        0         0</span>
05909         <span class="comment">//   (thread who's queue this is : e1a3ca28        0         0)</span>
05910         <span class="comment">//</span>
05911 ShowThreadCount:
05912         dwTimePosted = 0;
05913         <span class="keywordflow">if</span> (ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o2">cMsgs</a>) {
05914             dwPosted += ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o2">cMsgs</a>;
05915             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dwOldest, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(&amp;ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o0">pqmsgRead</a>-&gt;<a class="code" href="../../d8/d4/structtagQMSG.html#o2">msg</a>.time));
05916             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dwNewest, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(&amp;ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o1">pqmsgWriteLast</a>-&gt;<a class="code" href="../../d8/d4/structtagQMSG.html#o2">msg</a>.time));
05917             dwTimePosted = dwNewest - dwOldest;
05918         }
05919         Print(<span class="stringliteral">" %8x  %8x\n"</span>, ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o2">cMsgs</a>, dwTimePosted);
05920     } <span class="keywordflow">else</span> {
05921         <span class="keywordflow">if</span> (bMsgsPresent) {
05922             Print(<span class="stringliteral">"\n"</span>);
05923         }
05924     }
05925 
05926     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05927 }
05928 <span class="preprocessor">#endif KERNEL</span>
05929 <span class="preprocessor"></span>
05930 
05931 
05932 
05933 <span class="preprocessor">#ifdef KERNEL</span>
05934 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
05935 <span class="comment">* dwe - dump winevents</span>
05936 <span class="comment">*</span>
05937 <span class="comment">* dwe           - dumps all EVENTHOOKs.</span>
05938 <span class="comment">* dwe &lt;addr&gt;    - dumps EVENTHOOK at address.</span>
05939 <span class="comment">* dwe -n        - dumps all NOTIFYs.</span>
05940 <span class="comment">* dwe -n &lt;addr&gt; - dumps NOTIFY at address.</span>
05941 <span class="comment">*</span>
05942 <span class="comment">* 1997-07-10 IanJa      Created.</span>
05943 <span class="comment">\***************************************************************************/</span>
05944 
05945 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idwe(
05946 DWORD opts,
05947 PVOID param1)
05948 {
05949     <a class="code" href="../../d8/d4/structtagEVENTHOOK.html">EVENTHOOK</a> EventHook, *pEventHook;
05950     <a class="code" href="../../d9/d2/structtagNOTIFY.html">NOTIFY</a> Notify, *pNotify;
05951     PVOID pobj;
05952     <span class="keywordtype">char</span> ach[100];
05953 
05954     pobj = <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
05955 
05956     <span class="keywordflow">if</span> (opts &amp; OFLAG(n)) {
05957         <span class="keywordflow">if</span> (pobj) {
05958             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Notify, pobj);
05959             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"NOTIFY 0x%p\n"</span>, pobj);
05960             <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
05961             <span class="keywordflow">return</span> 1;
05962         }
05963         moveExpValuePtr(&amp;pNotify, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpPendingNotifies));
05964         Print(<span class="stringliteral">"Pending Notifications:\n"</span>);
05965         <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> += 2;
05966         SAFEWHILE (pNotify != NULL) {
05967             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"NOTIFY  0x%p\n"</span>, pNotify);
05968             <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
05969             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pNotify, &amp;pNotify-&gt;<a class="code" href="../../d9/d2/structtagNOTIFY.html#o0">pNotifyNext</a>);
05970         }
05971         <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> -= 2;
05972         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05973     }
05974 
05975     <span class="keywordflow">if</span> (pobj) {
05976         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(EventHook, pobj);
05977         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"EVENTHOOK 0x%p\n"</span>, pobj);
05978         <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
05979         <span class="keywordflow">return</span> 1;
05980     }
05981     moveExpValuePtr(&amp;pEventHook, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpWinEventHooks));
05982     Print(<span class="stringliteral">"WinEvent hooks:\n"</span>);
05983     <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> += 2;
05984     SAFEWHILE (pEventHook != NULL) {
05985         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"EVENTHOOK  0x%p\n"</span>, pEventHook);
05986         <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
05987         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pEventHook, &amp;pEventHook-&gt;<a class="code" href="../../d8/d4/structtagEVENTHOOK.html#o1">pehNext</a>);
05988     }
05989     <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> -= 2;
05990     Print(<span class="stringliteral">"\n"</span>);
05991     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
05992 }
05993 <span class="preprocessor">#endif KERNEL</span>
05994 <span class="preprocessor"></span>
05995 
05996 
05997 <span class="preprocessor">#ifndef KERNEL</span>
05998 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
05999 <span class="comment">* Procedure: Idped</span>
06000 <span class="comment">*</span>
06001 <span class="comment">* Description: Dumps Edit Control Structures (PEDs)</span>
06002 <span class="comment">*</span>
06003 <span class="comment">* Returns: fSuccess</span>
06004 <span class="comment">*</span>
06005 <span class="comment">* 6/9/1995 Created SanfordS</span>
06006 <span class="comment">*</span>
06007 <span class="comment">\************************************************************************/</span>
06008 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a222">Idped</a>(
06009     DWORD opts,
06010     PVOID param1)
06011 {
06012     <a class="code" href="../../d3/d4/structtagED.html">PED</a>   ped;
06013     <a class="code" href="../../d3/d4/structtagED.html">ED</a>    ed;
06014     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> pText;
06015 
06016     UNREFERENCED_PARAMETER(opts);
06017 
06018     ped = param1;
06019 
06020     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ed, ped);
06021     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pText, ed.<a class="code" href="../../d3/d4/structtagED.html#o0">hText</a>);
06022 
06023 
06024     Print(<span class="stringliteral">"PED Handle: %lX\n"</span>, ped);
06025     Print(<span class="stringliteral">"hText      %lX (%lX)\n"</span>, ed.<a class="code" href="../../d3/d4/structtagED.html#o0">hText</a>, pText);
06026     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., cchAlloc, cchTextMax);
06027     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., cch, cLines);
06028     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., ichMinSel, ichMaxSel);
06029     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., ichCaret, iCaretLine);
06030     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., ichScreenStart, ichLinesOnScreen);
06031     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., xOffset, charPasswordChar);
06032     <a class="code" href="../../d2/d1/userexts_8c.html#a28">PRTFDWDWP</a>(ed., cPasswordCharWidth, hwnd);
06033     <a class="code" href="../../d2/d1/userexts_8c.html#a25">PRTFDWP1</a>(ed., pwnd);
06034     <a class="code" href="../../d2/d1/userexts_8c.html#a22">PRTFRC</a>(ed., rcFmt);
06035     <a class="code" href="../../d2/d1/userexts_8c.html#a25">PRTFDWP1</a>(ed., hwndParent);
06036     <a class="code" href="../../d2/d1/userexts_8c.html#a23">PRTFPT</a>(ed., ptPrevMouse);
06037     <a class="code" href="../../d2/d1/userexts_8c.html#a18">PRTFDW1</a>(ed., prevKeys);
06038 
06039     <a class="code" href="../../d2/d1/userexts_8c.html#a29">BEGIN_PRTFFLG</a>();
06040     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fSingle);
06041     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fNoRedraw);
06042     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fMouseDown);
06043     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fFocus);
06044     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fDirty);
06045     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fDisabled);
06046     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fNonPropFont);
06047     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fNonPropDBCS);
06048     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fBorder);
06049     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fAutoVScroll);
06050     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fAutoHScroll);
06051     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fNoHideSel);
06052     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fDBCS);
06053     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fFmtLines);
06054     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fWrap);
06055     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fCalcLines);
06056     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fEatNextChar);
06057     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fStripCRCRLF);
06058     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fInDialogBox);
06059     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fReadOnly);
06060     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fCaretHidden);
06061     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fTrueType);
06062     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fAnsi);
06063     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fWin31Compat);
06064     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, f40Compat);
06065     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fFlatBorder);
06066     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fSawRButtonDown);
06067     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fInitialized);
06068     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fSwapRoOnUp);
06069     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fAllowRTL);
06070     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fDisplayCtrl);
06071     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fRtoLReading);
06072     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fInsertCompChr);
06073     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fReplaceCompChr);
06074     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fNoMoveCaret);
06075     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fResultProcess);
06076     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fKorea);
06077     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(ed, fInReconversion);
06078     <a class="code" href="../../d2/d1/userexts_8c.html#a31">END_PRTFFLG</a>();
06079 
06080     <a class="code" href="../../d2/d1/userexts_8c.html#a28">PRTFDWDWP</a>(ed., cbChar, chLines);
06081     <a class="code" href="../../d2/d1/userexts_8c.html#a28">PRTFDWDWP</a>(ed., format, lpfnNextWord);
06082     <a class="code" href="../../d2/d1/userexts_8c.html#a18">PRTFDW1</a>(ed., maxPixelWidth);
06083 
06084     {
06085         <span class="keyword">const</span> <span class="keywordtype">char</span>* p = <span class="stringliteral">"**INVALID**"</span>;
06086 
06087         <span class="keywordflow">if</span> (ed.undoType &lt; <a class="code" href="../../d6/d0/usercli_8h.html#a84">UNDO_DELETE</a>) {
06088             p = <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_EDUNDO, 0, NULL, TRUE);
06089         }
06090         Print(DWSTR2 <span class="stringliteral">"\t"</span> <span class="stringliteral">"%08x undoType (%s)\n"</span>, ed.hDeletedText, <span class="stringliteral">"hDeleteText"</span>, ed.undoType, p);
06091     }
06092 
06093     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., ichDeleted, cchDeleted);
06094     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., ichInsStart, ichInsEnd);
06095 
06096     <a class="code" href="../../d2/d1/userexts_8c.html#a27">PRTFDWPDW</a>(ed., hFont, aveCharWidth);
06097     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., lineHeight, charOverhang);
06098     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., cxSysCharWidth, cySysCharHeight);
06099     <a class="code" href="../../d2/d1/userexts_8c.html#a26">PRTFDWP2</a>(ed., listboxHwnd, pTabStops);
06100     <a class="code" href="../../d2/d1/userexts_8c.html#a25">PRTFDWP1</a>(ed., charWidthBuffer);
06101 <span class="comment">//    PRTFDW2(ed., hkl, wMaxNegA);</span>
06102     <a class="code" href="../../d2/d1/userexts_8c.html#a18">PRTFDW1</a>(ed., wMaxNegA);
06103     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., wMaxNegAcharPos, wMaxNegC);
06104     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., wMaxNegCcharPos, wLeftMargin);
06105     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., wRightMargin, ichStartMinSel);
06106     <a class="code" href="../../d2/d1/userexts_8c.html#a28">PRTFDWDWP</a>(ed., ichStartMaxSel, pLpkEditCallout);
06107     <a class="code" href="../../d2/d1/userexts_8c.html#a26">PRTFDWP2</a>(ed., hCaretBitmap, hInstance);
06108     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., seed, fEncoded);
06109     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(ed., iLockLevel, wImeStatus);
06110     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06111 }
06112 <span class="preprocessor">#endif // !KERNEL</span>
06113 <span class="preprocessor"></span>
06114 
06115 <span class="preprocessor">#ifndef KERNEL</span>
06116 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
06117 <span class="comment">* Procedure: Idci</span>
06118 <span class="comment">*</span>
06119 <span class="comment">* Description: Dumps Client Info</span>
06120 <span class="comment">*</span>
06121 <span class="comment">* Returns: fSuccess</span>
06122 <span class="comment">*</span>
06123 <span class="comment">* 6/15/1995 Created SanfordS</span>
06124 <span class="comment">*</span>
06125 <span class="comment">\************************************************************************/</span>
06126 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a223">Idci</a>()
06127 {
06128     TEB teb, *pteb;
06129     <a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a> pci;
06130 
06131     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a190">GetTargetTEB</a>(&amp;teb, &amp;pteb)) {
06132         pci = (<a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a>)&amp;teb.Win32ClientInfo[0];
06133 
06134         Print(<span class="stringliteral">"PCLIENTINFO @ %p:\n"</span>, &amp;pteb-&gt;Win32ClientInfo[0]);
06135         <span class="comment">// DWORD dwExpWinVer;</span>
06136         Print(<span class="stringliteral">"\tdwExpWinVer            %08lx\n"</span>, pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o2">dwExpWinVer</a>);
06137         <span class="comment">// DWORD dwCompatFlags;</span>
06138         Print(<span class="stringliteral">"\tdwCompatFlags          %08lx\n"</span>, pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o3">dwCompatFlags</a>);
06139         <span class="comment">// DWORD dwTIFlags;</span>
06140         Print(<span class="stringliteral">"\tdwTIFlags              %08lx\n"</span>, pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o4">dwTIFlags</a>);
06141         <span class="comment">// PDESKTOPINFO pDeskInfo;</span>
06142         Print(<span class="stringliteral">"\tpDeskInfo              %p\n"</span>, pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o5">pDeskInfo</a>);
06143         <span class="comment">// ULONG ulClientDelta;</span>
06144         Print(<span class="stringliteral">"\tulClientDelta          %p\n"</span>, pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o6">ulClientDelta</a>);
06145         <span class="comment">// struct tagHOOK *phkCurrent;</span>
06146         Print(<span class="stringliteral">"\tphkCurrent             %p\n"</span>, pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o7">phkCurrent</a>);
06147         <span class="comment">// DWORD fsHooks;</span>
06148         Print(<span class="stringliteral">"\tfsHooks                %08lx\n"</span>, pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o8">fsHooks</a>);
06149         <span class="comment">// CALLBACKWND CallbackWnd;</span>
06150         Print(<span class="stringliteral">"\tCallbackWnd            %08lx\n"</span>, pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o9">CallbackWnd</a>);
06151         <span class="comment">// DWORD cSpins;</span>
06152         Print(<span class="stringliteral">"\tcSpins                 %08lx\n"</span>, pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o1">cSpins</a>);
06153         Print(<span class="stringliteral">"\tCodePage               %d\n"</span>,    pci-&gt;<a class="code" href="../../d2/d2/struct__CLIENTINFO.html#o20">CodePage</a>);
06154 
06155     } <span class="keywordflow">else</span> {
06156         Print(<span class="stringliteral">"Unable to get TEB info.\n"</span>);
06157     }
06158     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06159 }
06160 <span class="preprocessor">#endif // !KERNEL</span>
06161 <span class="preprocessor"></span>
06162 
06163 
06164 <span class="preprocessor">#ifdef KERNEL</span>
06165 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
06166 <span class="comment">* Procedure: Idpi</span>
06167 <span class="comment">*</span>
06168 <span class="comment">* Description: Dumps ProcessInfo structs</span>
06169 <span class="comment">*</span>
06170 <span class="comment">* Returns: fSuccess</span>
06171 <span class="comment">*</span>
06172 <span class="comment">* 6/9/1995 Created SanfordS</span>
06173 <span class="comment">*</span>
06174 <span class="comment">\************************************************************************/</span>
06175 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idpi(
06176 DWORD opts,
06177 PVOID param1)
06178 {
06179     PW32PROCESS pW32Process;
06180     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a> ppi;
06181     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PROCESSINFO</a> pi;
06182     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a> si;
06183     <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">SHAREDINFO</a> shi;
06184     <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">PSHAREDINFO</a> pshi;
06185     <a class="code" href="../../d2/d3/structtagDESKTOPVIEW.html">DESKTOPVIEW</a> dv;
06186     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idProcess;
06187 
06188     <span class="comment">/*</span>
06189 <span class="comment">     * If he just wants the current process, located it.</span>
06190 <span class="comment">     */</span>
06191     <span class="keywordflow">if</span> (opts &amp; OFLAG(c)) {
06192         Print(<span class="stringliteral">"Current Process:\n"</span>);
06193         param1 = (PVOID)GetCurrentProcessAddress(
06194                 (USHORT)dwProcessor, hCurrentThread, NULL );
06195 
06196         <span class="keywordflow">if</span> (param1 == 0) {
06197             Print(<span class="stringliteral">"Unable to get current process pointer.\n"</span>);
06198             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
06199         }
06200 
06201         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(param1, PROCESS_WIN32PROCESS, &amp;pW32Process) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
06202             Print(<span class="stringliteral">"Unable to read _EPROCESS at %lx\n"</span>, param1);
06203             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
06204         }
06205         param1 = pW32Process;
06206     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (param1 == 0) {
06207         Print(<span class="stringliteral">"**** NT ACTIVE WIN32 PROCESSINFO DUMP ****\n"</span>);
06208         FOREACHPPI(ppi)
06209             Idpi(0, ppi);
06210             Print("\n");
06211         NEXTEACHPPI()
06212         return TRUE;
06213     }
06214 
06215     ppi = FIXKP(param1);
06216 
06217     if (!tryMove(pi, ppi)) {
06218         Print(<span class="stringliteral">"Can't get PROCESSINFO from %x.\n"</span>, ppi);
06219         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
06220     }
06221 
06222     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(pi.Process, PROCESS_PROCESSID, &amp;idProcess) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
06223         Print(<span class="stringliteral">"Unable to read _EPROCESS at %lx\n"</span>,pi.Process);
06224         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
06225     }
06226 
06227     Print(<span class="stringliteral">"---PPROCESSINFO @ 0x%p for process %x(%s):\n"</span>,
06228             ppi,
06229             idProcess,
06230             <a class="code" href="../../d7/d7/uclient_8c.html#a2">ProcessName</a>(ppi));
06231     Print(<span class="stringliteral">"\tppiNext           @0x%p\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o7">ppiNext</a>);
06232     Print(<span class="stringliteral">"\trpwinsta          @0x%p\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o14">rpwinsta</a>);
06233     Print(<span class="stringliteral">"\thwinsta            0x%08lx\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o15">hwinsta</a>);
06234     Print(<span class="stringliteral">"\tamwinsta           0x%08lx\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o16">amwinsta</a>);
06235     Print(<span class="stringliteral">"\tptiMainThread     @0x%p\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o2">ptiMainThread</a>);
06236     Print(<span class="stringliteral">"\tcThreads           0x%08lx\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o9">cThreads</a>);
06237     Print(<span class="stringliteral">"\trpdeskStartup     @0x%p\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o3">rpdeskStartup</a>);
06238     Print(<span class="stringliteral">"\thdeskStartup       0x%08lx\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o10">hdeskStartup</a>);
06239     Print(<span class="stringliteral">"\tpclsPrivateList   @0x%p\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o4">pclsPrivateList</a>);
06240     Print(<span class="stringliteral">"\tpclsPublicList    @0x%p\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o5">pclsPublicList</a>);
06241     Print(<span class="stringliteral">"\tflags              %s\n"</span>,
06242             <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_W32PF, pi.W32PF_Flags, NULL, TRUE));
06243     Print(<span class="stringliteral">"\tdwHotkey           0x%08lx\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o17">dwHotkey</a>);
06244     Print(<span class="stringliteral">"\tpWowProcessInfo   @0x%p\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o6">pwpi</a>);
06245     Print(<span class="stringliteral">"\tluidSession        0x%08lx:0x%08lx\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o27">luidSession</a>.HighPart,
06246             pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o27">luidSession</a>.LowPart);
06247     Print(<span class="stringliteral">"\tdwX,dwY            (0x%x,0x%x)\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o1">dwX</a>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o2">dwY</a>);
06248     Print(<span class="stringliteral">"\tdwXSize,dwYSize    (0x%x,0x%x)\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o3">dwXSize</a>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o4">dwYSize</a>);
06249     Print(<span class="stringliteral">"\tdwFlags            0x%08x\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o5">dwFlags</a>);
06250     Print(<span class="stringliteral">"\twShowWindow        0x%04x\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o28">usi</a>.<a class="code" href="../../d0/d9/structtagUSERSTARTUPINFO.html#o6">wShowWindow</a>);
06251     Print(<span class="stringliteral">"\tpCursorCache       0x%08x\n"</span>, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o22">pCursorCache</a>);
06252     Print(<span class="stringliteral">"\tdwLpkEntryPoints   %s\n"</span>,
06253             <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_LPK, pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o24">dwLpkEntryPoints</a>, NULL, TRUE));
06254 
06255     <span class="comment">/*</span>
06256 <span class="comment">     * List desktop views</span>
06257 <span class="comment">     */</span>
06258     dv.<a class="code" href="../../d2/d3/structtagDESKTOPVIEW.html#o0">pdvNext</a> = pi.<a class="code" href="../../d7/d3/structtagPROCESSINFO.html#o19">pdvList</a>;
06259     Print(<span class="stringliteral">"Desktop views:\n"</span>);
06260     <span class="keywordflow">while</span> (dv.<a class="code" href="../../d2/d3/structtagDESKTOPVIEW.html#o0">pdvNext</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
06261         <span class="keywordflow">if</span> (!tryMove(dv, dv.<a class="code" href="../../d2/d3/structtagDESKTOPVIEW.html#o0">pdvNext</a>))
06262             <span class="keywordflow">break</span>;
06263         Print(<span class="stringliteral">"\tpdesk = %08x, ulClientDelta = %08x\n"</span>, dv.<a class="code" href="../../d2/d3/structtagDESKTOPVIEW.html#o1">pdesk</a>, dv.<a class="code" href="../../d2/d3/structtagDESKTOPVIEW.html#o2">ulClientDelta</a>);
06264     }
06265 
06266     <span class="comment">/*</span>
06267 <span class="comment">     * List all the open objects for this process.</span>
06268 <span class="comment">     */</span>
06269     <a class="code" href="../../d2/d1/userexts_8c.html#a7">GETSHAREDINFO</a>(pshi);
06270     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(shi, pshi);
06271     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(si, shi.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o0">psi</a>);
06272 
06273     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06274 }
06275 <span class="preprocessor">#endif // KERNEL</span>
06276 <span class="preprocessor"></span>
06277 
06278 
06279 <span class="preprocessor">#ifdef KERNEL</span>
06280 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
06281 <span class="comment">* dpm - dump popupmenu</span>
06282 <span class="comment">*</span>
06283 <span class="comment">* dpm address    - dumps menu info for menu at address</span>
06284 <span class="comment">*                 (takes handle too)</span>
06285 <span class="comment">*</span>
06286 <span class="comment">* 13-Feb-1995  johnc      Created.</span>
06287 <span class="comment">* 6/9/1995 SanfordS made to fit stdexts motif</span>
06288 <span class="comment">\***************************************************************************/</span>
06289 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idpm(
06290 DWORD opts,
06291 PVOID param1)
06292 {
06293 
06294     <a class="code" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a> ppopupmenu;
06295     <a class="code" href="../../d4/d3/structtagPOPUPMENU.html">POPUPMENU</a> localPopupMenu;
06296 
06297     UNREFERENCED_PARAMETER(opts);
06298 
06299     ppopupmenu = (<a class="code" href="../../d4/d3/structtagPOPUPMENU.html">PPOPUPMENU</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
06300     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(localPopupMenu, ppopupmenu);
06301 
06302     Print(<span class="stringliteral">"PPOPUPMENU @ 0x%lX\n"</span>, ppopupmenu);
06303 
06304     <a class="code" href="../../d2/d1/userexts_8c.html#a29">BEGIN_PRTFFLG</a>();
06305     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fIsMenuBar);
06306     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fHasMenuBar);
06307     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fIsSysMenu);
06308     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fIsTrackPopup);
06309     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fDroppedLeft);
06310     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fHierarchyDropped);
06311     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fRightButton);
06312     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fToggle);
06313     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fSynchronous);
<a name="l06314"></a><a class="code" href="../../d2/d1/userexts_8c.html#a218">06314</a>     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fFirstClick);
06315     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fDropNextPopup);
06316     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fNoNotify);
06317     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fAboutToHide);
06318     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fShowTimer);
06319     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fHideTimer);
06320     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fDestroyed);
06321     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fDelayedFree);
06322     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fFlushDelayedFree);
06323     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fFreed);
06324     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fInCancel);
06325     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fTrackMouseEvent);
06326     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localPopupMenu, fSendUninit);
06327     <a class="code" href="../../d2/d1/userexts_8c.html#a31">END_PRTFFLG</a>();
06328 
06329     <a class="code" href="../../d2/d1/userexts_8c.html#a26">PRTFDWP2</a>(localPopupMenu., spwndNotify, spwndPopupMenu);
06330     <a class="code" href="../../d2/d1/userexts_8c.html#a26">PRTFDWP2</a>(localPopupMenu., spwndNextPopup, spwndPrevPopup);
06331     <a class="code" href="../../d2/d1/userexts_8c.html#a26">PRTFDWP2</a>(localPopupMenu., spmenu, spmenuAlternate);
06332     <a class="code" href="../../d2/d1/userexts_8c.html#a26">PRTFDWP2</a>(localPopupMenu., spwndActivePopup, ppopupmenuRoot);
06333     <a class="code" href="../../d2/d1/userexts_8c.html#a27">PRTFDWPDW</a>(localPopupMenu., ppmDelayedFree, posSelectedItem);
06334     <a class="code" href="../../d2/d1/userexts_8c.html#a18">PRTFDW1</a>(localPopupMenu., posDropped);
06335 
06336     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06337 }
06338 <span class="preprocessor">#endif // KERNEL</span>
06339 <span class="preprocessor"></span>
06340 <span class="preprocessor">#ifdef KERNEL</span>
06341 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
06342 <span class="comment">* dms - dump pMenuState</span>
06343 <span class="comment">*</span>
06344 <span class="comment">* dms address</span>
06345 <span class="comment">*</span>
06346 <span class="comment">* 05-15-96 Created GerardoB</span>
06347 <span class="comment">\***************************************************************************/</span>
06348 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idms(
06349 DWORD opts,
06350 PVOID param1)
06351 {
06352 
06353     <a class="code" href="../../d4/d1/structtagMENUSTATE.html">MENUSTATE</a> *pms;
06354     <a class="code" href="../../d4/d1/structtagMENUSTATE.html">MENUSTATE</a> localms;
06355 
06356     UNREFERENCED_PARAMETER(opts);
06357 
06358     pms = (<a class="code" href="../../d4/d1/structtagMENUSTATE.html">PMENUSTATE</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
06359     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(localms, pms);
06360 
06361     Print(<span class="stringliteral">"PMENUSTATE @ 0x%lX\n"</span>, pms);
06362 
06363     <a class="code" href="../../d2/d1/userexts_8c.html#a29">BEGIN_PRTFFLG</a>();
06364     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fMenuStarted);
06365     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fIsSysMenu);
06366     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fInsideMenuLoop);
06367     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fButtonDown);
06368     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fInEndMenu);
06369     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fUnderline);
06370     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fButtonAlwaysDown);
06371     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fDragging);
06372     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fModelessMenu);
06373     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fInCallHandleMenuMessages);
06374     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fDragAndDrop);
06375     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fAutoDismiss);
06376     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fIgnoreButtonUp);
06377     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fMouseOffMenu);
06378     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fInDoDragDrop);
06379     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fActiveNoForeground);
06380     <a class="code" href="../../d2/d1/userexts_8c.html#a30">PRTFFLG</a>(localms, fNotifyByPos);
06381     <a class="code" href="../../d2/d1/userexts_8c.html#a31">END_PRTFFLG</a>();
06382 
06383     <a class="code" href="../../d2/d1/userexts_8c.html#a25">PRTFDWP1</a>(localms., pGlobalPopupMenu);
06384     <a class="code" href="../../d2/d1/userexts_8c.html#a23">PRTFPT</a>(localms., ptMouseLast);
06385     <a class="code" href="../../d2/d1/userexts_8c.html#a20">PRTFDW2</a>(localms., mnFocus, cmdLast);
06386     <a class="code" href="../../d2/d1/userexts_8c.html#a25">PRTFDWP1</a>(localms., ptiMenuStateOwner);
06387 
06388     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06389 }
06390 <span class="preprocessor">#endif // KERNEL</span>
06391 <span class="preprocessor"></span>
06392 
06393 
06394 <span class="preprocessor">#ifdef KERNEL</span>
06395 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
06396 <span class="comment">* dq - dump queue</span>
06397 <span class="comment">*</span>
06398 <span class="comment">* dq address   - dumps queue structure at address</span>
06399 <span class="comment">* dq t address - dumps queue structure at address plus THREADINFO</span>
06400 <span class="comment">*</span>
06401 <span class="comment">* 06-20-91 ScottLu      Created.</span>
06402 <span class="comment">* 11-14-91 DavidPe      Added THREADINFO option.</span>
06403 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
06404 <span class="comment">\***************************************************************************/</span>
06405 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idq(
06406 DWORD opts,
06407 PVOID param1)
06408 {
06409 
06410     <span class="keywordtype">char</span> ach[80];
06411     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
06412     <a class="code" href="../../d7/d4/structtagQ.html">Q</a> q;
06413 
06414     <span class="keywordflow">if</span> (opts &amp; OFLAG(a)) {
06415         <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
06416         Print(<span class="stringliteral">"Dumping all queues:\n"</span>);
06417 
06418         FOREACHPTI(pti);
06419             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pq, &amp;pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>);
06420             Idq(opts &amp; ~OFLAG(a), pq);
06421         NEXTEACHPTI(pti);
06422         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06423 <span class="preprocessor">#ifdef SOME_OTHER_DELUSION</span>
06424 <span class="preprocessor"></span>        <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he, *phe;
06425         <span class="keywordtype">int</span> i;
06426 
06427 
06428         <a class="code" href="../../d2/d1/userexts_8c.html#a8">FOREACHHANDLEENTRY</a>(phe, he, i)
06429             if (he.bType == TYPE_INPUTQUEUE) {
06430                 Idq(opts &amp; ~OFLAG(a), <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>));
06431                 Print(<span class="stringliteral">"\n"</span>);
06432             }
06433         <a class="code" href="../../d2/d1/userexts_8c.html#a9">NEXTEACHHANDLEENTRY</a>()
06434         return TRUE;
06435 #endif
06436     }
06437 
06438     if (param1 == 0) {
06439         Print(<span class="stringliteral">"Dumping foreground queue:\n"</span>);
06440         moveExpValuePtr(&amp;pq, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpqForeground));
06441         <span class="keywordflow">if</span> (pq == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
06442             Print(<span class="stringliteral">"no foreground queue (gpqForeground == NULL)!\n"</span>);
06443             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06444         }
06445     } <span class="keywordflow">else</span> {
06446         pq = (<a class="code" href="../../d7/d4/structtagQ.html">PQ</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
06447     }
06448 
06449     <span class="comment">/*</span>
06450 <span class="comment">     * Print out simple thread info for pq-&gt;ptiKeyboard</span>
06451 <span class="comment">     */</span>
06452     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(q, pq);
06453     <span class="keywordflow">if</span> (q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>) {
06454         Idt(OFLAG(p), q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>);
06455     }
06456 
06457     <span class="comment">/*</span>
06458 <span class="comment">     * Don't Print() with more than 16 arguments at once because it'll blow</span>
06459 <span class="comment">     * up.</span>
06460 <span class="comment">     */</span>
06461     Print(<span class="stringliteral">"PQ @ 0x%p\n"</span>, pq);
06462     Print(
06463           <span class="stringliteral">"\tmlInput.pqmsgRead      0x%08lx\n"</span>
06464           <span class="stringliteral">"\tmlInput.pqmsgWriteLast 0x%08lx\n"</span>
06465           <span class="stringliteral">"\tmlInput.cMsgs          0x%08lx\n"</span>,
06466           q.<a class="code" href="../../d7/d4/structtagQ.html#o0">mlInput</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o0">pqmsgRead</a>,
06467           q.<a class="code" href="../../d7/d4/structtagQ.html#o0">mlInput</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o1">pqmsgWriteLast</a>,
06468           q.<a class="code" href="../../d7/d4/structtagQ.html#o0">mlInput</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o2">cMsgs</a>);
06469 
06470     Print(<span class="stringliteral">"\tptiSysLock             0x%08lx\n"</span>
06471           <span class="stringliteral">"\tidSysLock              0x%08lx\n"</span>
06472           <span class="stringliteral">"\tidSysPeek              0x%08lx\n"</span>,
06473           q.<a class="code" href="../../d7/d4/structtagQ.html#o1">ptiSysLock</a>,
06474           q.<a class="code" href="../../d7/d4/structtagQ.html#o2">idSysLock</a>,
06475           q.<a class="code" href="../../d7/d4/structtagQ.html#o3">idSysPeek</a>);
06476 
06477     Print(<span class="stringliteral">"\tptiMouse               0x%08lx\n"</span>
06478           <span class="stringliteral">"\tptiKeyboard            0x%08lx\n"</span>,
06479           q.<a class="code" href="../../d7/d4/structtagQ.html#o4">ptiMouse</a>,
06480           q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>);
06481 
06482     Print(<span class="stringliteral">"\tspcurCurrent           0x%08lx\n"</span>
06483           <span class="stringliteral">"\tiCursorLevel           0x%08lx\n"</span>,
06484           q.<a class="code" href="../../d7/d4/structtagQ.html#o19">spcurCurrent</a>,
06485           q.<a class="code" href="../../d7/d4/structtagQ.html#o20">iCursorLevel</a>);
06486 
06487     <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(q.<a class="code" href="../../d7/d4/structtagQ.html#o6">spwndCapture</a>, ach);
06488     Print(<span class="stringliteral">"\tspwndCapture           0x%08lx     \"%s\"\n"</span>,
06489           q.<a class="code" href="../../d7/d4/structtagQ.html#o6">spwndCapture</a>, ach);
06490     <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(q.<a class="code" href="../../d7/d4/structtagQ.html#o7">spwndFocus</a>, ach);
06491     Print(<span class="stringliteral">"\tspwndFocus             0x%08lx     \"%s\"\n"</span>,
06492           q.<a class="code" href="../../d7/d4/structtagQ.html#o7">spwndFocus</a>, ach);
06493     <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(q.<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>, ach);
06494     Print(<span class="stringliteral">"\tspwndActive            0x%08lx     \"%s\"\n"</span>,
06495           q.<a class="code" href="../../d7/d4/structtagQ.html#o8">spwndActive</a>, ach);
06496     <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(q.<a class="code" href="../../d7/d4/structtagQ.html#o9">spwndActivePrev</a>, ach);
06497     Print(<span class="stringliteral">"\tspwndActivePrev        0x%08lx     \"%s\"\n"</span>,
06498           q.<a class="code" href="../../d7/d4/structtagQ.html#o9">spwndActivePrev</a>, ach);
06499 
06500     Print(<span class="stringliteral">"\tcodeCapture            0x%04lx\n"</span>
06501           <span class="stringliteral">"\tmsgDblClk              0x%04lx\n"</span>
06502           <span class="stringliteral">"\ttimeDblClk             0x%08lx\n"</span>,
06503           q.<a class="code" href="../../d7/d4/structtagQ.html#o10">codeCapture</a>,
06504           q.<a class="code" href="../../d7/d4/structtagQ.html#o11">msgDblClk</a>,
06505           q.<a class="code" href="../../d7/d4/structtagQ.html#o13">timeDblClk</a>);
06506 
06507     Print(<span class="stringliteral">"\thwndDblClk             0x%08lx\n"</span>,
06508           q.<a class="code" href="../../d7/d4/structtagQ.html#o14">hwndDblClk</a>);
06509 
06510     Print(<span class="stringliteral">"\tptDblClk               { %d, %d }\n"</span>,
06511           q.<a class="code" href="../../d7/d4/structtagQ.html#o15">ptDblClk</a>.x,
06512           q.<a class="code" href="../../d7/d4/structtagQ.html#o15">ptDblClk</a>.y);
06513 
06514     Print(<span class="stringliteral">"\tQF_flags               0x%08lx %s\n"</span>
06515           <span class="stringliteral">"\tcThreads               0x%08lx\n"</span>
06516           <span class="stringliteral">"\tcLockCount             0x%08lx\n"</span>,
06517           q.<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a>, <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_QF, q.<a class="code" href="../../d7/d4/structtagQ.html#o21">QF_flags</a>, NULL, FALSE),
06518           (DWORD) q.<a class="code" href="../../d7/d4/structtagQ.html#o22">cThreads</a>,
06519           (DWORD) q.<a class="code" href="../../d7/d4/structtagQ.html#o23">cLockCount</a>);
06520 
06521     Print(<span class="stringliteral">"\tmsgJournal             0x%08lx\n"</span>
06522           <span class="stringliteral">"\tExtraInfo              0x%08lx\n"</span>,
06523           q.<a class="code" href="../../d7/d4/structtagQ.html#o24">msgJournal</a>,
06524           q.<a class="code" href="../../d7/d4/structtagQ.html#o25">ExtraInfo</a>);
06525 
06526     <span class="comment">/*</span>
06527 <span class="comment">     * Dump THREADINFO if user specified 't'.</span>
06528 <span class="comment">     */</span>
06529     <span class="keywordflow">if</span> (opts &amp; OFLAG(t)) {
06530         Idti(0, q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>);
06531     }
06532     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06533 }
06534 <span class="preprocessor">#endif // KERNEL</span>
06535 <span class="preprocessor"></span>
06536 <span class="comment">/************************************************************************\</span>
06537 <span class="comment">* Procedure: Idsbt</span>
06538 <span class="comment">*</span>
06539 <span class="comment">* Description: Dumps Scrollbar track structures.</span>
06540 <span class="comment">*</span>
06541 <span class="comment">* Returns: fSuccess</span>
06542 <span class="comment">*</span>
06543 <span class="comment">* 6/9/1995 Created SanfordS</span>
06544 <span class="comment">*</span>
06545 <span class="comment">\************************************************************************/</span>
06546 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a224">Idsbt</a>(
06547 DWORD opts,
06548 PVOID param1)
06549 {
06550     <a class="code" href="../../d6/d5/structtagSBTRACK.html">SBTRACK</a> sbt, *psbt;
<a name="l06551"></a><a class="code" href="../../d2/d1/userexts_8c.html#a219">06551</a>     <a class="code" href="../../d3/d5/structtagSBCALC.html">SBCALC</a>  sbc;
06552 
06553     UNREFERENCED_PARAMETER(opts);
06554 
06555     <span class="keywordflow">if</span> (param1 == 0) {
06556         Print(<span class="stringliteral">"Expected pSBTrack address\n"</span>);
06557         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
06558     }
06559     psbt = (<a class="code" href="../../d6/d5/structtagSBTRACK.html">PSBTRACK</a>)param1;
06560     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(sbt, psbt);
06561 
06562     Print(<span class="stringliteral">"SBTrack:\n"</span>);
06563     Print(<span class="stringliteral">"  fHitOld          %d\n"</span>,       sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o0">fHitOld</a>);
06564     Print(<span class="stringliteral">"  fTrackVert       %d\n"</span>,       sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o1">fTrackVert</a>);
06565     Print(<span class="stringliteral">"  fCtlSB           %d\n"</span>,       sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o2">fCtlSB</a>);
06566     Print(<span class="stringliteral">"  fTrackRecalc     %d\n"</span>,       sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o3">fTrackRecalc</a>);
06567     Print(<span class="stringliteral">"  spwndSB          0x%08lx\n"</span>,  sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o5">spwndSB</a>);
06568     Print(<span class="stringliteral">"  spwndSBNotify    0x%08lx\n"</span>,  sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o6">spwndSBNotify</a>);
06569     Print(<span class="stringliteral">"  spwndTrack       0x%08lx\n"</span>,  sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o4">spwndTrack</a>);
06570     Print(<span class="stringliteral">"  cmdSB            0x%08lx\n"</span>,  sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o9">cmdSB</a>);
06571     Print(<span class="stringliteral">"  dpxThumb         0x%08lx\n"</span>,  sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o11">dpxThumb</a>);
06572     Print(<span class="stringliteral">"  posOld           0x%08lx\n"</span>,  sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o13">posOld</a>);
06573     Print(<span class="stringliteral">"  posNew           0x%08lx\n"</span>,  sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o14">posNew</a>);
06574     Print(<span class="stringliteral">"  pxOld            0x%08lx\n"</span>,  sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o12">pxOld</a> );
06575     Print(<span class="stringliteral">"  rcTrack          (0x%08lx,0x%08lx,0x%08lx,0x%08lx)\n"</span>,
06576             sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o7">rcTrack</a>.left,
06577             sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o7">rcTrack</a>.top,
06578             sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o7">rcTrack</a>.right,
06579             sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o7">rcTrack</a>.bottom);
06580     Print(<span class="stringliteral">"  hTimerSB         0x%08lx\n"</span>,  sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o10">hTimerSB</a>     );
06581     Print(<span class="stringliteral">"  xxxpfnSB         0x%08lx\n"</span>,  sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o8">xxxpfnSB</a>     );
06582     Print(<span class="stringliteral">"  nBar             %d\n"</span>,       sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o15">nBar</a>         );
06583     Print(<span class="stringliteral">"  pSBCalc            0x%08lx\n"</span>,  sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o16">pSBCalc</a>        );
06584     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(sbc, sbt.<a class="code" href="../../d6/d5/structtagSBTRACK.html#o16">pSBCalc</a>);
06585     Print(<span class="stringliteral">"  pxTop            0x%08lx\n"</span>,  sbc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o1">pxTop</a>        );
06586     Print(<span class="stringliteral">"  pxBottom         0x%08lx\n"</span>,  sbc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o2">pxBottom</a>);
06587     Print(<span class="stringliteral">"  pxLeft           0x%08lx\n"</span>,  sbc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o3">pxLeft</a>);
06588     Print(<span class="stringliteral">"  pxRight          0x%08lx\n"</span>,  sbc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o4">pxRight</a>);
06589     Print(<span class="stringliteral">"  cpxThumb         0x%08lx\n"</span>,  sbc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o5">cpxThumb</a>     );
06590     Print(<span class="stringliteral">"  pxUpArrow        0x%08lx\n"</span>,  sbc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o6">pxUpArrow</a>    );
06591     Print(<span class="stringliteral">"  pxDownArrow      0x%08lx\n"</span>,  sbc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o7">pxDownArrow</a>);
06592     Print(<span class="stringliteral">"  pxStart          0x%08lx\n"</span>,  sbc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o8">pxStart</a>);
06593     Print(<span class="stringliteral">"  pxThumbBottom    0x%08lx\n"</span>,  sbc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o9">pxThumbBottom</a>);
06594     Print(<span class="stringliteral">"  pxThumbTop       0x%08lx\n"</span>,  sbc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o10">pxThumbTop</a>   );
06595     Print(<span class="stringliteral">"  cpx              0x%08lx\n"</span>,  sbc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o11">cpx</a>          );
06596     Print(<span class="stringliteral">"  pxMin            0x%08lx\n"</span>,  sbc.<a class="code" href="../../d3/d5/structtagSBCALC.html#o12">pxMin</a>        );
06597     Print(<span class="stringliteral">"  pos              0x%08lx\n"</span>,  sbc.pos          );
06598     Print(<span class="stringliteral">"  posMin           0x%08lx\n"</span>,  sbc.posMin       );
06599     Print(<span class="stringliteral">"  posMax           0x%08lx\n"</span>,  sbc.posMax       );
06600     Print(<span class="stringliteral">"  page             0x%08lx\n"</span>,  sbc.page         );
06601 
06602 
06603     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06604 }
06605 
06606 
06607 
06608 
06609 <span class="comment">/************************************************************************\</span>
06610 <span class="comment">* Procedure: Idsbwnd</span>
06611 <span class="comment">*</span>
06612 <span class="comment">* Description: Dumps Scrollbar windows struct extra fields</span>
06613 <span class="comment">*</span>
06614 <span class="comment">* Returns: fSuccess</span>
06615 <span class="comment">*</span>
06616 <span class="comment">* 6/9/1995 Created SanfordS</span>
06617 <span class="comment">*</span>
06618 <span class="comment">\************************************************************************/</span>
06619 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a225">Idsbwnd</a>(
06620 DWORD opts,
06621 PVOID param1)
06622 {
06623     <a class="code" href="../../d7/d5/structtagSBWND.html">SBWND</a> sbw, *psbw;
06624 
06625     UNREFERENCED_PARAMETER(opts);
06626 
06627     <span class="keywordflow">if</span> (param1 == 0) {
06628         Print(<span class="stringliteral">"Expected SB pwnd address\n"</span>);
06629         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
06630     }
06631     psbw = (<a class="code" href="../../d7/d5/structtagSBWND.html">PSBWND</a>)param1;
06632     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(sbw, psbw);
06633 
06634     Print(<span class="stringliteral">"SBWnd:\n"</span>);
06635     Print(<span class="stringliteral">"  min           %d\n"</span>, sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.posMin);
06636     Print(<span class="stringliteral">"  max           %d\n"</span>, sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.posMax);
06637     Print(<span class="stringliteral">"  page          %d\n"</span>, sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.page);
06638     Print(<span class="stringliteral">"  pos           %d\n"</span>, sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.pos);
06639     Print(<span class="stringliteral">"  fVert         %d\n"</span>, sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o1">fVert</a>);
06640     Print(<span class="stringliteral">"  wDisableFlags %d\n"</span>, sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o2">wDisableFlags</a>);
06641     Print(<span class="stringliteral">"  pxTop            0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.<a class="code" href="../../d3/d5/structtagSBCALC.html#o1">pxTop</a>        );
06642     Print(<span class="stringliteral">"  pxBottom         0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.<a class="code" href="../../d3/d5/structtagSBCALC.html#o2">pxBottom</a>);
06643     Print(<span class="stringliteral">"  pxLeft           0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.<a class="code" href="../../d3/d5/structtagSBCALC.html#o3">pxLeft</a>);
06644     Print(<span class="stringliteral">"  pxRight          0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.<a class="code" href="../../d3/d5/structtagSBCALC.html#o4">pxRight</a>);
06645     Print(<span class="stringliteral">"  cpxThumb         0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.<a class="code" href="../../d3/d5/structtagSBCALC.html#o5">cpxThumb</a>     );
06646     Print(<span class="stringliteral">"  pxUpArrow        0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.<a class="code" href="../../d3/d5/structtagSBCALC.html#o6">pxUpArrow</a>    );
06647     Print(<span class="stringliteral">"  pxDownArrow      0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.<a class="code" href="../../d3/d5/structtagSBCALC.html#o7">pxDownArrow</a>);
06648     Print(<span class="stringliteral">"  pxStart          0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.<a class="code" href="../../d3/d5/structtagSBCALC.html#o8">pxStart</a>);
06649     Print(<span class="stringliteral">"  pxThumbBottom    0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.<a class="code" href="../../d3/d5/structtagSBCALC.html#o9">pxThumbBottom</a>);
06650     Print(<span class="stringliteral">"  pxThumbTop       0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.<a class="code" href="../../d3/d5/structtagSBCALC.html#o10">pxThumbTop</a>   );
06651     Print(<span class="stringliteral">"  cpx              0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.<a class="code" href="../../d3/d5/structtagSBCALC.html#o11">cpx</a>          );
06652     Print(<span class="stringliteral">"  pxMin            0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.<a class="code" href="../../d3/d5/structtagSBCALC.html#o12">pxMin</a>        );
06653     Print(<span class="stringliteral">"  pos              0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.pos          );
06654     Print(<span class="stringliteral">"  posMin           0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.posMin       );
06655     Print(<span class="stringliteral">"  posMax           0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.posMax       );
06656     Print(<span class="stringliteral">"  page             0x%08lx\n"</span>,  sbw.<a class="code" href="../../d7/d5/structtagSBWND.html#o3">SBCalc</a>.page         );
06657     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06658 }
06659 
06660 <span class="comment">/***************************************************************************\</span>
06661 <span class="comment">* dsi dump serverinfo struct</span>
06662 <span class="comment">*</span>
06663 <span class="comment">* 02-27-92 ScottLu      Created.</span>
06664 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
06665 <span class="comment">\***************************************************************************/</span>
06666 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a226">Idsi</a>(DWORD opts)
06667 {
06668 
06669     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a> si;
06670     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">PSERVERINFO</a> psi;
06671     <span class="keywordtype">int</span> i;
06672 
06673     moveExpValuePtr(&amp;psi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
06674 
06675     Print(<span class="stringliteral">"PSERVERINFO @ 0x%p\n"</span>, psi);
06676 
06677     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(si, psi);
06678 
06679     Print(  <span class="stringliteral">"\tRIPFlags                 0x%04lx %s\n"</span>, si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o0">wRIPFlags</a>,  <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_RIP, si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o0">wRIPFlags</a>, NULL, FALSE));
06680     Print(  <span class="stringliteral">"\tSRVIFlags                0x%04lx %s\n"</span>, si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o1">wSRVIFlags</a>, <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_SRVI, si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o1">wSRVIFlags</a>, NULL, FALSE));
06681     Print(  <span class="stringliteral">"\tPUSIFlags                0x%08lx %s\n"</span>, si.PUSIFlags,  <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_SI, si.PUSIFlags, NULL, FALSE));
06682 
06683     Print(  <span class="stringliteral">"\tcHandleEntries           0x%08lx\n"</span>
06684             <span class="stringliteral">"\tcbHandleTable            0x%08lx\n"</span>
06685             <span class="stringliteral">"\tnEvents                  0x%08lx\n"</span>,
06686             si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o4">cHandleEntries</a>,
06687             si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o11">cbHandleTable</a>,
06688             si.nEvents);
06689 
06690     <span class="keywordflow">if</span> (opts &amp; OFLAG(p)) {
06691         Print(<span class="stringliteral">"\tmpFnidPfn:\n"</span>);
06692         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a224">FNID_ARRAY_SIZE</a>; i++) {
06693             Print(<span class="stringliteral">"\t\t[%d] = %08lx\n"</span>, i, si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o5">mpFnidPfn</a>[i]);
06694         }
06695     }
06696 
06697     <span class="keywordflow">if</span> (opts &amp; OFLAG(w)) {
06698         Print(<span class="stringliteral">"\taStoCidPfn:\n"</span>);
06699         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a198">FNID_WNDPROCEND</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a191">FNID_START</a> + 1; i++) {
06700             Print(<span class="stringliteral">"\t\t[%d] = %08lx\n"</span>, i, si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o6">aStoCidPfn</a>[i]);
06701         }
06702     }
06703 
06704     <span class="keywordflow">if</span> (opts &amp; OFLAG(b)) {
06705         Print(<span class="stringliteral">"\tmpFnid_serverCBWndProc:\n"</span>);
06706         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a223">FNID_END</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a191">FNID_START</a> + 1; i++) {
06707             Print(<span class="stringliteral">"\t\t[%d] = %08lx\n"</span>, i, si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o7">mpFnid_serverCBWndProc</a>[i]);
06708         }
06709     }
06710 
06711     <span class="keywordflow">if</span> (opts &amp; OFLAG(m)) {
06712 
06713         <span class="comment">/*</span>
06714 <span class="comment">         * Add entries to this table in alphabetical order with</span>
06715 <span class="comment">         * the prefix removed.</span>
06716 <span class="comment">         */</span>
06717         <span class="keyword">static</span> <a class="code" href="../../d7/d7/structSYSMET__ENTRY.html">SYSMET_ENTRY</a> aSysMet[SM_CMETRICS] = {
06718             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(ARRANGE),
06719             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXBORDER),
06720             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYBORDER),
06721             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYCAPTION),
06722             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CLEANBOOT),
06723             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXCURSOR),
06724             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYCURSOR),
06725             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(DBCSENABLED),
06726             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(DEBUG),
<a name="l06727"></a><a class="code" href="../../d2/d1/userexts_8c.html#a220">06727</a>             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXDLGFRAME),
06728             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYDLGFRAME),
06729             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXDOUBLECLK),
06730             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYDOUBLECLK),
06731             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXDRAG),
06732             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYDRAG),
06733             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXEDGE),
06734             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYEDGE),
06735             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXFRAME),
06736             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYFRAME),
06737             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXFULLSCREEN),
06738             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYFULLSCREEN),
06739             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXICON),
06740             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYICON),
06741             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXICONSPACING),
06742             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYICONSPACING),
06743             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(IMMENABLED),
06744             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYKANJIWINDOW),
06745             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXMAXIMIZED),
06746             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYMAXIMIZED),
06747             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXMAXTRACK),
06748             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYMAXTRACK),
06749             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYMENU),
06750             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXMENUCHECK),
06751             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYMENUCHECK),
06752             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(MENUDROPALIGNMENT),
06753             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXMENUSIZE),
06754             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYMENUSIZE),
06755             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(MIDEASTENABLED),
06756             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXMIN),
06757             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYMIN),
06758             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXMINIMIZED),
06759             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYMINIMIZED),
06760             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXMINSPACING),
06761             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYMINSPACING),
06762             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXMINTRACK),
06763             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYMINTRACK),
06764             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CMONITORS),
06765             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CMOUSEBUTTONS),
06766             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(MOUSEPRESENT),
06767             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(MOUSEWHEELPRESENT),
06768             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(NETWORK),
06769             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(PENWINDOWS),
06770             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(RESERVED1),
06771             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(RESERVED2),
06772             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(RESERVED3),
06773             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(RESERVED4),
06774             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(SAMEDISPLAYFORMAT),
06775             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXSCREEN),
06776             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYSCREEN),
06777             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXVSCROLL),
06778             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYHSCROLL),
06779             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYVSCROLL),
06780             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXHSCROLL),
06781             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(SECURE),
06782             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(SHOWSOUNDS),
06783             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXSIZE),
06784             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYSIZE),
06785             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(SLOWMACHINE),
06786             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYSMCAPTION),
06787             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXSMICON),
06788             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYSMICON),
06789             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXSMSIZE),
06790             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYSMSIZE),
06791             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(SWAPBUTTON),
06792             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYVTHUMB),
06793             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXHTHUMB),
06794             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(UNUSED_64),
06795             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(UNUSED_65),
06796             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(UNUSED_66),
06797             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(XVIRTUALSCREEN),
06798             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(YVIRTUALSCREEN),
06799             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CXVIRTUALSCREEN),
06800             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CYVIRTUALSCREEN),
06801         };
06802 
06803         Print(<span class="stringliteral">"\taiSysMet:\n"</span>);
06804         <span class="keywordflow">for</span> (i = 0; i &lt; SM_CMETRICS; i++) {
06805             Print(  <span class="stringliteral">"\t\tSM_%-18s = 0x%08lx = %d\n"</span>,
06806                     aSysMet[i].pstrMetric,
06807                     si.aiSysMet[aSysMet[i].iMetric],
06808                     si.aiSysMet[aSysMet[i].iMetric]);
06809         }
06810     }
06811 
06812     <span class="keywordflow">if</span> (opts &amp; OFLAG(c)) {
06813         <span class="keyword">static</span> LPSTR aszSysColor[COLOR_MAX] = {
06814           <span class="comment">//012345678901234567890</span>
06815             <span class="stringliteral">"SCROLLBAR"</span>,
06816             <span class="stringliteral">"BACKGROUND"</span>,
06817             <span class="stringliteral">"ACTIVECAPTION"</span>,
06818             <span class="stringliteral">"INACTIVECAPTION"</span>,
06819             <span class="stringliteral">"MENU"</span>,
06820             <span class="stringliteral">"WINDOW"</span>,
06821             <span class="stringliteral">"WINDOWFRAME"</span>,
06822             <span class="stringliteral">"MENUTEXT"</span>,
06823             <span class="stringliteral">"WINDOWTEXT"</span>,
06824             <span class="stringliteral">"CAPTIONTEXT"</span>,
06825             <span class="stringliteral">"ACTIVEBORDER"</span>,
06826             <span class="stringliteral">"INACTIVEBORDER"</span>,
06827             <span class="stringliteral">"APPWORKSPACE"</span>,
06828             <span class="stringliteral">"HIGHLIGHT"</span>,
06829             <span class="stringliteral">"HIGHLIGHTTEXT"</span>,
06830             <span class="stringliteral">"BTNFACE"</span>,
06831             <span class="stringliteral">"BTNSHADOW"</span>,
06832             <span class="stringliteral">"GRAYTEXT"</span>,
06833             <span class="stringliteral">"BTNTEXT"</span>,
06834             <span class="stringliteral">"INACTIVECAPTIONTEXT"</span>,
06835             <span class="stringliteral">"BTNHIGHLIGHT"</span>,
06836             <span class="stringliteral">"3DDKSHADOW"</span>,
06837             <span class="stringliteral">"3DLIGHT"</span>,
06838             <span class="stringliteral">"INFOTEXT"</span>,
06839             <span class="stringliteral">"INFOBK"</span>,
06840             <span class="stringliteral">"3DALTFACE"</span>,
06841             <span class="stringliteral">"HOTLIGHT"</span>,
06842         };
06843         Print(<span class="stringliteral">"\targbSystem:\n\t\tCOLOR%24sSYSRGB\tSYSHBR\n"</span>, <span class="stringliteral">""</span>);
06844         <span class="keywordflow">for</span> (i = 0; i &lt; COLOR_MAX; i++) {
06845             Print(<span class="stringliteral">"\t\tCOLOR_%-21s: 0x%08lx\t0x%08lx\n"</span>,
06846                 aszSysColor[i], si.argbSystem[i], si.ahbrSystem[i]);
06847         }
06848     }
06849 
06850     <span class="keywordflow">if</span> (opts &amp; OFLAG(o)) {
06851         Print(<span class="stringliteral">"\toembmi @ 0x%p:\n\t\tx       \ty       \tcx       \tcy\n"</span>, &amp;psi-&gt;oembmi);
06852         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a361">OBI_COUNT</a>; i++) {
06853             Print(<span class="stringliteral">"\tbm[%d]:\t%08x\t%08x\t%08x\t%08x\n"</span>,
06854                     i,
06855                     si.oembmi[i].x ,
<a name="l06856"></a><a class="code" href="../../d2/d1/userexts_8c.html#a221">06856</a>                     si.oembmi[i].y ,
06857                     si.oembmi[i].cx,
06858                     si.oembmi[i].cy);
06859         }
06860         Print(
06861                 <span class="stringliteral">"\t\tPlanes             = %d\n"</span>
06862                 <span class="stringliteral">"\t\tBitsPixel          = %d\n"</span>
06863                 <span class="stringliteral">"\t\tBitCount           = %d\n"</span>
06864                 <span class="stringliteral">"\t\tdmLogPixels        = %d\n"</span>
06865                 <span class="stringliteral">"\t\trcScreen           = (%d,%d)-(%d,%d) %dx%d\n"</span>
06866                 ,
06867                 si.Planes           ,
06868                 si.BitsPixel        ,
06869                 si.BitCount         ,
06870                 (UINT) si.dmLogPixels,
06871                 si.rcScreen.left,si.rcScreen.top,si.rcScreen.right,si.rcScreen.bottom,
06872                 si.rcScreen.right-si.rcScreen.left, si.rcScreen.bottom-si.rcScreen.top);
06873 
06874     }
06875 
06876     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
06877         Print(
06878                 <span class="stringliteral">"\tptCursor                 {%d, %d}\n"</span>
06879                 <span class="stringliteral">"\tgclBorder                0x%08lx\n"</span>
06880                 <span class="stringliteral">"\tdtScroll                 0x%08lx\n"</span>
06881                 <span class="stringliteral">"\tdtLBSearch               0x%08lx\n"</span>
06882                 <span class="stringliteral">"\tdtCaretBlink             0x%08lx\n"</span>
06883                 <span class="stringliteral">"\tdwDefaultHeapBase        0x%08lx\n"</span>
06884                 <span class="stringliteral">"\tdwDefaultHeapSize        0x%08lx\n"</span>
06885                 <span class="stringliteral">"\twMaxLeftOverlapChars     0x%08lx\n"</span>
06886                 <span class="stringliteral">"\twMaxRightOverlapchars    0x%08lx\n"</span>
06887                 <span class="stringliteral">"\tuiShellMsg               0x%08lx\n"</span>
06888                 <span class="stringliteral">"\tcxSysFontChar            0x%08lx\n"</span>
06889                 <span class="stringliteral">"\tcySysFontChar            0x%08lx\n"</span>
06890                 <span class="stringliteral">"\tcxMsgFontChar            0x%08lx\n"</span>
06891                 <span class="stringliteral">"\tcyMsgFontChar            0x%08lx\n"</span>
06892                 <span class="stringliteral">"\ttmSysFont              @ 0x%p\n"</span>
06893                 <span class="stringliteral">"\tatomIconSmProp           0x%04lx\n"</span>
06894                 <span class="stringliteral">"\tatomIconProp             0x%04lx\n"</span>
06895                 <span class="stringliteral">"\thIconSmWindows           0x%08lx\n"</span>
06896                 <span class="stringliteral">"\thIcoWindows              0x%08lx\n"</span>
06897                 <span class="stringliteral">"\thCaptionFont             0x%08lx\n"</span>
06898                 <span class="stringliteral">"\thMsgFont                 0x%08lx\n"</span>
06899                 <span class="stringliteral">"\tatomContextHelpIdProp    0x%08lx\n"</span>,
06900                 si.ptCursor.x,
06901                 si.ptCursor.y,
06902                 si.gclBorder,
06903                 si.dtScroll,
06904                 si.dtLBSearch,
06905                 si.dtCaretBlink,
06906                 si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o13">dwDefaultHeapBase</a>,
06907                 si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o14">dwDefaultHeapSize</a>,
06908                 si.wMaxLeftOverlapChars,
06909                 si.wMaxRightOverlapChars,
06910                 si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o15">uiShellMsg</a>,
06911                 si.cxSysFontChar,
06912                 si.cySysFontChar,
06913                 si.cxMsgFontChar,
06914                 si.cyMsgFontChar,
06915                 &amp;psi-&gt;tmSysFont,
06916                 si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o28">atomIconSmProp</a>,
06917                 si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o29">atomIconProp</a>,
06918                 si.hIconSmWindows,
06919                 si.hIcoWindows,
06920                 si.hCaptionFont,
06921                 si.hMsgFont,
06922                 si.<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o30">atomContextHelpIdProp</a>);
06923     }
06924 
06925     <span class="keywordflow">if</span> (opts &amp; OFLAG(h)) {
06926         <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">SHAREDINFO</a> shi;
06927         <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">PSHAREDINFO</a> pshi;
06928 
06929         <a class="code" href="../../d2/d1/userexts_8c.html#a7">GETSHAREDINFO</a>(pshi);
06930         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(shi, pshi);
06931         Print(<span class="stringliteral">"\nSHAREDINFO @ 0x%p:\n"</span>, pshi);
06932         Print(
06933                 <span class="stringliteral">"\taheList                  0x%08lx\n"</span>,
06934                 shi.<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o1">aheList</a>);
06935     }
06936 
06937     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06938 }
06939 
06940 
06941 <span class="preprocessor">#ifdef KERNEL</span>
06942 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
06943 <span class="comment">* dsms - dump send message structures</span>
06944 <span class="comment">*</span>
06945 <span class="comment">* dsms           - dumps all send message structures</span>
06946 <span class="comment">* dsms v         - dumps all verbose</span>
06947 <span class="comment">* dsms address   - dumps specific sms</span>
06948 <span class="comment">* dsms v address - dumps verbose</span>
06949 <span class="comment">* dsms l [address] - dumps sendlist of sms</span>
06950 <span class="comment">*</span>
06951 <span class="comment">*</span>
06952 <span class="comment">* 06-20-91 ScottLu      Created.</span>
06953 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
06954 <span class="comment">\***************************************************************************/</span>
06955 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idsms(
06956 DWORD opts,
06957 PVOID param1)
06958 {
06959 
06960     <a class="code" href="../../d7/d6/structtagSMS.html">SMS</a> sms;
06961     <a class="code" href="../../d4/d1/userk_8h.html#a871">PSMS</a> psms;
06962     <span class="keywordtype">int</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> = 0;
06963     <span class="keywordtype">int</span> cm = 0;
06964 
06965     <span class="keywordflow">if</span> ((opts &amp; OFLAG(m)) || (param1 == 0)) {
06966         moveExpValuePtr(&amp;psms, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsmsList));
06967 
06968         <span class="keywordflow">if</span> (psms == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
06969             Print(<span class="stringliteral">"No send messages currently in the list.\n"</span>);
06970             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06971         }
06972 
06973         <span class="keywordflow">if</span> (opts &amp; OFLAG(c)) {
06974             <span class="comment">// just count the messages</span>
06975             SAFEWHILE (psms != NULL) {
06976                 <span class="keywordflow">if</span> ((<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> % 400) == 0) {
06977                     Print(<span class="stringliteral">"%d (0x%lx)...\n"</span>, c, c);
06978                 }
06979                 <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>++;
06980                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(psms, &amp;psms-&gt;psmsNext);
06981             }
06982         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opts &amp; OFLAG(m)) {
06983             <span class="comment">// show messages with msg == param1</span>
06984             SAFEWHILE (psms != NULL) {
06985                 <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>++;
06986                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(sms, psms);
06987                 <span class="keywordflow">if</span> (sms.<a class="code" href="../../d7/d6/structtagSMS.html#o12">message</a> == PtrToUlong(param1)) {
06988                     cm++;
06989                     Idsms(opts &amp; ~OFLAG(m), psms);
06990                 }
06991                 psms = sms.<a class="code" href="../../d7/d6/structtagSMS.html#o0">psmsNext</a>;
06992             }
06993             Print(<span class="stringliteral">"%d messages == 0x%lx (out of a total of %d).\n"</span>, cm, param1, c);
06994             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
06995         } <span class="keywordflow">else</span> {
06996             SAFEWHILE (psms != NULL) {
06997                 <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>++;
06998                 <span class="keywordflow">if</span> (!Idsms(opts, psms)) {
06999                     Print(<span class="stringliteral">"%d (0x%lx) messages.\n"</span>, c, c);
07000                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07001                 }
07002                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(psms, &amp;psms-&gt;psmsNext);
07003             }
07004         }
07005         Print(<span class="stringliteral">"%d (0x%lx) messages.\n"</span>, c, c);
07006         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07007     }
07008 
07009     psms = (<a class="code" href="../../d4/d1/userk_8h.html#a871">PSMS</a>)param1;
07010 
07011     Print(<span class="stringliteral">"PSMS @ 0x%p\n"</span>, psms);
07012     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(sms, psms);
07013 
07014     Print(<span class="stringliteral">"SEND: "</span>);
07015     <span class="keywordflow">if</span> (sms.<a class="code" href="../../d7/d6/structtagSMS.html#o3">ptiSender</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07016         Idt(OFLAG(p), sms.<a class="code" href="../../d7/d6/structtagSMS.html#o3">ptiSender</a>);
07017     } <span class="keywordflow">else</span> {
07018         Print(<span class="stringliteral">"NULL\n"</span>);
07019     }
07020 
07021     <span class="keywordflow">if</span> (sms.<a class="code" href="../../d7/d6/structtagSMS.html#o4">ptiReceiver</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07022         Print(<span class="stringliteral">"RECV: "</span>);
07023         Idt(OFLAG(p), sms.<a class="code" href="../../d7/d6/structtagSMS.html#o4">ptiReceiver</a>);
07024     } <span class="keywordflow">else</span> {
07025         Print(<span class="stringliteral">"NULL\n"</span>);
07026     }
07027 
07028     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
07029         <span class="keywordtype">char</span> ach[80];
07030 
07031         Print(<span class="stringliteral">"\tpsmsNext           0x%08lx\n"</span>
07032 #<span class="keywordflow">if</span> DBG
07033               <span class="stringliteral">"\tpsmsSendList       0x%08lx\n"</span>
07034               <span class="stringliteral">"\tpsmsSendNext       0x%08lx\n"</span>
07035 #endif
07036               <span class="stringliteral">"\tpsmsReceiveNext    0x%08lx\n"</span>
07037               <span class="stringliteral">"\ttSent              0x%08lx\n"</span>
07038               <span class="stringliteral">"\tptiSender          0x%08lx\n"</span>
07039               <span class="stringliteral">"\tptiReceiver        0x%08lx\n"</span>
07040               <span class="stringliteral">"\tlRet               0x%08lx\n"</span>
07041               <span class="stringliteral">"\tflags              %s\n"</span>
07042               <span class="stringliteral">"\twParam             0x%08lx\n"</span>
07043               <span class="stringliteral">"\tlParam             0x%08lx\n"</span>
07044               <span class="stringliteral">"\tmessage            0x%08lx\n"</span>,
07045               sms.<a class="code" href="../../d7/d6/structtagSMS.html#o0">psmsNext</a>,
07046 #<span class="keywordflow">if</span> DBG
07047               sms.psmsSendList,
07048               sms.psmsSendNext,
07049 #endif
07050               sms.<a class="code" href="../../d7/d6/structtagSMS.html#o1">psmsReceiveNext</a>,
07051               sms.<a class="code" href="../../d7/d6/structtagSMS.html#o2">tSent</a>,
07052               sms.<a class="code" href="../../d7/d6/structtagSMS.html#o3">ptiSender</a>,
07053               sms.<a class="code" href="../../d7/d6/structtagSMS.html#o4">ptiReceiver</a>,
07054               sms.<a class="code" href="../../d7/d6/structtagSMS.html#o8">lRet</a>,
07055               <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_SMS, (WORD)sms.<a class="code" href="../../d7/d6/structtagSMS.html#o9">flags</a>, NULL, TRUE),
07056               sms.<a class="code" href="../../d7/d6/structtagSMS.html#o10">wParam</a>,
07057               sms.<a class="code" href="../../d7/d6/structtagSMS.html#o11">lParam</a>,
07058               sms.<a class="code" href="../../d7/d6/structtagSMS.html#o12">message</a>);
07059         <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(sms.<a class="code" href="../../d7/d6/structtagSMS.html#o13">spwnd</a>, ach);
07060         Print(<span class="stringliteral">"\tspwnd              0x%08lx     \"%s\"\n"</span>, sms.<a class="code" href="../../d7/d6/structtagSMS.html#o13">spwnd</a>, ach);
07061     }
07062 
07063 <span class="preprocessor">#if DBG</span>
07064 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (opts &amp; OFLAG(l)) {
07065         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idThread;
07066         <a class="code" href="../../d4/d1/userk_8h.html#a871">PSMS</a> psmsList;
07067         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> idThreadSender, idThreadReceiver;
07068         <a class="code" href="../../d2/d8/structtagTHREADINFO.html">THREADINFO</a> ti;
07069 
07070         psmsList = sms.psmsSendList;
07071         <span class="keywordflow">if</span> (psmsList == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07072             Print(<span class="stringliteral">"%x : Empty List\n"</span>, psms);
07073         } <span class="keywordflow">else</span> {
07074             Print(<span class="stringliteral">"%x : [tidSender](msg)[tidReceiver]\n"</span>, psms);
07075         }
07076         SAFEWHILE (psmsList != NULL) {
07077             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(sms, psmsList);
07078             <span class="keywordflow">if</span> (sms.<a class="code" href="../../d7/d6/structtagSMS.html#o3">ptiSender</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07079                 idThread = 0;
07080             } <span class="keywordflow">else</span> {
07081                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ti, sms.<a class="code" href="../../d7/d6/structtagSMS.html#o3">ptiSender</a>);
07082                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(idThreadSender, &amp;(ti.pEThread-&gt;Cid.UniqueThread));
07083             }
07084             <span class="keywordflow">if</span> (sms.<a class="code" href="../../d7/d6/structtagSMS.html#o4">ptiReceiver</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07085                 idThread = 0;
07086             } <span class="keywordflow">else</span> {
07087                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ti, sms.<a class="code" href="../../d7/d6/structtagSMS.html#o4">ptiReceiver</a>);
07088                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(idThreadReceiver, &amp;(ti.pEThread-&gt;Cid.UniqueThread));
07089             }
07090             Print(<span class="stringliteral">"%x : [%x](%x)[%x]\n"</span>, psmsList, idThreadSender, sms.<a class="code" href="../../d7/d6/structtagSMS.html#o12">message</a>,
07091                     idThreadReceiver);
07092 
07093             <span class="keywordflow">if</span> (psmsList == sms.psmsSendNext) {
07094                 Print(<span class="stringliteral">"Loop in list?\n"</span>);
07095                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07096             }
07097 
07098             psmsList = sms.psmsSendNext;
07099         }
07100         Print(<span class="stringliteral">"\n"</span>);
07101     }
07102 <span class="preprocessor">#endif</span>
07103 <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07104 }
07105 <span class="preprocessor">#endif // KERNEL</span>
07106 <span class="preprocessor"></span>
07107 
07108 
07109 <span class="preprocessor">#ifdef KERNEL</span>
07110 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
07111 <span class="comment">* dt - dump thread</span>
07112 <span class="comment">*</span>
07113 <span class="comment">* dt            - dumps simple thread info of all threads which have queues</span>
07114 <span class="comment">*                 on server</span>
07115 <span class="comment">* dt v          - dumps verbose thread info of all threads which have queues</span>
07116 <span class="comment">*                 on server</span>
07117 <span class="comment">* dt id         - dumps simple thread info of single server thread id</span>
07118 <span class="comment">* dt v id       - dumps verbose thread info of single server thread id</span>
07119 <span class="comment">*</span>
07120 <span class="comment">* 06-20-91 ScottLu      Created.</span>
07121 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
07122 <span class="comment">\***************************************************************************/</span>
07123 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> DumpThread(
07124     DWORD opts,
07125     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> pEThread)
07126 {
07127     <a class="code" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a> EThread;
07128     WCHAR ach[256];
07129     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">THREADINFO</a> ti;
07130     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
07131     <a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html">CLIENTTHREADINFO</a> cti;
07132     <a class="code" href="../../d7/d6/structtagSMS.html">SMS</a> sms;
07133 
07134     <span class="keywordflow">if</span> (!tryMove(EThread, pEThread)) {
07135         Print(<span class="stringliteral">"Unable to read _ETHREAD at %lx\n"</span>,pEThread);
07136         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07137     }
07138 
07139     pti = EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o47">Win32Thread</a>;
07140     <span class="keywordflow">if</span> (!tryMove(ti, pti)) {
07141         <span class="keywordflow">if</span> (!(opts &amp; OFLAG(g))) {
07142             Print(<span class="stringliteral">"  et 0x%08lx t 0x???????? q 0x???????? i %2x.%-3lx &lt;unknown name&gt;\n"</span>,
07143                 pEThread,
07144                 EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueProcess,
07145                 EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueThread);
07146         }
07147         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07148     }
07149 
07150     <span class="keywordflow">if</span> (ti.pEThread != pEThread || pti == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07151         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
<a name="l07152"></a><a class="code" href="../../d2/d1/userexts_8c.html#a222">07152</a>     } <span class="keywordflow">else</span> { <span class="comment">// Good thread</span>
07153 
07154         <span class="comment">/*</span>
07155 <span class="comment">         * Print out simple thread info if this is in simple mode. Print</span>
07156 <span class="comment">         * out queue info if in verbose mode (printing out queue info</span>
07157 <span class="comment">         * also prints out simple thread info).</span>
07158 <span class="comment">         */</span>
07159         <span class="keywordflow">if</span> (!(opts &amp; OFLAG(v))) {
07160             PWCHAR pwch;
07161 
07162             GetAppName(&amp;EThread, &amp;ti, ach, <span class="keyword">sizeof</span>(ach));
07163             pwch = wcsrchr(ach, <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\\'</span>);
07164             <span class="keywordflow">if</span> (pwch == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07165                 pwch = ach;
07166             } <span class="keywordflow">else</span> {
07167                 pwch++;
07168             }
07169 
07170             Print(<span class="stringliteral">"  et 0x%08lx t 0x%08lx q 0x%08lx i %2x.%-3lx %ws\n"</span>,
07171                     pEThread,
07172                     pti,
07173                     ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>,
07174                     EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueProcess,
07175                     EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueThread,
07176                     pwch);
07177 
07178             <span class="comment">/*</span>
07179 <span class="comment">             * Dump thread input state if required</span>
07180 <span class="comment">             */</span>
07181             <span class="keywordflow">if</span> (opts &amp; OFLAG(s)) {
07182 <span class="preprocessor">                #define DT_INDENT "\t"</span>
07183 <span class="preprocessor"></span>                <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cti, ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o5">pcti</a>);
07184 
07185                 <span class="keywordflow">if</span> (cti.<a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html#o4">fsWakeMask</a> == 0) {
07186                     Print(DT_INDENT <span class="stringliteral">"Not waiting for USER input events.\n"</span>);
07187                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((cti.<a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html#o4">fsWakeMask</a> &amp; (QS_ALLINPUT | QS_EVENT)) == (QS_ALLINPUT | QS_EVENT)) {
07188                     Print(DT_INDENT <span class="stringliteral">"Waiting for any USER input event (== in GetMessage).\n"</span>);
07189                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((cti.<a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html#o4">fsWakeMask</a> == (QS_SMSREPLY | QS_SENDMESSAGE))
07190                             || (cti.<a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html#o4">fsWakeMask</a> == QS_SMSREPLY)) {
07191                     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(sms, ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o11">psmsSent</a>);
07192                     Print(DT_INDENT <span class="stringliteral">"Waiting on thread %#lx to reply to this SendMessage:\n"</span>, sms.<a class="code" href="../../d7/d6/structtagSMS.html#o4">ptiReceiver</a>);
07193                     Print(DT_INDENT <span class="stringliteral">"pwnd:%#lx message:%#lx wParam:%#lx lParam:%#lx\n"</span>,
07194                             sms.<a class="code" href="../../d7/d6/structtagSMS.html#o13">spwnd</a>, sms.<a class="code" href="../../d7/d6/structtagSMS.html#o12">message</a>, sms.<a class="code" href="../../d7/d6/structtagSMS.html#o10">wParam</a>, sms.<a class="code" href="../../d7/d6/structtagSMS.html#o11">lParam</a>);
07195                     <span class="keywordflow">if</span> (cti.<a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html#o1">fsChangeBits</a> &amp; QS_SMSREPLY) {
07196                         Print(DT_INDENT <span class="stringliteral">"The receiver thread has replied to the message.\n"</span>);
07197                     }
07198                 } <span class="keywordflow">else</span> {
07199                     Print(DT_INDENT <span class="stringliteral">"Waiting for: %s\n"</span>,
07200                                       <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a259a139">GF_QS</a>, (WORD)cti.<a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html#o4">fsWakeMask</a>, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>));
07201                 }
07202             }
07203 
07204         } <span class="keywordflow">else</span> {
07205             Idti(0, pti);
07206             Print(<span class="stringliteral">"--------\n"</span>);
07207         }
07208     }
07209     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07210 }
07211 
07212 <span class="keywordtype">void</span> DumpProcessThreads(
07213     DWORD opts,
07214     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> pEProcess,
07215     ULONG_PTR ThreadToDump)
07216 {
07217     PW32PROCESS pW32Process;
07218     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> pEThread;
07219     <a class="code" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a> EThread;
07220     LIST_ENTRY ThreadList;
07221     PLIST_ENTRY ThreadListHead;
07222     PLIST_ENTRY NextThread;
07223 
07224     <span class="comment">/*</span>
07225 <span class="comment">     * Dump threads of Win32 Processes only</span>
07226 <span class="comment">     */</span>
07227     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(pEProcess, PROCESS_WIN32PROCESS,&amp;pW32Process) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
07228             || (pW32Process == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
07229         <span class="keywordflow">return</span>;
07230     }
07231 
07232     ThreadListHead = <a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(pEProcess, PROCESS_THREADLIST, &amp;ThreadList);
07233     <span class="keywordflow">if</span> (ThreadListHead == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07234         <span class="keywordflow">return</span>;
07235     }
07236 
07237     NextThread = ThreadList.Flink;
07238 
07239     SAFEWHILE ( NextThread != ThreadListHead) {
07240         pEThread = (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)(CONTAINING_RECORD(NextThread, <a class="code" href="../../d1/d8/struct__KTHREAD.html">KTHREAD</a>, ThreadListEntry));
07241 
07242         <span class="keywordflow">if</span> (!tryMove(EThread, pEThread)) {
07243             Print(<span class="stringliteral">"Unable to read _ETHREAD at %#p\n"</span>,pEThread);
07244             <span class="keywordflow">break</span>;
07245         }
07246         NextThread = ((<a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>)&amp;EThread)-&gt;ThreadListEntry.Flink;
07247 
07248         <span class="comment">/*</span>
07249 <span class="comment">         * ThreadToDump is either 0 (all windows threads) or its</span>
07250 <span class="comment">         * a TID ( &lt; UserProbeAddress or its a pEThread.</span>
07251 <span class="comment">         */</span>
07252         <span class="keywordflow">if</span> (ThreadToDump == 0 ||
07253 
07254                 (ThreadToDump &lt; <a class="code" href="../../d3/d6/kdexts_8c.html#a10">UserProbeAddress</a> &amp;&amp;
07255                     ThreadToDump == (ULONG_PTR)EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueThread) ||
07256 
07257                 (ThreadToDump &gt;= <a class="code" href="../../d3/d6/kdexts_8c.html#a10">UserProbeAddress</a> &amp;&amp;
07258                     ThreadToDump == (ULONG_PTR)pEThread)) {
07259 
07260             <span class="keywordflow">if</span> (!DumpThread(opts, pEThread) &amp;&amp; ThreadToDump != 0) {
07261                 Print(<span class="stringliteral">"Sorry, EThread %#p is not a Win32 thread.\n"</span>,
07262                         pEThread);
07263             }
07264 
07265             <span class="keywordflow">if</span> (ThreadToDump != 0) {
07266                 <span class="keywordflow">return</span>;
07267             }
07268 
07269         } <span class="comment">// Chosen Thread</span>
<a name="l07270"></a><a class="code" href="../../d2/d1/userexts_8c.html#a223">07270</a>     } <span class="comment">// NextThread</span>
07271 }
07272 
07273 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idt(
07274 DWORD opts,
07275 PVOID param1)
07276 {
07277     ULONG_PTR ThreadToDump;
07278     LIST_ENTRY <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>;
07279     PLIST_ENTRY NextProcess;
07280     PLIST_ENTRY ProcessHead;
07281     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> pEProcess;
07282     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> pEThread;
07283     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">THREADINFO</a> ti;
07284     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
07285 
07286     ThreadToDump = (ULONG_PTR)param1;
07287 
07288     <span class="comment">/*</span>
07289 <span class="comment">     * If its a pti, validate it, and turn it into and idThread.</span>
07290 <span class="comment">     */</span>
07291     <span class="keywordflow">if</span> (opts &amp; OFLAG(p)) {
07292         <span class="keywordflow">if</span> (!param1) {
07293             Print(<span class="stringliteral">"Expected a pti parameter.\n"</span>);
07294             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07295         }
07296 
07297         pti = <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
07298 
07299         <span class="keywordflow">if</span> (pti == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07300             Print(<span class="stringliteral">"WARNING: bad pti given!\n"</span>);
07301             pti = param1;
07302         } <span class="keywordflow">else</span> {
07303             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ti, pti);
07304             <span class="keywordflow">if</span> (!DumpThread(opts, ti.pEThread)) {
07305                 <span class="comment">/*</span>
07306 <span class="comment">                 * This thread either doesn't have a pti or something</span>
07307 <span class="comment">                 * is whacked out.  Just skip it if we want all</span>
07308 <span class="comment">                 * threads.</span>
07309 <span class="comment">                 */</span>
07310                 Print(<span class="stringliteral">"Sorry, EThread %x is not a Win32 thread.\n"</span>,
07311                         ti.pEThread);
07312                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07313             }
07314             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07315         }
07316     }
07317 
07318     <span class="comment">/*</span>
07319 <span class="comment">     * If he just wants the current thread, located it.</span>
07320 <span class="comment">     */</span>
07321     <span class="keywordflow">if</span> (opts &amp; OFLAG(c)) {
07322         Print(<span class="stringliteral">"Current Thread:"</span>);
07323         ThreadToDump = (ULONG_PTR)GetCurrentThreadAddress(
07324                 (USHORT)dwProcessor, hCurrentThread );
07325 
07326         <span class="keywordflow">if</span> (ThreadToDump == 0) {
07327             Print(<span class="stringliteral">"Unable to get current thread pointer.\n"</span>);
07328             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07329         }
07330         pEThread = (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)ThreadToDump;
07331         <span class="keywordflow">if</span> (!DumpThread(opts, pEThread)) {
07332             <span class="comment">/*</span>
07333 <span class="comment">             * This thread either doesn't have a pti or something</span>
07334 <span class="comment">             * is whacked out.  Just skip it if we want all</span>
07335 <span class="comment">             * threads.</span>
07336 <span class="comment">             */</span>
07337             Print(<span class="stringliteral">"Sorry, EThread %x is not a Win32 thread.\n"</span>,
07338                     pEThread);
07339             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07340         }
07341         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07342     <span class="comment">/*</span>
07343 <span class="comment">     * else he must want all window threads.</span>
07344 <span class="comment">     */</span>
07345     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ThreadToDump == 0) {
07346         Print(<span class="stringliteral">"**** NT ACTIVE WIN32 THREADINFO DUMP ****\n"</span>);
07347     }
07348 
07349     ProcessHead = EvalExp( <span class="stringliteral">"PsActiveProcessHead"</span> );
07350     <span class="keywordflow">if</span> (!ProcessHead) {
07351         Print(<span class="stringliteral">"Unable to get value of PsActiveProcessHead\n"</span>);
07352         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07353     }
07354 
07355     <span class="keywordflow">if</span> (!tryMove(List, ProcessHead)) {
07356         Print(<span class="stringliteral">"Unable to get value of PsActiveProcessHead\n"</span>);
07357         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07358     }
07359     NextProcess = <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>.Flink;
07360     <span class="keywordflow">if</span> (NextProcess == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07361         Print(<span class="stringliteral">"PsActiveProcessHead-&gt;Flink is NULL!\n"</span>);
07362         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07363     }
07364 
07365     SAFEWHILE(NextProcess != ProcessHead) {
07366         pEProcess = <a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>((<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)NextProcess,
07367                                     PROCESS_PROCESSHEAD,
07368                                     NULL);
07369 
07370         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(pEProcess, PROCESS_PROCESSLINK,
07371                 &amp;List) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07372             Print(<span class="stringliteral">"Unable to read _EPROCESS at %lx\n"</span>,pEProcess);
07373             <span class="keywordflow">break</span>;
07374         }
07375         NextProcess = <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>.Flink;
07376 
07377         DumpProcessThreads(opts, pEProcess, ThreadToDump);
07378 
07379     } <span class="comment">// NextProcess</span>
07380 
07381     <span class="keywordflow">if</span> (opts &amp; OFLAG(c)) {
07382         Print(<span class="stringliteral">"%x is not a windows thread.\n"</span>, ThreadToDump);
07383     }
07384 
07385     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07386 }
07387 <span class="preprocessor">#endif // KERNEL</span>
07388 <span class="preprocessor"></span>
07389 <span class="preprocessor">#ifdef KERNEL</span>
07390 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
07391 <span class="comment">* dp - dump process</span>
07392 <span class="comment">*</span>
07393 <span class="comment">*</span>
07394 <span class="comment">* 06-27-97 GerardoB     Created.</span>
07395 <span class="comment">\***************************************************************************/</span>
07396 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> DumpProcess(
07397     DWORD opts,
07398     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> pEProcess)
07399 {
07400     <a class="code" href="../../d0/d4/struct__EPROCESS.html">EPROCESS</a> EProcess;
07401     WCHAR ach[256];
07402     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PROCESSINFO</a> pi;
07403     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a> ppi;
07404 
07405     <span class="keywordflow">if</span> (!tryMove(EProcess, pEProcess)) {
07406         Print(<span class="stringliteral">"Unable to read _EPROCESS at %lx\n"</span>,pEProcess);
07407         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07408     }
07409 
07410     ppi = <a class="code" href="../../d4/d1/userk_8h.html#a18">PpiFromProcess</a>(&amp;EProcess);
07411 
07412     <span class="keywordflow">if</span> (!tryMove(pi, ppi)) {
07413         Print(<span class="stringliteral">"sid %2d ep 0x%08lx p 0x???????? f 0x???????? i %2x &lt;unknown name&gt;\n"</span>,
07414                 EProcess.<a class="code" href="../../d0/d4/struct__EPROCESS.html#o60">SessionId</a>,
07415                 pEProcess,
07416                 EProcess.<a class="code" href="../../d0/d4/struct__EPROCESS.html#o7">UniqueProcessId</a>);
07417         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07418     }
07419 
07420     <span class="keywordflow">if</span> (pi.Process != pEProcess || ppi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07421         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07422     } <span class="keywordflow">else</span> { <span class="comment">// Good process</span>
07423 
07424         <span class="comment">/*</span>
07425 <span class="comment">         * Print out simple process info if this is in simple mode.</span>
07426 <span class="comment">         */</span>
07427         <span class="keywordflow">if</span> (!(opts &amp; OFLAG(v))) {
07428             PWCHAR pwch;
07429 
07430             GetProcessName(pEProcess, ach);
07431             pwch = wcsrchr(ach, L<span class="charliteral">'\\'</span>);
07432             <span class="keywordflow">if</span> (pwch == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07433                 pwch = ach;
07434             } <span class="keywordflow">else</span> {
07435                 pwch++;
07436             }
07437 
07438             Print(<span class="stringliteral">"sid %2d ep 0x%08lx p 0x%08lx f 0x%08lx i %2x %ws\n"</span>,
07439                     EProcess.<a class="code" href="../../d0/d4/struct__EPROCESS.html#o60">SessionId</a>,
07440                     pEProcess,
07441                     ppi,
07442                     pi.W32PF_Flags,
07443                     EProcess.<a class="code" href="../../d0/d4/struct__EPROCESS.html#o7">UniqueProcessId</a>,
07444                     pwch);
07445         } <span class="keywordflow">else</span> {
07446             Idpi(0, ppi);
07447             Print(<span class="stringliteral">"--------\n"</span>);
07448         }
07449 
07450         <span class="comment">/*</span>
07451 <span class="comment">         * Dump all threads if required</span>
07452 <span class="comment">         */</span>
07453         <span class="keywordflow">if</span> (opts &amp; OFLAG(t)) {
07454             DumpProcessThreads(opts, pEProcess, 0);
07455         }
07456     }
07457     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07458 }
07459 
07460 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idp(
07461 DWORD opts,
07462 PVOID param1)
07463 {
07464     ULONG_PTR ProcessToDump;
07465     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PROCESSINFO</a> pi;
07466     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a> ppi;
07467     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> pEProcess;
07468     <a class="code" href="../../d0/d4/struct__EPROCESS.html">EPROCESS</a> EProcess;
07469     LIST_ENTRY <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>;
07470     PLIST_ENTRY NextProcess;
07471     PLIST_ENTRY ProcessHead;
07472     PW32PROCESS pW32Process;
07473 
07474     ProcessToDump = (ULONG_PTR)param1;
07475 
07476     <span class="comment">/*</span>
07477 <span class="comment">     * If its a ppi, validate it</span>
07478 <span class="comment">     */</span>
07479     <span class="keywordflow">if</span> (opts &amp; OFLAG(p)) {
07480         <span class="keywordflow">if</span> (!param1) {
07481             Print(<span class="stringliteral">"Expected a ppi parameter.\n"</span>);
07482             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07483         }
07484 
07485         ppi = <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
07486 
07487         <span class="keywordflow">if</span> (ppi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07488             Print(<span class="stringliteral">"WARNING: bad ppi given!\n"</span>);
07489             ppi = param1;
07490         } <span class="keywordflow">else</span> {
07491             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pi, ppi);
07492             <span class="keywordflow">if</span> (!DumpProcess(opts, pi.Process)) {
07493                 Print(<span class="stringliteral">"Sorry, EProcess %x is not a Win32 process.\n"</span>,
07494                         pi.Process);
07495                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07496             }
07497             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07498         }
07499     }
07500 
07501     <span class="comment">/*</span>
07502 <span class="comment">     * If he just wants the current process, located it.</span>
07503 <span class="comment">     */</span>
07504     <span class="keywordflow">if</span> (opts &amp; OFLAG(c)) {
07505         Print(<span class="stringliteral">"Current Process:"</span>);
07506         ProcessToDump = (ULONG_PTR)GetCurrentProcessAddress(
07507                 (USHORT)dwProcessor, hCurrentThread, NULL);
07508 
07509         <span class="keywordflow">if</span> (ProcessToDump == 0) {
07510             Print(<span class="stringliteral">"Unable to get current process pointer.\n"</span>);
07511             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07512         }
07513         pEProcess = (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)ProcessToDump;
07514         <span class="keywordflow">if</span> (!DumpProcess(opts, pEProcess)) {
07515             Print(<span class="stringliteral">"Sorry, EProcess %x is not a Win32 process.\n"</span>, pEProcess);
07516             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07517         }
07518         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07519     <span class="comment">/*</span>
07520 <span class="comment">     * else he must want all window threads.</span>
07521 <span class="comment">     */</span>
07522     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ProcessToDump == 0) {
07523         Print(<span class="stringliteral">"**** NT ACTIVE WIN32 PROCESSINFO DUMP ****\n"</span>);
07524     }
07525 
07526     ProcessHead = EvalExp( <span class="stringliteral">"PsActiveProcessHead"</span> );
07527     <span class="keywordflow">if</span> (!ProcessHead) {
07528         Print(<span class="stringliteral">"Unable to get value of PsActiveProcessHead\n"</span>);
07529         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07530     }
07531 
07532     <span class="keywordflow">if</span> (!tryMove(List, ProcessHead)) {
07533         Print(<span class="stringliteral">"Unable to get value of PsActiveProcessHead\n"</span>);
07534         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07535     }
07536     NextProcess = <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>.Flink;
07537     <span class="keywordflow">if</span> (NextProcess == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07538         Print(<span class="stringliteral">"PsActiveProcessHead-&gt;Flink is NULL!\n"</span>);
07539         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07540     }
07541 
07542     SAFEWHILE(NextProcess != ProcessHead) {
07543         pEProcess = <a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>((<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)NextProcess,
07544                                     PROCESS_PROCESSHEAD,
07545                                     NULL);
07546 
07547         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(pEProcess, PROCESS_PROCESSLINK,
07548                 &amp;List) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07549             Print(<span class="stringliteral">"Unable to read _EPROCESS at %#p\n"</span>,pEProcess);
07550             <span class="keywordflow">break</span>;
07551         }
07552         NextProcess = <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>.Flink;
07553 
07554         <span class="comment">/*</span>
07555 <span class="comment">         * Dump threads of Win32 Processes only</span>
07556 <span class="comment">         */</span>
07557         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(pEProcess, PROCESS_WIN32PROCESS,
07558                 &amp;pW32Process) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || pW32Process == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07559             <span class="keywordflow">continue</span>;
07560         }
07561 
07562         <span class="keywordflow">if</span> (!tryMove(EProcess, pEProcess)) {
07563             Print(<span class="stringliteral">"Unable to read _EPROCESS at %lx\n"</span>,pEProcess);
07564             <span class="keywordflow">break</span>;
07565         }
07566         <span class="comment">/*</span>
07567 <span class="comment">         * ProcessToDump is either 0 (all windows processes) or its</span>
07568 <span class="comment">         * a TID ( &lt; UserProbeAddress or its a pEPRocess.</span>
07569 <span class="comment">         */</span>
07570         <span class="keywordflow">if</span> (ProcessToDump == 0 ||
07571 
07572                 (ProcessToDump &lt; <a class="code" href="../../d3/d6/kdexts_8c.html#a10">UserProbeAddress</a> &amp;&amp;
07573                     ProcessToDump == (ULONG_PTR)EProcess.<a class="code" href="../../d0/d4/struct__EPROCESS.html#o7">UniqueProcessId</a>) ||
07574 
07575                 (ProcessToDump &gt;= <a class="code" href="../../d3/d6/kdexts_8c.html#a10">UserProbeAddress</a> &amp;&amp;
07576                     ProcessToDump == (ULONG_PTR)pEProcess)) {
07577 
07578             <span class="keywordflow">if</span> (!DumpProcess(opts, pEProcess)
07579                     &amp;&amp; (ProcessToDump != 0)) {
07580                 Print(<span class="stringliteral">"Sorry, EProcess %#p is not a Win32 process.\n"</span>,
07581                         pEProcess);
07582             }
07583 
07584             <span class="keywordflow">if</span> (ProcessToDump != 0) {
07585                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07586             }
07587         }
07588 
07589     } <span class="comment">// NextProcess</span>
07590 
07591     <span class="keywordflow">if</span> (opts &amp; OFLAG(c)) {
07592         Print(<span class="stringliteral">"%#p is not a windows process.\n"</span>, ProcessToDump);
07593     }
07594 
07595     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07596 }
07597 <span class="preprocessor">#endif // KERNEL</span>
07598 <span class="preprocessor"></span>
07599 
07600 
07601 <span class="preprocessor">#ifdef KERNEL</span>
07602 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
07603 <span class="comment">* dtdb - dump TDB</span>
07604 <span class="comment">*</span>
07605 <span class="comment">* dtdb address - dumps TDB structure at address</span>
07606 <span class="comment">*</span>
07607 <span class="comment">* 14-Sep-1993 DaveHart  Created.</span>
07608 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
07609 <span class="comment">\***************************************************************************/</span>
07610 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idtdb(
07611 DWORD opts,
07612 PVOID param1)
07613 {
07614 
07615     <a class="code" href="../../d0/d8/structtagTDB.html">PTDB</a> ptdb;
07616     <a class="code" href="../../d0/d8/structtagTDB.html">TDB</a> tdb;
07617     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
07618 
07619     UNREFERENCED_PARAMETER(opts);
07620 
07621     <span class="keywordflow">if</span> (param1 == 0) {
07622         Print(<span class="stringliteral">"Dumping all ptdbs:\n"</span>);
07623         FOREACHPTI(pti)
07624             move(ptdb, &amp;pti-&gt;ptdb);
07625             SAFEWHILE (ptdb) {
07626                 Idtdb(0, ptdb);
07627                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ptdb, &amp;ptdb-&gt;ptdbNext);
07628             }
07629         NEXTEACHPTI(pti)
07630         return TRUE;
07631     }
07632 
07633     ptdb = (<a class="code" href="../../d0/d8/structtagTDB.html">PTDB</a>)param1;
07634 
07635     if (ptdb == NULL) {
07636         Print(<span class="stringliteral">"Must supply a TDB address.\n"</span>);
07637         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07638     }
07639 
07640     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(tdb, ptdb);
07641 
07642     Print(<span class="stringliteral">"TDB (non preemptive scheduler task database) @ 0x%p\n"</span>, ptdb);
07643     Print(<span class="stringliteral">"\tptdbNext          @0x%p\n"</span>, tdb.<a class="code" href="../../d0/d8/structtagTDB.html#o0">ptdbNext</a>);
07644     Print(<span class="stringliteral">"\tnEvents            0x%08lx\n"</span>, tdb.<a class="code" href="../../d0/d8/structtagTDB.html#o1">nEvents</a>);
07645     Print(<span class="stringliteral">"\tnPriority          0x%08lx\n"</span>, tdb.<a class="code" href="../../d0/d8/structtagTDB.html#o2">nPriority</a>);
07646     Print(<span class="stringliteral">"\tpti               @0x%p\n"</span>, tdb.<a class="code" href="../../d0/d8/structtagTDB.html#o3">pti</a>);
07647     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07648 }
07649 <span class="preprocessor">#endif // KERNEL</span>
07650 <span class="preprocessor"></span>
07651 <span class="preprocessor">#ifndef KERNEL</span>
07652 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
07653 <span class="comment">* Procedure: Ikbp</span>
07654 <span class="comment">*</span>
07655 <span class="comment">* Description: Breaks into the kernel debugger</span>
07656 <span class="comment">*</span>
07657 <span class="comment">* Returns: fSuccess</span>
07658 <span class="comment">*</span>
07659 <span class="comment">* 7/2/96 Fritz Sands</span>
07660 <span class="comment">*</span>
07661 <span class="comment">\************************************************************************/</span>
07662 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a227">Ikbp</a>()
07663 {
07664     <span class="keyword">static</span> HANDLE ghToken = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
07665     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fFirstTry = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07666     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
07667 
07668 <span class="preprocessor">#if 0 </span><span class="comment">/* NTSD itself sets this privilege */</span>
07669     <span class="comment">/*</span>
07670 <span class="comment">     * Enable SeDebugPrivilege the first time around</span>
07671 <span class="comment">     */</span>
07672     <span class="keywordflow">if</span> (ghToken == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07673         LUID luid;
07674         TOKEN_PRIVILEGES tp, tpPrevious;
07675         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbSizePrevious, dwGLE;
07676 
07677         fFirstTry = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07678         <span class="keywordflow">if</span> (!OpenProcessToken(GetCurrentProcess(), TOKEN_QUERY | TOKEN_ADJUST_PRIVILEGES, &amp;ghToken)) {
07679             Print(<span class="stringliteral">"!kbp failed to open process token. GLE:%d\n"</span>, GetLastError());
07680             <span class="keywordflow">goto</span> TryItAnyway;
07681         }
07682         <span class="keywordflow">if</span> (!LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &amp;luid)) {
07683             Print(<span class="stringliteral">"!kbp failed to lookup debug privilege. GLE:%d\n"</span>, GetLastError());
07684             <span class="keywordflow">goto</span> TryItAnyway;
07685         }
07686         <span class="comment">/*</span>
07687 <span class="comment">         * Get the current setting attributes</span>
07688 <span class="comment">         */</span>
07689         tp.PrivilegeCount = 1;
<a name="l07690"></a><a class="code" href="../../d2/d1/userexts_8c.html#a224">07690</a>         tp.Privileges[0].Luid = luid;
07691         tp.Privileges[0].Attributes = 0;
07692         AdjustTokenPrivileges(ghToken, FALSE, &amp;tp, <span class="keyword">sizeof</span>(TOKEN_PRIVILEGES), &amp;tpPrevious,&amp;cbSizePrevious);
07693         dwGLE = GetLastError();
07694         <span class="keywordflow">if</span> (dwGLE != ERROR_SUCCESS) {
07695             Print(<span class="stringliteral">"!kbp failed to get current privilege setting. GLE:%d\n"</span>, dwGLE);
07696             <span class="keywordflow">goto</span> TryItAnyway;
07697         }
07698         <span class="comment">/*</span>
07699 <span class="comment">         * Enable it</span>
07700 <span class="comment">         */</span>
07701         tpPrevious.PrivilegeCount = 1;
07702         tpPrevious.Privileges[0].Luid   = luid;
07703         tpPrevious.Privileges[0].Attributes |= SE_PRIVILEGE_ENABLED;
07704         AdjustTokenPrivileges(ghToken, FALSE, &amp;tpPrevious,cbSizePrevious, NULL, NULL);
07705         dwGLE = GetLastError();
07706         <span class="keywordflow">if</span> (dwGLE != ERROR_SUCCESS) {
07707             Print(<span class="stringliteral">"!kbp failed to get adjust privilege setting. GLE:%d\n"</span>, dwGLE);
07708             <span class="keywordflow">goto</span> TryItAnyway;
07709         }
07710 
07711         CloseHandle(ghToken);
07712         fFirstTry = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07713     } <span class="comment">/* if (ghToken == NULL) */</span>
07714 
07715 
07716 TryItAnyway:
07717     <span class="keywordflow">if</span> (fFirstTry &amp;&amp; (ghToken != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
07718         CloseHandle(ghToken);
07719     }
07720 <span class="preprocessor">#endif</span>
07721 <span class="preprocessor"></span>
07722     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d3/dbgctrl_8c.html#a0">NtSystemDebugControl</a>(SysDbgBreakPoint, NULL, 0, NULL, 0, NULL);
07723     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
07724         Print(<span class="stringliteral">"!kbp NtSystemDebugControl failed. Status:%#lx\n"</span>, Status);
07725         <span class="keywordflow">if</span> (fFirstTry) {
07726             ghToken = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
07727         }
07728         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07729     } <span class="keywordflow">else</span> {
07730         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07731     }
07732 }
07733 
07734 <span class="preprocessor">#endif // !KERNEL</span>
07735 <span class="preprocessor"></span>
07736 <span class="preprocessor">#ifndef KERNEL</span>
07737 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
07738 <span class="comment">* Procedure: Icbp</span>
07739 <span class="comment">*</span>
07740 <span class="comment">* Description: Breaks into the debugger in context of csrss.exe.</span>
07741 <span class="comment">*</span>
07742 <span class="comment">* Returns: fSuccess</span>
07743 <span class="comment">*</span>
07744 <span class="comment">* 6/1/98 JerrySh</span>
07745 <span class="comment">*</span>
07746 <span class="comment">\************************************************************************/</span>
07747 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a228">Icbp</a>(VOID)
07748 {
07749     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwProcessId;
07750     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwThreadId;
07751     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fServerProcess;
07752     <a class="code" href="../../d3/d4/struct__USER__API__MSG.html">USER_API_MSG</a> m;
07753     <a class="code" href="../../d6/d5/struct__ACTIVATEDEBUGGERMSG.html">PACTIVATEDEBUGGERMSG</a> a = &amp;m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o15">u</a>.ActivateDebugger;
07754 
07755     moveExpValue(&amp;fServerProcess, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gfServerProcess));
07756 
07757     <span class="keywordflow">if</span> (fServerProcess) {
07758         Print(<span class="stringliteral">"Already debugging server process!\n"</span>);
07759     } <span class="keywordflow">else</span> {
07760         <span class="comment">/*</span>
07761 <span class="comment">         * Get the process and thread ID of a CSRSS thread.</span>
07762 <span class="comment">         */</span>
<a name="l07763"></a><a class="code" href="../../d2/d1/userexts_8c.html#a225">07763</a>         dwThreadId = <a class="code" href="../../d3/d8/winmgrc_8c.html#a18">GetWindowThreadProcessId</a>(<a class="code" href="../../d3/d9/client_2wow_8c.html#a4">GetDesktopWindow</a>(), &amp;dwProcessId);
07764         a-&gt;<a class="code" href="../../d6/d5/struct__ACTIVATEDEBUGGERMSG.html#o0">ClientId</a>.UniqueProcess = (HANDLE)LongToHandle(dwProcessId);
07765         a-&gt;<a class="code" href="../../d6/d5/struct__ACTIVATEDEBUGGERMSG.html#o0">ClientId</a>.UniqueThread = (HANDLE)LongToHandle(dwThreadId);
07766 
07767         <span class="comment">/*</span>
07768 <span class="comment">         * Tell CSRSS to break on itself.</span>
07769 <span class="comment">         */</span>
07770         <a class="code" href="../../d8/d9/wow64csr_8c.html#a4">CsrClientCallServer</a>( (PCSR_API_MSG)&amp;m,
07771                              NULL,
07772                              CSR_MAKE_API_NUMBER( USERSRV_SERVERDLL_INDEX,
07773                                                   UserpActivateDebugger
07774                                                 ),
07775                              <span class="keyword">sizeof</span>(*a)
07776                            );
07777     }
07778 
07779     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07780 }
07781 
07782 <span class="preprocessor">#endif // !KERNEL</span>
07783 <span class="preprocessor"></span>
07784 <span class="preprocessor">#ifndef KERNEL</span>
07785 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
07786 <span class="comment">* Procedure: Idteb</span>
07787 <span class="comment">*</span>
07788 <span class="comment">* Description: Dumps the target process's TEB</span>
07789 <span class="comment">*</span>
07790 <span class="comment">* Returns: fSuccess</span>
07791 <span class="comment">*</span>
07792 <span class="comment">* 6/15/1995 Created SanfordS</span>
07793 <span class="comment">*</span>
07794 <span class="comment">\************************************************************************/</span>
07795 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a229">Idteb</a>()
07796 {
07797     TEB teb, *pteb;
07798 
07799     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a190">GetTargetTEB</a>(&amp;teb, &amp;pteb)) {
07800         Print(<span class="stringliteral">"TEB @ 0x%p:\n"</span>, pteb);
07801         <span class="comment">// NT_TIB NtTib;</span>
07802         <span class="comment">//     struct _EXCEPTION_REGISTRATION_RECORD *ExceptionList;</span>
07803         <span class="comment">//     PVOID StackBase;</span>
07804         <span class="comment">//     PVOID StackLimit;</span>
07805         <span class="comment">//     PVOID SubSystemTib;</span>
07806         <span class="comment">//     ULONG Version;</span>
07807         <span class="comment">//     PVOID ArbitraryUserPointer;</span>
07808         <span class="comment">//     struct _NT_TIB *Self;</span>
07809         <span class="comment">// PVOID  EnvironmentPointer;</span>
<a name="l07810"></a><a class="code" href="../../d2/d1/userexts_8c.html#a226">07810</a>         <span class="comment">// CLIENT_ID ClientId;</span>
07811         Print(<span class="stringliteral">"\tClientId                       %08lx\n"</span>, teb.ClientId);
07812         <span class="comment">// PVOID ActiveRpcHandle;</span>
07813         <span class="comment">// PVOID ThreadLocalStoragePointer;</span>
07814         <span class="comment">// PPEB ProcessEnvironmentBlock;</span>
07815         <span class="comment">// ULONG LastErrorValue;</span>
07816         Print(<span class="stringliteral">"\tLastErrorValue                 %08lx\n"</span>, teb.LastErrorValue);
07817         <span class="comment">// ULONG CountOfOwnedCriticalSections;</span>
07818         Print(<span class="stringliteral">"\tCountOfOwnedCriticalSections   %08lx\n"</span>, teb.CountOfOwnedCriticalSections);
07819         <span class="comment">// PVOID Win32ThreadInfo;          // PtiCurrent</span>
07820         Print(<span class="stringliteral">"\tWin32ThreadInfo(pti)           %p\n"</span>, teb.Win32ThreadInfo);
07821         <span class="comment">// PVOID CsrQlpcStack;</span>
07822         <span class="comment">// UCHAR SpareBytes[124];</span>
07823         <span class="comment">// LCID CurrentLocale;</span>
07824         <span class="comment">// ULONG FpSoftwareStatusRegister;</span>
07825         <span class="comment">// PVOID Win32ClientInfo[54];</span>
07826         Print(<span class="stringliteral">"\tWin32ClientInfo[0](pci)        %08lx\n"</span>, teb.Win32ClientInfo[0]);
07827         <span class="comment">// PVOID Spare1;                   // User Debug info</span>
07828         <span class="comment">// NTSTATUS ExceptionCode;         // for RaiseUserException</span>
07829         <span class="comment">// PVOID CsrQlpcTeb[QLPC_TEB_LENGTH];</span>
07830         <span class="comment">// PVOID Win32ClientInfo[WIN32_CLIENT_INFO_LENGTH];</span>
07831         Print(<span class="stringliteral">"\tWin32ClientInfo(pcti)         @%p\n"</span>, &amp;pteb-&gt;Win32ClientInfo[0]);
07832         <span class="comment">// PVOID SystemReserved2[322];</span>
07833         <span class="comment">// ULONG GdiClientPID;</span>
07834         Print(<span class="stringliteral">"\tGdiClientPID                   %08lx\n"</span>, teb.GdiClientPID);
07835         <span class="comment">// ULONG GdiClientTID;</span>
07836         Print(<span class="stringliteral">"\tGdiClientTID                   %08lx\n"</span>, teb.GdiClientTID);
07837         <span class="comment">// PVOID GdiThreadLocalInfo;</span>
07838         Print(<span class="stringliteral">"\tGdiThreadLocalInfo             %08lx\n"</span>, teb.GdiThreadLocalInfo);
07839         <span class="comment">// PVOID User32Reserved0;          // User app spin count</span>
07840         <span class="comment">// PVOID User32Reserved1;</span>
07841         <span class="comment">// PVOID glDispatchTable[307];     // OpenGL</span>
07842         <span class="comment">// PVOID glSectionInfo;            // OpenGL</span>
07843         <span class="comment">// PVOID glSection;                // OpenGL</span>
07844         <span class="comment">// PVOID glTable;                  // OpenGL</span>
07845         <span class="comment">// PVOID glCurrentRC;              // OpenGL</span>
07846         <span class="comment">// PVOID glContext;                // OpenGL</span>
07847         <span class="comment">// ULONG LastStatusValue;</span>
07848         <span class="comment">// UNICODE_STRING StaticUnicodeString;</span>
07849         <span class="comment">// WCHAR StaticUnicodeBuffer[STATIC_UNICODE_BUFFER_LENGTH];</span>
07850         <span class="comment">// PVOID DeallocationStack;</span>
07851         <span class="comment">// PVOID TlsSlots[TLS_MINIMUM_AVAILABLE];</span>
07852         <span class="comment">// LIST_ENTRY TlsLinks;</span>
07853         <span class="comment">// PVOID Vdm;</span>
07854         <span class="comment">// PVOID ReservedForNtRpc;</span>
07855         <span class="comment">// PVOID DbgSsReserved[2];</span>
07856     } <span class="keywordflow">else</span> {
07857         Print(<span class="stringliteral">"Unable to get TEB info.\n"</span>);
07858     }
07859     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07860 }
07861 <span class="preprocessor">#endif // !KERNEL</span>
07862 <span class="preprocessor"></span>
07863 
07864 <span class="preprocessor">#ifdef KERNEL</span>
07865 <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span>_tagBASECHARSET {
07866     LPSTR pstrCS;
07867     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwValue;
07868 } BASECHARSET;
07869 
07870 BASECHARSET CrackCS[] = {
07871     {<span class="stringliteral">"ANSI_CHARSET"</span>            ,0   },
07872     {<span class="stringliteral">"DEFAULT_CHARSET"</span>         ,1   },
07873     {<span class="stringliteral">"SYMBOL_CHARSET"</span>          ,2   },
07874     {<span class="stringliteral">"SHIFTJIS_CHARSET"</span>        ,128 },
07875     {<span class="stringliteral">"HANGEUL_CHARSET"</span>         ,129 },
07876     {<span class="stringliteral">"GB2312_CHARSET"</span>          ,134 },
07877     {<span class="stringliteral">"CHINESEBIG5_CHARSET"</span>     ,136 },
07878     {<span class="stringliteral">"OEM_CHARSET"</span>             ,255 },
07879     {<span class="stringliteral">"JOHAB_CHARSET"</span>           ,130 },
07880     {<span class="stringliteral">"HEBREW_CHARSET"</span>          ,177 },
07881     {<span class="stringliteral">"ARABIC_CHARSET"</span>          ,178 },
07882     {<span class="stringliteral">"GREEK_CHARSET"</span>           ,161 },
07883     {<span class="stringliteral">"TURKISH_CHARSET"</span>         ,162 },
07884     {<span class="stringliteral">"THAI_CHARSET"</span>            ,222 },
07885     {<span class="stringliteral">"EASTEUROPE_CHARSET"</span>      ,238 },
07886     {<span class="stringliteral">"RUSSIAN_CHARSET"</span>         ,204 },
07887     {<span class="stringliteral">"MAC_CHARSET"</span>             ,77  }};
07888 
07889 <span class="comment">/***************************************************************************\</span>
07890 <span class="comment">* dkl - dump keyboard layout</span>
07891 <span class="comment">*</span>
07892 <span class="comment">* dkl address      - dumps keyboard layout structure at address</span>
07893 <span class="comment">*</span>
07894 <span class="comment">* 05/21/95 GregoryW        Created.</span>
07895 <span class="comment">\***************************************************************************/</span>
07896 
07897 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idkl(
07898 DWORD opts,
07899 PVOID param1)
07900 {
07901     LIST_ENTRY <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>;
07902     LIST_ENTRY ThreadList;
07903     PLIST_ENTRY NextProcess;
07904     PLIST_ENTRY NextThread;
07905     PLIST_ENTRY ProcessHead;
07906     PLIST_ENTRY ThreadListHead;
07907     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> pEProcess;
07908     PW32PROCESS pW32Process;
07909     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> pEThread;
07910     <a class="code" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a> EThread;
07911     WCHAR ach[256];
07912     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">THREADINFO</a> ti;
07913     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
07914     <a class="code" href="../../d4/d9/structtagKL.html">KL</a> kl, *pkl, *pklAnchor;
07915     <a class="code" href="../../d1/d9/structtagKBDFILE.html">KBDFILE</a> kf;
07916     KBDTABLES KbdTbl;
07917     <span class="keywordtype">int</span> i;
07918     <span class="keywordtype">int</span> nThread;
07919 
07920 
07921     <span class="keywordflow">if</span> (opts &amp; OFLAG(k)) {
07922         <span class="keywordflow">goto</span> display_layouts;
07923     }
07924 
07925     <span class="keywordflow">if</span> (param1 == 0) {
07926         Print(<span class="stringliteral">"Using gspklBaseLayout\n"</span>);
07927         moveExpValuePtr(&amp;pkl, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gspklBaseLayout));
07928         <span class="keywordflow">if</span> (!pkl) {
07929             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07930         }
07931     } <span class="keywordflow">else</span> {
07932         pkl = (<a class="code" href="../../d4/d9/structtagKL.html">PKL</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
07933     }
07934 
07935     <span class="keywordflow">if</span> (pkl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07936         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07937     }
07938 
07939     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(kl, pkl);
07940 
07941     Print(<span class="stringliteral">"KL @ 0x%p (cLockObj = %d)\n"</span>, pkl, kl.<a class="code" href="../../d4/d9/structtagKL.html#o0">head</a>.<a class="code" href="../../d4/d5/struct__HEAD.html#o1">cLockObj</a>);
07942     Print(<span class="stringliteral">"  pklNext       @0x%p\n"</span>, kl.<a class="code" href="../../d4/d9/structtagKL.html#o1">pklNext</a>);
07943     Print(<span class="stringliteral">"  pklPrev       @0x%p\n"</span>, kl.<a class="code" href="../../d4/d9/structtagKL.html#o2">pklPrev</a>);
07944     Print(<span class="stringliteral">"  dwKL_Flags     0x%08lx\n"</span>, kl.<a class="code" href="../../d4/d9/structtagKL.html#o3">dwKL_Flags</a>);
07945     Print(<span class="stringliteral">"  hkl            0x%08lx\n"</span>, kl.<a class="code" href="../../d4/d9/structtagKL.html#o4">hkl</a>);
07946     Print(<span class="stringliteral">"  piiex         @0x%p\n"</span>, kl.<a class="code" href="../../d4/d9/structtagKL.html#o10">piiex</a>);
07947 
07948     <span class="keywordflow">if</span> (kl.<a class="code" href="../../d4/d9/structtagKL.html#o5">spkf</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
07949         Print(<span class="stringliteral">"  spkf          @0x%p (NONE!)\n"</span>, kl.<a class="code" href="../../d4/d9/structtagKL.html#o5">spkf</a>);
07950     }<span class="keywordflow">else</span> {
07951         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(kf, kl.<a class="code" href="../../d4/d9/structtagKL.html#o5">spkf</a>);
07952 
07953         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(KbdTbl, kf.<a class="code" href="../../d1/d9/structtagKBDFILE.html#o4">pKbdTbl</a>);
07954 
07955         Print(<span class="stringliteral">"  spkf          @0x%p (cLockObj = %d)\n"</span>, kl.<a class="code" href="../../d4/d9/structtagKL.html#o5">spkf</a>, kf.<a class="code" href="../../d1/d9/structtagKBDFILE.html#o0">head</a>.<a class="code" href="../../d4/d5/struct__HEAD.html#o1">cLockObj</a>);
07956         Print(<span class="stringliteral">"     pkfNext       @0x%p\n"</span>, kf.<a class="code" href="../../d1/d9/structtagKBDFILE.html#o1">pkfNext</a>);
07957         Print(<span class="stringliteral">"     awchKF[]      L\"%ws\"\n"</span>, &amp;kf.<a class="code" href="../../d1/d9/structtagKBDFILE.html#o2">awchKF</a>[0]);
07958         Print(<span class="stringliteral">"     hBase          0x%08lx\n"</span>, kf.<a class="code" href="../../d1/d9/structtagKBDFILE.html#o3">hBase</a>);
07959         Print(<span class="stringliteral">"     pKbdTbl       @0x%p\n"</span>, kf.<a class="code" href="../../d1/d9/structtagKBDFILE.html#o4">pKbdTbl</a>);
07960         Print(<span class="stringliteral">"        fLocaleFlags 0x%08lx\n"</span>, KbdTbl.fLocaleFlags);
07961         Print(<span class="stringliteral">"  dwFontSigs        %s\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_CHARSETS, kl.<a class="code" href="../../d4/d9/structtagKL.html#o6">dwFontSigs</a>, NULL, TRUE));
07962     }
07963 
07964     <span class="keywordflow">for</span> (i = 0; i &lt; (<span class="keyword">sizeof</span>(CrackCS) / <span class="keyword">sizeof</span>(BASECHARSET)); i++) {
07965         <span class="keywordflow">if</span> (CrackCS[i].dwValue == kl.<a class="code" href="../../d4/d9/structtagKL.html#o7">iBaseCharset</a>) {
07966             <span class="keywordflow">break</span>;
07967         }
07968     }
07969     Print(<span class="stringliteral">"  iBaseCharset   %s\n"</span>,
07970           (i &lt; (<span class="keyword">sizeof</span>(CrackCS) / <span class="keyword">sizeof</span>(BASECHARSET))) ? CrackCS[i].pstrCS : <span class="stringliteral">"ILLEGAL VALUE"</span>);
07971     Print(<span class="stringliteral">"  Codepage       %d\n"</span>, kl.<a class="code" href="../../d4/d9/structtagKL.html#o8">CodePage</a>);
07972 
07973     <span class="keywordflow">if</span> (opts &amp; OFLAG(a)) {
07974         pklAnchor = pkl;
07975         SAFEWHILE (kl.<a class="code" href="../../d4/d9/structtagKL.html#o1">pklNext</a> != pklAnchor) {
07976             pkl = kl.<a class="code" href="../../d4/d9/structtagKL.html#o1">pklNext</a>;
07977             <span class="keywordflow">if</span> (!Idkl(0, pkl)) {
07978                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07979             }
07980             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(kl, pkl);
07981         }
07982     }
07983     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
07984 
07985 display_layouts:
07986 
07987     ProcessHead = EvalExp( <span class="stringliteral">"PsActiveProcessHead"</span> );
07988     <span class="keywordflow">if</span> (!ProcessHead) {
07989         Print(<span class="stringliteral">"Unable to get value of PsActiveProcessHead\n"</span>);
07990         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07991     }
07992     Print(<span class="stringliteral">"ProcessHead = %lx\n"</span>, ProcessHead);
07993 
07994     <span class="keywordflow">if</span> (!tryMove(List, ProcessHead)) {
07995         Print(<span class="stringliteral">"Unable to get value of PsActiveProcessHead\n"</span>);
07996         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
07997     }
07998     NextProcess = <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>.Flink;
07999     <span class="keywordflow">if</span> (NextProcess == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08000         Print(<span class="stringliteral">"PsActiveProcessHead-&gt;Flink is NULL!\n"</span>);
08001         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08002     }
08003     Print(<span class="stringliteral">"NextProcess = %lx\n"</span>, NextProcess);
08004 
08005     nThread = 0;
08006     SAFEWHILE(NextProcess != ProcessHead) {
08007         pEProcess = <a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>((<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)NextProcess,
08008                                     PROCESS_PROCESSHEAD,
08009                                     NULL);
08010         Print(<span class="stringliteral">"pEProcess = %lx\n"</span>, pEProcess);
08011 
08012         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(pEProcess, PROCESS_PROCESSLINK,
08013                 &amp;List) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08014             Print(<span class="stringliteral">"Unable to read _EPROCESS at %lx\n"</span>,pEProcess);
08015             <span class="keywordflow">break</span>;
08016         }
08017         NextProcess = <a class="code" href="../../d1/d0/cmchek_8c.html#a12">List</a>.Flink;
08018 
08019         <span class="comment">/*</span>
08020 <span class="comment">         * Dump threads of Win32 Processes only</span>
08021 <span class="comment">         */</span>
08022         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(pEProcess, PROCESS_WIN32PROCESS,
08023                 &amp;pW32Process) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || pW32Process == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08024             <span class="keywordflow">continue</span>;
08025         }
08026 
08027         ThreadListHead = <a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(pEProcess, PROCESS_THREADLIST, &amp;ThreadList);
08028         <span class="keywordflow">if</span> (ThreadListHead == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
08029             <span class="keywordflow">continue</span>;
08030         NextThread = ThreadList.Flink;
08031 
08032         SAFEWHILE ( NextThread != ThreadListHead) {
08033             pEThread = (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)(CONTAINING_RECORD(NextThread, <a class="code" href="../../d1/d8/struct__KTHREAD.html">KTHREAD</a>, ThreadListEntry));
08034 
08035             <span class="keywordflow">if</span> (!tryMove(EThread, pEThread)) {
08036                 Print(<span class="stringliteral">"Unable to read _ETHREAD at %lx\n"</span>,pEThread);
08037                 <span class="keywordflow">break</span>;
08038             }
08039             NextThread = ((<a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>)&amp;EThread)-&gt;ThreadListEntry.Flink;
08040 
08041             pti = EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o47">Win32Thread</a>;
08042             <span class="keywordflow">if</span> (pti == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08043                 Print(<span class="stringliteral">"Cid %lx:%lx has NULL pti\n"</span>,
08044                        EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueProcess,
08045                        EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueThread);
08046             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!tryMove(ti, pti)) {
08047                 Print(<span class="stringliteral">"Idt: Unable to move pti from %x.\n"</span>,
08048                         pti);
08049                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08050             }
08051 
08052             <span class="keywordflow">if</span> (ti.pEThread != pEThread || pti == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08053                 <span class="comment">/*</span>
08054 <span class="comment">                 * This thread either doesn't have a pti or something</span>
08055 <span class="comment">                 * is whacked out.  Just skip it if we want all</span>
08056 <span class="comment">                 * threads.</span>
08057 <span class="comment">                 */</span>
08058             } <span class="keywordflow">else</span> { <span class="comment">// Good thread</span>
08059 
08060                 PWCHAR pwch;
08061 
08062                 <span class="keywordflow">if</span> (!GetAppName(&amp;EThread, &amp;ti, ach, <span class="keyword">sizeof</span>(ach))) {
08063                     Print(<span class="stringliteral">"Idt: Unable to get app name for ETHREAD %x.\n"</span>,
08064                             pEThread);
08065                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08066                 }
08067                 pwch = wcsrchr(ach, L<span class="charliteral">'\\'</span>);
08068                 <span class="keywordflow">if</span> (pwch == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08069                     pwch = ach;
08070                 } <span class="keywordflow">else</span> {
08071                     pwch++;
08072                 }
08073 
08074                 nThread++;
08075                 Print(<span class="stringliteral">"t 0x%08lx i %2x.%-3lx k 0x%08lx  %ws\n"</span>,
08076                         pti,
08077                         EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueProcess,
08078                         EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueThread,
08079                         ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o4">spklActive</a>,
08080                         pwch);
08081                 <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
08082                     Idkl(0, ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o4">spklActive</a>);
08083                 }
08084 
08085             } <span class="comment">// Good Thread</span>
08086         } <span class="comment">// NextThread</span>
08087     } <span class="comment">// NextProcess</span>
08088     Print(<span class="stringliteral">"  %d threads total.\n"</span>, nThread);
08089     moveExpValuePtr(&amp;pkl, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gspklBaseLayout));
08090     Print(<span class="stringliteral">"  gspklBaseLayout = %#p\n"</span>, pkl);
08091     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
08092         Idkl(0, pkl);
08093     }
08094 
08095     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08096 }
08097 
08098 <span class="comment">/***************************************************************************\</span>
08099 <span class="comment">* ddk - dump deadkey table</span>
08100 <span class="comment">*</span>
08101 <span class="comment">* ddk address      - dumps deadkey table address</span>
08102 <span class="comment">*</span>
08103 <span class="comment">* 09/28/95 GregoryW        Created.</span>
08104 <span class="comment">\***************************************************************************/</span>
08105 
08106 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Iddk(
08107 DWORD opts,
08108 PVOID param1)
08109 {
08110    KBDTABLES KbdTbl;
08111    PKBDTABLES pKbdTbl;
08112    DEADKEY DeadKey;
08113    PDEADKEY pDeadKey;
08114 
08115     UNREFERENCED_PARAMETER(opts);
08116 
08117    <span class="keywordflow">if</span> (param1 == 0) {
08118        Print(<span class="stringliteral">"Expected address\n"</span>);
08119        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08120    } <span class="keywordflow">else</span> {
08121        pKbdTbl = (PKBDTABLES)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
08122    }
08123 
08124    <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(KbdTbl, pKbdTbl);
08125 
08126    pDeadKey = KbdTbl.pDeadKey;
08127 
08128    <span class="keywordflow">if</span> (!pDeadKey) {
08129        Print(<span class="stringliteral">"No deadkey table for this layout\n"</span>);
08130        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08131    }
08132 
08133    <span class="keywordflow">do</span> {
08134        <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(DeadKey, pDeadKey);
08135        <span class="keywordflow">if</span> (DeadKey.dwBoth == 0) {
08136            <span class="keywordflow">break</span>;
08137        }
08138        Print(<span class="stringliteral">"d 0x%04x  ch 0x%04x  =&gt; 0x%04x\n"</span>, HIWORD(DeadKey.dwBoth), LOWORD(DeadKey.dwBoth), DeadKey.wchComposed);
08139        pDeadKey++;
08140    } <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
08141 
08142    <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08143 }
08144 
08145 <span class="comment">/***************************************************************************\</span>
08146 <span class="comment">* dii - dump IMEINFOEX</span>
08147 <span class="comment">*</span>
08148 <span class="comment">* dii address      - dumps extended IME information at address</span>
08149 <span class="comment">*</span>
08150 <span class="comment">* 01/30/96 WKwok        Created.</span>
08151 <span class="comment">\***************************************************************************/</span>
08152 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idii(
08153 DWORD opts,
08154 PVOID param1)
08155 {
08156     <a class="code" href="../../d0/d8/structtagIMEINFOEX.html">IMEINFOEX</a> iiex, *piiex;
08157 
08158     UNREFERENCED_PARAMETER(opts);
08159 
08160     <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08161         Print(<span class="stringliteral">"Expected address\n"</span>);
08162         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08163     }
08164 
08165     piiex = (<a class="code" href="../../d0/d8/structtagIMEINFOEX.html">PIMEINFOEX</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
08166     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(iiex, piiex);
08167 
08168     Print(<span class="stringliteral">"IIEX @ 0x%p\n"</span>, piiex);
08169     Print(<span class="stringliteral">"  hKL            0x%08lx\n"</span>, iiex.<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o0">hkl</a>);
08170     Print(<span class="stringliteral">"  ImeInfo\n"</span>);
08171     Print(<span class="stringliteral">"     dwPrivateDataSize   0x%08lx\n"</span>, iiex.<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o1">ImeInfo</a>.dwPrivateDataSize);
08172     Print(<span class="stringliteral">"     fdwProperty         0x%08lx\n"</span>, iiex.<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o1">ImeInfo</a>.fdwProperty);
08173     Print(<span class="stringliteral">"     fdwConversionCaps   0x%08lx\n"</span>, iiex.<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o1">ImeInfo</a>.fdwConversionCaps);
08174     Print(<span class="stringliteral">"     fdwSentenceCaps     0x%08lx\n"</span>, iiex.<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o1">ImeInfo</a>.fdwSentenceCaps);
08175     Print(<span class="stringliteral">"     fdwUICaps           0x%08lx\n"</span>, iiex.<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o1">ImeInfo</a>.fdwUICaps);
08176     Print(<span class="stringliteral">"     fdwSCSCaps          0x%08lx\n"</span>, iiex.<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o1">ImeInfo</a>.fdwSCSCaps);
08177     Print(<span class="stringliteral">"     fdwSelectCaps       0x%08lx\n"</span>, iiex.<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o1">ImeInfo</a>.fdwSelectCaps);
08178     Print(<span class="stringliteral">"  wszImeDescription[]   L\"%ws\"\n"</span>, &amp;iiex.<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o8">wszImeDescription</a>[0]);
08179     Print(<span class="stringliteral">"  wszImeFile[]          L\"%ws\"\n"</span>, &amp;iiex.<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o9">wszImeFile</a>[0]);
08180 
08181     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08182 }
08183 
08184 <span class="comment">/***************************************************************************\</span>
08185 <span class="comment">* dti - dump THREADINFO</span>
08186 <span class="comment">*</span>
08187 <span class="comment">* dti address - dumps THREADINFO structure at address</span>
08188 <span class="comment">*</span>
08189 <span class="comment">* 11-13-91 DavidPe      Created.</span>
08190 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
08191 <span class="comment">\***************************************************************************/</span>
08192 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idti(
08193 DWORD opts,
08194 PVOID param1)
08195 {
08196     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
08197     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">THREADINFO</a> ti;
08198     <a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html">CLIENTTHREADINFO</a> cti;
08199     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> pThread;
08200     <a class="code" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a> Thread;
08201     UCHAR PriorityClass;
08202 
08203     UNREFERENCED_PARAMETER(opts);
08204 
08205 
08206     <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08207         <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
08208         <a class="code" href="../../d7/d4/structtagQ.html">Q</a> q;
08209         Print(<span class="stringliteral">"No pti specified: using foreground thread\n"</span>);
08210         moveExpValuePtr(&amp;pq, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpqForeground));
08211         <span class="keywordflow">if</span> (pq == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08212             Print(<span class="stringliteral">"No foreground queue!\n"</span>);
08213             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08214         }
08215         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(q, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(pq));
08216         pti = <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>);
08217     } <span class="keywordflow">else</span> {
08218         pti = (<a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
08219     }
08220 
08221     <span class="keywordflow">if</span> (pti == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08222         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08223     }
08224 
08225     Idt(OFLAG(p), pti);
08226 
08227     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ti, pti);
08228     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cti, ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o5">pcti</a>);
08229 
08230     Print(<span class="stringliteral">"PTHREADINFO @ 0x%p\n"</span>, pti);
08231 
08232     Print(<span class="stringliteral">"\tPtiLink.Flink         @0x%p\n"</span>
08233           <span class="stringliteral">"\tptl                   @0x%p\n"</span>
08234           <span class="stringliteral">"\tptlW32                @0x%p\n"</span>
08235           <span class="stringliteral">"\tppi                   @0x%p\n"</span>
08236           <span class="stringliteral">"\tpq                    @0x%p\n"</span>
08237           <span class="stringliteral">"\tspklActive            @0x%p\n"</span>
08238           <span class="stringliteral">"\tmlPost.pqmsgRead      @0x%p\n"</span>
08239           <span class="stringliteral">"\tmlPost.pqmsgWriteLast @0x%p\n"</span>
08240           <span class="stringliteral">"\tmlPost.cMsgs           0x%08lx\n"</span>,
08241           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o36">PtiLink</a>.Flink,
08242           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o1">ptl</a>,
08243           ti.ptlW32,
08244           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o2">ppi</a>,
08245           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>,
08246           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o4">spklActive</a>,
08247           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o0">pqmsgRead</a>,
08248           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o1">pqmsgWriteLast</a>,
08249           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o43">mlPost</a>.<a class="code" href="../../d6/d1/structtagMLIST.html#o2">cMsgs</a>);
08250 
08251     Print(<span class="stringliteral">"\tspwndDefaultIme       @0x%p\n"</span>
08252           <span class="stringliteral">"\tspDefaultImc          @0x%p\n"</span>
08253           <span class="stringliteral">"\thklPrev                0x%08lx\n"</span>,
08254           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o39">spwndDefaultIme</a>,
08255           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o40">spDefaultImc</a>,
08256           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o41">hklPrev</a>);
08257 
08258     Print(<span class="stringliteral">"\trpdesk                @0x%p\n"</span>,
08259           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>);
08260     Print(<span class="stringliteral">"\thdesk                  0x%08lx\n"</span>,
08261           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o18">hdesk</a>);
08262     Print(<span class="stringliteral">"\tamdesk                 0x%08lx\n"</span>,
08263           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o48">amdesk</a>);
08264 
08265     Print(<span class="stringliteral">"\tpDeskInfo             @0x%p\n"</span>
08266           <span class="stringliteral">"\tpClientInfo           @0x%p\n"</span>,
08267           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o7">pDeskInfo</a>,
08268           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o8">pClientInfo</a>);
08269 
08270     Print(<span class="stringliteral">"\tTIF_flags              %s\n"</span>,
08271           <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_TIF, ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o9">TIF_flags</a>, NULL, TRUE));
08272     Print(<span class="stringliteral">"\tsphkCurrent           @0x%p\n"</span>
08273           <span class="stringliteral">"\tpEventQueueServer     @0x%p\n"</span>
08274           <span class="stringliteral">"\thEventQueueClient      0x%08lx\n"</span>,
08275           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o32">sphkCurrent</a>,
08276           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o35">pEventQueueServer</a>,
08277           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o34">hEventQueueClient</a>);
08278 
08279     Print(<span class="stringliteral">"\tfsChangeBits           %s\n"</span>,
08280             <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_QS, (WORD)cti.<a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html#o1">fsChangeBits</a>, NULL, TRUE));
08281     Print(<span class="stringliteral">"\tfsChangeBitsRemovd     %s\n"</span>,
08282             <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_QS, (WORD)ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o44">fsChangeBitsRemoved</a>, NULL, TRUE));
08283     Print(<span class="stringliteral">"\tfsWakeBits             %s\n"</span>,
08284             <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_QS, (WORD)cti.<a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html#o2">fsWakeBits</a>, NULL, TRUE));
08285     Print(<span class="stringliteral">"\tfsWakeMask             %s\n"</span>,
08286             <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_QS, (WORD)cti.<a class="code" href="../../d4/d0/structtagCLIENTTHREADINFO.html#o4">fsWakeMask</a>, NULL, TRUE));
08287 
08288     Print(<span class="stringliteral">"\tcPaintsReady           0x%04x\n"</span>
08289           <span class="stringliteral">"\tcTimersReady           0x%04x\n"</span>
08290           <span class="stringliteral">"\ttimeLast               0x%08lx\n"</span>
08291           <span class="stringliteral">"\tptLast.x               0x%08lx\n"</span>
08292           <span class="stringliteral">"\tptLast.y               0x%08lx\n"</span>
08293           <span class="stringliteral">"\tidLast                 0x%08lx\n"</span>
08294           <span class="stringliteral">"\tcQuit                  0x%08lx\n"</span>
08295           <span class="stringliteral">"\texitCode               0x%08lx\n"</span>
08296           <span class="stringliteral">"\tpSBTrack               0x%08lx\n"</span>
08297           <span class="stringliteral">"\tpsmsSent              @0x%p\n"</span>
08298           <span class="stringliteral">"\tpsmsCurrent           @0x%p\n"</span>,
08299           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o19">cPaintsReady</a>,
08300           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o20">cTimersReady</a>,
08301           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o14">timeLast</a>,
08302           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o38">ptLast</a>.x,
08303           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o38">ptLast</a>.y,
08304           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o15">idLast</a>,
08305           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o16">cQuit</a>,
08306           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o17">exitCode</a>,
08307           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o33">pSBTrack</a>,
08308           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o11">psmsSent</a>,
08309           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o12">psmsCurrent</a>);
08310 
08311     Print(<span class="stringliteral">"\tfsHooks                0x%08lx\n"</span>
08312           <span class="stringliteral">"\taphkStart             @0x%p l%ld\n"</span>
08313           <span class="stringliteral">"\tsphkCurrent           @0x%p\n"</span>,
08314           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o31">fsHooks</a>,
08315           &amp;(pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o51">aphkStart</a>), CWINHOOKS,
08316           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o32">sphkCurrent</a>);
08317     Print(<span class="stringliteral">"\tpsmsReceiveList       @0x%p\n"</span>,
08318           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o13">psmsReceiveList</a>);
08319     Print(<span class="stringliteral">"\tptdb                  @0x%p\n"</span>
08320           <span class="stringliteral">"\tThread                @0x%p\n"</span>,
08321           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o22">ptdb</a>, ti.pEThread);
08322 
08323     pThread = (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)ti.pEThread;
08324     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Thread, pThread);
08325     <a class="code" href="../../d0/d7/alpha_8c.html#a1">GetEProcessData</a>(Thread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o28">ThreadsProcess</a>, PROCESS_PRIORITYCLASS, &amp;PriorityClass);
08326     Print(<span class="stringliteral">"\t  PriorityClass %d\n"</span>,
08327           PriorityClass);
08328 
08329     Print(<span class="stringliteral">"\tcWindows               0x%08lx\n"</span>
08330           <span class="stringliteral">"\tcVisWindows            0x%08lx\n"</span>
08331           <span class="stringliteral">"\tpqAttach              @0x%p\n"</span>
08332           <span class="stringliteral">"\tiCursorLevel           0x%08lx\n"</span>,
08333           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o49">cWindows</a>,
08334           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o50">cVisWindows</a>,
08335           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o28">pqAttach</a>,
08336           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o37">iCursorLevel</a>);
08337 
08338     Print(<span class="stringliteral">"\tpMenuState            @0x%p\n"</span>,
08339           ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o21">pMenuState</a>);
08340 
08341     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08342 }
08343 <span class="preprocessor">#endif // KERNEL</span>
08344 <span class="preprocessor"></span>
08345 
08346 <span class="preprocessor">#ifdef KERNEL</span>
08347 <span class="preprocessor"></span>
08348 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> ScanThreadlocks(<a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti, <span class="keywordtype">char</span> chType, PVOID pvSearch);
08349 
08350 <span class="comment">/***************************************************************************\</span>
08351 <span class="comment">* dtl handle|pointer</span>
08352 <span class="comment">*</span>
08353 <span class="comment">* !dtl &lt;addr&gt;       Dumps all THREAD locks for object at &lt;addr&gt;</span>
08354 <span class="comment">* !dtl -t &lt;pti&gt;     Dumps all THREAD locks made by thread &lt;pti&gt;</span>
08355 <span class="comment">* !dtl              Dumps all THREAD locks made by all threads</span>
08356 <span class="comment">*</span>
08357 <span class="comment">* 02-27-92 ScottLu      Created.</span>
08358 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
08359 <span class="comment">\***************************************************************************/</span>
08360 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idtl(
08361 DWORD opts,
08362 PVOID param1)
08363 {
08364     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
08365 
08366     <span class="keywordflow">if</span> (param1 == 0) {
08367         Print(<span class="stringliteral">"Dumping all thread locks:\n"</span>);
08368         Print(<span class="stringliteral">"pti        pObj     Caller\n"</span>);
08369         FOREACHPTI(pti)
08370             Idtl(OFLAG(t) | OFLAG(x), pti);
08371         NEXTEACHPTI(pti);
08372         return TRUE;
08373     }
08374 
08375     if (opts &amp; OFLAG(t)) {
08376         pti = (<a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
08377         <span class="keywordflow">if</span> (pti == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08378             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08379         }
08380 
08381         <span class="comment">/*</span>
08382 <span class="comment">         * Regular thread-locked objects</span>
08383 <span class="comment">         */</span>
08384         <span class="keywordflow">if</span> (!(opts &amp; OFLAG(x))) { <span class="comment">// x is not legal from user - internal only</span>
08385             Print(<span class="stringliteral">"pti        pObj     Caller\n"</span>);
08386         }
08387         ScanThreadlocks(pti, <span class="charliteral">'o'</span>, NULL);
08388         ScanThreadlocks(pti, <span class="charliteral">'k'</span>, NULL);
08389         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08390     }
08391 
08392 
08393     <span class="keywordflow">if</span> (!param1) {
08394         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08395     }
08396 
08397     Print(<span class="stringliteral">"Thread Locks for object %x:\n"</span>, param1);
08398     Print(<span class="stringliteral">"pti        pObj     Caller\n"</span>);
08399 
08400     FOREACHPTI(pti)
08401     ScanThreadlocks(pti, 'o', param1);
08402     ScanThreadlocks(pti, 'k', param1);
08403     NEXTEACHPTI(pti);
08404 
08405     Print("--- End Thread Lock List ---\n");
08406 
08407     return TRUE;
08408 }
08409 
08410 <span class="comment">/*</span>
08411 <span class="comment"> * Scans all threadlocked objects belonging to thread pti.</span>
08412 <span class="comment"> * of type chType (o == regular objects, k == kernel objects, p == pool</span>
08413 <span class="comment"> * Display each threadlock, or if pvSearch is non-NULL, just those locks on the</span>
08414 <span class="comment"> * object at pvSearch.</span>
08415 <span class="comment"> */</span>
08416 BOOL
08417 ScanThreadlocks(
08418     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti,
08419     <span class="keywordtype">char</span>        chType,
08420     PVOID       pvSearch)
08421 {
08422     <a class="code" href="../../d5/d1/struct__TL.html">TL</a>         tl;
08423     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">THREADINFO</a> ti;
08424     <a class="code" href="../../d5/d1/struct__TL.html">PTL</a>        ptl;
08425 
08426     <span class="keywordflow">if</span> (!tryMove(ti, pti)) {
08427         Print(<span class="stringliteral">"Idtl: Can't get pti data from %x.\n"</span>, pti);
08428         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08429     }
08430     <span class="keywordflow">switch</span> (chType) {
08431     <span class="keywordflow">case</span> <span class="charliteral">'o'</span>:
08432         ptl = ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o1">ptl</a>;
08433         <span class="keywordflow">break</span>;
08434     <span class="keywordflow">case</span> <span class="charliteral">'k'</span>:
08435         ptl = ti.ptlW32;
08436         <span class="keywordflow">break</span>;
08437     <span class="keywordflow">default</span>:
08438         Print(<span class="stringliteral">"Internal error, bad chType in ScanThreadlocks\n"</span>);
08439         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08440     }
08441     SAFEWHILE(ptl) {
08442         <span class="keywordtype">char</span> ach[80];
08443         DWORD_PTR dwOffset;
08444 
08445         <span class="keywordflow">if</span> (!tryMove(tl, ptl)) {
08446             Print(<span class="stringliteral">"Idtl: Can't get ptl data from %x.\n"</span>, ptl);
08447             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08448         }
08449 
08450         <span class="keywordflow">if</span> (!pvSearch || (tl.pobj == pvSearch)) {
08451             Print(<span class="stringliteral">"%p %c %p"</span>, pti, chType, tl.pobj);
08452 <span class="preprocessor">#if DBG</span>
08453 <span class="preprocessor"></span>            GetSym(tl.pfnCaller, ach, &amp;dwOffset);
08454             Print(<span class="stringliteral">" %s"</span>, ach);
08455             <span class="keywordflow">if</span> (dwOffset) {
08456                 Print(<span class="stringliteral">"+%lx"</span>, dwOffset);
08457             }
08458 <span class="preprocessor">#endif // !DBG</span>
08459 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (chType == <span class="charliteral">'k'</span>) {
08460                 GetSym(tl.pfnFree, ach, &amp;dwOffset);
08461                 Print(<span class="stringliteral">" (%s)"</span>, ach);
08462                 <span class="keywordflow">if</span> (dwOffset) {
08463                     Print(<span class="stringliteral">"+%x"</span>, dwOffset);
08464                 }
08465             }
08466             Print(<span class="stringliteral">"\n"</span>);
08467         }
08468         ptl = tl.next;
08469     }
08470     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08471 }
08472 
08473 <span class="preprocessor">#endif // KERNEL</span>
08474 <span class="preprocessor"></span>
08475 
08476 
08477 <span class="preprocessor">#ifdef KERNEL</span>
08478 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
08479 <span class="comment">* Procedure: Idtmr</span>
08480 <span class="comment">*</span>
08481 <span class="comment">* Description: Dumps timer structures</span>
08482 <span class="comment">*</span>
08483 <span class="comment">* Returns: fSuccess</span>
08484 <span class="comment">*</span>
08485 <span class="comment">* 6/9/1995 Created SanfordS</span>
08486 <span class="comment">*</span>
08487 <span class="comment">\************************************************************************/</span>
08488 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idtmr(
08489 DWORD opts,
08490 PVOID param1)
08491 {
08492     <a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a> ptmr;
08493     <a class="code" href="../../d4/d8/structtagTIMER.html">TIMER</a> tmr;
08494     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">THREADINFO</a> ti;
08495 
08496     UNREFERENCED_PARAMETER(opts);
08497 
08498     <span class="keywordflow">if</span> (param1 == 0) {
08499         moveExpValuePtr(&amp;ptmr, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gptmrFirst));
08500         SAFEWHILE (ptmr) {
08501             Idtmr(0, ptmr);
08502             Print(<span class="stringliteral">"\n"</span>);
08503             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ptmr, &amp;ptmr-&gt;<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>);
08504         }
08505         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08506     }
08507 
08508     ptmr = (<a class="code" href="../../d4/d8/structtagTIMER.html">PTIMER</a>)param1;
08509 
08510     <span class="keywordflow">if</span> (ptmr == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08511         Print(<span class="stringliteral">"Expected ptmr address.\n"</span>);
08512         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08513     }
08514 
08515     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(tmr, ptmr);
08516 
08517 
08518     Print(<span class="stringliteral">"Timer %08x:\n"</span>
08519           <span class="stringliteral">"  ptmrNext       = %x\n"</span>
08520           <span class="stringliteral">"  pti            = %x"</span>,
08521           ptmr,
08522           tmr.<a class="code" href="../../d4/d8/structtagTIMER.html#o1">ptmrNext</a>,
08523           tmr.<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a>);
08524     <span class="keywordflow">if</span> (tryMove(ti, tmr.<a class="code" href="../../d4/d8/structtagTIMER.html#o3">pti</a>)) {
08525         WCHAR awch[80];
08526         <a class="code" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a> EThread;
08527 
08528         <span class="keywordflow">if</span> (tryMove(EThread, ti.pEThread)) {
08529             <span class="keywordflow">if</span> (GetAppName(&amp;EThread, &amp;ti, awch, <span class="keyword">sizeof</span>(awch))) {
08530                 PWCHAR pwch = wcsrchr(awch, L<span class="charliteral">'\\'</span>);
08531                 <span class="keywordflow">if</span> (pwch == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08532                     pwch = awch;
08533                 } <span class="keywordflow">else</span> {
08534                     pwch++;
08535                 }
08536                 Print(<span class="stringliteral">"  q 0x%08lx i %2x.%-3lx %ws"</span>,
08537                         ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>,
08538                         EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueProcess,
08539                         EThread.<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueThread,
08540                         pwch);
08541             }
08542         }
08543     }
08544     Print(<span class="stringliteral">"\n"</span>
08545           <span class="stringliteral">"  spwnd          = %x"</span>,
08546           tmr.<a class="code" href="../../d4/d8/structtagTIMER.html#o4">spwnd</a>);
08547     <span class="keywordflow">if</span> (tmr.<a class="code" href="../../d4/d8/structtagTIMER.html#o4">spwnd</a>) {
08548         <span class="keywordtype">char</span> ach[80];
08549         <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(tmr.<a class="code" href="../../d4/d8/structtagTIMER.html#o4">spwnd</a>, ach);
08550         Print(<span class="stringliteral">"  \"%s\""</span>, ach);
08551     }
08552     Print(<span class="stringliteral">"\n"</span>
08553           <span class="stringliteral">"  nID            = %x\n"</span>
08554           <span class="stringliteral">"  cmsCountdown   = %x\n"</span>
08555           <span class="stringliteral">"  cmsRate        = %x\n"</span>
08556           <span class="stringliteral">"  flags          = %s\n"</span>
08557           <span class="stringliteral">"  pfn            = %x\n"</span>
08558           <span class="stringliteral">"  ptiOptCreator  = %x\n"</span>,
08559           tmr.<a class="code" href="../../d4/d8/structtagTIMER.html#o5">nID</a>,
08560           tmr.<a class="code" href="../../d4/d8/structtagTIMER.html#o6">cmsCountdown</a>,
08561           tmr.<a class="code" href="../../d4/d8/structtagTIMER.html#o7">cmsRate</a>,
08562           <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_TMRF, (WORD)tmr.<a class="code" href="../../d4/d8/structtagTIMER.html#o8">flags</a>, NULL, TRUE),
08563           tmr.<a class="code" href="../../d4/d8/structtagTIMER.html#o9">pfn</a>,
08564           tmr.<a class="code" href="../../d4/d8/structtagTIMER.html#o10">ptiOptCreator</a>);
08565 
08566     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08567 }
08568 <span class="preprocessor">#endif // KERNEL</span>
08569 <span class="preprocessor"></span>
08570 
08571 
08572 
08573 <span class="comment">/************************************************************************\</span>
08574 <span class="comment">* Procedure: Idu</span>
08575 <span class="comment">*</span>
08576 <span class="comment">* Description: Dump unknown object.  Does what it can figure out.</span>
08577 <span class="comment">*</span>
08578 <span class="comment">* Returns: fSuccess</span>
08579 <span class="comment">*</span>
08580 <span class="comment">* 6/9/1995 Created SanfordS</span>
08581 <span class="comment">*</span>
08582 <span class="comment">\************************************************************************/</span>
08583 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a230">Idu</a>(
08584 DWORD opts,
08585 PVOID param1)
08586 {
08587     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he, *phe;
08588     <span class="keywordtype">int</span> i;
08589     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dw;
08590 
08591     UNREFERENCED_PARAMETER(opts);
08592 
08593     <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08594         <a class="code" href="../../d2/d1/userexts_8c.html#a8">FOREACHHANDLEENTRY</a>(phe, he, i)
08595             if (he.bType != TYPE_FREE &amp;&amp; tryDword(&amp;dw, FIXKP(he.phead))) {
08596                 <a class="code" href="../../d2/d1/userexts_8c.html#a230">Idu</a>(OFLAG(x), he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>);
08597             }
08598         <a class="code" href="../../d2/d1/userexts_8c.html#a9">NEXTEACHHANDLEENTRY</a>()
08599         return TRUE;
08600     }
08601 
08602     param1 = HorPtoP(FIXKP(param1), -1);
08603     if (param1 == NULL) {
08604         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08605     }
08606 
08607     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/userexts_8c.html#a196">getHEfromP</a>(NULL, &amp;he, param1)) {
08608         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08609     }
08610 
08611     Print(<span class="stringliteral">"--- %s object @%x ---\n"</span>, pszObjStr[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>], <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1));
08612     <span class="keywordflow">switch</span> (he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>) {
08613     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a237">TYPE_WINDOW</a>:
08614         <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/userexts_8c.html#a231">Idw</a>(0, param1);
08615 
08616     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a238">TYPE_MENU</a>:
08617         <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/userexts_8c.html#a221">Idm</a>(0, param1);
08618 
08619 <span class="preprocessor">#ifdef KERNEL</span>
08620 <span class="preprocessor"></span>    <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a239">TYPE_CURSOR</a>:
08621         <span class="keywordflow">return</span> Idcur(0, param1);
08622 
08623 <span class="preprocessor">#ifdef LATER</span>
08624 <span class="preprocessor"></span>    <span class="keywordflow">case</span> TYPE_INPUTQUEUE:
08625         <span class="keywordflow">return</span> Idq(0, param1);
08626 <span class="preprocessor">#endif</span>
08627 <span class="preprocessor"></span>
08628     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a241">TYPE_HOOK</a>:
08629         <span class="keywordflow">return</span> Idhk(OFLAG(a) | OFLAG(g), NULL);
08630 
08631     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a246">TYPE_DDECONV</a>:
08632     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a247">TYPE_DDEXACT</a>:
08633         <span class="keywordflow">return</span> Idde(0, param1);
08634 <span class="preprocessor">#endif // KERNEL</span>
08635 <span class="preprocessor"></span>
08636     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a248">TYPE_MONITOR</a>:
08637         <span class="comment">// LATER: - add dmon command</span>
08638     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a243">TYPE_CALLPROC</a>:
08639     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a244">TYPE_ACCELTABLE</a>:
08640     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a240">TYPE_SETWINDOWPOS</a>:
08641     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a245">TYPE_DDEACCESS</a>:
08642     <span class="keywordflow">default</span>:
08643         Print(<span class="stringliteral">"not supported.\n"</span>, pszObjStr[he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>]);
08644     }
08645     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08646 }
08647 
08648 
08649 
08650 <span class="preprocessor">#ifdef KERNEL</span>
08651 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
08652 <span class="comment">* dumphmgr - dumps object allocation counts for handle-table.</span>
08653 <span class="comment">*</span>
08654 <span class="comment">* 10-18-94 ChrisWil     Created.</span>
08655 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
08656 <span class="comment">* 06-18-97 MCostea      made it work</span>
08657 <span class="comment">\***************************************************************************/</span>
08658 
08659 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idumphmgr(
08660 DWORD opts)
08661 {
08662     <a class="code" href="../../d1/d3/structtagPERFINFO.html">PERFHANDLEINFO</a> aLocalHti[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>], aLocalPrevHti[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>];
08663     <a class="code" href="../../d1/d3/structtagPERFINFO.html">PPERFHANDLEINFO</a> pgahti;
08664 
08665     LONG lTotalAlloc, lTotalMax, lTotalCurrent;
08666     LONG lPrevTotalAlloc, lPrevTotalMax, lPrevTotalCurrent;
08667     SIZE_T lTotalSize, lPrevTotalSize;
08668 
08669     <span class="keywordtype">int</span> idx;
08670 
08671     pgahti = EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gaPerfhti));
08672     <span class="keywordflow">if</span> (!pgahti) {
08673         Print(<span class="stringliteral">"\n!dumphmgr works only with debug versions of win32k.sys\n\n"</span>);
08674         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08675     }
08676     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(aLocalHti, pgahti);
08677 
08678     pgahti = EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gaPrevhti));
08679     <span class="keywordflow">if</span> (!pgahti) {
08680         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08681     }
08682 
08683     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(aLocalPrevHti, pgahti);
08684 
08685     lTotalSize = lTotalAlloc = lTotalMax = lTotalCurrent = 0;
08686     lPrevTotalSize = lPrevTotalAlloc = lPrevTotalMax = lPrevTotalCurrent = 0;
08687 
08688     <span class="keywordflow">if</span> (aLocalPrevHti[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a237">TYPE_WINDOW</a>].<a class="code" href="../../d1/d3/structtagPERFINFO.html#o2">lTotalCount</a>) {
08689         Print(<span class="stringliteral">"\nThe snapshot values come under the current ones\n"</span>);
08690 
08691         Print(<span class="stringliteral">"Type             Allocated         Maximum       Count             Size\n"</span>);
08692         Print(<span class="stringliteral">"______________________________________________________________________________"</span>);
08693         <span class="keywordflow">for</span>(idx=1; idx &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>; idx++) {
08694             Print(<span class="stringliteral">"\n%-15s  %8d %-+6d %7d %-+5d %6d %-+5d  %9d %-+d"</span>,
08695                   aszTypeNames[idx],
08696                   aLocalHti[idx].lTotalCount, aLocalHti[idx].lTotalCount - aLocalPrevHti[idx].lTotalCount,
08697                   aLocalHti[idx].lMaxCount, aLocalHti[idx].lMaxCount - aLocalPrevHti[idx].lMaxCount,
08698                   aLocalHti[idx].lCount, aLocalHti[idx].lCount - aLocalPrevHti[idx].lCount,
08699                   aLocalHti[idx].lSize, aLocalHti[idx].lSize - aLocalPrevHti[idx].lSize);
08700             <span class="keywordflow">if</span> (aLocalPrevHti[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a237">TYPE_WINDOW</a>].<a class="code" href="../../d1/d3/structtagPERFINFO.html#o2">lTotalCount</a>) {
08701                 Print(<span class="stringliteral">"\n                 %8d        %7d       %6d        %9d"</span>,
08702                       aLocalPrevHti[idx].lTotalCount,
08703                       aLocalPrevHti[idx].lMaxCount,
08704                       aLocalPrevHti[idx].lCount,
08705                       aLocalPrevHti[idx].lSize);
08706                 lPrevTotalAlloc   += aLocalPrevHti[idx].<a class="code" href="../../d1/d3/structtagPERFINFO.html#o2">lTotalCount</a>;
08707                 lPrevTotalMax     += aLocalPrevHti[idx].lMaxCount;
08708                 lPrevTotalCurrent += aLocalPrevHti[idx].lCount;
08709                 lPrevTotalSize    += aLocalPrevHti[idx].lSize;
08710 
08711             }
08712             lTotalAlloc   += aLocalHti[idx].<a class="code" href="../../d1/d3/structtagPERFINFO.html#o2">lTotalCount</a>;
08713             lTotalMax     += aLocalHti[idx].lMaxCount;
08714             lTotalCurrent += aLocalHti[idx].lCount;
08715             lTotalSize    += aLocalHti[idx].lSize;
08716         }
08717         Print(<span class="stringliteral">"\n______________________________________________________________________________\n"</span>);
08718         Print(<span class="stringliteral">"Totals           %8d %-+6d %7d %-+5d %6d %+-5d  %9d %-+d\n"</span>,
08719               lTotalAlloc, lTotalAlloc - lPrevTotalAlloc,
08720               lTotalMax, lTotalMax - lPrevTotalMax,
08721               lTotalCurrent, lTotalCurrent - lPrevTotalCurrent,
08722               lTotalSize, lTotalSize - lPrevTotalSize);
08723         Print(<span class="stringliteral">"                 %8d        %7d       %6d        %9d\n"</span>,
08724               lPrevTotalAlloc, lPrevTotalMax, lPrevTotalCurrent, lPrevTotalSize);
08725 
08726     }
08727     <span class="keywordflow">else</span> {
08728         Print(<span class="stringliteral">"Type               Allocated  Maximum  Count   Size\n"</span>);
08729         Print(<span class="stringliteral">"______________________________________________________"</span>);
08730         <span class="keywordflow">for</span>(idx=1; idx &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a254">TYPE_CTYPES</a>; idx++) {
08731             Print(<span class="stringliteral">"\n%-17s  %9d  %7d  %6d  %d"</span>,
08732                   aszTypeNames[idx],
08733                   aLocalHti[idx].lTotalCount,
08734                   aLocalHti[idx].lMaxCount,
08735                   aLocalHti[idx].lCount,
08736                   aLocalHti[idx].lSize);
08737             lTotalAlloc   += aLocalHti[idx].<a class="code" href="../../d1/d3/structtagPERFINFO.html#o2">lTotalCount</a>;
08738             lTotalMax     += aLocalHti[idx].lMaxCount;
08739             lTotalCurrent += aLocalHti[idx].lCount;
08740             lTotalSize    += aLocalHti[idx].lSize;
08741         }
08742         Print(<span class="stringliteral">"\n______________________________________________________\n"</span>);
08743         Print(<span class="stringliteral">"Current totals     %9d  %7d  %6d  %d\n"</span>,
08744               lTotalAlloc, lTotalMax, lTotalCurrent, lTotalSize);
08745     }
08746 
08747     <span class="comment">/*</span>
08748 <span class="comment">     * If the argument-list contains the Snap option,</span>
08749 <span class="comment">     * then copy the current counts to the previous ones</span>
08750 <span class="comment">     */</span>
08751     <span class="keywordflow">if</span> (opts &amp; OFLAG(s)) {
08752         (lpExtensionApis-&gt;lpWriteProcessMemoryRoutine)(
08753                 (ULONG_PTR)(&amp;(pgahti[0])),
08754                 (<span class="keywordtype">void</span>*)(aLocalHti),
08755                 <span class="keyword">sizeof</span>(aLocalHti),
08756                 <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
08757     }
08758 
08759     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08760 }
08761 <span class="preprocessor">#endif // KERNEL</span>
08762 <span class="preprocessor"></span>
08763 
08764 
08765 <span class="comment">/************************************************************************\</span>
08766 <span class="comment">* Procedure: dwrWorker</span>
08767 <span class="comment">*</span>
08768 <span class="comment">* Description: Dumps pwnd structures compactly to show relationships.</span>
08769 <span class="comment">*</span>
08770 <span class="comment">* Returns: fSuccess</span>
08771 <span class="comment">*</span>
08772 <span class="comment">* 6/9/1995 Created SanfordS</span>
08773 <span class="comment">*</span>
08774 <span class="comment">\************************************************************************/</span>
08775 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a200">dwrWorker</a>(
08776     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd,
08777     <span class="keywordtype">int</span> tab)
08778 {
08779     <a class="code" href="../../d6/d9/structtagWND.html">WND</a> wnd;
08780 
08781     <span class="keywordflow">if</span> (pwnd == 0) {
08782         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08783     }
08784 
08785     <span class="keywordflow">do</span> {
08786         pwnd = <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(pwnd);
08787         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wnd, pwnd);
08788         <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(pwnd, gach1);
08789         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(gcls, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>));
08790         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a65">gcls</a>.<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> &lt; 0xC000) {
08791             <span class="keywordflow">switch</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a65">gcls</a>.<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a>) {
08792             <span class="keywordflow">case</span> WC_DIALOG:
08793                 strcpy(gach1, <span class="stringliteral">"WC_DIALOG"</span>);
08794                 <span class="keywordflow">break</span>;
08795 
08796             <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a39">DESKTOPCLASS</a>:
08797                 strcpy(gach1, <span class="stringliteral">"DESKTOP"</span>);
08798                 <span class="keywordflow">break</span>;
08799 
08800             <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a41">SWITCHWNDCLASS</a>:
08801                 strcpy(gach1, <span class="stringliteral">"SWITCHWND"</span>);
08802                 <span class="keywordflow">break</span>;
08803 
08804             <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a42">ICONTITLECLASS</a>:
08805                 strcpy(gach1, <span class="stringliteral">"ICONTITLE"</span>);
<a name="l08806"></a><a class="code" href="../../d2/d1/userexts_8c.html#a227">08806</a>                 <span class="keywordflow">break</span>;
08807 
08808             <span class="keywordflow">default</span>:
08809                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a65">gcls</a>.<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> == 0) {
08810                     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a63">gach1</a>, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a65">gcls</a>.lpszAnsiClassName));
08811                 } <span class="keywordflow">else</span> {
08812                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(gach2, <span class="stringliteral">"0x%04x"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a65">gcls</a>.<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a>);
08813                 }
08814             }
08815         } <span class="keywordflow">else</span> {
08816             <a class="code" href="../../d2/d1/userexts_8c.html#a199">DebugGetClassNameA</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a65">gcls</a>.lpszAnsiClassName, gach2);
08817         }
08818         Print(<span class="stringliteral">"%08x%*s [%s|%s]"</span>, pwnd, tab, <span class="stringliteral">""</span>, gach1, gach2);
08819         <span class="keywordflow">if</span> (wnd.<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08820             Print(<span class="stringliteral">" &lt;- Owned by:%08x"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>));
08821         }
08822         Print(<span class="stringliteral">"\n"</span>);
08823         <span class="keywordflow">if</span> (wnd.<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08824             <a class="code" href="../../d2/d1/userexts_8c.html#a200">dwrWorker</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>, tab + 2);
08825         }
08826     } SAFEWHILE ((pwnd = wnd.<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>) &amp;&amp; tab &gt; 0);
08827     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08828 }
08829 
08830 
08831 <span class="comment">/************************************************************************\</span>
08832 <span class="comment">* Procedure: Idw</span>
08833 <span class="comment">*</span>
08834 <span class="comment">* Description: Dumps pwnd structures</span>
08835 <span class="comment">*</span>
08836 <span class="comment">* Returns: fSuccess</span>
08837 <span class="comment">*</span>
08838 <span class="comment">* 6/9/1995 Created SanfordS</span>
08839 <span class="comment">*</span>
08840 <span class="comment">\************************************************************************/</span>
08841 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a231">Idw</a>(
08842     DWORD opts,
08843     PVOID param1)
08844 {
08845     <a class="code" href="../../d6/d9/structtagWND.html">WND</a> wnd;
08846     <a class="code" href="../../d7/d0/structtagCLS.html">CLS</a> cls;
08847     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd = param1;
08848     <span class="keywordtype">char</span> ach[80];
08849     DWORD_PTR dwOffset;
08850     <span class="keywordtype">int</span>  ix;
08851     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> tempDWord;
08852     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwWOW;
08853 
08854     <span class="keywordflow">if</span> (opts &amp; OFLAG(a)) {
08855 <span class="preprocessor">#ifdef KERNEL</span>
08856 <span class="preprocessor"></span>        <a class="code" href="../../d0/d3/structtagDESKTOP.html">DESKTOP</a> desk, *pdesk;
08857         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
08858         WCHAR wach[80];
08859 
08860         <span class="keywordflow">if</span> (param1 != 0) {
08861             Print(<span class="stringliteral">"window parameter ignored with -a option.\n"</span>);
08862         }
08863         FOREACHDESKTOP(pdesk)
08864             if (tryMove(desk, pdesk)) {
08865                 <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">OBJECT_HEADER_NAME_INFO</a> NameInfo;
08866                 <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">OBJECT_HEADER</a> Head;
08867 
08868                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Head, <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(pdesk));
08869                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(NameInfo, ((PCHAR)(<a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(pdesk)) - Head.<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o4">NameInfoOffset</a>));
08870                 <a class="code" href="../../d7/d4/conexts_8c.html#a2">moveBlock</a>(wach, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(NameInfo.<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Buffer), NameInfo.<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length);
08871                 wach[NameInfo.<a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html#o1">Name</a>.Length / <span class="keyword">sizeof</span>(WCHAR)] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
08872                 Print(<span class="stringliteral">"\n----Windows for %ws desktop @%08lx:\n\n"</span>, wach, pdesk);
08873                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pwnd, &amp;(desk.pDeskInfo-&gt;spwnd));
08874                 <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/userexts_8c.html#a231">Idw</a>((opts &amp; ~OFLAG(a)) | OFLAG(p), pwnd)) {
08875                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08876                 }
08877             }
08878         NEXTEACHDESKTOP(pdesk)
08879 #<span class="keywordflow">else</span> <span class="comment">// !KERNEL</span>
08880         TEB teb;
08881 
08882         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a190">GetTargetTEB</a>(&amp;teb, NULL)) {
08883             <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">PDESKTOPINFO</a> pdi;
08884             <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">DESKTOPINFO</a> <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>;
08885 
08886             pdi = ((<a class="code" href="../../d2/d2/struct__CLIENTINFO.html">PCLIENTINFO</a>)&amp;teb.Win32ClientInfo[0])-&gt;pDeskInfo;
08887             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(di, pdi);
08888             <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/userexts_8c.html#a231">Idw</a>(opts &amp; ~OFLAG(a) | OFLAG(p), <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.spwnd));
08889         }
08890 <span class="preprocessor">#endif // !KERNEL</span>
<a name="l08891"></a><a class="code" href="../../d2/d1/userexts_8c.html#a228">08891</a> <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08892     }
08893 
08894     <span class="comment">/*</span>
08895 <span class="comment">     * t is like EnumThreadWindows.</span>
08896 <span class="comment">     */</span>
08897     <span class="keywordflow">if</span> (opts &amp; OFLAG(t)) {
08898 <span class="preprocessor">#ifdef KERNEL</span>
08899 <span class="preprocessor"></span>        <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti, ptiWnd;
08900         <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a> pdesk;
08901         <a class="code" href="../../d1/d3/structtagDESKTOPINFO.html">PDESKTOPINFO</a> pdi;
08902         <span class="comment">/*</span>
08903 <span class="comment">         * Get the desktop's first child window</span>
08904 <span class="comment">         */</span>
08905         pti = (<a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a>)param1;
08906         <span class="keywordflow">if</span> (!tryMove(pdesk, &amp;pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a>)
08907                 || !tryMove(pdi, &amp;pdesk-&gt;<a class="code" href="../../d0/d3/structtagDESKTOP.html#o0">pDeskInfo</a>)
08908                 || !tryMove(pwnd, &amp;pdi-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>)
08909                 || !tryMove(pwnd, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>)) {
08910             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08911         }
08912         <span class="comment">/*</span>
08913 <span class="comment">         * Walk the sibling chain looking for pwnd owned by pti.</span>
08914 <span class="comment">         */</span>
08915         SAFEWHILE (pwnd) {
08916             <span class="keywordflow">if</span> (tryMove(ptiWnd, &amp;(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.pti)) &amp;&amp; (ptiWnd == pti)) {
08917                 <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/userexts_8c.html#a231">Idw</a>(opts &amp; ~OFLAG(t), pwnd)) {
08918                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08919                 }
08920             }
08921             <span class="keywordflow">if</span> (!tryMove(pwnd, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>)) {
08922                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08923             }
08924         }
08925         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08926 
08927 <span class="preprocessor">#else // !KERNEL</span>
08928 <span class="preprocessor"></span>        Print(<span class="stringliteral">"t parameter not supported for NTSD at this point\n"</span>);
08929 <span class="preprocessor">#endif // !KERNEL</span>
08930 <span class="preprocessor"></span>    }
08931 
08932     <span class="comment">/*</span>
08933 <span class="comment">     * See if the user wants all top level windows.</span>
08934 <span class="comment">     */</span>
08935     <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || opts &amp; (OFLAG(p) | OFLAG(s))) {
08936         <span class="comment">/*</span>
08937 <span class="comment">         * Make sure there was also a window argument if p or s.</span>
08938 <span class="comment">         */</span>
<a name="l08939"></a><a class="code" href="../../d2/d1/userexts_8c.html#a229">08939</a> 
08940         <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; (opts &amp; (OFLAG(p) | OFLAG(s)))) {
08941             Print(<span class="stringliteral">"Must specify window with '-p' or '-s' options.\n"</span>);
08942             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08943         }
08944 
08945         <span class="keywordflow">if</span> (param1 &amp;&amp; (pwnd = <a class="code" href="../../d2/d1/userexts_8c.html#a197">HorPtoP</a>(pwnd, TYPE_WINDOW)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08946             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08947         }
08948 
08949         <span class="keywordflow">if</span> (opts &amp; OFLAG(p)) {
08950             Print(<span class="stringliteral">"pwndParent = 0x%p\n"</span>, pwnd);
08951             <span class="keywordflow">if</span> (!tryMove(pwnd, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(&amp;pwnd-&gt;spwndChild))) {
08952                 Print(<span class="stringliteral">"&lt;&lt; Can't get WND &gt;&gt;\n"</span>);
08953                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; <span class="comment">// we don't need to have the flags explained!</span>
08954             }
08955             SAFEWHILE (pwnd) {
08956                 <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d1/userexts_8c.html#a231">Idw</a>(opts &amp; ~OFLAG(p), pwnd)) {
08957                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08958                 }
08959                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pwnd, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(&amp;pwnd-&gt;spwndNext));
08960             }
08961             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08962 
08963         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opts &amp; OFLAG(s)) {
08964             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pwnd, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(&amp;pwnd-&gt;spwndParent));
08965             <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/userexts_8c.html#a231">Idw</a>((opts | OFLAG(p)) &amp; ~OFLAG(s), pwnd);
08966 
08967         } <span class="keywordflow">else</span> {    <span class="comment">// pwnd == NULL &amp; !p &amp; !s</span>
08968 <span class="preprocessor">#ifdef KERNEL</span>
08969 <span class="preprocessor"></span>            <a class="code" href="../../d7/d4/structtagQ.html">Q</a> q;
08970             <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
08971             <a class="code" href="../../d2/d8/structtagTHREADINFO.html">THREADINFO</a> ti;
08972             <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
08973 
08974             moveExpValuePtr(&amp;pq, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpqForeground));
08975             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(q, pq);
08976             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ti, q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>);
08977             <span class="keywordflow">if</span> (ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o6">rpdesk</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08978                 Print(<span class="stringliteral">"Foreground thread doesn't have a desktop.\n"</span>);
08979                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08980             }
08981             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pwnd, &amp;(ti.<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o7">pDeskInfo</a>-&gt;<a class="code" href="../../d1/d3/structtagDESKTOPINFO.html#o2">spwnd</a>));
08982             Print(<span class="stringliteral">"pwndDesktop = 0x%p\n"</span>, pwnd);
08983             <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/userexts_8c.html#a231">Idw</a>(opts | OFLAG(p), pwnd);
08984 <span class="preprocessor">#else  // !KERNEL</span>
08985 <span class="preprocessor"></span>            <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/userexts_8c.html#a231">Idw</a>(opts | OFLAG(a), 0);
08986 <span class="preprocessor">#endif // !KERNEL</span>
08987 <span class="preprocessor"></span>        }
08988     }
08989 
08990     <span class="keywordflow">if</span> (param1 &amp;&amp; (pwnd = <a class="code" href="../../d2/d1/userexts_8c.html#a197">HorPtoP</a>(param1, TYPE_WINDOW)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
08991         Print(<span class="stringliteral">"Idw: 0x%p is not a pwnd.\n"</span>, param1);
08992         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
08993     }
08994 
08995     <span class="keywordflow">if</span> (opts &amp;  OFLAG(r)) {
08996         <a class="code" href="../../d2/d1/userexts_8c.html#a200">dwrWorker</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(pwnd), 0);
08997         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
08998     }
08999 
09000     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wnd, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(pwnd));
09001 
09002 <span class="preprocessor">#ifdef KERNEL</span>
09003 <span class="preprocessor"></span>    <span class="comment">/*</span>
09004 <span class="comment">     * Print simple thread info.</span>
09005 <span class="comment">     */</span>
09006     <span class="keywordflow">if</span> (wnd.<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.pti) {
09007         Idt(OFLAG(p), (PVOID)wnd.<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.pti);
09008     }
09009 <span class="preprocessor">#endif // KERNEL</span>
09010 <span class="preprocessor"></span>    <span class="comment">/*</span>
09011 <span class="comment">     * Print pwnd.</span>
09012 <span class="comment">     */</span>
09013     Print(<span class="stringliteral">"pwnd    = 0x%p"</span>, pwnd);
09014     <span class="comment">/*</span>
09015 <span class="comment">     * Show z-ordering/activation revelant info</span>
09016 <span class="comment">     */</span>
09017     <span class="keywordflow">if</span> (opts &amp; OFLAG(z)) {
09018         <span class="keywordflow">if</span> (wnd.ExStyle &amp; WS_EX_TOPMOST) {
09019             Print(<span class="stringliteral">" TOPMOST"</span>);
09020         }
09021         <span class="keywordflow">if</span> (!(wnd.style &amp; WS_VISIBLE)) {
09022             Print(<span class="stringliteral">" HIDDEN"</span>);
09023         }
09024         <span class="keywordflow">if</span> (wnd.style &amp; WS_DISABLED) {
09025             Print(<span class="stringliteral">" DISABLED"</span>);
09026         }
09027         <span class="keywordflow">if</span> (wnd.<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
09028             <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>, ach);
09029             Print(<span class="stringliteral">" OWNER:0x%p \"%s\""</span>, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>, ach);
09030         }
09031     }
09032     Print(<span class="stringliteral">"\n"</span>);
09033 
09034     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(v))) {
09035 
09036         <span class="comment">/*</span>
09037 <span class="comment">         * Print title string.</span>
09038 <span class="comment">         */</span>
09039         <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(pwnd, ach);
09040         Print(<span class="stringliteral">"title   = \"%s\"\n"</span>, ach);
09041 
09042         <span class="comment">/*</span>
09043 <span class="comment">         * Print wndproc symbol string.</span>
09044 <span class="comment">         */</span>
09045         <span class="keywordflow">if</span> (opts &amp; OFLAG(h)) {
09046             <span class="keywordflow">if</span> (IsWOWProc (wnd.<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>)) {
09047             UnMarkWOWProc(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>,dwWOW);
09048             Print(<span class="stringliteral">"wndproc = %04lx:%04lx (WOW) (%s)"</span>,
09049                     HIWORD(dwWOW),LOWORD(dwWOW),
09050                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(&amp;wnd, WFANSIPROC) ? <span class="stringliteral">"ANSI"</span> : <span class="stringliteral">"Unicode"</span> );
09051             }
09052             <span class="keywordflow">else</span> {
09053                 GetSym((LPVOID)wnd.<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>, ach, &amp;dwOffset);
09054                 Print(<span class="stringliteral">"wndproc = 0x%p = \"%s\" (%s)"</span>, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>, ach,
09055                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(&amp;wnd, WFANSIPROC) ? <span class="stringliteral">"ANSI"</span> : <span class="stringliteral">"Unicode"</span> );
09056             }
09057         } <span class="keywordflow">else</span> {
09058             <span class="keywordflow">if</span> (IsWOWProc (wnd.<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>)) {
09059                 UnMarkWOWProc(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>,dwWOW);
09060                 Print(<span class="stringliteral">"wndproc = %04lx:%04lx (WOW) (%s)"</span>,
09061                         HIWORD(dwWOW),LOWORD(dwWOW),
09062                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(&amp;wnd, WFANSIPROC) ? <span class="stringliteral">"ANSI"</span> : <span class="stringliteral">"Unicode"</span> );
09063             }
09064             <span class="keywordflow">else</span> {
09065                 Print(<span class="stringliteral">"wndproc = 0x%p (%s)"</span>, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>,
09066                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(&amp;wnd, WFANSIPROC) ? <span class="stringliteral">"ANSI"</span> : <span class="stringliteral">"Unicode"</span> );
09067             }
09068         }
09069 
09070         <span class="comment">/*</span>
09071 <span class="comment">         * Display the class name/atom</span>
09072 <span class="comment">         */</span>
09073         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cls, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>));
09074         <span class="keywordflow">if</span> (cls.<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> &lt; 0xC000) {
09075             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"0x%04x"</span>, cls.<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a>);
09076         } <span class="keywordflow">else</span> {
09077             <a class="code" href="../../d2/d1/userexts_8c.html#a199">DebugGetClassNameA</a>(cls.lpszAnsiClassName, ach);
09078         }
09079         Print(<span class="stringliteral">" Class:\"%s\"\n"</span>, ach);
09080     } <span class="keywordflow">else</span> {
09081         <span class="comment">/*</span>
09082 <span class="comment">         * Get the PWND structure.  Ignore class-specific data for now.</span>
09083 <span class="comment">         */</span>
09084         Print(<span class="stringliteral">"\tpti               @0x%p\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.pti));
09085         Print(<span class="stringliteral">"\thandle             0x%p\n"</span>, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o0">head</a>.h);
09086 
09087         <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>, ach);
09088         Print(<span class="stringliteral">"\tspwndNext         @0x%p     \"%s\"\n"</span>, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o2">spwndNext</a>, ach);
09089         <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, ach);
09090         Print(<span class="stringliteral">"\tspwndParent       @0x%p     \"%s\"\n"</span>, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>, ach);
09091         <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>, ach);
09092         Print(<span class="stringliteral">"\tspwndChild        @0x%p     \"%s\"\n"</span>, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o4">spwndChild</a>, ach);
09093         <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>, ach);
09094         Print(<span class="stringliteral">"\tspwndOwner        @0x%p     \"%s\"\n"</span>, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o5">spwndOwner</a>, ach);
09095 
09096         Print(<span class="stringliteral">"\trcWindow           (%d,%d)-(%d,%d) %dx%d\n"</span>,
09097                 wnd.<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top,
09098                 wnd.<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom,
09099                 wnd.<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - wnd.<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left,
09100                 wnd.<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.bottom - wnd.<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top);
09101 
09102         Print(<span class="stringliteral">"\trcClient           (%d,%d)-(%d,%d) %dx%d\n"</span>,
09103                 wnd.<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top,
09104                 wnd.<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.bottom,
09105                 wnd.<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right - wnd.<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left,
09106                 wnd.<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.bottom - wnd.<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top);
09107 
09108         <span class="keywordflow">if</span> (IsWOWProc (wnd.<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>)) {
09109             UnMarkWOWProc(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>,dwWOW);
09110             Print(<span class="stringliteral">"\tlpfnWndProc       @%04lx:%04lx (WOW) (%s)\n"</span>,
09111                     HIWORD(dwWOW),LOWORD(dwWOW),
09112                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(&amp;wnd, WFANSIPROC) ? <span class="stringliteral">"ANSI"</span> : <span class="stringliteral">"Unicode"</span> );
09113         }
09114         <span class="keywordflow">else</span> {
09115             GetSym((LPVOID)wnd.<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>, ach, &amp;dwOffset);
09116             Print(<span class="stringliteral">"\tlpfnWndProc       @0x%p     (%s) %s\n"</span>, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o8">lpfnWndProc</a>, ach,
09117                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(&amp;wnd, WFANSIPROC) ? <span class="stringliteral">"ANSI"</span> : <span class="stringliteral">"Unicode"</span> );
09118         }
09119         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cls, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>));
09120         <span class="keywordflow">if</span> (cls.<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a> &lt; 0xC000) {
09121             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"0x%04x"</span>, cls.<a class="code" href="../../d7/d0/structtagCLS.html#o1">atomClassName</a>);
09122         } <span class="keywordflow">else</span> {
09123             <a class="code" href="../../d2/d1/userexts_8c.html#a199">DebugGetClassNameA</a>(cls.lpszAnsiClassName, ach);
09124         }
09125         Print(<span class="stringliteral">"\tpcls              @0x%p     (%s)\n"</span>,
09126                 wnd.<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>, ach);
09127 
09128         Print(<span class="stringliteral">"\thrgnUpdate         0x%p\n"</span>,
09129                 wnd.<a class="code" href="../../d6/d9/structtagWND.html#o11">hrgnUpdate</a>);
09130         <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o12">spwndLastActive</a>, ach);
09131         Print(<span class="stringliteral">"\tspwndLastActive   @0x%p     \"%s\"\n"</span>,
09132               wnd.<a class="code" href="../../d6/d9/structtagWND.html#o12">spwndLastActive</a>, ach);
09133         Print(<span class="stringliteral">"\tppropList         @0x%p\n"</span>
09134               <span class="stringliteral">"\tpSBInfo           @0x%p\n"</span>,
09135               wnd.<a class="code" href="../../d6/d9/structtagWND.html#o13">ppropList</a>,
09136               wnd.<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a>);
09137         <span class="keywordflow">if</span> (wnd.<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a>) {
09138             <a class="code" href="../../d5/d5/structtagSBINFO.html">SBINFO</a> asb;
09139 
09140             <a class="code" href="../../d7/d4/conexts_8c.html#a2">moveBlock</a>(&amp;asb, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o14">pSBInfo</a>), <span class="keyword">sizeof</span>(asb));
09141             Print(<span class="stringliteral">"\t  SBO_FLAGS =      %s\n"</span>
09142                   <span class="stringliteral">"\t  SBO_HMIN  =      %d\n"</span>
09143                   <span class="stringliteral">"\t  SBO_HMAX  =      %d\n"</span>
09144                   <span class="stringliteral">"\t  SBO_HPAGE =      %d\n"</span>
09145                   <span class="stringliteral">"\t  SBO_HPOS  =      %d\n"</span>
09146                   <span class="stringliteral">"\t  SBO_VMIN  =      %d\n"</span>
09147                   <span class="stringliteral">"\t  SBO_VMAX  =      %d\n"</span>
09148                   <span class="stringliteral">"\t  SBO_VPAGE =      %d\n"</span>
09149                   <span class="stringliteral">"\t  SBO_VPOS  =      %d\n"</span>,
09150                     <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_SB, (WORD)asb.<a class="code" href="../../d5/d5/structtagSBINFO.html#o0">WSBflags</a>, NULL, TRUE),
09151                     asb.<a class="code" href="../../d5/d5/structtagSBINFO.html#o1">Horz</a>.<a class="code" href="../../d4/d5/structtagSBDATA.html#o0">posMin</a>,
09152                     asb.<a class="code" href="../../d5/d5/structtagSBINFO.html#o1">Horz</a>.<a class="code" href="../../d4/d5/structtagSBDATA.html#o1">posMax</a>,
09153                     asb.<a class="code" href="../../d5/d5/structtagSBINFO.html#o1">Horz</a>.<a class="code" href="../../d4/d5/structtagSBDATA.html#o2">page</a>,
09154                     asb.<a class="code" href="../../d5/d5/structtagSBINFO.html#o1">Horz</a>.<a class="code" href="../../d4/d5/structtagSBDATA.html#o3">pos</a>,
09155                     asb.<a class="code" href="../../d5/d5/structtagSBINFO.html#o2">Vert</a>.<a class="code" href="../../d4/d5/structtagSBDATA.html#o0">posMin</a>,
09156                     asb.<a class="code" href="../../d5/d5/structtagSBINFO.html#o2">Vert</a>.<a class="code" href="../../d4/d5/structtagSBDATA.html#o1">posMax</a>,
09157                     asb.<a class="code" href="../../d5/d5/structtagSBINFO.html#o2">Vert</a>.<a class="code" href="../../d4/d5/structtagSBDATA.html#o2">page</a>,
09158                     asb.<a class="code" href="../../d5/d5/structtagSBINFO.html#o2">Vert</a>.<a class="code" href="../../d4/d5/structtagSBDATA.html#o3">pos</a>);
09159         }
09160         Print(<span class="stringliteral">"\tspmenuSys         @0x%p\n"</span>
09161               <span class="stringliteral">"\tspmenu/id         @0x%p\n"</span>,
09162               wnd.<a class="code" href="../../d6/d9/structtagWND.html#o15">spmenuSys</a>,
09163               wnd.<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>);
09164         Print(<span class="stringliteral">"\thrgnClip           0x%p\n"</span>,
09165               wnd.<a class="code" href="../../d6/d9/structtagWND.html#o19">hrgnClip</a>);
09166 
09167 
09168         <span class="comment">/*</span>
09169 <span class="comment">         * Print title string.</span>
09170 <span class="comment">         */</span>
09171         <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(pwnd, ach);
09172         Print(<span class="stringliteral">"\tpName              \"%s\"\n"</span>,
09173               ach);
09174         Print(<span class="stringliteral">"\tdwUserData         0x%p\n"</span>,
09175               wnd.<a class="code" href="../../d6/d9/structtagWND.html#o18">dwUserData</a>);
09176         Print(<span class="stringliteral">"\tstate              0x%08lx\n"</span>
09177               <span class="stringliteral">"\tstate2             0x%08lx\n"</span>
09178               <span class="stringliteral">"\tExStyle            0x%08lx\n"</span>
09179               <span class="stringliteral">"\tstyle              0x%08lx\n"</span>
09180               <span class="stringliteral">"\tfnid               0x%08lx\n"</span>
09181               <span class="stringliteral">"\thImc               0x%08lx\n"</span>
09182               <span class="stringliteral">"\tbFullScreen        %d\n"</span>
09183               <span class="stringliteral">"\thModule            0x%08lx\n"</span>,
09184               wnd.state,
09185               wnd.state2,
09186               wnd.ExStyle,
09187               wnd.style,
09188               (DWORD)wnd.fnid,
09189               wnd.<a class="code" href="../../d6/d9/structtagWND.html#o20">hImc</a>,
09190               <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a744">GetFullScreen</a>(&amp;wnd),
09191               wnd.hModule);
09192     }
09193     <span class="comment">/*</span>
09194 <span class="comment">     * Print out all the flags</span>
09195 <span class="comment">     */</span>
09196     <span class="keywordflow">if</span> (opts &amp; OFLAG(f)) {
09197         <span class="keywordtype">int</span> i;
09198         WORD wFlag;
09199         <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pbyte = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(&amp;(wnd.state));
09200 
09201         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(aWindowFlags); i++) {
09202             wFlag = <a class="code" href="../../d2/d1/userexts_8c.html#a74">aWindowFlags</a>[i].<a class="code" href="../../d3/d8/struct__WFLAGS.html#o1">wFlag</a>;
09203             <span class="keywordflow">if</span> (pbyte[<a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(wFlag)] &amp; <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(wFlag)) {
09204                 Print(<span class="stringliteral">"\t%-18s\t%lx:%02lx\n"</span>,
09205                         aWindowFlags[i].pszText,
09206                         (PBYTE)&amp;(pwnd-&gt;state) + <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(wFlag),
09207                         <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(wFlag));
09208             }
09209         }
09210     }
09211 
09212     <span class="keywordflow">if</span> (opts &amp; OFLAG(w)) {
09213         Print(<span class="stringliteral">"\t%d window bytes: "</span>, wnd.<a class="code" href="../../d6/d9/structtagWND.html#o10">cbwndExtra</a>);
09214         <span class="keywordflow">if</span> (wnd.<a class="code" href="../../d6/d9/structtagWND.html#o10">cbwndExtra</a>) {
09215             <span class="keywordflow">for</span> (ix=0; ix &lt; wnd.<a class="code" href="../../d6/d9/structtagWND.html#o10">cbwndExtra</a>; ix += 4) {
09216                  <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> UNALIGNED *pdw;
09217 
09218                  pdw = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> UNALIGNED *) ((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> *) (pwnd+1) + ix);
09219                  <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(tempDWord, pdw);
09220                  Print(<span class="stringliteral">"%08x "</span>, tempDWord);
09221             }
09222         }
09223         Print(<span class="stringliteral">"\n"</span>);
09224     }
09225 
09226     <span class="comment">/*</span>
09227 <span class="comment">     * Print window properties.</span>
09228 <span class="comment">     */</span>
09229     <span class="keywordflow">if</span> (opts &amp; OFLAG(o)) {
09230         <a class="code" href="../../d2/d6/structtagSERVERINFO.html">PSERVERINFO</a> psi;
09231         <a class="code" href="../../d5/d4/structtagPROPLIST.html">PPROPLIST</a>   ppropList;
09232         <a class="code" href="../../d5/d4/structtagPROPLIST.html">PROPLIST</a>    propList;
09233         <a class="code" href="../../d1/d4/structtagPROP.html">PROP</a>        prop;
09234         <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>        i, j;
09235 
09236         <span class="keyword">struct </span>{
09237             LPSTR   pstrName;
09238             ATOM    atom;
09239             LPSTR   pstrSymbol;
09240         } apropatom[] =
09241         {
09242             <span class="stringliteral">"Icon"</span>,         0,  MAKEINTRESOURCEA(FIELD_OFFSET(<a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a>, atomIconProp)),
09243             <span class="stringliteral">"IconSM"</span>,       0,  MAKEINTRESOURCEA(FIELD_OFFSET(<a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a>, atomIconSmProp)),
09244             <span class="stringliteral">"ContextHelpID"</span>,0,  MAKEINTRESOURCEA(FIELD_OFFSET(<a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a>, atomContextHelpIdProp)),
09245             <span class="stringliteral">"Checkpoint"</span>,   0,  <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(atomCheckpointProp),
09246             <span class="stringliteral">"Flash State"</span>,  0,  <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gaFlashWState),
09247             <span class="stringliteral">"DDETrack"</span>,     0,  <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(atomDDETrack),
09248             <span class="stringliteral">"QOS"</span>,          0,  <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(atomQOS),
09249             <span class="stringliteral">"DDEImp"</span>,       0,  <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(atomDDEImp),
09250             <span class="stringliteral">"WNDOBJ"</span>,       0,  <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(atomWndObj),
09251             <span class="stringliteral">"IMELevel"</span>,     0,  <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(atomImeLevel),
09252         };
09253 
09254 
09255         <span class="comment">/*</span>
09256 <span class="comment">         * Get the atom values for internal properties and put them in apropatom.atom</span>
09257 <span class="comment">         */</span>
09258         moveExpValuePtr(&amp;psi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
09259         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(apropatom); i++) {
09260             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(apropatom[i].pstrSymbol)) {
09261 
09262                 <span class="comment">/*</span>
09263 <span class="comment">                 * The atom is stored in psi.</span>
09264 <span class="comment">                 */</span>
09265                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(apropatom[0].atom, (ATOM *) ((BYTE *)psi + LOWORD(apropatom[i].pstrSymbol)));
09266             } <span class="keywordflow">else</span> {
09267 
09268                 <span class="comment">/*</span>
09269 <span class="comment">                 * The atom is a global.</span>
09270 <span class="comment">                 */</span>
09271                 moveExpValue(&amp;apropatom[i].atom, apropatom[i].pstrSymbol);
09272             }
09273         }
09274 
09275         <span class="comment">/*</span>
09276 <span class="comment">         * Print the property list structure.</span>
09277 <span class="comment">         */</span>
09278         ppropList = wnd.<a class="code" href="../../d6/d9/structtagWND.html#o13">ppropList</a>;
09279         <span class="keywordflow">if</span> (!ppropList) {
09280             Print(<span class="stringliteral">"\tNULL Property List\n"</span>);
09281         } <span class="keywordflow">else</span> {
09282             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(propList, ppropList);
09283             Print(<span class="stringliteral">"\tProperty List @0x%08x : %d Properties, %d total entries, %d free entries\n"</span>,
09284                     ppropList,
09285                     propList.<a class="code" href="../../d5/d4/structtagPROPLIST.html#o1">iFirstFree</a>,
09286                     propList.<a class="code" href="../../d5/d4/structtagPROPLIST.html#o0">cEntries</a>,
09287                     propList.<a class="code" href="../../d5/d4/structtagPROPLIST.html#o0">cEntries</a> - propList.<a class="code" href="../../d5/d4/structtagPROPLIST.html#o1">iFirstFree</a>);
09288 
09289             <span class="comment">/*</span>
09290 <span class="comment">             * Print each property.</span>
09291 <span class="comment">             */</span>
09292             <span class="keywordflow">for</span> (i = 0; !IsCtrlCHit() &amp;&amp; i &lt; propList.<a class="code" href="../../d5/d4/structtagPROPLIST.html#o1">iFirstFree</a>; i++) {
09293                 LPSTR pstrInternal;
09294 
09295                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(prop, &amp;ppropList-&gt;<a class="code" href="../../d5/d4/structtagPROPLIST.html#o2">aprop</a>[i]);
09296 
09297                 <span class="comment">/*</span>
09298 <span class="comment">                 * Find name for internal property.</span>
09299 <span class="comment">                 */</span>
09300                 pstrInternal = <span class="stringliteral">""</span>;
09301                 <span class="keywordflow">if</span> (prop.<a class="code" href="../../d1/d4/structtagPROP.html#o2">fs</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a498">PROPF_INTERNAL</a>) {
09302                     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(apropatom); j++) {
09303                         <span class="keywordflow">if</span> (prop.<a class="code" href="../../d1/d4/structtagPROP.html#o1">atomKey</a> == apropatom[j].atom) {
09304                             pstrInternal = apropatom[j].pstrName;
09305                             <span class="keywordflow">break</span>;
09306                         }
09307                     }
09308                 }
09309 
09310                 Print(<span class="stringliteral">"\tProperty %d\n"</span>, i);
09311                 Print(<span class="stringliteral">"\t\tatomKey     0x%04x %s\n"</span>, prop.<a class="code" href="../../d1/d4/structtagPROP.html#o1">atomKey</a>, pstrInternal);
09312                 Print(<span class="stringliteral">"\t\tfs          0x%04x %s\n"</span>, prop.<a class="code" href="../../d1/d4/structtagPROP.html#o2">fs</a>, <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_PROP, prop.<a class="code" href="../../d1/d4/structtagPROP.html#o2">fs</a>, NULL, FALSE));
09313                 Print(<span class="stringliteral">"\t\thData       0x%08x (%d)\n"</span>, prop.<a class="code" href="../../d1/d4/structtagPROP.html#o0">hData</a>, prop.<a class="code" href="../../d1/d4/structtagPROP.html#o0">hData</a>);
09314 
09315 <span class="preprocessor">        #ifdef KERNEL</span>
09316 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (prop.<a class="code" href="../../d1/d4/structtagPROP.html#o2">fs</a> &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a498">PROPF_INTERNAL</a>) {
09317                     <span class="keywordflow">if</span> (j == 3) {
09318                         <a class="code" href="../../d0/d0/structtagCHECKPOINT.html">CHECKPOINT</a>  cp;
09319                         <a class="code" href="../../d0/d0/structtagCHECKPOINT.html">PCHECKPOINT</a> pcp = (<a class="code" href="../../d0/d0/structtagCHECKPOINT.html">PCHECKPOINT</a>)prop.<a class="code" href="../../d1/d4/structtagPROP.html#o0">hData</a>;
09320                         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(cp, pcp);
09321                         Print(<span class="stringliteral">"\t\tCheckPoint:\n"</span>);
09322                         Print(<span class="stringliteral">"\t\trcNormal (%d,%d),(%d,%d) %dx%d\n"</span>,
09323                                 cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o0">rcNormal</a>.left,
09324                                 cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o0">rcNormal</a>.top,
09325                                 cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o0">rcNormal</a>.right,
09326                                 cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o0">rcNormal</a>.bottom,
09327                                 cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o0">rcNormal</a>.right - cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o0">rcNormal</a>.left,
09328                                 cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o0">rcNormal</a>.bottom - cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o0">rcNormal</a>.top);
09329 
09330                         Print(<span class="stringliteral">"\t\tptMin    (%d,%d)\n"</span>,                cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.x, cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o1">ptMin</a>.y);
09331                         Print(<span class="stringliteral">"\t\tptMax    (%d,%d)\n"</span>,                cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o2">ptMax</a>.x, cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o2">ptMax</a>.y);
09332                         Print(<span class="stringliteral">"\t\tfDragged:%d\n"</span>,                     cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o3">fDragged</a>);
09333                         Print(<span class="stringliteral">"\t\tfWasMaximizedBeforeMinimized:%d\n"</span>, cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o4">fWasMaximizedBeforeMinimized</a>);
09334                         Print(<span class="stringliteral">"\t\tfWasMinimizedBeforeMaximized:%d\n"</span>, cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o5">fWasMinimizedBeforeMaximized</a>);
09335                         Print(<span class="stringliteral">"\t\tfMinInitialized:%d\n"</span>,              cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o6">fMinInitialized</a>);
09336                         Print(<span class="stringliteral">"\t\tfMaxInitiailized:%d\n"</span>,             cp.<a class="code" href="../../d0/d0/structtagCHECKPOINT.html#o7">fMaxInitialized</a>);
09337                     }
09338                 }
09339 <span class="preprocessor">        #endif // ifdef KERNEL</span>
09340 <span class="preprocessor"></span>
09341                 Print(<span class="stringliteral">"\n"</span>);
09342             }
09343         }
09344     }
09345 
09346     Print(<span class="stringliteral">"---\n"</span>);
09347 
09348     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09349 }
09350 
09351 
09352 <span class="preprocessor">#ifdef KERNEL</span>
09353 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
09354 <span class="comment">* Procedure: Idwpi</span>
09355 <span class="comment">*</span>
09356 <span class="comment">* Description: Dumps WOWPROCESSINFO structs</span>
09357 <span class="comment">*</span>
09358 <span class="comment">* Returns:  fSuccess</span>
09359 <span class="comment">*</span>
09360 <span class="comment">* 6/9/1995 Created SanfordS</span>
09361 <span class="comment">*</span>
09362 <span class="comment">\************************************************************************/</span>
09363 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idwpi(
09364 DWORD opts,
09365 PVOID param1)
09366 {
09367 
09368     <a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html">PWOWPROCESSINFO</a> pwpi;
09369     <a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html">WOWPROCESSINFO</a> wpi;
09370     <a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a> ppi;
09371 
09372     <span class="keywordflow">if</span> (param1 == 0) {
09373         FOREACHPPI(ppi)
09374             Print("Process %x.\n", FIXKP(ppi));
09375             move(pwpi, FIXKP(&amp;ppi-&gt;pwpi));
09376             SAFEWHILE (pwpi) {
09377                 Idwpi(0, pwpi);
09378                 Print(<span class="stringliteral">"\n"</span>);
09379                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pwpi, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(&amp;pwpi-&gt;pwpiNext));
09380             }
09381         NEXTEACHPPI()
09382         return TRUE;
09383     }
09384 
09385     if (opts &amp; OFLAG(p)) {
09386         ppi = (<a class="code" href="../../d7/d3/structtagPROCESSINFO.html">PPROCESSINFO</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
09387         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pwpi, &amp;ppi-&gt;pwpi);
09388         <span class="keywordflow">if</span> (pwpi == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
09389             Print(<span class="stringliteral">"No pwpis for this process.\n"</span>);
09390             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09391         }
09392         SAFEWHILE (pwpi) {
09393             Idwpi(0, pwpi);
09394             Print(<span class="stringliteral">"\n"</span>);
09395             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pwpi, &amp;pwpi-&gt;pwpiNext);
09396         }
09397         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09398     }
09399 
09400     pwpi = (<a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html">PWOWPROCESSINFO</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
09401     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wpi, pwpi);
09402 
09403     Print(<span class="stringliteral">"PWOWPROCESSINFO @ 0x%p\n"</span>, pwpi);
09404     Print(<span class="stringliteral">"\tpwpiNext             0x%08lx\n"</span>, wpi.<a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html#o0">pwpiNext</a>);
09405     Print(<span class="stringliteral">"\tptiScheduled         0x%08lx\n"</span>, wpi.<a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html#o1">ptiScheduled</a>);
09406     Print(<span class="stringliteral">"\tnTaskLock            0x%08lx\n"</span>, wpi.<a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html#o2">nTaskLock</a>);
09407     Print(<span class="stringliteral">"\tptdbHead             0x%08lx\n"</span>, wpi.<a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html#o3">ptdbHead</a>);
09408     Print(<span class="stringliteral">"\tlpfnWowExitTask      0x%08lx\n"</span>, wpi.<a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html#o4">lpfnWowExitTask</a>);
09409     Print(<span class="stringliteral">"\tpEventWowExec        0x%08lx\n"</span>, wpi.<a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html#o5">pEventWowExec</a>);
09410     Print(<span class="stringliteral">"\thEventWowExecClient  0x%08lx\n"</span>, wpi.<a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html#o6">hEventWowExecClient</a>);
09411     Print(<span class="stringliteral">"\tnSendLock            0x%08lx\n"</span>, wpi.<a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html#o7">nSendLock</a>);
09412     Print(<span class="stringliteral">"\tnRecvLock            0x%08lx\n"</span>, wpi.<a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html#o8">nRecvLock</a>);
09413     Print(<span class="stringliteral">"\tCSOwningThread       0x%08lx\n"</span>, wpi.<a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html#o9">CSOwningThread</a>);
09414     Print(<span class="stringliteral">"\tCSLockCount          0x%08lx\n"</span>, wpi.<a class="code" href="../../d7/d9/structtagWOWPROCESSINFO.html#o10">CSLockCount</a>);
09415     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09416 }
09417 <span class="preprocessor">#endif // KERNEL</span>
09418 <span class="preprocessor"></span>
09419 <span class="comment">/************************************************************************\</span>
09420 <span class="comment">* Procedure: Idha</span>
09421 <span class="comment">*</span>
09422 <span class="comment">* Description: Walks the global array of heaps gWin32Heaps looking for an</span>
09423 <span class="comment">* allocation that contain the address passed in.  Then does a sanity check</span>
09424 <span class="comment">* on the entire heap the allocations belongs to.</span>
09425 <span class="comment">* DHAVerifyHeap is a helper procedure.  Note that the passed in parameter is</span>
09426 <span class="comment">* already mapped</span>
09427 <span class="comment">*</span>
09428 <span class="comment">* Returns:</span>
09429 <span class="comment">*</span>
09430 <span class="comment">* 12/7/1998 Created MCostea</span>
09431 <span class="comment">*</span>
09432 <span class="comment">\************************************************************************/</span>
09433 
09434 <span class="preprocessor">#ifdef KERNEL</span>
09435 <span class="preprocessor"></span>
09436 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> DHAVerifyHeap(
09437 PWIN32HEAP pHeap,
09438 BOOL bVerbose)
09439 {
09440     DbgHeapHead Alloc, *pAlloc = pHeap-&gt;pFirstAlloc;
09441     <span class="keywordtype">int</span> sizeHead, counter = 0;
09442     <span class="keywordtype">char</span>    szHeadOrTail[HEAP_CHECK_SIZE];
09443 
09444     <span class="keywordflow">if</span> (pAlloc == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
09445         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09446 
09447     sizeHead = pHeap-&gt;dwFlags &amp; WIN32_HEAP_USE_GUARDS ?
09448                <span class="keyword">sizeof</span>(pHeap-&gt;szHead) : 0;
09449 
09450     <span class="keywordflow">do</span> {
09451         <span class="keywordflow">if</span> (!tryMove(Alloc, pAlloc)) {
09452             Print(<span class="stringliteral">"Failed to read pAlloc from %p\n"</span>, pAlloc);
09453             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09454         }
09455         <span class="comment">/*</span>
09456 <span class="comment">         * Check the mark, header and tail</span>
09457 <span class="comment">         */</span>
09458         <span class="keywordflow">if</span> (Alloc.mark != HEAP_ALLOC_MARK) {
09459             Print(<span class="stringliteral">"!!! Bad mark found in allocation use !dso DbgHeapHead %p\n"</span>, pAlloc);
09460         }
09461         <span class="keywordflow">if</span> (sizeHead) {
09462             <span class="keywordflow">if</span> (!tryMove(szHeadOrTail, (PBYTE)pAlloc-<span class="keyword">sizeof</span>(szHeadOrTail))) {
09463                 Print(<span class="stringliteral">"Failed to read szHead from %p\n"</span>, (PBYTE)pAlloc-<span class="keyword">sizeof</span>(szHeadOrTail));
09464                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09465             }
09466             <span class="keywordflow">if</span> (!RtlEqualMemory(szHeadOrTail, pHeap-&gt;szHead, sizeHead)) {
09467                 Print(<span class="stringliteral">"Head pattern corrupted for allocation %#p\n"</span>, pAlloc);
09468             }
09469             <span class="keywordflow">if</span> (!tryMove(szHeadOrTail, (PBYTE)pAlloc + <span class="keyword">sizeof</span>(DbgHeapHead) + Alloc.size)) {
09470                 Print(<span class="stringliteral">"Failed to read szHead from %p\n"</span>, (PBYTE)pAlloc + <span class="keyword">sizeof</span>(DbgHeapHead) + Alloc.size);
09471                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09472             }
09473             <span class="keywordflow">if</span> (!RtlEqualMemory(szHeadOrTail, pHeap-&gt;szTail, sizeHead)) {
09474                 Print(<span class="stringliteral">"Tail pattern corrupted for allocation %#p\n"</span>, pAlloc);
09475             }
09476         }
09477         <span class="keywordflow">if</span> (bVerbose) {
09478             Print(<span class="stringliteral">"Allocation %#p, tag %04d size %08d\n"</span>, pAlloc, Alloc.tag, Alloc.size);
09479         }
09480         <span class="keywordflow">if</span> (counter++ &gt; 100) {
09481             Print(<span class="stringliteral">"."</span>);
09482             counter = 0;
09483         }
09484         pAlloc = Alloc.pNext;
09485     } <span class="keywordflow">while</span> (pAlloc != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
09486     <span class="keywordflow">if</span> (bVerbose) {
09487         Print(<span class="stringliteral">"To dump an allocation use !dso DBGHEAPHEAD address\n"</span>);
09488     }
09489 
09490     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09491 }
09492 
09493 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idha(
09494 DWORD opts,
09495 PVOID pointer)
09496 {
09497     <span class="keywordtype">int</span> ind, counter;
09498     SIZE_T sizeHead;
09499     WIN32HEAP localgWin32Heaps[MAX_HEAPS];
09500 
09501     <span class="keywordflow">if</span> (pointer == 0 &amp;&amp; (opts &amp; OFLAG(a) ==0)) {
09502         Print(<span class="stringliteral">"Wrong usage: dha takes a pointer as a parameter\n"</span>);
09503         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09504     }
09505 
09506     <span class="keywordflow">if</span> (!tryMoveBlock(localgWin32Heaps, EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gWin32Heaps)), <span class="keyword">sizeof</span>(localgWin32Heaps)))
09507     {
09508         Print(<span class="stringliteral">"Can't read the heap globals fix symbols and !reload win32k.sys\n"</span>);
09509         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09510     }
09511 
09512     <span class="comment">/*</span>
09513 <span class="comment">     * Walk gWin32Heaps array and look for an allocation containing this pointer</span>
09514 <span class="comment">     */</span>
09515     <span class="keywordflow">for</span> (ind = counter = 0; ind &lt; MAX_HEAPS; ind++) {
09516 
09517         <span class="comment">/*</span>
09518 <span class="comment">         * Is the address in this heap?</span>
09519 <span class="comment">         */</span>
09520         <span class="keywordflow">if</span> ((opts &amp; OFLAG(a)) == 0) {
09521             <span class="keywordflow">if</span> ((PVOID)localgWin32Heaps[ind].heap &gt; pointer ||
09522                 (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)localgWin32Heaps[ind].heap + localgWin32Heaps[ind].heapReserveSize &lt; (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pointer) {
09523 
09524                 <span class="keywordflow">continue</span>;
09525             }
09526         }
09527 
09528         Print(<span class="stringliteral">"\nHeap number %d "</span>, ind);
09529         Print(<span class="stringliteral">"at address %p, flags %d is "</span>, localgWin32Heaps[ind].heap, localgWin32Heaps[ind].dwFlags);
09530 
09531 
09532         <span class="keywordflow">if</span> (localgWin32Heaps[ind].dwFlags &amp; WIN32_HEAP_INUSE) {
09533 
09534             DbgHeapHead  Alloc, *pAlloc;
09535 
09536             Print(<span class="stringliteral">"in use\n"</span>);
09537             <span class="keywordflow">if</span> (localgWin32Heaps[ind].pFirstAlloc == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
09538                 <span class="keywordflow">continue</span>;
09539 
09540             pAlloc = localgWin32Heaps[ind].pFirstAlloc;
09541             <span class="keywordflow">if</span> (localgWin32Heaps[ind].dwFlags &amp; WIN32_HEAP_USE_GUARDS) {
09542                 sizeHead =  <span class="keyword">sizeof</span>(localgWin32Heaps[0].szHead);
09543                 Print(<span class="stringliteral">"    has string quards szHead %s, szTail %s\n"</span>,
09544                         localgWin32Heaps[0].szHead,
09545                         localgWin32Heaps[0].szTail);
09546             } <span class="keywordflow">else</span> {
09547                 sizeHead =  0;
09548                 Print(<span class="stringliteral">"no string quards\n"</span>);
09549             }
09550 
09551             <span class="keywordflow">if</span> (opts &amp; OFLAG(a)) {
09552                 <span class="keywordflow">if</span> (DHAVerifyHeap(&amp;localgWin32Heaps[ind], opts &amp; OFLAG(v))) {
09553                     Print(<span class="stringliteral">"WIN32HEAP at %p is healthy\n"</span>, localgWin32Heaps[ind].heap);
09554                 }
09555                 <span class="keywordflow">continue</span>;
09556             }
09557             <span class="keywordflow">do</span> {
09558                 <span class="keywordflow">if</span> (!tryMove(Alloc, pAlloc)) {
09559                     Print(<span class="stringliteral">"Failed to read pAlloc %p\n"</span>, pAlloc);
09560                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09561                 }
09562                 <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pAlloc - sizeHead &lt; (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pointer &amp;&amp;
09563                     (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pAlloc + <span class="keyword">sizeof</span>(DbgHeapHead) + Alloc.size + sizeHead &gt; (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pointer) {
09564 
09565                     <span class="comment">/*</span>
09566 <span class="comment">                     * Found the allocation</span>
09567 <span class="comment">                     */</span>
09568                     Print(<span class="stringliteral">"Found allocation %p "</span>, pAlloc);
09569                     <span class="keywordflow">if</span> (pointer == (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pAlloc + <span class="keyword">sizeof</span>(DbgHeapHead)) {
09570                         Print(<span class="stringliteral">"as the begining of a heap allocated block\n"</span>);
09571                     } <span class="keywordflow">else</span> {
09572                         Print(<span class="stringliteral">"inside a heap allocated block\n"</span>);
09573                     }
09574                     Print(<span class="stringliteral">"tag %04d size %08d now verify the heap\n"</span>, Alloc.tag, Alloc.size);
09575                     <span class="comment">/*</span>
09576 <span class="comment">                     * Verify the entire heap for corruption</span>
09577 <span class="comment">                     */</span>
09578                     <span class="keywordflow">if</span> (DHAVerifyHeap(&amp;localgWin32Heaps[ind], opts &amp; OFLAG(v))) {
09579                         Print(<span class="stringliteral">"WIN32HEAP at %p is healthy\n"</span>, localgWin32Heaps[ind].heap);
09580                     }
09581                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09582                 } <span class="keywordflow">else</span> {
09583                     pAlloc = Alloc.pNext;
09584                     <span class="keywordflow">if</span> (counter++ &gt; 100) {
09585                         counter = 0;
09586                         Print(<span class="stringliteral">"."</span>);
09587                     }
09588                 }
09589 
09590             } <span class="keywordflow">while</span> (pAlloc != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
09591         } <span class="keywordflow">else</span> {
09592             Print(<span class="stringliteral">"NOT in use\n"</span>);
09593         }
09594     }
09595     Print(<span class="stringliteral">"No heap contains this pointer %p\n"</span>, pointer);
09596     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09597 }
09598 
09599 <span class="comment">/***************************************************************************\</span>
09600 <span class="comment">* dws   - dump windows stations</span>
09601 <span class="comment">* dws h - dump windows stations plus handle list</span>
09602 <span class="comment">*</span>
09603 <span class="comment">* Dump WindowStation</span>
09604 <span class="comment">*</span>
09605 <span class="comment">* 8-11-94 SanfordS  Created</span>
09606 <span class="comment">* 6/9/1995 SanfordS made to fit stdexts motif</span>
09607 <span class="comment">\***************************************************************************/</span>
09608 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idws(
09609 DWORD opts,
09610 PVOID param1)
09611 {
09612     <a class="code" href="../../d4/d9/structtagWINDOWSTATION.html">WINDOWSTATION</a>           winsta, *pwinsta;
09613     WCHAR                   ach[80];
09614     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">OBJECT_HEADER</a>           Head;
09615     <a class="code" href="../../d0/d6/struct__OBJECT__HEADER__NAME__INFO.html">OBJECT_HEADER_NAME_INFO</a> NameInfo;
09616 
09617     UNREFERENCED_PARAMETER(opts);
09618 
09619     <span class="keywordflow">if</span> (param1 == 0) {
09620 
09621         FOREACHWINDOWSTATION(pwinsta)
09622 
09623             Idws(0, pwinsta);
09624             Print("\n");
09625 
09626         NEXTEACHWINDOWSTATION(pwinsta)
09627 
09628         return TRUE;
09629     }
09630 
09631     pwinsta = param1;
09632     move(winsta, pwinsta);
09633     move(Head, OBJECT_TO_OBJECT_HEADER(pwinsta));
09634     move(NameInfo, ((PCHAR)(OBJECT_TO_OBJECT_HEADER(pwinsta)) - Head.NameInfoOffset));
09635     move(ach, NameInfo.Name.Buffer);
09636     ach[NameInfo.Name.Length / sizeof(WCHAR)] = 0;
09637     Print("Windowstation: %ws @%0lx\n", ach, pwinsta);
09638     Print("  # Opens            = %d\n", Head.HandleCount);
09639     Print("  pTerm              = %0lx\n", winsta.pTerm);
09640     Print("  rpdeskList         = %0lx\n", winsta.rpdeskList);
09641     Print("  dwFlags            = %0lx\n", winsta.dwWSF_Flags);
09642     Print("  spklList           = %0lx\n", winsta.spklList);
09643     Print("  ptiClipLock        = %0lx\n", winsta.ptiClipLock);
09644     Print("  spwndClipOpen      = %0lx\n", winsta.spwndClipOpen);
09645     Print("  spwndClipViewer    = %0lx\n", winsta.spwndClipViewer);
09646     Print("  spwndClipOwner     = %0lx\n", winsta.spwndClipOwner);
09647     Print("  pClipBase          = %0lx\n", winsta.pClipBase);
09648     Print("  cNumClipFormats    = %0lx\n", winsta.cNumClipFormats);
09649     Print("  ptiDrawingClipboard= %0lx\n", winsta.ptiDrawingClipboard);
09650     Print("  fClipboardChanged  = %d\n",   winsta.fClipboardChanged);
09651     Print("  pGlobalAtomTable   = %0lx\n", winsta.pGlobalAtomTable);
09652     Print("  luidUser           = %0lx.%lx\n", winsta.luidUser.HighPart,
09653             winsta.luidUser.LowPart);
09654 
09655     return TRUE;
09656 }
09657 
09658 <span class="comment">/***************************************************************************\</span>
09659 <span class="comment">* ddl   - dump desktop log</span>
09660 <span class="comment">*</span>
09661 <span class="comment">* 12-03-97 CLupu  Created</span>
09662 <span class="comment">\***************************************************************************/</span>
09663 
09664 BOOL Iddl(
09665 DWORD opts,
09666 PVOID param1)
09667 {
09668 <span class="preprocessor">#ifdef LOGDESKTOPLOCKS</span>
09669 <span class="preprocessor"></span>    <a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>                pdesk;
09670     <a class="code" href="../../d0/d3/structtagDESKTOP.html">DESKTOP</a>                 desk;
09671     <a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html">OBJECT_HEADER</a>           Head;
09672     LogD                    log;
09673     PLogD                   pLog;
09674     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>                    bExtra = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09675     <span class="keywordtype">int</span>                     i, ind;
09676     DWORD_PTR               dwOffset;
09677     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>                    symbol[160];
09678 
09679     <span class="keywordflow">if</span> (param1 == 0) {
09680         Print(<span class="stringliteral">"Use !ddl pdesk\n"</span>);
09681         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09682     }
09683 
09684     pdesk = (<a class="code" href="../../d0/d3/structtagDESKTOP.html">PDESKTOP</a>)param1;
09685     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(desk, pdesk);
09686     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(Head, <a class="code" href="../../d4/d0/ob_8h.html#a8">OBJECT_TO_OBJECT_HEADER</a>(pdesk));
09687 
09688     Print(<span class="stringliteral">"Desktop locks:\n\n"</span>);
09689     Print(<span class="stringliteral">"# HandleCount      = %d\n"</span>, Head.<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o1">HandleCount</a>);
09690     Print(<span class="stringliteral">"# PointerCount     = %d\n"</span>, Head.<a class="code" href="../../d4/d5/struct__OBJECT__HEADER.html#o0">PointerCount</a>);
09691     Print(<span class="stringliteral">"# Log PointerCount = %d\n\n"</span>, desk.nLockCount);
09692 
09693     pLog = desk.pLog;
09694 
09695     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
09696         bExtra = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09697     }
09698 
09699     <span class="keywordflow">for</span> (i = 0; i &lt; desk.nLogCrt; i++) {
09700         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(log, pLog);
09701 
09702         Print(<span class="stringliteral">"%s Tag %6d Extra %8lx\n"</span>,
09703               (log.type ? <span class="stringliteral">"LOCK  "</span> : <span class="stringliteral">"UNLOCK"</span>),
09704                log.tag, log.extra);
09705 
09706         <span class="keywordflow">if</span> (bExtra) {
09707             Print(<span class="stringliteral">"----------------------------------------------\n"</span>);
09708 
09709             <span class="keywordflow">for</span> (ind = 0; ind &lt; 6; ind++) {
09710                 <span class="keywordflow">if</span> (log.trace[ind] == 0) {
09711                     <span class="keywordflow">break</span>;
09712                 }
09713 
09714                 GetSym((PVOID)log.trace[ind], symbol, &amp;dwOffset);
09715                 <span class="keywordflow">if</span> (*symbol) {
09716                     Print(<span class="stringliteral">"\t%s"</span>, symbol);
09717                     <span class="keywordflow">if</span> (dwOffset) {
09718                         Print(<span class="stringliteral">" + %x\n"</span>, dwOffset);
09719                     }
09720                 }
09721             }
09722             Print(<span class="stringliteral">"\n"</span>);
09723         }
09724 
09725         pLog++;
09726     }
<a name="l09727"></a><a class="code" href="../../d2/d1/userexts_8c.html#a230">09727</a>     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09728 <span class="preprocessor">#else</span>
09729 <span class="preprocessor"></span>    Print(<span class="stringliteral">"!ddl is available only on LOGDESKTOPLOCKS enabled builds of win32k.sys\n"</span>);
09730     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09731     UNREFERENCED_PARAMETER(opts);
09732     UNREFERENCED_PARAMETER(param1);
09733 <span class="preprocessor">#endif // LOGDESKTOPLOCKS</span>
09734 <span class="preprocessor"></span>}
09735 
09736 <span class="comment">/***************************************************************************\</span>
09737 <span class="comment">* dcss   - dump critical section stack</span>
09738 <span class="comment">*</span>
09739 <span class="comment">* Dump critical section stack</span>
09740 <span class="comment">*</span>
09741 <span class="comment">* 12-27-96 CLupu  Created</span>
09742 <span class="comment">\***************************************************************************/</span>
09743 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idcss(
09744 DWORD opts,
09745 PVOID param1)
09746 {
09747     <span class="keywordtype">int</span>        trace;
09748     DWORD_PTR  off;
09749     <a class="code" href="../../d4/d1/structtagCRITSTACK.html">PCRITSTACK</a> pstack;
09750     <a class="code" href="../../d4/d1/structtagCRITSTACK.html">CRITSTACK</a>  stack;
09751     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>       symbol[160];
09752 
09753     <span class="comment">/*</span>
09754 <span class="comment">     * Set up globals for speed.</span>
09755 <span class="comment">     */</span>
09756     moveExp(&amp;pstack, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gCritStack));
09757     <span class="keywordflow">if</span> (!tryMove(stack, pstack)) {
09758         Print(<span class="stringliteral">"dcss: Could not get CRITSTACK.\n"</span>);
09759         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09760     }
09761 
09762     <span class="keywordflow">if</span> (stack.<a class="code" href="../../d4/d1/structtagCRITSTACK.html#o2">nFrames</a> &gt; 0) {
09763         Print(<span class="stringliteral">"--- Critical section stack trace ---\n"</span>);
09764 
09765         Print(<span class="stringliteral">"\nthread : %8lx\n"</span>, stack.<a class="code" href="../../d4/d1/structtagCRITSTACK.html#o1">thread</a>);
09766 
09767         Print(<span class="stringliteral">"\n\tRetAddr   Call\n"</span>);
09768 
09769         <span class="keywordflow">for</span> (trace = 0; trace &lt; stack.<a class="code" href="../../d4/d1/structtagCRITSTACK.html#o2">nFrames</a>; trace++) {
09770             GetSym((PVOID)stack.<a class="code" href="../../d4/d1/structtagCRITSTACK.html#o3">trace</a>[trace], symbol, &amp;off);
09771             Print(<span class="stringliteral">"\t%#p  %s+%x\n"</span>, stack.<a class="code" href="../../d4/d1/structtagCRITSTACK.html#o3">trace</a>[trace], symbol, off);
09772         }
09773     }
09774 
09775     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09776 
09777     UNREFERENCED_PARAMETER(opts);
09778     UNREFERENCED_PARAMETER(param1);
09779 }
09780 
09781 <span class="keywordtype">void</span> PrintStackTrace(
09782     PVOID* parrTrace,
09783     <span class="keywordtype">int</span>    tracesCount)
09784 {
09785     <span class="keywordtype">int</span>       traceInd;
09786     DWORD_PTR dwOffset;
09787     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>      symbol[160];
09788 
09789     <span class="keywordflow">for</span> (traceInd = 0; traceInd &lt; tracesCount; traceInd++) {
09790 
09791         <span class="keywordflow">if</span> (parrTrace[traceInd] == 0) {
09792             <span class="keywordflow">break</span>;
09793         }
09794 
09795         GetSym(parrTrace[traceInd], symbol, &amp;dwOffset);
09796         <span class="keywordflow">if</span> (*symbol) {
09797             Print(<span class="stringliteral">"\t%s"</span>, symbol);
09798             <span class="keywordflow">if</span> (dwOffset) {
09799                 Print(<span class="stringliteral">"+%x\n"</span>, dwOffset);
09800             }
09801         }
09802     }
09803     Print(<span class="stringliteral">"\n"</span>);
09804 }
09805 
09806 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idvs(
09807 DWORD opts,
09808 PVOID param1)
09809 {
09810     PWin32Section   pSection;
09811     Win32Section    Section;
09812     PWin32MapView   pView;
09813     Win32MapView    View;
09814     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            bIncludeStackTrace = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09815 
09816     <span class="keywordflow">if</span> (EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpSections)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
09817         Print(<span class="stringliteral">"!dvs is available if TRACE_MAP_VIEWS is defined\n"</span>);
09818         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09819     }
09820 
09821     moveExpValuePtr(&amp;pSection, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpSections));
09822 
09823     <span class="keywordflow">if</span> (opts &amp; OFLAG(s)) {
09824         bIncludeStackTrace = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09825     }
09826 
09827     <span class="keywordflow">while</span> (pSection != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
09828         <span class="keywordflow">if</span> (!tryMove(Section, pSection)) {
09829             Print(<span class="stringliteral">"!dvs: Could not get pSection structure for %#p\n"</span>, pSection);
09830             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09831         }
09832 
09833         Print(<span class="stringliteral">"&gt;&gt;--------------------------------------\n"</span>);
09834 
09835         Print(<span class="stringliteral">"Section          %#p\n"</span>
09836               <span class="stringliteral">"   pFirstView    %#p\n"</span>
09837               <span class="stringliteral">"   SectionObject %#p\n"</span>
09838               <span class="stringliteral">"   SectionSize   0x%x\n"</span>
09839               <span class="stringliteral">"   SectionTag    0x%x\n"</span>,
09840               pSection,
09841               Section.pFirstView,
09842               Section.SectionObject,
09843               Section.SectionSize,
09844               Section.SectionTag);
09845 
09846         <span class="keywordflow">if</span> (bIncludeStackTrace) {
09847 <span class="preprocessor">#ifdef MAP_VIEW_STACK_TRACE</span>
09848 <span class="preprocessor"></span>            DWORD_PTR dwOffset;
09849             <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>  symbol[160];
09850             <span class="keywordtype">int</span>   ind;
09851 
09852             <span class="keywordflow">for</span> (ind = 0; ind &lt; MAP_VIEW_STACK_TRACE_SIZE; ind++) {
09853                 <span class="keywordflow">if</span> (Section.trace[ind] == 0) {
09854                     <span class="keywordflow">break</span>;
09855                 }
09856 
09857                 GetSym((PVOID)Section.trace[ind], symbol, &amp;dwOffset);
09858                 <span class="keywordflow">if</span> (*symbol) {
09859                     Print(<span class="stringliteral">"   %s"</span>, symbol);
09860                     <span class="keywordflow">if</span> (dwOffset) {
09861                         Print(<span class="stringliteral">"+%x\n"</span>, dwOffset);
09862                     }
09863                 }
09864             }
09865             Print(<span class="stringliteral">"\n"</span>);
09866 <span class="preprocessor">#endif // MAP_VIEW_STACK_TRACE</span>
09867 <span class="preprocessor"></span>        }
09868 
09869         pView = Section.pFirstView;
09870 
09871         <span class="keywordflow">while</span> (pView != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
09872             <span class="keywordflow">if</span> (!tryMove(View, pView)) {
09873                 Print(<span class="stringliteral">"!dvs: Could not get pView structure for %#p\n"</span>, pView);
09874                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09875             }
09876 
09877             Print(<span class="stringliteral">"Views: ---------------------------------\n"</span>
09878                   <span class="stringliteral">" View          %#p\n"</span>
09879                   <span class="stringliteral">"    pViewBase  %#p\n"</span>
09880                   <span class="stringliteral">"    ViewSize   %#p\n"</span>,
09881                   pView,
09882                   View.pViewBase,
09883                   View.ViewSize);
09884 
09885             <span class="keywordflow">if</span> (bIncludeStackTrace) {
09886 <span class="preprocessor">#ifdef MAP_VIEW_STACK_TRACE</span>
09887 <span class="preprocessor"></span>                DWORD_PTR dwOffset;
09888                 <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>  symbol[160];
09889                 <span class="keywordtype">int</span>   ind;
09890 
09891                 <span class="keywordflow">for</span> (ind = 0; ind &lt; MAP_VIEW_STACK_TRACE_SIZE; ind++) {
09892                     <span class="keywordflow">if</span> (View.trace[ind] == 0) {
09893                         <span class="keywordflow">break</span>;
09894                     }
09895 
09896                     GetSym((PVOID)View.trace[ind], symbol, &amp;dwOffset);
09897                     <span class="keywordflow">if</span> (*symbol) {
09898                         Print(<span class="stringliteral">"    %s"</span>, symbol);
09899                         <span class="keywordflow">if</span> (dwOffset) {
09900                             Print(<span class="stringliteral">"+%x\n"</span>, dwOffset);
09901                         }
09902                     }
09903                 }
09904                 Print(<span class="stringliteral">"\n"</span>);
09905 <span class="preprocessor">#endif // MAP_VIEW_STACK_TRACE</span>
09906 <span class="preprocessor"></span>            }
09907 
09908             pView = View.pNext;
09909         }
09910 
09911         pSection = Section.pNext;
09912     }
09913     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09914     UNREFERENCED_PARAMETER(opts);
09915     UNREFERENCED_PARAMETER(param1);
09916 }
09917 
09918 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idfa(
<a name="l09919"></a><a class="code" href="../../d2/d1/userexts_8c.html#a200">09919</a> DWORD opts,
09920 PVOID param1)
09921 {
09922 <span class="preprocessor">#if DBG</span>
09923 <span class="preprocessor"></span>    DWORD_PTR  dwOffset;
09924     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>       symbol[160];
09925     <span class="keywordtype">int</span>        ind;
09926     PVOID*     pTrace;
09927     PVOID      trace;
09928     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      dwAllocFailIndex;
09929     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>*     pdwAllocFailIndex;
09930     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>  <a class="code" href="../../d1/d8/w32_2ntuser_2kernel_2event_8c.html#a2">pep</a>;
09931     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>* ppep;
09932     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>   pet;
09933     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>*  ppet;
09934 
09935     <span class="keywordflow">if</span> (EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gdwAllocFailIndex)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
09936         Print(<span class="stringliteral">"!dfa is available only in debug versions of win32k.sys\n"</span>);
09937         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09938     }
09939 
09940     moveExp(&amp;pdwAllocFailIndex, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gdwAllocFailIndex));
09941     <span class="keywordflow">if</span> (!tryMove(dwAllocFailIndex, pdwAllocFailIndex)) {
09942         Print(<span class="stringliteral">"dfa failure"</span>);
09943         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09944     }
09945 
09946     moveExp(&amp;ppep, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpepRecorded));
09947     <span class="keywordflow">if</span> (!tryMove(<a class="code" href="../../d1/d8/w32_2ntuser_2kernel_2event_8c.html#a2">pep</a>, ppep)) {
09948         Print(<span class="stringliteral">"dfa failure"</span>);
09949         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09950     }
09951     moveExp(&amp;ppet, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpetRecorded));
09952     <span class="keywordflow">if</span> (!tryMove(pet, ppet)) {
09953         Print(<span class="stringliteral">"dfa failure"</span>);
09954         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09955     }
09956 
09957     Print(<span class="stringliteral">"Fail allocation index %d 0x%04x\n"</span>, dwAllocFailIndex, dwAllocFailIndex);
09958     Print(<span class="stringliteral">"pEProcess %#p pEThread %#p\n\n"</span>, <a class="code" href="../../d1/d8/w32_2ntuser_2kernel_2event_8c.html#a2">pep</a>, pet);
09959 
09960     moveExp(&amp;pTrace, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gRecordedStackTrace));
09961 
09962     <span class="keywordflow">for</span> (ind = 0; ind &lt; 12; ind++) {
09963 
09964         <span class="keywordflow">if</span> (!tryMove(trace, pTrace)) {
09965             Print(<span class="stringliteral">"dfa failure"</span>);
09966             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
09967         }
09968 
09969         <span class="keywordflow">if</span> (trace == 0) {
09970             <span class="keywordflow">break</span>;
09971         }
09972 
09973         GetSym((PVOID)trace, symbol, &amp;dwOffset);
09974         <span class="keywordflow">if</span> (*symbol) {
09975             Print(<span class="stringliteral">"\t%s"</span>, symbol);
09976             <span class="keywordflow">if</span> (dwOffset) {
09977                 Print(<span class="stringliteral">"+%x\n"</span>, dwOffset);
09978             }
09979         }
09980 
09981         pTrace++;
09982     }
09983     Print(<span class="stringliteral">"\n"</span>);
09984 <span class="preprocessor">#endif // DBG</span>
<a name="l09985"></a><a class="code" href="../../d2/d1/userexts_8c.html#a231">09985</a> <span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
09986     UNREFERENCED_PARAMETER(opts);
09987     UNREFERENCED_PARAMETER(param1);
09988 }
09989 
09990 <span class="comment">/***************************************************************************\</span>
09991 <span class="comment">* dpa   - dump pool allocations</span>
09992 <span class="comment">*</span>
09993 <span class="comment">* Dump pool allocations</span>
09994 <span class="comment">*</span>
09995 <span class="comment">* 12-27-96 CLupu  Created</span>
09996 <span class="comment">\***************************************************************************/</span>
09997 
09998 
09999 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idpa(
10000 DWORD opts,
10001 PVOID param1)
10002 {
10003     <a class="code" href="../../d3/d9/structtagWin32AllocStats.html">PWin32AllocStats</a> pAllocList;
10004     <a class="code" href="../../d3/d9/structtagWin32AllocStats.html">Win32AllocStats</a>  AllocList;
10005     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>*           pdwPoolFlags;
10006     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>            dwPoolFlags;
10007     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>             bIncludeStackTrace = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10008 
10009     moveExp(&amp;pdwPoolFlags, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gdwPoolFlags));
10010     <span class="keywordflow">if</span> (!tryMove(dwPoolFlags, pdwPoolFlags)) {
10011         Print(<span class="stringliteral">"Couldn't evaluate win32k!gdwPoolFlags. The symbols may be wrong !\n"</span>);
10012         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10013     }
10014 
10015     <span class="keywordflow">if</span> (!(dwPoolFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a210">POOL_HEAVY_ALLOCS</a>)) {
10016         Print(<span class="stringliteral">"win32k.sys doesn't have pool instrumentation !\n"</span>);
10017         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10018     }
10019 
10020     <span class="keywordflow">if</span> (opts &amp; OFLAG(s)) {
10021         <span class="keywordflow">if</span> (dwPoolFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a211">POOL_CAPTURE_STACK</a>) {
10022             bIncludeStackTrace = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10023         } <span class="keywordflow">else</span> {
10024             Print(<span class="stringliteral">"win32k.sys doesn't have stack traces enabled for pool allocations\n"</span>);
10025         }
10026     }
10027 
10028     moveExp(&amp;pAllocList, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gAllocList));
10029     <span class="keywordflow">if</span> (!tryMove(AllocList, pAllocList)) {
10030         Print(<span class="stringliteral">"Could not get Win32AllocStats structure win32k!gAllocList !\n"</span>);
10031         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10032     }
10033 
10034     <span class="comment">/*</span>
10035 <span class="comment">     * Handle !dpa -c</span>
10036 <span class="comment">     */</span>
10037     <span class="keywordflow">if</span> (opts &amp; OFLAG(c)) {
10038 
10039         Print(<span class="stringliteral">"- pool instrumentation enabled for win32k.sys\n"</span>);
10040         <span class="keywordflow">if</span> (dwPoolFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a211">POOL_CAPTURE_STACK</a>) {
10041             Print(<span class="stringliteral">"- stack traces enabled for pool allocations\n"</span>);
10042         } <span class="keywordflow">else</span> {
10043             Print(<span class="stringliteral">"- stack traces disabled for pool allocations\n"</span>);
10044         }
10045 
10046         <span class="keywordflow">if</span> (dwPoolFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a216">POOL_KEEP_FAIL_RECORD</a>) {
10047             Print(<span class="stringliteral">"- records of failed allocations enabled\n"</span>);
10048         } <span class="keywordflow">else</span> {
10049             Print(<span class="stringliteral">"- records of failed allocations disabled\n"</span>);
10050         }
10051 
10052         <span class="keywordflow">if</span> (dwPoolFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a215">POOL_KEEP_FREE_RECORD</a>) {
10053             Print(<span class="stringliteral">"- records of free pool enabled\n"</span>);
10054         } <span class="keywordflow">else</span> {
10055             Print(<span class="stringliteral">"- records of free pool disabled\n"</span>);
10056         }
10057 
10058         Print(<span class="stringliteral">"\n"</span>);
10059 
10060         Print(<span class="stringliteral">"    CrtM         CrtA         MaxM         MaxA       Head\n"</span>);
10061         Print(<span class="stringliteral">"------------|------------|------------|------------|------------|\n"</span>);
10062         Print(<span class="stringliteral">" 0x%08x   0x%08x   0x%08x   0x%08x   0x%08x\n"</span>,
10063               AllocList.<a class="code" href="../../d3/d9/structtagWin32AllocStats.html#o1">dwCrtMem</a>,
10064               AllocList.<a class="code" href="../../d3/d9/structtagWin32AllocStats.html#o3">dwCrtAlloc</a>,
10065               AllocList.<a class="code" href="../../d3/d9/structtagWin32AllocStats.html#o0">dwMaxMem</a>,
10066               AllocList.<a class="code" href="../../d3/d9/structtagWin32AllocStats.html#o2">dwMaxAlloc</a>,
10067               AllocList.<a class="code" href="../../d3/d9/structtagWin32AllocStats.html#o4">pHead</a>);
10068 
10069         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10070     }
10071 
10072     <span class="keywordflow">if</span> (opts &amp; OFLAG(f)) {
10073 
10074         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        dwFailRecordCrtIndex;
10075         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>*       pdwFailRecordCrtIndex;
10076         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        dwFailRecordTotalFailures;
10077         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>*       pdwFailRecordTotalFailures;
10078         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        dwFailRecords;
10079         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>*       pdwFailRecords;
10080         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        Ind, dwFailuresToDump;
10081         <a class="code" href="../../d3/d3/structtagPOOLRECORD.html">PPOOLRECORD</a>* ppFailRecord;
10082         <a class="code" href="../../d3/d3/structtagPOOLRECORD.html">PPOOLRECORD</a>  pFailRecord;
10083         <a class="code" href="../../d3/d3/structtagPOOLRECORD.html">PPOOLRECORD</a>  pFailRecordOrg;
10084 
10085         <span class="keywordflow">if</span> (!(dwPoolFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a216">POOL_KEEP_FAIL_RECORD</a>)) {
10086             Print(<span class="stringliteral">"win32k.sys doesn't have records of failed allocations !\n"</span>);
10087             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10088         }
10089 
10090         moveExp(&amp;pdwFailRecordTotalFailures, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gdwFailRecordTotalFailures));
10091         <span class="keywordflow">if</span> (!tryMove(dwFailRecordTotalFailures, pdwFailRecordTotalFailures)) {
10092             Print(<span class="stringliteral">"Could not get win32k!gdwFailRecordTotalFailures !\n"</span>);
10093             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10094         }
10095 
10096         <span class="keywordflow">if</span> (dwFailRecordTotalFailures == 0) {
10097             Print(<span class="stringliteral">"No allocation failure in win32k.sys !\n"</span>);
10098             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10099         }
10100 
10101         moveExp(&amp;pdwFailRecordCrtIndex, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gdwFailRecordCrtIndex));
10102         <span class="keywordflow">if</span> (!tryMove(dwFailRecordCrtIndex, pdwFailRecordCrtIndex)) {
10103             Print(<span class="stringliteral">"Could not get win32k!gdwFailRecordCrtIndex !\n"</span>);
10104             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10105         }
10106 
10107         moveExp(&amp;pdwFailRecords, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gdwFailRecords));
10108         <span class="keywordflow">if</span> (!tryMove(dwFailRecords, pdwFailRecords)) {
10109             Print(<span class="stringliteral">"Could not get win32k!gdwFailRecords !\n"</span>);
10110             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10111         }
10112 
10113         <span class="keywordflow">if</span> (dwFailRecordTotalFailures &lt; dwFailRecords) {
10114             dwFailuresToDump = dwFailRecordTotalFailures;
10115         } <span class="keywordflow">else</span> {
10116             dwFailuresToDump = dwFailRecords;
10117         }
10118 
10119         moveExp(&amp;ppFailRecord, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gparrFailRecord));
10120 
10121         <span class="keywordflow">if</span> (!tryMove(pFailRecord, ppFailRecord)) {
10122             Print(<span class="stringliteral">"\nCould not move from %#p !\n\n"</span>, ppFailRecord);
10123             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10124         }
10125 
10126         pFailRecordOrg = pFailRecord;
10127 
10128         Print(<span class="stringliteral">"\nFailures to dump : %d\n\n"</span>, dwFailuresToDump);
10129 
10130         <span class="keywordflow">for</span> (Ind = 0; Ind &lt; dwFailuresToDump; Ind++) {
10131 
10132             <a class="code" href="../../d3/d3/structtagPOOLRECORD.html">POOLRECORD</a> FailRecord;
10133             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>      tag[2] = {0, 0};
10134 
10135             <span class="keywordflow">if</span> (dwFailRecordCrtIndex == 0) {
10136                 dwFailRecordCrtIndex = dwFailRecords - 1;
10137             } <span class="keywordflow">else</span> {
10138                 dwFailRecordCrtIndex--;
10139             }
10140 
10141             pFailRecord = pFailRecordOrg + dwFailRecordCrtIndex;
10142 
10143             <span class="comment">/*</span>
10144 <span class="comment">             * Dump</span>
10145 <span class="comment">             */</span>
10146             <span class="keywordflow">if</span> (!tryMove(FailRecord, pFailRecord)) {
10147                 Print(<span class="stringliteral">"\nCould not move from %#p !\n\n"</span>, pFailRecord);
10148                 <span class="keywordflow">break</span>;
10149             }
10150 
10151             tag[0] = PtrToUlong(FailRecord.<a class="code" href="../../d3/d3/structtagPOOLRECORD.html#o0">ExtraData</a>);
10152 
10153             Print(<span class="stringliteral">"Allocation for tag '%s' size 0x%x failed\n"</span>,
10154                   &amp;tag,
10155                   FailRecord.<a class="code" href="../../d3/d3/structtagPOOLRECORD.html#o1">size</a>);
10156 
10157             PrintStackTrace(FailRecord.<a class="code" href="../../d3/d3/structtagPOOLRECORD.html#o2">trace</a>, RECORD_STACK_TRACE_SIZE);
10158         }
10159     }
10160     <span class="keywordflow">if</span> (opts &amp; OFLAG(r)) {
10161 
10162         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        dwFreeRecordCrtIndex;
10163         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>*       pdwFreeRecordCrtIndex;
10164         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        dwFreeRecordTotalFrees;
10165         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>*       pdwFreeRecordTotalFrees;
10166         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        dwFreeRecords;
10167         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>*       pdwFreeRecords;
10168         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>        Ind, dwFreesToDump;
10169         <a class="code" href="../../d3/d3/structtagPOOLRECORD.html">PPOOLRECORD</a>* ppFreeRecord;
10170         <a class="code" href="../../d3/d3/structtagPOOLRECORD.html">PPOOLRECORD</a>  pFreeRecord;
10171         <a class="code" href="../../d3/d3/structtagPOOLRECORD.html">PPOOLRECORD</a>  pFreeRecordOrg;
10172 
10173         <span class="keywordflow">if</span> (!(dwPoolFlags &amp; <a class="code" href="../../d4/d1/userk_8h.html#a215">POOL_KEEP_FREE_RECORD</a>)) {
10174             Print(<span class="stringliteral">"win32k.sys doesn't have records of free pool !\n"</span>);
10175             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10176         }
10177 
10178         moveExp(&amp;pdwFreeRecordTotalFrees, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gdwFreeRecordTotalFrees));
10179         <span class="keywordflow">if</span> (!tryMove(dwFreeRecordTotalFrees, pdwFreeRecordTotalFrees)) {
10180             Print(<span class="stringliteral">"Could not get win32k!gdwFreeRecordTotalFrees !\n"</span>);
10181             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10182         }
10183 
10184         <span class="keywordflow">if</span> (dwFreeRecordTotalFrees == 0) {
10185             Print(<span class="stringliteral">"No free pool in win32k.sys !\n"</span>);
10186             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10187         }
10188 
10189         moveExp(&amp;pdwFreeRecordCrtIndex, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gdwFreeRecordCrtIndex));
10190         <span class="keywordflow">if</span> (!tryMove(dwFreeRecordCrtIndex, pdwFreeRecordCrtIndex)) {
10191             Print(<span class="stringliteral">"Could not get win32k!gdwFreeRecordCrtIndex !\n"</span>);
10192             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10193         }
10194 
10195         moveExp(&amp;pdwFreeRecords, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gdwFreeRecords));
10196         <span class="keywordflow">if</span> (!tryMove(dwFreeRecords, pdwFreeRecords)) {
10197             Print(<span class="stringliteral">"Could not get win32k!gdwFreeRecords !\n"</span>);
10198             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10199         }
10200 
10201         <span class="keywordflow">if</span> (dwFreeRecordTotalFrees &lt; dwFreeRecords) {
10202             dwFreesToDump = dwFreeRecordTotalFrees;
10203         } <span class="keywordflow">else</span> {
10204             dwFreesToDump = dwFreeRecords;
10205         }
10206 
10207         moveExp(&amp;ppFreeRecord, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gparrFreeRecord));
10208 
10209         <span class="keywordflow">if</span> (!tryMove(pFreeRecord, ppFreeRecord)) {
10210             Print(<span class="stringliteral">"\nCould not move from %#p !\n\n"</span>, ppFreeRecord);
10211             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10212         }
10213 
10214         pFreeRecordOrg = pFreeRecord;
10215 
10216         Print(<span class="stringliteral">"\nFrees to dump : %d\n\n"</span>, dwFreesToDump);
10217 
10218         <span class="keywordflow">for</span> (Ind = 0; Ind &lt; dwFreesToDump; Ind++) {
10219 
10220             <a class="code" href="../../d3/d3/structtagPOOLRECORD.html">POOLRECORD</a> FreeRecord;
10221 
10222             <span class="keywordflow">if</span> (dwFreeRecordCrtIndex == 0) {
10223                 dwFreeRecordCrtIndex = dwFreeRecords - 1;
10224             } <span class="keywordflow">else</span> {
10225                 dwFreeRecordCrtIndex--;
10226             }
10227 
10228             pFreeRecord = pFreeRecordOrg + dwFreeRecordCrtIndex;
10229 
10230             <span class="comment">/*</span>
10231 <span class="comment">             * Dump</span>
10232 <span class="comment">             */</span>
10233             <span class="keywordflow">if</span> (!tryMove(FreeRecord, pFreeRecord)) {
10234                 Print(<span class="stringliteral">"\nCould not move from %#p !\n\n"</span>, pFreeRecord);
10235                 <span class="keywordflow">break</span>;
10236             }
10237 
10238             Print(<span class="stringliteral">"Free pool for p %#p size 0x%x\n"</span>,
10239                   FreeRecord.<a class="code" href="../../d3/d3/structtagPOOLRECORD.html#o0">ExtraData</a>,
10240                   FreeRecord.<a class="code" href="../../d3/d3/structtagPOOLRECORD.html#o1">size</a>);
10241 
10242             PrintStackTrace(FreeRecord.<a class="code" href="../../d3/d3/structtagPOOLRECORD.html#o2">trace</a>, RECORD_STACK_TRACE_SIZE);
10243         }
10244     }
10245 
10246     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
10247 
10248         PWin32PoolHead ph;
10249         Win32PoolHead  h;
10250 
10251 
10252         ph = AllocList.<a class="code" href="../../d3/d9/structtagWin32AllocStats.html#o4">pHead</a>;
10253 
10254         <span class="keywordflow">while</span> (ph != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
10255 
10256             <span class="keywordflow">if</span> (!tryMove(h, ph)) {
10257                 Print(<span class="stringliteral">"\nCould not move from %#p !\n\n"</span>, ph);
10258                 <span class="keywordflow">break</span>;
10259             }
10260 
10261             Print(<span class="stringliteral">"p %#p pHead %#p size %x\n"</span>,
10262                   ph + 1, ph, h.size);
10263 
10264             <span class="keywordflow">if</span> (bIncludeStackTrace) {
10265 
10266                 DWORD_PTR dwOffset;
10267                 <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>      symbol[160];
10268                 <span class="keywordtype">int</span>       ind;
10269                 PVOID     trace;
10270                 PVOID*    pTrace;
10271 
10272                 pTrace = h.pTrace;
10273 
10274                 <span class="keywordflow">for</span> (ind = 0; ind &lt; POOL_ALLOC_TRACE_SIZE; ind++) {
10275 
10276                     <span class="keywordflow">if</span> (!tryMove(trace, pTrace)) {
10277                         Print(<span class="stringliteral">"dpa failure\n"</span>);
10278                         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10279                     }
10280 
10281                     <span class="keywordflow">if</span> (trace == 0) {
10282                         <span class="keywordflow">break</span>;
10283                     }
10284 
10285                     GetSym((PVOID)trace, symbol, &amp;dwOffset);
10286                     <span class="keywordflow">if</span> (*symbol) {
10287                         Print(<span class="stringliteral">"\t%s"</span>, symbol);
10288                         <span class="keywordflow">if</span> (dwOffset) {
10289                             Print(<span class="stringliteral">"+%x\n"</span>, dwOffset);
10290                         }
10291                     }
10292 
10293                     pTrace++;
10294                 }
10295                 Print(<span class="stringliteral">"\n"</span>);
10296             }
10297 
10298             ph = h.pNext;
10299         }
10300         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10301     }
10302 
10303     <span class="keywordflow">if</span> (opts &amp; OFLAG(p)) {
10304 
10305         PWin32PoolHead ph;
10306         Win32PoolHead  h;
10307         <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>*          p;
10308 
10309         <span class="keywordflow">if</span> (param1 == 0) {
10310             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10311         }
10312 
10313         p = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>*)param1;
10314 
10315         ph = AllocList.<a class="code" href="../../d3/d9/structtagWin32AllocStats.html#o4">pHead</a>;
10316 
10317         <span class="keywordflow">while</span> (ph != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
10318 
10319             <span class="keywordflow">if</span> (!tryMove(h, ph)) {
10320                 Print(<span class="stringliteral">"\nCould not move from %#p !\n\n"</span>, ph);
10321                 <span class="keywordflow">break</span>;
10322             }
10323 
10324             <span class="keywordflow">if</span> (p &gt;= (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>*)ph &amp;&amp; p &lt;= (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>*)ph + h.size + <span class="keyword">sizeof</span>(Win32PoolHead)) {
10325 
10326                 PVOID Trace[<a class="code" href="../../d4/d1/userk_8h.html#a209">RECORD_STACK_TRACE_SIZE</a>];
10327 
10328                 Print(<span class="stringliteral">"p %#p pHead %#p size %x\n"</span>,
10329                       ph + 1, ph, h.size);
10330 
10331                 <a class="code" href="../../d7/d4/conexts_8c.html#a2">moveBlock</a>(Trace, h.pTrace, <span class="keyword">sizeof</span>(PVOID) * RECORD_STACK_TRACE_SIZE);
10332 
10333 
10334                 PrintStackTrace(Trace, RECORD_STACK_TRACE_SIZE);
10335                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10336             }
10337 
10338             ph = h.pNext;
10339         }
10340         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10341     }
10342 
10343     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10344 }
10345 <span class="preprocessor">#endif // KERNEL</span>
10346 <span class="preprocessor"></span>
10347 
10348 
10349 <span class="comment">/************************************************************************\</span>
10350 <span class="comment">* Procedure: Ifno</span>
10351 <span class="comment">*</span>
10352 <span class="comment">* Description: Find Nearest Objects - helps in figureing out references</span>
10353 <span class="comment">*   to freed objects or stale pointers.</span>
10354 <span class="comment">*</span>
10355 <span class="comment">* Returns: fSuccess</span>
10356 <span class="comment">*</span>
10357 <span class="comment">* 6/9/1995 Created SanfordS</span>
10358 <span class="comment">*</span>
10359 <span class="comment">\************************************************************************/</span>
10360 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a232">Ifno</a>(
10361     DWORD opts,
10362     PVOID param1)
10363 {
10364     <a class="code" href="../../d2/d4/struct__HANDLEENTRY.html">HANDLEENTRY</a> he, heBest, heAfter, *phe;
10365     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
10366     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> hBest, hAfter;
10367     DWORD_PTR dw;
10368 
10369     UNREFERENCED_PARAMETER(opts);
10370 
10371     <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
10372         Print(<span class="stringliteral">"Expected an address.\n"</span>);
10373         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10374     }
10375 
10376     dw = (DWORD_PTR)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
10377     heBest.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
10378     heAfter.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a> = (PVOID)-1;
10379 
10380     <span class="keywordflow">if</span> (dw != (DWORD_PTR)param1) {
10381         <span class="comment">/*</span>
10382 <span class="comment">         * no fixups needed - he's looking the kernel address range.</span>
10383 <span class="comment">         */</span>
10384         <a class="code" href="../../d2/d1/userexts_8c.html#a8">FOREACHHANDLEENTRY</a>(phe, he, i)
10385             if ((DWORD_PTR)he.phead &lt;= dw &amp;&amp;
10386                     heBest.phead &lt; he.phead &amp;&amp;
10387                     he.bType != TYPE_FREE) {
10388                 heBest = he;
10389                 hBest = i;
10390             }
10391             <span class="keywordflow">if</span> ((DWORD_PTR)he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a> &gt; dw &amp;&amp;
10392                     heAfter.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a> &gt; he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a> &amp;&amp;
10393                     he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a> != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a236">TYPE_FREE</a>) {
10394                 heAfter = he;
10395                 hAfter = i;
10396             }
10397         <a class="code" href="../../d2/d1/userexts_8c.html#a9">NEXTEACHHANDLEENTRY</a>()
10398 
10399         if (heBest.phead != NULL) {
10400             Print(<span class="stringliteral">"Nearest guy before %#p is a %s object located at %#p (i=%x).\n"</span>,
10401                     dw, aszTypeNames[heBest.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>], heBest.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>, hBest);
10402         }
10403         <span class="keywordflow">if</span> (heAfter.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a> != (PVOID)-1) {
10404             Print(<span class="stringliteral">"Nearest guy after %#p is a %s object located at %#p. (i=%x)\n"</span>,
10405                     dw, aszTypeNames[heAfter.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>], heAfter.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>, hAfter);
10406         }
10407     } <span class="keywordflow">else</span> {
10408         <span class="comment">/*</span>
10409 <span class="comment">         * fixups are needed.</span>
10410 <span class="comment">         */</span>
10411         <a class="code" href="../../d2/d1/userexts_8c.html#a8">FOREACHHANDLEENTRY</a>(phe, he, i)
10412             if ((DWORD_PTR)FIXKP(he.phead) &lt;= dw &amp;&amp;
10413                     heBest.phead &lt; he.phead &amp;&amp;
10414                     he.bType != TYPE_FREE) {
10415                 heBest = he;
10416                 hBest = i;
10417             }
10418             <span class="keywordflow">if</span> ((DWORD_PTR)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>) &gt; dw &amp;&amp;
10419                     heAfter.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a> &gt; he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a> &amp;&amp;
10420                     he.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a> != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a236">TYPE_FREE</a>) {
10421                 heAfter = he;
10422                 hAfter = i;
10423             }
10424         <a class="code" href="../../d2/d1/userexts_8c.html#a9">NEXTEACHHANDLEENTRY</a>()
10425 
10426         if (heBest.phead != NULL) {
10427             Print(<span class="stringliteral">"Nearest guy before %#p is a %s object located at %#p (i=%x).\n"</span>,
10428                     dw, aszTypeNames[heBest.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>], <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(heBest.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>), hBest);
10429         }
10430         <span class="keywordflow">if</span> (heAfter.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a> != (PVOID)-1) {
10431             Print(<span class="stringliteral">"Nearest guy after %#p is a %s object located at %#p. (i=%x)\n"</span>,
10432                     dw, aszTypeNames[heAfter.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o2">bType</a>], <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(heAfter.<a class="code" href="../../d2/d4/struct__HANDLEENTRY.html#o0">phead</a>), hAfter);
10433         }
10434     }
10435     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10436 }
10437 
10438 
10439 
10440 
10441 <span class="comment">/************************************************************************\</span>
10442 <span class="comment">* Procedure: Ifrr</span>
10443 <span class="comment">*</span>
10444 <span class="comment">* Description: Finds Range References - helpfull for finding stale</span>
10445 <span class="comment">*   pointers.</span>
10446 <span class="comment">*</span>
10447 <span class="comment">* Returns: fSuccess</span>
10448 <span class="comment">*</span>
10449 <span class="comment">* 6/9/1995 Created SanfordS</span>
10450 <span class="comment">*</span>
10451 <span class="comment">\************************************************************************/</span>
10452 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a233">Ifrr</a>(
10453     DWORD opts,
10454     PVOID param1,
10455     PVOID param2,
10456     PVOID param3,
10457     PVOID param4)
10458 {
10459     DWORD_PTR pSrc1 = (DWORD_PTR)param1;
10460     DWORD_PTR pSrc2 = (DWORD_PTR)param2;
10461     DWORD_PTR pRef1 = (DWORD_PTR)param3;
10462     DWORD_PTR pRef2 = (DWORD_PTR)param4;
10463     DWORD_PTR dw;
10464     DWORD_PTR buffer[<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> / <span class="keyword">sizeof</span>(DWORD_PTR)];
10465 
10466     UNREFERENCED_PARAMETER(opts);
10467 
10468     <span class="keywordflow">if</span> (pSrc2 &lt; pSrc1) {
10469         Print(<span class="stringliteral">"Source range improper.  Values reversed.\n"</span>);
10470         dw = pSrc1;
10471         pSrc1 = pSrc2;
10472         pSrc2 = dw;
10473     }
10474     <span class="keywordflow">if</span> (pRef2 == 0) {
10475         pRef2 = pRef1;
10476     }
10477     <span class="keywordflow">if</span> (pRef2 &lt; pRef1) {
10478         Print(<span class="stringliteral">"Reference range improper.  Values reversed.\n"</span>);
10479         dw = pRef1;
10480         pRef1 = pRef2;
10481         pRef2 = dw;
10482     }
10483 
10484     pSrc1 &amp;= MAXULONG_PTR - <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> + 1;  <span class="comment">// PAGE aligned</span>
10485     pSrc2 = (pSrc2 + (<span class="keyword">sizeof</span>(DWORD_PTR)-1)) &amp; (MAXULONG_PTR - (<span class="keyword">sizeof</span>(DWORD_PTR)-1));   <span class="comment">// dword_ptr aligned</span>
10486 
10487     Print(<span class="stringliteral">"Searching range (%#p-%#p) for references to (%#p-%#p)..."</span>,
10488             pSrc1, pSrc2, pRef1, pRef2);
10489 
10490     <span class="keywordflow">for</span> (; pSrc1 &lt; pSrc2; pSrc1 += <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>) {
10491         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSuccess;
10492 
10493         <span class="keywordflow">if</span> (!(pSrc1 &amp; 0xFFFFFF)) {
10494             Print(<span class="stringliteral">"\nSearching %#p..."</span>, pSrc1);
10495         }
10496         fSuccess = tryMoveBlock(buffer, (PVOID)pSrc1, <span class="keyword">sizeof</span>(buffer));
10497         <span class="keywordflow">if</span> (!fSuccess) {
10498             <span class="comment">/*</span>
10499 <span class="comment">             * Skip to next page</span>
10500 <span class="comment">             */</span>
10501         } <span class="keywordflow">else</span> {
10502             <span class="keywordflow">for</span> (dw = 0; dw &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(buffer); dw++) {
10503                 <span class="keywordflow">if</span> (buffer[dw] &gt;= pRef1 &amp;&amp; buffer[dw] &lt;= pRef2) {
10504                     Print(<span class="stringliteral">"\n[%#p] = %#p "</span>,
10505                             pSrc1 + dw * <span class="keyword">sizeof</span>(DWORD_PTR),
10506                             buffer[dw]);
10507                 }
10508             }
10509         }
10510         <span class="keywordflow">if</span> (IsCtrlCHit()) {
10511             Print(<span class="stringliteral">"\nSearch aborted.\n"</span>);
10512             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10513         }
10514     }
10515     Print(<span class="stringliteral">"\nSearch complete.\n"</span>);
10516     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10517 }
10518 
10519 
10520 <span class="preprocessor">#ifdef KERNEL</span>
10521 <span class="preprocessor"></span><span class="comment">//PGDI_DEVICE undefined</span>
10522 <span class="preprocessor">#if 0</span>
10523 <span class="preprocessor"></span><a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> ddGdiDevice(
10524 PGDI_DEVICE pGdiDevice)
10525 {
10526     Print(<span class="stringliteral">"\t\tGDI_DEVICE\n"</span>);
10527     Print(<span class="stringliteral">"\t\tcRefCount       = %d\n"</span>,     pGdiDevice-&gt;cRefCount);
10528     Print(<span class="stringliteral">"\t\thDevInfo        = 0x%.8x\n"</span>, pGdiDevice-&gt;hDevInfo);
10529     Print(<span class="stringliteral">"\t\thDev            = 0x%.8x\n"</span>, pGdiDevice-&gt;hDev);
10530     Print(<span class="stringliteral">"\t\trcScreen        = (%d,%d)-(%d,%d) %dx%d\n"</span>,
10531             pGdiDevice-&gt;rcScreen.left, pGdiDevice-&gt;rcScreen.top,
10532             pGdiDevice-&gt;rcScreen.right, pGdiDevice-&gt;rcScreen.bottom,
10533             pGdiDevice-&gt;rcScreen.right - pGdiDevice-&gt;rcScreen.left,
10534             pGdiDevice-&gt;rcScreen.bottom - pGdiDevice-&gt;rcScreen.top);
10535     Print(<span class="stringliteral">"\t\tDEVMODEW\n"</span>);
10536 }
10537 <span class="preprocessor">#endif</span>
10538 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
10539 <span class="preprocessor"></span>
10540 
10541 <span class="keywordtype">void</span>
10542 <a class="code" href="../../d2/d1/userexts_8c.html#a234">DumpMonitor</a>(<a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> pMonitor, LPSTR pstrPrefix)
10543 {
10544     Print(<span class="stringliteral">"%shead.h             = 0x%.8x\n"</span>, pstrPrefix, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o0">head</a>.<a class="code" href="../../d4/d5/struct__HEAD.html#o0">h</a>);
10545     Print(<span class="stringliteral">"%shead.cLockObj      = 0x%.8x\n"</span>, pstrPrefix, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o0">head</a>.<a class="code" href="../../d4/d5/struct__HEAD.html#o1">cLockObj</a>);
10546     Print(<span class="stringliteral">"%spMonitorNext       = 0x%.8x\n"</span>, pstrPrefix, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o1">pMonitorNext</a>);
10547     Print(<span class="stringliteral">"%sdwMONFlags         = 0x%.8x %s\n"</span>, pstrPrefix, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o2">dwMONFlags</a>, <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_MON, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o2">dwMONFlags</a>, NULL, FALSE));
10548 
10549     Print(<span class="stringliteral">"%srcMonitor          = (%d,%d)-(%d,%d) %dx%d\n"</span>,
10550             pstrPrefix,
10551             pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.left, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.top,
10552             pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.right, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.bottom,
10553             pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.right - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.left,
10554             pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.bottom - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.top);
10555 
10556     Print(<span class="stringliteral">"%srcWork             = (%d,%d)-(%d,%d) %dx%d\n"</span>,
10557             pstrPrefix,
10558             pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.left, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.top,
10559             pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.right, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.bottom,
10560             pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.right - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.left,
10561             pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.bottom - pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.top);
10562 
10563     Print(<span class="stringliteral">"%shrgnMonitor        = 0x%.8x\n"</span>, pstrPrefix, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o5">hrgnMonitor</a>);
10564     Print(<span class="stringliteral">"%scFullScreen        = %d\n"</span>,     pstrPrefix, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o6">cFullScreen</a>);
10565     Print(<span class="stringliteral">"%scwndStack          = %d\n"</span>,     pstrPrefix, pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o7">cWndStack</a>);
10566 
10567 <span class="preprocessor">#if 0</span>
10568 <span class="preprocessor"></span>    Print(<span class="stringliteral">"%spMonGdiDevice      = 0x%.8x\n"</span>, pstrPrefix, pMonitor-&gt;pMonGdiDevice);
10569 
10570     <span class="keywordflow">if</span> (pMonitor-&gt;pMonGdiDevice) {
10571         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(gdiDevice, pMonitor-&gt;pMonGdiDevice);
10572         ddGdiDevice(&amp;gdiDevice);
10573     } <span class="keywordflow">else</span> {
10574         Print(<span class="stringliteral">"\n\n"</span>);
10575         Print(<span class="stringliteral">"ERROR - pMonGdiDevice missing\n"</span>);
10576         Print(<span class="stringliteral">"\n\n"</span>);
10577     }
10578 <span class="preprocessor">#endif</span>
10579 <span class="preprocessor"></span>}
10580 
10581 
10582 
10583 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
10584 <a class="code" href="../../d2/d1/userexts_8c.html#a235">Idmon</a>(DWORD opts, PVOID param1)
10585 {
10586     <a class="code" href="../../d0/d2/structtagMONITOR.html">MONITOR</a>         monitor;
10587 
10588     UNREFERENCED_PARAMETER(opts);
10589 
10590     <span class="keywordflow">if</span> (!param1) {
10591         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10592     }
10593 
10594     Print(<span class="stringliteral">"Dumping MONITOR at 0x%.8x\n"</span>, param1);
10595     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(monitor, (<a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>)param1);
10596     <a class="code" href="../../d2/d1/userexts_8c.html#a234">DumpMonitor</a>(&amp;monitor, <span class="stringliteral">"\t"</span>);
10597 
10598     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10599 }
10600 
10601 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a236">Idy</a>(
10602 DWORD opts,
10603 PVOID param1)
10604 {
10605     <a class="code" href="../../d9/d3/structtagDISPLAYINFO.html">PDISPLAYINFO</a>    pdi, gpdi;
10606     <a class="code" href="../../d9/d3/structtagDISPLAYINFO.html">DISPLAYINFO</a>     <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>;
10607     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>        pMonitor;
10608     <a class="code" href="../../d0/d2/structtagMONITOR.html">MONITOR</a>         monitor;
10609     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">PSERVERINFO</a>     psi;
10610     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a>      si;
10611     <span class="keywordtype">int</span>             i;
10612     <a class="code" href="../../d4/d6/structtagSHAREDINFO.html">PSHAREDINFO</a>     pshi;
10613 
10614 <span class="preprocessor">#if 0</span>
10615 <span class="preprocessor"></span>    GDI_DEVICE      gdiDevice;
10616 <span class="preprocessor">#endif</span>
10617 <span class="preprocessor"></span>
10618     UNREFERENCED_PARAMETER(opts);
10619 
10620     moveExp(&amp;pshi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gSharedInfo));
10621     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(gpdi, &amp;pshi-&gt;<a class="code" href="../../d4/d6/structtagSHAREDINFO.html#o2">pDispInfo</a>);
10622 
10623     <span class="keywordflow">if</span> (param1) {
10624         pdi = (<a class="code" href="../../d9/d3/structtagDISPLAYINFO.html">DISPLAYINFO</a> *)param1;
10625     } <span class="keywordflow">else</span> {
10626         pdi = gpdi;
10627     }
10628 
10629     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(di, pdi);
10630 
10631     moveExpValuePtr(&amp;psi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
10632     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(si, psi);
10633 
10634     Print(<span class="stringliteral">"Dumping DISPLAYINFO at 0x%.8x\n"</span>, pdi);
10635     Print(<span class="stringliteral">"\thDev                  = 0x%.8x\n"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.hDev);
10636     Print(<span class="stringliteral">"\thdcScreen             = 0x%.8x\n"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.hdcScreen);
10637 
10638     Print(<span class="stringliteral">"\thdcBits               = 0x%.8x\n"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.hdcBits);
10639 
10640     Print(<span class="stringliteral">"\thdcGray               = 0x%.8x\n"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.hdcGray);
10641     Print(<span class="stringliteral">"\thbmGray               = 0x%.8x\n"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.hbmGray);
10642     Print(<span class="stringliteral">"\tcxGray                = %d\n"</span>,     <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.cxGray);
10643     Print(<span class="stringliteral">"\tcyGray                = %d\n"</span>,     <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.cyGray);
10644     Print(<span class="stringliteral">"\tpdceFirst             = 0x%.8x\n"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.pdceFirst);
10645     Print(<span class="stringliteral">"\tpspbFirst             = 0x%.8x\n"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.pspbFirst);
10646     Print(<span class="stringliteral">"\tcMonitors (visible)   = %d\n"</span>,     <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.cMonitors);
10647     Print(<span class="stringliteral">"\tpMonitorPrimary       = 0x%.8x\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a208">RebaseSharedPtr</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.pMonitorPrimary));
10648     Print(<span class="stringliteral">"\tpMonitorFirst         = 0x%.8x\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a208">RebaseSharedPtr</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.pMonitorFirst));
10649 
10650     Print(<span class="stringliteral">"\trcScreen              = (%d,%d)-(%d,%d) %dx%d\n"</span>,
10651 
10652                                      si.rcScreen.left, si.rcScreen.top,
10653                                      si.rcScreen.right, si.rcScreen.bottom,
10654                                      si.rcScreen.right - si.rcScreen.left,
10655                                      si.rcScreen.bottom - si.rcScreen.top);
10656 
10657     Print(<span class="stringliteral">"\thrgnScreen            = 0x%.8x\n"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.hrgnScreen);
10658     Print(<span class="stringliteral">"\tdmLogPixels           = %d\n"</span>,     <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.dmLogPixels);
10659     Print(<span class="stringliteral">"\tBitCountMax           = %d\n"</span>,     <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.BitCountMax);
10660     Print(<span class="stringliteral">"\tfDesktopIsRect        = %d\n"</span>,     <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.fDesktopIsRect);
10661 
10662 <span class="preprocessor">#if 0</span>
10663 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.pDispGdiDevice) {
10664         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(gdiDevice, <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.pDispGdiDevice);
10665         ddGdiDevice(&amp;gdiDevice);
10666     } <span class="keywordflow">else</span> {
10667         Print(<span class="stringliteral">"\n\n"</span>);
10668         Print(<span class="stringliteral">"ERROR - pDispGdiDevice missing\n"</span>);
10669         Print(<span class="stringliteral">"\n\n"</span>);
10670     }
10671 <span class="preprocessor">#endif</span>
10672 <span class="preprocessor"></span>
10673     Print(<span class="stringliteral">"\n"</span>);
10674 
10675     <span class="keywordflow">if</span> (pdi == gpdi) {
10676         <span class="keywordflow">if</span> (si.dmLogPixels != <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.dmLogPixels) {
10677             Print(<span class="stringliteral">"\n\n"</span>);
10678             Print(<span class="stringliteral">"ERROR - dmLogPixels doesn't match in gpsi (%d) and gpDispInfo (%d)\n"</span>,
10679                   si.dmLogPixels, <a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.dmLogPixels);
10680             Print(<span class="stringliteral">"\n\n"</span>);
10681         }
10682 
10683 <span class="preprocessor">#if 0</span>
10684 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.pDispGdiDevice) {
10685             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a34">EqualRect</a>(&amp;si.rcScreen, &amp;gdiDevice.rcScreen)) {
10686                 Print(<span class="stringliteral">"\n\n"</span>);
10687                 Print(<span class="stringliteral">"ERROR - rcScreen doesn't match in gpsi (%d,%d)-(%d,%d) and gpDispInfo (%d,%d)-(%d,%d)\n"</span>,
10688                       si.rcScreen.left,  si.rcScreen.top,
10689                       si.rcScreen.right, si.rcScreen.bottom,
10690                       gdiDevice.rcScreen.left,  gdiDevice.rcScreen.top,
10691                       gdiDevice.rcScreen.right, gdiDevice.rcScreen.bottom);
10692                 Print(<span class="stringliteral">"\n\n"</span>);
10693             }
10694         }
10695 <span class="preprocessor">#endif</span>
10696 <span class="preprocessor"></span>    }
10697 
10698 
10699     <span class="keywordflow">for</span> (   pMonitor = <a class="code" href="../../d2/d1/userexts_8c.html#a208">RebaseSharedPtr</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a28">di</a>.pMonitorFirst), i = 1;
10700             pMonitor;
10701             pMonitor = <a class="code" href="../../d2/d1/userexts_8c.html#a208">RebaseSharedPtr</a>(monitor.<a class="code" href="../../d0/d2/structtagMONITOR.html#o1">pMonitorNext</a>), i++) {
10702 
10703         Print(<span class="stringliteral">"\tMonitor %d, pMonitor = 0x%.8x\n"</span>, i, pMonitor);
10704         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(monitor, pMonitor);
10705         <a class="code" href="../../d2/d1/userexts_8c.html#a234">DumpMonitor</a>(&amp;monitor, <span class="stringliteral">"\t\t"</span>);
10706         Print(<span class="stringliteral">"\n"</span>);
10707     }
10708 
10709     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10710 }
10711 
10712 
10713 <span class="preprocessor">#ifdef KERNEL</span>
10714 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
10715 <span class="comment">* kbd [queue]</span>
10716 <span class="comment">*</span>
10717 <span class="comment">* Loads a DLL containing more debugging extensions</span>
10718 <span class="comment">*</span>
10719 <span class="comment">* 10/27/92 IanJa        Created.</span>
10720 <span class="comment">* 6/9/1995 SanfordS     made to fit stdexts motif</span>
10721 <span class="comment">\***************************************************************************/</span>
10722 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
10723     <span class="keywordtype">int</span> iVK;
10724     LPSTR pszVK;
10725 } VK, *PVK;
10726 
10727 VK aVK[] = {
10728     { VK_SHIFT,    <span class="stringliteral">"SHIFT"</span>    },
10729     { VK_LSHIFT,   <span class="stringliteral">"LSHIFT"</span>   },
10730     { VK_RSHIFT,   <span class="stringliteral">"RSHIFT"</span>   },
10731     { VK_CONTROL,  <span class="stringliteral">"CONTROL"</span>  },
10732     { VK_LCONTROL, <span class="stringliteral">"LCONTROL"</span> },
10733     { VK_RCONTROL, <span class="stringliteral">"RCONTROL"</span> },
10734     { VK_MENU,     <span class="stringliteral">"MENU"</span>     },
10735     { VK_LMENU,    <span class="stringliteral">"LMENU"</span>    },
10736     { VK_RMENU,    <span class="stringliteral">"RMENU"</span>    },
10737     { VK_NUMLOCK,  <span class="stringliteral">"NUMLOCK"</span>  },
10738     { VK_CAPITAL,  <span class="stringliteral">"CAPITAL"</span>  },
10739     { VK_LBUTTON,  <span class="stringliteral">"LBUTTON"</span>  },
10740     { VK_MBUTTON,  <span class="stringliteral">"MBUTTON"</span>  },
10741     { VK_RBUTTON,  <span class="stringliteral">"RBUTTON"</span>  },
10742     { VK_XBUTTON1, <span class="stringliteral">"XBUTTON1"</span> },
10743     { VK_XBUTTON2, <span class="stringliteral">"XBUTTON2"</span> },
10744     { VK_RETURN ,  <span class="stringliteral">"ENTER"</span>    },
10745     { VK_KANA,     <span class="stringliteral">"KANA/HANJA"</span> },
10746     { VK_OEM_8,    <span class="stringliteral">"OEM_8"</span>    },
10747     <span class="comment">// { 0x52      ,  "R"        },  // your key goes here</span>
10748     { 0,           <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>       }
10749 };
10750 
10751 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Ikbd(
10752 DWORD opts,
10753 PVOID param1)
10754 {
10755     <a class="code" href="../../d7/d4/structtagQ.html">PQ</a> pq;
10756     <a class="code" href="../../d7/d4/structtagQ.html">Q</a> q;
10757     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pb, pbr;
10758     <span class="keywordtype">int</span> i;
10759     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> afUpdateKeyState[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a825">CBKEYSTATE</a> + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a826">CBKEYSTATERECENTDOWN</a>];
10760     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pgafAsyncKeyState;
10761     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>  afAsyncKeyState[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a825">CBKEYSTATE</a>];
10762     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pgafRawKeyState;
10763     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>  afRawKeyState[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a825">CBKEYSTATE</a>];
10764     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>  PhysModifiers;
10765 
10766     <span class="keywordflow">if</span> (opts &amp; OFLAG(a)) {
10767         <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> pti;
10768 
10769         opts &amp;= ~OFLAG(a);
10770         FOREACHPTI(pti);
10771             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pq, &amp;pti-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o3">pq</a>);
10772             Ikbd(opts, pq);
10773         NEXTEACHPTI(pti);
10774         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10775     }
10776 
10777 
10778     <span class="comment">/*</span>
10779 <span class="comment">     * If 'u' was specified, make sure there was also an address</span>
10780 <span class="comment">     */</span>
10781     <span class="keywordflow">if</span> (opts &amp; OFLAG(u)) {
10782         <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
10783             Print(<span class="stringliteral">"provide arg 2 of ProcessUpdateKeyEvent(), or WM_UPDATEKEYSTATE wParam\n"</span>);
10784             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10785         }
10786         pb = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)param1;
10787         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(afUpdateKeyState, pb);
10788         pb = afUpdateKeyState;
10789         pbr = afUpdateKeyState + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a825">CBKEYSTATE</a>;
10790         Print(<span class="stringliteral">"Key State:   === NEW STATE ====   Asynchronous    Physical\n"</span>);
10791 
10792     } <span class="keywordflow">else</span> {
10793         <span class="keywordflow">if</span> (param1) {
10794             pq = (<a class="code" href="../../d7/d4/structtagQ.html">PQ</a>)param1;
10795         } <span class="keywordflow">else</span> {
10796             moveExpValuePtr(&amp;pq, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpqForeground));
10797         }
10798 
10799         <span class="comment">/*</span>
10800 <span class="comment">         * Print out simple thread info for pq-&gt;ptiLock.</span>
10801 <span class="comment">         */</span>
10802         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(q, pq);
10803         <span class="keywordflow">if</span> (q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>) {
10804             Idt(OFLAG(p), q.<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>);
10805         }
10806 
10807         pb = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)&amp;(q.<a class="code" href="../../d7/d4/structtagQ.html#o17">afKeyState</a>);
10808         pbr = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)&amp;(q.<a class="code" href="../../d7/d4/structtagQ.html#o16">afKeyRecentDown</a>);
10809         Print(<span class="stringliteral">"Key State:   QUEUE %lx       Asynchronous    Raw\n"</span>, pq);
10810     }
10811 
10812     moveExp(&amp;pgafAsyncKeyState, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gafAsyncKeyState));
10813     tryMove(afAsyncKeyState, pgafAsyncKeyState);
10814 
10815     moveExp(&amp;pgafRawKeyState, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gafRawKeyState));
10816     tryMove(afRawKeyState, pgafRawKeyState);
10817 
10818     Print(<span class="stringliteral">"             Down Toggle Recent   Down Toggle     Down Toggle\n"</span>);
10819     <span class="keywordflow">for</span> (i = 0; aVK[i].pszVK != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; i++) {
10820         Print(<span class="stringliteral">"VK_%s:\t%d    %d     %d        %d     %d         %d     %d\n"</span>,
10821             aVK[i].pszVK,
10822             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a827">TestKeyDownBit</a>(pb, aVK[i].iVK) != 0,
10823             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a830">TestKeyToggleBit</a>(pb, aVK[i].iVK) != 0,
10824             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a834">TestKeyRecentDownBit</a>(pbr, aVK[i].iVK) != 0,
10825             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a827">TestKeyDownBit</a>(afAsyncKeyState, aVK[i].iVK) != 0,
10826             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a830">TestKeyToggleBit</a>(afAsyncKeyState, aVK[i].iVK) != 0,
10827             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a827">TestKeyDownBit</a>(afRawKeyState, aVK[i].iVK) != 0,
10828             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a830">TestKeyToggleBit</a>(afRawKeyState, aVK[i].iVK) != 0);
10829     }
10830 
10831     moveExpValuePtr(&amp;PhysModifiers, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gfsSASModifiersDown));
10832     Print(<span class="stringliteral">"PhysModifiers = %x\n"</span>);
10833     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10834 }
10835 <span class="preprocessor">#endif // KERNEL</span>
10836 <span class="preprocessor"></span>
10837 
10838 
10839 
10840 
10841 <span class="comment">/************************************************************************\</span>
10842 <span class="comment">* Procedure: Itest</span>
10843 <span class="comment">*</span>
10844 <span class="comment">* Description: Tests the basic stdexts macros and functions - a good check</span>
10845 <span class="comment">*   on the debugger extensions in general before you waste time debuging</span>
10846 <span class="comment">*   entensions.</span>
10847 <span class="comment">*</span>
10848 <span class="comment">* Returns: fSuccess</span>
10849 <span class="comment">*</span>
10850 <span class="comment">* 6/9/1995 Created SanfordS</span>
10851 <span class="comment">*</span>
10852 <span class="comment">\************************************************************************/</span>
10853 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a237">Itest</a>()
10854 {
10855     PVOID p;
10856     DWORD_PTR cch;
10857     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> ach[80];
10858 
10859     Print(<span class="stringliteral">"Print test!\n"</span>);
10860     SAFEWHILE(TRUE) {
10861         Print(<span class="stringliteral">"SAFEWHILE test...  Hit Ctrl-C NOW!\n"</span>);
10862     }
10863     p = EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
10864     Print(<span class="stringliteral">"EvalExp(%s) = %#p\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi), p);
10865     GetSym(p, ach, &amp;cch);
10866     Print(<span class="stringliteral">"GetSym(%#p) = %s\n"</span>, p, ach);
10867     <span class="keywordflow">if</span> (IsWinDbg()) {
10868         Print(<span class="stringliteral">"I think windbg is calling me.\n"</span>);
10869     } <span class="keywordflow">else</span> {
10870         Print(<span class="stringliteral">"I don't think windbg is calling me.\n"</span>);
10871     }
10872     Print(<span class="stringliteral">"MoveBlock test...\n"</span>);
10873     <a class="code" href="../../d7/d4/conexts_8c.html#a2">moveBlock</a>(&amp;p, EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi)), <span class="keyword">sizeof</span>(PVOID));
10874     Print(<span class="stringliteral">"MoveBlock(%#p) = %#p.\n"</span>, EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi)), p);
10875 
10876     Print(<span class="stringliteral">"moveExp test...\n"</span>);
10877     moveExp(&amp;p, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
10878     Print(<span class="stringliteral">"moveExp(%s) = %x.\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi), p);
10879 
10880     Print(<span class="stringliteral">"moveExpValue test...\n"</span>);
10881     moveExpValuePtr(&amp;p, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
10882     Print(<span class="stringliteral">"moveExpValue(%s) = %#p.\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi), p);
10883 
10884     Print(<span class="stringliteral">"Basic tests complete.\n"</span>);
10885     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10886 }
10887 
10888 
10889 
10890 <span class="comment">/************************************************************************\</span>
10891 <span class="comment">* Procedure: Iuver</span>
10892 <span class="comment">*</span>
10893 <span class="comment">* Description: Dumps versions of extensions and winsrv/win32k</span>
10894 <span class="comment">*</span>
10895 <span class="comment">* Returns: fSuccess</span>
10896 <span class="comment">*</span>
10897 <span class="comment">* 6/15/1995 Created SanfordS</span>
10898 <span class="comment">*</span>
10899 <span class="comment">\************************************************************************/</span>
10900 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a238">Iuver</a>()
10901 {
10902     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">PSERVERINFO</a> psi;
10903     WORD        wSRVIFlags;
10904 
10905 <span class="preprocessor">#if DBG</span>
10906 <span class="preprocessor"></span>    Print(<span class="stringliteral">"USEREXTS version: Checked.\n"</span>
10907           <span class="stringliteral">"WIN32K.SYS version: "</span>);
10908 <span class="preprocessor">#else</span>
10909 <span class="preprocessor"></span>    Print(<span class="stringliteral">"USEREXTS version: Free.\n"</span>
10910           <span class="stringliteral">"WIN32K.SYS version: "</span>);
10911 <span class="preprocessor">#endif</span>
10912 <span class="preprocessor"></span>
10913     moveExpValuePtr(&amp;psi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
10914     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wSRVIFlags, &amp;psi-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o1">wSRVIFlags</a>);
10915 
10916     Print((wSRVIFlags &amp; SRVIF_CHECKED) ? <span class="stringliteral">"Checked"</span> : <span class="stringliteral">"Free"</span>);
10917     Print(<span class="stringliteral">".\n"</span>);
10918     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10919 }
10920 
10921 <span class="preprocessor">#define DUMPSTATUS(status) if (tryMoveExpValue(&amp;Status, VAR(g ## status))) { \</span>
10922 <span class="preprocessor">                               Print("g%s = %lx\n", #status, Status);        \</span>
10923 <span class="preprocessor">                           }</span>
10924 <span class="preprocessor"></span><span class="preprocessor">#define DUMPTIME(time)     if (tryMoveExpValue(&amp;Time, VAR(g ## time))) {     \</span>
10925 <span class="preprocessor">                               Print("g%s = %lx\n", #time, Time);            \</span>
10926 <span class="preprocessor">                           }</span>
10927 <span class="preprocessor"></span>
10928 
10929 <span class="preprocessor">#ifdef KERNEL</span>
10930 <span class="preprocessor"></span><span class="comment">/***************************************************************************\</span>
10931 <span class="comment">* dinp - dump input diagnostics</span>
10932 <span class="comment">* dinp -v   verbose</span>
10933 <span class="comment">* dinp -i   show input records</span>
10934 <span class="comment">*</span>
10935 <span class="comment">* 04/13/98  IanJa       Created.</span>
10936 <span class="comment">\***************************************************************************/</span>
10937 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idinp(
10938     DWORD opts,
10939     PVOID param1)
10940 {
10941     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    <a class="code" href="../../d6/d6/ttime_8c.html#a14">Time</a>;
10942     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
10943     <a class="code" href="../../d5/d3/structtagDEVICEINFO.html">PDEVICEINFO</a> pDeviceInfo, *ppDeviceInfo;
10944     <span class="keywordtype">int</span> i = 0;
10945     <span class="keywordtype">char</span> ach[100];
10946     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nKbd;
10947     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bVerbose = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
10948 
10949     <a class="code" href="../../d2/d1/userexts_8c.html#a49">DUMPSTATUS</a>(KbdIoctlLEDSStatus);
10950 
10951     <a class="code" href="../../d2/d1/userexts_8c.html#a50">DUMPTIME</a>(MouseProcessMiceInputTime);
10952     <a class="code" href="../../d2/d1/userexts_8c.html#a50">DUMPTIME</a>(MouseQueueMouseEventTime);
10953     <a class="code" href="../../d2/d1/userexts_8c.html#a50">DUMPTIME</a>(MouseUnqueueMouseEventTime);
10954 
10955     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
10956         bVerbose = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
10957     }
10958 
10959 
10960     ppDeviceInfo = EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpDeviceInfoList));
10961     <span class="keywordflow">while</span> (tryMove(pDeviceInfo, ppDeviceInfo) &amp;&amp; pDeviceInfo) {
10962 
10963         <span class="keywordflow">if</span> (param1 &amp;&amp; (param1 != pDeviceInfo)) {
10964             ; <span class="comment">// skip it</span>
10965         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pDeviceInfo != 0) {
10966             <a class="code" href="../../d5/d3/structtagDEVICEINFO.html">DEVICEINFO</a> DeviceInfo;
10967             WCHAR awchBuffer[100];
10968             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbBuffer;
10969 
10970             Print(<span class="stringliteral">"#%d: %x "</span>, i, pDeviceInfo);
10971             <span class="keywordflow">if</span> (tryMove(DeviceInfo, pDeviceInfo)) {
10972                 <span class="keywordflow">if</span> (DeviceInfo.type == <a class="code" href="../../d4/d1/userk_8h.html#a175">DEVICE_TYPE_MOUSE</a>) {
10973                     Print(<span class="stringliteral">"MOU"</span>, i);
10974                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (DeviceInfo.type == <a class="code" href="../../d4/d1/userk_8h.html#a176">DEVICE_TYPE_KEYBOARD</a>) {
10975                     Print(<span class="stringliteral">"KBD"</span>);
10976                 } <span class="keywordflow">else</span> {
10977                     Print(<span class="stringliteral">"%2d?"</span>, DeviceInfo.type);
10978                 }
10979                 <span class="keywordflow">if</span> (DeviceInfo.usActions) {
10980                     Print(<span class="stringliteral">" Pending action %x %s"</span>, DeviceInfo.usActions,
10981                             <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_DIAF, DeviceInfo.usActions, NULL, TRUE));
10982                 }
10983                 cbBuffer = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(DeviceInfo.ustrName.Length, <span class="keyword">sizeof</span>(awchBuffer)-<span class="keyword">sizeof</span>(WCHAR));
10984                 <span class="keywordflow">if</span> (tryMoveBlock(awchBuffer, DeviceInfo.ustrName.Buffer, cbBuffer)) {
10985                     awchBuffer[cbBuffer / <span class="keyword">sizeof</span>(WCHAR)] = 0;
10986                     Print(<span class="stringliteral">"\n    %ws\n"</span>, awchBuffer);
10987                 } <span class="keywordflow">else</span> {
10988                     Print(<span class="stringliteral">"\n"</span>);
10989                 }
10990             } <span class="keywordflow">else</span> {
10991                 DeviceInfo.type = 0xFF;
10992             }
10993             <span class="keywordflow">if</span> (bVerbose || (param1 == pDeviceInfo)) {
10994                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"GENERIC_DEVICE_INFO 0x%p"</span>, pDeviceInfo);
10995                 <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> += 2;
10996                 <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
10997                 <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> += 2;
10998                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"IO_STATUS_BLOCK 0x%p"</span>,
10999                         (PBYTE)pDeviceInfo + FIELD_OFFSET(<a class="code" href="../../d5/d3/structtagDEVICEINFO.html">DEVICEINFO</a>, iosb));
11000                 <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
11001                 <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> -= 2;
11002                 <span class="keywordflow">if</span> (DeviceInfo.type == <a class="code" href="../../d4/d1/userk_8h.html#a175">DEVICE_TYPE_MOUSE</a>) {
11003                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"MOUSE_DEVICE_INFO 0x%p"</span>,
11004                             (PBYTE)pDeviceInfo + FIELD_OFFSET(<a class="code" href="../../d5/d3/structtagDEVICEINFO.html">DEVICEINFO</a>, mouse));
11005                     <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
11006 
11007                     <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> += 2;
11008                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"MOUSE_ATTRIBUTES 0x%p"</span>,
11009                             (PBYTE)pDeviceInfo + FIELD_OFFSET(<a class="code" href="../../d5/d3/structtagDEVICEINFO.html">DEVICEINFO</a>, mouse)
11010                                     + FIELD_OFFSET(<a class="code" href="../../d4/d2/structtagMOUSE__DEVICE__INFO.html">MOUSE_DEVICE_INFO</a>, Attr));
11011                     <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
11012                     <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> -= 2;
11013                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (DeviceInfo.type == <a class="code" href="../../d4/d1/userk_8h.html#a176">DEVICE_TYPE_KEYBOARD</a>) {
11014                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"KEYBOARD_DEVICE_INFO 0x%p"</span>,
11015                             (PBYTE)pDeviceInfo + FIELD_OFFSET(<a class="code" href="../../d5/d3/structtagDEVICEINFO.html">DEVICEINFO</a>, keyboard));
11016                     <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
11017                     <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> += 2;
11018                     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"KEYBOARD_ATTRIBUTES 0x%p"</span>,
11019                             (PBYTE)pDeviceInfo + FIELD_OFFSET(<a class="code" href="../../d5/d3/structtagDEVICEINFO.html">DEVICEINFO</a>, keyboard)
11020                                     + FIELD_OFFSET(<a class="code" href="../../d3/d9/structtagKEYBOARD__DEVICE__INFO.html">KEYBOARD_DEVICE_INFO</a>, Attr));
11021                     <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
11022                     <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> -= 2;
11023                 } <span class="keywordflow">else</span> {
11024                     Print(<span class="stringliteral">"Unknown device type %d\n"</span>, DeviceInfo.type);
11025                 }
11026                 <span class="keywordflow">if</span> (opts &amp; OFLAG(i)) {
11027                     Print(<span class="stringliteral">"  Input Records:"</span>);
11028                     <span class="keywordflow">if</span> (DeviceInfo.iosb.Information == 0) {
11029                         Print(<span class="stringliteral">" NONE\n"</span>);
11030                     } <span class="keywordflow">else</span> {
11031                         Print(<span class="stringliteral">"\n"</span>);
11032                         <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> += 2;
11033                         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"KEYBOARD_INPUT_DATA %p *%x"</span>,
11034                                 &amp;(pDeviceInfo-&gt;<a class="code" href="../../d5/d3/structtagDEVICEINFO.html#o2">keyboard</a>.<a class="code" href="../../d3/d9/structtagKEYBOARD__DEVICE__INFO.html#o1">Data</a>[0]),
11035                                 DeviceInfo.iosb.Information / <span class="keyword">sizeof</span>(DeviceInfo.<a class="code" href="../../d5/d3/structtagDEVICEINFO.html#o2">keyboard</a>.<a class="code" href="../../d3/d9/structtagKEYBOARD__DEVICE__INFO.html#o1">Data</a>[0]));
11036                         <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
11037                         <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> -= 2;
11038                     }
11039                 }
11040                 <a class="code" href="../../d0/d3/dsocode_8c.html#a3">gnIndent</a> -= 2;
11041             } <span class="comment">// bVerbose</span>
11042         }
11043         ppDeviceInfo = <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(&amp;pDeviceInfo-&gt;pNext);
11044         i++;
11045     }
11046 
11047     <span class="comment">// Now display input related sytem metrics</span>
11048     {
11049         <a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a> si;
11050         <a class="code" href="../../d2/d6/structtagSERVERINFO.html">PSERVERINFO</a> psi;
11051 
11052 <span class="comment">// #define SMENTRY(sm) {SM_##sm, #sm}  (see above</span>
11053 
11054         <span class="comment">/*</span>
11055 <span class="comment">         * Add mouse- and keyboard- related entries to this table</span>
11056 <span class="comment">         * with the prefix removed, in whatever order you think is rational</span>
11057 <span class="comment">         */</span>
11058         <span class="keyword">static</span> <a class="code" href="../../d7/d7/structSYSMET__ENTRY.html">SYSMET_ENTRY</a> aSysMet[] = {
11059             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(MOUSEPRESENT),
11060             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(MOUSEWHEELPRESENT),
11061             <a class="code" href="../../d2/d1/userexts_8c.html#a3">SMENTRY</a>(CMOUSEBUTTONS),
11062         };
11063 
11064         moveExpValuePtr(&amp;psi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
11065         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(si, psi);
11066 
11067         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d2/d3/tnlsxlat_8c.html#a0">NELEM</a>(aSysMet); i++) {
11068             Print(  <span class="stringliteral">"SM_%-18s = 0x%08lx = %d\n"</span>,
11069                     aSysMet[i].pstrMetric,
11070                     si.aiSysMet[aSysMet[i].iMetric],
11071                     si.aiSysMet[aSysMet[i].iMetric]);
11072         }
11073 
11074         moveExpValuePtr(&amp;nKbd, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gnKeyboards));
11075         Print(<span class="stringliteral">"gnKeyboards = %d\n"</span>, nKbd);
11076         moveExpValuePtr(&amp;nKbd, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gnMice));
11077         Print(<span class="stringliteral">"gnMice = %d\n"</span>, nKbd);
11078     }
11079     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
11080 }
11081 
11082 <span class="comment">/***************************************************************************\</span>
11083 <span class="comment">* hh - dump the flags in gdwHydraHint</span>
11084 <span class="comment">*</span>
11085 <span class="comment">* 05/20/98  MCostea       Created.</span>
11086 <span class="comment">\***************************************************************************/</span>
11087 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Ihh(
11088     DWORD opts,
11089     PVOID param1)
11090 {
11091     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwHHint, *pdwHH;
11092     ULONG ulSessionId, *pulASessionId;
11093     <span class="keywordtype">int</span> i, maxFlags;
11094 
11095     <span class="keywordtype">char</span> * aHHstrings[] = {
11096         <span class="stringliteral">"HH_DRIVERENTRY            0x00000001"</span>,
11097         <span class="stringliteral">"HH_USERINITIALIZE         0x00000002"</span>,
11098         <span class="stringliteral">"HH_INITVIDEO              0x00000004"</span>,
11099         <span class="stringliteral">"HH_REMOTECONNECT          0x00000008"</span>,
11100         <span class="stringliteral">"HH_REMOTEDISCONNECT       0x00000010"</span>,
11101         <span class="stringliteral">"HH_REMOTERECONNECT        0x00000020"</span>,
11102         <span class="stringliteral">"HH_REMOTELOGOFF           0x00000040"</span>,
11103         <span class="stringliteral">"HH_DRIVERUNLOAD           0x00000080"</span>,
11104         <span class="stringliteral">"HH_GRECLEANUP             0x00000100"</span>,
11105         <span class="stringliteral">"HH_USERKCLEANUP           0x00000200"</span>,
11106         <span class="stringliteral">"HH_INITIATEWIN32KCLEANUP  0x00000400"</span>,
11107         <span class="stringliteral">"HH_ALLDTGONE              0x00000800"</span>,
11108         <span class="stringliteral">"HH_RITGONE                0x00001000"</span>,
11109         <span class="stringliteral">"HH_RITCREATED             0x00002000"</span>,
11110         <span class="stringliteral">"HH_LOADCURSORS            0x00004000"</span>,
11111         <span class="stringliteral">"HH_KBDLYOUTGLOBALCLEANUP  0x00008000"</span>,
11112         <span class="stringliteral">"HH_KBDLYOUTFREEWINSTA     0x00010000"</span>,
11113         <span class="stringliteral">"HH_CLEANUPRESOURCES       0x00020000"</span>,
11114         <span class="stringliteral">"HH_DISCONNECTDESKTOP      0x00040000"</span>
11115     };
11116 
11117     <span class="keywordflow">if</span> (param1) {
11118         dwHHint = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)((DWORD_PTR)param1);
11119         Print(<span class="stringliteral">"gdwHydraHint is 0x%x:\n"</span>, dwHHint);
11120     } <span class="keywordflow">else</span> {
11121         pdwHH = EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gdwHydraHint));
11122         <span class="keywordflow">if</span>(!tryMove(dwHHint, pdwHH)) {
11123             Print(<span class="stringliteral">"Can't get value of gdwHydraHint"</span>);
11124             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
11125         }
11126 
11127         pulASessionId = EvalExp(<a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gSessionId));
11128         <span class="keywordflow">if</span> (!tryMove(ulSessionId, pulASessionId)) {
11129             Print(<span class="stringliteral">"Can't get value of gSessionId"</span>);
11130             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
11131         }
11132 
11133         Print(<span class="stringliteral">"Session 0x%x \n  gdwHydraHint is 0x%x:\n"</span>, ulSessionId, dwHHint);
11134     }
11135 
11136     i = 0;
11137     maxFlags = <span class="keyword">sizeof</span>(aHHstrings)/<span class="keyword">sizeof</span>(aHHstrings[0]);
11138 
11139     <span class="keywordflow">while</span> (dwHHint) {
11140 
11141         <span class="keywordflow">if</span> (dwHHint &amp; 0x01) {
11142 
11143             <span class="keywordflow">if</span> (i &gt;= maxFlags) {
11144                 Print(<span class="stringliteral">"\n Error: Unknown flags: userkdx.dll might be outdated\n"</span>);
11145                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
11146             }
11147             Print(<span class="stringliteral">"    %s\n"</span>, aHHstrings[i]);
11148         }
11149         i++;
11150         dwHHint &gt;&gt;= 1;
11151     }
11152 
11153     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
11154     UNREFERENCED_PARAMETER(opts);
11155 }
11156 
11157 <span class="preprocessor">#endif // KERNEL</span>
11158 <span class="preprocessor"></span>
11159 <span class="comment">/************************************************************************\</span>
11160 <span class="comment">* Procedure: Idupm</span>
11161 <span class="comment">*</span>
11162 <span class="comment">* 04/29/98 GerardoB     Created</span>
11163 <span class="comment">*</span>
11164 <span class="comment">\************************************************************************/</span>
11165 <span class="preprocessor">#ifdef KERNEL</span>
11166 <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idupm (<span class="keywordtype">void</span>)
11167 {
11168     <span class="keywordtype">char</span> ach[80];
11169     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwMask;
11170     <span class="keywordtype">int</span> i;
11171     WORD w = <a class="code" href="../../d2/d1/userexts_8c.html#a259a160">GF_UPM0</a>;
11172 
11173     Print(<span class="stringliteral">"UserPreferencesMask:\n"</span>);
11174     <span class="keywordflow">for</span> (i = 0; i &lt; SPI_BOOLMASKDWORDSIZE; i++) {
11175         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"win32k!gpdwCPUserPreferencesMask + %#lx"</span>, i * <span class="keyword">sizeof</span>(DWORD));
11176         moveExpValue(&amp;dwMask, ach);
11177         w = <a class="code" href="../../d2/d1/userexts_8c.html#a259a160">GF_UPM0</a> + i;
11178         Print(<span class="stringliteral">"Offset: %d - %#lx: %s\n"</span>,
11179               i, dwMask, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(w, dwMask, NULL, TRUE));
11180     }
11181     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
11182 }
11183 <span class="preprocessor">#endif // KERNEL</span>
11184 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
11185 <span class="comment">* Procedure: Idup</span>
11186 <span class="comment">*</span>
11187 <span class="comment">* 04/29/98 GerardoB     Created header</span>
11188 <span class="comment">*</span>
11189 <span class="comment">\************************************************************************/</span>
11190 <span class="preprocessor">#ifdef KERNEL</span>
11191 <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idup (<span class="keywordtype">void</span>)
11192 {
11193     Print(<span class="stringliteral">"Bummer, not implemented yet!"</span>);
11194     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
11195 }
11196 <span class="preprocessor">#endif // KERNEL</span>
11197 <span class="preprocessor"></span>
11198 
11199 <span class="comment">/************************************************************************\</span>
11200 <span class="comment">* Procedure: Idimc</span>
11201 <span class="comment">*</span>
11202 <span class="comment">* HiroYama     Created</span>
11203 <span class="comment">*</span>
11204 <span class="comment">\************************************************************************/</span>
11205 
11206 <span class="keyword">static</span> <span class="keyword">struct </span><span class="comment">/*NoName*/</span> {
11207     <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a134">terse</a>;
11208     <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a135">verbose</a>;
11209 } <a class="code" href="../../d2/d1/userexts_8c.html#a136">gaIMCAttr</a>[] = {
11210     <span class="stringliteral">"IN"</span>, <span class="stringliteral">"INPUT"</span>,
11211     <span class="stringliteral">"TC"</span>, <span class="stringliteral">"TARGET_CONVERTED"</span>,
11212     <span class="stringliteral">"CV"</span>, <span class="stringliteral">"CONVERTED"</span>,
11213     <span class="stringliteral">"TN"</span>, <span class="stringliteral">"TARGET_NOTCONVERTED"</span>,
11214     <span class="stringliteral">"IE"</span>, <span class="stringliteral">"INPUT_ERROR"</span>,
11215     <span class="stringliteral">"FC"</span>, <span class="stringliteral">"FIXEDCONVERTED"</span>,
11216 };
11217 
11218 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a239">GetInxAttr</a>(BYTE bAttr)
11219 {
11220     <span class="keywordflow">if</span> (bAttr &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(gaIMCAttr)) {
11221         <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/userexts_8c.html#a136">gaIMCAttr</a>[bAttr].terse;
11222     }
11223     <span class="keywordflow">return</span> <span class="stringliteral">"**"</span>;
11224 }
11225 
11226 <span class="keywordtype">void</span> <a class="code" href="../../d2/d1/userexts_8c.html#a240">_PrintInxAttr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* title, PVOID pCompStr, DWORD offset, DWORD len)
11227 {
11228     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
11229     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pAttr = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pCompStr + offset;
11230 
11231     <span class="keywordflow">if</span> (title == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
11232         <span class="comment">// Print a legend</span>
11233         Print(<span class="stringliteral">"  "</span>);
11234         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(gaIMCAttr); ++i) {
11235             <span class="keywordflow">if</span> (i &amp;&amp; i % 4 == 0) {
11236                 Print(<span class="stringliteral">"\n"</span>);
11237                 Print(<span class="stringliteral">"  "</span>);
11238             }
11239             Print(<span class="stringliteral">"%s:%s "</span>, gaIMCAttr[i].terse, gaIMCAttr[i].verbose);
11240         }
11241         Print(<span class="stringliteral">"\n"</span>);
11242         <span class="keywordflow">return</span>;
11243     }
11244 
11245     <span class="keywordflow">if</span> (offset == 0 || len == 0) {
11246         <span class="keywordflow">return</span>;
11247     }
11248 
11249     Print(<span class="stringliteral">"  %-12s (@%p) off:0x%x len:0x%x (in byte)\n"</span>,
11250           title, pAttr, offset, len);
11251     Print(<span class="stringliteral">"   "</span>);
11252     <span class="keywordflow">for</span> (i = 0; i &lt; len; ++i) {
11253         <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bAttr;
11254 
11255         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(bAttr, pAttr + i);
11256         Print(<span class="stringliteral">"|%s"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a239">GetInxAttr</a>(bAttr));
11257     }
11258     Print(<span class="stringliteral">"|\n"</span>);
11259 }
11260 
11261 <span class="preprocessor">#define PrintInxAttr(name) \</span>
11262 <span class="preprocessor">    _PrintInxAttr(#name, pCompStr, CompStr.dw ## name ## Offset, CompStr.dw ## name ## Len)</span>
11263 <span class="preprocessor"></span>
11264 <span class="keywordtype">void</span> <a class="code" href="../../d2/d1/userexts_8c.html#a241">_PrintInxClause</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* title, PVOID pCompStr, DWORD offset, DWORD len)
11265 {
11266     PDWORD pClause = (PDWORD)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pCompStr + offset);
11267     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
11268 
11269     <span class="keywordflow">if</span> (offset == 0 || len == 0) {
11270         <span class="keywordflow">return</span>;
11271     }
11272 
11273     Print(<span class="stringliteral">"  %-12s (@%p) off:0x%x len:0x%x (0x%x dwords)\n"</span>,
11274           title, pClause, offset, len, len / <span class="keyword">sizeof</span>(DWORD));
11275 
11276     Print(<span class="stringliteral">"   "</span>);
11277     len /= <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>);
11278     <span class="keywordflow">for</span> (i = 0; i &lt; len; ++i) {
11279         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwData;
11280 
11281         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dwData,  pClause + i);
11282         Print(<span class="stringliteral">"|0x%x"</span>, dwData);
11283     }
11284     Print(<span class="stringliteral">"|\n"</span>);
11285 }
11286 
11287 <span class="preprocessor">#define PrintInxClause(name) \</span>
11288 <span class="preprocessor">    _PrintInxClause(#name, pCompStr, CompStr.dw ## name ## Offset, CompStr.dw ## name ## Len)</span>
11289 <span class="preprocessor"></span>
11290 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a242">GetInxStr</a>(WCHAR wchar, BOOLEAN fUnicode)
11291 {
11292     <span class="keyword">static</span> <span class="keywordtype">char</span> ach[32];
11293 
11294     <span class="keywordflow">if</span> (wchar &gt;= 0x20 &amp;&amp; wchar &lt;= 0x7e) {
11295         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"'%c'"</span>, wchar);
11296     }
11297     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fUnicode) {
11298         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"U+%04x"</span>, wchar);
11299     }
11300     <span class="keywordflow">else</span> {
11301         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"%02x"</span>, (BYTE)wchar);
11302     }
11303 
11304     <span class="keywordflow">return</span> ach;
11305 }
11306 
11307 <span class="keywordtype">void</span> <a class="code" href="../../d2/d1/userexts_8c.html#a243">_PrintInxStr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* title, PVOID pCompStr, DWORD offset, DWORD len, BOOLEAN fUnicode)
11308 {
11309     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
11310 
11311     <span class="keywordflow">if</span> (offset == 0 || len == 0) {
11312         <span class="keywordflow">return</span>;
11313     }
11314 
11315     Print(<span class="stringliteral">"  %-12s (@%p) off:0x%x len:0x%x (0x%x cch)\n"</span>,
11316         title, (PBYTE)pCompStr + offset, offset, len, len / (fUnicode + 1));
11317 
11318     Print(<span class="stringliteral">"   "</span>);
11319     <span class="keywordflow">for</span> (i = 0; i &lt; len; ++i) {
11320         WCHAR wchar;
11321         <span class="keywordflow">if</span> (fUnicode) {
11322             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wchar, (PWCHAR)((PBYTE)pCompStr + offset) + i);
11323         }
11324         <span class="keywordflow">else</span> {
11325             <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bchar;
11326 
11327             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(bchar, (PBYTE)pCompStr + offset + i);
11328             wchar = bchar;
11329         }
11330         Print(<span class="stringliteral">"|%s"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a242">GetInxStr</a>(wchar, fUnicode));
11331     }
11332     Print(<span class="stringliteral">"|\n"</span>);
11333 }
11334 
11335 <span class="preprocessor">#define PrintInxStr(name) \</span>
11336 <span class="preprocessor">    _PrintInxStr(#name, pCompStr, CompStr.dw ## name ## Offset, CompStr.dw ## name ## Len, fUnicode)</span>
11337 <span class="preprocessor"></span>
11338 
11339 <span class="preprocessor">#define PrintInxElementA(name) \</span>
11340 <span class="preprocessor">    do { \</span>
11341 <span class="preprocessor">        PrintInxAttr(name ## Attr); \</span>
11342 <span class="preprocessor">        PrintInxClause(name ## Clause); \</span>
11343 <span class="preprocessor">        PrintInxStr(name ## Str); \</span>
11344 <span class="preprocessor">    } while (0)</span>
11345 <span class="preprocessor"></span>
11346 <span class="preprocessor">#define PrintInxElementB(name) \</span>
11347 <span class="preprocessor">    do { \</span>
11348 <span class="preprocessor">        PrintInxClause(name ## Clause); \</span>
11349 <span class="preprocessor">        PrintInxStr(name ## Str); \</span>
11350 <span class="preprocessor">    } while (0)</span>
11351 <span class="preprocessor"></span>
11352 
11353 <span class="keywordtype">void</span> <a class="code" href="../../d2/d1/userexts_8c.html#a244">_PrintInxFriendlyStr</a>(
11354     <span class="keyword">const</span> <span class="keywordtype">char</span>* title,
11355     PBYTE pCompStr,
11356     DWORD dwAttrOffset,
11357     DWORD dwAttrLen,
11358     DWORD dwClauseOffset,
11359     DWORD dwClauseLen,
11360     DWORD dwStrOffset,
11361     DWORD dwStrLen,
11362     BOOLEAN fUnicode)
11363 {
11364     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
11365     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
11366     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwClause;
11367 
11368     Print(<span class="stringliteral">"  %-11s"</span>, title);
11369     <span class="keywordflow">if</span> (dwStrOffset == 0 || dwStrLen == 0) {
11370         Print(<span class="stringliteral">"\n"</span>);
11371         <span class="keywordflow">return</span>;
11372     }
11373 
11374     <span class="keywordflow">for</span> (i = 0, <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = 0; i &lt; dwStrLen; ++i) {
11375         <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bAttr;
11376         WCHAR wchar;
11377 
11378         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dwClause, (PDWORD)(pCompStr + dwClauseOffset) + n);
11379         <span class="keywordflow">if</span> (dwClause == i) {
11380             ++<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
11381             <span class="keywordflow">if</span> (i) {
11382                 Print(<span class="stringliteral">"| "</span>);
11383             }
11384         }
11385 
11386         <span class="keywordflow">if</span> (fUnicode) {
11387             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wchar, (PWCHAR)((PBYTE)pCompStr + dwStrOffset) + i);
11388         }
11389         <span class="keywordflow">else</span> {
11390             <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bchar;
11391             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(bchar, (PBYTE)pCompStr + dwStrOffset + i);
11392             wchar = bchar;
11393         }
11394 
11395         <span class="keywordflow">if</span> (dwAttrOffset != ~0) {
11396             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(bAttr, pCompStr + dwAttrOffset + i);
11397             Print(<span class="stringliteral">"|%s:%s"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a239">GetInxAttr</a>(bAttr), <a class="code" href="../../d2/d1/userexts_8c.html#a242">GetInxStr</a>(wchar, fUnicode));
11398         }
11399         <span class="keywordflow">else</span> {
11400             Print(<span class="stringliteral">"|%s"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a242">GetInxStr</a>(wchar, fUnicode));
11401         }
11402     }
11403     Print(<span class="stringliteral">"|\n"</span>);
11404     <span class="keywordflow">if</span> (dwClauseLen / <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>) != (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> + 1)) {
11405         Print(<span class="stringliteral">"  ** dwClauseLen (0x%x) doesn't match to n (0x%x) **\n"</span>, dwClauseLen, (n + 1) * <span class="keyword">sizeof</span>(DWORD));
11406     }
11407     <span class="keywordflow">if</span> (dwAttrOffset != ~0 &amp;&amp; dwAttrLen != dwStrLen) {
11408         Print(<span class="stringliteral">"  ** dwAttrLen (0x%x) doesn't match to dwStrLen (0x%x) **\n"</span>, dwAttrLen, dwStrLen);
11409     }
11410 }
11411 
11412 <span class="preprocessor">#define PrintInxFriendlyStrA(name) \</span>
11413 <span class="preprocessor">    _PrintInxFriendlyStr(#name, \</span>
11414 <span class="preprocessor">                         (PBYTE)pCompStr, \</span>
11415 <span class="preprocessor">                         CompStr.dw ## name ## AttrOffset, \</span>
11416 <span class="preprocessor">                         CompStr.dw ## name ## AttrLen, \</span>
11417 <span class="preprocessor">                         CompStr.dw ## name ## ClauseOffset, \</span>
11418 <span class="preprocessor">                         CompStr.dw ## name ## ClauseLen, \</span>
11419 <span class="preprocessor">                         CompStr.dw ## name ## StrOffset, \</span>
11420 <span class="preprocessor">                         CompStr.dw ## name ## StrLen, \</span>
11421 <span class="preprocessor">                         fUnicode)</span>
11422 <span class="preprocessor"></span>
11423 <span class="preprocessor">#define PrintInxFriendlyStrB(name) \</span>
11424 <span class="preprocessor">    _PrintInxFriendlyStr(#name, \</span>
11425 <span class="preprocessor">                         (PBYTE)pCompStr, \</span>
11426 <span class="preprocessor">                         ~0, \</span>
11427 <span class="preprocessor">                         0, \</span>
11428 <span class="preprocessor">                         CompStr.dw ## name ## ClauseOffset, \</span>
11429 <span class="preprocessor">                         CompStr.dw ## name ## ClauseLen, \</span>
11430 <span class="preprocessor">                         CompStr.dw ## name ## StrOffset, \</span>
11431 <span class="preprocessor">                         CompStr.dw ## name ## StrLen, \</span>
11432 <span class="preprocessor">                         fUnicode)</span>
11433 <span class="preprocessor"></span>
11434 
11435 
11436 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a245">Idimc</a>(DWORD opts, PVOID param1)
11437 {
11438     <a class="code" href="../../d1/d7/structtagIMC.html">IMC</a> imc;
11439     <a class="code" href="../../d1/d7/structtagIMC.html">PIMC</a> pImc;
11440     <a class="code" href="../../d3/d0/structtagCLIENTIMC.html">PCLIENTIMC</a> pClientImc;
11441     <a class="code" href="../../d3/d0/structtagCLIENTIMC.html">CLIENTIMC</a> ClientImc;
11442     PINPUTCONTEXT pInputContext;
11443     INPUTCONTEXT InputContext;
11444     HANDLE hInputContext;
11445     BOOLEAN fUnicode = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
11446     BOOLEAN fVerbose, fDumpInputContext, fShowIMCMinInfo, fShowModeSaver, fShowCompStrRaw;
11447     <span class="keywordtype">char</span> ach[32];
11448 
11449     <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
11450         Print(<span class="stringliteral">"!dimc -? for help\n"</span>);
11451         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
11452     }
11453 
11454     <span class="comment">//</span>
11455     <span class="comment">// If "All" option is specified, set all bits in opts</span>
11456     <span class="comment">// except type specifiers.</span>
11457     <span class="comment">//</span>
11458     <span class="keywordflow">if</span> (opts &amp; OFLAG(a)) {
11459         opts |= ~(OFLAG(w) | OFLAG(c) | OFLAG(i) | OFLAG(u));
11460     }
11461 
11462     fVerbose = !!(opts &amp; OFLAG(v));
11463     fShowCompStrRaw = (opts &amp; OFLAG(s)) || fVerbose;
11464     fDumpInputContext = (opts &amp; OFLAG(d)) || fShowCompStrRaw || fVerbose;
11465     fShowIMCMinInfo = (opts &amp; OFLAG(h)) || fDumpInputContext || fVerbose;
11466     fShowModeSaver = (opts &amp; OFLAG(r)) || fVerbose;
11467 
11468     <span class="keywordflow">if</span> (opts &amp; OFLAG(w)) {
11469         <span class="comment">//</span>
11470         <span class="comment">// Arg is hwnd or pwnd.</span>
11471         <span class="comment">//</span>
11472         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd;
11473 
11474         <span class="keywordflow">if</span> ((pwnd = <a class="code" href="../../d2/d1/userexts_8c.html#a197">HorPtoP</a>(param1, TYPE_WINDOW)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
11475             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
11476         }
11477         Print(<span class="stringliteral">"pwnd=%p\n"</span>, pwnd);
11478         <span class="keywordflow">if</span> (!tryMove(param1, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o20">hImc</a>)) {
11479             Print(<span class="stringliteral">"Could not read pwnd-&gt;hImc.\n"</span>);
11480             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
11481         }
11482     }
11483 
11484     <span class="keywordflow">if</span> (opts &amp; OFLAG(c)) {
11485         <span class="comment">//</span>
11486         <span class="comment">// Arg is client side IMC</span>
11487         <span class="comment">//</span>
11488         pClientImc = param1;
11489         <span class="keywordflow">goto</span> LClientImc;
11490     }
11491 
11492     <span class="keywordflow">if</span> (opts &amp; OFLAG(i)) {
11493         <span class="comment">//</span>
11494         <span class="comment">// Arg is pInputContext.</span>
11495         <span class="comment">//</span>
11496         pInputContext = param1;
11497         opts |= OFLAG(h);   <span class="comment">// otherwise, nothing will be displayed !</span>
11498         hInputContext = 0;
11499         <span class="keywordflow">if</span> (opts &amp; OFLAG(u)) {
11500             Print(<span class="stringliteral">"Assuming Input Context is UNICODE.\n"</span>);
11501         }
11502         <span class="keywordflow">else</span> {
11503             Print(<span class="stringliteral">"Assuming Input Context is ANSI.\n"</span>);
<a name="l11504"></a><a class="code" href="../../d2/d1/userexts_8c.html#a232">11504</a>         }
11505         <span class="keywordflow">goto</span> LInputContext;
11506     }
11507 
11508     <span class="comment">//</span>
11509     <span class="comment">// Otherwise, Arg is hImc.</span>
11510     <span class="comment">//</span>
11511     <span class="keywordflow">if</span> ((pImc = <a class="code" href="../../d2/d1/userexts_8c.html#a197">HorPtoP</a>(param1, TYPE_INPUTCONTEXT)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
11512         Print(<span class="stringliteral">"Idimc: %x is not an input context.\n"</span>, param1);
11513         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
11514     }
11515     <span class="comment">//move(imc, FIXKP(pImc));</span>
11516     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(imc, pImc);
11517 
11518 <span class="preprocessor">#ifdef KERNEL</span>
11519 <span class="preprocessor"></span>    <span class="comment">// Print simple thread info.</span>
11520     <span class="keywordflow">if</span> (imc.<a class="code" href="../../d1/d7/structtagIMC.html#o0">head</a>.pti) {
11521         Idt(OFLAG(p), (PVOID)imc.<a class="code" href="../../d1/d7/structtagIMC.html#o0">head</a>.pti);
11522     }
11523 <span class="preprocessor">#endif</span>
11524 <span class="preprocessor"></span>
11525     <span class="comment">//</span>
11526     <span class="comment">// Basic information</span>
11527     <span class="comment">//</span>
11528     Print(<span class="stringliteral">"pImc = %08lx  pti:%08lx\n"</span>, pImc, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(imc.<a class="code" href="../../d1/d7/structtagIMC.html#o0">head</a>.pti));
11529     Print(<span class="stringliteral">"  handle      %08lx\n"</span>, imc.<a class="code" href="../../d1/d7/structtagIMC.html#o0">head</a>.h);
11530     Print(<span class="stringliteral">"  dwClientImc %08lx\n"</span>, imc.<a class="code" href="../../d1/d7/structtagIMC.html#o2">dwClientImcData</a>);
11531     Print(<span class="stringliteral">"  hImeWnd     %08lx\n"</span>, imc.<a class="code" href="../../d1/d7/structtagIMC.html#o3">hImeWnd</a>);
11532 
11533     <span class="comment">//</span>
11534     <span class="comment">// Show client IMC</span>
11535     <span class="comment">//</span>
11536     pClientImc = (PVOID)imc.<a class="code" href="../../d1/d7/structtagIMC.html#o2">dwClientImcData</a>;
11537 LClientImc:
11538     <span class="keywordflow">if</span> (pClientImc == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
11539         Print(<span class="stringliteral">"pClientImc is NULL.\n"</span>);
11540         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
11541     }
11542     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ClientImc, pClientImc);
11543 
11544     <span class="keywordflow">if</span> (fVerbose) {
11545         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"CLIENTIMC %p"</span>, pClientImc);
11546         <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
11547     }
11548     <span class="keywordflow">else</span> {
11549         Print(<span class="stringliteral">"pClientImc @%p  cLockObj:%x\n"</span>, imc.<a class="code" href="../../d1/d7/structtagIMC.html#o2">dwClientImcData</a>, ClientImc.<a class="code" href="../../d3/d0/structtagCLIENTIMC.html#o1">cLockObj</a>);
11550     }
11551     Print(<span class="stringliteral">"  dwFlags %s\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_CLIENTIMC, ClientImc.<a class="code" href="../../d3/d0/structtagCLIENTIMC.html#o2">dwFlags</a>, NULL, TRUE));
11552     fUnicode = !!(ClientImc.<a class="code" href="../../d3/d0/structtagCLIENTIMC.html#o2">dwFlags</a> &amp; <a class="code" href="../../d8/d0/immstruc_8h.html#a4">IMCF_UNICODE</a>);
11553 
11554     <span class="comment">//</span>
11555     <span class="comment">// Show InputContext</span>
11556     <span class="comment">//</span>
11557     hInputContext = ClientImc.<a class="code" href="../../d3/d0/structtagCLIENTIMC.html#o0">hInputContext</a>;
11558     <span class="keywordflow">if</span> (hInputContext) {
11559         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pInputContext, hInputContext);
11560     }
11561     <span class="keywordflow">else</span> {
11562         pInputContext = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
11563     }
11564 LInputContext:
11565     Print(<span class="stringliteral">"InputContext %08lx (@%p)"</span>, hInputContext, pInputContext);
11566 
11567     <span class="keywordflow">if</span> (pInputContext == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
11568         Print(<span class="stringliteral">"\n"</span>);
11569         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
11570     }
11571 
11572     <span class="comment">//</span>
11573     <span class="comment">// if UNICODE specified by the option,</span>
11574     <span class="comment">// set the flag accordingly</span>
11575     <span class="comment">//</span>
11576     <span class="keywordflow">if</span> (opts &amp; OFLAG(u)) {
11577         fUnicode = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
11578     }
11579 
11580     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(InputContext, pInputContext);
11581     Print(<span class="stringliteral">"   hwnd=%p\n"</span>, InputContext.hWnd);
11582 
11583     <span class="keywordflow">if</span> (fVerbose) {
11584         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"INPUTCONTEXT %p"</span>, pInputContext);
11585         <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
11586     }
11587 
11588 
11589     <span class="comment">//</span>
11590     <span class="comment">// Decipher InputContext.</span>
11591     <span class="comment">//</span>
11592     <span class="keywordflow">if</span> (fShowIMCMinInfo) {
11593         PCOMPOSITIONSTRING pCompStr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
11594         PCANDIDATEINFO pCandInfo = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
11595         PGUIDELINE pGuideLine = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
<a name="l11596"></a><a class="code" href="../../d2/d1/userexts_8c.html#a233">11596</a>         PTRANSMSGLIST pMsgBuf = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
11597         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> i;
11598 
11599         Print(<span class="stringliteral">"  dwRefCount: 0x%x      fdwDirty: %s\n"</span>,
11600               InputContext.dwRefCount, <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_IMEDIRTY, InputContext.fdwDirty, NULL, TRUE));
11601         Print(<span class="stringliteral">"  Conversion: %s\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_CONVERSION, InputContext.fdwConversion, NULL, TRUE));
11602         Print(<span class="stringliteral">"  Sentence:   %s\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_SENTENCE, InputContext.fdwSentence, NULL, TRUE));
11603         Print(<span class="stringliteral">"  fChgMsg:    %d     uSaveVKey:   %02x %s\n"</span>,
11604               InputContext.fChgMsg,
11605               InputContext.uSavedVKey, <a class="code" href="../../d2/d1/userexts_8c.html#a212">GetVKeyName</a>(InputContext.uSavedVKey));
11606         Print(<span class="stringliteral">"  StatusWnd:  (0x%x,0x%x)   SoftKbd: (0x%x,0x%x)\n"</span>,
11607               InputContext.ptStatusWndPos.x, InputContext.ptStatusWndPos.y,
11608               InputContext.ptSoftKbdPos.x, InputContext.ptSoftKbdPos.y);
11609         Print(<span class="stringliteral">"  fdwInit:    %s\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_IMEINIT, InputContext.fdwInit, NULL, TRUE));
11610         <span class="comment">// Font</span>
11611         {
11612             LPCSTR fmt = <span class="stringliteral">"  Font:       '%s' %dpt wt:%d charset: %s\n"</span>;
11613             <span class="keywordflow">if</span> (fUnicode) {
11614                 fmt = <span class="stringliteral">"  Font:       '%S' %dpt wt:%d charset: %s\n"</span>;
11615             }
11616             Print(fmt,
11617                   InputContext.lfFont.A.lfFaceName,
11618                   InputContext.lfFont.A.lfHeight,
11619                   InputContext.lfFont.A.lfWeight,
11620                   <a class="code" href="../../d2/d1/userexts_8c.html#a202">GetMaskedEnum</a>(EI_CHARSETTYPE, InputContext.lfFont.A.lfCharSet, NULL));
11621         }
11622 
11623         <span class="comment">// COMPOSITIONFORM</span>
11624         Print(<span class="stringliteral">"  cfCompForm: %s pos:(0x%x,0x%x) rc:(0x%x,0x%x)-(0x%x,0x%x)\n"</span>,
11625               <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_IMECOMPFORM, InputContext.cfCompForm.dwStyle, NULL, TRUE),
11626               InputContext.cfCompForm.ptCurrentPos.x, InputContext.cfCompForm.ptCurrentPos.y,
11627               InputContext.cfCompForm.rcArea.left, InputContext.cfCompForm.rcArea.top,
11628               InputContext.cfCompForm.rcArea.right, InputContext.cfCompForm.rcArea.bottom);
11629 
11630         <span class="keywordflow">if</span> (InputContext.hCompStr) {
11631             <span class="keywordflow">if</span> (!tryMove(pCompStr, InputContext.hCompStr)) {
11632                 Print(<span class="stringliteral">"Could not get hCompStr=%08x\n"</span>, InputContext.hCompStr);
11633                 <span class="comment">//return FALSE;</span>
11634             }
11635         }
11636         <span class="keywordflow">if</span> (pCompStr &amp;&amp; fVerbose) {
11637             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"COMPOSITIONSTRING %p"</span>, pCompStr);
11638             <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
11639         }
11640 
11641         <span class="keywordflow">if</span> (InputContext.hCandInfo) {
11642             <span class="keywordflow">if</span> (!tryMove(pCandInfo, InputContext.hCandInfo)) {
11643                 Print(<span class="stringliteral">"Could not get hCandInfo=%08x\n"</span>, InputContext.hCandInfo);
11644                 <span class="comment">//return FALSE;</span>
11645             }
11646         }
11647         <span class="keywordflow">if</span> (pCandInfo &amp;&amp; fVerbose) {
11648             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"CANDIDATEINFO %p"</span>, pCandInfo);
11649             <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
11650         }
11651 
11652         <span class="keywordflow">if</span> (InputContext.hGuideLine) {
11653             <span class="keywordflow">if</span> (!tryMove(pGuideLine, InputContext.hGuideLine)) {
11654                 Print(<span class="stringliteral">"Could not get hGuideLine=%08x\n"</span>, InputContext.hGuideLine);
11655                 <span class="comment">//return FALSE;</span>
11656             }
11657         }
11658         <span class="keywordflow">if</span> (pGuideLine &amp;&amp; fVerbose) {
11659             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"GUIDELINE %p"</span>, pGuideLine);
11660             <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
11661         }
11662 
11663         <span class="keywordflow">if</span> (InputContext.hMsgBuf) {
11664             <span class="keywordflow">if</span> (!tryMove(pMsgBuf, InputContext.hMsgBuf)) {
11665                 Print(<span class="stringliteral">"Could not get hMsgBuf=%08x\n"</span>, InputContext.hMsgBuf);
11666                 <span class="comment">//return FALSE;</span>
11667             }
11668         }
11669         <span class="keywordflow">if</span> (pMsgBuf &amp;&amp; fVerbose) {
11670             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"TRANSMSGLIST %p"</span>, pMsgBuf);
11671             <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
11672         }
11673 
11674         <span class="keywordflow">if</span> (!fDumpInputContext &amp;&amp; !fVerbose) {
11675             Print(<span class="stringliteral">"  CompStr @%p  CandInfo @%p  GuideL @%p  \n"</span>,
11676                 pCompStr, pCandInfo, pGuideLine);
11677             Print(<span class="stringliteral">"  MsgBuf @%p (0x%x)\n"</span>, pMsgBuf, InputContext.dwNumMsgBuf);
11678         }
11679 
11680         <span class="keywordflow">if</span> (fDumpInputContext) {
11681             <span class="comment">//</span>
11682             <span class="comment">// Composition String</span>
11683             <span class="comment">//</span>
11684             <span class="keywordflow">if</span> (pCompStr) {
11685                 COMPOSITIONSTRING CompStr;
<a name="l11686"></a><a class="code" href="../../d2/d1/userexts_8c.html#a234">11686</a> 
11687                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(CompStr, pCompStr);
11688                 Print(<span class="stringliteral">" hCompositionString: %p (@%p) dwSize=0x%x\n"</span>,
11689                     InputContext.hCompStr, pCompStr, CompStr.dwSize);
11690 
11691                 <span class="keywordflow">if</span> (fShowCompStrRaw) {
11692                     <a class="code" href="../../d2/d1/userexts_8c.html#a240">_PrintInxAttr</a>(NULL, NULL, 0, 0);
11693                     <a class="code" href="../../d2/d1/userexts_8c.html#a54">PrintInxElementA</a>(CompRead);
11694                     <a class="code" href="../../d2/d1/userexts_8c.html#a54">PrintInxElementA</a>(Comp);
11695                     <a class="code" href="../../d2/d1/userexts_8c.html#a55">PrintInxElementB</a>(ResultRead);
11696                     <a class="code" href="../../d2/d1/userexts_8c.html#a55">PrintInxElementB</a>(Result);
11697                 }
11698 
11699                 Print(<span class="stringliteral">"  CursorPos=0x%x  DeltaStart=0x%x\n"</span>,
11700                     CompStr.dwCursorPos, CompStr.dwDeltaStart);
11701                 Print(<span class="stringliteral">"  Private: (@%p) off:0x%x len:0x%x\n"</span>,
11702                     (PBYTE)pCompStr + CompStr.dwPrivateOffset,
11703                     CompStr.dwPrivateOffset, CompStr.dwPrivateSize);
11704 
11705                 Print(<span class="stringliteral">"\n"</span>);
11706 
11707                 <a class="code" href="../../d2/d1/userexts_8c.html#a56">PrintInxFriendlyStrA</a>(CompRead);
11708                 <a class="code" href="../../d2/d1/userexts_8c.html#a56">PrintInxFriendlyStrA</a>(Comp);
11709                 <a class="code" href="../../d2/d1/userexts_8c.html#a57">PrintInxFriendlyStrB</a>(ResultRead);
11710                 <a class="code" href="../../d2/d1/userexts_8c.html#a57">PrintInxFriendlyStrB</a>(Result);
11711 
11712                 Print(<span class="stringliteral">"\n"</span>);
11713             }
11714             <span class="keywordflow">else</span> {
11715                 Print(<span class="stringliteral">" pCompStr is NULL\n"</span>);
11716             }
11717 
11718             <span class="comment">//</span>
11719             <span class="comment">// Candidate Info</span>
11720             <span class="comment">//</span>
11721             <span class="keywordflow">if</span> (pCandInfo) {
11722                 CANDIDATEINFO CandInfo;
11723 
11724                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(CandInfo, pCandInfo);
11725                 Print(<span class="stringliteral">" hCandidateInfo: %p (@%p) dwSize=0x%x dwCount=0x%x PrivOffset=0x%x PrivSize=0x%x\n"</span>,
11726                       InputContext.hCandInfo, pCandInfo, CandInfo.dwSize, CandInfo.dwCount,
11727                       CandInfo.dwPrivateOffset, CandInfo.dwPrivateSize);
<a name="l11728"></a><a class="code" href="../../d2/d1/userexts_8c.html#a235">11728</a> 
11729                 <span class="keywordflow">for</span> (i = 0; i &lt; CandInfo.dwCount; ++i) {
11730                     PCANDIDATELIST pCandList;
11731                     CANDIDATELIST CandList;
11732                     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> j;
11733 
11734                     pCandList = (PCANDIDATELIST)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pCandInfo + CandInfo.dwOffset[i]);
11735                     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(CandList, pCandList);
11736 
11737                     Print(<span class="stringliteral">"   CandList[%02x] (@%p) %s count=%x sel=%x pgStart=%x pgSize=%x\n"</span>,
11738                           i, pCandList, <a class="code" href="../../d2/d1/userexts_8c.html#a202">GetMaskedEnum</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a260a185">EI_IMECANDIDATESTYLE</a>, CandList.dwStyle, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>),
11739                           CandList.dwCount,
11740                           CandList.dwSelection, CandList.dwPageStart, CandList.dwPageSize);
11741 
11742                     <span class="keywordflow">if</span> (CandList.dwStyle == IME_CAND_CODE &amp;&amp; CandList.dwCount == 1) {
11743                         <span class="comment">// Special case</span>
11744                         Print(<span class="stringliteral">"     Special case: DBCS char = %04x"</span>, CandList.dwOffset[0]);
<a name="l11745"></a><a class="code" href="../../d2/d1/userexts_8c.html#a236">11745</a>                     }
11746                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CandList.dwCount &gt; 1) {
11747                         <span class="keywordflow">for</span> (j = 0; j &lt; CandList.dwCount; ++j) {
11748                             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> k;
11749                             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwOffset;
11750 
11751                             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dwOffset, pCandList-&gt;dwOffset + j);
11752 
11753                             Print(<span class="stringliteral">"    %c%c[%02x]@%p "</span>,
11754                                   j == CandList.dwSelection ? <span class="charliteral">'*'</span> : <span class="charliteral">' '</span>,
11755                                   (j &gt;= CandList.dwPageStart &amp;&amp; j &lt; CandList.dwPageStart + CandList.dwPageSize) ? <span class="charliteral">'+'</span> : <span class="charliteral">' '</span>,
11756                                   j, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pCandList + dwOffset);
11757                             <span class="keywordflow">for</span> (k = 0; k &lt; 0x100; ++k) {   <span class="comment">// limit upto 0xff cch</span>
11758                                 WCHAR wchar;
11759 
11760                                 <span class="keywordflow">if</span> (fUnicode) {
11761                                     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wchar, (PWCHAR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pCandList + dwOffset) + k);
11762                                 }
11763                                 <span class="keywordflow">else</span> {
11764                                     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bchar;
11765                                     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(bchar, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pCandList + dwOffset + k);
11766                                     wchar = bchar;
11767                                 }
11768                                 <span class="keywordflow">if</span> (wchar == 0) {
11769                                     <span class="keywordflow">break</span>;
11770                                 }
11771                                 Print(<span class="stringliteral">"|%s"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a242">GetInxStr</a>(wchar, fUnicode));
11772                             }
11773                             Print(<span class="stringliteral">"|\n"</span>);
11774                         }
11775                     }
11776                 }
11777             }
11778 
11779             <span class="keywordflow">if</span> (pGuideLine) {
11780                 GUIDELINE GuideLine;
11781 
11782                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(GuideLine, pGuideLine);
11783                 Print(<span class="stringliteral">" hGuideLine: %p (@%p) dwSize=0x%x\n"</span>,
11784                     InputContext.hGuideLine, pGuideLine, GuideLine.dwSize);
11785 
11786                 Print(<span class="stringliteral">"   level:%x index;%x privOffset:%x privSize:%x\n"</span>,
11787                       GuideLine.dwLevel, GuideLine.dwIndex,
11788                       GuideLine.dwPrivateSize, GuideLine.dwPrivateOffset);
11789 
11790                 <span class="keywordflow">if</span> (GuideLine.dwStrOffset &amp;&amp; GuideLine.dwStrLen) {
11791                     <span class="comment">// String</span>
11792                     Print(<span class="stringliteral">"   str @%p  "</span>, (PBYTE)pGuideLine + GuideLine.dwStrOffset);
11793                     <span class="keywordflow">for</span> (i = 0; i &lt; GuideLine.dwStrLen; ++i) {
11794                         WCHAR wchar;
11795 
11796                         <span class="keywordflow">if</span> (fUnicode) {
11797                             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wchar, (PWCHAR)((PBYTE)pGuideLine + GuideLine.dwStrOffset) + i);
11798                         }
11799                         <span class="keywordflow">else</span> {
11800                             <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bchar;
11801                             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(bchar, (PBYTE)pGuideLine + GuideLine.dwStrOffset + i);
11802                             wchar = bchar;
11803                         }
11804                         Print(<span class="stringliteral">"|%s"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a242">GetInxStr</a>(wchar, fUnicode));
11805                     }
11806                     Print(<span class="stringliteral">"|\n"</span>);
11807                 }
11808             }
11809 
11810             <span class="keywordflow">if</span> (pMsgBuf) {
11811                 TRANSMSGLIST TransMsgList;
11812 
11813                 <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(TransMsgList, pMsgBuf);
11814                 Print(<span class="stringliteral">" hMsgBuf: %p (@%p) dwNumMsgBuf=0x%x uMsgCount=0x%x\n"</span>,
11815                     InputContext.hMsgBuf, pMsgBuf, InputContext.dwNumMsgBuf,
11816                     TransMsgList.uMsgCount);
11817 
11818                 <span class="keywordflow">if</span> (InputContext.dwNumMsgBuf) {
11819                     PTRANSMSG pTransMsg = pMsgBuf-&gt;TransMsg;
11820 
11821                     Print(<span class="stringliteral">"  | ## |msg | wParam | lParam |\n"</span>);
11822                     Print(<span class="stringliteral">"  +----+----+--------+--------+\n"</span>);
11823 
11824                     <span class="keywordflow">for</span> (i = 0; i &lt; InputContext.dwNumMsgBuf; ++i, ++pTransMsg) {
11825                         <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="../../d2/d1/userexts_8c.html#a130">pszMsg</a> = <span class="stringliteral">""</span>;
11826                         TRANSMSG TransMsg;
11827                         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> j;
11828 
11829                         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(TransMsg, pTransMsg);
11830 
11831                         <span class="comment">// Try to find a readable name of the window message</span>
11832                         <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(gaMsgs); ++j) {
11833                             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a131">gaMsgs</a>[i].msg == TransMsg.message) {
11834                                 <a class="code" href="../../d2/d1/userexts_8c.html#a130">pszMsg</a> = <a class="code" href="../../d2/d1/userexts_8c.html#a131">gaMsgs</a>[j].pszMsg;
11835                                 <span class="keywordflow">break</span>;
11836                             }
11837                         }
11838 
11839                         Print(<span class="stringliteral">"   | %02x |%04x|%08x|%08x| %s\n"</span>,
11840                             i,
11841                             TransMsg.message, TransMsg.wParam, TransMsg.lParam, pszMsg);
11842                     }
11843                     Print(<span class="stringliteral">"  +----+----+--------+--------+\n"</span>);
11844                 }
11845             }
11846 
11847         }
11848     }
11849 
11850     <span class="comment">//</span>
11851     <span class="comment">// Recursively display Mode Savers.</span>
11852     <span class="comment">//</span>
11853     <span class="keywordflow">if</span> (fShowModeSaver) {
11854         <a class="code" href="../../d2/d8/structtagIMEMODESAVER.html">PIMEMODESAVER</a> pModeSaver = InputContext.pImeModeSaver;
11855 
11856         <span class="comment">//</span>
11857         <span class="comment">// Private Mode Savers.</span>
11858         <span class="comment">//</span>
11859         <span class="keywordflow">while</span> (pModeSaver) {
11860             <a class="code" href="../../d2/d8/structtagIMEMODESAVER.html">IMEMODESAVER</a> ImeModeSaver;
11861 
11862             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ImeModeSaver, pModeSaver);
11863             Print(<span class="stringliteral">"ImeModeSaver @ %p -- LangId=%04x fOpen=%d\n"</span>,
11864                   pModeSaver, ImeModeSaver.<a class="code" href="../../d2/d8/structtagIMEMODESAVER.html#o1">langId</a>, ImeModeSaver.<a class="code" href="../../d2/d8/structtagIMEMODESAVER.html#o2">fOpen</a>);
11865             Print(<span class="stringliteral">"    fdwInit      %s\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_IMEINIT, ImeModeSaver.<a class="code" href="../../d2/d8/structtagIMEMODESAVER.html#o5">fdwInit</a>, NULL, TRUE));
11866             Print(<span class="stringliteral">"    Conversion   %s\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_CONVERSION, ImeModeSaver.<a class="code" href="../../d2/d8/structtagIMEMODESAVER.html#o3">fdwConversion</a>, NULL, TRUE));
11867             Print(<span class="stringliteral">"    Sentence     %s\n"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_SENTENCE, ImeModeSaver.<a class="code" href="../../d2/d8/structtagIMEMODESAVER.html#o4">fdwSentence</a>, NULL, TRUE));
11868             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(pModeSaver, &amp;pModeSaver-&gt;<a class="code" href="../../d2/d8/structtagIMEMODESAVER.html#o0">next</a>);
11869         }
11870     }
11871 
11872     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
11873 }
11874 
11875 <span class="preprocessor">#ifndef KERNEL</span>
11876 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
11877 <span class="comment">* Procedure: Ikc</span>
11878 <span class="comment">*</span>
11879 <span class="comment">* Dumps keyboard cues state for the window, and pertinent info on the</span>
11880 <span class="comment">* parent KC state and the system settings related to this</span>
11881 <span class="comment">*</span>
11882 <span class="comment">* 06/11/98 MCostea     Created</span>
11883 <span class="comment">*</span>
11884 <span class="comment">\************************************************************************/</span>
11885 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a246">Ikc</a>(
11886     DWORD opts,
11887     PVOID param1)
11888 {
11889     <a class="code" href="../../d6/d9/structtagWND.html">WND</a> wnd;
11890     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, pwndParent;
11891     <span class="keywordtype">char</span> ach[80];
11892     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bHideFocus, bHideAccel;
11893     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">SERVERINFO</a> si;
11894     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">PSERVERINFO</a> psi;
11895 
11896     <span class="keywordflow">if</span> (param1 &amp;&amp; (pwnd = <a class="code" href="../../d2/d1/userexts_8c.html#a197">HorPtoP</a>(param1, TYPE_WINDOW)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
11897         Print(<span class="stringliteral">"Idw: %x is not a pwnd.\n"</span>, param1);
11898         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
11899     }
11900     moveExpValuePtr(&amp;psi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
11901     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(si, psi);
11902 
11903     <span class="keywordflow">if</span> (si.bKeyboardPref) {
11904         Print(<span class="stringliteral">"gpsi-&gt;bKeyboardPref ON, KC mechanism is turned off\n"</span>);
11905     }
11906     <span class="keywordflow">if</span> (!(si.PUSIFlags &amp; (<a class="code" href="../../d1/d0/inc_2user_8h.html#a374">PUSIF_KEYBOARDCUES</a> | <a class="code" href="../../d1/d0/inc_2user_8h.html#a375">PUSIF_UIEFFECTS</a>) == <a class="code" href="../../d1/d0/inc_2user_8h.html#a374">PUSIF_KEYBOARDCUES</a> | <a class="code" href="../../d1/d0/inc_2user_8h.html#a375">PUSIF_UIEFFECTS</a>)) {
11907         Print(<span class="stringliteral">"Either the UI effects or PUSIF_KEYBOARDCUES are off\n"</span>);
11908     }
11909 
11910     <span class="keywordflow">if</span> (!param1) {
11911         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
11912     }
11913     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wnd, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(pwnd));
11914     <span class="comment">/*</span>
11915 <span class="comment">     * Print pwnd and title string.</span>
11916 <span class="comment">     */</span>
11917     <a class="code" href="../../d2/d1/userexts_8c.html#a198">DebugGetWindowTextA</a>(pwnd, ach);
11918     Print(<span class="stringliteral">"pwnd = %08lx  \"%s\"\n"</span>, pwnd, ach);
11919     bHideAccel = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFPUIACCELHIDDEN);
11920     bHideFocus = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFPUIFOCUSHIDDEN);
11921 
11922     <span class="keywordflow">switch</span>(wnd.fnid) {
11923     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a200">FNID_BUTTON</a> :
11924         {
11925             Print(<span class="stringliteral">"FNID_BUTTON"</span>);
11926         }
11927         <span class="keywordflow">goto</span> printCues;
11928     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a205">FNID_LISTBOX</a> :
11929         {
11930             Print(<span class="stringliteral">"FNID_LISTBOX"</span>);
11931         }
11932         <span class="keywordflow">goto</span> printCues;
11933     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a203">FNID_DIALOG</a> :
11934         {
11935             Print(<span class="stringliteral">"FNID_DIALOG"</span>);
11936         }
11937         <span class="keywordflow">goto</span> printCues;
11938     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a207">FNID_STATIC</a> :
11939         {
11940             Print(<span class="stringliteral">"FNID_STATIC"</span>);
11941         }
11942 printCues:
11943         Print(bHideAccel ? <span class="stringliteral">" Hide Accel"</span> : <span class="stringliteral">" Show Accel"</span>);
11944         Print(bHideFocus ? <span class="stringliteral">" Hide Focus"</span> : <span class="stringliteral">" Show Focus"</span>);
11945         <span class="keywordflow">break</span>;
11946 
11947     <span class="keywordflow">default</span>:
11948         Print(<span class="stringliteral">"Not KC interesting FNID 0x%x"</span>, wnd.fnid);
11949         <span class="keywordflow">break</span>;
11950     }
11951     Print(<span class="stringliteral">"\n"</span>);
11952 
11953     pwndParent = wnd.<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>;
11954     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wnd, <a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(wnd.<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a>));
11955     <span class="keywordflow">if</span> (wnd.fnid == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a203">FNID_DIALOG</a>) {
11956         Print(<span class="stringliteral">"The parent is a dialog:\n"</span>);
11957         <a class="code" href="../../d2/d1/userexts_8c.html#a246">Ikc</a>(opts, pwndParent);
11958     } <span class="keywordflow">else</span> {
11959         Print(<span class="stringliteral">"The parent is not a dialog\n"</span>);
11960     }
11961     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
11962 }
11963 <span class="preprocessor">#endif</span>
11964 <span class="preprocessor"></span>
11965 <span class="preprocessor">#ifdef KERNEL</span>
11966 <span class="preprocessor"></span>
11967 <span class="comment">/************************************************************************\</span>
11968 <span class="comment">* Procedure: Idimk -- dump IME Hotkeys</span>
11969 <span class="comment">*</span>
11970 <span class="comment">* 08/09/98 HiroYama     Created</span>
11971 <span class="comment">*</span>
11972 <span class="comment">\************************************************************************/</span>
11973 
11974 <span class="preprocessor">#define IHK_ITEM(x) { x, #x }</span>
11975 <span class="preprocessor"></span>
11976 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Idimk(DWORD opts, PVOID param1)
11977 {
11978     <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> pObj;
11979     <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">IMEHOTKEYOBJ</a> hotkeyObj;
11980     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>{
11981         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> mask;
11982         <span class="keyword">const</span> <span class="keywordtype">char</span>* name;
11983     } masks[] = {
11984         IHK_ITEM(MOD_IGNORE_ALL_MODIFIER),
11985         IHK_ITEM(MOD_ON_KEYUP),
11986         IHK_ITEM(MOD_RIGHT),
11987         IHK_ITEM(MOD_LEFT),
11988         IHK_ITEM(MOD_SHIFT),
11989         IHK_ITEM(MOD_CONTROL),
11990         IHK_ITEM(MOD_ALT),
11991     };
11992     <span class="keywordtype">int</span> nHotKeys = 0;
11993 
11994     UNREFERENCED_PARAMETER(opts);
11995 
11996     <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
<a name="l11997"></a><a class="code" href="../../d2/d1/userexts_8c.html#a237">11997</a>         moveExpValuePtr(&amp;pObj, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpImeHotKeyListHeader));
11998         <span class="keywordflow">if</span> (!pObj) {
11999             Print(<span class="stringliteral">"No IME HotKeys. win32k!gpImeHotKeyListHeader is NULL.\n\n"</span>);
12000             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
12001         }
12002         Print(<span class="stringliteral">"using win32k!gpImeHotKeyListHeader (@0x%p)\n"</span>, pObj);
12003     }
12004     <span class="keywordflow">else</span> {
12005         pObj = (<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
12006     }
12007 
12008     <span class="keywordflow">while</span> (pObj) {
12009         <span class="keywordtype">int</span> i, <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
12010 
12011         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(hotkeyObj, pObj);
12012 
12013         Print(<span class="stringliteral">"ImeHotKeyObj @ 0x%p\n"</span>, pObj);
12014         Print(<span class="stringliteral">"    pNext          0x%p\n"</span>, hotkeyObj.<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a>);
12015 <span class="preprocessor">#if 0</span>
12016 <span class="preprocessor"></span>        Print(<span class="stringliteral">"IMEHOTKEY @ 0x%p\n"</span>, &amp;pObj-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>);
12017 <span class="preprocessor">#endif</span>
12018 <span class="preprocessor"></span>        Print(<span class="stringliteral">"    dwHotKeyID     0x%04x    "</span>, hotkeyObj.<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a>);
12019 
12020         <span class="comment">//</span>
12021         <span class="comment">// Show hotkey ID by name</span>
12022         <span class="comment">//</span>
12023         <span class="keywordflow">if</span> (hotkeyObj.<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a> &gt;= IME_HOTKEY_DSWITCH_FIRST &amp;&amp; hotkeyObj.<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a> &lt;= IME_HOTKEY_DSWITCH_LAST) {
12024             Print(<span class="stringliteral">" Direct Switch to HKL 0x%p"</span>, hotkeyObj.<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o3">hKL</a>);
12025         }
12026         <span class="keywordflow">else</span> {
12027             Print(<span class="stringliteral">" %s"</span>, <a class="code" href="../../d2/d1/userexts_8c.html#a202">GetMaskedEnum</a>(EI_IMEHOTKEYTYPE, hotkeyObj.<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a>, NULL));
12028         }
12029 
12030         <span class="comment">//</span>
12031         <span class="comment">// Show VKey value by name</span>
12032         <span class="comment">//</span>
12033         Print(<span class="stringliteral">"\n    uVKey          0x%02x       %s\n"</span>, hotkeyObj.<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o1">uVKey</a>, <a class="code" href="../../d2/d1/userexts_8c.html#a212">GetVKeyName</a>(hotkeyObj.<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o1">uVKey</a>));
12034 
12035         <span class="comment">//</span>
12036         <span class="comment">// Show bit mask by name</span>
12037         <span class="comment">//</span>
12038         Print(  <span class="stringliteral">"    Modifiers      0x%04x     "</span>, hotkeyObj.<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a>);
12039         <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = 0;
12040         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(masks); ++i) {
12041             <span class="keywordflow">if</span> (masks[i].mask &amp; hotkeyObj.<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a>) {
12042                 Print(<span class="stringliteral">"%s%s"</span>, n ? <span class="stringliteral">" | "</span> : <span class="stringliteral">""</span>, masks[i].name);
12043                 ++<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>;
<a name="l12044"></a><a class="code" href="../../d2/d1/userexts_8c.html#a238">12044</a>             }
12045         }
12046 
12047         <span class="comment">//</span>
12048         <span class="comment">// Target HKL</span>
12049         <span class="comment">//</span>
12050         Print(<span class="stringliteral">"\n    hKL            0x%p\n\n"</span>, hotkeyObj.<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o3">hKL</a>);
12051 
12052         pObj = hotkeyObj.<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a>;
12053 
12054         <span class="comment">//</span>
12055         <span class="comment">// If address is specified as an argument, just display one instance.</span>
12056         <span class="comment">//</span>
12057         <span class="keywordflow">if</span> (param1 != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
12058             <span class="keywordflow">break</span>;
12059         }
12060 
12061         ++nHotKeys;
12062     }
12063     <span class="keywordflow">if</span> (nHotKeys) {
12064         Print(<span class="stringliteral">"Number of IME HotKeys: 0x%04x\n"</span>, nHotKeys);
<a name="l12065"></a><a class="code" href="../../d2/d1/userexts_8c.html#a49">12065</a>     }
12066 
12067     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
<a name="l12068"></a><a class="code" href="../../d2/d1/userexts_8c.html#a50">12068</a> }
12069 
12070 <span class="preprocessor">#undef IHK_ITEM</span>
12071 <span class="preprocessor"></span>
12072 <span class="preprocessor">#endif  // KERNEL</span>
12073 <span class="preprocessor"></span>
12074 <span class="preprocessor">#ifdef KERNEL</span>
12075 <span class="preprocessor"></span><span class="comment">/************************************************************************\</span>
12076 <span class="comment">* Procedure: Igflags</span>
12077 <span class="comment">*</span>
12078 <span class="comment">* Dumps NT Global Flags</span>
12079 <span class="comment">*</span>
12080 <span class="comment">* 08/11/98 Hiroyama     Created</span>
12081 <span class="comment">*</span>
12082 <span class="comment">\************************************************************************/</span>
12083 
12084 <span class="preprocessor">#define DGF_ITEM(x) { x, #x }</span>
12085 <span class="preprocessor"></span>
12086 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Igflags(DWORD opts)
12087 {
12088     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>{
12089         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwFlag;
12090         <span class="keyword">const</span> <span class="keywordtype">char</span>* name;
12091     } names[] = {
12092         DGF_ITEM(FLG_STOP_ON_EXCEPTION),
12093         DGF_ITEM(FLG_SHOW_LDR_SNAPS),
12094         DGF_ITEM(FLG_DEBUG_INITIAL_COMMAND),
12095         DGF_ITEM(FLG_STOP_ON_HUNG_GUI),
12096         DGF_ITEM(FLG_HEAP_ENABLE_TAIL_CHECK),
12097         DGF_ITEM(FLG_HEAP_ENABLE_FREE_CHECK),
12098         DGF_ITEM(FLG_HEAP_VALIDATE_PARAMETERS),
12099         DGF_ITEM(FLG_HEAP_VALIDATE_ALL),
12100         DGF_ITEM(FLG_POOL_ENABLE_TAGGING),
12101         DGF_ITEM(FLG_HEAP_ENABLE_TAGGING),
12102         DGF_ITEM(FLG_USER_STACK_TRACE_DB),
12103         DGF_ITEM(FLG_KERNEL_STACK_TRACE_DB),
12104         DGF_ITEM(FLG_MAINTAIN_OBJECT_TYPELIST),
12105         DGF_ITEM(FLG_HEAP_ENABLE_TAG_BY_DLL),
12106         DGF_ITEM(FLG_ENABLE_CSRDEBUG),
12107         DGF_ITEM(FLG_ENABLE_KDEBUG_SYMBOL_LOAD),
12108         DGF_ITEM(FLG_DISABLE_PAGE_KERNEL_STACKS),
12109         DGF_ITEM(FLG_HEAP_DISABLE_COALESCING),
12110         DGF_ITEM(FLG_ENABLE_CLOSE_EXCEPTIONS),
12111         DGF_ITEM(FLG_ENABLE_EXCEPTION_LOGGING),
12112         DGF_ITEM(FLG_ENABLE_HANDLE_TYPE_TAGGING),
12113         DGF_ITEM(FLG_HEAP_PAGE_ALLOCS),
12114         DGF_ITEM(FLG_DEBUG_INITIAL_COMMAND_EX),
12115         DGF_ITEM(FLG_DISABLE_DBGPRINT),
12116     };
12117     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>;
12118     <span class="keywordtype">int</span> i, <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = 0;
12119 
12120     moveExpValue(&amp;dwFlags, <span class="stringliteral">"NT!NtGlobalFlag"</span>);
12121     <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
12122         Print(<span class="stringliteral">"NT!NtGlobalFlag                         %08lx\n\n"</span>, dwFlags);
12123     }
12124     <span class="keywordflow">else</span> {
12125         Print(<span class="stringliteral">"NT!NtGlobalFlag 0x%lx\n"</span>, dwFlags);
12126     }
12127 
12128     <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp;= FLG_VALID_BITS;
12129 
12130     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(names); ++i) {
12131         BOOLEAN on = (<a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> &amp; names[i].dwFlag) != 0;
12132 
12133         <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
12134             Print(<span class="stringliteral">"  %c%-34s %c(%08x)\n"</span>, on ? <span class="charliteral">'*'</span> : <span class="charliteral">' '</span>, names[i].name, on ? <span class="charliteral">'*'</span> : <span class="charliteral">' '</span>, names[i].dwFlag);
12135         }
12136         <span class="keywordflow">else</span> {
12137             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>++ % 2 == 0) {
12138                 Print(<span class="stringliteral">"\n"</span>);
12139             }
12140             Print(<span class="stringliteral">" %c%-29s "</span>, on ? <span class="charliteral">'*'</span> : <span class="charliteral">' '</span>, names[i].name + <span class="keyword">sizeof</span> <span class="stringliteral">"FLG_"</span> - 1);
12141         }
12142     }
12143     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(v))) {
12144         Print(<span class="stringliteral">"\n"</span>);
12145     }
12146 
12147     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
12148 }
12149 
12150 <span class="preprocessor">#undef DGF_ITEM</span>
12151 <span class="preprocessor"></span>
12152 <span class="preprocessor">#endif  // KERNEL</span>
12153 <span class="preprocessor"></span>
12154 <span class="comment">/************************************************************************\</span>
12155 <span class="comment">* Procedure: Ivkey</span>
12156 <span class="comment">*</span>
12157 <span class="comment">* Dumps virtual keys</span>
12158 <span class="comment">*</span>
12159 <span class="comment">* 08/11/98 Hiroyama     Created</span>
12160 <span class="comment">*</span>
12161 <span class="comment">\************************************************************************/</span>
12162 
12163 <span class="keywordtype">void</span> <a class="code" href="../../d2/d1/userexts_8c.html#a247">PrintVKey</a>(<span class="keywordtype">int</span> i)
12164 {
12165     Print(<span class="stringliteral">"  %02x %s\n"</span>, gVKeyDef[i].dwVKey, gVKeyDef[i].name);
12166 }
12167 
12168 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a248">Ivkey</a>(DWORD opts, LPSTR pszName)
12169 {
12170     <span class="keywordtype">int</span> i;
12171 
12172     <span class="keywordflow">if</span> ((opts &amp; OFLAG(a)) || (opts &amp; OFLAG(o))) {
12173         <span class="comment">//</span>
12174         <span class="comment">// List all virtual keys.</span>
12175         <span class="comment">//</span>
12176         <span class="keywordtype">int</span> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = 0;
12177 
12178         <span class="keywordflow">for</span> (i = 0; i &lt; 0x100; ++i) {
12179             <span class="keyword">const</span> <span class="keywordtype">char</span>* name = <a class="code" href="../../d2/d1/userexts_8c.html#a212">GetVKeyName</a>(i);
12180             <span class="keywordflow">if</span> (*name) {
12181                 <span class="keywordtype">char</span> buf[128];
12182                 <span class="keywordtype">int</span> len;
12183 
12184                 <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(buf, <span class="stringliteral">" %02x %-35s"</span>, i, name);
12185 
12186                 <span class="keywordflow">if</span> (opts &amp; OFLAG(a)) {
12187                     <span class="comment">//</span>
12188                     <span class="comment">// If it exceeds the second column width, begin new line.</span>
12189                     <span class="comment">//</span>
12190                     <span class="keywordflow">if</span> ((len = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(buf)) &gt;= 40 &amp;&amp; <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> % 2 == 1) {
12191                         Print(<span class="stringliteral">"\n"</span>);
12192                         <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = 0;
12193                     }
12194                     Print(buf);
12195                     <span class="comment">//</span>
12196                     <span class="comment">// If it's in the second column, begin new line.</span>
12197                     <span class="comment">//</span>
12198                     <span class="keywordflow">if</span> (++<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> % 2 == 0 || len &gt;= 40) {
12199                         Print(<span class="stringliteral">"\n"</span>);
12200                         <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = 0;
12201                     }
12202                 }
12203                 <span class="keywordflow">else</span> {
12204                     Print(<span class="stringliteral">"%s\n"</span>, buf);
12205                 }
12206             }
12207         }
12208         Print(<span class="stringliteral">"\n"</span>);
12209     }
12210     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*pszName == <span class="charliteral">'V'</span> || *pszName == <span class="charliteral">'v'</span>) {
12211         <span class="comment">//</span>
12212         <span class="comment">// Search by VK name.</span>
12213         <span class="comment">//</span>
12214         <span class="keywordtype">int</span> nFound = 0;
12215         <span class="keywordtype">int</span> len = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(pszName);
12216 
12217         <span class="keywordflow">if</span> (len == 4) {
12218             <span class="keywordtype">int</span> ch = pszName[3];
12219 
12220             <span class="keywordflow">if</span> ((ch &gt;= <span class="charliteral">'A'</span> &amp;&amp; ch &lt;= 'Z') || (ch &gt;= <span class="charliteral">'0'</span> &amp;&amp; ch &lt;= <span class="charliteral">'9'</span>)) {
12221                 Print(<span class="stringliteral">"  %02x %s\n"</span>, ch, pszName);
12222                 ++nFound;
12223             }
12224         }
12225 
12226         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(gVKeyDef); ++i) {
12227             <span class="keywordflow">if</span> (_strnicmp(gVKeyDef[i].name, pszName, len) == 0) {
12228                 Print(<span class="stringliteral">"  %02x %s\n"</span>, gVKeyDef[i].dwVKey, gVKeyDef[i].name);
12229                 ++nFound;
12230             }
12231         }
12232         <span class="keywordflow">if</span> (nFound == 0) {
12233             Print(<span class="stringliteral">"Could not find it.\n"</span>);
12234         }
12235     }
12236     <span class="keywordflow">else</span> {
12237         <span class="comment">//</span>
12238         <span class="comment">// Search by VK value.</span>
12239         <span class="comment">//</span>
12240         <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> status;
12241         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwVKey;
12242         <span class="keyword">const</span> <span class="keywordtype">char</span>* name;
12243 
12244         status = <a class="code" href="../../d2/d1/userexts_8c.html#a215">GetInteger</a>(pszName, 16, &amp;dwVKey, NULL);
12245         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(status)) {
12246             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
12247         }
12248         name = <a class="code" href="../../d2/d1/userexts_8c.html#a212">GetVKeyName</a>(dwVKey);
12249         <span class="keywordflow">if</span> (*name) {
12250             Print(<span class="stringliteral">"  %02x %s\n"</span>, dwVKey, name);
12251         }
12252         <span class="keywordflow">else</span> {
12253             Print(<span class="stringliteral">"Could not find it.\n"</span>);
12254         }
12255     }
12256 
12257     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
12258 }
12259 
12260 <span class="comment">/************************************************************************\</span>
12261 <span class="comment">* Procedure: Idisi</span>
12262 <span class="comment">*</span>
12263 <span class="comment">* Dumps event injection union</span>
12264 <span class="comment">*</span>
12265 <span class="comment">* 09/??/98 Hiroyama     Created</span>
12266 <span class="comment">*</span>
12267 <span class="comment">\************************************************************************/</span>
12268 
12269 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a249">Idisi</a>(DWORD opts, PVOID param1)
12270 {
12271     PINPUT pObj;
12272     INPUT input;
12273 
12274     UNREFERENCED_PARAMETER(opts);
12275 
12276     <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
12277         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
12278     }
12279 
12280     pObj = (PINPUT)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
12281     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(input, pObj);
12282 
12283     Print(<span class="stringliteral">"INPUT @%p - size: 0x%x\n"</span>, pObj, <span class="keyword">sizeof</span> input);
12284 
12285     <span class="keywordflow">switch</span> (input.type) {
12286     <span class="keywordflow">case</span> INPUT_MOUSE:
12287         {
12288             MOUSEINPUT* pmi = &amp;input.mi;
12289 
12290             Print(<span class="stringliteral">"type: Mouse Input(%x)\n"</span>, input.type);
12291             Print(<span class="stringliteral">"     dx          %lx (%ld in dec.)\n"</span>, pmi-&gt;dx, pmi-&gt;dx);
12292             Print(<span class="stringliteral">"     dy          %lx (%ld in dec.)\n"</span>, pmi-&gt;dx, pmi-&gt;dx);
12293             Print(<span class="stringliteral">"     mouseData   %lx (%ld in dec.)\n"</span>, pmi-&gt;mouseData, pmi-&gt;mouseData);
12294             Print(<span class="stringliteral">"     dwFlags     %lx (%s)\n"</span>, pmi-&gt;dwFlags, <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_MI, pmi-&gt;dwFlags, NULL, TRUE));
12295             Print(<span class="stringliteral">"     time        %lx\n"</span>, pmi-&gt;time);
12296             Print(<span class="stringliteral">"     dwExtraInfo %lx\n"</span>, pmi-&gt;dwExtraInfo);
12297         }
12298         <span class="keywordflow">break</span>;
12299 
12300     <span class="keywordflow">case</span> INPUT_KEYBOARD:
12301         {
12302             KEYBDINPUT* pki = &amp;input.ki;
12303             <span class="keyword">const</span> <span class="keywordtype">char</span>* name;
12304 
12305             Print(<span class="stringliteral">"type: Keyboard Input(%x)\n"</span>, input.type);
12306             <span class="comment">//</span>
12307             <span class="comment">// Print Vkey</span>
12308             <span class="comment">//</span>
12309             Print(<span class="stringliteral">"     wVk         %lx"</span>, pki-&gt;wVk);
12310             name = <a class="code" href="../../d2/d1/userexts_8c.html#a212">GetVKeyName</a>(pki-&gt;wVk);
12311             <span class="keywordflow">if</span> (*name) {
12312                 Print(<span class="stringliteral">" (%s)\n"</span>, name);
12313             } <span class="keywordflow">else</span> {
12314                 Print(<span class="stringliteral">"\n"</span>);
12315             }
12316             <span class="comment">//</span>
12317             <span class="comment">// Print scan code: if KEYEVENTF_UNICODE, it's UNICODE value.</span>
12318             <span class="comment">//</span>
12319             <span class="keywordflow">if</span> (pki-&gt;dwFlags &amp; KEYEVENTF_UNICODE) {
12320                 Print(<span class="stringliteral">"     UNICODE     %lx\n"</span>, pki-&gt;wScan);
12321             } <span class="keywordflow">else</span> {
12322                 Print(<span class="stringliteral">"     wScan       %lx\n"</span>, pki-&gt;wScan);
12323             }
12324             <span class="comment">//</span>
12325             <span class="comment">// Print and decrypt dwFlags</span>
12326             <span class="comment">//</span>
12327             Print(<span class="stringliteral">"     dwFlags     %lx (%s)\n"</span>, pki-&gt;dwFlags, <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_KI, pki-&gt;dwFlags, NULL, TRUE));
12328             Print(<span class="stringliteral">"     time        %lx\n"</span>, pki-&gt;time);
12329             Print(<span class="stringliteral">"     dwExtraInfo %lx\n"</span>, pki-&gt;dwExtraInfo);
12330         }
12331         <span class="keywordflow">break</span>;
12332 
12333     <span class="keywordflow">case</span> INPUT_HARDWARE:
12334         Print(<span class="stringliteral">"type: HardwareEvent(%x)\n"</span>, input.type);
12335         Print(<span class="stringliteral">"         uMsg            %lx\n"</span>, input.hi.uMsg);
12336         Print(<span class="stringliteral">"         wParamH:wParamL %x:%x\n"</span>, input.hi.wParamH, input.hi.wParamL);
12337         <span class="keywordflow">break</span>;
12338 
12339     <span class="keywordflow">default</span>:
12340         Print(<span class="stringliteral">"Invalid type information(0x%lx)\n"</span>, input.type);
12341         <span class="keywordflow">break</span>;
12342     }
12343 
12344     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
12345 }
12346 
12347 
12348 <span class="comment">/************************************************************************\</span>
12349 <span class="comment">* Procedure: Iwm</span>
12350 <span class="comment">*</span>
<a name="l12351"></a><a class="code" href="../../d2/d1/userexts_8c.html#a134">12351</a> <span class="comment">* Decrypt window message number</span>
<a name="l12352"></a><a class="code" href="../../d2/d1/userexts_8c.html#a135">12352</a> <span class="comment">*</span>
12353 <span class="comment">* 09/??/98 Hiroyama     Created</span>
12354 <span class="comment">*</span>
12355 <span class="comment">\************************************************************************/</span>
12356 
12357 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a250">Iwm</a>(DWORD opts, LPSTR pszName)
12358 {
12359     <span class="keywordtype">int</span> i;
12360     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> value;
12361 
<a name="l12362"></a><a class="code" href="../../d2/d1/userexts_8c.html#a239">12362</a>     UNREFERENCED_PARAMETER(opts);
12363 
12364     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(a)) &amp;&amp; *pszName == 0) {
12365         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
12366     }
12367 
12368     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d2/d1/userexts_8c.html#a215">GetInteger</a>(pszName, 16, &amp;value, NULL)) || strchr(pszName, <span class="charliteral">'_'</span>)) {
12369         <span class="comment">//</span>
<a name="l12370"></a><a class="code" href="../../d2/d1/userexts_8c.html#a240">12370</a>         <span class="comment">// Search by WM name.</span>
12371         <span class="comment">//</span>
12372         <span class="keywordtype">int</span> nFound = 0;
12373         <span class="keywordtype">int</span> len = <a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(pszName);
12374 
12375         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(gaMsgs); ++i) {
12376             <span class="keywordflow">if</span> (_strnicmp(gaMsgs[i].pszMsg, pszName, len) == 0) {
12377                 Print(<span class="stringliteral">"  %04x %s\n"</span>, gaMsgs[i].msg, gaMsgs[i].pszMsg);
12378                 ++nFound;
12379             }
12380         }
12381         <span class="keywordflow">if</span> (nFound == 0) {
12382             Print(<span class="stringliteral">"Could not find it.\n"</span>);
12383         }
12384     }
12385     <span class="keywordflow">else</span> {
12386         <span class="comment">//</span>
12387         <span class="comment">// Search by WM value.</span>
12388         <span class="comment">//</span>
12389         <span class="keywordtype">int</span> i;
12390 
12391         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(gaMsgs); ++i) {
12392             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a131">gaMsgs</a>[i].msg == value) {
12393                 Print(<span class="stringliteral">"  %04x %s\n"</span>, gaMsgs[i].msg, gaMsgs[i].pszMsg);
12394                 <span class="keywordflow">break</span>;
12395             }
12396         }
12397     }
12398 
12399     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
12400 }
12401 
12402 <span class="comment">//</span>
12403 <span class="comment">// Dump Dialog Template</span>
12404 <span class="comment">//</span>
<a name="l12405"></a><a class="code" href="../../d2/d1/userexts_8c.html#a51">12405</a> <span class="comment">//</span>
12406 
12407 <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> <a class="code" href="../../d2/d1/userexts_8c.html#a251">SkipSz</a>(UTCHAR *lpsz, UTCHAR* lpszCopy, UINT len)
<a name="l12408"></a><a class="code" href="../../d2/d1/userexts_8c.html#a241">12408</a> {
12409     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
12410     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> <a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> = 0;
12411 
12412     lpszCopy[len - 1] = 0;
12413 
12414     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>, lpsz);
12415     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> == 0xFF) {
12416         <span class="keywordflow">if</span> (lpszCopy) {
12417             *lpszCopy = 0;
12418         }
12419         <span class="keywordflow">return</span> (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpsz + 4;
12420     }
12421 
12422     <span class="keywordflow">do</span> {
12423         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>, lpsz);
12424         ++lpsz;
12425         <span class="keywordflow">if</span> (++<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a> &lt; len) {
12426             <span class="keywordflow">if</span> (lpszCopy) {
12427                 *lpszCopy ++ = <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
12428             }
12429         }
12430     } <span class="keywordflow">while</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> != 0);
<a name="l12431"></a><a class="code" href="../../d2/d1/userexts_8c.html#a52">12431</a> 
12432     <span class="keywordflow">return</span> (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpsz;
12433 }
<a name="l12434"></a><a class="code" href="../../d2/d1/userexts_8c.html#a242">12434</a> 
12435 
12436 <span class="preprocessor">#ifndef NextWordBoundary</span>
12437 <span class="preprocessor"></span><span class="preprocessor">#define NextWordBoundary(p)     ((PBYTE)(p) + ((ULONG_PTR)(p) &amp; 1))</span>
12438 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
12439 <span class="preprocessor"></span><span class="preprocessor">#ifndef NextDWordBoundary</span>
12440 <span class="preprocessor"></span><span class="preprocessor">#define NextDWordBoundary(p)    ((PBYTE)(p) + ((ULONG_PTR)(-(LONG_PTR)(p)) &amp; 3))</span>
12441 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
12442 <span class="preprocessor"></span>
12443 <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> <a class="code" href="../../d2/d1/userexts_8c.html#a252">WordSkipSz</a>(UTCHAR *lpsz, UTCHAR* lpszCopy, UINT len)
12444 {
12445     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pb = <a class="code" href="../../d2/d1/userexts_8c.html#a251">SkipSz</a>(lpsz, lpszCopy, len);
12446     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a123">NextWordBoundary</a>(pb);
12447 }
12448 
12449 <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> <a class="code" href="../../d2/d1/userexts_8c.html#a253">DWordSkipSz</a>(UTCHAR *lpsz, UTCHAR* lpszCopy, UINT len)
12450 {
<a name="l12451"></a><a class="code" href="../../d2/d1/userexts_8c.html#a243">12451</a>     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pb = <a class="code" href="../../d2/d1/userexts_8c.html#a251">SkipSz</a>(lpsz, lpszCopy, len);
12452     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a124">NextDWordBoundary</a>(pb);
12453 }
12454 
12455 LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a254">GetCharSetName</a>(BYTE charset)
12456 {
12457     <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/userexts_8c.html#a202">GetMaskedEnum</a>(EI_CHARSETTYPE, charset, NULL);
12458 }
12459 
12460 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d2/d1/userexts_8c.html#a255">ParseDialogFont</a>(LPWORD* lplpstr, LPDLGTEMPLATE2 lpdt)
12461 {
12462     LOGFONT     LogFont;
12463     <span class="keywordtype">short</span>       tmp;
12464     <span class="keywordtype">int</span>         fontheight, fheight;
12465     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">PSERVERINFO</a> <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>;
12466     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fDesktopCharset = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
12467     WORD   dmLogPixels;
12468 
12469 <span class="comment">//</span>
12470 <span class="comment">//  fheight = fontheight = (SHORT)(*((WORD *) *lplpstr)++);</span>
12471 <span class="comment">//</span>
12472     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(tmp, *lplpstr);
12473     ++*lplpstr;
12474     fontheight = fheight = tmp;
12475 
12476     <span class="keywordflow">if</span> (fontheight == 0x7FFF) {
12477         <span class="comment">// a 0x7FFF height is our special code meaning use the message box font</span>
12478         Print(<span class="stringliteral">"\</span>
<a name="l12479"></a><a class="code" href="../../d2/d1/userexts_8c.html#a53">12479</a> <span class="stringliteral">    Font    System Font (Messagebox font)\n"</span>);
12480         <span class="keywordflow">return</span>;
12481     }
12482 
<a name="l12483"></a><a class="code" href="../../d2/d1/userexts_8c.html#a54">12483</a> 
12484     <span class="comment">//</span>
12485     <span class="comment">// The dialog template contains a font description! Use it.</span>
12486     <span class="comment">//</span>
12487     <span class="comment">// Fill the LogFont with default values</span>
12488     RtlZeroMemory(&amp;LogFont, <span class="keyword">sizeof</span>(LOGFONT));
12489 
<a name="l12490"></a><a class="code" href="../../d2/d1/userexts_8c.html#a55">12490</a>     moveExpValue(&amp;gpsi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
12491     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dmLogPixels, &amp;<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dmLogPixels);
12492     LogFont.lfHeight = -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(fontheight, dmLogPixels, 72);
12493 
12494     <span class="keywordflow">if</span> (lpdt-&gt;wDlgVer) {
12495         WORD w;
12496         <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> b;
<a name="l12497"></a><a class="code" href="../../d2/d1/userexts_8c.html#a244">12497</a> <span class="comment">//</span>
12498 <span class="comment">//      LogFont.lfWeight  = *((WORD FAR *) *lplpstr)++;</span>
12499 <span class="comment">//</span>
12500         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(w, *lplpstr);
12501         ++*lplpstr;
12502         LogFont.lfWeight = w;
12503 <span class="comment">//</span>
12504 <span class="comment">//      LogFont.lfItalic  = *((BYTE FAR *) *lplpstr)++;</span>
12505 <span class="comment">//</span>
12506         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(b, *lplpstr);
12507         ++((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>*)*lplpstr);
12508         LogFont.lfItalic = b;
12509 
12510 <span class="comment">//</span>
12511 <span class="comment">//      LogFont.lfCharSet = *((BYTE FAR *) *lplpstr)++;</span>
12512 <span class="comment">//</span>
12513         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(b, *lplpstr);
12514         ++((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>*)*lplpstr);
12515         LogFont.lfCharSet = b;
12516     }
12517     <span class="keywordflow">else</span> {
12518         <span class="comment">// DIALOG statement, which only has a facename.</span>
12519         <span class="comment">// The new applications are not supposed to use DIALOG statement,</span>
12520         <span class="comment">// they should use DIALOGEX instead.</span>
12521         LogFont.lfWeight  = FW_BOLD;
12522         LogFont.lfCharSet = 0;  <span class="comment">//(BYTE)GET_DESKTOP_CHARSET();</span>
12523         fDesktopCharset = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
12524     }
12525 
12526     *lplpstr = (WORD*)<a class="code" href="../../d2/d1/userexts_8c.html#a253">DWordSkipSz</a>(*lplpstr, LogFont.lfFaceName, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(LogFont.lfFaceName));
12527 
12528     Print(<span class="stringliteral">"\</span>
12529 <span class="stringliteral">    Font    %dpt (%d), Weight: %d, %s Italic, %s,\n\</span>
12530 <span class="stringliteral">            \"%ls\"\n"</span>,
12531         fontheight, LogFont.lfHeight,
12532         LogFont.lfWeight,
12533         LogFont.lfItalic ? <span class="stringliteral">""</span> : <span class="stringliteral">"Not"</span>,
12534         fDesktopCharset ? <span class="stringliteral">"DESKTOP_CHARSET"</span> : <a class="code" href="../../d2/d1/userexts_8c.html#a254">GetCharSetName</a>(LogFont.lfCharSet),
12535         LogFont.lfFaceName);
12536 }
12537 
12538 LPCSTR <a class="code" href="../../d2/d1/userexts_8c.html#a256">GetCtrlStyle</a>(WORD iClass, DWORD style)
12539 {
12540     WORD <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d1/userexts_8c.html#a259a164">GF_WS</a>;
12541 
12542     <span class="keywordflow">switch</span> (iClass) {
12543     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a76">ICLS_DIALOG</a>:
12544         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d1/userexts_8c.html#a259a163">GF_DS</a>;
12545         <span class="keywordflow">break</span>;
12546     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a70">ICLS_STATIC</a>:
12547         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d1/userexts_8c.html#a259a168">GF_SS</a>;
12548         <span class="keywordflow">break</span>;
12549     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a69">ICLS_EDIT</a>:
12550         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d1/userexts_8c.html#a259a165">GF_ES</a>;
12551         <span class="keywordflow">break</span>;
12552     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a68">ICLS_BUTTON</a>:
12553         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d1/userexts_8c.html#a259a166">GF_BS</a>;
12554         <span class="keywordflow">break</span>;
12555     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a73">ICLS_COMBOBOX</a>:
<a name="l12556"></a><a class="code" href="../../d2/d1/userexts_8c.html#a56">12556</a>         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d1/userexts_8c.html#a259a167">GF_CBS</a>;
12557         <span class="keywordflow">break</span>;
12558     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a71">ICLS_LISTBOX</a>:
12559         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d1/userexts_8c.html#a259a169">GF_LBS</a>;
12560         <span class="keywordflow">break</span>;
12561     <span class="keywordflow">case</span> <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a72">ICLS_SCROLLBAR</a>:
12562         <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> = <a class="code" href="../../d2/d1/userexts_8c.html#a259a170">GF_SBS</a>;
12563         <span class="keywordflow">break</span>;
12564     <span class="keywordflow">default</span>:
12565         <span class="keywordflow">break</span>;
12566     }
<a name="l12567"></a><a class="code" href="../../d2/d1/userexts_8c.html#a57">12567</a>     <span class="keywordflow">return</span> <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(type, style, NULL, FALSE);
12568 }
12569 
12570 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a257">Iddlgt</a>(DWORD opts, LPVOID param1)
12571 {
12572     LPDLGTEMPLATE lpdt = (LPDLGTEMPLATE)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
12573     DLGTEMPLATE2 <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>;
12574     LPDLGTEMPLATE2 lpdt2 = &amp;<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>;
12575     BOOLEAN fNewDialogTemplate = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
12576     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>* lpszMenu;
12577     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>* lpszClass;
12578     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>* lpszText;
12579     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>* lpStr;
<a name="l12580"></a><a class="code" href="../../d2/d1/userexts_8c.html#a245">12580</a>     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>* lpCreateParams;
12581     LPCSTR  lpszIClassName;
12582     WORD w;
12583     DLGITEMTEMPLATE2    dit;
12584     LPDLGITEMTEMPLATE   lpdit;
12585     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> menuName[64];
12586     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> className[64];
12587     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a5">text</a>[64];
12588     <a class="code" href="../../d2/d6/structtagSERVERINFO.html">PSERVERINFO</a> <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>;
12589 
12590     UNREFERENCED_PARAMETER(opts);
12591 
12592     <span class="keywordflow">if</span> (opts == 0 &amp;&amp; param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
12593         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
12594     }
12595 
12596     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(w, &amp;((LPDLGTEMPLATE2)lpdt)-&gt;wSignature);
12597 
12598     <span class="keywordflow">if</span> (w == 0xffff) {
12599         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dt, lpdt);
12600         fNewDialogTemplate = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
12601     }
12602     <span class="keywordflow">else</span> {
12603         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wDlgVer = 0;
12604         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wSignature = 0;
12605         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwHelpID = 0;
12606         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle, &amp;lpdt-&gt;dwExtendedStyle);
12607         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style, &amp;lpdt-&gt;style);
12608         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cDlgItems, &amp;lpdt-&gt;cdit);
12609         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.x, &amp;lpdt-&gt;x);
12610         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.y, &amp;lpdt-&gt;y);
12611         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx, &amp;lpdt-&gt;cx);
12612         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy, &amp;lpdt-&gt;cy);
12613     }
12614 
12615 
12616     Print(<span class="stringliteral">"DlgTemplate%s @%p version %d\n"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wDlgVer ? <span class="stringliteral">"2"</span> : <span class="stringliteral">""</span>, lpdt, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wDlgVer);
12617 
12618     <span class="keywordflow">if</span> (!(opts &amp; OFLAG(v))) {
12619         Print(<span class="stringliteral">"\</span>
12620 <span class="stringliteral">    (%d, %d)-(%d,%d) [%d, %d](dec)\n\</span>
12621 <span class="stringliteral">    Style   %08lx   ExStyle %08lx   items 0x%x\n"</span>,
12622               <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.x, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.y, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.x + <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.y + <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy,
12623               <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cDlgItems);
12624     }
12625     <span class="keywordflow">else</span> {
12626         Print(<span class="stringliteral">"\</span>
12627 <span class="stringliteral">    (%d,%d)-(%d,%d) [%d,%d] (dec)  item: 0x%lx\n"</span>,
12628               <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.x, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.y, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.x + <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.y + <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy,
12629               <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy,
12630               <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cDlgItems);
12631         Print(<span class="stringliteral">"\</span>
12632 <span class="stringliteral">    Style   %08lx %s"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style, OFLAG(v) ? <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_DS, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style, NULL, FALSE) : <span class="stringliteral">""</span>);
12633         <span class="keywordflow">if</span> ((<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_SHELLFONT) == DS_SHELLFONT) {
12634             Print(<span class="stringliteral">" [DS_SHELLFONT]"</span>);
12635         }
12636         Print(<span class="stringliteral">"\n"</span>);
12637         Print(<span class="stringliteral">"\</span>
12638 <span class="stringliteral">    ExStyle %08lx %s\n"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle, <a class="code" href="../../d7/d4/conexts_8c.html#a22">GetFlags</a>(GF_WSEX, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle, NULL, FALSE));
12639     }
12640 
12641     <span class="comment">// If there's a menu name string, load it.</span>
12642     lpszMenu = (LPWSTR)(((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(lpdt)) + (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wDlgVer ? <span class="keyword">sizeof</span>(DLGTEMPLATE2):<span class="keyword">sizeof</span>(DLGTEMPLATE)));
12643 
12644     <span class="comment">/*</span>
12645 <span class="comment">     * If the menu id is expressed as an ordinal and not a string,</span>
12646 <span class="comment">     * skip all 4 bytes to get to the class string.</span>
12647 <span class="comment">     */</span>
12648     <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(w, (WORD*)lpszMenu);
12649 
12650     <span class="comment">/*</span>
12651 <span class="comment">     * If there's a menu name string, load it.</span>
12652 <span class="comment">     */</span>
12653     <span class="keywordflow">if</span> (w != 0) {
12654         <span class="keywordflow">if</span> (w == 0xffff) {
12655             LPWORD lpwMenu = (LPWORD)((LPBYTE)lpszMenu + 2);
12656             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(w, lpwMenu);
12657             Print(<span class="stringliteral">"\</span>
12658 <span class="stringliteral">    menu id     %lx\n"</span>, w);
12659         }
12660     }
12661 
12662     <span class="keywordflow">if</span> (w == 0xFFFF) {
12663         lpszClass = (LPWSTR)((LPBYTE)lpszMenu + 4);
12664     } <span class="keywordflow">else</span> {
12665         lpszClass = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> *)<a class="code" href="../../d2/d1/userexts_8c.html#a252">WordSkipSz</a>(lpszMenu, menuName, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(menuName));
12666         Print(<span class="stringliteral">"\</span>
12667 <span class="stringliteral">    menu   @%p \"%ls\"\n"</span>, lpszMenu, menuName);
12668     }
12669 
12670     <span class="comment">//</span>
12671     <span class="comment">// Class name</span>
12672     <span class="comment">//</span>
12673     lpszText = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> *)<a class="code" href="../../d2/d1/userexts_8c.html#a252">WordSkipSz</a>(lpszClass, className, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(className));
12674     Print(<span class="stringliteral">"\</span>
12675 <span class="stringliteral">    class  @%p \"%ls\"\n"</span>, lpszClass, className);
12676 
12677     <span class="comment">//</span>
12678     <span class="comment">// Window text</span>
12679     <span class="comment">//</span>
12680     lpStr = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> *)<a class="code" href="../../d2/d1/userexts_8c.html#a252">WordSkipSz</a>(lpszText, text, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(text));
12681     Print(<span class="stringliteral">"\</span>
12682 <span class="stringliteral">    text   @%p \"%ls\"\n"</span>, lpszText, text);
12683 
12684     <span class="comment">//</span>
12685     <span class="comment">// Font</span>
12686     <span class="comment">//</span>
12687     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_SETFONT) {
12688         <a class="code" href="../../d2/d1/userexts_8c.html#a255">ParseDialogFont</a>(&amp;lpStr, &amp;dt);
12689     }
12690 
12691     lpdit = (LPDLGITEMTEMPLATE)<a class="code" href="../../d6/d0/usercli_8h.html#a124">NextDWordBoundary</a>(lpStr);
12692 
12693 
12695     <span class="comment">// if "-r" option is not specified, bail out.</span>
12697 <span class="comment"></span>    <span class="keywordflow">if</span> (!(opts &amp; OFLAG(r))) {
12698         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
12699     }
12700 
12701     Print(<span class="stringliteral">"\n"</span>);
12702 
12703     <span class="comment">/*</span>
12704 <span class="comment">     * Loop through the dialog controls, doing a CreateWindowEx() for each of</span>
12705 <span class="comment">     * them.</span>
12706 <span class="comment">     */</span>
12707     <span class="keywordflow">while</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cDlgItems-- != 0) {
12708         WORD iClass = 0;
12709         <span class="comment">//</span>
12710         <span class="comment">// Retrieve basic information.</span>
12711         <span class="comment">//</span>
12712 
12713         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wDlgVer) {
12714             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dit, lpdit);
12715         } <span class="keywordflow">else</span> {
12716             dit.dwHelpID = 0;
12717             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dit.dwExStyle, &amp;lpdit-&gt;dwExtendedStyle);
12718             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dit.style, &amp;lpdit-&gt;style);
12719             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dit.x, &amp;lpdit-&gt;x);
12720             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dit.y, &amp;lpdit-&gt;y);
12721             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dit.cx, &amp;lpdit-&gt;cx);
12722             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(dit.cy, &amp;lpdit-&gt;cy);
12723             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(w, &amp;lpdit-&gt;id);
12724             dit.dwID = w;
12725         }
12726 
12727         Print(<span class="stringliteral">"\</span>
12728 <span class="stringliteral">#ID:0x%04x @%p HelpID:0x%04x (%d,%d)-(%d,%d) [%d,%d] (dec)\n"</span>,
12729             dit.dwID,
12730             lpdit,
12731             dit.dwHelpID,
12732             dit.x, dit.y, dit.x + dit.cx, dit.y + dit.cy,
12733             dit.cx, dit.cy);
12734 
12735         <span class="comment">//</span>
12736         <span class="comment">// Skip DLGITEMTEMPLATE or DLGITEMTEMPLATE2</span>
12737         <span class="comment">//</span>
12738         lpszClass = (LPWSTR)(((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(lpdit)) + (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wDlgVer ? <span class="keyword">sizeof</span>(DLGITEMTEMPLATE2) : <span class="keyword">sizeof</span>(DLGITEMTEMPLATE)));
12739 
12740         <span class="comment">/*</span>
12741 <span class="comment">         * If the first WORD is 0xFFFF the second word is the encoded class name index.</span>
12742 <span class="comment">         * Use it to look up the class name string.</span>
12743 <span class="comment">         */</span>
12744         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(w, lpszClass);
12745         <span class="keywordflow">if</span> (w == 0xFFFF) {
12746             WORD wAtom;
12747 
12748             lpszText = lpszClass + 2;
12749 <span class="preprocessor">#ifdef ORG</span>
12750 <span class="preprocessor"></span>            lpszClass = (LPWSTR)(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[*(((LPWORD)lpszClass)+1) &amp; ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a59">CODEBIT</a>]);
12751 <span class="preprocessor">#endif</span>
12752 <span class="preprocessor"></span>            moveExpValue(&amp;gpsi, <a class="code" href="../../d2/d1/userexts_8c.html#a5">VAR</a>(gpsi));
12753             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(iClass, lpszClass + 1);
12754             iClass &amp;= ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a59">CODEBIT</a>;
12755             <span class="keywordflow">if</span> (*(lpszIClassName = <a class="code" href="../../d2/d1/userexts_8c.html#a202">GetMaskedEnum</a>(EI_CLSTYPE, iClass, NULL)) == <span class="charliteral">'\0'</span>) {
12756                 lpszIClassName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
12757             }
12758             <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(wAtom, &amp;<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[iClass]);
12759             swprintf(className, L<span class="stringliteral">"#%lx"</span>, wAtom);
12760         } <span class="keywordflow">else</span> {
12761             lpszText = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>*)<a class="code" href="../../d2/d1/userexts_8c.html#a251">SkipSz</a>(lpszClass, className, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(className));
12762             lpszIClassName = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
12763         }
12764 
12765         Print(<span class="stringliteral">"\</span>
12766 <span class="stringliteral">    class  @%p \"%ls\" "</span>, lpszClass, className);
12767         <span class="keywordflow">if</span> (lpszIClassName) {
12768             Print(<span class="stringliteral">"= %s"</span>, lpszIClassName);
12769         }
12770         Print(<span class="stringliteral">"\n"</span>);
12771 
12772         lpszText = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>*)<a class="code" href="../../d6/d0/usercli_8h.html#a123">NextWordBoundary</a>(lpszText); <span class="comment">// UINT align lpszText</span>
12773 
12774 <span class="comment">//      Our code in InternalCreateDialog does this.</span>
12775 <span class="comment">//        dit.dwExStyle |= WS_EX_NOPARENTNOTIFY;</span>
12776 <span class="comment">//</span>
12777         <span class="comment">/*</span>
12778 <span class="comment">         * Get pointer to additional data.  lpszText can point to an encoded</span>
12779 <span class="comment">         * ordinal number for some controls (e.g.  static icon control) so</span>
12780 <span class="comment">         * we check for that here.</span>
12781 <span class="comment">         */</span>
12782 
12783         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(w, lpszText);
12784         <span class="keywordflow">if</span> (w == 0xFFFF) {
12785             swprintf(text, L<span class="stringliteral">"#%lx"</span>, w);
12786             lpCreateParams = (LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpszText + 4);
12787         } <span class="keywordflow">else</span> {
12788             lpCreateParams = (LPWSTR)(<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a252">WordSkipSz</a>(lpszText, text, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(text));
12789         }
12790 
12791         Print(<span class="stringliteral">"\</span>
12792 <span class="stringliteral">    text   @%p \"%ls\"\n"</span>, lpszText, text);
12793 
12794         Print(<span class="stringliteral">"\</span>
12795 <span class="stringliteral">    style   %08lx %s%s"</span>, dit.style,
12796                 (opts &amp; OFLAG(v)) ? <a class="code" href="../../d2/d1/userexts_8c.html#a256">GetCtrlStyle</a>(iClass, dit.style) : <span class="stringliteral">""</span>,
12797                 (opts &amp; OFLAG(v)) ? <span class="stringliteral">"\n"</span> : <span class="stringliteral">""</span>);
12798         Print(<span class="stringliteral">"\</span>
12799 <span class="stringliteral">    ExStyle %08lx %s\n"</span>, dit.dwExStyle, (opts &amp; OFLAG(v)) ? <a class="code" href="../../d2/d1/userexts_8c.html#a191">GetFlags</a>(GF_WSEX, dit.dwExStyle, NULL, FALSE) : <span class="stringliteral">""</span>);
12800 
12801         <span class="comment">/*</span>
12802 <span class="comment">         * Point at next item template</span>
12803 <span class="comment">         */</span>
12804         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(w, lpCreateParams);
12805         lpdit = (LPDLGITEMTEMPLATE)<a class="code" href="../../d6/d0/usercli_8h.html#a124">NextDWordBoundary</a>(
12806                 (LPBYTE)(lpCreateParams + 1) + w);
12807         Print(<span class="stringliteral">"\n"</span>);
12808     }
12809 
12810 
12811     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
12812 }
12813 
12814 <span class="preprocessor">#if !defined(KERNEL)</span>
12815 <span class="preprocessor"></span><a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d1/userexts_8c.html#a258">Idimedpi</a>(DWORD opts, PVOID param1)
12816 {
12817     <a class="code" href="../../d2/d7/structtagIMEDPI.html">IMEDPI</a> ImeDpi;
12818     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi;
12819     <span class="keywordtype">char</span> ach[32];
12820 
12821     UNREFERENCED_PARAMETER(opts);
12822 
12823     <span class="keywordflow">if</span> (param1 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
12824         moveExpValue(&amp;pImeDpi, <span class="stringliteral">"imm32!gpImeDpi"</span>);
12825     }
12826     <span class="keywordflow">else</span> {
12827         pImeDpi = (<a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a6">FIXKP</a>(param1);
12828     }
12829 
12830     <span class="keywordflow">while</span> (pImeDpi) {
12831         <a class="code" href="../../d7/d4/conexts_8c.html#a1">move</a>(ImeDpi, pImeDpi);
12832 
12833         Print(<span class="stringliteral">"IMEDPI @ %08p  hInst: %08p cLock:%3d"</span>, pImeDpi, ImeDpi.<a class="code" href="../../d2/d7/structtagIMEDPI.html#o1">hInst</a>, ImeDpi.<a class="code" href="../../d2/d7/structtagIMEDPI.html#o6">cLock</a>);
12834         Print(<span class="stringliteral">"  CodePage:%4d UI Class: \"%S\"\n"</span>, ImeDpi.<a class="code" href="../../d2/d7/structtagIMEDPI.html#o4">dwCodePage</a>, ImeDpi.<a class="code" href="../../d2/d7/structtagIMEDPI.html#o5">wszUIClass</a>);
12835         <span class="keywordflow">if</span> (opts &amp; OFLAG(i)) {
12836             Print(<span class="stringliteral">" ImeInfo: @ %08p   dwPrivateDataSize: %08x\n"</span>, &amp;pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o3">ImeInfo</a>,
12837                   ImeDpi.<a class="code" href="../../d2/d7/structtagIMEDPI.html#o3">ImeInfo</a>.dwPrivateDataSize);
12838         }
12839 
12840         <span class="keywordflow">if</span> (opts &amp; OFLAG(v)) {
12841             <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(ach, <span class="stringliteral">"IMEDPI %p"</span>, pImeDpi);
12842             <a class="code" href="../../d0/d3/dsocode_8c.html#a10">Idso</a>(0, ach);
12843         }
12844 
12845         Print(<span class="stringliteral">"\n"</span>);
12846 
12847         pImeDpi = ImeDpi.<a class="code" href="../../d2/d7/structtagIMEDPI.html#o0">pNext</a>;
12848     }
12849 
12850     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
12851 }
12852 
12853 <span class="preprocessor">#endif</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:16 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
