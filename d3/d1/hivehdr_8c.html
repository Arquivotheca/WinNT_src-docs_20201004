<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: hivehdr.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>hivehdr.c File Reference</h1><code>#include "<a class="el" href="../../d6/d6/regutil_8h-source.html">regutil.h</a>"</code><br>
<code>#include "<a class="el" href="../../d1/d4/edithive_8h-source.html">edithive.h</a>"</code><br>

<p>
<a href="../../d4/d0/hivehdr_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/hivehdr_8c.html#a0">_ARCCODES_</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/hivehdr_8c.html#a1">DoDump</a> (PUCHAR Filename)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void __cdecl&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/hivehdr_8c.html#a2">main</a> (int argc, char *argv[])</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="hivehdr.c::_ARCCODES_" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define _ARCCODES_          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/hivehdr_8c-source.html#l00024">24</a> of file <a class="el" href="../../d4/d0/hivehdr_8c-source.html">hivehdr.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1" doxytag="hivehdr.c::DoDump" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void DoDump           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PUCHAR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Filename</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/hivehdr_8c-source.html#l00055">55</a> of file <a class="el" href="../../d4/d0/hivehdr_8c-source.html">hivehdr.c</a>.
<p>
References <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00348">_HBASE_BLOCK::CheckSum</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00345">_HBASE_BLOCK::Cluster</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00346">_HBASE_BLOCK::FileName</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00342">_HBASE_BLOCK::Format</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00323">HBASE_BLOCK_SIGNATURE</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00329">HBASE_FORMAT_MEMORY</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00331">HBASE_NAME_ALLOC</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00569">HFILE_TYPE_ALTERNATE</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00570">HFILE_TYPE_LOG</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00572">HFILE_TYPE_MAX</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00568">HFILE_TYPE_PRIMARY</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00129">HSECTOR_SIZE</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00325">HSYS_MAJOR</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00326">HSYS_MINOR</a>, <a class="el" href="../../d0/d1/hivesum_8c-source.html#l00031">HvpHeaderCheckSum()</a>, <a class="el" href="../../d6/d3/rxact_8c-source.html#l00212">INVALID_HANDLE_VALUE</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00344">_HBASE_BLOCK::Length</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00339">_HBASE_BLOCK::Major</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00340">_HBASE_BLOCK::Minor</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d8/ntfsexp_8h.html#a141a69">OPEN_EXISTING</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00343">_HBASE_BLOCK::RootCell</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00336">_HBASE_BLOCK::Sequence1</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00337">_HBASE_BLOCK::Sequence2</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00335">_HBASE_BLOCK::Signature</a>, <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00338">_HBASE_BLOCK::TimeStamp</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d1/d0/hivedata_8h-source.html#l00341">_HBASE_BLOCK::Type</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/hivehdr_8c-source.html#l00035">main()</a>.
<p>
<pre class="fragment"><div>00058 {
00059     HANDLE  infile;
00060     <span class="keyword">static</span> <span class="keywordtype">char</span> buffer[<a class="code" href="../../d0/d1/hivedata_8h.html#a15">HSECTOR_SIZE</a>];
00061     <a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html">PHBASE_BLOCK</a> bbp;
00062     <span class="keywordtype">char</span>   *validstring[] = { <span class="stringliteral">"BAD"</span>, <span class="stringliteral">"OK"</span> };
00063     <span class="keywordtype">int</span>     valid;
00064     <span class="keywordtype">char</span>   *<span class="keyword">typename</span>[] = { <span class="stringliteral">"primary"</span>, <span class="stringliteral">"alternate"</span>, <span class="stringliteral">"log"</span>, <span class="stringliteral">"external"</span>, <span class="stringliteral">"unknown"</span> };
00065     <span class="keywordtype">int</span>     typeselect;
00066     <span class="keywordtype">int</span>     readcount;
00067     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> checksum;
00068     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> i;
00069 
00070     infile = (HANDLE)CreateFile(
00071             Filename,                           <span class="comment">// file name</span>
00072             GENERIC_READ,                       <span class="comment">// desired access</span>
00073             FILE_SHARE_READ | FILE_SHARE_WRITE, <span class="comment">// share mode</span>
00074             NULL,                               <span class="comment">// security attributes</span>
00075             OPEN_EXISTING,                      <span class="comment">// creation disposition</span>
00076             FILE_FLAG_SEQUENTIAL_SCAN,          <span class="comment">// flags and attributes</span>
00077             NULL                                <span class="comment">// template file</span>
00078     );
00079     <span class="keywordflow">if</span> (infile == <a class="code" href="../../d5/d4/rxact_8c.html#a0">INVALID_HANDLE_VALUE</a>) {
00080         fprintf(stderr, <span class="stringliteral">"hivehdr: Could not open '%s'\n"</span>, Filename);
00081         <span class="keywordflow">return</span>;
00082     }
00083 
00084     <span class="keywordflow">if</span> (!ReadFile(infile, buffer, HSECTOR_SIZE, &amp;readcount, NULL)) {
00085         fprintf(
00086             stderr, <span class="stringliteral">"hivehdr: '%s' - cannot read full base block\n"</span>, Filename);
00087         <span class="keywordflow">return</span>;
00088     }
00089     <span class="keywordflow">if</span> (readcount != <a class="code" href="../../d0/d1/hivedata_8h.html#a15">HSECTOR_SIZE</a>) {
00090         fprintf(
00091             stderr, <span class="stringliteral">"hivehdr: '%s' - cannot read full base block\n"</span>, Filename);
00092         <span class="keywordflow">return</span>;
00093     }
00094 
00095     bbp = (<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html">PHBASE_BLOCK</a>)&amp;(buffer[0]);
00096 
00097     <span class="keywordflow">if</span> ((bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o4">Major</a> != 1) || (bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o5">Minor</a> != 1)) {
00098         printf(<span class="stringliteral">"WARNING: Hive file is newer than hivehdr, or is invalid\n"</span>);
00099     }
00100 
00101     printf(<span class="stringliteral">"         File: '%s'\n"</span>, Filename);
00102     printf(<span class="stringliteral">"    BaseBlock:\n"</span>);
00103 
00104     valid = (bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o0">Signature</a> == <a class="code" href="../../d0/d1/hivedata_8h.html#a26">HBASE_BLOCK_SIGNATURE</a>);
00105     printf(<span class="stringliteral">"    Signature: %08lx  '%4.4s'\t\t%s\n"</span>,
00106             bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o0">Signature</a>, (PUCHAR)&amp;(bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o0">Signature</a>), validstring[valid]);
00107 
00108     valid = (bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o1">Sequence1</a> == bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o2">Sequence2</a>);
00109     printf(<span class="stringliteral">" Sequence1//2: %08lx//%08lx\t%s\n"</span>,
00110             bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o1">Sequence1</a>, bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o2">Sequence2</a>, validstring[valid]);
00111 
00112     printf(<span class="stringliteral">"    TimeStamp: %08lx:%08lx\n"</span>,
00113             bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o3">TimeStamp</a>.HighPart, bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o3">TimeStamp</a>.LowPart,
00114             (PUCHAR)&amp;(bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o0">Signature</a>), validstring[valid]);
00115 
00116     valid = (bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o4">Major</a> == <a class="code" href="../../d0/d1/hivedata_8h.html#a27">HSYS_MAJOR</a>);
00117     printf(<span class="stringliteral">"Major Version: %08lx\t\t\t%s\n"</span>,
00118             bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o4">Major</a>, validstring[valid]);
00119 
00120     valid = (bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o5">Minor</a> == <a class="code" href="../../d0/d1/hivedata_8h.html#a28">HSYS_MINOR</a>);
00121     printf(<span class="stringliteral">"Minor Version: %08lx\t\t\t%s\n"</span>,
00122             bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o5">Minor</a>, validstring[valid]);
00123 
00124     valid = ( (bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o6">Type</a> == <a class="code" href="../../d0/d1/hivedata_8h.html#a38">HFILE_TYPE_PRIMARY</a>) ||
00125               (bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o6">Type</a> == <a class="code" href="../../d0/d1/hivedata_8h.html#a39">HFILE_TYPE_ALTERNATE</a>) ||
00126               (bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o6">Type</a> == <a class="code" href="../../d0/d1/hivedata_8h.html#a40">HFILE_TYPE_LOG</a>) );
00127     <span class="keywordflow">if</span> (valid) {
00128         typeselect = bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o6">Type</a>;
00129     } <span class="keywordflow">else</span> {
00130         typeselect = <a class="code" href="../../d0/d1/hivedata_8h.html#a42">HFILE_TYPE_MAX</a>;
00131     }
00132 
00133     printf(<span class="stringliteral">"         Type: %08lx %s\t\t%s\n"</span>,
00134             bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o6">Type</a>, <span class="keyword">typename</span>[typeselect], validstring[valid]);
00135 
00136     valid = (bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o7">Format</a> == <a class="code" href="../../d0/d1/hivedata_8h.html#a29">HBASE_FORMAT_MEMORY</a>);
00137     printf(<span class="stringliteral">"       Format: %08lx\t\t\t%s\n"</span>,
00138             bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o7">Format</a>, validstring[valid]);
00139 
00140     printf(<span class="stringliteral">"     RootCell: %08lx\n"</span>, bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o8">RootCell</a>);
00141 
00142     printf(<span class="stringliteral">"       Length: %08lx\n"</span>, bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o9">Length</a>);
00143 
00144     printf(<span class="stringliteral">"      Cluster: %08lx\n"</span>, bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o10">Cluster</a>);
00145 
00146     checksum = <a class="code" href="../../d9/d1/hivesum_8c.html#a0">HvpHeaderCheckSum</a>(bbp);
00147     valid = (checksum == bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o13">CheckSum</a>);
00148     <span class="keywordflow">if</span> (checksum == bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o13">CheckSum</a>) {
00149         printf(<span class="stringliteral">"     CheckSum: %08lx\t\t\t%s\n"</span>,
00150                 bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o13">CheckSum</a>, validstring[TRUE]);
00151     } <span class="keywordflow">else</span> {
00152         printf(<span class="stringliteral">"     CheckSum: %08lx\t\t\t%s\tCorrect: %08lx\n"</span>,
00153                 bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o13">CheckSum</a>, validstring[FALSE], checksum);
00154     }
00155 
00156     <span class="comment">//</span>
00157     <span class="comment">// print last part of file name, aid to identification</span>
00158     <span class="comment">//</span>
00159     printf(<span class="stringliteral">"Hive/FileName: "</span>);
00160 
00161     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d0/d1/hivedata_8h.html#a30">HBASE_NAME_ALLOC</a>;i+=<span class="keyword">sizeof</span>(WCHAR)) {
00162         printf(<span class="stringliteral">"%wc"</span>, bbp-&gt;<a class="code" href="../../d6/d4/struct__HBASE__BLOCK.html#o11">FileName</a>[i]);
00163     }
00164 
00165 
00166     <span class="keywordflow">return</span>;
00167 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="hivehdr.c::main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void __cdecl main           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/hivehdr_8c-source.html#l00035">35</a> of file <a class="el" href="../../d4/d0/hivehdr_8c-source.html">hivehdr.c</a>.
<p>
References <a class="el" href="../../d4/d0/hivehdr_8c-source.html#l00055">DoDump()</a>, and <a class="el" href="../../d0/d1/fedefs_8h-source.html#l00051">exit</a>.
<p>
<pre class="fragment"><div>00039 {
00040     <span class="keywordtype">int</span> i;
00041 
00042     <span class="keywordflow">if</span> (argc == 1) {
00043         fprintf(stderr, <span class="stringliteral">"Usage: hivehdr filename filename...\n"</span>, argv[0]);
00044         <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(1);
00045     }
00046 
00047     <span class="keywordflow">for</span> (i = 1; i &lt; argc; i++) {
00048         <a class="code" href="../../d3/d1/hivehdr_8c.html#a1">DoDump</a>(argv[i]);
00049     }
00050 
00051     <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>(0);
00052 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:05 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
