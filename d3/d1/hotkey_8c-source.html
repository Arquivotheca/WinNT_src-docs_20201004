<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: hotkey.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>hotkey.c</h1><a href="../../d2/d2/hotkey_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/**************************************************************************\</span>
00002 <span class="comment">* Module Name: hotkey.c (corresponds to Win95 hotkey.c)</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* IME hot key management routines for imm32 dll</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* 03-Jan-1996 wkwok       Created</span>
00010 <span class="comment">\**************************************************************************/</span>
00011 
00012 <span class="preprocessor">#include "<a class="code" href="../../d8/d3/w32_2ntuser_2imm_2precomp_8h.html">precomp.h</a>"</span>
00013 <span class="preprocessor">#pragma hdrstop</span>
00014 <span class="preprocessor"></span>
00015 
00016 
00017 <span class="comment">//</span>
00018 <span class="comment">// internal functions</span>
00019 <span class="comment">//</span>
00020 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a0">CIMENonIMEToggle</a>(HIMC hIMC, HKL hKL, HWND hWnd, LANGID langTarget);
00021 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a1">IMENonIMEToggle</a>( HIMC hIMC, HKL hKL, HWND hWnd, BOOL fIME, LANGID langTarget);
00022 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a2">JCloseOpen</a>( HIMC hIMC, HKL hKL, HWND hWnd);
00023 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a3">CSymbolToggle</a>(HIMC hIMC, HKL hKL, HWND hWnd);
00024 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a4">TShapeToggle</a>(HIMC hIMC, HKL hKL, HWND hWnd);
00025 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a5">KEnglishHangul</a>( HIMC hIMC);
00026 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a6">KShapeToggle</a>( HIMC hIMC);
00027 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a7">KHanjaConvert</a>( HIMC hIMC);
00028 
00029 
00030 <span class="comment">/***************************************************************************\</span>
00031 <span class="comment">* ImmGetHotKey()</span>
00032 <span class="comment">*</span>
00033 <span class="comment">* Private API for IMEs and the control panel. The caller specifies</span>
00034 <span class="comment">* the IME hotkey ID:dwID. If a hotkey is registered with the specified</span>
00035 <span class="comment">* ID, this function returns the modifiers, vkey and hkl of the hotkey.</span>
00036 <span class="comment">*</span>
00037 <span class="comment">* History:</span>
00038 <span class="comment">* 25-Mar-1996 TakaoK       Created</span>
00039 <span class="comment">\***************************************************************************/</span>
<a name="l00040"></a><a class="code" href="../../d2/d2/hotkey_8c.html#a8">00040</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d2/d2/hotkey_8c.html#a8">ImmGetHotKey</a>(
00041     DWORD dwID,
00042     PUINT puModifiers,
00043     PUINT puVKey,
00044     HKL   *phkl)
00045 {
00046     <span class="keywordflow">if</span> (puModifiers == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || puVKey == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00047         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00048     }
00049     <span class="keywordflow">return</span> <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a393">NtUserGetImeHotKey</a>( dwID, puModifiers, puVKey, phkl );
00050 }
00051 
00052 <span class="comment">/**********************************************************************/</span>
00053 <span class="comment">/* ImmSimulateHotKey()                                                */</span>
00054 <span class="comment">/* Return Value:                                                      */</span>
00055 <span class="comment">/*      TRUE - successful, FALSE - failure                            */</span>
00056 <span class="comment">/**********************************************************************/</span>
<a name="l00057"></a><a class="code" href="../../d2/d2/hotkey_8c.html#a9">00057</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> WINAPI <a class="code" href="../../d2/d2/hotkey_8c.html#a9">ImmSimulateHotKey</a>(  <span class="comment">// simulate the functionality of that hot key</span>
00058     HWND  hAppWnd,              <span class="comment">// application window handle</span>
00059     DWORD dwHotKeyID)
00060 {
00061     HIMC hImc;
00062     HKL  hKL;
00063     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fReturn;
00064 
00065     hImc = <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a5">ImmGetContext</a>( hAppWnd );
00066     hKL = <a class="code" href="../../d3/d8/client_8c.html#a154">GetKeyboardLayout</a>( <a class="code" href="../../d3/d8/winmgrc_8c.html#a18">GetWindowThreadProcessId</a>(hAppWnd, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) );
00067     fReturn = <a class="code" href="../../d4/d0/immcli_8h.html#a105">HotKeyIDDispatcher</a>( hAppWnd, hImc, hKL, dwHotKeyID);
00068     <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a7">ImmReleaseContext</a>( hAppWnd, hImc );
00069     <span class="keywordflow">return</span> fReturn;
00070 }
00071 
00072 
00073 <span class="comment">/***************************************************************************\</span>
00074 <span class="comment">* SaveImeHotKey()</span>
00075 <span class="comment">*</span>
00076 <span class="comment">*  Put/Remove the specified IME hotkey entry from the registry</span>
00077 <span class="comment">*</span>
00078 <span class="comment">* History:</span>
00079 <span class="comment">* 25-Mar-1996 TakaoK       Created</span>
00080 <span class="comment">\***************************************************************************/</span>
00081 
00082 <span class="comment">/**********************************************************************/</span>
00083 <span class="comment">/* HotKeyIDDispatcher                                                 */</span>
00084 <span class="comment">/* Return Value:                                                      */</span>
00085 <span class="comment">/*      TRUE - a hot key processed, FALSE - not processed             */</span>
00086 <span class="comment">/**********************************************************************/</span>
<a name="l00087"></a><a class="code" href="../../d4/d0/immcli_8h.html#a105">00087</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d4/d0/immcli_8h.html#a105">HotKeyIDDispatcher</a>( HWND hWnd, HIMC hImc, HKL hKlCurrent, DWORD dwHotKeyID )
00088 {
00089     <span class="comment">/*</span>
00090 <span class="comment">     * Dispatch the IME hotkey event for the specified hImc</span>
00091 <span class="comment">     * only if the calling thread owns the hImc.</span>
00092 <span class="comment">     */</span>
00093     <span class="keywordflow">if</span> (hImc != <a class="code" href="../../d8/d0/immstruc_8h.html#a0">NULL_HIMC</a> &amp;&amp;
00094             <a class="code" href="../../d4/d0/immcli_8h.html#a15">GetInputContextThread</a>(hImc) != GetCurrentThreadId()) {
00095         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00096     }
00097 
00098     <span class="keywordflow">switch</span> ( dwHotKeyID ) {
00099     <span class="keywordflow">case</span> IME_CHOTKEY_IME_NONIME_TOGGLE:
00100         <span class="keywordflow">return</span> <a class="code" href="../../d2/d2/hotkey_8c.html#a0">CIMENonIMEToggle</a>(hImc, hKlCurrent, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, MAKELANGID(LANG_CHINESE, SUBLANG_CHINESE_SIMPLIFIED));
00101 
00102     <span class="keywordflow">case</span> IME_THOTKEY_IME_NONIME_TOGGLE:
00103         <span class="keywordflow">return</span> <a class="code" href="../../d2/d2/hotkey_8c.html#a0">CIMENonIMEToggle</a>(hImc, hKlCurrent, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, MAKELANGID(LANG_CHINESE, SUBLANG_CHINESE_TRADITIONAL));
00104 
00105     <span class="keywordflow">case</span> IME_CHOTKEY_SYMBOL_TOGGLE:
00106     <span class="keywordflow">case</span> IME_THOTKEY_SYMBOL_TOGGLE:
00107         <span class="keywordflow">return</span> <a class="code" href="../../d2/d2/hotkey_8c.html#a3">CSymbolToggle</a>( hImc, hKlCurrent, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>);
00108 
00109     <span class="keywordflow">case</span> IME_JHOTKEY_CLOSE_OPEN:
00110         <span class="keywordflow">return</span> <a class="code" href="../../d2/d2/hotkey_8c.html#a2">JCloseOpen</a>( hImc, hKlCurrent, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>);
00111 
00112     <span class="keywordflow">case</span> IME_KHOTKEY_ENGLISH:           <span class="comment">// VK_HANGUL : English/Hangul mode</span>
00113         <span class="keywordflow">return</span> <a class="code" href="../../d2/d2/hotkey_8c.html#a5">KEnglishHangul</a>( hImc );
00114 
00115     <span class="keywordflow">case</span> IME_KHOTKEY_SHAPE_TOGGLE:      <span class="comment">// VK_JUNJA : full/half width</span>
00116         <span class="keywordflow">return</span> <a class="code" href="../../d2/d2/hotkey_8c.html#a6">KShapeToggle</a>( hImc );
00117 
00118     <span class="keywordflow">case</span> IME_KHOTKEY_HANJACONVERT:      <span class="comment">// VK_HANJA : convert hangul to hanja</span>
00119         <span class="keywordflow">return</span> <a class="code" href="../../d2/d2/hotkey_8c.html#a7">KHanjaConvert</a>( hImc );
00120 
00121     <span class="keywordflow">case</span> IME_CHOTKEY_SHAPE_TOGGLE:
00122     <span class="keywordflow">case</span> IME_THOTKEY_SHAPE_TOGGLE:
00123         <span class="keywordflow">return</span> <a class="code" href="../../d2/d2/hotkey_8c.html#a4">TShapeToggle</a>( hImc, hKlCurrent, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>);
00124 
00125     <span class="keywordflow">default</span>:
00126         <span class="comment">/*</span>
00127 <span class="comment">         * Direct swithing hotkey should have been handled in the kernel side.</span>
00128 <span class="comment">         */</span>
00129         <a class="code" href="../../d4/d0/immcli_8h.html#a2">ImmAssert</a>(dwHotKeyID &lt; IME_HOTKEY_DSWITCH_FIRST || dwHotKeyID &gt; IME_HOTKEY_DSWITCH_LAST);
00130 
00131         <span class="keywordflow">if</span> ( dwHotKeyID &gt;= IME_HOTKEY_PRIVATE_FIRST &amp;&amp;
00132                     dwHotKeyID &lt;= IME_HOTKEY_PRIVATE_LAST ) {
00133 
00134             <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a> pImeDpi;
00135             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    bRet = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00136 
00137             <span class="keywordflow">if</span> ( (pImeDpi = <a class="code" href="../../d9/d0/immuser_8h.html#a45">ImmLockImeDpi</a>(hKlCurrent)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00138 
00139                 bRet = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>)(*pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o8">pfn</a>.<a class="code" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o21">ImeEscape</a>)( hImc,
00140                                                   IME_ESC_PRIVATE_HOTKEY,
00141                                                   (PVOID)&amp;dwHotKeyID );
00142                 <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
00143                 <span class="keywordflow">return</span> bRet;
00144             }
00145         }
00146     }
00147     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00148 }
00149 
00150 <span class="comment">/**********************************************************************/</span>
00151 <span class="comment">/* JCloseOpen()                                                       */</span>
00152 <span class="comment">/* Return Value:                                                      */</span>
00153 <span class="comment">/*      TRUE - a hot key processed, FALSE - not processed             */</span>
00154 <span class="comment">/**********************************************************************/</span>
<a name="l00155"></a><a class="code" href="../../d2/d2/hotkey_8c.html#a2">00155</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a2">JCloseOpen</a>(         <span class="comment">// open/close toggle</span>
00156     HIMC        hIMC,
00157     HKL         hCurrentKL,
00158     HWND        hWnd)
00159 {
00160 
00161     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/layout_8c.html#a20">ImmIsIME</a>(hCurrentKL) &amp;&amp;
00162             LOWORD(HandleToUlong(hCurrentKL)) == MAKELANGID(LANG_JAPANESE, SUBLANG_DEFAULT)) {
00163         <span class="comment">//</span>
00164         <span class="comment">// If current KL is IME and its language is Japanese,</span>
00165         <span class="comment">// we only have to switch the open/close status.</span>
00166         <span class="comment">//</span>
00167         <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a32">ImmSetOpenStatus</a>( hIMC, !<a class="code" href="../../d4/d1/ctxtinfo_8c.html#a31">ImmGetOpenStatus</a>(hIMC) );
00168     } <span class="keywordflow">else</span> {
00169         <span class="comment">//</span>
00170         <span class="comment">// If current KL is not IME or its language is not Japanese,</span>
00171         <span class="comment">// we should find the Japanese IME and set it open.</span>
00172         <span class="comment">//</span>
00173         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d2/hotkey_8c.html#a1">IMENonIMEToggle</a>(hIMC, hCurrentKL, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, MAKELANGID(LANG_JAPANESE, SUBLANG_DEFAULT))) {
00174             <span class="comment">//</span>
00175             <span class="comment">// Mark it so that later we can initialize the fOpen</span>
00176             <span class="comment">// as expected.</span>
00177             <span class="comment">//</span>
00178             PINPUTCONTEXT pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>(hIMC);
00179 
00180             <span class="keywordflow">if</span> (pInputContext) {
00181                 pInputContext-&gt;fdwDirty |= IMSS_INIT_OPEN;
00182                 <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>(hIMC);
00183             }
00184         }
00185     }
00186     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00187 
00188 <span class="preprocessor">#if 0   // for your reference : old code ported from Win95</span>
00189 <span class="preprocessor"></span>    LPINPUTCONTEXT pInputContext;
00190     <a class="code" href="../../d2/d7/structtagIMEDPI.html">PIMEDPI</a>            pImeDpi;
00191 
00192 
00193     <span class="keywordflow">if</span> ( (pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>( hIMC )) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00194     <span class="comment">//</span>
00195     <span class="comment">// The return value is same as Win95.</span>
00196     <span class="comment">// Not happens so often any way.</span>
00197     <span class="comment">//</span>
00198         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00199     }
00200 
00201     pImeDpi = <a class="code" href="../../d9/d0/immuser_8h.html#a45">ImmLockImeDpi</a>( hCurrentKL );
00202     <span class="keywordflow">if</span> ( pImeDpi != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00203     <span class="comment">//</span>
00204     <span class="comment">// update Input Context</span>
00205     <span class="comment">//</span>
00206         pInputContext-&gt;fOpen = !pInputContext-&gt;fOpen;
00207 
00208     <span class="comment">//</span>
00209     <span class="comment">// notify IME</span>
00210     <span class="comment">//</span>
00211         (*pImeDpi-&gt;<a class="code" href="../../d2/d7/structtagIMEDPI.html#o8">pfn</a>.<a class="code" href="../../d3/d7/structtagIMEDPI_1_1__tagImeFunctions.html#o26">NotifyIME</a>)( hIMC,
00212                                    NI_CONTEXTUPDATED,
00213                                    0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>,
00214                                    IMC_SETOPENSTATUS );
00215     <span class="comment">//</span>
00216     <span class="comment">// inform UI</span>
00217     <span class="comment">//</span>
00218         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, WM_IME_NOTIFY, IMN_SETOPENSTATUS, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00219         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, WM_IME_SYSTEM, IMS_SETOPENSTATUS, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00220 
00221         <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>( hIMC );
00222         <a class="code" href="../../d9/d0/immuser_8h.html#a46">ImmUnlockImeDpi</a>(pImeDpi);
00223         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00224 
00225     } <span class="keywordflow">else</span> {
00226 
00227         <span class="keywordflow">if</span> ( !pInputContext-&gt;fOpen ) {
00228             pInputContext-&gt;fOpen = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00229             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, WM_IME_NOTIFY, IMN_SETOPENSTATUS, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00230             <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, WM_IME_SYSTEM, IMS_SETOPENSTATUS, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00231         }
00232         <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>( hIMC );
00233 
00234         <span class="keywordflow">return</span> <a class="code" href="../../d2/d2/hotkey_8c.html#a1">IMENonIMEToggle</a>(hIMC, hCurrentKL, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00235     }
00236 <span class="preprocessor">#endif</span>
00237 <span class="preprocessor"></span>}
00238 
00239 
00240 <span class="comment">/**********************************************************************/</span>
00241 <span class="comment">/* CIMENonIMEToggle()                                                 */</span>
00242 <span class="comment">/* Return Value:                                                      */</span>
00243 <span class="comment">/*      TRUE - a hot key processed, FALSE - not processed             */</span>
00244 <span class="comment">/**********************************************************************/</span>
<a name="l00245"></a><a class="code" href="../../d2/d2/hotkey_8c.html#a0">00245</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a0">CIMENonIMEToggle</a>(   <span class="comment">// non-IME and IME toggle</span>
00246     HIMC        hIMC,
00247     HKL         hKlCurrent,
00248     HWND        hWnd,
00249     LANGID      langId)
00250 {
00251     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00252         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00253 
00254     <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/layout_8c.html#a20">ImmIsIME</a>(hKlCurrent) || LOWORD(HandleToUlong(hKlCurrent)) != langId) {
00255         <span class="comment">//</span>
00256         <span class="comment">// Current keyboard layout is not IME or its language does not match.</span>
00257         <span class="comment">// Let's try to switch to our IME.</span>
00258         <span class="comment">//</span>
00259         <a class="code" href="../../d2/d2/hotkey_8c.html#a1">IMENonIMEToggle</a>(hIMC, hKlCurrent, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, langId);
00260         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00261 
00262     } <span class="keywordflow">else</span> {
00263 
00264         LPINPUTCONTEXT pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>( hIMC );
00265 
00266         <span class="keywordflow">if</span> ( pInputContext == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00267             <span class="comment">//</span>
00268             <span class="comment">// returning TRUE even if we didn't change</span>
00269             <span class="comment">//</span>
00270             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00271         }
00272         <span class="keywordflow">if</span> (!pInputContext-&gt;fOpen) {
00273             <span class="comment">//</span>
00274             <span class="comment">// toggle close to open</span>
00275             <span class="comment">//</span>
00276             <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a32">ImmSetOpenStatus</a>(hIMC, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00277             <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>(hIMC);
00278             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00279         } <span class="keywordflow">else</span> {
00280             <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>(hIMC);
00281             <a class="code" href="../../d2/d2/hotkey_8c.html#a1">IMENonIMEToggle</a>(hIMC, hKlCurrent, <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, 0);
00282             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00283         }
00284     }
00285 }
00286 
00287 <span class="comment">/**********************************************************************/</span>
00288 <span class="comment">/* IMENonIMEToggle()                                                  */</span>
00289 <span class="comment">/* Return Value:                                                      */</span>
00290 <span class="comment">/*      TRUE - a hot key processed, FALSE - not processed             */</span>
00291 <span class="comment">/**********************************************************************/</span>
<a name="l00292"></a><a class="code" href="../../d2/d2/hotkey_8c.html#a1">00292</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a1">IMENonIMEToggle</a>(
00293     HIMC        hIMC,
00294     HKL         hCurrentKL,
00295     HWND        hWnd,
00296     BOOL        fCurrentIsIME,
00297     LANGID      langTarget)
00298 {
00299     HKL  hEnumKL[32], hTargetKL;
00300     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> nLayouts, i;
00301     HKL hPrevKL;
00302 
00303     UNREFERENCED_PARAMETER(hIMC);
00304 
00305     hPrevKL = (HKL)<a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a287">NtUserGetThreadState</a>( UserThreadStatePreviousKeyboardLayout );
00306 
00307     <span class="comment">//</span>
00308     <span class="comment">// If we find the same layout in the layout list, let's switch to</span>
00309     <span class="comment">// the layout. If we fail, let's switch to a first-found good</span>
00310     <span class="comment">// layout.</span>
00311     <span class="comment">//</span>
00312 
00313     hTargetKL = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00314     nLayouts = GetKeyboardLayoutList(<span class="keyword">sizeof</span>(hEnumKL)/<span class="keyword">sizeof</span>(HKL), hEnumKL);
00315 
00316     <span class="comment">// LATER:</span>
00317     <span class="comment">// Hmm, looks like we can't simply rely on hPrevKL on multiple lanugage</span>
00318     <span class="comment">// environment..</span>
00319     <span class="comment">//</span>
00320     <span class="keywordflow">if</span> (hPrevKL != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00321         <span class="keywordflow">if</span> (langTarget == 0 || LOWORD(HandleToUlong(hPrevKL)) == langTarget) {
00322             <span class="comment">//</span>
00323             <span class="comment">// If langtarget is not specified, or</span>
00324             <span class="comment">// if it matches the previous langauge.</span>
00325             <span class="comment">//</span>
00326             <span class="keywordflow">for</span> (i = 0; i &lt; nLayouts; i++) {
00327                 <span class="comment">// valid target HKL</span>
00328                 <span class="keywordflow">if</span> (hEnumKL[i] == hPrevKL) {
00329                     hTargetKL = hPrevKL;
00330                     <span class="keywordflow">break</span>;
00331                 }
00332             }
00333         }
00334     }
00335     <span class="keywordflow">if</span> (hTargetKL == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00336         <span class="keywordflow">for</span> (i = 0; i &lt; nLayouts; i++) {
00337             <span class="comment">// find a valid target HKL</span>
00338             <span class="keywordflow">if</span> (fCurrentIsIME ^ <a class="code" href="../../d4/d1/layout_8c.html#a20">ImmIsIME</a>(hEnumKL[i])) {
00339                 <span class="keywordflow">if</span> (langTarget != 0 &amp;&amp; LOWORD(HandleToUlong(hEnumKL[i])) != langTarget) {
00340                     <span class="comment">// If the target language is specified, check it</span>
00341                     <span class="keywordflow">continue</span>;
00342                 }
00343                 hTargetKL = hEnumKL[i];
00344                 <span class="keywordflow">break</span>;
00345             }
00346         }
00347     }
00348     <span class="keywordflow">if</span> (hTargetKL != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; hCurrentKL != hTargetKL) {
00349 
00350         <span class="comment">// depends on multilingual message and how to get the base charset</span>
00351         <span class="comment">// wait for confirmation of multiingual spec - tmp solution</span>
00352         <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, WM_INPUTLANGCHANGEREQUEST, DEFAULT_CHARSET, (LPARAM)hTargetKL);
00353     }
00354     <span class="comment">//</span>
00355     <span class="comment">// returning TRUE, even if we failed to switch</span>
00356     <span class="comment">//</span>
00357     <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/layout_8c.html#a20">ImmIsIME</a>(hTargetKL);
00358 }
00359 
00360 <span class="comment">/**********************************************************************/</span>
00361 <span class="comment">/* CSymbolToggle()                                                    */</span>
00362 <span class="comment">/* Return Value:                                                      */</span>
00363 <span class="comment">/*      TRUE - a hot key processed, FALSE - not processed             */</span>
00364 <span class="comment">/**********************************************************************/</span>
<a name="l00365"></a><a class="code" href="../../d2/d2/hotkey_8c.html#a3">00365</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a3">CSymbolToggle</a>(              <span class="comment">// symbol &amp; non symbol toggle</span>
00366     HIMC        hIMC,
00367     HKL         hKL,
00368     HWND        hWnd)
00369 {
00370     LPINPUTCONTEXT pInputContext;
00371 
00372     <span class="comment">//</span>
00373     <span class="comment">// Return TRUE even no layout switching - Win95 behavior</span>
00374     <span class="comment">//</span>
00375     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00376         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00377 
00378     <span class="keywordflow">if</span> ( ! <a class="code" href="../../d4/d1/layout_8c.html#a20">ImmIsIME</a>( hKL ) ) {
00379         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00380     }
00381 
00382     <span class="keywordflow">if</span> ( (pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>( hIMC )) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00383         <span class="comment">//</span>
00384         <span class="comment">// The return value is same as Win95.</span>
00385         <span class="comment">// Not happens so often any way.</span>
00386         <span class="comment">//</span>
00387         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00388     }
00389 
00390     <span class="keywordflow">if</span> (pInputContext-&gt;fOpen) {
00391         <span class="comment">//</span>
00392         <span class="comment">// toggle the symbol mode</span>
00393         <span class="comment">//</span>
00394         <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a30">ImmSetConversionStatus</a>(hIMC,
00395                                pInputContext-&gt;fdwConversion ^ IME_CMODE_SYMBOL,
00396                                pInputContext-&gt;fdwSentence);
00397     }
00398     <span class="keywordflow">else</span> {
00399         <span class="comment">//</span>
00400         <span class="comment">// change close -&gt; open</span>
00401         <span class="comment">//</span>
00402         <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a32">ImmSetOpenStatus</a>(hIMC, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00403     }
00404 
00405     <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>(hIMC);
00406     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00407 
00408 }
00409 
00410 <span class="comment">/**********************************************************************/</span>
00411 <span class="comment">/* TShapeToggle()                                                     */</span>
00412 <span class="comment">/* Return Value:                                                      */</span>
00413 <span class="comment">/*      TRUE - a hot key processed, FALSE - not processed             */</span>
00414 <span class="comment">/**********************************************************************/</span>
<a name="l00415"></a><a class="code" href="../../d2/d2/hotkey_8c.html#a4">00415</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a4">TShapeToggle</a>(               <span class="comment">// fullshape &amp; halfshape toggle</span>
00416     HIMC        hIMC,
00417     HKL         hKL,
00418     HWND        hWnd)
00419 {
00420     LPINPUTCONTEXT pInputContext;
00421 
00422     <span class="comment">//</span>
00423     <span class="comment">// Return TRUE even no layout switching - Win95 behavior</span>
00424     <span class="comment">//</span>
00425     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00426         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00427 
00428     <span class="keywordflow">if</span> ( ! <a class="code" href="../../d4/d1/layout_8c.html#a20">ImmIsIME</a>( hKL ) ) {
00429         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00430     }
00431 
00432     <span class="keywordflow">if</span> ( (pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>( hIMC )) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00433         <span class="comment">//</span>
00434         <span class="comment">// The return value is same as Win95.</span>
00435         <span class="comment">// Not happens so often any way.</span>
00436         <span class="comment">//</span>
00437         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00438     }
00439 
00440     <span class="keywordflow">if</span> (pInputContext-&gt;fOpen) {
00441         <span class="comment">//</span>
00442         <span class="comment">// toggle the symbol mode</span>
00443         <span class="comment">//</span>
00444         <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a30">ImmSetConversionStatus</a>(hIMC,
00445                                pInputContext-&gt;fdwConversion ^ IME_CMODE_FULLSHAPE,
00446                                pInputContext-&gt;fdwSentence);
00447     }
00448     <span class="keywordflow">else</span> {
00449         <span class="comment">//</span>
00450         <span class="comment">// change close -&gt; open</span>
00451         <span class="comment">//</span>
00452         <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a32">ImmSetOpenStatus</a>(hIMC, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00453     }
00454 
00455     <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>(hIMC);
00456     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00457 }
00458 
00459 <span class="comment">/**********************************************************************/</span>
00460 <span class="comment">/* KEnglishHangul() - Egnlish &amp; Hangeul toggle                       */</span>
00461 <span class="comment">/* Return Value:                                                      */</span>
00462 <span class="comment">/*      TRUE - a hot key processed, FALSE - not processed             */</span>
00463 <span class="comment">/**********************************************************************/</span>
<a name="l00464"></a><a class="code" href="../../d2/d2/hotkey_8c.html#a5">00464</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a5">KEnglishHangul</a>( HIMC hImc )
00465 {
00466     PINPUTCONTEXT pInputContext;
00467 
00468     <span class="keywordflow">if</span> ((pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>(hImc)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00469 
00470         <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a30">ImmSetConversionStatus</a>(hImc,
00471                 pInputContext-&gt;fdwConversion ^ IME_CMODE_HANGEUL,
00472                 pInputContext-&gt;fdwSentence);
00473 
00474         <span class="keywordflow">if</span> ((pInputContext-&gt;fdwConversion &amp; IME_CMODE_HANGEUL) ||
00475                 (pInputContext-&gt;fdwConversion &amp; IME_CMODE_FULLSHAPE)) {
00476             <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a32">ImmSetOpenStatus</a>(hImc, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00477         } <span class="keywordflow">else</span> {
00478             <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a32">ImmSetOpenStatus</a>(hImc, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00479         }
00480         <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>(hImc);
00481         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00482     }
00483 
00484     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00485 }
00486 
00487 <span class="comment">/**********************************************************************/</span>
00488 <span class="comment">/* KShapeToggle() - Fullshape &amp; Halfshape toggle                      */</span>
00489 <span class="comment">/* Return Value:                                                      */</span>
00490 <span class="comment">/*      TRUE - a hot key processed, FALSE - not processed             */</span>
00491 <span class="comment">/**********************************************************************/</span>
<a name="l00492"></a><a class="code" href="../../d2/d2/hotkey_8c.html#a6">00492</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a6">KShapeToggle</a>( HIMC hImc )
00493 {
00494     PINPUTCONTEXT pInputContext;
00495 
00496     <span class="keywordflow">if</span> ( (pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>( hImc )) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00497 
00498         <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a30">ImmSetConversionStatus</a>(hImc,
00499             pInputContext-&gt;fdwConversion ^ IME_CMODE_FULLSHAPE,
00500             pInputContext-&gt;fdwSentence);
00501 
00502         <span class="keywordflow">if</span> ((pInputContext-&gt;fdwConversion &amp; IME_CMODE_HANGEUL)
00503                 || (pInputContext-&gt;fdwConversion &amp; IME_CMODE_FULLSHAPE))
00504             <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a32">ImmSetOpenStatus</a>(hImc, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00505         <span class="keywordflow">else</span>
00506             <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a32">ImmSetOpenStatus</a>(hImc, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00507         <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>(hImc);
00508         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00509     }
00510 
00511     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00512 }
00513 
00514 <span class="comment">/**********************************************************************/</span>
00515 <span class="comment">/* KHanjaConvert() - Hanja conversion toggle                          */</span>
00516 <span class="comment">/* Return Value:                                                      */</span>
00517 <span class="comment">/*      TRUE - a hot key processed, FALSE - not processed             */</span>
00518 <span class="comment">/**********************************************************************/</span>
<a name="l00519"></a><a class="code" href="../../d2/d2/hotkey_8c.html#a7">00519</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d2/d2/hotkey_8c.html#a7">KHanjaConvert</a>( HIMC hImc )
00520 {
00521     PINPUTCONTEXT pInputContext;
00522 
00523     <span class="keywordflow">if</span> ( (pInputContext = <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a12">ImmLockIMC</a>( hImc )) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00524 
00525         <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a30">ImmSetConversionStatus</a>( hImc,
00526                                 pInputContext-&gt;fdwConversion ^ IME_CMODE_HANJACONVERT,
00527                                 pInputContext-&gt;fdwSentence );
00528 
00529         <a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a13">ImmUnlockIMC</a>( hImc );
00530         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00531     }
00532     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00533 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:18 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
