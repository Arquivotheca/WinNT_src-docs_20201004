<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: drawscrn.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>drawscrn.c</h1><a href="../../d2/d2/drawscrn_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1992  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    drawscrn.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This is the console fullscreen driver for the VGA card.</span>
00012 <span class="comment"></span>
00013 <span class="comment">Environment:</span>
00014 <span class="comment"></span>
00015 <span class="comment">    kernel mode only</span>
00016 <span class="comment"></span>
00017 <span class="comment">Notes:</span>
00018 <span class="comment"></span>
00019 <span class="comment">Revision History:</span>
00020 <span class="comment"></span>
00021 <span class="comment">--*/</span>
00022 
00023 <span class="preprocessor">#include "stdarg.h"</span>
00024 <span class="preprocessor">#include "stdio.h"</span>
00025 <span class="preprocessor">#include "ntddk.h"</span>
00026 <span class="preprocessor">#include "<a class="code" href="../../d7/d8/fsvga_8h.html">fsvga.h</a>"</span>
00027 <span class="preprocessor">#include "fsvgalog.h"</span>
00028 
<a name="l00029"></a><a class="code" href="../../d2/d2/drawscrn_8c.html#a0">00029</a> <span class="preprocessor">#define COMMON_LVB_MASK (COMMON_LVB_GRID_HORIZONTAL |  \</span>
00030 <span class="preprocessor">                         COMMON_LVB_GRID_LVERTICAL  |  \</span>
00031 <span class="preprocessor">                         COMMON_LVB_GRID_RVERTICAL  |  \</span>
00032 <span class="preprocessor">                         COMMON_LVB_REVERSE_VIDEO   |  \</span>
00033 <span class="preprocessor">                         COMMON_LVB_UNDERSCORE      )</span>
00034 <span class="preprocessor"></span>
00035 <span class="comment">/* ----- Macros -----*/</span>
00036 <span class="comment">/*++</span>
00037 <span class="comment">    Macro Description:</span>
00038 <span class="comment">        This Macro calcurate a scan line in graphics buffer.</span>
00039 <span class="comment"></span>
00040 <span class="comment">    Arguments:</span>
00041 <span class="comment">        WindowY        - Coord to Y.</span>
00042 <span class="comment">        FontSizeY      - Font size of Y.</span>
00043 <span class="comment"></span>
00044 <span class="comment">    Return Value:</span>
00045 <span class="comment">        Returen to graphics buffer offset.</span>
00046 <span class="comment">--*/</span>
<a name="l00047"></a><a class="code" href="../../d2/d2/drawscrn_8c.html#a1">00047</a> <span class="preprocessor">#define CalcGRAMScanLine(WindowY,FontSizeY) \</span>
00048 <span class="preprocessor">    (WindowY * FontSizeY)</span>
00049 <span class="preprocessor"></span>
00050 <span class="comment">/*++</span>
00051 <span class="comment">    Macro Description:</span>
00052 <span class="comment">        This Macro calcurate a graphics buffer offset.</span>
00053 <span class="comment"></span>
00054 <span class="comment">    Arguments:</span>
00055 <span class="comment">        WindowSize - Coord of window size.</span>
00056 <span class="comment">        DeviceExtension - Pointer to the miniport driver's device extension.</span>
00057 <span class="comment"></span>
00058 <span class="comment">    Return Value:</span>
00059 <span class="comment">        Returen to graphics buffer offset.</span>
00060 <span class="comment">--*/</span>
<a name="l00061"></a><a class="code" href="../../d2/d2/drawscrn_8c.html#a2">00061</a> <span class="preprocessor">#define CalcGRAMOffs(WindowSize,DeviceExtension) \</span>
00062 <span class="preprocessor">    (DeviceExtension-&gt;EmulateInfo.StartAddress + \</span>
00063 <span class="preprocessor">     CalcGRAMSize(WindowSize,DeviceExtension) \</span>
00064 <span class="preprocessor">    )</span>
00065 <span class="preprocessor"></span>
00066 <span class="comment">/*++</span>
00067 <span class="comment">    Macro Description:</span>
00068 <span class="comment">        This Macro gets the byte per one scan line.</span>
00069 <span class="comment"></span>
00070 <span class="comment">    Arguments:</span>
00071 <span class="comment">        EmulateInfo - Pointer to screen emualte information structure.</span>
00072 <span class="comment"></span>
00073 <span class="comment">    Return Value:</span>
00074 <span class="comment">        Byte pre line number.</span>
00075 <span class="comment">--*/</span>
<a name="l00076"></a><a class="code" href="../../d2/d2/drawscrn_8c.html#a3">00076</a> <span class="preprocessor">#define GetBytePerLine(DeviceExtension) \</span>
00077 <span class="preprocessor">    ((DeviceExtension-&gt;Configuration.HardwareScroll &amp; OFFSET_128_TO_NEXT_SLICE) ? \</span>
00078 <span class="preprocessor">     (1024 / 8) : \</span>
00079 <span class="preprocessor">     (640 / 8) \</span>
00080 <span class="preprocessor">    )</span>
00081 <span class="preprocessor"></span>
00082 
00083 
00084 ULONG
<a name="l00085"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a38">00085</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a38">CalcGRAMSize</a>(
00086     IN COORD WindowSize,
00087     IN <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension
00088     )
00089 
00090 <span class="comment">/*++</span>
00091 <span class="comment"></span>
00092 <span class="comment">Routine Description:</span>
00093 <span class="comment"></span>
00094 <span class="comment">    This Macro calcurate a graphics buffer size.</span>
00095 <span class="comment"></span>
00096 <span class="comment">Arguments:</span>
00097 <span class="comment"></span>
00098 <span class="comment">    WindowSize - Coord of window size.</span>
00099 <span class="comment"></span>
00100 <span class="comment">    DeviceExtension - Pointer to the miniport driver's device extension.</span>
00101 <span class="comment"></span>
00102 <span class="comment">Return Value:</span>
00103 <span class="comment"></span>
00104 <span class="comment">    Returen to graphics buffer offset.</span>
00105 <span class="comment"></span>
00106 <span class="comment">--*/</span>
00107 
00108 {
00109     <span class="keywordflow">return</span> WindowSize.X +
00110            <a class="code" href="../../d2/d2/drawscrn_8c.html#a1">CalcGRAMScanLine</a>(WindowSize.Y, DeviceExtension-&gt;ScreenAndFont.FontSize.Y) *
00111            DeviceExtension-&gt;EmulateInfo.BytePerLine;
00112 }
00113 
00114 
00115 PUCHAR
<a name="l00116"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a39">00116</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a39">CalcGRAMAddress</a>(
00117     IN COORD WindowSize,
00118     IN <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension
00119     )
00120 
00121 <span class="comment">/*++</span>
00122 <span class="comment"></span>
00123 <span class="comment">Routine Description:</span>
00124 <span class="comment"></span>
00125 <span class="comment">    This routine calcurate a graphics buffer address.</span>
00126 <span class="comment"></span>
00127 <span class="comment">Arguments:</span>
00128 <span class="comment"></span>
00129 <span class="comment">    WindowSize - Coord of window size.</span>
00130 <span class="comment"></span>
00131 <span class="comment">    DeviceExtension - Pointer to the miniport driver's device extension.</span>
00132 <span class="comment"></span>
00133 <span class="comment">Return Value:</span>
00134 <span class="comment"></span>
00135 <span class="comment">    Returen to graphics buffer address.</span>
00136 <span class="comment"></span>
00137 <span class="comment">--*/</span>
00138 {
00139     PUCHAR BufPtr = (PUCHAR)DeviceExtension-&gt;CurrentMode.VideoMemory.FrameBufferBase;
00140 
00141     BufPtr += <a class="code" href="../../d2/d2/drawscrn_8c.html#a2">CalcGRAMOffs</a>(WindowSize, DeviceExtension);
00142     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(BufPtr -
00143                 (PUCHAR)DeviceExtension-&gt;CurrentMode.VideoMemory.FrameBufferBase)
00144            &gt;= DeviceExtension-&gt;EmulateInfo.LimitGRAM)
00145         <span class="keywordflow">return</span> (BufPtr - DeviceExtension-&gt;EmulateInfo.LimitGRAM);
00146     <span class="keywordflow">else</span>
00147         <span class="keywordflow">return</span> BufPtr;
00148 }
00149 
00150 
00151 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00152"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a40">00152</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a40">IsGRAMRowOver</a>(
00153     PUCHAR BufPtr,
00154     BOOL fDbcs,
00155     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension
00156     )
00157 
00158 <span class="comment">/*++</span>
00159 <span class="comment"></span>
00160 <span class="comment">Routine Description:</span>
00161 <span class="comment"></span>
00162 <span class="comment">    This Routine check ROW overflow as GRAM limit line.</span>
00163 <span class="comment"></span>
00164 <span class="comment">Arguments:</span>
00165 <span class="comment"></span>
00166 <span class="comment">    BufPtr - Pointer to graphics buffer.</span>
00167 <span class="comment"></span>
00168 <span class="comment">    fDbcs - Flag of DBCS(true) or SBCS(false).</span>
00169 <span class="comment"></span>
00170 <span class="comment">Return Value:</span>
00171 <span class="comment">    TRUE:  if font box is overflow as GRAMlimit line.</span>
00172 <span class="comment">    FALSE: not overflow.</span>
00173 <span class="comment"></span>
00174 <span class="comment">--*/</span>
00175 
00176 {
00177     <span class="keywordflow">if</span> (fDbcs)
00178     {
00179         <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(BufPtr + 1 +
00180                     DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o6">DeltaNextFontRow</a> -
00181                     (PUCHAR)DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o50">CurrentMode</a>.VideoMemory.FrameBufferBase)
00182              &gt;= DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o5">LimitGRAM</a>)
00183             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00184         <span class="keywordflow">else</span>
00185             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00186     }
00187     <span class="keywordflow">else</span>
00188     {
00189         <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(BufPtr +
00190                     DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o6">DeltaNextFontRow</a> -
00191                     (PUCHAR)DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o50">CurrentMode</a>.VideoMemory.FrameBufferBase)
00192              &gt;= DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o5">LimitGRAM</a>)
00193             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00194         <span class="keywordflow">else</span>
00195             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00196     }
00197 }
00198 
00199 PUCHAR
<a name="l00200"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a41">00200</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a41">NextGRAMRow</a>(
00201     PUCHAR BufPtr,
00202     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension
00203     )
00204 
00205 <span class="comment">/*++</span>
00206 <span class="comment"></span>
00207 <span class="comment">Routine Description:</span>
00208 <span class="comment">    This Routine add next row a graphics buffer address.</span>
00209 <span class="comment"></span>
00210 <span class="comment">Arguments:</span>
00211 <span class="comment"></span>
00212 <span class="comment">    BufPtr - Pointer to graphics buffer.</span>
00213 <span class="comment"></span>
00214 <span class="comment">Return Value:</span>
00215 <span class="comment"></span>
00216 <span class="comment">    Returen to graphics buffer address.</span>
00217 <span class="comment"></span>
00218 <span class="comment">--*/</span>
00219 
00220 {
00221     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(BufPtr +
00222                 DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o3">BytePerLine</a> -
00223                 (PUCHAR)DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o50">CurrentMode</a>.VideoMemory.FrameBufferBase)
00224            &gt;= DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o5">LimitGRAM</a>)
00225         <span class="keywordflow">return</span> (BufPtr +
00226                 DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o3">BytePerLine</a> -
00227                 DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o5">LimitGRAM</a>);
00228     <span class="keywordflow">else</span>
00229         <span class="keywordflow">return</span> (BufPtr + DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o3">BytePerLine</a>);
00230 }
00231 
00232 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00233"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a42">00233</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a42">memcpyGRAM</a>(
00234     IN PCHAR TargetPtr,
00235     IN PCHAR SourcePtr,
00236     IN ULONG Length
00237     )
00238 
00239 <span class="comment">/*++</span>
00240 <span class="comment"></span>
00241 <span class="comment">Routine Description:</span>
00242 <span class="comment"></span>
00243 <span class="comment">    This routine is a memory copy for byte order.</span>
00244 <span class="comment"></span>
00245 <span class="comment">Arguments:</span>
00246 <span class="comment"></span>
00247 <span class="comment">    TargetPtr - Pointer to target graphics buffer.</span>
00248 <span class="comment"></span>
00249 <span class="comment">    SourcePtr - Pointer to source graphics buffer.</span>
00250 <span class="comment"></span>
00251 <span class="comment">    Length - Fill length.</span>
00252 <span class="comment"></span>
00253 <span class="comment">Return Value:</span>
00254 <span class="comment"></span>
00255 <span class="comment">--*/</span>
00256 
00257 {
00258     <span class="keywordflow">while</span> (Length--)
00259         *TargetPtr++ = *SourcePtr++;
00260 }
00261 
00262 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00263"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a43">00263</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a43">memcpyGRAMOver</a>(
00264     IN PCHAR TargetPtr,
00265     IN PCHAR SourcePtr,
00266     IN ULONG Length,
00267     IN PUCHAR FrameBufPtr,
00268     IN <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension
00269     )
00270 
00271 <span class="comment">/*++</span>
00272 <span class="comment"></span>
00273 <span class="comment">Routine Description:</span>
00274 <span class="comment"></span>
00275 <span class="comment">    This routine move a graphics buffer.</span>
00276 <span class="comment"></span>
00277 <span class="comment">Arguments:</span>
00278 <span class="comment"></span>
00279 <span class="comment">    TargetPtr - Pointer to target graphics buffer.</span>
00280 <span class="comment"></span>
00281 <span class="comment">    SourcePtr - Pointer to source graphics buffer.</span>
00282 <span class="comment"></span>
00283 <span class="comment">    Length - Fill length.</span>
00284 <span class="comment"></span>
00285 <span class="comment">Return Value:</span>
00286 <span class="comment"></span>
00287 <span class="comment">--*/</span>
00288 
00289 {
00290     ULONG tmpLen;
00291 
00292     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(SourcePtr + Length - FrameBufPtr) &gt;= DeviceExtension-&gt;EmulateInfo.LimitGRAM) {
00293         tmpLen = DeviceExtension-&gt;EmulateInfo.LimitGRAM - (SourcePtr - FrameBufPtr);
00294         <a class="code" href="../../d7/d8/fsvga_8h.html#a42">memcpyGRAM</a>(TargetPtr, SourcePtr, tmpLen);
00295         TargetPtr += tmpLen;
00296         Length -= tmpLen;
00297         SourcePtr = FrameBufPtr;
00298     }
00299 
00300     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(TargetPtr + Length - FrameBufPtr) &gt;= DeviceExtension-&gt;EmulateInfo.LimitGRAM) {
00301         tmpLen = DeviceExtension-&gt;EmulateInfo.LimitGRAM - (TargetPtr - FrameBufPtr);
00302         <a class="code" href="../../d7/d8/fsvga_8h.html#a42">memcpyGRAM</a>(TargetPtr, SourcePtr, tmpLen);
00303         SourcePtr += tmpLen;
00304         Length -= tmpLen;
00305         TargetPtr = FrameBufPtr;
00306     }
00307 
00308     <span class="keywordflow">if</span> (Length) {
00309         <a class="code" href="../../d7/d8/fsvga_8h.html#a42">memcpyGRAM</a>(TargetPtr, SourcePtr, Length);
00310     }
00311 }
00312 
00313 <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
<a name="l00314"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a44">00314</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a44">MoveGRAM</a>(
00315     IN PCHAR TargetPtr,
00316     IN PCHAR SourcePtr,
00317     IN ULONG Length,
00318     IN PUCHAR FrameBufPtr,
00319     IN <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension
00320     )
00321 
00322 <span class="comment">/*++</span>
00323 <span class="comment"></span>
00324 <span class="comment">Routine Description:</span>
00325 <span class="comment"></span>
00326 <span class="comment">    This routine move a graphics buffer.</span>
00327 <span class="comment"></span>
00328 <span class="comment">Arguments:</span>
00329 <span class="comment"></span>
00330 <span class="comment">    TargetPtr - Pointer to target graphics buffer.</span>
00331 <span class="comment"></span>
00332 <span class="comment">    SourcePtr - Pointer to source graphics buffer.</span>
00333 <span class="comment"></span>
00334 <span class="comment">    Length - Fill length.</span>
00335 <span class="comment"></span>
00336 <span class="comment">Return Value:</span>
00337 <span class="comment"></span>
00338 <span class="comment">    none.</span>
00339 <span class="comment"></span>
00340 <span class="comment">--*/</span>
00341 {
00342     PCHAR tmpSrc;
00343     PCHAR tmpTrg;
00344     ULONG tmpLen;
00345 
00346     <span class="comment">//</span>
00347     <span class="comment">// Set copy mode of graphics register</span>
00348     <span class="comment">//</span>
00349 
00350     <a class="code" href="../../d6/d2/port_8c.html#a2">SetGRAMCopyMode</a>(DeviceExtension);
00351 
00352     <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(SourcePtr + Length - FrameBufPtr) &gt;= DeviceExtension-&gt;EmulateInfo.LimitGRAM ||
00353         (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(TargetPtr + Length - FrameBufPtr) &gt;= DeviceExtension-&gt;EmulateInfo.LimitGRAM    ) {
00354         <span class="keywordflow">if</span> (SourcePtr &gt; TargetPtr) {
00355             <a class="code" href="../../d7/d8/fsvga_8h.html#a43">memcpyGRAMOver</a>(TargetPtr,SourcePtr,Length,FrameBufPtr,DeviceExtension);
00356         }
00357         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ULONG)(TargetPtr - SourcePtr) &gt;= Length) {
00358             <a class="code" href="../../d7/d8/fsvga_8h.html#a43">memcpyGRAMOver</a>(TargetPtr,SourcePtr,Length,FrameBufPtr,DeviceExtension);
00359         }
00360         <span class="keywordflow">else</span> {
00361             <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(SourcePtr + Length - FrameBufPtr) &gt;= DeviceExtension-&gt;EmulateInfo.LimitGRAM) {
00362                 tmpLen = SourcePtr + Length - FrameBufPtr - DeviceExtension-&gt;EmulateInfo.LimitGRAM;
00363                 tmpTrg = TargetPtr + Length - tmpLen - DeviceExtension-&gt;EmulateInfo.LimitGRAM;
00364                 <a class="code" href="../../d7/d8/fsvga_8h.html#a42">memcpyGRAM</a>(tmpTrg, FrameBufPtr, tmpLen);
00365                 Length -= tmpLen;
00366             }
00367             <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(TargetPtr + Length - FrameBufPtr) &gt;= DeviceExtension-&gt;EmulateInfo.LimitGRAM) {
00368                 tmpLen = TargetPtr + Length - FrameBufPtr - DeviceExtension-&gt;EmulateInfo.LimitGRAM;
00369                 tmpSrc = SourcePtr + Length - tmpLen;
00370                 <a class="code" href="../../d7/d8/fsvga_8h.html#a42">memcpyGRAM</a>(FrameBufPtr, tmpSrc, tmpLen);
00371                 Length -= tmpLen;
00372             }
00373             <span class="keywordflow">if</span> (Length) {
00374                 <a class="code" href="../../d7/d8/fsvga_8h.html#a42">memcpyGRAM</a>(TargetPtr, SourcePtr, Length);
00375             }
00376         }
00377     }
00378     <span class="keywordflow">else</span> {
00379         <a class="code" href="../../d7/d8/fsvga_8h.html#a42">memcpyGRAM</a>(TargetPtr, SourcePtr, Length);
00380     }
00381 
00382     <a class="code" href="../../d6/d2/port_8c.html#a1">SetGRAMWriteMode</a>(DeviceExtension);
00383 }
00384 
00385 
00386 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00387"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a45">00387</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a45">FsgVgaInitializeHWFlags</a>(
00388     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension
00389     )
00390 
00391 <span class="comment">/*++</span>
00392 <span class="comment"></span>
00393 <span class="comment">Routine Description:</span>
00394 <span class="comment"></span>
00395 <span class="comment">    This routine initialize the hardware scrolls flag and any values.</span>
00396 <span class="comment"></span>
00397 <span class="comment">Arguments:</span>
00398 <span class="comment"></span>
00399 <span class="comment">    EmulateInfo - Pointer to screen emulate information structure.</span>
00400 <span class="comment"></span>
00401 <span class="comment">Return Value:</span>
00402 <span class="comment"></span>
00403 <span class="comment">--*/</span>
00404 
00405 {
00406     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00407 
00408     <a class="code" href="../../d6/d2/port_8c.html#a0">GetHardwareScrollReg</a>(DeviceExtension);
00409     DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o3">BytePerLine</a> =
00410         (WORD)<a class="code" href="../../d2/d2/drawscrn_8c.html#a3">GetBytePerLine</a>(DeviceExtension);
00411     DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o4">MaxScanLine</a> =
00412         (WORD)<a class="code" href="../../d2/d2/drawscrn_8c.html#a1">CalcGRAMScanLine</a>(DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.ScreenSize.Y,
00413                                DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.FontSize.Y);
00414     DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o6">DeltaNextFontRow</a> =
00415         DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o3">BytePerLine</a> * DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.FontSize.Y;
00416 
00417     <span class="keywordflow">if</span> (DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o49">Configuration</a>.<a class="code" href="../../d3/d1/struct__FSVGA__CONFIGURATION__INFORMATION.html#o2">HardwareScroll</a> &amp; <a class="code" href="../../d7/d8/fsvga_8h.html#a5">USE_LINE_COMPARE</a>) {
00418         DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o5">LimitGRAM</a> =
00419             DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o4">MaxScanLine</a> * DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o3">BytePerLine</a>;
00420     }
00421     <span class="keywordflow">else</span> {
00422         DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o5">LimitGRAM</a> = <a class="code" href="../../d7/d8/fsvga_8h.html#a7">LIMIT_64K</a>;
00423     }
00424 
00425     DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o7">ColorFg</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)-1;
00426     DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o8">ColorBg</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)-1;
00427 
00428     DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o9">CursorAttributes</a>.Enable = 0;
00429     DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o11">ShowCursor</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00430 
00431     <a class="code" href="../../d6/d2/port_8c.html#a1">SetGRAMWriteMode</a>(DeviceExtension);
00432 
00433     <span class="keywordflow">return</span> STATUS_SUCCESS;
00434 }
00435 
00436 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00437"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a46">00437</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a46">FsgCopyFrameBuffer</a>(
00438     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension,
00439     PFSVIDEO_COPY_FRAME_BUFFER CopyFrameBuffer,
00440     ULONG inputBufferLength
00441     )
00442 
00443 <span class="comment">/*++</span>
00444 <span class="comment"></span>
00445 <span class="comment">Routine Description:</span>
00446 <span class="comment"></span>
00447 <span class="comment">    This routine copy the frame buffer.</span>
00448 <span class="comment"></span>
00449 <span class="comment">Arguments:</span>
00450 <span class="comment"></span>
00451 <span class="comment">    DeviceExtension - Pointer to the miniport driver's device extension.</span>
00452 <span class="comment"></span>
00453 <span class="comment">    CopyFrameBuffer - Pointer to the structure containing the information about the copy frame buffer.</span>
00454 <span class="comment"></span>
00455 <span class="comment">    inputBufferLength - Length of the input buffer supplied by the user.</span>
00456 <span class="comment"></span>
00457 <span class="comment">Return Value:</span>
00458 <span class="comment"></span>
00459 <span class="comment">    STATUS_INSUFFICIENT_BUFFER if the input buffer was not large enough</span>
00460 <span class="comment">        for the input data.</span>
00461 <span class="comment"></span>
00462 <span class="comment">    STATUS_SUCCESS if the operation completed successfully.</span>
00463 <span class="comment"></span>
00464 <span class="comment">--*/</span>
00465 
00466 {
00467     PUCHAR SourcePtr, TargetPtr;
00468 
00469     <a class="code" href="../../d7/d8/fsvga_8h.html#a49">FsgInvertCursor</a>(DeviceExtension,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00470 
00471     SourcePtr = <a class="code" href="../../d7/d8/fsvga_8h.html#a39">CalcGRAMAddress</a> (CopyFrameBuffer-&gt;SrcScreen.Position,
00472                                  DeviceExtension);
00473     TargetPtr = <a class="code" href="../../d7/d8/fsvga_8h.html#a39">CalcGRAMAddress</a> (CopyFrameBuffer-&gt;DestScreen.Position,
00474                                  DeviceExtension);
00475     <a class="code" href="../../d7/d8/fsvga_8h.html#a44">MoveGRAM</a> (TargetPtr,
00476               SourcePtr,
00477               CopyFrameBuffer-&gt;SrcScreen.nNumberOfChars *
00478                   DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.FontSize.Y,
00479               DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o50">CurrentMode</a>.VideoMemory.FrameBufferBase,
00480               DeviceExtension
00481              );
00482 
00483     <a class="code" href="../../d7/d8/fsvga_8h.html#a49">FsgInvertCursor</a>(DeviceExtension,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00484 
00485     <span class="keywordflow">return</span> STATUS_SUCCESS;
00486 }
00487 
00488 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00489"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a47">00489</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a47">FsgWriteToFrameBuffer</a>(
00490     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension,
00491     PFSVIDEO_WRITE_TO_FRAME_BUFFER WriteFrameBuffer,
00492     ULONG inputBufferLength
00493     )
00494 
00495 <span class="comment">/*++</span>
00496 <span class="comment"></span>
00497 <span class="comment">Routine Description:</span>
00498 <span class="comment"></span>
00499 <span class="comment">    This routine write the frame buffer.</span>
00500 <span class="comment"></span>
00501 <span class="comment">Arguments:</span>
00502 <span class="comment"></span>
00503 <span class="comment">    DeviceExtension - Pointer to the miniport driver's device extension.</span>
00504 <span class="comment"></span>
00505 <span class="comment">    WriteFrameBuffer - Pointer to the structure containing the information about the write frame buffer.</span>
00506 <span class="comment"></span>
00507 <span class="comment">    inputBufferLength - Length of the input buffer supplied by the user.</span>
00508 <span class="comment"></span>
00509 <span class="comment">Return Value:</span>
00510 <span class="comment"></span>
00511 <span class="comment">    STATUS_INSUFFICIENT_BUFFER if the input buffer was not large enough</span>
00512 <span class="comment">        for the input data.</span>
00513 <span class="comment"></span>
00514 <span class="comment">    STATUS_SUCCESS if the operation completed successfully.</span>
00515 <span class="comment"></span>
00516 <span class="comment">--*/</span>
00517 
00518 {
00519     PCHAR_IMAGE_INFO pCharInfoUni = WriteFrameBuffer-&gt;SrcBuffer;
00520     PUCHAR TargetPtr;
00521     COORD Position = WriteFrameBuffer-&gt;DestScreen.Position;
00522     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Length = WriteFrameBuffer-&gt;DestScreen.nNumberOfChars;
00523     COORD FontSize1 = DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.FontSize;
00524     COORD FontSize2;
00525     PVOID pCapBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00526     ULONG cCapBuffer = 0;
00527     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  fDbcs;
00528     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00529 
00530     <a class="code" href="../../d7/d8/fsvga_8h.html#a49">FsgInvertCursor</a>(DeviceExtension,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00531 
00532     DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o7">ColorFg</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)-1;
00533     DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o8">ColorBg</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)-1;
00534 
00535     FontSize2 = FontSize1;
00536     FontSize2.X *= 2;
00537     cCapBuffer = <a class="code" href="../../d6/d6/foncache_8h.html#a29">CalcBitmapBufferSize</a>(FontSize2,<a class="code" href="../../d6/d6/foncache_8h.html#a9">BYTE_ALIGN</a>);
00538     pCapBuffer = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(<a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, cCapBuffer);
00539 
00540     <span class="keywordflow">while</span> (Length--)
00541     {
00542         <span class="keywordflow">if</span> (pCharInfoUni-&gt;FontImageInfo.ImageBits != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00543         {
00544             <span class="keywordflow">try</span>
00545             {
00546                 fDbcs = pCharInfoUni-&gt;CharInfo.Attributes &amp; COMMON_LVB_SBCSDBCS;
00547                 <a class="code" href="../../d7/d8/fsvga_8h.html#a56">AlignCopyMemory</a>((PVOID)pCapBuffer,                    <span class="comment">// pDestBits</span>
00548                                 <a class="code" href="../../d6/d6/foncache_8h.html#a9">BYTE_ALIGN</a>,                           <span class="comment">// dwDestAlign</span>
00549                                 pCharInfoUni-&gt;FontImageInfo.ImageBits,<span class="comment">// pSrcBits</span>
00550                                 <a class="code" href="../../d6/d6/foncache_8h.html#a10">WORD_ALIGN</a>,                           <span class="comment">// dwSrcAlign</span>
00551                                 fDbcs ? FontSize2 : FontSize1);
00552 
00553                 TargetPtr = <a class="code" href="../../d7/d8/fsvga_8h.html#a39">CalcGRAMAddress</a> (Position,
00554                                              DeviceExtension);
00555                 <span class="keywordflow">if</span> (fDbcs)
00556                 {
00557                     <span class="keywordflow">if</span> (Length)
00558                     {
00559                         <a class="code" href="../../d7/d8/fsvga_8h.html#a50">FsgWriteToScreen</a>(TargetPtr, pCapBuffer, 2, fDbcs,
00560                                          pCharInfoUni-&gt;CharInfo.Attributes,
00561                                          (pCharInfoUni+1)-&gt;CharInfo.Attributes,
00562                                          DeviceExtension);
00563                     }
00564                     <span class="keywordflow">else</span>
00565                     {
00566                         <a class="code" href="../../d7/d8/fsvga_8h.html#a50">FsgWriteToScreen</a>(TargetPtr, pCapBuffer, 2, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00567                                          pCharInfoUni-&gt;CharInfo.Attributes,
00568                                          (WORD)-1,
00569                                          DeviceExtension);
00570                     }
00571                 }
00572                 <span class="keywordflow">else</span>
00573                 {
00574                     <a class="code" href="../../d7/d8/fsvga_8h.html#a50">FsgWriteToScreen</a>(TargetPtr, pCapBuffer, 1, fDbcs,
00575                                      pCharInfoUni-&gt;CharInfo.Attributes,
00576                                      (WORD)-1,
00577                                      DeviceExtension);
00578                 }
00579 
00580             }
00581             except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>)
00582             {
00583             }
00584 
00585         }
00586 
00587         <span class="keywordflow">if</span> (fDbcs &amp;&amp; Length)
00588         {
00589             Length--;
00590             Position.X += 2;
00591             pCharInfoUni += 2;
00592         }
00593         <span class="keywordflow">else</span>
00594         {
00595             Position.X++;
00596             pCharInfoUni++;
00597         }
00598     }
00599 
00600     <a class="code" href="../../d7/d8/fsvga_8h.html#a49">FsgInvertCursor</a>(DeviceExtension,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00601 
00602     <span class="keywordflow">if</span> (pCapBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00603         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(pCapBuffer);
00604 
00605     <span class="keywordflow">return</span> STATUS_SUCCESS;
00606 }
00607 
00608 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00609"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a48">00609</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a48">FsgReverseMousePointer</a>(
00610     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension,
00611     PFSVIDEO_REVERSE_MOUSE_POINTER MouseBuffer,
00612     ULONG inputBufferLength
00613     )
00614 
00615 <span class="comment">/*++</span>
00616 <span class="comment"></span>
00617 <span class="comment">Routine Description:</span>
00618 <span class="comment"></span>
00619 <span class="comment">    This routine reverse the frame buffer for mouse pointer.</span>
00620 <span class="comment"></span>
00621 <span class="comment">Arguments:</span>
00622 <span class="comment"></span>
00623 <span class="comment">    DeviceExtension - Pointer to the miniport driver's device extension.</span>
00624 <span class="comment"></span>
00625 <span class="comment">    MouseBuffer - Pointer to the structure containing the information about the mouse frame buffer.</span>
00626 <span class="comment"></span>
00627 <span class="comment">    inputBufferLength - Length of the input buffer supplied by the user.</span>
00628 <span class="comment"></span>
00629 <span class="comment">Return Value:</span>
00630 <span class="comment"></span>
00631 <span class="comment">    STATUS_INSUFFICIENT_BUFFER if the input buffer was not large enough</span>
00632 <span class="comment">        for the input data.</span>
00633 <span class="comment"></span>
00634 <span class="comment">    STATUS_SUCCESS if the operation completed successfully.</span>
00635 <span class="comment"></span>
00636 <span class="comment">--*/</span>
00637 
00638 {
00639 
00640     PUCHAR CurFrameBufPtr;
00641     COORD  CursorPosition;
00642     COORD  FontSize;
00643     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>  i;
00644     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fOneMore = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00645 
00646     <a class="code" href="../../d7/d8/fsvga_8h.html#a49">FsgInvertCursor</a>(DeviceExtension,<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00647 
00648     FontSize = DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.FontSize;
00649 
00650     CursorPosition.X = MouseBuffer-&gt;Screen.Position.X;
00651     CursorPosition.Y = MouseBuffer-&gt;Screen.Position.Y;
00652     <span class="keywordflow">if</span> ( (0 &lt;= CursorPosition.X &amp;&amp;
00653                CursorPosition.X &lt; MouseBuffer-&gt;Screen.ScreenSize.X) &amp;&amp;
00654          (0 &lt;= CursorPosition.Y &amp;&amp;
00655                CursorPosition.Y &lt; MouseBuffer-&gt;Screen.ScreenSize.Y)    )
00656     {
00657         <span class="keywordflow">switch</span> (MouseBuffer-&gt;dwType)
00658         {
00659             <span class="keywordflow">case</span> CHAR_TYPE_LEADING:
00660                 <span class="keywordflow">if</span> (CursorPosition.X != MouseBuffer-&gt;Screen.ScreenSize.X-1)
00661                 {
00662                     fOneMore = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00663                 }
00664                 <span class="keywordflow">break</span>;
00665             <span class="keywordflow">case</span> CHAR_TYPE_TRAILING:
00666                 <span class="keywordflow">if</span> (CursorPosition.X != 0)
00667                 {
00668                     fOneMore = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00669                     CursorPosition.X--;
00670                 }
00671                 <span class="keywordflow">break</span>;
00672         }
00673 
00674         CurFrameBufPtr = <a class="code" href="../../d7/d8/fsvga_8h.html#a39">CalcGRAMAddress</a> (CursorPosition,
00675                                           DeviceExtension);
00676 
00677         <span class="comment">//</span>
00678         <span class="comment">// Set invert mode of graphics register</span>
00679         <span class="comment">//</span>
00680         <a class="code" href="../../d6/d2/port_8c.html#a3">SetGRAMInvertMode</a>(DeviceExtension);
00681 
00682         <span class="comment">/*</span>
00683 <span class="comment">         * CursorAttributes.Width is bottom scan lines.</span>
00684 <span class="comment">         */</span>
00685         <span class="keywordflow">for</span> (i=0 ; i &lt; FontSize.Y; i++)
00686         {
00687             <a class="code" href="../../d7/d8/fsvga_8h.html#a54">AccessGRAM_AND</a>(CurFrameBufPtr, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)-1);
00688             <span class="keywordflow">if</span> (fOneMore)
00689                 <a class="code" href="../../d7/d8/fsvga_8h.html#a54">AccessGRAM_AND</a>(CurFrameBufPtr+1, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)-1);
00690             CurFrameBufPtr = <a class="code" href="../../d7/d8/fsvga_8h.html#a41">NextGRAMRow</a>(CurFrameBufPtr,DeviceExtension);
00691         }
00692 
00693         <a class="code" href="../../d6/d2/port_8c.html#a1">SetGRAMWriteMode</a>(DeviceExtension);
00694     }
00695 
00696     <a class="code" href="../../d7/d8/fsvga_8h.html#a49">FsgInvertCursor</a>(DeviceExtension,<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00697 
00698     <span class="keywordflow">return</span> STATUS_SUCCESS;
00699 }
00700 
00701 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00702"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a49">00702</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a49">FsgInvertCursor</a>(
00703     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension,
00704     BOOL Invert
00705     )
00706 
00707 <span class="comment">/*++</span>
00708 <span class="comment"></span>
00709 <span class="comment">Routine Description:</span>
00710 <span class="comment"></span>
00711 <span class="comment">    This routine inverts the cursor.</span>
00712 <span class="comment"></span>
00713 <span class="comment">Arguments:</span>
00714 <span class="comment"></span>
00715 <span class="comment">    DeviceExtension - Pointer to the miniport driver's device extension.</span>
00716 <span class="comment"></span>
00717 <span class="comment">    Invert - </span>
00718 <span class="comment"></span>
00719 <span class="comment">Return Value:</span>
00720 <span class="comment"></span>
00721 <span class="comment">    STATUS_INSUFFICIENT_BUFFER if the input buffer was not large enough</span>
00722 <span class="comment">        for the input data.</span>
00723 <span class="comment"></span>
00724 <span class="comment">    STATUS_SUCCESS if the operation completed successfully.</span>
00725 <span class="comment"></span>
00726 <span class="comment">--*/</span>
00727 
00728 {
00729     PUCHAR CurFrameBufPtr;
00730     COORD  CursorPosition;
00731     COORD  FontSize;
00732     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>  i;
00733     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>  TopScanLine;
00734     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fOneMore = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00735 
00736     <span class="keywordflow">if</span> (DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o11">ShowCursor</a> == Invert)
00737         <span class="keywordflow">return</span> STATUS_SUCCESS;
00738 
00739     DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o11">ShowCursor</a> = Invert;
00740 
00741     <span class="keywordflow">if</span> (!(DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o9">CursorAttributes</a>.Enable))
00742         <span class="keywordflow">return</span> STATUS_SUCCESS;
00743 
00744     FontSize = DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.FontSize;
00745     <span class="keywordflow">if</span> (DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.ScreenSize.Y &gt; 25)
00746     {
00747         TopScanLine = ((DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o9">CursorAttributes</a>.Height + 8) * 100 / 8) - 100;
00748     }
00749     <span class="keywordflow">else</span>
00750     {
00751         TopScanLine = ((DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o9">CursorAttributes</a>.Height + 16) * 100 / 16) - 100;
00752     }
00753     TopScanLine = (FontSize.Y * TopScanLine) / 100;
00754 
00755     CursorPosition.X = DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o10">CursorPosition</a>.Coord.Column;
00756     CursorPosition.Y = DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o10">CursorPosition</a>.Coord.Row;
00757     <span class="keywordflow">if</span> ( (0 &lt;= CursorPosition.X &amp;&amp;
00758                CursorPosition.X &lt; DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.ScreenSize.X) &amp;&amp;
00759          (0 &lt;= CursorPosition.Y &amp;&amp;
00760                CursorPosition.Y &lt; DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.ScreenSize.Y)    )
00761     {
00762         <span class="keywordflow">switch</span> (DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o10">CursorPosition</a>.dwType)
00763         {
00764             <span class="keywordflow">case</span> CHAR_TYPE_LEADING:
00765                 <span class="keywordflow">if</span> (CursorPosition.X != DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.ScreenSize.X-1)
00766                 {
00767                     fOneMore = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00768                 }
00769                 <span class="keywordflow">break</span>;
00770             <span class="keywordflow">case</span> CHAR_TYPE_TRAILING:
00771                 <span class="keywordflow">if</span> (CursorPosition.X != 0)
00772                 {
00773                     fOneMore = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00774                     CursorPosition.X--;
00775                 }
00776                 <span class="keywordflow">break</span>;
00777         }
00778 
00779         CurFrameBufPtr = <a class="code" href="../../d7/d8/fsvga_8h.html#a39">CalcGRAMAddress</a> (CursorPosition,
00780                                           DeviceExtension);
00781 
00782         <span class="comment">/*</span>
00783 <span class="comment">         * CursorAttributes.Height is top scan lines.</span>
00784 <span class="comment">         */</span>
00785         <span class="keywordflow">for</span> (i = 0; i &lt; TopScanLine; i++)
00786         {
00787             CurFrameBufPtr = <a class="code" href="../../d7/d8/fsvga_8h.html#a41">NextGRAMRow</a>(CurFrameBufPtr,DeviceExtension);
00788         }
00789 
00790         <span class="comment">//</span>
00791         <span class="comment">// Set invert mode of graphics register</span>
00792         <span class="comment">//</span>
00793         <a class="code" href="../../d6/d2/port_8c.html#a3">SetGRAMInvertMode</a>(DeviceExtension);
00794 
00795         <span class="comment">/*</span>
00796 <span class="comment">         * CursorAttributes.Width is bottom scan lines.</span>
00797 <span class="comment">         */</span>
00798         <span class="keywordflow">for</span> ( ; i &lt; FontSize.Y; i++)
00799         {
00800             <a class="code" href="../../d7/d8/fsvga_8h.html#a54">AccessGRAM_AND</a>(CurFrameBufPtr, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)-1);
00801             <span class="keywordflow">if</span> (fOneMore)
00802                 <a class="code" href="../../d7/d8/fsvga_8h.html#a54">AccessGRAM_AND</a>(CurFrameBufPtr+1, (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)-1);
00803             CurFrameBufPtr = <a class="code" href="../../d7/d8/fsvga_8h.html#a41">NextGRAMRow</a>(CurFrameBufPtr,DeviceExtension);
00804         }
00805 
00806         <a class="code" href="../../d6/d2/port_8c.html#a1">SetGRAMWriteMode</a>(DeviceExtension);
00807     }
00808 
00809     <span class="keywordflow">return</span> STATUS_SUCCESS;
00810 }
00811 
00812 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00813"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a50">00813</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a50">FsgWriteToScreen</a>(
00814     PUCHAR FrameBuffer,
00815     PUCHAR BitmapBuffer,
00816     DWORD cjBytes,
00817     BOOL fDbcs,
00818     WORD Attributes1,
00819     WORD Attributes2,
00820     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension
00821     )
00822 {
00823     WORD  <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00824     PCHAR CurFrameBufPtrTmp;
00825     PCHAR CurFrameBufPtr2nd;
00826     PWORD CurFrameBufPtrWord;
00827     PUCHAR BitmapBufferTmp;
00828 
00829 <span class="preprocessor">#ifdef LATER_HIGH_SPPED_VRAM_ACCESS  // kazum</span>
00830 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (! <a class="code" href="../../d7/d8/fsvga_8h.html#a40">IsGRAMRowOver</a>(FrameBuffer,fDBCS,DeviceExtension)) {
00831         <span class="keywordflow">if</span> (!fDbcs) {
00832             <span class="keywordflow">if</span> (cjBytes == 2)
00833                 BitmapBuffer++;
00834             (*WriteGramInfo-&gt;pfnWriteFontToByteGRAM)(WriteGramInfo);
00835         }
00836         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cjBytes == 2 &amp;&amp; fDBCS) {
00837             <span class="keywordflow">if</span> (DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o49">Configuration</a>.<a class="code" href="../../d3/d1/struct__FSVGA__CONFIGURATION__INFORMATION.html#o0">EmulationMode</a> &amp; <a class="code" href="../../d7/d8/fsvga_8h.html#a0">ENABLE_WORD_WRITE_VRAM</a>) {
00838                 (*WriteGramInfo-&gt;pfnWriteFontToFirstWordGRAM)(WriteGramInfo);
00839             }
00840             <span class="keywordflow">else</span> {
00841                (*WriteGramInfo-&gt;pfnWriteFontToWordGRAM)(WriteGramInfo);
00842             }
00843         }
00844     }
00845     <span class="keywordflow">else</span>
00846 <span class="preprocessor">#endif // LATER_HIGH_SPPED_VRAM_ACCESS  // kazum</span>
00847 <span class="preprocessor"></span>    <span class="keywordflow">try</span>
00848     {
00849         <a class="code" href="../../d6/d2/port_8c.html#a4">set_opaque_bkgnd_proc</a>(DeviceExtension,FrameBuffer,Attributes1);
00850 
00851         <span class="keywordflow">if</span> (!fDbcs) {
00852             CurFrameBufPtrTmp = FrameBuffer;
00853             <span class="keywordflow">if</span> (cjBytes == 2)
00854                 BitmapBuffer++;
00855             <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>=0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.FontSize.Y; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++) {
00856                 *CurFrameBufPtrTmp = *BitmapBuffer;
00857                 BitmapBuffer += cjBytes;
00858                 CurFrameBufPtrTmp=<a class="code" href="../../d7/d8/fsvga_8h.html#a41">NextGRAMRow</a>(CurFrameBufPtrTmp,DeviceExtension);
00859             }
00860         }
00861         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cjBytes == 2 &amp;&amp; fDbcs) {
00862             <span class="keywordflow">if</span> ((DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o49">Configuration</a>.<a class="code" href="../../d3/d1/struct__FSVGA__CONFIGURATION__INFORMATION.html#o0">EmulationMode</a> &amp; <a class="code" href="../../d7/d8/fsvga_8h.html#a0">ENABLE_WORD_WRITE_VRAM</a>) &amp;&amp;
00863                 !((ULONG)FrameBuffer &amp; 1) &amp;&amp;
00864                 (Attributes2 != -1) &amp;&amp;
00865                 (Attributes1 == Attributes2)
00866                ) {
00867                 CurFrameBufPtrWord = (PWORD)FrameBuffer;
00868                 <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>=0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.FontSize.Y; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++) {
00869                     *CurFrameBufPtrWord = *((PWORD)BitmapBuffer);
00870                     BitmapBuffer += cjBytes;
00871                     CurFrameBufPtrWord=(PWORD)<a class="code" href="../../d7/d8/fsvga_8h.html#a41">NextGRAMRow</a>((PCHAR)CurFrameBufPtrWord,DeviceExtension);
00872                 }
00873             }
00874             <span class="keywordflow">else</span> {
00875                 CurFrameBufPtrTmp = FrameBuffer;
00876                 CurFrameBufPtr2nd = FrameBuffer + 1;
00877                 BitmapBufferTmp = BitmapBuffer + 1;
00878                 <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>=0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.FontSize.Y; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++) {
00879                     *CurFrameBufPtrTmp = *BitmapBuffer;
00880                     BitmapBuffer += cjBytes;
00881                     CurFrameBufPtrTmp=<a class="code" href="../../d7/d8/fsvga_8h.html#a41">NextGRAMRow</a>(CurFrameBufPtrTmp,DeviceExtension);
00882                 }
00883                 <span class="keywordflow">if</span> (Attributes2 != -1 &amp;&amp;
00884                     Attributes1 != Attributes2)
00885                     <a class="code" href="../../d6/d2/port_8c.html#a4">set_opaque_bkgnd_proc</a>(DeviceExtension,FrameBuffer,Attributes2);
00886                 <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>=0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.FontSize.Y; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++) {
00887                     *CurFrameBufPtr2nd = *BitmapBufferTmp;
00888                     BitmapBufferTmp += cjBytes;
00889                     CurFrameBufPtr2nd=<a class="code" href="../../d7/d8/fsvga_8h.html#a41">NextGRAMRow</a>(CurFrameBufPtr2nd,DeviceExtension);
00890                 }
00891             }
00892         }
00893     }
00894     except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>)
00895     {
00896     }
00897 
00898     <span class="keywordflow">if</span> (Attributes1 &amp; <a class="code" href="../../d2/d2/drawscrn_8c.html#a0">COMMON_LVB_MASK</a>)
00899     {
00900         <a class="code" href="../../d7/d8/fsvga_8h.html#a51">FsgWriteToScreenCommonLVB</a>(FrameBuffer,
00901                                   Attributes1,
00902                                   DeviceExtension);
00903     }
00904     <span class="keywordflow">if</span> ((Attributes2 != (WORD)-1) &amp;&amp; (Attributes2 &amp; <a class="code" href="../../d2/d2/drawscrn_8c.html#a0">COMMON_LVB_MASK</a>))
00905     {
00906         <a class="code" href="../../d7/d8/fsvga_8h.html#a51">FsgWriteToScreenCommonLVB</a>(FrameBuffer+1,
00907                                   Attributes2,
00908                                   DeviceExtension);
00909     }
00910 
00911     <span class="keywordflow">return</span> STATUS_SUCCESS;
00912 }
00913 
00914 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00915"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a51">00915</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a51">FsgWriteToScreenCommonLVB</a>(
00916     PUCHAR FrameBuffer,
00917     WORD Attributes,
00918     <a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html">PDEVICE_EXTENSION</a> DeviceExtension
00919     )
00920 {
00921     WORD  <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00922     PUCHAR CurFrameBufPtrTmp;
00923 
00924     <span class="keywordflow">try</span>
00925     {
00926         <span class="keywordflow">if</span> (Attributes &amp; COMMON_LVB_UNDERSCORE)
00927         {
00928             <a class="code" href="../../d6/d2/port_8c.html#a4">set_opaque_bkgnd_proc</a>(DeviceExtension,FrameBuffer,Attributes);
00929             CurFrameBufPtrTmp = FrameBuffer;
00930             <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>=0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.FontSize.Y - 1; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++)
00931                 CurFrameBufPtrTmp=<a class="code" href="../../d7/d8/fsvga_8h.html#a41">NextGRAMRow</a>(CurFrameBufPtrTmp,DeviceExtension);
00932             *CurFrameBufPtrTmp = 0xff;
00933         }
00934 
00935         <span class="keywordflow">if</span> (Attributes &amp; COMMON_LVB_GRID_HORIZONTAL)
00936         {
00937             <a class="code" href="../../d6/d2/port_8c.html#a6">ColorSetDirect</a>(DeviceExtension, FrameBuffer,
00938                            FOREGROUND_BLUE | FOREGROUND_GREEN | FOREGROUND_RED,
00939                            0);
00940             *FrameBuffer = 0xff;
00941         }
00942 
00943         <span class="keywordflow">if</span> ( (Attributes &amp; COMMON_LVB_GRID_LVERTICAL) ||
00944              (Attributes &amp; COMMON_LVB_GRID_RVERTICAL)   )
00945         {
00946             <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> mask = ((Attributes &amp; COMMON_LVB_GRID_LVERTICAL) ? 0x80 : 0) +
00947                         ((Attributes &amp; COMMON_LVB_GRID_RVERTICAL) ? 0x01 : 0);
00948             <a class="code" href="../../d6/d2/port_8c.html#a5">ColorSetGridMask</a>(DeviceExtension,
00949                              mask
00950                             );
00951             CurFrameBufPtrTmp = FrameBuffer;
00952             <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>=0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o51">ScreenAndFont</a>.FontSize.Y; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>++) {
00953                 <a class="code" href="../../d7/d8/fsvga_8h.html#a53">AccessGRAM_RW</a>(CurFrameBufPtrTmp, mask);
00954                 CurFrameBufPtrTmp=<a class="code" href="../../d7/d8/fsvga_8h.html#a41">NextGRAMRow</a>(CurFrameBufPtrTmp,DeviceExtension);
00955             }
00956 
00957             <a class="code" href="../../d6/d2/port_8c.html#a1">SetGRAMWriteMode</a>(DeviceExtension);
00958         }
00959 
00960         DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o7">ColorFg</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)-1;
00961         DeviceExtension-&gt;<a class="code" href="../../d8/d3/struct__DEVICE__EXTENSION.html#o52">EmulateInfo</a>.<a class="code" href="../../d1/d3/struct__EMULATE__BUFFER__INFORMATION.html#o8">ColorBg</a> = (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)-1;
00962 
00963     }
00964     except (<a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>)
00965     {
00966     }
00967 
00968     <span class="keywordflow">return</span> STATUS_SUCCESS;
00969 }
00970 
00971 <span class="preprocessor">#pragma optimize("",off)</span>
00972 <span class="preprocessor"></span>    <span class="comment">/*</span>
00973 <span class="comment">     * because, frame buffer memory access is need by write/read.</span>
00974 <span class="comment">     */</span>
00975 UCHAR
<a name="l00976"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a52">00976</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a52">AccessGRAM_WR</a>(
00977     PUCHAR FrameBuffer,
00978     UCHAR  write
00979     )
00980 {
00981     *FrameBuffer = write;
00982     <span class="keywordflow">return</span> *FrameBuffer;
00983 }
00984 
00985 UCHAR
<a name="l00986"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a53">00986</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a53">AccessGRAM_RW</a>(
00987     PUCHAR FrameBuffer,
00988     UCHAR  write
00989     )
00990 {
00991     UCHAR tmp;
00992     tmp = *FrameBuffer;
00993     *FrameBuffer = write;
00994     <span class="keywordflow">return</span> tmp;
00995 }
00996 
00997 UCHAR
<a name="l00998"></a><a class="code" href="../../d7/d8/fsvga_8h.html#a54">00998</a> <a class="code" href="../../d7/d8/fsvga_8h.html#a54">AccessGRAM_AND</a>(
00999     PUCHAR FrameBuffer,
01000     UCHAR  write
01001     )
01002 {
01003     <span class="keywordflow">return</span> *FrameBuffer &amp;= write;
01004 }
01005 <span class="preprocessor">#pragma optimize("",on)</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:46 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
