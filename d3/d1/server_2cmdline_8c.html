<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: server/cmdline.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>cmdline.c File Reference</h1><code>#include "<a class="el" href="../../d7/d2/w32_2ntcon_2server_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d4/d0/server_2cmdline_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a0">COPY_TO_CHAR_PROMPT_LENGTH</a>&nbsp;&nbsp;&nbsp;26</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a1">COPY_FROM_CHAR_PROMPT_LENGTH</a>&nbsp;&nbsp;&nbsp;28</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a2">COMMAND_NUMBER_PROMPT_LENGTH</a>&nbsp;&nbsp;&nbsp;22</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a3">COMMAND_NUMBER_LENGTH</a>&nbsp;&nbsp;&nbsp;5</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a4">MINIMUM_COMMAND_PROMPT_SIZE</a>&nbsp;&nbsp;&nbsp;COMMAND_NUMBER_LENGTH</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(cch)&nbsp;&nbsp;&nbsp;((cch)/sizeof(WCHAR))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a6">ALT_PRESSED</a>&nbsp;&nbsp;&nbsp;(RIGHT_ALT_PRESSED | LEFT_ALT_PRESSED)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a7">CTRL_PRESSED</a>&nbsp;&nbsp;&nbsp;(RIGHT_CTRL_PRESSED | LEFT_CTRL_PRESSED)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a8">CTRL_BUT_NOT_ALT</a>(<a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a9">my_wcsncmpi</a>(p1, p2, <a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>)&nbsp;&nbsp;&nbsp;MyStringCompareW(p1, p2, <a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>, TRUE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a10">my_wcsncmp</a>(p1, p2, <a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>)&nbsp;&nbsp;&nbsp;MyStringCompareW(p1, p2, <a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>, FALSE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a11">MAX_ARGS</a>&nbsp;&nbsp;&nbsp;9</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a16">InitExtendedEditKeys</a> (CONST ExtKeyDefBuf *pKeyDefBuf)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CONST ExtKeySubst *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a17">ParseEditKeyInfo</a> (IN OUT PKEY_EVENT_RECORD pKeyEvent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a18">IsPauseKey</a> (IN PKEY_EVENT_RECORD pKeyEvent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a19">IsWordDelim</a> (WCHAR wch)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a20">AddExeAliasList</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> ExeName, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> ExeLength, IN BOOLEAN UnicodeExe)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a21">MyStringCompareW</a> (IN LPWSTR Str1, IN LPWSTR Str2, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> Length, IN BOOLEAN bCaseInsensitive)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a22">FindExe</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> ExeName, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> ExeLength, IN BOOLEAN UnicodeExe)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d6/struct__ALIAS.html">PALIAS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a23">FindAlias</a> (IN <a class="el" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> AliasList, IN LPWSTR AliasName, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> AliasLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a24">AddAlias</a> (IN <a class="el" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList, IN LPWSTR Source, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> SourceLength, IN LPWSTR Target, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> TargetLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a25">ReplaceAlias</a> (IN <a class="el" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias, IN LPWSTR Target, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> TargetLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a26">RemoveAlias</a> (IN <a class="el" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a27">FreeAliasList</a> (IN <a class="el" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a28">FreeAliasBuffers</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a29">SrvAddConsoleAlias</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a30">SrvGetConsoleAlias</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a31">SrvGetConsoleAliasesLength</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a32">ClearAliases</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a33">SrvGetConsoleAliases</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a34">SrvGetConsoleAliasExesLength</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a35">SrvGetConsoleAliasExes</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a36">MatchandCopyAlias</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN PWCHAR Source, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> SourceLength, OUT PWCHAR TargetBuffer, IN OUT <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a22">PUSHORT</a> TargetLength, IN LPWSTR Exe, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> ExeLength, OUT PDWORD LineCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a37">SrvExpungeConsoleCommandHistory</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a38">SrvSetConsoleNumberOfCommands</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a39">SrvGetConsoleCommandHistoryLength</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a40">SrvGetConsoleCommandHistory</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a41">SrvSetConsoleCommandHistoryMode</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a42">ReallocCommandHistory</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CurrentCommandHistory, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> NumCommands)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a43">FindExeCommandHistory</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN PVOID AppName, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> AppNameLength, IN BOOLEAN <a class="el" href="../../d3/d0/user32_8def.html#a97">Unicode</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a44">AllocateCommandHistory</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> AppNameLength, IN PWCHAR AppName, IN HANDLE ProcessHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a45">BeginPopup</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory, IN COORD PopupSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a46">EndPopup</a> (IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a47">CleanUpPopups</a> (IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a48">DeleteCommandLine</a> (IN OUT <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData, IN BOOL UpdateFields)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a49">RedrawCommandLine</a> (IN OUT <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a50">RetrieveNthCommand</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>, IN PWCHAR <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN ULONG <a class="el" href="../../d7/d2/rtqval_8c.html#a7">BufferSize</a>, OUT PULONG CommandSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a51">SetCurrentCommandLine</a> (IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a52">IsCommandLinePopupKey</a> (IN OUT PKEY_EVENT_RECORD KeyEvent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a53">IsCommandLineEditingKey</a> (IN PKEY_EVENT_RECORD KeyEvent)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a54">ProcessCommandListInput</a> (IN PVOID CookedReadDataPtr, IN PCSR_API_MSG WaitReplyMessage, IN PCSR_THREAD WaitingThread, IN BOOLEAN WaitRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a55">ProcessCopyFromCharInput</a> (IN PVOID CookedReadDataPtr, IN PCSR_API_MSG WaitReplyMessage, IN PCSR_THREAD WaitingThread, IN BOOLEAN WaitRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a56">ProcessCopyToCharInput</a> (IN PVOID CookedReadDataPtr, IN PCSR_API_MSG WaitReplyMessage, IN PCSR_THREAD WaitingThread, IN BOOLEAN WaitRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a57">ProcessCommandNumberInput</a> (IN PVOID CookedReadDataPtr, IN PCSR_API_MSG WaitReplyMessage, IN PCSR_THREAD WaitingThread, IN BOOLEAN WaitRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a58">CommandListPopup</a> (IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData, IN PCSR_API_MSG WaitReplyMessage, IN PCSR_THREAD WaitingThread, IN BOOLEAN WaitRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a59">DrawPromptPopup</a> (IN <a class="el" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup, IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN PWCHAR Prompt, IN ULONG PromptLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a60">CopyFromCharPopup</a> (IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData, IN PCSR_API_MSG WaitReplyMessage, IN PCSR_THREAD WaitingThread, IN BOOLEAN WaitRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a61">CopyToCharPopup</a> (IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData, IN PCSR_API_MSG WaitReplyMessage, IN PCSR_THREAD WaitingThread, IN BOOLEAN WaitRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a62">CommandNumberPopup</a> (IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData, IN PCSR_API_MSG WaitReplyMessage, IN PCSR_THREAD WaitingThread, IN BOOLEAN WaitRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a63">GetLastCommand</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a64">EmptyCommandHistory</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a65">AtFirstCommand</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a66">AtLastCommand</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a67">ProcessCommandLine</a> (IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData, IN WCHAR Char, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> KeyState, IN PCSR_API_MSG WaitReplyMessage, IN PCSR_THREAD WaitingThread, IN BOOLEAN WaitRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a68">RemoveCommand</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> iDel)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a69">FindMatchingCommand</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory, IN PWCHAR pwszIn, IN ULONG cbIn, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> CommandIndex, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a70">DrawCommandListBorder</a> (IN <a class="el" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup, IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a71">UpdateHighlight</a> (IN <a class="el" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> OldCurrentCommand, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> NewCurrentCommand, IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a72">DrawCommandListPopup</a> (IN <a class="el" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> CurrentCommand, IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory, IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a73">UpdateCommandListPopup</a> (IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> Delta, IN OUT <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a21">PSHORT</a> CurrentCommand, IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory, IN <a class="el" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup, IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a> ScreenInfo, IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> Flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a74">FindCommandHistory</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN HANDLE ProcessHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a75">FreeCommandHistory</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN HANDLE ProcessHandle)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a76">FreeCommandHistoryBuffers</a> (IN OUT <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a77">ResizeCommandHistoryBuffers</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console, IN UINT NumCommands)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a78">InitializeConsoleCommandData</a> (IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a79">ResetCommandHistory</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a80">AddCommand</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory, IN PWCHAR Command, IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a> Length, IN BOOL HistoryNoDup)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a81">RetrieveCommand</a> (IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory, IN WORD VirtualKeyCode, IN PWCHAR <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>, IN ULONG <a class="el" href="../../d7/d2/rtqval_8c.html#a7">BufferSize</a>, OUT PULONG CommandSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a82">SrvGetConsoleTitle</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a83">SrvSetConsoleTitle</a> (IN OUT PCSR_API_MSG m, IN OUT PCSR_REPLY_STATUS ReplyStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a84">LoadStringExW</a> (IN HINSTANCE hModule, IN UINT wID, OUT LPWSTR lpBuffer, IN int cchBufferMax, IN WORD wLangId)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ExtKeyDefTable&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a12">gaKeyDef</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CONST ExtKeyDefTable&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a13">gaDefaultKeyDef</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a14">gaWordDelimChars</a> [WORD_DELIM_MAX]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>CONST WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/server_2cmdline_8c.html#a15">gaWordDelimCharsDefault</a> [WORD_DELIM_MAX] = L"\\" L"+!:=/.&lt;&gt;;|&amp;"</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a6" doxytag="server/cmdline.c::ALT_PRESSED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ALT_PRESSED&nbsp;&nbsp;&nbsp;(RIGHT_ALT_PRESSED | LEFT_ALT_PRESSED)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00075">75</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00229">ParseEditKeyInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="server/cmdline.c::CHAR_COUNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CHAR_COUNT          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">cch&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((cch)/sizeof(WCHAR))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00071">71</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">SrvGetConsoleAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00903">SrvGetConsoleAliases()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01029">SrvGetConsoleAliasExes()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01500">SrvGetConsoleCommandHistory()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="server/cmdline.c::COMMAND_NUMBER_LENGTH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define COMMAND_NUMBER_LENGTH&nbsp;&nbsp;&nbsp;5          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00065">65</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03150">CommandNumberPopup()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="server/cmdline.c::COMMAND_NUMBER_PROMPT_LENGTH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define COMMAND_NUMBER_PROMPT_LENGTH&nbsp;&nbsp;&nbsp;22          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00064">64</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="server/cmdline.c::COPY_FROM_CHAR_PROMPT_LENGTH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define COPY_FROM_CHAR_PROMPT_LENGTH&nbsp;&nbsp;&nbsp;28          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00062">62</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="server/cmdline.c::COPY_TO_CHAR_PROMPT_LENGTH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define COPY_TO_CHAR_PROMPT_LENGTH&nbsp;&nbsp;&nbsp;26          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00061">61</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="server/cmdline.c::CTRL_BUT_NOT_ALT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CTRL_BUT_NOT_ALT          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(((<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>) &amp; (LEFT_CTRL_PRESSED | RIGHT_CTRL_PRESSED)) &amp;&amp; \
        !((<a class="code" href="../../d7/d0/exts_8h.html#a0">n</a>) &amp; (LEFT_ALT_PRESSED | RIGHT_ALT_PRESSED)))
</div></pre>
<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00078">78</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l02397">HandleKeyEvent()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00289">IsPauseKey()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="server/cmdline.c::CTRL_PRESSED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CTRL_PRESSED&nbsp;&nbsp;&nbsp;(RIGHT_CTRL_PRESSED | LEFT_CTRL_PRESSED)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00076">76</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00229">ParseEditKeyInfo()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="server/cmdline.c::MAX_ARGS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_ARGS&nbsp;&nbsp;&nbsp;9          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01102">1102</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01105">MatchandCopyAlias()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="server/cmdline.c::MINIMUM_COMMAND_PROMPT_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MINIMUM_COMMAND_PROMPT_SIZE&nbsp;&nbsp;&nbsp;COMMAND_NUMBER_LENGTH          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00066">66</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03150">CommandNumberPopup()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="server/cmdline.c::my_wcsncmp" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define my_wcsncmp          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">p1,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>p2,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;MyStringCompareW(p1, p2, <a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>, FALSE)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00391">391</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04078">FindMatchingCommand()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="server/cmdline.c::my_wcsncmpi" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define my_wcsncmpi          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">p1,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>p2,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;MyStringCompareW(p1, p2, <a class="el" href="../../d7/d0/exts_8h.html#a0">n</a>, TRUE)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00390">390</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01683">AllocateCommandHistory()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00447">FindAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a24" doxytag="server/cmdline.c::AddAlias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS AddAlias           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ExeAliasList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00483">483</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00064">ALIAS_TAG</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00161">_ALIAS::ListLink</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00164">_ALIAS::Source</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00162">_ALIAS::SourceLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00165">_ALIAS::Target</a>, and <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00163">_ALIAS::TargetLength</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>.
<p>
<pre class="fragment"><div>00497 {
00498     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
00499 
00500     Alias = (<a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( ALIAS_TAG ),<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d6/struct__ALIAS.html">ALIAS</a>));
00501     <span class="keywordflow">if</span> (Alias == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00502         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00503     }
00504     Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o3">Source</a> = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( ALIAS_TAG ),SourceLength);
00505     <span class="keywordflow">if</span> (Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o3">Source</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00506         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Alias);
00507         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00508     }
00509     Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a> = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( ALIAS_TAG ),TargetLength);
00510     <span class="keywordflow">if</span> (Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00511         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o3">Source</a>);
00512         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Alias);
00513         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00514     }
00515     Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a> = SourceLength;
00516     Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> = TargetLength;
00517     RtlCopyMemory(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o3">Source</a>,Source,SourceLength);
00518     RtlCopyMemory(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a>,Target,TargetLength);
00519     InsertHeadList(&amp;ExeAliasList-&gt;AliasList,&amp;Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o0">ListLink</a>);
00520     <span class="keywordflow">return</span> STATUS_SUCCESS;
00521 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a80" doxytag="server/cmdline.c::AddCommand" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS AddCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandHistory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Command</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>HistoryNoDup</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04744">4744</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00066">CLE_RESET</a>, <a class="el" href="../../d4/d1/cmdline_8h.html#a25">COMMAND</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00146">COMMAND_IND_INC</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00122">COMMAND_IND_PREV</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04078">FindMatchingCommand()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00306">FMCFL_EXACT_MATCH</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00065">HISTORY_TAG</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04026">RemoveCommand()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04726">ResetCommandHistory()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>.
<p>
<pre class="fragment"><div>04750 {
04751     <a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> *ppCmd;
04752     <span class="comment">//PWCHAR LastChar;</span>
04753 
04754     <span class="comment">// only add if doesn't match current command</span>
04755 
04756     <span class="keywordflow">if</span> (CommandHistory == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || CommandHistory-&gt;MaximumNumberOfCommands == 0) {
04757         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
04758     }
04759     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(CommandHistory-&gt;Flags &amp; CLE_ALLOCATED);
04760 
04761     <span class="comment">//</span>
04762     <span class="comment">// don't remove trailing blanks - prompt "asdf  " won't work.</span>
04763     <span class="comment">//</span>
04764     <span class="comment">//LastChar=Command+(Length/sizeof(WCHAR))-1;</span>
04765     <span class="comment">//while (Length &amp;&amp; *LastChar--==(WCHAR)' ') Length-=2;</span>
04766 
04767     <span class="keywordflow">if</span> (Length == 0) {
04768         <span class="keywordflow">return</span> STATUS_SUCCESS;
04769     }
04770 
04771     <span class="keywordflow">if</span> (CommandHistory-&gt;NumberOfCommands == 0 ||
04772         CommandHistory-&gt;Commands[CommandHistory-&gt;LastAdded]-&gt;CommandLength != Length ||
04773         memcmp(CommandHistory-&gt;Commands[CommandHistory-&gt;LastAdded]-&gt;Command,Command,Length)) {
04774 
04775         <a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> pCmdReuse = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04776 
04777         <span class="keywordflow">if</span> (HistoryNoDup) {
04778             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
04779             i = <a class="code" href="../../d4/d1/cmdline_8h.html#a56">FindMatchingCommand</a>(CommandHistory, Command, Length,
04780                     CommandHistory-&gt;LastDisplayed, FMCFL_EXACT_MATCH);
04781             <span class="keywordflow">if</span> (i != -1) {
04782                 pCmdReuse = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a68">RemoveCommand</a>(CommandHistory, i);
04783             }
04784         }
04785 
04786 
04787         <span class="comment">//</span>
04788         <span class="comment">// find free record.  if all records are used, free the lru one.</span>
04789         <span class="comment">//</span>
04790 
04791         <span class="keywordflow">if</span> (CommandHistory-&gt;NumberOfCommands &lt; CommandHistory-&gt;MaximumNumberOfCommands) {
04792             CommandHistory-&gt;LastAdded += 1;
04793             CommandHistory-&gt;NumberOfCommands++;
04794         }
04795         <span class="keywordflow">else</span> {
04796             <a class="code" href="../../d4/d1/cmdline_8h.html#a13">COMMAND_IND_INC</a>(CommandHistory-&gt;LastAdded, CommandHistory);
04797             <a class="code" href="../../d4/d1/cmdline_8h.html#a13">COMMAND_IND_INC</a>(CommandHistory-&gt;FirstCommand, CommandHistory);
04798             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(CommandHistory-&gt;Commands[CommandHistory-&gt;LastAdded]);
04799             <span class="keywordflow">if</span> (CommandHistory-&gt;LastDisplayed == CommandHistory-&gt;LastAdded) {
04800                 CommandHistory-&gt;LastDisplayed = -1;
04801             }
04802         }
04803 
04804         <span class="keywordflow">if</span> (CommandHistory-&gt;LastDisplayed == -1 ||
04805             CommandHistory-&gt;Commands[CommandHistory-&gt;LastDisplayed]-&gt;CommandLength != Length ||
04806                 memcmp(CommandHistory-&gt;Commands[CommandHistory-&gt;LastDisplayed]-&gt;Command,Command,Length)) {
04807             <a class="code" href="../../d8/d5/consrv_8h.html#a255">ResetCommandHistory</a>(CommandHistory);
04808         }
04809 
04810         <span class="comment">//</span>
04811         <span class="comment">// add command to array</span>
04812         <span class="comment">//</span>
04813 
04814         ppCmd = &amp;CommandHistory-&gt;Commands[CommandHistory-&gt;LastAdded];
04815         <span class="keywordflow">if</span> (pCmdReuse) {
04816             *ppCmd = pCmdReuse;
04817         } <span class="keywordflow">else</span> {
04818             *ppCmd = (<a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>( <a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>(HISTORY_TAG),
04819                     Length - <span class="keyword">sizeof</span>(WCHAR) + <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d7/struct__COMMAND.html">COMMAND</a>));
04820             <span class="keywordflow">if</span> (*ppCmd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04821                 <a class="code" href="../../d4/d1/cmdline_8h.html#a10">COMMAND_IND_PREV</a>(CommandHistory-&gt;LastAdded, CommandHistory);
04822                 CommandHistory-&gt;NumberOfCommands -= 1;
04823                 <span class="keywordflow">return</span> STATUS_NO_MEMORY;
04824             }
04825             (*ppCmd)-&gt;CommandLength = Length;
04826             RtlCopyMemory((*ppCmd)-&gt;Command,Command,Length);
04827         }
04828     }
04829     CommandHistory-&gt;Flags |= <a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>; <span class="comment">// remember that we've returned a cmd</span>
04830     <span class="keywordflow">return</span> STATUS_SUCCESS;
04831 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="server/cmdline.c::AddExeAliasList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> AddExeAliasList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ExeName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ExeLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>UnicodeExe</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00329">329</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00064">ALIAS_TAG</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00172">_EXE_ALIAS_LIST::AliasList</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01345">ConvertInputToUnicode()</a>, <a class="el" href="../../d4/d1/cmdline_8h.html#a36">EXE_ALIAS_LIST</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00170">_EXE_ALIAS_LIST::ExeLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00171">_EXE_ALIAS_LIST::ExeName</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00169">_EXE_ALIAS_LIST::ListLink</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>.
<p>
<pre class="fragment"><div>00335 {
00336     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> AliasList;
00337 
00338     AliasList = (<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( ALIAS_TAG ),<span class="keyword">sizeof</span>(<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">EXE_ALIAS_LIST</a>));
00339     <span class="keywordflow">if</span> (AliasList == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00340         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00341     }
00342     <span class="keywordflow">if</span> (UnicodeExe) {
00343         AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o2">ExeName</a> = (PWCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( ALIAS_TAG ),ExeLength);
00344         <span class="keywordflow">if</span> (AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o2">ExeName</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00345             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(AliasList);
00346             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00347         }
00348         RtlCopyMemory(AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o2">ExeName</a>,ExeName,ExeLength);
00349         AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a> = ExeLength;
00350     } <span class="keywordflow">else</span> {
00351         AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o2">ExeName</a> = (PWCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( ALIAS_TAG ),ExeLength*<span class="keyword">sizeof</span>(WCHAR));
00352         <span class="keywordflow">if</span> (AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o2">ExeName</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00353             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(AliasList);
00354             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00355         }
00356         AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(Console-&gt;CP,
00357                                                  ExeName,
00358                                                  ExeLength,
00359                                                  AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o2">ExeName</a>,
00360                                                  ExeLength);
00361         AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a> *= 2;
00362     }
00363     InitializeListHead(&amp;AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o3">AliasList</a>);
00364     InsertHeadList(&amp;Console-&gt;ExeAliasList,&amp;AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o0">ListLink</a>);
00365     <span class="keywordflow">return</span> AliasList;
00366 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="server/cmdline.c::AllocateCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> AllocateCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AppNameLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>AppName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessHandle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01683">1683</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00154">CLE_NO_POPUPS</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d7/d4/ioep_8h-source.html#l00067">DBGPRINT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00012">History</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00065">HISTORY_TAG</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00390">my_wcsncmpi</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01091">ConsoleClientConnectRoutine()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01537">SrvAllocConsole()</a>.
<p>
<pre class="fragment"><div>01692                    :
01693 
01694     This routine returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LRU command history buffer, or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command history
01695     buffer that corresponds to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> app name.
01696 
01697 Arguments:
01698 
01699     Console - pointer to console.
01700 
01701 Return Value:
01702 
01703     Pointer to command history buffer.  <span class="keywordflow">if</span> none are available, returns <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>.
01704 
01705 --*/
01706 
01707 {
01708     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>,BestCandidate;
01709     PLIST_ENTRY ListHead, ListNext;
01710     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> SameApp;
01711 
01712     <span class="comment">//</span>
01713     <span class="comment">// Reuse a history buffer.  The buffer must be !CLE_ALLOCATED.</span>
01714     <span class="comment">// If possible, the buffer should have the same app name.</span>
01715     <span class="comment">//</span>
01716 
01717     ListHead = &amp;Console-&gt;CommandHistoryList;
01718     ListNext = ListHead-&gt;Blink;
01719     BestCandidate = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01720     SameApp = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01721     <span class="keywordflow">while</span> (ListNext != ListHead) {
01722         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = CONTAINING_RECORD( ListNext, <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>, ListLink );
01723         ListNext = ListNext-&gt;Blink;
01724 
01725         <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>) == 0) {
01726 
01727             <span class="comment">//</span>
01728             <span class="comment">// use LRU history buffer with same app name</span>
01729             <span class="comment">//</span>
01730 
01731             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName &amp;&amp; !<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a9">my_wcsncmpi</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName,AppName,(USHORT)AppNameLength)) {
01732                 BestCandidate = <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
01733                 SameApp = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01734                 <span class="keywordflow">break</span>;
01735             }
01736 
01737             <span class="comment">//</span>
01738             <span class="comment">// second best choice is LRU history buffer</span>
01739             <span class="comment">//</span>
01740 
01741             <span class="keywordflow">if</span> (BestCandidate == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01742                 BestCandidate = <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
01743             }
01744         }
01745     }
01746 
01747     <span class="comment">//</span>
01748     <span class="comment">// if there isn't a free buffer for the app name and the maximum number of</span>
01749     <span class="comment">// command history buffers hasn't been allocated, allocate a new one.</span>
01750     <span class="comment">//</span>
01751 
01752     <span class="keywordflow">if</span> (!SameApp &amp;&amp; Console-&gt;NumCommandHistories &lt; Console-&gt;MaxCommandHistories) {
01753         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = (<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( HISTORY_TAG ),<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>) + ((Console-&gt;CommandHistorySize-1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a>)));
01754         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01755             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01756         }
01757         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( HISTORY_TAG ),AppNameLength);
01758         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01759             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(History);
01760             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01761         }
01762         RtlCopyMemory(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName,AppName,AppNameLength);
01763         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags = <a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>;
01764         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands = 0;
01765         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;LastAdded = -1;
01766         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;LastDisplayed = -1;
01767         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;FirstCommand = 0;
01768         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;MaximumNumberOfCommands = Console-&gt;CommandHistorySize;
01769         InsertHeadList(&amp;Console-&gt;CommandHistoryList,&amp;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;ListLink);
01770         Console-&gt;NumCommandHistories+=1;
01771         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;ProcessHandle = ProcessHandle;
01772         InitializeListHead(&amp;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;PopupList);
01773         <span class="keywordflow">return</span> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
01774     }
01775 
01776     <span class="comment">//</span>
01777     <span class="comment">// if the app name doesn't match, copy in the new app name and free the old commands.</span>
01778     <span class="comment">//</span>
01779 
01780     <span class="keywordflow">if</span> (BestCandidate) {
01781         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = BestCandidate;
01782         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d4/d1/cmdline_8h.html#a14">CLE_NO_POPUPS</a>(History));
01783         <span class="keywordflow">if</span> (!SameApp) {
01784             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
01785             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName) {
01786                 <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"Reusing %ls command history\n"</span>, <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName));
01787                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName);
01788             }
01789             <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands;i++) {
01790                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Commands[i]);
01791             }
01792             <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands = 0;
01793             <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;LastAdded = -1;
01794             <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;LastDisplayed = -1;
01795             <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;FirstCommand = 0;
01796             <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( HISTORY_TAG ),AppNameLength);
01797             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01798                 <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags &amp;= ~<a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>;
01799                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01800             }
01801             RtlCopyMemory(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName,AppName,AppNameLength);
01802         }
01803         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;ProcessHandle = ProcessHandle;
01804         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags |= <a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>;
01805 
01806         <span class="comment">//</span>
01807         <span class="comment">// move to the front of the list</span>
01808         <span class="comment">//</span>
01809 
01810         RemoveEntryList(&amp;BestCandidate-&gt;ListLink);
01811         InsertHeadList(&amp;Console-&gt;CommandHistoryList,&amp;BestCandidate-&gt;ListLink);
01812     }
01813     <span class="keywordflow">return</span> BestCandidate;
01814 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a65" doxytag="server/cmdline.c::AtFirstCommand" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL AtFirstCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CommandHistory</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03245">3245</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00066">CLE_RESET</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>.
<p>
<pre class="fragment"><div>03248 {
03249     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
03250 
03251     <span class="keywordflow">if</span> (CommandHistory==<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
03252         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03253     <span class="keywordflow">if</span> (CommandHistory-&gt;Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>)
03254         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03255     i = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CommandHistory-&gt;LastDisplayed - 1);
03256     <span class="keywordflow">if</span> (i==-1)
03257         i=(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CommandHistory-&gt;NumberOfCommands-1);
03258     <span class="keywordflow">return</span> (i == CommandHistory-&gt;LastAdded);
03259 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a66" doxytag="server/cmdline.c::AtLastCommand" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL AtLastCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CommandHistory</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03262">3262</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>.
<p>
<pre class="fragment"><div>03265 {
03266     <span class="keywordflow">if</span> (CommandHistory==<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
03267         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03268     <span class="keywordflow">return</span> (CommandHistory-&gt;LastDisplayed == CommandHistory-&gt;LastAdded);
03269 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="server/cmdline.c::BeginPopup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS BeginPopup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandHistory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN COORD&nbsp;</td>
          <td class="mdname" nowrap> <em>PopupSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01817">1817</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00044">_CLE_POPUP::Attributes</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00047">_CLE_POPUP::BottomIndex</a>, <a class="el" href="../../d4/d1/cmdline_8h.html#a28">CLE_POPUP</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00039">CLEPF_FALSE_UNICODE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00113">COMMAND_INDEX_TO_NUM</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00269">CONSOLE_WINDOW_SIZE_X</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00270">CONSOLE_WINDOW_SIZE_Y</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04123">DrawCommandListBorder()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00045">_CLE_POPUP::Flags</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00042">_CLE_POPUP::ListLink</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00046">_CLE_POPUP::OldContents</a>, <a class="el" href="../../d4/d1/cmdline_8h.html#a29">PCLE_POPUP</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01623">ReadScreenBuffer()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00043">_CLE_POPUP::Region</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, and <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>.
<p>
<pre class="fragment"><div>01822 {
01823     COORD Origin;
01824     COORD <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
01825     <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup;
01826     SMALL_RECT TargetRect;
01827 
01828     <span class="comment">// determine popup dimensions</span>
01829 
01830     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = PopupSize;
01831     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X += 2;    <span class="comment">// add borders</span>
01832     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y += 2;    <span class="comment">// add borders</span>
01833     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X &gt;= (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo))) {
01834         <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo));
01835     }
01836     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y &gt;= (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo))) {
01837         <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo));
01838     }
01839 
01840     <span class="comment">// make sure there's enough room for the popup borders</span>
01841 
01842     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X &lt; 2 || <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y &lt; 2) {
01843         <span class="keywordflow">return</span> STATUS_BUFFER_TOO_SMALL;
01844     }
01845 
01846     <span class="comment">// determine origin.  center popup on window</span>
01847     Origin.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((<a class="code" href="../../d7/d2/output_8h.html#a17">CONSOLE_WINDOW_SIZE_X</a>(ScreenInfo) - <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X) / 2 + ScreenInfo-&gt;Window.Left);
01848     Origin.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((<a class="code" href="../../d7/d2/output_8h.html#a18">CONSOLE_WINDOW_SIZE_Y</a>(ScreenInfo) - <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y) / 2 + ScreenInfo-&gt;Window.Top);
01849 
01850     <span class="comment">// allocate a popup structure</span>
01851 
01852     Popup = (<a class="code" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d0/struct__CLE__POPUP.html">CLE_POPUP</a>));
01853     <span class="keywordflow">if</span> (Popup == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01854         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01855     }
01856 
01857     <span class="comment">// allocate a buffer</span>
01858 
01859 <span class="preprocessor">#if !defined(FE_SB)</span>
01860 <span class="preprocessor"></span>    Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o4">OldContents</a> = (PCHAR_INFO)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X * <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y * <span class="keyword">sizeof</span>(CHAR_INFO));
01861 <span class="preprocessor">#else</span>
01862 <span class="preprocessor"></span>    Popup-&gt;OldScreenSize = ScreenInfo-&gt;ScreenBufferSize;
01863     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o4">OldContents</a> = (PCHAR_INFO)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),Popup-&gt;OldScreenSize.X * <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y * <span class="keyword">sizeof</span>(CHAR_INFO));
01864 <span class="preprocessor">#endif</span>
01865 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o4">OldContents</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01866         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Popup);
01867         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01868     }
01869     <span class="keywordflow">if</span> ((ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
01870             !(ScreenInfo-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN)) {
01871         Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o3">Flags</a> |= <a class="code" href="../../d4/d1/cmdline_8h.html#a0">CLEPF_FALSE_UNICODE</a>;
01872     } <span class="keywordflow">else</span> {
01873         Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o3">Flags</a> &amp;= ~<a class="code" href="../../d4/d1/cmdline_8h.html#a0">CLEPF_FALSE_UNICODE</a>;
01874     }
01875 
01876     <span class="comment">//</span>
01877     <span class="comment">// fill in popup structure</span>
01878     <span class="comment">//</span>
01879 
01880     InsertHeadList(&amp;CommandHistory-&gt;PopupList,&amp;Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o0">ListLink</a>);
01881     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Left = Origin.X;
01882     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Top = Origin.Y;
01883     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Right = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Origin.X + <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X - 1);
01884     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Bottom = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Origin.Y + <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y - 1);
01885     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o2">Attributes</a> = ScreenInfo-&gt;PopupAttributes;
01886     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o5">BottomIndex</a> = <a class="code" href="../../d4/d1/cmdline_8h.html#a9">COMMAND_INDEX_TO_NUM</a>(CommandHistory-&gt;LastDisplayed,CommandHistory);
01887 
01888     <span class="comment">//</span>
01889     <span class="comment">// copy old contents</span>
01890     <span class="comment">//</span>
01891 
01892 <span class="preprocessor">#if !defined(FE_SB)</span>
01893 <span class="preprocessor"></span>    TargetRect = Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>;
01894 <span class="preprocessor">#else</span>
01895 <span class="preprocessor"></span>    TargetRect.Left = 0;
01896     TargetRect.Top = Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Top;
01897     TargetRect.Right = Popup-&gt;OldScreenSize.X - 1;
01898     TargetRect.Bottom = Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Bottom;
01899 <span class="preprocessor">#endif</span>
01900 <span class="preprocessor"></span>    <a class="code" href="../../d6/d2/output_8c.html#a52">ReadScreenBuffer</a>(ScreenInfo,
01901                      Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o4">OldContents</a>,
01902                      &amp;TargetRect);
01903 
01904     ScreenInfo-&gt;Console-&gt;PopupCount++;
01905     <a class="code" href="../../d4/d1/cmdline_8h.html#a54">DrawCommandListBorder</a>(Popup,ScreenInfo);
01906     <span class="keywordflow">return</span> STATUS_SUCCESS;
01907 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="server/cmdline.c::CleanUpPopups" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CleanUpPopups           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CookedReadData</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01993">1993</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00154">CLE_NO_POPUPS</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01910">EndPopup()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01541">CookedReadWaitRoutine()</a>.
<p>
<pre class="fragment"><div>01996 {
01997     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory;
01998 
01999     CommandHistory = CookedReadData-&gt;CommandHistory;
02000     <span class="keywordflow">if</span> (!CommandHistory)
02001         <span class="keywordflow">return</span>;
02002     <span class="keywordflow">while</span> (!<a class="code" href="../../d4/d1/cmdline_8h.html#a14">CLE_NO_POPUPS</a>(CommandHistory)) {
02003         <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a46">EndPopup</a>(CookedReadData-&gt;ScreenInfo,CommandHistory);
02004     }
02005 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="server/cmdline.c::ClearAliases" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ClearAliases           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00878">878</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00172">_EXE_ALIAS_LIST::AliasList</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00552">RemoveAlias()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>.
<p>
<pre class="fragment"><div>00881 {
00882     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList;
00883     PLIST_ENTRY ListHead, ListNext;
00884     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
00885 
00886     ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a22">FindExe</a>(Console,
00887                            L<span class="stringliteral">"cmd.exe"</span>,
00888                            14,
00889                            TRUE);
00890     <span class="keywordflow">if</span> (ExeAliasList == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00891         <span class="keywordflow">return</span>;
00892     }
00893     ListHead = &amp;ExeAliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o3">AliasList</a>;
00894     ListNext = ListHead-&gt;Flink;
00895     <span class="keywordflow">while</span> (ListNext != ListHead) {
00896         Alias = CONTAINING_RECORD( ListNext, <a class="code" href="../../d1/d6/struct__ALIAS.html">ALIAS</a>, ListLink );
00897         ListNext = ListNext-&gt;Flink;
00898         <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a26">RemoveAlias</a>(Alias);
00899     }
00900 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a58" doxytag="server/cmdline.c::CommandListPopup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CommandListPopup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CookedReadData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitReplyMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitingThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02935">2935</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00047">_CLE_POPUP::BottomIndex</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00113">COMMAND_INDEX_TO_NUM</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00048">_CLE_POPUP::CurrentCommand</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04346">DrawCommandListPopup()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00074">_COMMAND_HISTORY::LastDisplayed</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00072">_COMMAND_HISTORY::NumberOfCommands</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00029">PCLE_POPUP_INPUT_ROUTINE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00058">POPUP_SIZE_Y</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00051">_CLE_POPUP::PopupInputRoutine</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00078">_COMMAND_HISTORY::PopupList</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>.
<p>
<pre class="fragment"><div>02948                 :
02949 
02950         <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a> - we ran <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of input, so
02951             a wait block was created
02952 
02953         STATUS_SUCCESS - read was fully completed (user hit <span class="keywordflow">return</span>)
02954 
02955 --*/
02956 
02957 {
02958     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> CurrentCommand;
02959     <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup;
02960     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory;
02961 
02962     CommandHistory = CookedReadData-&gt;CommandHistory;
02963     Popup = CONTAINING_RECORD( CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o9">PopupList</a>.Flink, <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">CLE_POPUP</a>, ListLink );
02964 
02965     CurrentCommand = <a class="code" href="../../d4/d1/cmdline_8h.html#a9">COMMAND_INDEX_TO_NUM</a>(CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o5">LastDisplayed</a>,CommandHistory);
02966 
02967     <span class="keywordflow">if</span> (CurrentCommand &lt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o3">NumberOfCommands</a> - <a class="code" href="../../d4/d1/cmdline_8h.html#a2">POPUP_SIZE_Y</a>(Popup))) {
02968         Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o5">BottomIndex</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(CurrentCommand,<a class="code" href="../../d4/d1/cmdline_8h.html#a2">POPUP_SIZE_Y</a>(Popup)-1));
02969     } <span class="keywordflow">else</span> {
02970         Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o5">BottomIndex</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o3">NumberOfCommands</a>-1);
02971     }
02972     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o6">CurrentCommand</a> = CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o5">LastDisplayed</a>;
02973     <a class="code" href="../../d4/d1/cmdline_8h.html#a61">DrawCommandListPopup</a>(Popup,
02974                          CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o5">LastDisplayed</a>,
02975                          CommandHistory,
02976                          CookedReadData-&gt;ScreenInfo);
02977     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o9">PopupInputRoutine</a> = (<a class="code" href="../../d4/d1/cmdline_8h.html#a27">PCLE_POPUP_INPUT_ROUTINE</a>) <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a54">ProcessCommandListInput</a>;
02978     <span class="keywordflow">return</span> <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a54">ProcessCommandListInput</a>(CookedReadData,
02979                                    WaitReplyMessage,
02980                                    WaitingThread,
02981                                    WaitRoutine
02982                                   );
02983 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a62" doxytag="server/cmdline.c::CommandNumberPopup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CommandNumberPopup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CookedReadData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitReplyMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitingThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03150">3150</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00065">COMMAND_NUMBER_LENGTH</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02986">DrawPromptPopup()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02643">GetConsoleLangId()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00027">ghInstance</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00157">LoadStringEx</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00066">MINIMUM_COMMAND_PROMPT_SIZE</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00030">msgCmdLineF9</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00050">_CLE_POPUP::NumberRead</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00029">PCLE_POPUP_INPUT_ROUTINE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00057">POPUP_SIZE_X</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00051">_CLE_POPUP::PopupInputRoutine</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00078">_COMMAND_HISTORY::PopupList</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02793">ProcessCommandNumberInput()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00043">_CLE_POPUP::Region</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00474">SetCursorPosition()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>.
<p>
<pre class="fragment"><div>03163                 :
03164 
03165         <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a> - we ran <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of input, so
03166             a wait block was created
03167 
03168         STATUS_SUCCESS - read was fully completed (user hit <span class="keywordflow">return</span>)
03169 
03170 --*/
03171 
03172 {
03173     <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup;
03174     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory;
03175     COORD CursorPosition;
03176     WCHAR ItemString[70];
03177     <span class="keywordtype">int</span> ItemLength;
03178     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03179     LANGID   LangId;
03180 
03181     CommandHistory = CookedReadData-&gt;CommandHistory;
03182     Popup = CONTAINING_RECORD( CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o9">PopupList</a>.Flink, <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">CLE_POPUP</a>, ListLink );
03183 
03184     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d5/srvinit_8c.html#a45">GetConsoleLangId</a>(CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;OutputCP, &amp;LangId);
03185     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
03186         ItemLength = <a class="code" href="../../d8/d5/consrv_8h.html#a34">LoadStringEx</a>(ghInstance,msgCmdLineF9,ItemString,70,LangId);
03187     }
03188     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) || ItemLength == 0) {
03189         ItemLength = LoadString(ghInstance,msgCmdLineF9,ItemString,70);
03190     }
03191 
03192     <span class="keywordflow">if</span> (ItemLength &gt; <a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup) - <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a3">COMMAND_NUMBER_LENGTH</a>) {
03193         ItemLength = <a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup) - <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a3">COMMAND_NUMBER_LENGTH</a>;
03194     }
03195     <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a59">DrawPromptPopup</a>(Popup,
03196                     CookedReadData-&gt;ScreenInfo,
03197                     ItemString,
03198                     ItemLength
03199                    );
03200     CursorPosition.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Right - <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a4">MINIMUM_COMMAND_PROMPT_SIZE</a>);
03201     CursorPosition.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Top+1);
03202     <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a7">SetCursorPosition</a>(CookedReadData-&gt;ScreenInfo,
03203                       CursorPosition,
03204                       TRUE
03205                      );
03206     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o8">NumberRead</a>=0;
03207     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o9">PopupInputRoutine</a> = (<a class="code" href="../../d4/d1/cmdline_8h.html#a27">PCLE_POPUP_INPUT_ROUTINE</a>) <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a57">ProcessCommandNumberInput</a>;
03208     <span class="keywordflow">return</span> <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a57">ProcessCommandNumberInput</a>(CookedReadData,
03209                                      WaitReplyMessage,
03210                                      WaitingThread,
03211                                      WaitRoutine
03212                                     );
03213 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a60" doxytag="server/cmdline.c::CopyFromCharPopup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CopyFromCharPopup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CookedReadData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitReplyMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitingThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03040">3040</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02986">DrawPromptPopup()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02643">GetConsoleLangId()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00027">ghInstance</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00157">LoadStringEx</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00029">msgCmdLineF4</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00029">PCLE_POPUP_INPUT_ROUTINE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00051">_CLE_POPUP::PopupInputRoutine</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00078">_COMMAND_HISTORY::PopupList</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02546">ProcessCopyFromCharInput()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>.
<p>
<pre class="fragment"><div>03053                 :
03054 
03055         <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a> - we ran <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of input, so
03056             a wait block was created
03057 
03058         STATUS_SUCCESS - read was fully completed (user hit <span class="keywordflow">return</span>)
03059 
03060 --*/
03061 
03062 {
03063     <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup;
03064     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory;
03065     WCHAR ItemString[70];
03066     <span class="keywordtype">int</span> ItemLength;
03067     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03068     LANGID   LangId;
03069 
03070     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d5/srvinit_8c.html#a45">GetConsoleLangId</a>(CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;OutputCP, &amp;LangId);
03071     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
03072         ItemLength = <a class="code" href="../../d8/d5/consrv_8h.html#a34">LoadStringEx</a>(ghInstance,msgCmdLineF4,ItemString,70,LangId);
03073     }
03074     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) || ItemLength == 0) {
03075         ItemLength = LoadString(ghInstance,msgCmdLineF4,ItemString,70);
03076     }
03077 
03078     CommandHistory = CookedReadData-&gt;CommandHistory;
03079     Popup = CONTAINING_RECORD( CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o9">PopupList</a>.Flink, <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">CLE_POPUP</a>, ListLink );
03080 
03081     <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a59">DrawPromptPopup</a>(Popup,
03082                     CookedReadData-&gt;ScreenInfo,
03083                     ItemString,
03084                     ItemLength
03085                    );
03086     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o9">PopupInputRoutine</a> = (<a class="code" href="../../d4/d1/cmdline_8h.html#a27">PCLE_POPUP_INPUT_ROUTINE</a>) <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a55">ProcessCopyFromCharInput</a>;
03087     <span class="keywordflow">return</span> <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a55">ProcessCopyFromCharInput</a>(CookedReadData,
03088                                   WaitReplyMessage,
03089                                   WaitingThread,
03090                                   WaitRoutine
03091                                  );
03092 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a61" doxytag="server/cmdline.c::CopyToCharPopup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS CopyToCharPopup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CookedReadData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitReplyMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitingThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03096">3096</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02986">DrawPromptPopup()</a>, <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02643">GetConsoleLangId()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00027">ghInstance</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00157">LoadStringEx</a>, <a class="el" href="../../d7/d6/menu_8h-source.html#l00028">msgCmdLineF2</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00029">PCLE_POPUP_INPUT_ROUTINE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00051">_CLE_POPUP::PopupInputRoutine</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00078">_COMMAND_HISTORY::PopupList</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02677">ProcessCopyToCharInput()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>.
<p>
<pre class="fragment"><div>03109                 :
03110 
03111         <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a> - we ran <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of input, so
03112             a wait block was created
03113 
03114         STATUS_SUCCESS - read was fully completed (user hit <span class="keywordflow">return</span>)
03115 
03116 --*/
03117 
03118 {
03119     <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup;
03120     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory;
03121     WCHAR ItemString[70];
03122     <span class="keywordtype">int</span> ItemLength;
03123     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03124     LANGID   LangId;
03125 
03126     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d5/srvinit_8c.html#a45">GetConsoleLangId</a>(CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;OutputCP, &amp;LangId);
03127     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
03128         ItemLength = <a class="code" href="../../d8/d5/consrv_8h.html#a34">LoadStringEx</a>(ghInstance,msgCmdLineF2,ItemString,70,LangId);
03129     }
03130     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) || ItemLength == 0) {
03131         ItemLength = LoadString(ghInstance,msgCmdLineF2,ItemString,70);
03132     }
03133 
03134     CommandHistory = CookedReadData-&gt;CommandHistory;
03135     Popup = CONTAINING_RECORD( CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o9">PopupList</a>.Flink, <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">CLE_POPUP</a>, ListLink );
03136     <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a59">DrawPromptPopup</a>(Popup,
03137                     CookedReadData-&gt;ScreenInfo,
03138                     ItemString,
03139                     ItemLength
03140                    );
03141     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o9">PopupInputRoutine</a> = (<a class="code" href="../../d4/d1/cmdline_8h.html#a27">PCLE_POPUP_INPUT_ROUTINE</a>) <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a56">ProcessCopyToCharInput</a>;
03142     <span class="keywordflow">return</span> <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a56">ProcessCopyToCharInput</a>(CookedReadData,
03143                                   WaitReplyMessage,
03144                                   WaitingThread,
03145                                   WaitRoutine
03146                                  );
03147 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="server/cmdline.c::DeleteCommandLine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DeleteCommandLine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CookedReadData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>UpdateFields</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02009">2009</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00272">CONSOLE_FALSE_UNICODE</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00075">FillOutput</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00474">SetCursorPosition()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02793">ProcessCommandNumberInput()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00876">ProcessCookedReadInput()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02546">ProcessCopyFromCharInput()</a>, <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02136">SetCurrentCommandLine()</a>.
<p>
<pre class="fragment"><div>02013 {
02014     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CharsToWrite = CookedReadData-&gt;NumberOfVisibleChars;
02015     COORD Coord = CookedReadData-&gt;OriginalCursorPosition;
02016 
02017     <span class="comment">//</span>
02018     <span class="comment">// catch the case where the current command has scrolled off the</span>
02019     <span class="comment">// top of the screen.</span>
02020     <span class="comment">//</span>
02021 
02022     <span class="keywordflow">if</span> (Coord.Y &lt; 0) {
02023         CharsToWrite += CookedReadData-&gt;ScreenInfo-&gt;ScreenBufferSize.X * Coord.Y;
02024         CharsToWrite += CookedReadData-&gt;OriginalCursorPosition.X;   <span class="comment">// account for prompt</span>
02025         CookedReadData-&gt;OriginalCursorPosition.X = 0;
02026         CookedReadData-&gt;OriginalCursorPosition.Y = 0;
02027         Coord.X = 0;
02028         Coord.Y = 0;
02029     }
02030 <span class="preprocessor">#if defined(FE_SB)</span>
02031 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (CONSOLE_IS_DBCS_OUTPUTCP(CookedReadData-&gt;ScreenInfo-&gt;Console) &amp;&amp;
02032         !CheckBisectStringW(CookedReadData-&gt;ScreenInfo,
02033                            CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;CP,
02034                            CookedReadData-&gt;BackupLimit,
02035                            CharsToWrite,
02036                            CookedReadData-&gt;ScreenInfo-&gt;ScreenBufferSize.X
02037                             -CookedReadData-&gt;OriginalCursorPosition.X
02038                            )) {
02039         CharsToWrite++;
02040     }
02041 <span class="preprocessor">#endif</span>
02042 <span class="preprocessor"></span>    <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(CookedReadData-&gt;ScreenInfo,
02043                (WCHAR)<span class="charliteral">' '</span>,
02044                Coord,
02045                CONSOLE_FALSE_UNICODE, <span class="comment">// faster than real unicode</span>
02046                &amp;CharsToWrite
02047               );
02048     <span class="keywordflow">if</span> (UpdateFields) {
02049         CookedReadData-&gt;BufPtr=CookedReadData-&gt;BackupLimit;
02050         CookedReadData-&gt;BytesRead=0;
02051         CookedReadData-&gt;CurrentPosition=0;
02052         CookedReadData-&gt;NumberOfVisibleChars = 0;
02053     }
02054     <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a7">SetCursorPosition</a>(CookedReadData-&gt;ScreenInfo,
02055                       CookedReadData-&gt;OriginalCursorPosition,
02056                       TRUE
02057                      );
02058 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a70" doxytag="server/cmdline.c::DrawCommandListBorder" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DrawCommandListBorder           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Popup</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04123">4123</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00271">CONSOLE_ATTRIBUTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00270">CONSOLE_REAL_UNICODE</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00714">else</a>, <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00075">FillOutput</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00057">POPUP_SIZE_X</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00058">POPUP_SIZE_Y</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01817">BeginPopup()</a>.
<p>
<pre class="fragment"><div>04127 {
04128     COORD WriteCoord;
04129     ULONG Length;
04130     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
04131 
04132     <span class="comment">//</span>
04133     <span class="comment">// fill attributes of top line</span>
04134     <span class="comment">//</span>
04135     WriteCoord.X = Popup-&gt;Region.Left;
04136     WriteCoord.Y = Popup-&gt;Region.Top;
04137     Length = <a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup) + 2;
04138     <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04139                Popup-&gt;Attributes,
04140                WriteCoord,
04141                CONSOLE_ATTRIBUTE,
04142                &amp;Length
04143               );
04144     <span class="comment">//</span>
04145     <span class="comment">// draw upper left corner</span>
04146     <span class="comment">//</span>
04147     Length = 1;
04148     <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04149 #<span class="keywordflow">if</span> defined(FE_SB)
04150                ScreenInfo-&gt;LineChar[UPPER_LEFT_CORNER],
04151 #<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a85">else</a>
04152                (WCHAR)0x250c,
04153 #endif
04154                WriteCoord,
04155                CONSOLE_REAL_UNICODE,
04156                &amp;Length
04157               );
04158 
04159     <span class="comment">//</span>
04160     <span class="comment">// draw upper bar</span>
04161     <span class="comment">//</span>
04162 
04163     WriteCoord.X += 1;
04164     Length = <a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup);
04165     <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04166 #<span class="keywordflow">if</span> defined(FE_SB)
04167                ScreenInfo-&gt;LineChar[HORIZONTAL_LINE],
04168 #<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a85">else</a>
04169                (WCHAR)0x2500,
04170 #endif
04171                WriteCoord,
04172                CONSOLE_REAL_UNICODE,
04173                &amp;Length
04174               );
04175 
04176     <span class="comment">//</span>
04177     <span class="comment">// draw upper right corner</span>
04178     <span class="comment">//</span>
04179 
04180     WriteCoord.X = Popup-&gt;Region.Right;
04181     Length = 1;
04182     <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04183 #<span class="keywordflow">if</span> defined(FE_SB)
04184                ScreenInfo-&gt;LineChar[UPPER_RIGHT_CORNER],
04185 #<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a85">else</a>
04186                (WCHAR)0x2510,
04187 #endif
04188                WriteCoord,
04189                CONSOLE_REAL_UNICODE,
04190                &amp;Length
04191               );
04192 
04193     <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d4/d1/cmdline_8h.html#a2">POPUP_SIZE_Y</a>(Popup);i++) {
04194         WriteCoord.Y += 1;
04195         WriteCoord.X = Popup-&gt;Region.Left;
04196 
04197         <span class="comment">//</span>
04198         <span class="comment">// fill attributes</span>
04199         <span class="comment">//</span>
04200 
04201         Length = <a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup) + 2;
04202         <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04203                    Popup-&gt;Attributes,
04204                    WriteCoord,
04205                    CONSOLE_ATTRIBUTE,
04206                    &amp;Length
04207                   );
04208         Length = 1;
04209         <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04210 #<span class="keywordflow">if</span> defined(FE_SB)
04211                    ScreenInfo-&gt;LineChar[VERTICAL_LINE],
04212 #<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a85">else</a>
04213                    (WCHAR)0x2502,
04214 #endif
04215                    WriteCoord,
04216                    CONSOLE_REAL_UNICODE,
04217                    &amp;Length
04218                   );
04219         WriteCoord.X = Popup-&gt;Region.Right;
04220         Length = 1;
04221         <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04222 #<span class="keywordflow">if</span> defined(FE_SB)
04223                    ScreenInfo-&gt;LineChar[VERTICAL_LINE],
04224 #<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a85">else</a>
04225                    (WCHAR)0x2502,
04226 #endif
04227                    WriteCoord,
04228                    CONSOLE_REAL_UNICODE,
04229                    &amp;Length
04230                   );
04231     }
04232 
04233     <span class="comment">//</span>
04234     <span class="comment">// draw bottom line</span>
04235     <span class="comment">//</span>
04236     <span class="comment">// fill attributes of top line</span>
04237     <span class="comment">//</span>
04238 
04239     WriteCoord.X = Popup-&gt;Region.Left;
04240     WriteCoord.Y = Popup-&gt;Region.Bottom;
04241     Length = <a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup) + 2;
04242     <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04243                Popup-&gt;Attributes,
04244                WriteCoord,
04245                CONSOLE_ATTRIBUTE,
04246                &amp;Length
04247               );
04248     <span class="comment">//</span>
04249     <span class="comment">// draw bottom left corner</span>
04250     <span class="comment">//</span>
04251 
04252     Length = 1;
04253     WriteCoord.X = Popup-&gt;Region.Left;
04254     <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04255 #<span class="keywordflow">if</span> defined(FE_SB)
04256                ScreenInfo-&gt;LineChar[BOTTOM_LEFT_CORNER],
04257 #<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a85">else</a>
04258                (WCHAR)0x2514,
04259 #endif
04260                WriteCoord,
04261                CONSOLE_REAL_UNICODE,
04262                &amp;Length
04263               );
04264 
04265     <span class="comment">//</span>
04266     <span class="comment">// draw lower bar</span>
04267     <span class="comment">//</span>
04268 
04269     WriteCoord.X += 1;
04270     Length = <a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup);
04271     <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04272 #<span class="keywordflow">if</span> defined(FE_SB)
04273                ScreenInfo-&gt;LineChar[HORIZONTAL_LINE],
04274 #<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a85">else</a>
04275                (WCHAR)0x2500,
04276 #endif
04277                WriteCoord,
04278                CONSOLE_REAL_UNICODE,
04279                &amp;Length
04280               );
04281 
04282     <span class="comment">//</span>
04283     <span class="comment">// draw lower right corner</span>
04284     <span class="comment">//</span>
04285 
04286     WriteCoord.X = Popup-&gt;Region.Right;
04287     Length = 1;
04288     <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04289 #<span class="keywordflow">if</span> defined(FE_SB)
04290                ScreenInfo-&gt;LineChar[BOTTOM_RIGHT_CORNER],
04291 #<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a85">else</a>
04292                (WCHAR)0x2518,
04293 #endif
04294                WriteCoord,
04295                CONSOLE_REAL_UNICODE,
04296                &amp;Length
04297               );
04298 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a72" doxytag="server/cmdline.c::DrawCommandListPopup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DrawCommandListPopup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Popup</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CurrentCommand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandHistory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04346">4346</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00112">COMMAND_NUM_TO_INDEX</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00059">COMMAND_NUMBER_SIZE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00269">CONSOLE_ASCII</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00271">CONSOLE_ATTRIBUTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00272">CONSOLE_FALSE_UNICODE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00270">CONSOLE_REAL_UNICODE</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01676">FalseUnicodeToRealUnicode()</a>, <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00075">FillOutput</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00057">POPUP_SIZE_X</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00058">POPUP_SIZE_Y</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00039">WriteOutputString</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02935">CommandListPopup()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04500">UpdateCommandListPopup()</a>.
<p>
<pre class="fragment"><div>04352 {
04353     WORD Attributes;
04354     ULONG lStringLength,CommandNumberLength;
04355     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> CommandNumber[<a class="code" href="../../d4/d1/cmdline_8h.html#a3">COMMAND_NUMBER_SIZE</a>];
04356     PCHAR CommandNumberPtr;
04357     COORD WriteCoord;
04358     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
04359 
04360     <span class="comment">//</span>
04361     <span class="comment">// draw empty popup</span>
04362     <span class="comment">//</span>
04363 
04364     WriteCoord.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;Region.Left+1);
04365     WriteCoord.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;Region.Top+1);
04366     lStringLength = <a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup);
04367     <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d4/d1/cmdline_8h.html#a2">POPUP_SIZE_Y</a>(Popup);i++) {
04368         <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04369                    Popup-&gt;Attributes,
04370                    WriteCoord,
04371                    CONSOLE_ATTRIBUTE,
04372                    &amp;lStringLength
04373                   );
04374         <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04375                    (WCHAR)<span class="charliteral">' '</span>,
04376                    WriteCoord,
04377                    CONSOLE_FALSE_UNICODE, <span class="comment">// faster than real unicode</span>
04378                    &amp;lStringLength
04379                   );
04380         WriteCoord.Y += 1;
04381     }
04382 
04383     WriteCoord.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;Region.Top+1);
04384     <span class="keywordflow">for</span> (i=<a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>((SHORT)(Popup-&gt;BottomIndex-<a class="code" href="../../d4/d1/cmdline_8h.html#a2">POPUP_SIZE_Y</a>(Popup)+1),0);i&lt;=Popup-&gt;BottomIndex;i++) {
04385 
04386         <span class="comment">//</span>
04387         <span class="comment">// write command number to screen</span>
04388         <span class="comment">//</span>
04389 
04390         CommandNumberPtr = _itoa(i,CommandNumber,10);
04391         CommandNumberLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)lstrlenA(CommandNumberPtr);
04392         CommandNumber[CommandNumberLength] = <span class="charliteral">':'</span>;
04393         CommandNumber[CommandNumberLength+1] = <span class="charliteral">' '</span>;
04394         CommandNumberLength+=2;
04395         <span class="keywordflow">if</span> (CommandNumberLength &gt; (ULONG)<a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup))
04396             CommandNumberLength = (ULONG)<a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup);
04397         WriteCoord.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;Region.Left+1);
04398         <a class="code" href="../../d6/d8/dispatch_8h.html#a2">WriteOutputString</a>(ScreenInfo,
04399                           CommandNumberPtr,
04400                           WriteCoord,
04401                           CONSOLE_ASCII,
04402                           &amp;CommandNumberLength,
04403                           NULL
04404                          );
04405 
04406         <span class="comment">//</span>
04407         <span class="comment">// write command to screen</span>
04408         <span class="comment">//</span>
04409 
04410         lStringLength = CommandHistory-&gt;Commands[<a class="code" href="../../d4/d1/cmdline_8h.html#a8">COMMAND_NUM_TO_INDEX</a>(i,CommandHistory)]-&gt;CommandLength/<span class="keyword">sizeof</span>(WCHAR);
04411 <span class="preprocessor">#if defined(FE_SB)</span>
04412 <span class="preprocessor"></span>        {
04413             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> lTmpStringLength;
04414             LONG lPopupLength;
04415             LPWSTR lpStr;
04416 
04417             lTmpStringLength = lStringLength;
04418             lPopupLength = <a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup) - CommandNumberLength;
04419             lpStr = CommandHistory-&gt;Commands[<a class="code" href="../../d4/d1/cmdline_8h.html#a8">COMMAND_NUM_TO_INDEX</a>(i,CommandHistory)]-&gt;Command;
04420             <span class="keywordflow">while</span> (lTmpStringLength--) {
04421                 <span class="keywordflow">if</span> (IsConsoleFullWidth(ScreenInfo-&gt;Console-&gt;hDC,
04422                                        ScreenInfo-&gt;Console-&gt;OutputCP,*lpStr++)) {
04423                     lPopupLength -= 2;
04424                 }
04425                 <span class="keywordflow">else</span> {
04426                     lPopupLength--;
04427                 }
04428                 <span class="keywordflow">if</span> (lPopupLength &lt;= 0) {
04429                     lStringLength -= lTmpStringLength;
04430                     <span class="keywordflow">if</span> (lPopupLength &lt; 0)
04431                         lStringLength--;
04432                     <span class="keywordflow">break</span>;
04433                 }
04434             }
04435         }
04436 <span class="preprocessor">#else</span>
04437 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ((lStringLength+CommandNumberLength) &gt; (ULONG)<a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup))
04438             lStringLength = (ULONG)(<a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup)-CommandNumberLength);
04439 <span class="preprocessor">#endif</span>
04440 <span class="preprocessor"></span>        WriteCoord.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(WriteCoord.X + CommandNumberLength);
04441 <span class="preprocessor">#if defined(FE_SB)</span>
04442 <span class="preprocessor"></span>        {
04443             PWCHAR TransBuffer;
04444 
04445             TransBuffer = <a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_DBCS_TAG ),lStringLength * <span class="keyword">sizeof</span>(WCHAR));
04446             <span class="keywordflow">if</span> (TransBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04447                 <span class="keywordflow">return</span>;
04448             }
04449 
04450             RtlCopyMemory(TransBuffer,CommandHistory-&gt;Commands[<a class="code" href="../../d4/d1/cmdline_8h.html#a8">COMMAND_NUM_TO_INDEX</a>(i,CommandHistory)]-&gt;Command,lStringLength * <span class="keyword">sizeof</span>(WCHAR));
04451             <a class="code" href="../../d6/d8/dispatch_8h.html#a2">WriteOutputString</a>(ScreenInfo,
04452                               TransBuffer,
04453                               WriteCoord,
04454                               CONSOLE_REAL_UNICODE,
04455                               &amp;lStringLength,
04456                               NULL
04457                              );
04458             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TransBuffer);
04459         }
04460 <span class="preprocessor">#else</span>
04461 <span class="preprocessor"></span>        <a class="code" href="../../d6/d8/dispatch_8h.html#a2">WriteOutputString</a>(ScreenInfo,
04462                           CommandHistory-&gt;Commands[<a class="code" href="../../d4/d1/cmdline_8h.html#a8">COMMAND_NUM_TO_INDEX</a>(i,CommandHistory)]-&gt;Command,
04463                           WriteCoord,
04464                           CONSOLE_REAL_UNICODE,
04465                           &amp;lStringLength,
04466                           NULL
04467                          );
04468         <span class="comment">// convert back to true unicode (got converted by WriteOutputString)</span>
04469         <span class="keywordflow">if</span> ((ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
04470                 !(ScreenInfo-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN)) {
04471             <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a43">FalseUnicodeToRealUnicode</a>(CommandHistory-&gt;Commands[<a class="code" href="../../d4/d1/cmdline_8h.html#a8">COMMAND_NUM_TO_INDEX</a>(i,CommandHistory)]-&gt;Command,
04472                     lStringLength,
04473                     ScreenInfo-&gt;Console-&gt;OutputCP);
04474         }
04475 <span class="preprocessor">#endif</span>
04476 <span class="preprocessor"></span>
04477         <span class="comment">//</span>
04478         <span class="comment">// write attributes to screen</span>
04479         <span class="comment">//</span>
04480 
04481         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/cmdline_8h.html#a8">COMMAND_NUM_TO_INDEX</a>(i,CommandHistory) == CurrentCommand) {
04482             WriteCoord.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;Region.Left+1);
04483             <span class="comment">// inverted attributes</span>
04484             Attributes = (WORD)(((Popup-&gt;Attributes &lt;&lt; 4) &amp; 0xf0) |
04485                                 ((Popup-&gt;Attributes &gt;&gt; 4) &amp; 0x0f));
04486             lStringLength = <a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup);
04487             <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04488                        Attributes,
04489                        WriteCoord,
04490                        CONSOLE_ATTRIBUTE,
04491                        &amp;lStringLength
04492                       );
04493         }
04494 
04495         WriteCoord.Y += 1;
04496     }
04497 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a59" doxytag="server/cmdline.c::DrawPromptPopup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DrawPromptPopup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Popup</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Prompt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PromptLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02986">2986</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00271">CONSOLE_ATTRIBUTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00272">CONSOLE_FALSE_UNICODE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00270">CONSOLE_REAL_UNICODE</a>, <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00075">FillOutput</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00057">POPUP_SIZE_X</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00058">POPUP_SIZE_Y</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00039">WriteOutputString</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03150">CommandNumberPopup()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03040">CopyFromCharPopup()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03096">CopyToCharPopup()</a>.
<p>
<pre class="fragment"><div>02992 {
02993     ULONG lStringLength;
02994     COORD WriteCoord;
02995     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
02996 
02997     <span class="comment">//</span>
02998     <span class="comment">// draw empty popup</span>
02999     <span class="comment">//</span>
03000 
03001     WriteCoord.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;Region.Left+1);
03002     WriteCoord.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;Region.Top+1);
03003     lStringLength = <a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup);
03004     <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d4/d1/cmdline_8h.html#a2">POPUP_SIZE_Y</a>(Popup);i++) {
03005         <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
03006                    Popup-&gt;Attributes,
03007                    WriteCoord,
03008                    CONSOLE_ATTRIBUTE,
03009                    &amp;lStringLength
03010                   );
03011         <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
03012                    (WCHAR)<span class="charliteral">' '</span>,
03013                    WriteCoord,
03014                    CONSOLE_FALSE_UNICODE, <span class="comment">// faster that real unicode</span>
03015                    &amp;lStringLength
03016                   );
03017         WriteCoord.Y += 1;
03018     }
03019 
03020     WriteCoord.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;Region.Left+1);
03021     WriteCoord.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;Region.Top+1);
03022 
03023     <span class="comment">//</span>
03024     <span class="comment">// write prompt to screen</span>
03025     <span class="comment">//</span>
03026 
03027     lStringLength = PromptLength;
03028     <span class="keywordflow">if</span> (lStringLength &gt; (ULONG)<a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup))
03029     lStringLength = (ULONG)(<a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup));
03030     <a class="code" href="../../d6/d8/dispatch_8h.html#a2">WriteOutputString</a>(ScreenInfo,
03031                       Prompt,
03032                       WriteCoord,
03033                       CONSOLE_REAL_UNICODE,
03034                       &amp;lStringLength,
03035                       NULL
03036                      );
03037 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a64" doxytag="server/cmdline.c::EmptyCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID EmptyCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CommandHistory</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03227">3227</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00066">CLE_RESET</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01393">SrvExpungeConsoleCommandHistory()</a>.
<p>
<pre class="fragment"><div>03230 {
03231     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
03232     <span class="keywordflow">if</span> (CommandHistory==<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
03233         <span class="keywordflow">return</span>;
03234     <span class="keywordflow">for</span> (i=0;i&lt;CommandHistory-&gt;NumberOfCommands;i++) {
03235         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(CommandHistory-&gt;Commands[i]);
03236     }
03237     CommandHistory-&gt;NumberOfCommands = 0;
03238     CommandHistory-&gt;LastAdded = -1;
03239     CommandHistory-&gt;LastDisplayed = -1;
03240     CommandHistory-&gt;FirstCommand = 0;
03241     CommandHistory-&gt;Flags = <a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>;
03242 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="server/cmdline.c::EndPopup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS EndPopup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandHistory</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01910">1910</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00154">CLE_NO_POPUPS</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00039">CLEPF_FALSE_UNICODE</a>, <a class="el" href="../../d8/d1/output_8h-source.html#l00150">CONSOLE_OEMFONT_DISPLAY</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00207">ConsoleHideCursor()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00176">ConsoleShowCursor()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00045">_CLE_POPUP::Flags</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00042">_CLE_POPUP::ListLink</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00046">_CLE_POPUP::OldContents</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00043">_CLE_POPUP::Region</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d6/d8/dispatch_8h.html#a13">TranslateOutputToAnsiUnicode()</a>, <a class="el" href="../../d6/d8/dispatch_8h.html#a16">TranslateOutputToOemUnicode()</a>, <a class="el" href="../../d7/d1/output_8c-source.html#l01706">WriteScreenBuffer()</a>, and <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00061">WriteToScreen</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01993">CleanUpPopups()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02793">ProcessCommandNumberInput()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02546">ProcessCopyFromCharInput()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02677">ProcessCopyToCharInput()</a>.
<p>
<pre class="fragment"><div>01914 {
01915     COORD <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
01916     SMALL_RECT SourceRect;
01917     <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup;
01918 
01919     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(!<a class="code" href="../../d4/d1/cmdline_8h.html#a14">CLE_NO_POPUPS</a>(CommandHistory));
01920     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/cmdline_8h.html#a14">CLE_NO_POPUPS</a>(CommandHistory))
01921         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01922 
01923     <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a3">ConsoleHideCursor</a>(ScreenInfo);
01924     Popup = CONTAINING_RECORD( CommandHistory-&gt;PopupList.Flink, <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">CLE_POPUP</a>, ListLink );
01925 
01926     <span class="comment">//</span>
01927     <span class="comment">// restore previous contents to screen</span>
01928     <span class="comment">//</span>
01929 
01930 <span class="preprocessor">#if !defined(FE_SB)</span>
01931 <span class="preprocessor"></span>    <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Right - Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Left + 1);
01932     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Bottom - Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Top + 1);
01933     SourceRect = Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>;
01934 <span class="preprocessor">#else</span>
01935 <span class="preprocessor"></span>    <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.X = Popup-&gt;OldScreenSize.X;
01936     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Bottom - Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Top + 1);
01937     SourceRect.Left = 0;
01938     SourceRect.Top = Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Top;
01939     SourceRect.Right = Popup-&gt;OldScreenSize.X - 1;
01940     SourceRect.Bottom = Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o1">Region</a>.Bottom;
01941 <span class="preprocessor">#endif</span>
01942 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((ScreenInfo-&gt;Flags &amp; <a class="code" href="../../d7/d2/output_8h.html#a2">CONSOLE_OEMFONT_DISPLAY</a>) &amp;&amp;
01943             !(ScreenInfo-&gt;Console-&gt;FullScreenFlags &amp; CONSOLE_FULLSCREEN)) {
01944         <span class="comment">/*</span>
01945 <span class="comment">         * Screen buffer wants fake Unicode</span>
01946 <span class="comment">         */</span>
01947         <span class="keywordflow">if</span> (!(Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o3">Flags</a> &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a0">CLEPF_FALSE_UNICODE</a>)) {
01948 <span class="preprocessor">#if !defined(FE_SB)</span>
01949 <span class="preprocessor"></span>            <a class="code" href="../../d6/d8/dispatch_8h.html#a13">TranslateOutputToAnsiUnicode</a>(ScreenInfo-&gt;Console,
01950                     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o4">OldContents</a>, Size);
01951 <span class="preprocessor">#else</span>
01952 <span class="preprocessor"></span>            <a class="code" href="../../d6/d8/dispatch_8h.html#a13">TranslateOutputToAnsiUnicode</a>(ScreenInfo-&gt;Console,
01953                     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o4">OldContents</a>, Size,
01954                     NULL);
01955 <span class="preprocessor">#endif</span>
01956 <span class="preprocessor"></span>        }
01957     } <span class="keywordflow">else</span> {
01958         <span class="comment">/*</span>
01959 <span class="comment">         * Screen buffer wants real Unicode</span>
01960 <span class="comment">         */</span>
01961         <span class="keywordflow">if</span> (Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o3">Flags</a> &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a0">CLEPF_FALSE_UNICODE</a>) {
01962 <span class="preprocessor">#if !defined(FE_SB)</span>
01963 <span class="preprocessor"></span>            <a class="code" href="../../d6/d8/dispatch_8h.html#a16">TranslateOutputToOemUnicode</a>(ScreenInfo-&gt;Console,
01964                     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o4">OldContents</a>, Size);
01965 <span class="preprocessor">#else</span>
01966 <span class="preprocessor"></span>            <a class="code" href="../../d6/d8/dispatch_8h.html#a16">TranslateOutputToOemUnicode</a>(ScreenInfo-&gt;Console,
01967                     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o4">OldContents</a>, Size, FALSE);
01968 <span class="preprocessor">#endif</span>
01969 <span class="preprocessor"></span>        }
01970     }
01971     <a class="code" href="../../d6/d2/output_8c.html#a53">WriteScreenBuffer</a>(ScreenInfo,
01972                       Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o4">OldContents</a>,
01973                       &amp;SourceRect
01974                      );
01975     <a class="code" href="../../d6/d8/dispatch_8h.html#a4">WriteToScreen</a>(ScreenInfo,
01976                   &amp;SourceRect
01977                  );
01978 
01979     <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a2">ConsoleShowCursor</a>(ScreenInfo);
01980 
01981     <span class="comment">//</span>
01982     <span class="comment">// free popup structure</span>
01983     <span class="comment">//</span>
01984 
01985     RemoveEntryList(&amp;Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o0">ListLink</a>);
01986     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o4">OldContents</a>);
01987     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Popup);
01988     ScreenInfo-&gt;Console-&gt;PopupCount--;
01989     <span class="keywordflow">return</span> STATUS_SUCCESS;
01990 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="server/cmdline.c::FindAlias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> FindAlias           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AliasList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>AliasName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AliasLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00447">447</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d4/d1/cmdline_8h.html#a34">ALIAS</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00390">my_wcsncmpi</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00164">_ALIAS::Source</a>, and <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00162">_ALIAS::SourceLength</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01105">MatchandCopyAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">SrvGetConsoleAlias()</a>.
<p>
<pre class="fragment"><div>00461 {
00462     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
00463     PLIST_ENTRY ListHead, ListNext;
00464 
00465     ListHead = &amp;AliasList-&gt;AliasList;
00466     ListNext = ListHead-&gt;Flink;
00467     <span class="keywordflow">while</span> (ListNext != ListHead) {
00468         Alias = CONTAINING_RECORD( ListNext, <a class="code" href="../../d1/d6/struct__ALIAS.html">ALIAS</a>, ListLink );
00469         <span class="keywordflow">if</span> (Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a> == AliasLength &amp;&amp;
00470             !<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a9">my_wcsncmpi</a>(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o3">Source</a>,AliasName,AliasLength)) {
00471             <span class="keywordflow">if</span> (ListNext != ListHead-&gt;Flink) {
00472                 RemoveEntryList(ListNext);
00473                 InsertHeadList(ListHead,ListNext);
00474             }
00475             <span class="keywordflow">return</span> Alias;
00476         }
00477         ListNext = ListNext-&gt;Flink;
00478     }
00479     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00480 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a74" doxytag="server/cmdline.c::FindCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> FindCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessHandle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04564">4564</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00012">History</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04605">FreeCommandHistory()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02263">SrvReadConsole()</a>.
<p>
<pre class="fragment"><div>04571                    :
04572 
04573     This routine marks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command history buffer freed.
04574 
04575 Arguments:
04576 
04577     Console - pointer to console.
04578 
04579     ProcessHandle - handle to client process.
04580 
04581 Return Value:
04582 
04583     none.
04584 
04585 --*/
04586 
04587 {
04588     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
04589     PLIST_ENTRY ListHead, ListNext;
04590 
04591     ListHead = &amp;Console-&gt;CommandHistoryList;
04592     ListNext = ListHead-&gt;Flink;
04593     <span class="keywordflow">while</span> (ListNext != ListHead) {
04594         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = CONTAINING_RECORD( ListNext, <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>, ListLink );
04595         ListNext = ListNext-&gt;Flink;
04596         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;ProcessHandle == ProcessHandle) {
04597             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags &amp; CLE_ALLOCATED);
04598             <span class="keywordflow">return</span> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
04599         }
04600     }
04601     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04602 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="server/cmdline.c::FindExe" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> FindExe           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ExeName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ExeLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>UnicodeExe</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">394</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01345">ConvertInputToUnicode()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00170">_EXE_ALIAS_LIST::ExeLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00171">_EXE_ALIAS_LIST::ExeName</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00390">my_wcsncmpi</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00878">ClearAliases()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01105">MatchandCopyAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">SrvGetConsoleAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00903">SrvGetConsoleAliases()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00834">SrvGetConsoleAliasesLength()</a>.
<p>
<pre class="fragment"><div>00408 {
00409     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> AliasList;
00410     PLIST_ENTRY ListHead, ListNext;
00411     LPWSTR UnicodeExeName;
00412 
00413 
00414     <span class="keywordflow">if</span> (UnicodeExe) {
00415         UnicodeExeName = ExeName;
00416     } <span class="keywordflow">else</span> {
00417         UnicodeExeName = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),ExeLength*<span class="keyword">sizeof</span>(WCHAR));
00418         <span class="keywordflow">if</span> (UnicodeExeName == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00419             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00420         ExeLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(Console-&gt;CP,
00421                                       ExeName,
00422                                       ExeLength,
00423                                       UnicodeExeName,
00424                                       ExeLength);
00425         ExeLength *= 2;
00426     }
00427     ListHead = &amp;Console-&gt;ExeAliasList;
00428     ListNext = ListHead-&gt;Flink;
00429     <span class="keywordflow">while</span> (ListNext != ListHead) {
00430         AliasList = CONTAINING_RECORD( ListNext, <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">EXE_ALIAS_LIST</a>, ListLink );
00431         <span class="keywordflow">if</span> (AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a> == ExeLength &amp;&amp;
00432             !<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a9">my_wcsncmpi</a>(AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o2">ExeName</a>,UnicodeExeName,ExeLength)) {
00433             <span class="keywordflow">if</span> (!UnicodeExe) {
00434                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(UnicodeExeName);
00435             }
00436             <span class="keywordflow">return</span> AliasList;
00437         }
00438         ListNext = ListNext-&gt;Flink;
00439     }
00440     <span class="keywordflow">if</span> (!UnicodeExe) {
00441         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(UnicodeExeName);
00442     }
00443     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00444 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="server/cmdline.c::FindExeCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> FindExeCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>AppName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>AppNameLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Unicode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">1637</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01345">ConvertInputToUnicode()</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00012">History</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00390">my_wcsncmpi</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d3/d9/nt6_2user32_8def-source.html#l00844">Unicode</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01393">SrvExpungeConsoleCommandHistory()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01500">SrvGetConsoleCommandHistory()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01458">SrvGetConsoleCommandHistoryLength()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01424">SrvSetConsoleNumberOfCommands()</a>.
<p>
<pre class="fragment"><div>01643 {
01644     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
01645     PLIST_ENTRY ListHead, ListNext;
01646     PWCHAR AppNamePtr;
01647 
01648     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>) {
01649         AppNamePtr = (PWCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),AppNameLength * <span class="keyword">sizeof</span>(WCHAR));
01650         <span class="keywordflow">if</span> (AppNamePtr == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01651             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01652         }
01653         AppNameLength = <a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(Console-&gt;CP,
01654                                   AppName,
01655                                   AppNameLength,
01656                                   AppNamePtr,
01657                                   AppNameLength);
01658         AppNameLength *= 2;
01659     } <span class="keywordflow">else</span> {
01660         AppNamePtr = AppName;
01661     }
01662     ListHead = &amp;Console-&gt;CommandHistoryList;
01663     ListNext = ListHead-&gt;Flink;
01664     <span class="keywordflow">while</span> (ListNext != ListHead) {
01665         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = CONTAINING_RECORD( ListNext, <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>, ListLink );
01666         ListNext = ListNext-&gt;Flink;
01667 
01668         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a> &amp;&amp;
01669             !<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a9">my_wcsncmpi</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName,AppNamePtr,(USHORT)AppNameLength)) {
01670             <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>) {
01671                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(AppNamePtr);
01672             }
01673             <span class="keywordflow">return</span> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
01674         }
01675     }
01676     <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a96">Unicode</a>) {
01677         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(AppNamePtr);
01678     }
01679     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01680 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a69" doxytag="server/cmdline.c::FindMatchingCommand" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a> FindMatchingCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandHistory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwszIn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>cbIn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04078">4078</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00066">CLE_RESET</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00024">_COMMAND::Command</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00122">COMMAND_IND_PREV</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00023">_COMMAND::CommandLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00306">FMCFL_EXACT_MATCH</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00307">FMCFL_JUST_LOOKING</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00391">my_wcsncmp</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04744">AddCommand()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>.
<p>
<pre class="fragment"><div>04094 {
04095     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
04096 
04097     <span class="keywordflow">if</span> (CommandHistory-&gt;NumberOfCommands == 0) {
04098         <span class="keywordflow">return</span> -1;
04099     }
04100     <span class="keywordflow">if</span> (!(Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a16">FMCFL_JUST_LOOKING</a>) &amp;&amp; (CommandHistory-&gt;Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>)) {
04101         CommandHistory-&gt;Flags &amp;= ~<a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>;
04102     } <span class="keywordflow">else</span> {
04103         <a class="code" href="../../d4/d1/cmdline_8h.html#a10">COMMAND_IND_PREV</a>(CommandIndex, CommandHistory);
04104     }
04105     <span class="keywordflow">if</span> (cbIn == 0) {
04106         <span class="keywordflow">return</span> CommandIndex;
04107     }
04108     <span class="keywordflow">for</span> (i=0;i&lt;CommandHistory-&gt;NumberOfCommands;i++) {
04109         <a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> pcmdT = CommandHistory-&gt;Commands[CommandIndex];
04110 
04111         <span class="keywordflow">if</span> ((!(Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a15">FMCFL_EXACT_MATCH</a>) &amp;&amp; (cbIn &lt;= pcmdT-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>)) ||
04112                 ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)cbIn == pcmdT-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>)) {
04113             <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a10">my_wcsncmp</a>(pcmdT-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o1">Command</a>, pwszIn, (USHORT)cbIn)) {
04114                 <span class="keywordflow">return</span> CommandIndex;
04115             }
04116         }
04117         <a class="code" href="../../d4/d1/cmdline_8h.html#a10">COMMAND_IND_PREV</a>(CommandIndex, CommandHistory);
04118     }
04119     <span class="keywordflow">return</span> -1;
04120 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="server/cmdline.c::FreeAliasBuffers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeAliasBuffers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00591">591</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00571">FreeAliasList()</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04423">AbortCreateConsole()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l04454">DestroyWindowsWindow()</a>.
<p>
<pre class="fragment"><div>00594 {
00595     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> AliasList;
00596     PLIST_ENTRY ListHead, ListNext;
00597 
00598     ListHead = &amp;Console-&gt;ExeAliasList;
00599     ListNext = ListHead-&gt;Flink;
00600     <span class="keywordflow">while</span> (ListNext != ListHead) {
00601         AliasList = CONTAINING_RECORD( ListNext, <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">EXE_ALIAS_LIST</a>, ListLink );
00602         ListNext = ListNext-&gt;Flink;
00603         <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a27">FreeAliasList</a>(AliasList);
00604     }
00605 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="server/cmdline.c::FreeAliasList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeAliasList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ExeAliasList</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00571">571</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00552">RemoveAlias()</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00591">FreeAliasBuffers()</a>.
<p>
<pre class="fragment"><div>00574 {
00575     PLIST_ENTRY ListHead, ListNext;
00576     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
00577 
00578     ListHead = &amp;ExeAliasList-&gt;AliasList;
00579     ListNext = ListHead-&gt;Flink;
00580     <span class="keywordflow">while</span> (ListNext != ListHead) {
00581         Alias = CONTAINING_RECORD( ListNext, <a class="code" href="../../d1/d6/struct__ALIAS.html">ALIAS</a>, ListLink );
00582         ListNext = ListNext-&gt;Flink;
00583         <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a26">RemoveAlias</a>(Alias);
00584     }
00585     RemoveEntryList(&amp;ExeAliasList-&gt;ListLink);
00586     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ExeAliasList-&gt;ExeName);
00587     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(ExeAliasList);
00588 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a75" doxytag="server/cmdline.c::FreeCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessHandle</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04605">4605</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04564">FindCommandHistory()</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00012">History</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01355">RemoveConsole()</a>.
<p>
<pre class="fragment"><div>04612                    :
04613 
04614     This routine marks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command history buffer freed.
04615 
04616 Arguments:
04617 
04618     Console - pointer to console.
04619 
04620     ProcessHandle - handle to client process.
04621 
04622 Return Value:
04623 
04624     none.
04625 
04626 --*/
04627 
04628 {
04629     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
04630 
04631     <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = <a class="code" href="../../d4/d1/cmdline_8h.html#a46">FindCommandHistory</a>(Console,ProcessHandle);
04632     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>) {
04633         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags &amp;= ~<a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>;
04634         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;ProcessHandle = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04635     }
04636 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a76" doxytag="server/cmdline.c::FreeCommandHistoryBuffers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeCommandHistoryBuffers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04640">4640</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00012">History</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/output_8c-source.html#l04423">AbortCreateConsole()</a>, and <a class="el" href="../../d7/d1/output_8c-source.html#l04454">DestroyWindowsWindow()</a>.
<p>
<pre class="fragment"><div>04643 {
04644     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
04645     PLIST_ENTRY ListHead, ListNext;
04646     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
04647 
04648     ListHead = &amp;Console-&gt;CommandHistoryList;
04649     ListNext = ListHead-&gt;Flink;
04650     <span class="keywordflow">while</span> (ListNext != ListHead) {
04651         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = CONTAINING_RECORD( ListNext, <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>, ListLink );
04652         ListNext = ListNext-&gt;Flink;
04653         RemoveEntryList(&amp;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;ListLink);
04654         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName) {
04655             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;AppName);
04656         }
04657         <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands;i++) {
04658             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Commands[i]);
04659         }
04660         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(History);
04661     }
04662 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a63" doxytag="server/cmdline.c::GetLastCommand" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> GetLastCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CommandHistory</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03217">3217</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02677">ProcessCopyToCharInput()</a>.
<p>
<pre class="fragment"><div>03220 {
03221     <span class="keywordflow">if</span> (CommandHistory-&gt;NumberOfCommands == 0)
03222         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
03223     <span class="keywordflow">return</span> CommandHistory-&gt;Commands[CommandHistory-&gt;LastDisplayed];
03224 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="server/cmdline.c::InitExtendedEditKeys" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitExtendedEditKeys           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">CONST ExtKeyDefBuf *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pKeyDefBuf</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00186">186</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00088">gaDefaultKeyDef</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00086">gaKeyDef</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02210">GetRegistryValues()</a>.
<p>
<pre class="fragment"><div>00187 {
00188     CONST <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>* lpbyte;
00189     <span class="keywordtype">int</span> i;
00190     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwCheckSum;
00191 
00192     <span class="comment">//</span>
00193     <span class="comment">// Sanity check</span>
00194     <span class="comment">// If pKeyDefBuf is NULL, give it the default value.</span>
00195     <span class="comment">// If the version is not supported, just use the default and bail.</span>
00196     <span class="comment">//</span>
00197     <span class="keywordflow">if</span> (pKeyDefBuf == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || pKeyDefBuf-&gt;dwVersion != 0) {
00198 <span class="preprocessor">#if DBG</span>
00199 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (pKeyDefBuf != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00200             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"InitExtendedEditKeys: Unsupported version number(%d)\n"</span>, pKeyDefBuf-&gt;dwVersion);
00201         }
00202 <span class="preprocessor">#endif</span>
00203 <span class="preprocessor"></span>retry_clean:
00204         memcpy(gaKeyDef, gaDefaultKeyDef, <span class="keyword">sizeof</span> gaKeyDef);
00205         <span class="keywordflow">return</span>;
00206     }
00207 
00208     <span class="comment">//</span>
00209     <span class="comment">// Calculate check sum</span>
00210     <span class="comment">//</span>
00211     dwCheckSum = 0;
00212     <span class="keywordflow">for</span> (lpbyte = (CONST <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>*)pKeyDefBuf, i = FIELD_OFFSET(ExtKeyDefBuf, table); i &lt; <span class="keyword">sizeof</span> *pKeyDefBuf; ++i) {
00213         dwCheckSum += lpbyte[i];
00214     }
00215     <span class="keywordflow">if</span> (dwCheckSum != pKeyDefBuf-&gt;dwCheckSum) {
00216 <span class="preprocessor">#if DBG</span>
00217 <span class="preprocessor"></span>        <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"InitExtendedEditKeys: Checksum(%d) does not match.\n"</span>, pKeyDefBuf-&gt;dwCheckSum);
00218 <span class="preprocessor">#endif</span>
00219 <span class="preprocessor"></span>        <span class="keywordflow">goto</span> retry_clean;
00220     }
00221 
00222     <span class="comment">//</span>
00223     <span class="comment">// Copy the entity</span>
00224     <span class="comment">//</span>
00225 
00226     memcpy(gaKeyDef, pKeyDefBuf-&gt;table, <span class="keyword">sizeof</span> gaKeyDef);
00227 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a78" doxytag="server/cmdline.c::InitializeConsoleCommandData" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID InitializeConsoleCommandData           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Console</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04700">4700</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l00789">AllocateConsole()</a>.
<p>
<pre class="fragment"><div>04706                    :
04707 
04708     This routine initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> per-console commandline recall data structures.
04709 
04710 Arguments:
04711 
04712     Console - pointer to console.
04713 
04714 Return Value:
04715 
04716     none
04717 
04718 --*/
04719 
04720 {
04721     Console-&gt;NumCommandHistories = 0;
04722     InitializeListHead(&amp;Console-&gt;CommandHistoryList);
04723 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a53" doxytag="server/cmdline.c::IsCommandLineEditingKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL IsCommandLineEditingKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKEY_EVENT_RECORD&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>KeyEvent</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02214">2214</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00054">gExtendedEditKey</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00229">ParseEditKeyInfo()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>02217 {
02218     <span class="keywordflow">if</span> (!(KeyEvent-&gt;dwControlKeyState &amp;
02219             (RIGHT_ALT_PRESSED | LEFT_ALT_PRESSED |
02220              RIGHT_CTRL_PRESSED | LEFT_CTRL_PRESSED))) {
02221         <span class="keywordflow">switch</span> (KeyEvent-&gt;wVirtualKeyCode) {
02222         <span class="keywordflow">case</span> VK_ESCAPE:
02223         <span class="keywordflow">case</span> VK_PRIOR:
02224         <span class="keywordflow">case</span> VK_NEXT:
02225         <span class="keywordflow">case</span> VK_END:
02226         <span class="keywordflow">case</span> VK_HOME:
02227         <span class="keywordflow">case</span> VK_LEFT:
02228         <span class="keywordflow">case</span> VK_UP:
02229         <span class="keywordflow">case</span> VK_RIGHT:
02230         <span class="keywordflow">case</span> VK_DOWN:
02231         <span class="keywordflow">case</span> VK_INSERT:
02232         <span class="keywordflow">case</span> VK_DELETE:
02233         <span class="keywordflow">case</span> VK_F1:
02234         <span class="keywordflow">case</span> VK_F2:
02235         <span class="keywordflow">case</span> VK_F3:
02236         <span class="keywordflow">case</span> VK_F4:
02237         <span class="keywordflow">case</span> VK_F5:
02238         <span class="keywordflow">case</span> VK_F6:
02239         <span class="keywordflow">case</span> VK_F7:
02240         <span class="keywordflow">case</span> VK_F8:
02241         <span class="keywordflow">case</span> VK_F9:
02242             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02243         <span class="keywordflow">default</span>:
02244             <span class="keywordflow">break</span>;
02245         }
02246     }
02247     <span class="keywordflow">if</span> ((KeyEvent-&gt;dwControlKeyState &amp;
02248             (RIGHT_CTRL_PRESSED | LEFT_CTRL_PRESSED))) {
02249         <span class="keywordflow">switch</span> (KeyEvent-&gt;wVirtualKeyCode) {
02250         <span class="keywordflow">case</span> VK_END:
02251         <span class="keywordflow">case</span> VK_HOME:
02252         <span class="keywordflow">case</span> VK_LEFT:
02253         <span class="keywordflow">case</span> VK_RIGHT:
02254             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02255         <span class="keywordflow">default</span>:
02256             <span class="keywordflow">break</span>;
02257         }
02258     }
02259 
02260     <span class="comment">//</span>
02261     <span class="comment">// Extended edit key handling</span>
02262     <span class="comment">//</span>
02263     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a24">gExtendedEditKey</a> &amp;&amp; <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a17">ParseEditKeyInfo</a>(KeyEvent)) {
02264         <span class="comment">//</span>
02265         <span class="comment">// If wUnicodeChar is specified in KeySubst,</span>
02266         <span class="comment">// the key should be handled as a normal key.</span>
02267         <span class="comment">// Basically this is for VK_BACK keys.</span>
02268         <span class="comment">//</span>
02269         <span class="keywordflow">return</span> KeyEvent-&gt;uChar.UnicodeChar == 0;
02270     }
02271 
02272     <span class="keywordflow">if</span> ((KeyEvent-&gt;dwControlKeyState &amp;
02273             (RIGHT_ALT_PRESSED | LEFT_ALT_PRESSED))) {
02274         <span class="keywordflow">switch</span> (KeyEvent-&gt;wVirtualKeyCode) {
02275         <span class="keywordflow">case</span> VK_F7:
02276         <span class="keywordflow">case</span> VK_F10:
02277             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02278         <span class="keywordflow">default</span>:
02279             <span class="keywordflow">break</span>;
02280         }
02281     }
02282     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02283 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="server/cmdline.c::IsCommandLinePopupKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL IsCommandLinePopupKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PKEY_EVENT_RECORD&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>KeyEvent</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02179">2179</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00054">gExtendedEditKey</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00229">ParseEditKeyInfo()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00263">GetChar()</a>.
<p>
<pre class="fragment"><div>02182 {
02183     <span class="keywordflow">if</span> (!(KeyEvent-&gt;dwControlKeyState &amp;
02184             (RIGHT_ALT_PRESSED | LEFT_ALT_PRESSED |
02185              RIGHT_CTRL_PRESSED | LEFT_CTRL_PRESSED))) {
02186         <span class="keywordflow">switch</span> (KeyEvent-&gt;wVirtualKeyCode) {
02187         <span class="keywordflow">case</span> VK_ESCAPE:
02188         <span class="keywordflow">case</span> VK_PRIOR:
02189         <span class="keywordflow">case</span> VK_NEXT:
02190         <span class="keywordflow">case</span> VK_END:
02191         <span class="keywordflow">case</span> VK_HOME:
02192         <span class="keywordflow">case</span> VK_LEFT:
02193         <span class="keywordflow">case</span> VK_UP:
02194         <span class="keywordflow">case</span> VK_RIGHT:
02195         <span class="keywordflow">case</span> VK_DOWN:
02196         <span class="keywordflow">case</span> VK_F9:
02197             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02198         <span class="keywordflow">default</span>:
02199             <span class="keywordflow">break</span>;
02200         }
02201     }
02202 
02203     <span class="comment">//</span>
02204     <span class="comment">// Extended key handling</span>
02205     <span class="comment">//</span>
02206     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a24">gExtendedEditKey</a> &amp;&amp; <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a17">ParseEditKeyInfo</a>(KeyEvent)) {
02207         <span class="keywordflow">return</span> KeyEvent-&gt;uChar.UnicodeChar == 0;
02208     }
02209 
02210     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02211 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="server/cmdline.c::IsPauseKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL IsPauseKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKEY_EVENT_RECORD&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pKeyEvent</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00289">289</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00078">CTRL_BUT_NOT_ALT</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00054">gExtendedEditKey</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00229">ParseEditKeyInfo()</a>.
<p>
Referenced by <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l01340">PreprocessInput()</a>.
<p>
<pre class="fragment"><div>00290 {
00291     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a24">gExtendedEditKey</a>) {
00292         KEY_EVENT_RECORD KeyEvent = *pKeyEvent;
00293         CONST ExtKeySubst* pKeySubst = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a17">ParseEditKeyInfo</a>(&amp;KeyEvent);
00294 
00295         <span class="keywordflow">return</span> pKeySubst != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> &amp;&amp; pKeySubst-&gt;wVirKey == VK_PAUSE;
00296     }
00297 
00298     <span class="keywordflow">return</span> pKeyEvent-&gt;wVirtualKeyCode == <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'S'</span> &amp;&amp; <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a8">CTRL_BUT_NOT_ALT</a>(pKeyEvent-&gt;dwControlKeyState);
00299 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="server/cmdline.c::IsWordDelim" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL IsWordDelim           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">WCHAR&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>wch</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00309">309</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00306">gaWordDelimChars</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00405">WORD_DELIM_MAX</a>.
<p>
<pre class="fragment"><div>00310 {
00311     <span class="keywordtype">int</span> i;
00312 
00313     <span class="comment">//</span>
00314     <span class="comment">// Before it reaches here, L' ' case should have beeen already detected,</span>
00315     <span class="comment">// and gaWordDelimChars is specified.</span>
00316     <span class="comment">//</span>
00317     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(wch != L<span class="charliteral">' '</span> &amp;&amp; gaWordDelimChars[0]);
00318 
00319     <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a14">gaWordDelimChars</a>[i] &amp;&amp; i &lt; <a class="code" href="../../d4/d1/cmdline_8h.html#a24">WORD_DELIM_MAX</a>; ++i) {
00320         <span class="keywordflow">if</span> (wch == <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a14">gaWordDelimChars</a>[i]) {
00321             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00322         }
00323     }
00324 
00325     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00326 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a84" doxytag="server/cmdline.c::LoadStringExW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int LoadStringExW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HINSTANCE&nbsp;</td>
          <td class="mdname" nowrap> <em>hModule</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN int&nbsp;</td>
          <td class="mdname" nowrap> <em>cchBufferMax</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>wLangId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04995">4995</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00041">UTCHAR</a>.
<p>
<pre class="fragment"><div>05002 {
05003     HANDLE hResInfo;
05004     HANDLE hStringSeg;
05005     LPTSTR lpsz;
05006     <span class="keywordtype">int</span> cch;
05007 
05008     <span class="comment">/*</span>
05009 <span class="comment">     * Make sure the parms are valid.</span>
05010 <span class="comment">     */</span>
05011     <span class="keywordflow">if</span> (lpBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
05012         <span class="keywordflow">return</span> 0;
05013     }
05014 
05015     cch = 0;
05016 
05017     <span class="comment">/*</span>
05018 <span class="comment">     * String Tables are broken up into 16 string segments.  Find the segment</span>
05019 <span class="comment">     * containing the string we are interested in.</span>
05020 <span class="comment">     */</span>
05021     <span class="keywordflow">if</span> (hResInfo = FindResourceEx(hModule,
05022                                   RT_STRING,
05023                                   (LPTSTR)((LONG)(((USHORT)wID &gt;&gt; 4) + 1)),
05024                                   wLangId)) {
05025 
05026         <span class="comment">/*</span>
05027 <span class="comment">         * Load that segment.</span>
05028 <span class="comment">         */</span>
05029         hStringSeg = LoadResource(hModule, hResInfo);
05030 
05031         <span class="comment">/*</span>
05032 <span class="comment">         * Lock the resource.</span>
05033 <span class="comment">         */</span>
05034         <span class="keywordflow">if</span> (lpsz = (LPTSTR)LockResource(hStringSeg)) {
05035 
05036             <span class="comment">/*</span>
05037 <span class="comment">             * Move past the other strings in this segment.</span>
05038 <span class="comment">             * (16 strings in a segment -&gt; &amp; 0x0F)</span>
05039 <span class="comment">             */</span>
05040             wID &amp;= 0x0F;
05041             <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
05042                 cch = *((<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> *)lpsz++);      <span class="comment">// PASCAL like string count</span>
05043                                                 <span class="comment">// first UTCHAR is count if TCHARs</span>
05044                 <span class="keywordflow">if</span> (wID-- == 0) <span class="keywordflow">break</span>;
05045                 lpsz += cch;                    <span class="comment">// Step to start if next string</span>
05046             }
05047 
05048             <span class="comment">/*</span>
05049 <span class="comment">             * chhBufferMax == 0 means return a pointer to the read-only resource buffer.</span>
05050 <span class="comment">             */</span>
05051             <span class="keywordflow">if</span> (cchBufferMax == 0) {
05052                 *(LPTSTR *)lpBuffer = lpsz;
05053             } <span class="keywordflow">else</span> {
05054 
05055                 <span class="comment">/*</span>
05056 <span class="comment">                 * Account for the NULL</span>
05057 <span class="comment">                 */</span>
05058                 cchBufferMax--;
05059 
05060                 <span class="comment">/*</span>
05061 <span class="comment">                 * Don't copy more than the max allowed.</span>
05062 <span class="comment">                 */</span>
05063                 <span class="keywordflow">if</span> (cch &gt; cchBufferMax)
05064                     cch = cchBufferMax;
05065 
05066                 <span class="comment">/*</span>
05067 <span class="comment">                 * Copy the string into the buffer.</span>
05068 <span class="comment">                 */</span>
05069                 RtlCopyMemory(lpBuffer, lpsz, cch*<span class="keyword">sizeof</span>(WCHAR));
05070             }
05071         }
05072     }
05073 
05074     <span class="comment">/*</span>
05075 <span class="comment">     * Append a NULL.</span>
05076 <span class="comment">     */</span>
05077     <span class="keywordflow">if</span> (cchBufferMax != 0) {
05078         lpBuffer[cch] = 0;
05079     }
05080 
05081     <span class="keywordflow">return</span> cch;
05082 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="server/cmdline.c::MatchandCopyAlias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS MatchandCopyAlias           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SourceLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a22">PUSHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Exe</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ExeLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PDWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>LineCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01105">1105</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00447">FindAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01102">MAX_ARGS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00165">_ALIAS::Target</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00163">_ALIAS::TargetLength</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00177">UNICODE_CARRIAGERETURN</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00178">UNICODE_LINEFEED</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>.
<p>
<pre class="fragment"><div>01118                    :
01119 
01120     This routine matches <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input string with an alias and copies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01121     alias to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input buffer.
01122 
01123 Arguments:
01124 
01125     Source - string to match
01126 
01127     SourceLength - length of Source in bytes
01128 
01129     TargetBuffer - where to store matched string
01130 
01131     TargetLength - on input, contains size of TargetBuffer.  On output,
01132     contains length of alias stored in TargetBuffer.
01133 
01134     SourceIsCommandLine - <span class="keywordflow">if</span> <span class="keyword">true</span>, source buffer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a command line, where
01135         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first blank separate token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be check <span class="keywordflow">for</span> an alias, and <span class="keywordflow">if</span>
01136         <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> matches, replaced with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> alias.  <span class="keywordflow">if</span> <span class="keyword">false</span>, then
01137         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source string <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a null terminated alias name.
01138 
01139     LineCount - aliases can contain multiple commands.  $T <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command
01140         separator
01141 
01142 Return Value:
01143 
01144     SUCCESS - match was found and alias was copied to buffer.
01145 
01146 --*/
01147 
01148 {
01149     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
01150     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01151     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> SourceUpToFirstBlank=0;  <span class="comment">// in chars</span>
01152     PWCHAR Tmp;
01153     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList;
01154     LPWSTR Args[<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a11">MAX_ARGS</a>];
01155     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> ArgsLength[<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a11">MAX_ARGS</a>];    <span class="comment">// in bytes</span>
01156     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> NumSourceArgs;
01157     LPWSTR SourcePtr;
01158     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> ArgCount,i,j,NewTargetLength;
01159     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> SourceRemainderLength;   <span class="comment">// in chars</span>
01160     PWCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>,TargetAlias;
01161     PWCHAR TmpBuffer;
01162 
01163     <span class="comment">//</span>
01164     <span class="comment">// alloc of exename may have failed.</span>
01165     <span class="comment">//</span>
01166 
01167     <span class="keywordflow">if</span> (Exe == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
01168         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01169 
01170     <span class="comment">//</span>
01171     <span class="comment">// find exe</span>
01172     <span class="comment">//</span>
01173 
01174     ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a22">FindExe</a>(Console,Exe,ExeLength,TRUE);
01175     <span class="keywordflow">if</span> (!ExeAliasList) {
01176         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01177     }
01178 
01179     <span class="comment">//</span>
01180     <span class="comment">// find first blank</span>
01181     <span class="comment">//</span>
01182 
01183     <span class="keywordflow">for</span> (Tmp=Source,SourceUpToFirstBlank=0;
01184          *Tmp!=(WCHAR)<span class="charliteral">' '</span> &amp;&amp; SourceUpToFirstBlank&lt;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(SourceLength/<span class="keyword">sizeof</span>(WCHAR));
01185          Tmp++,SourceUpToFirstBlank++) ;
01186 
01187     <span class="comment">//</span>
01188     <span class="comment">// find char past first blank</span>
01189     <span class="comment">//</span>
01190 
01191     j=SourceUpToFirstBlank;
01192     <span class="keywordflow">while</span> (j&lt;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(SourceLength/<span class="keyword">sizeof</span>(WCHAR)) &amp;&amp; *Tmp==(WCHAR)<span class="charliteral">' '</span>) {
01193         Tmp++;
01194         j++;
01195     }
01196     SourcePtr = Tmp;
01197     SourceRemainderLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((SourceLength/<span class="keyword">sizeof</span>(WCHAR)) - j);
01198 
01199     <span class="comment">//</span>
01200     <span class="comment">// find alias</span>
01201     <span class="comment">//</span>
01202 
01203     Alias = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a23">FindAlias</a>(ExeAliasList,Source,(USHORT)(SourceUpToFirstBlank*<span class="keyword">sizeof</span>(WCHAR)));
01204     <span class="keywordflow">if</span> (!Alias) {
01205         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
01206     }
01207 
01208     TmpBuffer = (PWCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),*TargetLength);
01209     <span class="keywordflow">if</span> (!TmpBuffer)
01210         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
01211 
01212     <span class="comment">//</span>
01213     <span class="comment">// count args in target</span>
01214     <span class="comment">//</span>
01215 
01216     ArgCount=0;
01217     *LineCount=1;
01218     Tmp=Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a>;
01219     <span class="keywordflow">for</span> (i=0;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(i+1)&lt;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>/<span class="keyword">sizeof</span>(WCHAR));i++) {
01220         <span class="keywordflow">if</span> (*Tmp == (WCHAR)<span class="charliteral">'$'</span> &amp;&amp; *(Tmp+1) &gt;= (WCHAR)<span class="charliteral">'1'</span> &amp;&amp; *(Tmp+1) &lt;= (WCHAR)<span class="charliteral">'9'</span>) {
01221             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> ArgNum = *(Tmp+1) - (WCHAR)<span class="charliteral">'0'</span>;
01222             <span class="keywordflow">if</span> (ArgNum &gt; ArgCount) {
01223                 ArgCount = ArgNum;
01224             }
01225             Tmp++;
01226             i++;
01227         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*Tmp == (WCHAR)<span class="charliteral">'$'</span> &amp;&amp; *(Tmp+1) == (WCHAR)<span class="charliteral">'*'</span>) {
01228             <span class="keywordflow">if</span> (ArgCount==0) {
01229                 ArgCount = 1;
01230             }
01231             Tmp++;
01232             i++;
01233         }
01234         Tmp++;
01235     }
01236 
01237     <span class="comment">//</span>
01238     <span class="comment">// package up space separated strings in source into array</span>
01239     <span class="comment">// of args</span>
01240     <span class="comment">//</span>
01241     <span class="comment">//</span>
01242 
01243     NumSourceArgs=0;
01244     Tmp = SourcePtr;
01245     <span class="keywordflow">for</span> (i=0,j=0;i&lt;ArgCount;i++) {
01246         <span class="keywordflow">if</span> (j&lt;SourceRemainderLength) {
01247             Args[NumSourceArgs] = Tmp;
01248             ArgsLength[NumSourceArgs] = 0;
01249             <span class="keywordflow">while</span> (j++&lt;SourceRemainderLength &amp;&amp; *Tmp++ != (WCHAR)<span class="charliteral">' '</span>) {
01250                 ArgsLength[NumSourceArgs] += <span class="keyword">sizeof</span>(WCHAR);
01251             }
01252             <span class="keywordflow">while</span> (j&lt;SourceRemainderLength &amp;&amp; *Tmp == (WCHAR)<span class="charliteral">' '</span>) {
01253                 j++;
01254                 Tmp++;
01255             }
01256             NumSourceArgs++;
01257         } <span class="keywordflow">else</span> {
01258             <span class="keywordflow">break</span>;
01259         }
01260     }
01261 
01262     <span class="comment">//</span>
01263     <span class="comment">// put together the target string</span>
01264     <span class="comment">//</span>
01265     <span class="comment">// while (target)</span>
01266     <span class="comment">//     if ($)</span>
01267     <span class="comment">//        if arg &amp;&amp; arg# &lt;= ArgCount</span>
01268     <span class="comment">//            copy arg</span>
01269     <span class="comment">//        else if *</span>
01270     <span class="comment">//            copy arg</span>
01271     <span class="comment">//        else</span>
01272     <span class="comment">//            replace with &lt; &gt; etc</span>
01273     <span class="comment">//     else</span>
01274     <span class="comment">//        copy text up to next ' '</span>
01275     <span class="comment">//</span>
01276 
01277     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = TmpBuffer;
01278     NewTargetLength = 2*<span class="keyword">sizeof</span>(WCHAR);    <span class="comment">// for CRLF</span>
01279     TargetAlias=Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a>;
01280     <span class="keywordflow">for</span> (i=0;i&lt;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>/<span class="keyword">sizeof</span>(WCHAR));i++) {
01281         <span class="keywordflow">if</span> (NewTargetLength &gt;= *TargetLength) {
01282             *TargetLength = NewTargetLength;
01283             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
01284             <span class="keywordflow">break</span>;
01285         }
01286         <span class="keywordflow">if</span> (*TargetAlias == (WCHAR)<span class="charliteral">'$'</span> &amp;&amp; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(i+1)&lt;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>/<span class="keyword">sizeof</span>(WCHAR))) {
01287             TargetAlias++;
01288             i++;
01289             <span class="keywordflow">if</span> (*TargetAlias &gt;= (WCHAR)<span class="charliteral">'1'</span> &amp;&amp; *TargetAlias &lt;= (WCHAR)<span class="charliteral">'9'</span>) {
01290 
01291                 <span class="comment">//</span>
01292                 <span class="comment">// do numbered parameter substitution</span>
01293                 <span class="comment">//</span>
01294 
01295                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> ArgNumber;
01296 
01297                 ArgNumber = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(*TargetAlias - (WCHAR)<span class="charliteral">'1'</span>);
01298                 <span class="keywordflow">if</span> (ArgNumber &lt; NumSourceArgs) {
01299                     <span class="keywordflow">if</span> ((NewTargetLength+ArgsLength[ArgNumber])&lt;=*TargetLength) {
01300                         RtlCopyMemory(Buffer,Args[ArgNumber],ArgsLength[ArgNumber]);
01301                         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>+=ArgsLength[ArgNumber]/<span class="keyword">sizeof</span>(WCHAR);
01302                         NewTargetLength+=ArgsLength[ArgNumber];
01303                     } <span class="keywordflow">else</span> {
01304                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
01305                         <span class="keywordflow">break</span>;
01306                     }
01307                 }
01308             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*TargetAlias == (WCHAR)<span class="charliteral">'*'</span>) {
01309 
01310                 <span class="comment">//</span>
01311                 <span class="comment">// do * parameter substitution</span>
01312                 <span class="comment">//</span>
01313 
01314                 <span class="keywordflow">if</span> (NumSourceArgs) {
01315                     <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(NewTargetLength+(SourceRemainderLength*<span class="keyword">sizeof</span>(WCHAR)))&lt;=*TargetLength) {
01316                         RtlCopyMemory(Buffer,Args[0],SourceRemainderLength*<span class="keyword">sizeof</span>(WCHAR));
01317                         <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>+=SourceRemainderLength;
01318                         NewTargetLength+=SourceRemainderLength*<span class="keyword">sizeof</span>(WCHAR);
01319                     } <span class="keywordflow">else</span> {
01320                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
01321                         <span class="keywordflow">break</span>;
01322                     }
01323                 }
01324             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*TargetAlias == (WCHAR)<span class="charliteral">'l'</span> || *TargetAlias == (WCHAR)<span class="charliteral">'L'</span>) {
01325 
01326                 <span class="comment">//</span>
01327                 <span class="comment">// do &lt; substitution</span>
01328                 <span class="comment">//</span>
01329 
01330                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = (WCHAR)<span class="charliteral">'&lt;'</span>;
01331                 NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR);
01332             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*TargetAlias == (WCHAR)<span class="charliteral">'g'</span> || *TargetAlias == (WCHAR)<span class="charliteral">'G'</span>) {
01333 
01334                 <span class="comment">//</span>
01335                 <span class="comment">// do &gt; substitution</span>
01336                 <span class="comment">//</span>
01337 
01338                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = (WCHAR)<span class="charliteral">'&gt;'</span>;
01339                 NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR);
01340             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*TargetAlias == (WCHAR)<span class="charliteral">'b'</span> || *TargetAlias == (WCHAR)<span class="charliteral">'B'</span>) {
01341 
01342                 <span class="comment">//</span>
01343                 <span class="comment">// do | substitution</span>
01344                 <span class="comment">//</span>
01345 
01346                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = (WCHAR)<span class="charliteral">'|'</span>;
01347                 NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR);
01348             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*TargetAlias == (WCHAR)<span class="charliteral">'t'</span> || *TargetAlias == (WCHAR)<span class="charliteral">'T'</span>) {
01349 
01350                 <span class="comment">//</span>
01351                 <span class="comment">// do newline substitution</span>
01352                 <span class="comment">//</span>
01353 
01354                 <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(NewTargetLength+(<span class="keyword">sizeof</span>(WCHAR)*2))&gt;*TargetLength) {
01355                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
01356                 }
01357 
01358                 *LineCount += 1;
01359                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>;
01360                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = <a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;
01361                 NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR)*2;
01362             } <span class="keywordflow">else</span> {
01363 
01364                 <span class="comment">//</span>
01365                 <span class="comment">// copy $X</span>
01366                 <span class="comment">//</span>
01367 
01368                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = (WCHAR)<span class="charliteral">'$'</span>;
01369                 NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR);
01370                 *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = *TargetAlias;
01371                 NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR);
01372             }
01373             TargetAlias++;
01374         } <span class="keywordflow">else</span> {
01375 
01376             <span class="comment">//</span>
01377             <span class="comment">// copy char</span>
01378             <span class="comment">//</span>
01379 
01380             *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = *TargetAlias++;
01381             NewTargetLength+=<span class="keyword">sizeof</span>(WCHAR);
01382         }
01383     }
01384     *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>;
01385     *<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>++ = <a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;
01386     RtlCopyMemory(TargetBuffer,TmpBuffer,NewTargetLength);
01387     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TmpBuffer);
01388     *TargetLength = NewTargetLength;
01389     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01390 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="server/cmdline.c::MyStringCompareW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int MyStringCompareW           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Str1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Str2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>bCaseInsensitive</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00369">369</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d5/nls_8c-source.html#l01520">RtlCompareUnicodeString()</a>, <a class="el" href="../../d0/d9/tcmpmem_8c-source.html#l00037">String1</a>, and <a class="el" href="../../d0/d9/tcmpmem_8c-source.html#l00038">String2</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/find_8c-source.html#l00028">SearchForString()</a>, and <a class="el" href="../../d1/d4/srvinit_8c-source.html#l01831">TranslateConsoleTitle()</a>.
<p>
<pre class="fragment"><div>00375 {
00376     UNICODE_STRING <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>;
00377     UNICODE_STRING <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>;
00378 
00379     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>.Length = Length;
00380     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>.MaximumLength = Length;
00381     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a1">String1</a>.Buffer = Str1;
00382     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>.Length = Length;
00383     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>.MaximumLength = Length;
00384     <a class="code" href="../../d9/d9/tcmpmem_8c.html#a2">String2</a>.Buffer = Str2;
00385     <span class="keywordflow">return</span> <a class="code" href="../../d6/d6/nls_8c.html#a41">RtlCompareUnicodeString</a>(&amp;String1,
00386                                    &amp;String2,
00387                                    bCaseInsensitive);
00388 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="server/cmdline.c::ParseEditKeyInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST ExtKeySubst* ParseEditKeyInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PKEY_EVENT_RECORD&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pKeyEvent</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00229">229</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00075">ALT_PRESSED</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00076">CTRL_PRESSED</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00086">gaKeyDef</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00054">gExtendedEditKey</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02214">IsCommandLineEditingKey()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02179">IsCommandLinePopupKey()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00289">IsPauseKey()</a>.
<p>
<pre class="fragment"><div>00230 {
00231     CONST ExtKeyDef* pKeyDef;
00232     CONST ExtKeySubst* pKeySubst;
00233 
00234     <span class="comment">//</span>
00235     <span class="comment">// If not extended mode, or Control key or Alt key is not pressed,</span>
00236     <span class="comment">// or virtual keycode is out of range, just bail.</span>
00237     <span class="comment">//</span>
00238     <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d6/ntcon_2server_2globals_8h.html#a24">gExtendedEditKey</a> ||
00239             (pKeyEvent-&gt;dwControlKeyState &amp; (<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a7">CTRL_PRESSED</a> | <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a6">ALT_PRESSED</a>)) == 0 ||
00240             pKeyEvent-&gt;wVirtualKeyCode &lt; <span class="charliteral">'A'</span> || pKeyEvent-&gt;wVirtualKeyCode &gt; <span class="charliteral">'Z'</span>) {
00241 
00242         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00243     }
00244 
00245     <span class="comment">//</span>
00246     <span class="comment">// Get the corresponding KeyDef.</span>
00247     <span class="comment">//</span>
00248     pKeyDef = &amp;<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a12">gaKeyDef</a>[pKeyEvent-&gt;wVirtualKeyCode - <span class="charliteral">'A'</span>];
00249 
00250     <span class="comment">//</span>
00251     <span class="comment">// Get the KeySubst based on the modifier status.</span>
00252     <span class="comment">//</span>
00253     <span class="keywordflow">if</span> (pKeyEvent-&gt;dwControlKeyState &amp; <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a6">ALT_PRESSED</a>) {
00254         <span class="keywordflow">if</span> (pKeyEvent-&gt;dwControlKeyState &amp; <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a7">CTRL_PRESSED</a>) {
00255             pKeySubst = &amp;pKeyDef-&gt;keys[2];
00256         } <span class="keywordflow">else</span> {
00257             pKeySubst = &amp;pKeyDef-&gt;keys[1];
00258         }
00259     } <span class="keywordflow">else</span> {
00260         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pKeyEvent-&gt;dwControlKeyState &amp; CTRL_PRESSED);
00261         pKeySubst = &amp;pKeyDef-&gt;keys[0];
00262     }
00263 
00264     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(pKeySubst);
00265 
00266     <span class="comment">//</span>
00267     <span class="comment">// If the conbination is not defined, just bail.</span>
00268     <span class="comment">//</span>
00269     <span class="keywordflow">if</span> (pKeySubst-&gt;wVirKey == 0) {
00270         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00271     }
00272 
00273     <span class="comment">//</span>
00274     <span class="comment">// Substitute the input with ext key.</span>
00275     <span class="comment">//</span>
00276     pKeyEvent-&gt;dwControlKeyState = pKeySubst-&gt;wMod;
00277     pKeyEvent-&gt;wVirtualKeyCode = pKeySubst-&gt;wVirKey;
00278     pKeyEvent-&gt;uChar.UnicodeChar = pKeySubst-&gt;wUnicodeChar;
00279 
00280     <span class="keywordflow">return</span> pKeySubst;
00281 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a67" doxytag="server/cmdline.c::ProcessCommandLine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ProcessCommandLine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CookedReadData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Char</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>KeyState</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitReplyMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitingThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">3272</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00115">AdjustCursorPosition</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00094">AT_EOL</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03245">AtFirstCommand()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03262">AtLastCommand()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01817">BeginPopup()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00878">ClearAliases()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00024">_COMMAND::Command</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00112">COMMAND_NUM_TO_INDEX</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00065">COMMAND_NUMBER_LENGTH</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00064">COMMAND_NUMBER_PROMPT_LENGTH</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00023">_COMMAND::CommandLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02935">CommandListPopup()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03150">CommandNumberPopup()</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00149">CONSOLE_IS_DBCS_ENABLED</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00062">COPY_FROM_CHAR_PROMPT_LENGTH</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00061">COPY_TO_CHAR_PROMPT_LENGTH</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03040">CopyFromCharPopup()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03096">CopyToCharPopup()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00076">CTRL_PRESSED</a>, <a class="el" href="../../d7/d4/ioep_8h-source.html#l00067">DBGPRINT</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02009">DeleteCommandLine()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03227">EmptyCommandHistory()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04078">FindMatchingCommand()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03217">GetLastCommand()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00399">IS_WORD_DELIM</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00066">MINIMUM_COMMAND_PROMPT_SIZE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04834">RetrieveCommand()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02111">RetrieveNthCommand()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00818">RetrieveNumberOfSpaces()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00774">RetrieveTotalNumberOfSpaces()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00288">SetCursorMode()</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00474">SetCursorPosition()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00353">WC_DESTRUCTIVE_BACKSPACE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00355">WC_ECHO</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00354">WC_KEEP_CURSOR_VISIBLE</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l03047">WriteCharsFromInput()</a>.
<p>
Referenced by <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01237">CookedRead()</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00876">ProcessCookedReadInput()</a>.
<p>
<pre class="fragment"><div>03286                 :
03287 
03288     <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a> - <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a58">CommandListPopup</a> ran <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of input
03289     <a class="code" href="../../d1/d7/server_8h.html#a65">CONSOLE_STATUS_READ_COMPLETE</a> - user hit &lt;enter&gt; in <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a58">CommandListPopup</a>
03290     STATUS_SUCCESS - everything's cool
03291 
03292 --*/
03293 
03294 {
03295     COORD CurrentPosition;
03296     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CharsToWrite;
03297     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
03298     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> UpdateCursorPosition;
03299     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> ScrollY=0;
03300     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fStartFromDelim;
03301 
03302     UpdateCursorPosition = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03303     <span class="keywordflow">if</span> (Char == VK_F7 &amp;&amp;
03304         !(KeyState &amp; (RIGHT_CTRL_PRESSED | LEFT_CTRL_PRESSED | RIGHT_ALT_PRESSED | LEFT_ALT_PRESSED))) {
03305         COORD PopupSize;
03306 
03307         <span class="keywordflow">if</span> (CookedReadData-&gt;CommandHistory &amp;&amp;
03308             CookedReadData-&gt;CommandHistory-&gt;NumberOfCommands) {
03309             PopupSize.X = 40;
03310             PopupSize.Y = 10;
03311             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a45">BeginPopup</a>(CookedReadData-&gt;ScreenInfo,
03312                        CookedReadData-&gt;CommandHistory,
03313                        PopupSize
03314                       );
03315             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
03316                 <span class="comment">// CommandListPopup does EndPopup call</span>
03317                 <span class="keywordflow">return</span> <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a58">CommandListPopup</a>(CookedReadData,
03318                                         WaitReplyMessage,
03319                                         WaitingThread,
03320                                         WaitRoutine
03321                                        );
03322             }
03323         }
03324     } <span class="keywordflow">else</span> {
03325         <span class="keywordflow">switch</span> (Char) {
03326             <span class="keywordflow">case</span> VK_ESCAPE:
03327                 <a class="code" href="../../d4/d1/cmdline_8h.html#a41">DeleteCommandLine</a>(CookedReadData,
03328                                   TRUE);
03329                 <span class="keywordflow">break</span>;
03330             <span class="keywordflow">case</span> VK_UP:
03331             <span class="keywordflow">case</span> VK_DOWN:
03332             <span class="keywordflow">case</span> VK_F5:
03333                 <span class="keywordflow">if</span> (Char == VK_F5)
03334                     Char = VK_UP;
03335                 <span class="comment">// for doskey compatibility, buffer isn't circular</span>
03336                 <span class="keywordflow">if</span> (Char==VK_UP &amp;&amp; !<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a65">AtFirstCommand</a>(CookedReadData-&gt;CommandHistory) ||
03337                     Char==VK_DOWN &amp;&amp; !<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a66">AtLastCommand</a>(CookedReadData-&gt;CommandHistory)) {
03338                     <a class="code" href="../../d4/d1/cmdline_8h.html#a41">DeleteCommandLine</a>(CookedReadData,
03339                                       TRUE);
03340                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d5/consrv_8h.html#a253">RetrieveCommand</a>(CookedReadData-&gt;CommandHistory,
03341                                              Char,
03342                                              CookedReadData-&gt;BackupLimit,
03343                                              CookedReadData-&gt;BufferSize,
03344                                              &amp;CookedReadData-&gt;BytesRead);
03345                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(CookedReadData-&gt;BackupLimit == CookedReadData-&gt;BufPtr);
03346                     <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
03347                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;ScreenInfo,
03348                                 CookedReadData-&gt;BackupLimit,
03349                                 CookedReadData-&gt;BufPtr,
03350                                 CookedReadData-&gt;BufPtr,
03351                                 &amp;CookedReadData-&gt;BytesRead,
03352                                 (PLONG)&amp;CookedReadData-&gt;NumberOfVisibleChars,
03353                                 CookedReadData-&gt;OriginalCursorPosition.X,
03354                                 WC_DESTRUCTIVE_BACKSPACE |
03355                                         WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
03356                                 &amp;ScrollY );
03357                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
03358                         CookedReadData-&gt;OriginalCursorPosition.Y += ScrollY;
03359                     }
03360                     CharsToWrite = CookedReadData-&gt;BytesRead/<span class="keyword">sizeof</span>(WCHAR);
03361                     CookedReadData-&gt;CurrentPosition = CharsToWrite;
03362                     CookedReadData-&gt;BufPtr = CookedReadData-&gt;BackupLimit + CharsToWrite;
03363                 }
03364                 <span class="keywordflow">break</span>;
03365             <span class="keywordflow">case</span> VK_PRIOR:
03366             <span class="keywordflow">case</span> VK_NEXT:
03367                 <span class="keywordflow">if</span> (CookedReadData-&gt;CommandHistory &amp;&amp;
03368                     CookedReadData-&gt;CommandHistory-&gt;NumberOfCommands) {
03369 
03370                 <span class="comment">//</span>
03371                 <span class="comment">// display oldest or newest command</span>
03372                 <span class="comment">//</span>
03373 
03374                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> CommandNumber;
03375                 <span class="keywordflow">if</span> (Char == VK_PRIOR) {
03376                     CommandNumber = 0;
03377                 } <span class="keywordflow">else</span> {
03378                     CommandNumber = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CookedReadData-&gt;CommandHistory-&gt;NumberOfCommands-1);
03379                 }
03380                 <a class="code" href="../../d4/d1/cmdline_8h.html#a41">DeleteCommandLine</a>(CookedReadData,
03381                                   TRUE);
03382                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a50">RetrieveNthCommand</a>(CookedReadData-&gt;CommandHistory,
03383                                             <a class="code" href="../../d4/d1/cmdline_8h.html#a8">COMMAND_NUM_TO_INDEX</a>(CommandNumber,CookedReadData-&gt;CommandHistory),
03384                                             CookedReadData-&gt;BackupLimit,
03385                                             CookedReadData-&gt;BufferSize,
03386                                             &amp;CookedReadData-&gt;BytesRead);
03387                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(CookedReadData-&gt;BackupLimit == CookedReadData-&gt;BufPtr);
03388                 <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
03389                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;ScreenInfo,
03390                                         CookedReadData-&gt;BackupLimit,
03391                                         CookedReadData-&gt;BufPtr,
03392                                         CookedReadData-&gt;BufPtr,
03393                                         &amp;CookedReadData-&gt;BytesRead,
03394                                         (PLONG)&amp;CookedReadData-&gt;NumberOfVisibleChars,
03395                                         CookedReadData-&gt;OriginalCursorPosition.X,
03396                                         WC_DESTRUCTIVE_BACKSPACE |
03397                                                 WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
03398                                         &amp;ScrollY
03399                                         );
03400                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
03401                     CookedReadData-&gt;OriginalCursorPosition.Y += ScrollY;
03402                 }
03403                 CharsToWrite = CookedReadData-&gt;BytesRead/<span class="keyword">sizeof</span>(WCHAR);
03404                 CookedReadData-&gt;CurrentPosition = CharsToWrite;
03405                 CookedReadData-&gt;BufPtr = CookedReadData-&gt;BackupLimit + CharsToWrite;
03406                 }
03407                 <span class="keywordflow">break</span>;
03408             <span class="keywordflow">case</span> VK_END:
03409                 <span class="keywordflow">if</span> (KeyState &amp; (RIGHT_CTRL_PRESSED | LEFT_CTRL_PRESSED)) {
03410                     <a class="code" href="../../d4/d1/cmdline_8h.html#a41">DeleteCommandLine</a>(CookedReadData,
03411                                       FALSE);
03412                     CookedReadData-&gt;BytesRead = CookedReadData-&gt;CurrentPosition*<span class="keyword">sizeof</span>(WCHAR);
03413                     <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
03414                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;ScreenInfo,
03415                                             CookedReadData-&gt;BackupLimit,
03416                                             CookedReadData-&gt;BackupLimit,
03417                                             CookedReadData-&gt;BackupLimit,
03418                                             &amp;CookedReadData-&gt;BytesRead,
03419                                             (PLONG)&amp;CookedReadData-&gt;NumberOfVisibleChars,
03420                                             CookedReadData-&gt;OriginalCursorPosition.X,
03421                                             WC_DESTRUCTIVE_BACKSPACE |
03422                                                 WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
03423                                             NULL
03424                                             );
03425                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
03426                     }
03427                 } <span class="keywordflow">else</span> {
03428                     CookedReadData-&gt;CurrentPosition = CookedReadData-&gt;BytesRead/<span class="keyword">sizeof</span>(WCHAR);
03429                     CookedReadData-&gt;BufPtr = CookedReadData-&gt;BackupLimit + CookedReadData-&gt;CurrentPosition;
03430                     CurrentPosition.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CookedReadData-&gt;OriginalCursorPosition.X + CookedReadData-&gt;NumberOfVisibleChars);
03431                     CurrentPosition.Y = CookedReadData-&gt;OriginalCursorPosition.Y;
03432 <span class="preprocessor">#if defined(FE_SB)</span>
03433 <span class="preprocessor"></span>                    <span class="keywordflow">if</span> (CheckBisectProcessW(CookedReadData-&gt;ScreenInfo,
03434                                             CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;CP,
03435                                             CookedReadData-&gt;BackupLimit,
03436                                             CookedReadData-&gt;CurrentPosition,
03437                                             CookedReadData-&gt;ScreenInfo-&gt;ScreenBufferSize.X-CookedReadData-&gt;OriginalCursorPosition.X,
03438                                             CookedReadData-&gt;OriginalCursorPosition.X,
03439                                             TRUE)) {
03440                         CurrentPosition.X++;
03441                     }
03442 <span class="preprocessor">#endif</span>
03443 <span class="preprocessor"></span>                    UpdateCursorPosition = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03444                 }
03445                 <span class="keywordflow">break</span>;
03446             <span class="keywordflow">case</span> VK_HOME:
03447                 <span class="keywordflow">if</span> (KeyState &amp; (RIGHT_CTRL_PRESSED | LEFT_CTRL_PRESSED)) {
03448                     <a class="code" href="../../d4/d1/cmdline_8h.html#a41">DeleteCommandLine</a>(CookedReadData,
03449                                       FALSE);
03450                     CookedReadData-&gt;BytesRead -= CookedReadData-&gt;CurrentPosition*<span class="keyword">sizeof</span>(WCHAR);
03451                     CookedReadData-&gt;CurrentPosition = 0;
03452                     RtlCopyMemory(CookedReadData-&gt;BackupLimit,
03453                            CookedReadData-&gt;BufPtr,
03454                            CookedReadData-&gt;BytesRead
03455                            );
03456                     CookedReadData-&gt;BufPtr = CookedReadData-&gt;BackupLimit;
03457                     <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
03458                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;ScreenInfo,
03459                                             CookedReadData-&gt;BackupLimit,
03460                                             CookedReadData-&gt;BackupLimit,
03461                                             CookedReadData-&gt;BackupLimit,
03462                                             &amp;CookedReadData-&gt;BytesRead,
03463                                             (PLONG)&amp;CookedReadData-&gt;NumberOfVisibleChars,
03464                                             CookedReadData-&gt;OriginalCursorPosition.X,
03465                                             WC_DESTRUCTIVE_BACKSPACE |
03466                                                 WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
03467                                             NULL
03468                                             );
03469                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
03470                     }
03471                     CurrentPosition = CookedReadData-&gt;OriginalCursorPosition;
03472                     UpdateCursorPosition = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03473                 } <span class="keywordflow">else</span> {
03474                     CookedReadData-&gt;CurrentPosition = 0;
03475                     CookedReadData-&gt;BufPtr = CookedReadData-&gt;BackupLimit;
03476                     CurrentPosition = CookedReadData-&gt;OriginalCursorPosition;
03477                     UpdateCursorPosition = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03478                 }
03479                 <span class="keywordflow">break</span>;
03480             <span class="keywordflow">case</span> VK_LEFT:
03481                 <span class="keywordflow">if</span> (KeyState &amp; (RIGHT_CTRL_PRESSED | LEFT_CTRL_PRESSED)) {
03482                     PWCHAR LastWord;
03483                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> NonSpaceCharSeen=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03484                     <span class="keywordflow">if</span> (CookedReadData-&gt;BufPtr != CookedReadData-&gt;BackupLimit) {
03485                         LastWord = CookedReadData-&gt;BufPtr-1;
03486                         <span class="keywordflow">while</span> (LastWord != CookedReadData-&gt;BackupLimit) {
03487                             <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/cmdline_8h.html#a23">IS_WORD_DELIM</a>(*LastWord))
03488                                 NonSpaceCharSeen=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03489                             <span class="keywordflow">else</span>
03490                                 <span class="keywordflow">if</span> (NonSpaceCharSeen)
03491                                     <span class="keywordflow">break</span>;
03492                             LastWord--;
03493                         }
03494                         <span class="keywordflow">if</span> (LastWord != CookedReadData-&gt;BackupLimit) {
03495                             CookedReadData-&gt;BufPtr = LastWord+1;
03496                         } <span class="keywordflow">else</span> {
03497                             CookedReadData-&gt;BufPtr = LastWord;
03498                         }
03499                         CookedReadData-&gt;CurrentPosition=(ULONG)(CookedReadData-&gt;BufPtr-CookedReadData-&gt;BackupLimit);
03500                         CurrentPosition = CookedReadData-&gt;OriginalCursorPosition;
03501 <span class="preprocessor">#if defined(FE_SB)</span>
03502 <span class="preprocessor"></span>                        CurrentPosition.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CurrentPosition.X +
03503                             <a class="code" href="../../d0/d7/server_2stream_8c.html#a21">RetrieveTotalNumberOfSpaces</a>(CookedReadData-&gt;OriginalCursorPosition.X,
03504                                                         CookedReadData-&gt;BackupLimit,
03505                                                         CookedReadData-&gt;CurrentPosition,
03506                                                         CookedReadData-&gt;ScreenInfo-&gt;Console));
03507                         <span class="keywordflow">if</span> (CheckBisectStringW(CookedReadData-&gt;ScreenInfo,
03508                                                CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;CP,
03509                                                CookedReadData-&gt;BackupLimit,
03510                                                CookedReadData-&gt;CurrentPosition+1,
03511                                                CookedReadData-&gt;ScreenInfo-&gt;ScreenBufferSize.X
03512                                                 -CookedReadData-&gt;OriginalCursorPosition.X
03513                                                )) {
03514                             CurrentPosition.X++;
03515                         }
03516 <span class="preprocessor">#else</span>
03517 <span class="preprocessor"></span>                        CurrentPosition.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CurrentPosition.X + <a class="code" href="../../d0/d7/server_2stream_8c.html#a21">RetrieveTotalNumberOfSpaces</a>(CookedReadData-&gt;OriginalCursorPosition.X,
03518                                                                          CookedReadData-&gt;BackupLimit,
03519                                                                          CookedReadData-&gt;CurrentPosition));
03520 <span class="preprocessor">#endif</span>
03521 <span class="preprocessor"></span>                        UpdateCursorPosition = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03522                     }
03523                 } <span class="keywordflow">else</span> {
03524                     <span class="keywordflow">if</span> (CookedReadData-&gt;BufPtr != CookedReadData-&gt;BackupLimit) {
03525                         CookedReadData-&gt;BufPtr--;
03526                         CookedReadData-&gt;CurrentPosition--;
03527                         CurrentPosition.X = CookedReadData-&gt;ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition.X;
03528                         CurrentPosition.Y = CookedReadData-&gt;ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition.Y;
03529 <span class="preprocessor">#if defined(FE_SB)</span>
03530 <span class="preprocessor"></span>                        CurrentPosition.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CurrentPosition.X -
03531                             <a class="code" href="../../d0/d7/server_2stream_8c.html#a22">RetrieveNumberOfSpaces</a>(CookedReadData-&gt;OriginalCursorPosition.X,
03532                                                    CookedReadData-&gt;BackupLimit,
03533                                                    CookedReadData-&gt;CurrentPosition,
03534                                                    CookedReadData-&gt;ScreenInfo-&gt;Console,
03535                                                    CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;CP));
03536                         <span class="keywordflow">if</span> (CheckBisectProcessW(CookedReadData-&gt;ScreenInfo,
03537                                                 CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;CP,
03538                                                 CookedReadData-&gt;BackupLimit,
03539                                                 CookedReadData-&gt;CurrentPosition+2,
03540                                                 CookedReadData-&gt;ScreenInfo-&gt;ScreenBufferSize.X
03541                                                  -CookedReadData-&gt;OriginalCursorPosition.X,
03542                                                 CookedReadData-&gt;OriginalCursorPosition.X,
03543                                                 TRUE)) {
03544                             <span class="keywordflow">if</span> ((CurrentPosition.X == -2) ||
03545                                 (CurrentPosition.X == -1)) {
03546                                 CurrentPosition.X--;
03547                             }
03548                         }
03549 <span class="preprocessor">#else</span>
03550 <span class="preprocessor"></span>                        CurrentPosition.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CurrentPosition.X - <a class="code" href="../../d0/d7/server_2stream_8c.html#a22">RetrieveNumberOfSpaces</a>(CookedReadData-&gt;OriginalCursorPosition.X,
03551                                                                     CookedReadData-&gt;BackupLimit,
03552                                                                     CookedReadData-&gt;CurrentPosition));
03553 <span class="preprocessor">#endif</span>
03554 <span class="preprocessor"></span>                        UpdateCursorPosition = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03555                     }
03556                 }
03557                 <span class="keywordflow">break</span>;
03558             <span class="keywordflow">case</span> VK_RIGHT:
03559             <span class="keywordflow">case</span> VK_F1:
03560 
03561                 <span class="comment">//</span>
03562                 <span class="comment">// we don't need to check for end of buffer here because we've</span>
03563                 <span class="comment">// already done it.</span>
03564                 <span class="comment">//</span>
03565 
03566                 <span class="keywordflow">if</span> (KeyState &amp; (RIGHT_CTRL_PRESSED | LEFT_CTRL_PRESSED)) {
03567                     <span class="keywordflow">if</span> (Char != VK_F1) {
03568                         PWCHAR NextWord;
03569                         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
03570                         <span class="keywordflow">if</span> (CookedReadData-&gt;CurrentPosition &lt; (CookedReadData-&gt;BytesRead/<span class="keyword">sizeof</span>(WCHAR))) {
03571                             NextWord = CookedReadData-&gt;BufPtr;
03572                             <span class="keywordflow">for</span> (i=(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CookedReadData-&gt;CurrentPosition);
03573                                  i&lt;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((CookedReadData-&gt;BytesRead-1)/<span class="keyword">sizeof</span>(WCHAR));
03574                                  i++) {
03575                                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/cmdline_8h.html#a23">IS_WORD_DELIM</a>(*NextWord)) {
03576                                     i++;
03577                                     NextWord++;
03578                                     <span class="keywordflow">while</span> ((i&lt;(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((CookedReadData-&gt;BytesRead-1)/<span class="keyword">sizeof</span>(WCHAR))) &amp;&amp;
03579                                             <a class="code" href="../../d4/d1/cmdline_8h.html#a23">IS_WORD_DELIM</a>(*NextWord)) {
03580                                         i++;
03581                                         NextWord++;
03582                                     }
03583                                     <span class="keywordflow">break</span>;
03584                                 }
03585                                 NextWord++;
03586                             }
03587                             CookedReadData-&gt;BufPtr = NextWord;
03588                             CookedReadData-&gt;CurrentPosition=(ULONG)(CookedReadData-&gt;BufPtr-CookedReadData-&gt;BackupLimit);
03589 <span class="preprocessor">#if defined(FE_SB)</span>
03590 <span class="preprocessor"></span>                            CurrentPosition = CookedReadData-&gt;OriginalCursorPosition;
03591                             CurrentPosition.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CurrentPosition.X +
03592                                 <a class="code" href="../../d0/d7/server_2stream_8c.html#a21">RetrieveTotalNumberOfSpaces</a>(CookedReadData-&gt;OriginalCursorPosition.X,
03593                                                             CookedReadData-&gt;BackupLimit,
03594                                                             CookedReadData-&gt;CurrentPosition,
03595                                                             CookedReadData-&gt;ScreenInfo-&gt;Console));
03596                             <span class="keywordflow">if</span> (CheckBisectStringW(CookedReadData-&gt;ScreenInfo,
03597                                                    CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;CP,
03598                                                    CookedReadData-&gt;BackupLimit,
03599                                                    CookedReadData-&gt;CurrentPosition+1,
03600                                                    CookedReadData-&gt;ScreenInfo-&gt;ScreenBufferSize.X
03601                                                     -CookedReadData-&gt;OriginalCursorPosition.X
03602                                                    )) {
03603                                 CurrentPosition.X++;
03604                             }
03605 <span class="preprocessor">#else</span>
03606 <span class="preprocessor"></span>                            CurrentPosition = CookedReadData-&gt;OriginalCursorPosition;
03607                             CurrentPosition.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CurrentPosition.X + <a class="code" href="../../d0/d7/server_2stream_8c.html#a21">RetrieveTotalNumberOfSpaces</a>(CookedReadData-&gt;OriginalCursorPosition.X,
03608                                                                              CookedReadData-&gt;BackupLimit,
03609                                                                              CookedReadData-&gt;CurrentPosition));
03610 <span class="preprocessor">#endif</span>
03611 <span class="preprocessor"></span>                            UpdateCursorPosition = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03612                         }
03613                     }
03614                 } <span class="keywordflow">else</span> {
03615 
03616                     <span class="comment">//</span>
03617                     <span class="comment">// if not at the end of the line, move cursor position right</span>
03618                     <span class="comment">//</span>
03619 
03620                     <span class="keywordflow">if</span> (CookedReadData-&gt;CurrentPosition &lt; (CookedReadData-&gt;BytesRead/<span class="keyword">sizeof</span>(WCHAR))) {
03621                         CurrentPosition = CookedReadData-&gt;ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition;
03622 <span class="preprocessor">#if defined(FE_SB)</span>
03623 <span class="preprocessor"></span>                        CurrentPosition.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CurrentPosition.X +
03624                             <a class="code" href="../../d0/d7/server_2stream_8c.html#a22">RetrieveNumberOfSpaces</a>(CookedReadData-&gt;OriginalCursorPosition.X,
03625                                                    CookedReadData-&gt;BackupLimit,
03626                                                    CookedReadData-&gt;CurrentPosition,
03627                                                    CookedReadData-&gt;ScreenInfo-&gt;Console,
03628                                                    CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;CP));
03629                         <span class="keywordflow">if</span> (CheckBisectProcessW(CookedReadData-&gt;ScreenInfo,
03630                                                 CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;CP,
03631                                                 CookedReadData-&gt;BackupLimit,
03632                                                 CookedReadData-&gt;CurrentPosition+2,
03633                                                 CookedReadData-&gt;ScreenInfo-&gt;ScreenBufferSize.X
03634                                                  -CookedReadData-&gt;OriginalCursorPosition.X,
03635                                                 CookedReadData-&gt;OriginalCursorPosition.X,
03636                                                 TRUE)) {
03637                             <span class="keywordflow">if</span> (CurrentPosition.X == (CookedReadData-&gt;ScreenInfo-&gt;ScreenBufferSize.X-1))
03638                                 CurrentPosition.X++;
03639                         }
03640 <span class="preprocessor">#else</span>
03641 <span class="preprocessor"></span>                        CurrentPosition.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CurrentPosition.X + <a class="code" href="../../d0/d7/server_2stream_8c.html#a22">RetrieveNumberOfSpaces</a>(CookedReadData-&gt;OriginalCursorPosition.X,
03642                                                                     CookedReadData-&gt;BackupLimit,
03643                                                                     CookedReadData-&gt;CurrentPosition));
03644 <span class="preprocessor">#endif</span>
03645 <span class="preprocessor"></span>                        CookedReadData-&gt;BufPtr++;
03646                         CookedReadData-&gt;CurrentPosition++;
03647                         UpdateCursorPosition = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03648 
03649                     <span class="comment">//</span>
03650                     <span class="comment">// if at the end of the line, copy a character from the</span>
03651                     <span class="comment">// same position in the last command</span>
03652                     <span class="comment">//</span>
03653 
03654                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (CookedReadData-&gt;CommandHistory) {
03655                         <a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> LastCommand;
03656                         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> NumSpaces;
03657                         LastCommand = <a class="code" href="../../d4/d1/cmdline_8h.html#a55">GetLastCommand</a>(CookedReadData-&gt;CommandHistory);
03658                         <span class="keywordflow">if</span> (LastCommand &amp;&amp; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(LastCommand-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>/<span class="keyword">sizeof</span>(WCHAR)) &gt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)CookedReadData-&gt;CurrentPosition) {
03659                             *CookedReadData-&gt;BufPtr = LastCommand-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o1">Command</a>[CookedReadData-&gt;CurrentPosition];
03660                             CookedReadData-&gt;BytesRead += <span class="keyword">sizeof</span>(WCHAR);
03661                             CookedReadData-&gt;CurrentPosition++;
03662                             <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
03663                                 CharsToWrite = <span class="keyword">sizeof</span>(WCHAR);
03664                                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(
03665                                         CookedReadData-&gt;ScreenInfo,
03666                                         CookedReadData-&gt;BackupLimit,
03667                                         CookedReadData-&gt;BufPtr,
03668                                         CookedReadData-&gt;BufPtr,
03669                                         &amp;CharsToWrite,
03670                                         (PLONG)&amp;NumSpaces,
03671                                         CookedReadData-&gt;OriginalCursorPosition.X,
03672                                         WC_DESTRUCTIVE_BACKSPACE |
03673                                                 WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
03674                                         &amp;ScrollY);
03675                                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
03676                                 CookedReadData-&gt;OriginalCursorPosition.Y += ScrollY;
03677                                 CookedReadData-&gt;NumberOfVisibleChars += NumSpaces;
03678                             }
03679                             CookedReadData-&gt;BufPtr+=1;
03680                         }
03681                     }
03682                 }
03683                 <span class="keywordflow">break</span>;
03684             <span class="keywordflow">case</span> VK_F2:
03685 
03686                 <span class="comment">//</span>
03687                 <span class="comment">// copy the previous command to the current command, up to but</span>
03688                 <span class="comment">// not including the character specified by the user.  the user</span>
03689                 <span class="comment">// is prompted via popup to enter a character.</span>
03690                 <span class="comment">//</span>
03691 
03692                 <span class="keywordflow">if</span> (CookedReadData-&gt;CommandHistory) {
03693                     COORD PopupSize;
03694 
03695                     PopupSize.X = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a0">COPY_TO_CHAR_PROMPT_LENGTH</a>+2;
03696                     PopupSize.Y = 1;
03697                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a45">BeginPopup</a>(CookedReadData-&gt;ScreenInfo,
03698                                CookedReadData-&gt;CommandHistory,
03699                                PopupSize
03700                               );
03701                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
03702                         <span class="comment">// CopyToCharPopup does EndPopup call</span>
03703                         <span class="keywordflow">return</span> <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a61">CopyToCharPopup</a>(CookedReadData,
03704                                                WaitReplyMessage,
03705                                                WaitingThread,
03706                                                WaitRoutine
03707                                               );
03708                     }
03709                 }
03710                 <span class="keywordflow">break</span>;
03711             <span class="keywordflow">case</span> VK_F3:
03712 
03713                 <span class="comment">//</span>
03714                 <span class="comment">// copy the remainder of the previous command to the current command.</span>
03715                 <span class="comment">//</span>
03716 
03717                 <span class="keywordflow">if</span> (CookedReadData-&gt;CommandHistory) {
03718                     <a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> LastCommand;
03719                     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> NumSpaces;
03720                     <span class="keywordtype">int</span> j;  <span class="comment">// chars, not bytes</span>
03721                     LastCommand = <a class="code" href="../../d4/d1/cmdline_8h.html#a55">GetLastCommand</a>(CookedReadData-&gt;CommandHistory);
03722                     <span class="keywordflow">if</span> (LastCommand &amp;&amp; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(LastCommand-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>/<span class="keyword">sizeof</span>(WCHAR)) &gt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)CookedReadData-&gt;CurrentPosition) {
03723                         j = (LastCommand-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>/<span class="keyword">sizeof</span>(WCHAR)) - CookedReadData-&gt;CurrentPosition;
03724                         RtlCopyMemory(CookedReadData-&gt;BufPtr,
03725                                 &amp;LastCommand-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o1">Command</a>[CookedReadData-&gt;CurrentPosition],
03726                                 j*<span class="keyword">sizeof</span>(WCHAR)
03727                                );
03728                         CookedReadData-&gt;CurrentPosition += j;
03729                         j *= <span class="keyword">sizeof</span>(WCHAR);
03730                         CookedReadData-&gt;BytesRead += j;
03731                         <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
03732                             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;ScreenInfo,
03733                                     CookedReadData-&gt;BackupLimit,
03734                                     CookedReadData-&gt;BufPtr,
03735                                     CookedReadData-&gt;BufPtr,
03736                                     (PDWORD) &amp;j,
03737                                     (PLONG)&amp;NumSpaces,
03738                                     CookedReadData-&gt;OriginalCursorPosition.X,
03739                                     WC_DESTRUCTIVE_BACKSPACE |
03740                                             WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
03741                                     &amp;ScrollY);
03742                             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
03743                             CookedReadData-&gt;OriginalCursorPosition.Y += ScrollY;
03744                             CookedReadData-&gt;NumberOfVisibleChars += NumSpaces;
03745                         }
03746                         CookedReadData-&gt;BufPtr+=j/<span class="keyword">sizeof</span>(WCHAR);
03747                     }
03748                 }
03749                 <span class="keywordflow">break</span>;
03750             <span class="keywordflow">case</span> VK_F4:
03751 
03752                 <span class="comment">//</span>
03753                 <span class="comment">// copy the previous command to the current command, from</span>
03754                 <span class="comment">// the letter specified by the user.   the user</span>
03755                 <span class="comment">// is prompted via popup to enter a character.</span>
03756                 <span class="comment">//</span>
03757 
03758                 <span class="keywordflow">if</span> (CookedReadData-&gt;CommandHistory) {
03759                     COORD PopupSize;
03760 
03761                     PopupSize.X = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a1">COPY_FROM_CHAR_PROMPT_LENGTH</a>+2;
03762                     PopupSize.Y = 1;
03763                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a45">BeginPopup</a>(CookedReadData-&gt;ScreenInfo,
03764                                CookedReadData-&gt;CommandHistory,
03765                                PopupSize
03766                               );
03767                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
03768                         <span class="comment">// CopyFromCharPopup does EndPopup call</span>
03769                         <span class="keywordflow">return</span> <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a60">CopyFromCharPopup</a>(CookedReadData,
03770                                                WaitReplyMessage,
03771                                                WaitingThread,
03772                                                WaitRoutine
03773                                               );
03774                     }
03775                 }
03776                 <span class="keywordflow">break</span>;
03777             <span class="keywordflow">case</span> VK_F6:
03778 
03779                 <span class="comment">//</span>
03780                 <span class="comment">// place a ctrl-z in the current command line</span>
03781                 <span class="comment">//</span>
03782 
03783                 {
03784                 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> NumSpaces;
03785                 *CookedReadData-&gt;BufPtr = (WCHAR)0x1a; <span class="comment">// ctrl-z</span>
03786                 CookedReadData-&gt;BytesRead += <span class="keyword">sizeof</span>(WCHAR);
03787                 CookedReadData-&gt;CurrentPosition++;
03788                 <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
03789                     CharsToWrite = <span class="keyword">sizeof</span>(WCHAR);
03790                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;ScreenInfo,
03791                                         CookedReadData-&gt;BackupLimit,
03792                                         CookedReadData-&gt;BufPtr,
03793                                         CookedReadData-&gt;BufPtr,
03794                                         &amp;CharsToWrite,
03795                                         (PLONG)&amp;NumSpaces,
03796                                         CookedReadData-&gt;OriginalCursorPosition.X,
03797                                         WC_DESTRUCTIVE_BACKSPACE |
03798                                                 WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
03799                                         &amp;ScrollY
03800                                         );
03801                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
03802                     CookedReadData-&gt;OriginalCursorPosition.Y += ScrollY;
03803                     CookedReadData-&gt;NumberOfVisibleChars += NumSpaces;
03804                 }
03805                 CookedReadData-&gt;BufPtr+=1;
03806                 }
03807                 <span class="keywordflow">break</span>;
03808             <span class="keywordflow">case</span> VK_F7:
03809                 <span class="keywordflow">if</span> (KeyState &amp; (RIGHT_ALT_PRESSED | LEFT_ALT_PRESSED)) {
03810                     <a class="code" href="../../d4/d1/cmdline_8h.html#a43">EmptyCommandHistory</a>(CookedReadData-&gt;CommandHistory);
03811                     CookedReadData-&gt;CommandHistory-&gt;Flags |= <a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>;
03812                 }
03813                 <span class="keywordflow">break</span>;
03814             <span class="keywordflow">case</span> VK_F8:
03815                 <span class="keywordflow">if</span> (CookedReadData-&gt;CommandHistory) {
03816                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
03817 
03818                     <span class="comment">//</span>
03819                     <span class="comment">// cycles through the stored commands that start with</span>
03820                     <span class="comment">// the characters in the current command</span>
03821                     <span class="comment">//</span>
03822 
03823                     i = <a class="code" href="../../d4/d1/cmdline_8h.html#a56">FindMatchingCommand</a>(CookedReadData-&gt;CommandHistory,
03824                             CookedReadData-&gt;BackupLimit,
03825                             CookedReadData-&gt;CurrentPosition*<span class="keyword">sizeof</span>(WCHAR),
03826                             CookedReadData-&gt;CommandHistory-&gt;LastDisplayed, 0);
03827                     <span class="keywordflow">if</span> (i!=-1) {
03828                         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> CurrentPosition;
03829                         COORD CursorPosition;
03830 
03831                         <span class="comment">//</span>
03832                         <span class="comment">// save cursor position</span>
03833                         <span class="comment">//</span>
03834 
03835                         CurrentPosition = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)CookedReadData-&gt;CurrentPosition;
03836                         CursorPosition = CookedReadData-&gt;ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition;
03837 
03838                         <a class="code" href="../../d4/d1/cmdline_8h.html#a41">DeleteCommandLine</a>(CookedReadData,
03839                                           TRUE);
03840                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a50">RetrieveNthCommand</a>(CookedReadData-&gt;CommandHistory,
03841                                                     i,
03842                                                     CookedReadData-&gt;BackupLimit,
03843                                                     CookedReadData-&gt;BufferSize,
03844                                                     &amp;CookedReadData-&gt;BytesRead);
03845                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(CookedReadData-&gt;BackupLimit == CookedReadData-&gt;BufPtr);
03846                         <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
03847                             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;ScreenInfo,
03848                                     CookedReadData-&gt;BackupLimit,
03849                                     CookedReadData-&gt;BufPtr,
03850                                     CookedReadData-&gt;BufPtr,
03851                                     &amp;CookedReadData-&gt;BytesRead,
03852                                     (PLONG)&amp;CookedReadData-&gt;NumberOfVisibleChars,
03853                                     CookedReadData-&gt;OriginalCursorPosition.X,
03854                                     WC_DESTRUCTIVE_BACKSPACE |
03855                                             WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
03856                                     &amp;ScrollY);
03857                             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
03858                             CookedReadData-&gt;OriginalCursorPosition.Y += ScrollY;
03859                         }
03860                         CursorPosition.Y += ScrollY;
03861 
03862                         <span class="comment">//</span>
03863                         <span class="comment">// restore cursor position</span>
03864                         <span class="comment">//</span>
03865 
03866                         CookedReadData-&gt;BufPtr = CookedReadData-&gt;BackupLimit + CurrentPosition;
03867                         CookedReadData-&gt;CurrentPosition = CurrentPosition;
03868                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a7">SetCursorPosition</a>(CookedReadData-&gt;ScreenInfo,
03869                                                    CursorPosition,
03870                                                    TRUE
03871                                                   );
03872                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
03873                     }
03874                 }
03875                 <span class="keywordflow">break</span>;
03876             <span class="keywordflow">case</span> VK_F9:
03877 
03878                 <span class="comment">//</span>
03879                 <span class="comment">// prompt the user to enter the desired command number.</span>
03880                 <span class="comment">// copy that command to the command line.</span>
03881                 <span class="comment">//</span>
03882 
03883                 {
03884                 COORD PopupSize;
03885 
03886                 <span class="keywordflow">if</span> (CookedReadData-&gt;CommandHistory &amp;&amp;
03887                     CookedReadData-&gt;CommandHistory-&gt;NumberOfCommands &amp;&amp;
03888                     CookedReadData-&gt;ScreenInfo-&gt;ScreenBufferSize.X &gt;= <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a4">MINIMUM_COMMAND_PROMPT_SIZE</a>+2) {  <span class="comment">// 2 is for border</span>
03889                     PopupSize.X = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a2">COMMAND_NUMBER_PROMPT_LENGTH</a>+<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a3">COMMAND_NUMBER_LENGTH</a>;
03890                     PopupSize.Y = 1;
03891                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a45">BeginPopup</a>(CookedReadData-&gt;ScreenInfo,
03892                                         CookedReadData-&gt;CommandHistory,
03893                                         PopupSize
03894                                        );
03895                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
03896                         <span class="comment">// CommandNumberPopup does EndPopup call</span>
03897                         <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/cmdline_8h.html#a57">CommandNumberPopup</a>(CookedReadData,
03898                                                   WaitReplyMessage,
03899                                                   WaitingThread,
03900                                                   WaitRoutine
03901                                                  );
03902                     }
03903                 }
03904                 }
03905                 <span class="keywordflow">break</span>;
03906             <span class="keywordflow">case</span> VK_F10:
03907                 <span class="keywordflow">if</span> (KeyState &amp; (RIGHT_ALT_PRESSED | LEFT_ALT_PRESSED)) {
03908                     <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a32">ClearAliases</a>(CookedReadData-&gt;Console);
03909                 }
03910                 <span class="keywordflow">break</span>;
03911             <span class="keywordflow">case</span> VK_INSERT:
03912                 CookedReadData-&gt;InsertMode = !CookedReadData-&gt;InsertMode;
03913                 <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a5">SetCursorMode</a>(CookedReadData-&gt;ScreenInfo,
03914                               (BOOLEAN)(CookedReadData-&gt;InsertMode != CookedReadData-&gt;Console-&gt;InsertMode));
03915                 <span class="keywordflow">break</span>;
03916         <span class="keywordflow">case</span> VK_DELETE:
03917                 <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d3/input_8h.html#a12">AT_EOL</a>(CookedReadData)) {
03918                     COORD CursorPosition;
03919 
03920                     fStartFromDelim = <a class="code" href="../../d4/d1/cmdline_8h.html#a23">IS_WORD_DELIM</a>(*CookedReadData-&gt;BufPtr);
03921 
03922 del_repeat:
03923                     <span class="comment">//</span>
03924                     <span class="comment">// save cursor position</span>
03925                     <span class="comment">//</span>
03926 
03927                     CursorPosition = CookedReadData-&gt;ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition;
03928 
03929                     <span class="comment">//</span>
03930                     <span class="comment">// deletecommandline</span>
03931                     <span class="comment">//</span>
03932 
03933                     <a class="code" href="../../d4/d1/cmdline_8h.html#a41">DeleteCommandLine</a>(CookedReadData,
03934                                       FALSE);
03935                     <span class="comment">//</span>
03936                     <span class="comment">// delete char</span>
03937                     <span class="comment">//</span>
03938 
03939                     CookedReadData-&gt;BytesRead -= <span class="keyword">sizeof</span>(WCHAR);
03940                     RtlCopyMemory(CookedReadData-&gt;BufPtr,
03941                            CookedReadData-&gt;BufPtr+1,
03942                            CookedReadData-&gt;BytesRead - (CookedReadData-&gt;CurrentPosition*<span class="keyword">sizeof</span>(WCHAR))
03943                           );
03944 
03945 <span class="preprocessor">#if defined(FE_SB)</span>
03946 <span class="preprocessor"></span>                    {
03947                         PWCHAR buf = (PWCHAR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)CookedReadData-&gt;BackupLimit +
03948                                                      CookedReadData-&gt;BytesRead    );
03949                         *buf = (WCHAR)<span class="charliteral">' '</span>;
03950                     }
03951 <span class="preprocessor">#endif</span>
03952 <span class="preprocessor"></span>                    <span class="comment">//</span>
03953                     <span class="comment">// write commandline</span>
03954                     <span class="comment">//</span>
03955 
03956                     <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
03957                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;ScreenInfo,
03958                                 CookedReadData-&gt;BackupLimit,
03959                                 CookedReadData-&gt;BackupLimit,
03960                                 CookedReadData-&gt;BackupLimit,
03961                                 &amp;CookedReadData-&gt;BytesRead,
03962                                 (PLONG)&amp;CookedReadData-&gt;NumberOfVisibleChars,
03963                                 CookedReadData-&gt;OriginalCursorPosition.X,
03964                                 WC_DESTRUCTIVE_BACKSPACE |
03965                                         WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
03966                                 NULL);
03967                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
03968                     }
03969 
03970                     <span class="comment">//</span>
03971                     <span class="comment">// restore cursor position</span>
03972                     <span class="comment">//</span>
03973 
03974                     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d5/consrv_8h.html#a32">CONSOLE_IS_DBCS_ENABLED</a>() &amp;&amp; CONSOLE_IS_DBCS_CP(CookedReadData-&gt;Console)) {
03975                         <span class="keywordflow">if</span> (CheckBisectProcessW(CookedReadData-&gt;ScreenInfo,
03976                                                 CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;CP,
03977                                                 CookedReadData-&gt;BackupLimit,
03978                                                 CookedReadData-&gt;CurrentPosition+1,
03979                                                 CookedReadData-&gt;ScreenInfo-&gt;ScreenBufferSize.X
03980                                                  -CookedReadData-&gt;OriginalCursorPosition.X,
03981                                                 CookedReadData-&gt;OriginalCursorPosition.X,
03982                                                 TRUE)) {
03983                             CursorPosition.X++;
03984                         }
03985                         CurrentPosition = CursorPosition;
03986                         <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
03987                             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a10">AdjustCursorPosition</a>(CookedReadData-&gt;ScreenInfo,
03988                                                           CurrentPosition,
03989                                                           TRUE,
03990                                                           NULL);
03991                             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
03992                         }
03993                     }
03994                     <span class="keywordflow">else</span> {
03995                         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a7">SetCursorPosition</a>(CookedReadData-&gt;ScreenInfo,
03996                                                    CursorPosition,
03997                                                    TRUE
03998                                                   );
03999                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
04000                     }
04001 
04002                     <span class="comment">// If Ctrl key is pressed, delete a word.</span>
04003                     <span class="comment">// If the start point was word delimiter, just remove delimiters portion only.</span>
04004                     <span class="keywordflow">if</span> ((KeyState &amp; <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a7">CTRL_PRESSED</a>) &amp;&amp; !<a class="code" href="../../d9/d3/input_8h.html#a12">AT_EOL</a>(CookedReadData) &amp;&amp;
04005                             fStartFromDelim ^ !<a class="code" href="../../d4/d1/cmdline_8h.html#a23">IS_WORD_DELIM</a>(*CookedReadData-&gt;BufPtr)) {
04006                         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"Repeating it(%x).\n"</span>, *CookedReadData-&gt;BufPtr));
04007                         <span class="keywordflow">goto</span> del_repeat;
04008                     }
04009                 }
04010                 <span class="keywordflow">break</span>;
04011             <span class="keywordflow">default</span>:
04012                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(FALSE);
04013                 <span class="keywordflow">break</span>;
04014         }
04015     }
04016     <span class="keywordflow">if</span> (UpdateCursorPosition &amp;&amp; CookedReadData-&gt;Echo) {
04017         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a10">AdjustCursorPosition</a>(CookedReadData-&gt;ScreenInfo,
04018                                       CurrentPosition,
04019                                       TRUE,
04020                                       NULL);
04021         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
04022     }
04023     <span class="keywordflow">return</span> STATUS_SUCCESS;
04024 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a54" doxytag="server/cmdline.c::ProcessCommandListInput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ProcessCommandListInput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>CookedReadDataPtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitReplyMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitingThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">2287</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01817">BeginPopup()</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00079">_INPUT_READ_HANDLE_DATA::BufPtr</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00077">_INPUT_READ_HANDLE_DATA::BytesAvailable</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00071">CHAR_COUNT</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l02929">CloseOutputHandle()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00065">COMMAND_NUMBER_LENGTH</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00064">COMMAND_NUMBER_PROMPT_LENGTH</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00099">_COOKED_READ_DATA::CommandHistory</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03150">CommandNumberPopup()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00088">_COOKED_READ_DATA::Console</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00392">CONSOLE_FROMTHREADPERPROCESSDATA</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00351">CONSOLE_STATUS_READ_COMPLETE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00350">CONSOLE_STATUS_WAIT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00352">CONSOLE_STATUS_WAIT_NO_BLOCK</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01541">CookedReadWaitRoutine()</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00078">_INPUT_READ_HANDLE_DATA::CurrentBufPtr</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00048">_CLE_POPUP::CurrentCommand</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01910">EndPopup()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04078">FindMatchingCommand()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00307">FMCFL_JUST_LOOKING</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00263">GetChar()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00307">HANDLE_INPUT_PENDING</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00308">HANDLE_MULTI_LINE_INPUT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00105">_COOKED_READ_DATA::HandleIndex</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00066">_INPUT_READ_HANDLE_DATA::InputHandleFlags</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00086">_COOKED_READ_DATA::InputInfo</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00318">_HANDLE_DATA::InputReadData</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01105">MatchandCopyAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00066">MINIMUM_COMMAND_PROMPT_SIZE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00072">_COMMAND_HISTORY::NumberOfCommands</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00442">_CONSOLE_READCONSOLE_MSG::NumBytes</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d5/d5/conmsg_8h.html#a78">PCONSOLE_READCONSOLE_MSG</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00058">POPUP_SIZE_Y</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00078">_COMMAND_HISTORY::PopupList</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00876">ProcessCookedReadInput()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00104">_COOKED_READ_DATA::ProcessData</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00065">_INPUT_READ_HANDLE_DATA::ReadCount</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02136">SetCurrentCommandLine()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00378">UCLP_WRAP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00447">_CONSOLE_READCONSOLE_MSG::Unicode</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00177">UNICODE_CARRIAGERETURN</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00178">UNICODE_LINEFEED</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04500">UpdateCommandListPopup()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02935">CommandListPopup()</a>.
<p>
<pre class="fragment"><div>02299                 :
02300 
02301         <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a> - we ran <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of input, so
02302             a wait block was created
02303 
02304         <a class="code" href="../../d1/d7/server_8h.html#a65">CONSOLE_STATUS_READ_COMPLETE</a> - user hit <span class="keywordflow">return</span>
02305 
02306 --*/
02307 
02308 {
02309     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02310     <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup;
02311     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory;
02312     <a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData=(<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>)CookedReadDataPtr;
02313     WCHAR Char;
02314     BOOLEAN CommandLinePopupKeys = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02315     <a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html">PCONSOLE_READCONSOLE_MSG</a> a;
02316     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
02317     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
02318 
02319     CommandHistory = CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>;
02320     Popup = CONTAINING_RECORD( CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o9">PopupList</a>.Flink, <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">CLE_POPUP</a>, ListLink );
02321     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o18">ProcessData</a>,
02322                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o19">HandleIndex</a>,
02323                                         &amp;HandleData
02324                                        );
02325     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02326     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02327         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a19">GetChar</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o0">InputInfo</a>,
02328                          &amp;Char,
02329                          TRUE,
02330                          CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o2">Console</a>,
02331                          HandleData,
02332                          WaitReplyMessage,
02333                          CookedReadWaitRoutine,
02334                          CookedReadData,
02335                          <span class="keyword">sizeof</span>(*CookedReadData),
02336                          WaitRoutine,
02337                          NULL,
02338                          &amp;CommandLinePopupKeys,
02339                          NULL,
02340                          NULL
02341                         );
02342         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02343             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
02344                 CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a> = 0;
02345             }
02346             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02347         }
02348 
02349         <span class="keywordflow">if</span> (CommandLinePopupKeys) {
02350             <span class="keywordflow">switch</span> (Char) {
02351             <span class="keywordflow">case</span> VK_F9:
02352 
02353                 <span class="comment">//</span>
02354                 <span class="comment">// prompt the user to enter the desired command number.</span>
02355                 <span class="comment">// copy that command to the command line.</span>
02356                 <span class="comment">//</span>
02357 
02358                 {
02359                 COORD PopupSize;
02360 
02361                 <span class="keywordflow">if</span> (CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a> &amp;&amp;
02362                     CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o5">ScreenBufferSize</a>.X &gt;= <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a4">MINIMUM_COMMAND_PROMPT_SIZE</a>+2) {  <span class="comment">// 2 is for border</span>
02363                     PopupSize.X = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a2">COMMAND_NUMBER_PROMPT_LENGTH</a>+<a class="code" href="../../d3/d1/server_2cmdline_8c.html#a3">COMMAND_NUMBER_LENGTH</a>;
02364                     PopupSize.Y = 1;
02365                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a45">BeginPopup</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,
02366                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>,
02367                                         PopupSize
02368                                        );
02369                     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02370                         <span class="comment">// CommandNumberPopup does EndPopup call</span>
02371                         <span class="keywordflow">return</span> <a class="code" href="../../d4/d1/cmdline_8h.html#a57">CommandNumberPopup</a>(CookedReadData,
02372                                                   WaitReplyMessage,
02373                                                   WaitingThread,
02374                                                   WaitRoutine
02375                                                  );
02376                     }
02377                 }
02378                 }
02379                 <span class="keywordflow">break</span>;
02380             <span class="keywordflow">case</span> VK_ESCAPE:
02381                 <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a46">EndPopup</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,CommandHistory);
02382                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o1">ReadCount</a> += 1;
02383                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d7/server_8h.html#a66">CONSOLE_STATUS_WAIT_NO_BLOCK</a>;
02384             <span class="keywordflow">case</span> VK_UP:
02385                 <a class="code" href="../../d4/d1/cmdline_8h.html#a62">UpdateCommandListPopup</a>(-1,
02386                                        &amp;Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o6">CurrentCommand</a>,
02387                                        CommandHistory,
02388                                        Popup,
02389                                        CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>, 0);
02390                 <span class="keywordflow">break</span>;
02391             <span class="keywordflow">case</span> VK_DOWN:
02392                 <a class="code" href="../../d4/d1/cmdline_8h.html#a62">UpdateCommandListPopup</a>(1,
02393                                        &amp;Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o6">CurrentCommand</a>,
02394                                        CommandHistory,
02395                                        Popup,
02396                                        CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>, 0);
02397                 <span class="keywordflow">break</span>;
02398             <span class="keywordflow">case</span> VK_END:
02399                 <span class="comment">/*</span>
02400 <span class="comment">                 * Move waaay forward, UpdateCommandListPopup() can handle it.</span>
02401 <span class="comment">                 */</span>
02402                 <a class="code" href="../../d4/d1/cmdline_8h.html#a62">UpdateCommandListPopup</a>((SHORT)(CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o3">NumberOfCommands</a>),
02403                                        &amp;Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o6">CurrentCommand</a>,
02404                                        CommandHistory,
02405                                        Popup,
02406                                        CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>, 0);
02407                 <span class="keywordflow">break</span>;
02408             <span class="keywordflow">case</span> VK_HOME:
02409                 <span class="comment">/*</span>
02410 <span class="comment">                 * Move waaay back, UpdateCommandListPopup() can handle it.</span>
02411 <span class="comment">                 */</span>
02412                 <a class="code" href="../../d4/d1/cmdline_8h.html#a62">UpdateCommandListPopup</a>((SHORT)-(CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o3">NumberOfCommands</a>),
02413                                        &amp;Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o6">CurrentCommand</a>,
02414                                        CommandHistory,
02415                                        Popup,
02416                                        CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>, 0);
02417                 <span class="keywordflow">break</span>;
02418             <span class="keywordflow">case</span> VK_PRIOR:
02419                 <a class="code" href="../../d4/d1/cmdline_8h.html#a62">UpdateCommandListPopup</a>((SHORT)-<a class="code" href="../../d4/d1/cmdline_8h.html#a2">POPUP_SIZE_Y</a>(Popup),
02420                                        &amp;Popup-&gt;CurrentCommand,
02421                                        CommandHistory,
02422                                        Popup,
02423                                        CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>, 0);
02424                 <span class="keywordflow">break</span>;
02425             <span class="keywordflow">case</span> VK_NEXT:
02426                 <a class="code" href="../../d4/d1/cmdline_8h.html#a62">UpdateCommandListPopup</a>(<a class="code" href="../../d4/d1/cmdline_8h.html#a2">POPUP_SIZE_Y</a>(Popup),
02427                                        &amp;Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o6">CurrentCommand</a>,
02428                                        CommandHistory,
02429                                        Popup,
02430                                        CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>, 0);
02431                 <span class="keywordflow">break</span>;
02432             <span class="keywordflow">case</span> VK_LEFT:
02433             <span class="keywordflow">case</span> VK_RIGHT:
02434                 <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o6">CurrentCommand</a>;
02435                 <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a46">EndPopup</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,CommandHistory);
02436                 <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a51">SetCurrentCommandLine</a>(CookedReadData,Index);
02437                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o1">ReadCount</a> += 1;
02438                 <span class="keywordflow">return</span> <a class="code" href="../../d1/d7/server_8h.html#a66">CONSOLE_STATUS_WAIT_NO_BLOCK</a>;
02439             <span class="keywordflow">default</span>:
02440                 <span class="keywordflow">break</span>;
02441             }
02442         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Char == <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>) {
02443             ULONG i,lStringLength;
02444             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> LineCount=1;
02445             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o6">CurrentCommand</a>;
02446             <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a46">EndPopup</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,CommandHistory);
02447             <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a51">SetCurrentCommandLine</a>(CookedReadData,Index);
02448             lStringLength = CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a>;
02449             <a class="code" href="../../d0/d7/server_2stream_8c.html#a23">ProcessCookedReadInput</a>(CookedReadData,
02450                                    UNICODE_CARRIAGERETURN,
02451                                    0,
02452                                    &amp;Status);
02453             <span class="comment">//</span>
02454             <span class="comment">// complete read</span>
02455             <span class="comment">//</span>
02456 
02457             <span class="keywordflow">if</span> (CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o14">Echo</a>) {
02458 
02459                 <span class="comment">//</span>
02460                 <span class="comment">// check for alias</span>
02461                 <span class="comment">//</span>
02462 
02463                 i = CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o6">BufferSize</a>;
02464                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d8/d5/consrv_8h.html#a251">MatchandCopyAlias</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o2">Console</a>,
02465                                                  CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>,
02466                                                  (USHORT)lStringLength,
02467                                                  CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>,
02468                                                  (PUSHORT)&amp;i,
02469                                                  CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o20">ExeName</a>,
02470                                                  CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o21">ExeNameLength</a>,
02471                                                  &amp;LineCount
02472                                                 ))) {
02473                   CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a> = i;
02474                 }
02475                 <a class="code" href="../../d0/d7/server_2stream_8c.html#a36">CloseOutputHandle</a>(<a class="code" href="../../d1/d7/server_8h.html#a83">CONSOLE_FROMTHREADPERPROCESSDATA</a>(WaitingThread),
02476                                   CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o2">Console</a>,
02477                                   &amp;CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o3">TempHandle</a>,
02478                                   NULL,
02479                                   FALSE
02480                                  );
02481             }
02482             WaitReplyMessage-&gt;ReturnValue = STATUS_SUCCESS;
02483             a = (<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html">PCONSOLE_READCONSOLE_MSG</a>)&amp;WaitReplyMessage-&gt;u.ApiMessageData;
02484             <span class="keywordflow">if</span> (CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a> &gt; CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o4">UserBufferSize</a> || LineCount &gt; 1) {
02485                 <span class="keywordflow">if</span> (LineCount &gt; 1) {
02486                     PWSTR Tmp;
02487                     HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o2">InputHandleFlags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a53">HANDLE_MULTI_LINE_INPUT</a>;
02488                     <span class="keywordflow">for</span> (Tmp=CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>;*Tmp!=<a class="code" href="../../d4/d5/conimep_8h.html#a54">UNICODE_LINEFEED</a>;Tmp++)
02489                         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Tmp&lt;(CookedReadData-&gt;BackupLimit+CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a>));
02490                     a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> = (ULONG)(Tmp-CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>+1)*<span class="keyword">sizeof</span>(*Tmp);
02491                 } <span class="keywordflow">else</span> {
02492                     a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> = CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o4">UserBufferSize</a>;
02493                 }
02494                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o2">InputHandleFlags</a> |= <a class="code" href="../../d1/d7/server_8h.html#a52">HANDLE_INPUT_PENDING</a>;
02495                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o5">BufPtr</a> = CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>;
02496                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o3">BytesAvailable</a> = CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a> - a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>;
02497                 HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o4">CurrentBufPtr</a>=(PWCHAR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>+a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>);
02498                 RtlCopyMemory(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o5">UserBuffer</a>,CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>,a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>);
02499             }
02500             <span class="keywordflow">else</span> {
02501                 a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> = CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a>;
02502                 RtlCopyMemory(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o5">UserBuffer</a>,CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>,a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>);
02503             }
02504             <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o10">Unicode</a>) {
02505 
02506                 <span class="comment">//</span>
02507                 <span class="comment">// if ansi, translate string.</span>
02508                 <span class="comment">//</span>
02509 
02510                 PCHAR TransBuffer;
02511 
02512                 TransBuffer = (PCHAR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ), <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>));
02513                 <span class="keywordflow">if</span> (TransBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02514                     <span class="keywordflow">return</span> STATUS_NO_MEMORY;
02515                 }
02516 
02517                 a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> = (ULONG)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o2">Console</a>-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
02518                                             CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o5">UserBuffer</a>,
02519                                             a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a> / <span class="keyword">sizeof</span>(WCHAR),
02520                                             TransBuffer,
02521                                             <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>)
02522                                             );
02523                 RtlCopyMemory(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o5">UserBuffer</a>,TransBuffer,a-&gt;<a class="code" href="../../d3/d4/struct__CONSOLE__READCONSOLE__MSG.html#o5">NumBytes</a>);
02524                 <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(TransBuffer);
02525             }
02526 
02527             <span class="keywordflow">return</span> <a class="code" href="../../d1/d7/server_8h.html#a65">CONSOLE_STATUS_READ_COMPLETE</a>;
02528 
02529         } <span class="keywordflow">else</span> {
02530             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = <a class="code" href="../../d4/d1/cmdline_8h.html#a56">FindMatchingCommand</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>,
02531                     &amp;Char, 1 * <span class="keyword">sizeof</span>(WCHAR),
02532                     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o6">CurrentCommand</a>, FMCFL_JUST_LOOKING);
02533             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> != -1) {
02534                 <a class="code" href="../../d4/d1/cmdline_8h.html#a62">UpdateCommandListPopup</a>(
02535                         (SHORT)(Index - Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o6">CurrentCommand</a>),
02536                         &amp;Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o6">CurrentCommand</a>,
02537                         CommandHistory,
02538                         Popup,
02539                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>, UCLP_WRAP);
02540             }
02541         }
02542     }
02543 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a57" doxytag="server/cmdline.c::ProcessCommandNumberInput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ProcessCommandNumberInput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>CookedReadDataPtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitReplyMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitingThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02793">2793</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00044">_CLE_POPUP::Attributes</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00154">CLE_NO_POPUPS</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00112">COMMAND_NUM_TO_INDEX</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00099">_COOKED_READ_DATA::CommandHistory</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00088">_COOKED_READ_DATA::Console</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00350">CONSOLE_STATUS_WAIT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00352">CONSOLE_STATUS_WAIT_NO_BLOCK</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01541">CookedReadWaitRoutine()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02009">DeleteCommandLine()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01910">EndPopup()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00263">GetChar()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00105">_COOKED_READ_DATA::HandleIndex</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00086">_COOKED_READ_DATA::InputInfo</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00318">_HANDLE_DATA::InputReadData</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00049">_CLE_POPUP::NumberBuffer</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00050">_CLE_POPUP::NumberRead</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00078">_COMMAND_HISTORY::PopupList</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00104">_COOKED_READ_DATA::ProcessData</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00065">_INPUT_READ_HANDLE_DATA::ReadCount</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02136">SetCurrentCommandLine()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00175">UNICODE_BACKSPACE</a>, <a class="el" href="../../d5/d4/conimep_8h-source.html#l00177">UNICODE_CARRIAGERETURN</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00353">WC_DESTRUCTIVE_BACKSPACE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00355">WC_ECHO</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00354">WC_KEEP_CURSOR_VISIBLE</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l03047">WriteCharsFromInput()</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03150">CommandNumberPopup()</a>.
<p>
<pre class="fragment"><div>02805                 :
02806 
02807         <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a> - we ran <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of input, so
02808             a wait block was created
02809 
02810         <a class="code" href="../../d1/d7/server_8h.html#a65">CONSOLE_STATUS_READ_COMPLETE</a> - user hit <span class="keywordflow">return</span>
02811 
02812 --*/
02813 
02814 {
02815     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02816     <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a> Popup;
02817     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory;
02818     <a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData=(<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>)CookedReadDataPtr;
02819     WCHAR Char;
02820     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> NumSpaces;
02821     BOOLEAN CommandLinePopupKeys;
02822     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> CommandNumber;
02823     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
02824 
02825     CommandHistory = CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>;
02826     Popup = CONTAINING_RECORD( CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o9">PopupList</a>.Flink, <a class="code" href="../../d1/d0/struct__CLE__POPUP.html">CLE_POPUP</a>, ListLink );
02827     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o18">ProcessData</a>,
02828                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o19">HandleIndex</a>,
02829                                         &amp;HandleData
02830                                        );
02831     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02832     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02833         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a19">GetChar</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o0">InputInfo</a>,
02834                          &amp;Char,
02835                          TRUE,
02836                          CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o2">Console</a>,
02837                          HandleData,
02838                          WaitReplyMessage,
02839                          CookedReadWaitRoutine,
02840                          CookedReadData,
02841                          <span class="keyword">sizeof</span>(*CookedReadData),
02842                          WaitRoutine,
02843                          NULL,
02844                          &amp;CommandLinePopupKeys,
02845                          NULL,
02846                          NULL
02847                         );
02848         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02849             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
02850                 CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a> = 0;
02851             }
02852             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02853         }
02854 
02855         <span class="keywordflow">if</span> (Char &gt;= (WCHAR)0x30 &amp;&amp; Char &lt;= (WCHAR)0x39) {
02856             <span class="keywordflow">if</span> (Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o8">NumberRead</a> &lt; 5) {
02857                 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CharsToWrite;
02858                 WORD RealAttributes;
02859 
02860                 RealAttributes = CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o8">Attributes</a>;
02861                 CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o8">Attributes</a> = Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o2">Attributes</a>;
02862                 CharsToWrite = <span class="keyword">sizeof</span>(WCHAR);
02863                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,
02864                                     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o7">NumberBuffer</a>,
02865                                     &amp;Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o7">NumberBuffer</a>[Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o8">NumberRead</a>],
02866                                     &amp;Char,
02867                                     &amp;CharsToWrite,
02868                                     (PLONG)&amp;NumSpaces,
02869                                     CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o11">OriginalCursorPosition</a>.X,
02870                                     WC_DESTRUCTIVE_BACKSPACE |
02871                                             WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
02872                                     NULL
02873                                     );
02874                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02875                 CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o8">Attributes</a> = RealAttributes;
02876                 Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o7">NumberBuffer</a>[Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o8">NumberRead</a>] = Char;
02877                 Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o8">NumberRead</a> += 1;
02878             }
02879         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Char == <a class="code" href="../../d4/d5/conimep_8h.html#a51">UNICODE_BACKSPACE</a>) {
02880             <span class="keywordflow">if</span> (Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o8">NumberRead</a> &gt; 0) {
02881                 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CharsToWrite;
02882                 WORD RealAttributes;
02883 
02884                 RealAttributes = CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o8">Attributes</a>;
02885                 CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o8">Attributes</a> = Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o2">Attributes</a>;
02886                 CharsToWrite = <span class="keyword">sizeof</span>(WCHAR);
02887                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,
02888                                     Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o7">NumberBuffer</a>,
02889                                     &amp;Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o7">NumberBuffer</a>[Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o8">NumberRead</a>],
02890                                     &amp;Char,
02891                                     &amp;CharsToWrite,
02892                                     (PLONG)&amp;NumSpaces,
02893                                     CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o11">OriginalCursorPosition</a>.X,
02894                                     WC_DESTRUCTIVE_BACKSPACE |
02895                                             WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
02896                                     NULL
02897                                     );
02898                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02899                 CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o8">Attributes</a> = RealAttributes;
02900                 Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o7">NumberBuffer</a>[Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o8">NumberRead</a>] = (WCHAR)<span class="charliteral">' '</span>;
02901                 Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o8">NumberRead</a> -= 1;
02902             }
02903         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Char == (WCHAR)VK_ESCAPE) {
02904             <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a46">EndPopup</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>);
02905             <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/cmdline_8h.html#a14">CLE_NO_POPUPS</a>(CommandHistory)) {
02906                 <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a46">EndPopup</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>);
02907             }
02908             <a class="code" href="../../d4/d1/cmdline_8h.html#a41">DeleteCommandLine</a>(CookedReadData,
02909                               TRUE);
02910         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Char == <a class="code" href="../../d4/d5/conimep_8h.html#a53">UNICODE_CARRIAGERETURN</a>) {
02911             <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> NumberBuffer[6];
02912             <span class="keywordtype">int</span> i;
02913 
02914             <span class="keywordflow">for</span> (i=0;i&lt;Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o8">NumberRead</a>;i++) {
02915                 NumberBuffer[i] = (<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)Popup-&gt;<a class="code" href="../../d1/d0/struct__CLE__POPUP.html#o7">NumberBuffer</a>[i];
02916             }
02917             NumberBuffer[i] = 0;
02918             CommandNumber = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)atoi(NumberBuffer);
02919             <span class="keywordflow">if</span> ((WORD)CommandNumber &gt;= (WORD)CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o3">NumberOfCommands</a>) {
02920                 CommandNumber = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o3">NumberOfCommands</a>-1);
02921             }
02922             <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a46">EndPopup</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>);
02923             <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/cmdline_8h.html#a14">CLE_NO_POPUPS</a>(CommandHistory)) {
02924                 <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a46">EndPopup</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>);
02925             }
02926             <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a51">SetCurrentCommandLine</a>(CookedReadData,<a class="code" href="../../d4/d1/cmdline_8h.html#a8">COMMAND_NUM_TO_INDEX</a>(CommandNumber,CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>));
02927         }
02928         HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o1">ReadCount</a> += 1;
02929         <span class="keywordflow">return</span> <a class="code" href="../../d1/d7/server_8h.html#a66">CONSOLE_STATUS_WAIT_NO_BLOCK</a>;
02930     }
02931     UNREFERENCED_PARAMETER(WaitingThread);
02932 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a55" doxytag="server/cmdline.c::ProcessCopyFromCharInput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ProcessCopyFromCharInput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>CookedReadDataPtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitReplyMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitingThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02546">2546</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00088">_COOKED_READ_DATA::Console</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00350">CONSOLE_STATUS_WAIT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00352">CONSOLE_STATUS_WAIT_NO_BLOCK</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01541">CookedReadWaitRoutine()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02009">DeleteCommandLine()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01910">EndPopup()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00263">GetChar()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00105">_COOKED_READ_DATA::HandleIndex</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00086">_COOKED_READ_DATA::InputInfo</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00318">_HANDLE_DATA::InputReadData</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00104">_COOKED_READ_DATA::ProcessData</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00065">_INPUT_READ_HANDLE_DATA::ReadCount</a>, <a class="el" href="../../d7/d0/ntcon_2server_2cursor_8c-source.html#l00474">SetCursorPosition()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00353">WC_DESTRUCTIVE_BACKSPACE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00355">WC_ECHO</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00354">WC_KEEP_CURSOR_VISIBLE</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l03047">WriteCharsFromInput()</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03040">CopyFromCharPopup()</a>.
<p>
<pre class="fragment"><div>02558                 :
02559 
02560         <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a> - we ran <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of input, so
02561             a wait block was created
02562 
02563         <a class="code" href="../../d1/d7/server_8h.html#a65">CONSOLE_STATUS_READ_COMPLETE</a> - user hit <span class="keywordflow">return</span>
02564 
02565 --*/
02566 
02567 {
02568     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02569     <a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData=(<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>)CookedReadDataPtr;
02570     WCHAR Char;
02571     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
02572     <span class="keywordtype">int</span> i;  <span class="comment">// char index (not byte)</span>
02573 
02574     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o18">ProcessData</a>,
02575                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o19">HandleIndex</a>,
02576                                         &amp;HandleData
02577                                        );
02578     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02579     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02580         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a19">GetChar</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o0">InputInfo</a>,
02581                          &amp;Char,
02582                          TRUE,
02583                          CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o2">Console</a>,
02584                          HandleData,
02585                          WaitReplyMessage,
02586                          CookedReadWaitRoutine,
02587                          CookedReadData,
02588                          <span class="keyword">sizeof</span>(*CookedReadData),
02589                          WaitRoutine,
02590                          NULL,
02591                          NULL,
02592                          NULL,
02593                          NULL
02594                         );
02595         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02596             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
02597                 CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a> = 0;
02598             }
02599             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02600         }
02601 
02602         <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a46">EndPopup</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>);
02603 
02604         <span class="comment">//</span>
02605         <span class="comment">// delete from cursor up to specified char</span>
02606         <span class="comment">//</span>
02607 
02608         <span class="keywordflow">for</span> (i=CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o8">CurrentPosition</a>+1;
02609              i&lt;(<span class="keywordtype">int</span>)(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a>/<span class="keyword">sizeof</span>(WCHAR));
02610              i++) {
02611             <span class="keywordflow">if</span> (CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>[i] == Char) {
02612                 <span class="keywordflow">break</span>;
02613             }
02614         }
02615         <span class="keywordflow">if</span> (i!=(<span class="keywordtype">int</span>)(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a>/<span class="keyword">sizeof</span>(WCHAR)+1)) {
02616                 COORD CursorPosition;
02617 
02618                 <span class="comment">//</span>
02619                 <span class="comment">// save cursor position</span>
02620                 <span class="comment">//</span>
02621 
02622                 CursorPosition = CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>-&gt;<a class="code" href="../../d7/d8/struct__SCREEN__INFORMATION.html#o22">BufferInfo</a>.TextInfo.CursorPosition;
02623 
02624                 <span class="comment">//</span>
02625                 <span class="comment">// deletecommandline</span>
02626                 <span class="comment">//</span>
02627 
02628                 <a class="code" href="../../d4/d1/cmdline_8h.html#a41">DeleteCommandLine</a>(CookedReadData,
02629                                   FALSE);
02630                 <span class="comment">//</span>
02631                 <span class="comment">// delete chars</span>
02632                 <span class="comment">//</span>
02633 
02634                 RtlCopyMemory(&amp;CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>[CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o8">CurrentPosition</a>],
02635                               &amp;CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>[i],
02636                               CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a>-(i*<span class="keyword">sizeof</span>(WCHAR))
02637                               );
02638                 CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a> -= (i-CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o8">CurrentPosition</a>)*<span class="keyword">sizeof</span>(WCHAR);
02639 
02640                 <span class="comment">//</span>
02641                 <span class="comment">// write commandline</span>
02642                 <span class="comment">//</span>
02643 
02644                 <span class="keywordflow">if</span> (CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o14">Echo</a>) {
02645                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,
02646                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>,
02647                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>,
02648                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>,
02649                                         &amp;CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a>,
02650                                         (PLONG)&amp;CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o12">NumberOfVisibleChars</a>,
02651                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o11">OriginalCursorPosition</a>.X,
02652                                         WC_DESTRUCTIVE_BACKSPACE |
02653                                                 WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
02654                                         NULL
02655                                         );
02656                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02657                 }
02658 
02659                 <span class="comment">//</span>
02660                 <span class="comment">// restore cursor position</span>
02661                 <span class="comment">//</span>
02662 
02663                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d1/ntcon_2server_2cursor_8c.html#a7">SetCursorPosition</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,
02664                                            CursorPosition,
02665                                            TRUE
02666                                           );
02667                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02668         }
02669 
02670         HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o1">ReadCount</a> += 1;
02671         <span class="keywordflow">return</span> <a class="code" href="../../d1/d7/server_8h.html#a66">CONSOLE_STATUS_WAIT_NO_BLOCK</a>;
02672     }
02673     UNREFERENCED_PARAMETER(WaitingThread);
02674 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a56" doxytag="server/cmdline.c::ProcessCopyToCharInput" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ProcessCopyToCharInput           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>CookedReadDataPtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitReplyMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCSR_THREAD&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitingThread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02677">2677</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00024">_COMMAND::Command</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00023">_COMMAND::CommandLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00088">_COOKED_READ_DATA::Console</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00350">CONSOLE_STATUS_WAIT</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00352">CONSOLE_STATUS_WAIT_NO_BLOCK</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l01541">CookedReadWaitRoutine()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01501">DereferenceIoHandleNoCheck()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01910">EndPopup()</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00263">GetChar()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03217">GetLastCommand()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00105">_COOKED_READ_DATA::HandleIndex</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00086">_COOKED_READ_DATA::InputInfo</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00318">_HANDLE_DATA::InputReadData</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00104">_COOKED_READ_DATA::ProcessData</a>, <a class="el" href="../../d0/d3/input_8h-source.html#l00065">_INPUT_READ_HANDLE_DATA::ReadCount</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00353">WC_DESTRUCTIVE_BACKSPACE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00355">WC_ECHO</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00354">WC_KEEP_CURSOR_VISIBLE</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l03047">WriteCharsFromInput()</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03096">CopyToCharPopup()</a>.
<p>
<pre class="fragment"><div>02689                 :
02690 
02691         <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a> - we ran <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> of input, so
02692             a wait block was created
02693 
02694         <a class="code" href="../../d1/d7/server_8h.html#a65">CONSOLE_STATUS_READ_COMPLETE</a> - user hit <span class="keywordflow">return</span>
02695 
02696 --*/
02697 
02698 {
02699     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02700     <a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData=(<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>)CookedReadDataPtr;
02701     WCHAR Char;
02702     <a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> LastCommand;
02703     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> NumSpaces;
02704     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> ScrollY=0;
02705     <a class="code" href="../../d4/d3/struct__HANDLE__DATA.html">PHANDLE_DATA</a> HandleData;
02706 
02707     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a30">DereferenceIoHandleNoCheck</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o18">ProcessData</a>,
02708                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o19">HandleIndex</a>,
02709                                         &amp;HandleData
02710                                        );
02711     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02712     <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
02713         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a19">GetChar</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o0">InputInfo</a>,
02714                          &amp;Char,
02715                          TRUE,
02716                          CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o2">Console</a>,
02717                          HandleData,
02718                          WaitReplyMessage,
02719                          CookedReadWaitRoutine,
02720                          CookedReadData,
02721                          <span class="keyword">sizeof</span>(*CookedReadData),
02722                          WaitRoutine,
02723                          NULL,
02724                          NULL,
02725                          NULL,
02726                          NULL
02727                         );
02728         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
02729             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != <a class="code" href="../../d1/d7/server_8h.html#a64">CONSOLE_STATUS_WAIT</a>) {
02730                 CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a> = 0;
02731             }
02732             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02733         }
02734 
02735         <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a46">EndPopup</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>);
02736 
02737         <span class="comment">//</span>
02738         <span class="comment">// copy up to specified char</span>
02739         <span class="comment">//</span>
02740 
02741         LastCommand = <a class="code" href="../../d4/d1/cmdline_8h.html#a55">GetLastCommand</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a>);
02742         <span class="keywordflow">if</span> (LastCommand) {
02743             <span class="keywordtype">int</span> i,j;
02744 
02745             <span class="comment">//</span>
02746             <span class="comment">// find specified char in last command</span>
02747             <span class="comment">//</span>
02748 
02749             <span class="keywordflow">for</span> (i=CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o8">CurrentPosition</a>+1;i&lt;(<span class="keywordtype">int</span>)(LastCommand-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>/<span class="keyword">sizeof</span>(WCHAR));i++) {
02750                 <span class="keywordflow">if</span> (LastCommand-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o1">Command</a>[i] == Char)
02751                     <span class="keywordflow">break</span>;
02752             }
02753 
02754             <span class="comment">//</span>
02755             <span class="comment">// if we found it, copy up to it</span>
02756             <span class="comment">//</span>
02757 
02758             <span class="keywordflow">if</span> (i&lt;(<span class="keywordtype">int</span>)(LastCommand-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>/<span class="keyword">sizeof</span>(WCHAR)) &amp;&amp; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(LastCommand-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>/<span class="keyword">sizeof</span>(WCHAR)) &gt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o8">CurrentPosition</a>) {
02759                 j=i-CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o8">CurrentPosition</a>;
02760                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(j&gt;0);
02761                 RtlCopyMemory(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o9">BufPtr</a>,
02762                        &amp;LastCommand-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o1">Command</a>[CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o8">CurrentPosition</a>],
02763                        j*<span class="keyword">sizeof</span>(WCHAR));
02764                 CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o8">CurrentPosition</a> += j;
02765                 j*=<span class="keyword">sizeof</span>(WCHAR);
02766                 CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o7">BytesRead</a> += j;
02767                 <span class="keywordflow">if</span> (CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o14">Echo</a>) {
02768                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o1">ScreenInfo</a>,
02769                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o10">BackupLimit</a>,
02770                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o9">BufPtr</a>,
02771                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o9">BufPtr</a>,
02772                                         (PDWORD) &amp;j,
02773                                         (PLONG)&amp;NumSpaces,
02774                                         CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o11">OriginalCursorPosition</a>.X,
02775                                         WC_DESTRUCTIVE_BACKSPACE |
02776                                                 WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
02777                                         &amp;ScrollY
02778                                         );
02779                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02780                     CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o11">OriginalCursorPosition</a>.Y += ScrollY;
02781                     CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o12">NumberOfVisibleChars</a> += NumSpaces;
02782                 }
02783                 CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o9">BufPtr</a>+=j/<span class="keyword">sizeof</span>(WCHAR);
02784             }
02785         }
02786         HandleData-&gt;<a class="code" href="../../d4/d3/struct__HANDLE__DATA.html#o6">InputReadData</a>-&gt;<a class="code" href="../../d8/d2/struct__INPUT__READ__HANDLE__DATA.html#o1">ReadCount</a> += 1;
02787         <span class="keywordflow">return</span> <a class="code" href="../../d1/d7/server_8h.html#a66">CONSOLE_STATUS_WAIT_NO_BLOCK</a>;
02788     }
02789     UNREFERENCED_PARAMETER(WaitingThread);
02790 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="server/cmdline.c::ReallocCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> ReallocCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CurrentCommandHistory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>NumCommands</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01597">1597</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00066">CLE_RESET</a>, <a class="el" href="../../d4/d1/cmdline_8h.html#a30">COMMAND_HISTORY</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00112">COMMAND_NUM_TO_INDEX</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00012">History</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00065">HISTORY_TAG</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04665">ResizeCommandHistoryBuffers()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01424">SrvSetConsoleNumberOfCommands()</a>.
<p>
<pre class="fragment"><div>01602 {
01603     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
01604     <span class="keywordtype">int</span> i;
01605 
01606     <span class="keywordflow">if</span> (CurrentCommandHistory == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
01607         CurrentCommandHistory-&gt;MaximumNumberOfCommands==(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)NumCommands) {
01608         <span class="keywordflow">return</span> CurrentCommandHistory;
01609     }
01610     <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = (<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( HISTORY_TAG ),<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>) + ((NumCommands-1) * <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a>)));
01611     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01612         <span class="keywordflow">return</span> CurrentCommandHistory;
01613     }
01614     *<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>=*CurrentCommandHistory;
01615     <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags |= <a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>;
01616     <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands, (SHORT)NumCommands);
01617     <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;LastAdded = <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands - 1;
01618     <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;LastDisplayed = <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands - 1;
01619     <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;FirstCommand = 0;
01620     <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;MaximumNumberOfCommands=(<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)NumCommands;
01621     <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;NumberOfCommands; i++) {
01622         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Commands[i] = CurrentCommandHistory-&gt;Commands[<a class="code" href="../../d4/d1/cmdline_8h.html#a8">COMMAND_NUM_TO_INDEX</a>(i,CurrentCommandHistory)];
01623     }
01624     <span class="keywordflow">for</span> (; i&lt;CurrentCommandHistory-&gt;NumberOfCommands; i++) {
01625         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(CurrentCommandHistory-&gt;Commands[<a class="code" href="../../d4/d1/cmdline_8h.html#a8">COMMAND_NUM_TO_INDEX</a>(i,CurrentCommandHistory)]);
01626     }
01627 
01628     RemoveEntryList(&amp;CurrentCommandHistory-&gt;ListLink);
01629     InitializeListHead(&amp;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;PopupList);
01630     InsertHeadList(&amp;Console-&gt;CommandHistoryList,&amp;<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;ListLink);
01631 
01632     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(CurrentCommandHistory);
01633     <span class="keywordflow">return</span> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
01634 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a49" doxytag="server/cmdline.c::RedrawCommandLine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID RedrawCommandLine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CookedReadData</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02061">2061</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00115">AdjustCursorPosition</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l00774">RetrieveTotalNumberOfSpaces()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00353">WC_DESTRUCTIVE_BACKSPACE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00355">WC_ECHO</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00354">WC_KEEP_CURSOR_VISIBLE</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l03047">WriteCharsFromInput()</a>.
<p>
<pre class="fragment"><div>02064 {
02065     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02066     COORD CursorPosition;
02067     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> ScrollY=0;
02068 
02069     <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
02070         <span class="comment">//</span>
02071         <span class="comment">// Draw the command line</span>
02072         <span class="comment">//</span>
02073         CookedReadData-&gt;OriginalCursorPosition = CookedReadData-&gt;ScreenInfo-&gt;BufferInfo.TextInfo.CursorPosition;
02074         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;ScreenInfo,
02075                                      CookedReadData-&gt;BackupLimit,
02076                                      CookedReadData-&gt;BackupLimit,
02077                                      CookedReadData-&gt;BackupLimit,
02078                                      &amp;CookedReadData-&gt;BytesRead,
02079                                      &amp;CookedReadData-&gt;NumberOfVisibleChars,
02080                                      CookedReadData-&gt;OriginalCursorPosition.X,
02081                                      WC_DESTRUCTIVE_BACKSPACE | WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
02082                                      &amp;ScrollY);
02083         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02084         CookedReadData-&gt;OriginalCursorPosition.Y += ScrollY;
02085 
02086         <span class="comment">//</span>
02087         <span class="comment">// Move the cursor back to the right position</span>
02088         <span class="comment">//</span>
02089         CursorPosition = CookedReadData-&gt;OriginalCursorPosition;
02090         CursorPosition.X += (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)<a class="code" href="../../d0/d7/server_2stream_8c.html#a21">RetrieveTotalNumberOfSpaces</a>(CookedReadData-&gt;OriginalCursorPosition.X,
02091                                                    CookedReadData-&gt;BackupLimit,
02092                                                    CookedReadData-&gt;CurrentPosition,
02093                                                    CookedReadData-&gt;ScreenInfo-&gt;Console);
02094         <span class="keywordflow">if</span> (CheckBisectStringW(CookedReadData-&gt;ScreenInfo,
02095                                CookedReadData-&gt;ScreenInfo-&gt;Console-&gt;CP,
02096                                CookedReadData-&gt;BackupLimit,
02097                                CookedReadData-&gt;CurrentPosition,
02098                                CookedReadData-&gt;ScreenInfo-&gt;ScreenBufferSize.X
02099                                 -CookedReadData-&gt;OriginalCursorPosition.X)) {
02100             CursorPosition.X++;
02101         }
02102         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d8/dispatch_8h.html#a10">AdjustCursorPosition</a>(CookedReadData-&gt;ScreenInfo,
02103                                       CursorPosition,
02104                                       TRUE,
02105                                       NULL);
02106         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02107     }
02108 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="server/cmdline.c::RemoveAlias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RemoveAlias           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d6/struct__ALIAS.html">PALIAS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Alias</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00552">552</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00878">ClearAliases()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00571">FreeAliasList()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>.
<p>
<pre class="fragment"><div>00562 {
00563     RemoveEntryList(&amp;Alias-&gt;ListLink);
00564     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Alias-&gt;Source);
00565     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Alias-&gt;Target);
00566     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Alias);
00567     <span class="keywordflow">return</span> STATUS_SUCCESS;
00568 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a68" doxytag="server/cmdline.c::RemoveCommand" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> RemoveCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandHistory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>iDel</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04026">4026</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00138">COMMAND_IND_DEC</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00146">COMMAND_IND_INC</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00113">COMMAND_INDEX_TO_NUM</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04744">AddCommand()</a>.
<p>
<pre class="fragment"><div>04029 {
04030     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> iFirst, iLast, iDisp, nDel;
04031     <a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> *ppcFirst, *ppcDel, pcmdDel;
04032 
04033     iFirst = CommandHistory-&gt;FirstCommand;
04034     iLast = CommandHistory-&gt;LastAdded;
04035     iDisp = CommandHistory-&gt;LastDisplayed;
04036 
04037     <span class="keywordflow">if</span> (CommandHistory-&gt;NumberOfCommands == 0) {
04038         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04039     }
04040 
04041     nDel = <a class="code" href="../../d4/d1/cmdline_8h.html#a9">COMMAND_INDEX_TO_NUM</a>(iDel, CommandHistory);
04042     <span class="keywordflow">if</span> ((nDel &lt; <a class="code" href="../../d4/d1/cmdline_8h.html#a9">COMMAND_INDEX_TO_NUM</a>(iFirst, CommandHistory)) ||
04043             (nDel &gt; <a class="code" href="../../d4/d1/cmdline_8h.html#a9">COMMAND_INDEX_TO_NUM</a>(iLast, CommandHistory))) {
04044         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
04045     }
04046 
04047     <span class="keywordflow">if</span> (iDisp == iDel) {
04048         CommandHistory-&gt;LastDisplayed = -1;
04049     }
04050 
04051     ppcFirst = &amp;(CommandHistory-&gt;Commands[iFirst]);
04052     ppcDel = &amp;(CommandHistory-&gt;Commands[iDel]);
04053     pcmdDel = *ppcDel;
04054 
04055     <span class="keywordflow">if</span> (iDel &lt; iLast) {
04056         RtlCopyMemory(ppcDel, ppcDel+1, (iLast - iDel) * <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a>));
04057         <span class="keywordflow">if</span> ((iDisp &gt; iDel) &amp;&amp; (iDisp &lt;= iLast)) {
04058             <a class="code" href="../../d4/d1/cmdline_8h.html#a12">COMMAND_IND_DEC</a>(iDisp, CommandHistory);
04059         }
04060         <a class="code" href="../../d4/d1/cmdline_8h.html#a12">COMMAND_IND_DEC</a>(iLast, CommandHistory);
04061     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iFirst &lt;= iDel) {
04062         RtlMoveMemory(ppcFirst+1, ppcFirst, (iDel - iFirst) * <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a>));
04063         <span class="keywordflow">if</span> ((iDisp &gt;= iFirst) &amp;&amp; (iDisp &lt; iDel)) {
04064             <a class="code" href="../../d4/d1/cmdline_8h.html#a13">COMMAND_IND_INC</a>(iDisp, CommandHistory);
04065         }
04066         <a class="code" href="../../d4/d1/cmdline_8h.html#a13">COMMAND_IND_INC</a>(iFirst, CommandHistory);
04067     }
04068 
04069     CommandHistory-&gt;FirstCommand = iFirst;
04070     CommandHistory-&gt;LastAdded = iLast;
04071     CommandHistory-&gt;LastDisplayed = iDisp;
04072     CommandHistory-&gt;NumberOfCommands--;
04073     <span class="keywordflow">return</span> pcmdDel;
04074 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="server/cmdline.c::ReplaceAlias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ReplaceAlias           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d6/struct__ALIAS.html">PALIAS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Alias</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Target</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a14">USHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>TargetLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00524">524</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d9/d4/consrv_8h-source.html#l00064">ALIAS_TAG</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">SrvAddConsoleAlias()</a>.
<p>
<pre class="fragment"><div>00536 {
00537     LPWSTR NewTarget;
00538 
00539     NewTarget = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( ALIAS_TAG ),TargetLength);
00540     <span class="keywordflow">if</span> (NewTarget == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00541         <span class="keywordflow">return</span> STATUS_NO_MEMORY;
00542     }
00543     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Alias-&gt;Target);
00544     Alias-&gt;Target = NewTarget;
00545     Alias-&gt;TargetLength = TargetLength;
00546     RtlCopyMemory(Alias-&gt;Target,Target,TargetLength);
00547     <span class="keywordflow">return</span> STATUS_SUCCESS;
00548 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a79" doxytag="server/cmdline.c::ResetCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ResetCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>CommandHistory</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04726">4726</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00066">CLE_RESET</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04744">AddCommand()</a>.
<p>
<pre class="fragment"><div>04735 {
04736     <span class="keywordflow">if</span> (CommandHistory == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04737         <span class="keywordflow">return</span>;
04738     }
04739     CommandHistory-&gt;LastDisplayed = CommandHistory-&gt;LastAdded;
04740     CommandHistory-&gt;Flags |= <a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>;
04741 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a77" doxytag="server/cmdline.c::ResizeCommandHistoryBuffers" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ResizeCommandHistoryBuffers           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Console</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>NumCommands</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04665">4665</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00099">_COOKED_READ_DATA::CommandHistory</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00012">History</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01597">ReallocCommandHistory()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d2/d6/ntcon_2server_2menu_8c-source.html#l00459">PropertiesUpdate()</a>.
<p>
<pre class="fragment"><div>04669 {
04670     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>;
04671     PLIST_ENTRY ListHead, ListNext;
04672 <span class="preprocessor">#if defined(FE_SB)</span>
04673 <span class="preprocessor"></span>    <a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a> CookedReadData;
04674     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> NewHistory;
04675 <span class="preprocessor">#endif</span>
04676 <span class="preprocessor"></span>
04677     Console-&gt;CommandHistorySize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)NumCommands;
04678 
04679     ListHead = &amp;Console-&gt;CommandHistoryList;
04680     ListNext = ListHead-&gt;Flink;
04681     <span class="keywordflow">while</span> (ListNext != ListHead) {
04682         <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a> = CONTAINING_RECORD( ListNext, <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">COMMAND_HISTORY</a>, ListLink );
04683         ListNext = ListNext-&gt;Flink;
04684 
04685 <span class="preprocessor">#if defined(FE_SB)</span>
04686 <span class="preprocessor"></span>        NewHistory = <a class="code" href="../../d4/d1/cmdline_8h.html#a44">ReallocCommandHistory</a>(Console, History, NumCommands);
04687         CookedReadData = Console-&gt;lpCookedReadData;
04688         <span class="keywordflow">if</span> (CookedReadData &amp;&amp; CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a> == <a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>) {
04689             CookedReadData-&gt;<a class="code" href="../../d2/d8/struct__COOKED__READ__DATA.html#o13">CommandHistory</a> = NewHistory;
04690         }
04691 <span class="preprocessor">#else</span>
04692 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!(<a class="code" href="../../d1/d9/icmui_8def.html#a3">History</a>-&gt;Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a4">CLE_ALLOCATED</a>)) {
04693             <a class="code" href="../../d4/d1/cmdline_8h.html#a44">ReallocCommandHistory</a>(Console, History, NumCommands);
04694          }
04695 <span class="preprocessor">#endif</span>
04696 <span class="preprocessor"></span>    }
04697 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a81" doxytag="server/cmdline.c::RetrieveCommand" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RetrieveCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandHistory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>VirtualKeyCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BufferSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04834">4834</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00065">CLE_ALLOCATED</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00066">CLE_RESET</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00130">COMMAND_IND_NEXT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00122">COMMAND_IND_PREV</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02111">RetrieveNthCommand()</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>.
<p>
<pre class="fragment"><div>04841 {
04842 
04843     <span class="keywordflow">if</span> (CommandHistory == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04844         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
04845     }
04846     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(CommandHistory-&gt;Flags &amp; CLE_ALLOCATED);
04847     <span class="keywordflow">if</span> (CommandHistory-&gt;NumberOfCommands == 0) {
04848         <span class="keywordflow">return</span> STATUS_UNSUCCESSFUL;
04849     }
04850     <span class="keywordflow">if</span> (CommandHistory-&gt;NumberOfCommands == 1) {
04851         CommandHistory-&gt;LastDisplayed = 0;
04852     }
04853     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (VirtualKeyCode == VK_UP) {
04854 
04855         <span class="comment">//</span>
04856         <span class="comment">// if this is the first time for this read that a command has</span>
04857         <span class="comment">// been retrieved, return the current command.  otherwise, return</span>
04858         <span class="comment">// the previous command.</span>
04859         <span class="comment">//</span>
04860 
04861         <span class="keywordflow">if</span> (CommandHistory-&gt;Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>) {
04862             CommandHistory-&gt;Flags &amp;= ~<a class="code" href="../../d4/d1/cmdline_8h.html#a5">CLE_RESET</a>;
04863         } <span class="keywordflow">else</span> {
04864             <a class="code" href="../../d4/d1/cmdline_8h.html#a10">COMMAND_IND_PREV</a>(CommandHistory-&gt;LastDisplayed, CommandHistory);
04865         }
04866     }
04867     <span class="keywordflow">else</span> {
04868         <a class="code" href="../../d4/d1/cmdline_8h.html#a11">COMMAND_IND_NEXT</a>(CommandHistory-&gt;LastDisplayed, CommandHistory);
04869     }
04870     <span class="keywordflow">return</span> <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a50">RetrieveNthCommand</a>(CommandHistory,
04871                               CommandHistory-&gt;LastDisplayed,
04872                               Buffer,
04873                               BufferSize,
04874                               CommandSize
04875                              );
04876 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a50" doxytag="server/cmdline.c::RetrieveNthCommand" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS RetrieveNthCommand           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandHistory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Index</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PWCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BufferSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02111">2111</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00045">BufferSize</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00024">_COMMAND::Command</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00023">_COMMAND::CommandLength</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03272">ProcessCommandLine()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04834">RetrieveCommand()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02136">SetCurrentCommandLine()</a>.
<p>
<pre class="fragment"><div>02118 {
02119     <a class="code" href="../../d8/d7/struct__COMMAND.html">PCOMMAND</a> CommandRecord;
02120 
02121     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a> (Index &lt; CommandHistory-&gt;NumberOfCommands);
02122     CommandHistory-&gt;LastDisplayed = <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
02123     CommandRecord = CommandHistory-&gt;Commands[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
02124     <span class="keywordflow">if</span> (CommandRecord-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a> &gt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>) {
02125         *CommandSize = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d6/d2/rtqkey_8c.html#a5">BufferSize</a>;  <span class="comment">// room for CRLF?</span>
02126     }
02127     <span class="keywordflow">else</span> {
02128         *CommandSize = CommandRecord-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>;
02129     }
02130     RtlCopyMemory(Buffer,CommandRecord-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o1">Command</a>,*CommandSize);
02131     <span class="keywordflow">return</span> STATUS_SUCCESS;
02132 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a51" doxytag="server/cmdline.c::SetCurrentCommandLine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetCurrentCommandLine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d8/struct__COOKED__READ__DATA.html">PCOOKED_READ_DATA</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CookedReadData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Index</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02136">2136</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02009">DeleteCommandLine()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02111">RetrieveNthCommand()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00353">WC_DESTRUCTIVE_BACKSPACE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00355">WC_ECHO</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00354">WC_KEEP_CURSOR_VISIBLE</a>, and <a class="el" href="../../d1/d6/server_2stream_8c-source.html#l03047">WriteCharsFromInput()</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02793">ProcessCommandNumberInput()</a>.
<p>
<pre class="fragment"><div>02146 {
02147     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> CharsToWrite;
02148     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02149     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> ScrollY=0;
02150 
02151     <a class="code" href="../../d4/d1/cmdline_8h.html#a41">DeleteCommandLine</a>(CookedReadData,
02152                       TRUE);
02153     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a50">RetrieveNthCommand</a>(CookedReadData-&gt;CommandHistory,
02154                                 Index,
02155                                 CookedReadData-&gt;BackupLimit,
02156                                 CookedReadData-&gt;BufferSize,
02157                                 &amp;CookedReadData-&gt;BytesRead);
02158     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02159     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(CookedReadData-&gt;BackupLimit == CookedReadData-&gt;BufPtr);
02160     <span class="keywordflow">if</span> (CookedReadData-&gt;Echo) {
02161         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d7/server_2stream_8c.html#a38">WriteCharsFromInput</a>(CookedReadData-&gt;ScreenInfo,
02162                 CookedReadData-&gt;BackupLimit,
02163                 CookedReadData-&gt;BufPtr,
02164                 CookedReadData-&gt;BufPtr,
02165                 &amp;CookedReadData-&gt;BytesRead,
02166                 (PLONG)&amp;CookedReadData-&gt;NumberOfVisibleChars,
02167                 CookedReadData-&gt;OriginalCursorPosition.X,
02168                 WC_DESTRUCTIVE_BACKSPACE | WC_KEEP_CURSOR_VISIBLE | WC_ECHO,
02169                 &amp;ScrollY);
02170         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
02171         CookedReadData-&gt;OriginalCursorPosition.Y += ScrollY;
02172     }
02173     CharsToWrite = CookedReadData-&gt;BytesRead/<span class="keyword">sizeof</span>(WCHAR);
02174     CookedReadData-&gt;CurrentPosition = CharsToWrite;
02175     CookedReadData-&gt;BufPtr = CookedReadData-&gt;BackupLimit + CharsToWrite;
02176 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="server/cmdline.c::SrvAddConsoleAlias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvAddConsoleAlias           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00608">608</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00483">AddAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00329">AddExeAliasList()</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00491">_CONSOLE_ADDALIAS_MSG::ConsoleHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01345">ConvertInputToUnicode()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00497">_CONSOLE_ADDALIAS_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00494">_CONSOLE_ADDALIAS_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00447">FindAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00552">RemoveAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00524">ReplaceAlias()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00495">_CONSOLE_ADDALIAS_MSG::Source</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00492">_CONSOLE_ADDALIAS_MSG::SourceLength</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00496">_CONSOLE_ADDALIAS_MSG::Target</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00493">_CONSOLE_ADDALIAS_MSG::TargetLength</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00498">_CONSOLE_ADDALIAS_MSG::Unicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00499">_CONSOLE_ADDALIAS_MSG::UnicodeExe</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00615                    :
00616 
00617     This routine adds a command line alias to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global set.
00618 
00619 Arguments:
00620 
00621     m - message containing api parameters
00622 
00623     ReplyStatus - Indicates whether to reply to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dll port.
00624 
00625 Return Value:
00626 
00627 --*/
00628 
00629 {
00630 
00631     <a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html">PCONSOLE_ADDALIAS_MSG</a> a = (<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html">PCONSOLE_ADDALIAS_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00632     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
00633     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00634     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList;
00635     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00636     LPWSTR Source,Target;
00637 
00638     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o0">ConsoleHandle</a>,
00639                          &amp;Console
00640                         );
00641     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00642         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00643     }
00644 
00645     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o4">Source</a>, a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
00646         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o5">Target</a>,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
00647         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o6">Exe</a>, a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o3">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
00648 
00649         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00650         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00651     }
00652 
00653     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o7">Unicode</a>) {
00654         Source = a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o4">Source</a>;
00655         Target = a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o5">Target</a>;
00656     } <span class="keywordflow">else</span> {
00657         Source = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>*<span class="keyword">sizeof</span>(WCHAR));
00658         <span class="keywordflow">if</span> (Source == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00659             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00660             <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
00661         }
00662         Target = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>*<span class="keyword">sizeof</span>(WCHAR));
00663         <span class="keywordflow">if</span> (Target == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00664             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Source);
00665             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00666             <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
00667         }
00668         a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00669                                             a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o4">Source</a>,
00670                                             a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>,
00671                                             Source,
00672                                             a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>);
00673         a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a> *= 2;
00674         a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00675                                             a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o5">Target</a>,
00676                                             a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>,
00677                                             Target,
00678                                             a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>);
00679         a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a> *= 2;
00680     }
00681 
00682     <span class="comment">//</span>
00683     <span class="comment">// find specified exe.  if it's not there, add it if we're not</span>
00684     <span class="comment">// removing an alias.</span>
00685     <span class="comment">//</span>
00686 
00687     ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a22">FindExe</a>(Console,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o6">Exe</a>,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o3">ExeLength</a>,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o8">UnicodeExe</a>);
00688     <span class="keywordflow">if</span> (ExeAliasList) {
00689         Alias = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a23">FindAlias</a>(ExeAliasList,Source,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>);
00690         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>) {
00691             <span class="keywordflow">if</span> (Alias) {
00692                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a25">ReplaceAlias</a>(Alias,
00693                                       Target,
00694                                       a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>);
00695             } <span class="keywordflow">else</span> {
00696                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a24">AddAlias</a>(ExeAliasList,
00697                                   Source,
00698                                   a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>,
00699                                   Target,
00700                                   a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>);
00701             }
00702         } <span class="keywordflow">else</span> {
00703             <span class="keywordflow">if</span> (Alias) {
00704                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a26">RemoveAlias</a>(Alias);
00705             }
00706         }
00707     } <span class="keywordflow">else</span> {
00708         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>) {
00709             ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a20">AddExeAliasList</a>(Console,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o6">Exe</a>,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o3">ExeLength</a>,a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o8">UnicodeExe</a>);
00710             <span class="keywordflow">if</span> (ExeAliasList) {
00711                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a24">AddAlias</a>(ExeAliasList,
00712                                   Source,
00713                                   a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o1">SourceLength</a>,
00714                                   Target,
00715                                   a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o2">TargetLength</a>);
00716             } <span class="keywordflow">else</span> {
00717                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_NO_MEMORY;
00718             }
00719         }
00720     }
00721     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00722     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d2/d9/struct__CONSOLE__ADDALIAS__MSG.html#o7">Unicode</a>) {
00723         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Source);
00724         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Target);
00725     }
00726     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00727     UNREFERENCED_PARAMETER(ReplyStatus);
00728 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="server/cmdline.c::SrvExpungeConsoleCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvExpungeConsoleCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01393">1393</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00547">_CONSOLE_EXPUNGECOMMANDHISTORY_MSG::ConsoleHandle</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l03227">EmptyCommandHistory()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00549">_CONSOLE_EXPUNGECOMMANDHISTORY_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00548">_CONSOLE_EXPUNGECOMMANDHISTORY_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00551">_CONSOLE_EXPUNGECOMMANDHISTORY_MSG::UnicodeExe</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01397 {
01398     <a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html">PCONSOLE_EXPUNGECOMMANDHISTORY_MSG</a> a = (<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html">PCONSOLE_EXPUNGECOMMANDHISTORY_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01399     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01400     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01401 
01402     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o0">ConsoleHandle</a>,
01403                          &amp;Console
01404                         );
01405     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01406         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01407     }
01408 
01409     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o2">Exe</a>, a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o1">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
01410         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01411         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01412     }
01413 
01414     <a class="code" href="../../d4/d1/cmdline_8h.html#a43">EmptyCommandHistory</a>(<a class="code" href="../../d4/d1/cmdline_8h.html#a45">FindExeCommandHistory</a>(Console,
01415                                               a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o2">Exe</a>,
01416                                               a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o1">ExeLength</a>,
01417                                               a-&gt;<a class="code" href="../../d1/d0/struct__CONSOLE__EXPUNGECOMMANDHISTORY__MSG.html#o4">UnicodeExe</a>));
01418     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01419     <span class="keywordflow">return</span> STATUS_SUCCESS;
01420     UNREFERENCED_PARAMETER(ReplyStatus);
01421 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="server/cmdline.c::SrvGetConsoleAlias" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleAlias           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00731">731</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00071">CHAR_COUNT</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00503">_CONSOLE_GETALIAS_MSG::ConsoleHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01345">ConvertInputToUnicode()</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00509">_CONSOLE_GETALIAS_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00506">_CONSOLE_GETALIAS_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00447">FindAlias()</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00507">_CONSOLE_GETALIAS_MSG::Source</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00504">_CONSOLE_GETALIAS_MSG::SourceLength</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00508">_CONSOLE_GETALIAS_MSG::Target</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00165">_ALIAS::Target</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00505">_CONSOLE_GETALIAS_MSG::TargetLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00163">_ALIAS::TargetLength</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00062">TMP_TAG</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00510">_CONSOLE_GETALIAS_MSG::Unicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00511">_CONSOLE_GETALIAS_MSG::UnicodeExe</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00738                    :
00739 
00740     This routine get a command line alias from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global set.
00741 
00742 Arguments:
00743 
00744     m - message containing api parameters
00745 
00746     ReplyStatus - Indicates whether to reply to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dll port.
00747 
00748 Return Value:
00749 
00750 --*/
00751 
00752 {
00753 
00754     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00755     <a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html">PCONSOLE_GETALIAS_MSG</a> a = (<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html">PCONSOLE_GETALIAS_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00756     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
00757     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00758     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList;
00759     LPWSTR Source,Target;
00760 
00761     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o0">ConsoleHandle</a>,
00762                          &amp;Console
00763                         );
00764     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00765         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00766     }
00767 
00768     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o4">Source</a>, a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
00769         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o5">Target</a>, a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
00770         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o6">Exe</a>, a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o3">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
00771 
00772         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00773         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00774     }
00775 
00776     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o7">Unicode</a>) {
00777         Source = a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o4">Source</a>;
00778         Target = a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o5">Target</a>;
00779     } <span class="keywordflow">else</span> {
00780         Source = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a>*<span class="keyword">sizeof</span>(WCHAR));
00781         <span class="keywordflow">if</span> (Source == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00782             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00783             <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
00784         }
00785         Target = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TMP_TAG ),a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a>*<span class="keyword">sizeof</span>(WCHAR));
00786         <span class="keywordflow">if</span> (Target == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00787             <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Source);
00788             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00789             <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
00790         }
00791         a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a> * <span class="keyword">sizeof</span>(WCHAR));
00792         a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00793                                             a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o4">Source</a>,
00794                                             a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a>,
00795                                             Source,
00796                                             a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a>);
00797         a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a> *= 2;
00798     }
00799     ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a22">FindExe</a>(Console,a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o6">Exe</a>,a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o3">ExeLength</a>,a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o8">UnicodeExe</a>);
00800     <span class="keywordflow">if</span> (ExeAliasList) {
00801         Alias = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a23">FindAlias</a>(ExeAliasList,Source,a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o1">SourceLength</a>);
00802         <span class="keywordflow">if</span> (Alias) {
00803             <span class="keywordflow">if</span> (Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> + <span class="keyword">sizeof</span>(WCHAR) &gt; a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a>) {
00804                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_TOO_SMALL;
00805             } <span class="keywordflow">else</span> {
00806                 a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a> = Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> + <span class="keyword">sizeof</span>(WCHAR);
00807                 RtlCopyMemory(Target,Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a>,Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>);
00808                 Target[Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>/<span class="keyword">sizeof</span>(WCHAR)] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00809             }
00810         } <span class="keywordflow">else</span> {
00811             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
00812         }
00813     } <span class="keywordflow">else</span> {
00814         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_UNSUCCESSFUL;
00815     }
00816     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o7">Unicode</a>) {
00817         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00818             a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00819                                              Target,
00820                                              a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a> / <span class="keyword">sizeof</span>(WCHAR),
00821                                              a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o5">Target</a>,
00822                                              <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(a-&gt;<a class="code" href="../../d5/d0/struct__CONSOLE__GETALIAS__MSG.html#o2">TargetLength</a>)
00823                                              );
00824         }
00825         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Source);
00826         <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Target);
00827     }
00828     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00829     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00830     UNREFERENCED_PARAMETER(ReplyStatus);
00831 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="server/cmdline.c::SrvGetConsoleAliases" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvGetConsoleAliases           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00903">903</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00536">_CONSOLE_GETALIASES_MSG::AliasesBuffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00535">_CONSOLE_GETALIASES_MSG::AliasesBufferLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00172">_EXE_ALIAS_LIST::AliasList</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00071">CHAR_COUNT</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00530">_CONSOLE_GETALIASES_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00532">_CONSOLE_GETALIASES_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00531">_CONSOLE_GETALIASES_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00164">_ALIAS::Source</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00162">_ALIAS::SourceLength</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00165">_ALIAS::Target</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00163">_ALIAS::TargetLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00533">_CONSOLE_GETALIASES_MSG::Unicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00534">_CONSOLE_GETALIASES_MSG::UnicodeExe</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00907 {
00908     <a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html">PCONSOLE_GETALIASES_MSG</a> a = (<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html">PCONSOLE_GETALIASES_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00909     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00910     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList;
00911     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
00912     PLIST_ENTRY ListHead, ListNext;
00913     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> AliasesBufferLength;
00914     LPWSTR AliasesBufferPtrW;
00915     LPSTR  AliasesBufferPtrA;
00916     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00917 
00918     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o0">ConsoleHandle</a>,
00919                          &amp;Console
00920                         );
00921     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00922         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00923     }
00924 
00925     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o6">AliasesBuffer</a>, a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
00926         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o2">Exe</a>, a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o1">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
00927 
00928         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00929         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00930     }
00931 
00932     AliasesBufferLength = a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a>;
00933     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o3">Unicode</a>) {
00934         AliasesBufferPtrW = a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o6">AliasesBuffer</a>;
00935     } <span class="keywordflow">else</span> {
00936         AliasesBufferPtrA = a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o6">AliasesBuffer</a>;
00937     }
00938     a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a> = 0;
00939     ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a22">FindExe</a>(Console,a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o2">Exe</a>,a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o1">ExeLength</a>,a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o4">UnicodeExe</a>);
00940     <span class="keywordflow">if</span> (ExeAliasList) {
00941         ListHead = &amp;ExeAliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o3">AliasList</a>;
00942         ListNext = ListHead-&gt;Flink;
00943         <span class="keywordflow">while</span> (ListNext != ListHead) {
00944             Alias = CONTAINING_RECORD( ListNext, <a class="code" href="../../d1/d6/struct__ALIAS.html">ALIAS</a>, ListLink );
00945             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o3">Unicode</a>) {
00946                 <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a> + Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a> + Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> + (2*<span class="keyword">sizeof</span>(WCHAR)))
00947                     &lt;= AliasesBufferLength) {
00948                     RtlCopyMemory(AliasesBufferPtrW,Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o3">Source</a>,Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a>);
00949                     AliasesBufferPtrW+=Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a>/<span class="keyword">sizeof</span>(WCHAR);
00950                     *AliasesBufferPtrW++= (WCHAR)<span class="charliteral">'='</span>;
00951                     RtlCopyMemory(AliasesBufferPtrW,Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a>,Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>);
00952                     AliasesBufferPtrW+=Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>/<span class="keyword">sizeof</span>(WCHAR);
00953                     *AliasesBufferPtrW++= (WCHAR)<span class="charliteral">'\0'</span>;
00954                     a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a> += Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a> + Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> + (2*<span class="keyword">sizeof</span>(WCHAR));  <span class="comment">// +2 is for = and term null</span>
00955                 } <span class="keywordflow">else</span> {
00956                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00957                     <span class="keywordflow">return</span> (ULONG)STATUS_BUFFER_OVERFLOW;
00958                 }
00959             } <span class="keywordflow">else</span> {
00960                 <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a> + ((Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a> + Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>)/<span class="keyword">sizeof</span>(WCHAR)) + (2*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)))
00961                     &lt;= AliasesBufferLength) {
00962                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> SourceLength,TargetLength;
00963                     SourceLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00964                                                  Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o3">Source</a>,
00965                                                  Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a> / <span class="keyword">sizeof</span>(WCHAR),
00966                                                  AliasesBufferPtrA,
00967                                                  <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a>)
00968                                                  );
00969                     AliasesBufferPtrA+=SourceLength;
00970                     *AliasesBufferPtrA++ = <span class="charliteral">'='</span>;
00971                     TargetLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
00972                                                  Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o4">Target</a>,
00973                                                  Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> / <span class="keyword">sizeof</span>(WCHAR),
00974                                                  AliasesBufferPtrA,
00975                                                  <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a>)
00976                                                  );
00977                     AliasesBufferPtrA+=TargetLength;
00978                     *AliasesBufferPtrA++= <span class="charliteral">'\0'</span>;
00979                     a-&gt;<a class="code" href="../../d6/d0/struct__CONSOLE__GETALIASES__MSG.html#o5">AliasesBufferLength</a> += SourceLength + TargetLength + (2*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>));  <span class="comment">// +2 is for = and term null</span>
00980                 } <span class="keywordflow">else</span> {
00981                     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00982                     <span class="keywordflow">return</span> (ULONG)STATUS_BUFFER_OVERFLOW;
00983                 }
00984             }
00985             ListNext = ListNext-&gt;Flink;
00986         }
00987     }
00988     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00989     <span class="keywordflow">return</span> STATUS_SUCCESS;
00990     UNREFERENCED_PARAMETER(ReplyStatus);
00991 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="server/cmdline.c::SrvGetConsoleAliasesLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvGetConsoleAliasesLength           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00834">834</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00518">_CONSOLE_GETALIASESLENGTH_MSG::AliasesLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00172">_EXE_ALIAS_LIST::AliasList</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00515">_CONSOLE_GETALIASESLENGTH_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00517">_CONSOLE_GETALIASESLENGTH_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00516">_CONSOLE_GETALIASESLENGTH_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00394">FindExe()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00162">_ALIAS::SourceLength</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00163">_ALIAS::TargetLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00519">_CONSOLE_GETALIASESLENGTH_MSG::Unicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00520">_CONSOLE_GETALIASESLENGTH_MSG::UnicodeExe</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00838 {
00839     <a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html">PCONSOLE_GETALIASESLENGTH_MSG</a> a = (<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html">PCONSOLE_GETALIASESLENGTH_MSG</a>)&amp;m-&gt;u.ApiMessageData;
00840     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
00841     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> ExeAliasList;
00842     <a class="code" href="../../d1/d6/struct__ALIAS.html">PALIAS</a> Alias;
00843     PLIST_ENTRY ListHead, ListNext;
00844     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00845 
00846     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o0">ConsoleHandle</a>,
00847                          &amp;Console
00848                         );
00849     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00850         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00851     }
00852 
00853     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o2">Exe</a>, a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o1">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
00854         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00855         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00856     }
00857 
00858     a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o3">AliasesLength</a> = 0;
00859     ExeAliasList = <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a22">FindExe</a>(Console,a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o2">Exe</a>,a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o1">ExeLength</a>,a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o5">UnicodeExe</a>);
00860     <span class="keywordflow">if</span> (ExeAliasList) {
00861         ListHead = &amp;ExeAliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o3">AliasList</a>;
00862         ListNext = ListHead-&gt;Flink;
00863         <span class="keywordflow">while</span> (ListNext != ListHead) {
00864             Alias = CONTAINING_RECORD( ListNext, <a class="code" href="../../d1/d6/struct__ALIAS.html">ALIAS</a>, ListLink );
00865             a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o3">AliasesLength</a> += Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o1">SourceLength</a> + Alias-&gt;<a class="code" href="../../d1/d6/struct__ALIAS.html#o2">TargetLength</a> + (2*<span class="keyword">sizeof</span>(WCHAR));  <span class="comment">// +2 is for = and term null</span>
00866             ListNext = ListNext-&gt;Flink;
00867         }
00868     }
00869     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o4">Unicode</a>) {
00870         a-&gt;<a class="code" href="../../d7/d0/struct__CONSOLE__GETALIASESLENGTH__MSG.html#o3">AliasesLength</a> /= <span class="keyword">sizeof</span>(WCHAR);
00871     }
00872     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
00873     <span class="keywordflow">return</span> STATUS_SUCCESS;
00874     UNREFERENCED_PARAMETER(ReplyStatus);
00875 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="server/cmdline.c::SrvGetConsoleAliasExes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvGetConsoleAliasExes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01029">1029</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00542">_CONSOLE_GETALIASEXES_MSG::AliasExesBuffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00541">_CONSOLE_GETALIASEXES_MSG::AliasExesBufferLength</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00071">CHAR_COUNT</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00540">_CONSOLE_GETALIASEXES_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00150">_CONSOLE_INFORMATION::ExeAliasList</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00170">_EXE_ALIAS_LIST::ExeLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00171">_EXE_ALIAS_LIST::ExeName</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00543">_CONSOLE_GETALIASEXES_MSG::Unicode</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>01033 {
01034     <a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html">PCONSOLE_GETALIASEXES_MSG</a> a = (<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html">PCONSOLE_GETALIASEXES_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01035     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01036     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> AliasList;
01037     PLIST_ENTRY ListHead, ListNext;
01038     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> AliasExesBufferLength;
01039     LPWSTR AliasExesBufferPtrW;
01040     LPSTR  AliasExesBufferPtrA;
01041     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01042 
01043     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o0">ConsoleHandle</a>,
01044                          &amp;Console
01045                         );
01046     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01047         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01048     }
01049 
01050     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o2">AliasExesBuffer</a>, a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
01051         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01052         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01053     }
01054 
01055     AliasExesBufferLength = a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a>;
01056     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o3">Unicode</a>) {
01057         AliasExesBufferPtrW = a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o2">AliasExesBuffer</a>;
01058     } <span class="keywordflow">else</span> {
01059         AliasExesBufferPtrA = a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o2">AliasExesBuffer</a>;
01060     }
01061     a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a> = 0;
01062     ListHead = &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o21">ExeAliasList</a>;
01063     ListNext = ListHead-&gt;Flink;
01064     <span class="keywordflow">while</span> (ListNext != ListHead) {
01065         AliasList = CONTAINING_RECORD( ListNext, <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">EXE_ALIAS_LIST</a>, ListLink );
01066         <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o3">Unicode</a>) {
01067             <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a> + AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a> + (1*<span class="keyword">sizeof</span>(WCHAR)))
01068                 &lt;= AliasExesBufferLength) {
01069                 RtlCopyMemory(AliasExesBufferPtrW,AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o2">ExeName</a>,AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a>);
01070                 AliasExesBufferPtrW+=AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a>/<span class="keyword">sizeof</span>(WCHAR);
01071                 *AliasExesBufferPtrW++= (WCHAR)<span class="charliteral">'\0'</span>;
01072                 a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a> += AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a> + (1*<span class="keyword">sizeof</span>(WCHAR));  <span class="comment">// +1 is term null</span>
01073             } <span class="keywordflow">else</span> {
01074                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01075                 <span class="keywordflow">return</span> (ULONG)STATUS_BUFFER_OVERFLOW;
01076             }
01077         } <span class="keywordflow">else</span> {
01078             <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a> + (AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a>/<span class="keyword">sizeof</span>(WCHAR)) + (1*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)))
01079                 &lt;= AliasExesBufferLength) {
01080                 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> Length;
01081                 Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
01082                                         AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o2">ExeName</a>,
01083                                         AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a> / <span class="keyword">sizeof</span>(WCHAR),
01084                                         AliasExesBufferPtrA,
01085                                         <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a>)
01086                                         );
01087                 AliasExesBufferPtrA+=Length;
01088                 *AliasExesBufferPtrA++= (WCHAR)<span class="charliteral">'\0'</span>;
01089                 a-&gt;<a class="code" href="../../d8/d0/struct__CONSOLE__GETALIASEXES__MSG.html#o1">AliasExesBufferLength</a> += Length + (1*<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>));  <span class="comment">// +1 is term null</span>
01090             } <span class="keywordflow">else</span> {
01091                 <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01092                 <span class="keywordflow">return</span> (ULONG)STATUS_BUFFER_OVERFLOW;
01093             }
01094         }
01095         ListNext = ListNext-&gt;Flink;
01096     }
01097     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01098     <span class="keywordflow">return</span> STATUS_SUCCESS;
01099     UNREFERENCED_PARAMETER(ReplyStatus);
01100 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="server/cmdline.c::SrvGetConsoleAliasExesLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvGetConsoleAliasExesLength           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00994">994</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00525">_CONSOLE_GETALIASEXESLENGTH_MSG::AliasExesLength</a>, <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00524">_CONSOLE_GETALIASEXESLENGTH_MSG::ConsoleHandle</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00150">_CONSOLE_INFORMATION::ExeAliasList</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00170">_EXE_ALIAS_LIST::ExeLength</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00526">_CONSOLE_GETALIASEXESLENGTH_MSG::Unicode</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>00998 {
00999     <a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html">PCONSOLE_GETALIASEXESLENGTH_MSG</a> a = (<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html">PCONSOLE_GETALIASEXESLENGTH_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01000     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01001     <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">PEXE_ALIAS_LIST</a> AliasList;
01002     PLIST_ENTRY ListHead, ListNext;
01003     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01004 
01005     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html#o0">ConsoleHandle</a>,
01006                          &amp;Console
01007                         );
01008     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01009         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01010     }
01011 
01012     a-&gt;<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html#o1">AliasExesLength</a> = 0;
01013     ListHead = &amp;Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o21">ExeAliasList</a>;
01014     ListNext = ListHead-&gt;Flink;
01015     <span class="keywordflow">while</span> (ListNext != ListHead) {
01016         AliasList = CONTAINING_RECORD( ListNext, <a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html">EXE_ALIAS_LIST</a>, ListLink );
01017         a-&gt;<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html#o1">AliasExesLength</a> += AliasList-&gt;<a class="code" href="../../d6/d8/struct__EXE__ALIAS__LIST.html#o1">ExeLength</a> + (1*<span class="keyword">sizeof</span>(WCHAR)); <span class="comment">// +1 for term null</span>
01018         ListNext = ListNext-&gt;Flink;
01019     }
01020     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html#o2">Unicode</a>) {
01021         a-&gt;<a class="code" href="../../d9/d0/struct__CONSOLE__GETALIASEXESLENGTH__MSG.html#o1">AliasExesLength</a> /= <span class="keyword">sizeof</span>(WCHAR);
01022     }
01023     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01024     <span class="keywordflow">return</span> STATUS_SUCCESS;
01025     UNREFERENCED_PARAMETER(ReplyStatus);
01026 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="server/cmdline.c::SrvGetConsoleCommandHistory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvGetConsoleCommandHistory           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01500">1500</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00071">CHAR_COUNT</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00024">_COMMAND::Command</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00575">_CONSOLE_GETCOMMANDHISTORY_MSG::CommandBuffer</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00574">_CONSOLE_GETCOMMANDHISTORY_MSG::CommandBufferLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00023">_COMMAND::CommandLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00079">_COMMAND_HISTORY::Commands</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00573">_CONSOLE_GETCOMMANDHISTORY_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00577">_CONSOLE_GETCOMMANDHISTORY_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00576">_CONSOLE_GETCOMMANDHISTORY_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00072">_COMMAND_HISTORY::NumberOfCommands</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00578">_CONSOLE_GETCOMMANDHISTORY_MSG::Unicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00579">_CONSOLE_GETCOMMANDHISTORY_MSG::UnicodeExe</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>01504 {
01505     <a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html">PCONSOLE_GETCOMMANDHISTORY_MSG</a> a = (<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html">PCONSOLE_GETCOMMANDHISTORY_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01506     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01507     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01508     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i,CommandHistoryLength;
01509     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory;
01510     PWCHAR CommandBufferW;
01511     PCHAR CommandBufferA;
01512 
01513     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o0">ConsoleHandle</a>,
01514                          &amp;Console
01515                         );
01516     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01517         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01518     }
01519 
01520     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o2">CommandBuffer</a>, a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o1">CommandBufferLength</a>, <span class="keyword">sizeof</span>(BYTE)) ||
01521         !CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o4">Exe</a>, a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o3">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
01522 
01523         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01524         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01525     }
01526 
01527     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o5">Unicode</a>) {
01528         CommandBufferW=a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o2">CommandBuffer</a>;
01529     } <span class="keywordflow">else</span> {
01530         CommandBufferA=a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o2">CommandBuffer</a>;
01531     }
01532     CommandHistoryLength=0;
01533     CommandHistory=<a class="code" href="../../d4/d1/cmdline_8h.html#a45">FindExeCommandHistory</a>(Console,
01534                                          a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o4">Exe</a>,
01535                                          a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o3">ExeLength</a>,
01536                                          a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o6">UnicodeExe</a>);
01537     <span class="keywordflow">if</span> (CommandHistory) {
01538         <span class="keywordflow">for</span> (i=0;i&lt;CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o3">NumberOfCommands</a>;i++) {
01539             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o5">Unicode</a>) {
01540                 <span class="keywordflow">if</span> ((CommandHistoryLength+CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>+<span class="keyword">sizeof</span>(WCHAR)) &lt;= a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o1">CommandBufferLength</a>) {
01541                     RtlCopyMemory(CommandBufferW,CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o1">Command</a>,CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>);
01542                     CommandBufferW+=CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>/<span class="keyword">sizeof</span>(WCHAR);
01543                     *CommandBufferW++=(WCHAR)<span class="charliteral">'\0'</span>;
01544                     CommandHistoryLength+=CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>+<span class="keyword">sizeof</span>(WCHAR);
01545                 } <span class="keywordflow">else</span> {
01546                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_OVERFLOW;
01547                     <span class="keywordflow">break</span>;
01548                 }
01549             } <span class="keywordflow">else</span> {
01550                 <span class="keywordflow">if</span> ((CommandHistoryLength+(CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>/<span class="keyword">sizeof</span>(WCHAR))+<span class="keyword">sizeof</span>(<a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>)) &lt;= a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o1">CommandBufferLength</a>) {
01551                     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> Length;
01552                     Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
01553                                             CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o1">Command</a>,
01554                                             CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a> / <span class="keyword">sizeof</span>(WCHAR),
01555                                             CommandBufferA,
01556                                             <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a5">CHAR_COUNT</a>(CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>)
01557                                             );
01558                     CommandBufferA+=Length;
01559                     *CommandBufferA++=(WCHAR)<span class="charliteral">'\0'</span>;
01560                     CommandHistoryLength+=CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>+<span class="keyword">sizeof</span>(WCHAR);
01561                 } <span class="keywordflow">else</span> {
01562                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_BUFFER_OVERFLOW;
01563                     <span class="keywordflow">break</span>;
01564                 }
01565             }
01566         }
01567     }
01568     a-&gt;<a class="code" href="../../d0/d1/struct__CONSOLE__GETCOMMANDHISTORY__MSG.html#o1">CommandBufferLength</a>=CommandHistoryLength;
01569     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01570     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01571     UNREFERENCED_PARAMETER(ReplyStatus);
01572 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="server/cmdline.c::SrvGetConsoleCommandHistoryLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvGetConsoleCommandHistoryLength           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01458">1458</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00565">_CONSOLE_GETCOMMANDHISTORYLENGTH_MSG::CommandHistoryLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00023">_COMMAND::CommandLength</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00079">_COMMAND_HISTORY::Commands</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00564">_CONSOLE_GETCOMMANDHISTORYLENGTH_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00567">_CONSOLE_GETCOMMANDHISTORYLENGTH_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00566">_CONSOLE_GETCOMMANDHISTORYLENGTH_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00072">_COMMAND_HISTORY::NumberOfCommands</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00568">_CONSOLE_GETCOMMANDHISTORYLENGTH_MSG::Unicode</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00569">_CONSOLE_GETCOMMANDHISTORYLENGTH_MSG::UnicodeExe</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01462 {
01463     <a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html">PCONSOLE_GETCOMMANDHISTORYLENGTH_MSG</a> a = (<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html">PCONSOLE_GETCOMMANDHISTORYLENGTH_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01464     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01465     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01466     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> i;
01467     <a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a> CommandHistory;
01468 
01469     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o0">ConsoleHandle</a>,
01470                          &amp;Console
01471                         );
01472     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01473         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01474     }
01475 
01476     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o3">Exe</a>, a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o2">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
01477         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01478         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01479     }
01480 
01481     a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o1">CommandHistoryLength</a>=0;
01482     CommandHistory=<a class="code" href="../../d4/d1/cmdline_8h.html#a45">FindExeCommandHistory</a>(Console,
01483                                          a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o3">Exe</a>,
01484                                          a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o2">ExeLength</a>,
01485                                          a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o5">UnicodeExe</a>);
01486     <span class="keywordflow">if</span> (CommandHistory) {
01487         <span class="keywordflow">for</span> (i=0;i&lt;CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o3">NumberOfCommands</a>;i++) {
01488             a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o1">CommandHistoryLength</a>+=CommandHistory-&gt;<a class="code" href="../../d9/d7/struct__COMMAND__HISTORY.html#o10">Commands</a>[i]-&gt;<a class="code" href="../../d8/d7/struct__COMMAND.html#o0">CommandLength</a>+<span class="keyword">sizeof</span>(WCHAR);
01489         }
01490     }
01491     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o4">Unicode</a>) {
01492         a-&gt;<a class="code" href="../../d1/d1/struct__CONSOLE__GETCOMMANDHISTORYLENGTH__MSG.html#o1">CommandHistoryLength</a> /= <span class="keyword">sizeof</span>(WCHAR);
01493     }
01494     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01495     <span class="keywordflow">return</span> STATUS_SUCCESS;
01496     UNREFERENCED_PARAMETER(ReplyStatus);
01497 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a82" doxytag="server/cmdline.c::SrvGetConsoleTitle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvGetConsoleTitle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04879">4879</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00612">_CONSOLE_GETTITLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01307">ConvertToOem()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00614">_CONSOLE_GETTITLE_MSG::Title</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00157">_CONSOLE_INFORMATION::Title</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00613">_CONSOLE_GETTITLE_MSG::TitleLength</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00155">_CONSOLE_INFORMATION::TitleLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00615">_CONSOLE_GETTITLE_MSG::Unicode</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>04883 {
04884     <a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html">PCONSOLE_GETTITLE_MSG</a> a = (<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html">PCONSOLE_GETTITLE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
04885     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04886     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
04887 
04888     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o0">ConsoleHandle</a>,
04889                          &amp;Console
04890                         );
04891     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
04892         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04893     }
04894 
04895     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o2">Title</a>, a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
04896         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04897         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
04898     }
04899 
04900     <span class="comment">// a-&gt;TitleLength contains length in bytes</span>
04901     <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o3">Unicode</a>) {
04902         <span class="keywordflow">if</span> ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a> &gt; Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a>) {
04903             a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a> = Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a>;
04904         }
04905         RtlCopyMemory(a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o2">Title</a>,Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a>,a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a>);
04906     } <span class="keywordflow">else</span> {
04907 <span class="preprocessor">#if defined(FE_SB)</span>
04908 <span class="preprocessor"></span>        a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(OEMCP,
04909                                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a>,
04910                                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a> / <span class="keyword">sizeof</span>(WCHAR),
04911                                         a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o2">Title</a>,
04912                                         a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a>
04913                                         );
04914 <span class="preprocessor">#else</span>
04915 <span class="preprocessor"></span>        a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a35">ConvertToOem</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
04916                                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a>,
04917                                         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a> / <span class="keyword">sizeof</span>(WCHAR),
04918                                         a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o2">Title</a>,
04919                                         a-&gt;<a class="code" href="../../d9/d2/struct__CONSOLE__GETTITLE__MSG.html#o1">TitleLength</a>
04920                                         );
04921 <span class="preprocessor">#endif</span>
04922 <span class="preprocessor"></span>    }
04923     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04924     <span class="keywordflow">return</span> STATUS_SUCCESS;
04925     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
04926 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="server/cmdline.c::SrvSetConsoleCommandHistoryMode" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvSetConsoleCommandHistoryMode           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01575">1575</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00583">_CONSOLE_SETCOMMANDHISTORYMODE_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00584">_CONSOLE_SETCOMMANDHISTORYMODE_MSG::Flags</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00180">_CONSOLE_INFORMATION::InsertMode</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01579 {
01580     <a class="code" href="../../d0/d5/struct__CONSOLE__SETCOMMANDHISTORYMODE__MSG.html">PCONSOLE_SETCOMMANDHISTORYMODE_MSG</a> a = (<a class="code" href="../../d0/d5/struct__CONSOLE__SETCOMMANDHISTORYMODE__MSG.html">PCONSOLE_SETCOMMANDHISTORYMODE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01581     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01582     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01583 
01584     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d0/d5/struct__CONSOLE__SETCOMMANDHISTORYMODE__MSG.html#o0">ConsoleHandle</a>,
01585                          &amp;Console
01586                         );
01587     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01588         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01589     }
01590     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o43">InsertMode</a> = (BOOLEAN) (a-&gt;<a class="code" href="../../d0/d5/struct__CONSOLE__SETCOMMANDHISTORYMODE__MSG.html#o1">Flags</a> != CONSOLE_OVERSTRIKE);
01591     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01592     <span class="keywordflow">return</span> STATUS_SUCCESS;
01593     UNREFERENCED_PARAMETER(ReplyStatus);
01594 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="server/cmdline.c::SrvSetConsoleNumberOfCommands" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> SrvSetConsoleNumberOfCommands           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01424">1424</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00555">_CONSOLE_SETNUMBEROFCOMMANDS_MSG::ConsoleHandle</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00558">_CONSOLE_SETNUMBEROFCOMMANDS_MSG::Exe</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00557">_CONSOLE_SETNUMBEROFCOMMANDS_MSG::ExeLength</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01637">FindExeCommandHistory()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00556">_CONSOLE_SETNUMBEROFCOMMANDS_MSG::NumCommands</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l01597">ReallocCommandHistory()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00560">_CONSOLE_SETNUMBEROFCOMMANDS_MSG::UnicodeExe</a>, and <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>.
<p>
<pre class="fragment"><div>01428 {
01429     <a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html">PCONSOLE_SETNUMBEROFCOMMANDS_MSG</a> a = (<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html">PCONSOLE_SETNUMBEROFCOMMANDS_MSG</a>)&amp;m-&gt;u.ApiMessageData;
01430     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
01431     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01432 
01433     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o0">ConsoleHandle</a>,
01434                          &amp;Console
01435                         );
01436     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01437         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01438     }
01439 
01440     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o3">Exe</a>, a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o2">ExeLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
01441         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01442         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
01443     }
01444 
01445     <a class="code" href="../../d4/d1/cmdline_8h.html#a44">ReallocCommandHistory</a>(Console,
01446                           <a class="code" href="../../d4/d1/cmdline_8h.html#a45">FindExeCommandHistory</a>(Console,
01447                                                 a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o3">Exe</a>,
01448                                                 a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o2">ExeLength</a>,
01449                                                 a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o5">UnicodeExe</a>),
01450                           a-&gt;<a class="code" href="../../d2/d6/struct__CONSOLE__SETNUMBEROFCOMMANDS__MSG.html#o1">NumCommands</a>
01451                          );
01452     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
01453     <span class="keywordflow">return</span> STATUS_SUCCESS;
01454     UNREFERENCED_PARAMETER(ReplyStatus);
01455 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a83" doxytag="server/cmdline.c::SrvSetConsoleTitle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG SrvSetConsoleTitle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCSR_API_MSG&nbsp;</td>
          <td class="mdname" nowrap> <em>m</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCSR_REPLY_STATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyStatus</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04929">4929</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d3/d7/w32_2ntcon_2server_2handle_8c-source.html#l01627">ApiPreamble()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00359">CM_UPDATE_TITLE</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00619">_CONSOLE_SETTITLE_MSG::ConsoleHandle</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00180">ConsoleHeapAlloc</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00193">ConsoleHeapFree</a>, <a class="el" href="../../d5/d9/w32_2ntcon_2server_2misc_8c-source.html#l01345">ConvertInputToUnicode()</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00210">_CONSOLE_INFORMATION::CP</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00137">_CONSOLE_INFORMATION::hWnd</a>, <a class="el" href="../../d0/d2/ldrp_8h-source.html#l00457">MAKE_TAG</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d5/ntcon_2server_2globals_8h-source.html#l00025">OEMCP</a>, <a class="el" href="../../d1/d7/ntcftxt_8h-source.html#l00427">PostMessage()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00621">_CONSOLE_SETTITLE_MSG::Title</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00157">_CONSOLE_INFORMATION::Title</a>, <a class="el" href="../../d9/d4/consrv_8h-source.html#l00066">TITLE_TAG</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00620">_CONSOLE_SETTITLE_MSG::TitleLength</a>, <a class="el" href="../../d2/d6/server_8h-source.html#l00155">_CONSOLE_INFORMATION::TitleLength</a>, <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00622">_CONSOLE_SETTITLE_MSG::Unicode</a>, <a class="el" href="../../d4/d2/ntcon_2server_2input_8c-source.html#l04103">UnlockConsole()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>04933 {
04934     <a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html">PCONSOLE_SETTITLE_MSG</a> a = (<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html">PCONSOLE_SETTITLE_MSG</a>)&amp;m-&gt;u.ApiMessageData;
04935     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04936     <a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html">PCONSOLE_INFORMATION</a> Console;
04937     LPWSTR NewTitle;
04938 
04939     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/w32_2ntcon_2server_2handle_8c.html#a33">ApiPreamble</a>(a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o0">ConsoleHandle</a>,
04940                          &amp;Console
04941                         );
04942     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
04943         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
04944     }
04945 
04946     <span class="keywordflow">if</span> (!CsrValidateMessageBuffer(m, &amp;a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o2">Title</a>, a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>, <span class="keyword">sizeof</span>(BYTE))) {
04947         <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04948         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
04949     }
04950 
04951     <span class="keywordflow">if</span> (!a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o3">Unicode</a>) {
04952         NewTitle = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TITLE_TAG ),a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>*<span class="keyword">sizeof</span>(WCHAR)+<span class="keyword">sizeof</span>(WCHAR));
04953         <span class="keywordflow">if</span> (NewTitle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04954             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04955             <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
04956         }
04957 
04958         <span class="comment">// convert title to unicode</span>
04959 
04960 <span class="preprocessor">#if defined(FE_SB)</span>
04961 <span class="preprocessor"></span>        Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(OEMCP,
04962                                                  a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o2">Title</a>,
04963                                                  a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>,
04964                                                  NewTitle,
04965                                                  a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>);
04966 <span class="preprocessor">#else</span>
04967 <span class="preprocessor"></span>        Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)<a class="code" href="../../d4/d0/w32_2ntcon_2server_2misc_8c.html#a36">ConvertInputToUnicode</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o61">CP</a>,
04968                                                  a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o2">Title</a>,
04969                                                  a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>,
04970                                                  NewTitle,
04971                                                  a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>);
04972 <span class="preprocessor">#endif</span>
04973 <span class="preprocessor"></span>        Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a> *= 2;
04974     } <span class="keywordflow">else</span> {
04975         <span class="comment">// a-&gt;TitleLength contains length in bytes</span>
04976 
04977         NewTitle = (LPWSTR)<a class="code" href="../../d8/d5/consrv_8h.html#a36">ConsoleHeapAlloc</a>(<a class="code" href="../../d9/d2/ldrp_8h.html#a11">MAKE_TAG</a>( TITLE_TAG ),a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>+<span class="keyword">sizeof</span>(WCHAR));
04978         <span class="keywordflow">if</span> (NewTitle == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
04979             <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04980             <span class="keywordflow">return</span> (ULONG)STATUS_NO_MEMORY;
04981         }
04982         Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a> = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>;
04983         RtlCopyMemory(NewTitle,a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o2">Title</a>,a-&gt;<a class="code" href="../../d6/d6/struct__CONSOLE__SETTITLE__MSG.html#o1">TitleLength</a>);
04984     }
04985     NewTitle[Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o26">TitleLength</a>/<span class="keyword">sizeof</span>(WCHAR)] = 0;   <span class="comment">// NULL terminate</span>
04986     <a class="code" href="../../d8/d5/consrv_8h.html#a38">ConsoleHeapFree</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a>);
04987     Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o28">Title</a> = NewTitle;
04988     <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(Console-&gt;<a class="code" href="../../d1/d3/struct__CONSOLE__INFORMATION.html#o8">hWnd</a>, CM_UPDATE_TITLE, 0, 0);
04989     <a class="code" href="../../d3/d3/ntcon_2server_2input_8c.html#a54">UnlockConsole</a>(Console);
04990     <span class="keywordflow">return</span> STATUS_SUCCESS;
04991     UNREFERENCED_PARAMETER(ReplyStatus);    <span class="comment">// get rid of unreferenced parameter warning message</span>
04992 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a73" doxytag="server/cmdline.c::UpdateCommandListPopup" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UpdateCommandListPopup           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Delta</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a21">PSHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CurrentCommand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d9/d7/struct__COMMAND__HISTORY.html">PCOMMAND_HISTORY</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandHistory</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Popup</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04500">4500</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00113">COMMAND_INDEX_TO_NUM</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00112">COMMAND_NUM_TO_INDEX</a>, <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04346">DrawCommandListPopup()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00058">POPUP_SIZE_Y</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00378">UCLP_WRAP</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04301">UpdateHighlight()</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l02287">ProcessCommandListInput()</a>.
<p>
<pre class="fragment"><div>04508 {
04509     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
04510     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> CurCmdNum;
04511     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> NewCmdNum;
04512     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Scroll=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
04513 
04514     <span class="keywordflow">if</span> (Delta == 0) {
04515         <span class="keywordflow">return</span>;
04516     }
04517     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a> = <a class="code" href="../../d4/d1/cmdline_8h.html#a2">POPUP_SIZE_Y</a>(Popup);
04518 
04519     <span class="keywordflow">if</span> (Flags &amp; <a class="code" href="../../d4/d1/cmdline_8h.html#a22">UCLP_WRAP</a>) {
04520         CurCmdNum = *CurrentCommand;
04521         NewCmdNum = CurCmdNum + Delta;
04522         NewCmdNum = <a class="code" href="../../d4/d1/cmdline_8h.html#a9">COMMAND_INDEX_TO_NUM</a>(NewCmdNum, CommandHistory);
04523         CurCmdNum = <a class="code" href="../../d4/d1/cmdline_8h.html#a9">COMMAND_INDEX_TO_NUM</a>(CurCmdNum, CommandHistory);
04524     } <span class="keywordflow">else</span> {
04525         CurCmdNum = <a class="code" href="../../d4/d1/cmdline_8h.html#a9">COMMAND_INDEX_TO_NUM</a>(*CurrentCommand, CommandHistory);
04526         NewCmdNum = CurCmdNum + Delta;
04527         <span class="keywordflow">if</span> (NewCmdNum &gt;= CommandHistory-&gt;NumberOfCommands) {
04528             NewCmdNum = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CommandHistory-&gt;NumberOfCommands-1);
04529         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NewCmdNum &lt; 0) {
04530             NewCmdNum = 0;
04531         }
04532     }
04533     Delta = NewCmdNum - CurCmdNum;
04534 
04535     <span class="comment">// determine amount to scroll, if any</span>
04536 
04537     <span class="keywordflow">if</span> (NewCmdNum &lt;= Popup-&gt;BottomIndex-<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>) {
04538         Popup-&gt;BottomIndex += Delta;
04539         <span class="keywordflow">if</span> (Popup-&gt;BottomIndex &lt; (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>-1)) {
04540             Popup-&gt;BottomIndex = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>-1);
04541         }
04542         Scroll = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04543     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (NewCmdNum &gt; Popup-&gt;BottomIndex) {
04544         Popup-&gt;BottomIndex += Delta;
04545         <span class="keywordflow">if</span> (Popup-&gt;BottomIndex &gt;= CommandHistory-&gt;NumberOfCommands) {
04546             Popup-&gt;BottomIndex = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(CommandHistory-&gt;NumberOfCommands-1);
04547         }
04548         Scroll = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
04549     }
04550 
04551 
04552     <span class="comment">//</span>
04553     <span class="comment">// write commands to popup</span>
04554     <span class="comment">//</span>
04555     <span class="keywordflow">if</span> (Scroll) {
04556         <a class="code" href="../../d4/d1/cmdline_8h.html#a61">DrawCommandListPopup</a>(Popup,<a class="code" href="../../d4/d1/cmdline_8h.html#a8">COMMAND_NUM_TO_INDEX</a>(NewCmdNum,CommandHistory),CommandHistory,ScreenInfo);
04557     } <span class="keywordflow">else</span> {
04558         <a class="code" href="../../d3/d1/server_2cmdline_8c.html#a71">UpdateHighlight</a>(Popup,<a class="code" href="../../d4/d1/cmdline_8h.html#a9">COMMAND_INDEX_TO_NUM</a>((*CurrentCommand),CommandHistory),NewCmdNum,ScreenInfo);
04559     }
04560     *CurrentCommand = <a class="code" href="../../d4/d1/cmdline_8h.html#a8">COMMAND_NUM_TO_INDEX</a>(NewCmdNum,CommandHistory);
04561 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a71" doxytag="server/cmdline.c::UpdateHighlight" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID UpdateHighlight           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d0/struct__CLE__POPUP.html">PCLE_POPUP</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Popup</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OldCurrentCommand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d6/jul98_2test_2icc__i386_8h.html#a13">SHORT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>NewCurrentCommand</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d8/struct__SCREEN__INFORMATION.html">PSCREEN_INFORMATION</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ScreenInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04301">4301</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
References <a class="el" href="../../d6/d4/conmsg_8h-source.html#l00271">CONSOLE_ATTRIBUTE</a>, <a class="el" href="../../d7/d7/dispatch_8h-source.html#l00075">FillOutput</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00057">POPUP_SIZE_X</a>, <a class="el" href="../../d5/d0/cmdline_8h-source.html#l00058">POPUP_SIZE_Y</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l04500">UpdateCommandListPopup()</a>.
<p>
<pre class="fragment"><div>04307 {
04308     COORD WriteCoord;
04309     ULONG lStringLength;
04310     WORD Attributes;
04311     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a> TopIndex;
04312 
04313     <span class="keywordflow">if</span> (Popup-&gt;BottomIndex &lt; <a class="code" href="../../d4/d1/cmdline_8h.html#a2">POPUP_SIZE_Y</a>(Popup)) {
04314         TopIndex = 0;
04315     } <span class="keywordflow">else</span> {
04316         TopIndex = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;BottomIndex-<a class="code" href="../../d4/d1/cmdline_8h.html#a2">POPUP_SIZE_Y</a>(Popup)+1);
04317     }
04318     WriteCoord.X = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;Region.Left+1);
04319     lStringLength = <a class="code" href="../../d4/d1/cmdline_8h.html#a1">POPUP_SIZE_X</a>(Popup);
04320 
04321     WriteCoord.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;Region.Top+1+OldCurrentCommand-TopIndex);
04322     <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04323                Popup-&gt;Attributes,
04324                WriteCoord,
04325                CONSOLE_ATTRIBUTE,
04326                &amp;lStringLength
04327               );
04328 
04329     <span class="comment">//</span>
04330     <span class="comment">// highlight new command</span>
04331     <span class="comment">//</span>
04332 
04333     WriteCoord.Y = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(Popup-&gt;Region.Top+1+NewCurrentCommand-TopIndex);
04334     <span class="comment">// inverted attributes</span>
04335     Attributes = (WORD)(((Popup-&gt;Attributes &lt;&lt; 4) &amp; 0xf0) |
04336                         ((Popup-&gt;Attributes &gt;&gt; 4) &amp; 0x0f));
04337     <a class="code" href="../../d6/d8/dispatch_8h.html#a6">FillOutput</a>(ScreenInfo,
04338                Attributes,
04339                WriteCoord,
04340                CONSOLE_ATTRIBUTE,
04341                &amp;lStringLength
04342               );
04343 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a13" doxytag="server/cmdline.c::gaDefaultKeyDef" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST ExtKeyDefTable <a class="el" href="../../d3/d1/server_2cmdline_8c.html#a13">gaDefaultKeyDef</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00088">88</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00186">InitExtendedEditKeys()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="server/cmdline.c::gaKeyDef" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ExtKeyDefTable <a class="el" href="../../d3/d1/server_2cmdline_8c.html#a12">gaKeyDef</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00086">86</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00186">InitExtendedEditKeys()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00229">ParseEditKeyInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="server/cmdline.c::gaWordDelimChars" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WCHAR <a class="el" href="../../d4/d1/cmdline_8h.html#a38">gaWordDelimChars</a>[WORD_DELIM_MAX]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00306">306</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02210">GetRegistryValues()</a>, and <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00309">IsWordDelim()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="server/cmdline.c::gaWordDelimCharsDefault" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST WCHAR <a class="el" href="../../d4/d1/cmdline_8h.html#a39">gaWordDelimCharsDefault</a>[WORD_DELIM_MAX] = L"\\" L"+!:=/.&lt;&gt;;|&amp;"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html#l00307">307</a> of file <a class="el" href="../../d4/d0/server_2cmdline_8c-source.html">server/cmdline.c</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/srvinit_8c-source.html#l02210">GetRegistryValues()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:08 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
