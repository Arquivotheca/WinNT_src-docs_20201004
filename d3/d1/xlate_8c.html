<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: xlate.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>xlate.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d4/d0/xlate_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>WORD&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/xlate_8c.html#a1">GetModifierBits</a> (PMODIFIERS pModifiers, LPBYTE afKeyState)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WORD&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/xlate_8c.html#a2">GetModificationNumber</a> (PMODIFIERS pModifiers, WORD wModBits)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/xlate_8c.html#a3">VKFromVSC</a> (PKE pke, <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> bPrefix, LPBYTE afKeyState)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/xlate_8c.html#a4">InternalMapVirtualKeyEx</a> (UINT wCode, UINT wType, PKBDTABLES pKbdTbl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int APIENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/xlate_8c.html#a5">_GetKeyNameText</a> (LONG lParam, LPWSTR ccxlpStr, int cchSize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/xlate_8c.html#a6">xxxAltGr</a> (PKE pKe)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/xlate_8c.html#a7">xxxShiftLock</a> (PKE pKe)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/xlate_8c.html#a8">KEOEMProcs</a> (PKE pKe)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/xlate_8c.html#a9">xxxKELocaleProcs</a> (PKE pKe)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/xlate_8c.html#a0">gbAltGrDown</a> = FALSE</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a5" doxytag="xlate.c::_GetKeyNameText" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int APIENTRY _GetKeyNameText           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LONG&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>ccxlpStr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cchSize</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/xlate_8c-source.html#l00408">408</a> of file <a class="el" href="../../d4/d0/xlate_8c-source.html">xlate.c</a>.
<p>
References <a class="el" href="../../d2/d0/bench_8c-source.html#l00048">APIENTRY</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d4/d0/xlate_8c-source.html#l00231">InternalMapVirtualKeyEx()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02495">tagKBDFILE::pKbdTbl</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00059">PtiCurrentShared</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02509">tagKL::spkf</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03323">tagTHREADINFO::spklActive</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d2/d4/w32_2ntuser_2rtl_2random_8c-source.html#l00146">wcsncpycch()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l08992">NtUserGetKeyNameText()</a>.
<p>
<pre class="fragment"><div>00412 {
00413     <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> Vsc = <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(HIWORD(lParam));
00414     PVSC_LPWSTR pKN;
00415     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiT = <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>();
00416     PKBDTABLES pKbdTbl;
00417     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> Vk;
00418     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> Char;
00419 
00420     <span class="comment">/*</span>
00421 <span class="comment">     * NOTE -- lpStr can be a client-side address, so access through it</span>
00422 <span class="comment">     *    must be guarded with try blocks.</span>
00423 <span class="comment">     */</span>
00424 
00425     <span class="keywordflow">if</span> (cchSize &lt; 1)
00426         <span class="keywordflow">return</span> 0;
00427 
00428     <span class="comment">/*</span>
00429 <span class="comment">     * If bit 25 set (don't care about left vs. right) then:</span>
00430 <span class="comment">     * 1) convert right-Shift into left-Shift</span>
00431 <span class="comment">     * 2) clear the extended bit for Ctrl and Alt only (effectively converting</span>
00432 <span class="comment">     *    right-Ctrl &amp; right-Alt into left-Ctrl &amp; right-Alt)</span>
00433 <span class="comment">     * For Windows '95 compatibility, the DONTCARE_BIT doesn't apply to other</span>
00434 <span class="comment">     * extended keys (eg: NumPad cursor movement keys, NumPad Enter). Some</span>
00435 <span class="comment">     * applications (Word '95) depend on this.  #37796</span>
00436 <span class="comment">     */</span>
00437     <span class="keywordflow">if</span> (lParam &amp; DONTCARE_BIT) {
00438         <span class="keywordflow">if</span> (Vsc == SCANCODE_RSHIFT) {
00439            Vsc = SCANCODE_LSHIFT;
00440         }
00441         <span class="keywordflow">if</span> (lParam &amp; EXTENDED_BIT) {
00442             <span class="keywordflow">if</span> ((Vsc == SCANCODE_CTRL) || (Vsc == SCANCODE_ALT)) {
00443                 lParam &amp;= ~EXTENDED_BIT;
00444             }
00445         }
00446         lParam &amp;= ~DONTCARE_BIT;
00447     }
00448 
00449     <span class="keywordflow">if</span> (ptiT-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o4">spklActive</a> == (<a class="code" href="../../d4/d9/structtagKL.html">PKL</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00450         <span class="keywordflow">return</span> 0;
00451     }
00452     pKbdTbl = ptiT-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o4">spklActive</a>-&gt;<a class="code" href="../../d4/d9/structtagKL.html#o5">spkf</a>-&gt;<a class="code" href="../../d1/d9/structtagKBDFILE.html#o4">pKbdTbl</a>;
00453 
00454     <span class="comment">/*</span>
00455 <span class="comment">     * Scan pKbdTbl-&gt;pKeyNames[] or pKeyNamesExt[] for matching Virtual Scan Code</span>
00456 <span class="comment">     */</span>
00457     <span class="keywordflow">if</span> (lParam &amp; EXTENDED_BIT) {
00458         pKN = pKbdTbl-&gt;pKeyNamesExt;
00459     } <span class="keywordflow">else</span> {
00460         pKN = pKbdTbl-&gt;pKeyNames;
00461     }
00462 
00463     <span class="keywordflow">if</span> (pKN) {
00464         <span class="keywordflow">while</span> (pKN-&gt;vsc != 0) {
00465             <span class="keywordflow">if</span> (Vsc == pKN-&gt;vsc) {
00466 
00467                 <span class="keywordflow">try</span> {
00468                     cchSize = <a class="code" href="../../d1/d5/w32_2ntuser_2rtl_2random_8c.html#a3">wcsncpycch</a>(ccxlpStr, pKN-&gt;pwsz, cchSize);
00469                     cchSize--;
00470                     ccxlpStr[cchSize] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00471                 } except(W32ExceptionHandler(TRUE, RIP_ERROR)) {
00472                     <span class="keywordflow">return</span> 0;
00473                 }
00474                 <span class="keywordflow">return</span> cchSize;
00475             }
00476             pKN++;
00477         }
00478     }
00479 
00480     <span class="comment">/*</span>
00481 <span class="comment">     * The name of the key was not found in the table, so we</span>
00482 <span class="comment">     * now attempt to construct the key name from the character produced by</span>
00483 <span class="comment">     * the key.  Translate Scancode -&gt; Virtual Key -&gt; character.</span>
00484 <span class="comment">     */</span>
00485 
00486     <span class="comment">/*</span>
00487 <span class="comment">     * Translate Scancode to Virtual Key (ignoring modifier keys etc.)</span>
00488 <span class="comment">     */</span>
00489     Vk = <a class="code" href="../../d3/d1/xlate_8c.html#a4">InternalMapVirtualKeyEx</a>((UINT)Vsc, 1, pKbdTbl);
00490     <span class="keywordflow">if</span> (Vk == 0) {
00491         <span class="keywordflow">return</span> 0;
00492     }
00493 
00494     <span class="comment">/*</span>
00495 <span class="comment">     * Now translate Virtual Key to character (ignoring modifier keys etc.)</span>
00496 <span class="comment">     */</span>
00497     Char = <a class="code" href="../../d3/d1/xlate_8c.html#a4">InternalMapVirtualKeyEx</a>((UINT)Vk, 2, pKbdTbl);
00498     <span class="keywordflow">if</span> (Char == 0) {
00499         <span class="keywordflow">return</span> 0;
00500     }
00501 
00502     <span class="keywordflow">if</span> (Char &amp; 0x80000000) {
00503         LPWSTR *ppwsz;
00504 
00505         ppwsz = pKbdTbl-&gt;pKeyNamesDead;
00506         <span class="keywordflow">if</span> (ppwsz) {
00507             <span class="keywordflow">while</span> (*ppwsz != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00508                 <span class="keywordflow">if</span> (*ppwsz[0] == (WCHAR)Char) {
00509                     <span class="keywordflow">try</span> {
00510                         cchSize = <a class="code" href="../../d1/d5/w32_2ntuser_2rtl_2random_8c.html#a3">wcsncpycch</a>(ccxlpStr, (*ppwsz)+1, cchSize);
00511                         cchSize--;
00512                         ccxlpStr[cchSize] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00513                     } except(W32ExceptionHandler(TRUE, RIP_ERROR)) {
00514                         <span class="keywordflow">return</span> 0;
00515                     }
00516                     <span class="keywordflow">return</span> cchSize;
00517                 }
00518                 ppwsz++;
00519             }
00520         }
00521     }
00522 
00523     <span class="comment">/*</span>
00524 <span class="comment">     * Construct a single character name (adding null-terminator if possible)</span>
00525 <span class="comment">     */</span>
00526     <span class="keywordflow">try</span> {
00527         ccxlpStr[0] = (WCHAR)Char;
00528         <span class="keywordflow">if</span> (cchSize &gt;= 2) {
00529             ccxlpStr[1] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00530         }
00531     } except(W32ExceptionHandler(TRUE, RIP_ERROR)) {
00532         <span class="keywordflow">return</span> 0;
00533     }
00534     <span class="keywordflow">return</span> 1;
00535 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="xlate.c::GetModificationNumber" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WORD GetModificationNumber           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PMODIFIERS&nbsp;</td>
          <td class="mdname" nowrap> <em>pModifiers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WORD&nbsp;</td>
          <td class="mdname" nowrap> <em>wModBits</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/xlate_8c-source.html#l00047">47</a> of file <a class="el" href="../../d4/d0/xlate_8c-source.html">xlate.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01835">CheckCritInShared</a>.
<p>
Referenced by <a class="el" href="../../d3/d3/tounicod_8c-source.html#l00803">InternalVkKeyScanEx()</a>, <a class="el" href="../../d5/d1/fekbd_8c-source.html#l00940">KbdNlsFuncTypeAlt()</a>, <a class="el" href="../../d5/d1/fekbd_8c-source.html#l00912">KbdNlsFuncTypeNormal()</a>, <a class="el" href="../../d4/d0/xlate_8c-source.html#l00073">VKFromVSC()</a>, and <a class="el" href="../../d3/d3/tounicod_8c-source.html#l00279">xxxInternalToUnicode()</a>.
<p>
<pre class="fragment"><div>00050 {
00051     <a class="code" href="../../d4/d1/userk_8h.html#a156">CheckCritInShared</a>();
00052     <span class="keywordflow">if</span> (wModBits &gt; pModifiers-&gt;wMaxModBits) {
00053          <span class="keywordflow">return</span> SHFT_INVALID;
00054     }
00055 
00056     <span class="keywordflow">return</span> pModifiers-&gt;ModNumber[wModBits];
00057 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="xlate.c::GetModifierBits" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WORD GetModifierBits           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PMODIFIERS&nbsp;</td>
          <td class="mdname" nowrap> <em>pModifiers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPBYTE&nbsp;</td>
          <td class="mdname" nowrap> <em>afKeyState</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/xlate_8c-source.html#l00026">26</a> of file <a class="el" href="../../d4/d0/xlate_8c-source.html">xlate.c</a>.
<p>
References <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02934">TestKeyDownBit</a>.
<p>
Referenced by <a class="el" href="../../d5/d1/fekbd_8c-source.html#l00940">KbdNlsFuncTypeAlt()</a>, <a class="el" href="../../d5/d1/fekbd_8c-source.html#l00912">KbdNlsFuncTypeNormal()</a>, <a class="el" href="../../d4/d0/xlate_8c-source.html#l00073">VKFromVSC()</a>, and <a class="el" href="../../d3/d3/tounicod_8c-source.html#l00279">xxxInternalToUnicode()</a>.
<p>
<pre class="fragment"><div>00029 {
00030     PVK_TO_BIT pVkToBit = pModifiers-&gt;pVkToBit;
00031     WORD wModBits = 0;
00032 
00033     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00034 
00035     <span class="keywordflow">while</span> (pVkToBit-&gt;Vk) {
00036         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a827">TestKeyDownBit</a>(afKeyState, pVkToBit-&gt;Vk)) {
00037             wModBits |= pVkToBit-&gt;ModBits;
00038         }
00039         pVkToBit++;
00040     }
00041     <span class="keywordflow">return</span> wModBits;
00042 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="xlate.c::InternalMapVirtualKeyEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT InternalMapVirtualKeyEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PKBDTABLES&nbsp;</td>
          <td class="mdname" nowrap> <em>pKbdTbl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/xlate_8c-source.html#l00231">231</a> of file <a class="el" href="../../d4/d0/xlate_8c-source.html">xlate.c</a>.
<p>
References <a class="el" href="../../d8/d7/kbd_8c-source.html#l00030">aVkNumpad</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/xlate_8c-source.html#l00408">_GetKeyNameText()</a>, <a class="el" href="../../d7/d1/kbdlyout_8c-source.html#l01104">AdjustPushState()</a>, and <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09089">NtUserMapVirtualKeyEx()</a>.
<p>
<pre class="fragment"><div>00235 {
00236     PVK_TO_WCHARS1 pVK;
00237     PVK_TO_WCHAR_TABLE pVKT;
00238     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> VkRet = 0;
00239     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> usScanCode;
00240     PVSC_VK pVscVk;
00241     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pVkNumpad;
00242 
00243     <span class="keywordflow">switch</span> (wType) {
00244     <span class="keywordflow">case</span> 0:
00245 
00246         <span class="comment">/*</span>
00247 <span class="comment">         * Convert Virtual Key (wCode) to Scan Code</span>
00248 <span class="comment">         */</span>
00249         <span class="keywordflow">if</span> ((wCode &gt;= VK_SHIFT) &amp;&amp; (wCode &lt;= VK_MENU)) {
00250 
00251             <span class="comment">/*</span>
00252 <span class="comment">             * Convert ambiguous Shift/Control/Alt keys to left-hand keys</span>
00253 <span class="comment">             */</span>
00254             wCode = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)((wCode - VK_SHIFT) * 2 + VK_LSHIFT);
00255         }
00256 
00257         <span class="comment">/*</span>
00258 <span class="comment">         * Scan through the table that maps Virtual Scancodes to Virtual Keys</span>
00259 <span class="comment">         * for non-extended keys.</span>
00260 <span class="comment">         */</span>
00261         <span class="keywordflow">for</span> (usScanCode = 0; usScanCode &lt; pKbdTbl-&gt;bMaxVSCtoVK; usScanCode++) {
00262             <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(pKbdTbl-&gt;pusVSCtoVK[usScanCode]) == wCode) {
00263                 <span class="keywordflow">return</span> usScanCode &amp; 0xFF;
00264             }
00265         }
00266 
00267         <span class="comment">/*</span>
00268 <span class="comment">         * Scan through the table that maps Virtual Scancodes to Virtual Keys</span>
00269 <span class="comment">         * for extended keys.</span>
00270 <span class="comment">         */</span>
00271         <span class="keywordflow">for</span> (pVscVk = pKbdTbl-&gt;pVSCtoVK_E0; pVscVk-&gt;Vk; pVscVk++) {
00272             <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(pVscVk-&gt;Vk) == wCode) {
00273                 <span class="keywordflow">return</span> (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)pVscVk-&gt;Vsc;
00274             }
00275         }
00276 
00277         <span class="comment">/*</span>
00278 <span class="comment">         * There was no match: maybe the Virtual Key can only be generated</span>
00279 <span class="comment">         * with Numlock on. Scan through aVkNumpad[] to determine scancode.</span>
00280 <span class="comment">         */</span>
00281         <span class="keywordflow">for</span> (pVkNumpad = <a class="code" href="../../d7/d8/kbd_8c.html#a1">aVkNumpad</a>; *pVkNumpad != 0; pVkNumpad++) {
00282             <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(*pVkNumpad) == wCode) {
00283                 <span class="keywordflow">return</span> (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(pVkNumpad - <a class="code" href="../../d7/d8/kbd_8c.html#a1">aVkNumpad</a>) + SCANCODE_NUMPAD_FIRST;
00284             }
00285         }
00286 
00287         <span class="keywordflow">return</span> 0;   <span class="comment">// No match found!</span>
00288 
00289     <span class="keywordflow">case</span> 1:
00290     <span class="keywordflow">case</span> 3:
00291 
00292         <span class="comment">/*</span>
00293 <span class="comment">         * Convert Scan Code (wCode) to Virtual Key, disregarding modifier keys</span>
00294 <span class="comment">         * and NumLock key etc.  Returns 0 for no corresponding Virtual Key</span>
00295 <span class="comment">         */</span>
00296         <span class="keywordflow">if</span> (wCode &lt; (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)(pKbdTbl-&gt;bMaxVSCtoVK)) {
00297             VkRet = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(pKbdTbl-&gt;pusVSCtoVK[wCode]);
00298         } <span class="keywordflow">else</span> {
00299             <span class="comment">/*</span>
00300 <span class="comment">             * Scan the E0 prefix table for a match</span>
00301 <span class="comment">             */</span>
00302             <span class="keywordflow">for</span> (pVscVk = pKbdTbl-&gt;pVSCtoVK_E0; pVscVk-&gt;Vk; pVscVk++) {
00303                 <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)pVscVk-&gt;Vsc == wCode) {
00304                     VkRet = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(pVscVk-&gt;Vk);
00305                     <span class="keywordflow">break</span>;
00306                 }
00307             }
00308         }
00309 
00310         <span class="keywordflow">if</span> ((wType == 1) &amp;&amp; (VkRet &gt;= VK_LSHIFT) &amp;&amp; (VkRet &lt;= VK_RMENU)) {
00311 
00312             <span class="comment">/*</span>
00313 <span class="comment">             * Convert left/right Shift/Control/Alt keys to ambiguous keys</span>
00314 <span class="comment">             * (neither left nor right)</span>
00315 <span class="comment">             */</span>
00316             VkRet = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)((VkRet - VK_LSHIFT) / 2 + VK_SHIFT);
00317         }
00318 
00319         <span class="keywordflow">if</span> (VkRet == 0xFF) {
00320             VkRet = 0;
00321         }
00322         <span class="keywordflow">return</span> VkRet;
00323 
00324     <span class="keywordflow">case</span> 2:
00325 
00326         <span class="comment">/*</span>
00327 <span class="comment">         * Bogus Win3.1 functionality: despite SDK documenation, return uppercase for</span>
00328 <span class="comment">         * VK_A through VK_Z</span>
00329 <span class="comment">         */</span>
00330         <span class="keywordflow">if</span> ((wCode &gt;= (WORD)<span class="charliteral">'A'</span>) &amp;&amp; (wCode &lt;= (WORD)<span class="charliteral">'Z'</span>)) {
00331             <span class="keywordflow">return</span> wCode;
00332         }
00333 
00334         <span class="comment">// HIWORD is no loner the wchar, due to app compat problems #287134</span>
00335         <span class="comment">// We should not return the wchar from pti-&gt;wchInjected that cached</span>
00336         <span class="comment">// at GetMessage time.</span>
00337         <span class="comment">// (delete this commented-out section by end of March 1999 - IanJa)</span>
00338         <span class="comment">//</span>
00339         <span class="comment">// if (LOWORD(wCode) == VK_PACKET) {</span>
00340         <span class="comment">//    return HIWORD(wCode);</span>
00341         <span class="comment">// }</span>
00342 
00343         <span class="comment">/*</span>
00344 <span class="comment">         * Convert Virtual Key (wCode) to ANSI.</span>
00345 <span class="comment">         * Search each Shift-state table in turn, looking for the Virtual Key.</span>
00346 <span class="comment">         */</span>
00347         <span class="keywordflow">for</span> (pVKT = pKbdTbl-&gt;pVkToWcharTable; pVKT-&gt;pVkToWchars != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; pVKT++) {
00348             pVK = pVKT-&gt;pVkToWchars;
00349             <span class="keywordflow">while</span> (pVK-&gt;VirtualKey != 0) {
00350                 <span class="keywordflow">if</span> ((<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)pVK-&gt;VirtualKey == wCode) {
00351 
00352                     <span class="comment">/*</span>
00353 <span class="comment">                     * Match found: return the unshifted character</span>
00354 <span class="comment">                     */</span>
00355                     <span class="keywordflow">if</span> (pVK-&gt;wch[0] == WCH_DEAD) {
00356 
00357                         <span class="comment">/*</span>
00358 <span class="comment">                         * It is a dead character: the next entry contains its</span>
00359 <span class="comment">                         * value.  Set the high bit to indicate dead key</span>
00360 <span class="comment">                         * (undocumented behaviour)</span>
00361 <span class="comment">                         */</span>
00362                         pVK = (PVK_TO_WCHARS1)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pVK + pVKT-&gt;cbSize);
00363                         <span class="keywordflow">return</span> pVK-&gt;wch[0] | (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)0x80000000;
00364                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pVK-&gt;wch[0] == WCH_NONE) {
00365                         <span class="keywordflow">return</span> 0; <span class="comment">// 9013</span>
00366                     }
00367                     <span class="keywordflow">if</span> (pVK-&gt;wch[0] == WCH_NONE) {
00368                         <span class="keywordflow">return</span> 0;
00369                     }
00370                     <span class="keywordflow">return</span> pVK-&gt;wch[0];
00371                 }
00372                 pVK = (PVK_TO_WCHARS1)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)pVK + pVKT-&gt;cbSize);
00373             }
00374         }
00375     }
00376 
00377     <span class="comment">/*</span>
00378 <span class="comment">     * Can't find translation, or wType was invalid</span>
00379 <span class="comment">     */</span>
00380     <span class="keywordflow">return</span> 0;
00381 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="xlate.c::KEOEMProcs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL KEOEMProcs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PKE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pKe</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/xlate_8c-source.html#l00635">635</a> of file <a class="el" href="../../d4/d0/xlate_8c-source.html">xlate.c</a>.
<p>
References <a class="el" href="../../d8/d7/kbd_8c-source.html#l00356">aKEProcOEM</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/ntinput_8c-source.html#l02791">xxxProcessKeyEvent()</a>.
<p>
<pre class="fragment"><div>00636 {
00637     <span class="keywordtype">int</span> i;
00638 
00639     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00640 
00641     <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d7/d8/kbd_8c.html#a16">aKEProcOEM</a>[i] != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; i++) {
00642         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d8/kbd_8c.html#a16">aKEProcOEM</a>[i](pKe)) {
00643             <span class="comment">/*</span>
00644 <span class="comment">             * Eat the key event</span>
00645 <span class="comment">             */</span>
00646             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00647         }
00648     }
00649 
00650     <span class="comment">/*</span>
00651 <span class="comment">     * Pass the (possibly altered) key event on.</span>
00652 <span class="comment">     */</span>
00653     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00654 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="xlate.c::VKFromVSC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> VKFromVSC           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PKE&nbsp;</td>
          <td class="mdname" nowrap> <em>pke</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>bPrefix</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPBYTE&nbsp;</td>
          <td class="mdname" nowrap> <em>afKeyState</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/xlate_8c-source.html#l00073">73</a> of file <a class="el" href="../../d4/d0/xlate_8c-source.html">xlate.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00593">gafRawKeyState</a>, <a class="el" href="../../d8/d7/kbd_8c-source.html#l00157">gapulCvt_VK</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l00439">GetActiveHKL()</a>, <a class="el" href="../../d4/d0/xlate_8c-source.html#l00047">GetModificationNumber()</a>, <a class="el" href="../../d4/d0/xlate_8c-source.html#l00026">GetModifierBits()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00189">gpKbdTbl</a>, <a class="el" href="../../d8/d7/kbd_8c-source.html#l00159">gpModifiers_VK</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00091">gptiForeground</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00591">IS_IME_ENABLED</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00183">LOBYTE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02495">tagKBDFILE::pKbdTbl</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02509">tagKL::spkf</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03323">tagTHREADINFO::spklActive</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/ntinput_8c-source.html#l02615">ProcessKeyboardInput()</a>, and <a class="el" href="../../d7/d7/ntinput_8c-source.html#l03403">xxxInternalKeyEventDirect()</a>.
<p>
<pre class="fragment"><div>00078 {
00079     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> usVKey;
00080     PVSC_VK pVscVk;
00081     PKBDTABLES pKbdTbl;
00082     <span class="keyword">static</span> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fVkPause;
00083 
00084     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00085     DBG_UNREFERENCED_PARAMETER(afKeyState);
00086 
00087     <span class="comment">/*</span>
00088 <span class="comment">     * Initialize as an unknown VK (unrecognised scancode)</span>
00089 <span class="comment">     */</span>
00090     pke-&gt;usFlaggedVk = usVKey = 0xFF;
00091 
00092     <span class="comment">/* HACK ALERT</span>
00093 <span class="comment">     * For Korean 103 keyboard:</span>
00094 <span class="comment">     * Check this is Korean keyboard layout or not.</span>
00095 <span class="comment">     */</span>
00096     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a126">IS_IME_ENABLED</a>() &amp;&amp;
00097             KOREAN_KBD_LAYOUT(<a class="code" href="../../d6/d8/ntinput_8c.html#a43">GetActiveHKL</a>())) {
00098         <span class="keywordflow">if</span> ((pke-&gt;bScanCode == 0x71) || (pke-&gt;bScanCode == 0x72)) {
00099             pke-&gt;bScanCode |= 0x80;
00100             bPrefix = 0xE0;
00101         } <span class="keywordflow">else</span> {
00102             pke-&gt;bScanCode &amp;= 0x7F;
00103         }
00104     } <span class="keywordflow">else</span> {
00105         pke-&gt;bScanCode &amp;= 0x7F;
00106     }
00107 
00108     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a25">gptiForeground</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00109         RIPMSG0(RIP_VERBOSE, <span class="stringliteral">"VKFromVSC: NULL gptiForeground\n"</span>);
00110         pKbdTbl = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a70">gpKbdTbl</a>;
00111     } <span class="keywordflow">else</span> {
00112         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a25">gptiForeground</a>-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o4">spklActive</a>) {
00113             pKbdTbl = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a25">gptiForeground</a>-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o4">spklActive</a>-&gt;<a class="code" href="../../d4/d9/structtagKL.html#o5">spkf</a>-&gt;<a class="code" href="../../d1/d9/structtagKBDFILE.html#o4">pKbdTbl</a>;
00114         } <span class="keywordflow">else</span> {
00115             RIPMSG0(RIP_VERBOSE, <span class="stringliteral">"VKFromVSC: NULL spklActive\n"</span>);
00116             pKbdTbl = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a70">gpKbdTbl</a>;
00117         }
00118     }
00119     <span class="keywordflow">if</span> (bPrefix == 0) {
00120         <span class="keywordflow">if</span> (pke-&gt;bScanCode &lt; pKbdTbl-&gt;bMaxVSCtoVK) {
00121             <span class="comment">/*</span>
00122 <span class="comment">             * direct index into non-prefix table</span>
00123 <span class="comment">             */</span>
00124             usVKey = pKbdTbl-&gt;pusVSCtoVK[pke-&gt;bScanCode];
00125             <span class="keywordflow">if</span> (usVKey == 0) {
00126                 <span class="keywordflow">return</span> 0xFF;
00127             }
00128         } <span class="keywordflow">else</span> {
00129             <span class="comment">/*</span>
00130 <span class="comment">             * unexpected scancode</span>
00131 <span class="comment">             */</span>
00132             RIPMSG2(RIP_VERBOSE, <span class="stringliteral">"unrecognized scancode 0x%x, prefix %x"</span>,
00133                     pke-&gt;bScanCode, bPrefix);
00134             <span class="keywordflow">return</span> 0xFF;
00135         }
00136     } <span class="keywordflow">else</span> {
00137         <span class="comment">/*</span>
00138 <span class="comment">         * Scan the E0 or E1 prefix table for a match</span>
00139 <span class="comment">         */</span>
00140         <span class="keywordflow">if</span> (bPrefix == 0xE0) {
00141             <span class="comment">/*</span>
00142 <span class="comment">             * Set the KBDEXT (extended key) bit in case the scancode is not</span>
00143 <span class="comment">             * found in the table (eg: FUJITSU POS keyboard #65436)</span>
00144 <span class="comment">             */</span>
00145             usVKey |= KBDEXT;
00146             <span class="comment">/*</span>
00147 <span class="comment">             * Ignore the SHIFT keystrokes generated by the hardware</span>
00148 <span class="comment">             */</span>
00149             <span class="keywordflow">if</span> ((pke-&gt;bScanCode == SCANCODE_LSHIFT) ||
00150                     (pke-&gt;bScanCode == SCANCODE_RSHIFT)) {
00151                 <span class="keywordflow">return</span> 0;
00152             }
00153             pVscVk = pKbdTbl-&gt;pVSCtoVK_E0;
00154         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bPrefix == 0xE1) {
00155             pVscVk = pKbdTbl-&gt;pVSCtoVK_E1;
00156         } <span class="keywordflow">else</span> {
00157             <span class="comment">/*</span>
00158 <span class="comment">             * Unrecognized prefix (from ScancodeMap?) produces an</span>
00159 <span class="comment">             * unextended and unrecognized VK.</span>
00160 <span class="comment">             */</span>
00161             <span class="keywordflow">return</span> 0xFF;
00162         }
00163         <span class="keywordflow">while</span> (pVscVk-&gt;Vk) {
00164             <span class="keywordflow">if</span> (pVscVk-&gt;Vsc == pke-&gt;bScanCode) {
00165                 usVKey = pVscVk-&gt;Vk;
00166                 <span class="keywordflow">break</span>;
00167             }
00168             pVscVk++;
00169         }
00170     }
00171 
00172     <span class="comment">/*</span>
00173 <span class="comment">     * Scancode set 1 returns PAUSE button as E1 1D 45 (E1 Ctrl NumLock)</span>
00174 <span class="comment">     * so convert E1 Ctrl to VK_PAUSE, and remember to discard the NumLock</span>
00175 <span class="comment">     */</span>
00176     <span class="keywordflow">if</span> (fVkPause) {
00177         <span class="comment">/*</span>
00178 <span class="comment">         * This is the "45" part of the Pause scancode sequence.</span>
00179 <span class="comment">         * Discard this key event: it is a false NumLock</span>
00180 <span class="comment">         */</span>
00181         fVkPause = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00182         <span class="keywordflow">return</span> 0;
00183     }
00184     <span class="keywordflow">if</span> (usVKey == VK_PAUSE) {
00185         <span class="comment">/*</span>
00186 <span class="comment">         * This is the "E1 1D" part of the Pause scancode sequence.</span>
00187 <span class="comment">         * Alter the scancode to the value Windows expects for Pause,</span>
00188 <span class="comment">         * and remember to discard the "45" scancode that will follow</span>
00189 <span class="comment">         */</span>
00190         pke-&gt;bScanCode = 0x45;
00191         fVkPause = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00192     }
00193 
00194     <span class="comment">/*</span>
00195 <span class="comment">     * Convert to a different VK if some modifier keys are depressed.</span>
00196 <span class="comment">     */</span>
00197     <span class="keywordflow">if</span> (usVKey &amp; KBDMULTIVK) {
00198         WORD nMod;
00199         PULONG pul;
00200 
00201         nMod = <a class="code" href="../../d3/d1/xlate_8c.html#a2">GetModificationNumber</a>(
00202                    gpModifiers_VK,
00203                    <a class="code" href="../../d3/d1/xlate_8c.html#a1">GetModifierBits</a>(gpModifiers_VK, gafRawKeyState));
00204 
00205         <span class="comment">/*</span>
00206 <span class="comment">         * Scan gapulCvt_VK[nMod] for matching VK.</span>
00207 <span class="comment">         */</span>
00208         <span class="keywordflow">if</span> ((nMod != SHFT_INVALID) &amp;&amp; ((pul = <a class="code" href="../../d7/d8/kbd_8c.html#a13">gapulCvt_VK</a>[nMod]) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00209             <span class="keywordflow">while</span> (*pul != 0) {
00210                 <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(*pul) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a4">LOBYTE</a>(usVKey)) {
00211                     pke-&gt;usFlaggedVk = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)HIWORD(*pul);
00212                     <span class="keywordflow">return</span> (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)pke-&gt;usFlaggedVk;
00213                 }
00214                 pul++;
00215             }
00216         }
00217     }
00218 
00219     pke-&gt;usFlaggedVk = usVKey;
00220     <span class="keywordflow">return</span> (<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a>)usVKey;
00221 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="xlate.c::xxxAltGr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> xxxAltGr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PKE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pKe</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/xlate_8c-source.html#l00547">547</a> of file <a class="el" href="../../d4/d0/xlate_8c-source.html">xlate.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d0/xlate_8c-source.html#l00545">gbAltGrDown</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05734">TestRawKeyDown</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d7/d7/ntinput_8c-source.html#l01338">xxxKeyEvent()</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/xlate_8c-source.html#l00662">xxxKELocaleProcs()</a>.
<p>
<pre class="fragment"><div>00549 {
00550     UserAssert(pKe != NULL);
00551 
00552     <span class="keywordflow">if</span> ((pKe-&gt;usFlaggedVk &amp; 0xFF) != VK_RMENU) {
00553         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00554     }
00555 
00556     <span class="keywordflow">if</span> (!(pKe-&gt;usFlaggedVk &amp; KBDBREAK)) {
00557         <span class="comment">/*</span>
00558 <span class="comment">         * If neither CTRL key is down, then fake one going down so that</span>
00559 <span class="comment">         * the right hand ALT key is converted to CTRL + ALT.</span>
00560 <span class="comment">         */</span>
00561         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a579">TestRawKeyDown</a>(VK_CONTROL)) {
00562             <a class="code" href="../../d3/d1/xlate_8c.html#a0">gbAltGrDown</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00563             <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(VK_LCONTROL, 0x1D | SCANCODE_SIMULATED,
00564                         pKe-&gt;dwTime, 0, FALSE);
00565         }
00566     } <span class="keywordflow">else</span> {
00567         <span class="comment">/*</span>
00568 <span class="comment">         * If the physical Left Ctrl key is not really down, fake the</span>
00569 <span class="comment">         * Left Ctrl key coming back up (undo earlier faked Left Ctrl down)</span>
00570 <span class="comment">         */</span>
00571         <a class="code" href="../../d3/d1/xlate_8c.html#a0">gbAltGrDown</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00572         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a579">TestRawKeyDown</a>(VK_LCONTROL)) {
00573             <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(VK_LCONTROL | KBDBREAK, 0x1D | SCANCODE_SIMULATED,
00574                         pKe-&gt;dwTime, 0, FALSE);
00575         }
00576     }
00577     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00578 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="xlate.c::xxxKELocaleProcs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxKELocaleProcs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PKE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pKe</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/xlate_8c-source.html#l00662">662</a> of file <a class="el" href="../../d4/d0/xlate_8c-source.html">xlate.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l01833">CheckCritIn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d0/xlate_8c-source.html#l00545">gbAltGrDown</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00192">gdwKeyboardAttributes</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00189">gpKbdTbl</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d0/xlate_8c-source.html#l00547">xxxAltGr()</a>, and <a class="el" href="../../d4/d0/xlate_8c-source.html#l00586">xxxShiftLock()</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/ntinput_8c-source.html#l02791">xxxProcessKeyEvent()</a>.
<p>
<pre class="fragment"><div>00663 {
00664     <a class="code" href="../../d4/d1/userk_8h.html#a154">CheckCritIn</a>();
00665 
00666     <span class="comment">/*</span>
00667 <span class="comment">     * AltGr is a layout-specific behavior</span>
00668 <span class="comment">     * Modifier keys are sent up as necessary in xxxInternalActivateKeyboardLayout</span>
00669 <span class="comment">     * (#139178), so left-Ctrl won't be left stuck down if we switch from an</span>
00670 <span class="comment">     * AltGr keyboard to a non-AltGr keybord while the AltGr is held down.</span>
00671 <span class="comment">     */</span>
00672     <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a70">gpKbdTbl</a>-&gt;fLocaleFlags &amp; KLLF_ALTGR) || <a class="code" href="../../d3/d1/xlate_8c.html#a0">gbAltGrDown</a>) {
00673         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d1/xlate_8c.html#a6">xxxAltGr</a>(pKe)) {
00674             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00675         }
00676     }
00677 
00678     <span class="comment">/*</span>
00679 <span class="comment">     * ShiftLock/CapsLock is per-user (global) behavior as well as (for</span>
00680 <span class="comment">     * backward compatibility) per-layout behavior.</span>
00681 <span class="comment">     */</span>
00682     <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a73">gdwKeyboardAttributes</a> &amp; KLLF_SHIFTLOCK) ||
00683             (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a70">gpKbdTbl</a>-&gt;fLocaleFlags &amp; KLLF_SHIFTLOCK)) {
00684         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d1/xlate_8c.html#a7">xxxShiftLock</a>(pKe)) {
00685             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00686         }
00687     }
00688 
00689     <span class="comment">/*</span>
00690 <span class="comment">     * Other special Key Event processors</span>
00691 <span class="comment">     */</span>
00692 
00693     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00694 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="xlate.c::xxxShiftLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> xxxShiftLock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PKE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pKe</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/xlate_8c-source.html#l00586">586</a> of file <a class="el" href="../../d4/d0/xlate_8c-source.html">xlate.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02974">TestAsyncKeyStateToggle</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, and <a class="el" href="../../d7/d7/ntinput_8c-source.html#l01338">xxxKeyEvent()</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/xlate_8c-source.html#l00662">xxxKELocaleProcs()</a>.
<p>
<pre class="fragment"><div>00588 {
00589     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> Vk;
00590 
00591     UserAssert(pKe != NULL);
00592 
00593     <span class="comment">/*</span>
00594 <span class="comment">     * We only mess with downstrokes: return TRUE to let it pass unmolested.</span>
00595 <span class="comment">     */</span>
00596     <span class="keywordflow">if</span> (pKe-&gt;usFlaggedVk &amp; KBDBREAK) {
00597         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00598     }
00599 
00600     Vk = pKe-&gt;usFlaggedVk &amp; 0xFF;
00601 
00602     <span class="comment">/*</span>
00603 <span class="comment">     * If CapsLock is pressed when CapsLock is already on, lose the keystroke.</span>
00604 <span class="comment">     */</span>
00605     <span class="keywordflow">if</span> ((Vk == VK_CAPITAL) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a846">TestAsyncKeyStateToggle</a>(VK_CAPITAL)) {
00606         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00607     }
00608 
00609     <span class="comment">/*</span>
00610 <span class="comment">     * If a Shift key goes down when CapsLock is on, turn CapsLock off</span>
00611 <span class="comment">     * by simulating a click on the CapsLock key.</span>
00612 <span class="comment">     * Let the Shift down through FIRST, since it might be part of an</span>
00613 <span class="comment">     * input lang toggle (tough luck that this toggle turns off CapsLock!)</span>
00614 <span class="comment">     */</span>
00615     <span class="keywordflow">if</span> (((Vk == VK_LSHIFT) || (Vk == VK_RSHIFT) || (Vk == VK_SHIFT)) &amp;&amp;
00616             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a846">TestAsyncKeyStateToggle</a>(VK_CAPITAL)) {
00617         <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(pKe-&gt;usFlaggedVk, pKe-&gt;bScanCode,
00618                     pKe-&gt;dwTime, 0, FALSE);
00619         <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(VK_CAPITAL, 0x3A | SCANCODE_SIMULATED,
00620                     pKe-&gt;dwTime, 0, FALSE);
00621         <a class="code" href="../../d4/d1/userk_8h.html#a1039">xxxKeyEvent</a>(VK_CAPITAL | KBDBREAK, 0x3A | SCANCODE_SIMULATED,
00622                     pKe-&gt;dwTime, 0, FALSE);
00623         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00624     }
00625 
00626     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00627 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a0" doxytag="xlate.c::gbAltGrDown" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL <a class="el" href="../../d3/d1/xlate_8c.html#a0">gbAltGrDown</a> = FALSE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/xlate_8c-source.html#l00545">545</a> of file <a class="el" href="../../d4/d0/xlate_8c-source.html">xlate.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/xlate_8c-source.html#l00547">xxxAltGr()</a>, and <a class="el" href="../../d4/d0/xlate_8c-source.html#l00662">xxxKELocaleProcs()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:46:11 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
