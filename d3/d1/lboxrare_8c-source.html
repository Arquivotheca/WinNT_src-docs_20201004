<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: lboxrare.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>lboxrare.c</h1><a href="../../d2/d2/lboxrare_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/**************************** Module Header ********************************\</span>
00002 <span class="comment">* Module Name: lboxrare.c</span>
00003 <span class="comment">*</span>
00004 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00005 <span class="comment">*</span>
00006 <span class="comment">* Infrequently Used List Box Routines</span>
00007 <span class="comment">*</span>
00008 <span class="comment">* History:</span>
00009 <span class="comment">* ??-???-???? ianja    Ported from Win 3.0 sources</span>
00010 <span class="comment">* 14-Feb-1991 mikeke   Added Revalidation code</span>
00011 <span class="comment">\***************************************************************************/</span>
00012 
00013 <span class="preprocessor">#include "<a class="code" href="../../d7/d3/w32_2ntuser_2client_2precomp_8h.html">precomp.h</a>"</span>
00014 <span class="preprocessor">#pragma hdrstop</span>
00015 <span class="preprocessor"></span>
<a name="l00016"></a><a class="code" href="../../d2/d2/lboxrare_8c.html#a0">00016</a> <span class="keyword">extern</span> <a class="code" href="../../d2/d4/struct__LOOKASIDE.html">LOOKASIDE</a> <a class="code" href="../../d6/d1/lb1_8c.html#a0">ListboxLookaside</a>;
00017 
00018 <span class="comment">/***************************************************************************\</span>
00019 <span class="comment">* LBSetCItemFullMax</span>
00020 <span class="comment">*</span>
00021 <span class="comment">* History:</span>
00022 <span class="comment">* 03-04-92 JimA             Ported from Win 3.1 sources.</span>
00023 <span class="comment">\***************************************************************************/</span>
00024 
<a name="l00025"></a><a class="code" href="../../d6/d0/usercli_8h.html#a688">00025</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a688">LBSetCItemFullMax</a>(
00026     <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> plb)
00027 {
00028     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a> != <a class="code" href="../../d6/d0/usercli_8h.html#a63">OWNERDRAWVAR</a>) {
00029         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o5">cItemFullMax</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a713">CItemInWindow</a>(plb, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00030     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a> &lt; 2) {
00031         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o5">cItemFullMax</a> = 1;
00032     } <span class="keywordflow">else</span> {
00033         <span class="keywordtype">int</span>     height;
00034         RECT    rect;
00035         <span class="keywordtype">int</span>     i;
00036         <span class="keywordtype">int</span>     j = 0;
00037 
00038         <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>, &amp;rect);
00039         height = rect.bottom;
00040 
00041         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o5">cItemFullMax</a> = 0;
00042         <span class="keywordflow">for</span> (i = plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a> - 1; i &gt;= 0; i--, j++) {
00043             height -= <a class="code" href="../../d6/d0/usercli_8h.html#a746">LBGetVariableHeightItemHeight</a>(plb, i);
00044 
00045             <span class="keywordflow">if</span> (height &lt; 0) {
00046                 plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o5">cItemFullMax</a> = j;
00047                 <span class="keywordflow">break</span>;
00048             }
00049         }
00050         <span class="keywordflow">if</span> (!plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o5">cItemFullMax</a>)
00051             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o5">cItemFullMax</a> = j;
00052     }
00053 }
00054 
00055 <span class="comment">/***************************************************************************\</span>
00056 <span class="comment">* xxxCreateLBox</span>
00057 <span class="comment">*</span>
00058 <span class="comment">* History:</span>
00059 <span class="comment">* 16-Apr-1992 beng      Added LBS_NODATA</span>
00060 <span class="comment">\***************************************************************************/</span>
00061 
<a name="l00062"></a><a class="code" href="../../d6/d0/usercli_8h.html#a697">00062</a> LONG <a class="code" href="../../d6/d0/usercli_8h.html#a697">xxxLBCreate</a>(
00063     <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> plb, <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, LPCREATESTRUCT lpcs)
00064 {
00065     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> style;
00066     MEASUREITEMSTRUCT measureItemStruct;
00067     <a class="code" href="../../d5/d1/struct__TL.html">TL</a> tlpwndParent;
00068     HDC hdc;
00069 
00070     <span class="comment">/*</span>
00071 <span class="comment">     * Once we make it here, nobody can change the ownerdraw style bits</span>
00072 <span class="comment">     * by calling SetWindowLong. The window style must match the flags in plb</span>
00073 <span class="comment">     *</span>
00074 <span class="comment">     */</span>
00075     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o46">fInitialized</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00076 
00077     style = pwnd-&gt;style;
00078 
00079     <span class="comment">/*</span>
00080 <span class="comment">     * Compatibility hack.</span>
00081 <span class="comment">     */</span>
00082     <span class="keywordflow">if</span> (pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o3">spwndParent</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00083         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1137">_GetDesktopWindow</a>());
00084     <span class="keywordflow">else</span>
00085         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>), <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent));
00086 
00087     <span class="comment">/*</span>
00088 <span class="comment">     * Break out the style bits</span>
00089 <span class="comment">     */</span>
00090     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o19">fRedraw</a> = ((style &amp; LBS_NOREDRAW) == 0);
00091     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o20">fDeferUpdate</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00092     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o23">fNotify</a> = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)((style &amp; LBS_NOTIFY) != 0);
00093     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o39">fVertBar</a> = ((style &amp; WS_VSCROLL) != 0);
00094     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o38">fHorzBar</a> = ((style &amp; WS_HSCROLL) != 0);
00095 
00096     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>)) {
00097         <span class="comment">// for 3.x apps, if either scroll bar was specified, the app got BOTH</span>
00098         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o39">fVertBar</a> || plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o38">fHorzBar</a>)
00099             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o39">fVertBar</a> = plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o38">fHorzBar</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00100     }
00101 
00102     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o48">fRtoLReading</a> = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a625">WEFRTLREADING</a>) != 0);
00103     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o47">fRightAlign</a>  = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a624">WEFRIGHT</a>) != 0);
00104     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o37">fDisableNoScroll</a> = ((style &amp; LBS_DISABLENOSCROLL) != 0);
00105 
00106     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o49">fSmoothScroll</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00107 
00108     <span class="comment">/*</span>
00109 <span class="comment">     * LBS_NOSEL gets priority over any other selection style.  Next highest</span>
00110 <span class="comment">     * priority goes to LBS_EXTENDEDSEL. Then LBS_MULTIPLESEL.</span>
00111 <span class="comment">     */</span>
00112     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>) &amp;&amp; (style &amp; LBS_NOSEL)) {
00113         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o21">wMultiple</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a114">SINGLESEL</a>;
00114         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o41">fNoSel</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00115     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (style &amp; LBS_EXTENDEDSEL) {
00116         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o21">wMultiple</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a116">EXTENDEDSEL</a>;
00117     } <span class="keywordflow">else</span> {
00118         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o21">wMultiple</a> = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>)((style &amp; LBS_MULTIPLESEL) ? <a class="code" href="../../d6/d0/usercli_8h.html#a115">MULTIPLESEL</a> : <a class="code" href="../../d6/d0/usercli_8h.html#a114">SINGLESEL</a>);
00119     }
00120 
00121     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o35">fNoIntegralHeight</a> = ((style &amp; LBS_NOINTEGRALHEIGHT) != 0);
00122     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o36">fWantKeyboardInput</a> = ((style &amp; LBS_WANTKEYBOARDINPUT) != 0);
00123     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o33">fUseTabStops</a> = ((style &amp; LBS_USETABSTOPS) != 0);
00124     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o33">fUseTabStops</a>) {
00125 
00126         <span class="comment">/*</span>
00127 <span class="comment">         * Set tab stops every &lt;default&gt; dialog units.</span>
00128 <span class="comment">         */</span>
00129         <a class="code" href="../../d6/d0/usercli_8h.html#a725">LBSetTabStops</a>(plb, 0, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00130     }
00131     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o34">fMultiColumn</a> = ((style &amp; LBS_MULTICOLUMN) != 0);
00132     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o30">fHasStrings</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00133     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o51">iLastSelection</a> = -1;
00134     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o52">iMouseDown</a> = -1;  <span class="comment">/* Anchor point for multi selection */</span>
00135     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o53">iLastMouseMove</a> = -1;
00136 
00137     <span class="comment">/*</span>
00138 <span class="comment">     * Get ownerdraw style bits</span>
00139 <span class="comment">     */</span>
00140     <span class="keywordflow">if</span> ((style &amp; LBS_OWNERDRAWFIXED)) {
00141         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a62">OWNERDRAWFIXED</a>;
00142     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((style &amp; LBS_OWNERDRAWVARIABLE) &amp;&amp; !plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o34">fMultiColumn</a>) {
00143         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a63">OWNERDRAWVAR</a>;
00144 
00145         <span class="comment">/*</span>
00146 <span class="comment">         * Integral height makes no sense with var height owner draw</span>
00147 <span class="comment">         */</span>
00148         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o35">fNoIntegralHeight</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00149     }
00150 
00151     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a> &amp;&amp; !(style &amp; LBS_HASSTRINGS)) {
00152 
00153         <span class="comment">/*</span>
00154 <span class="comment">         * If owner draw, do they want the listbox to maintain strings?</span>
00155 <span class="comment">         */</span>
00156         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o30">fHasStrings</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00157     }
00158 
00159     <span class="comment">/*</span>
00160 <span class="comment">     * If user specifies sort and not hasstrings, then we will send</span>
00161 <span class="comment">     * WM_COMPAREITEM messages to the parent.</span>
00162 <span class="comment">     */</span>
00163     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o22">fSort</a> = ((style &amp; LBS_SORT) != 0);
00164 
00165     <span class="comment">/*</span>
00166 <span class="comment">     * "No data" lazy-eval listbox mandates certain other style settings</span>
00167 <span class="comment">     */</span>
00168     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o31">fHasData</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00169 
00170     <span class="keywordflow">if</span> (style &amp; LBS_NODATA) {
00171         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a> != <a class="code" href="../../d6/d0/usercli_8h.html#a62">OWNERDRAWFIXED</a> || plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o22">fSort</a> || plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o30">fHasStrings</a>) {
00172             RIPERR0(ERROR_INVALID_FLAGS, RIP_WARNING,
00173                  <span class="stringliteral">"NODATA listbox must be OWNERDRAWFIXED, w/o SORT or HASSTRINGS"</span>);
00174         } <span class="keywordflow">else</span> {
00175             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o31">fHasData</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00176         }
00177     }
00178 
00179     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o60">dwLocaleId</a> = GetThreadLocale();
00180 
00181     <span class="comment">/*</span>
00182 <span class="comment">     * Check if this is part of a combo box</span>
00183 <span class="comment">     */</span>
00184     <span class="keywordflow">if</span> ((style &amp; <a class="code" href="../../d6/d0/usercli_8h.html#a67">LBS_COMBOBOX</a>) != 0) {
00185 
00186         <span class="comment">/*</span>
00187 <span class="comment">         * Get the pcbox structure contained in the parent window's extra data</span>
00188 <span class="comment">         * pointer.  Check cbwndExtra to ensure compatibility with SQL windows.</span>
00189 <span class="comment">         */</span>
00190         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o10">cbwndExtra</a> != 0)
00191             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o58">pcbox</a> = ((<a class="code" href="../../d0/d1/structtagCOMBOWND.html">PCOMBOWND</a>)(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>))-&gt;pcbox;
00192     }
00193 
00194     <span class="comment">/*</span>
00195 <span class="comment">     * No need to set these to 0 since that was done for us when we Alloced</span>
00196 <span class="comment">     * the PLBIV.</span>
00197 <span class="comment">     */</span>
00198 
00199     <span class="comment">/*</span>
00200 <span class="comment">     * plb-&gt;rgpch       = (PBYTE)0;</span>
00201 <span class="comment">     */</span>
00202 
00203     <span class="comment">/*</span>
00204 <span class="comment">     * plb-&gt;iSelBase    = plb-&gt;iTop = 0;</span>
00205 <span class="comment">     */</span>
00206 
00207     <span class="comment">/*</span>
00208 <span class="comment">     * plb-&gt;fMouseDown  = FALSE;</span>
00209 <span class="comment">     */</span>
00210 
00211     <span class="comment">/*</span>
00212 <span class="comment">     * plb-&gt;fCaret      = FALSE;</span>
00213 <span class="comment">     */</span>
00214 
00215     <span class="comment">/*</span>
00216 <span class="comment">     * plb-&gt;fCaretOn    = FALSE;</span>
00217 <span class="comment">     */</span>
00218 
00219     <span class="comment">/*</span>
00220 <span class="comment">     * plb-&gt;maxWidth    = 0;</span>
00221 <span class="comment">     */</span>
00222 
00223     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o3">iSel</a> = -1;
00224 
00225     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o59">hdc</a>        = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00226 
00227     <span class="comment">/*</span>
00228 <span class="comment">     * Set the keyboard state so that when the user keyboard clicks he selects</span>
00229 <span class="comment">     * an item.</span>
00230 <span class="comment">     */</span>
00231     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o32">fNewItemState</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00232 
00233     <a class="code" href="../../d6/d0/usercli_8h.html#a684">InitHStrings</a>(plb);
00234 
00235     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o30">fHasStrings</a> &amp;&amp; plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o9">hStrings</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00236         <span class="keywordflow">return</span> -1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00237     }
00238 
00239     hdc = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a250">NtUserGetDC</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd));
00240     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o12">cxChar</a> = GdiGetCharDimensions(hdc, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, &amp;plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o13">cyChar</a>);
00241     <a class="code" href="../../d6/d0/usercli_8h.html#a211">NtUserReleaseDC</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), hdc);
00242 
00243     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o12">cxChar</a> == 0) {
00244         RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxLBCreate: GdiGetCharDimensions failed"</span>);
00245         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o12">cxChar</a> = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cxSysFontChar;
00246         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o13">cyChar</a> = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cySysFontChar;
00247     }
00248 
00249     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a> == <a class="code" href="../../d6/d0/usercli_8h.html#a62">OWNERDRAWFIXED</a>) {
00250 
00251         <span class="comment">/*</span>
00252 <span class="comment">         * Query for item height only if we are fixed height owner draw.  Note</span>
00253 <span class="comment">         * that we don't care about an item's width for listboxes.</span>
00254 <span class="comment">         */</span>
00255         measureItemStruct.CtlType = ODT_LISTBOX;
00256         measureItemStruct.CtlID = PtrToUlong(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>);
00257 
00258         <span class="comment">/*</span>
00259 <span class="comment">         * System font height is default height</span>
00260 <span class="comment">         */</span>
00261         measureItemStruct.itemHeight = plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o13">cyChar</a>;
00262         measureItemStruct.itemWidth = 0;
00263         measureItemStruct.itemData = 0;
00264 
00265         <span class="comment">/*</span>
00266 <span class="comment">         * IanJa: #ifndef WIN16 (32-bit Windows), plb-&gt;id gets extended</span>
00267 <span class="comment">         * to LONG wParam automatically by the compiler</span>
00268 <span class="comment">         */</span>
00269         <a class="code" href="../../d6/d0/usercli_8h.html#a36">ThreadLock</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>, &amp;tlpwndParent);
00270         <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>), WM_MEASUREITEM,
00271                 measureItemStruct.CtlID,
00272                 (LPARAM)&amp;measureItemStruct);
00273         <a class="code" href="../../d6/d0/usercli_8h.html#a40">ThreadUnlock</a>(&amp;tlpwndParent);
00274 
00275         <span class="comment">/*</span>
00276 <span class="comment">         * Use default height if given 0.  This prevents any possible future</span>
00277 <span class="comment">         * div-by-zero errors.</span>
00278 <span class="comment">         */</span>
00279         <span class="keywordflow">if</span> (measureItemStruct.itemHeight)
00280             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o13">cyChar</a> = measureItemStruct.itemHeight;
00281 
00282 
00283         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o34">fMultiColumn</a>) {
00284 
00285             <span class="comment">/*</span>
00286 <span class="comment">             * Get default column width from measure items struct if we are a</span>
00287 <span class="comment">             * multicolumn listbox.</span>
00288 <span class="comment">             */</span>
00289             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o14">cxColumn</a> = measureItemStruct.itemWidth;
00290         }
00291     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a> == <a class="code" href="../../d6/d0/usercli_8h.html#a63">OWNERDRAWVAR</a>)
00292         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o13">cyChar</a> = 0;
00293 
00294 
00295     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o34">fMultiColumn</a>) {
00296 
00297         <span class="comment">/*</span>
00298 <span class="comment">         * Set these default values till we get the WM_SIZE message and we</span>
00299 <span class="comment">         * calculate them properly.  This is because some people create a</span>
00300 <span class="comment">         * 0 width/height listbox and size it later.  We don't want to have</span>
00301 <span class="comment">         * problems with invalid values in these fields</span>
00302 <span class="comment">         */</span>
00303         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o14">cxColumn</a> &lt;= 0)
00304             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o14">cxColumn</a> = 15 * plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o12">cxChar</a>;
00305         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o16">numberOfColumns</a> = plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o15">itemsPerColumn</a> = 1;
00306     }
00307 
00308     <a class="code" href="../../d6/d0/usercli_8h.html#a688">LBSetCItemFullMax</a>(plb);
00309 
00310     <span class="comment">// Don't do this for 4.0 apps.  It'll make everyone's lives easier and</span>
00311     <span class="comment">// fix the anomaly that a combo &amp; list created the same width end up</span>
00312     <span class="comment">// different when all is done.</span>
00313     <span class="comment">// B#1520</span>
00314 
00315     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>)) {
00316         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o45">fIgnoreSizeMsg</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00317         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a111">NtUserMoveWindow</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd),
00318              lpcs-&gt;x - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER),
00319              lpcs-&gt;y - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER),
00320              lpcs-&gt;cx + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE),
00321              lpcs-&gt;cy + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE),
00322              <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00323         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o45">fIgnoreSizeMsg</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00324     }
00325 
00326     <span class="keywordflow">if</span> (!plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o35">fNoIntegralHeight</a>) {
00327 
00328         <span class="comment">/*</span>
00329 <span class="comment">         * Send a message to ourselves to resize the listbox to an integral</span>
00330 <span class="comment">         * height.  We need to do it this way because at create time we are all</span>
00331 <span class="comment">         * mucked up with window rects etc...</span>
00332 <span class="comment">         * IanJa: #ifndef WIN16 (32-bit Windows), wParam 0 gets extended</span>
00333 <span class="comment">         * to wParam 0L automatically by the compiler.</span>
00334 <span class="comment">         */</span>
00335         <a class="code" href="../../d0/d8/ntcftxt_8h.html#a20">PostMessage</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), WM_SIZE, 0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00336     }
00337 
00338     <span class="keywordflow">return</span> 1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00339 }
00340 
00341 <span class="comment">/***************************************************************************\</span>
00342 <span class="comment">* xxxLBoxDoDeleteItems</span>
00343 <span class="comment">*</span>
00344 <span class="comment">* Send DELETEITEM message for all the items in the ownerdraw listbox.</span>
00345 <span class="comment">*</span>
00346 <span class="comment">* History:</span>
00347 <span class="comment">* 16-Apr-1992 beng          Nodata case</span>
00348 <span class="comment">\***************************************************************************/</span>
00349 
<a name="l00350"></a><a class="code" href="../../d6/d0/usercli_8h.html#a700">00350</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a700">xxxLBoxDoDeleteItems</a>(
00351     <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> plb)
00352 {
00353     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> sItem;
00354 
00355     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>);
00356 
00357     <span class="comment">/*</span>
00358 <span class="comment">     * Send WM_DELETEITEM message for ownerdraw listboxes which are</span>
00359 <span class="comment">     * being deleted.  (NODATA listboxes don't send such, though.)</span>
00360 <span class="comment">     */</span>
00361     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a> &amp;&amp; plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a> &amp;&amp; plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o31">fHasData</a>) {
00362         <span class="keywordflow">for</span> (sItem = plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a> - 1; sItem &gt;= 0; sItem--) {
00363             <a class="code" href="../../d6/d0/usercli_8h.html#a699">xxxLBoxDeleteItem</a>(plb, sItem);
00364         }
00365     }
00366 }
00367 
00368 
00369 <span class="comment">/***************************************************************************\</span>
00370 <span class="comment">* xxxDestroyLBox</span>
00371 <span class="comment">*</span>
00372 <span class="comment">* History:</span>
00373 <span class="comment">\***************************************************************************/</span>
00374 
<a name="l00375"></a><a class="code" href="../../d6/d0/usercli_8h.html#a698">00375</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a698">xxxDestroyLBox</a>(
00376     <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> pLBIV,
00377     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwnd)
00378 {
00379     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndParent;
00380 
00381     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00382 
00383     <span class="keywordflow">if</span> (pLBIV != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00384         <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>);
00385 
00386         <span class="comment">/*</span>
00387 <span class="comment">         * If ownerdraw, send deleteitem messages to parent</span>
00388 <span class="comment">         */</span>
00389         <a class="code" href="../../d6/d0/usercli_8h.html#a700">xxxLBoxDoDeleteItems</a>(pLBIV);
00390 
00391         <span class="keywordflow">if</span> (pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o8">rgpch</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00392             <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o8">rgpch</a>);
00393             pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o8">rgpch</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00394         }
00395 
00396         <span class="keywordflow">if</span> (pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o9">hStrings</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00397             <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o9">hStrings</a>);
00398             pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o9">hStrings</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00399         }
00400 
00401         <span class="keywordflow">if</span> (pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o54">iTabPixelPositions</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00402             <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>((HANDLE)pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o54">iTabPixelPositions</a>);
00403             pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o54">iTabPixelPositions</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00404         }
00405 
00406         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>);
00407         <a class="code" href="../../d6/d0/usercli_8h.html#a42">Unlock</a>(&amp;pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o0">spwndParent</a>);
00408 
00409         <span class="keywordflow">if</span> (pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o62">pszTypeSearch</a>) {
00410             <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(pLBIV-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o62">pszTypeSearch</a>);
00411         }
00412 
00413         <a class="code" href="../../d6/d0/usercli_8h.html#a408">FreeLookasideEntry</a>(&amp;<a class="code" href="../../d6/d1/lb1_8c.html#a0">ListboxLookaside</a>, pLBIV);
00414     }
00415 
00416     <span class="comment">/*</span>
00417 <span class="comment">     * Set the window's fnid status so that we can ignore rogue messages</span>
00418 <span class="comment">     */</span>
00419     <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a284">NtUserSetWindowFNID</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a226">FNID_CLEANEDUP_BIT</a>);
00420 
00421     <span class="comment">/*</span>
00422 <span class="comment">     * If we're part of a combo box, let it know we're gone</span>
00423 <span class="comment">     */</span>
00424     pwndParent = <a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent);
00425     <span class="keywordflow">if</span> (pwndParent &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwndParent) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a201">FNID_COMBOBOX</a>) {
00426         <a class="code" href="../../d6/d0/usercli_8h.html#a614">ComboBoxWndProcWorker</a>(pwndParent, WM_PARENTNOTIFY,
00427                 MAKELONG(WM_DESTROY, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o16">spmenu</a>)), (LPARAM)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(pwnd), <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00428     }
00429 }
00430 
00431 
00432 <span class="comment">/***************************************************************************\</span>
00433 <span class="comment">* xxxLBSetFont</span>
00434 <span class="comment">*</span>
00435 <span class="comment">* History:</span>
00436 <span class="comment">\***************************************************************************/</span>
00437 
<a name="l00438"></a><a class="code" href="../../d6/d0/usercli_8h.html#a723">00438</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a723">xxxLBSetFont</a>(
00439     <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> plb,
00440     HANDLE hFont,
00441     BOOL fRedraw)
00442 {
00443     HDC     hdc;
00444     HANDLE  hOldFont = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00445     <span class="keywordtype">int</span>     iHeight;
00446 
00447     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>);
00448 
00449     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o55">hFont</a> = hFont;
00450 
00451     hdc = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a250">NtUserGetDC</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>));
00452 
00453     <span class="keywordflow">if</span> (hFont) {
00454         hOldFont = SelectObject(hdc, hFont);
00455         <span class="keywordflow">if</span> (!hOldFont) {
00456             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o55">hFont</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00457         }
00458     }
00459 
00460     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o12">cxChar</a> = GdiGetCharDimensions(hdc, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, &amp;iHeight);
00461     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o12">cxChar</a> == 0) {
00462         RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxLBSetFont: GdiGetCharDimensions failed"</span>);
00463         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o12">cxChar</a> = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cxSysFontChar;
00464         iHeight = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cySysFontChar;
00465     }
00466 
00467 
00468     <span class="keywordflow">if</span> (!plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a> &amp;&amp; (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o13">cyChar</a> != iHeight)) {
00469 
00470         <span class="comment">/*</span>
00471 <span class="comment">         * We don't want to mess up the cyChar height for owner draw listboxes</span>
00472 <span class="comment">         * so don't do this.</span>
00473 <span class="comment">         */</span>
00474         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o13">cyChar</a> = iHeight;
00475 
00476         <span class="comment">/*</span>
00477 <span class="comment">         * Only resize the listbox for 4.0 dudes, or combo dropdowns.</span>
00478 <span class="comment">         * Macromedia Director 4.0 GP-faults otherwise.</span>
00479 <span class="comment">         */</span>
00480         <span class="keywordflow">if</span> (!plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o35">fNoIntegralHeight</a> &amp;&amp;
00481                 (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o58">pcbox</a> || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a>))) {
00482             <a class="code" href="../../d6/d0/usercli_8h.html#a726">xxxLBSize</a>(plb,
00483                 plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.right  - plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.left,
00484                 plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.bottom - plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o7">rcClient</a>.top);
00485         }
00486     }
00487 
00488     <span class="keywordflow">if</span> (hOldFont) {
00489         SelectObject(hdc, hOldFont);
00490     }
00491 
00492     <span class="comment">/*</span>
00493 <span class="comment">     * IanJa: was ReleaseDC(hwnd, hdc);</span>
00494 <span class="comment">     */</span>
00495     <a class="code" href="../../d6/d0/usercli_8h.html#a211">NtUserReleaseDC</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>), hdc);
00496 
00497     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o34">fMultiColumn</a>) {
00498         <a class="code" href="../../d6/d0/usercli_8h.html#a743">LBCalcItemRowsAndColumns</a>(plb);
00499     }
00500 
00501     <a class="code" href="../../d6/d0/usercli_8h.html#a688">LBSetCItemFullMax</a>(plb);
00502 
00503     <span class="keywordflow">if</span> (fRedraw)
00504         <a class="code" href="../../d6/d0/usercli_8h.html#a714">xxxCheckRedraw</a>(plb, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>, 0);
00505 }
00506 
00507 
00508 <span class="comment">/***************************************************************************\</span>
00509 <span class="comment">* xxxLBSize</span>
00510 <span class="comment">*</span>
00511 <span class="comment">* History:</span>
00512 <span class="comment">\***************************************************************************/</span>
00513 
<a name="l00514"></a><a class="code" href="../../d6/d0/usercli_8h.html#a726">00514</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a726">xxxLBSize</a>(
00515     <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> plb,
00516     INT cx,
00517     INT cy)
00518 {
00519     RECT rc;
00520     <span class="keywordtype">int</span> iTopOld;
00521     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fSizedSave;
00522 
00523     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>);
00524 
00525     <span class="keywordflow">if</span> (!plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o35">fNoIntegralHeight</a>) {
00526         <span class="keywordtype">int</span> cBdrs = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a7">GetWindowBorders</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>-&gt;style, plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>-&gt;ExStyle, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00527 
00528         <a class="code" href="../../d3/d6/rect_8c.html#a2">CopyInflateRect</a>(&amp;rc, &amp;plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>, 0, -cBdrs * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
00529 
00530         <span class="comment">// Size the listbox to fit an integral # of items in its client</span>
00531         <span class="keywordflow">if</span> ((rc.bottom - rc.top) % plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o13">cyChar</a>) {
00532             <span class="keywordtype">int</span> iItems = (rc.bottom - rc.top);
00533 
00534             <span class="comment">// B#2285 - If its a 3.1 app its SetWindowPos needs</span>
00535             <span class="comment">// to be window based dimensions not Client !</span>
00536             <span class="comment">// this crunches Money into using a scroll bar</span>
00537 
00538             <span class="keywordflow">if</span> ( ! <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>( plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a593">WFWIN40COMPAT</a> ) )
00539                 iItems += (cBdrs * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE)); <span class="comment">// so add it back in</span>
00540 
00541             iItems /= plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o13">cyChar</a>;
00542 
00543             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a115">NtUserSetWindowPos</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>), HWND_TOP, 0, 0, rc.right - rc.left,
00544                     iItems * plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o13">cyChar</a> + (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE) * cBdrs),
00545                     SWP_NOACTIVATE | SWP_NOMOVE | SWP_NOZORDER);
00546 
00547             <span class="comment">/*</span>
00548 <span class="comment">             * Changing the size causes us to recurse.  Upon return</span>
00549 <span class="comment">             * the state is where it should be and nothing further</span>
00550 <span class="comment">             * needs to be done.</span>
00551 <span class="comment">             */</span>
00552             <span class="keywordflow">return</span>;
00553         }
00554     }
00555 
00556     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o34">fMultiColumn</a>) {
00557 
00558         <span class="comment">/*</span>
00559 <span class="comment">         * Compute the number of DISPLAYABLE rows and columns in the listbox</span>
00560 <span class="comment">         */</span>
00561         <a class="code" href="../../d6/d0/usercli_8h.html#a743">LBCalcItemRowsAndColumns</a>(plb);
00562     } <span class="keywordflow">else</span> {
00563 
00564         <span class="comment">/*</span>
00565 <span class="comment">         * Adjust the current horizontal position to eliminate as much</span>
00566 <span class="comment">         * empty space as possible from the right side of the items.</span>
00567 <span class="comment">         */</span>
00568         <a class="code" href="../../d6/d9/rtl_2wow_8c.html#a19">_GetClientRect</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>, &amp;rc);
00569         <span class="keywordflow">if</span> ((plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o57">maxWidth</a> - plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o56">xOrigin</a>) &lt; (rc.right - rc.left))
00570             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o56">xOrigin</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>(0, plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o57">maxWidth</a> - (rc.right - rc.left));
00571     }
00572 
00573     <a class="code" href="../../d6/d0/usercli_8h.html#a688">LBSetCItemFullMax</a>(plb);
00574 
00575     <span class="comment">/*</span>
00576 <span class="comment">     * Adjust the top item in the listbox to eliminate as much empty space</span>
00577 <span class="comment">     * after the last item as possible</span>
00578 <span class="comment">     * (fix for bugs #8490 &amp; #3836)</span>
00579 <span class="comment">     */</span>
00580     iTopOld = plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o2">iTop</a>;
00581     fSizedSave = plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o44">fSized</a>;
00582     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o44">fSized</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00583     <a class="code" href="../../d6/d0/usercli_8h.html#a730">xxxNewITop</a>(plb, plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o2">iTop</a>);
00584 
00585     <span class="comment">/*</span>
00586 <span class="comment">     * If changing the top item index caused a resize, there is no</span>
00587 <span class="comment">     * more work to be done here.</span>
00588 <span class="comment">     */</span>
00589     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o44">fSized</a>)
00590         <span class="keywordflow">return</span>;
00591     plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o44">fSized</a> = fSizedSave;
00592 
00593     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a108">IsLBoxVisible</a>(plb)) {
00594         <span class="comment">/*</span>
00595 <span class="comment">         * This code no longer blows because it's fixed right!!!  We could</span>
00596 <span class="comment">         * optimize the fMultiColumn case with some more code to figure out</span>
00597 <span class="comment">         * if we really need to invalidate the whole thing but note that some</span>
00598 <span class="comment">         * 3.0 apps depend on this extra invalidation (AMIPRO 2.0, bug 14620)</span>
00599 <span class="comment">         *</span>
00600 <span class="comment">         * For 3.1 apps, we blow off the invalidaterect in the case where</span>
00601 <span class="comment">         * cx and cy are 0 because this happens during the processing of</span>
00602 <span class="comment">         * the posted WM_SIZE message when we are created which would otherwise</span>
00603 <span class="comment">         * cause us to flash.</span>
00604 <span class="comment">         */</span>
00605         <span class="keywordflow">if</span> ((plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o34">fMultiColumn</a> &amp;&amp; !(cx == 0 &amp;&amp; <a class="code" href="../../d1/d1/inctlpan_8c.html#a3">cy</a> == 0)) ||
00606                 plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o2">iTop</a> != iTopOld)
00607             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>), <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00608         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o4">iSelBase</a> &gt;= 0) {
00609 
00610             <span class="comment">/*</span>
00611 <span class="comment">             * Invalidate the item with the caret so that if the listbox</span>
00612 <span class="comment">             * grows horizontally, we redraw it properly.</span>
00613 <span class="comment">             */</span>
00614             <a class="code" href="../../d6/d0/usercli_8h.html#a744">LBGetItemRect</a>(plb, plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o4">iSelBase</a>, &amp;rc);
00615             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a206">NtUserInvalidateRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a451">HWq</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>), &amp;rc, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00616         }
00617     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o19">fRedraw</a>)
00618         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o20">fDeferUpdate</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00619 
00620     <span class="comment">/*</span>
00621 <span class="comment">     * Send "fake" scroll bar messages to update the scroll positions since we</span>
00622 <span class="comment">     * changed size.</span>
00623 <span class="comment">     */</span>
00624     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a641">WFVSCROLL</a>)) {
00625         <a class="code" href="../../d6/d0/usercli_8h.html#a705">xxxLBoxCtlScroll</a>(plb, SB_ENDSCROLL, 0);
00626     }
00627 
00628     <span class="comment">/*</span>
00629 <span class="comment">     * We count on this to call LBShowHideScrollBars except when plb-&gt;cMac == 0!</span>
00630 <span class="comment">     */</span>
00631     <a class="code" href="../../d6/d0/usercli_8h.html#a703">xxxLBoxCtlHScroll</a>(plb, SB_ENDSCROLL, 0);
00632 
00633     <span class="comment">/*</span>
00634 <span class="comment">     * Show/hide scroll bars depending on how much stuff is visible...</span>
00635 <span class="comment">     *</span>
00636 <span class="comment">     * Note:  Now we only call this guy when cMac == 0, because it is</span>
00637 <span class="comment">     * called inside the LBoxCtlHScroll with SB_ENDSCROLL otherwise.</span>
00638 <span class="comment">     */</span>
00639     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a> == 0)
00640         <a class="code" href="../../d6/d0/usercli_8h.html#a706">xxxLBShowHideScrollBars</a>(plb);
00641 }
00642 
00643 
00644 <span class="comment">/***************************************************************************\</span>
00645 <span class="comment">* LBSetTabStops</span>
00646 <span class="comment">*</span>
00647 <span class="comment">* Sets the tab stops for this listbox. Returns TRUE if successful else FALSE.</span>
00648 <span class="comment">*</span>
00649 <span class="comment">* History:</span>
00650 <span class="comment">\***************************************************************************/</span>
00651 
<a name="l00652"></a><a class="code" href="../../d6/d0/usercli_8h.html#a725">00652</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d6/d0/usercli_8h.html#a725">LBSetTabStops</a>(
00653     <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> plb,
00654     INT count,
00655     LPINT lptabstops)
00656 {
00657     <a class="code" href="../../d9/d5/ndismain_8h.html#a264">PINT</a> ptabs;
00658 
00659     <span class="keywordflow">if</span> (!plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o33">fUseTabStops</a>) {
00660         RIPERR0(ERROR_LB_WITHOUT_TABSTOPS, RIP_VERBOSE, <span class="stringliteral">""</span>);
00661         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00662     }
00663 
00664     <span class="keywordflow">if</span> (count) {
00665         <span class="comment">/*</span>
00666 <span class="comment">         * Allocate memory for the tab stops.  The first byte in the</span>
00667 <span class="comment">         * plb-&gt;iTabPixelPositions array will contain a count of the number</span>
00668 <span class="comment">         * of tab stop positions we have.</span>
00669 <span class="comment">         */</span>
00670         ptabs = (LPINT)<a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(HEAP_ZERO_MEMORY, (count + 1) * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
00671         <span class="keywordflow">if</span> (ptabs == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00672             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00673 
00674         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o54">iTabPixelPositions</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00675             <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o54">iTabPixelPositions</a>);
00676         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o54">iTabPixelPositions</a> = ptabs;
00677 
00678         <span class="comment">/*</span>
00679 <span class="comment">         * Set the count of tab stops</span>
00680 <span class="comment">         */</span>
00681         *ptabs++ = count;
00682 
00683         <span class="keywordflow">for</span> (; count &gt; 0; count--) {
00684 
00685             <span class="comment">/*</span>
00686 <span class="comment">             * Convert the dialog unit tabstops into pixel position tab stops.</span>
00687 <span class="comment">             */</span>
00688             *ptabs++ = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(*lptabstops, plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o12">cxChar</a>, 4);
00689             lptabstops++;
00690         }
00691     } <span class="keywordflow">else</span> {
00692 
00693         <span class="comment">/*</span>
00694 <span class="comment">         * Set default 8 system font ave char width tabs.  So free the memory</span>
00695 <span class="comment">         * associated with the tab stop list.</span>
00696 <span class="comment">         */</span>
00697         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o54">iTabPixelPositions</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00698             <a class="code" href="../../d6/d0/usercli_8h.html#a138">UserLocalFree</a>((HANDLE)plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o54">iTabPixelPositions</a>);
00699             plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o54">iTabPixelPositions</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00700         }
00701     }
00702 
00703     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00704 }
00705 
00706 
00707 <span class="comment">/***************************************************************************\</span>
00708 <span class="comment">* InitHStrings</span>
00709 <span class="comment">*</span>
00710 <span class="comment">* History:</span>
00711 <span class="comment">\***************************************************************************/</span>
00712 
<a name="l00713"></a><a class="code" href="../../d6/d0/usercli_8h.html#a684">00713</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a684">InitHStrings</a>(
00714     <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> plb)
00715 {
00716     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o30">fHasStrings</a>) {
00717         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o11">ichAlloc</a> = 0;
00718         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o10">cchStrings</a> = 0;
00719         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o9">hStrings</a> = <a class="code" href="../../d6/d0/usercli_8h.html#a136">UserLocalAlloc</a>(0, 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>);
00720     }
00721 }
00722 
00723 
00724 <span class="comment">/***************************************************************************\</span>
00725 <span class="comment">* LBDropObjectHandler</span>
00726 <span class="comment">*</span>
00727 <span class="comment">* Handles a WM_DROPITEM message on this listbox</span>
00728 <span class="comment">*</span>
00729 <span class="comment">* History:</span>
00730 <span class="comment">\***************************************************************************/</span>
00731 
<a name="l00732"></a><a class="code" href="../../d6/d0/usercli_8h.html#a720">00732</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a720">LBDropObjectHandler</a>(
00733     <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> plb,
00734     PDROPSTRUCT pds)
00735 {
00736     LONG mouseSel;
00737 
00738     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a686">ISelFromPt</a>(plb, pds-&gt;ptDrop, &amp;mouseSel)) {
00739 
00740         <span class="comment">/*</span>
00741 <span class="comment">         * User dropped in empty space at bottom of listbox</span>
00742 <span class="comment">         */</span>
00743         pds-&gt;dwControlData = (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)-1<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00744     } <span class="keywordflow">else</span> {
00745         pds-&gt;dwControlData = mouseSel;
00746     }
00747 }
00748 
00749 
00750 <span class="comment">/***************************************************************************\</span>
00751 <span class="comment">* LBGetSetItemHeightHandler()</span>
00752 <span class="comment">*</span>
00753 <span class="comment">* Sets/Gets the height associated with each item.  For non ownerdraw</span>
00754 <span class="comment">* and fixed height ownerdraw, the item number is ignored.</span>
00755 <span class="comment">*</span>
00756 <span class="comment">* History:</span>
00757 <span class="comment">\***************************************************************************/</span>
00758 
<a name="l00759"></a><a class="code" href="../../d6/d0/usercli_8h.html#a719">00759</a> <span class="keywordtype">int</span> <a class="code" href="../../d6/d0/usercli_8h.html#a719">LBGetSetItemHeightHandler</a>(
00760     <a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> plb,
00761     UINT message,
00762     <span class="keywordtype">int</span> item,
00763     UINT height)
00764 {
00765     <span class="keywordflow">if</span> (message == LB_GETITEMHEIGHT) {
00766         <span class="comment">/*</span>
00767 <span class="comment">         * All items are same height for non ownerdraw and for fixed height</span>
00768 <span class="comment">         * ownerdraw.</span>
00769 <span class="comment">         */</span>
00770         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a> != <a class="code" href="../../d6/d0/usercli_8h.html#a63">OWNERDRAWVAR</a>)
00771             <span class="keywordflow">return</span> plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o13">cyChar</a>;
00772 
00773         <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a> &amp;&amp; item &gt;= plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a>) {
00774             RIPERR0(ERROR_INVALID_INDEX, RIP_VERBOSE, <span class="stringliteral">""</span>);
00775             <span class="keywordflow">return</span> LB_ERR;
00776         }
00777 
00778         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)<a class="code" href="../../d6/d0/usercli_8h.html#a746">LBGetVariableHeightItemHeight</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)item);
00779     }
00780 
00781     <span class="keywordflow">if</span> (!height || height &gt; 255) {
00782         RIPERR1(ERROR_INVALID_PARAMETER,
00783                 RIP_WARNING,
00784                 <span class="stringliteral">"Invalid parameter \"height\" (%ld) to LBGetSetItemHeightHandler"</span>,
00785                 height);
00786 
00787         <span class="keywordflow">return</span> LB_ERR;
00788     }
00789 
00790     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o18">OwnerDraw</a> != <a class="code" href="../../d6/d0/usercli_8h.html#a63">OWNERDRAWVAR</a>)
00791         plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o13">cyChar</a> = height;
00792     <span class="keywordflow">else</span> {
00793         <span class="keywordflow">if</span> (item &lt; 0 || item &gt;= plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o6">cMac</a>) {
00794             RIPERR1(ERROR_INVALID_PARAMETER,
00795                     RIP_WARNING,
00796                     <span class="stringliteral">"Invalid parameter \"item\" (%ld) to LBGetSetItemHeightHandler"</span>,
00797                     item);
00798 
00799             <span class="keywordflow">return</span> LB_ERR;
00800         }
00801 
00802         <a class="code" href="../../d6/d0/usercli_8h.html#a745">LBSetVariableHeightItemHeight</a>(plb, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)item, (<a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>)height);
00803     }
00804 
00805     <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o34">fMultiColumn</a>)
00806         <a class="code" href="../../d6/d0/usercli_8h.html#a743">LBCalcItemRowsAndColumns</a>(plb);
00807 
00808     <a class="code" href="../../d6/d0/usercli_8h.html#a688">LBSetCItemFullMax</a>(plb);
00809 
00810     <span class="keywordflow">return</span>(0);
00811 }
00812 
00813 <span class="comment">/*****************************************************************************\</span>
00814 <span class="comment">*</span>
00815 <span class="comment">* LBEvent()</span>
00816 <span class="comment">*</span>
00817 <span class="comment">* This is for item focus &amp; selection events in listboxes.</span>
00818 <span class="comment">*</span>
00819 <span class="comment">\*****************************************************************************/</span>
<a name="l00820"></a><a class="code" href="../../d6/d0/usercli_8h.html#a409">00820</a> <span class="keywordtype">void</span> <a class="code" href="../../d6/d0/usercli_8h.html#a409">LBEvent</a>(<a class="code" href="../../d7/d9/structtagLBIV.html">PLBIV</a> plb, UINT uEvent, <span class="keywordtype">int</span> iItem)
00821 {
00822     UserAssert(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>());
00823 
00824     <span class="keywordflow">switch</span> (uEvent) {
00825         <span class="keywordflow">case</span> EVENT_OBJECT_SELECTIONREMOVE:
00826             <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o21">wMultiple</a> != <a class="code" href="../../d6/d0/usercli_8h.html#a114">SINGLESEL</a>) {
00827                 <span class="keywordflow">break</span>;
00828             }
00829             iItem = -1;
00830             <span class="comment">//</span>
00831             <span class="comment">// FALL THRU</span>
00832             <span class="comment">//</span>
00833 
00834         <span class="keywordflow">case</span> EVENT_OBJECT_SELECTIONADD:
00835             <span class="keywordflow">if</span> (plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o21">wMultiple</a> == <a class="code" href="../../d6/d0/usercli_8h.html#a115">MULTIPLESEL</a>) {
00836                 uEvent = EVENT_OBJECT_SELECTION;
00837             }
00838             <span class="keywordflow">break</span>;
00839 
00840         <span class="keywordflow">case</span> EVENT_OBJECT_SELECTIONWITHIN:
00841             iItem = -1;
00842             <span class="keywordflow">break</span>;
00843     }
00844 
00845     <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a12">NotifyWinEvent</a>(uEvent, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(plb-&gt;<a class="code" href="../../d7/d9/structtagLBIV.html#o1">spwnd</a>), OBJID_CLIENT, iItem+1);
00846 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:37 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
