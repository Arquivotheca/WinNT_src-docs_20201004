<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: layime.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>layime.c File Reference</h1><code>#include "<a class="el" href="../../d9/d2/w32_2ntuser_2imm_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d4/d0/layime_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a0">VERSION_DLL</a>&nbsp;&nbsp;&nbsp;TEXT("version.dll")</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a1">VER_FILE_VERSION</a>&nbsp;&nbsp;&nbsp;TEXT("FileVersion")</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a2">SZ_BACKSLASH</a>&nbsp;&nbsp;&nbsp;TEXT("\\")</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a3">WCHAR_BACKSLASH</a>&nbsp;&nbsp;&nbsp;L'\\'</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a4">WCHAR_NULL</a>&nbsp;&nbsp;&nbsp;L'\0'</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a5">VERSION_GetFileVersionInfoW</a>&nbsp;&nbsp;&nbsp;"GetFileVersionInfoW"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a6">VERSION_GetFileVersionInfoSizeW</a>&nbsp;&nbsp;&nbsp;"GetFileVersionInfoSizeW"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a7">VERSION_VerQueryValueW</a>&nbsp;&nbsp;&nbsp;"VerQueryValueW"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a8">GET_PROC</a>(x)</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOL(WINAPI *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a9">LPFNGETFILEVERSIONINFOW</a> )(PWSTR, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>(WINAPI *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a10">LPFNGETFILEVERSIONINFOSIZEW</a> )(PWSTR, LPDWORD)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef BOOL(WINAPI *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a11">LPFNVERQUERYVALUEW</a> )(const <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>, PWSTR, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> *, LPDWORD)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VS_FIXEDFILEINFO *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a12">PFIXEDFILEINFO</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a16">ImmLoadLayout</a> (HKL hKL, <a class="el" href="../../d0/d8/structtagIMEINFOEX.html">PIMEINFOEX</a> piiex)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a17">GetSystemPathName</a> (PWSTRpwszPath, PWSTR pwszFileName, UINT maxChar)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d1/bench_8h.html#a7">INT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a18">ExtractColumn</a> (LPWSTR lpSrc, WCHAR cSeparator, UINT uiColumn)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PWSTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a19">GetVersionDatum</a> (PWSTR pszVersionBuffer, PWSTR pszVersionKey, PWSTR pszName)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a20">LoadFixVersionInfo</a> (<a class="el" href="../../d0/d8/structtagIMEINFOEX.html">PIMEINFOEX</a> piiex, PWSTR pszVersionBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a21">LoadVarVersionInfo</a> (<a class="el" href="../../d0/d8/structtagIMEINFOEX.html">PIMEINFOEX</a> piiex, PWSTR pszVersionBuffer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a22">LoadVersionInfo</a> (<a class="el" href="../../d0/d8/structtagIMEINFOEX.html">PIMEINFOEX</a> piiex)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d1/layime_8c.html#a9">LPFNGETFILEVERSIONINFOW</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a13">pfnGetFileVersionInfoW</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d1/layime_8c.html#a10">LPFNGETFILEVERSIONINFOSIZEW</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a14">pfnGetFileVersionInfoSizeW</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d1/layime_8c.html#a11">LPFNVERQUERYVALUEW</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/layime_8c.html#a15">pfnVerQueryValueW</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a8" doxytag="layime.c::GET_PROC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define GET_PROC          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">x&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><span class="keywordflow">if</span> (!(pfn##x = (PVOID) GetProcAddress(hVersion, VERSION_##x))) { \
        <span class="keywordflow">goto</span> LoadVerInfoUnload; }
</div></pre>
<p>
Referenced by <a class="el" href="../../d5/d0/layout_8c-source.html#l00516">CopyImeFile()</a>, and <a class="el" href="../../d4/d0/layime_8c-source.html#l00305">LoadVersionInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="layime.c::SZ_BACKSLASH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SZ_BACKSLASH&nbsp;&nbsp;&nbsp;TEXT("\\")          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00019">19</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/layime_8c-source.html#l00204">LoadFixVersionInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="layime.c::VER_FILE_VERSION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VER_FILE_VERSION&nbsp;&nbsp;&nbsp;TEXT("FileVersion")          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00017">17</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="layime.c::VERSION_DLL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VERSION_DLL&nbsp;&nbsp;&nbsp;TEXT("version.dll")          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00016">16</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/layime_8c-source.html#l00305">LoadVersionInfo()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="layime.c::VERSION_GetFileVersionInfoSizeW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VERSION_GetFileVersionInfoSizeW&nbsp;&nbsp;&nbsp;"GetFileVersionInfoSizeW"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00025">25</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="layime.c::VERSION_GetFileVersionInfoW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VERSION_GetFileVersionInfoW&nbsp;&nbsp;&nbsp;"GetFileVersionInfoW"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00024">24</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="layime.c::VERSION_VerQueryValueW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define VERSION_VerQueryValueW&nbsp;&nbsp;&nbsp;"VerQueryValueW"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00026">26</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="layime.c::WCHAR_BACKSLASH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define WCHAR_BACKSLASH&nbsp;&nbsp;&nbsp;L'\\'          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00021">21</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="layime.c::WCHAR_NULL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define WCHAR_NULL&nbsp;&nbsp;&nbsp;L'\0'          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00022">22</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a10" doxytag="layime.c::LPFNGETFILEVERSIONINFOSIZEW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>(WINAPI * <a class="el" href="../../d3/d1/layime_8c.html#a10">LPFNGETFILEVERSIONINFOSIZEW</a>)(PWSTR, LPDWORD)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00029">29</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="layime.c::LPFNGETFILEVERSIONINFOW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOL(WINAPI * <a class="el" href="../../d3/d1/layime_8c.html#a9">LPFNGETFILEVERSIONINFOW</a>)(PWSTR, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00028">28</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="layime.c::LPFNVERQUERYVALUEW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef BOOL(WINAPI * <a class="el" href="../../d3/d1/layime_8c.html#a11">LPFNVERQUERYVALUEW</a>)(const <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>, PWSTR, <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> *, LPDWORD)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00030">30</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="layime.c::PFIXEDFILEINFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VS_FIXEDFILEINFO* <a class="el" href="../../d3/d1/layime_8c.html#a12">PFIXEDFILEINFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00031">31</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/layime_8c-source.html#l00204">LoadFixVersionInfo()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a18" doxytag="layime.c::ExtractColumn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d1/bench_8h.html#a7">INT</a> ExtractColumn           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>WCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>cSeparator</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uiColumn</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00115">115</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.
<p>
References <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00025">INT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00225">RtlUnicodeStringToInteger()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
<pre class="fragment"><div>00123                    :
00124 
00125 
00126 Arguments:
00127 
00128     lpSrc - <span class="stringliteral">"YYYY.MM.DD"</span> or <span class="stringliteral">"HH:MM:SS"</span> or <span class="stringliteral">"MM.NN"</span> pointer
00129 
00130 Return Value:
00131 
00132     packed <span class="keywordtype">int</span>
00133 
00134 --*/
00135 
00136 {
00137     UNICODE_STRING uStr;
00138     WCHAR *pSep, *pStr;
00139     <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> i;
00140 
00141     <span class="keywordflow">if</span> (!lpSrc) {
00142         <span class="keywordflow">return</span> 0;
00143     }
00144 
00145     pStr = pSep = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00146 
00147     <span class="keywordflow">while</span> (uiColumn--) {
00148         pStr = lpSrc;
00149 
00150         <span class="keywordflow">while</span> (*lpSrc &amp;&amp; *lpSrc != cSeparator) {
00151             lpSrc++;
00152         }
00153 
00154         <span class="keywordflow">if</span> (*lpSrc == cSeparator) {
00155             pSep = lpSrc;
00156             lpSrc++;
00157         }
00158     }
00159 
00160     <span class="keywordflow">if</span> (pStr) {
00161         <span class="keywordflow">if</span> (pSep) {
00162             *pSep = TEXT(<span class="charliteral">'\0'</span>);
00163             uStr.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)((pSep - pStr) * <span class="keyword">sizeof</span>(WCHAR));
00164         }
00165         <span class="keywordflow">else</span> {
00166             uStr.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(((lpSrc - pStr) + 1) * <span class="keyword">sizeof</span>(WCHAR));
00167         }
00168         uStr.Buffer = pStr;
00169         uStr.MaximumLength = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(uStr.Length + <span class="keyword">sizeof</span>(WCHAR));
00170         <a class="code" href="../../d9/d3/cnvint_8c.html#a4">RtlUnicodeStringToInteger</a>(&amp;uStr, 0, &amp;i);
00171         <span class="keywordflow">if</span> (pSep) {
00172             *pSep = cSeparator;
00173         }
00174     } <span class="keywordflow">else</span> {
00175         i = 0;
00176     }
00177 
00178     <span class="keywordflow">return</span> i;
00179 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="layime.c::GetSystemPathName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID GetSystemPathName           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwszPath</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pwszFileName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>maxChar</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00095">95</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.
<p>
References <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d5/d0/layout_8c-source.html#l00516">CopyImeFile()</a>, <a class="el" href="../../d5/d0/layout_8c-source.html#l00266">ImmInstallIMEW()</a>, <a class="el" href="../../d7/d9/immime_8c-source.html#l00131">LoadIME()</a>, and <a class="el" href="../../d4/d0/layime_8c-source.html#l00305">LoadVersionInfo()</a>.
<p>
<pre class="fragment"><div>00096 {
00097     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> fnLen = wcslen(pwszFileName);
00098     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> i = GetSystemDirectoryW(pwszPath, maxChar);
00099 
00100     UserAssert(fnLen + 1 &lt; maxChar);
00101     <span class="comment">// avoid error condition</span>
00102     <span class="keywordflow">if</span> (fnLen + 1 &gt;= maxChar) {
00103         *pwszPath = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00104         <span class="keywordflow">return</span>;
00105     }
00106     <span class="keywordflow">if</span> (i &gt; 0 || i &lt; maxChar - fnLen - 1) {
00107         pwszPath += i;
00108         <span class="keywordflow">if</span> (pwszPath[-1] != <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\\'</span>)
00109             *pwszPath++ = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\\'</span>;
00110     }
00111     wcscpy(pwszPath, pwszFileName);
00112 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="layime.c::GetVersionDatum" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PWSTR GetVersionDatum           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszVersionBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszVersionKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00182">182</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/layime_8c-source.html#l00238">LoadVarVersionInfo()</a>.
<p>
<pre class="fragment"><div>00186 {
00187     ULONG ulSize;
00188     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cbValue = 0;
00189     PWSTR pValue;
00190 
00191     ulSize = wcslen(pszVersionKey);
00192     wcscat(pszVersionKey, pszName);
00193 
00194     (*pfnVerQueryValueW)(pszVersionBuffer,
00195                           pszVersionKey,
00196                           (<a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a>*)&amp;pValue,
00197                           &amp;cbValue);
00198 
00199     pszVersionKey[ulSize] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00200     <span class="keywordflow">return</span> (cbValue != 0) ? pValue : (PWSTR)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00201 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="layime.c::ImmLoadLayout" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ImmLoadLayout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKL&nbsp;</td>
          <td class="mdname" nowrap> <em>hKL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d8/structtagIMEINFOEX.html">PIMEINFOEX</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>piiex</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00038">38</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00105">tagIMEINFOEX::fLoadFlag</a>, <a class="el" href="../../d3/d5/ntuser_2imm_2globals_8c-source.html#l00045">gszRegKbdLayout</a>, <a class="el" href="../../d3/d5/ntuser_2imm_2globals_8c-source.html#l00051">gszValImeFile</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00100">tagIMEINFOEX::hkl</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00065">IM_FILE_SIZE</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00060">IMEF_NONLOAD</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d4/d0/layime_8c-source.html#l00305">LoadVersionInfo()</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d0/d3/cnvint_8c-source.html#l00433">RtlIntegerToUnicodeString()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00109">tagIMEINFOEX::wszImeFile</a>.
<p>
Referenced by <a class="el" href="../../d3/d0/fareast_8c-source.html#l00238">_InitializeImmEntryTable()</a>.
<p>
<pre class="fragment"><div>00041 {
00042     UNICODE_STRING strIme;
00043     WCHAR    wszIme[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00044     HKEY     hKeyKbdLayout, hKeyIme;
00045     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00046     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>    dwTmp;
00047     LONG     lRet;
00048 
00049     strIme.Buffer = wszIme;
00050     strIme.MaximumLength = <span class="keyword">sizeof</span>(wszIme);
00051 
00052     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d3/cnvint_8c.html#a6">RtlIntegerToUnicodeString</a>(HandleToUlong(hKL), 16, &amp;strIme);
00053     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00054         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00055     }
00056 
00057     lRet = RegOpenKey(HKEY_LOCAL_MACHINE, gszRegKbdLayout, &amp;hKeyKbdLayout);
00058     <span class="keywordflow">if</span> ( lRet != ERROR_SUCCESS ) {
00059         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00060     }
00061 
00062     lRet = RegOpenKey(hKeyKbdLayout, strIme.Buffer, &amp;hKeyIme);
00063     <span class="keywordflow">if</span> ( lRet != ERROR_SUCCESS ) {
00064         RegCloseKey(hKeyKbdLayout);
00065         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00066     }
00067 
00068     dwTmp = <a class="code" href="../../d8/d0/immstruc_8h.html#a22">IM_FILE_SIZE</a>;
00069     lRet = RegQueryValueEx(hKeyIme,
00070                            gszValImeFile,
00071                            NULL,
00072                            NULL,
00073                            (LPBYTE)piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o9">wszImeFile</a>,
00074                            &amp;dwTmp);
00075 
00076     <span class="keywordflow">if</span> ( lRet != ERROR_SUCCESS ) {
00077         RegCloseKey(hKeyIme);
00078         RegCloseKey(hKeyKbdLayout);
00079         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00080     }
00081 
00082     piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o9">wszImeFile</a>[<a class="code" href="../../d8/d0/immstruc_8h.html#a22">IM_FILE_SIZE</a> - 1] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00083 
00084     RegCloseKey(hKeyIme);
00085     RegCloseKey(hKeyKbdLayout);
00086 
00087     piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o0">hkl</a> = hKL;
00088     piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o5">fLoadFlag</a> = <a class="code" href="../../d8/d0/immstruc_8h.html#a18">IMEF_NONLOAD</a>;
00089 
00090     <span class="keywordflow">return</span> <a class="code" href="../../d3/d1/layime_8c.html#a22">LoadVersionInfo</a>(piiex);
00091 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="layime.c::LoadFixVersionInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL LoadFixVersionInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d8/structtagIMEINFOEX.html">PIMEINFOEX</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>piiex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszVersionBuffer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00204">204</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00107">tagIMEINFOEX::dwImeWinVersion</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00106">tagIMEINFOEX::dwProdVersion</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d0/layime_8c-source.html#l00031">PFIXEDFILEINFO</a>, <a class="el" href="../../d4/d0/layime_8c-source.html#l00019">SZ_BACKSLASH</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/layime_8c-source.html#l00305">LoadVersionInfo()</a>.
<p>
<pre class="fragment"><div>00207 {
00208     <a class="code" href="../../d3/d1/layime_8c.html#a12">PFIXEDFILEINFO</a> pFixedVersionInfo;
00209     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>           fResult;
00210     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>          cbValue;
00211 
00212     fResult = (*pfnVerQueryValueW)(pszVersionBuffer,
00213                                    <a class="code" href="../../d3/d1/layime_8c.html#a2">SZ_BACKSLASH</a>,
00214                                    &amp;pFixedVersionInfo,
00215                                    &amp;cbValue);
00216 
00217     <span class="keywordflow">if</span> (!fResult || cbValue == 0)
00218         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00219 
00220     <span class="comment">/*</span>
00221 <span class="comment">     * Check for IME file type.</span>
00222 <span class="comment">     */</span>
00223     <span class="keywordflow">if</span> (pFixedVersionInfo-&gt;dwFileType != VFT_DRV ||
00224         pFixedVersionInfo-&gt;dwFileSubtype != VFT2_DRV_INPUTMETHOD) {
00225         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00226     }
00227 
00228     piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o6">dwProdVersion</a> = pFixedVersionInfo-&gt;dwProductVersionMS;
00229 
00230     <span class="comment">/*</span>
00231 <span class="comment">     * Currently, we only support 4.0 DLL based IME.</span>
00232 <span class="comment">     */</span>
00233     piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o7">dwImeWinVersion</a> = IMEVER_0400;
00234 
00235     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00236 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="layime.c::LoadVarVersionInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL LoadVarVersionInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d8/structtagIMEINFOEX.html">PIMEINFOEX</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>piiex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>pszVersionBuffer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00238">238</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d0/layime_8c-source.html#l00182">GetVersionDatum()</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00100">tagIMEINFOEX::hkl</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00108">tagIMEINFOEX::wszImeDescription</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/layime_8c-source.html#l00305">LoadVersionInfo()</a>.
<p>
<pre class="fragment"><div>00241 {
00242     PWSTR   pDescription;
00243     WORD    wLangId;
00244     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fResult;
00245     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a> puXlate;
00246     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   cbValue;
00247     WCHAR   szVersionKey[80];
00248 
00249     fResult = (*pfnVerQueryValueW)(pszVersionBuffer,
00250                                    <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="stringliteral">"\\VarFileInfo\\Translation"</span>,
00251                                    (<a class="code" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> *)&amp;puXlate,
00252                                    &amp;cbValue);
00253 
00254     <span class="keywordflow">if</span> (!fResult || cbValue == 0)
00255         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00256 
00257     wLangId = *puXlate;
00258 
00259     <span class="keywordflow">if</span> (piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o0">hkl</a> == 0) {
00260         <span class="comment">/*</span>
00261 <span class="comment">         * A newly installed IME, its HKL is not assigned yet.</span>
00262 <span class="comment">         */</span>
00263         piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o0">hkl</a> = (HKL)LongToHandle( MAKELONG(wLangId, 0) );
00264     }
00265 <span class="preprocessor">#if 0   // let unlocalized IME to work.</span>
00266 <span class="preprocessor"></span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (LOWORD(HandleToUlong(piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o0">hkl</a>)) != wLangId){
00267         <span class="comment">/*</span>
00268 <span class="comment">         * Mismatch in Lang ID, blow out</span>
00269 <span class="comment">         */</span>
00270         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00271     }
00272 <span class="preprocessor">#endif</span>
00273 <span class="preprocessor"></span>
00274     <span class="comment">/*</span>
00275 <span class="comment">     * First try the language we are currently in.</span>
00276 <span class="comment">     */</span>
00277     wsprintf(szVersionKey, L<span class="stringliteral">"\\StringFileInfo\\%04X04B0\\"</span>,
00278              LANGIDFROMLCID(GetThreadLocale()));
00279 
00280     pDescription = <a class="code" href="../../d3/d1/layime_8c.html#a19">GetVersionDatum</a>(pszVersionBuffer, szVersionKey,
00281             L<span class="stringliteral">"FileDescription"</span>);
00282 
00283     <span class="keywordflow">if</span> (pDescription == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00284         <span class="comment">/*</span>
00285 <span class="comment">         * Now try the first translation specified in IME</span>
00286 <span class="comment">         */</span>
00287         wsprintf(szVersionKey, L<span class="stringliteral">"\\StringFileInfo\\%04X%04X\\"</span>,
00288                  *puXlate, *(puXlate+1));
00289 
00290         pDescription = <a class="code" href="../../d3/d1/layime_8c.html#a19">GetVersionDatum</a>(pszVersionBuffer, szVersionKey,
00291                 L<span class="stringliteral">"FileDescription"</span>);
00292     }
00293 
00294     <span class="keywordflow">if</span> (pDescription != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00295         wcscpy(piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o8">wszImeDescription</a>, pDescription);
00296     }
00297     <span class="keywordflow">else</span> {
00298         piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o8">wszImeDescription</a>[0] = <a class="code" href="../../d2/d0/aw_8h.html#a3">L</a><span class="charliteral">'\0'</span>;
00299     }
00300 
00301     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00302 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="layime.c::LoadVersionInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL LoadVersionInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d8/structtagIMEINFOEX.html">PIMEINFOEX</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>piiex</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00305">305</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00075">ARRAY_SIZE</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d1/layime_8c.html#a8">GET_PROC</a>, <a class="el" href="../../d4/d0/layime_8c-source.html#l00095">GetSystemPathName()</a>, <a class="el" href="../../d6/d9/w32_2ntuser_2imm_2misc_8c-source.html#l00557">ImmLocalAlloc()</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00137">ImmLocalFree</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d4/d0/layime_8c-source.html#l00204">LoadFixVersionInfo()</a>, <a class="el" href="../../d4/d0/layime_8c-source.html#l00238">LoadVarVersionInfo()</a>, <a class="el" href="../../d4/d8/arcinst_8c-source.html#l00065">MAX_PATH</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d4/d0/layime_8c-source.html#l00016">VERSION_DLL</a>, and <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00109">tagIMEINFOEX::wszImeFile</a>.
<p>
Referenced by <a class="el" href="../../d5/d0/layout_8c-source.html#l00266">ImmInstallIMEW()</a>, and <a class="el" href="../../d4/d0/layime_8c-source.html#l00038">ImmLoadLayout()</a>.
<p>
<pre class="fragment"><div>00307 {
00308     WCHAR   szPath[<a class="code" href="../../d3/d9/arcinst_8c.html#a6">MAX_PATH</a>];
00309     PWSTR   pszVersionBuffer;
00310     HANDLE  hVersion;
00311     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwVersionSize;
00312     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwHandle = 0;
00313     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>    fUnload, fReturn = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00314 
00315     hVersion = GetModuleHandle(VERSION_DLL);
00316     <span class="keywordflow">if</span> (hVersion != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00317         fUnload = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00318     }
00319     <span class="keywordflow">else</span> {
00320         hVersion = LoadLibrary(VERSION_DLL);
00321         <span class="keywordflow">if</span> (hVersion == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00322             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00323         }
00324         fUnload = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00325     }
00326 
00327 <span class="preprocessor">#define GET_PROC(x) \</span>
00328 <span class="preprocessor">    if (!(pfn##x = (PVOID) GetProcAddress(hVersion, VERSION_##x))) { \</span>
00329 <span class="preprocessor">        goto LoadVerInfoUnload; }</span>
00330 <span class="preprocessor"></span>
00331     <a class="code" href="../../d3/d1/layime_8c.html#a8">GET_PROC</a>(GetFileVersionInfoW);
00332     <a class="code" href="../../d3/d1/layime_8c.html#a8">GET_PROC</a>(GetFileVersionInfoSizeW);
00333     <a class="code" href="../../d3/d1/layime_8c.html#a8">GET_PROC</a>(VerQueryValueW);
00334 
00335 <span class="preprocessor">#undef GET_PROC</span>
00336 <span class="preprocessor"></span>
00337     <span class="comment">// szPath = fully qualified IME file name</span>
00338     <a class="code" href="../../d3/d1/layime_8c.html#a17">GetSystemPathName</a>(szPath, piiex-&gt;<a class="code" href="../../d0/d8/structtagIMEINFOEX.html#o9">wszImeFile</a>, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a2">ARRAY_SIZE</a>(szPath));
00339 
00340     dwVersionSize = (*pfnGetFileVersionInfoSizeW)(szPath, &amp;dwHandle);
00341 
00342     <span class="keywordflow">if</span> (dwVersionSize == 0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>)
00343         <span class="keywordflow">goto</span> LoadVerInfoUnload;
00344 
00345     pszVersionBuffer = (PWSTR)<a class="code" href="../../d5/d0/w32_2ntuser_2imm_2misc_8c.html#a22">ImmLocalAlloc</a>(0, dwVersionSize);
00346 
00347     <span class="keywordflow">if</span> (pszVersionBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)    <span class="comment">// can't get memory for version info, blow out</span>
00348         <span class="keywordflow">goto</span> LoadVerInfoUnload;
00349 
00350     <span class="keywordflow">if</span> (!(*pfnGetFileVersionInfoW)(szPath, dwHandle, dwVersionSize, pszVersionBuffer))
00351         <span class="keywordflow">goto</span> LoadVerInfoFree;
00352 
00353     <span class="comment">/*</span>
00354 <span class="comment">     * Get the fixed block version information.</span>
00355 <span class="comment">     */</span>
00356     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d1/layime_8c.html#a20">LoadFixVersionInfo</a>(piiex, pszVersionBuffer)) {
00357         <span class="comment">/*</span>
00358 <span class="comment">         * Get the variable block version information.</span>
00359 <span class="comment">         */</span>
00360         fReturn = <a class="code" href="../../d3/d1/layime_8c.html#a21">LoadVarVersionInfo</a>(piiex, pszVersionBuffer);
00361     }
00362 
00363 LoadVerInfoFree:
00364     <a class="code" href="../../d4/d0/immcli_8h.html#a8">ImmLocalFree</a>((HLOCAL)pszVersionBuffer);
00365 
00366 LoadVerInfoUnload:
00367     <span class="keywordflow">if</span> (fUnload)
00368         FreeLibrary(hVersion);
00369 
00370     <span class="keywordflow">return</span> fReturn;
00371 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a14" doxytag="layime.c::pfnGetFileVersionInfoSizeW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d1/layime_8c.html#a10">LPFNGETFILEVERSIONINFOSIZEW</a> <a class="el" href="../../d3/d1/layime_8c.html#a14">pfnGetFileVersionInfoSizeW</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00034">34</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="layime.c::pfnGetFileVersionInfoW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d1/layime_8c.html#a9">LPFNGETFILEVERSIONINFOW</a> <a class="el" href="../../d3/d1/layime_8c.html#a13">pfnGetFileVersionInfoW</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00033">33</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="layime.c::pfnVerQueryValueW" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d1/layime_8c.html#a11">LPFNVERQUERYVALUEW</a> <a class="el" href="../../d3/d1/layime_8c.html#a15">pfnVerQueryValueW</a><code> [static]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/layime_8c-source.html#l00035">35</a> of file <a class="el" href="../../d4/d0/layime_8c-source.html">layime.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:29 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
