<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: nt6/dlgbegin.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dlgbegin.c File Reference</h1><code>#include "<a class="el" href="../../d4/d3/w32_2ntuser_2tools_2usrbench_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d2/d8/nt6_2dlgbegin_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a0">CD_VISIBLE</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a1">CD_GLOBALEDIT</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a2">CD_USERFONT</a>&nbsp;&nbsp;&nbsp;0x04</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a3">CD_SETFOREGROUND</a>&nbsp;&nbsp;&nbsp;0x08</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a4">CD_USEDEFAULTX</a>&nbsp;&nbsp;&nbsp;0x10</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a5">CD_USEDEFAULTCX</a>&nbsp;&nbsp;&nbsp;0x20</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> __cdecl&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a7">MakeAResizeDlg</a> (int id, HANDLE h)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a8">ValidateCallback</a> (HANDLE h)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>__inline int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a9">DefShortToInt</a> (short s)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a10">SkipSz</a> (UTCHAR *lpsz)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a11">WordSkipSz</a> (UTCHAR *lpsz)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a12">DWordSkipSz</a> (UTCHAR *lpsz)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>__inline BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a13">IsFontTooSmall</a> (LPWSTR szTempBuffer, LPCWSTR lpStrSubst, TEXTMETRIC *ptm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int CALLBACK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a14">GetCharsetEnumProc</a> (LPLOGFONT lpLogFont, LPTEXTMETRIC lptm, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> nType, LPARAM lpData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UINT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a15">GetACPCharSet</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HFONT&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a16">CreateDlgFont</a> (HDC hdcDlg, LPWORD FAR *lplpstr, LPDLGTEMPLATE2 lpdt, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwExpWinVer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a17">GetDialogMonitor</a> (HWND hwndOwner, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> <a class="el" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HWND&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a18">InternalCreateDialog</a> (HANDLE hmod, LPDLGTEMPLATE lpdt, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> cb, HWND hwndOwner, DLGPROC lpfnDialog, LPARAM lParam, UINT fSCDLGFlags)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>CONST WCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a6">szEDITCLASS</a> [] = TEXT("Edit")</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="nt6/dlgbegin.c::CD_GLOBALEDIT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CD_GLOBALEDIT&nbsp;&nbsp;&nbsp;0x02          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00331">331</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="nt6/dlgbegin.c::CD_SETFOREGROUND" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CD_SETFOREGROUND&nbsp;&nbsp;&nbsp;0x08          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00333">333</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="nt6/dlgbegin.c::CD_USEDEFAULTCX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CD_USEDEFAULTCX&nbsp;&nbsp;&nbsp;0x20          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00335">335</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="nt6/dlgbegin.c::CD_USEDEFAULTX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CD_USEDEFAULTX&nbsp;&nbsp;&nbsp;0x10          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00334">334</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="nt6/dlgbegin.c::CD_USERFONT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CD_USERFONT&nbsp;&nbsp;&nbsp;0x04          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00332">332</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="nt6/dlgbegin.c::CD_VISIBLE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CD_VISIBLE&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00330">330</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a16" doxytag="nt6/dlgbegin.c::CreateDlgFont" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HFONT CreateDlgFont           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdcDlg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWORD FAR *&nbsp;</td>
          <td class="mdname" nowrap> <em>lplpstr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPDLGTEMPLATE2&nbsp;</td>
          <td class="mdname" nowrap> <em>lpdt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwExpWinVer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00141">141</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">BYTE</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l13593">DWordSkipSz()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/aug98_2dll32_2icmdll_8h-source.html#l00010">FAR</a>, <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00133">GetACPCharSet()</a>, <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00106">GetCharsetEnumProc()</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00479">Is500Compat</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00590">IS_DBCS_ENABLED</a>, <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00080">IsFontTooSmall()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00624">MultDiv</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d4/w32_2ntuser_2rtl_2random_8c-source.html#l00146">wcsncpycch()</a>.
<p>
Referenced by <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00553">InternalCreateDialog()</a>.
<p>
<pre class="fragment"><div>00142 {
00143     LOGFONT     LogFont;
00144     <span class="keywordtype">int</span>         fontheight, fheight;
00145     HFONT       hOldFont, hFont;
00146     WCHAR       szTempBuffer[20];
00147     LPCWSTR     lpStrSubst;
00148     TEXTMETRIC  tm;
00149     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>        fDeleteFont = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00150     <span class="comment">// FE</span>
00151     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>        bWillTryDefaultCharset = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00152 
00153     fheight = fontheight = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(*((WORD *) *lplpstr)++);
00154 
00155     <span class="keywordflow">if</span> (fontheight == 0x7FFF) {
00156         <span class="comment">// a 0x7FFF height is our special code meaning use the message box font</span>
00157 <span class="comment">//        return(gpsi-&gt;hMsgFont);</span>
00158         GetObject(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hMsgFont, <span class="keyword">sizeof</span>(LOGFONT), &amp;LogFont);
00159         <span class="keywordflow">return</span>(CreateFontIndirect(&amp;LogFont));
00160     }
00161 
00162     <span class="comment">//</span>
00163     <span class="comment">// The dialog template contains a font description! Use it.</span>
00164     <span class="comment">//</span>
00165     <span class="comment">// Fill the LogFont with default values</span>
00166     RtlZeroMemory(&amp;LogFont, <span class="keyword">sizeof</span>(LOGFONT));
00167 
00168     fontheight = -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a141">MultDiv</a>(fontheight, <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;dmLogPixels, 72);
00169     LogFont.lfHeight = fontheight;
00170 
00171     <span class="keywordflow">if</span> (lpdt-&gt;wDlgVer)
00172     {
00173         LogFont.lfWeight  = *((WORD <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a5">FAR</a> *) *lplpstr)++;
00174         LogFont.lfItalic  = *((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a5">FAR</a> *) *lplpstr)++;
00175         LogFont.lfCharSet = *((<a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d6/d7/aug98_2dll32_2icmdll_8h.html#a5">FAR</a> *) *lplpstr)++;
00176         <span class="comment">// FE_SB</span>
00177         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a125">IS_DBCS_ENABLED</a>() &amp;&amp; LogFont.lfCharSet == ANSI_CHARSET) {
00178             <span class="comment">//</span>
00179             <span class="comment">// When resource compiler generates dialog resource data</span>
00180             <span class="comment">// from DIALOGEX template, it can specify 'charset'. but</span>
00181             <span class="comment">// optional, if it is not specified, it will be filled</span>
00182             <span class="comment">// with 0 (ANSI charset). But, on localized version,</span>
00183             <span class="comment">// User might guess the default will be localized-charset</span>
00184             <span class="comment">//</span>
00185             <span class="comment">// [Dialog Resource File]</span>
00186             <span class="comment">//</span>
00187             <span class="comment">// DIALOGEX ...</span>
00188             <span class="comment">// ...</span>
00189             <span class="comment">// FONT pointsize, typeface, [weight], [italic], [charset]</span>
00190             <span class="comment">//</span>
00191             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a104">Is500Compat</a>(dwExpWinVer)) {
00192                 bWillTryDefaultCharset = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00193             } <span class="keywordflow">else</span> {
00194                 <span class="comment">// #100182</span>
00195                 LogFont.lfCharSet = DEFAULT_CHARSET;
00196                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"No CharSet information in DIALOGEX"</span>);
00197             }
00198         }
00199         <span class="comment">// end FE_SB</span>
00200     }
00201     <span class="keywordflow">else</span>
00202     {
00203         LogFont.lfWeight  = FW_BOLD;
00204         LogFont.lfCharSet = DEFAULT_CHARSET;
00205     }
00206 
00207 
00208     lpStrSubst = *lplpstr;
00209 
00210     <a class="code" href="../../d1/d5/w32_2ntuser_2rtl_2random_8c.html#a3">wcsncpycch</a>(LogFont.lfFaceName, lpStrSubst, <span class="keyword">sizeof</span>(LogFont.lfFaceName) / <span class="keyword">sizeof</span>(WCHAR));
00211 
00212     <span class="comment">//</span>
00213     <span class="comment">// "MS Shell Dlg" should have native character set ---</span>
00214     <span class="comment">// Yes I hate this kind of hard code literals, but there's no way to get</span>
00215     <span class="comment">// font link information.</span>
00216     <span class="comment">// That's the reason why you see this hard coded **** here</span>
00217     <span class="comment">//</span>
00218     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a125">IS_DBCS_ENABLED</a>() &amp;&amp; _wcsicmp(LogFont.lfFaceName, L<span class="stringliteral">"MS Shell Dlg"</span>) == 0) {
00219         LogFont.lfCharSet = <a class="code" href="../../d0/d9/dlgbegin_8c.html#a18">GetACPCharSet</a>();
00220     }
00221 
00222     *lplpstr = (WORD *)<a class="code" href="../../d2/d1/userexts_8c.html#a253">DWordSkipSz</a>(*lplpstr);
00223 
00224     <span class="keywordflow">if</span> (lpdt-&gt;style &amp; DS_3DLOOK)
00225         LogFont.lfWeight = FW_NORMAL;
00226 
00227 TryDefaultCharset:
00228     <span class="keywordflow">if</span> (LogFont.lfCharSet == DEFAULT_CHARSET) {
00229         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a125">IS_DBCS_ENABLED</a>()) {
00230             {
00231                 <span class="comment">//</span>
00232                 <span class="comment">// Get character set for given facename.</span>
00233                 <span class="comment">//</span>
00234                 EnumFonts(hdcDlg, LogFont.lfFaceName,
00235                           (FONTENUMPROC)GetCharsetEnumProc, (LPARAM)(&amp;LogFont));
00236                 <span class="comment">//</span>
00237                 <span class="comment">// We already tried default charset.</span>
00238                 <span class="comment">//</span>
00239                 bWillTryDefaultCharset = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00240             }
00241 
00242             <span class="comment">//</span>
00243             <span class="comment">// [Windows 3.1 FarEast version did this...]</span>
00244             <span class="comment">//</span>
00245             <span class="comment">// Use FW_NORMAL as default for DIALOG template. For DIALOGEX</span>
00246             <span class="comment">// template, we need to respect the value in the template.</span>
00247             <span class="comment">//</span>
00248             <span class="keywordflow">if</span> ((!(lpdt-&gt;wDlgVer)) &amp;&amp; <span class="comment">// not DIALOGEX template ?</span>
00249                 (IS_ANY_DBCS_CHARSET(LogFont.lfCharSet)) &amp;&amp; <span class="comment">// any FarEast font ?</span>
00250                 (LogFont.lfWeight != FW_NORMAL)) { <span class="comment">// already FW_NORMAL ?</span>
00251 
00252                 <span class="comment">//</span>
00253                 <span class="comment">// Set weight to FW_NORMAL.</span>
00254                 <span class="comment">//</span>
00255                 LogFont.lfWeight = FW_NORMAL;
00256             }
00257         } <span class="keywordflow">else</span> {
00258             LogFont.lfCharSet = GetTextCharset(hdcDlg); <span class="comment">// Assume shell charset.</span>
00259         }
00260     }
00261 
00262     <span class="keywordflow">if</span> (!(hFont = CreateFontIndirect((LPLOGFONT) &amp;LogFont)))
00263         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00264 
00265     <span class="keywordflow">if</span> (!(hOldFont = SelectFont(hdcDlg, hFont)))
00266         <span class="keywordflow">goto</span> deleteFont;
00267 
00268     <span class="keywordflow">if</span> (!GetTextMetrics(hdcDlg, &amp;tm)) {
00269         RIPMSG0(RIP_WARNING, <span class="stringliteral">"CreateDlgFont: GetTextMetrics failed"</span>);
00270         <span class="keywordflow">goto</span> deleteFont;
00271     }
00272 
00273 
00274     GetTextFace(hdcDlg, <span class="keyword">sizeof</span>(szTempBuffer)/<span class="keyword">sizeof</span>(WCHAR), szTempBuffer);
00275 
00276     <span class="comment">//</span>
00277     <span class="comment">// If this is a low res device, we need to check if the</span>
00278     <span class="comment">// font we're creating is smaller than the system font.</span>
00279     <span class="comment">// If so, just use the system font.</span>
00280     <span class="comment">//</span>
00281     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/nt6_2dlgbegin_8c.html#a13">IsFontTooSmall</a>(szTempBuffer, lpStrSubst, &amp;tm)) {
00282         <span class="comment">//</span>
00283         <span class="comment">// Couldn't find a font with the height or facename</span>
00284         <span class="comment">// the app wanted so use the system font instead. Note</span>
00285         <span class="comment">// that we need to make sure the app knows it is</span>
00286         <span class="comment">// getting the system font via the WM_SETFONT message</span>
00287         <span class="comment">// so we still need to act as if a new font is being</span>
00288         <span class="comment">// sent to the dialog box.</span>
00289         <span class="comment">//</span>
00290 deleteFont:
00291         fDeleteFont = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00292     }
00293 
00294 
00295     <span class="keywordflow">if</span> (hOldFont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00296         SelectFont(hdcDlg, hOldFont);
00297     }
00298 
00299     <span class="keywordflow">if</span> (fDeleteFont) {
00300         DeleteFont(hFont);
00301         <span class="comment">// FE_SB</span>
00302         <span class="comment">//</span>
00303         <span class="comment">// Font is deleted, Prepare for reTry...</span>
00304         <span class="comment">//</span>
00305         fDeleteFont = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00306         <span class="comment">// end FE_SB</span>
00307         hFont = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00308     }
00309 
00310     <span class="comment">// FE_SB</span>
00311     <span class="comment">//</span>
00312     <span class="comment">// 1. We fail to create font.</span>
00313     <span class="comment">// 2. We did *NOT* try default charset, yet.</span>
00314     <span class="comment">// 3. We want to try default charset.</span>
00315     <span class="comment">//</span>
00316     <span class="comment">// if all of answer is 'Yes', we will try...</span>
00317     <span class="comment">//</span>
00318     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a125">IS_DBCS_ENABLED</a>() &amp;&amp; (hFont == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; bWillTryDefaultCharset) {
00319         <span class="comment">//</span>
00320         <span class="comment">// Try DEFAULT_CHARSET.</span>
00321         <span class="comment">//</span>
00322         LogFont.lfCharSet = DEFAULT_CHARSET;
00323         <span class="keywordflow">goto</span> TryDefaultCharset;
00324     }
00325     <span class="comment">// end FE_SB</span>
00326 
00327     <span class="keywordflow">return</span>(hFont);
00328 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="nt6/dlgbegin.c::DefShortToInt" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline int DefShortToInt           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">short&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>s</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00032">32</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.
<p>
References <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02743">CW2_USEDEFAULT</a>, and <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>.
<p>
<pre class="fragment"><div>00033 {
00034     <span class="keywordflow">if</span> (s == (<span class="keywordtype">short</span>)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a>) {
00035         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)(WORD)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a>;
00036     } <span class="keywordflow">else</span> {
00037         <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)s;
00038     }
00039 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="nt6/dlgbegin.c::DWordSkipSz" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> DWordSkipSz           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UTCHAR *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lpsz</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00064">64</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00887">NextDWordBoundary</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d3/d0/userexts_8c-source.html#l13551">SkipSz()</a>.
<p>
<pre class="fragment"><div>00066 {
00067     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pb = <a class="code" href="../../d2/d1/userexts_8c.html#a251">SkipSz</a>(lpsz);
00068     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a124">NextDWordBoundary</a>(pb);
00069 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="nt6/dlgbegin.c::GetACPCharSet" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UINT GetACPCharSet           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00122">122</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, and <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>.
<p>
<pre class="fragment"><div>00123 {
00124     CHARSETINFO csInfo;
00125 
00126     <span class="keywordflow">if</span> (!TranslateCharsetInfo((DWORD*)GetACP(), &amp;csInfo, TCI_SRCCODEPAGE)) {
00127         <span class="keywordflow">return</span> DEFAULT_CHARSET;
00128     }
00129     <span class="keywordflow">return</span> csInfo.ciCharset;
00130 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="nt6/dlgbegin.c::GetCharsetEnumProc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int CALLBACK GetCharsetEnumProc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPLOGFONT&nbsp;</td>
          <td class="mdname" nowrap> <em>lpLogFont</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPTEXTMETRIC&nbsp;</td>
          <td class="mdname" nowrap> <em>lptm</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>nType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lpData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00098">98</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00103 {
00104     UNREFERENCED_PARAMETER(lptm);
00105     UNREFERENCED_PARAMETER(nType);
00106 
00107     <span class="comment">//</span>
00108     <span class="comment">// Use other than FIXED pitch sysfont when the face name isn't specified.</span>
00109     <span class="comment">//</span>
00110     <span class="keywordflow">if</span> ((lpLogFont-&gt;lfPitchAndFamily &amp; 3) == FIXED_PITCH)
00111     {
00112         <span class="keywordflow">if</span> (!lstrcmpi(lpLogFont-&gt;lfFaceName,L<span class="stringliteral">"System"</span>) ||
00113             !lstrcmpi(lpLogFont-&gt;lfFaceName,L<span class="stringliteral">"@System"</span>))
00114             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; <span class="comment">// try to get another system font metric</span>
00115     }
00116 
00117     ((LPLOGFONT)lpData)-&gt;lfCharSet = lpLogFont-&gt;lfCharSet;
00118     ((LPLOGFONT)lpData)-&gt;lfPitchAndFamily = lpLogFont-&gt;lfPitchAndFamily;
00119     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00120 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="nt6/dlgbegin.c::GetDialogMonitor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a> GetDialogMonitor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwndOwner</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00351">351</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.
<p>
References <a class="el" href="../../d0/d1/mmrtl_8c-source.html#l00426">_MonitorFromWindow()</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00787">FNID_DESKTOP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00843">GETFNID</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02604">GetPrimaryMonitor()</a>, <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00251">GetWindowThreadProcessId()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05163">NtUserGetForegroundWindow()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00215">REBASEPWND</a>, and <a class="el" href="../../d5/d9/immcli_8h-source.html#l00120">ValidateHwnd</a>.
<p>
Referenced by <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00553">InternalCreateDialog()</a>, and <a class="el" href="../../d7/d3/msgbox_8c-source.html#l00730">SoftModalMessageBox()</a>.
<p>
<pre class="fragment"><div>00352 {
00353     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>    pMonitor;
00354     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>        pwnd;
00355     HWND        hwndForeground;
00356     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       pid;
00357 
00358     UserAssert(dwFlags == MONITOR_DEFAULTTONULL ||
00359                dwFlags == MONITOR_DEFAULTTOPRIMARY);
00360 
00361     pMonitor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00362     <span class="keywordflow">if</span> (hwndOwner) {
00363         pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndOwner);
00364         <span class="keywordflow">if</span> (    pwnd &amp;&amp;
00365                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(pwnd) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>  &amp;&amp;
00366                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a232">GETFNID</a>(<a class="code" href="../../d6/d0/usercli_8h.html#a27">REBASEPWND</a>(pwnd, spwndParent)) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a196">FNID_DESKTOP</a>) {
00367 
00368             pMonitor = <a class="code" href="../../d9/d1/mmrtl_8c.html#a8">_MonitorFromWindow</a>(pwnd, MONITOR_DEFAULTTOPRIMARY);
00369         }
00370     } <span class="keywordflow">else</span> {
00371         <span class="comment">/*</span>
00372 <span class="comment">         * HACK!  They passed in no owner and are creating a top level</span>
00373 <span class="comment">         * dialog window.  Does this process own the foreground window?</span>
00374 <span class="comment">         * If so, pin to that window's monitor.  That way 16-bit apps</span>
00375 <span class="comment">         * will work mostly as expected, and old multithreaded dudes just</span>
00376 <span class="comment">         * might too.  Especially the shell, for whom many system UI pieces</span>
00377 <span class="comment">         * pop up random dialogs inside of API calls.</span>
00378 <span class="comment">         */</span>
00379 
00380         hwndForeground = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a199">NtUserGetForegroundWindow</a>();
00381         <span class="keywordflow">if</span> (hwndForeground) {
00382             <a class="code" href="../../d3/d8/winmgrc_8c.html#a18">GetWindowThreadProcessId</a>(hwndForeground, &amp;pid);
00383             <span class="keywordflow">if</span> (pid == HandleToUlong(NtCurrentTeb()-&gt;ClientId.UniqueProcess)) {
00384                 pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwndForeground);
00385                 <span class="keywordflow">if</span> (pwnd) {
00386                     pMonitor = <a class="code" href="../../d9/d1/mmrtl_8c.html#a8">_MonitorFromWindow</a>(pwnd, MONITOR_DEFAULTTOPRIMARY);
00387                 }
00388             }
00389         }
00390     }
00391 
00392     <span class="keywordflow">if</span> (!pMonitor &amp;&amp; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> == MONITOR_DEFAULTTOPRIMARY) {
00393         pMonitor = <a class="code" href="../../d6/d0/usercli_8h.html#a793">GetPrimaryMonitor</a>();
00394     }
00395 
00396     <span class="keywordflow">return</span> pMonitor;
00397 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="nt6/dlgbegin.c::InternalCreateDialog" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HWND InternalCreateDialog           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>hmod</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPDLGTEMPLATE&nbsp;</td>
          <td class="mdname" nowrap> <em>lpdt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>cb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HWND&nbsp;</td>
          <td class="mdname" nowrap> <em>hwndOwner</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>DLGPROC&nbsp;</td>
          <td class="mdname" nowrap> <em>lpfnDialog</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>fSCDLGFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00413">413</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.
<p>
References <a class="el" href="../../d4/d7/winmgrc_8c-source.html#l00604">_AdjustWindowRectEx()</a>, <a class="el" href="../../d7/d8/dlgmgrc_8c-source.html#l00348">_GetNextDlgTabItem()</a>, <a class="el" href="../../d0/d1/mmrtl_8c-source.html#l00056">_MonitorFromPoint()</a>, <a class="el" href="../../d0/d1/mmrtl_8c-source.html#l00221">_MonitorFromRect()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01297">tagSERVERINFO::atomSysClass</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00465">_LARGE_UNICODE_STRING::bAnsi</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00435">_LARGE_UNICODE_STRING::Buffer</a>, <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00470">CD_GLOBALEDIT</a>, <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00472">CD_SETFOREGROUND</a>, <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00474">CD_USEDEFAULTCX</a>, <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00473">CD_USEDEFAULTX</a>, <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00471">CD_USERFONT</a>, <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00469">CD_VISIBLE</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00593">ClientToScreen()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00323">CODEBIT</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l03173">ConnectIfNecessary</a>, <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00141">CreateDlgFont()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02743">CW2_USEDEFAULT</a>, <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00040">DefShortToInt()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02484">DF3DLOOK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02488">DFCONTROL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02485">DFNOFAILCREATE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00290">DIALOGCLASS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02824">DLGF_ANSI</a>, <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00175">DLGRSC_VER_NT5COMPAT_RESERVE</a>, <a class="el" href="../../d4/d8/dlgmgr_8c-source.html#l00152">DlgSetFocus()</a>, <a class="el" href="../../d8/d3/conexts_8c-source.html#l00650">dt()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01123">GETAPPVER</a>, <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00490">GetDialogMonitor()</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l02766">GetEditDS()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00916">GETEXPWINVER</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02604">GetPrimaryMonitor()</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00103">ghFontSys</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d6/d8/ntrtlp_8h-source.html#l00184">HIBYTE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01514">HW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00344">ICLS_COMBOBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00340">ICLS_EDIT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00480">Is400Compat</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00410">IS_PTR</a>, <a class="el" href="../../d4/d8/client_2wow_8c-source.html#l00277">IsWindow()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00463">_LARGE_UNICODE_STRING::Length</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, <a class="el" href="../../d6/d7/resizedlg_8cpp-source.html#l00032">MakeAResizeDlg()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02558">MaskWF</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00464">_LARGE_UNICODE_STRING::MaximumLength</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00887">NextDWordBoundary</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00886">NextWordBoundary</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04563">NtUserCallHwndLock()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l08087">NtUserCreateWindowEx()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04100">NtUserDestroyMenu()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04115">NtUserDestroyWindow()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l05226">NtUserGetSystemMenu()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01573">NtUserSetForegroundWindow</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l01565">NtUserSetWindowContextHelpId</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l06274">NtUserShowWindow()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00139">OffsetRect()</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02819">PDLG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00411">PTR_TO_ID</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02157">tagMONITOR::rcMonitor</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02158">tagMONITOR::rcWork</a>, <a class="el" href="../../d4/d8/dlgmgr_8c-source.html#l01363">RepositionRect()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00194">RevalidateHwnd</a>, <a class="el" href="../../d6/d5/chartran_8c-source.html#l00636">RtlInitLargeUnicodeString()</a>, <a class="el" href="../../d6/d8/cltxt_8h-source.html#l00652">SendMessage()</a>, <a class="el" href="../../d1/d8/clmsg_8c-source.html#l00270">SendMessageWorker()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00062">SHORT</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l13551">SkipSz()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d8/dlgbegin_8c-source.html#l00018">szEDITCLASS</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l02801">TellWOWThehDlg()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01174">TEST_KbdCuesPUSIF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02561">TestwndChild</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03608">UpdateWindow()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00041">UTCHAR</a>, <a class="el" href="../../d4/d8/dlgmgr_8c-source.html#l00192">ValidateDialogPwnd()</a>, <a class="el" href="../../d5/d9/immcli_8h-source.html#l00120">ValidateHwnd</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00475">VER40</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02421">WFCHILD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02400">WFMAXBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02402">WFMINBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02404">WFSIZEBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02405">WFSYSMENU</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02423">WFTYPEMASK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02419">WFVISIBLE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02319">WFWIN40COMPAT</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l13587">WordSkipSz()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00728">WS_EX_ANSICREATOR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00727">WS_EX_MDICHILD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02988">XPixFromXDU</a>, <a class="el" href="../../d6/d8/dlgmgr2_8c-source.html#l00084">xxxCheckDefPushButton()</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02989">YPixFromYDU</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/clres_8c-source.html#l00826">CreateDialogIndirectParamAorW()</a>, and <a class="el" href="../../d4/d8/dlgmgr_8c-source.html#l01246">InternalDialogBox()</a>.
<p>
<pre class="fragment"><div>00421 {
00422     HWND                hwnd;
00423     HWND                hwnd2;
00424     <a class="code" href="../../d6/d9/structtagWND.html">PWND</a>                pwnd;
00425     HWND                hwndNewFocus;
00426     HWND                hwndEditFirst = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00427     RECT                rc;
00428     WORD                w;
00429     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a>              *lpszMenu,
00430                         *lpszClass,
00431                         *lpszText,
00432                         *lpCreateParams,
00433                         *lpStr;
00434     <span class="keywordtype">int</span>                 cxChar,
00435                         cyChar;
00436     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>                f40Compat;
00437     HFONT               hNewFont = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00438     HFONT               hOldFont;
00439     LPDLGITEMTEMPLATE   lpdit;
00440     HMENU               hMenu;
00441     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>                fSuccess;
00442     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>                fWowWindow;
00443     HANDLE              hmodCreate;
00444     LPBYTE              lpCreateParamsData;
00445     DLGTEMPLATE2        <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>;
00446     DLGITEMTEMPLATE2    dit;
00447     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>               dwExpWinVer;
00448     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>               dsStyleOld;
00449     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>               bFlags = 0;
00450     HDC                 hdcDlg;
00451     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">LARGE_STRING</a>        strClassName;
00452     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>       pstrClassName;
00453     <a class="code" href="../../d1/d9/struct__LARGE__STRING.html">LARGE_STRING</a>        strWindowName;
00454     <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>            pMonitor;
00455         <span class="comment">// FA</span>
00456         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> bResizeMe=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00457 
00458     UNREFERENCED_PARAMETER(cb);
00459 
00460     <a class="code" href="../../d1/d0/inc_2user_8h.html#a848">ConnectIfNecessary</a>();
00461 
00462     UserAssert(!(fSCDLGFlags &amp; ~(SCDLG_CLIENT|SCDLG_ANSI|SCDLG_NOREVALIDATE|SCDLG_16BIT)));    <span class="comment">// These are the only valid flags</span>
00463 
00464     <span class="comment">/*</span>
00465 <span class="comment">     * Is this a Win4 extended dialog?</span>
00466 <span class="comment">     */</span>
00467     <span class="keywordflow">if</span> (((LPDLGTEMPLATE2)lpdt)-&gt;wSignature == 0xffff) {
00468 
00469         UserAssert(((LPDLGTEMPLATE2)lpdt)-&gt;wDlgVer == 1);
00470         RtlCopyMemory(&amp;dt, lpdt, <span class="keyword">sizeof</span> dt);
00471     } <span class="keywordflow">else</span> {
00472         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wDlgVer = 0;
00473         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wSignature = 0;
00474         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwHelpID = 0;
00475         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle = lpdt-&gt;dwExtendedStyle;
00476         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style = lpdt-&gt;style;
00477         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cDlgItems = lpdt-&gt;cdit;
00478         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.x = lpdt-&gt;x;
00479         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.y = lpdt-&gt;y;
00480         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx = lpdt-&gt;cx;
00481         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy = lpdt-&gt;cy;
00482     }
00483 
00484     <span class="comment">/*</span>
00485 <span class="comment">     * If this is called from wow code, then the loword of hmod != 0.</span>
00486 <span class="comment">     * In this case, allow any DS_ style bits that were passed in win3.1</span>
00487 <span class="comment">     * to be legal in win32. Case in point: 16 bit quark xpress passes the</span>
00488 <span class="comment">     * same bit as the win32 style DS_SETFOREGROUND. Also, VC++ sample</span>
00489 <span class="comment">     * "scribble" does the same thing.</span>
00490 <span class="comment">     *</span>
00491 <span class="comment">     * For win32 apps test the DS_SETFOREGROUND bit; wow apps are not set</span>
00492 <span class="comment">     * foreground (this is the new NT semantics)</span>
00493 <span class="comment">     * We have to let no "valid" bits through because apps depend on them</span>
00494 <span class="comment">     * bug 5232.</span>
00495 <span class="comment">     */</span>
00496     dsStyleOld = LOWORD(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style);
00497 
00498     <span class="comment">/*</span>
00499 <span class="comment">     * If the app is Win4 or greater, require correct dialog style bits.</span>
00500 <span class="comment">     * Prevents conflicts with new bits introduced in Chicago</span>
00501 <span class="comment">     */</span>
00502     dwExpWinVer = <a class="code" href="../../d6/d0/usercli_8h.html#a134">GETEXPWINVER</a>(hmod);
00503 
00504     <span class="keywordflow">if</span> ( f40Compat = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a105">Is400Compat</a>(dwExpWinVer) ) {
00505         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp;= (DS_VALID40 | 0xffff0000);
00506 
00507         <span class="comment">//</span>
00508         <span class="comment">// For old applications:</span>
00509         <span class="comment">//      If DS_COMMONDIALOG isn't set, don't touch DS_3DLOOK style</span>
00510         <span class="comment">// bit.  If it's there, it stays there.  If not, not.  That way old</span>
00511         <span class="comment">// apps which pass in their own templates, not commdlg's, don't get</span>
00512         <span class="comment">// forced 3D.</span>
00513         <span class="comment">//      If DS_COMMONDIALOG is there, remove DS_3DLOOK.</span>
00514         <span class="comment">//</span>
00515         <span class="comment">// For new applications:</span>
00516         <span class="comment">//      Force 3D always.</span>
00517         <span class="comment">//</span>
00518         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a150">GETAPPVER</a>() &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a101">VER40</a>) {
00519             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_COMMONDIALOG) {
00520                 <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp;= ~DS_3DLOOK;
00521                 dsStyleOld &amp;= ~DS_3DLOOK;
00522             }
00523         } <span class="keywordflow">else</span> {
00524             <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style |= DS_3DLOOK;
00525             dsStyleOld |= DS_3DLOOK;
00526         }
00527     } <span class="keywordflow">else</span> {
00528 <span class="preprocessor">#if DBG</span>
00529 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style != (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; (DS_VALID31 | DS_3DLOOK | 0xffff0000))) {
00530             RIPMSG1(RIP_WARNING, <span class="stringliteral">"CreateDialog: stripping invalid bits %lX"</span>, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style);
00531         }
00532 <span class="preprocessor">#endif // DBG</span>
00533 <span class="preprocessor"></span>
00534 
00535         <span class="comment">/*</span>
00536 <span class="comment">         * Don't strip off bits for old apps, they depend on this.  Especially 16 bit MFC apps!</span>
00537 <span class="comment">         *</span>
00538 <span class="comment">         * dt.dwStyle &amp;= (DS_VALID31 | 0xffff0000);</span>
00539 <span class="comment">         */</span>
00540     }
00541 
00542     <span class="keywordflow">if</span> (LOWORD((ULONG_PTR)hmod) == 0) {
00543         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_SETFOREGROUND)
00544             bFlags |= <a class="code" href="../../d0/d9/dlgbegin_8c.html#a5">CD_SETFOREGROUND</a>;
00545     }
00546 
00547     <span class="keywordflow">if</span> (dsStyleOld != LOWORD(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style))
00548     {
00549 
00550         RIPMSG1(f40Compat ? RIP_ERROR : RIP_WARNING,
00551                 <span class="stringliteral">"Bad dialog style bits (%x) - please remove."</span>,
00552                 LOWORD(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style));
00553         <span class="comment">// Fail new apps that pass in bogus bits!</span>
00554 
00555         <span class="keywordflow">if</span> (f40Compat) {
00556             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00557         }
00558     }
00559 
00560     <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_MODALFRAME) {
00561         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle |= WS_EX_DLGMODALFRAME | WS_EX_WINDOWEDGE;
00562     }
00563 
00564     <span class="keywordflow">if</span> (( <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_CONTEXTHELP) &amp;&amp; f40Compat) {
00565         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle |= WS_EX_CONTEXTHELP;
00566     }
00567 
00568     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_CONTROL) {
00569         <span class="comment">// Captions and system menus aren't allowed on "control" dialogs.</span>
00570         <span class="comment">// And strip DS_SYSMODAL.</span>
00571         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp;= ~(WS_CAPTION | WS_SYSMENU | DS_SYSMODAL);
00572     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; WS_DLGFRAME) {
00573         <span class="comment">// Add on window edge same way that CreateWindowEx() will</span>
00574         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle |= WS_EX_WINDOWEDGE;
00575     }
00576 
00577     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_SYSMODAL) {
00578         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle |= WS_EX_TOPMOST;
00579     }
00580 
00581     <span class="keywordflow">if</span> (!(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; WS_CHILD) || (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_CONTROL)) {
00582         <span class="comment">// only a control parent if it's not a child dialog or if it's</span>
00583         <span class="comment">// explicitly marked as a recursive dialog</span>
00584         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle |= WS_EX_CONTROLPARENT;
00585     }
00586 
00587     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.x == (<span class="keywordtype">short</span>)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a>) {
00588         bFlags |= <a class="code" href="../../d0/d9/dlgbegin_8c.html#a6">CD_USEDEFAULTX</a>;
00589         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.x = 0;
00590     }
00591 
00592     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx == (<span class="keywordtype">short</span>)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a>) {
00593         bFlags |= <a class="code" href="../../d0/d9/dlgbegin_8c.html#a7">CD_USEDEFAULTCX</a>;
00594         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx = 0;
00595     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx &lt; 0) {
00596         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx = 0;
00597     }
00598 
00599     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy &lt; 0) {
00600         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy = 0;
00601     }
00602 
00603 
00604     <span class="comment">// If there's a menu name string, load it.</span>
00605     lpszMenu = (LPWSTR)(((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(lpdt)) + (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wDlgVer ? <span class="keyword">sizeof</span>(DLGTEMPLATE2):<span class="keyword">sizeof</span>(DLGTEMPLATE)));
00606 
00607     <span class="comment">/*</span>
00608 <span class="comment">     * If the menu id is expressed as an ordinal and not a string,</span>
00609 <span class="comment">     * skip all 4 bytes to get to the class string.</span>
00610 <span class="comment">     */</span>
00611     w = *(LPWORD)lpszMenu;
00612 
00613     <span class="comment">/*</span>
00614 <span class="comment">     * If there's a menu name string, load it.</span>
00615 <span class="comment">     */</span>
00616     <span class="keywordflow">if</span> (w != 0) {
00617         <span class="keywordflow">if</span> ((hMenu = LoadMenu(hmod, (w == 0xFFFF) ?
00618                 MAKEINTRESOURCE(*(WORD *)((PBYTE)lpszMenu + 2)) : lpszMenu)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00619             RIPMSG0(RIP_WARNING, <span class="stringliteral">"ServerCreateDialog() failed: couldn't load menu"</span>);
00620             <span class="keywordflow">goto</span> DeleteFontAndMenuAndFail;
00621         }
00622     } <span class="keywordflow">else</span> {
00623         hMenu = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00624     }
00625 
00626     <span class="keywordflow">if</span> (w == 0xFFFF) {
00627         lpszClass = (LPWSTR)((LPBYTE)lpszMenu + 4);
00628     } <span class="keywordflow">else</span> {
00629         lpszClass = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> *)<a class="code" href="../../d2/d1/userexts_8c.html#a252">WordSkipSz</a>(lpszMenu);
00630     }
00631 
00632     lpszText = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> *)<a class="code" href="../../d2/d1/userexts_8c.html#a252">WordSkipSz</a>(lpszClass);
00633 
00634     lpStr = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> *)<a class="code" href="../../d2/d1/userexts_8c.html#a252">WordSkipSz</a>(lpszText);
00635 
00636     hdcDlg = CreateCompatibleDC(NULL);
00637     <span class="keywordflow">if</span> (hdcDlg == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00638         <span class="keywordflow">goto</span> DeleteFontAndMenuAndFail;
00639 
00640     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_SETFONT) {
00641         hNewFont = <a class="code" href="../../d1/d9/nt6_2dlgbegin_8c.html#a16">CreateDlgFont</a>(hdcDlg, &amp;lpStr, &amp;dt, dwExpWinVer);
00642         bFlags |= <a class="code" href="../../d0/d9/dlgbegin_8c.html#a4">CD_USERFONT</a>;
00643         lpdit = (LPDLGITEMTEMPLATE) <a class="code" href="../../d6/d0/usercli_8h.html#a124">NextDWordBoundary</a>(lpStr);
00644     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a105">Is400Compat</a>(dwExpWinVer) &amp;&amp; (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_FIXEDSYS)) {
00645 
00646         <span class="comment">//</span>
00647         <span class="comment">// B#2078 -- WISH for fixed width system font in dialog.  We need</span>
00648         <span class="comment">// to tell the dialog that it's using a font different from the</span>
00649         <span class="comment">// standard system font, so set CD_USERFONT bit.</span>
00650         <span class="comment">//</span>
00651         <span class="comment">// We need the 400 compat. check for CorelDraw, since they use</span>
00652         <span class="comment">// this style bit for their own purposes.</span>
00653         <span class="comment">//</span>
00654         hNewFont = GetStockObject(SYSTEM_FIXED_FONT);
00655         bFlags |= <a class="code" href="../../d0/d9/dlgbegin_8c.html#a4">CD_USERFONT</a>;
00656         lpdit = (LPDLGITEMTEMPLATE)<a class="code" href="../../d6/d0/usercli_8h.html#a124">NextDWordBoundary</a>(lpStr);
00657     } <span class="keywordflow">else</span> {
00658         lpdit = (LPDLGITEMTEMPLATE)<a class="code" href="../../d6/d0/usercli_8h.html#a124">NextDWordBoundary</a>(lpStr);
00659     }
00660 
00661     <span class="comment">/*</span>
00662 <span class="comment">     * If the application requested a particular font and for some</span>
00663 <span class="comment">     * reason we couldn't find it, we just use the system font.  BUT we</span>
00664 <span class="comment">     * need to make sure we tell him he gets the system font.  Dialogs</span>
00665 <span class="comment">     * which never request a particular font get the system font and we</span>
00666 <span class="comment">     * don't bother telling them this (via the WM_SETFONT message).</span>
00667 <span class="comment">     */</span>
00668 
00669     <span class="comment">// Is it anything other than the default system font?  If we can't get</span>
00670     <span class="comment">// enough memory to select in the new font specified, just use the system</span>
00671     <span class="comment">// font.</span>
00672     <span class="keywordflow">if</span> (hNewFont &amp;&amp; (hOldFont = SelectFont(hdcDlg, hNewFont))) {
00673         <span class="comment">// Get the ave character width and height to be used</span>
00674         cxChar = GdiGetCharDimensions(hdcDlg, NULL, &amp;cyChar);
00675 
00676         SelectFont(hdcDlg, hOldFont);
00677         <span class="keywordflow">if</span> (cxChar == 0) {
00678             RIPMSG0(RIP_WARNING, <span class="stringliteral">"InternalCreateDialog: GdiGetCharDimensions failed"</span>);
00679             <span class="keywordflow">goto</span> UseSysFontMetrics;
00680         }
00681     }
00682     <span class="keywordflow">else</span>
00683     {
00684         <span class="keywordflow">if</span> (hNewFont || (bFlags &amp; <a class="code" href="../../d0/d9/dlgbegin_8c.html#a4">CD_USERFONT</a>))
00685             hNewFont = <a class="code" href="../../d1/d8/clglobal_8c.html#a28">ghFontSys</a>;
00686 
00687 UseSysFontMetrics:
00688         cxChar = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cxSysFontChar;
00689         cyChar = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cySysFontChar;
00690     }
00691     DeleteDC(hdcDlg);
00692 
00693     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; WS_VISIBLE) {
00694         bFlags |= <a class="code" href="../../d0/d9/dlgbegin_8c.html#a2">CD_VISIBLE</a>;
00695         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp;= ~WS_VISIBLE;
00696     }
00697 
00698     <span class="keywordflow">if</span> (!(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_LOCALEDIT)) {
00699         bFlags |= <a class="code" href="../../d0/d9/dlgbegin_8c.html#a3">CD_GLOBALEDIT</a>;
00700     }
00701 
00702     <span class="comment">/* Figure out dimensions of real window</span>
00703 <span class="comment">     */</span>
00704     rc.left = rc.top = 0;
00705     rc.right = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a852">XPixFromXDU</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx, cxChar);
00706     rc.bottom = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a853">YPixFromYDU</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy, cyChar);
00707 
00708     <a class="code" href="../../d1/d0/inc_2user_8h.html#a1195">_AdjustWindowRectEx</a>(&amp;rc, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style, w, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle);
00709 
00710     <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(rc.right - rc.left);
00711     <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(rc.bottom - rc.top);
00712 
00713     <span class="keywordflow">if</span> ((<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_CENTERMOUSE) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(MOUSEPRESENT) &amp;&amp; f40Compat) {
00714         pMonitor = <a class="code" href="../../d9/d1/mmrtl_8c.html#a6">_MonitorFromPoint</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor, MONITOR_DEFAULTTONULL);
00715         UserAssert(pMonitor);
00716         *((LPPOINT)&amp;rc.left) = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;ptCursor;
00717         rc.left -= (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx / 2);
00718         rc.top  -= (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy / 2);
00719     } <span class="keywordflow">else</span> {
00720         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fNoDialogMonitor;
00721 
00722         pMonitor = <a class="code" href="../../d6/d0/usercli_8h.html#a762">GetDialogMonitor</a>(hwndOwner, MONITOR_DEFAULTTONULL);
00723         fNoDialogMonitor = pMonitor ? <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00724         <span class="keywordflow">if</span> (!pMonitor) {
00725             pMonitor = <a class="code" href="../../d6/d0/usercli_8h.html#a793">GetPrimaryMonitor</a>();
00726         }
00727 
00728         <span class="keywordflow">if</span> ((<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; (DS_CENTER | DS_CENTERMOUSE)) &amp;&amp; f40Compat) {
00729             <span class="comment">/*</span>
00730 <span class="comment">             * Center to the work area of the owner monitor.</span>
00731 <span class="comment">             */</span>
00732             rc.left = (pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.left + pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.right - <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx) / 2;
00733             rc.top  = (pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.top + pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o4">rcWork</a>.bottom - <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy) / 2;
00734         } <span class="keywordflow">else</span> {
00735             rc.left = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a852">XPixFromXDU</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.x, cxChar);
00736             rc.top = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a853">YPixFromYDU</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.y, cyChar);
00737 
00738             <span class="keywordflow">if</span> (!(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; DS_ABSALIGN) &amp;&amp; hwndOwner) {
00739                 <span class="comment">/*</span>
00740 <span class="comment">                 * Offset relative coordinates to the owner window. If it is</span>
00741 <span class="comment">                 * a child window, there is nothing to do.</span>
00742 <span class="comment">                 */</span>
00743                 <span class="keywordflow">if</span> ((HIWORD(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style) &amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a734">MaskWF</a>(WFTYPEMASK)) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a734">MaskWF</a>(WFCHILD)) {
00744                     <span class="comment">//This is will considre rc.left form the right hand side of the owner window if it a mirrored one.</span>
00745                     <a class="code" href="../../d3/d9/client_2wow_8c.html#a23">ClientToScreen</a>(hwndOwner, (LPPOINT)&amp;rc.left);
00746 
00747 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00748 <span class="preprocessor"></span>                    <span class="comment">//It is not chiled then do Visual ClientToScreen</span>
00749                     <span class="comment">//i.e. rc.left it is form the left hand side of the owner window</span>
00750                     <span class="keywordflow">if</span> (MIRRORED_HWND(hwndOwner)) {
00751                         rc.left -= <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx;
00752                     }
00753 <span class="preprocessor">#endif</span>
00754 <span class="preprocessor"></span>
00755                 }
00756             } <span class="keywordflow">else</span> {
00757                 <span class="comment">/*</span>
00758 <span class="comment">                 * Position the dialog in screen coordinates. If the dialog's</span>
00759 <span class="comment">                 * owner is on a different monitor than specified in the</span>
00760 <span class="comment">                 * template, move the dialog to the owner window. If the owner</span>
00761 <span class="comment">                 * doesn't exist, then use the monitor from the dialog's</span>
00762 <span class="comment">                 * template.</span>
00763 <span class="comment">                 */</span>
00764 
00765                 <a class="code" href="../../d0/d2/structtagMONITOR.html">PMONITOR</a>    pMonitorTemplate;
00766                 RECT        rcTemplate;
00767 
00768                 rcTemplate.left  = rc.left;
00769                 rcTemplate.top   = rc.top;
00770                 rcTemplate.right  = rc.left + <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx;
00771                 rcTemplate.bottom = rc.top + <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy;
00772 
00773                 pMonitorTemplate = <a class="code" href="../../d9/d1/mmrtl_8c.html#a7">_MonitorFromRect</a>(&amp;rcTemplate, MONITOR_DEFAULTTOPRIMARY);
00774                 <span class="keywordflow">if</span> (fNoDialogMonitor) {
00775                     pMonitor = pMonitorTemplate;
00776                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pMonitorTemplate != pMonitor) {
00777                     rc.left += pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.left - pMonitorTemplate-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.left;
00778                     rc.top  += pMonitor-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.top  - pMonitorTemplate-&gt;<a class="code" href="../../d0/d2/structtagMONITOR.html#o3">rcMonitor</a>.top;
00779                 }
00780             }
00781         }
00782     }
00783 
00784     rc.right  = rc.left + <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx;
00785     rc.bottom = rc.top  + <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy;
00786 
00787     <span class="comment">// If the right or bottom coordinate has overflowed, then pin it back to</span>
00788     <span class="comment">// a valid rectangle.  Likely to happen if a minimized window is the owner of</span>
00789     <span class="comment">// the dialog.</span>
00790     <span class="keywordflow">if</span> (rc.left &gt; rc.right || rc.top &gt; rc.bottom) {
00791         <a class="code" href="../../d3/d6/rect_8c.html#a6">OffsetRect</a>(&amp;rc, -<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx, -<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy);
00792     }
00793 
00794    <span class="comment">//</span>
00795     <span class="comment">// Need to do this for ALL dialogs, not just top-level, since we used</span>
00796     <span class="comment">// to in 3.1.</span>
00797     <span class="comment">//</span>
00798 
00799     <span class="comment">// Clip top level dialogs within working area</span>
00800     <span class="comment">// Start child dialogs at least at (0, 0)</span>
00801     <a class="code" href="../../d6/d0/usercli_8h.html#a760">RepositionRect</a>(pMonitor, &amp;rc, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle);
00802 
00803     <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.x  = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((bFlags &amp; <a class="code" href="../../d0/d9/dlgbegin_8c.html#a6">CD_USEDEFAULTX</a>) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a> : rc.left);
00804     <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.y  = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(rc.top);
00805     <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)((bFlags &amp; <a class="code" href="../../d0/d9/dlgbegin_8c.html#a7">CD_USEDEFAULTCX</a>) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a770">CW2_USEDEFAULT</a> : rc.right - rc.left);
00806     <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a13">SHORT</a>)(rc.bottom - rc.top);
00807 
00808     <span class="keywordflow">if</span> (*lpszClass != 0) {
00809         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(lpszClass)) {
00810             <a class="code" href="../../d5/d6/chartran_8c.html#a7">RtlInitLargeUnicodeString</a>((<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html">PLARGE_UNICODE_STRING</a>)&amp;strClassName,
00811                     lpszClass, (UINT)-1);
00812             pstrClassName = &amp;strClassName;
00813         } <span class="keywordflow">else</span> {
00814             pstrClassName = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)lpszClass;
00815         }
00816     } <span class="keywordflow">else</span> {
00817         pstrClassName = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a40">DIALOGCLASS</a>;
00818     }
00819 
00820     <a class="code" href="../../d5/d6/chartran_8c.html#a7">RtlInitLargeUnicodeString</a>((<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html">PLARGE_UNICODE_STRING</a>)&amp;strWindowName,
00821             lpszText, (UINT)-1);
00822 
00823         <span class="comment">//</span>
00824         <span class="comment">// FA</span>
00825         <span class="comment">// instantiate the resize dlg class if NOT WS_DLGFRAME and WS_THICKFRAME</span>
00826         <span class="comment">// as those dialogs already support the resize code themselves.</span>
00827 
00828         bResizeMe=<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00829         <span class="keywordflow">if</span>(!( (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; WS_DLGFRAME) &amp;&amp; ( <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; WS_THICKFRAME) ))
00830         {
00831                 <span class="keywordflow">if</span> ( (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style &amp; WS_CHILD) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> )
00832                 {
00833                         <span class="comment">// PDLG(pwnd)-&gt;pDlgResize=MakeAResizeDlg(0,hmod);</span>
00834                         <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style |= ( WS_DLGFRAME | WS_THICKFRAME );
00835                         bResizeMe=<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00836                 }
00837         }
00838 
00839     UserAssert((<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle &amp; WS_EX_MDICHILD) == 0);
00840     hwnd = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a290">NtUserCreateWindowEx</a>(
00841             <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwExStyle | ((fSCDLGFlags &amp; SCDLG_ANSI) ? WS_EX_ANSICREATOR : 0),
00842             pstrClassName,
00843             &amp;strWindowName,
00844             <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.style,
00845             <a class="code" href="../../d0/d9/dlgbegin_8c.html#a12">DefShortToInt</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.x),
00846             <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.y,
00847             <a class="code" href="../../d0/d9/dlgbegin_8c.html#a12">DefShortToInt</a>(<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cx),
00848             <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cy,
00849             hwndOwner,
00850             hMenu,
00851             hmod,
00852             (LPVOID)NULL,
00853             dwExpWinVer);
00854 
00855     <span class="keywordflow">if</span> (hwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00856         RIPMSG0(RIP_WARNING, <span class="stringliteral">"CreateDialog() failed: couldn't create window"</span>);
00857 DeleteFontAndMenuAndFail:
00858         <span class="keywordflow">if</span> (hMenu != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00859             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a158">NtUserDestroyMenu</a>(hMenu);
00860         <span class="comment">/*</span>
00861 <span class="comment">         * Only delete the font if we didn't grab it</span>
00862 <span class="comment">         * from the dialog font cache.</span>
00863 <span class="comment">         */</span>
00864         <span class="keywordflow">if</span> ((hNewFont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)) {
00865             DeleteObject(hNewFont);
00866         }
00867         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00868     }
00869 
00870     pwnd = <a class="code" href="../../d4/d0/immcli_8h.html#a4">ValidateHwnd</a>(hwnd);
00871 
00872     <span class="comment">// tell WOW the hDlg of the Window just created BEFORE they get any messages</span>
00873     <span class="comment">// at WOW32!w32win16wndprocex</span>
00874     <span class="keywordflow">if</span>(fSCDLGFlags &amp; SCDLG_16BIT) {
00875         <a class="code" href="../../d6/d0/usercli_8h.html#a765">TellWOWThehDlg</a>(hwnd);
00876     }
00877 
00878     <span class="comment">/*</span>
00879 <span class="comment">     * Before anything happens with this window, we need to mark it as a</span>
00880 <span class="comment">     * dialog window!!!! So do that.</span>
00881 <span class="comment">     */</span>
00882     <span class="keywordflow">if</span> (pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> || !<a class="code" href="../../d6/d0/usercli_8h.html#a761">ValidateDialogPwnd</a>(pwnd))
00883         <span class="keywordflow">goto</span> DeleteFontAndMenuAndFail;
00884 
00885     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwHelpID) {
00886         <a class="code" href="../../d6/d0/usercli_8h.html#a220">NtUserSetWindowContextHelpId</a>(hwnd, <a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.dwHelpID);
00887     }
00888 
00889     <span class="comment">/*</span>
00890 <span class="comment">     * Set up the system menu on this dialog box if it has one.</span>
00891 <span class="comment">     */</span>
00892     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSYSMENU)) {
00893 
00894         <span class="comment">/*</span>
00895 <span class="comment">         * For a modal dialog box with a frame and caption, we want to</span>
00896 <span class="comment">         * delete the unselectable items from the system menu.</span>
00897 <span class="comment">         */</span>
00898         UserAssert(<a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(WFSIZEBOX) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(WFMINBOX));
00899         UserAssert(<a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(WFMINBOX) == <a class="code" href="../../d5/d9/ntrtlp_8h.html#a5">HIBYTE</a>(WFMAXBOX));
00900         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSIZEBOX | WFMINBOX | WFMAXBOX)) {
00901 
00902             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a176">NtUserCallHwndLock</a>(hwnd, SFI_XXXSETDIALOGSYSTEMMENU);
00903         } <span class="keywordflow">else</span> {
00904 
00905             <span class="comment">/*</span>
00906 <span class="comment">             * We have to give this dialog its own copy of the system menu</span>
00907 <span class="comment">             * in case it modifies the menu.</span>
00908 <span class="comment">             */</span>
00909             <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a202">NtUserGetSystemMenu</a>(hwnd, FALSE);
00910         }
00911     }
00912 
00913     <span class="comment">/*</span>
00914 <span class="comment">     * Set fDisabled to FALSE so EndDialog will Enable if dialog is ended</span>
00915 <span class="comment">     * before returning to DialogBox (or if modeless).</span>
00916 <span class="comment">     */</span>
00917     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;fDisabled = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00918 
00919     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;cxChar = cxChar;
00920     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;cyChar = cyChar;
00921     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;lpfnDlg = lpfnDialog;
00922     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;fEnd = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00923     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;result = IDOK;
00924         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;pDlgResize = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00925 
00926         <span class="comment">//</span>
00927         <span class="comment">// FA - instantiate the resize dlg class if WS_DLGFRAME and WS_THICKFRAME</span>
00928         <span class="comment">//</span>
00929         <span class="keywordflow">if</span>(bResizeMe)
00930                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;pDlgResize=<a class="code" href="../../d5/d8/resizedlg_8cpp.html#a6">MakeAResizeDlg</a>(0,hmod);
00931 
00932     <span class="comment">/*</span>
00933 <span class="comment">     * Need to remember Unicode status.</span>
00934 <span class="comment">     */</span>
00935     <span class="keywordflow">if</span> (fSCDLGFlags &amp; SCDLG_ANSI) {
00936         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;flags |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a794">DLGF_ANSI</a>;
00937     }
00938 
00939     <span class="comment">/*</span>
00940 <span class="comment">     * Have to do a callback here for WOW apps.  WOW needs what's in lParam</span>
00941 <span class="comment">     * before the dialog gets any messages.</span>
00942 <span class="comment">     */</span>
00943 
00944     <span class="comment">/*</span>
00945 <span class="comment">     * If the app is a Wow app then the Lo Word of the hInstance is the</span>
00946 <span class="comment">     * 16-bit hInstance.  Set the lParam, which no-one should look at</span>
00947 <span class="comment">     * but the app, to the 16 bit value</span>
00948 <span class="comment">     */</span>
00949     <span class="keywordflow">if</span> (LOWORD((ULONG_PTR)hmod) != 0) {
00950         fWowWindow = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00951     } <span class="keywordflow">else</span> {
00952         fWowWindow = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00953     }
00954 
00955     <span class="comment">/*</span>
00956 <span class="comment">     * If a user defined font is used, save the handle so that we can delete</span>
00957 <span class="comment">     * it when the dialog is destroyed.</span>
00958 <span class="comment">     */</span>
00959     <span class="keywordflow">if</span> (bFlags &amp; <a class="code" href="../../d0/d9/dlgbegin_8c.html#a4">CD_USERFONT</a>) {
00960 
00961         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;hUserFont = hNewFont;
00962 
00963         <span class="keywordflow">if</span> (lpfnDialog != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00964             <span class="comment">/*</span>
00965 <span class="comment">             * Tell the dialog that it will be using this font...</span>
00966 <span class="comment">             */</span>
00967             <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwnd, WM_SETFONT, (WPARAM)hNewFont, 0L, FALSE);
00968         }
00969     }
00970 
00971     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wDlgVer) {
00972         dit.dwHelpID = 0;
00973     }
00974 
00975     <span class="comment">/*</span>
00976 <span class="comment">     * Loop through the dialog controls, doing a CreateWindowEx() for each of</span>
00977 <span class="comment">     * them.</span>
00978 <span class="comment">     */</span>
00979     <span class="keywordflow">while</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.cDlgItems-- != 0) {
00980         <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwExpWinVer2;
00981 
00982         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wDlgVer) {
00983             RtlCopyMemory(&amp;dit, lpdit, <span class="keyword">sizeof</span> dit);
00984         } <span class="keywordflow">else</span> {
00985             dit.dwHelpID = 0;
00986             dit.dwExStyle = lpdit-&gt;dwExtendedStyle;
00987             dit.style = lpdit-&gt;style;
00988             dit.x = lpdit-&gt;x;
00989             dit.y = lpdit-&gt;y;
00990             dit.cx = lpdit-&gt;cx;
00991             dit.cy = lpdit-&gt;cy;
00992             dit.dwID = lpdit-&gt;id;
00993         }
00994 
00995         dit.x = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a852">XPixFromXDU</a>(dit.x, cxChar);
00996         dit.y = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a853">YPixFromYDU</a>(dit.y, cyChar);
00997         dit.cx = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a852">XPixFromXDU</a>(dit.cx, cxChar);
00998         dit.cy = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a853">YPixFromYDU</a>(dit.cy, cyChar);
00999 
01000         lpszClass = (LPWSTR)(((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)(lpdit)) + (<a class="code" href="../../d7/d4/conexts_8c.html#a26">dt</a>.wDlgVer ? <span class="keyword">sizeof</span>(DLGITEMTEMPLATE2):<span class="keyword">sizeof</span>(DLGITEMTEMPLATE)));
01001 
01002         <span class="comment">/*</span>
01003 <span class="comment">         * If the first WORD is 0xFFFF the second word is the encoded class name index.</span>
01004 <span class="comment">         * Use it to look up the class name string.</span>
01005 <span class="comment">         */</span>
01006         <span class="keywordflow">if</span> (*(LPWORD)lpszClass == 0xFFFF) {
01007             lpszText = lpszClass + 2;
01008             lpszClass = (LPWSTR)(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[*(((LPWORD)lpszClass)+1) &amp; ~<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a59">CODEBIT</a>]);
01009         } <span class="keywordflow">else</span> {
01010             lpszText = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> *)<a class="code" href="../../d2/d1/userexts_8c.html#a251">SkipSz</a>(lpszClass);
01011         }
01012         lpszText = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a1">UTCHAR</a> *)<a class="code" href="../../d6/d0/usercli_8h.html#a123">NextWordBoundary</a>(lpszText); <span class="comment">// UINT align lpszText</span>
01013 
01014         dit.dwExStyle |= WS_EX_NOPARENTNOTIFY;
01015 
01016         <span class="comment">//</span>
01017         <span class="comment">// Replace flat borders with 3D ones for DS_3DLOOK dialogs</span>
01018         <span class="comment">// We test the WINDOW style, not the template style now.  This is so</span>
01019         <span class="comment">// that 4.0 apps--who get 3D stuff automatically--can turn it off on</span>
01020         <span class="comment">// create if they want.</span>
01021         <span class="comment">//</span>
01022 
01023         <span class="comment">//</span>
01024         <span class="comment">// HACK!</span>
01025         <span class="comment">// Treat DS_3DLOOK combos like they have a WS_EX_CLIENTEDGE.  Why</span>
01026         <span class="comment">// should we have to draw the borders of a combobox ourselves?</span>
01027         <span class="comment">// We can't do the same thing for WS_BORDER though becaues of</span>
01028         <span class="comment">// PC Fools--they use the presence of WS_BORDER to distinguish</span>
01029         <span class="comment">// between lists and combos.</span>
01030         <span class="comment">//</span>
01031 
01032         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, DF3DLOOK)) {
01033             <span class="keywordflow">if</span> (    (dit.style &amp; WS_BORDER) ||
01034                     (lpszClass == MAKEINTRESOURCE(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[ICLS_COMBOBOX]))) {
01035 
01036                 dit.style &amp;= ~WS_BORDER;
01037                 dit.dwExStyle |= WS_EX_CLIENTEDGE;
01038             }
01039         }
01040 
01041         <span class="comment">/*</span>
01042 <span class="comment">         * Get pointer to additional data.  lpszText can point to an encoded</span>
01043 <span class="comment">         * ordinal number for some controls (e.g.  static icon control) so</span>
01044 <span class="comment">         * we check for that here.</span>
01045 <span class="comment">         */</span>
01046         <span class="keywordflow">if</span> (*(LPWORD)lpszText == 0xFFFF) {
01047             lpCreateParams = (LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpszText + 4);
01048             strWindowName.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o3">Buffer</a> = lpszText;
01049             strWindowName.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a> = 4;
01050             strWindowName.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o1">MaximumLength</a> = 4;
01051             strWindowName.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o2">bAnsi</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01052         } <span class="keywordflow">else</span> {
01053             lpCreateParams = (LPWSTR)((<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)<a class="code" href="../../d2/d1/userexts_8c.html#a252">WordSkipSz</a>(lpszText));
01054             <a class="code" href="../../d5/d6/chartran_8c.html#a7">RtlInitLargeUnicodeString</a>((<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html">PLARGE_UNICODE_STRING</a>)&amp;strWindowName,
01055                     lpszText, (UINT)-1);
01056         }
01057 
01058         <span class="comment">/*</span>
01059 <span class="comment">         * If control is edit control and caller wants global storage</span>
01060 <span class="comment">         * of edit text, allocate object in WOW and pass instance</span>
01061 <span class="comment">         * handle to CreateWindowEx().</span>
01062 <span class="comment">         */</span>
01063         <span class="keywordflow">if</span> (fWowWindow &amp;&amp; (bFlags &amp; <a class="code" href="../../d0/d9/dlgbegin_8c.html#a3">CD_GLOBALEDIT</a>) &amp;&amp;
01064                ((!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(lpszClass) &amp;&amp;
01065                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a99">PTR_TO_ID</a>(lpszClass) == (ATOM)(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o12">atomSysClass</a>[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a69">ICLS_EDIT</a>])) ||
01066                (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(lpszClass) &amp;&amp;
01067                     (wcscmp(lpszClass, szEDITCLASS) == 0)))) {
01068 
01069             <span class="comment">/*</span>
01070 <span class="comment">             * Allocate only one global object (first time we see editctl.)</span>
01071 <span class="comment">             */</span>
01072             <span class="keywordflow">if</span> (!(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;hData)) {
01073                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;hData = <a class="code" href="../../d3/d8/client_8c.html#a84">GetEditDS</a>();
01074                 <span class="keywordflow">if</span> (!(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;hData))
01075                     <span class="keywordflow">goto</span> NoCreate;
01076             }
01077 
01078             hmodCreate = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;hData;
01079             dwExpWinVer2 = <a class="code" href="../../d6/d0/usercli_8h.html#a134">GETEXPWINVER</a>(hmodCreate);
01080         } <span class="keywordflow">else</span> {
01081             hmodCreate = hmod;
01082             dwExpWinVer2 = dwExpWinVer;
01083         }
01084 
01085         UserAssert((dit.dwExStyle &amp; WS_EX_ANSICREATOR) == 0);
01086 
01087         <span class="comment">/*</span>
01088 <span class="comment">         * Get pointer to additional data.</span>
01089 <span class="comment">         *</span>
01090 <span class="comment">         * For WOW, instead of pointing lpCreateParams at the CreateParams</span>
01091 <span class="comment">         * data, set lpCreateParams to whatever DWORD is stored in the 32-bit</span>
01092 <span class="comment">         * DLGTEMPLATE's CreateParams.  WOW has already made sure that that</span>
01093 <span class="comment">         * 32-bit value is indeed a 16:16 pointer to the CreateParams in the</span>
01094 <span class="comment">         * 16-bit DLGTEMPLATE.</span>
01095 <span class="comment">         */</span>
01096 
01097         <span class="keywordflow">if</span> (*lpCreateParams) {
01098             lpCreateParamsData = (LPBYTE)lpCreateParams;
01099             <span class="keywordflow">if</span> (fWowWindow || fSCDLGFlags &amp; SCDLG_16BIT) {
01100                 lpCreateParamsData =
01101                     (LPBYTE)*(UNALIGNED <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> *)
01102                     (lpCreateParamsData + <span class="keyword">sizeof</span>(WORD));
01103             }
01104         } <span class="keywordflow">else</span> {
01105             lpCreateParamsData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01106         }
01107 
01108         <span class="comment">/*</span>
01109 <span class="comment">         * If the dialog template specifies a menu ID then TestwndChild(pwnd)</span>
01110 <span class="comment">         * must be TRUE or CreateWindowEx will think the ID is an hMenu rather</span>
01111 <span class="comment">         * than an ID (in a dialog template you'll never have an hMenu).</span>
01112 <span class="comment">         * However for compatibility reasons we let it go if the ID = 0.</span>
01113 <span class="comment">         */</span>
01114         <span class="keywordflow">if</span> (dit.dwID) {
01115             <span class="comment">/*</span>
01116 <span class="comment">             * This makes TestwndChild(pwnd) on this window return TRUE.</span>
01117 <span class="comment">             */</span>
01118             dit.style |= WS_CHILD;
01119             dit.style &amp;= ~WS_POPUP;
01120         }
01121 
01122         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a98">IS_PTR</a>(lpszClass)) {
01123             <a class="code" href="../../d5/d6/chartran_8c.html#a7">RtlInitLargeUnicodeString</a>((<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html">PLARGE_UNICODE_STRING</a>)&amp;strClassName,
01124                     lpszClass, (UINT)-1);
01125             pstrClassName = &amp;strClassName;
01126         } <span class="keywordflow">else</span> {
01127             pstrClassName = (<a class="code" href="../../d1/d9/struct__LARGE__STRING.html">PLARGE_STRING</a>)lpszClass;
01128         }
01129         UserAssert((dit.dwExStyle &amp; WS_EX_MDICHILD) == 0);
01130 
01131         hwnd2 = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a290">NtUserCreateWindowEx</a>(
01132                 dit.dwExStyle | ((fSCDLGFlags &amp; SCDLG_ANSI) ? WS_EX_ANSICREATOR : 0),
01133                 pstrClassName,
01134                 &amp;strWindowName,
01135                 dit.style,
01136                 <a class="code" href="../../d0/d9/dlgbegin_8c.html#a12">DefShortToInt</a>(dit.x),
01137                 dit.y,
01138                 <a class="code" href="../../d0/d9/dlgbegin_8c.html#a12">DefShortToInt</a>(dit.cx),
01139                 dit.cy,
01140                 hwnd,
01141                 (HMENU)dit.dwID,
01142                 hmodCreate,
01143                 lpCreateParamsData,
01144                 dwExpWinVer2);
01145 
01146         <span class="keywordflow">if</span> (hwnd2 == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01147 NoCreate:
01148             <span class="comment">/*</span>
01149 <span class="comment">             * Couldn't create the window -- return NULL.</span>
01150 <span class="comment">             */</span>
01151             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, DFNOFAILCREATE)) {
01152                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"CreateDialog() failed: couldn't create control"</span>);
01153                 <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a159">NtUserDestroyWindow</a>(hwnd);
01154                 <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01155             }
01156         } <span class="keywordflow">else</span> {
01157 
01158             <span class="keywordflow">if</span> (dit.dwHelpID) {
01159                 <a class="code" href="../../d6/d0/usercli_8h.html#a220">NtUserSetWindowContextHelpId</a>(hwnd2, dit.dwHelpID);
01160             }
01161 
01162         <span class="comment">/*</span>
01163 <span class="comment">         * If it is a not a default system font, set the font for all the</span>
01164 <span class="comment">         * child windows of the dialogbox.</span>
01165 <span class="comment">         */</span>
01166             <span class="keywordflow">if</span> (hNewFont != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01167                 <a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwnd2, WM_SETFONT, (WPARAM)hNewFont, 0L);
01168             }
01169 
01170         <span class="comment">/*</span>
01171 <span class="comment">         * Result gets ID of last (hopefully only) defpushbutton.</span>
01172 <span class="comment">         */</span>
01173             <span class="keywordflow">if</span> (<a class="code" href="../../d5/d9/cltxt_8h.html#a16">SendMessage</a>(hwnd2, WM_GETDLGCODE, 0, 0L) &amp; DLGC_DEFPUSHBUTTON) {
01174                 <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;result = dit.dwID;
01175             }
01176         }
01177         <span class="comment">/*</span>
01178 <span class="comment">         * Point at next item template</span>
01179 <span class="comment">         */</span>
01180         lpdit = (LPDLGITEMTEMPLATE)<a class="code" href="../../d6/d0/usercli_8h.html#a124">NextDWordBoundary</a>(
01181                 (LPBYTE)(lpCreateParams + 1) + *lpCreateParams);
01182     }
01183 
01184     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, DFCONTROL)) {
01185         <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT = <a class="code" href="../../d6/d0/usercli_8h.html#a642">_GetNextDlgTabItem</a>(pwnd, NULL, FALSE);
01186         hwndEditFirst = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndT);
01187     }
01188 
01189     <span class="keywordflow">if</span> (lpfnDialog != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01190         fSuccess = <a class="code" href="../../d6/d0/usercli_8h.html#a600">SendMessageWorker</a>(pwnd, WM_INITDIALOG,
01191                                (WPARAM)hwndEditFirst, lParam, FALSE);
01192 
01193         <span class="comment">//</span>
01194         <span class="comment">// Make sure the window didn't get nuked during WM_INITDIALOG</span>
01195         <span class="comment">//</span>
01196         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(hwnd)) {
01197             <span class="keywordflow">goto</span> CreateDialogReturn;
01198         }
01199 
01200         <span class="keywordflow">if</span> (fSuccess &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;fEnd) {
01201 
01202             <span class="comment">//</span>
01203             <span class="comment">// To remove the two-default-push-buttons problem, we must make</span>
01204             <span class="comment">// sure CheckDefPushButton() will remove default from other push</span>
01205             <span class="comment">// buttons.  This happens only if hwndEditFirst != hwndNewFocus;</span>
01206             <span class="comment">// So, we make it NULL here. This breaks Designer's install</span>
01207             <span class="comment">// program(which can't take a DM_GETDEFID.  So, we do a version</span>
01208             <span class="comment">// check here.</span>
01209             <span class="comment">//</span>
01210             <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, DFCONTROL)) {
01211                 <a class="code" href="../../d6/d9/structtagWND.html">PWND</a> pwndT;
01212                 <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(hwndEditFirst) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT))
01213                     hwndEditFirst = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01214 
01215                 <span class="comment">//</span>
01216                 <span class="comment">// They could have disabled hwndEditFirst during WM_INITDIALOG.</span>
01217                 <span class="comment">// So, let use obtain the First Tab again.</span>
01218                 <span class="comment">//</span>
01219                 pwndT = <a class="code" href="../../d6/d0/usercli_8h.html#a642">_GetNextDlgTabItem</a>(pwnd, NULL, FALSE);
01220                 <span class="keywordflow">if</span> (hwndNewFocus = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a450">HW</a>(pwndT)) {
01221                     <a class="code" href="../../d6/d0/usercli_8h.html#a759">DlgSetFocus</a>(hwndNewFocus);
01222                 }
01223 
01224                 <a class="code" href="../../d6/d0/usercli_8h.html#a757">xxxCheckDefPushButton</a>(pwnd, hwndEditFirst, hwndNewFocus);
01225             }
01226         }
01227     }
01228 
01229     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(hwnd))
01230     {
01231         <span class="comment">// Omnis7 relies on a nonzero return even though they nuked this</span>
01232         <span class="comment">// dialog during processing of the WM_INITDIALOG message</span>
01233         <span class="comment">// -- jeffbog -- 2/24/95 -- Win95B B#12368</span>
01234         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d0/usercli_8h.html#a150">GETAPPVER</a>() &lt; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a101">VER40</a>) {
01235             <span class="keywordflow">return</span>(hwnd);
01236         }
01237 
01238         <span class="keywordflow">return</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
01239     }
01240 
01241     <span class="comment">/*</span>
01242 <span class="comment">     * Bring this dialog into the foreground</span>
01243 <span class="comment">     * if DS_SETFOREGROUND is set.</span>
01244 <span class="comment">     */</span>
01245     <span class="keywordflow">if</span> (bFlags &amp; <a class="code" href="../../d0/d9/dlgbegin_8c.html#a5">CD_SETFOREGROUND</a>) {
01246         <a class="code" href="../../d6/d0/usercli_8h.html#a228">NtUserSetForegroundWindow</a>(hwnd);
01247         <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d9/client_2wow_8c.html#a11">IsWindow</a>(hwnd)) {
01248             hwnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01249             <span class="keywordflow">goto</span> CreateDialogReturn;
01250         }
01251     }
01252 
01253     <span class="keywordflow">if</span> ((bFlags &amp; <a class="code" href="../../d0/d9/dlgbegin_8c.html#a2">CD_VISIBLE</a>) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a793">PDLG</a>(pwnd)-&gt;fEnd &amp;&amp; (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFVISIBLE))) {
01254         <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a237">NtUserShowWindow</a>(hwnd, SHOW_OPENWINDOW);
01255         <a class="code" href="../../d3/d8/client_8c.html#a140">UpdateWindow</a>(hwnd);
01256     }
01257 
01258 CreateDialogReturn:
01259 
01260     <span class="comment">/*</span>
01261 <span class="comment">     * 17609 Gupta's SQLWin deletes the window before CreateDialog returns</span>
01262 <span class="comment">     * but still expects non-zero return value from CreateDialog so we will</span>
01263 <span class="comment">     * do like win 3.1 and not revalidate for 16 bit apps</span>
01264 <span class="comment">     */</span>
01265     <span class="keywordflow">if</span> (!(fSCDLGFlags &amp; SCDLG_NOREVALIDATE) &amp;&amp; !<a class="code" href="../../d6/d0/usercli_8h.html#a21">RevalidateHwnd</a>(hwnd)) {
01266         hwnd = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01267     }
01268 
01269     <span class="keywordflow">return</span> hwnd;
01270 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="nt6/dlgbegin.c::IsFontTooSmall" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> __inline BOOLEAN IsFontTooSmall           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">LPWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>szTempBuffer</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCWSTR&nbsp;</td>
          <td class="mdname" nowrap> <em>lpStrSubst</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>TEXTMETRIC *&nbsp;</td>
          <td class="mdname" nowrap> <em>ptm</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00080">80</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.
<p>
References <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00141">CreateDlgFont()</a>.
<p>
<pre class="fragment"><div>00081 {
00082     <span class="comment">//</span>
00083     <span class="comment">// For FarEast version, we will allow the font smaller than system font.</span>
00084     <span class="comment">//</span>
00085     <span class="keywordflow">return</span> _wcsicmp(szTempBuffer, lpStrSubst) ||
00086                 (!IS_ANY_DBCS_CHARSET(ptm-&gt;tmCharSet) &amp;&amp;
00087                     (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXICON) &lt; 32 || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYICON) &lt; 32) &amp;&amp;
00088                     ptm-&gt;tmHeight &lt; <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;cySysFontChar);
00089 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="nt6/dlgbegin.c::MakeAResizeDlg" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a5">LPVOID</a> __cdecl MakeAResizeDlg           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>h</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d6/d7/resizedlg_8cpp-source.html#l00032">32</a> of file <a class="el" href="../../d6/d7/resizedlg_8cpp-source.html">resizedlg.cpp</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">LPVOID</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00413">InternalCreateDialog()</a>.
<p>
<pre class="fragment"><div>00033 {
00034         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="../../d5/d6/classCResizeDlg.html">CResizeDlg</a>(<span class="keywordtype">id</span>, NULL, (HINSTANCE)h);
00035 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="nt6/dlgbegin.c::SkipSz" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> SkipSz           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UTCHAR *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lpsz</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00046">46</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.
<p>
References <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>.
<p>
<pre class="fragment"><div>00048 {
00049     <span class="keywordflow">if</span> (*lpsz == 0xFF)
00050         <span class="keywordflow">return</span> (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpsz + 4;
00051 
00052     <span class="keywordflow">while</span> (*lpsz++ != 0) ;
00053 
00054     <span class="keywordflow">return</span> (<a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a>)lpsz;
00055 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="nt6/dlgbegin.c::ValidateCallback" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL ValidateCallback           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HANDLE&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>h</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="nt6/dlgbegin.c::WordSkipSz" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> WordSkipSz           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UTCHAR *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>lpsz</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00057">57</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00886">NextWordBoundary</a>, <a class="el" href="../../d0/d7/halvprnt_8c-source.html#l00031">PBYTE</a>, and <a class="el" href="../../d3/d0/userexts_8c-source.html#l13551">SkipSz()</a>.
<p>
<pre class="fragment"><div>00059 {
00060     <a class="code" href="../../d9/d7/halvprnt_8c.html#a1">PBYTE</a> pb = <a class="code" href="../../d2/d1/userexts_8c.html#a251">SkipSz</a>(lpsz);
00061     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/usercli_8h.html#a123">NextWordBoundary</a>(pb);
00062 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a6" doxytag="nt6/dlgbegin.c::szEDITCLASS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> CONST WCHAR <a class="el" href="../../d1/d9/nt6_2dlgbegin_8c.html#a6">szEDITCLASS</a>[] = TEXT("Edit")          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html#l00018">18</a> of file <a class="el" href="../../d2/d8/nt6_2dlgbegin_8c-source.html">nt6/dlgbegin.c</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:27 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
