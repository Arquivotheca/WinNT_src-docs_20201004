<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ps.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ps.h File Reference</h1>
<p>
<a href="../../d2/d8/ps_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d6/struct__MMSUPPORT__FLAGS.html">_MMSUPPORT_FLAGS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d6/struct__MMSUPPORT.html">_MMSUPPORT</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html">_PS_IMPERSONATION_INFORMATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">_EPROCESS_QUOTA_BLOCK</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d9/struct__WOW64__PROCESS.html">_WOW64_PROCESS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d4/struct__EPROCESS.html">_EPROCESS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d6/struct__ETHREAD.html">_ETHREAD</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d2/struct__INITIAL__PEB.html">_INITIAL_PEB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d1/struct__PS__JOB__TOKEN__FILTER.html">_PS_JOB_TOKEN_FILTER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d3/struct__EJOB.html">_EJOB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d2/d1/struct__IMAGE__INFO.html">_IMAGE_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/struct__WIN32__JOBCALLOUT__PARAMETERS.html">_WIN32_JOBCALLOUT_PARAMETERS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">_WIN32_POWEREVENT_PARAMETERS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html">_WIN32_POWERSTATE_PARAMETERS</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a0">PSP_INVALID_ID</a>&nbsp;&nbsp;&nbsp;((ULONG_PTR)(0x82)&lt;&lt;((sizeof(ULONG_PTR)-1)*8))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a1">MEMORY_PRIORITY_BACKGROUND</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a2">MEMORY_PRIORITY_WASFOREGROUND</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a3">MEMORY_PRIORITY_FOREGROUND</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a4">PS_WS_TRIM_FROM_EXE_HEADER</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a5">PS_WS_TRIM_BACKGROUND_ONLY_APP</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a6">PS_SET_BITS</a>(Flags, Flag)&nbsp;&nbsp;&nbsp;ExInterlockedSetBits (Flags, Flag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a7">PS_CLEAR_BITS</a>(Flags, Flag)&nbsp;&nbsp;&nbsp;ExInterlockedClearBits (Flags, Flag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a8">PS_SET_CLEAR_BITS</a>(Flags, sFlag, cFlag)&nbsp;&nbsp;&nbsp;ExInterlockedSetClearBits (Flags, sFlag, cFlag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a9">PS_JOB_STATUS_NOT_REALLY_ACTIVE</a>&nbsp;&nbsp;&nbsp;0x00000001</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a10">PS_JOB_STATUS_ACCOUNTING_FOLDED</a>&nbsp;&nbsp;&nbsp;0x00000002</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a11">PS_JOB_STATUS_NEW_PROCESS_REPORTED</a>&nbsp;&nbsp;&nbsp;0x00000004</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a12">PS_JOB_STATUS_EXIT_PROCESS_REPORTED</a>&nbsp;&nbsp;&nbsp;0x00000008</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a13">PS_JOB_STATUS_REPORT_COMMIT_CHANGES</a>&nbsp;&nbsp;&nbsp;0x00000010</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a14">PS_JOB_STATUS_LAST_REPORT_MEMORY</a>&nbsp;&nbsp;&nbsp;0x00000020</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a15">PS_GET_THREAD_CREATE_TIME</a>(Thread)&nbsp;&nbsp;&nbsp;((Thread)-&gt;CreateTime.QuadPart &gt;&gt; 3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a16">PS_SET_THREAD_CREATE_TIME</a>(Thread, InputCreateTime)&nbsp;&nbsp;&nbsp;((Thread)-&gt;CreateTime.QuadPart = (InputCreateTime.QuadPart &lt;&lt; 3))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a17">THREAD_TO_PROCESS</a>(thread)&nbsp;&nbsp;&nbsp;((thread)-&gt;ThreadsProcess)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a18">IS_SYSTEM_THREAD</a>(thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()&nbsp;&nbsp;&nbsp;(CONTAINING_RECORD(((KeGetCurrentThread())-&gt;ApcState.Process),<a class="el" href="../../d0/d4/struct__EPROCESS.html">EPROCESS</a>,Pcb))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()&nbsp;&nbsp;&nbsp;(CONTAINING_RECORD((KeGetCurrentThread()),<a class="el" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a>,Tcb))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a21">PsLockProcessSecurityFields</a>()&nbsp;&nbsp;&nbsp;ExAcquireFastMutex( &amp;<a class="el" href="../../d0/d1/psinit_8c.html#a16">PsProcessSecurityLock</a> )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a22">PsFreeProcessSecurityFields</a>()&nbsp;&nbsp;&nbsp;ExReleaseFastMutex( &amp;<a class="el" href="../../d0/d1/psinit_8c.html#a16">PsProcessSecurityLock</a> )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a23">IMAGE_ADDRESSING_MODE_32BIT</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a24">PsDereferencePrimaryToken</a>(T)&nbsp;&nbsp;&nbsp;(ObDereferenceObject((T)))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a25">PsProcessAuditId</a>(Process)&nbsp;&nbsp;&nbsp;((Process)-&gt;UniqueProcessId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a26">PsDereferenceImpersonationToken</a>(T)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a27">PsIsThreadTerminating</a>(T)&nbsp;&nbsp;&nbsp;(T)-&gt;HasTerminated</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d6/struct__MMSUPPORT__FLAGS.html">_MMSUPPORT_FLAGS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a28">MMSUPPORT_FLAGS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d6/struct__MMSUPPORT.html">_MMSUPPORT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a29">MMSUPPORT</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d6/struct__MMSUPPORT.html">MMSUPPORT</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a30">PMMSUPPORT</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html">_PS_IMPERSONATION_INFORMATION</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a31">PS_IMPERSONATION_INFORMATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html">_PS_IMPERSONATION_INFORMATION</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a32">PPS_IMPERSONATION_INFORMATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">_EPROCESS_QUOTA_BLOCK</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a33">EPROCESS_QUOTA_BLOCK</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">_EPROCESS_QUOTA_BLOCK</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a34">PEPROCESS_QUOTA_BLOCK</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d9/struct__WOW64__PROCESS.html">_WOW64_PROCESS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a35">WOW64_PROCESS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d9/struct__WOW64__PROCESS.html">_WOW64_PROCESS</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a36">PWOW64_PROCESS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d4/struct__EPROCESS.html">_EPROCESS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a37">EPROCESS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d4/struct__EPROCESS.html">EPROCESS</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a38">PEPROCESS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d6/struct__ETHREAD.html">_ETHREAD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a39">ETHREAD</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a40">PETHREAD</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d2/struct__INITIAL__PEB.html">_INITIAL_PEB</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a41">INITIAL_PEB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d2/struct__INITIAL__PEB.html">_INITIAL_PEB</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a42">PINITIAL_PEB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d1/struct__PS__JOB__TOKEN__FILTER.html">_PS_JOB_TOKEN_FILTER</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a43">PS_JOB_TOKEN_FILTER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d1/struct__PS__JOB__TOKEN__FILTER.html">_PS_JOB_TOKEN_FILTER</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a44">PPS_JOB_TOKEN_FILTER</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d3/struct__EJOB.html">_EJOB</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a45">EJOB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d3/struct__EJOB.html">EJOB</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a46">PEJOB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a66">PLEGO_NOTIFY_ROUTINE</a> )(<a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a67">PCREATE_PROCESS_NOTIFY_ROUTINE</a> )(IN HANDLE ParentId, IN HANDLE ProcessId, IN BOOLEAN Create)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a68">PCREATE_THREAD_NOTIFY_ROUTINE</a> )(IN HANDLE ProcessId, IN HANDLE ThreadId, IN BOOLEAN Create)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d1/struct__IMAGE__INFO.html">_IMAGE_INFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a69">IMAGE_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d2/d1/struct__IMAGE__INFO.html">_IMAGE_INFO</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a70">PIMAGE_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a71">PLOAD_IMAGE_NOTIFY_ROUTINE</a> )(IN PUNICODE_STRING FullImageName, IN HANDLE ProcessId, IN <a class="el" href="../../d2/d1/struct__IMAGE__INFO.html">PIMAGE_INFO</a> ImageInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d1/d9/ps_8h.html#a155">_PSLOCKPROCESSMODE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a73">PSLOCKPROCESSMODE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef NTSTATUS(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a74">PKWIN32_PROCESS_CALLOUT</a> )(IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN BOOLEAN Initialize)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d1/d9/ps_8h.html#a156">_PSW32JOBCALLOUTTYPE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a75">PSW32JOBCALLOUTTYPE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d8/struct__WIN32__JOBCALLOUT__PARAMETERS.html">_WIN32_JOBCALLOUT_PARAMETERS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a76">WIN32_JOBCALLOUT_PARAMETERS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d8/struct__WIN32__JOBCALLOUT__PARAMETERS.html">_WIN32_JOBCALLOUT_PARAMETERS</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a77">PKWIN32_JOBCALLOUT_PARAMETERS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef NTSTATUS(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a78">PKWIN32_JOB_CALLOUT</a> )(IN <a class="el" href="../../d4/d8/struct__WIN32__JOBCALLOUT__PARAMETERS.html">PKWIN32_JOBCALLOUT_PARAMETERS</a> Parm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d1/d9/ps_8h.html#a157">_PSW32THREADCALLOUTTYPE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a79">PSW32THREADCALLOUTTYPE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef NTSTATUS(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a80">PKWIN32_THREAD_CALLOUT</a> )(IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread, IN <a class="el" href="../../d1/d9/ps_8h.html#a79">PSW32THREADCALLOUTTYPE</a> CalloutType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d1/d9/ps_8h.html#a158">_PSPOWEREVENTTYPE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a81">PSPOWEREVENTTYPE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">_WIN32_POWEREVENT_PARAMETERS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a82">WIN32_POWEREVENT_PARAMETERS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">_WIN32_POWEREVENT_PARAMETERS</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a83">PKWIN32_POWEREVENT_PARAMETERS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html">_WIN32_POWERSTATE_PARAMETERS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a84">WIN32_POWERSTATE_PARAMETERS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html">_WIN32_POWERSTATE_PARAMETERS</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a85">PKWIN32_POWERSTATE_PARAMETERS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef NTSTATUS(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a86">PKWIN32_POWEREVENT_CALLOUT</a> )(IN <a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">PKWIN32_POWEREVENT_PARAMETERS</a> Parm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef NTSTATUS(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a87">PKWIN32_POWERSTATE_CALLOUT</a> )(IN <a class="el" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html">PKWIN32_POWERSTATE_PARAMETERS</a> Parm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d1/d9/ps_8h.html#a159">_PSPROCESSPRIORITYMODE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a88">PSPROCESSPRIORITYMODE</a></td></tr>

<tr><td colspan=2><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a155">_PSLOCKPROCESSMODE</a> { <a class="el" href="../../d1/d9/ps_8h.html#a155a89">PsLockPollOnTimeout</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a155a90">PsLockReturnTimeout</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a155a91">PsLockWaitForever</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a155a92">PsLockIAmExiting</a>
 }</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a156">_PSW32JOBCALLOUTTYPE</a> { <a class="el" href="../../d1/d9/ps_8h.html#a156a93">PsW32JobCalloutSetInformation</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a156a94">PsW32JobCalloutAddProcess</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a156a95">PsW32JobCalloutTerminate</a>
 }</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a157">_PSW32THREADCALLOUTTYPE</a> { <a class="el" href="../../d1/d9/ps_8h.html#a157a96">PsW32ThreadCalloutInitialize</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a157a97">PsW32ThreadCalloutExit</a>
 }</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a158">_PSPOWEREVENTTYPE</a> { <br>
&nbsp;&nbsp;<a class="el" href="../../d1/d9/ps_8h.html#a158a98">PsW32FullWake</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a158a99">PsW32EventCode</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a158a100">PsW32PowerPolicyChanged</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a158a101">PsW32SystemPowerState</a>, 
<br>
&nbsp;&nbsp;<a class="el" href="../../d1/d9/ps_8h.html#a158a102">PsW32SystemTime</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a158a103">PsW32DisplayState</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a158a104">PsW32CapabilitiesChanged</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a158a105">PsW32SetStateFailed</a>, 
<br>
&nbsp;&nbsp;<a class="el" href="../../d1/d9/ps_8h.html#a158a106">PsW32GdiOff</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a158a107">PsW32GdiOn</a>
<br>
 }</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a159">_PSPROCESSPRIORITYMODE</a> { <a class="el" href="../../d1/d9/ps_8h.html#a159a108">PsProcessPriorityBackground</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a159a109">PsProcessPriorityForeground</a>, 
<a class="el" href="../../d1/d9/ps_8h.html#a159a110">PsProcessPrioritySpinning</a>
 }</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a111">PsChangeJobMemoryUsage</a> (SSIZE_T Amount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a112">PsReportProcessMemoryLimitViolation</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a113">PsEnforceExecutionTimeLimits</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a114">PsInitSystem</a> (IN ULONG Phase, IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a> LoaderBlock)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a115">PsLocateSystemDll</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a116">PsChangeQuantumTable</a> (BOOLEAN ModifyActiveProcesses, ULONG PrioritySeparation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a117">PsExitSpecialApc</a> (IN <a class="el" href="../../d1/d5/struct__KAPC.html">PKAPC</a> Apc, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> *NormalRoutine, IN PVOID *NormalContext, IN PVOID *SystemArgument1, IN PVOID *SystemArgument2)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a118">PsCreateSystemThread</a> (OUT PHANDLE <a class="el" href="../../d2/d1/cttoken_8c.html#a63">ThreadHandle</a>, IN ULONG DesiredAccess, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a> OPTIONAL, IN HANDLE ProcessHandle OPTIONAL, OUT PCLIENT_ID ClientId OPTIONAL, IN <a class="el" href="../../d4/d9/ke_8h.html#a66">PKSTART_ROUTINE</a> StartRoutine, IN PVOID StartContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a119">PsTerminateSystemThread</a> (IN NTSTATUS ExitStatus)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a120">PsCreateSystemProcess</a> (OUT PHANDLE ProcessHandle, IN ULONG DesiredAccess, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a> OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a121">PsSetLegoNotifyRoutine</a> (<a class="el" href="../../d1/d9/ps_8h.html#a66">PLEGO_NOTIFY_ROUTINE</a> LegoNotifyRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a122">PsSetCreateProcessNotifyRoutine</a> (IN <a class="el" href="../../d1/d9/ps_8h.html#a67">PCREATE_PROCESS_NOTIFY_ROUTINE</a> NotifyRoutine, IN BOOLEAN Remove)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a123">PsSetCreateThreadNotifyRoutine</a> (IN <a class="el" href="../../d1/d9/ps_8h.html#a68">PCREATE_THREAD_NOTIFY_ROUTINE</a> NotifyRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a124">PsSetLoadImageNotifyRoutine</a> (IN <a class="el" href="../../d1/d9/ps_8h.html#a71">PLOAD_IMAGE_NOTIFY_ROUTINE</a> NotifyRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a125">PsAssignImpersonationToken</a> (IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread, IN HANDLE <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI PACCESS_TOKEN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a126">PsReferencePrimaryToken</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI PACCESS_TOKEN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a127">PsReferenceImpersonationToken</a> (IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread, OUT PBOOLEAN CopyOnOpen, OUT PBOOLEAN EffectiveOnly, OUT PSECURITY_IMPERSONATION_LEVEL ImpersonationLevel)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PACCESS_TOKEN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a128">PsReferenceEffectiveToken</a> (IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread, OUT PTOKEN_TYPE TokenType, OUT PBOOLEAN EffectiveOnly, OUT PSECURITY_IMPERSONATION_LEVEL ImpersonationLevel)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LARGE_INTEGER&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a129">PsGetProcessExitTime</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a130">PsCallImageNotifyRoutines</a> (IN PUNICODE_STRING FullImageName, IN HANDLE ProcessId, IN <a class="el" href="../../d2/d1/struct__IMAGE__INFO.html">PIMAGE_INFO</a> ImageInfo)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a131">PsImpersonateClient</a> (IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread, IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>, IN BOOLEAN CopyOnOpen, IN BOOLEAN EffectiveOnly, IN SECURITY_IMPERSONATION_LEVEL ImpersonationLevel)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a132">PsDisableImpersonation</a> (IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread, IN PSE_IMPERSONATION_STATE ImpersonationState)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a133">PsRestoreImpersonation</a> (IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread, IN PSE_IMPERSONATION_STATE ImpersonationState)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a134">PsRevertToSelf</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a135">PsOpenTokenOfThread</a> (IN HANDLE <a class="el" href="../../d2/d1/cttoken_8c.html#a63">ThreadHandle</a>, IN BOOLEAN OpenAsSelf, OUT PACCESS_TOKEN *<a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>, OUT PBOOLEAN CopyOnOpen, OUT PBOOLEAN EffectiveOnly, OUT PSECURITY_IMPERSONATION_LEVEL ImpersonationLevel)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a136">PsOpenTokenOfProcess</a> (IN HANDLE ProcessHandle, OUT PACCESS_TOKEN *<a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a137">PsOpenTokenOfJob</a> (IN HANDLE JobHandle, OUT PACCESS_TOKEN *<a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a138">PsLookupProcessThreadByCid</a> (IN PCLIENT_ID Cid, OUT <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> *Process OPTIONAL, OUT <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> *Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a139">PsLookupProcessByProcessId</a> (IN HANDLE ProcessId, OUT <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> *Process)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a140">PsLookupThreadByThreadId</a> (IN HANDLE ThreadId, OUT <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> *Thread)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a141">PsChargePoolQuota</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN ULONG_PTR Amount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a142">PsReturnPoolQuota</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, IN ULONG_PTR Amount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a143">PspContextToKframes</a> (OUT PKTRAP_FRAME TrapFrame, OUT PKEXCEPTION_FRAME ExceptionFrame, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a144">PspContextFromKframes</a> (OUT PKTRAP_FRAME TrapFrame, OUT PKEXCEPTION_FRAME ExceptionFrame, IN PCONTEXT Context)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a145">PsReturnSharedPoolQuota</a> (IN <a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a> QuotaBlock, IN ULONG_PTR PagedAmount, IN ULONG_PTR NonPagedAmount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a146">PsChargeSharedPoolQuota</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN ULONG_PTR PagedAmount, IN ULONG_PTR NonPagedAmount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a147">PsLockProcess</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> WaitMode, IN <a class="el" href="../../d1/d9/ps_8h.html#a73">PSLOCKPROCESSMODE</a> LockMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a148">PsUnlockProcess</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a149">PsForwardException</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN BOOLEAN DebugException, IN BOOLEAN SecondChance)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a150">PsEstablishWin32Callouts</a> (IN <a class="el" href="../../d1/d9/ps_8h.html#a74">PKWIN32_PROCESS_CALLOUT</a> ProcessCallout, IN <a class="el" href="../../d1/d9/ps_8h.html#a80">PKWIN32_THREAD_CALLOUT</a> ThreadCallout, IN <a class="el" href="../../d5/d8/ex_8h.html#a170">PKWIN32_GLOBALATOMTABLE_CALLOUT</a> GlobalAtomTableCallout, IN <a class="el" href="../../d1/d9/ps_8h.html#a86">PKWIN32_POWEREVENT_CALLOUT</a> PowerEventCallout, IN <a class="el" href="../../d1/d9/ps_8h.html#a87">PKWIN32_POWERSTATE_CALLOUT</a> PowerStateCallout, IN <a class="el" href="../../d1/d9/ps_8h.html#a78">PKWIN32_JOB_CALLOUT</a> JobCallout, IN PVOID BatchFlushRoutine)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a151">PsSetProcessPriorityByClass</a> (IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN <a class="el" href="../../d1/d9/ps_8h.html#a88">PSPROCESSPRIORITYMODE</a> PriorityMode)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a152">PsGetCurrentProcessId</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>HANDLE&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a153">PsGetCurrentThreadId</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a154">PsGetVersion</a> (PULONG MajorVersion OPTIONAL, PULONG MinorVersion OPTIONAL, PULONG BuildNumber OPTIONAL, PUNICODE_STRING CSDVersion OPTIONAL)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a47">PsPrioritySeperation</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a48">PsRawPrioritySeparation</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a49">PsActiveProcessHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>UNICODE_STRING&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a50">PsNtDllPathName</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a51">PsSystemDllBase</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a52">PsProcessSecurityLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a53">PsInitialSystemProcess</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a54">PsNtosImageBase</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a55">PsHalImageBase</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a56">PsLoadedModuleList</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a57">PsLoadedModuleResource</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LCID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a58">PsDefaultSystemLocaleId</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LCID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a59">PsDefaultThreadLocaleId</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LANGID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a60">PsDefaultUILanguageId</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LANGID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a61">PsInstallUILanguageId</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a62">PsIdleProcess</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a63">PsReaperActive</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LIST_ENTRY&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a64">PsReaperListHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">WORK_QUEUE_ITEM</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a65">PsReaperWorkItem</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/ps_8h.html#a72">PsImageNotifyEnabled</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a23" doxytag="ps.h::IMAGE_ADDRESSING_MODE_32BIT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IMAGE_ADDRESSING_MODE_32BIT&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00769">769</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00211">DbgkCreateThread()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, and <a class="el" href="../../d4/d4/mapview_8c-source.html#l01567">MiMapViewOfImageSection()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="ps.h::IS_SYSTEM_THREAD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IS_SYSTEM_THREAD          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">thread&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(((thread)-&gt;Tcb.Teb == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) ||                         \
            (<a class="code" href="../../d2/d1/mm_8h.html#a10">IS_SYSTEM_ADDRESS</a>((thread)-&gt;Tcb.Teb)))
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00639">639</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00349">ExpRaiseHardError()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l07673">IoIsSystemThread()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00151">NtGetContextThread()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00056">NtQueueApcThread()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00029">NtReplyWaitReceivePort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00635">NtReplyWaitReceivePortEx()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00352">NtSetContextThread()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00227">NtTerminateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00461">NtTerminateThread()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">PsAssignImpersonationToken()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00631">PspExitNormalApc()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00384">PspTerminateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00546">PsTerminateSystemThread()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>, <a class="el" href="../../d3/d8/w32_2ntuser_2kernel_2heap_8c-source.html#l00015">UserCommitDesktopMemory()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02519">UserGetDesktopDC()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02841">VerifierExAcquireFastMutexUnsafe()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02182">VerifierExAcquireResourceExclusive()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02870">VerifierExReleaseFastMutex()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02899">VerifierExReleaseFastMutexUnsafe()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02208">VerifierExReleaseResource()</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l03358">xxxSwitchDesktop()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ps.h::MEMORY_PRIORITY_BACKGROUND" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MEMORY_PRIORITY_BACKGROUND&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00041">41</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/procsup_8c-source.html#l05567">MmSetMemoryPriorityProcess()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00878">PsChangeQuantumTable()</a>, and <a class="el" href="../../d0/d1/psquery_8c-source.html#l03916">PsSetProcessPriorityByClass()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ps.h::MEMORY_PRIORITY_FOREGROUND" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MEMORY_PRIORITY_FOREGROUND&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00043">43</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00031">KiUnwaitThread()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l01372">MiCheckProcessTrimCriteria()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l01644">MiDetermineWsTrimAmount()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l00254">MiDoReplacement()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l02465">MiRearrangeWorkingSetExpansionList()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02262">PspApplyJobLimitsToProcess()</a>, and <a class="el" href="../../d0/d1/psquery_8c-source.html#l03916">PsSetProcessPriorityByClass()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ps.h::MEMORY_PRIORITY_WASFOREGROUND" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MEMORY_PRIORITY_WASFOREGROUND&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00042">42</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ps.h::PS_CLEAR_BITS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_CLEAR_BITS          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Flags,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Flag&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExInterlockedClearBits (Flags, Flag)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00151">151</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l02396">PsEnforceExecutionTimeLimits()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="ps.h::PS_GET_THREAD_CREATE_TIME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_GET_THREAD_CREATE_TIME          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Thread&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((Thread)-&gt;CreateTime.QuadPart &gt;&gt; 3)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00341">341</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l03427">ExpCopyThreadInfo()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l02706">NtQueryInformationThread()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ps.h::PS_JOB_STATUS_ACCOUNTING_FOLDED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_JOB_STATUS_ACCOUNTING_FOLDED&nbsp;&nbsp;&nbsp;0x00000002          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00315">315</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l00814">NtQueryInformationJobObject()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02396">PsEnforceExecutionTimeLimits()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00439">PspAddProcessToJob()</a>, and <a class="el" href="../../d2/d0/psjob_8c-source.html#l02632">PspFoldProcessAccountingIntoJob()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ps.h::PS_JOB_STATUS_EXIT_PROCESS_REPORTED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_JOB_STATUS_EXIT_PROCESS_REPORTED&nbsp;&nbsp;&nbsp;0x00000008          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00317">317</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01232">PspExitProcess()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="ps.h::PS_JOB_STATUS_LAST_REPORT_MEMORY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_JOB_STATUS_LAST_REPORT_MEMORY&nbsp;&nbsp;&nbsp;0x00000020          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00319">319</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02823">PsChangeJobMemoryUsage()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02396">PsEnforceExecutionTimeLimits()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00439">PspAddProcessToJob()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01232">PspExitProcess()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02632">PspFoldProcessAccountingIntoJob()</a>, and <a class="el" href="../../d2/d0/psjob_8c-source.html#l02901">PsReportProcessMemoryLimitViolation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ps.h::PS_JOB_STATUS_NEW_PROCESS_REPORTED" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_JOB_STATUS_NEW_PROCESS_REPORTED&nbsp;&nbsp;&nbsp;0x00000004          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00316">316</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02823">PsChangeJobMemoryUsage()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00439">PspAddProcessToJob()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, and <a class="el" href="../../d2/d0/psjob_8c-source.html#l02901">PsReportProcessMemoryLimitViolation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ps.h::PS_JOB_STATUS_NOT_REALLY_ACTIVE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_JOB_STATUS_NOT_REALLY_ACTIVE&nbsp;&nbsp;&nbsp;0x00000001          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00314">314</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l00814">NtQueryInformationJobObject()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02396">PsEnforceExecutionTimeLimits()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00439">PspAddProcessToJob()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02210">PspApplyJobLimitsToProcessSet()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01232">PspExitProcess()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00608">PspExitProcessFromJob()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00579">PspRemoveProcessFromJob()</a>, and <a class="el" href="../../d2/d0/psjob_8c-source.html#l02570">PspTerminateAllProcessesInJob()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="ps.h::PS_JOB_STATUS_REPORT_COMMIT_CHANGES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_JOB_STATUS_REPORT_COMMIT_CHANGES&nbsp;&nbsp;&nbsp;0x00000010          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00318">318</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00030">MiInsertVad()</a>, <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00256">MiRemoveVad()</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l00869">MiReturnPageTablePageCommitment()</a>, <a class="el" href="../../d1/d8/protect_8c-source.html#l01110">MiSetProtectionOnSection()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l02386">MmAssignProcessToJob()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l01695">MmCleanProcessAddressSpace()</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l00075">NtAllocateVirtualMemory()</a>, and <a class="el" href="../../d4/d6/freevm_8c-source.html#l00066">NtFreeVirtualMemory()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ps.h::PS_SET_BITS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_SET_BITS          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Flags,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>Flag&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExInterlockedSetBits (Flags, Flag)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00148">148</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l02823">PsChangeJobMemoryUsage()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00439">PspAddProcessToJob()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00608">PspExitProcessFromJob()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00579">PspRemoveProcessFromJob()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02570">PspTerminateAllProcessesInJob()</a>, and <a class="el" href="../../d2/d0/psjob_8c-source.html#l02901">PsReportProcessMemoryLimitViolation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ps.h::PS_SET_CLEAR_BITS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_SET_CLEAR_BITS          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Flags,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>sFlag,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>cFlag&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExInterlockedSetClearBits (Flags, sFlag, cFlag)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00154">154</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l01323">NtSetInformationJobObject()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02396">PsEnforceExecutionTimeLimits()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00439">PspAddProcessToJob()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01232">PspExitProcess()</a>, and <a class="el" href="../../d2/d0/psjob_8c-source.html#l02632">PspFoldProcessAccountingIntoJob()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="ps.h::PS_SET_THREAD_CREATE_TIME" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_SET_THREAD_CREATE_TIME          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Thread,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>InputCreateTime&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((Thread)-&gt;CreateTime.QuadPart = (InputCreateTime.QuadPart &lt;&lt; 3))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00343">343</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ps.h::PS_WS_TRIM_BACKGROUND_ONLY_APP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_WS_TRIM_BACKGROUND_ONLY_APP&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00133">133</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/psquery_8c-source.html#l03916">PsSetProcessPriorityByClass()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ps.h::PS_WS_TRIM_FROM_EXE_HEADER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PS_WS_TRIM_FROM_EXE_HEADER&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00132">132</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="ps.h::PsDereferenceImpersonationToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PsDereferenceImpersonationToken          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">T&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>{<span class="keywordflow">if</span> (ARGUMENT_PRESENT(T)) {                                       \
                (<a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>((T)));                                   \
             } <span class="keywordflow">else</span> {                                                         \
                ;                                                             \
             }                                                                \
            }
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00840">840</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00650">PsImpersonateClient()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00326">PsOpenTokenOfThread()</a>, <a class="el" href="../../d5/d4/seclient_8c-source.html#l00062">SepCreateClientSecurity()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00294">SepOpenTokenOfThread()</a>, and <a class="el" href="../../d1/d7/subject_8c-source.html#l00196">SeReleaseSubjectContext()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="ps.h::PsDereferencePrimaryToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PsDereferencePrimaryToken          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">T&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(ObDereferenceObject((T)))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00810">810</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00458">NtOpenThreadToken()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00366">PspSetPrimaryToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02867">SeIsChildToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02960">SeIsChildTokenByPointer()</a>, <a class="el" href="../../d5/d4/seclient_8c-source.html#l00062">SepCreateClientSecurity()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00196">SeReleaseSubjectContext()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l01327">SeSubProcessToken()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="ps.h::PsFreeProcessSecurityFields" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PsFreeProcessSecurityFields          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExReleaseFastMutex( &amp;<a class="el" href="../../d0/d1/psinit_8c.html#a16">PsProcessSecurityLock</a> )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00661">661</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l00266">NtAssignProcessToJobObject()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00888">PsDisableImpersonation()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00650">PsImpersonateClient()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01256">PspAssignPrimaryToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00208">PsReferenceEffectiveToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00097">PsReferenceImpersonationToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00028">PsReferencePrimaryToken()</a>, and <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01051">PsRevertToSelf()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="ps.h::PsGetCurrentProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PsGetCurrentProcess          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(CONTAINING_RECORD(((KeGetCurrentThread())-&gt;ApcState.Process),<a class="el" href="../../d0/d4/struct__EPROCESS.html">EPROCESS</a>,Pcb))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">643</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l01568">_LoadCursorsAndIcons()</a>, <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00125">_RegisterHotKey()</a>, <a class="el" href="../../d1/d7/dir_8c-source.html#l00057">BuildQueryDirectoryIrp()</a>, <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04557">CheckHandleInUse()</a>, <a class="el" href="../../d8/d4/w32_2ntuser_2kernel_2security_8c-source.html#l00518">CheckWinstaWriteAttributesAccess()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l00293">CmInitSystem1()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01028">CmNotifyRunDown()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l01165">CmpCreateRegistryRoot()</a>, <a class="el" href="../../d4/d1/cmparse2_8c-source.html#l00226">CmpDoCreateChild()</a>, <a class="el" href="../../d3/d1/cmparse_8c-source.html#l00963">CmpDoOpen()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00804">CmpPostApc()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00922">CmpPostApcRunDown()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00278">CommitReadOnlyMemory()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00211">DbgkCreateThread()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00528">DbgkExitProcess()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00471">DbgkExitThread()</a>, <a class="el" href="../../d7/d2/dbgkport_8c-source.html#l00099">DbgkForwardException()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00586">DbgkMapViewOfSection()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00086">DbgkpResumeProcess()</a>, <a class="el" href="../../d7/d2/dbgkport_8c-source.html#l00031">DbgkpSendApiMessage()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00036">DbgkpSuspendProcess()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00664">DbgkUnMapViewOfSection()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00694">ExAllocatePoolWithQuota()</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02607">ExAllocatePoolWithQuotaTag()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01475">ExpAllocateHandleTable()</a>, <a class="el" href="../../d3/d4/mutant_8c-source.html#l00095">ExpMutantInitialization()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00349">ExpRaiseHardError()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00806">FastGetProfileStringW()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00325">InitializePool()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l06960">IoGetCurrentProcess()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00084">IopChainDereferenceComplete()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00036">IopCloseFile()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l02795">IopWriteTriageDump()</a>, <a class="el" href="../../d4/d0/biosc_8c-source.html#l00060">Ke386CallBios()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00109">KeFlushEntireTb()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00247">KeFlushMultipleTb()</a>, <a class="el" href="../../d0/d5/ia64_2flushtb_8c-source.html#l00427">KeFlushSingleTb()</a>, <a class="el" href="../../d1/d8/ia64_2gdtsup_8c-source.html#l00032">KeIA32GetGdtEntryThread()</a>, <a class="el" href="../../d3/d5/ia64_2iopm_8c-source.html#l00048">KeIA32SetIoAccessMap()</a>, <a class="el" href="../../d6/d2/ia64_2ldtsup_8c-source.html#l00036">KeIA32SetLdtProcess()</a>, <a class="el" href="../../d6/d3/ke_2ia64_2callback_8c-source.html#l00030">KeUserModeCallback()</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00307">Ki386VdmDispatchIo()</a>, <a class="el" href="../../d0/d3/ke_2i386_2vdm_8c-source.html#l00418">Ki386VdmDispatchStringIo()</a>, <a class="el" href="../../d9/d7/alpha_2exceptn_8c-source.html#l00412">KiDispatchException()</a>, <a class="el" href="../../d5/d4/ia64_2trapc_8c-source.html#l00056">KiMemoryFault()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00915">LpcpCopyRequestData()</a>, <a class="el" href="../../d7/d5/lpccreat_8c-source.html#l00136">LpcpCreatePort()</a>, <a class="el" href="../../d4/d5/lpcclose_8c-source.html#l00110">LpcpDeletePort()</a>, <a class="el" href="../../d4/d6/lpcqueue_8c-source.html#l00980">LpcpFindDataInfoMessage()</a>, <a class="el" href="../../d4/d6/lpcqueue_8c-source.html#l00879">LpcpFreeDataInfoMessage()</a>, <a class="el" href="../../d4/d6/lpcqueue_8c-source.html#l00809">LpcpSaveDataInfoMessage()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l01181">LpcRequestPort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l01407">LpcRequestWaitReplyPort()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l04056">MiAddValidPageToWorkingSet()</a>, <a class="el" href="../../d4/d6/session_8c-source.html#l01181">MiAttachSession()</a>, <a class="el" href="../../d6/d2/acceschk_8c-source.html#l00194">MiCheckForUserStackOverflow()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l00100">MiCloneProcessAddressSpace()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l01762">MiCompleteProtoPteFault()</a>, <a class="el" href="../../d4/d9/wrtfault_8c-source.html#l00025">MiCopyOnWrite()</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l02361">MiDeletePageTablesForPhysicalRange()</a>, <a class="el" href="../../d9/d5/deleteva_8c-source.html#l00026">MiDeleteVirtualAddresses()</a>, <a class="el" href="../../d4/d6/session_8c-source.html#l01544">MiDereferenceSession()</a>, <a class="el" href="../../d4/d6/session_8c-source.html#l01253">MiDetachSession()</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00529">MiDoMappedCopy()</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00758">MiDoPoolCopy()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l03974">MiEliminateWorkingSetEntry()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l04726">MiEmptyWorkingSet()</a>, <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00431">MiFindEmptyAddressRange()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l04532">MiFindImageSectionObject()</a>, <a class="el" href="../../d1/d8/protect_8c-source.html#l02079">MiFlushTbAndCapture()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l04378">MiGetPageForHeader()</a>, <a class="el" href="../../d6/d2/queryvm_8c-source.html#l00890">MiGetWorkingSetInfo()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l04868">MiGetWritablePagesInSection()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l03300">MiGrowWsleHash()</a>, <a class="el" href="../../d3/d0/inialpha_8c-source.html#l00041">MiInitMachineDependent()</a>, <a class="el" href="../../d1/d7/creasect_8c-source.html#l04638">MiInsertImageSectionObject()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00059">MiInsertPageInList()</a>, <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00030">MiInsertVad()</a>, <a class="el" href="../../d8/d9/wstree_8c-source.html#l00051">MiInsertWsle()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l01474">MiLoadImageSection()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00380">MiLocateAddress()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l02785">MiMapLockedPagesInUserSpace()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l02110">MiRemoveUserPhysicalPagesVad()</a>, <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00256">MiRemoveVad()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l04228">MiRemoveWorkingSetPages()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00191">MiSegmentDelete()</a>, <a class="el" href="../../d4/d6/session_8c-source.html#l00178">MiSessionAddProcess()</a>, <a class="el" href="../../d4/d6/session_8c-source.html#l00259">MiSessionRemoveProcess()</a>, <a class="el" href="../../d5/d6/sessload_8c-source.html#l00936">MiSessionWideReserveImageAddress()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l03253">MiUnmapLockedPagesInUserSpace()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l01078">MiUpdateWsle()</a>, <a class="el" href="../../d5/d0/mmfault_8c-source.html#l00041">MmAccessFault()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l02450">MmAdjustWorkingSetSize()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l04948">MmAllowWorkingSetExpansion()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l02386">MmAssignProcessToJob()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l01695">MmCleanProcessAddressSpace()</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00362">MmCopyVirtualMemory()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l00190">MmCreateProcessAddressSpace()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l00543">MmEnforceWorkingSetLimit()</a>, <a class="el" href="../../d7/d4/flushsec_8c-source.html#l00297">MmFlushVirtualMemory()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l00184">MmInitSystem()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l05161">MmMapUserAddressesToPage()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l03211">MmMapViewInSessionSpace()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l00753">MmMapViewOfSection()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l00238">MmProbeAndLockPages()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l00813">MmProbeAndLockProcessPages()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l04177">MmSecureVirtualMemory()</a>, <a class="el" href="../../d4/d6/session_8c-source.html#l00974">MmSessionCreate()</a>, <a class="el" href="../../d4/d6/session_8c-source.html#l01093">MmSessionDelete()</a>, <a class="el" href="../../d4/d6/session_8c-source.html#l00140">MmSessionSetUnloadAddress()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l05567">MmSetMemoryPriorityProcess()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l03639">MmUnmapViewInSessionSpace()</a>, <a class="el" href="../../d5/d8/umapview_8c-source.html#l00090">MmUnmapViewOfSection()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l04614">MmUnsecureVirtualMemory()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l00397">MmWorkingSetManager()</a>, <a class="el" href="../../d5/d5/lpccompl_8c-source.html#l00040">NtAcceptConnectPort()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l00970">NtAllocateUserPhysicalPages()</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l00075">NtAllocateVirtualMemory()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l02965">NtAreMappedFilesTheSame()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00101">NtCreateChannel()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00048">NtCreateJobObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l00163">NtDuplicateObject()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l01624">NtFreeUserPhysicalPages()</a>, <a class="el" href="../../d4/d6/freevm_8c-source.html#l00066">NtFreeVirtualMemory()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00035">NtLoadDriver()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00035">NtLockFile()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l00085">NtMapUserPhysicalPages()</a>, <a class="el" href="../../d9/d4/physical_8c-source.html#l00498">NtMapUserPhysicalPagesScatter()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l00199">NtMapViewOfSection()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01319">NtNotifyChangeMultipleKeys()</a>, <a class="el" href="../../d5/d5/channel_8c-source.html#l00348">NtOpenChannel()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d1/d8/protect_8c-source.html#l00069">NtProtectVirtualMemory()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00101">NtQueryInformationFile()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00814">NtQueryInformationJobObject()</a>, <a class="el" href="../../d1/d2/qsquota_8c-source.html#l00035">NtQueryQuotaInformationFile()</a>, <a class="el" href="../../d6/d2/queryvm_8c-source.html#l00061">NtQueryVirtualMemory()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00037">NtQueryVolumeInformationFile()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00730">NtReadFileScatter()</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00102">NtReadVirtualMemory()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00044">NtReplyPort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00029">NtReplyWaitReceivePort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00635">NtReplyWaitReceivePortEx()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00375">NtReplyWaitReplyPort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00032">NtRequestPort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00395">NtRequestWaitReplyPort()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00886">NtSetDefaultHardErrorPort()</a>, <a class="el" href="../../d1/d7/ex_2event_8c-source.html#l00748">NtSetEvent()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00849">NtSetInformationFile()</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00545">NtSetInformationObject()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l01235">NtSetLdtEntries()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00492">NtSetVolumeInformationFile()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00227">NtTerminateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00461">NtTerminateThread()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00244">NtUnloadDriver()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00458">NtUnlockFile()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02713">NtUserInitialize()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l01434">NtUserSetThreadDesktop()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00406">NtWaitForMultipleObjects()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00801">NtWriteFileGather()</a>, <a class="el" href="../../d0/d5/readwrt_8c-source.html#l00231">NtWriteVirtualMemory()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">ObInitSystem()</a>, <a class="el" href="../../d7/d9/obcreate_8c-source.html#l00761">ObpAllocateObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01861">ObpChargeQuotaForObject()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l02160">ObpCreateHandle()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l02507">ObpCreateUnnamedHandle()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01232">ObpIncrementHandleCount()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l01587">ObpIncrementUnnamedHandleCount()</a>, <a class="el" href="../../d9/d9/obdir_8c-source.html#l01081">ObpLookupObjectName()</a>, <a class="el" href="../../d5/d0/oblink_8c-source.html#l01121">ObpProcessDosDeviceSymbolicLink()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d8/d9/obdevmap_8c-source.html#l00030">ObSetDeviceMap()</a>, <a class="el" href="../../d2/d6/w32_2ntuser_2kernel_2profile_8c-source.html#l00263">OpenCacheKeyEx()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">PsAssignImpersonationToken()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02823">PsChangeJobMemoryUsage()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03964">PsConvertToGuiThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01539">PsGetProcessExitTime()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00525">PsLocateSystemDll()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00384">PspTerminateProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01800">PspUserThreadStartup()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02901">PsReportProcessMemoryLimitViolation()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03788">PsWatchWorkingSet()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00985">ResetSharedDesktops()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02867">SeIsChildToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02960">SeIsChildTokenByPointer()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01312">SepAdtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01465">SepAdtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01794">SepAdtHandleAuditAlarm()</a>, <a class="el" href="../../d0/d5/seinit_8c-source.html#l00078">SepInitializationPhase0()</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00466">SepRmCommandServerThreadInit()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04579">SetHandleInUse()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l01456">SmbTraceCompleteRdr()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l01242">SmbTraceCompleteSrv()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l01879">SmbTraceDisconnect()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l00551">SmbTraceStart()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l01050">SmbTraceStop()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l02425">SmbTraceToClient()</a>, <a class="el" href="../../d3/d8/w32_2ntuser_2kernel_2heap_8c-source.html#l00015">UserCommitDesktopMemory()</a>, <a class="el" href="../../d3/d8/w32_2ntuser_2kernel_2heap_8c-source.html#l00133">UserCommitSharedMemory()</a>, <a class="el" href="../../d3/d8/w32_2ntuser_2kernel_2heap_8c-source.html#l00189">UserCreateHeap()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l03035">UserGlobalAtomTableCallout()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00477">VdmDispatchInterrupts()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01709">VdmpDelayIntApcRoutine()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01235">VdmpDelayInterrupt()</a>, <a class="el" href="../../d8/d3/vdminit_8c-source.html#l00019">VdmpInitialize()</a>, <a class="el" href="../../d5/d4/vdmprint_8c-source.html#l00295">VdmpPrinterInitialize()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00232">VdmpQueueIntApcRoutine()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00146">VdmpQueueInterrupt()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00408">VdmpQueueIntNormalRoutine()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02249">Win32UserInitialize()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l01343">xxxCreateDesktop2()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04309">xxxGetInputDesktop()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04211">xxxGetThreadDesktop()</a>, <a class="el" href="../../d7/d1/kbdlyout_8c-source.html#l01203">xxxInternalActivateKeyboardLayout()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04821">xxxResolveDesktop()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l01077">xxxSetProcessWindowStation()</a>, and <a class="el" href="../../d8/d0/ntuser_2kernel_2cursor_8c-source.html#l00216">zzzClipCursor()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="ps.h::PsGetCurrentThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PsGetCurrentThread          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(CONTAINING_RECORD((KeGetCurrentThread()),<a class="el" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a>,Tcb))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">645</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d3/kernel_2ddetrack_8c-source.html#l02256">_ImpersonateDdeClientWindow()</a>, <a class="el" href="../../d5/d7/syscmd_8c-source.html#l00583">_RegisterTasklist()</a>, <a class="el" href="../../d1/d7/dir_8c-source.html#l00057">BuildQueryDirectoryIrp()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l00031">CcCopyRead()</a>, <a class="el" href="../../d6/d6/copysup_8c-source.html#l00588">CcFastCopyRead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l06024">CcMapAndCopy()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l05749">CcMapAndRead()</a>, <a class="el" href="../../d3/d8/pinsup_8c-source.html#l00052">CcMapData()</a>, <a class="el" href="../../d8/d4/mdlsup_8c-source.html#l00030">CcMdlRead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l01633">CcPerformReadAhead()</a>, <a class="el" href="../../d7/d1/cachesub_8c-source.html#l02717">CcSetValidData()</a>, <a class="el" href="../../d9/d7/ntuser_2kernel_2clipbrd_8c-source.html#l00049">CheckClipboardAccess()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l00885">CloseDevice()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l01378">CmpNotifyChangeKey()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00211">DbgkCreateThread()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00528">DbgkExitProcess()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00471">DbgkExitThread()</a>, <a class="el" href="../../d7/d2/dbgkport_8c-source.html#l00099">DbgkForwardException()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00586">DbgkMapViewOfSection()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00664">DbgkUnMapViewOfSection()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l01025">DeviceNotify()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00492">ExAcquireResourceExclusiveLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00762">ExAcquireResourceSharedLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01014">ExAcquireSharedStarveExclusive()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01165">ExAcquireSharedWaitForExclusive()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00413">ExAllocatePool()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01942">ExConvertExclusiveToSharedLite()</a>, <a class="el" href="../../d5/d4/logger_8c-source.html#l00106">ExDebugLogEvent()</a>, <a class="el" href="../../d6/d1/poolhack_8c-source.html#l00970">ExFreePool()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02187">ExIsResourceAcquiredExclusiveLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l02245">ExIsResourceAcquiredSharedLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00410">ExpAcquireResourceExclusiveLite()</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00349">ExpRaiseHardError()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00081">ExpTimerApcRoutine()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00538">ExpWorkerThread()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01389">ExReleaseResourceLite()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l01820">ExSetResourceOwnerPointer()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00346">ExTimerRundown()</a>, <a class="el" href="../../d9/d7/ex_2resource_8c-source.html#l00598">ExTryToAcquireResourceExclusiveLite()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l00054">FsRtlCopyRead()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l00330">FsRtlCopyWrite()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l02691">FsRtlGetFileSize()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l01064">FsRtlMdlReadDev()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l01474">FsRtlPrepareMdlWriteDev()</a>, <a class="el" href="../../d4/d0/fastio_8c-source.html#l02864">FsRtlSetFileSize()</a>, <a class="el" href="../../d5/d4/stackovf_8c-source.html#l00294">FsRtlStackOverflowRead()</a>, <a class="el" href="../../d5/d4/stackovf_8c-source.html#l00345">FsRtlWorkerThread()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00101">FullScreenCleanup()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00050">GetProcessLuid()</a>, <a class="el" href="../../d2/d9/kernel_2exitwin_8c-source.html#l00119">InitiateShutdown()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00191">InitSystemThread()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l00934">IoAsynchronousPageWrite()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l01360">IoBuildAsynchronousFsdRequest()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l01552">IoBuildDeviceIoControlRequest()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12535">IoCancelFileOpen()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l02242">IoCancelThreadIo()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l07212">IoGetInitialStack()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l07409">IoGetTopLevelIrp()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l08509">IoPageRead()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00262">IopAsynchronousCall()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00036">IopCloseFile()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l01019">IopCompleteRequest()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00417">IopDeleteFile()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l01623">IopDisassociateThreadIrp()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00730">IopEjectDevice()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l03255">IopFilterResourceRequirementsCall()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l02256">IopGetFileName()</a>, <a class="el" href="../../d4/d0/objsup_8c-source.html#l00975">IopGetSetSecurityObject()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l04282">IopMountVolume()</a>, <a class="el" href="../../d5/d2/parse_8c-source.html#l00202">IopParseDevice()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l05397">IopQueryXxxInformation()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06326">IopSetEaOrQuotaInformationFile()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00381">IopSynchronousCall()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12345">IopUpdateOtherOperationCount()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12441">IopUpdateOtherTransferCount()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12377">IopUpdateReadOperationCount()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12473">IopUpdateReadTransferCount()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12410">IopUpdateWriteOperationCount()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12504">IopUpdateWriteTransferCount()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l02795">IopWriteTriageDump()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l08084">IopXxxControlFile()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l08909">IoRaiseInformationalHardError()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12782">IoRetryIrpCompletions()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l09835">IoSetInformation()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l10281">IoSetThreadHardErrorMode()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l10321">IoSetTopLevelIrp()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l10957">IoSynchronousPageWrite()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l11389">IoVerifyVolume()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l03132">IovpAllocateIrp1()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l00493">IovpCallDriver1()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l00948">IovpCallDriver2()</a>, <a class="el" href="../../d8/d3/flunkirp_8c-source.html#l01531">IovpThrowBogusSynchronousIrp()</a>, <a class="el" href="../../d6/d2/ia64_2ldtsup_8c-source.html#l00036">KeIA32SetLdtProcess()</a>, <a class="el" href="../../d7/d5/lpccreat_8c-source.html#l00136">LpcpCreatePort()</a>, <a class="el" href="../../d4/d5/lpcclose_8c-source.html#l00110">LpcpDeletePort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l01181">LpcRequestPort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l01407">LpcRequestWaitReplyPort()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l10107">MESSAGECALL()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l02824">MiAddWorkingSetPage()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l03179">MiAddWsleHash()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00807">MiAllocatePoolPages()</a>, <a class="el" href="../../d6/d2/acceschk_8c-source.html#l00194">MiCheckForUserStackOverflow()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l00166">MiCheckPageFilePath()</a>, <a class="el" href="../../d9/d5/forksup_8c-source.html#l00100">MiCloneProcessAddressSpace()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l01762">MiCompleteProtoPteFault()</a>, <a class="el" href="../../d4/d9/wrtfault_8c-source.html#l00025">MiCopyOnWrite()</a>, <a class="el" href="../../d6/d4/sectsup_8c-source.html#l00603">MiDereferenceSegmentThread()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l00068">MiDispatchFault()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l02715">MiEmptyAllWorkingSets()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l04726">MiEmptyWorkingSet()</a>, <a class="el" href="../../d8/d4/pfnlist_8c-source.html#l00941">MiEnsureAvailablePageOrWait()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l04152">MiGetInPageSupportBlock()</a>, <a class="el" href="../../d4/d4/lockvm_8c-source.html#l01051">MiInsertConflictInList()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l06461">MiLockCode()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l04034">MiMakeSpecialPoolPagable()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l04239">MiMappedPageWriter()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l02669">MiModifiedPageWriter()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l00674">MiResolveDemandZeroFault()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l01989">MiResolveMappedFileFault()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l01272">MiResolvePageFileFault()</a>, <a class="el" href="../../d9/d1/pagfault_8c-source.html#l00868">MiResolveTransitionFault()</a>, <a class="el" href="../../d4/d6/session_8c-source.html#l02318">MiSessionCommitPageTables()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l01078">MiUpdateWsle()</a>, <a class="el" href="../../d5/d0/mmfault_8c-source.html#l00041">MmAccessFault()</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l01016">MmCheckCachedPageState()</a>, <a class="el" href="../../d2/d4/mapcache_8c-source.html#l01274">MmCopyToCachedPage()</a>, <a class="el" href="../../d7/d4/flushsec_8c-source.html#l00668">MmFlushSection()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l03742">MmFreeSpecialPool()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l02921">MmGrowKernelStack()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l07167">MmIsRecursiveIoFault()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l00238">MmProbeAndLockPages()</a>, <a class="el" href="../../d2/d5/allocpag_8c-source.html#l00589">MmResourcesAvailable()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l02986">MmTrimAllSystemPagableMemory()</a>, <a class="el" href="../../d6/d9/wsmanage_8c-source.html#l00397">MmWorkingSetManager()</a>, <a class="el" href="../../d5/d5/lpccompl_8c-source.html#l00040">NtAcceptConnectPort()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00049">NtCancelIoFile()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00386">NtFlushBuffersFile()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00151">NtGetContextThread()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00035">NtLockFile()</a>, <a class="el" href="../../d1/d7/dir_8c-source.html#l00821">NtNotifyChangeDirectoryFile()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00458">NtOpenThreadToken()</a>, <a class="el" href="../../d8/d1/qsea_8c-source.html#l00035">NtQueryEaFile()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00101">NtQueryInformationFile()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l02706">NtQueryInformationThread()</a>, <a class="el" href="../../d1/d2/qsquota_8c-source.html#l00035">NtQueryQuotaInformationFile()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00037">NtQueryVolumeInformationFile()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00036">NtReadFile()</a>, <a class="el" href="../../d7/d4/io_2read_8c-source.html#l00730">NtReadFileScatter()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01472">NtRegisterThreadTerminatePort()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00044">NtReplyPort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00029">NtReplyWaitReceivePort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00635">NtReplyWaitReceivePortEx()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00375">NtReplyWaitReplyPort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00032">NtRequestPort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00395">NtRequestWaitReplyPort()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>, <a class="el" href="../../d3/d9/psctx_8c-source.html#l00352">NtSetContextThread()</a>, <a class="el" href="../../d8/d1/qsea_8c-source.html#l00652">NtSetEaFile()</a>, <a class="el" href="../../d0/d2/qsinfo_8c-source.html#l00849">NtSetInformationFile()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d3/d1/timer_8c-source.html#l00960">NtSetTimer()</a>, <a class="el" href="../../d9/d1/qsfs_8c-source.html#l00492">NtSetVolumeInformationFile()</a>, <a class="el" href="../../d2/d1/psspnd_8c-source.html#l00033">NtSuspendThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00227">NtTerminateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00461">NtTerminateThread()</a>, <a class="el" href="../../d2/d4/lock_8c-source.html#l00458">NtUnlockFile()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00035">NtWriteFile()</a>, <a class="el" href="../../d1/d9/io_2write_8c-source.html#l00801">NtWriteFileGather()</a>, <a class="el" href="../../d1/d0/obinit_8c-source.html#l00117">ObInitSystem()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l00807">OpenDevice()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03964">PsConvertToGuiThread()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02306">PsGetCurrentProcessId()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02312">PsGetCurrentThreadId()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01966">PsLockProcess()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00326">PsOpenTokenOfThread()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00631">PspExitNormalApc()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, <a class="el" href="../../d8/d9/psctxppc_8c-source.html#l00386">PspGetSetContextApc()</a>, <a class="el" href="../../d7/d9/psctxmip_8c-source.html#l00475">PspGetSetContextSpecialApc()</a>, <a class="el" href="../../d5/d9/psctxalp_8c-source.html#l00349">PspGetSetContextSpecialApcMain()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00580">PspNullSpecialApc()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01920">PspSystemThreadStartup()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00160">PspTerminateThreadByPointer()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01800">PspUserThreadStartup()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01051">PsRevertToSelf()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00546">PsTerminateSystemThread()</a>, <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l00929">RegisterForDeviceChangeNotifications()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, <a class="el" href="../../d5/d4/seclient_8c-source.html#l00636">SeImpersonateClientEx()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00384">SepDeReferenceLogonSession()</a>, <a class="el" href="../../d0/d5/seinit_8c-source.html#l00078">SepInitializationPhase0()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00294">SepOpenTokenOfThread()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00278">SepReferenceLogonSession()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l01099">StartDeviceRead()</a>, <a class="el" href="../../d1/d7/udfdata_8c-source.html#l00539">UdfProcessException()</a>, <a class="el" href="../../d6/d8/w32_2ntuser_2kernel_2pnp_8c-source.html#l00981">UnregisterForDeviceChangeNotifications()</a>, <a class="el" href="../../d3/d8/w32_2ntuser_2kernel_2heap_8c-source.html#l00015">UserCommitDesktopMemory()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02519">UserGetDesktopDC()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l03035">UserGlobalAtomTableCallout()</a>, <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l02004">UserInitialize()</a>, <a class="el" href="../../d8/d3/vdminit_8c-source.html#l00019">VdmpInitialize()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00232">VdmpQueueIntApcRoutine()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00408">VdmpQueueIntNormalRoutine()</a>, <a class="el" href="../../d8/d6/strtexec_8c-source.html#l00040">VdmpStartExecution()</a>, <a class="el" href="../../d4/d3/vdm_2vdm_8c-source.html#l00087">VdmQueryDirectoryFile()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02841">VerifierExAcquireFastMutexUnsafe()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02182">VerifierExAcquireResourceExclusive()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02870">VerifierExReleaseFastMutex()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02899">VerifierExReleaseFastMutexUnsafe()</a>, <a class="el" href="../../d0/d5/verifier_8c-source.html#l02208">VerifierExReleaseResource()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l00883">xxxDesktopWndProc()</a>, <a class="el" href="../../d5/d7/createw_8c-source.html#l01591">xxxDestroyWindow()</a>, <a class="el" href="../../d0/d6/desktop_8c-source.html#l04211">xxxGetThreadDesktop()</a>, <a class="el" href="../../d0/d4/srvhook_8c-source.html#l00028">xxxHkCallHook()</a>, <a class="el" href="../../d9/d7/fullscr_8c-source.html#l00166">xxxMakeWindowForegroundWithState()</a>, <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00609">xxxSendMessageEx()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l01077">xxxSetProcessWindowStation()</a>, <a class="el" href="../../d7/d8/taskman_8c-source.html#l00252">xxxSleepTask()</a>, <a class="el" href="../../d6/d8/snapshot_8c-source.html#l00023">xxxSnapWindow()</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l03358">xxxSwitchDesktop()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="ps.h::PsIsThreadTerminating" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PsIsThreadTerminating          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">T&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(T)-&gt;HasTerminated</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00875">875</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l04737">PtiFromThreadId()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01922">VdmpIsThreadTerminating()</a>, <a class="el" href="../../d0/d4/vdmints_8c-source.html#l00232">VdmpQueueIntApcRoutine()</a>, and <a class="el" href="../../d7/d8/taskman_8c-source.html#l00252">xxxSleepTask()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="ps.h::PsLockProcessSecurityFields" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PsLockProcessSecurityFields          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExAcquireFastMutex( &amp;<a class="el" href="../../d0/d1/psinit_8c.html#a16">PsProcessSecurityLock</a> )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00654">654</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l00266">NtAssignProcessToJobObject()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00888">PsDisableImpersonation()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00650">PsImpersonateClient()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01256">PspAssignPrimaryToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00208">PsReferenceEffectiveToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00097">PsReferenceImpersonationToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00028">PsReferencePrimaryToken()</a>, and <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01051">PsRevertToSelf()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="ps.h::PSP_INVALID_ID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PSP_INVALID_ID&nbsp;&nbsp;&nbsp;((ULONG_PTR)(0x82)&lt;&lt;((sizeof(ULONG_PTR)-1)*8))          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00029">29</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/pscid_8c-source.html#l00094">PsLookupProcessByProcessId()</a>, <a class="el" href="../../d2/d9/pscid_8c-source.html#l00027">PsLookupProcessThreadByCid()</a>, <a class="el" href="../../d2/d9/pscid_8c-source.html#l00146">PsLookupThreadByThreadId()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="ps.h::PsProcessAuditId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PsProcessAuditId          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Process&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((Process)-&gt;UniqueProcessId)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00814">814</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02573">SeAuditHandleDuplication()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02653">SeAuditProcessExit()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01312">SepAdtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01465">SepAdtDeleteObjectAuditAlarm()</a>, and <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01794">SepAdtHandleAuditAlarm()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="ps.h::THREAD_TO_PROCESS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define THREAD_TO_PROCESS          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">thread&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((thread)-&gt;ThreadsProcess)</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00638">638</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/notify_8c-source.html#l00547">FsRtlNotifyFullChangeDirectory()</a>, <a class="el" href="../../d2/d9/kernel_2exitwin_8c-source.html#l00119">InitiateShutdown()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l07374">IoGetRequestorProcess()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12301">IoGetRequestorSessionId()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12345">IopUpdateOtherOperationCount()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12441">IopUpdateOtherTransferCount()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12377">IopUpdateReadOperationCount()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12473">IopUpdateReadTransferCount()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12410">IopUpdateWriteOperationCount()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l12504">IopUpdateWriteTransferCount()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l11071">IoThreadToProcess()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00915">LpcpCopyRequestData()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l01407">LpcRequestWaitReplyPort()</a>, <a class="el" href="../../d5/d5/lpccompl_8c-source.html#l00040">NtAcceptConnectPort()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l02706">NtQueryInformationThread()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00044">NtReplyPort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00029">NtReplyWaitReceivePort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00635">NtReplyWaitReceivePortEx()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00375">NtReplyWaitReplyPort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00395">NtRequestWaitReplyPort()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00461">NtTerminateThread()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">PsAssignImpersonationToken()</a>, <a class="el" href="../../d2/d9/pscid_8c-source.html#l00027">PsLookupProcessThreadByCid()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, <a class="el" href="../../d4/d0/i386_2psldt_8c-source.html#l01061">PspQueryDescriptorThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00057">PspReaper()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01438">PspThreadDelete()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00208">PsReferenceEffectiveToken()</a>, <a class="el" href="../../d5/d8/minmax_8c-source.html#l01329">xxxMinMaximize()</a>, <a class="el" href="../../d9/d7/winsta_8c-source.html#l01077">xxxSetProcessWindowStation()</a>, and <a class="el" href="../../d2/d1/hooks_8c-source.html#l00576">zzzSetWindowsHookEx()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a45" doxytag="ps.h::EJOB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d3/struct__EJOB.html">_EJOB</a>  <a class="el" href="../../d0/d3/struct__EJOB.html">EJOB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l00048">NtCreateJobObject()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="ps.h::EPROCESS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d4/struct__EPROCESS.html">_EPROCESS</a>  <a class="el" href="../../d0/d4/struct__EPROCESS.html">EPROCESS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="ps.h::EPROCESS_QUOTA_BLOCK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">_EPROCESS_QUOTA_BLOCK</a>  <a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">EPROCESS_QUOTA_BLOCK</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="ps.h::ETHREAD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d6/struct__ETHREAD.html">_ETHREAD</a>  <a class="el" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a69" doxytag="ps.h::IMAGE_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d1/struct__IMAGE__INFO.html">_IMAGE_INFO</a>  <a class="el" href="../../d2/d1/struct__IMAGE__INFO.html">IMAGE_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00211">DbgkCreateThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="ps.h::INITIAL_PEB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d2/struct__INITIAL__PEB.html">_INITIAL_PEB</a>  <a class="el" href="../../d2/d2/struct__INITIAL__PEB.html">INITIAL_PEB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="ps.h::MMSUPPORT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d6/struct__MMSUPPORT.html">_MMSUPPORT</a>  <a class="el" href="../../d3/d6/struct__MMSUPPORT.html">MMSUPPORT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="ps.h::MMSUPPORT_FLAGS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d6/struct__MMSUPPORT__FLAGS.html">_MMSUPPORT_FLAGS</a>  <a class="el" href="../../d5/d6/struct__MMSUPPORT__FLAGS.html">MMSUPPORT_FLAGS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a67" doxytag="ps.h::PCREATE_PROCESS_NOTIFY_ROUTINE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d1/d9/ps_8h.html#a67">PCREATE_PROCESS_NOTIFY_ROUTINE</a>)(IN HANDLE ParentId, IN HANDLE ProcessId, IN BOOLEAN Create)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00724">724</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a68" doxytag="ps.h::PCREATE_THREAD_NOTIFY_ROUTINE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d1/d9/ps_8h.html#a68">PCREATE_THREAD_NOTIFY_ROUTINE</a>)(IN HANDLE ProcessId, IN HANDLE ThreadId, IN BOOLEAN Create)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00738">738</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="ps.h::PEJOB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d0/d3/struct__EJOB.html">EJOB</a>* <a class="el" href="../../d0/d3/struct__EJOB.html">PEJOB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00566">566</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="ps.h::PEPROCESS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d0/d4/struct__EPROCESS.html">EPROCESS</a>* <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00321">321</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="ps.h::PEPROCESS_QUOTA_BLOCK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">_EPROCESS_QUOTA_BLOCK</a> * <a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d7/d0/mmquota_8c-source.html#l00058">MiChargePageFileQuota()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="ps.h::PETHREAD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d5/d6/struct__ETHREAD.html">ETHREAD</a>* <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00456">456</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a70" doxytag="ps.h::PIMAGE_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d1/struct__IMAGE__INFO.html">_IMAGE_INFO</a> * <a class="el" href="../../d2/d1/struct__IMAGE__INFO.html">PIMAGE_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02396">PsCallImageNotifyRoutines()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="ps.h::PINITIAL_PEB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d2/d2/struct__INITIAL__PEB.html">_INITIAL_PEB</a> * <a class="el" href="../../d2/d2/struct__INITIAL__PEB.html">PINITIAL_PEB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a78" doxytag="ps.h::PKWIN32_JOB_CALLOUT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef NTSTATUS(* <a class="el" href="../../d1/d9/ps_8h.html#a78">PKWIN32_JOB_CALLOUT</a>)(IN <a class="el" href="../../d4/d8/struct__WIN32__JOBCALLOUT__PARAMETERS.html">PKWIN32_JOBCALLOUT_PARAMETERS</a> Parm)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l01075">1075</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a77" doxytag="ps.h::PKWIN32_JOBCALLOUT_PARAMETERS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d8/struct__WIN32__JOBCALLOUT__PARAMETERS.html">_WIN32_JOBCALLOUT_PARAMETERS</a> * <a class="el" href="../../d4/d8/struct__WIN32__JOBCALLOUT__PARAMETERS.html">PKWIN32_JOBCALLOUT_PARAMETERS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d7/job_8c-source.html#l00026">UserJobCallout()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a86" doxytag="ps.h::PKWIN32_POWEREVENT_CALLOUT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef NTSTATUS(* <a class="el" href="../../d1/d9/ps_8h.html#a86">PKWIN32_POWEREVENT_CALLOUT</a>)(IN <a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">PKWIN32_POWEREVENT_PARAMETERS</a> Parm)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l01119">1119</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a83" doxytag="ps.h::PKWIN32_POWEREVENT_PARAMETERS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">_WIN32_POWEREVENT_PARAMETERS</a> * <a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">PKWIN32_POWEREVENT_PARAMETERS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00076">QueuePowerRequest()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a87" doxytag="ps.h::PKWIN32_POWERSTATE_CALLOUT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef NTSTATUS(* <a class="el" href="../../d1/d9/ps_8h.html#a87">PKWIN32_POWERSTATE_CALLOUT</a>)(IN <a class="el" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html">PKWIN32_POWERSTATE_PARAMETERS</a> Parm)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l01125">1125</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a85" doxytag="ps.h::PKWIN32_POWERSTATE_PARAMETERS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html">_WIN32_POWERSTATE_PARAMETERS</a> * <a class="el" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html">PKWIN32_POWERSTATE_PARAMETERS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00608">UserPowerStateCallout()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a74" doxytag="ps.h::PKWIN32_PROCESS_CALLOUT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef NTSTATUS(* <a class="el" href="../../d1/d9/ps_8h.html#a74">PKWIN32_PROCESS_CALLOUT</a>)(IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process, IN BOOLEAN Initialize)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l01054">1054</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a80" doxytag="ps.h::PKWIN32_THREAD_CALLOUT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef NTSTATUS(* <a class="el" href="../../d1/d9/ps_8h.html#a80">PKWIN32_THREAD_CALLOUT</a>)(IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread, IN <a class="el" href="../../d1/d9/ps_8h.html#a79">PSW32THREADCALLOUTTYPE</a> CalloutType)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l01087">1087</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a66" doxytag="ps.h::PLEGO_NOTIFY_ROUTINE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d1/d9/ps_8h.html#a66">PLEGO_NOTIFY_ROUTINE</a>)(<a class="el" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a> Thread)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00709">709</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a71" doxytag="ps.h::PLOAD_IMAGE_NOTIFY_ROUTINE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d1/d9/ps_8h.html#a71">PLOAD_IMAGE_NOTIFY_ROUTINE</a>)(IN PUNICODE_STRING FullImageName, IN HANDLE ProcessId,IN <a class="el" href="../../d2/d1/struct__IMAGE__INFO.html">PIMAGE_INFO</a> ImageInfo)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00773">773</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02344">PsSetLoadImageNotifyRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="ps.h::PMMSUPPORT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d3/d6/struct__MMSUPPORT.html">MMSUPPORT</a>* <a class="el" href="../../d3/d6/struct__MMSUPPORT.html">PMMSUPPORT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00085">85</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d5/iosup_8c-source.html#l06461">MiLockCode()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="ps.h::PPS_IMPERSONATION_INFORMATION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html">_PS_IMPERSONATION_INFORMATION</a> * <a class="el" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html">PPS_IMPERSONATION_INFORMATION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="ps.h::PPS_JOB_TOKEN_FILTER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d1/struct__PS__JOB__TOKEN__FILTER.html">_PS_JOB_TOKEN_FILTER</a> *  <a class="el" href="../../d6/d1/struct__PS__JOB__TOKEN__FILTER.html">PPS_JOB_TOKEN_FILTER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="ps.h::PS_IMPERSONATION_INFORMATION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html">_PS_IMPERSONATION_INFORMATION</a>  <a class="el" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html">PS_IMPERSONATION_INFORMATION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="ps.h::PS_JOB_TOKEN_FILTER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d1/struct__PS__JOB__TOKEN__FILTER.html">_PS_JOB_TOKEN_FILTER</a>  <a class="el" href="../../d6/d1/struct__PS__JOB__TOKEN__FILTER.html">PS_JOB_TOKEN_FILTER</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d2/d0/psjob_8c-source.html#l02680">PspCaptureTokenFilter()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a73" doxytag="ps.h::PSLOCKPROCESSMODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d1/d9/ps_8h.html#a155">_PSLOCKPROCESSMODE</a>  <a class="el" href="../../d1/d9/ps_8h.html#a73">PSLOCKPROCESSMODE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01966">PsLockProcess()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a81" doxytag="ps.h::PSPOWEREVENTTYPE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d1/d9/ps_8h.html#a158">_PSPOWEREVENTTYPE</a>  <a class="el" href="../../d1/d9/ps_8h.html#a81">PSPOWEREVENTTYPE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d8/d1/power_8c-source.html#l00274">xxxUserPowerEventCalloutWorker()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a88" doxytag="ps.h::PSPROCESSPRIORITYMODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d1/d9/ps_8h.html#a159">_PSPROCESSPRIORITYMODE</a>  <a class="el" href="../../d1/d9/ps_8h.html#a88">PSPROCESSPRIORITYMODE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a75" doxytag="ps.h::PSW32JOBCALLOUTTYPE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d1/d9/ps_8h.html#a156">_PSW32JOBCALLOUTTYPE</a>  <a class="el" href="../../d1/d9/ps_8h.html#a75">PSW32JOBCALLOUTTYPE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d7/job_8c-source.html#l00026">UserJobCallout()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a79" doxytag="ps.h::PSW32THREADCALLOUTTYPE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d1/d9/ps_8h.html#a157">_PSW32THREADCALLOUTTYPE</a>  <a class="el" href="../../d1/d9/ps_8h.html#a79">PSW32THREADCALLOUTTYPE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="ps.h::PWOW64_PROCESS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d9/struct__WOW64__PROCESS.html">_WOW64_PROCESS</a> * <a class="el" href="../../d8/d9/struct__WOW64__PROCESS.html">PWOW64_PROCESS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d4/procsup_8c-source.html#l00911">MmInitializeProcessAddressSpace()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a76" doxytag="ps.h::WIN32_JOBCALLOUT_PARAMETERS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d8/struct__WIN32__JOBCALLOUT__PARAMETERS.html">_WIN32_JOBCALLOUT_PARAMETERS</a>  <a class="el" href="../../d4/d8/struct__WIN32__JOBCALLOUT__PARAMETERS.html">WIN32_JOBCALLOUT_PARAMETERS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a82" doxytag="ps.h::WIN32_POWEREVENT_PARAMETERS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">_WIN32_POWEREVENT_PARAMETERS</a>  <a class="el" href="../../d5/d8/struct__WIN32__POWEREVENT__PARAMETERS.html">WIN32_POWEREVENT_PARAMETERS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a84" doxytag="ps.h::WIN32_POWERSTATE_PARAMETERS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html">_WIN32_POWERSTATE_PARAMETERS</a>  <a class="el" href="../../d6/d8/struct__WIN32__POWERSTATE__PARAMETERS.html">WIN32_POWERSTATE_PARAMETERS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="ps.h::WOW64_PROCESS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d9/struct__WOW64__PROCESS.html">_WOW64_PROCESS</a>  <a class="el" href="../../d8/d9/struct__WOW64__PROCESS.html">WOW64_PROCESS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d5/d4/procsup_8c-source.html#l00911">MmInitializeProcessAddressSpace()</a>.    </td>
  </tr>
</table>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="a155" doxytag="ps.h::_PSLOCKPROCESSMODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d1/d9/ps_8h.html#a155">_PSLOCKPROCESSMODE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a155a89" doxytag="PsLockPollOnTimeout" ></a>PsLockPollOnTimeout</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a155a90" doxytag="PsLockReturnTimeout" ></a>PsLockReturnTimeout</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a155a91" doxytag="PsLockWaitForever" ></a>PsLockWaitForever</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a155a92" doxytag="PsLockIAmExiting" ></a>PsLockIAmExiting</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l01021">1021</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
<pre class="fragment"><div>01021                                 {
01022     <a class="code" href="../../d1/d9/ps_8h.html#a155a89">PsLockPollOnTimeout</a>,
01023     <a class="code" href="../../d1/d9/ps_8h.html#a155a90">PsLockReturnTimeout</a>,
01024     <a class="code" href="../../d1/d9/ps_8h.html#a155a91">PsLockWaitForever</a>,
01025     <a class="code" href="../../d1/d9/ps_8h.html#a155a92">PsLockIAmExiting</a>
01026 } <a class="code" href="../../d1/d9/ps_8h.html#a73">PSLOCKPROCESSMODE</a>;
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a158" doxytag="ps.h::_PSPOWEREVENTTYPE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d1/d9/ps_8h.html#a158">_PSPOWEREVENTTYPE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a158a98" doxytag="PsW32FullWake" ></a>PsW32FullWake</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a158a99" doxytag="PsW32EventCode" ></a>PsW32EventCode</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a158a100" doxytag="PsW32PowerPolicyChanged" ></a>PsW32PowerPolicyChanged</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a158a101" doxytag="PsW32SystemPowerState" ></a>PsW32SystemPowerState</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a158a102" doxytag="PsW32SystemTime" ></a>PsW32SystemTime</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a158a103" doxytag="PsW32DisplayState" ></a>PsW32DisplayState</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a158a104" doxytag="PsW32CapabilitiesChanged" ></a>PsW32CapabilitiesChanged</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a158a105" doxytag="PsW32SetStateFailed" ></a>PsW32SetStateFailed</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a158a106" doxytag="PsW32GdiOff" ></a>PsW32GdiOff</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a158a107" doxytag="PsW32GdiOn" ></a>PsW32GdiOn</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l01092">1092</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
<pre class="fragment"><div>01092                                {
01093     <a class="code" href="../../d1/d9/ps_8h.html#a158a98">PsW32FullWake</a>,
01094     <a class="code" href="../../d1/d9/ps_8h.html#a158a99">PsW32EventCode</a>,
01095     <a class="code" href="../../d1/d9/ps_8h.html#a158a100">PsW32PowerPolicyChanged</a>,
01096     <a class="code" href="../../d1/d9/ps_8h.html#a158a101">PsW32SystemPowerState</a>,
01097     <a class="code" href="../../d1/d9/ps_8h.html#a158a102">PsW32SystemTime</a>,
01098     <a class="code" href="../../d1/d9/ps_8h.html#a158a103">PsW32DisplayState</a>,
01099     <a class="code" href="../../d1/d9/ps_8h.html#a158a104">PsW32CapabilitiesChanged</a>,
01100     <a class="code" href="../../d1/d9/ps_8h.html#a158a105">PsW32SetStateFailed</a>,
01101     <a class="code" href="../../d1/d9/ps_8h.html#a158a106">PsW32GdiOff</a>,
01102     <a class="code" href="../../d1/d9/ps_8h.html#a158a107">PsW32GdiOn</a>
01103 } <a class="code" href="../../d1/d9/ps_8h.html#a81">PSPOWEREVENTTYPE</a>;
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a159" doxytag="ps.h::_PSPROCESSPRIORITYMODE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d1/d9/ps_8h.html#a159">_PSPROCESSPRIORITYMODE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a159a108" doxytag="PsProcessPriorityBackground" ></a>PsProcessPriorityBackground</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a159a109" doxytag="PsProcessPriorityForeground" ></a>PsProcessPriorityForeground</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a159a110" doxytag="PsProcessPrioritySpinning" ></a>PsProcessPrioritySpinning</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l01142">1142</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
<pre class="fragment"><div>01142                                     {
01143     <a class="code" href="../../d1/d9/ps_8h.html#a159a108">PsProcessPriorityBackground</a>,
01144     <a class="code" href="../../d1/d9/ps_8h.html#a159a109">PsProcessPriorityForeground</a>,
01145     <a class="code" href="../../d1/d9/ps_8h.html#a159a110">PsProcessPrioritySpinning</a>
01146 } <a class="code" href="../../d1/d9/ps_8h.html#a88">PSPROCESSPRIORITYMODE</a>;
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a156" doxytag="ps.h::_PSW32JOBCALLOUTTYPE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d1/d9/ps_8h.html#a156">_PSW32JOBCALLOUTTYPE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a156a93" doxytag="PsW32JobCalloutSetInformation" ></a>PsW32JobCalloutSetInformation</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a156a94" doxytag="PsW32JobCalloutAddProcess" ></a>PsW32JobCalloutAddProcess</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a156a95" doxytag="PsW32JobCalloutTerminate" ></a>PsW32JobCalloutTerminate</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l01060">1060</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
<pre class="fragment"><div>01060                                   {
01061     <a class="code" href="../../d1/d9/ps_8h.html#a156a93">PsW32JobCalloutSetInformation</a>,
01062     <a class="code" href="../../d1/d9/ps_8h.html#a156a94">PsW32JobCalloutAddProcess</a>,
01063     <a class="code" href="../../d1/d9/ps_8h.html#a156a95">PsW32JobCalloutTerminate</a>
01064 } <a class="code" href="../../d1/d9/ps_8h.html#a75">PSW32JOBCALLOUTTYPE</a>;
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a157" doxytag="ps.h::_PSW32THREADCALLOUTTYPE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d1/d9/ps_8h.html#a157">_PSW32THREADCALLOUTTYPE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a157a96" doxytag="PsW32ThreadCalloutInitialize" ></a>PsW32ThreadCalloutInitialize</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a157a97" doxytag="PsW32ThreadCalloutExit" ></a>PsW32ThreadCalloutExit</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l01080">1080</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
<pre class="fragment"><div>01080                                      {
01081     <a class="code" href="../../d1/d9/ps_8h.html#a157a96">PsW32ThreadCalloutInitialize</a>,
01082     <a class="code" href="../../d1/d9/ps_8h.html#a157a97">PsW32ThreadCalloutExit</a>
01083 } <a class="code" href="../../d1/d9/ps_8h.html#a79">PSW32THREADCALLOUTTYPE</a>;
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a125" doxytag="ps.h::PsAssignImpersonationToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PsAssignImpersonationToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">1483</a> of file <a class="el" href="../../d7/d4/ps_2security_8c-source.html">ps/security.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d1/rtnotify_8c-source.html#l00075">Filter</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00639">IS_SYSTEM_THREAD</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00166">KeAttachProcess()</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00405">KeDetachProcess()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00166">_EPROCESS::Pcb</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00650">PsImpersonateClient()</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01859">SeFastFilterToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00211">SeTokenImpersonationLevel()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00150">SeTokenIsAdmin()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00181">SeTokenIsRestricted()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01213">SeTokenObjectType</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00118">SeTokenType()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00638">THREAD_TO_PROCESS</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>.
<p>
<pre class="fragment"><div>01490                    :
01491 
01492     This function performs <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security portions of establishing an
01493     impersonation token.  This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> expected to be used <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> in
01494     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">case</span> where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject has asked <span class="keywordflow">for</span> impersonation explicitly
01495     providing an impersonation token.  Other services are provided <span class="keywordflow">for</span>
01496     use by communication session layers that need to establish an
01497     impersonation on a server's behalf.
01498 
01499     It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> expected that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> proper access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread object has already
01500     been established.
01501 
01502     The following rules apply:
01503 
01504          1) The caller must have TOKEN_IMPERSONATE access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token
01505             <span class="keywordflow">for</span> any action to be taken.
01506 
01507          2) If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token may NOT be used <span class="keywordflow">for</span> impersonation (e.g., not an
01508             impersonation token) no action <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> taken.
01509 
01510          3) Otherwise, any existing impersonation token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> dereferenced and
01511             <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> established as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> impersonation token.
01512 
01513 
01514 
01515 Arguments:
01516 
01517     Thread - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread whose impersonation token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being
01518         set.
01519 
01520     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - The handle value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token to be assigned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> impersonation
01521         token.  If <span class="keyword">this</span> value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, then current impersonation (<span class="keywordflow">if</span> any)
01522         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> terminated and no <span class="keyword">new</span> impersonation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> established.
01523 
01524 
01525 Return Value:
01526 
01527     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary token has been successfully
01528         replaced.
01529 
01530     STATUS_BAD_TOKEN_TYPE - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>
01531         TokenImpersonation.
01532 
01533     Other status may be returned when attempting to reference <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token
01534     object.
01535 
01536 --*/
01537 
01538 {
01539     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
01540         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01541 
01542     PACCESS_TOKEN
01543         NewToken, NewerToken ;
01544 
01545     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>
01546         PreviousMode;
01547 
01548     SECURITY_IMPERSONATION_LEVEL
01549         ImpersonationLevel;
01550 
01551     <a class="code" href="../../d6/d1/struct__PS__JOB__TOKEN__FILTER.html">PPS_JOB_TOKEN_FILTER</a> <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a> ;
01552 
01553     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> ThreadProcess;
01554     BOOLEAN  AttachedToProcess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01555 
01556     PreviousMode = KeGetPreviousMode();
01557 
01558     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT(Token)) {
01559 
01560         NewToken = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01561 
01562         <span class="comment">//</span>
01563         <span class="comment">// Don't care what value ImpersonationLevel has, it won't</span>
01564         <span class="comment">// be used.</span>
01565         <span class="comment">//</span>
01566 
01567     } <span class="keywordflow">else</span> {
01568 
01569         <span class="comment">//</span>
01570         <span class="comment">// Reference the specified token for TOKEN_IMPERSONATE access</span>
01571         <span class="comment">//</span>
01572 
01573         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a> (
01574                     Token,
01575                     TOKEN_IMPERSONATE,
01576                     <a class="code" href="../../d0/d5/se_8h.html#a17">SeTokenObjectType</a>(),
01577                     PreviousMode,
01578                     (PVOID *)&amp;NewToken,
01579                     NULL
01580                     );
01581 
01582         <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) ) {
01583             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01584         }
01585 
01586         <span class="comment">//</span>
01587         <span class="comment">// Make sure the token is an impersonation token.</span>
01588         <span class="comment">//</span>
01589 
01590         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d3/token_8c.html#a3">SeTokenType</a>( NewToken ) != TokenImpersonation ) {
01591             <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( NewToken );
01592             <span class="keywordflow">return</span> STATUS_BAD_TOKEN_TYPE;
01593         }
01594 
01595         <span class="keywordflow">if</span> ( Thread-&gt;ThreadsProcess-&gt;Job ) {
01596 
01597             <span class="keywordflow">if</span> ( ( Thread-&gt;ThreadsProcess-&gt;Job-&gt;SecurityLimitFlags &amp; JOB_OBJECT_SECURITY_NO_ADMIN ) &amp;&amp;
01598                  ( <a class="code" href="../../d4/d3/token_8c.html#a4">SeTokenIsAdmin</a>( NewToken ) ) ) {
01599 
01600                 <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( NewToken );
01601 
01602                 <span class="keywordflow">return</span> STATUS_ACCESS_DENIED ;
01603 
01604             }
01605 
01606             <span class="keywordflow">if</span> ( ( Thread-&gt;ThreadsProcess-&gt;Job-&gt;SecurityLimitFlags &amp; JOB_OBJECT_SECURITY_RESTRICTED_TOKEN ) &amp;&amp;
01607                  ( !<a class="code" href="../../d4/d3/token_8c.html#a5">SeTokenIsRestricted</a>( NewToken ) ) )
01608             {
01609                 <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( NewToken );
01610 
01611                 <span class="keywordflow">return</span> STATUS_ACCESS_DENIED ;
01612             }
01613 
01614             <span class="keywordflow">if</span> ( Thread-&gt;ThreadsProcess-&gt;Job-&gt;Filter )
01615             {
01616                 <span class="comment">//</span>
01617                 <span class="comment">// Filter installed.  Need to create a restricted token</span>
01618                 <span class="comment">// dynamically.</span>
01619                 <span class="comment">//</span>
01620                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a> = Thread-&gt;ThreadsProcess-&gt;Job-&gt;Filter ;
01621 
01622                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d3/tokendup_8c.html#a9">SeFastFilterToken</a>(
01623                                 NewToken,
01624                                 PreviousMode,
01625                                 0,
01626                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedGroupCount,
01627                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedGroups,
01628                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedPrivilegeCount,
01629                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedPrivileges,
01630                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedSidCount,
01631                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedSids,
01632                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedSidsLength,
01633                                 &amp;NewerToken );
01634 
01635                 <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( NewToken );
01636 
01637                 <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ) )
01638                 {
01639                     NewToken = NewerToken ;
01640                 }
01641                 <span class="keywordflow">else</span>
01642                 {
01643                     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> ;
01644                 }
01645 
01646 
01647             }
01648         }
01649 
01650         ImpersonationLevel = <a class="code" href="../../d4/d3/token_8c.html#a6">SeTokenImpersonationLevel</a>( NewToken );
01651     }
01652 
01653     <span class="comment">//</span>
01654     <span class="comment">// The rest can be done by PsImpersonateClient.</span>
01655     <span class="comment">//</span>
01656     <span class="comment">// PsImpersonateClient will reference the passed token</span>
01657     <span class="comment">// on success.</span>
01658     <span class="comment">//</span>
01659 
01660     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d5/ps_2security_8c.html#a6">PsImpersonateClient</a>(
01661                  Thread,
01662                  NewToken,
01663                  FALSE,          <span class="comment">// CopyOnOpen</span>
01664                  FALSE,          <span class="comment">//EffectiveOnly</span>
01665                  ImpersonationLevel
01666                  );
01667 
01668 
01669     <span class="comment">//</span>
01670     <span class="comment">// dereference the passed token, if there is one.</span>
01671     <span class="comment">//</span>
01672     <span class="comment">// Note that if PsImpersonateClient failed, this will</span>
01673     <span class="comment">// be the final dereference of NewToken/NewerToken,</span>
01674     <span class="comment">// and it will be freed.</span>
01675     <span class="comment">//</span>
01676 
01677     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(NewToken)) {
01678         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( NewToken );
01679     }
01680 
01681     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
01682 
01683         <span class="comment">//</span>
01684         <span class="comment">//   Indicate that 'Thread' has started to do impersonation.</span>
01685         <span class="comment">//   This info is useful for GetUserDefaultLCID()</span>
01686         <span class="comment">//</span>
01687 
01688         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d9/ps_8h.html#a18">IS_SYSTEM_THREAD</a>(Thread)) {
01689 
01690             ThreadProcess = <a class="code" href="../../d1/d9/ps_8h.html#a17">THREAD_TO_PROCESS</a>(Thread);
01691 
01692             <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>() != ThreadProcess ) {
01693                 <a class="code" href="../../d3/d5/procobj_8c.html#a4">KeAttachProcess</a>( &amp;ThreadProcess-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o0">Pcb</a> );
01694                 AttachedToProcess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01695             }
01696 
01697             <span class="keywordflow">if</span> (ARGUMENT_PRESENT(NewToken)) {
01698                 ((PTEB)(Thread-&gt;Tcb.Teb))-&gt;ImpersonationLocale = (LCID)-1;
01699                 ((PTEB)(Thread-&gt;Tcb.Teb))-&gt;IsImpersonating = 1;
01700             } <span class="keywordflow">else</span> {
01701                 ((PTEB)(Thread-&gt;Tcb.Teb))-&gt;ImpersonationLocale = (LCID) 0;
01702                 ((PTEB)(Thread-&gt;Tcb.Teb))-&gt;IsImpersonating = 0;
01703             }
01704 
01705             <span class="keywordflow">if</span> (AttachedToProcess) {
01706                 <a class="code" href="../../d3/d5/procobj_8c.html#a7">KeDetachProcess</a>();
01707             }
01708         }
01709     }
01710 
01711     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01712 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a130" doxytag="ps.h::PsCallImageNotifyRoutines" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsCallImageNotifyRoutines           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>FullImageName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d2/d1/struct__IMAGE__INFO.html">PIMAGE_INFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ImageInfo</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02396">2396</a> of file <a class="el" href="../../d3/d7/ps_2create_8c-source.html">ps/create.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d1/d9/ps_8h.html#a70">PIMAGE_INFO</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00880">PsImageNotifyEnabled</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00212">PSP_MAX_LOAD_IMAGE_NOTIFY</a>, and <a class="el" href="../../d9/d0/psp_8h-source.html#l00214">PspLoadImageNotifyRoutine</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00211">DbgkCreateThread()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, and <a class="el" href="../../d4/d4/mapview_8c-source.html#l01567">MiMapViewOfImageSection()</a>.
<p>
<pre class="fragment"><div>02403                    :
02404 
02405     This function actually calls <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registered image notify <a class="code" href="../../d3/d0/user32_8def.html#a16">functions</a> (on behalf)
02406     of mapview.c and sysload.c
02407 
02408 Arguments:
02409 
02410     FullImageName - The name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image being loaded
02411 
02412     ProcessId - The process that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being loaded into (0 <span class="keywordflow">for</span> driver loads)
02413 
02414     ImageInfo - Various flags <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image
02415 
02416 Return Value:
02417 
02418     None.
02419 
02420 --*/
02421 
02422 {
02423     <span class="keywordtype">int</span> i;
02424 
02425     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02426 
02427     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d9/ps_8h.html#a72">PsImageNotifyEnabled</a> ) {
02428         <span class="keywordflow">for</span> (i=0; i&lt;<a class="code" href="../../d8/d1/psp_8h.html#a7">PSP_MAX_LOAD_IMAGE_NOTIFY</a>; i++) {
02429             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/psp_8h.html#a26">PspLoadImageNotifyRoutine</a>[i] != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02430                (*<a class="code" href="../../d8/d1/psp_8h.html#a26">PspLoadImageNotifyRoutine</a>[i])(
02431                     (PUNICODE_STRING) FullImageName,
02432                     ProcessId,
02433                     ImageInfo
02434                     );
02435                 }
02436             }
02437         }
02438 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a111" doxytag="ps.h::PsChangeJobMemoryUsage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN PsChangeJobMemoryUsage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">SSIZE_T&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Amount</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/psjob_8c-source.html#l02823">2823</a> of file <a class="el" href="../../d2/d0/psjob_8c-source.html">psjob.c</a>.
<p>
References <a class="el" href="../../d2/d8/ps_8h-source.html#l00186">_EPROCESS::CommitCharge</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00539">_EJOB::CompletionKey</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00538">_EJOB::CompletionPort</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00561">_EJOB::CurrentJobMemoryUsed</a>, <a class="el" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00671">IoSetIoCompletion()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00285">_EPROCESS::Job</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00558">_EJOB::JobMemoryLimit</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00286">_EPROCESS::JobStatus</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00512">_EJOB::LimitFlags</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00563">_EJOB::MemoryLimitsLock</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00560">_EJOB::PeakJobMemoryUsed</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00559">_EJOB::PeakProcessMemoryUsed</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00319">PS_JOB_STATUS_LAST_REPORT_MEMORY</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00316">PS_JOB_STATUS_NEW_PROCESS_REPORTED</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00148">PS_SET_BITS</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00174">_EPROCESS::UniqueProcessId</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00030">MiInsertVad()</a>, <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00256">MiRemoveVad()</a>, <a class="el" href="../../d7/d0/mmquota_8c-source.html#l00869">MiReturnPageTablePageCommitment()</a>, <a class="el" href="../../d1/d8/protect_8c-source.html#l01110">MiSetProtectionOnSection()</a>, <a class="el" href="../../d5/d9/wslist_8c-source.html#l02386">MmAssignProcessToJob()</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l01695">MmCleanProcessAddressSpace()</a>, <a class="el" href="../../d4/d5/allocvm_8c-source.html#l00075">NtAllocateVirtualMemory()</a>, and <a class="el" href="../../d4/d6/freevm_8c-source.html#l00066">NtFreeVirtualMemory()</a>.
<p>
<pre class="fragment"><div>02826 {
02827     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process;
02828     <a class="code" href="../../d0/d3/struct__EJOB.html">PEJOB</a> Job;
02829     SIZE_T CurrentJobMemoryUsed;
02830     BOOLEAN ReturnValue;
02831 
02832     ReturnValue = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02833     Process = <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>();
02834     Job = Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o73">Job</a>;
02835     <span class="keywordflow">if</span> ( Job ) {
02836         <span class="comment">//</span>
02837         <span class="comment">// This routine can be called while hoolding the process lock (during</span>
02838         <span class="comment">// teb deletion... So instead of using the job lock, we must use the</span>
02839         <span class="comment">// memory limits lock. The lock order is always (job lock followed by</span>
02840         <span class="comment">// process lock. The memory limits lock never nests or calls other</span>
02841         <span class="comment">// code while held. It can be grapped while holding the job lock, or the process</span>
02842         <span class="comment">// lock.</span>
02843         <span class="comment">//</span>
02844         <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
02845         <a class="code" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe</a>(&amp;Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o41">MemoryLimitsLock</a>);
02846 
02847         CurrentJobMemoryUsed = Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o40">CurrentJobMemoryUsed</a> + Amount;
02848 
02849         <span class="keywordflow">if</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o14">LimitFlags</a> &amp; JOB_OBJECT_LIMIT_JOB_MEMORY &amp;&amp;
02850              CurrentJobMemoryUsed &gt; Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o37">JobMemoryLimit</a> ) {
02851             CurrentJobMemoryUsed = Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o40">CurrentJobMemoryUsed</a>;
02852             ReturnValue = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02853 
02854 
02855 
02856             <span class="comment">//</span>
02857             <span class="comment">// Tell the job port that commit has been exceeded, and process id x</span>
02858             <span class="comment">// was the one that hit it.</span>
02859             <span class="comment">//</span>
02860 
02861             <span class="keywordflow">if</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o25">CompletionPort</a>
02862                  &amp;&amp; Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o7">UniqueProcessId</a>
02863                  &amp;&amp; (Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o74">JobStatus</a> &amp; <a class="code" href="../../d1/d9/ps_8h.html#a11">PS_JOB_STATUS_NEW_PROCESS_REPORTED</a>)
02864                  &amp;&amp; (Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o74">JobStatus</a> &amp; <a class="code" href="../../d1/d9/ps_8h.html#a14">PS_JOB_STATUS_LAST_REPORT_MEMORY</a>) == 0) {
02865 
02866                 <a class="code" href="../../d1/d9/ps_8h.html#a6">PS_SET_BITS</a> (&amp;Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o74">JobStatus</a>, PS_JOB_STATUS_LAST_REPORT_MEMORY);
02867                 <a class="code" href="../../d5/d4/complete_8c.html#a6">IoSetIoCompletion</a>(
02868                     Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o25">CompletionPort</a>,
02869                     Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o26">CompletionKey</a>,
02870                     (PVOID)Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o7">UniqueProcessId</a>,
02871                     STATUS_SUCCESS,
02872                     JOB_OBJECT_MSG_JOB_MEMORY_LIMIT,
02873                     TRUE
02874                     );
02875 
02876                 }
02877             }
02878 
02879         <span class="keywordflow">if</span> ( ReturnValue ) {
02880             <span class="comment">//</span>
02881             <span class="comment">// update current and peak counters</span>
02882             <span class="comment">//</span>
02883             Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o40">CurrentJobMemoryUsed</a> = CurrentJobMemoryUsed;
02884             <span class="keywordflow">if</span> ( CurrentJobMemoryUsed &gt; Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o39">PeakJobMemoryUsed</a> ) {
02885                 Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o39">PeakJobMemoryUsed</a> = CurrentJobMemoryUsed;
02886                 }
02887 
02888             <span class="keywordflow">if</span> ( Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o12">CommitCharge</a> + Amount &gt; Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o38">PeakProcessMemoryUsed</a> ) {
02889                 Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o38">PeakProcessMemoryUsed</a> = Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o12">CommitCharge</a> + Amount;
02890                 }
02891             }
02892         <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a>(&amp;Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o41">MemoryLimitsLock</a>);
02893         <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
02894         }
02895 
02896     <span class="keywordflow">return</span> ReturnValue;
02897 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a116" doxytag="ps.h::PsChangeQuantumTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsChangeQuantumTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ModifyActiveProcesses</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>PrioritySeparation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/psinit_8c-source.html#l00878">878</a> of file <a class="el" href="../../d1/d0/psinit_8c-source.html">psinit.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00285">_EPROCESS::Job</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00041">MEMORY_PRIORITY_BACKGROUND</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00069">_MMSUPPORT::MemoryPriority</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l03087">MmIsThisAnNtAsSystem()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00166">_EPROCESS::Pcb</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00276">_EPROCESS::PriorityClass</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00575">PsActiveProcessHead</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l03058">PspActiveProcessMutex</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00840">PspFixedQuantums</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00113">PspForegroundQuantum</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00864">PspJobSchedulingClasses</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00573">PsPrioritySeperation</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00862">PspUseJobSchedulingClasses</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00849">PspVariableQuantums</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00543">_EJOB::SchedulingClass</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00036">THREAD_QUANTUM</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00769">_KPROCESS::ThreadQuantum</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00196">_EPROCESS::Vm</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l02264">NtSetSystemInformation()</a>, and <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>.
<p>
<pre class="fragment"><div>00882 {
00883 
00884     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process;
00885     PLIST_ENTRY NextProcess;
00886     ULONG QuantumIndex;
00887     PSCHAR QuantumTableBase;
00888 
00889     <span class="comment">//</span>
00890     <span class="comment">// extract priority seperation value</span>
00891     <span class="comment">//</span>
00892     <span class="keywordflow">switch</span> ( PrioritySeparation &amp; PROCESS_PRIORITY_SEPARATION_MASK ) {
00893         <span class="keywordflow">case</span> 3:
00894             <a class="code" href="../../d1/d9/ps_8h.html#a47">PsPrioritySeperation</a> = PROCESS_PRIORITY_SEPARATION_MAX;
00895             <span class="keywordflow">break</span>;
00896         <span class="keywordflow">default</span>:
00897             <a class="code" href="../../d1/d9/ps_8h.html#a47">PsPrioritySeperation</a> = PrioritySeparation &amp; PROCESS_PRIORITY_SEPARATION_MASK;
00898             <span class="keywordflow">break</span>;
00899         }
00900 
00901     <span class="comment">//</span>
00902     <span class="comment">// determine if we are using fixed or variable quantums</span>
00903     <span class="comment">//</span>
00904     <span class="keywordflow">switch</span> ( PrioritySeparation &amp; PROCESS_QUANTUM_VARIABLE_MASK ) {
00905         <span class="keywordflow">case</span> PROCESS_QUANTUM_VARIABLE_VALUE:
00906             QuantumTableBase = <a class="code" href="../../d0/d1/psinit_8c.html#a36">PspVariableQuantums</a>;
00907             <span class="keywordflow">break</span>;
00908 
00909         <span class="keywordflow">case</span> PROCESS_QUANTUM_FIXED_VALUE:
00910             QuantumTableBase = <a class="code" href="../../d0/d1/psinit_8c.html#a35">PspFixedQuantums</a>;
00911             <span class="keywordflow">break</span>;
00912 
00913         <span class="keywordflow">case</span> PROCESS_QUANTUM_VARIABLE_DEF:
00914         <span class="keywordflow">default</span>:
00915             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d1/mminit_8c.html#a58">MmIsThisAnNtAsSystem</a>() ) {
00916                 QuantumTableBase = <a class="code" href="../../d0/d1/psinit_8c.html#a35">PspFixedQuantums</a>;
00917                 }
00918             <span class="keywordflow">else</span> {
00919                 QuantumTableBase = <a class="code" href="../../d0/d1/psinit_8c.html#a36">PspVariableQuantums</a>;
00920                 }
00921             <span class="keywordflow">break</span>;
00922         }
00923 
00924     <span class="comment">//</span>
00925     <span class="comment">// determine if we are using long or short</span>
00926     <span class="comment">//</span>
00927     <span class="keywordflow">switch</span> ( PrioritySeparation &amp; PROCESS_QUANTUM_LONG_MASK ) {
00928         <span class="keywordflow">case</span> PROCESS_QUANTUM_LONG_VALUE:
00929             QuantumTableBase = QuantumTableBase + 3;
00930             <span class="keywordflow">break</span>;
00931 
00932         <span class="keywordflow">case</span> PROCESS_QUANTUM_SHORT_VALUE:
00933             <span class="keywordflow">break</span>;
00934 
00935         <span class="keywordflow">case</span> PROCESS_QUANTUM_LONG_DEF:
00936         <span class="keywordflow">default</span>:
00937             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d1/mminit_8c.html#a58">MmIsThisAnNtAsSystem</a>() ) {
00938                 QuantumTableBase = QuantumTableBase + 3;
00939                 }
00940             <span class="keywordflow">break</span>;
00941         }
00942 
00943     <span class="comment">//</span>
00944     <span class="comment">// Job Scheduling classes are ONLY meaningful if long fixed quantums</span>
00945     <span class="comment">// are selected. In practice, this means stock NTS configurations</span>
00946     <span class="comment">//</span>
00947     <span class="keywordflow">if</span> ( QuantumTableBase == &amp;<a class="code" href="../../d0/d1/psinit_8c.html#a35">PspFixedQuantums</a>[3] ) {
00948         <a class="code" href="../../d0/d1/psinit_8c.html#a37">PspUseJobSchedulingClasses</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00949         }
00950     <span class="keywordflow">else</span> {
00951         <a class="code" href="../../d0/d1/psinit_8c.html#a37">PspUseJobSchedulingClasses</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00952         }
00953 
00954     RtlCopyMemory(PspForegroundQuantum,QuantumTableBase,<span class="keyword">sizeof</span>(PspForegroundQuantum));
00955 
00956     <span class="keywordflow">if</span> (ModifyActiveProcesses) {
00957 
00958         ExAcquireFastMutex(&amp;PspActiveProcessMutex);
00959 
00960         NextProcess = <a class="code" href="../../d1/d9/ps_8h.html#a49">PsActiveProcessHead</a>.Flink;
00961 
00962         <span class="keywordflow">while</span> (NextProcess != &amp;<a class="code" href="../../d1/d9/ps_8h.html#a49">PsActiveProcessHead</a>) {
00963             Process = CONTAINING_RECORD(NextProcess,
00964                                         <a class="code" href="../../d0/d4/struct__EPROCESS.html">EPROCESS</a>,
00965                                         ActiveProcessLinks);
00966 
00967             <span class="keywordflow">if</span> ( Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o16">Vm</a>.<a class="code" href="../../d3/d6/struct__MMSUPPORT.html#o12">MemoryPriority</a> == <a class="code" href="../../d1/d9/ps_8h.html#a1">MEMORY_PRIORITY_BACKGROUND</a> ) {
00968                 QuantumIndex = 0;
00969                 }
00970             <span class="keywordflow">else</span> {
00971                 QuantumIndex = <a class="code" href="../../d1/d9/ps_8h.html#a47">PsPrioritySeperation</a>;
00972                 }
00973             <span class="keywordflow">if</span> ( Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o68">PriorityClass</a> != PROCESS_PRIORITY_CLASS_IDLE ) {
00974 
00975                 <span class="comment">//</span>
00976                 <span class="comment">// If the process is contained within a JOB, AND we are</span>
00977                 <span class="comment">// running Fixed, Long Quantums, use the quantum associated</span>
00978                 <span class="comment">// with the Job's scheduling class</span>
00979                 <span class="comment">//</span>
00980                 <span class="keywordflow">if</span> ( Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o73">Job</a> &amp;&amp; <a class="code" href="../../d0/d1/psinit_8c.html#a37">PspUseJobSchedulingClasses</a> ) {
00981                     Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o0">Pcb</a>.<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a> = <a class="code" href="../../d0/d1/psinit_8c.html#a38">PspJobSchedulingClasses</a>[Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o73">Job</a>-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o28">SchedulingClass</a>];
00982                     }
00983                 <span class="keywordflow">else</span> {
00984                     Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o0">Pcb</a>.<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a> = <a class="code" href="../../d0/d1/psinit_8c.html#a21">PspForegroundQuantum</a>[QuantumIndex];
00985                     }
00986                 }
00987             <span class="keywordflow">else</span> {
00988                 Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o0">Pcb</a>.<a class="code" href="../../d5/d7/struct__KPROCESS.html#o13">ThreadQuantum</a> = <a class="code" href="../../d4/d9/ke_8h.html#a3">THREAD_QUANTUM</a>;
00989                 }
00990             NextProcess = NextProcess-&gt;Flink;
00991             }
00992         ExReleaseFastMutex(&amp;PspActiveProcessMutex);
00993         }
00994 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a141" doxytag="ps.h::PsChargePoolQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsChargePoolQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Amount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a146" doxytag="ps.h::PsChargeSharedPoolQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a> PsChargeSharedPoolQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>PagedAmount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>NonPagedAmount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a120" doxytag="ps.h::PsCreateSystemProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PsCreateSystemProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a118" doxytag="ps.h::PsCreateSystemThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS PsCreateSystemThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ThreadHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE ProcessHandle&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCLIENT_ID ClientId&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d9/ke_8h.html#a66">PKSTART_ROUTINE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>StartRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>StartContext</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a132" doxytag="ps.h::PsDisableImpersonation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN PsDisableImpersonation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSE_IMPERSONATION_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>ImpersonationState</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00888">888</a> of file <a class="el" href="../../d7/d4/ps_2security_8c-source.html">ps/security.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00093">_PS_IMPERSONATION_INFORMATION::CopyOnOpen</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00094">_PS_IMPERSONATION_INFORMATION::EffectiveOnly</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00095">_PS_IMPERSONATION_INFORMATION::ImpersonationLevel</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00661">PsFreeProcessSecurityFields</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00654">PsLockProcessSecurityFields</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a163">ThreadObject</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00092">_PS_IMPERSONATION_INFORMATION::Token</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00458">NtOpenThreadToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00326">PsOpenTokenOfThread()</a>, and <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00294">SepOpenTokenOfThread()</a>.
<p>
<pre class="fragment"><div>00895                    :
00896 
00897     This routine temporarily disables <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> impersonation of a thread.
00898     The impersonation state <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> saved <span class="keywordflow">for</span> quick replacement later.  The
00899     impersonation token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> left referenced and a pointer to <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> held
00900     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IMPERSONATION_STATE data structure.
00901 
00902     <a class="code" href="../../d6/d5/ps_2security_8c.html#a8">PsRestoreImpersonation</a>() must be used after this routine is called.
00903 
00904 
00905 
00906 Arguments:
00907 
00908     Thread - points to the thread whose impersonation (if any) is to
00909         be temporarily disabled.
00910 
00911     ImpersonationState - receives the current impersonation information,
00912         including a pointer to the impersonation token.
00913 
00914 
00915 Return Value:
00916 
00917     TRUE - Indicates the impersonation state has been saved and the
00918         impersonation has been temporarily disabled.
00919 
00920     FALSE - Indicates the specified thread was not impersonating a client.
00921        No action has been taken.
00922 
00923 --*/
00924 
00925 {
00926 
00927 
00928     <a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html">PPS_IMPERSONATION_INFORMATION</a>
00929         OldClient;
00930 
00931     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Thread-&gt;Tcb.Header.Type == ThreadObject );
00932 
00933     <span class="comment">//</span>
00934     <span class="comment">//  Lock the process security fields</span>
00935     <span class="comment">//</span>
00936 
00937     <a class="code" href="../../d1/d9/ps_8h.html#a21">PsLockProcessSecurityFields</a>();
00938 
00939     <span class="comment">//</span>
00940     <span class="comment">//  Capture the impersonation information (if there is any).</span>
00941     <span class="comment">//</span>
00942 
00943     <span class="keywordflow">if</span> ( Thread-&gt;ActiveImpersonationInfo ) {
00944 
00945         OldClient = Thread-&gt;ImpersonationInfo;
00946         ImpersonationState-&gt;Level         = OldClient-&gt;<a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html#o3">ImpersonationLevel</a>;
00947         ImpersonationState-&gt;EffectiveOnly = OldClient-&gt;<a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html#o2">EffectiveOnly</a>;
00948         ImpersonationState-&gt;CopyOnOpen    = OldClient-&gt;<a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html#o1">CopyOnOpen</a>;
00949         ImpersonationState-&gt;Token         = OldClient-&gt;<a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html#o0">Token</a>;
00950     } <span class="keywordflow">else</span> {
00951 
00952         <span class="comment">//</span>
00953         <span class="comment">// Not impersonating.  Just make up some values.</span>
00954         <span class="comment">// The NULL for the token indicates we aren't impersonating.</span>
00955         <span class="comment">//</span>
00956 
00957         OldClient = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00958         ImpersonationState-&gt;Level         = SecurityAnonymous;
00959         ImpersonationState-&gt;EffectiveOnly = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00960         ImpersonationState-&gt;CopyOnOpen    = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00961         ImpersonationState-&gt;Token         = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00962     }
00963 
00964     <span class="comment">//</span>
00965     <span class="comment">// Clear the Client field to indicate the thread is not impersonating.</span>
00966     <span class="comment">//</span>
00967 
00968     Thread-&gt;ActiveImpersonationInfo = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00969 
00970 
00971     <span class="comment">//</span>
00972     <span class="comment">//  Release the security fields</span>
00973     <span class="comment">//</span>
00974 
00975     <a class="code" href="../../d1/d9/ps_8h.html#a22">PsFreeProcessSecurityFields</a>();
00976 
00977 
00978     <span class="keywordflow">if</span> ( OldClient ) {
00979 
00980         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00981 
00982     } <span class="keywordflow">else</span> {
00983         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00984     }
00985 
00986 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a113" doxytag="ps.h::PsEnforceExecutionTimeLimits" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsEnforceExecutionTimeLimits           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/psjob_8c-source.html#l02396">2396</a> of file <a class="el" href="../../d2/d0/psjob_8c-source.html">psjob.c</a>.
<p>
References <a class="el" href="../../d2/d8/ps_8h-source.html#l00503">_EJOB::ActiveProcesses</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00539">_EJOB::CompletionKey</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00538">_EJOB::CompletionPort</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00537">_EJOB::EndOfJobTimeAction</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00488">_EJOB::Event</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02475">ExAcquireResourceExclusive</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02393">ExReleaseResource</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00671">IoSetIoCompletion()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00491">_EJOB::JobLock</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00286">_EPROCESS::JobStatus</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02774">KeMaximumIncrement</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00512">_EJOB::LimitFlags</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00058">ObGetObjectPointerCount()</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00166">_EPROCESS::Pcb</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00511">_EJOB::PerJobUserTimeLimit</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00510">_EJOB::PerProcessUserTimeLimit</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00490">_EJOB::ProcessListHead</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00151">PS_CLEAR_BITS</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00315">PS_JOB_STATUS_ACCOUNTING_FOLDED</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00319">PS_JOB_STATUS_LAST_REPORT_MEMORY</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00314">PS_JOB_STATUS_NOT_REALLY_ACTIVE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00154">PS_SET_CLEAR_BITS</a>, <a class="el" href="../../d1/d9/ps_8h.html#a155a90">PsLockReturnTimeout</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02632">PspFoldProcessAccountingIntoJob()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00119">PspJobList</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00118">PspJobListLock</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02570">PspTerminateAllProcessesInJob()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00384">PspTerminateProcess()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00499">_EJOB::ThisPeriodTotalUserTime</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00504">_EJOB::TotalTerminatedProcesses</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00174">_EPROCESS::UniqueProcessId</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00756">_KPROCESS::UserTime</a>.
<p>
Referenced by <a class="el" href="../../d0/d0/balmgr_8c-source.html#l00142">KeBalanceSetManager()</a>.
<p>
<pre class="fragment"><div>02399 {
02400     PLIST_ENTRY NextJob;
02401     PLIST_ENTRY NextProcess;
02402     LARGE_INTEGER RunningJobTime;
02403     LARGE_INTEGER ProcessTime;
02404     <a class="code" href="../../d0/d3/struct__EJOB.html">PEJOB</a> Job;
02405     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process;
02406     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
02407 
02408     ExAcquireFastMutex(&amp;PspJobListLock);
02409 
02410     <span class="comment">//</span>
02411     <span class="comment">// Look at each job. If time limits are set for the job, then enforce them</span>
02412     <span class="comment">//</span>
02413     NextJob = <a class="code" href="../../d0/d1/psinit_8c.html#a26">PspJobList</a>.Flink;
02414     <span class="keywordflow">while</span> ( NextJob != &amp;<a class="code" href="../../d0/d1/psinit_8c.html#a26">PspJobList</a> ) {
02415         Job = (<a class="code" href="../../d0/d3/struct__EJOB.html">PEJOB</a>)(CONTAINING_RECORD(NextJob,<a class="code" href="../../d0/d3/struct__EJOB.html">EJOB</a>,JobLinks));
02416         <span class="keywordflow">if</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o14">LimitFlags</a> &amp; (JOB_OBJECT_LIMIT_PROCESS_TIME | JOB_OBJECT_LIMIT_JOB_TIME) ) {
02417 
02418             <span class="comment">//</span>
02419             <span class="comment">// Job looks like a candidate for time enforcing. Need to get the</span>
02420             <span class="comment">// job lock to be sure, but we don't want to hang waiting for the</span>
02421             <span class="comment">// job lock, so skip the job until next time around if we need to</span>
02422             <span class="comment">//</span>
02423             <span class="comment">//</span>
02424 
02425             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d8/ex_8h.html#a70">ExAcquireResourceExclusive</a>(&amp;Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o3">JobLock</a>, FALSE) ) {
02426 
02427                 <span class="keywordflow">if</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o14">LimitFlags</a> &amp; (JOB_OBJECT_LIMIT_PROCESS_TIME | JOB_OBJECT_LIMIT_JOB_TIME) ) {
02428 
02429                     <span class="comment">//</span>
02430                     <span class="comment">// Job is setup for time limits</span>
02431                     <span class="comment">//</span>
02432 
02433                     RunningJobTime.QuadPart = Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o6">ThisPeriodTotalUserTime</a>.QuadPart;
02434 
02435                     NextProcess = Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o2">ProcessListHead</a>.Flink;
02436 
02437                     <span class="keywordflow">while</span> ( NextProcess != &amp;Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o2">ProcessListHead</a>) {
02438 
02439                         Process = (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)(CONTAINING_RECORD(NextProcess,<a class="code" href="../../d0/d4/struct__EPROCESS.html">EPROCESS</a>,JobLinks));
02440 
02441                         ProcessTime.QuadPart = UInt32x32To64(Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o0">Pcb</a>.<a class="code" href="../../d5/d7/struct__KPROCESS.html#o5">UserTime</a>,KeMaximumIncrement);
02442 
02443                         <span class="keywordflow">if</span> ( !(Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o74">JobStatus</a> &amp; <a class="code" href="../../d1/d9/ps_8h.html#a10">PS_JOB_STATUS_ACCOUNTING_FOLDED</a>) ) {
02444                             RunningJobTime.QuadPart += ProcessTime.QuadPart;
02445                             }
02446 
02447                         <span class="keywordflow">if</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o14">LimitFlags</a> &amp; JOB_OBJECT_LIMIT_PROCESS_TIME ) {
02448                             <span class="keywordflow">if</span> ( ProcessTime.QuadPart &gt; Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o12">PerProcessUserTimeLimit</a>.QuadPart ) {
02449 
02450                                 <span class="comment">//</span>
02451                                 <span class="comment">// Process Time Limit has been exceeded.</span>
02452                                 <span class="comment">//</span>
02453                                 <span class="comment">// Reference the process. Assert that it is not in its</span>
02454                                 <span class="comment">// delete routine. If all is OK, then nuke and dereferece</span>
02455                                 <span class="comment">// the process</span>
02456                                 <span class="comment">//</span>
02457 
02458                                 <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(Process);
02459 
02460                                 <span class="comment">//</span>
02461                                 <span class="comment">// Avoid double delete since process could be in delete routine during the above ref</span>
02462                                 <span class="comment">//</span>
02463                                 <span class="keywordflow">if</span> ( <a class="code" href="../../d7/d1/obref_8c.html#a1">ObGetObjectPointerCount</a>(Process) &gt; 1 ) {
02464 
02465                                     <span class="keywordflow">if</span> ( !(Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o74">JobStatus</a> &amp; <a class="code" href="../../d1/d9/ps_8h.html#a9">PS_JOB_STATUS_NOT_REALLY_ACTIVE</a>) ) {
02466                                         <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d1/psp_8h.html#a94">PspTerminateProcess</a>(Process,ERROR_NOT_ENOUGH_QUOTA,PsLockReturnTimeout) == STATUS_SUCCESS ) {
02467 
02468                                             Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o11">TotalTerminatedProcesses</a>++;
02469                                             <a class="code" href="../../d1/d9/ps_8h.html#a8">PS_SET_CLEAR_BITS</a> (&amp;Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o74">JobStatus</a>,
02470                                                                PS_JOB_STATUS_NOT_REALLY_ACTIVE,
02471                                                                PS_JOB_STATUS_LAST_REPORT_MEMORY);
02472                                             Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o10">ActiveProcesses</a>--;
02473 
02474                                             <span class="keywordflow">if</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o25">CompletionPort</a> ) {
02475                                                 <a class="code" href="../../d5/d4/complete_8c.html#a6">IoSetIoCompletion</a>(
02476                                                     Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o25">CompletionPort</a>,
02477                                                     Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o26">CompletionKey</a>,
02478                                                     (PVOID)Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o7">UniqueProcessId</a>,
02479                                                     STATUS_SUCCESS,
02480                                                     JOB_OBJECT_MSG_END_OF_PROCESS_TIME,
02481                                                     FALSE
02482                                                     );
02483                                                 }
02484                                             <a class="code" href="../../d8/d1/psp_8h.html#a98">PspFoldProcessAccountingIntoJob</a>(Job,Process);
02485 
02486                                             }
02487                                         }
02488                                     <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>(Process);
02489                                     }
02490                                 }
02491                             }
02492 
02493                         NextProcess = NextProcess-&gt;Flink;
02494                         }
02495                     <span class="keywordflow">if</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o14">LimitFlags</a> &amp; JOB_OBJECT_LIMIT_JOB_TIME ) {
02496                         <span class="keywordflow">if</span> ( RunningJobTime.QuadPart &gt; Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o13">PerJobUserTimeLimit</a>.QuadPart ) {
02497 
02498                             <span class="comment">//</span>
02499                             <span class="comment">// Job Time Limit has been exceeded.</span>
02500                             <span class="comment">//</span>
02501                             <span class="comment">// Perform the appropriate action</span>
02502                             <span class="comment">//</span>
02503 
02504                             <span class="keywordflow">switch</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o24">EndOfJobTimeAction</a> ) {
02505 
02506                             <span class="keywordflow">case</span> JOB_OBJECT_TERMINATE_AT_END_OF_JOB:
02507                                 <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d1/psp_8h.html#a97">PspTerminateAllProcessesInJob</a>(Job,ERROR_NOT_ENOUGH_QUOTA,PsLockReturnTimeout) ) {
02508                                     <span class="keywordflow">if</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o10">ActiveProcesses</a> == 0 ) {
02509                                         <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>(&amp;Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o0">Event</a>,0,FALSE);
02510                                         <span class="keywordflow">if</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o25">CompletionPort</a> ) {
02511                                             <a class="code" href="../../d1/d9/ps_8h.html#a7">PS_CLEAR_BITS</a> (&amp;Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o74">JobStatus</a>, PS_JOB_STATUS_LAST_REPORT_MEMORY);
02512                                             <a class="code" href="../../d5/d4/complete_8c.html#a6">IoSetIoCompletion</a>(
02513                                                 Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o25">CompletionPort</a>,
02514                                                 Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o26">CompletionKey</a>,
02515                                                 NULL,
02516                                                 STATUS_SUCCESS,
02517                                                 JOB_OBJECT_MSG_END_OF_JOB_TIME,
02518                                                 FALSE
02519                                                 );
02520                                             }
02521                                         }
02522                                     }
02523                                 <span class="keywordflow">break</span>;
02524 
02525                             <span class="keywordflow">case</span> JOB_OBJECT_POST_AT_END_OF_JOB:
02526 
02527                                 <span class="keywordflow">if</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o25">CompletionPort</a> ) {
02528                                     <a class="code" href="../../d1/d9/ps_8h.html#a7">PS_CLEAR_BITS</a> (&amp;Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o74">JobStatus</a>, PS_JOB_STATUS_LAST_REPORT_MEMORY);
02529                                     st = <a class="code" href="../../d5/d4/complete_8c.html#a6">IoSetIoCompletion</a>(
02530                                             Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o25">CompletionPort</a>,
02531                                             Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o26">CompletionKey</a>,
02532                                             NULL,
02533                                             STATUS_SUCCESS,
02534                                             JOB_OBJECT_MSG_END_OF_JOB_TIME,
02535                                             FALSE
02536                                             );
02537                                     <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
02538 
02539                                         <span class="comment">//</span>
02540                                         <span class="comment">// Clear job level time limit</span>
02541                                         <span class="comment">//</span>
02542 
02543                                         Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o14">LimitFlags</a> &amp;= ~JOB_OBJECT_LIMIT_JOB_TIME;
02544                                         Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o13">PerJobUserTimeLimit</a>.QuadPart = 0;
02545                                         }
02546                                     }
02547                                 <span class="keywordflow">else</span> {
02548                                     <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d1/psp_8h.html#a97">PspTerminateAllProcessesInJob</a>(Job,ERROR_NOT_ENOUGH_QUOTA,PsLockReturnTimeout) ) {
02549                                         <span class="keywordflow">if</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o10">ActiveProcesses</a> == 0 ) {
02550                                             <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>(&amp;Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o0">Event</a>,0,FALSE);
02551                                             }
02552                                         }
02553                                     }
02554                                 <span class="keywordflow">break</span>;
02555                                 }
02556                             }
02557 
02558                         }
02559 
02560                     }
02561                 <a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(&amp;Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o3">JobLock</a>);
02562                 }
02563             }
02564         NextJob = NextJob-&gt;Flink;
02565         }
02566     ExReleaseFastMutex(&amp;PspJobListLock);
02567 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a150" doxytag="ps.h::PsEstablishWin32Callouts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID PsEstablishWin32Callouts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d9/ps_8h.html#a74">PKWIN32_PROCESS_CALLOUT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessCallout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/ps_8h.html#a80">PKWIN32_THREAD_CALLOUT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ThreadCallout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a170">PKWIN32_GLOBALATOMTABLE_CALLOUT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>GlobalAtomTableCallout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/ps_8h.html#a86">PKWIN32_POWEREVENT_CALLOUT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PowerEventCallout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/ps_8h.html#a87">PKWIN32_POWERSTATE_CALLOUT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PowerStateCallout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/ps_8h.html#a78">PKWIN32_JOB_CALLOUT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>JobCallout</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BatchFlushRoutine</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/psquery_8c-source.html#l03855">3855</a> of file <a class="el" href="../../d0/d1/psquery_8c-source.html">psquery.c</a>.
<p>
References <a class="el" href="../../d7/d7/exatom_8c-source.html#l00439">ExGlobalAtomTableCallout</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02772">KeGdiFlushUserBatch</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02275">PGDI_BATCHFLUSH_ROUTINE</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03848">PopEventCallout</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03849">PopStateCallout</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00536">PspW32JobCallout</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00534">PspW32ProcessCallout</a>, and <a class="el" href="../../d9/d0/psp_8h-source.html#l00535">PspW32ThreadCallout</a>.
<p>
<pre class="fragment"><div>03867                    :
03868 
03869     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Win32 kernel mode component to
03870     <span class="keyword">register</span> callout <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a16">functions</a> <span class="keywordflow">for</span> process/thread init/deinit <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a16">functions</a>
03871     and to report <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sizes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> structures.
03872 
03873 Arguments:
03874 
03875     ProcessCallout - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function to be called when
03876         a process <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> either created or deleted.
03877 
03878     ThreadCallout - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function to be called when
03879         a thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> either created or deleted.
03880 
03881     GlobalAtomTableCallout - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function to be called
03882         to get <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> correct global atom table <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process
03883 
03884     PowerEventCallout - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a function to be called when
03885         a power event occurs.
03886 
03887     PowerStateCallout - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a function to be called when
03888         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> power state changes.
03889 
03890     JobCallout - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a function to be called when
03891         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> job state changes or a process <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assigned to a job.
03892 
03893     BatchFlushRoutine - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function to be called
03894 
03895 Return Value:
03896 
03897     None.
03898 
03899 --*/
03900 
03901 {
03902     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03903 
03904     <a class="code" href="../../d8/d1/psp_8h.html#a39">PspW32ProcessCallout</a> = ProcessCallout;
03905     <a class="code" href="../../d8/d1/psp_8h.html#a40">PspW32ThreadCallout</a> = ThreadCallout;
03906     <a class="code" href="../../d6/d8/exatom_8c.html#a0">ExGlobalAtomTableCallout</a> = GlobalAtomTableCallout;
03907     <a class="code" href="../../d4/d9/ke_8h.html#a129">KeGdiFlushUserBatch</a> = (<a class="code" href="../../d4/d9/ke_8h.html#a117">PGDI_BATCHFLUSH_ROUTINE</a>)BatchFlushRoutine;
03908     <a class="code" href="../../d9/d1/psquery_8c.html#a10">PopEventCallout</a> = PowerEventCallout;
03909     <a class="code" href="../../d9/d1/psquery_8c.html#a11">PopStateCallout</a> = PowerStateCallout;
03910     <a class="code" href="../../d8/d1/psp_8h.html#a41">PspW32JobCallout</a> = JobCallout;
03911 <span class="comment">//    PoSetSystemState(ES_SYSTEM_REQUIRED);</span>
03912 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a117" doxytag="ps.h::PsExitSpecialApc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsExitSpecialApc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d5/struct__KAPC.html">PKAPC</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Apc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a41">PKNORMAL_ROUTINE</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>NormalContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>SystemArgument2</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00603">603</a> of file <a class="el" href="../../d9/d9/psdelete_8c-source.html">psdelete.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>.
<p>
Referenced by <a class="el" href="../../d7/d6/apcsup_8c-source.html#l00223">KiInsertQueueApc()</a>, <a class="el" href="../../d1/d1/thredsup_8c-source.html#l00770">KiSuspendThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00631">PspExitNormalApc()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00160">PspTerminateThreadByPointer()</a>.
<p>
<pre class="fragment"><div>00611 {
00612     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> ExitStatus;
00613 
00614     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00615 
00616     UNREFERENCED_PARAMETER(NormalRoutine);
00617     UNREFERENCED_PARAMETER(NormalContext);
00618     UNREFERENCED_PARAMETER(SystemArgument1);
00619     UNREFERENCED_PARAMETER(SystemArgument2);
00620 
00621     <span class="keywordflow">if</span> ( Apc-&gt;SystemArgument2 ) {
00622         ExitStatus = (<a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>)((LONG_PTR)Apc-&gt;NormalContext);
00623         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(Apc);
00624         <a class="code" href="../../d8/d1/psp_8h.html#a68">PspExitThread</a>(ExitStatus);
00625     }
00626 
00627 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a149" doxytag="ps.h::PsForwardException" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN PsForwardException           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>DebugException</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SecondChance</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a152" doxytag="ps.h::PsGetCurrentProcessId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE PsGetCurrentProcessId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02306">2306</a> of file <a class="el" href="../../d3/d7/ps_2create_8c-source.html">ps/create.c</a>.
<p>
References <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03736">SeAuditHandleCreation()</a>.
<p>
<pre class="fragment"><div>02307 {
02308     <span class="keywordflow">return</span> <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;Cid.UniqueProcess;
02309 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a153" doxytag="ps.h::PsGetCurrentThreadId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> HANDLE PsGetCurrentThreadId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02312">2312</a> of file <a class="el" href="../../d3/d7/ps_2create_8c-source.html">ps/create.c</a>.
<p>
References <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>.
<p>
<pre class="fragment"><div>02313 {
02314     <span class="keywordflow">return</span> <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>()-&gt;Cid.UniqueThread;
02315 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a129" doxytag="ps.h::PsGetProcessExitTime" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LARGE_INTEGER PsGetProcessExitTime           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/psdelete_8c-source.html#l01539">1539</a> of file <a class="el" href="../../d9/d9/psdelete_8c-source.html">psdelete.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>.
<p>
<pre class="fragment"><div>01545                    :
01546 
01547     This routine returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a> time <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process.
01548 
01549 Arguments:
01550 
01551     None.
01552 
01553 Return Value:
01554 
01555     The function value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a> time <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process.
01556 
01557 Note:
01558 
01559     This routine assumes that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller wants an error log entry within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01560     bounds of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> maximum size.
01561 
01562 --*/
01563 
01564 {
01565     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01566 
01567     <span class="comment">//</span>
01568     <span class="comment">// Simply return the exit time for this process.</span>
01569     <span class="comment">//</span>
01570 
01571     <span class="keywordflow">return</span> <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>()-&gt;ExitTime;
01572 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a154" doxytag="ps.h::PsGetVersion" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN PsGetVersion           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PULONG MajorVersion&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PULONG MinorVersion&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PULONG BuildNumber&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PUNICODE_STRING CSDVersion&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02318">2318</a> of file <a class="el" href="../../d3/d7/ps_2create_8c-source.html">ps/create.c</a>.
<p>
References <a class="el" href="../../d9/d0/init_8h-source.html#l00034">CmCSDVersionString</a>, <a class="el" href="../../d6/d4/triage_8c-source.html#l00042">NtBuildNumber</a>, <a class="el" href="../../d9/d0/init_8h-source.html#l00030">NtMajorVersion</a>, and <a class="el" href="../../d9/d0/init_8h-source.html#l00031">NtMinorVersion</a>.
<p>
<pre class="fragment"><div>02324 {
02325     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(MajorVersion)) {
02326         *MajorVersion = <a class="code" href="../../d8/d1/init_8h.html#a5">NtMajorVersion</a>;
02327     }
02328 
02329     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(MinorVersion)) {
02330         *MinorVersion = <a class="code" href="../../d8/d1/init_8h.html#a6">NtMinorVersion</a>;
02331     }
02332 
02333     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(BuildNumber)) {
02334         *BuildNumber = <a class="code" href="../../d5/d5/triage_8c.html#a0">NtBuildNumber</a> &amp; 0x3FFF;
02335     }
02336 
02337     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(CSDVersion)) {
02338         *CSDVersion = <a class="code" href="../../d8/d1/init_8h.html#a9">CmCSDVersionString</a>;
02339     }
02340     <span class="keywordflow">return</span> (<a class="code" href="../../d5/d5/triage_8c.html#a0">NtBuildNumber</a> &gt;&gt; 28) == 0xC;
02341 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a131" doxytag="ps.h::PsImpersonateClient" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PsImpersonateClient           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>CopyOnOpen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>EffectiveOnly</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN SECURITY_IMPERSONATION_LEVEL&nbsp;</td>
          <td class="mdname" nowrap> <em>ImpersonationLevel</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00650">650</a> of file <a class="el" href="../../d7/d4/ps_2security_8c-source.html">ps/security.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00093">_PS_IMPERSONATION_INFORMATION::CopyOnOpen</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00094">_PS_IMPERSONATION_INFORMATION::EffectiveOnly</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d1/rtnotify_8c-source.html#l00075">Filter</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00095">_PS_IMPERSONATION_INFORMATION::ImpersonationLevel</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00840">PsDereferenceImpersonationToken</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00661">PsFreeProcessSecurityFields</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00654">PsLockProcessSecurityFields</a>, <a class="el" href="../../d7/d2/tokendup_8c-source.html#l01859">SeFastFilterToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00150">SeTokenIsAdmin()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00181">SeTokenIsRestricted()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a163">ThreadObject</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00092">_PS_IMPERSONATION_INFORMATION::Token</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d2/token_8c-source.html#l03038">NtImpersonateAnonymousToken()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00458">NtOpenThreadToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l01483">PsAssignImpersonationToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00990">PsRestoreImpersonation()</a>, and <a class="el" href="../../d5/d4/seclient_8c-source.html#l00636">SeImpersonateClientEx()</a>.
<p>
<pre class="fragment"><div>00660                    :
00661 
00662     This routine sets up <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread so that <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> impersonating
00663     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified client.  This will result in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference count of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00664     token representing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client being incremented to reflect <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span>
00665     reference.
00666 
00667     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently impersonating a client, that token will be
00668     dereferenced.
00669 
00670 
00671 
00672 Arguments:
00673 
00674     Thread - points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> going to impersonate a client.
00675 
00676     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token to be assigned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> impersonation token.
00677         This does NOT have to be a TokenImpersonation <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> token.  This
00678         allows direct reference of client process's primary tokens.
00679 
00680     CopyOnOpen - If <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> considered to be <span class="keyword">private</span>
00681         by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> assigner and should be copied <span class="keywordflow">if</span> opened.  For example, a
00682         session layer may be <span class="keyword">using</span> a token to represent a client's context.
00683         If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> session <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> trying to synchronize <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> context of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client,
00684         then user mode code should not be given direct access to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> session
00685         layer's token.
00686 
00687         Basically, session layers should always specify <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">for</span> <span class="keyword">this</span>, <span class="keywordflow">while</span>
00688         tokens assigned by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> server itself (handle based) should specify
00689         <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>.
00690 
00691 
00692     EffectiveOnly - Is a <span class="keywordtype">boolean</span> value to be assigned as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00693         Thread-&gt;ImpersonationInfo-&gt;EffectiveOnly field value <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00694         impersonation.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> server <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allowed
00695         to enable currently disabled groups and privileges.
00696 
00697     ImpersonationLevel - Is <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> impersonation level that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> server <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allowed
00698         to access <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token with.
00699 
00700 
00701 Return Value:
00702 
00703     STATUS_SUCCESS - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> call completed successfully.
00704 
00705 
00706 --*/
00707 
00708 {
00709 
00710     <a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html">PPS_IMPERSONATION_INFORMATION</a>
00711         NewClient;
00712 
00713     PACCESS_TOKEN
00714         OldToken;
00715 
00716     PACCESS_TOKEN NewerToken ;
00717     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> ;
00718     <a class="code" href="../../d6/d1/struct__PS__JOB__TOKEN__FILTER.html">PPS_JOB_TOKEN_FILTER</a> <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a> ;
00719     BOOLEAN DontRefToken = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
00720 
00721     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Thread-&gt;Tcb.Header.Type == ThreadObject );
00722 
00723 
00724     <span class="comment">//</span>
00725     <span class="comment">//  Lock the process security fields</span>
00726     <span class="comment">//</span>
00727 
00728     <a class="code" href="../../d1/d9/ps_8h.html#a21">PsLockProcessSecurityFields</a>();
00729 
00730 
00731     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT(Token)) {
00732 
00733         <span class="comment">//</span>
00734         <span class="comment">// This is a request to revert to self.</span>
00735         <span class="comment">// Clean up any client information.</span>
00736         <span class="comment">//</span>
00737 
00738         <span class="keywordflow">if</span> ( Thread-&gt;ActiveImpersonationInfo ) {
00739 
00740             OldToken = Thread-&gt;ImpersonationInfo-&gt;Token;
00741             Thread-&gt;ActiveImpersonationInfo = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00742         } <span class="keywordflow">else</span> {
00743             OldToken = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00744         }
00745 
00746     } <span class="keywordflow">else</span> {
00747 
00748         <span class="comment">//</span>
00749         <span class="comment">// Check if we're allowed to impersonate based on the job</span>
00750         <span class="comment">// restrictions:</span>
00751         <span class="comment">//</span>
00752 
00753         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS ;
00754 
00755         <span class="keywordflow">if</span> ( Thread-&gt;ThreadsProcess-&gt;Job ) {
00756 
00757             <span class="keywordflow">if</span> ( ( Thread-&gt;ThreadsProcess-&gt;Job-&gt;SecurityLimitFlags &amp; JOB_OBJECT_SECURITY_NO_ADMIN ) &amp;&amp;
00758                  ( <a class="code" href="../../d4/d3/token_8c.html#a4">SeTokenIsAdmin</a>( Token ) ) ) {
00759 
00760                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_ACCESS_DENIED ;
00761 
00762             }
00763 
00764             <span class="keywordflow">if</span> ( ( Thread-&gt;ThreadsProcess-&gt;Job-&gt;SecurityLimitFlags &amp; JOB_OBJECT_SECURITY_RESTRICTED_TOKEN ) &amp;&amp;
00765                  ( !<a class="code" href="../../d4/d3/token_8c.html#a5">SeTokenIsRestricted</a>( Token ) ) )
00766             {
00767                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_ACCESS_DENIED ;
00768             }
00769 
00770             <span class="keywordflow">if</span> ( Thread-&gt;ThreadsProcess-&gt;Job-&gt;Filter )
00771             {
00772                 <span class="comment">//</span>
00773                 <span class="comment">// Filter installed.  Need to create a restricted token</span>
00774                 <span class="comment">// dynamically.</span>
00775                 <span class="comment">//</span>
00776                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a> = Thread-&gt;ThreadsProcess-&gt;Job-&gt;Filter ;
00777 
00778                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d3/tokendup_8c.html#a9">SeFastFilterToken</a>(
00779                                 Token,
00780                                 KernelMode,
00781                                 0,
00782                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedGroupCount,
00783                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedGroups,
00784                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedPrivilegeCount,
00785                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedPrivileges,
00786                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedSidCount,
00787                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedSids,
00788                                 <a class="code" href="../../d5/d2/rtnotify_8c.html#a9">Filter</a>-&gt;CapturedSidsLength,
00789                                 &amp;NewerToken );
00790 
00791                 <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ) )
00792                 {
00793                     DontRefToken = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
00794 
00795                     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = NewerToken ;
00796                 }
00797 
00798             }
00799         }
00800 
00801         <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status ) )
00802         {
00803             <a class="code" href="../../d1/d9/ps_8h.html#a22">PsFreeProcessSecurityFields</a>();
00804 
00805             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> ;
00806         }
00807 
00808         <span class="comment">//</span>
00809         <span class="comment">// If we are already impersonating someone,</span>
00810         <span class="comment">// use the already allocated block.  This avoids</span>
00811         <span class="comment">// an alloc and a free.</span>
00812         <span class="comment">//</span>
00813 
00814         <span class="keywordflow">if</span> ( Thread-&gt;ActiveImpersonationInfo ) {
00815 
00816             <span class="comment">//</span>
00817             <span class="comment">// capture the old token pointer.</span>
00818             <span class="comment">// We'll dereference it after unlocking the security fields.</span>
00819             <span class="comment">//</span>
00820 
00821             OldToken = Thread-&gt;ImpersonationInfo-&gt;Token;
00822             NewClient = Thread-&gt;ImpersonationInfo;
00823 
00824         } <span class="keywordflow">else</span> {
00825 
00826             OldToken = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00827 
00828             <span class="keywordflow">if</span> ( Thread-&gt;ImpersonationInfo ) {
00829                 NewClient = Thread-&gt;ImpersonationInfo;
00830             } <span class="keywordflow">else</span> {
00831 
00832                 <span class="comment">//</span>
00833                 <span class="comment">// Allocate and set up the Client block</span>
00834                 <span class="comment">//</span>
00835 
00836                 NewClient = (<a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html">PPS_IMPERSONATION_INFORMATION</a>)<a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(
00837                                 PagedPool,
00838                                 <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html">PS_IMPERSONATION_INFORMATION</a>),
00839                                 'mIsP');
00840 
00841                 <span class="keywordflow">if</span> (NewClient == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00842 
00843                     <a class="code" href="../../d1/d9/ps_8h.html#a22">PsFreeProcessSecurityFields</a>();
00844 
00845                     <span class="keywordflow">return</span> STATUS_NO_MEMORY ;
00846 
00847                 }
00848 
00849                 Thread-&gt;ImpersonationInfo = NewClient;
00850             }
00851         }
00852 
00853         NewClient-&gt;<a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html#o3">ImpersonationLevel</a> = ImpersonationLevel;
00854         NewClient-&gt;<a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html#o2">EffectiveOnly</a> = EffectiveOnly;
00855         NewClient-&gt;<a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html#o1">CopyOnOpen</a> = CopyOnOpen;
00856         NewClient-&gt;<a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html#o0">Token</a> = <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00857         Thread-&gt;ActiveImpersonationInfo = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00858 
00859         <span class="keywordflow">if</span> ( !DontRefToken )
00860         {
00861             <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(NewClient-&gt;<a class="code" href="../../d5/d1/struct__PS__IMPERSONATION__INFORMATION.html#o0">Token</a>);
00862         }
00863     }
00864 
00865     <span class="comment">//</span>
00866     <span class="comment">//  Release the security fields</span>
00867     <span class="comment">//</span>
00868 
00869     <a class="code" href="../../d1/d9/ps_8h.html#a22">PsFreeProcessSecurityFields</a>();
00870 
00871 
00872     <span class="comment">//</span>
00873     <span class="comment">// Free the old client token, if necessary.</span>
00874     <span class="comment">//</span>
00875 
00876     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( OldToken )) {
00877 
00878         <a class="code" href="../../d1/d9/ps_8h.html#a26">PsDereferenceImpersonationToken</a>( OldToken );
00879     }
00880 
00881 
00882     <span class="keywordflow">return</span> STATUS_SUCCESS ;
00883 
00884 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a114" doxytag="ps.h::PsInitSystem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN PsInitSystem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Phase</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d2/struct__LOADER__PARAMETER__BLOCK.html">PLOADER_PARAMETER_BLOCK</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LoaderBlock</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/psinit_8c-source.html#l00138">138</a> of file <a class="el" href="../../d1/d0/psinit_8c-source.html">psinit.c</a>.
<p>
References <a class="el" href="../../d9/d0/init_8h-source.html#l00070">InitializationPhase</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>, and <a class="el" href="../../d1/d0/psinit_8c-source.html#l00487">PspInitPhase1()</a>.
<p>
<pre class="fragment"><div>00145                    :
00146 
00147     This function fermorms process structure initialization.
00148     It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called during phase 0 and phase 1 initialization. Its
00149     function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to dispatch to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> appropriate phase initialization
00150     routine.
00151 
00152 Arguments:
00153 
00154     Phase - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> initialization phase number.
00155 
00156     LoaderBlock - Supplies a pointer to a loader parameter block.
00157 
00158 Return Value:
00159 
00160     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - Initialization succeeded.
00161 
00162     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - Initialization failed.
00163 
00164 --*/
00165 
00166 {
00167 
00168     <span class="keywordflow">switch</span> ( <a class="code" href="../../d8/d1/init_8h.html#a21">InitializationPhase</a> ) {
00169 
00170     <span class="keywordflow">case</span> 0 :
00171         <span class="keywordflow">return</span> <a class="code" href="../../d8/d1/psp_8h.html#a55">PspInitPhase0</a>(LoaderBlock);
00172     <span class="keywordflow">case</span> 1 :
00173         <span class="keywordflow">return</span> <a class="code" href="../../d8/d1/psp_8h.html#a56">PspInitPhase1</a>(LoaderBlock);
00174     <span class="keywordflow">default</span>:
00175         <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(UNEXPECTED_INITIALIZATION_CALL);
00176     }
00177     <span class="keywordflow">return</span> 0; <span class="comment">// Not reachable, quiet compiler</span>
00178 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a115" doxytag="ps.h::PsLocateSystemDll" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PsLocateSystemDll           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/psinit_8c-source.html#l00525">525</a> of file <a class="el" href="../../d1/d0/psinit_8c-source.html">psinit.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00086">_SYSTEM_DLL::DllBase</a>, <a class="el" href="../../d2/d8/icmui_8def-source.html#l00004">File</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d1/psinit_8c.html#a39">MmCheckSystemImage()</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l00381">MmSectionObjectType</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00532">NtRaiseHardError()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00576">PsNtDllPathName</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00679">PspMapSystemDll()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00124">PspSystemDll</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00577">PsSystemDllBase</a>, <a class="el" href="../../d7/d7/ex_2harderr_8c-source.html#l00061">PsSystemDllDllBase</a>, <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l00410">RtlAllocateStringRoutine</a>, <a class="el" href="../../d7/d5/nls_8c-source.html#l01763">RtlCopyUnicodeString()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00085">_SYSTEM_DLL::Section</a>, and <a class="el" href="../../d7/d8/restrfil_8c-source.html#l00582">ZwOpenFile()</a>.
<p>
Referenced by <a class="el" href="../../d0/d5/ioinit_8c-source.html#l00270">IoInitSystem()</a>.
<p>
<pre class="fragment"><div>00531                    :
00532 
00533     This function locates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system dll and creates a section <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00534     DLL and maps <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system process.
00535 
00536 Arguments:
00537 
00538     None.
00539 
00540 Return Value:
00541 
00542     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - Initialization was successful.
00543 
00544     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - Initialization Failed.
00545 
00546 --*/
00547 
00548 {
00549 
00550     HANDLE <a class="code" href="../../d1/d9/icmui_8def.html#a0">File</a>;
00551     HANDLE Section;
00552     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> st;
00553     UNICODE_STRING DllPathName;
00554     WCHAR PathBuffer[DOS_MAX_PATH_LENGTH];
00555     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00556     IO_STATUS_BLOCK IoStatus;
00557 
00558     <span class="comment">//</span>
00559     <span class="comment">// Initialize the system DLL</span>
00560     <span class="comment">//</span>
00561 
00562     DllPathName.Length = 0;
00563     DllPathName.Buffer = PathBuffer;
00564     DllPathName.MaximumLength = 256;
00565     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(&amp;DllPathName,L<span class="stringliteral">"\\SystemRoot\\System32\\ntdll.dll"</span>);
00566     InitializeObjectAttributes(
00567         &amp;ObjectAttributes,
00568         &amp;DllPathName,
00569         OBJ_CASE_INSENSITIVE,
00570         NULL,
00571         NULL
00572         );
00573 
00574     st = <a class="code" href="../../d6/d9/restrfil_8c.html#a33">ZwOpenFile</a>(
00575             &amp;File,
00576             SYNCHRONIZE | FILE_EXECUTE,
00577             &amp;ObjectAttributes,
00578             &amp;IoStatus,
00579             FILE_SHARE_READ,
00580             0
00581             );
00582 
00583     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st)) {
00584 
00585 <span class="preprocessor">#if DBG</span>
00586 <span class="preprocessor"></span>        <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"PS: PsLocateSystemDll - NtOpenFile( NTDLL.DLL ) failed.  Status == %lx\n"</span>,
00587             st
00588             );
00589 <span class="preprocessor">#endif</span>
00590 <span class="preprocessor"></span>        <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(PROCESS1_INITIALIZATION_FAILED,st,2,0,0);
00591         <span class="keywordflow">return</span> st;
00592     }
00593 
00594     st = <a class="code" href="../../d0/d1/psinit_8c.html#a39">MmCheckSystemImage</a>(File);
00595     <span class="keywordflow">if</span> ( st == STATUS_IMAGE_CHECKSUM_MISMATCH ) {
00596         ULONG_PTR ErrorParameters;
00597         ULONG ErrorResponse;
00598 
00599         <span class="comment">//</span>
00600         <span class="comment">// Hard error time. A driver is corrupt.</span>
00601         <span class="comment">//</span>
00602 
00603     ErrorParameters = (ULONG_PTR)&amp;DllPathName;
00604 
00605         <a class="code" href="../../d6/d8/ex_2harderr_8c.html#a11">NtRaiseHardError</a>(
00606             st,
00607             1,
00608             1,
00609             &amp;ErrorParameters,
00610             OptionOk,
00611             &amp;ErrorResponse
00612             );
00613         <span class="keywordflow">return</span> st;
00614         }
00615 
00616 
00617     <a class="code" href="../../d1/d9/ps_8h.html#a50">PsNtDllPathName</a>.MaximumLength = DllPathName.Length + <span class="keyword">sizeof</span>( WCHAR );
00618     <a class="code" href="../../d1/d9/ps_8h.html#a50">PsNtDllPathName</a>.Length = 0;
00619     <a class="code" href="../../d1/d9/ps_8h.html#a50">PsNtDllPathName</a>.Buffer = <a class="code" href="../../d2/d2/ex_2pool_8c.html#a49">RtlAllocateStringRoutine</a>( <a class="code" href="../../d1/d9/ps_8h.html#a50">PsNtDllPathName</a>.MaximumLength );
00620     <a class="code" href="../../d6/d6/nls_8c.html#a44">RtlCopyUnicodeString</a>( &amp;PsNtDllPathName, &amp;DllPathName );
00621 
00622     st = ZwCreateSection(
00623             &amp;Section,
00624             SECTION_ALL_ACCESS,
00625             NULL,
00626             0,
00627             PAGE_EXECUTE,
00628             SEC_IMAGE,
00629             File
00630             );
00631     ZwClose( File );
00632 
00633     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st)) {
00634 <span class="preprocessor">#if DBG</span>
00635 <span class="preprocessor"></span>        <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"PS: PsLocateSystemDll: NtCreateSection Status == %lx\n"</span>,st);
00636 <span class="preprocessor">#endif</span>
00637 <span class="preprocessor"></span>        <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(PROCESS1_INITIALIZATION_FAILED,st,3,0,0);
00638         <span class="keywordflow">return</span> st;
00639     }
00640 
00641     <span class="comment">//</span>
00642     <span class="comment">// Now that we have the section, reference it, store its address in the</span>
00643     <span class="comment">// PspSystemDll and then close handle to the section.</span>
00644     <span class="comment">//</span>
00645 
00646     st = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(
00647             Section,
00648             SECTION_ALL_ACCESS,
00649             MmSectionObjectType,
00650             KernelMode,
00651             &amp;<a class="code" href="../../d0/d1/psinit_8c.html#a30">PspSystemDll</a>.<a class="code" href="../../d0/d8/struct__SYSTEM__DLL.html#o0">Section</a>,
00652             NULL
00653             );
00654 
00655     ZwClose(Section);
00656 
00657     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
00658         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(PROCESS1_INITIALIZATION_FAILED,st,4,0,0);
00659         <span class="keywordflow">return</span> st;
00660     }
00661 
00662     <span class="comment">//</span>
00663     <span class="comment">// Map the system dll into the user part of the address space</span>
00664     <span class="comment">//</span>
00665 
00666     st = <a class="code" href="../../d8/d1/psp_8h.html#a61">PspMapSystemDll</a>(<a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>(),&amp;<a class="code" href="../../d0/d1/psinit_8c.html#a30">PspSystemDll</a>.<a class="code" href="../../d0/d8/struct__SYSTEM__DLL.html#o1">DllBase</a>);
00667     <a class="code" href="../../d6/d8/ex_2harderr_8c.html#a8">PsSystemDllDllBase</a> = <a class="code" href="../../d0/d1/psinit_8c.html#a30">PspSystemDll</a>.<a class="code" href="../../d0/d8/struct__SYSTEM__DLL.html#o1">DllBase</a>;
00668 
00669     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(st) ) {
00670         <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(PROCESS1_INITIALIZATION_FAILED,st,5,0,0);
00671         <span class="keywordflow">return</span> st;
00672     }
00673     <a class="code" href="../../d1/d9/ps_8h.html#a51">PsSystemDllBase</a> = <a class="code" href="../../d0/d1/psinit_8c.html#a30">PspSystemDll</a>.<a class="code" href="../../d0/d8/struct__SYSTEM__DLL.html#o1">DllBase</a>;
00674 
00675     <span class="keywordflow">return</span> STATUS_SUCCESS;
00676 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a147" doxytag="ps.h::PsLockProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PsLockProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>WaitMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/ps_8h.html#a73">PSLOCKPROCESSMODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>LockMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01966">1966</a> of file <a class="el" href="../../d3/d7/ps_2create_8c-source.html">ps/create.c</a>.
<p>
References <a class="el" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00623">Executive</a>, <a class="el" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00679">_KTHREAD::FreezeCount</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01072">KeClearEvent</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d4/d4/procobj_8c-source.html#l00624">KeReadStateProcess()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00596">_KTHREAD::KernelApcDisable</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00810">KeWaitForSingleObject()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d1/d9/ps_8h.html#a155a92">PsLockIAmExiting</a>, <a class="el" href="../../d1/d9/ps_8h.html#a73">PSLOCKPROCESSMODE</a>, <a class="el" href="../../d1/d9/ps_8h.html#a155a90">PsLockReturnTimeout</a>, <a class="el" href="../../d1/d9/ps_8h.html#a155a91">PsLockWaitForever</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00064">PspProcessLockMutex</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02250">PsUnlockProcess()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00347">_ETHREAD::Tcb</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00211">DbgkCreateThread()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00086">DbgkpResumeProcess()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00036">DbgkpSuspendProcess()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00266">NtAssignProcessToJobObject()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00227">NtTerminateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00461">NtTerminateThread()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02262">PspApplyJobLimitsToProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00384">PspTerminateProcess()</a>.
<p>
<pre class="fragment"><div>01974                    :
01975 
01976     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to lock <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process from create/<span class="keyword">delete</span> and to
01977     freeze threads from entering/exiting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process.
01978 
01979 Arguments:
01980 
01981     Process - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process to lock
01982 
01983     WaitMode - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor mode to issue <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> wait under
01984 
01985     LockMode - The <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of lock to attempt
01986 
01987                 <a class="code" href="../../d1/d9/ps_8h.html#a155a89">PsLockPollOnTimeout</a> - Use a timeout and poll <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lock
01988                     bailing <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process exits.
01989 
01990                 <a class="code" href="../../d1/d9/ps_8h.html#a155a90">PsLockReturnTimeout</a> - Do not poll, just timeout wait and
01991                     <span class="keywordflow">return</span> <span class="keywordflow">if</span> you can not get <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lock.
01992 
01993                 <a class="code" href="../../d1/d9/ps_8h.html#a155a91">PsLockWaitForever</a> - Wait without a timeout
01994 
01995 
01996 Return Value:
01997 
01998     STATUS_SUCCESS - You got <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lock, you must call PsUnlocProcess later on
01999 
02000     STATUS_TIMEOUT - You requested <a class="code" href="../../d1/d9/ps_8h.html#a155a90">PsLockReturnTimeout</a>, and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> lock was not available
02001 
02002     STATUS_PROCESS_IS_TERMINATING - The process you are trying to lock <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> terminating
02003 
02004 --*/
02005 
02006 {
02007 
02008     LARGE_INTEGER DueTime;
02009     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02010     PLARGE_INTEGER Timeout;
02011     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread;
02012     <a class="code" href="../../d1/d9/ps_8h.html#a73">PSLOCKPROCESSMODE</a> LocalLockMode;
02013     BOOLEAN WaitSuccess;
02014 
02015     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02016 
02017     LocalLockMode = LockMode;
02018     <span class="keywordflow">if</span> ( LockMode == <a class="code" href="../../d1/d9/ps_8h.html#a155a92">PsLockIAmExiting</a> ) {
02019         LocalLockMode = <a class="code" href="../../d1/d9/ps_8h.html#a155a91">PsLockWaitForever</a>;
02020         }
02021 
02022     Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
02023 
02024 retry:
02025     <span class="comment">//</span>
02026     <span class="comment">// Acquire process lock fast mutex to synchronize access to the ownership,</span>
02027     <span class="comment">// lock count, and synchronization event of the specified process.</span>
02028     <span class="comment">//</span>
02029 
02030     <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
02031 
02032     <a class="code" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe</a>(&amp;PspProcessLockMutex);
02033 
02034     <span class="comment">//</span>
02035     <span class="comment">// Check if the process lock can be acquired.</span>
02036     <span class="comment">//</span>
02037 
02038     <span class="keywordflow">if</span> (Process-&gt;LockCount != 1) {
02039 
02040         <span class="comment">//</span>
02041         <span class="comment">// The process lock is currently owned.</span>
02042         <span class="comment">//</span>
02043         <span class="comment">// If the lock mode is return timeout, then release the process lock</span>
02044         <span class="comment">// fast mutex and return timeout. Otherwise, set the timout value,</span>
02045         <span class="comment">// decrement the lock count, release the process lock fast mutex, and</span>
02046         <span class="comment">// wait for the process event.</span>
02047         <span class="comment">//</span>
02048 
02049         <span class="keywordflow">if</span> (LocalLockMode == <a class="code" href="../../d1/d9/ps_8h.html#a155a90">PsLockReturnTimeout</a>) {
02050             <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a>(&amp;PspProcessLockMutex);
02051             <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
02052             <span class="keywordflow">return</span> STATUS_TIMEOUT;
02053 
02054         } <span class="keywordflow">else</span> {
02055 
02056             <span class="comment">//</span>
02057             <span class="comment">// If the lock mode is not wait forever, then set the timeout</span>
02058             <span class="comment">// value to one second. Otherwise set the timeout to forever.</span>
02059             <span class="comment">//</span>
02060 
02061             <span class="keywordflow">if</span> (LocalLockMode != <a class="code" href="../../d1/d9/ps_8h.html#a155a91">PsLockWaitForever</a>) {
02062                 DueTime.QuadPart = - 10 * 1000 * 1000;
02063                 Timeout = &amp;DueTime;
02064 
02065             } <span class="keywordflow">else</span> {
02066                 Timeout = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02067             }
02068 
02069             <span class="comment">//</span>
02070             <span class="comment">// Decrement the lock count and loop waiting for the process to</span>
02071             <span class="comment">// terminate or the lock to be granted.</span>
02072             <span class="comment">//</span>
02073 
02074             Process-&gt;LockCount -= 1;
02075             <span class="keywordflow">do</span> {
02076 
02077                 WaitSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02078                 <span class="comment">//</span>
02079                 <span class="comment">// If the specified process has exited, then set the</span>
02080                 <span class="comment">// completion status and exit the loop.</span>
02081                 <span class="comment">//</span>
02082 
02083                 <span class="keywordflow">if</span> (Process-&gt;ExitTime.QuadPart != 0 &amp;&amp; LocalLockMode != <a class="code" href="../../d1/d9/ps_8h.html#a155a91">PsLockWaitForever</a>) {
02084                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_PROCESS_IS_TERMINATING;
02085                     <span class="keywordflow">break</span>;
02086                 }
02087 
02088                 <span class="comment">//</span>
02089                 <span class="comment">// Release the process lock fast mutex and wait for the</span>
02090                 <span class="comment">// lock to be granted or time out to occur.</span>
02091                 <span class="comment">//</span>
02092 
02093                 <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a>(&amp;PspProcessLockMutex);
02094 rewait:
02095                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d7/wait_8c.html#a4">KeWaitForSingleObject</a>(&amp;Process-&gt;LockEvent,
02096                                                Executive,
02097                                                WaitMode,
02098                                                FALSE,
02099                                                Timeout);
02100 
02101                 <span class="comment">//</span>
02102                 <span class="comment">// If waitmode is user-mode, then we can pop out of the wait with</span>
02103                 <span class="comment">// status_user_apc. If callers are using PsLockWaitForever, they</span>
02104                 <span class="comment">// don't expect this API to return without holding the lock, so</span>
02105                 <span class="comment">// we need to re-execute the wait. Only place waitforever is used</span>
02106                 <span class="comment">// in conjunction with UserMode is exit where all we want to do</span>
02107                 <span class="comment">// with user-mode is allow our stack to swap, not service an exitapc</span>
02108                 <span class="comment">//</span>
02109                 <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_USER_APC
02110                      &amp;&amp; WaitMode == <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>
02111                      &amp;&amp; LocalLockMode == <a class="code" href="../../d1/d9/ps_8h.html#a155a91">PsLockWaitForever</a> ) {
02112                     WaitMode = <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>;
02113                     <span class="keywordflow">goto</span> rewait;
02114                     }
02115 
02116                 <span class="comment">//</span>
02117                 <span class="comment">// Reacquire the process lock fast mutex and continue the</span>
02118                 <span class="comment">// loop if timeout has occured.</span>
02119                 <span class="comment">//</span>
02120                 <span class="comment">//</span>
02121 
02122                 <a class="code" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe</a>(&amp;PspProcessLockMutex);
02123 
02124                 <span class="comment">//</span>
02125                 <span class="comment">// If the specified process has exited, then set the</span>
02126                 <span class="comment">// completion status and exit the loop. This test needs</span>
02127                 <span class="comment">// to be repeated so we catch the non-timed out wait</span>
02128                 <span class="comment">// case where the process terminated and the lock was released</span>
02129                 <span class="comment">// during the wait period</span>
02130                 <span class="comment">//</span>
02131 
02132                 <span class="keywordflow">if</span> ( Process-&gt;ExitTime.QuadPart != 0
02133                      &amp;&amp; LocalLockMode != <a class="code" href="../../d1/d9/ps_8h.html#a155a91">PsLockWaitForever</a> ) {
02134 
02135                     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_SUCCESS ) {
02136                         <span class="comment">//</span>
02137                         <span class="comment">// We came out of the wait due to someone setting the</span>
02138                         <span class="comment">// event. Since we are now going to bail,</span>
02139                         <span class="comment">// we need to set the event to pass ownership on to someone else.</span>
02140                         <span class="comment">//</span>
02141                         WaitSuccess = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02142                         }
02143                     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_PROCESS_IS_TERMINATING;
02144                     <span class="keywordflow">break</span>;
02145                 }
02146 
02147             } <span class="keywordflow">while</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_TIMEOUT);
02148 
02149             <span class="comment">//</span>
02150             <span class="comment">// If the completion status is success, then the lock has been</span>
02151             <span class="comment">// granted and the owner is set. Otherwise, a user APC is pending</span>
02152             <span class="comment">// or the process has terminated and the lock request should be</span>
02153             <span class="comment">// dropped.</span>
02154             <span class="comment">//</span>
02155 
02156             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_SUCCESS) {
02157                 <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_PROCESS_IS_TERMINATING;
02158                 Process-&gt;LockCount += 1;
02159 
02160                 <span class="keywordflow">if</span> ( Process-&gt;LockCount == 1 ) {
02161                     <span class="comment">//</span>
02162                     <span class="comment">// No one else is involved with the lock. We were granted owner</span>
02163                     <span class="comment">// ship. We need to make sure the event is NOT signalled</span>
02164                     <span class="comment">//</span>
02165                     <span class="comment">// Is doesn't matter if we bail in this case due to a successful</span>
02166                     <span class="comment">// wait, timeout. A lock count of 1 is the initial state</span>
02167                     <span class="comment">// of a free lock.</span>
02168 
02169                     <a class="code" href="../../d4/d9/ke_8h.html#a21">KeClearEvent</a>(&amp;Process-&gt;LockEvent);
02170                 } <span class="keywordflow">else</span> {
02171 
02172                     <span class="comment">//</span>
02173                     <span class="comment">// A LockCount !=1 means that others are involved</span>
02174                     <span class="comment">// in the lock. We requested ownership of the lock</span>
02175                     <span class="comment">// by decrementing lockcount.</span>
02176                     <span class="comment">//</span>
02177                     <span class="comment">// We were granted ownership IF our wait was satisfied.</span>
02178                     <span class="comment">// Since we are bailing, we need to pass this ownership along</span>
02179                     <span class="comment">// to the next waiter.</span>
02180                     <span class="comment">//</span>
02181                     <span class="comment">// If we were not granted ownership (wait timed out, or we</span>
02182                     <span class="comment">// bailed before the wait) then we don't have to do anything</span>
02183                     <span class="comment">// more than increment the lock count</span>
02184                     <span class="comment">//</span>
02185 
02186                     <span class="keywordflow">if</span> ( WaitSuccess ) {
02187                         <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>(&amp;Process-&gt;LockEvent, 0, FALSE);
02188                     }
02189                 }
02190 
02191             } <span class="keywordflow">else</span> {
02192                 Process-&gt;LockOwner = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
02193             }
02194         }
02195 
02196     } <span class="keywordflow">else</span> {
02197 
02198         <span class="comment">//</span>
02199         <span class="comment">// The process lock is not currently owned.</span>
02200         <span class="comment">//</span>
02201         <span class="comment">// If the lock mode is not wait forever and the process has already</span>
02202         <span class="comment">// terminated, then set the completion status to process terminating.</span>
02203         <span class="comment">// Otherwise, decrement the lock count, set the lock owner, and set</span>
02204         <span class="comment">// the completion status to success.</span>
02205         <span class="comment">//</span>
02206 
02207         <span class="keywordflow">if</span> ((LocalLockMode != <a class="code" href="../../d1/d9/ps_8h.html#a155a91">PsLockWaitForever</a>) &amp;&amp;
02208             ( (Process-&gt;ExitTime.QuadPart != 0 || <a class="code" href="../../d3/d5/procobj_8c.html#a9">KeReadStateProcess</a>(&amp;Process-&gt;Pcb) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) )
02209            ) {
02210             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_PROCESS_IS_TERMINATING;
02211 
02212         } <span class="keywordflow">else</span> {
02213             Process-&gt;LockCount -= 1;
02214             Process-&gt;LockOwner = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
02215             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
02216         }
02217     }
02218 
02219     <span class="comment">//</span>
02220     <span class="comment">// Release the process lock fast mutex and return the completion</span>
02221     <span class="comment">// status.</span>
02222     <span class="comment">//</span>
02223 
02224     <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a>(&amp;PspProcessLockMutex);
02225 
02226     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> != STATUS_SUCCESS) {
02227         <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
02228     } <span class="keywordflow">else</span> {
02229 
02230         <span class="comment">//</span>
02231         <span class="comment">// We don't want to be "frozen" with the process lock held, so now</span>
02232         <span class="comment">// that we own the lock, check to see if we have a pending freeze count,</span>
02233         <span class="comment">// and if we do and dropping the lock will help, then drop it</span>
02234         <span class="comment">//</span>
02235 
02236         <span class="keywordflow">if</span> ((LockMode != <a class="code" href="../../d1/d9/ps_8h.html#a155a92">PsLockIAmExiting</a>) &amp;&amp;
02237             (Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o65">FreezeCount</a> != 0) &amp;&amp;
02238             (Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o30">KernelApcDisable</a> == (ULONG) -1) ) {
02239             <a class="code" href="../../d2/d8/ps_2create_8c.html#a23">PsUnlockProcess</a>(Process);
02240             <span class="keywordflow">goto</span> retry;
02241         }
02242     }
02243 
02244     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02245 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a139" doxytag="ps.h::PsLookupProcessByProcessId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS PsLookupProcessByProcessId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/pscid_8c-source.html#l00094">94</a> of file <a class="el" href="../../d2/d9/pscid_8c-source.html">pscid.c</a>.
<p>
References <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01403">ExMapHandleToPointer()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l00336">ExUnlockHandleTableEntry()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00254">_EPROCESS::GrantedAccess</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00698">_KPROCESS::Header</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02672">_HANDLE_TABLE_ENTRY::Object</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00166">_EPROCESS::Pcb</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a160">ProcessObject</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00029">PSP_INVALID_ID</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00037">PspCidTable</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00258">_DISPATCHER_HEADER::Type</a>.
<p>
Referenced by <a class="el" href="../../d8/d5/lpcinit_8c-source.html#l00193">LpcpGetCreatorName()</a>, and <a class="el" href="../../d8/d0/psopen_8c-source.html#l00030">NtOpenProcess()</a>.
<p>
<pre class="fragment"><div>00101                    :
00102 
00103     This function accepts <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process <span class="keywordtype">id</span> of a process and returns a
00104     referenced pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process.
00105 
00106 Arguments:
00107 
00108     ProcessId - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Process <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process.
00109 
00110     Process - Returns a referenced pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00111         process <span class="keywordtype">id</span>.
00112 
00113 Return Value:
00114 
00115     STATUS_SUCCESS - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> process was located based on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> contents of
00116         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process <span class="keywordtype">id</span>.
00117 
00118     STATUS_INVALID_PARAMETER - The process was not found.
00119 
00120 --*/
00121 
00122 {
00123 
00124     <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">PHANDLE_TABLE_ENTRY</a> CidEntry;
00125     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> lProcess;
00126     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00127 
00128     CidEntry = <a class="code" href="../../d5/d8/ex_8h.html#a299">ExMapHandleToPointer</a>(PspCidTable, ProcessId);
00129     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00130     <span class="keywordflow">if</span> (CidEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00131         lProcess = (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)CidEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o0">Object</a>;
00132         <span class="keywordflow">if</span> (lProcess != (<a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>)<a class="code" href="../../d1/d9/ps_8h.html#a0">PSP_INVALID_ID</a> &amp;&amp; lProcess-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o0">Pcb</a>.<a class="code" href="../../d5/d7/struct__KPROCESS.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o0">Type</a> == <a class="code" href="../../d4/d9/ke_8h.html#a402a160">ProcessObject</a> &amp;&amp; lProcess-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o54">GrantedAccess</a> ) {
00133             <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(lProcess);
00134             *Process = lProcess;
00135             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00136         }
00137 
00138         <a class="code" href="../../d5/d8/ex_8h.html#a288">ExUnlockHandleTableEntry</a>(PspCidTable, CidEntry);
00139     }
00140 
00141     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00142 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a138" doxytag="ps.h::PsLookupProcessThreadByCid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PsLookupProcessThreadByCid           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCLIENT_ID&nbsp;</td>
          <td class="mdname" nowrap> <em>Cid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> *Process&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/pscid_8c-source.html#l00027">27</a> of file <a class="el" href="../../d2/d9/pscid_8c-source.html">pscid.c</a>.
<p>
References <a class="el" href="../../d2/d8/ps_8h-source.html#l00388">_ETHREAD::Cid</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01403">ExMapHandleToPointer()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l00336">ExUnlockHandleTableEntry()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00440">_ETHREAD::GrantedAccess</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00545">_KTHREAD::Header</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02672">_HANDLE_TABLE_ENTRY::Object</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00029">PSP_INVALID_ID</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00037">PspCidTable</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00347">_ETHREAD::Tcb</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00638">THREAD_TO_PROCESS</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a163">ThreadObject</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00258">_DISPATCHER_HEADER::Type</a>.
<p>
Referenced by <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00915">LpcpCopyRequestData()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l01407">LpcRequestWaitReplyPort()</a>, <a class="el" href="../../d5/d5/lpccompl_8c-source.html#l00040">NtAcceptConnectPort()</a>, <a class="el" href="../../d2/d6/lpcpriv_8c-source.html#l00032">NtImpersonateClientOfPort()</a>, <a class="el" href="../../d8/d0/psopen_8c-source.html#l00030">NtOpenProcess()</a>, <a class="el" href="../../d8/d0/psopen_8c-source.html#l00280">NtOpenThread()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00044">NtReplyPort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00029">NtReplyWaitReceivePort()</a>, <a class="el" href="../../d5/d6/lpcrecv_8c-source.html#l00635">NtReplyWaitReceivePortEx()</a>, <a class="el" href="../../d6/d6/lpcreply_8c-source.html#l00375">NtReplyWaitReplyPort()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l00395">NtRequestWaitReplyPort()</a>, and <a class="el" href="../../d0/d4/vdmints_8c-source.html#l01922">VdmpIsThreadTerminating()</a>.
<p>
<pre class="fragment"><div>00035                    :
00036 
00037     This function accepts The Client <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> of a thread, and returns a
00038     referenced pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread, and possibly a referenced pointer
00039     to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process.
00040 
00041 Arguments:
00042 
00043     Cid - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Client <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread.
00044 
00045     Process - If specified, returns a referenced pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process
00046         specified in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Cid.
00047 
00048     Thread - Returns a referenced pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread specified in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00049         Cid.
00050 
00051 Return Value:
00052 
00053     STATUS_SUCCESS - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> process and thread were located based on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> contents
00054         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Cid.
00055 
00056     STATUS_INVALID_CID - The specified Cid <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> invalid.
00057 
00058 --*/
00059 
00060 {
00061 
00062     <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">PHANDLE_TABLE_ENTRY</a> CidEntry;
00063     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> lThread;
00064     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00065 
00066     CidEntry = <a class="code" href="../../d5/d8/ex_8h.html#a299">ExMapHandleToPointer</a>(PspCidTable, Cid-&gt;UniqueThread);
00067     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_CID;
00068     <span class="keywordflow">if</span> (CidEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00069         lThread = (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)CidEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o0">Object</a>;
00070         <span class="keywordflow">if</span> ((lThread != (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)<a class="code" href="../../d1/d9/ps_8h.html#a0">PSP_INVALID_ID</a>) &amp;&amp;
00071             (
00072              lThread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o0">Type</a> == <a class="code" href="../../d4/d9/ke_8h.html#a402a163">ThreadObject</a> &amp;&amp;
00073              lThread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o12">Cid</a>.UniqueProcess == Cid-&gt;UniqueProcess &amp;&amp;
00074              lThread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o27">GrantedAccess</a>
00075             ) ) {
00076             <span class="keywordflow">if</span> (ARGUMENT_PRESENT(Process)) {
00077                 *Process = <a class="code" href="../../d1/d9/ps_8h.html#a17">THREAD_TO_PROCESS</a>(lThread);
00078                 <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(*Process);
00079             }
00080 
00081             <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(lThread);
00082             *Thread = lThread;
00083             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00084         }
00085 
00086         <a class="code" href="../../d5/d8/ex_8h.html#a288">ExUnlockHandleTableEntry</a>(PspCidTable, CidEntry);
00087     }
00088 
00089     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00090 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a140" doxytag="ps.h::PsLookupThreadByThreadId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS PsLookupThreadByThreadId           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ThreadId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/pscid_8c-source.html#l00146">146</a> of file <a class="el" href="../../d2/d9/pscid_8c-source.html">pscid.c</a>.
<p>
References <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l01403">ExMapHandleToPointer()</a>, <a class="el" href="../../d1/d7/ex_2handle_8c-source.html#l00336">ExUnlockHandleTableEntry()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00440">_ETHREAD::GrantedAccess</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00545">_KTHREAD::Header</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02672">_HANDLE_TABLE_ENTRY::Object</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00029">PSP_INVALID_ID</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00037">PspCidTable</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00347">_ETHREAD::Tcb</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a163">ThreadObject</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00258">_DISPATCHER_HEADER::Type</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/psopen_8c-source.html#l00280">NtOpenThread()</a>.
<p>
<pre class="fragment"><div>00153                    :
00154 
00155     This function accepts <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <span class="keywordtype">id</span> of a thread and returns a
00156     referenced pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread.
00157 
00158 Arguments:
00159 
00160     ThreadId - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Thread <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread.
00161 
00162     Thread - Returns a referenced pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00163         thread <span class="keywordtype">id</span>.
00164 
00165 Return Value:
00166 
00167     STATUS_SUCCESS - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> thread was located based on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> contents of
00168         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <span class="keywordtype">id</span>.
00169 
00170     STATUS_INVALID_PARAMETER - The thread was not found.
00171 
00172 --*/
00173 
00174 {
00175 
00176     <a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html">PHANDLE_TABLE_ENTRY</a> CidEntry;
00177     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> lThread;
00178     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00179 
00180     CidEntry = <a class="code" href="../../d5/d8/ex_8h.html#a299">ExMapHandleToPointer</a>(PspCidTable, ThreadId);
00181     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INVALID_PARAMETER;
00182     <span class="keywordflow">if</span> (CidEntry != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00183         lThread = (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)CidEntry-&gt;<a class="code" href="../../d7/d3/struct__HANDLE__TABLE__ENTRY.html#o0">Object</a>;
00184         <span class="keywordflow">if</span> (lThread != (<a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>)<a class="code" href="../../d1/d9/ps_8h.html#a0">PSP_INVALID_ID</a> &amp;&amp; lThread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o0">Header</a>.<a class="code" href="../../d1/d6/struct__DISPATCHER__HEADER.html#o0">Type</a> == <a class="code" href="../../d4/d9/ke_8h.html#a402a163">ThreadObject</a> &amp;&amp; lThread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o27">GrantedAccess</a> ) {
00185 
00186             <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(lThread);
00187             *Thread = lThread;
00188             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00189         }
00190 
00191         <a class="code" href="../../d5/d8/ex_8h.html#a288">ExUnlockHandleTableEntry</a>(PspCidTable, CidEntry);
00192     }
00193 
00194     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00195 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a137" doxytag="ps.h::PsOpenTokenOfJob" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PsOpenTokenOfJob           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>JobHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACCESS_TOKEN *&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a136" doxytag="ps.h::PsOpenTokenOfProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PsOpenTokenOfProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACCESS_TOKEN *&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00492">492</a> of file <a class="el" href="../../d7/d4/ps_2security_8c-source.html">ps/security.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d0/d8/ntos_8h-source.html#l00088">PsProcessType</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00028">PsReferencePrimaryToken()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00178">NtOpenProcessToken()</a>.
<p>
<pre class="fragment"><div>00499                    :
00500 
00501     This function does <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process specific processing of
00502     an <a class="code" href="../../d7/d3/tokenopn_8c.html#a1">NtOpenProcessToken</a>() service.
00503 
00504     The service validates that the handle has appropriate access
00505     to referenced process.  If so, it goes on to reference the
00506     primary token object to prevent it from going away while the
00507     rest of the NtOpenProcessToken() request is processed.
00508 
00509     NOTE: If this call completes successfully, the caller is responsible
00510           for decrementing the reference count of the target token.
00511           This must be done using the PsDereferencePrimaryToken() API.
00512 
00513 Arguments:
00514 
00515     ProcessHandle - Supplies a handle to a process object whose primary
00516         token is to be opened.
00517 
00518     Token - If successful, receives a pointer to the process's token
00519         object.
00520 
00521 Return Value:
00522 
00523     STATUS_SUCCESS - Indicates the call completed successfully.
00524 
00525     status may also be any value returned by an attemp the reference
00526     the process object for PROCESS_QUERY_INFORMATION access.
00527 
00528 --*/
00529 
00530 {
00531 
00532     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00533         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00534 
00535     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>
00536         Process;
00537 
00538     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>
00539         PreviousMode;
00540 
00541 
00542     PreviousMode = KeGetPreviousMode();
00543 
00544     <span class="comment">//</span>
00545     <span class="comment">//  Make sure the handle grants the appropriate access to the specified</span>
00546     <span class="comment">//  process.</span>
00547     <span class="comment">//</span>
00548 
00549     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(
00550                  ProcessHandle,
00551                  PROCESS_QUERY_INFORMATION,
00552                  PsProcessType,
00553                  PreviousMode,
00554                  (PVOID *)&amp;Process,
00555                  NULL
00556                  );
00557 
00558     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00559 
00560         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00561 
00562     }
00563 
00564     <span class="comment">//</span>
00565     <span class="comment">//  Reference the primary token</span>
00566     <span class="comment">//  (This takes care of gaining exlusive access to the process</span>
00567     <span class="comment">//   security fields for us)</span>
00568     <span class="comment">//</span>
00569 
00570     (*Token) = <a class="code" href="../../d6/d5/ps_2security_8c.html#a0">PsReferencePrimaryToken</a>( Process );
00571 
00572 
00573 
00574     <span class="comment">//</span>
00575     <span class="comment">// Done with the process object</span>
00576     <span class="comment">//</span>
00577 
00578     <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Process );
00579 
00580     <span class="keywordflow">return</span> STATUS_SUCCESS;
00581 
00582 
00583 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a135" doxytag="ps.h::PsOpenTokenOfThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PsOpenTokenOfThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ThreadHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>OpenAsSelf</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACCESS_TOKEN *&nbsp;</td>
          <td class="mdname" nowrap> <em>Token</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>CopyOnOpen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>EffectiveOnly</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSECURITY_IMPERSONATION_LEVEL&nbsp;</td>
          <td class="mdname" nowrap> <em>ImpersonationLevel</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00326">326</a> of file <a class="el" href="../../d7/d4/ps_2security_8c-source.html">ps/security.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00840">PsDereferenceImpersonationToken</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00888">PsDisableImpersonation()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00097">PsReferenceImpersonationToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00990">PsRestoreImpersonation()</a>, <a class="el" href="../../d0/d8/ntos_8h-source.html#l00089">PsThreadType</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00138">ThreadHandle</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
<pre class="fragment"><div>00337                    :
00338 
00339     This function does <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread specific processing of
00340     an <a class="code" href="../../d7/d3/tokenopn_8c.html#a3">NtOpenThreadToken</a>() service.
00341 
00342     The service validates that the handle has appropriate access
00343     to reference the thread.  If so, it goes on to increment
00344     the reference count of the token object to prevent it from
00345     going away while the rest of the NtOpenThreadToken() request
00346     is processed.
00347 
00348     NOTE: If this call completes successfully, the caller is responsible
00349           for decrementing the reference count of the target token.
00350           This must be done using PsDereferenceImpersonationToken().
00351 
00352 Arguments:
00353 
00354     ThreadHandle - Supplies a handle to a thread object.
00355 
00356     OpenAsSelf - Is a <span class="keywordtype">boolean</span> value indicating whether the access should
00357         be made using the calling thread's current security context, which
00358         may be that of a client (if impersonating), or using the caller's
00359         process-level security context.  A value of FALSE indicates the
00360         caller's current context should be used un-modified.  A value of
00361         TRUE indicates the request should be fulfilled using the process
00362         level security context.
00363 
00364     Token - If successful, receives a pointer to the thread's token
00365         object.
00366 
00367     CopyOnOpen - The current value of the Thread-&gt;Client-&gt;CopyOnOpen field.
00368 
00369     EffectiveOnly - The current value of the Thread-&gt;Client-&gt;EffectiveOnly field.
00370 
00371     ImpersonationLevel - The current value of the Thread-&gt;Client-&gt;ImpersonationLevel
00372         field.
00373 
00374 Return Value:
00375 
00376     STATUS_SUCCESS - Indicates the call completed successfully.
00377 
00378     STATUS_NO_TOKEN - Indicates the referenced thread is not currently
00379         impersonating a client.
00380 
00381     STATUS_CANT_OPEN_ANONYMOUS - Indicates the client requested anonymous
00382         impersonation level.  An anonymous token can not be openned.
00383 
00384     status may also be any value returned by an attemp the reference
00385     the thread object for THREAD_QUERY_INFORMATION access.
00386 
00387 --*/
00388 
00389 {
00390 
00391     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00392         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00393 
00394     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>
00395         Thread;
00396 
00397     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a>
00398         PreviousMode;
00399 
00400     SE_IMPERSONATION_STATE
00401         DisabledImpersonationState;
00402 
00403     BOOLEAN
00404         RestoreImpersonationState = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00405 
00406     PreviousMode = KeGetPreviousMode();
00407 
00408 
00409 
00410     <span class="comment">//</span>
00411     <span class="comment">// Disable impersonation if necessary</span>
00412     <span class="comment">//</span>
00413 
00414     <span class="keywordflow">if</span> (OpenAsSelf) {
00415          RestoreImpersonationState = <a class="code" href="../../d6/d5/ps_2security_8c.html#a7">PsDisableImpersonation</a>(
00416                                          <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>(),
00417                                          &amp;DisabledImpersonationState
00418                                          );
00419     }
00420 
00421     <span class="comment">//</span>
00422     <span class="comment">//  Make sure the handle grants the appropriate access to the specified</span>
00423     <span class="comment">//  thread.</span>
00424     <span class="comment">//</span>
00425 
00426     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>(
00427                  ThreadHandle,
00428                  THREAD_QUERY_INFORMATION,
00429                  PsThreadType,
00430                  PreviousMode,
00431                  (PVOID *)&amp;Thread,
00432                  NULL
00433                  );
00434 
00435 
00436 
00437 
00438     <span class="keywordflow">if</span> (RestoreImpersonationState) {
00439         <a class="code" href="../../d6/d5/ps_2security_8c.html#a8">PsRestoreImpersonation</a>(
00440             <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>(),
00441             &amp;DisabledImpersonationState
00442             );
00443     }
00444 
00445     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00446         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00447     }
00448 
00449     <span class="comment">//</span>
00450     <span class="comment">//  Reference the impersonation token, if there is one</span>
00451     <span class="comment">//</span>
00452 
00453     (*Token) = <a class="code" href="../../d6/d5/ps_2security_8c.html#a1">PsReferenceImpersonationToken</a>( Thread,
00454                                               CopyOnOpen,
00455                                               EffectiveOnly,
00456                                               ImpersonationLevel
00457                                               );
00458 
00459 
00460     <span class="comment">//</span>
00461     <span class="comment">//  dereference the target thread.</span>
00462     <span class="comment">//</span>
00463 
00464     <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Thread );
00465 
00466     <span class="comment">//</span>
00467     <span class="comment">// Make sure there is a token</span>
00468     <span class="comment">//</span>
00469 
00470     <span class="keywordflow">if</span> ((*Token) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00471         <span class="keywordflow">return</span> STATUS_NO_TOKEN;
00472     }
00473 
00474     <span class="comment">//</span>
00475     <span class="comment">//  Make sure the ImpersonationLevel is high enough to allow</span>
00476     <span class="comment">//  the token to be openned.</span>
00477     <span class="comment">//</span>
00478 
00479     <span class="keywordflow">if</span> ((*ImpersonationLevel) &lt;= SecurityAnonymous) {
00480         <a class="code" href="../../d1/d9/ps_8h.html#a26">PsDereferenceImpersonationToken</a>( (*Token) );
00481         (*Token) = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00482         <span class="keywordflow">return</span> STATUS_CANT_OPEN_ANONYMOUS;
00483     }
00484 
00485 
00486     <span class="keywordflow">return</span> STATUS_SUCCESS;
00487 
00488 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a144" doxytag="ps.h::PspContextFromKframes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PspContextFromKframes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a143" doxytag="ps.h::PspContextToKframes" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PspContextToKframes           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrapFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PKEXCEPTION_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>Context</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a128" doxytag="ps.h::PsReferenceEffectiveToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PACCESS_TOKEN PsReferenceEffectiveToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PTOKEN_TYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>TokenType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>EffectiveOnly</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSECURITY_IMPERSONATION_LEVEL&nbsp;</td>
          <td class="mdname" nowrap> <em>ImpersonationLevel</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00208">208</a> of file <a class="el" href="../../d7/d4/ps_2security_8c-source.html">ps/security.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00661">PsFreeProcessSecurityFields</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00654">PsLockProcessSecurityFields</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00638">THREAD_TO_PROCESS</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a163">ThreadObject</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d5/d4/seclient_8c-source.html#l00209">SeCreateClientSecurity()</a>.
<p>
<pre class="fragment"><div>00217                    :
00218 
00219     This function returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> effective token of a thread.  The
00220     effective token of a thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread's impersonation token <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> has
00221     one.  Otherwise, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary token of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread's process.
00222 
00223     The reference count of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> effective token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> incremented to protect
00224     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer returned.
00225 
00226     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> impersonating a client, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> impersonation level
00227     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> also returned.
00228 
00229     Either <a class="code" href="../../d1/d9/ps_8h.html#a26">PsDereferenceImpersonationToken</a>() (<span class="keywordflow">for</span> an impersonation token) or
00230     <a class="code" href="../../d1/d9/ps_8h.html#a24">PsDereferencePrimaryToken</a>() (<span class="keywordflow">for</span> a primary token) must be called to
00231     decrement <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token's reference count when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no longer
00232     needed.
00233 
00234 
00235 Arguments:
00236 
00237     Thread - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread whose effective token
00238         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be referenced.
00239 
00240     TokenType - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> effective token.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread
00241         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently impersonating a client, then <span class="keyword">this</span> will be
00242         TokenImpersonation.  Othwerwise, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> will be TokenPrimary.
00243 
00244     EffectiveOnly - If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> TokenImpersonation, then <span class="keyword">this</span>
00245         receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client thread's Thread-&gt;Client-&gt;EffectiveOnly field.
00246         Otherwise, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set to <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>.
00247 
00248     ImpersonationLevel - The current value of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Thread-&gt;Client-&gt;ImpersonationLevel
00249         field <span class="keywordflow">for</span> an impersonation token and <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not set <span class="keywordflow">for</span> a primary token.
00250 
00251 Return Value:
00252 
00253     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread's effective token.
00254 
00255 --*/
00256 
00257 {
00258     PACCESS_TOKEN
00259         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00260 
00261     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Thread-&gt;Tcb.Header.Type == ThreadObject );
00262 
00263     <span class="comment">//</span>
00264     <span class="comment">//  Lock the process security fields.</span>
00265     <span class="comment">//</span>
00266 
00267     <a class="code" href="../../d1/d9/ps_8h.html#a21">PsLockProcessSecurityFields</a>();
00268 
00269     <span class="comment">//</span>
00270     <span class="comment">//  Grab the current impersonation token pointer value</span>
00271     <span class="comment">//</span>
00272 
00273 
00274     <span class="keywordflow">if</span> ( Thread-&gt;ActiveImpersonationInfo ) {
00275 
00276         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = Thread-&gt;ImpersonationInfo-&gt;Token;
00277 
00278         <span class="comment">//</span>
00279         <span class="comment">//  Return the thread's impersonation level, etc.</span>
00280         <span class="comment">//</span>
00281 
00282         (*TokenType) = TokenImpersonation;
00283         (*EffectiveOnly) = Thread-&gt;ImpersonationInfo-&gt;EffectiveOnly;
00284         (*ImpersonationLevel) = Thread-&gt;ImpersonationInfo-&gt;ImpersonationLevel;
00285 
00286 
00287 
00288     } <span class="keywordflow">else</span> {
00289 
00290         <span class="comment">//</span>
00291         <span class="comment">// Get the thread's primary token if it wasn't impersonating a client.</span>
00292         <span class="comment">//</span>
00293 
00294         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = <a class="code" href="../../d1/d9/ps_8h.html#a17">THREAD_TO_PROCESS</a>(Thread)-&gt;Token;
00295 
00296 
00297         <span class="comment">//</span>
00298         <span class="comment">//  Only the TokenType and CopyOnOpen OUT parameters are</span>
00299         <span class="comment">//  returned for a primary token.</span>
00300         <span class="comment">//</span>
00301 
00302         (*TokenType) = TokenPrimary;
00303         (*EffectiveOnly) = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00304 
00305     }
00306 
00307     <span class="comment">//</span>
00308     <span class="comment">//  Increment the reference count of the token to protect our</span>
00309     <span class="comment">//  pointer.</span>
00310     <span class="comment">//</span>
00311 
00312     <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(Token);
00313 
00314     <span class="comment">//</span>
00315     <span class="comment">//  Release the security fields.</span>
00316     <span class="comment">//</span>
00317 
00318     <a class="code" href="../../d1/d9/ps_8h.html#a22">PsFreeProcessSecurityFields</a>();
00319 
00320 
00321     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00322 
00323 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a127" doxytag="ps.h::PsReferenceImpersonationToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI PACCESS_TOKEN PsReferenceImpersonationToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>CopyOnOpen</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>EffectiveOnly</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSECURITY_IMPERSONATION_LEVEL&nbsp;</td>
          <td class="mdname" nowrap> <em>ImpersonationLevel</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00097">97</a> of file <a class="el" href="../../d7/d4/ps_2security_8c-source.html">ps/security.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00661">PsFreeProcessSecurityFields</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00654">PsLockProcessSecurityFields</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a163">ThreadObject</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/ex_8c-source.html#l00050">GetProcessLuid()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00095">IsRestricted()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00326">PsOpenTokenOfThread()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, and <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00294">SepOpenTokenOfThread()</a>.
<p>
<pre class="fragment"><div>00106                    :
00107 
00108     This function returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> impersonation token of a thread.
00109     The reference count of that impersonation token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> incremented to protect
00110     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer returned.
00111 
00112     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not currently impersonating a client, then a null pointer
00113     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00114 
00115     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> impersonating a client, then information about <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00116     means of impersonation are also returned (ImpersonationLevel).
00117 
00118     If a non-null value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned, then <a class="code" href="../../d1/d9/ps_8h.html#a26">PsDereferenceImpersonationToken</a>()
00119     must be called to decrement the token's reference count when the pointer
00120     is no longer needed.
00121 
00122 
00123 Arguments:
00124 
00125     Thread - Supplies the address of the thread whose impersonation token
00126         is to be referenced.
00127 
00128     CopyOnOpen - The current value of the Thread-&gt;ImpersonationInfo-&gt;CopyOnOpen field.
00129 
00130     EffectiveOnly - The current value of the Thread-&gt;ImpersonationInfo-&gt;EffectiveOnly field.
00131 
00132     ImpersonationLevel - The current value of the Thread-&gt;ImpersonationInfo-&gt;ImpersonationLevel
00133         field.
00134 
00135 Return Value:
00136 
00137     A pointer to the specified thread's impersonation token.
00138 
00139     If the thread is not currently impersonating a client, then NULL is
00140     returned.
00141 
00142 --*/
00143 
00144 {
00145     PACCESS_TOKEN
00146         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00147 
00148     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Thread-&gt;Tcb.Header.Type == ThreadObject );
00149     <span class="comment">//</span>
00150     <span class="comment">// before going through the lock overhead just look to see if it is</span>
00151     <span class="comment">// null. There is no race.  Grabbing the lock is not needed until</span>
00152     <span class="comment">// we decide to use the token at which point we re check to see it</span>
00153     <span class="comment">// it is null.</span>
00154     <span class="comment">// This check saves about 300 instructions.</span>
00155     <span class="comment">//</span>
00156 
00157     <span class="keywordflow">if</span> ( !Thread-&gt;ActiveImpersonationInfo ) {
00158         <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00159     }
00160 
00161 
00162     <span class="comment">//</span>
00163     <span class="comment">//  Lock the process security fields.</span>
00164     <span class="comment">//</span>
00165 
00166     <a class="code" href="../../d1/d9/ps_8h.html#a21">PsLockProcessSecurityFields</a>();
00167 
00168     <span class="comment">//</span>
00169     <span class="comment">//  Grab the current token pointer value</span>
00170     <span class="comment">//</span>
00171 
00172 
00173     <span class="keywordflow">if</span> ( Thread-&gt;ActiveImpersonationInfo ) {
00174 
00175         <span class="comment">//</span>
00176         <span class="comment">//  Return the thread's impersonation level, etc.</span>
00177         <span class="comment">//</span>
00178 
00179         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = Thread-&gt;ImpersonationInfo-&gt;Token;
00180         (*ImpersonationLevel) = Thread-&gt;ImpersonationInfo-&gt;ImpersonationLevel;
00181         (*CopyOnOpen) = Thread-&gt;ImpersonationInfo-&gt;CopyOnOpen;
00182         (*EffectiveOnly) = Thread-&gt;ImpersonationInfo-&gt;EffectiveOnly;
00183 
00184 
00185         <span class="comment">//</span>
00186         <span class="comment">//  Increment the reference count of the token to protect our</span>
00187         <span class="comment">//  pointer.</span>
00188         <span class="comment">//</span>
00189 
00190         <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(Token);
00191 
00192     } <span class="keywordflow">else</span> {
00193         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00194     }
00195 
00196 
00197     <span class="comment">//</span>
00198     <span class="comment">//  Release the security fields.</span>
00199     <span class="comment">//</span>
00200 
00201     <a class="code" href="../../d1/d9/ps_8h.html#a22">PsFreeProcessSecurityFields</a>();
00202 
00203     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00204 
00205 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a126" doxytag="ps.h::PsReferencePrimaryToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI PACCESS_TOKEN PsReferencePrimaryToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Process</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00028">28</a> of file <a class="el" href="../../d7/d4/ps_2security_8c-source.html">ps/security.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00514">ObReferenceObject</a>, <a class="el" href="../../d4/d9/ke_8h.html#a402a160">ProcessObject</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00661">PsFreeProcessSecurityFields</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00654">PsLockProcessSecurityFields</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/queue_8c-source.html#l00222">CheckAllowForeground()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00050">GetProcessLuid()</a>, <a class="el" href="../../d5/d7/ex_8c-source.html#l00095">IsRestricted()</a>, <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00458">NtOpenThreadToken()</a>, <a class="el" href="../../d6/d5/lpcconn_8c-source.html#l00084">NtSecureConnectPort()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00492">PsOpenTokenOfProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00366">PspSetPrimaryToken()</a>, <a class="el" href="../../d1/d7/subject_8c-source.html#l00046">SeCaptureSubjectContext()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02867">SeIsChildToken()</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l02960">SeIsChildTokenByPointer()</a>, and <a class="el" href="../../d5/d2/token_8c-source.html#l01327">SeSubProcessToken()</a>.
<p>
<pre class="fragment"><div>00034                    :
00035 
00036     This function returns a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary token of a process.
00037     The reference count of that primary token <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> incremented to protect
00038     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer returned.
00039 
00040     When <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pointer <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no longer needed, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> should be freed <span class="keyword">using</span>
00041     <a class="code" href="../../d1/d9/ps_8h.html#a24">PsDereferencePrimaryToken</a>().
00042 
00043 
00044 Arguments:
00045 
00046     Process - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process whose primary token
00047         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be referenced.
00048 
00049 Return Value:
00050 
00051     <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified process's primary token.
00052 
00053 --*/
00054 
00055 {
00056     PACCESS_TOKEN
00057         <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00058 
00059     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Process-&gt;Pcb.Header.Type == ProcessObject );
00060 
00061     <span class="comment">//</span>
00062     <span class="comment">//  For performance sake, we may want to change this to use</span>
00063     <span class="comment">//  an executive interlocked add routine in the future.</span>
00064     <span class="comment">//</span>
00065 
00066 
00067     <span class="comment">//</span>
00068     <span class="comment">//  Lock the process security fields.</span>
00069     <span class="comment">//</span>
00070 
00071     <a class="code" href="../../d1/d9/ps_8h.html#a21">PsLockProcessSecurityFields</a>();
00072 
00073     <span class="comment">//</span>
00074     <span class="comment">//  Grab the current token pointer value</span>
00075     <span class="comment">//</span>
00076 
00077     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = Process-&gt;Token;
00078 
00079     <span class="comment">//</span>
00080     <span class="comment">//  Increment the reference count of the primary token to protect our</span>
00081     <span class="comment">//  pointer.</span>
00082     <span class="comment">//</span>
00083 
00084     <a class="code" href="../../d4/d0/ob_8h.html#a15">ObReferenceObject</a>(Token);
00085 
00086     <span class="comment">//</span>
00087     <span class="comment">//  Release the process security fields</span>
00088     <span class="comment">//</span>
00089 
00090     <a class="code" href="../../d1/d9/ps_8h.html#a22">PsFreeProcessSecurityFields</a>();
00091 
00092     <span class="keywordflow">return</span> <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00093 
00094 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a112" doxytag="ps.h::PsReportProcessMemoryLimitViolation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsReportProcessMemoryLimitViolation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/psjob_8c-source.html#l02901">2901</a> of file <a class="el" href="../../d2/d0/psjob_8c-source.html">psjob.c</a>.
<p>
References <a class="el" href="../../d2/d8/ps_8h-source.html#l00539">_EJOB::CompletionKey</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00538">_EJOB::CompletionPort</a>, <a class="el" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe()</a>, <a class="el" href="../../d6/d3/complete_8c-source.html#l00671">IoSetIoCompletion()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00285">_EPROCESS::Job</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00286">_EPROCESS::JobStatus</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01598">KeEnterCriticalRegion</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00512">_EJOB::LimitFlags</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00563">_EJOB::MemoryLimitsLock</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00319">PS_JOB_STATUS_LAST_REPORT_MEMORY</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00316">PS_JOB_STATUS_NEW_PROCESS_REPORTED</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00148">PS_SET_BITS</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d8/ps_8h-source.html#l00174">_EPROCESS::UniqueProcessId</a>.
<p>
Referenced by <a class="el" href="../../d7/d2/vadtree_8c-source.html#l00030">MiInsertVad()</a>, <a class="el" href="../../d1/d8/protect_8c-source.html#l01110">MiSetProtectionOnSection()</a>, and <a class="el" href="../../d4/d5/allocvm_8c-source.html#l00075">NtAllocateVirtualMemory()</a>.
<p>
<pre class="fragment"><div>02904 {
02905     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process;
02906     <a class="code" href="../../d0/d3/struct__EJOB.html">PEJOB</a> Job;
02907 
02908     Process = <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>();
02909     Job = Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o73">Job</a>;
02910     <span class="keywordflow">if</span> ( Job &amp;&amp; (Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o14">LimitFlags</a> &amp; JOB_OBJECT_LIMIT_PROCESS_MEMORY) ) {
02911         <a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();
02912         <a class="code" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe</a>(&amp;Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o41">MemoryLimitsLock</a>);
02913 
02914         <span class="comment">//</span>
02915         <span class="comment">// Tell the job port that commit has been exceeded, and process id x</span>
02916         <span class="comment">// was the one that hit it.</span>
02917         <span class="comment">//</span>
02918 
02919         <span class="keywordflow">if</span> ( Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o25">CompletionPort</a>
02920              &amp;&amp; Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o7">UniqueProcessId</a>
02921              &amp;&amp; (Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o74">JobStatus</a> &amp; <a class="code" href="../../d1/d9/ps_8h.html#a11">PS_JOB_STATUS_NEW_PROCESS_REPORTED</a>)
02922              &amp;&amp; (Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o74">JobStatus</a> &amp; <a class="code" href="../../d1/d9/ps_8h.html#a14">PS_JOB_STATUS_LAST_REPORT_MEMORY</a>) == 0) {
02923 
02924             <a class="code" href="../../d1/d9/ps_8h.html#a6">PS_SET_BITS</a> (&amp;Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o74">JobStatus</a>, PS_JOB_STATUS_LAST_REPORT_MEMORY);
02925             <a class="code" href="../../d5/d4/complete_8c.html#a6">IoSetIoCompletion</a>(
02926                 Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o25">CompletionPort</a>,
02927                 Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o26">CompletionKey</a>,
02928                 (PVOID)Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o7">UniqueProcessId</a>,
02929                 STATUS_SUCCESS,
02930                 JOB_OBJECT_MSG_PROCESS_MEMORY_LIMIT,
02931                 TRUE
02932                 );
02933 
02934             }
02935         <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a>(&amp;Job-&gt;<a class="code" href="../../d0/d3/struct__EJOB.html#o41">MemoryLimitsLock</a>);
02936         <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
02937 
02938         }
02939 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a133" doxytag="ps.h::PsRestoreImpersonation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsRestoreImpersonation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Thread</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSE_IMPERSONATION_STATE&nbsp;</td>
          <td class="mdname" nowrap> <em>ImpersonationState</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00990">990</a> of file <a class="el" href="../../d7/d4/ps_2security_8c-source.html">ps/security.c</a>.
<p>
References <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, and <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00650">PsImpersonateClient()</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00458">NtOpenThreadToken()</a>, <a class="el" href="../../d7/d4/ps_2security_8c-source.html#l00326">PsOpenTokenOfThread()</a>, and <a class="el" href="../../d8/d2/tokenopn_8c-source.html#l00294">SepOpenTokenOfThread()</a>.
<p>
<pre class="fragment"><div>00997                    :
00998 
00999     This routine restores an impersonation that has been temporarily disabled
01000     <span class="keyword">using</span> <a class="code" href="../../d6/d5/ps_2security_8c.html#a7">PsDisableImpersonation</a>().
01001 
01002     Notice that <span class="keywordflow">if</span> <span class="keyword">this</span> routine finds <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already impersonating
01003     (again), then restoring <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> temporarily disabled impersonation will cause
01004     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current impersonation to be abandoned.
01005 
01006 
01007 
01008 Arguments:
01009 
01010     Thread - points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread whose impersonation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be restored.
01011 
01012     ImpersontionState - receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current impersontion information,
01013         including a pointer ot <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> impersonation token.
01014 
01015 
01016 Return Value:
01017 
01018     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> impersonation state has been saved and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01019         impersonation has been temporarily disabled.
01020 
01021     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified thread was not impersonating a client.
01022        No action has been taken.
01023 
01024 --*/
01025 
01026 {
01027 
01028 
01029     <span class="comment">//</span>
01030     <span class="comment">// The processing for restore is identical to that for Impersonation,</span>
01031     <span class="comment">// except that the token's reference count will be incremented (and</span>
01032     <span class="comment">// so we need to do one dereference).</span>
01033 
01034     <a class="code" href="../../d6/d5/ps_2security_8c.html#a6">PsImpersonateClient</a>(
01035         Thread,
01036         ImpersonationState-&gt;Token,
01037         ImpersonationState-&gt;CopyOnOpen,
01038         ImpersonationState-&gt;EffectiveOnly,
01039         ImpersonationState-&gt;Level
01040         );
01041 
01042 
01043     <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( ImpersonationState-&gt;Token );
01044 
01045     <span class="keywordflow">return</span>;
01046 
01047 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a142" doxytag="ps.h::PsReturnPoolQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsReturnPoolQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>Amount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a145" doxytag="ps.h::PsReturnSharedPoolQuota" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsReturnSharedPoolQuota           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d4/struct__EPROCESS__QUOTA__BLOCK.html">PEPROCESS_QUOTA_BLOCK</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>QuotaBlock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>PagedAmount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG_PTR&nbsp;</td>
          <td class="mdname" nowrap> <em>NonPagedAmount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a134" doxytag="ps.h::PsRevertToSelf" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID PsRevertToSelf           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a122" doxytag="ps.h::PsSetCreateProcessNotifyRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PsSetCreateProcessNotifyRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d9/ps_8h.html#a67">PCREATE_PROCESS_NOTIFY_ROUTINE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>NotifyRoutine</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Remove</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01691">1691</a> of file <a class="el" href="../../d3/d7/ps_2create_8c-source.html">ps/create.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00189">PSP_MAX_CREATE_PROCESS_NOTIFY</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00192">PspCreateProcessNotifyRoutine</a>, and <a class="el" href="../../d9/d0/psp_8h-source.html#l00191">PspCreateProcessNotifyRoutineCount</a>.
<p>
<pre class="fragment"><div>01698                    :
01699 
01700     This function allows an installable <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> system to hook into process
01701     creation and deletion to track those events against their own internal
01702     data structures.
01703 
01704 Arguments:
01705 
01706     NotifyRoutine - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a routine which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called at
01707         process creation and deletion. The routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> passed <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unique Id
01708         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> created or deleted process and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent process <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> was
01709         created with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inherit handles option. If <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> was created without
01710         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inherit handle options, then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent process Id will be <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>.
01711         The third parameter passed to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> notify routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process
01712         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being created and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being deleted.
01713 
01714         The callout <span class="keywordflow">for</span> creation happens just after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first thread in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01715         process has been created. The callout <span class="keywordflow">for</span> deletion happens after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01716         last thread in a process has terminated and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address space <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> about
01717         to be deleted. It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> possible to get a deletion call without a creation
01718         call <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pathological <span class="keywordflow">case</span> where a process <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> created and deleted
01719         without a thread ever being created.
01720 
01721     Remove - <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> specifies to install <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> callout and <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> specifies to
01722         remove <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> callout that mat
01723 
01724 Return Value:
01725 
01726     STATUS_SUCCESS <span class="keywordflow">if</span> successful, and STATUS_INVALID_PARAMETER <span class="keywordflow">if</span> not.
01727 
01728 --*/
01729 
01730 {
01731 
01732     ULONG i;
01733 
01734     <span class="keywordflow">for</span> (i=0; i &lt; <a class="code" href="../../d8/d1/psp_8h.html#a5">PSP_MAX_CREATE_PROCESS_NOTIFY</a>; i++) {
01735         <span class="keywordflow">if</span> (Remove) {
01736             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/psp_8h.html#a22">PspCreateProcessNotifyRoutine</a>[i] == NotifyRoutine) {
01737                 <a class="code" href="../../d8/d1/psp_8h.html#a22">PspCreateProcessNotifyRoutine</a>[i] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01738                 <a class="code" href="../../d8/d1/psp_8h.html#a21">PspCreateProcessNotifyRoutineCount</a> -= 1;
01739                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01740             }
01741 
01742         } <span class="keywordflow">else</span> {
01743             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/psp_8h.html#a22">PspCreateProcessNotifyRoutine</a>[i] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01744                 <a class="code" href="../../d8/d1/psp_8h.html#a22">PspCreateProcessNotifyRoutine</a>[i] = NotifyRoutine;
01745                 <a class="code" href="../../d8/d1/psp_8h.html#a21">PspCreateProcessNotifyRoutineCount</a> += 1;
01746                 <span class="keywordflow">return</span> STATUS_SUCCESS;
01747             }
01748         }
01749     }
01750 
01751     <span class="keywordflow">return</span> Remove ? STATUS_PROCEDURE_NOT_FOUND : STATUS_INVALID_PARAMETER;
01752 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a123" doxytag="ps.h::PsSetCreateThreadNotifyRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PsSetCreateThreadNotifyRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d9/ps_8h.html#a68">PCREATE_THREAD_NOTIFY_ROUTINE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NotifyRoutine</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01755">1755</a> of file <a class="el" href="../../d3/d7/ps_2create_8c-source.html">ps/create.c</a>.
<p>
References <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00206">PSP_MAX_CREATE_THREAD_NOTIFY</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00209">PspCreateThreadNotifyRoutine</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00208">PspCreateThreadNotifyRoutineCount</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>01761                    :
01762 
01763     This function allows an installable <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> system to hook into thread
01764     creation and deletion to track those events against their own internal
01765     data structures.
01766 
01767 Arguments:
01768 
01769     NotifyRoutine - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> routine which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called at
01770         thread creation and deletion. The routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> passed <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unique Id
01771         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> created or deleted thread and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> unique Id of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> containing
01772         process. The third parameter passed to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> notify routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span>
01773         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being created and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being deleted.
01774 
01775 Return Value:
01776 
01777     STATUS_SUCCESS <span class="keywordflow">if</span> successful, and STATUS_INSUFFICIENT_RESOURCES <span class="keywordflow">if</span> not.
01778 
01779 --*/
01780 
01781 {
01782 
01783     ULONG i;
01784     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01785 
01786     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INSUFFICIENT_RESOURCES;
01787     <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d8/d1/psp_8h.html#a6">PSP_MAX_CREATE_THREAD_NOTIFY</a>; i += 1) {
01788         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/psp_8h.html#a24">PspCreateThreadNotifyRoutine</a>[i] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01789             <a class="code" href="../../d8/d1/psp_8h.html#a24">PspCreateThreadNotifyRoutine</a>[i] = NotifyRoutine;
01790             <a class="code" href="../../d8/d1/psp_8h.html#a23">PspCreateThreadNotifyRoutineCount</a> += 1;
01791             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
01792             <span class="keywordflow">break</span>;
01793         }
01794     }
01795 
01796     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01797 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a121" doxytag="ps.h::PsSetLegoNotifyRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG PsSetLegoNotifyRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d1/d9/ps_8h.html#a66">PLEGO_NOTIFY_ROUTINE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>LegoNotifyRoutine</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00045">45</a> of file <a class="el" href="../../d9/d9/psdelete_8c-source.html">psdelete.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00042">PspLegoNotifyRoutine</a>.
<p>
<pre class="fragment"><div>00048 {
00049     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00050 
00051     <a class="code" href="../../d8/d0/psdelete_8c.html#a0">PspLegoNotifyRoutine</a> = LegoNotifyRoutine;
00052 
00053     <span class="keywordflow">return</span> FIELD_OFFSET(<a class="code" href="../../d1/d8/struct__KTHREAD.html">KTHREAD</a>,LegoData);
00054 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a124" doxytag="ps.h::PsSetLoadImageNotifyRoutine" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS PsSetLoadImageNotifyRoutine           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d9/ps_8h.html#a71">PLOAD_IMAGE_NOTIFY_ROUTINE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>NotifyRoutine</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02344">2344</a> of file <a class="el" href="../../d3/d7/ps_2create_8c-source.html">ps/create.c</a>.
<p>
References <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00773">PLOAD_IMAGE_NOTIFY_ROUTINE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00880">PsImageNotifyEnabled</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00212">PSP_MAX_LOAD_IMAGE_NOTIFY</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00214">PspLoadImageNotifyRoutine</a>, <a class="el" href="../../d9/d0/psp_8h-source.html#l00213">PspLoadImageNotifyRoutineCount</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>02350                    :
02351 
02352     This function allows a device driver to get notified <span class="keywordflow">for</span>
02353     image loads. The notify <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> issued <span class="keywordflow">for</span> both kernel and user
02354     mode image loads system-wide.
02355 
02356 Arguments:
02357 
02358     NotifyRoutine - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a routine which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called at
02359         image load. The routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> passed information describing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02360         image being loaded.
02361 
02362         The callout <span class="keywordflow">for</span> creation happens just after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> loaded
02363         into memory but before executiona of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> image.
02364 
02365     Remove - <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> specifies to install <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> callout and <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> specifies to
02366         remove <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> callout that mat
02367 
02368 Return Value:
02369 
02370     STATUS_SUCCESS <span class="keywordflow">if</span> successful, and STATUS_INVALID_PARAMETER <span class="keywordflow">if</span> not.
02371 
02372 --*/
02373 
02374 {
02375 
02376     ULONG i;
02377     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02378 
02379     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02380 
02381     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_INSUFFICIENT_RESOURCES;
02382     <span class="keywordflow">for</span> (i=0; i &lt; <a class="code" href="../../d8/d1/psp_8h.html#a7">PSP_MAX_LOAD_IMAGE_NOTIFY</a>; i++) {
02383         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d1/psp_8h.html#a26">PspLoadImageNotifyRoutine</a>[i] == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
02384             <a class="code" href="../../d8/d1/psp_8h.html#a26">PspLoadImageNotifyRoutine</a>[i] = NotifyRoutine;
02385             <a class="code" href="../../d8/d1/psp_8h.html#a25">PspLoadImageNotifyRoutineCount</a> += 1;
02386             <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
02387             <a class="code" href="../../d1/d9/ps_8h.html#a72">PsImageNotifyEnabled</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02388             <span class="keywordflow">break</span>;
02389         }
02390     }
02391 
02392     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
02393 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a151" doxytag="ps.h::PsSetProcessPriorityByClass" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID PsSetProcessPriorityByClass           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Process</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/ps_8h.html#a88">PSPROCESSPRIORITYMODE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PriorityMode</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d1/psquery_8c-source.html#l03916">3916</a> of file <a class="el" href="../../d0/d1/psquery_8c-source.html">psquery.c</a>.
<p>
References <a class="el" href="../../d4/d4/procobj_8c-source.html#l00738">KeSetPriorityProcess()</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00041">MEMORY_PRIORITY_BACKGROUND</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00043">MEMORY_PRIORITY_FOREGROUND</a>, <a class="el" href="../../d5/d4/procsup_8c-source.html#l05567">MmSetMemoryPriorityProcess()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00133">PS_WS_TRIM_BACKGROUND_ONLY_APP</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00113">PspForegroundQuantum</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00864">PspJobSchedulingClasses</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l00052">PspPriorityTable</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00573">PsPrioritySeperation</a>, <a class="el" href="../../d1/d9/ps_8h.html#a159a109">PsProcessPriorityForeground</a>, <a class="el" href="../../d1/d9/ps_8h.html#a159a110">PsProcessPrioritySpinning</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00862">PspUseJobSchedulingClasses</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00036">THREAD_QUANTUM</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02262">PspApplyJobLimitsToProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, and <a class="el" href="../../d4/d5/focusact_8c-source.html#l02648">SetForegroundPriorityProcess()</a>.
<p>
<pre class="fragment"><div>03920 {
03921     KPRIORITY BasePriority;
03922     UCHAR MemoryPriority;
03923     ULONG QuantumIndex;
03924 
03925     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03926 
03927 
03928     BasePriority = <a class="code" href="../../d9/d1/psquery_8c.html#a6">PspPriorityTable</a>[Process-&gt;PriorityClass];
03929 
03930 
03931     <span class="keywordflow">if</span> ( PriorityMode == <a class="code" href="../../d1/d9/ps_8h.html#a159a109">PsProcessPriorityForeground</a> ) {
03932         QuantumIndex = <a class="code" href="../../d1/d9/ps_8h.html#a47">PsPrioritySeperation</a>;
03933         MemoryPriority = <a class="code" href="../../d1/d9/ps_8h.html#a3">MEMORY_PRIORITY_FOREGROUND</a>;
03934 <span class="preprocessor">#if defined(_X86_)</span>
03935 <span class="preprocessor"></span>        Process-&gt;MmAgressiveWsTrimMask &amp;= ~<a class="code" href="../../d1/d9/ps_8h.html#a5">PS_WS_TRIM_BACKGROUND_ONLY_APP</a>;
03936 <span class="preprocessor">#endif // _X86_</span>
03937 <span class="preprocessor"></span>        }
03938     <span class="keywordflow">else</span> {
03939         QuantumIndex = 0;
03940         MemoryPriority = <a class="code" href="../../d1/d9/ps_8h.html#a1">MEMORY_PRIORITY_BACKGROUND</a>;
03941         }
03942 
03943     <span class="keywordflow">if</span> ( Process-&gt;PriorityClass != PROCESS_PRIORITY_CLASS_IDLE ) {
03944         <span class="keywordflow">if</span> ( Process-&gt;Job &amp;&amp; <a class="code" href="../../d0/d1/psinit_8c.html#a37">PspUseJobSchedulingClasses</a> ) {
03945             Process-&gt;Pcb.ThreadQuantum = <a class="code" href="../../d0/d1/psinit_8c.html#a38">PspJobSchedulingClasses</a>[Process-&gt;Job-&gt;SchedulingClass];
03946             }
03947         <span class="keywordflow">else</span> {
03948             Process-&gt;Pcb.ThreadQuantum = <a class="code" href="../../d0/d1/psinit_8c.html#a21">PspForegroundQuantum</a>[QuantumIndex];
03949             }
03950         }
03951     <span class="keywordflow">else</span> {
03952         Process-&gt;Pcb.ThreadQuantum = <a class="code" href="../../d4/d9/ke_8h.html#a3">THREAD_QUANTUM</a>;
03953         }
03954 
03955     <a class="code" href="../../d3/d5/procobj_8c.html#a11">KeSetPriorityProcess</a>(&amp;Process-&gt;Pcb,BasePriority);
03956     <span class="keywordflow">if</span> ( PriorityMode != <a class="code" href="../../d1/d9/ps_8h.html#a159a110">PsProcessPrioritySpinning</a> ) {
03957         <a class="code" href="../../d4/d5/procsup_8c.html#a45">MmSetMemoryPriorityProcess</a>(Process, MemoryPriority);
03958         }
03959 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a119" doxytag="ps.h::PsTerminateSystemThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI NTSTATUS PsTerminateSystemThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN NTSTATUS&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>ExitStatus</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00546">546</a> of file <a class="el" href="../../d9/d9/psdelete_8c-source.html">psdelete.c</a>.
<p>
References <a class="el" href="../../d2/d8/ps_8h-source.html#l00434">_ETHREAD::HasTerminated</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00639">IS_SYSTEM_THREAD</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l02020">SmbTraceThreadEntry()</a>, and <a class="el" href="../../d0/d6/desktop_8c-source.html#l00114">xxxDesktopThread()</a>.
<p>
<pre class="fragment"><div>00552                    :
00553 
00554     This function causes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread, which must be a system
00555     thread, to terminate.
00556 
00557 Arguments:
00558 
00559     ExitStatus - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a> status associated with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread.
00560 
00561 Return Value:
00562 
00563     None.
00564 
00565 --*/
00566 
00567 {
00568     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
00569 
00570     <span class="keywordflow">if</span> ( !<a class="code" href="../../d1/d9/ps_8h.html#a18">IS_SYSTEM_THREAD</a>(Thread) ) {
00571         <span class="keywordflow">return</span> STATUS_INVALID_PARAMETER;
00572     }
00573 
00574     Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o26">HasTerminated</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00575     <a class="code" href="../../d8/d1/psp_8h.html#a68">PspExitThread</a>(ExitStatus);
00576 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a148" doxytag="ps.h::PsUnlockProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID PsUnlockProcess           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Process</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02250">2250</a> of file <a class="el" href="../../d3/d7/ps_2create_8c-source.html">ps/create.c</a>.
<p>
References <a class="el" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01628">KeLeaveCriticalRegion</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00064">PspProcessLockMutex</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00211">DbgkCreateThread()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00086">DbgkpResumeProcess()</a>, <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00036">DbgkpSuspendProcess()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l00266">NtAssignProcessToJobObject()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, <a class="el" href="../../d0/d1/psquery_8c-source.html#l03103">NtSetInformationThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00227">NtTerminateProcess()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00461">NtTerminateThread()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01966">PsLockProcess()</a>, <a class="el" href="../../d2/d0/psjob_8c-source.html#l02262">PspApplyJobLimitsToProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00690">PspExitThread()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00384">PspTerminateProcess()</a>.
<p>
<pre class="fragment"><div>02256                    :
02257 
02258     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> opposite of a successful call to <a class="code" href="../../d1/d9/ps_8h.html#a147">PsLockProcess</a>. It
02259     simply releases <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> createdelete lock <span class="keywordflow">for</span> a process.
02260 
02261 Arguments:
02262 
02263     Process - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> process whose create/<span class="keyword">delete</span>
02264         lock <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be released.
02265 
02266 Return Value:
02267 
02268     None.
02269 
02270 --*/
02271 
02272 {
02273 
02274     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02275 
02276     <span class="comment">//</span>
02277     <span class="comment">// Acquire process lock fast mutex to synchronize access to the ownership,</span>
02278     <span class="comment">// lock count, and synchronization event of the specified process.</span>
02279     <span class="comment">//</span>
02280 
02281     <a class="code" href="../../d5/d8/ex_8h.html#a231">ExAcquireFastMutexUnsafe</a>(&amp;PspProcessLockMutex);
02282 
02283     <span class="comment">//</span>
02284     <span class="comment">// Increment the lock count and clear the lock owner. If the lock count</span>
02285     <span class="comment">// is less than one, then set the lock event.</span>
02286     <span class="comment">//</span>
02287 
02288     Process-&gt;LockCount += 1;
02289     Process-&gt;LockOwner = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
02290     <span class="keywordflow">if</span> (Process-&gt;LockCount != 1) {
02291         <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>(&amp;Process-&gt;LockEvent, 0, FALSE);
02292     }
02293 
02294     <span class="comment">//</span>
02295     <span class="comment">// Release the process lock fast mutex and return.</span>
02296     <span class="comment">//</span>
02297 
02298 
02299     <a class="code" href="../../d5/d8/ex_8h.html#a232">ExReleaseFastMutexUnsafe</a>(&amp;PspProcessLockMutex);
02300     <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>();
02301     <span class="keywordflow">return</span>;
02302 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a49" doxytag="ps.h::PsActiveProcessHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d0/d1/psinit_8c.html#a33">PsActiveProcessHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00575">575</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l03060">ExpGetProcessInformation()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l01519">IoWriteCrashDump()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l01095">MiCheckForCrashDump()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00878">PsChangeQuantumTable()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, and <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a58" doxytag="ps.h::PsDefaultSystemLocaleId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LCID <a class="el" href="../../d2/d8/ps_2create_8c.html#a2">PsDefaultSystemLocaleId</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00584">584</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00050">CmGetSystemControlValues()</a>, <a class="el" href="../../d2/d2/cmsysini_8c-source.html#l04155">CmpCreatePerfKeys()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l01538">IopProcessNewDeviceNode()</a>, <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l00492">LdrpSearchResourceSection_U()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00220">NtQueryDefaultLocale()</a>, and <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00258">NtSetDefaultLocale()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a59" doxytag="ps.h::PsDefaultThreadLocaleId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LCID <a class="el" href="../../d2/d8/ps_2create_8c.html#a3">PsDefaultThreadLocaleId</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00585">585</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00050">CmGetSystemControlValues()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00220">NtQueryDefaultLocale()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00258">NtSetDefaultLocale()</a>, and <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l01800">PspUserThreadStartup()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a60" doxytag="ps.h::PsDefaultUILanguageId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LANGID <a class="el" href="../../d2/d8/ps_2create_8c.html#a4">PsDefaultUILanguageId</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00586">586</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00050">CmGetSystemControlValues()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a55" doxytag="ps.h::PsHalImageBase" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d1/d9/ps_8h.html#a55">PsHalImageBase</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00581">581</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a62" doxytag="ps.h::PsIdleProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> <a class="el" href="../../d0/d1/psinit_8c.html#a34">PsIdleProcess</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00588">588</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l03060">ExpGetProcessInformation()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00941">NtQuerySystemInformation()</a>, and <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a72" doxytag="ps.h::PsImageNotifyEnabled" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d2/d8/ps_2create_8c.html#a8">PsImageNotifyEnabled</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00880">880</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00211">DbgkCreateThread()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l01567">MiMapViewOfImageSection()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02396">PsCallImageNotifyRoutines()</a>, and <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l02344">PsSetLoadImageNotifyRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a53" doxytag="ps.h::PsInitialSystemProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> <a class="el" href="../../d0/d1/psinit_8c.html#a12">PsInitialSystemProcess</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00579">579</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l02607">ExAllocatePoolWithQuotaTag()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00084">IopChainDereferenceComplete()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l01095">MiCheckForCrashDump()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l01567">MiMapViewOfImageSection()</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l00297">NtCreatePagingFile()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00035">NtLoadDriver()</a>, <a class="el" href="../../d7/d0/obquery_8c-source.html#l00545">NtSetInformationObject()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00244">NtUnloadDriver()</a>, <a class="el" href="../../d2/d1/obwait_8c-source.html#l00406">NtWaitForMultipleObjects()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l02160">ObpCreateHandle()</a>, <a class="el" href="../../d0/d0/obhandle_8c-source.html#l02507">ObpCreateUnnamedHandle()</a>, <a class="el" href="../../d1/d1/psquota_8c-source.html#l00246">PsChargePoolQuota()</a>, <a class="el" href="../../d1/d1/psquota_8c-source.html#l00024">PsChargeSharedPoolQuota()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00175">PsCreateSystemThread()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00969">PspCreateProcess()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00262">PspCreateThread()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>, and <a class="el" href="../../d1/d1/psquota_8c-source.html#l00356">PsReturnPoolQuota()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a61" doxytag="ps.h::PsInstallUILanguageId" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LANGID <a class="el" href="../../d2/d8/ps_2create_8c.html#a5">PsInstallUILanguageId</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00587">587</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d6/d9/cmcontrl_8c-source.html#l00050">CmGetSystemControlValues()</a>, <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l00492">LdrpSearchResourceSection_U()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00447">NtQueryDefaultUILanguage()</a>, and <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00416">NtQueryInstallUILanguage()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a56" doxytag="ps.h::PsLoadedModuleList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d8/d8/sysload_8c.html#a27">PsLoadedModuleList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00582">582</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/hwprofil_8c-source.html#l02529">CmpCreateHwProfileFriendlyName()</a>, <a class="el" href="../../d2/d4/ioassert_8c-source.html#l01254">IopDriverCorrectnessAddressToFileHeader()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l02602">IopGetLoadedDriverInfo()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l08928">IopInitializeBootLogging()</a>, <a class="el" href="../../d0/d5/ioinit_8c-source.html#l02812">IopInitializeBuiltinDriver()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l03200">IopLoadDriver()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l02681">IopWriteDriverList()</a>, <a class="el" href="../../d3/d2/dumpctl_8c-source.html#l01519">IoWriteCrashDump()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02838">KdpGetVersion()</a>, <a class="el" href="../../d8/d9/mips_2dmpstate_8c-source.html#l00059">KeDumpMachineState()</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00220">KiPcToFileHeader()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l03326">MiBuildImportsForBootDrivers()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l01095">MiCheckForCrashDump()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l03822">MiDereferenceImports()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l02735">MiEnablePagingTheExecutive()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l02474">MiFindInitializationCode()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l01901">MiGetHighestPteConsumer()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l06591">MiInitializeLoadedModuleList()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l06991">MiLookupDataTableEntry()</a>, <a class="el" href="../../d5/d6/sessload_8c-source.html#l01273">MiLookupPsLoadedModule()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l03953">MiResolveImageReferences()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l04464">MiSnapThunk()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l06808">MmGetSystemRoutineAddress()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l00184">MmInitSystem()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l08083">MmSetKernelDumpRange()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02896">MmUnloadSystemImage()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00941">NtQuerySystemInformation()</a>, and <a class="el" href="../../d7/d3/pctohdr_8c-source.html#l00042">RtlPcToFileHeader()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a57" doxytag="ps.h::PsLoadedModuleResource" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="el" href="../../d8/d8/sysload_8c.html#a28">PsLoadedModuleResource</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00583">583</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d3/internal_8c-source.html#l08928">IopInitializeBootLogging()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l03200">IopLoadDriver()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l02735">MiEnablePagingTheExecutive()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l02474">MiFindInitializationCode()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l06591">MiInitializeLoadedModuleList()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l00443">MiLoadSystemImage()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l06991">MiLookupDataTableEntry()</a>, <a class="el" href="../../d5/d6/sessload_8c-source.html#l01273">MiLookupPsLoadedModule()</a>, <a class="el" href="../../d4/d4/mapview_8c-source.html#l01567">MiMapViewOfImageSection()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l06797">MmGetSectionRange()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l06808">MmGetSystemRoutineAddress()</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l00184">MmInitSystem()</a>, <a class="el" href="../../d6/d5/iosup_8c-source.html#l06864">MmLockPagableDataSection()</a>, <a class="el" href="../../d9/d7/sysload_8c-source.html#l02896">MmUnloadSystemImage()</a>, <a class="el" href="../../d7/d7/sysinfo_8c-source.html#l00941">NtQuerySystemInformation()</a>, and <a class="el" href="../../d3/d2/dbgctrl_8c-source.html#l00036">NtSystemDebugControl()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a50" doxytag="ps.h::PsNtDllPathName" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> UNICODE_STRING <a class="el" href="../../d0/d1/psinit_8c.html#a15">PsNtDllPathName</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00576">576</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00211">DbgkCreateThread()</a>, and <a class="el" href="../../d1/d0/psinit_8c-source.html#l00525">PsLocateSystemDll()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a54" doxytag="ps.h::PsNtosImageBase" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d8/d8/sysload_8c.html#a26">PsNtosImageBase</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00580">580</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/kdapi_8c-source.html#l02838">KdpGetVersion()</a>, <a class="el" href="../../d9/d1/ia64_2initkr_8c-source.html#l00078">KiInitializeKernel()</a>, and <a class="el" href="../../d9/d7/sysload_8c-source.html#l06591">MiInitializeLoadedModuleList()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="ps.h::PsPrioritySeperation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d1/psinit_8c.html#a4">PsPrioritySeperation</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00573">573</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d6/waitsup_8c-source.html#l00031">KiUnwaitThread()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00878">PsChangeQuantumTable()</a>, and <a class="el" href="../../d0/d1/psquery_8c-source.html#l03916">PsSetProcessPriorityByClass()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a52" doxytag="ps.h::PsProcessSecurityLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="el" href="../../d0/d1/psinit_8c.html#a16">PsProcessSecurityLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00578">578</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="ps.h::PsRawPrioritySeparation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d0/d1/psinit_8c.html#a5">PsRawPrioritySeparation</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00574">574</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a63" doxytag="ps.h::PsReaperActive" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d0/d1/psinit_8c.html#a27">PsReaperActive</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00589">589</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01996">KeTerminateThread()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00057">PspReaper()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a64" doxytag="ps.h::PsReaperListHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LIST_ENTRY <a class="el" href="../../d0/d1/psinit_8c.html#a28">PsReaperListHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00590">590</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01996">KeTerminateThread()</a>, <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>, and <a class="el" href="../../d9/d9/psdelete_8c-source.html#l00057">PspReaper()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a65" doxytag="ps.h::PsReaperWorkItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">WORK_QUEUE_ITEM</a> <a class="el" href="../../d0/d1/psinit_8c.html#a29">PsReaperWorkItem</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00591">591</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01996">KeTerminateThread()</a>, and <a class="el" href="../../d1/d0/psinit_8c-source.html#l00181">PspInitPhase0()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a51" doxytag="ps.h::PsSystemDllBase" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID <a class="el" href="../../d0/d1/psinit_8c.html#a31">PsSystemDllBase</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/ps_8h-source.html#l00577">577</a> of file <a class="el" href="../../d2/d8/ps_8h-source.html">ps.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d2/dbgkproc_8c-source.html#l00211">DbgkCreateThread()</a>, and <a class="el" href="../../d1/d0/psinit_8c-source.html#l00525">PsLocateSystemDll()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:21 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
