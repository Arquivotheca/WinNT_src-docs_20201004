<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: worker.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>worker.c File Reference</h1><code>#include "<a class="el" href="../../d5/d9/exp_8h-source.html">exp.h</a>"</code><br>

<p>
<a href="../../d2/d8/worker_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a0">DELAYED_WORK_QUEUE_PRIORITY</a>&nbsp;&nbsp;&nbsp;(12 - NORMAL_BASE_PRIORITY)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a1">CRITICAL_WORK_QUEUE_PRIORITY</a>&nbsp;&nbsp;&nbsp;(13 - NORMAL_BASE_PRIORITY)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a2">HYPER_CRITICAL_WORK_QUEUE_PRIORITY</a>&nbsp;&nbsp;&nbsp;(15 - NORMAL_BASE_PRIORITY)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a3">MAX_ADDITIONAL_THREADS</a>&nbsp;&nbsp;&nbsp;16</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a4">MAX_ADDITIONAL_DYNAMIC_THREADS</a>&nbsp;&nbsp;&nbsp;16</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a5">SMALL_NUMBER_OF_THREADS</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a6">MEDIUM_NUMBER_OF_THREADS</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a7">LARGE_NUMBER_OF_THREADS</a>&nbsp;&nbsp;&nbsp;5</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a8">DYNAMIC_THREAD_TIMEOUT</a>&nbsp;&nbsp;&nbsp;((LONGLONG)10 * 60 * 1000 * 1000 * 10)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a9">THREAD_SET_INTERVAL</a>&nbsp;&nbsp;&nbsp;(1 * 1000 * 1000 * 10)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a10">DYNAMIC_WORKER_THREAD</a>&nbsp;&nbsp;&nbsp;0x80000000</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef enum <a class="el" href="../../d9/d0/balmgr_8c.html#a26">_BALANCE_OBJECT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a11">BALANCE_OBJECT</a></td></tr>

<tr><td colspan=2><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a31">_BALANCE_OBJECT</a> { <a class="el" href="../../d1/d9/worker_8c.html#a31a18">TimerExpiration</a>, 
<a class="el" href="../../d1/d9/worker_8c.html#a31a19">ThreadSetManagerEvent</a>, 
<a class="el" href="../../d1/d9/worker_8c.html#a31a20">MaximumBalanceObject</a>
 }</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a21">C_ASSERT</a> (MaximumBalanceObject&lt; THREAD_WAIT_OBJECTS)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a22">ExpCheckDynamicThreadCount</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a23">ExpCreateWorkerThread</a> (<a class="el" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a> QueueType, BOOLEAN Dynamic)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a24">ExpDetectWorkerThreadDeadlock</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a25">ExpWorkerThreadBalanceManager</a> (IN PVOID StartContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a26">ExpWorkerThread</a> (IN PVOID StartContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PVOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a27">ExpCheckForWorker</a> (IN PVOID p, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN __inline&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a28">ExpNewThreadNecessary</a> (IN <a class="el" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a> QueueType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a29">ExpWorkerInitialization</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a30">ExQueueWorkItem</a> (IN <a class="el" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">PWORK_QUEUE_ITEM</a> WorkItem, IN <a class="el" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a> QueueType)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d7/struct__EX__WORK__QUEUE.html">EX_WORK_QUEUE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a12">ExWorkerQueue</a> [MaximumWorkQueue]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a13">ExpAdditionalCriticalWorkerThreads</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a14">ExpAdditionalDelayedWorkerThreads</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a15">ExCriticalWorkerThreads</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a16">ExDelayedWorkerThreads</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d6/struct__KEVENT.html">KEVENT</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/worker_8c.html#a17">ExThreadSetManagerEvent</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="worker.c::CRITICAL_WORK_QUEUE_PRIORITY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define CRITICAL_WORK_QUEUE_PRIORITY&nbsp;&nbsp;&nbsp;(13 - NORMAL_BASE_PRIORITY)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00049">49</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">ExpCreateWorkerThread()</a>, and <a class="el" href="../../d2/d8/worker_8c-source.html#l00431">ExpWorkerThreadBalanceManager()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="worker.c::DELAYED_WORK_QUEUE_PRIORITY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DELAYED_WORK_QUEUE_PRIORITY&nbsp;&nbsp;&nbsp;(12 - NORMAL_BASE_PRIORITY)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00048">48</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">ExpCreateWorkerThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="worker.c::DYNAMIC_THREAD_TIMEOUT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DYNAMIC_THREAD_TIMEOUT&nbsp;&nbsp;&nbsp;((LONGLONG)10 * 60 * 1000 * 1000 * 10)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00067">67</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00538">ExpWorkerThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="worker.c::DYNAMIC_WORKER_THREAD" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DYNAMIC_WORKER_THREAD&nbsp;&nbsp;&nbsp;0x80000000          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00080">80</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">ExpCreateWorkerThread()</a>, and <a class="el" href="../../d2/d8/worker_8c-source.html#l00538">ExpWorkerThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="worker.c::HYPER_CRITICAL_WORK_QUEUE_PRIORITY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define HYPER_CRITICAL_WORK_QUEUE_PRIORITY&nbsp;&nbsp;&nbsp;(15 - NORMAL_BASE_PRIORITY)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00050">50</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">ExpCreateWorkerThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="worker.c::LARGE_NUMBER_OF_THREADS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define LARGE_NUMBER_OF_THREADS&nbsp;&nbsp;&nbsp;5          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00061">61</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">ExpWorkerInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="worker.c::MAX_ADDITIONAL_DYNAMIC_THREADS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_ADDITIONAL_DYNAMIC_THREADS&nbsp;&nbsp;&nbsp;16          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00057">57</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00853">ExpDetectWorkerThreadDeadlock()</a>, and <a class="el" href="../../d2/d8/worker_8c-source.html#l00159">ExpNewThreadNecessary()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="worker.c::MAX_ADDITIONAL_THREADS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_ADDITIONAL_THREADS&nbsp;&nbsp;&nbsp;16          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00056">56</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">ExpWorkerInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="worker.c::MEDIUM_NUMBER_OF_THREADS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MEDIUM_NUMBER_OF_THREADS&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00060">60</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">ExpWorkerInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="worker.c::SMALL_NUMBER_OF_THREADS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SMALL_NUMBER_OF_THREADS&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00059">59</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">ExpWorkerInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="worker.c::THREAD_SET_INTERVAL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define THREAD_SET_INTERVAL&nbsp;&nbsp;&nbsp;(1 * 1000 * 1000 * 10)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00073">73</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00431">ExpWorkerThreadBalanceManager()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a11" doxytag="worker.c::BALANCE_OBJECT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef enum <a class="el" href="../../d9/d0/balmgr_8c.html#a26">_BALANCE_OBJECT</a>  <a class="el" href="../../d5/d5/sectsup_8c.html#a5">BALANCE_OBJECT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="a31" doxytag="worker.c::_BALANCE_OBJECT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> enum <a class="el" href="../../d9/d0/balmgr_8c.html#a26">_BALANCE_OBJECT</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a31a18" doxytag="TimerExpiration" ></a>TimerExpiration</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a31a19" doxytag="ThreadSetManagerEvent" ></a>ThreadSetManagerEvent</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a31a20" doxytag="MaximumBalanceObject" ></a>MaximumBalanceObject</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00030">30</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
<pre class="fragment"><div>00030                              {
00031     <a class="code" href="../../d1/d9/worker_8c.html#a31a18">TimerExpiration</a>,
00032     <a class="code" href="../../d1/d9/worker_8c.html#a31a19">ThreadSetManagerEvent</a>,
00033     <a class="code" href="../../d1/d9/worker_8c.html#a31a20">MaximumBalanceObject</a>
00034 } <a class="code" href="../../d1/d9/worker_8c.html#a11">BALANCE_OBJECT</a>;
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a21" doxytag="worker.c::C_ASSERT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> C_ASSERT           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d1/psquery_8c-source.html#l01510">NtSetInformationProcess()</a>, and <a class="el" href="../../d8/d0/rtlassig_8c-source.html#l00510">RtlSelfRelativeToAbsoluteSD2()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="worker.c::ExpCheckDynamicThreadCount" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExpCheckDynamicThreadCount           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00806">806</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
References <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">ExpCreateWorkerThread()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00159">ExpNewThreadNecessary()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a208">MaximumWorkQueue</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00431">ExpWorkerThreadBalanceManager()</a>.
<p>
<pre class="fragment"><div>00810                    :
00811 
00812     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called when there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a> to believe that a work queue
00813     might benefit from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> creation of an additional worker thread.
00814 
00815     This routine checks each queue to determine whether <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> would benefit from
00816     an additional worker thread (see <a class="code" href="../../d1/d9/worker_8c.html#a28">ExpNewThreadNecessary</a>()), and creates
00817     one <span class="keywordflow">if</span> so.
00818 
00819 Arguments:
00820 
00821     None.
00822 
00823 Return Value:
00824 
00825     None.
00826 
00827 --*/
00828 {
00829     <a class="code" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a> QueueType;
00830 
00831     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00832 
00833     <span class="comment">//</span>
00834     <span class="comment">// Check each worker queue.</span>
00835     <span class="comment">//</span>
00836 
00837     <span class="keywordflow">for</span> (QueueType = 0; QueueType &lt; <a class="code" href="../../d5/d8/ex_8h.html#a332a208">MaximumWorkQueue</a>; QueueType++) {
00838 
00839         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/worker_8c.html#a28">ExpNewThreadNecessary</a>(QueueType)) {
00840 
00841             <span class="comment">//</span>
00842             <span class="comment">// Create a new thread for this queue.  We explicitly ignore</span>
00843             <span class="comment">// an error from ExpCreateDynamicThread(): there's nothing</span>
00844             <span class="comment">// we can or should do in the event of a failure.</span>
00845             <span class="comment">//</span>
00846 
00847             <a class="code" href="../../d1/d9/worker_8c.html#a23">ExpCreateWorkerThread</a>(QueueType, TRUE);
00848         }
00849     }
00850 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="worker.c::ExpCheckForWorker" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PVOID ExpCheckForWorker           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d3/d1/ex_2pool_8c-source.html#l03892">ExFreePoolSanityChecks()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="worker.c::ExpCreateWorkerThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS ExpCreateWorkerThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>QueueType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>Dynamic</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">971</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
References <a class="el" href="../../d2/d8/worker_8c-source.html#l00049">CRITICAL_WORK_QUEUE_PRIORITY</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a205">CriticalWorkQueue</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00048">DELAYED_WORK_QUEUE_PRIORITY</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a206">DelayedWorkQueue</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00080">DYNAMIC_WORKER_THREAD</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00538">ExpWorkerThread()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00086">ExWorkerQueue</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00050">HYPER_CRITICAL_WORK_QUEUE_PRIORITY</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a207">HyperCriticalWorkQueue</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01532">KeSetBasePriorityThread()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d9/ob_8h-source.html#l00494">ObDereferenceObject</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l00542">ObReferenceObjectByHandle()</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00175">PsCreateSystemThread()</a>, <a class="el" href="../../d0/d8/ntos_8h-source.html#l00089">PsThreadType</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00138">ThreadHandle</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00806">ExpCheckDynamicThreadCount()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00853">ExpDetectWorkerThreadDeadlock()</a>, and <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">ExpWorkerInitialization()</a>.
<p>
<pre class="fragment"><div>00978                    :
00979 
00980     This function creates a single <span class="keyword">new</span> <span class="keyword">static</span> or dynamic worker thread <span class="keywordflow">for</span>
00981     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> given queue <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
00982 
00983 Arguments:
00984 
00985     QueueType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queue <span class="keywordflow">for</span> which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> worker thread
00986                 should be created.
00987 
00988     Dynamic - If <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> worker thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> created as a dynamic thread that
00989               will terminate after a sufficient period of inactivity.  If <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>,
00990               <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> worker thread will never terminate.
00991 
00992 
00993 Return Value:
00994 
00995     The <span class="keyword">final</span> status of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation.
00996 
00997 Notes:
00998 
00999     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> called from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> worker thread set balance thread,
01000     therefore <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> will not be reentered.
01001 
01002 --*/
01003 
01004 {
01005     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
01006     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01007     HANDLE <a class="code" href="../../d2/d1/cttoken_8c.html#a63">ThreadHandle</a>;
01008     ULONG Context;
01009     ULONG BasePriority;
01010     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread;
01011 
01012     InitializeObjectAttributes(&amp;ObjectAttributes, NULL, 0, NULL, NULL);
01013 
01014     Context = QueueType;
01015     <span class="keywordflow">if</span> (Dynamic != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01016         Context |= <a class="code" href="../../d1/d9/worker_8c.html#a10">DYNAMIC_WORKER_THREAD</a>;
01017     }
01018 
01019     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/ps_2create_8c.html#a11">PsCreateSystemThread</a>(&amp;ThreadHandle,
01020                                   THREAD_ALL_ACCESS,
01021                                   &amp;ObjectAttributes,
01022                                   0L,
01023                                   NULL,
01024                                   ExpWorkerThread,
01025                                   (PVOID)Context);
01026     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01027 <span class="preprocessor">#if DBG</span>
01028 <span class="preprocessor"></span>        <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"EXWORKER: Worker thread creation failed, status %08x\n"</span>,
01029                  Status);
01030 <span class="preprocessor">#endif</span>
01031 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01032     }
01033 
01034     <span class="keywordflow">if</span> (Dynamic != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
01035 
01036 <span class="preprocessor">#if DBG</span>
01037 <span class="preprocessor"></span>        <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"EXWORKER: Created dynamic thread type %d, %d total\n"</span>,
01038                  QueueType,
01039                  ExWorkerQueue[QueueType].DynamicThreadCount);
01040 <span class="preprocessor">#endif</span>
01041 <span class="preprocessor"></span>
01042         InterlockedIncrement( &amp;ExWorkerQueue[QueueType].DynamicThreadCount );
01043     }
01044 
01045     <span class="comment">//</span>
01046     <span class="comment">// Set the priority according to the type of worker thread.</span>
01047     <span class="comment">//</span>
01048 
01049     <span class="keywordflow">switch</span> (QueueType) {
01050    
01051         <span class="keywordflow">case</span> <a class="code" href="../../d5/d8/ex_8h.html#a332a207">HyperCriticalWorkQueue</a>:
01052 
01053             BasePriority = <a class="code" href="../../d1/d9/worker_8c.html#a2">HYPER_CRITICAL_WORK_QUEUE_PRIORITY</a>;
01054             <span class="keywordflow">break</span>;
01055 
01056         <span class="keywordflow">case</span> <a class="code" href="../../d5/d8/ex_8h.html#a332a205">CriticalWorkQueue</a>:
01057 
01058             BasePriority = <a class="code" href="../../d1/d9/worker_8c.html#a1">CRITICAL_WORK_QUEUE_PRIORITY</a>;
01059             <span class="keywordflow">break</span>;
01060 
01061         <span class="keywordflow">case</span> <a class="code" href="../../d5/d8/ex_8h.html#a332a206">DelayedWorkQueue</a>:
01062 
01063             BasePriority = <a class="code" href="../../d1/d9/worker_8c.html#a0">DELAYED_WORK_QUEUE_PRIORITY</a>;
01064             <span class="keywordflow">break</span>;
01065     }
01066 
01067     <span class="comment">//</span>
01068     <span class="comment">// Set the base priority of the just-created thread.</span>
01069     <span class="comment">// </span>
01070 
01071     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d1/obref_8c.html#a4">ObReferenceObjectByHandle</a>( ThreadHandle,
01072                                         THREAD_SET_INFORMATION,
01073                                         PsThreadType,
01074                                         KernelMode,
01075                                         (PVOID *)&amp;Thread,
01076                                         NULL );
01077     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
01078 
01079         <a class="code" href="../../d9/d1/thredobj_8c.html#a20">KeSetBasePriorityThread</a>( &amp;Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>, BasePriority );
01080         <a class="code" href="../../d4/d0/ob_8h.html#a14">ObDereferenceObject</a>( Thread );
01081 
01082     } <span class="keywordflow">else</span> {
01083 
01084         <span class="comment">//</span>
01085         <span class="comment">// The thread was created but we were unable to reference it.  This is</span>
01086         <span class="comment">// very odd... just leave it at the default priority, better than no</span>
01087         <span class="comment">// thread at all.</span>
01088         <span class="comment">//</span>
01089 
01090     }
01091 
01092     ZwClose( ThreadHandle );
01093     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01094 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="worker.c::ExpDetectWorkerThreadDeadlock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExpDetectWorkerThreadDeadlock           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00853">853</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01997">_EX_WORK_QUEUE::DynamicThreadCount</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">ExpCreateWorkerThread()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00086">ExWorkerQueue</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00092">KeReadStateQueue()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00057">MAX_ADDITIONAL_DYNAMIC_THREADS</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a208">MaximumWorkQueue</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02018">_EX_WORK_QUEUE::QueueDepthLastPass</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01990">_EX_WORK_QUEUE::WorkerQueue</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02003">_EX_WORK_QUEUE::WorkItemsProcessed</a>, and <a class="el" href="../../d6/d7/ex_8h-source.html#l02011">_EX_WORK_QUEUE::WorkItemsProcessedLastPass</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00431">ExpWorkerThreadBalanceManager()</a>.
<p>
<pre class="fragment"><div>00857                    :
00858 
00859     This function creates <span class="keyword">new</span> work item threads <span class="keywordflow">if</span> a possible deadlock <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00860     detected.
00861 
00862 Arguments:
00863 
00864     None.
00865 
00866 Return Value:
00867 
00868     None
00869 
00870 --*/
00871 
00872 {
00873     LONG QueueDepth;
00874     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00875     LONG ThreadCount;
00876     LONG NewThreadCount;
00877     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00878     HANDLE Thread;
00879     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00880     <a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html">PEX_WORK_QUEUE</a> Queue;
00881 
00882     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00883 
00884     <span class="comment">//</span>
00885     <span class="comment">// Process each queue type.</span>
00886     <span class="comment">// </span>
00887 
00888     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; <a class="code" href="../../d5/d8/ex_8h.html#a332a208">MaximumWorkQueue</a>; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00889 
00890         Queue = &amp;<a class="code" href="../../d1/d9/worker_8c.html#a12">ExWorkerQueue</a>[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>];
00891 
00892         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o1">DynamicThreadCount</a> &lt;=
00893                 MAX_ADDITIONAL_DYNAMIC_THREADS );
00894 
00895         <span class="keywordflow">if</span> (Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o4">QueueDepthLastPass</a> &gt; 0 &amp;&amp;
00896 
00897             Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o2">WorkItemsProcessed</a> ==
00898                 Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o3">WorkItemsProcessedLastPass</a> &amp;&amp;
00899 
00900             Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o1">DynamicThreadCount</a> &lt;
00901                 <a class="code" href="../../d1/d9/worker_8c.html#a4">MAX_ADDITIONAL_DYNAMIC_THREADS</a>) {
00902 
00903             <span class="comment">//</span>
00904             <span class="comment">// These things are known:</span>
00905             <span class="comment">//</span>
00906             <span class="comment">// - There were work items waiting in the queue at the last pass.</span>
00907             <span class="comment">// - No work items have been processed since the last pass.</span>
00908             <span class="comment">// - We haven't yet created the maximum number of dynamic threads.</span>
00909             <span class="comment">//</span>
00910             <span class="comment">// Things look like they're stuck, create a new thread.</span>
00911             <span class="comment">//</span>
00912 
00913 <span class="preprocessor">#if DBG</span>
00914 <span class="preprocessor"></span>            <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"EXWORKER: Work item deadlock detected, creating "</span>
00915                      <span class="stringliteral">"type %d worker thread\n"</span>,
00916                      Index );
00917 <span class="preprocessor">#endif</span>
00918 <span class="preprocessor"></span>
00919             <span class="comment">//</span>
00920             <span class="comment">// Create a new thread for this queue.  We explicitly ignore</span>
00921             <span class="comment">// an error from ExpCreateDynamicThread(): we'll try again in</span>
00922             <span class="comment">// another detection period if the queue looks like it's still</span>
00923             <span class="comment">// stuck.</span>
00924             <span class="comment">//</span>
00925 
00926             <a class="code" href="../../d1/d9/worker_8c.html#a23">ExpCreateWorkerThread</a>(Index, TRUE);
00927         }
00928 
00929         <span class="comment">//</span>
00930         <span class="comment">// Update some bookkeeping.</span>
00931         <span class="comment">//</span>
00932         <span class="comment">// Note that WorkItemsProcessed and the queue depth must be recorded</span>
00933         <span class="comment">// in that order to avoid getting a false deadlock indication.</span>
00934         <span class="comment">//</span>
00935 
00936         Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o3">WorkItemsProcessedLastPass</a> = Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o2">WorkItemsProcessed</a>;
00937         Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o4">QueueDepthLastPass</a> = <a class="code" href="../../d8/d3/queueobj_8c.html#a2">KeReadStateQueue</a>( &amp;Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o0">WorkerQueue</a> );
00938     }
00939 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="worker.c::ExpNewThreadNecessary" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN __inline ExpNewThreadNecessary           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>QueueType</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00159">159</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00500">_KQUEUE::CurrentCount</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01997">_EX_WORK_QUEUE::DynamicThreadCount</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00499">_KQUEUE::EntryListHead</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00086">ExWorkerQueue</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02027">_EX_WORK_QUEUE::MakeThreadsAsNecessary</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00057">MAX_ADDITIONAL_DYNAMIC_THREADS</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00501">_KQUEUE::MaximumCount</a>, <a class="el" href="../../d5/d8/ex_8h.html#a115">PEX_WORK_QUEUE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d6/d7/ex_8h-source.html#l01990">_EX_WORK_QUEUE::WorkerQueue</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00806">ExpCheckDynamicThreadCount()</a>, and <a class="el" href="../../d2/d8/worker_8c-source.html#l00375">ExQueueWorkItem()</a>.
<p>
<pre class="fragment"><div>00165                    :
00166 
00167     This function checks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied worker queue and determines whether
00168     <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> appropriate to spin up a dynamic worker thread <span class="keywordflow">for</span> that queue.
00169 
00170 Arguments:
00171 
00172     QueueType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queue that should be examined.
00173 
00174 Return Value:
00175 
00176     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> given work queue would benefit from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> creation of an
00177     additional thread, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> not.
00178 
00179 --*/
00180 {
00181     <a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html">PEX_WORK_QUEUE</a> Queue;
00182 
00183     Queue = &amp;<a class="code" href="../../d1/d9/worker_8c.html#a12">ExWorkerQueue</a>[QueueType];
00184 
00185     <span class="keywordflow">if</span> (Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o5">MakeThreadsAsNecessary</a> != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> &amp;&amp;
00186         IsListEmpty( &amp;Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o0">WorkerQueue</a>.<a class="code" href="../../d7/d7/struct__KQUEUE.html#o1">EntryListHead</a> ) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> &amp;&amp;
00187         Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o0">WorkerQueue</a>.<a class="code" href="../../d7/d7/struct__KQUEUE.html#o2">CurrentCount</a> &lt; Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o0">WorkerQueue</a>.<a class="code" href="../../d7/d7/struct__KQUEUE.html#o3">MaximumCount</a> &amp;&amp;
00188         Queue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o1">DynamicThreadCount</a> &lt; <a class="code" href="../../d1/d9/worker_8c.html#a4">MAX_ADDITIONAL_DYNAMIC_THREADS</a>) {
00189 
00190         <span class="comment">//</span>
00191         <span class="comment">// We know these things:</span>
00192         <span class="comment">//</span>
00193         <span class="comment">// - This queue is eligible for dynamic creation of threads to try</span>
00194         <span class="comment">//   to keep the CPUs busy,</span>
00195         <span class="comment">//</span>
00196         <span class="comment">// - There are work items waiting in the queue,</span>
00197         <span class="comment">//</span>
00198         <span class="comment">// - The number of runable worker threads for this queue is less than</span>
00199         <span class="comment">//   the number of processors on this system, and</span>
00200         <span class="comment">//</span>
00201         <span class="comment">// - We haven't reached the maximum dynamic thread count.</span>
00202         <span class="comment">//</span>
00203         <span class="comment">// An additional worker thread at this point will help clear the</span>
00204         <span class="comment">// backlog.</span>
00205         <span class="comment">//</span>
00206 
00207         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00208 
00209     } <span class="keywordflow">else</span> {
00210 
00211         <span class="comment">//</span>
00212         <span class="comment">// One of the above conditions is false.</span>
00213         <span class="comment">//</span>
00214 
00215         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00216     }
00217 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="worker.c::ExpWorkerInitialization" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN ExpWorkerInitialization           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">220</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
References <a class="el" href="../../d5/d8/ex_8h.html#a332a205">CriticalWorkQueue</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a206">DelayedWorkQueue</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00095">ExCriticalWorkerThreads</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00096">ExDelayedWorkerThreads</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00106">ExpAdditionalCriticalWorkerThreads</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00107">ExpAdditionalDelayedWorkerThreads</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">ExpCreateWorkerThread()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00431">ExpWorkerThreadBalanceManager()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00102">ExThreadSetManagerEvent</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00086">ExWorkerQueue</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a207">HyperCriticalWorkQueue</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l01066">KeInitializeEvent</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00036">KeInitializeQueue()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00061">LARGE_NUMBER_OF_THREADS</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02027">_EX_WORK_QUEUE::MakeThreadsAsNecessary</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00056">MAX_ADDITIONAL_THREADS</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a208">MaximumWorkQueue</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00060">MEDIUM_NUMBER_OF_THREADS</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l03087">MmIsThisAnNtAsSystem()</a>, <a class="el" href="../../d2/d1/mm_8h.html#a343a167">MmLargeSystem</a>, <a class="el" href="../../d2/d1/mm_8h.html#a343a166">MmMediumSystem</a>, <a class="el" href="../../d3/d0/mm_8h-source.html#l00399">MmNumberOfPhysicalPages</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l03073">MmQuerySystemSize()</a>, <a class="el" href="../../d2/d1/mm_8h.html#a343a165">MmSmallSystem</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00599">PAGE_SIZE</a>, <a class="el" href="../../d3/d7/ps_2create_8c-source.html#l00175">PsCreateSystemThread()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00059">SMALL_NUMBER_OF_THREADS</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a>.
<p>
<pre class="fragment"><div>00224 {
00225 
00226     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00227     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00228     ULONG NumberOfDelayedThreads;
00229     ULONG NumberOfCriticalThreads;
00230     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00231     HANDLE Thread;
00232     BOOLEAN NtAs;
00233     <a class="code" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a> WorkQueueType;
00234 
00235     <span class="comment">//</span>
00236     <span class="comment">// Set the number of worker threads based on the system size.</span>
00237     <span class="comment">//</span>
00238 
00239     NtAs = <a class="code" href="../../d5/d1/mminit_8c.html#a58">MmIsThisAnNtAsSystem</a>();
00240     <span class="keywordflow">switch</span> (<a class="code" href="../../d5/d1/mminit_8c.html#a57">MmQuerySystemSize</a>()) {
00241     <span class="keywordflow">case</span> <a class="code" href="../../d2/d1/mm_8h.html#a343a165">MmSmallSystem</a>:
00242         NumberOfDelayedThreads = <a class="code" href="../../d1/d9/worker_8c.html#a6">MEDIUM_NUMBER_OF_THREADS</a>;
00243         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/mm_8h.html#a136">MmNumberOfPhysicalPages</a> &gt; ((12*1024*1024)/<a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>) ) {
00244             NumberOfCriticalThreads = <a class="code" href="../../d1/d9/worker_8c.html#a6">MEDIUM_NUMBER_OF_THREADS</a>;
00245         } <span class="keywordflow">else</span> {
00246             NumberOfCriticalThreads = <a class="code" href="../../d1/d9/worker_8c.html#a5">SMALL_NUMBER_OF_THREADS</a>;
00247         }
00248         <span class="keywordflow">break</span>;
00249 
00250     <span class="keywordflow">case</span> <a class="code" href="../../d2/d1/mm_8h.html#a343a166">MmMediumSystem</a>:
00251         NumberOfDelayedThreads = <a class="code" href="../../d1/d9/worker_8c.html#a6">MEDIUM_NUMBER_OF_THREADS</a>;
00252         NumberOfCriticalThreads = <a class="code" href="../../d1/d9/worker_8c.html#a6">MEDIUM_NUMBER_OF_THREADS</a>;
00253         <span class="keywordflow">if</span> ( NtAs ) {
00254             NumberOfCriticalThreads += <a class="code" href="../../d1/d9/worker_8c.html#a6">MEDIUM_NUMBER_OF_THREADS</a>;
00255             }
00256         <span class="keywordflow">break</span>;
00257 
00258     <span class="keywordflow">case</span> <a class="code" href="../../d2/d1/mm_8h.html#a343a167">MmLargeSystem</a>:
00259         NumberOfDelayedThreads = <a class="code" href="../../d1/d9/worker_8c.html#a6">MEDIUM_NUMBER_OF_THREADS</a>;
00260         NumberOfCriticalThreads = <a class="code" href="../../d1/d9/worker_8c.html#a7">LARGE_NUMBER_OF_THREADS</a>;
00261         <span class="keywordflow">if</span> ( NtAs ) {
00262             NumberOfCriticalThreads += <a class="code" href="../../d1/d9/worker_8c.html#a7">LARGE_NUMBER_OF_THREADS</a>;
00263             }
00264         <span class="keywordflow">break</span>;
00265 
00266     <span class="keywordflow">default</span>:
00267         NumberOfDelayedThreads = <a class="code" href="../../d1/d9/worker_8c.html#a5">SMALL_NUMBER_OF_THREADS</a>;
00268         NumberOfCriticalThreads = <a class="code" href="../../d1/d9/worker_8c.html#a5">SMALL_NUMBER_OF_THREADS</a>;
00269     }
00270 
00271 
00272     <span class="comment">//</span>
00273     <span class="comment">// Initialize the work Queue objects.</span>
00274     <span class="comment">//</span>
00275 
00276     <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d0/cmdat3_8c.html#a50">ExpAdditionalCriticalWorkerThreads</a> &gt; <a class="code" href="../../d1/d9/worker_8c.html#a3">MAX_ADDITIONAL_THREADS</a> ) {
00277         <a class="code" href="../../d8/d0/cmdat3_8c.html#a50">ExpAdditionalCriticalWorkerThreads</a> = <a class="code" href="../../d1/d9/worker_8c.html#a3">MAX_ADDITIONAL_THREADS</a>;
00278         }
00279 
00280     <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d0/cmdat3_8c.html#a51">ExpAdditionalDelayedWorkerThreads</a> &gt; <a class="code" href="../../d1/d9/worker_8c.html#a3">MAX_ADDITIONAL_THREADS</a> ) {
00281         <a class="code" href="../../d8/d0/cmdat3_8c.html#a51">ExpAdditionalDelayedWorkerThreads</a> = <a class="code" href="../../d1/d9/worker_8c.html#a3">MAX_ADDITIONAL_THREADS</a>;
00282         }
00283 
00284     <span class="comment">//</span>
00285     <span class="comment">// Initialize the ExWorkerQueue[] array.</span>
00286     <span class="comment">// </span>
00287 
00288     <span class="keywordflow">for</span> (WorkQueueType = 0; WorkQueueType &lt; <a class="code" href="../../d5/d8/ex_8h.html#a332a208">MaximumWorkQueue</a>; WorkQueueType++) {
00289 
00290         RtlZeroMemory(&amp;ExWorkerQueue[WorkQueueType],
00291                       <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html">EX_WORK_QUEUE</a>));
00292 
00293         <a class="code" href="../../d8/d3/queueobj_8c.html#a1">KeInitializeQueue</a>(&amp;ExWorkerQueue[WorkQueueType].WorkerQueue, 0);
00294     }
00295 
00296     <span class="comment">//</span>
00297     <span class="comment">// We only create dynamic threads for the critical work queue (note</span>
00298     <span class="comment">// this doesn't apply to dynamic threads created to break deadlocks.)</span>
00299     <span class="comment">//</span>
00300     <span class="comment">// The rationale is this: folks who use the delayed work queue are</span>
00301     <span class="comment">// not time critical, and the hypercritical queue is used rarely</span>
00302     <span class="comment">// by folks who are non-blocking.</span>
00303     <span class="comment">//</span>
00304 
00305     <a class="code" href="../../d1/d9/worker_8c.html#a12">ExWorkerQueue</a>[<a class="code" href="../../d5/d8/ex_8h.html#a332a205">CriticalWorkQueue</a>].<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o5">MakeThreadsAsNecessary</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00306 
00307     <span class="comment">//</span>
00308     <span class="comment">// Initialize the global thread set manager event.</span>
00309     <span class="comment">//</span>
00310 
00311     <a class="code" href="../../d4/d9/ke_8h.html#a20">KeInitializeEvent</a>(&amp;ExThreadSetManagerEvent,
00312                       SynchronizationEvent,
00313                       FALSE);
00314 
00315     <span class="comment">//</span>
00316     <span class="comment">// Create the desired number of executive worker threads for each</span>
00317     <span class="comment">// of the work queues.</span>
00318     <span class="comment">//</span>
00319 
00320     InitializeObjectAttributes(&amp;ObjectAttributes, NULL, 0, NULL, NULL);
00321 
00322     <span class="comment">//</span>
00323     <span class="comment">// Create any builtin critical and delayed worker threads.</span>
00324     <span class="comment">//</span>
00325 
00326     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; (NumberOfCriticalThreads + <a class="code" href="../../d8/d0/cmdat3_8c.html#a50">ExpAdditionalCriticalWorkerThreads</a>); <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00327 
00328         <span class="comment">//</span>
00329         <span class="comment">// Create a worker thread to service the critical work queue.</span>
00330         <span class="comment">//</span>
00331 
00332         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d9/worker_8c.html#a23">ExpCreateWorkerThread</a>( CriticalWorkQueue, FALSE );
00333         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00334             <span class="keywordflow">break</span>;
00335         }
00336         <a class="code" href="../../d1/d9/worker_8c.html#a15">ExCriticalWorkerThreads</a>++;
00337     }
00338 
00339 
00340     <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; (NumberOfDelayedThreads + <a class="code" href="../../d8/d0/cmdat3_8c.html#a51">ExpAdditionalDelayedWorkerThreads</a>); <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00341 
00342         <span class="comment">//</span>
00343         <span class="comment">// Create a worker thread to service the delayed work queue.</span>
00344         <span class="comment">//</span>
00345 
00346         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d9/worker_8c.html#a23">ExpCreateWorkerThread</a>( DelayedWorkQueue, FALSE );
00347         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00348             <span class="keywordflow">break</span>;
00349         }
00350 
00351         <a class="code" href="../../d1/d9/worker_8c.html#a16">ExDelayedWorkerThreads</a>++;
00352     }
00353 
00354     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d9/worker_8c.html#a23">ExpCreateWorkerThread</a>( HyperCriticalWorkQueue, FALSE );
00355 
00356     <span class="comment">//</span>
00357     <span class="comment">// Create the worker thread set manager thread.</span>
00358     <span class="comment">//</span>
00359 
00360     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d2/d8/ps_2create_8c.html#a11">PsCreateSystemThread</a>(&amp;Thread,
00361                                   THREAD_ALL_ACCESS,
00362                                   &amp;ObjectAttributes,
00363                                   0L,
00364                                   NULL,
00365                                   ExpWorkerThreadBalanceManager,
00366                                   NULL);
00367     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00368         ZwClose( Thread );
00369     }
00370 
00371     <span class="keywordflow">return</span> (BOOLEAN)<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status);
00372 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="worker.c::ExpWorkerThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExpWorkerThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>StartContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00538">538</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
References <a class="el" href="../../d2/d8/ps_8h-source.html#l00450">_ETHREAD::ActiveImpersonationInfo</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a205">CriticalWorkQueue</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00067">DYNAMIC_THREAD_TIMEOUT</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00080">DYNAMIC_WORKER_THREAD</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01997">_EX_WORK_QUEUE::DynamicThreadCount</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00086">ExWorkerQueue</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a207">HyperCriticalWorkQueue</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l04577">IoRemoteBootClient</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00414">_ETHREAD::IrpList</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00428">KeBugCheckEx()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00238">KeRemoveQueue()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00596">_KTHREAD::KernelApcDisable</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01799">KeSetKernelStackSwapEnable()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00174">KPROCESSOR_MODE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00094">List</a>, <a class="el" href="../../d6/d0/mminit_8c-source.html#l03087">MmIsThisAnNtAsSystem()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01957">_WORK_QUEUE_ITEM::Parameter</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00645">PsGetCurrentThread</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01950">PWORKER_THREAD_ROUTINE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00347">_ETHREAD::Tcb</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>, <a class="el" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01990">_EX_WORK_QUEUE::WorkerQueue</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01956">_WORK_QUEUE_ITEM::WorkerRoutine</a>, and <a class="el" href="../../d6/d7/ex_8h-source.html#l02003">_EX_WORK_QUEUE::WorkItemsProcessed</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">ExpCreateWorkerThread()</a>.
<p>
<pre class="fragment"><div>00542 {
00543 
00544     PLIST_ENTRY Entry;
00545     <a class="code" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a> QueueType;
00546     <a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">PWORK_QUEUE_ITEM</a> WorkItem;
00547     <a class="code" href="../../d0/d9/ntosdef_8h.html#a39">KPROCESSOR_MODE</a> WaitMode;
00548     LARGE_INTEGER TimeoutValue;
00549     PLARGE_INTEGER Timeout;
00550     <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> Thread;
00551     BOOLEAN DynamicThread;
00552     <a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html">PEX_WORK_QUEUE</a> WorkerQueue;
00553     PVOID WorkerRoutine;
00554     PVOID Parameter;
00555 
00556     WaitMode = <a class="code" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>;
00557 
00558     <span class="comment">//</span>
00559     <span class="comment">// Set timeout value etc according to whether we are static or dynamic.</span>
00560     <span class="comment">//</span>
00561 
00562     <span class="keywordflow">if</span> (((ULONG_PTR)StartContext &amp; <a class="code" href="../../d1/d9/worker_8c.html#a10">DYNAMIC_WORKER_THREAD</a>) == 0) {
00563 
00564         <span class="comment">//</span>
00565         <span class="comment">// We are being created as a static thread.  As such it will not</span>
00566         <span class="comment">// terminate, so there is no point in timing out waiting for a work</span>
00567         <span class="comment">// item.</span>
00568         <span class="comment">//</span>
00569 
00570         Timeout = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00571 
00572     } <span class="keywordflow">else</span> {
00573 
00574         <span class="comment">//</span>
00575         <span class="comment">// This is a dynamic worker thread.  It has a non-infinite timeout</span>
00576         <span class="comment">// so that it can eventually terminate.</span>
00577         <span class="comment">//</span>
00578 
00579         TimeoutValue.QuadPart = -<a class="code" href="../../d1/d9/worker_8c.html#a8">DYNAMIC_THREAD_TIMEOUT</a>;
00580         Timeout = &amp;TimeoutValue;
00581     }
00582 
00583     Thread = <a class="code" href="../../d1/d9/ps_8h.html#a20">PsGetCurrentThread</a>();
00584 
00585     <span class="comment">//</span>
00586     <span class="comment">// If the thread is a critical worker thread, then set the thread</span>
00587     <span class="comment">// priority to the lowest realtime level. Otherwise, set the base</span>
00588     <span class="comment">// thread priority to time critical.</span>
00589     <span class="comment">//</span>
00590 
00591     QueueType = (<a class="code" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a>)
00592                 ((ULONG_PTR)StartContext &amp; ~<a class="code" href="../../d1/d9/worker_8c.html#a10">DYNAMIC_WORKER_THREAD</a>);
00593 
00594     WorkerQueue = &amp;<a class="code" href="../../d1/d9/worker_8c.html#a12">ExWorkerQueue</a>[QueueType];
00595 
00596     <span class="keywordflow">switch</span> ( QueueType ) {
00597 
00598         <span class="keywordflow">case</span> <a class="code" href="../../d5/d8/ex_8h.html#a332a207">HyperCriticalWorkQueue</a>:
00599 
00600             <span class="comment">//</span>
00601             <span class="comment">// Always make stack for this thread resident</span>
00602             <span class="comment">// so that worker pool deadlock magic can run</span>
00603             <span class="comment">// even when what we are trying to do is inpage</span>
00604             <span class="comment">// the hyper critical worker thread's stack.</span>
00605             <span class="comment">// Without this fix, we hold the process lock</span>
00606             <span class="comment">// but this thread's stack can't come in, and</span>
00607             <span class="comment">// the deadlock detection cannot create new threads</span>
00608             <span class="comment">// to break the system deadlock.</span>
00609             <span class="comment">//</span>
00610 
00611             WaitMode = <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>;
00612             <span class="keywordflow">break</span>;
00613 
00614         <span class="keywordflow">case</span> <a class="code" href="../../d5/d8/ex_8h.html#a332a205">CriticalWorkQueue</a>:
00615             <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d1/mminit_8c.html#a58">MmIsThisAnNtAsSystem</a>() ) {
00616                 WaitMode = <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>;
00617                 }
00618 
00619             <span class="keywordflow">break</span>;
00620     }
00621 
00622 <span class="preprocessor">#if defined(REMOTE_BOOT)</span>
00623 <span class="preprocessor"></span>    <span class="comment">//</span>
00624     <span class="comment">// In diskless NT scenarios ensure that the kernel stack of the worker</span>
00625     <span class="comment">// threads will not be swapped out.</span>
00626     <span class="comment">//</span>
00627 
00628     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d5/io_8h.html#a399">IoRemoteBootClient</a>) {
00629         <a class="code" href="../../d9/d1/thredobj_8c.html#a23">KeSetKernelStackSwapEnable</a>(FALSE);
00630     }
00631 <span class="preprocessor">#endif // defined(REMOTE_BOOT)</span>
00632 <span class="preprocessor"></span>
00633     <span class="comment">//</span>
00634     <span class="comment">// Loop forever waiting for a work queue item, calling the processing</span>
00635     <span class="comment">// routine, and then waiting for another work queue item.</span>
00636     <span class="comment">//</span>
00637 
00638     <span class="keywordflow">do</span> {
00639 
00640         <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00641 
00642             <span class="comment">//</span>
00643             <span class="comment">// Wait until something is put in the queue or until we time out.</span>
00644             <span class="comment">//</span>
00645             <span class="comment">// By specifying a wait mode of UserMode, the thread's kernel</span>
00646             <span class="comment">// stack is swappable.</span>
00647             <span class="comment">//</span>
00648 
00649             Entry = <a class="code" href="../../d8/d3/queueobj_8c.html#a5">KeRemoveQueue</a>(&amp;WorkerQueue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o0">WorkerQueue</a>,
00650                                   WaitMode,
00651                                   Timeout);
00652             <span class="keywordflow">if</span> ((ULONG_PTR)Entry != STATUS_TIMEOUT) {
00653 
00654                 <span class="comment">//</span>
00655                 <span class="comment">// This is a real work item, break out of the timeout loop</span>
00656                 <span class="comment">// and go process.</span>
00657                 <span class="comment">//</span>
00658 
00659                 <span class="keywordflow">break</span>;
00660             }
00661 
00662             <span class="comment">// </span>
00663             <span class="comment">// These things are known:</span>
00664             <span class="comment">//</span>
00665             <span class="comment">// - Static worker threads do not time out, so this is a dynamic</span>
00666             <span class="comment">//   worker thread.</span>
00667             <span class="comment">//</span>
00668             <span class="comment">// - This thread has been waiting for a long time with nothing</span>
00669             <span class="comment">//   to do.</span>
00670             <span class="comment">//</span>
00671 
00672             <span class="keywordflow">if</span> (IsListEmpty( &amp;Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o18">IrpList</a> ) == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00673 
00674                 <span class="comment">//</span>
00675                 <span class="comment">// There is still I/O pending, can't terminate yet.</span>
00676                 <span class="comment">//</span>
00677 
00678                 <span class="keywordflow">continue</span>;
00679             }
00680 
00681             <span class="comment">//</span>
00682             <span class="comment">// This dynamic thread can be terminated.</span>
00683             <span class="comment">//</span>
00684 
00685 <span class="preprocessor">#if DBG</span>
00686 <span class="preprocessor"></span>            <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"EXWORKER: Dynamic type %d thread no longer needed,"</span>
00687                      <span class="stringliteral">" terminating.\n"</span>,
00688                      QueueType );
00689 <span class="preprocessor">#endif</span>
00690 <span class="preprocessor"></span>
00691             InterlockedDecrement(
00692                 &amp;WorkerQueue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o1">DynamicThreadCount</a> );
00693 
00694 <span class="preprocessor">#if defined(REMOTE_BOOT)</span>
00695 <span class="preprocessor"></span>            <span class="comment">//</span>
00696             <span class="comment">// We will bugcheck if we terminate a thread with stack swapping</span>
00697             <span class="comment">// disabled.</span>
00698             <span class="comment">//</span>
00699 
00700             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d5/io_8h.html#a399">IoRemoteBootClient</a>) {
00701                 <a class="code" href="../../d9/d1/thredobj_8c.html#a23">KeSetKernelStackSwapEnable</a>(TRUE);
00702             }
00703 <span class="preprocessor">#endif // defined(REMOTE_BOOT)</span>
00704 <span class="preprocessor"></span>
00705             <span class="keywordflow">return</span>;
00706         }
00707 
00708         <span class="comment">//</span>
00709         <span class="comment">// Update the total number of work items processed.</span>
00710         <span class="comment">// </span>
00711 
00712         InterlockedIncrement( &amp;WorkerQueue-&gt;<a class="code" href="../../d8/d7/struct__EX__WORK__QUEUE.html#o2">WorkItemsProcessed</a> );
00713 
00714         WorkItem = CONTAINING_RECORD(Entry, <a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">WORK_QUEUE_ITEM</a>, List);
00715         WorkerRoutine = WorkItem-&gt;<a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html#o1">WorkerRoutine</a>;
00716         Parameter = WorkItem-&gt;<a class="code" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html#o2">Parameter</a>;
00717 
00718         <span class="comment">//</span>
00719         <span class="comment">// Execute the specified routine.</span>
00720         <span class="comment">//</span>
00721 
00722 <span class="preprocessor">#if DBG</span>
00723 <span class="preprocessor"></span>
00724         <span class="keywordflow">try</span> {
00725 
00726             ((<a class="code" href="../../d5/d8/ex_8h.html#a111">PWORKER_THREAD_ROUTINE</a>)WorkerRoutine)(Parameter);
00727 
00728             <span class="keywordflow">if</span> (KeGetCurrentIrql() != 0) {
00729                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"EXWORKER: worker exit at IRQL %d, worker routine %x, "</span>
00730                         <span class="stringliteral">"parameter %x, item %x\n"</span>,
00731                         KeGetCurrentIrql(), WorkerRoutine, Parameter, WorkItem);
00732 
00733                 DbgBreakPoint();
00734             }
00735 
00736             <span class="comment">//</span>
00737             <span class="comment">// Catch worker routines that forget to do KeLeaveCriticalRegion.</span>
00738             <span class="comment">//</span>
00739             <span class="keywordflow">if</span> (Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o30">KernelApcDisable</a> != 0) {
00740                 <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"EXWORKER: worker exit with APCs disabled, worker routine %x, "</span>
00741                         <span class="stringliteral">"parameter %x, item %x\n"</span>,
00742                         WorkerRoutine, Parameter, WorkItem);
00743 
00744                 DbgBreakPoint();
00745                 Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o30">KernelApcDisable</a> = 0;
00746             }
00747 
00748             <span class="keywordflow">if</span> (Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o35">ActiveImpersonationInfo</a>) {
00749                 <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(
00750                     IMPERSONATING_WORKER_THREAD,
00751                     (ULONG_PTR)WorkerRoutine,
00752                     (ULONG_PTR)Parameter,
00753                     (ULONG_PTR)WorkItem,
00754                     0);
00755             }
00756 
00757         } except( ExpWorkerThreadFilter(WorkerRoutine,
00758                                         Parameter,
00759                                         GetExceptionInformation() )) {
00760         }
00761 
00762 <span class="preprocessor">#else</span>
00763 <span class="preprocessor"></span>
00764         ((<a class="code" href="../../d5/d8/ex_8h.html#a111">PWORKER_THREAD_ROUTINE</a>)WorkerRoutine)(Parameter);
00765 
00766         <span class="comment">//</span>
00767         <span class="comment">// Catch worker routines that forget to do KeLeaveCriticalRegion.</span>
00768         <span class="comment">// It has to be zero at this point. In the debug case we enter a </span>
00769         <span class="comment">// breakpoint. In the non-debug case just zero the flag so that</span>
00770         <span class="comment">// APCs can continue to fire to this thread.</span>
00771         <span class="comment">//</span>
00772 
00773         <span class="keywordflow">if</span> (Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o30">KernelApcDisable</a> != 0) {
00774             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"EXWORKER: worker exit with APCs disabled, worker routine %x, "</span>
00775                     <span class="stringliteral">"parameter %x, item %x\n"</span>,
00776                     WorkerRoutine, Parameter, WorkItem);
00777 
00778             Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o0">Tcb</a>.<a class="code" href="../../d1/d8/struct__KTHREAD.html#o30">KernelApcDisable</a> = 0;
00779         }
00780 
00781         <span class="keywordflow">if</span> (KeGetCurrentIrql() != 0) {
00782             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(
00783                 WORKER_THREAD_RETURNED_AT_BAD_IRQL,
00784                 (ULONG_PTR)WorkerRoutine,
00785                 (ULONG_PTR)KeGetCurrentIrql(),
00786                 (ULONG_PTR)Parameter,
00787                 (ULONG_PTR)WorkItem
00788                 );
00789             }
00790 
00791         <span class="keywordflow">if</span> (Thread-&gt;<a class="code" href="../../d5/d6/struct__ETHREAD.html#o35">ActiveImpersonationInfo</a>) {
00792             <a class="code" href="../../d9/d1/bugcheck_8c.html#a19">KeBugCheckEx</a>(
00793                 IMPERSONATING_WORKER_THREAD,
00794                 (ULONG_PTR)WorkerRoutine,
00795                 (ULONG_PTR)Parameter,
00796                 (ULONG_PTR)WorkItem,
00797                 0
00798                 );
00799         }
00800 <span class="preprocessor">#endif</span>
00801 <span class="preprocessor"></span>
00802     } <span class="keywordflow">while</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00803 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="worker.c::ExpWorkerThreadBalanceManager" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExpWorkerThreadBalanceManager           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>StartContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00431">431</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
References <a class="el" href="../../d2/d8/worker_8c-source.html#l00049">CRITICAL_WORK_QUEUE_PRIORITY</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00623">Executive</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00806">ExpCheckDynamicThreadCount()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00853">ExpDetectWorkerThreadDeadlock()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00102">ExThreadSetManagerEvent</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00043">KeInitializeTimer()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01532">KeSetBasePriorityThread()</a>, <a class="el" href="../../d4/d1/timerobj_8c-source.html#l00243">KeSetTimer()</a>, <a class="el" href="../../d2/d6/wait_8c-source.html#l00395">KeWaitForMultipleObjects()</a>, <a class="el" href="../../d1/d9/worker_8c.html#a31a20">MaximumBalanceObject</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00073">THREAD_SET_INTERVAL</a>, <a class="el" href="../../d1/d9/worker_8c.html#a31a19">ThreadSetManagerEvent</a>, <a class="el" href="../../d1/d9/worker_8c.html#a31a18">TimerExpiration</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">ExpWorkerInitialization()</a>.
<p>
<pre class="fragment"><div>00437                    :
00438 
00439     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> startup code <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> worker thread manager thread.
00440     The worker thread manager thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> created during system initialization
00441     and begins execution in <span class="keyword">this</span> function.
00442 
00443     This thread <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> responsible <span class="keywordflow">for</span> detecting and breaking circular deadlocks
00444     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system worker thread queues.  It will also create and destroy
00445     additional worker threads as needed based on loading.
00446 
00447 Arguments:
00448 
00449     Context - Supplies a pointer to an arbitrary data structure (NULL).
00450 
00451 Return Value:
00452 
00453     None.
00454 
00455 --*/
00456 {
00457     <a class="code" href="../../d3/d8/struct__KTIMER.html">KTIMER</a> PeriodTimer;
00458     LARGE_INTEGER DueTime;
00459     PVOID WaitObjects[<a class="code" href="../../d1/d9/worker_8c.html#a31a20">MaximumBalanceObject</a>];
00460     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00461 
00462     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00463 
00464     <span class="comment">//</span>
00465     <span class="comment">// Raise the thread priority to just higher than the priority of the</span>
00466     <span class="comment">// critical work queue.</span>
00467     <span class="comment">//</span>
00468 
00469     <a class="code" href="../../d9/d1/thredobj_8c.html#a20">KeSetBasePriorityThread</a>(<a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>(),
00470                             CRITICAL_WORK_QUEUE_PRIORITY+1);
00471 
00472     <span class="comment">//</span>
00473     <span class="comment">// Initialize the periodic timer and set the manager period.</span>
00474     <span class="comment">//</span>
00475 
00476     <a class="code" href="../../d3/d2/timerobj_8c.html#a1">KeInitializeTimer</a>(&amp;PeriodTimer);
00477     DueTime.QuadPart = - <a class="code" href="../../d1/d9/worker_8c.html#a9">THREAD_SET_INTERVAL</a>;
00478 
00479     <span class="comment">//</span>
00480     <span class="comment">// Initialize the wait object array.</span>
00481     <span class="comment">//</span>
00482 
00483     WaitObjects[<a class="code" href="../../d1/d9/worker_8c.html#a31a18">TimerExpiration</a>] = (PVOID)&amp;PeriodTimer;
00484     WaitObjects[<a class="code" href="../../d1/d9/worker_8c.html#a31a19">ThreadSetManagerEvent</a>] = (PVOID)&amp;<a class="code" href="../../d1/d9/worker_8c.html#a17">ExThreadSetManagerEvent</a>;
00485 
00486     <span class="comment">//</span>
00487     <span class="comment">// Loop forever processing events.</span>
00488     <span class="comment">//</span>
00489 
00490     <span class="keywordflow">while</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ) {
00491 
00492         <span class="comment">//</span>
00493         <span class="comment">// Set the timer to expire at the next periodic interval.</span>
00494         <span class="comment">//</span>
00495 
00496         <a class="code" href="../../d3/d2/timerobj_8c.html#a6">KeSetTimer</a>(&amp;PeriodTimer, DueTime, NULL);
00497 
00498         <span class="comment">//</span>
00499         <span class="comment">// Wake up when the timer expires or the set manager event is</span>
00500         <span class="comment">// signalled.</span>
00501         <span class="comment">//</span>
00502 
00503         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d7/wait_8c.html#a3">KeWaitForMultipleObjects</a>(MaximumBalanceObject,
00504                                           WaitObjects,
00505                                           WaitAny,
00506                                           Executive,
00507                                           KernelMode,
00508                                           FALSE,
00509                                           NULL,
00510                                           NULL);
00511 
00512         <span class="keywordflow">switch</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>) {
00513 
00514             <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/worker_8c.html#a31a18">TimerExpiration</a>:
00515 
00516                 <span class="comment">//</span>
00517                 <span class="comment">// Periodic timer expiration - go see if any work queues</span>
00518                 <span class="comment">// are deadlocked.</span>
00519                 <span class="comment">//</span>
00520         
00521                 <a class="code" href="../../d1/d9/worker_8c.html#a24">ExpDetectWorkerThreadDeadlock</a>();
00522                 <span class="keywordflow">break</span>;
00523 
00524             <span class="keywordflow">case</span> <a class="code" href="../../d1/d9/worker_8c.html#a31a19">ThreadSetManagerEvent</a>:
00525 
00526                 <span class="comment">//</span>
00527                 <span class="comment">// Someone has asked us to check some metrics to determine</span>
00528                 <span class="comment">// whether we should create another worker thread.</span>
00529                 <span class="comment">//</span>
00530 
00531                 <a class="code" href="../../d1/d9/worker_8c.html#a22">ExpCheckDynamicThreadCount</a>();
00532                 <span class="keywordflow">break</span>;
00533         }
00534     }
00535 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="worker.c::ExQueueWorkItem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ExQueueWorkItem           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d7/d9/struct__WORK__QUEUE__ITEM.html">PWORK_QUEUE_ITEM</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>WorkItem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a110">WORK_QUEUE_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>QueueType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00375">375</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00159">ExpNewThreadNecessary()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00102">ExThreadSetManagerEvent</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00086">ExWorkerQueue</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00124">KeInsertQueue()</a>, <a class="el" href="../../d3/d7/eventobj_8c-source.html#l00343">KeSetEvent()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a332a208">MaximumWorkQueue</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d6/d0/lazyrite_8c-source.html#l00662">CcPostWorkQueue()</a>, <a class="el" href="../../d6/d0/cmgquota_8c-source.html#l00204">CmpClaimGlobalQuota()</a>, <a class="el" href="../../d6/d2/cmworker_8c-source.html#l00556">CmpDiskFullWarning()</a>, <a class="el" href="../../d6/d2/cmworker_8c-source.html#l00416">CmpLazyFlushDpcRoutine()</a>, <a class="el" href="../../d1/d1/cmnotify_8c-source.html#l00487">CmpPostNotify()</a>, <a class="el" href="../../d4/d9/pnpdel_8c-source.html#l00084">IopChainDereferenceComplete()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l00657">IopCompleteUnloadOrDelete()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00896">IopDeviceEjectComplete()</a>, <a class="el" href="../../d1/d0/pnpirp_8c-source.html#l00730">IopEjectDevice()</a>, <a class="el" href="../../d8/d6/errorlog_8c-source.html#l00660">IopErrorLogDpc()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l05034">IopProcessNewProfile()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06327">IopQueueDeviceWorkItem()</a>, <a class="el" href="../../d7/d9/pnpenum_8c-source.html#l00207">IopRequestDeviceAction()</a>, <a class="el" href="../../d3/d3/internal_8c-source.html#l06127">IopSendMessageToTrackService()</a>, <a class="el" href="../../d2/d9/io_2misc_8c-source.html#l00953">IoQueueWorkItem()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l08769">IoRaiseHardError()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l08909">IoRaiseInformationalHardError()</a>, <a class="el" href="../../d9/d9/pnpioapi_8c-source.html#l06118">IoReportTargetDeviceChangeAsynchronous()</a>, <a class="el" href="../../d9/d3/trackirp_8c-source.html#l02555">IovpInternalDeferredCompletion()</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l11556">IoWriteErrorLogEntry()</a>, <a class="el" href="../../d9/d2/kdapi_8c-source.html#l00494">KdpTimeSlipDpcRoutine()</a>, <a class="el" href="../../d0/d8/mips_2kdtrap_8c-source.html#l00079">KdpTrap()</a>, <a class="el" href="../../d7/d2/modwrite_8c-source.html#l01095">MiCheckForCrashDump()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00035">NtLoadDriver()</a>, <a class="el" href="../../d9/d3/loadunld_8c-source.html#l00244">NtUnloadDriver()</a>, <a class="el" href="../../d8/d0/obref_8c-source.html#l01124">ObfDereferenceObject()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l01049">SepInformFileSystemsOfDeletedLogon()</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">SepQueueWorkItem()</a>, <a class="el" href="../../d5/d8/smbtrsup_8c-source.html#l01794">SmbTraceDereferenceHeap()</a>, <a class="el" href="../../d3/d8/workque_8c-source.html#l00316">UdfAddToWorkque()</a>, and <a class="el" href="../../d3/d8/close_8c-source.html#l00634">UdfQueueClose()</a>.
<p>
<pre class="fragment"><div>00382                    :
00383 
00384     This function inserts a work item into a work queue that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> processed
00385     by a worker thread of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> corresponding <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>.
00386 
00387 Arguments:
00388 
00389     WorkItem - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> work item to add <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> queue.
00390         This structure must be located in <a class="code" href="../../d5/d8/ex_8h.html#a329a173">NonPagedPool</a>. The work item
00391         structure contains a doubly linked list entry, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a
00392         routine to call and a parameter to pass to that routine.
00393 
00394     QueueType - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of work queue that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> work item
00395         should be placed in.
00396 
00397 Return Value:
00398 
00399     None
00400 
00401 --*/
00402 
00403 {
00404 
00405     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(QueueType &lt; MaximumWorkQueue);
00406     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(WorkItem-&gt;List.Flink == NULL);
00407 
00408     <span class="comment">//</span>
00409     <span class="comment">// Insert the work item in the appropriate queue object.</span>
00410     <span class="comment">//</span>
00411 
00412     <a class="code" href="../../d8/d3/queueobj_8c.html#a3">KeInsertQueue</a>(&amp;ExWorkerQueue[QueueType].WorkerQueue, &amp;WorkItem-&gt;List);
00413 
00414     <span class="comment">//</span>
00415     <span class="comment">// Determine whether another thread should be created, and signal the</span>
00416     <span class="comment">// thread set balance manager if so.</span>
00417     <span class="comment">//</span>
00418 
00419     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d9/worker_8c.html#a28">ExpNewThreadNecessary</a>(QueueType) != <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00420         
00421         <a class="code" href="../../d2/d8/eventobj_8c.html#a8">KeSetEvent</a>( &amp;ExThreadSetManagerEvent,
00422                     0,
00423                     FALSE );
00424     }
00425 
00426     <span class="keywordflow">return</span>;
00427 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a15" doxytag="worker.c::ExCriticalWorkerThreads" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d8/ex_8h.html#a163">ExCriticalWorkerThreads</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00095">95</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d6/d7/fssup_8c-source.html#l00069">CcInitializeCacheManager()</a>, and <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">ExpWorkerInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="worker.c::ExDelayedWorkerThreads" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d5/d8/ex_8h.html#a164">ExDelayedWorkerThreads</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00096">96</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">ExpWorkerInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="worker.c::ExpAdditionalCriticalWorkerThreads" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d1/d9/worker_8c.html#a13">ExpAdditionalCriticalWorkerThreads</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00092">92</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">ExpWorkerInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="worker.c::ExpAdditionalDelayedWorkerThreads" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d1/d9/worker_8c.html#a14">ExpAdditionalDelayedWorkerThreads</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00093">93</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">ExpWorkerInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="worker.c::ExThreadSetManagerEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d6/struct__KEVENT.html">KEVENT</a> <a class="el" href="../../d1/d9/worker_8c.html#a17">ExThreadSetManagerEvent</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00102">102</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">ExpWorkerInitialization()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00431">ExpWorkerThreadBalanceManager()</a>, and <a class="el" href="../../d2/d8/worker_8c-source.html#l00375">ExQueueWorkItem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="worker.c::ExWorkerQueue" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d7/struct__EX__WORK__QUEUE.html">EX_WORK_QUEUE</a> <a class="el" href="../../d5/d8/ex_8h.html#a116">ExWorkerQueue</a>[MaximumWorkQueue]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/worker_8c-source.html#l00086">86</a> of file <a class="el" href="../../d2/d8/worker_8c-source.html">worker.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/worker_8c-source.html#l01097">ExpCheckForWorker()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00971">ExpCreateWorkerThread()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00853">ExpDetectWorkerThreadDeadlock()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00159">ExpNewThreadNecessary()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00220">ExpWorkerInitialization()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00538">ExpWorkerThread()</a>, <a class="el" href="../../d2/d8/worker_8c-source.html#l00375">ExQueueWorkItem()</a>, <a class="el" href="../../d9/d2/queueobj_8c-source.html#l00238">KeRemoveQueue()</a>, and <a class="el" href="../../d0/d1/thredobj_8c-source.html#l01996">KeTerminateThread()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:46:09 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
