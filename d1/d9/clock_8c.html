<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: clock.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>clock.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>
<code>#include &lt;<a class="el" href="../../d4/d3/ia64_8h-source.html">ia64.h</a>&gt;</code><br>
<code>#include &lt;ntia64.h&gt;</code><br>
<code>#include &lt;ntexapi.h&gt;</code><br>

<p>
<a href="../../d2/d8/clock_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/clock_8c.html#a0">KiProcessProfileList</a> (IN PKTRAP_FRAME TrFrame, IN KPROFILE_SOURCE Source, IN PLIST_ENTRY ListHead)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/clock_8c.html#a1">KiChkTimerExpireSysDpc</a> (IN ULONGLONG TickCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/clock_8c.html#a2">KeUpdateSystemTime</a> (IN PKTRAP_FRAME TrFrame, IN ULONG Increment)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/clock_8c.html#a3">KeUpdateRunTime</a> (IN PKTRAP_FRAME TrFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/clock_8c.html#a4">KiDecrementQuantum</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/clock_8c.html#a5">KeProfileInterrupt</a> (IN PKTRAP_FRAME TrFrame)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d9/clock_8c.html#a6">KeProfileInterruptWithSource</a> (IN PKTRAP_FRAME TrFrame, IN KPROFILE_SOURCE Source)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a5" doxytag="clock.c::KeProfileInterrupt" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeProfileInterrupt           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TrFrame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/clock_8c-source.html#l00366">366</a> of file <a class="el" href="../../d2/d8/clock_8c-source.html">clock.c</a>.
<p>
References <a class="el" href="../../d2/d8/clock_8c-source.html#l00401">KeProfileInterruptWithSource()</a>.
<p>
<pre class="fragment"><div>00371                    :
00372 
00373     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executed on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor complex.
00374     The routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> entered as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> result of an interrupt generated by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> profile
00375     timer. Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to update <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> profile information <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> currently
00376     active profile objects.
00377 
00378     N.B. <a class="code" href="../../d1/d9/clock_8c.html#a5">KeProfileInterrupt</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> an alternate entry <span class="keywordflow">for</span> backwards compatability that
00379          sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source to zero (ProfileTime).
00380 
00381 Arguments:
00382 
00383     TrFrame   - Supplies a pointer to a trap frame.
00384 
00385 Return Value:
00386 
00387     None.
00388 
00389 --*/
00390 
00391 {
00392     KPROFILE_SOURCE Source = 0;
00393 
00394     <a class="code" href="../../d1/d9/clock_8c.html#a6">KeProfileInterruptWithSource</a>(TrFrame, Source);
00395 
00396     <span class="keywordflow">return</span>;
00397 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="clock.c::KeProfileInterruptWithSource" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeProfileInterruptWithSource           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KPROFILE_SOURCE&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/clock_8c-source.html#l00401">401</a> of file <a class="el" href="../../d2/d8/clock_8c-source.html">clock.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d2/d8/clock_8c-source.html#l00449">KiProcessProfileList()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00484">KiProfileListHead</a>, <a class="el" href="../../d5/d3/alpha_2splocks_8c-source.html#l00066">KiProfileLock</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00244">_KAPC_STATE::Process</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00699">_KPROCESS::ProfileListHead</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/clock_8c-source.html#l00366">KeProfileInterrupt()</a>, <a class="el" href="../../d3/d1/byteem_8c-source.html#l00049">KiEmulateByteWord()</a>, and <a class="el" href="../../d6/d4/ia64_2alignem_8c-source.html#l00166">KiEmulateReference()</a>.
<p>
<pre class="fragment"><div>00407                    :
00408 
00409     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executed on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor complex.
00410     The routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> entered as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> result of an interrupt generated by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> profile
00411     timer. Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to update <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> profile information <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> currently
00412     active profile objects.
00413 
00414     N.B. <a class="code" href="../../d1/d9/clock_8c.html#a6">KeProfileInterruptWithSource</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not currently fully implemented by any of
00415          <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> architectures.
00416 
00417 Arguments:
00418 
00419     TrFrame - Supplies a pointer to a trap frame.
00420 
00421     Source  - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> profile interrupt.
00422 
00423 Return Value:
00424 
00425     None.
00426 
00427 --*/
00428 
00429 {
00430     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>  Thread  = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00431     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o1">Process</a>;
00432 
00433 <span class="preprocessor">#if !defined(NT_UP)    </span>
00434 <span class="preprocessor"></span>    KiAcquireSpinLock(&amp;KiProfileLock);
00435 <span class="preprocessor">#endif </span>
00436 <span class="preprocessor"></span>
00437     <a class="code" href="../../d1/d9/clock_8c.html#a0">KiProcessProfileList</a>(TrFrame, Source, &amp;Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o1">ProfileListHead</a>);
00438 
00439     <a class="code" href="../../d1/d9/clock_8c.html#a0">KiProcessProfileList</a>(TrFrame, Source, &amp;KiProfileListHead);        
00440 
00441 <span class="preprocessor">#if !defined(NT_UP)    </span>
00442 <span class="preprocessor"></span>    KiAcquireSpinLock(&amp;KiProfileLock);
00443 <span class="preprocessor">#endif </span>
00444 <span class="preprocessor"></span>    <span class="keywordflow">return</span>;
00445 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="clock.c::KeUpdateRunTime" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeUpdateRunTime           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TrFrame</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/clock_8c-source.html#l00208">208</a> of file <a class="el" href="../../d2/d8/clock_8c-source.html">clock.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00575">_KTHREAD::ApcState</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00028">CLOCK_QUANTUM_DECREMENT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d9/d3/intrloc2_8c-source.html#l00030">ExInterlockedIncrementLong()</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00755">_KPROCESS::KernelTime</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00648">_KTHREAD::KernelTime</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00127">KiAdjustDpcThreshold</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00128">KiIdealDpcRate</a>, <a class="el" href="../../d9/d9/cmdat3_8c-source.html#l00125">KiMaximumDpcQueueDepth</a>, <a class="el" href="../../d0/d4/intsupc_8c-source.html#l00159">KiRequestSoftwareInterrupt()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00244">_KAPC_STATE::Process</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00593">_KTHREAD::Quantum</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00756">_KPROCESS::UserTime</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00649">_KTHREAD::UserTime</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/clock_8c-source.html#l00122">KeUpdateSystemTime()</a>.
<p>
<pre class="fragment"><div>00214                    :
00215 
00216     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executed on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor complex.
00217     It's function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to update <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> run time of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread, udpate <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> run
00218     time <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread's process, and decrement <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current thread's quantum.
00219 
00220 Arguments:
00221 
00222     TrFrame - Supplies a pointer to a trap frame.
00223 
00224 Return Value:
00225 
00226     None.
00227 
00228 --*/
00229 
00230 {
00231     KSPIN_LOCK <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>;
00232     PKPRCB    Prcb    = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00233     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>  Thread  = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00234     <a class="code" href="../../d5/d7/struct__KPROCESS.html">PKPROCESS</a> Process = Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o14">ApcState</a>.<a class="code" href="../../d3/d5/struct__KAPC__STATE.html#o1">Process</a>;
00235 
00236     <span class="comment">//</span>
00237     <span class="comment">// If thread was executing in user mode:</span>
00238     <span class="comment">//    increment the thread user time.</span>
00239     <span class="comment">//    atomically increment the process user time.</span>
00240     <span class="comment">// else If the old IRQL is greater than the DPC level:</span>
00241     <span class="comment">//         increment the time executing interrupt service routines.</span>
00242     <span class="comment">//      else If the old IRQL is less than the DPC level or If a DPC is not active:</span>
00243     <span class="comment">//              increment the thread kernel time.</span>
00244     <span class="comment">//              atomically increment the process kernel time.</span>
00245     <span class="comment">//      else</span>
00246     <span class="comment">//              increment time executing DPC routines.</span>
00247     <span class="comment">//</span>
00248 
00249     <span class="keywordflow">if</span> (TrFrame-&gt;PreviousMode != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00250         ++Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o55">UserTime</a>;
00251 
00252         <span class="comment">// Atomic Update of Process User Time required.</span>
00253         <a class="code" href="../../d8/d4/intrloc2_8c.html#a0">ExInterlockedIncrementLong</a>(&amp;Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o5">UserTime</a>, &amp;Lock);
00254 
00255         <span class="comment">// Update the time spent in user mode for the current processor.</span>
00256         ++Prcb-&gt;UserTime;           
00257     } <span class="keywordflow">else</span> {
00258 
00259         <span class="keywordflow">if</span> (TrFrame-&gt;OldIrql &gt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) {
00260             ++Prcb-&gt;InterruptTime;
00261         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((TrFrame-&gt;OldIrql &lt; <a class="code" href="../../d6/d7/halmips_8h.html#a53">DISPATCH_LEVEL</a>) || 
00262                    (Prcb-&gt;DpcRoutineActive == 0)) {
00263             ++Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o54">KernelTime</a>;
00264             <a class="code" href="../../d8/d4/intrloc2_8c.html#a0">ExInterlockedIncrementLong</a>(&amp;Process-&gt;<a class="code" href="../../d5/d7/struct__KPROCESS.html#o4">KernelTime</a>, &amp;Lock);
00265         } <span class="keywordflow">else</span> {
00266             ++Prcb-&gt;DpcTime;
00267         }
00268 
00269         <span class="comment">//</span>
00270         <span class="comment">// Update the time spent in kernel mode for the current processor.</span>
00271         <span class="comment">//</span>
00272 
00273         ++Prcb-&gt;KernelTime;         
00274     }
00275 
00276     <span class="comment">// </span>
00277     <span class="comment">// Update the DPC request rate which is computed as the average between the</span>
00278     <span class="comment">// previous rate and the current rate. </span>
00279     <span class="comment">// Update the DPC last count with the current DPC count.</span>
00280     <span class="comment">//</span>
00281     Prcb-&gt;DpcRequestRate = ((Prcb-&gt;DpcCount - Prcb-&gt;DpcLastCount) + Prcb-&gt;DpcRequestRate) &gt;&gt; 1;
00282     Prcb-&gt;DpcLastCount = Prcb-&gt;DpcCount;
00283 
00284     <span class="comment">//</span>
00285     <span class="comment">// If the DPC queue depth is not zero and a DPC routine is not active.</span>
00286     <span class="comment">//      Request a dispatch interrupt.</span>
00287     <span class="comment">//      Decrement the maximum DPC queue depth.</span>
00288     <span class="comment">//      Reset the threshold counter if appropriate.</span>
00289     <span class="comment">//</span>
00290     <span class="keywordflow">if</span> (Prcb-&gt;DpcQueueDepth != 0 &amp;&amp; Prcb-&gt;DpcRoutineActive == 0) {
00291 
00292         Prcb-&gt;AdjustDpcThreshold = <a class="code" href="../../d8/d0/cmdat3_8c.html#a66">KiAdjustDpcThreshold</a>;
00293 
00294         <span class="comment">// Need to request a DPC interrupt. </span>
00295         <a class="code" href="../../d9/d4/intsupc_8c.html#a3">KiRequestSoftwareInterrupt</a>(DISPATCH_LEVEL);
00296 
00297         <span class="keywordflow">if</span> (Prcb-&gt;DpcRequestRate &lt; <a class="code" href="../../d8/d0/cmdat3_8c.html#a67">KiIdealDpcRate</a> &amp;&amp; Prcb-&gt;MaximumDpcQueueDepth &gt; 1)
00298             --Prcb-&gt;MaximumDpcQueueDepth;
00299     } <span class="keywordflow">else</span> {
00300         <span class="comment">//</span>
00301         <span class="comment">// The DPC queue is empty or a DPC routine is active or a DPC interrupt</span>
00302         <span class="comment">// has been requested. Count down the adjustment threshold and if the count</span>
00303         <span class="comment">// reaches zero, then increment the maximum DPC queue depth but not above</span>
00304         <span class="comment">// the initial value. Also, reset the adjustment threshold value.</span>
00305         <span class="comment">//</span>
00306         --Prcb-&gt;AdjustDpcThreshold;
00307         <span class="keywordflow">if</span> (Prcb-&gt;AdjustDpcThreshold == 0) {
00308             Prcb-&gt;AdjustDpcThreshold = <a class="code" href="../../d8/d0/cmdat3_8c.html#a66">KiAdjustDpcThreshold</a>;
00309             <span class="keywordflow">if</span> (<a class="code" href="../../d8/d0/cmdat3_8c.html#a64">KiMaximumDpcQueueDepth</a> != Prcb-&gt;MaximumDpcQueueDepth)
00310                 ++Prcb-&gt;MaximumDpcQueueDepth;
00311         }    
00312     }
00313 
00314     <span class="comment">//</span>
00315     <span class="comment">// Decrement current thread quantum and determine if quantum end has occurred.</span>
00316     <span class="comment">//</span>
00317     Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o27">Quantum</a> -= <a class="code" href="../../d4/d9/ke_8h.html#a0">CLOCK_QUANTUM_DECREMENT</a>;
00318 
00319     <span class="comment">// Set quantum end if time expired, for any thread except idle thread. </span>
00320     <span class="keywordflow">if</span> (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o27">Quantum</a> == 0 &amp;&amp; Thread != Prcb-&gt;IdleThread)  {
00321         
00322         Prcb-&gt;QuantumEnd = 1;
00323 
00324         <span class="comment">// Need to request a DPC interrupt. </span>
00325         <a class="code" href="../../d9/d4/intsupc_8c.html#a3">KiRequestSoftwareInterrupt</a>(DISPATCH_LEVEL);
00326     }
00327 
00328 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="clock.c::KeUpdateSystemTime" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeUpdateSystemTime           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Increment</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/clock_8c-source.html#l00122">122</a> of file <a class="el" href="../../d2/d8/clock_8c-source.html">clock.c</a>.
<p>
References <a class="el" href="../../d7/d3/rtl_2random_8c-source.html#l00032">Increment</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02774">KeMaximumIncrement</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02797">KeTickCount</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02812">KeTimeAdjustment</a>, <a class="el" href="../../d2/d8/clock_8c-source.html#l00208">KeUpdateRunTime()</a>, <a class="el" href="../../d2/d8/clock_8c-source.html#l00038">KiChkTimerExpireSysDpc()</a>, and <a class="el" href="../../d1/d9/ki_8h-source.html#l01139">KiTickOffset</a>.
<p>
<pre class="fragment"><div>00129                    :
00130 
00131     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executed on a single processor in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor complex.
00132     It's function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to update <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system time and to check to determine <span class="keywordflow">if</span> a
00133     timer has expired.
00134 
00135     N.B. This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executed on a single processor in a multiprocess system.
00136     The remainder of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> complex execute <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> quantum end and 
00137     runtime update code.
00138 
00139 Arguments:
00140 
00141     TrFrame   - Supplies a pointer to a trap frame.
00142 
00143     <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a> - The time increment to be used to adjust <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> time slice <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> next
00144                 tick. The value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> supplied in 100ns units.
00145 
00146 Return Value:
00147 
00148     None.
00149 
00150 --*/
00151 
00152 {
00153     <span class="keywordtype">long</span>       SaveTickOffset;
00154     LARGE_INTEGER SystemTime;
00155 
00156     SharedUserData-&gt;InterruptTime += <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a>;
00157     SharedUserData-&gt;InterruptHigh2Time = (LONG)(SharedUserData-&gt;InterruptTime &gt;&gt; 32);
00158     <a class="code" href="../../d0/d0/ki_8h.html#a66">KiTickOffset</a>                  -= <a class="code" href="../../d6/d4/rtl_2random_8c.html#a1">Increment</a>;
00159 
00160     SaveTickOffset = <a class="code" href="../../d0/d0/ki_8h.html#a66">KiTickOffset</a>;
00161 
00162     <span class="keywordflow">if</span> ((LONG)<a class="code" href="../../d0/d0/ki_8h.html#a66">KiTickOffset</a> &gt; 0)
00163     {
00164         <span class="comment">//</span>
00165         <span class="comment">// Tick has not completed (100ns time units remain).</span>
00166         <span class="comment">//</span>
00167         <span class="comment">// Determine if a timer has expired at the current hand value.</span>
00168         <span class="comment">//</span>
00169 
00170         <a class="code" href="../../d1/d9/clock_8c.html#a1">KiChkTimerExpireSysDpc</a>(KeTickCount); 
00171 
00172     } <span class="keywordflow">else</span> {
00173 
00174         <span class="comment">//</span>
00175         <span class="comment">// Tick has completed, tick count set to maximum increase plus any </span>
00176         <span class="comment">// residue and system time is updated.</span>
00177         <span class="comment">//</span>
00178         <span class="comment">// Compute next tick offset.</span>
00179         <span class="comment">//</span>
00180 
00181         <a class="code" href="../../d0/d0/ki_8h.html#a66">KiTickOffset</a> += <a class="code" href="../../d4/d9/ke_8h.html#a131">KeMaximumIncrement</a>;
00182         SystemTime.HighPart = SharedUserData-&gt;SystemHigh1Time;
00183         SystemTime.LowPart  = SharedUserData-&gt;SystemLowTime;
00184         SystemTime.QuadPart += <a class="code" href="../../d4/d9/ke_8h.html#a152">KeTimeAdjustment</a>;
00185         SharedUserData-&gt;SystemHigh1Time = SystemTime.HighPart;
00186         SharedUserData-&gt;SystemLowTime = SystemTime.LowPart;
00187         SharedUserData-&gt;SystemHigh2Time = SystemTime.HighPart;
00188         ++<a class="code" href="../../d4/d9/ke_8h.html#a147">KeTickCount</a>;
00189         SharedUserData-&gt;TickCountLow = (ULONG)<a class="code" href="../../d4/d9/ke_8h.html#a147">KeTickCount</a>;
00190 
00191         <span class="comment">//</span>
00192         <span class="comment">// Determine if a timer has expired at either the current hand value or </span>
00193         <span class="comment">// the next hand value.</span>
00194         <span class="comment">//</span>
00195 
00196         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d9/clock_8c.html#a1">KiChkTimerExpireSysDpc</a>(KeTickCount - 1))
00197             <a class="code" href="../../d1/d9/clock_8c.html#a1">KiChkTimerExpireSysDpc</a>(KeTickCount);
00198 
00199     }
00200 
00201     <span class="keywordflow">if</span> (SaveTickOffset &lt;= 0) {
00202         <a class="code" href="../../d1/d9/clock_8c.html#a3">KeUpdateRunTime</a>(TrFrame);
00203     }
00204 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="clock.c::KiChkTimerExpireSysDpc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN KiChkTimerExpireSysDpc           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONGLONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>TickCount</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/clock_8c-source.html#l00038">38</a> of file <a class="el" href="../../d2/d8/clock_8c-source.html">clock.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00335">_KDPC::DpcListEntry</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00523">_KTIMER::DueTime</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d0/d4/intsupc_8c-source.html#l00159">KiRequestSoftwareInterrupt()</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00497">KiTimerExpireDpc</a>, <a class="el" href="../../d6/d8/kernldat_8c-source.html#l00059">KiTimerTableListHead</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00340">_KDPC::Lock</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d9/ke_8h.html#a97">PKTIMER</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00338">_KDPC::SystemArgument1</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00339">_KDPC::SystemArgument2</a>, <a class="el" href="../../d7/d7/lh__open_2pi__tick_8c-source.html#l00055">TickCount()</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00094">TIMER_TABLE_SIZE</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/clock_8c-source.html#l00122">KeUpdateSystemTime()</a>.
<p>
<pre class="fragment"><div>00044                    :
00045 
00046     This routine determines <span class="keywordflow">if</span> <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> should attempt to place a timer expiration DPC 
00047     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system DPC list and to drive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DPC by initiating a dispatch level interrupt 
00048     on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current processor.
00049 
00050     N.B. If DPC <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already inserted on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> DPC list, we're done.
00051 
00052 Arguments:
00053 
00054     <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a> - The lower tick count, timer table hand value
00055 
00056 Return Value:
00057 
00058     BOOLEAN - Set to <span class="keyword">true</span> <span class="keywordflow">if</span> Queued DPC or <span class="keywordflow">if</span> DPC already Queued.
00059 
00060 --*/
00061 
00062 {
00063     BOOLEAN     ret = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;    <span class="comment">// No DPC queued, default return value.</span>
00064 
00065     PLIST_ENTRY ListHead = &amp;<a class="code" href="../../d5/d9/kernldat_8c.html#a3">KiTimerTableListHead</a>[(ULONG)<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>%<a class="code" href="../../d4/d9/ke_8h.html#a10">TIMER_TABLE_SIZE</a>];
00066     PLIST_ENTRY NextEntry = ListHead-&gt;Flink;
00067 
00068     <span class="comment">//</span>
00069     <span class="comment">// Check to see if the list is empty.</span>
00070     <span class="comment">//</span>
00071     <span class="keywordflow">if</span> (NextEntry != ListHead) {
00072         <a class="code" href="../../d3/d8/struct__KTIMER.html">PKTIMER</a>   Timer = CONTAINING_RECORD(NextEntry, <a class="code" href="../../d3/d8/struct__KTIMER.html">KTIMER</a>, TimerListEntry);
00073         ULONGLONG TimeValue = Timer-&gt;<a class="code" href="../../d3/d8/struct__KTIMER.html#o1">DueTime</a>.QuadPart;
00074 
00075         <span class="comment">//</span>
00076         <span class="comment">// See if timer expired.</span>
00077         <span class="comment">//</span>
00078 
00079         <span class="keywordflow">if</span> (TimeValue &lt;= SharedUserData-&gt;InterruptTime) {
00080     
00081             PKPRCB Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00082             <a class="code" href="../../d1/d6/struct__KDPC.html">PKDPC</a>  Dpc  = &amp;<a class="code" href="../../d5/d9/kernldat_8c.html#a58">KiTimerExpireDpc</a>;
00083 
00084             _disable();
00085 <span class="preprocessor">#if !defined(NT_UP)    </span>
00086 <span class="preprocessor"></span>            KiAcquireSpinLock(&amp;Prcb-&gt;DpcLock);
00087 <span class="preprocessor">#endif </span>
00088 <span class="preprocessor"></span>            <span class="comment">//</span>
00089             <span class="comment">// Insert DPC only if not already inserted.</span>
00090             <span class="comment">//</span>
00091             <span class="keywordflow">if</span> (Dpc-&gt;<a class="code" href="../../d1/d6/struct__KDPC.html#o8">Lock</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00092 
00093                 <span class="comment">//</span>
00094                 <span class="comment">// Put timer expiration DPC in the system DPC list and initiate</span>
00095                 <span class="comment">// a dispatch interrupt on the current processor.</span>
00096                 <span class="comment">//</span>
00097 
00098                 Prcb-&gt;DpcCount += 1;
00099                 Prcb-&gt;DpcQueueDepth += 1;
00100                 Dpc-&gt;<a class="code" href="../../d1/d6/struct__KDPC.html#o8">Lock</a> = &amp;Prcb-&gt;DpcLock;
00101                 Dpc-&gt;<a class="code" href="../../d1/d6/struct__KDPC.html#o6">SystemArgument1</a> = (PVOID)<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a7">TickCount</a>;
00102                 Dpc-&gt;<a class="code" href="../../d1/d6/struct__KDPC.html#o7">SystemArgument2</a> = 0;
00103                 InsertTailList(&amp;Prcb-&gt;DpcListHead, &amp;Dpc-&gt;<a class="code" href="../../d1/d6/struct__KDPC.html#o3">DpcListEntry</a>);
00104                 <a class="code" href="../../d9/d4/intsupc_8c.html#a3">KiRequestSoftwareInterrupt</a>(DISPATCH_LEVEL);
00105             }
00106 
00107             ret = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00108 
00109 <span class="preprocessor">#if !defined(NT_UP)    </span>
00110 <span class="preprocessor"></span>            KiReleaseSpinLock(&amp;Prcb-&gt;DpcLock);
00111 <span class="preprocessor">#endif </span>
00112 <span class="preprocessor"></span>
00113             _enable();
00114         }
00115     }
00116 
00117     <span class="keywordflow">return</span>(ret);
00118 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="clock.c::KiDecrementQuantum" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiDecrementQuantum           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/clock_8c-source.html#l00332">332</a> of file <a class="el" href="../../d2/d8/clock_8c-source.html">clock.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00028">CLOCK_QUANTUM_DECREMENT</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00070">KeGetCurrentThread</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00593">_KTHREAD::Quantum</a>.
<p>
<pre class="fragment"><div>00337                    :
00338 
00339     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executed on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor complex.
00340     Decrement current thread quantum and check to determine <span class="keywordflow">if</span> a quantum end
00341     has occurred.
00342 
00343 Arguments:
00344 
00345     None.
00346 
00347 Return Value:
00348 
00349     None.
00350 
00351 --*/
00352 
00353 {
00354     <a class="code" href="../../d1/d8/struct__KTHREAD.html">PKTHREAD</a>  Thread  = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a3">KeGetCurrentThread</a>();
00355     PKPRCB    Prcb    = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00356 
00357     Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o27">Quantum</a> -= <a class="code" href="../../d4/d9/ke_8h.html#a0">CLOCK_QUANTUM_DECREMENT</a>;
00358 
00359     <span class="comment">// Set quantum end if time expired, for any thread except idle thread. </span>
00360     <span class="keywordflow">if</span> (Thread-&gt;<a class="code" href="../../d1/d8/struct__KTHREAD.html#o27">Quantum</a> == 0 &amp;&amp; Thread != Prcb-&gt;IdleThread) 
00361         Prcb-&gt;QuantumEnd = 1;
00362 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="clock.c::KiProcessProfileList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiProcessProfileList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PKTRAP_FRAME&nbsp;</td>
          <td class="mdname" nowrap> <em>TrFrame</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN KPROFILE_SOURCE&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLIST_ENTRY&nbsp;</td>
          <td class="mdname" nowrap> <em>ListHead</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d8/clock_8c-source.html#l00449">449</a> of file <a class="el" href="../../d2/d8/clock_8c-source.html">clock.c</a>.
<p>
References <a class="el" href="../../d5/d8/ke_8h-source.html#l00793">_KPROFILE::Affinity</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00790">_KPROFILE::BucketShift</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00791">_KPROFILE::Buffer</a>, <a class="el" href="../../d3/d6/alpha_2kdpcpu_8h-source.html#l00069">KeGetCurrentPrcb</a>, <a class="el" href="../../d4/d9/ke_8h.html#a105">KPROFILE</a>, <a class="el" href="../../d4/d9/ke_8h.html#a106">PKPROFILE</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00788">_KPROFILE::RangeBase</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l00789">_KPROFILE::RangeLimit</a>, and <a class="el" href="../../d5/d8/ke_8h-source.html#l00794">_KPROFILE::Source</a>.
<p>
Referenced by <a class="el" href="../../d2/d8/clock_8c-source.html#l00401">KeProfileInterruptWithSource()</a>.
<p>
<pre class="fragment"><div>00456                    :
00457 
00458     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executed on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor complex.
00459     The routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> entered as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> result of an interrupt generated by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> profile
00460     timer. Its function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to update <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> profile information <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> currently
00461     active profile objects.
00462 
00463     N.B. <a class="code" href="../../d1/d9/clock_8c.html#a6">KeProfileInterruptWithSource</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not currently fully implemented by any of
00464          <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> architectures.
00465 
00466 Arguments:
00467 
00468     TrFrame  - Supplies a pointer to a trap frame.
00469 
00470     Source   - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> profile interrupt.
00471 
00472     ListHead - Supplies a pointer to a profile list.
00473 
00474 Return Value:
00475 
00476     None.
00477 
00478 --*/
00479 
00480 {
00481     PLIST_ENTRY NextEntry = ListHead-&gt;Flink;
00482     PKPRCB Prcb = <a class="code" href="../../d2/d7/alpha_2kdpcpu_8h.html#a2">KeGetCurrentPrcb</a>();
00483 
00484     <span class="comment">//</span>
00485     <span class="comment">// Scan profile list and increment profile buckets as appropriate.</span>
00486     <span class="comment">//</span>
00487     <span class="keywordflow">for</span> (; NextEntry != ListHead; NextEntry = NextEntry-&gt;Flink) {
00488 
00489         PCHAR  BucketPter;
00490         PULONG BucketValue;
00491         
00492         <a class="code" href="../../d6/d7/struct__KPROFILE.html">PKPROFILE</a> Profile = CONTAINING_RECORD(NextEntry, <a class="code" href="../../d6/d7/struct__KPROFILE.html">KPROFILE</a>, ProfileListEntry);
00493 
00494         <span class="keywordflow">if</span> (Profile-&gt;<a class="code" href="../../d6/d7/struct__KPROFILE.html#o10">Source</a> != Source || ((Profile-&gt;<a class="code" href="../../d6/d7/struct__KPROFILE.html#o9">Affinity</a> &amp; Prcb-&gt;SetMember) == 0))
00495             <span class="keywordflow">continue</span>;
00496         
00497         <span class="keywordflow">if</span> ((PVOID)TrFrame-&gt;StIIP &lt; Profile-&gt;<a class="code" href="../../d6/d7/struct__KPROFILE.html#o4">RangeBase</a> || (PVOID)TrFrame-&gt;StIIP &gt; Profile-&gt;<a class="code" href="../../d6/d7/struct__KPROFILE.html#o5">RangeLimit</a>)
00498             <span class="keywordflow">continue</span>;
00499 
00500         BucketPter = (PCHAR)Profile-&gt;<a class="code" href="../../d6/d7/struct__KPROFILE.html#o7">Buffer</a> +
00501                      ((((PCHAR)TrFrame-&gt;StIIP - (PCHAR)Profile-&gt;<a class="code" href="../../d6/d7/struct__KPROFILE.html#o4">RangeBase</a>)
00502                      &gt;&gt; Profile-&gt;<a class="code" href="../../d6/d7/struct__KPROFILE.html#o6">BucketShift</a>) &amp; 0xFFFFFFFC);
00503 
00504         BucketValue = (PULONG) BucketPter;
00505         ++BucketValue;
00506     }   
00507 
00508     <span class="keywordflow">return</span>;
00509 }
}
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:05 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
