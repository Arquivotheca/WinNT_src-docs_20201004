<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: dynres.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>dynres.c</h1><a href="../../d0/d4/dynres_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*************************************************************************</span>
00002 <span class="comment">*</span>
00003 <span class="comment">* dynres.c</span>
00004 <span class="comment">*</span>
00005 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00006 <span class="comment">*</span>
00007 <span class="comment">* WinStation Dynamic display resolution change</span>
00008 <span class="comment">*</span>
00009 <span class="comment">* History:</span>
00010 <span class="comment">* July 25th 1997 v-mohamb Created.</span>
00011 <span class="comment">\***************************************************************************/</span>
00012 
00013 <span class="preprocessor">#include "<a class="code" href="../../d2/d4/w32_2ntuser_2server_2precomp_8h.html">precomp.h</a>"</span>
00014 <span class="preprocessor">#pragma hdrstop</span>
00015 <span class="preprocessor"></span>
00016 <span class="preprocessor">#include "<a class="code" href="../../d0/d0/ntuser_8h.html">ntuser.h</a>"</span>
00017 
00018 <span class="preprocessor">#include &lt;winsta.h&gt;</span>
00019 <span class="preprocessor">#include &lt;wstmsg.h&gt;</span>
00020 
00021 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00022 <a class="code" href="../../d0/d4/dynres_8c.html#a0">DrChangeDisplaySettings</a>(WINSTATIONDORECONNECTMSG *pDoReconnectMessage);
00023 
00024 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00025 <a class="code" href="../../d0/d4/dynres_8c.html#a1">DrGetDeviceName</a>(OUT PUNICODE_STRING pustrDeviceName,
00026                 WINSTATIONDORECONNECTMSG *pDoReconnectMessage);
00027 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
00028 <a class="code" href="../../d0/d4/dynres_8c.html#a2">DrSetDevMode</a>(WINSTATIONDORECONNECTMSG *pDoReconnectMessage,
00029              PDEVMODEW pDevmodew);
00030 
00031 
00032 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00033"></a><a class="code" href="../../d2/d8/api_8c.html#a25">00033</a> <a class="code" href="../../d0/d4/dynres_8c.html#a0">DrChangeDisplaySettings</a>(
00034     WINSTATIONDORECONNECTMSG *pDoReconnectMessage)
00035 {
00036     DEVMODEW devmodew;
00037     UNICODE_STRING ustrDeviceName;
00038     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00039 
00040 
00041     <span class="comment">//BUGBUG Reconnecting at a resolution different than the orignal connection</span>
00042     <span class="comment">// is not functional on Hydra 5</span>
00043     <span class="keywordflow">return</span> STATUS_NOT_IMPLEMENTED;
00044 
00045 <span class="preprocessor">#if DBG</span>
00046 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\nDrChangeDisplaySettings - Entering...\n"</span>);
00047 <span class="preprocessor">#endif</span>
00048 <span class="preprocessor"></span>
00049     <span class="comment">// Setup DEVMODE for Display settings change</span>
00050 
00051     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d4/dynres_8c.html#a2">DrSetDevMode</a>(pDoReconnectMessage, &amp;devmodew);
00052 
00053     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>))
00054         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00055 
00056     <span class="comment">// Get device name from reconnect message</span>
00057 
00058     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d0/d4/dynres_8c.html#a1">DrGetDeviceName</a>(&amp;ustrDeviceName,pDoReconnectMessage);
00059 
00060     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>))
00061         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00062 
00063     <span class="comment">// Change display settings for every desktop</span>
00064 
00065     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d9/d9/kernel_2ntstubs_8c.html#a322">NtUserChangeDisplaySettings</a>(&amp;ustrDeviceName,
00066                                          &amp;devmodew,
00067                                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00068                                          (CDS_RESET | CDS_GLOBAL),
00069                                          <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00070 
00071     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00072 }
00073 
00074 
00075 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00076"></a><a class="code" href="../../d0/d4/dynres_8c.html#a1">00076</a> <a class="code" href="../../d0/d4/dynres_8c.html#a1">DrGetDeviceName</a>(
00077     OUT PUNICODE_STRING pustrDeviceName,
00078     WINSTATIONDORECONNECTMSG *pDoReconnectMessage)
00079 {
00080     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00081 
00082     pDoReconnectMessage;
00083 
00084     <span class="comment">// Get Device name from reconnect message ( LATTER )</span>
00085     <span class="comment">// for now, just use a static name for device</span>
00086 
00087     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>(pustrDeviceName, DR_RECONNECT_DEVICE_NAMEW);
00088 
00089 <span class="preprocessor">#if DBG</span>
00090 <span class="preprocessor"></span>    <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"DrGetDeviceName - Device name is : %ws\n"</span>, pustrDeviceName-&gt;Buffer);
00091 <span class="preprocessor">#endif</span>
00092 <span class="preprocessor"></span>
00093     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00094 }
00095 
00096 <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a>
<a name="l00097"></a><a class="code" href="../../d0/d4/dynres_8c.html#a2">00097</a> <a class="code" href="../../d0/d4/dynres_8c.html#a2">DrSetDevMode</a>(
00098     WINSTATIONDORECONNECTMSG *pDoReconnectMessage,
00099     PDEVMODEW pDevmodew)
00100 {
00101     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = STATUS_SUCCESS;
00102 
00103     <span class="comment">// Initialize unused fields</span>
00104 
00105     RtlZeroMemory(pDevmodew, <span class="keyword">sizeof</span>(DEVMODEW));
00106 
00107     <span class="comment">// Get Display resolution data from reconnect data</span>
00108 
00109     pDevmodew-&gt;dmPelsHeight = pDoReconnectMessage-&gt;VRes;
00110     pDevmodew-&gt;dmPelsWidth  = pDoReconnectMessage-&gt;HRes;
00111     pDevmodew-&gt;dmBitsPerPel = pDoReconnectMessage-&gt;ColorDepth;
00112     pDevmodew-&gt;dmFields     = DM_BITSPERPEL  | DM_PELSWIDTH  | DM_PELSHEIGHT;
00113     pDevmodew-&gt;dmSize       = <span class="keyword">sizeof</span>(DEVMODEW);
00114 
00115     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00116 }
00117 
00118 
00119 
00120 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:47 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
