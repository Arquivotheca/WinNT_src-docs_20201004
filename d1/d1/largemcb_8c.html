<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: largemcb.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>largemcb.c File Reference</h1><code>#include "FsRtlP.h"</code><br>

<p>
<a href="../../d2/d0/largemcb_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d8/d6/struct__MAPPING.html">_MAPPING</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">_NONOPAQUE_MCB</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a0">Dbg</a>&nbsp;&nbsp;&nbsp;(0x80000000)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>&nbsp;&nbsp;&nbsp;(-1)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a2">SizeOfMapping</a>(<a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>)&nbsp;&nbsp;&nbsp;((sizeof(<a class="el" href="../../d8/d6/struct__MAPPING.html">MAPPING</a>) * (<a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>)-&gt;MaximumPairCount))</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a3">PreviousEndingVbn</a>(<a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>, I)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(<a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>, I)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(<a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>, I)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a6">NextStartingVbn</a>(<a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>, I)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a7">PreviousEndingLbn</a>(<a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>, I)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(<a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>, I)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a9">EndingLbn</a>(<a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>, I)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a10">NextStartingLbn</a>(<a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>, I)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a11">SectorsWithinRun</a>(<a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>, I)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a12">MODULE_POOL_TAG</a>&nbsp;&nbsp;&nbsp;('mrSF')</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a13">FsRtlAllocateFirstMapping</a>()&nbsp;&nbsp;&nbsp;(PVOID)ExAllocateFromPagedLookasideList( &amp;<a class="el" href="../../d1/d1/largemcb_8c.html#a22">FsRtlFirstMappingLookasideList</a> )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a14">FsRtlFreeFirstMapping</a>(Mapping)&nbsp;&nbsp;&nbsp;ExFreeToPagedLookasideList( &amp;<a class="el" href="../../d1/d1/largemcb_8c.html#a22">FsRtlFirstMappingLookasideList</a>, (Mapping) )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a15">FsRtlAllocateFastMutex</a>()&nbsp;&nbsp;&nbsp;(<a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a>)ExAllocateFromNPagedLookasideList( &amp;<a class="el" href="../../d1/d1/largemcb_8c.html#a23">FsRtlFastMutexLookasideList</a> )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a16">FsRtlFreeFastMutex</a>(FastMutex)&nbsp;&nbsp;&nbsp;ExFreeToNPagedLookasideList( &amp;<a class="el" href="../../d1/d1/largemcb_8c.html#a23">FsRtlFastMutexLookasideList</a>, (FastMutex) )</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a17">INITIAL_MAXIMUM_PAIR_COUNT</a>&nbsp;&nbsp;&nbsp;(15)</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d6/struct__MAPPING.html">_MAPPING</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a18">MAPPING</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d8/d6/struct__MAPPING.html">MAPPING</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a19">PMAPPING</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">_NONOPAQUE_MCB</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a20">NONOPAQUE_MCB</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">NONOPAQUE_MCB</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a21">PNONOPAQUE_MCB</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a24">FsRtlRemoveMcbEntryPrivate</a> (IN <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> OpaqueMcb, IN ULONG Vbn, IN ULONG SectorCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a25">FsRtlFindLargeIndex</a> (IN <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb, IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> Vbn, OUT PULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a26">FsRtlAddLargeEntry</a> (IN <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb, IN ULONG WhereToAddIndex, IN ULONG AmountToAdd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a27">FsRtlRemoveLargeEntry</a> (IN <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb, IN ULONG WhereToRemoveIndex, IN ULONG AmountToRemove)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a28">FsRtlInitializeMcb</a> (IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a> Mcb, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a29">FsRtlUninitializeMcb</a> (IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a> Mcb)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a30">FsRtlTruncateMcb</a> (IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a> Mcb, IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> Vbn)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a31">FsRtlAddMcbEntry</a> (IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a> Mcb, IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> Vbn, IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a> Lbn, IN ULONG SectorCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a32">FsRtlRemoveMcbEntry</a> (IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a> OpaqueMcb, IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> Vbn, IN ULONG SectorCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a33">FsRtlLookupMcbEntry</a> (IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a> Mcb, IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> Vbn, OUT <a class="el" href="../../d1/d8/fsrtl_8h.html#a51">PLBN</a> Lbn, OUT PULONG SectorCount OPTIONAL, OUT PULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a> OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a34">FsRtlLookupLastMcbEntry</a> (IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a> Mcb, OUT <a class="el" href="../../d1/d8/fsrtl_8h.html#a53">PVBN</a> Vbn, OUT <a class="el" href="../../d1/d8/fsrtl_8h.html#a51">PLBN</a> Lbn)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a35">FsRtlNumberOfRunsInMcb</a> (IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a> Mcb)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a36">FsRtlGetNextMcbEntry</a> (IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a> Mcb, IN ULONG RunIndex, OUT <a class="el" href="../../d1/d8/fsrtl_8h.html#a53">PVBN</a> Vbn, OUT <a class="el" href="../../d1/d8/fsrtl_8h.html#a51">PLBN</a> Lbn, OUT PULONG SectorCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a37">FsRtlInitializeLargeMcbs</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a38">FsRtlInitializeLargeMcb</a> (IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a> OpaqueMcb, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a39">FsRtlUninitializeLargeMcb</a> (IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a> OpaqueMcb)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a40">FsRtlTruncateLargeMcb</a> (IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a> OpaqueMcb, IN LONGLONG LargeVbn)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTKERNELAPI VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a41">FsRtlResetLargeMcb</a> (IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a> OpaqueMcb, IN BOOLEAN SelfSynchronized)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a42">FsRtlAddLargeMcbEntry</a> (IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a> OpaqueMcb, IN LONGLONG LargeVbn, IN LONGLONG LargeLbn, IN LONGLONG LargeSectorCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a43">FsRtlRemoveLargeMcbEntry</a> (IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a> OpaqueMcb, IN LONGLONG LargeVbn, IN LONGLONG LargeSectorCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a44">FsRtlLookupLargeMcbEntry</a> (IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a> OpaqueMcb, IN LONGLONG LargeVbn, OUT PLONGLONG LargeLbn OPTIONAL, OUT PLONGLONG LargeSectorCount OPTIONAL, OUT PLONGLONG LargeStartingLbn OPTIONAL, OUT PLONGLONG LargeCountFromStartingLbn OPTIONAL, OUT PULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a> OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a45">FsRtlLookupLastLargeMcbEntry</a> (IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a> OpaqueMcb, OUT PLONGLONG LargeVbn, OUT PLONGLONG LargeLbn)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a46">FsRtlLookupLastLargeMcbEntryAndIndex</a> (IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a> OpaqueMcb, OUT PLONGLONG LargeVbn, OUT PLONGLONG LargeLbn, OUT PULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a47">FsRtlNumberOfRunsInLargeMcb</a> (IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a> OpaqueMcb)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a48">FsRtlGetNextLargeMcbEntry</a> (IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a> OpaqueMcb, IN ULONG RunIndex, OUT PLONGLONG LargeVbn, OUT PLONGLONG LargeLbn, OUT PLONGLONG LargeSectorCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a49">FsRtlSplitLargeMcb</a> (IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a> OpaqueMcb, IN LONGLONG LargeVbn, IN LONGLONG LargeAmount)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PAGED_LOOKASIDE_LIST</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a22">FsRtlFirstMappingLookasideList</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">NPAGED_LOOKASIDE_LIST</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d1/largemcb_8c.html#a23">FsRtlFastMutexLookasideList</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="largemcb.c::Dbg" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define Dbg&nbsp;&nbsp;&nbsp;(0x80000000)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00084">84</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="largemcb.c::EndingLbn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EndingLbn          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>I&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                                       \
    (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)(<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>,I) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> ?                     \
          <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> :                                           \
          ((<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>)-&gt;Mapping[(I)].Lbn +                             \
           (<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>)-&gt;Mapping[(I)].NextVbn - <a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>,I) - 1) \
         )                                                       \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00214">214</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01763">FsRtlLookupLastLargeMcbEntry()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01841">FsRtlLookupLastLargeMcbEntryAndIndex()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="largemcb.c::EndingVbn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define EndingVbn          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>I&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                     \
    (<a class="code" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a>)((((<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>)-&gt;Mapping)[(I)].NextVbn) - 1) \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00195">195</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02748">FsRtlFindLargeIndex()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01600">FsRtlLookupLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01763">FsRtlLookupLastLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01841">FsRtlLookupLastLargeMcbEntryAndIndex()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="largemcb.c::FsRtlAllocateFastMutex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FsRtlAllocateFastMutex          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(<a class="el" href="../../d6/d9/struct__FAST__MUTEX.html">PFAST_MUTEX</a>)ExAllocateFromNPagedLookasideList( &amp;<a class="el" href="../../d1/d1/largemcb_8c.html#a23">FsRtlFastMutexLookasideList</a> )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00295">295</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00572">FsRtlInitializeLargeMcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="largemcb.c::FsRtlAllocateFirstMapping" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FsRtlAllocateFirstMapping          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;(PVOID)ExAllocateFromPagedLookasideList( &amp;<a class="el" href="../../d1/d1/largemcb_8c.html#a22">FsRtlFirstMappingLookasideList</a> )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00289">289</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00572">FsRtlInitializeLargeMcb()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00743">FsRtlTruncateLargeMcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="largemcb.c::FsRtlFreeFastMutex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FsRtlFreeFastMutex          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">FastMutex&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExFreeToNPagedLookasideList( &amp;<a class="el" href="../../d1/d1/largemcb_8c.html#a23">FsRtlFastMutexLookasideList</a>, (FastMutex) )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00298">298</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00572">FsRtlInitializeLargeMcb()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00670">FsRtlUninitializeLargeMcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="largemcb.c::FsRtlFreeFirstMapping" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FsRtlFreeFirstMapping          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">Mapping&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;ExFreeToPagedLookasideList( &amp;<a class="el" href="../../d1/d1/largemcb_8c.html#a22">FsRtlFirstMappingLookasideList</a>, (Mapping) )</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00292">292</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02852">FsRtlAddLargeEntry()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00670">FsRtlUninitializeLargeMcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="largemcb.c::INITIAL_MAXIMUM_PAIR_COUNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define INITIAL_MAXIMUM_PAIR_COUNT&nbsp;&nbsp;&nbsp;(15)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00313">313</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02852">FsRtlAddLargeEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00572">FsRtlInitializeLargeMcb()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00521">FsRtlInitializeLargeMcbs()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00743">FsRtlTruncateLargeMcb()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00670">FsRtlUninitializeLargeMcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="largemcb.c::MODULE_POOL_TAG" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MODULE_POOL_TAG&nbsp;&nbsp;&nbsp;('mrSF')          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00251">251</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="largemcb.c::NextStartingLbn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NextStartingLbn          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>I&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                                             \
    (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)((I) &gt;= (<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>)-&gt;PairCount - 1 ? <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> : <a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>,(I)+1)) \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00222">222</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="largemcb.c::NextStartingVbn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NextStartingVbn          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>I&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                                \
    (<a class="code" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a>)((I) &gt;= (<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>)-&gt;PairCount ? 0 : <a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>,(I)+1)) \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00199">199</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00743">FsRtlTruncateLargeMcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="largemcb.c::PreviousEndingLbn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PreviousEndingLbn          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>I&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                      \
    (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)((I) == 0 ? <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> : <a class="code" href="../../d1/d1/largemcb_8c.html#a9">EndingLbn</a>(<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>,(I)-1)) \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00206">206</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02066">FsRtlSplitLargeMcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="largemcb.c::PreviousEndingVbn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PreviousEndingVbn          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>I&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                      \
    (<a class="code" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a>)((I) == 0 ? 0xffffffff : <a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>,(I)-1)) \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00187">187</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="largemcb.c::SectorsWithinRun" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SectorsWithinRun          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>I&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                      \
    (ULONG)(<a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>,I) - <a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>,I) + 1) \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00242">242</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01970">FsRtlGetNextLargeMcbEntry()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="largemcb.c::SizeOfMapping" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SizeOfMapping          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((sizeof(<a class="el" href="../../d8/d6/struct__MAPPING.html">MAPPING</a>) * (<a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>)-&gt;MaximumPairCount))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00170">170</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="largemcb.c::StartingLbn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define StartingLbn          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>I&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(         \
    (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)(((<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>)-&gt;Mapping)[(I)].Lbn) \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00210">210</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01970">FsRtlGetNextLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01600">FsRtlLookupLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02066">FsRtlSplitLargeMcb()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00743">FsRtlTruncateLargeMcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="largemcb.c::StartingVbn" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define StartingVbn          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d2/d7/struct__MCB.html">MCB</a>,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>I&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                                \
    (<a class="code" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a>)((I) == 0 ? 0 : (((<a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>)-&gt;Mapping))[(I)-1].NextVbn) \
)
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00191">191</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02748">FsRtlFindLargeIndex()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01970">FsRtlGetNextLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01600">FsRtlLookupLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02066">FsRtlSplitLargeMcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="largemcb.c::UNUSED_LBN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define UNUSED_LBN&nbsp;&nbsp;&nbsp;(-1)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00149">149</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01970">FsRtlGetNextLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01600">FsRtlLookupLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01763">FsRtlLookupLastLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01841">FsRtlLookupLastLargeMcbEntryAndIndex()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02066">FsRtlSplitLargeMcb()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00743">FsRtlTruncateLargeMcb()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a18" doxytag="largemcb.c::MAPPING" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d8/d6/struct__MAPPING.html">_MAPPING</a>  <a class="el" href="../../d8/d6/struct__MAPPING.html">MAPPING</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02852">FsRtlAddLargeEntry()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="largemcb.c::NONOPAQUE_MCB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">_NONOPAQUE_MCB</a>  <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">NONOPAQUE_MCB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="largemcb.c::PMAPPING" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d8/d6/struct__MAPPING.html">MAPPING</a>* <a class="el" href="../../d8/d6/struct__MAPPING.html">PMAPPING</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00155">155</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02852">FsRtlAddLargeEntry()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00743">FsRtlTruncateLargeMcb()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="largemcb.c::PNONOPAQUE_MCB" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">NONOPAQUE_MCB</a>* <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">164</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01970">FsRtlGetNextLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00572">FsRtlInitializeLargeMcb()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01600">FsRtlLookupLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01763">FsRtlLookupLastLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01841">FsRtlLookupLastLargeMcbEntryAndIndex()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01924">FsRtlNumberOfRunsInLargeMcb()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01528">FsRtlRemoveLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00392">FsRtlRemoveMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00922">FsRtlResetLargeMcb()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02066">FsRtlSplitLargeMcb()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00743">FsRtlTruncateLargeMcb()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00670">FsRtlUninitializeLargeMcb()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a26" doxytag="largemcb.c::FsRtlAddLargeEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlAddLargeEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>WhereToAddIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>AmountToAdd</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02852">2852</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00292">FsRtlFreeFirstMapping</a>, <a class="el" href="../../d4/d7/fsrtlp_8h-source.html#l00040">FsRtlpAllocatePool</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00313">INITIAL_MAXIMUM_PAIR_COUNT</a>, <a class="el" href="../../d1/d1/largemcb_8c.html#a18">MAPPING</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00155">PMAPPING</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02066">FsRtlSplitLargeMcb()</a>.
<p>
<pre class="fragment"><div>02860                    :
02861 
02862     This routine takes a current Mcb and detemines <span class="keywordflow">if</span> there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> enough
02863     room to add <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> mapping entries.  If there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not enough room
02864     <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> reallocates a <span class="keyword">new</span> mcb buffer and copies over <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current mapping.
02865     If also will spread <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current mappings to leave <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
02866     index slots in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping unfilled.  For example, <span class="keywordflow">if</span> WhereToAddIndex
02867     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> equal to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current pair count then we don'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> need to make a hole
02868     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping, but <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> less than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current pair count
02869     then we'll need to slide some of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mappings down to make room
02870     at <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified index.
02871 
02872 Arguments:
02873 
02874     Mcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mcb being checked and modified
02875 
02876     WhereToAddIndex - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of where <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> additional entries
02877         need to be <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a>
02878 
02879     AmountToAdd - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of additional entries needed in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02880         mcb
02881 
02882 Return Value:
02883 
02884     None.
02885 
02886 --*/
02887 
02888 {
02889     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02890 
02891     <span class="comment">//</span>
02892     <span class="comment">//  Check to see if the current buffer is large enough to hold</span>
02893     <span class="comment">//  the additional entries</span>
02894     <span class="comment">//</span>
02895 
02896     <span class="keywordflow">if</span> (Mcb-&gt;PairCount + AmountToAdd &gt; Mcb-&gt;MaximumPairCount) {
02897 
02898         ULONG NewMax;
02899         <a class="code" href="../../d8/d6/struct__MAPPING.html">PMAPPING</a> Mapping;
02900 
02901         <span class="comment">//</span>
02902         <span class="comment">//  We need to allocate a new mapping so compute a new maximum pair</span>
02903         <span class="comment">//  count.  We'll only be asked to grow by at most 2 at a time, so</span>
02904         <span class="comment">//  doubling will definitely make us large enough for the new amount.</span>
02905         <span class="comment">//  But we won't double without bounds we'll stop doubling if the</span>
02906         <span class="comment">//  pair count gets too high.</span>
02907         <span class="comment">//</span>
02908 
02909         <span class="keywordflow">if</span> (Mcb-&gt;MaximumPairCount &lt; 2048) {
02910 
02911             NewMax = Mcb-&gt;MaximumPairCount * 2;
02912 
02913         } <span class="keywordflow">else</span> {
02914 
02915             NewMax = Mcb-&gt;MaximumPairCount + 2048;
02916         }
02917 
02918         Mapping = <a class="code" href="../../d3/d8/fsrtlp_8h.html#a2">FsRtlpAllocatePool</a>( Mcb-&gt;PoolType, <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d6/struct__MAPPING.html">MAPPING</a>) * NewMax );
02919 
02920         <span class="comment">//**** RtlZeroMemory( Mapping, sizeof(MAPPING) * NewMax );</span>
02921 
02922         <span class="comment">//</span>
02923         <span class="comment">//  Now copy over the old mapping to the new buffer</span>
02924         <span class="comment">//</span>
02925 
02926         RtlCopyMemory( Mapping, Mcb-&gt;Mapping, <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d6/struct__MAPPING.html">MAPPING</a>) * Mcb-&gt;PairCount );
02927 
02928         <span class="comment">//</span>
02929         <span class="comment">//  Deallocate the old buffer</span>
02930         <span class="comment">//</span>
02931 
02932         <span class="keywordflow">if</span> ((Mcb-&gt;PoolType == <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>) &amp;&amp; (Mcb-&gt;MaximumPairCount == <a class="code" href="../../d1/d1/largemcb_8c.html#a17">INITIAL_MAXIMUM_PAIR_COUNT</a>)) {
02933 
02934             <a class="code" href="../../d1/d1/largemcb_8c.html#a14">FsRtlFreeFirstMapping</a>( Mcb-&gt;Mapping );
02935 
02936         } <span class="keywordflow">else</span> {
02937 
02938             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( Mcb-&gt;Mapping );
02939         }
02940 
02941         <span class="comment">//</span>
02942         <span class="comment">//  And set up the new buffer in the Mcb</span>
02943         <span class="comment">//</span>
02944 
02945         Mcb-&gt;Mapping = Mapping;
02946         Mcb-&gt;MaximumPairCount = NewMax;
02947     }
02948 
02949     <span class="comment">//</span>
02950     <span class="comment">//  Now see if we need to shift some entries over according to the</span>
02951     <span class="comment">//  WhereToAddIndex value</span>
02952     <span class="comment">//</span>
02953 
02954     <span class="keywordflow">if</span> (WhereToAddIndex &lt; Mcb-&gt;PairCount) {
02955 
02956         RtlMoveMemory( &amp;((Mcb-&gt;Mapping)[WhereToAddIndex + AmountToAdd]),
02957                        &amp;((Mcb-&gt;Mapping)[WhereToAddIndex]),
02958                        (Mcb-&gt;PairCount - WhereToAddIndex) * <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d6/struct__MAPPING.html">MAPPING</a>) );
02959     }
02960 
02961     <span class="comment">//</span>
02962     <span class="comment">//  Now zero out the new additions</span>
02963     <span class="comment">//</span>
02964 
02965     <span class="comment">//**** RtlZeroMemory( &amp;((Mcb-&gt;Mapping)[WhereToAddIndex]), sizeof(MAPPING) * AmountToAdd );</span>
02966 
02967     <span class="comment">//</span>
02968     <span class="comment">//  Now increment the PairCount</span>
02969     <span class="comment">//</span>
02970 
02971     Mcb-&gt;PairCount += AmountToAdd;
02972 
02973     <span class="comment">//</span>
02974     <span class="comment">//  And return to our caller</span>
02975     <span class="comment">//</span>
02976 
02977     <span class="keywordflow">return</span>;
02978 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a42" doxytag="largemcb.c::FsRtlAddLargeMcbEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FsRtlAddLargeMcbEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OpaqueMcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeVbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeLbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeSectorCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">977</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00147">ASSERTMSG</a>, <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00214">EndingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00195">EndingVbn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02852">FsRtlAddLargeEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02748">FsRtlFindLargeIndex()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02986">FsRtlRemoveLargeEntry()</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l00029">LBN</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00162">_NONOPAQUE_MCB::Mapping</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00222">NextStartingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00199">NextStartingVbn</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00160">_NONOPAQUE_MCB::PairCount</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00206">PreviousEndingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00187">PreviousEndingVbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00210">StartingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00191">StartingVbn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02154">try_return</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00149">UNUSED_LBN</a>, and <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l00032">VBN</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00375">FsRtlAddMcbEntry()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l03388">UdfInitializeAllocations()</a>, <a class="el" href="../../d3/d5/allocsup_8c-source.html#l01406">UdfLoadSparingTables()</a>, and <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00997">UdfUpdateVcbPhase1()</a>.
<p>
<pre class="fragment"><div>00986                    :
00987 
00988     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to add a <span class="keyword">new</span> mapping of VBNs to LBNs to an existing
00989     Mcb. The information added will map
00990 
00991         Vbn to Lbn,
00992 
00993         Vbn+1 to Lbn+1,...
00994 
00995         Vbn+(SectorCount-1) to Lbn+(SectorCount-1).
00996 
00997     The mapping <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> VBNs must not already exist in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00998     mapping continues a previous run, then <span class="keyword">this</span> routine will actually coalesce
00999     them into 1 run.
01000 
01001     If <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not available to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information <span class="keyword">this</span> routine will raise a
01002     status value indicating insufficient resources.
01003 
01004     An input Lbn value of zero <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> illegal (i.e., the Mcb structure will never
01005     map a Vbn to a zero Lbn value).
01006 
01007 Arguments:
01008 
01009     OpaqueMcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb in which to add <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> mapping.
01010 
01011     Vbn - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting Vbn of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> mapping run to add to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb.
01012 
01013     Lbn - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting Lbn of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> mapping run to add to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb.
01014 
01015     SectorCount - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> mapping run (in sectors).
01016 
01017 Return Value:
01018 
01019     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping was added successfully (i.e., the <span class="keyword">new</span>
01020         Vbns did not collide with existing Vbns), and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise.  If
01021         <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not changed.
01022 
01023 --*/
01024 
01025 {
01026     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
01027 
01028     <a class="code" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> Vbn = ((ULONG)LargeVbn);
01029     <a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a> Lbn = ((ULONG)LargeLbn);
01030     ULONG SectorCount = ((ULONG)LargeSectorCount);
01031 
01032     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
01033 
01034     <a class="code" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> LastVbn;
01035 
01036     BOOLEAN Result;
01037 
01038     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"LargeInteger not supported yet "</span>, ((PLARGE_INTEGER)&amp;LargeVbn)-&gt;HighPart == 0);
01039     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"LargeInteger not supported yet "</span>, ((PLARGE_INTEGER)&amp;LargeLbn)-&gt;HighPart == 0);
01040     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"LargeInteger not supported yet "</span>, ((PLARGE_INTEGER)&amp;LargeSectorCount)-&gt;HighPart == 0);
01041 
01042     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01043 
01044     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, Dbg, <span class="stringliteral">"FsRtlAddLargeMcbEntry, Mcb = %08lx\n"</span>, Mcb );
01045     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">" Vbn         = %08lx\n"</span>, Vbn );
01046     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">" Lbn         = %08lx\n"</span>, Lbn );
01047     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">" SectorCount = %08lx\n"</span>, SectorCount );
01048 
01049     ExAcquireFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
01050 
01051     <span class="keywordflow">try</span> {
01052 
01053         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a25">FsRtlFindLargeIndex</a>(Mcb, Vbn, &amp;Index)) {
01054 
01055             ULONG EndVbn = Vbn + SectorCount - 1;
01056             ULONG EndIndex;
01057 
01058             <span class="comment">//</span>
01059             <span class="comment">//  First check the case where we are adding to an existing mcb run</span>
01060             <span class="comment">//  and if so then we will modify the insertion to complete the run</span>
01061             <span class="comment">//</span>
01062             <span class="comment">//      --ExistingRun--|      ==becomes==&gt;  --ExistingRun--|</span>
01063             <span class="comment">//              |--NewRun--|                               |---|</span>
01064             <span class="comment">//</span>
01065             <span class="comment">//      --ExistingRun----|    ==becomes==&gt; a noop</span>
01066             <span class="comment">//          |--NewRun--|</span>
01067             <span class="comment">//</span>
01068 
01069             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb, Index) != <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) {
01070 
01071                 <span class="comment">//</span>
01072                 <span class="comment">//  Check that the Lbn's line up between the new and existing run</span>
01073                 <span class="comment">//</span>
01074 
01075                 <span class="keywordflow">if</span> (Lbn != (<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb, Index) + (Vbn - <a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb, Index)))) {
01076 
01077                     <span class="comment">//</span>
01078                     <span class="comment">//  Let our caller know we couldn't insert the run.</span>
01079                     <span class="comment">//</span>
01080 
01081                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>(Result = FALSE);
01082                 }
01083 
01084                 <span class="comment">//</span>
01085                 <span class="comment">//  Check if the new run is contained in the existing run</span>
01086                 <span class="comment">//</span>
01087 
01088                 <span class="keywordflow">if</span> (EndVbn &lt;= <a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb, Index)) {
01089 
01090                     <span class="comment">//</span>
01091                     <span class="comment">//  Do nothing because the run is contained within the existing run</span>
01092                     <span class="comment">//</span>
01093 
01094                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>(Result = TRUE);
01095                 }
01096 
01097                 <span class="comment">//</span>
01098                 <span class="comment">//  Otherwise we will simply trim off the request for the new run</span>
01099                 <span class="comment">//  to not overlap with the existing run</span>
01100                 <span class="comment">//</span>
01101 
01102                 Vbn = <a class="code" href="../../d1/d1/largemcb_8c.html#a6">NextStartingVbn</a>(Mcb, Index);
01103                 Lbn = <a class="code" href="../../d1/d1/largemcb_8c.html#a9">EndingLbn</a>(Mcb, Index) + 1;
01104 
01105                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(EndVbn &gt;= Vbn);
01106 
01107                 SectorCount = EndVbn - Vbn + 1;
01108 
01109             <span class="comment">//</span>
01110             <span class="comment">//  At this point the new run start in a hole, now check that if</span>
01111             <span class="comment">//  crosses into a non hole and if so then adjust new run to fit</span>
01112             <span class="comment">//  in the hole</span>
01113             <span class="comment">//</span>
01114             <span class="comment">//</span>
01115             <span class="comment">//            |--ExistingRun--  ==becomes==&gt;        |--ExistingRun--</span>
01116             <span class="comment">//      |--NewRun--|                          |--New|</span>
01117             <span class="comment">//</span>
01118 
01119             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a25">FsRtlFindLargeIndex</a>(Mcb, EndVbn, &amp;EndIndex) &amp;&amp; (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> == (EndIndex-1))) {
01120 
01121                 <span class="comment">//</span>
01122                 <span class="comment">//  Check that the Lbn's line up in the overlap</span>
01123                 <span class="comment">//</span>
01124 
01125                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb, EndIndex) != Lbn + (<a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb, EndIndex) - Vbn)) {
01126 
01127                     <span class="comment">//</span>
01128                     <span class="comment">//  Let our caller know we couldn't insert the run.</span>
01129                     <span class="comment">//</span>
01130 
01131                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>(Result = FALSE);
01132                 }
01133 
01134                 <span class="comment">//</span>
01135                 <span class="comment">//  Truncate the sector count to go up to but not include</span>
01136                 <span class="comment">//  the existing run</span>
01137                 <span class="comment">//</span>
01138 
01139                 SectorCount = <a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb, EndIndex) - Vbn;
01140             }
01141         }
01142 
01143         <span class="comment">//</span>
01144         <span class="comment">//  Find the index for the starting Vbn of our new run, if there isn't</span>
01145         <span class="comment">//  a hole found then index will be set to paircount.</span>
01146         <span class="comment">//</span>
01147 
01148         <span class="keywordflow">if</span> (((<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a>) == 0) ||
01149             (<a class="code" href="../../d1/d1/largemcb_8c.html#a3">PreviousEndingVbn</a>(Mcb,Index)+1 &lt;= Vbn) ||
01150             !<a class="code" href="../../d1/d1/largemcb_8c.html#a25">FsRtlFindLargeIndex</a>(Mcb, Vbn, &amp;Index)) {
01151 
01152             <span class="comment">//</span>
01153             <span class="comment">//  We didn't find a mapping, therefore this new mapping must</span>
01154             <span class="comment">//  go on at the end of the current mapping.</span>
01155             <span class="comment">//</span>
01156             <span class="comment">//  See if we can just grow the last mapping in the current mcb.</span>
01157             <span class="comment">//  We can grow the last entry if (1) the Vbns follow on, and (2)</span>
01158             <span class="comment">//  the Lbns follow on.  We can only grow the last mapping if the</span>
01159             <span class="comment">//  index is not 0.</span>
01160             <span class="comment">//</span>
01161 
01162             <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> != 0) &amp;&amp;
01163                 (<a class="code" href="../../d1/d1/largemcb_8c.html#a3">PreviousEndingVbn</a>(Mcb,Index) + 1 == Vbn) &amp;&amp;
01164                 (<a class="code" href="../../d1/d1/largemcb_8c.html#a7">PreviousEndingLbn</a>(Mcb,Index) + 1 == Lbn)) {
01165 
01166                 <span class="comment">//</span>
01167                 <span class="comment">//      --LastRun--|---NewRun--|</span>
01168                 <span class="comment">//</span>
01169 
01170                 <span class="comment">//</span>
01171                 <span class="comment">//  Extend the last run in the mcb</span>
01172                 <span class="comment">//</span>
01173 
01174                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Continuing last run\n"</span>, 0);
01175 
01176                 (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a>-1].NextVbn += SectorCount;
01177 
01178                 <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = TRUE);
01179             }
01180 
01181             <span class="comment">//</span>
01182             <span class="comment">//  We couldn't grow the last mapping, now check to see if</span>
01183             <span class="comment">//  this is a continuation of the last Vbn (i.e., there isn't</span>
01184             <span class="comment">//  going to be a hole in the mapping).  Or if this is the first</span>
01185             <span class="comment">//  run in the mapping</span>
01186             <span class="comment">//</span>
01187 
01188             <span class="keywordflow">if</span> ((Vbn == 0) ||
01189                 (<a class="code" href="../../d1/d1/largemcb_8c.html#a3">PreviousEndingVbn</a>(Mcb,Index) + 1 == Vbn)) {
01190 
01191                 <span class="comment">//</span>
01192                 <span class="comment">//      --LastRun--||---NewRun--|</span>
01193                 <span class="comment">//</span>
01194                 <span class="comment">//      0:|--NewRun--|</span>
01195                 <span class="comment">//</span>
01196 
01197                 <span class="comment">//</span>
01198                 <span class="comment">//  We only need to add one more run to the mcb, so make sure</span>
01199                 <span class="comment">//  there is enough room for one.</span>
01200                 <span class="comment">//</span>
01201 
01202                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Adding new contiguous last run\n"</span>, 0);
01203 
01204                 <a class="code" href="../../d1/d1/largemcb_8c.html#a26">FsRtlAddLargeEntry</a>( Mcb, Index, 1 );
01205 
01206                 <span class="comment">//</span>
01207                 <span class="comment">//  Add the new mapping</span>
01208                 <span class="comment">//</span>
01209 
01210                 (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn = Lbn;
01211                 (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn = Vbn + SectorCount;
01212 
01213                 <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = TRUE);
01214             }
01215 
01216             <span class="comment">//</span>
01217             <span class="comment">//  If we reach this point then there is going to be a hole in the</span>
01218             <span class="comment">//  mapping. and the mapping gets appended to the end of the current</span>
01219             <span class="comment">//  allocation.  So need to make room for two more runs in the mcb.</span>
01220             <span class="comment">//</span>
01221 
01222             <span class="comment">//</span>
01223             <span class="comment">//      --LastRun--|   hole   |---NewRun--|</span>
01224             <span class="comment">//</span>
01225             <span class="comment">//      0:  hole  |--NewRun--|</span>
01226             <span class="comment">//</span>
01227 
01228             <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Adding new noncontiguous last run\n"</span>, 0);
01229 
01230             <a class="code" href="../../d1/d1/largemcb_8c.html#a26">FsRtlAddLargeEntry</a>( Mcb, Index, 2 );
01231 
01232             <span class="comment">//</span>
01233             <span class="comment">//  Add the hole</span>
01234             <span class="comment">//</span>
01235 
01236             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn = (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)<a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>;
01237             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn = Vbn;
01238 
01239             <span class="comment">//</span>
01240             <span class="comment">//  Add the new mapping</span>
01241             <span class="comment">//</span>
01242 
01243             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].Lbn = Lbn;
01244             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].NextVbn = Vbn + SectorCount;
01245 
01246             <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = TRUE);
01247         }
01248 
01249         <span class="comment">//</span>
01250         <span class="comment">//  We found an index for the Vbn therefore we must be trying</span>
01251         <span class="comment">//  to fill up a hole in the mcb.  So first we need to check to make</span>
01252         <span class="comment">//  sure there really is a hole to be filled</span>
01253         <span class="comment">//</span>
01254 
01255         LastVbn = Vbn + SectorCount - 1;
01256 
01257         <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb,Index) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) &amp;&amp;
01258             (<a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb,Index) &lt;= Vbn) &amp;&amp; (LastVbn &lt;= <a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb,Index))) {
01259 
01260             <span class="comment">//</span>
01261             <span class="comment">//  The mapping fits in this hole, but now here are the following</span>
01262             <span class="comment">//  cases we must consider for the new mapping</span>
01263             <span class="comment">//</span>
01264 
01265             <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb,Index) &lt; Vbn) &amp;&amp; (LastVbn &lt; <a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb,Index))) {
01266 
01267                 <span class="comment">//  Leaves a hole are both ends</span>
01268                 <span class="comment">//</span>
01269                 <span class="comment">//  --PreviousRun--|  hole  |--NewRun--|  hole  |--FollowingRun--</span>
01270                 <span class="comment">//</span>
01271                 <span class="comment">//  0:  hole  |--NewRun--|  hole  |--FollowingRun--</span>
01272                 <span class="comment">//</span>
01273 
01274                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Hole at both ends\n"</span>, 0);
01275 
01276                 <span class="comment">//</span>
01277                 <span class="comment">//  Make room for two more entries.  The NextVbn field of the</span>
01278                 <span class="comment">//  one we're shifting remains valid.</span>
01279                 <span class="comment">//</span>
01280 
01281                 <a class="code" href="../../d1/d1/largemcb_8c.html#a26">FsRtlAddLargeEntry</a>( Mcb, Index, 2 );
01282 
01283                 <span class="comment">//</span>
01284                 <span class="comment">//  Add the first hole</span>
01285                 <span class="comment">//</span>
01286 
01287                 (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn = (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)<a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>;
01288                 (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn = Vbn;
01289 
01290                 <span class="comment">//</span>
01291                 <span class="comment">//  Add the new mapping</span>
01292                 <span class="comment">//</span>
01293 
01294                 (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].Lbn = Lbn;
01295                 (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].NextVbn = Vbn + SectorCount;
01296 
01297                 <span class="comment">//</span>
01298                 <span class="comment">//  The second hole is already set up by the add entry call, because</span>
01299                 <span class="comment">//  that call just shift over the original hole to that slot</span>
01300                 <span class="comment">//</span>
01301 
01302                 <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = TRUE);
01303             }
01304 
01305             <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb,Index) == Vbn) &amp;&amp; (LastVbn &lt; <a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb,Index))) {
01306 
01307                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a7">PreviousEndingLbn</a>(Mcb,Index) + 1 == Lbn) {
01308 
01309                     <span class="comment">//</span>
01310                     <span class="comment">//  Leaves a hole at the rear, and continues the earlier run</span>
01311                     <span class="comment">//</span>
01312                     <span class="comment">//  --PreviousRun--|--NewRun--|  hole  |--FollowingRun--</span>
01313                     <span class="comment">//</span>
01314 
01315                     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Hole at rear and continue\n"</span>, 0);
01316 
01317                     <span class="comment">//</span>
01318                     <span class="comment">//  We just need to extend the previous run</span>
01319                     <span class="comment">//</span>
01320 
01321                     (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>-1].NextVbn += SectorCount;
01322 
01323                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = TRUE);
01324 
01325                 } <span class="keywordflow">else</span> {
01326 
01327                     <span class="comment">//</span>
01328                     <span class="comment">//  Leaves a hole at the rear, and does not continue the</span>
01329                     <span class="comment">//  earlier run.  As occurs if index is zero.</span>
01330                     <span class="comment">//</span>
01331                     <span class="comment">//  --PreviousRun--||--NewRun--|  hole  |--FollowingRun--</span>
01332                     <span class="comment">//</span>
01333                     <span class="comment">//  0:|--NewRun--|  hole  |--FollowingRun--</span>
01334                     <span class="comment">//</span>
01335 
01336                     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Hole at rear and not continue\n"</span>, 0);
01337 
01338                     <span class="comment">//</span>
01339                     <span class="comment">//  Make room for one more entry.  The NextVbn field of the</span>
01340                     <span class="comment">//  one we're shifting remains valid.</span>
01341                     <span class="comment">//</span>
01342 
01343                     <a class="code" href="../../d1/d1/largemcb_8c.html#a26">FsRtlAddLargeEntry</a>( Mcb, Index, 1 );
01344 
01345                     <span class="comment">//</span>
01346                     <span class="comment">//  Add the new mapping</span>
01347                     <span class="comment">//</span>
01348 
01349                     (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn = Lbn;
01350                     (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn = Vbn + SectorCount;
01351 
01352                     <span class="comment">//</span>
01353                     <span class="comment">//  The hole is already set up by the add entry call, because</span>
01354                     <span class="comment">//  that call just shift over the original hole to that slot</span>
01355                     <span class="comment">//</span>
01356 
01357                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = TRUE);
01358                 }
01359             }
01360 
01361             <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb,Index) &lt; Vbn) &amp;&amp; (LastVbn == <a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb,Index))) {
01362 
01363                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a10">NextStartingLbn</a>(Mcb,Index) == Lbn + SectorCount) {
01364 
01365                     <span class="comment">//</span>
01366                     <span class="comment">//  Leaves a hole at the front, and continues the following run</span>
01367                     <span class="comment">//</span>
01368                     <span class="comment">//  --PreviousRun--|  hole  |--NewRun--|--FollowingRun--</span>
01369                     <span class="comment">//</span>
01370                     <span class="comment">//  0:  hole  |--NewRun--|--FollowingRun--</span>
01371                     <span class="comment">//</span>
01372 
01373                     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Hole at front and continue\n"</span>, 0);
01374 
01375                     <span class="comment">//</span>
01376                     <span class="comment">//  We just need to extend the following run</span>
01377                     <span class="comment">//</span>
01378 
01379                     (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn = Vbn;
01380                     (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].Lbn = Lbn;
01381 
01382                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = TRUE);
01383 
01384                 } <span class="keywordflow">else</span> {
01385 
01386                     <span class="comment">//</span>
01387                     <span class="comment">//  Leaves a hole at the front, and does not continue the following</span>
01388                     <span class="comment">//  run</span>
01389                     <span class="comment">//</span>
01390                     <span class="comment">//  --PreviousRun--|  hole  |--NewRun--||--FollowingRun--</span>
01391                     <span class="comment">//</span>
01392                     <span class="comment">//  0:  hole  |--NewRun--||--FollowingRun--</span>
01393                     <span class="comment">//</span>
01394 
01395                     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Hole at front and not continue\n"</span>, 0);
01396 
01397                     <span class="comment">//</span>
01398                     <span class="comment">//  Make room for one more entry.  The NextVbn field of the</span>
01399                     <span class="comment">//  one we're shifting remains valid.</span>
01400                     <span class="comment">//</span>
01401 
01402                     <a class="code" href="../../d1/d1/largemcb_8c.html#a26">FsRtlAddLargeEntry</a>( Mcb, Index, 1 );
01403 
01404                     <span class="comment">//</span>
01405                     <span class="comment">//  Add the hole</span>
01406                     <span class="comment">//</span>
01407 
01408                     (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn = (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)<a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>;
01409                     (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn = Vbn;
01410 
01411                     <span class="comment">//</span>
01412                     <span class="comment">//  Add the new mapping</span>
01413                     <span class="comment">//</span>
01414 
01415                     (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].Lbn = Lbn;
01416 
01417                     <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = TRUE);
01418                 }
01419 
01420             }
01421 
01422             <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d1/largemcb_8c.html#a7">PreviousEndingLbn</a>(Mcb,Index) + 1 == Lbn) &amp;&amp;
01423                 (<a class="code" href="../../d1/d1/largemcb_8c.html#a10">NextStartingLbn</a>(Mcb,Index) == Lbn + SectorCount)) {
01424 
01425                 <span class="comment">//</span>
01426                 <span class="comment">//  Leaves no holes, and continues both runs</span>
01427                 <span class="comment">//</span>
01428                 <span class="comment">//  --PreviousRun--|--NewRun--|--FollowingRun--</span>
01429                 <span class="comment">//</span>
01430 
01431                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"No holes, and continues both runs\n"</span>, 0);
01432 
01433                 <span class="comment">//</span>
01434                 <span class="comment">//  We need to collapse the current index and the following index</span>
01435                 <span class="comment">//  but first we copy the NextVbn of the follwing run into</span>
01436                 <span class="comment">//  the NextVbn field of the previous run to so it all becomes</span>
01437                 <span class="comment">//  one run</span>
01438                 <span class="comment">//</span>
01439 
01440                 (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>-1].NextVbn = (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].NextVbn;
01441 
01442                 <a class="code" href="../../d1/d1/largemcb_8c.html#a27">FsRtlRemoveLargeEntry</a>( Mcb, Index, 2 );
01443 
01444                 <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = TRUE);
01445             }
01446 
01447             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a10">NextStartingLbn</a>(Mcb,Index) == Lbn + SectorCount) {
01448 
01449                 <span class="comment">//</span>
01450                 <span class="comment">//  Leaves no holes, and continues only following run</span>
01451                 <span class="comment">//</span>
01452                 <span class="comment">//  --PreviousRun--||--NewRun--|--FollowingRun--</span>
01453                 <span class="comment">//</span>
01454                 <span class="comment">//  0:|--NewRun--|--FollowingRun--</span>
01455                 <span class="comment">//</span>
01456 
01457                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"No holes, and continues following\n"</span>, 0);
01458 
01459                 <span class="comment">//</span>
01460                 <span class="comment">//  This index is going away so we need to stretch the</span>
01461                 <span class="comment">//  following run to meet up with the previous run</span>
01462                 <span class="comment">//</span>
01463 
01464                 (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].Lbn = Lbn;
01465 
01466                 <a class="code" href="../../d1/d1/largemcb_8c.html#a27">FsRtlRemoveLargeEntry</a>( Mcb, Index, 1 );
01467 
01468                 <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = TRUE);
01469             }
01470 
01471             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a7">PreviousEndingLbn</a>(Mcb,Index) + 1 == Lbn) {
01472 
01473                 <span class="comment">//</span>
01474                 <span class="comment">//  Leaves no holes, and continues only earlier run</span>
01475                 <span class="comment">//</span>
01476                 <span class="comment">//  --PreviousRun--|--NewRun--||--FollowingRun--</span>
01477                 <span class="comment">//</span>
01478 
01479                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"No holes, and continues earlier\n"</span>, 0);
01480 
01481                 <span class="comment">//</span>
01482                 <span class="comment">//  This index is going away so we need to stretch the</span>
01483                 <span class="comment">//  previous run to meet up with the following run</span>
01484                 <span class="comment">//</span>
01485 
01486                 (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>-1].NextVbn = (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn;
01487 
01488                 <a class="code" href="../../d1/d1/largemcb_8c.html#a27">FsRtlRemoveLargeEntry</a>( Mcb, Index, 1 );
01489 
01490                 <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = TRUE);
01491             }
01492 
01493             <span class="comment">//</span>
01494             <span class="comment">//  Leaves no holes, and continues neither run</span>
01495             <span class="comment">//</span>
01496             <span class="comment">//      --PreviousRun--||--NewRun--||--FollowingRun--</span>
01497             <span class="comment">//</span>
01498             <span class="comment">//      0:|--NewRun--||--FollowingRun--</span>
01499             <span class="comment">//</span>
01500 
01501             <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"No holes, and continues none\n"</span>, 0);
01502 
01503             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn = Lbn;
01504 
01505             <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = TRUE);
01506         }
01507 
01508         <span class="comment">//</span>
01509         <span class="comment">//  We tried to overwrite an existing mapping so we'll have to</span>
01510         <span class="comment">//  tell our caller that it's not possible</span>
01511         <span class="comment">//</span>
01512 
01513         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01514 
01515     try_exit: NOTHING;
01516     } finally {
01517 
01518         ExReleaseFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
01519 
01520         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, Dbg, <span class="stringliteral">"FsRtlAddLargeMcbEntry -&gt; %08lx\n"</span>, Result );
01521     }
01522 
01523     <span class="keywordflow">return</span> Result;
01524 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="largemcb.c::FsRtlAddMcbEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FsRtlAddMcbEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Vbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Lbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SectorCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00375">375</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00637">UdfAddVmcbMapping()</a>.
<p>
<pre class="fragment"><div>00382 {
00383     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00384 
00385     <span class="keywordflow">return</span> <a class="code" href="../../d1/d8/fsrtl_8h.html#a143">FsRtlAddLargeMcbEntry</a>( (<a class="code" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>)Mcb,
00386                                   (LONGLONG)(Vbn),
00387                                   (LONGLONG)(Lbn),
00388                                   (LONGLONG)(SectorCount) );
00389 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="largemcb.c::FsRtlFindLargeIndex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FsRtlFindLargeIndex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Vbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Index</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02748">2748</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00195">EndingVbn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00191">StartingVbn</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01600">FsRtlLookupLargeMcbEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02066">FsRtlSplitLargeMcb()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00743">FsRtlTruncateLargeMcb()</a>.
<p>
<pre class="fragment"><div>02756                    :
02757 
02758     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a <span class="keyword">private</span> routine that locates a mapping <span class="keywordflow">for</span> a Vbn
02759     in a given mapping array
02760 
02761 Arguments:
02762 
02763     Mcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping array to examine
02764 
02765     Vbn - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vbn to look up
02766 
02767     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping array of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping
02768         containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vbn.  If none <span class="keywordflow">if</span> found then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set to
02769         PairCount.
02770 
02771 Return Value:
02772 
02773     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> Vbn <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> found and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise
02774 
02775 --*/
02776 
02777 {
02778     LONG MinIndex;
02779     LONG MaxIndex;
02780     LONG MidIndex;
02781 
02782     <span class="comment">//</span>
02783     <span class="comment">//  We'll just do a binary search for the mapping entry.  Min and max</span>
02784     <span class="comment">//  are our search boundaries</span>
02785     <span class="comment">//</span>
02786 
02787     MinIndex = 0;
02788     MaxIndex = Mcb-&gt;PairCount - 1;
02789 
02790     <span class="keywordflow">while</span> (MinIndex &lt;= MaxIndex) {
02791 
02792         <span class="comment">//</span>
02793         <span class="comment">//  Compute the middle index to look at</span>
02794         <span class="comment">//</span>
02795 
02796         MidIndex = ((MaxIndex + MinIndex) / 2);
02797 
02798         <span class="comment">//</span>
02799         <span class="comment">//  check if the Vbn is less than the mapping at the mid index</span>
02800         <span class="comment">//</span>
02801 
02802         <span class="keywordflow">if</span> (Vbn &lt; <a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb, MidIndex)) {
02803 
02804             <span class="comment">//</span>
02805             <span class="comment">//  Vbn is less than the middle index so we need to drop</span>
02806             <span class="comment">//  the max down</span>
02807             <span class="comment">//</span>
02808 
02809             MaxIndex = MidIndex - 1;
02810 
02811         <span class="comment">//</span>
02812         <span class="comment">//  check if the Vbn is greater than the mapping at the mid index</span>
02813         <span class="comment">//</span>
02814 
02815         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Vbn &gt; <a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb, MidIndex)) {
02816 
02817             <span class="comment">//</span>
02818             <span class="comment">//  Vbn is greater than the middle index so we need to bring</span>
02819             <span class="comment">//  up the min</span>
02820             <span class="comment">//</span>
02821 
02822             MinIndex = MidIndex + 1;
02823 
02824         <span class="comment">//</span>
02825         <span class="comment">//  Otherwise we've found the index containing the Vbn so set the</span>
02826         <span class="comment">//  index and return TRUE.</span>
02827         <span class="comment">//</span>
02828 
02829         } <span class="keywordflow">else</span> {
02830 
02831             *<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = MidIndex;
02832 
02833             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02834         }
02835     }
02836 
02837     <span class="comment">//</span>
02838     <span class="comment">//  A match wasn't found so set index to PairCount and return FALSE</span>
02839     <span class="comment">//</span>
02840 
02841     *<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = Mcb-&gt;PairCount;
02842 
02843     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02844 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a48" doxytag="largemcb.c::FsRtlGetNextLargeMcbEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FsRtlGetNextLargeMcbEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OpaqueMcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RunIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeVbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeLbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeSectorCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01970">1970</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00160">_NONOPAQUE_MCB::PairCount</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00242">SectorsWithinRun</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00210">StartingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00191">StartingVbn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02154">try_return</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00149">UNUSED_LBN</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00490">FsRtlGetNextMcbEntry()</a>.
<p>
<pre class="fragment"><div>01980                    :
01981 
01982     This routine returns to its caller <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vbn, Lbn, and SectorCount <span class="keywordflow">for</span>
01983     distinct runs mapped by an Mcb.  Holes are counted as runs.  For example,
01984     to construct to <a class="code" href="../../d0/d1/rtdeltre_8c.html#a5">print</a> <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> all of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> runs in a a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>:
01985 
01986 <span class="comment">//. .   for (i = 0; FsRtlGetNextLargeMcbEntry(Mcb,i,&amp;Vbn,&amp;Lbn,&amp;Count); i++) {</span>
01987 <span class="comment">//</span>
01988 <span class="comment">//. .       // print out vbn, lbn, and count</span>
01989 <span class="comment">//</span>
01990 <span class="comment">//. .       }</span>
01991 
01992 Arguments:
01993 
01994     OpaqueMcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb being examined.
01995 
01996     RunIndex - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> run (zero based) to <span class="keywordflow">return</span> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01997         caller.
01998 
01999     Vbn - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting Vbn of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> returned run, or zero <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02000         run does not exist.
02001 
02002     Lbn - Recieves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting Lbn of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> returned run, or zero <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02003         run does not exist.
02004 
02005     SectorCount - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of sectors within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> returned run,
02006         or zero <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> run does not exist.
02007 
02008 Return Value:
02009 
02010     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified run (i.e., RunIndex) exists in the Mcb,
02011         and FALSE otherwise.  If FALSE is returned then the Vbn, Lbn, and
02012         SectorCount parameters receive zero.
02013 
02014 --*/
02015 
02016 {
02017     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
02018 
02019     BOOLEAN Result;
02020 
02021     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02022 
02023     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, Dbg, <span class="stringliteral">"FsRtlGetNextLargeMcbEntry, Mcb = %08lx\n"</span>, Mcb );
02024     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">" RunIndex = %08lx\n"</span>, RunIndex );
02025 
02026     ExAcquireFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
02027 
02028     <span class="keywordflow">try</span> {
02029 
02030         <span class="comment">//</span>
02031         <span class="comment">//  Make sure the run index is within range</span>
02032         <span class="comment">//</span>
02033 
02034         <span class="keywordflow">if</span> (RunIndex &gt;= Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a>) {
02035 
02036             <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = FALSE);
02037         }
02038 
02039         <span class="comment">//</span>
02040         <span class="comment">//  Set the return variables</span>
02041         <span class="comment">//</span>
02042 
02043         *((PULONG)LargeVbn) = <a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb,RunIndex);
02044         *((PULONG)LargeLbn) = <a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb,RunIndex);
02045         *((PULONG)LargeSectorCount) = <a class="code" href="../../d1/d1/largemcb_8c.html#a11">SectorsWithinRun</a>(Mcb,RunIndex);
02046 
02047         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02048 
02049     try_exit: NOTHING;
02050     } finally {
02051 
02052         ExReleaseFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
02053 
02054         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, Dbg, <span class="stringliteral">"FsRtlGetNextLargeMcbEntry -&gt; %08lx\n"</span>, Result );
02055     }
02056 
02057     ((PLARGE_INTEGER)LargeVbn)-&gt;HighPart = (*((PULONG)LargeVbn) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> ? <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> : 0);
02058     ((PLARGE_INTEGER)LargeLbn)-&gt;HighPart = (*((PULONG)LargeLbn) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> ? <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> : 0);
02059     ((PLARGE_INTEGER)LargeSectorCount)-&gt;HighPart = 0;
02060 
02061     <span class="keywordflow">return</span> Result;
02062 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a36" doxytag="largemcb.c::FsRtlGetNextMcbEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FsRtlGetNextMcbEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RunIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d1/d8/fsrtl_8h.html#a53">PVBN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Vbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d1/d8/fsrtl_8h.html#a51">PLBN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Lbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SectorCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00490">490</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01970">FsRtlGetNextLargeMcbEntry()</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
<pre class="fragment"><div>00498 {
00499     BOOLEAN Results;
00500     LONGLONG LiVbn;
00501     LONGLONG LiLbn;
00502     LONGLONG LiSectorCount;
00503 
00504     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00505 
00506     Results = <a class="code" href="../../d1/d8/fsrtl_8h.html#a149">FsRtlGetNextLargeMcbEntry</a>( (<a class="code" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>)Mcb,
00507                                          RunIndex,
00508                                          &amp;LiVbn,
00509                                          &amp;LiLbn,
00510                                          &amp;LiSectorCount );
00511 
00512     *Vbn = ((ULONG)LiVbn);
00513     *Lbn = (((ULONG)LiLbn) == -1 ? 0 : ((ULONG)LiLbn));
00514     *SectorCount = ((ULONG)LiSectorCount);
00515 
00516     <span class="keywordflow">return</span> Results;
00517 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a38" doxytag="largemcb.c::FsRtlInitializeLargeMcb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlInitializeLargeMcb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OpaqueMcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00572">572</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00367">ExInitializeFastMutex</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00295">FsRtlAllocateFastMutex</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00289">FsRtlAllocateFirstMapping</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00298">FsRtlFreeFastMutex</a>, <a class="el" href="../../d4/d7/fsrtlp_8h-source.html#l00040">FsRtlpAllocatePool</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00313">INITIAL_MAXIMUM_PAIR_COUNT</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00162">_NONOPAQUE_MCB::Mapping</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00159">_NONOPAQUE_MCB::MaximumPairCount</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00160">_NONOPAQUE_MCB::PairCount</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00161">_NONOPAQUE_MCB::PoolType</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00334">FsRtlInitializeMcb()</a>, <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00181">UdfInitializeFcbMcb()</a>, and <a class="el" href="../../d3/d5/allocsup_8c-source.html#l01406">UdfLoadSparingTables()</a>.
<p>
<pre class="fragment"><div>00579                    :
00580 
00581     This routine initializes a <span class="keyword">new</span> Mcb structure.  The caller must
00582     supply <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb structure.  This call must precede all
00583     other calls that set/query <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb structure.
00584 
00585     If <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not available <span class="keyword">this</span> routine will raise a status value
00586     indicating insufficient resources.
00587 
00588 Arguments:
00589 
00590     OpaqueMcb - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb structure to initialize.
00591 
00592     PoolType - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to use when allocating additional
00593         internal Mcb memory.
00594 
00595 Return Value:
00596 
00597     None.
00598 
00599 --*/
00600 
00601 {
00602     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
00603 
00604     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, Dbg, <span class="stringliteral">"FsRtlInitializeLargeMcb, Mcb = %08lx\n"</span>, Mcb );
00605 
00606     <span class="comment">//</span>
00607     <span class="comment">//  Preset the following fields to null so we know to deallocate them</span>
00608     <span class="comment">//  during an abnormal termination</span>
00609     <span class="comment">//</span>
00610 
00611     Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00612     Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00613 
00614     <span class="keywordflow">try</span> {
00615 
00616         <span class="comment">//</span>
00617         <span class="comment">//  Initialize the fields in the Mcb</span>
00618         <span class="comment">//</span>
00619 
00620         Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> = <a class="code" href="../../d1/d1/largemcb_8c.html#a15">FsRtlAllocateFastMutex</a>();
00621 
00622         <a class="code" href="../../d5/d8/ex_8h.html#a8">ExInitializeFastMutex</a>( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
00623 
00624         Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> = 0;
00625         Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o3">PoolType</a> = PoolType;
00626 
00627         <span class="comment">//</span>
00628         <span class="comment">//  Allocate a new buffer an initial size is one that will hold</span>
00629         <span class="comment">//  16 runs</span>
00630         <span class="comment">//</span>
00631 
00632         <span class="keywordflow">if</span> (PoolType == <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>) {
00633 
00634             Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a> = <a class="code" href="../../d1/d1/largemcb_8c.html#a13">FsRtlAllocateFirstMapping</a>();
00635 
00636         } <span class="keywordflow">else</span> {
00637 
00638             Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a> = <a class="code" href="../../d3/d8/fsrtlp_8h.html#a2">FsRtlpAllocatePool</a>( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o3">PoolType</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d6/struct__MAPPING.html">MAPPING</a>) * INITIAL_MAXIMUM_PAIR_COUNT );
00639         }
00640 
00641         <span class="comment">//**** RtlZeroMemory( Mcb-&gt;Mapping, sizeof(MAPPING) * INITIAL_MAXIMUM_PAIR_COUNT );</span>
00642 
00643         Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o1">MaximumPairCount</a> = <a class="code" href="../../d1/d1/largemcb_8c.html#a17">INITIAL_MAXIMUM_PAIR_COUNT</a>;
00644 
00645     } finally {
00646 
00647         <span class="comment">//</span>
00648         <span class="comment">//  If this is an abnormal termination then we need to deallocate</span>
00649         <span class="comment">//  the FastMutex and/or mapping (but once the mapping is allocated,</span>
00650         <span class="comment">//  we can't raise).</span>
00651         <span class="comment">//</span>
00652 
00653         <span class="keywordflow">if</span> (AbnormalTermination()) {
00654 
00655             <span class="keywordflow">if</span> (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) { <a class="code" href="../../d1/d1/largemcb_8c.html#a16">FsRtlFreeFastMutex</a>( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> ); }
00656         }
00657 
00658         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, Dbg, <span class="stringliteral">"FsRtlInitializeLargeMcb -&gt; VOID\n"</span>, 0 );
00659     }
00660 
00661     <span class="comment">//</span>
00662     <span class="comment">//  And return to our caller</span>
00663     <span class="comment">//</span>
00664 
00665     <span class="keywordflow">return</span>;
00666 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a37" doxytag="largemcb.c::FsRtlInitializeLargeMcbs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlInitializeLargeMcbs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00521">521</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00408">ExInitializeNPagedLookasideList()</a>, <a class="el" href="../../d0/d5/ex_2lookasid_8c-source.html#l00543">ExInitializePagedLookasideList()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00322">FsRtlFastMutexLookasideList</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00315">FsRtlFirstMappingLookasideList</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00313">INITIAL_MAXIMUM_PAIR_COUNT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d6/d7/ex_8h-source.html#l00144">POOL_RAISE_IF_ALLOCATION_FAILURE</a>.
<p>
Referenced by <a class="el" href="../../d5/d7/fsrtlpc_8c-source.html#l00215">FsRtlInitSystem()</a>.
<p>
<pre class="fragment"><div>00527                    :
00528 
00529     This routine initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> global portion of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> large mcb <span class="keyword">package</span>
00530 <span class="keyword">    </span>at system initialization time.
00531 
00532 Arguments:
00533 
00534     None.
00535 
00536 Return Value:
00537 
00538     None.
00539 
00540 --*/
00541 
00542 {
00543     <span class="comment">//</span>
00544     <span class="comment">//  Initialize the lookaside of paged initial mapping arrays.</span>
00545     <span class="comment">//</span>
00546 
00547     ExInitializePagedLookasideList( &amp;FsRtlFirstMappingLookasideList,
00548                                     NULL,
00549                                     NULL,
00550                                     POOL_RAISE_IF_ALLOCATION_FAILURE,
00551                                     sizeof( MAPPING ) * INITIAL_MAXIMUM_PAIR_COUNT,
00552                                     'miSF',
00553                                     4 );
00554 
00555     <span class="comment">//</span>
00556     <span class="comment">//  Initialize the Fast Mutex lookaside list.</span>
00557     <span class="comment">//</span>
00558 
00559     <a class="code" href="../../d5/d8/ex_8h.html#a246">ExInitializeNPagedLookasideList</a>( &amp;FsRtlFastMutexLookasideList,
00560                                      NULL,
00561                                      NULL,
00562                                      POOL_RAISE_IF_ALLOCATION_FAILURE,
00563                                      <span class="keyword">sizeof</span>( <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a>),
00564                                      'mfSF',
00565                                      32 );
00566 
00567 
00568 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="largemcb.c::FsRtlInitializeMcb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlInitializeMcb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00334">334</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00572">FsRtlInitializeLargeMcb()</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00219">UdfInitializeVmcb()</a>.
<p>
<pre class="fragment"><div>00338 {
00339     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00340 
00341     <a class="code" href="../../d1/d8/fsrtl_8h.html#a139">FsRtlInitializeLargeMcb</a>( (<a class="code" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>)Mcb,
00342                              PoolType );
00343 
00344     <span class="keywordflow">return</span>;
00345 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a44" doxytag="largemcb.c::FsRtlLookupLargeMcbEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FsRtlLookupLargeMcbEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OpaqueMcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeVbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLONGLONG LargeLbn&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLONGLONG LargeSectorCount&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLONGLONG LargeStartingLbn&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLONGLONG LargeCountFromStartingLbn&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01600">1600</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00147">ASSERTMSG</a>, <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00195">EndingVbn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02748">FsRtlFindLargeIndex()</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l00029">LBN</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00160">_NONOPAQUE_MCB::PairCount</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00210">StartingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00191">StartingVbn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02154">try_return</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00149">UNUSED_LBN</a>.
<p>
<pre class="fragment"><div>01612                    :
01613 
01614     This routine retrieves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping of a Vbn to an Lbn from an Mcb.
01615     It indicates <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping exists and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> run.
01616 
01617 Arguments:
01618 
01619     OpaqueMcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb being examined.
01620 
01621     Vbn - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vbn to lookup.
01622 
01623     Lbn - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Lbn corresponding to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vbn.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of -1 <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
01624         returned <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vbn does not have a corresponding Lbn.
01625 
01626     SectorCount - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of sectors that map from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vbn to
01627         contiguous Lbn values beginning with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input Vbn.
01628 
01629     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> run found.
01630 
01631 Return Value:
01632 
01633     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vbn <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range of VBNs mapped by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01634         <a class="code" href="../../d1/d8/fsrtl_8h.html#a75">MCB</a> (even <span class="keywordflow">if</span> it corresponds to a hole in the mapping), and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>
01635         <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vbn <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> beyond <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d1/d8/fsrtl_8h.html#a75">MCB</a>'s mapping.
01636 
01637         For example, <span class="keywordflow">if</span> an <a class="code" href="../../d1/d8/fsrtl_8h.html#a75">MCB</a> has a mapping <span class="keywordflow">for</span> VBNs 5 and 7 but not <span class="keywordflow">for</span>
01638         6, then a lookup on Vbn 5 or 7 will yield a non zero Lbn and a sector
01639         count of 1.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> lookup <span class="keywordflow">for</span> Vbn 6 will <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> with an Lbn value of
01640         0, and lookup <span class="keywordflow">for</span> Vbn 8 or above will <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>.
01641 
01642 --*/
01643 
01644 {
01645     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
01646 
01647     BOOLEAN Result;
01648 
01649     ULONG LocalIndex;
01650 
01651     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, Dbg, <span class="stringliteral">"FsRtlLookupLargeMcbEntry, Mcb = %08lx\n"</span>, Mcb );
01652     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"  LargeVbn.LowPart = %08lx\n"</span>, LargeVbn.LowPart );
01653 
01654     ExAcquireFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
01655 
01656     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"LargeInteger not supported yet "</span>, ((((PLARGE_INTEGER)&amp;LargeVbn)-&gt;HighPart == 0) ||
01657                                                   (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> == 0) ||
01658                                                   ((((PLARGE_INTEGER)&amp;LargeVbn)-&gt;HighPart == 0x7FFFFFFF) &amp;&amp;
01659                                                    (((ULONG)LargeVbn) == 0xFFFFFFFF))));
01660 
01661     <span class="keywordflow">try</span> {
01662 
01663         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d1/largemcb_8c.html#a25">FsRtlFindLargeIndex</a>(Mcb, ((ULONG)LargeVbn), &amp;LocalIndex)) {
01664 
01665             <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = FALSE);
01666         }
01667 
01668         <span class="comment">//</span>
01669         <span class="comment">//  Compute the lbn for corresponding to the vbn, the value is the</span>
01670         <span class="comment">//  starting lbn of the run plus the number of sectors offset into the</span>
01671         <span class="comment">//  run.  But if it's a hole then the sector Lbn is zero.</span>
01672         <span class="comment">//</span>
01673 
01674         <span class="keywordflow">if</span> (ARGUMENT_PRESENT(LargeLbn)) {
01675 
01676             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb,LocalIndex) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) {
01677 
01678                 *((PULONG)LargeLbn) = (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)<a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>;
01679 
01680             } <span class="keywordflow">else</span> {
01681 
01682                 *((PULONG)LargeLbn) = <a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb,LocalIndex) + (((ULONG)LargeVbn) - <a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb,LocalIndex));
01683             }
01684         }
01685 
01686         <span class="comment">//</span>
01687         <span class="comment">//  If there sector count argument is present then we'll return the number</span>
01688         <span class="comment">//  of sectors remaing in the run.</span>
01689         <span class="comment">//</span>
01690 
01691         <span class="keywordflow">if</span> (ARGUMENT_PRESENT(LargeSectorCount)) {
01692 
01693             *((PULONG)LargeSectorCount) = <a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb,LocalIndex) - ((ULONG)LargeVbn) + 1;
01694         }
01695 
01696         <span class="comment">//</span>
01697         <span class="comment">//  Compute the starting lbn for corresponding to the start of the run, the value is the</span>
01698         <span class="comment">//  starting lbn of the run.  But if it's a hole then the sector Lbn is zero.</span>
01699         <span class="comment">//</span>
01700 
01701         <span class="keywordflow">if</span> (ARGUMENT_PRESENT(LargeStartingLbn)) {
01702 
01703             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb,LocalIndex) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) {
01704 
01705                 *((PULONG)LargeStartingLbn) = (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)<a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>;
01706 
01707             } <span class="keywordflow">else</span> {
01708 
01709                 *((PULONG)LargeStartingLbn) = <a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb,LocalIndex);
01710             }
01711         }
01712 
01713         <span class="comment">//</span>
01714         <span class="comment">//  If there sector count argument is present then we'll return the number</span>
01715         <span class="comment">//  of sectors in the run.</span>
01716         <span class="comment">//</span>
01717 
01718         <span class="keywordflow">if</span> (ARGUMENT_PRESENT(LargeCountFromStartingLbn)) {
01719 
01720             *((PULONG)LargeCountFromStartingLbn) = <a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb,LocalIndex) - <a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb,LocalIndex) + 1;
01721         }
01722 
01723         <span class="comment">//</span>
01724         <span class="comment">//  If the caller want to know the Index number, fill it in.</span>
01725         <span class="comment">//</span>
01726 
01727         <span class="keywordflow">if</span> (ARGUMENT_PRESENT(Index)) {
01728 
01729             *<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = LocalIndex;
01730         }
01731 
01732         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01733 
01734     try_exit: NOTHING;
01735     } finally {
01736 
01737         ExReleaseFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
01738 
01739         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, Dbg, <span class="stringliteral">"FsRtlLookupLargeMcbEntry -&gt; %08lx\n"</span>, Result );
01740     }
01741 
01742     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(LargeLbn)) {
01743         ((PLARGE_INTEGER)LargeLbn)-&gt;HighPart = (*((PULONG)LargeLbn) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> ? <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> : 0);
01744     }
01745 
01746     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(LargeSectorCount)) {
01747         ((PLARGE_INTEGER)LargeSectorCount)-&gt;HighPart = 0;
01748     }
01749 
01750     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(LargeStartingLbn)) {
01751         ((PLARGE_INTEGER)LargeStartingLbn)-&gt;HighPart = (*((PULONG)LargeStartingLbn) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> ? <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> : 0);
01752     }
01753 
01754     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(LargeCountFromStartingLbn)) {
01755         ((PLARGE_INTEGER)LargeCountFromStartingLbn)-&gt;HighPart = 0;
01756     }
01757 
01758     <span class="keywordflow">return</span> Result;
01759 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a45" doxytag="largemcb.c::FsRtlLookupLastLargeMcbEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FsRtlLookupLastLargeMcbEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OpaqueMcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeVbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeLbn</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01763">1763</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00214">EndingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00195">EndingVbn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00160">_NONOPAQUE_MCB::PairCount</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02154">try_return</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00149">UNUSED_LBN</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00455">FsRtlLookupLastMcbEntry()</a>.
<p>
<pre class="fragment"><div>01771                    :
01772 
01773     This routine retrieves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last Vbn to Lbn mapping stored in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb.
01774     It returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last sector or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last run in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01775     Mcb.  The results of <span class="keyword">this</span> function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> useful when extending an existing
01776     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> and needing to a hint on where to <span class="keywordflow">try</span> and allocate sectors on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01777     disk.
01778 
01779 Arguments:
01780 
01781     OpaqueMcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb being examined.
01782 
01783     Vbn - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last Vbn value mapped.
01784 
01785     Lbn - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Lbn corresponding to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vbn.
01786 
01787 Return Value:
01788 
01789     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a mapping within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise
01790         (i.e., <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb does not contain any mapping).
01791 
01792 --*/
01793 
01794 {
01795     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
01796 
01797     BOOLEAN Result;
01798 
01799     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01800 
01801     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, Dbg, <span class="stringliteral">"FsRtlLookupLastLargeMcbEntry, Mcb = %08lx\n"</span>, Mcb );
01802 
01803     ExAcquireFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
01804 
01805     <span class="keywordflow">try</span> {
01806 
01807         <span class="comment">//</span>
01808         <span class="comment">//  Check to make sure there is at least one run in the mcb</span>
01809         <span class="comment">//</span>
01810 
01811         <span class="keywordflow">if</span> (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> &lt;= 0) {
01812 
01813             <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = FALSE);
01814         }
01815 
01816         <span class="comment">//</span>
01817         <span class="comment">//  Return the last mapping of the last run</span>
01818         <span class="comment">//</span>
01819 
01820         *((PULONG)LargeLbn) = <a class="code" href="../../d1/d1/largemcb_8c.html#a9">EndingLbn</a>(Mcb,Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a>-1);
01821         *((PULONG)LargeVbn) = <a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb,Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a>-1);
01822 
01823         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01824 
01825     try_exit: NOTHING;
01826     } finally {
01827 
01828         ExReleaseFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
01829 
01830         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, Dbg, <span class="stringliteral">"FsRtlLookupLastLargeMcbEntry -&gt; %08lx\n"</span>, Result );
01831     }
01832 
01833     ((PLARGE_INTEGER)LargeVbn)-&gt;HighPart = (*((PULONG)LargeVbn) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> ? <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> : 0);
01834     ((PLARGE_INTEGER)LargeLbn)-&gt;HighPart = (*((PULONG)LargeLbn) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> ? <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> : 0);
01835 
01836     <span class="keywordflow">return</span> Result;
01837 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a46" doxytag="largemcb.c::FsRtlLookupLastLargeMcbEntryAndIndex" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FsRtlLookupLastLargeMcbEntryAndIndex           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OpaqueMcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeVbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PLONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeLbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Index</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01841">1841</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00214">EndingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00195">EndingVbn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00160">_NONOPAQUE_MCB::PairCount</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02154">try_return</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00149">UNUSED_LBN</a>.
<p>
<pre class="fragment"><div>01850                    :
01851 
01852     This routine retrieves <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last Vbn to Lbn mapping stored in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb.
01853     It returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last sector or <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last run in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01854     Mcb.  The results of <span class="keyword">this</span> function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> useful when extending an existing
01855     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> and needing to a hint on where to <span class="keywordflow">try</span> and allocate sectors on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01856     disk.
01857 
01858 Arguments:
01859 
01860     OpaqueMcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb being examined.
01861 
01862     Vbn - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last Vbn value mapped.
01863 
01864     Lbn - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Lbn corresponding to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Vbn.
01865     
01866     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> - Receives <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last run.
01867 
01868 Return Value:
01869 
01870     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a mapping within <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise
01871         (i.e., <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb does not contain any mapping).
01872 
01873 --*/
01874 
01875 {
01876     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
01877 
01878     BOOLEAN Result;
01879 
01880     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01881 
01882     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, Dbg, <span class="stringliteral">"FsRtlLookupLastLargeMcbEntryAndIndex, Mcb = %08lx\n"</span>, Mcb );
01883 
01884     ExAcquireFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
01885 
01886     <span class="keywordflow">try</span> {
01887 
01888         <span class="comment">//</span>
01889         <span class="comment">//  Check to make sure there is at least one run in the mcb</span>
01890         <span class="comment">//</span>
01891 
01892         <span class="keywordflow">if</span> (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> &lt;= 0) {
01893 
01894             <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a> (Result = FALSE);
01895         }
01896 
01897         <span class="comment">//</span>
01898         <span class="comment">//  Return the last mapping of the last run</span>
01899         <span class="comment">//</span>
01900 
01901         *((PULONG)LargeLbn) = <a class="code" href="../../d1/d1/largemcb_8c.html#a9">EndingLbn</a>(Mcb,Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a>-1);
01902         *((PULONG)LargeVbn) = <a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb,Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a>-1);
01903 
01904         *<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> - 1;
01905 
01906         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01907 
01908     try_exit: NOTHING;
01909     } finally {
01910 
01911         ExReleaseFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
01912 
01913         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, Dbg, <span class="stringliteral">"FsRtlLookupLastLargeMcbEntryAndIndex -&gt; %08lx\n"</span>, Result );
01914     }
01915 
01916     ((PLARGE_INTEGER)LargeVbn)-&gt;HighPart = (*((PULONG)LargeVbn) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> ? <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> : 0);
01917     ((PLARGE_INTEGER)LargeLbn)-&gt;HighPart = (*((PULONG)LargeLbn) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> ? <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a> : 0);
01918 
01919     <span class="keywordflow">return</span> Result;
01920 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="largemcb.c::FsRtlLookupLastMcbEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FsRtlLookupLastMcbEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d1/d8/fsrtl_8h.html#a53">PVBN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Vbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d1/d8/fsrtl_8h.html#a51">PLBN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Lbn</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00455">455</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01763">FsRtlLookupLastLargeMcbEntry()</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00637">UdfAddVmcbMapping()</a>.
<p>
<pre class="fragment"><div>00461 {
00462     BOOLEAN Results;
00463     LONGLONG LiVbn;
00464     LONGLONG LiLbn;
00465 
00466     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00467 
00468     Results = <a class="code" href="../../d1/d8/fsrtl_8h.html#a146">FsRtlLookupLastLargeMcbEntry</a>( (<a class="code" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>)Mcb,
00469                                             &amp;LiVbn,
00470                                             &amp;LiLbn );
00471 
00472     *Vbn = ((ULONG)LiVbn);
00473     *Lbn = (((ULONG)LiLbn) == -1 ? 0 : ((ULONG)LiLbn));
00474 
00475     <span class="keywordflow">return</span> Results;
00476 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="largemcb.c::FsRtlLookupMcbEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FsRtlLookupMcbEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Vbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d1/d8/fsrtl_8h.html#a51">PLBN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Lbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG SectorCount&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG <a class="el" href="../../d7/d0/cmdat2_8c.html#a27">Index</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00426">426</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d1/d8/fsrtl_8h.html#a145">FsRtlLookupLargeMcbEntry()</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00434 {
00435     BOOLEAN Results;
00436     LONGLONG LiLbn;
00437     LONGLONG LiSectorCount;
00438 
00439     Results = <a class="code" href="../../d1/d8/fsrtl_8h.html#a145">FsRtlLookupLargeMcbEntry</a>( (<a class="code" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>)Mcb,
00440                                         (LONGLONG)(Vbn),
00441                                         &amp;LiLbn,
00442                                         ARGUMENT_PRESENT(SectorCount) ? &amp;LiSectorCount : NULL,
00443                                         NULL,
00444                                         NULL,
00445                                         Index );
00446 
00447     *Lbn = (((ULONG)LiLbn) == -1 ? 0 : ((ULONG)LiLbn));
00448 
00449     <span class="keywordflow">if</span> (ARGUMENT_PRESENT(SectorCount)) { *SectorCount = ((ULONG)LiSectorCount); }
00450 
00451     <span class="keywordflow">return</span> Results;
00452 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a47" doxytag="largemcb.c::FsRtlNumberOfRunsInLargeMcb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG FsRtlNumberOfRunsInLargeMcb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>OpaqueMcb</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01924">1924</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d5/d9/cmconfig_8c-source.html#l00051">Count</a>, <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00160">_NONOPAQUE_MCB::PairCount</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00479">FsRtlNumberOfRunsInMcb()</a>.
<p>
<pre class="fragment"><div>01930                    :
01931 
01932     This routine returns to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> its caller <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of distinct runs
01933     mapped by an Mcb.  Holes (i.e., Vbns that map to Lbn=UNUSED_LBN) are counted
01934     as runs.  For example, an Mcb containing a mapping <span class="keywordflow">for</span> <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> Vbns 0 and 3
01935     will have 3 runs, one <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first mapped sector, a second <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01936     hole covering Vbns 1 and 2, and a third <span class="keywordflow">for</span> Vbn 3.
01937 
01938 Arguments:
01939 
01940     OpaqueMcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb being examined.
01941 
01942 Return Value:
01943 
01944     ULONG - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of distinct runs mapped by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input Mcb.
01945 
01946 --*/
01947 
01948 {
01949     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
01950 
01951     ULONG <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
01952 
01953     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01954 
01955     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, Dbg, <span class="stringliteral">"FsRtlNumberOfRunsInLargeMcb, Mcb = %08lx\n"</span>, Mcb );
01956 
01957     ExAcquireFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
01958 
01959     <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a> = Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a>;
01960 
01961     ExReleaseFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
01962 
01963     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, Dbg, <span class="stringliteral">"FsRtlNumberOfRunsInLargeMcb -&gt; %08lx\n"</span>, Count );
01964 
01965     <span class="keywordflow">return</span> <a class="code" href="../../d4/d0/cmconfig_8c.html#a6">Count</a>;
01966 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="largemcb.c::FsRtlNumberOfRunsInMcb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG FsRtlNumberOfRunsInMcb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Mcb</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00479">479</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01924">FsRtlNumberOfRunsInLargeMcb()</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
<pre class="fragment"><div>00483 {
00484     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00485 
00486     <span class="keywordflow">return</span> <a class="code" href="../../d1/d8/fsrtl_8h.html#a148">FsRtlNumberOfRunsInLargeMcb</a>( (<a class="code" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>)Mcb );
00487 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="largemcb.c::FsRtlRemoveLargeEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlRemoveLargeEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>WhereToRemoveIndex</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>AmountToRemove</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02986">2986</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00977">FsRtlAddLargeMcbEntry()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>.
<p>
<pre class="fragment"><div>02994                    :
02995 
02996     This routine takes a current Mcb and removes one or more entries.
02997 
02998 Arguments:
02999 
03000     Mcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mcb being checked and modified
03001 
03002     WhereToRemoveIndex - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> index of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entries to remove
03003 
03004     AmountToRemove - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of entries to remove
03005 
03006 Return Value:
03007 
03008     None.
03009 
03010 --*/
03011 
03012 {
03013     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
03014 
03015     <span class="comment">//</span>
03016     <span class="comment">//  Check to see if we need to shift everything down because the</span>
03017     <span class="comment">//  entries to remove do not include the last entry in the mcb</span>
03018     <span class="comment">//</span>
03019 
03020     <span class="keywordflow">if</span> (WhereToRemoveIndex + AmountToRemove &lt; Mcb-&gt;PairCount) {
03021 
03022         RtlMoveMemory( &amp;((Mcb-&gt;Mapping)[WhereToRemoveIndex]),
03023                       &amp;((Mcb-&gt;Mapping)[WhereToRemoveIndex + AmountToRemove]),
03024                       (Mcb-&gt;PairCount - (WhereToRemoveIndex + AmountToRemove))
03025                                                            * <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d6/struct__MAPPING.html">MAPPING</a>) );
03026     }
03027 
03028     <span class="comment">//</span>
03029     <span class="comment">//  Now zero out the entries beyond the part we just shifted down</span>
03030     <span class="comment">//</span>
03031 
03032     <span class="comment">//**** RtlZeroMemory( &amp;((Mcb-&gt;Mapping)[Mcb-&gt;PairCount - AmountToRemove]), AmountToRemove * sizeof(MAPPING) );</span>
03033 
03034     <span class="comment">//</span>
03035     <span class="comment">//  Now decrement the PairCount</span>
03036     <span class="comment">//</span>
03037 
03038     Mcb-&gt;PairCount -= AmountToRemove;
03039 
03040     <span class="comment">//</span>
03041     <span class="comment">//  And return to our caller</span>
03042     <span class="comment">//</span>
03043 
03044     <span class="keywordflow">return</span>;
03045 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a43" doxytag="largemcb.c::FsRtlRemoveLargeMcbEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlRemoveLargeMcbEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OpaqueMcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeVbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeSectorCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01528">1528</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00147">ASSERTMSG</a>, <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>, and <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l00032">VBN</a>.
<p>
<pre class="fragment"><div>01536                    :
01537 
01538     This routine removes a mapping of VBNs to LBNs from an Mcb.  The mappings
01539     removed are <span class="keywordflow">for</span>
01540 
01541         Vbn,
01542 
01543         Vbn+1, to
01544 
01545         Vbn+(SectorCount-1).
01546 
01547     The operation works even <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping <span class="keywordflow">for</span> a Vbn in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified range
01548     does not already exist in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified range of Vbn includes
01549     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last mapped Vbn in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb mapping shrinks accordingly.
01550 
01551     If <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not available to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information <span class="keyword">this</span> routine will raise
01552     a status value indicating insufficient resources.
01553 
01554 Arguments:
01555 
01556     OpaqueMcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb from which to remove <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping.
01557 
01558     Vbn - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting Vbn of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mappings to remove.
01559 
01560     SectorCount - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mappings to remove (in sectors).
01561 
01562 Return Value:
01563 
01564     None.
01565 
01566 --*/
01567 
01568 {
01569     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
01570 
01571     <a class="code" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> Vbn = ((ULONG)LargeVbn);
01572     ULONG SectorCount = ((ULONG)LargeSectorCount);
01573 
01574     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01575 
01576     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"LargeInteger not supported yet "</span>, ((PLARGE_INTEGER)&amp;LargeVbn)-&gt;HighPart == 0);
01577 
01578     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, Dbg, <span class="stringliteral">"FsRtlRemoveLargeMcbEntry, Mcb = %08lx\n"</span>, Mcb );
01579     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">" Vbn         = %08lx\n"</span>, Vbn );
01580     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">" SectorCount = %08lx\n"</span>, SectorCount );
01581 
01582     ExAcquireFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
01583 
01584     <span class="keywordflow">try</span> {
01585 
01586         <a class="code" href="../../d1/d1/largemcb_8c.html#a24">FsRtlRemoveMcbEntryPrivate</a>( Mcb, Vbn, SectorCount );
01587 
01588     } finally {
01589 
01590         ExReleaseFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
01591 
01592         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, Dbg, <span class="stringliteral">"FsRtlRemoveLargeMcbEntry -&gt; VOID\n"</span>, 0 );
01593     }
01594 
01595     <span class="keywordflow">return</span>;
01596 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="largemcb.c::FsRtlRemoveMcbEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlRemoveMcbEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OpaqueMcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Vbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SectorCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00392">392</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">FsRtlRemoveMcbEntryPrivate()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>.
<p>
Referenced by <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00637">UdfAddVmcbMapping()</a>, and <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00867">UdfRemoveVmcbMapping()</a>.
<p>
<pre class="fragment"><div>00398 {
00399     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
00400 
00401     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00402 
00403     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, Dbg, <span class="stringliteral">"FsRtlRemoveMcbEntry, Mcb = %08lx\n"</span>, Mcb );
00404     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">" Vbn         = %08lx\n"</span>, Vbn );
00405     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">" SectorCount = %08lx\n"</span>, SectorCount );
00406 
00407     ExAcquireFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
00408 
00409     <span class="keywordflow">try</span> {
00410 
00411         <a class="code" href="../../d1/d1/largemcb_8c.html#a24">FsRtlRemoveMcbEntryPrivate</a>( Mcb,
00412                                     Vbn,
00413                                     SectorCount );
00414 
00415     } finally {
00416 
00417         ExReleaseFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
00418 
00419         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, Dbg, <span class="stringliteral">"FsRtlRemoveMcbEntry -&gt; VOID\n"</span>, 0 );
00420     }
00421 
00422     <span class="keywordflow">return</span>;
00423 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="largemcb.c::FsRtlRemoveMcbEntryPrivate" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlRemoveMcbEntryPrivate           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OpaqueMcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Vbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SectorCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02297">2297</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00195">EndingVbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02852">FsRtlAddLargeEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02748">FsRtlFindLargeIndex()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02986">FsRtlRemoveLargeEntry()</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l00029">LBN</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00222">NextStartingLbn</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00206">PreviousEndingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00242">SectorsWithinRun</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00210">StartingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00191">StartingVbn</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00149">UNUSED_LBN</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l01528">FsRtlRemoveLargeMcbEntry()</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00392">FsRtlRemoveMcbEntry()</a>.
<p>
<pre class="fragment"><div>02305                    :
02306 
02307     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> work routine <span class="keywordflow">for</span> remove large mcb entry.  It does <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> work
02308     without taking <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mcb FastMutex.
02309 
02310 Arguments:
02311 
02312     Mcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb from which to remove <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping.
02313 
02314     Vbn - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting Vbn of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mappings to remove.
02315 
02316     SectorCount - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mappings to remove (in sectors).
02317 
02318 Return Value:
02319 
02320     None.
02321 
02322 --*/
02323 
02324 {
02325     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
02326 
02327     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02328 
02329     <span class="comment">//</span>
02330     <span class="comment">//  Do a quick test to see if we are wiping out the entire MCB.</span>
02331     <span class="comment">//</span>
02332 
02333     <span class="keywordflow">if</span> ((Vbn == 0) &amp;&amp; (Mcb-&gt;PairCount &gt; 0) &amp;&amp; (SectorCount &gt;= Mcb-&gt;Mapping[Mcb-&gt;PairCount-1].NextVbn)) {
02334 
02335         Mcb-&gt;PairCount = 0;
02336 
02337         <span class="keywordflow">return</span>;
02338     }
02339 
02340     <span class="comment">//</span>
02341     <span class="comment">//  While there is some more mapping to remove we'll continue</span>
02342     <span class="comment">//  with our main loop</span>
02343     <span class="comment">//</span>
02344 
02345     <span class="keywordflow">while</span> (SectorCount &gt; 0) {
02346 
02347         <span class="comment">//</span>
02348         <span class="comment">//  Locate the mapping for the vbn</span>
02349         <span class="comment">//</span>
02350 
02351         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d1/largemcb_8c.html#a25">FsRtlFindLargeIndex</a>(Mcb, Vbn, &amp;Index)) {
02352 
02353             <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"FsRtlRemoveLargeMcbEntry, Cannot remove an unmapped Vbn = %08lx\n"</span>, Vbn );
02354 
02355             <span class="keywordflow">return</span>;
02356         }
02357 
02358         <span class="comment">//</span>
02359         <span class="comment">//  Now that we some something to remove the following cases must</span>
02360         <span class="comment">//  be considered</span>
02361         <span class="comment">//</span>
02362 
02363         <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb,Index) == Vbn) &amp;&amp;
02364             (<a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb,Index) &lt; Vbn + SectorCount)) {
02365 
02366             ULONG i;
02367 
02368             <span class="comment">//</span>
02369             <span class="comment">//  Removes the entire run</span>
02370             <span class="comment">//</span>
02371 
02372             <span class="comment">//</span>
02373             <span class="comment">//  Update the amount to remove</span>
02374             <span class="comment">//</span>
02375 
02376             i = <a class="code" href="../../d1/d1/largemcb_8c.html#a11">SectorsWithinRun</a>(Mcb,Index);
02377             Vbn += i;
02378             SectorCount -= i;
02379 
02380             <span class="comment">//</span>
02381             <span class="comment">//  If already a hole then leave it alone</span>
02382             <span class="comment">//</span>
02383 
02384             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb,Index) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) {
02385 
02386                 NOTHING;
02387 
02388             <span class="comment">//</span>
02389             <span class="comment">//  Test for last run</span>
02390             <span class="comment">//</span>
02391 
02392             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> == Mcb-&gt;PairCount - 1) {
02393 
02394                 <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d1/largemcb_8c.html#a7">PreviousEndingLbn</a>(Mcb,Index) != <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) ||
02395                     (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> == 0)) {
02396 
02397                     <span class="comment">//</span>
02398                     <span class="comment">//  Previous is not hole, index is last run</span>
02399                     <span class="comment">//</span>
02400                     <span class="comment">//  --Previous--|  Hole</span>
02401                     <span class="comment">//</span>
02402                     <span class="comment">//  0:  Hole</span>
02403                     <span class="comment">//</span>
02404 
02405                     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Entire run, Previous not hole, index is last run\n"</span>, 0);
02406 
02407                     <span class="comment">//</span>
02408                     <span class="comment">//  Just remove this entry</span>
02409                     <span class="comment">//</span>
02410 
02411                     <a class="code" href="../../d1/d1/largemcb_8c.html#a27">FsRtlRemoveLargeEntry</a>( Mcb, Index, 1);
02412 
02413                 } <span class="keywordflow">else</span> {
02414 
02415                     <span class="comment">//</span>
02416                     <span class="comment">//  Previous is hole, index is last run</span>
02417                     <span class="comment">//</span>
02418                     <span class="comment">//  --Hole--|  Hole</span>
02419                     <span class="comment">//</span>
02420 
02421                     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Entire run, Previous hole, index is last run\n"</span>, 0);
02422 
02423                     <span class="comment">//</span>
02424                     <span class="comment">//  Just remove this entry, and preceding entry</span>
02425                     <span class="comment">//</span>
02426 
02427                     <a class="code" href="../../d1/d1/largemcb_8c.html#a27">FsRtlRemoveLargeEntry</a>( Mcb, Index-1, 2);
02428                 }
02429 
02430             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<a class="code" href="../../d1/d1/largemcb_8c.html#a7">PreviousEndingLbn</a>(Mcb,Index) != <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) || (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> == 0)) &amp;&amp;
02431                        (<a class="code" href="../../d1/d1/largemcb_8c.html#a10">NextStartingLbn</a>(Mcb,Index) != <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>)) {
02432 
02433                 <span class="comment">//</span>
02434                 <span class="comment">//  Previous and following are not holes</span>
02435                 <span class="comment">//</span>
02436                 <span class="comment">//  --Previous--|  Hole  |--Following--</span>
02437                 <span class="comment">//</span>
02438                 <span class="comment">//  0:  Hole  |--Following--</span>
02439                 <span class="comment">//</span>
02440 
02441                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Entire run, Previous &amp; Following not holes\n"</span>, 0);
02442 
02443                 <span class="comment">//</span>
02444                 <span class="comment">//  Make this index a hole</span>
02445                 <span class="comment">//</span>
02446 
02447                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn = (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)<a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>;
02448 
02449             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<a class="code" href="../../d1/d1/largemcb_8c.html#a7">PreviousEndingLbn</a>(Mcb,Index) != <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) || (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> == 0)) &amp;&amp;
02450                        (<a class="code" href="../../d1/d1/largemcb_8c.html#a10">NextStartingLbn</a>(Mcb,Index) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>)) {
02451 
02452                 <span class="comment">//</span>
02453                 <span class="comment">//  Following is hole</span>
02454                 <span class="comment">//</span>
02455                 <span class="comment">//  --Previous--|  Hole  |--Hole--</span>
02456                 <span class="comment">//</span>
02457                 <span class="comment">//  0:  Hole  |--Hole--</span>
02458                 <span class="comment">//</span>
02459 
02460                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Entire run, Following is hole\n"</span>, 0);
02461 
02462                 <span class="comment">//</span>
02463                 <span class="comment">//  Simply remove this entry</span>
02464                 <span class="comment">//</span>
02465 
02466                 <a class="code" href="../../d1/d1/largemcb_8c.html#a27">FsRtlRemoveLargeEntry</a>( Mcb, Index, 1 );
02467 
02468             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d1/largemcb_8c.html#a7">PreviousEndingLbn</a>(Mcb,Index) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) &amp;&amp;
02469                        (<a class="code" href="../../d1/d1/largemcb_8c.html#a10">NextStartingLbn</a>(Mcb,Index) != <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>)) {
02470 
02471                 <span class="comment">//</span>
02472                 <span class="comment">//  Previous is hole</span>
02473                 <span class="comment">//</span>
02474                 <span class="comment">//  --Hole--|  Hole  |--Following--</span>
02475                 <span class="comment">//</span>
02476 
02477                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Entire run, Previous is hole\n"</span>, 0);
02478 
02479                 <span class="comment">//</span>
02480                 <span class="comment">//  Mark current entry a hole</span>
02481                 <span class="comment">//</span>
02482 
02483                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn = (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)<a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>;
02484 
02485                 <span class="comment">//</span>
02486                 <span class="comment">//  Remove previous entry</span>
02487                 <span class="comment">//</span>
02488 
02489                 <a class="code" href="../../d1/d1/largemcb_8c.html#a27">FsRtlRemoveLargeEntry</a>( Mcb, Index - 1, 1 );
02490 
02491             } <span class="keywordflow">else</span> {
02492 
02493                 <span class="comment">//</span>
02494                 <span class="comment">//  Previous and following are holes</span>
02495                 <span class="comment">//</span>
02496                 <span class="comment">//  --Hole--|  Hole  |--Hole--</span>
02497                 <span class="comment">//</span>
02498 
02499                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Entire run, Previous &amp; following are holes\n"</span>, 0);
02500 
02501                 <span class="comment">//</span>
02502                 <span class="comment">//  Remove previous and this entry</span>
02503                 <span class="comment">//</span>
02504 
02505                 <a class="code" href="../../d1/d1/largemcb_8c.html#a27">FsRtlRemoveLargeEntry</a>( Mcb, Index - 1, 2 );
02506             }
02507 
02508         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb,Index) == Vbn) {
02509 
02510             <span class="comment">//</span>
02511             <span class="comment">//  Removes first part of run</span>
02512             <span class="comment">//</span>
02513 
02514             <span class="comment">//</span>
02515             <span class="comment">//  If already a hole then leave it alone</span>
02516             <span class="comment">//</span>
02517 
02518             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb,Index) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) {
02519 
02520                 NOTHING;
02521 
02522             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d1/largemcb_8c.html#a7">PreviousEndingLbn</a>(Mcb,Index) != <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) || (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> == 0)) {
02523 
02524                 <span class="comment">//</span>
02525                 <span class="comment">//  Previous is not hole</span>
02526                 <span class="comment">//</span>
02527                 <span class="comment">//  --Previous--|  Hole  |--Index--||--Following--</span>
02528                 <span class="comment">//</span>
02529                 <span class="comment">//  0:  Hole  |--Index--||--Following--</span>
02530                 <span class="comment">//</span>
02531 
02532                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"1st part, Previous is not hole\n"</span>, 0);
02533 
02534                 <span class="comment">//</span>
02535                 <span class="comment">//  Make room for one more entry.  The NextVbn field of the</span>
02536                 <span class="comment">//  one we're shifting remains valid.</span>
02537                 <span class="comment">//</span>
02538 
02539                 <a class="code" href="../../d1/d1/largemcb_8c.html#a26">FsRtlAddLargeEntry</a>( Mcb, Index, 1 );
02540 
02541                 <span class="comment">//</span>
02542                 <span class="comment">//  Set the hole</span>
02543                 <span class="comment">//</span>
02544 
02545                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn = (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)<a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>;
02546                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn = Vbn + SectorCount;
02547 
02548                 <span class="comment">//</span>
02549                 <span class="comment">//  Set the new Lbn for the remaining run</span>
02550                 <span class="comment">//</span>
02551 
02552                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].Lbn += SectorCount;
02553 
02554             } <span class="keywordflow">else</span> {
02555 
02556                 <span class="comment">//</span>
02557                 <span class="comment">//  Previous is hole</span>
02558                 <span class="comment">//</span>
02559                 <span class="comment">//  --Hole--|  Hole  |--Index--||--Following--</span>
02560                 <span class="comment">//</span>
02561 
02562                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"1st part, Previous is hole\n"</span>, 0);
02563 
02564                 <span class="comment">//</span>
02565                 <span class="comment">//  Expand the preceding hole</span>
02566                 <span class="comment">//</span>
02567 
02568                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>-1].NextVbn += SectorCount;
02569 
02570                 <span class="comment">//</span>
02571                 <span class="comment">//  Set the new Lbn for the remaining run</span>
02572                 <span class="comment">//</span>
02573 
02574                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn += SectorCount;
02575             }
02576 
02577             <span class="comment">//</span>
02578             <span class="comment">//  Update the amount to remove</span>
02579             <span class="comment">//</span>
02580 
02581             Vbn += SectorCount;
02582             SectorCount = 0;
02583 
02584         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb,Index) &lt; Vbn + SectorCount) {
02585 
02586             ULONG AmountToRemove;
02587 
02588             AmountToRemove = <a class="code" href="../../d1/d1/largemcb_8c.html#a5">EndingVbn</a>(Mcb,Index) - Vbn + 1;
02589 
02590             <span class="comment">//</span>
02591             <span class="comment">//  Removes last part of run</span>
02592             <span class="comment">//</span>
02593 
02594             <span class="comment">//</span>
02595             <span class="comment">//  If already a hole then leave it alone</span>
02596             <span class="comment">//</span>
02597 
02598             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb,Index) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) {
02599 
02600                 NOTHING;
02601 
02602             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> == Mcb-&gt;PairCount - 1) {
02603 
02604                 <span class="comment">//</span>
02605                 <span class="comment">//  Index is last run</span>
02606                 <span class="comment">//</span>
02607                 <span class="comment">//  --Previous--||--Index--|  Hole</span>
02608                 <span class="comment">//</span>
02609                 <span class="comment">//  0:|--Index--|  Hole</span>
02610                 <span class="comment">//</span>
02611 
02612                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"last part, Index is last run\n"</span>, 0);
02613 
02614                 <span class="comment">//</span>
02615                 <span class="comment">//  Shrink back the size of the current index</span>
02616                 <span class="comment">//</span>
02617 
02618                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn -= AmountToRemove;
02619 
02620             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a10">NextStartingLbn</a>(Mcb,Index) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) {
02621 
02622                 <span class="comment">//</span>
02623                 <span class="comment">//  Following is hole</span>
02624                 <span class="comment">//</span>
02625                 <span class="comment">//  --Previous--||--Index--|  Hole  |--Hole--</span>
02626                 <span class="comment">//</span>
02627                 <span class="comment">//  0:|--Index--|  Hole  |--Hole--</span>
02628                 <span class="comment">//</span>
02629 
02630                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"last part, Following is hole\n"</span>, 0);
02631 
02632                 <span class="comment">//</span>
02633                 <span class="comment">//  Shrink back the size of the current index</span>
02634                 <span class="comment">//</span>
02635 
02636                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn -= AmountToRemove;
02637 
02638             } <span class="keywordflow">else</span> {
02639 
02640                 <span class="comment">//</span>
02641                 <span class="comment">//  Following is not hole</span>
02642                 <span class="comment">//</span>
02643                 <span class="comment">//  --Previous--||--Index--|  Hole  |--Following--</span>
02644                 <span class="comment">//</span>
02645                 <span class="comment">//</span>
02646                 <span class="comment">//  0:|--Index--|  Hole  |--Following--</span>
02647                 <span class="comment">//</span>
02648 
02649                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"last part, Following is not hole\n"</span>, 0);
02650 
02651                 <span class="comment">//</span>
02652                 <span class="comment">//  Make room for one more entry.  The NextVbn field of the</span>
02653                 <span class="comment">//  one we're shifting remains valid.</span>
02654                 <span class="comment">//</span>
02655 
02656                 <a class="code" href="../../d1/d1/largemcb_8c.html#a26">FsRtlAddLargeEntry</a>( Mcb, Index+1, 1 );
02657 
02658                 <span class="comment">//</span>
02659                 <span class="comment">//  Set the new hole</span>
02660                 <span class="comment">//</span>
02661 
02662                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].Lbn = (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)<a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>;
02663                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].NextVbn = (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn;
02664 
02665                 <span class="comment">//</span>
02666                 <span class="comment">//  Shrink back the size of the current index</span>
02667                 <span class="comment">//</span>
02668 
02669                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn -= AmountToRemove;
02670             }
02671 
02672             <span class="comment">//</span>
02673             <span class="comment">//  Update amount to remove</span>
02674             <span class="comment">//</span>
02675 
02676             Vbn += AmountToRemove;
02677             SectorCount -= AmountToRemove;
02678 
02679         } <span class="keywordflow">else</span> {
02680 
02681             <span class="comment">//</span>
02682             <span class="comment">//  If already a hole then leave it alone</span>
02683             <span class="comment">//</span>
02684 
02685             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb,Index) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) {
02686 
02687                 NOTHING;
02688 
02689             } <span class="keywordflow">else</span> {
02690 
02691                 <span class="comment">//</span>
02692                 <span class="comment">//  Remove middle of run</span>
02693                 <span class="comment">//</span>
02694                 <span class="comment">//  --Previous--||--Index--|  Hole  |--Index--||--Following--</span>
02695                 <span class="comment">//</span>
02696                 <span class="comment">//  0:|--Index--|  Hole  |--Index--||--Following--</span>
02697                 <span class="comment">//</span>
02698 
02699                 <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">"Middle of run\n"</span>, 0);
02700 
02701                 <span class="comment">//</span>
02702                 <span class="comment">//  Make room for two more entries.  The NextVbn field of the</span>
02703                 <span class="comment">//  one we're shifting remains valid.</span>
02704                 <span class="comment">//</span>
02705 
02706                 <a class="code" href="../../d1/d1/largemcb_8c.html#a26">FsRtlAddLargeEntry</a>( Mcb, Index, 2 );
02707 
02708                 <span class="comment">//</span>
02709                 <span class="comment">//  Set up the first remaining run</span>
02710                 <span class="comment">//</span>
02711 
02712                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn = (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+2].Lbn;
02713                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn = Vbn;
02714 
02715                 <span class="comment">//</span>
02716                 <span class="comment">//  Set up the hole</span>
02717                 <span class="comment">//</span>
02718 
02719                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].Lbn = (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)<a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>;
02720                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].NextVbn = Vbn + SectorCount;
02721 
02722                 <span class="comment">//</span>
02723                 <span class="comment">//  Set up the second remaining run</span>
02724                 <span class="comment">//</span>
02725 
02726                 (Mcb-&gt;Mapping)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+2].Lbn += <a class="code" href="../../d1/d1/largemcb_8c.html#a11">SectorsWithinRun</a>(Mcb,Index) +
02727                                                <a class="code" href="../../d1/d1/largemcb_8c.html#a11">SectorsWithinRun</a>(Mcb,Index+1);
02728             }
02729 
02730             <span class="comment">//</span>
02731             <span class="comment">//  Update amount to remove</span>
02732             <span class="comment">//</span>
02733 
02734             Vbn += SectorCount;
02735             SectorCount = 0;
02736         }
02737     }
02738 
02739     <span class="keywordflow">return</span>;
02740 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a41" doxytag="largemcb.c::FsRtlResetLargeMcb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTKERNELAPI VOID FsRtlResetLargeMcb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OpaqueMcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>SelfSynchronized</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00922">922</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00160">_NONOPAQUE_MCB::PairCount</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>.
<p>
Referenced by <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00181">UdfInitializeFcbMcb()</a>, and <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00370">UdfResetVmcb()</a>.
<p>
<pre class="fragment"><div>00929                    :
00930 
00931     This routine truncates an Mcb structure to contain zero mapping
00932     pairs.  It does not shrink <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping pairs array.
00933 
00934 Arguments:
00935 
00936     OpaqueMcb - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb structure to truncate.
00937 
00938     SelfSynchronized - Indicates whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already <span class="keyword">synchronized</span>
00939         with respect to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb.
00940 
00941 Return Value:
00942 
00943     None.
00944 
00945 --*/
00946 
00947 {
00948     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
00949 
00950     <span class="keywordflow">if</span> (SelfSynchronized) {
00951         
00952         <span class="comment">//</span>
00953         <span class="comment">//  If we are self-synchronized, then all we do is clear out the </span>
00954         <span class="comment">//  current mapping pair count.</span>
00955         <span class="comment">//</span>
00956         
00957         Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> = 0;
00958     
00959     } <span class="keywordflow">else</span> {
00960         
00961         <span class="comment">//</span>
00962         <span class="comment">//  Since we are not self-synchronized, we must serialize access to</span>
00963         <span class="comment">//  the Mcb before clearing the pair count</span>
00964         <span class="comment">//</span>
00965         
00966         ExAcquireFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
00967         Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> = 0;
00968         ExReleaseFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
00969     
00970     }
00971 
00972     <span class="keywordflow">return</span>;
00973 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a49" doxytag="largemcb.c::FsRtlSplitLargeMcb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN FsRtlSplitLargeMcb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OpaqueMcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeVbn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeAmount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02066">2066</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00147">ASSERTMSG</a>, <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02852">FsRtlAddLargeEntry()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02748">FsRtlFindLargeIndex()</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l00029">LBN</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00162">_NONOPAQUE_MCB::Mapping</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00160">_NONOPAQUE_MCB::PairCount</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00206">PreviousEndingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00210">StartingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00191">StartingVbn</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02154">try_return</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00149">UNUSED_LBN</a>, and <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l00032">VBN</a>.
<p>
<pre class="fragment"><div>02074                    :
02075 
02076     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to create a hole within an <a class="code" href="../../d2/d7/struct__MCB.html">MCB</a>, by shifting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02077     mapping of Vbns.  All mappings above <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input vbn are shifted by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
02078     amount specified and <span class="keywordflow">while</span> keeping their current lbn value.  Pictorially
02079     we have as input <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following <a class="code" href="../../d1/d8/fsrtl_8h.html#a75">MCB</a>
02080 
02081         <a class="code" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> :       LargeVbn-1 LargeVbn         N
02082             +-----------------+------------------+
02083         <a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a> :             X        Y
02084 
02085     And after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> split we have
02086 
02087         <a class="code" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> :       LargeVbn-1               LargeVbn+Amount    N+Amount
02088             +-----------------+.............+---------------------------+
02089         <a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a> :             X      UnusedLbn       Y
02090 
02091     When doing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> split we have a few cases to consider.  They are:
02092 
02093     1. The input Vbn <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> beyond <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last run.  In <span class="keyword">this</span> <span class="keywordflow">case</span> <span class="keyword">this</span> operation
02094        <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a noop.
02095 
02096     2. The input Vbn <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within or adjacent to a existing run of unused Lbns.
02097        In <span class="keyword">this</span> <span class="keywordflow">case</span> we simply need to extend <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> existing hole
02098        and shift succeeding runs.
02099 
02100     3. The input Vbn <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> between two existing runs, including <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> an input vbn
02101        value of zero.  In <span class="keyword">this</span> <span class="keywordflow">case</span> we need to add a <span class="keyword">new</span> entry <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> hole
02102        and shift succeeding runs.
02103 
02104     4. The input Vbn <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> within an existing run.  In <span class="keyword">this</span> <span class="keywordflow">case</span> we need to add
02105        two <span class="keyword">new</span> entries to contain <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> split run and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> hole.
02106 
02107     If <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not available to store <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> information <span class="keyword">this</span> routine will raise a
02108     status value indicating insufficient resources.
02109 
02110 Arguments:
02111 
02112     OpaqueMcb - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb in which to add <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> mapping.
02113 
02114     Vbn - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting Vbn that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be shifted.
02115 
02116     Amount - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> amount to shift by.
02117 
02118 Return Value:
02119 
02120     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping was successfully shifted, and <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> otherwise.
02121         If <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned then <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not changed.
02122 
02123 --*/
02124 
02125 {
02126     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
02127 
02128     <a class="code" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> Vbn = ((ULONG)LargeVbn);
02129     ULONG Amount = ((ULONG)LargeAmount);
02130 
02131     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
02132 
02133     BOOLEAN Result;
02134 
02135     ULONG i;
02136 
02137     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
02138 
02139     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, Dbg, <span class="stringliteral">"FsRtlSplitLargeMcb, Mcb = %08lx\n"</span>, Mcb );
02140     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">" Vbn    = %08lx\n"</span>, Vbn );
02141     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>( 0, Dbg, <span class="stringliteral">" Amount = %08lx\n"</span>, Amount );
02142 
02143     ExAcquireFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
02144 
02145     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"LargeInteger not supported yet "</span>, ((((PLARGE_INTEGER)&amp;LargeVbn)-&gt;HighPart == 0) ||
02146                                                   (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> == 0)));
02147     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"LargeInteger not supported yet "</span>, ((((PLARGE_INTEGER)&amp;LargeAmount)-&gt;HighPart == 0) ||
02148                                                   (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> == 0)));
02149 
02150     <span class="keywordflow">try</span> {
02151 
02152         <span class="comment">//</span>
02153         <span class="comment">//  First lookup the index for the entry that we are going to split.</span>
02154         <span class="comment">//  If we can't find the entry then there is nothing to split.  This</span>
02155         <span class="comment">//  takes care of the case where the input vbn is beyond the last run</span>
02156         <span class="comment">//  in the mcb</span>
02157         <span class="comment">//</span>
02158 
02159         <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d1/largemcb_8c.html#a25">FsRtlFindLargeIndex</a>( Mcb, Vbn, &amp;Index)) {
02160 
02161             <a class="code" href="../../d5/d5/cc_8h.html#a90">try_return</a>(Result = FALSE);
02162         }
02163 
02164         <span class="comment">//</span>
02165         <span class="comment">//  Now check if the input Vbn is within a hole</span>
02166         <span class="comment">//</span>
02167 
02168         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb,Index) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) {
02169 
02170             <span class="comment">//</span>
02171             <span class="comment">//  Before: --PreviousRun--||--IndexHole--||--FollowingRun--</span>
02172             <span class="comment">//  After:  --PreviousRun--||----IndexHole----||--FollowingRun--</span>
02173             <span class="comment">//</span>
02174             <span class="comment">//      In this case the vbn is somewhere within the hole and we</span>
02175             <span class="comment">//      simply need to added the amount of each existing run</span>
02176             <span class="comment">//      beyond the hole.</span>
02177             <span class="comment">//</span>
02178 
02179             <span class="comment">//</span>
02180             <span class="comment">//  In this case there is really nothing to do here because the</span>
02181             <span class="comment">//  ending code will already shift the runs by proper amount</span>
02182             <span class="comment">//  starting at index</span>
02183             <span class="comment">//</span>
02184 
02185             NOTHING;
02186 
02187         <span class="comment">//</span>
02188         <span class="comment">//  Now check if the input vbn is between a hole and an existing run.</span>
02189         <span class="comment">//</span>
02190 
02191         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb,Index) == Vbn) &amp;&amp; (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> != 0) &amp;&amp; (<a class="code" href="../../d1/d1/largemcb_8c.html#a7">PreviousEndingLbn</a>(Mcb,Index) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>)) {
02192 
02193             <span class="comment">//</span>
02194             <span class="comment">//  Before: --Hole--||--IndexRun--</span>
02195             <span class="comment">//  After:  --Hole------||--IndexRun--</span>
02196             <span class="comment">//</span>
02197             <span class="comment">//      In this case the vbn points to the start of the existing</span>
02198             <span class="comment">//      run and we need to do the split between the hole and the</span>
02199             <span class="comment">//      existing run by simply adding the amount to each existing</span>
02200             <span class="comment">//      run beyond the hole.</span>
02201             <span class="comment">//</span>
02202 
02203             <span class="comment">//</span>
02204             <span class="comment">//  In this case we need to decement the index by 1 and then</span>
02205             <span class="comment">//  fall to the bottom code which will do the shifting for us</span>
02206             <span class="comment">//</span>
02207 
02208             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> -= 1;
02209 
02210         <span class="comment">//</span>
02211         <span class="comment">//  Now check if the input vbn is between two existing runs</span>
02212         <span class="comment">//</span>
02213 
02214         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb,Index) == Vbn) {
02215 
02216             <span class="comment">//</span>
02217             <span class="comment">//  Before: --PreviousRun--||--IndexRun--</span>
02218             <span class="comment">//  After:  --PreviousRun--||--NewHole--||--IndexRun--</span>
02219             <span class="comment">//</span>
02220             <span class="comment">//  Before: 0:|--IndexRun--</span>
02221             <span class="comment">//  After:  0:|--NewHole--||--IndexRun--</span>
02222             <span class="comment">//</span>
02223             <span class="comment">//      In this case the vbn points to the start of an existing</span>
02224             <span class="comment">//      run and the preceeding is either a real run or the start</span>
02225             <span class="comment">//      of mapping pairs We simply add a new entry for the hole</span>
02226             <span class="comment">//      and shift succeeding runs.</span>
02227             <span class="comment">//</span>
02228 
02229             <a class="code" href="../../d1/d1/largemcb_8c.html#a26">FsRtlAddLargeEntry</a>( Mcb, Index, 1 );
02230 
02231             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn = (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)<a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>;
02232             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn = Vbn + Amount;
02233 
02234             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1;
02235 
02236         <span class="comment">//</span>
02237         <span class="comment">//  Otherwise the input vbn is inside an existing run</span>
02238         <span class="comment">//</span>
02239 
02240         } <span class="keywordflow">else</span> {
02241 
02242             <span class="comment">//</span>
02243             <span class="comment">//  Before: --IndexRun--</span>
02244             <span class="comment">//  After:  --SplitRun--||--NewHole--||--SplitRun--</span>
02245             <span class="comment">//</span>
02246             <span class="comment">//      In this case the vbn points within an existing run</span>
02247             <span class="comment">//      we need to add two new extries for hole and split</span>
02248             <span class="comment">//      run and shift succeeding runs</span>
02249             <span class="comment">//</span>
02250 
02251             <a class="code" href="../../d1/d1/largemcb_8c.html#a26">FsRtlAddLargeEntry</a>( Mcb, Index, 2 );
02252 
02253             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].Lbn = (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+2].Lbn;
02254             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn = Vbn;
02255 
02256             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].Lbn = (<a class="code" href="../../d1/d8/fsrtl_8h.html#a50">LBN</a>)<a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>;
02257             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+1].NextVbn = Vbn + Amount;
02258 
02259             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+2].Lbn = (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>+2].Lbn +
02260                                           <a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb, Index+1) -
02261                                           <a class="code" href="../../d1/d1/largemcb_8c.html#a4">StartingVbn</a>(Mcb, Index);
02262 
02263             <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 2;
02264 
02265         }
02266 
02267         <span class="comment">//</span>
02268         <span class="comment">//  At this point we have completed most of the work we now need to</span>
02269         <span class="comment">//  shift existing runs from the index to the end of the mappings</span>
02270         <span class="comment">//  by the specified amount</span>
02271         <span class="comment">//</span>
02272 
02273         <span class="keywordflow">for</span> (i = <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>; i &lt; Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a>; i += 1) {
02274 
02275             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[i].NextVbn += Amount;
02276         }
02277 
02278         Result = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02279 
02280     try_exit: NOTHING;
02281     } finally {
02282 
02283         ExReleaseFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
02284 
02285         <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, Dbg, <span class="stringliteral">"FsRtlSplitLargeMcb -&gt; %08lx\n"</span>, Result );
02286     }
02287 
02288     <span class="keywordflow">return</span> Result;
02289 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a40" doxytag="largemcb.c::FsRtlTruncateLargeMcb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlTruncateLargeMcb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OpaqueMcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>LargeVbn</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00743">743</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00147">ASSERTMSG</a>, <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00289">FsRtlAllocateFirstMapping</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l02748">FsRtlFindLargeIndex()</a>, <a class="el" href="../../d4/d7/fsrtlp_8h-source.html#l00040">FsRtlpAllocatePool</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00313">INITIAL_MAXIMUM_PAIR_COUNT</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00162">_NONOPAQUE_MCB::Mapping</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00159">_NONOPAQUE_MCB::MaximumPairCount</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00199">NextStartingVbn</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00160">_NONOPAQUE_MCB::PairCount</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00155">PMAPPING</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00161">_NONOPAQUE_MCB::PoolType</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00210">StartingLbn</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00149">UNUSED_LBN</a>, and <a class="el" href="../../d2/d7/fsrtl_8h-source.html#l00032">VBN</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00361">FsRtlTruncateMcb()</a>.
<p>
<pre class="fragment"><div>00750                    :
00751 
00752     This routine truncates an Mcb structure to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified Vbn.
00753     After calling <span class="keyword">this</span> routine <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb will <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> contain mappings
00754     up to and not including <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input vbn.
00755 
00756 Arguments:
00757 
00758     OpaqueMcb - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb structure to truncate.
00759 
00760     LargeVbn - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> last Vbn at which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no longer to be
00761       mapped.
00762 
00763 Return Value:
00764 
00765     None.
00766 
00767 --*/
00768 
00769 {
00770     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
00771 
00772     <a class="code" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a> Vbn = ((ULONG)LargeVbn);
00773     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00774 
00775     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00776 
00777     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, Dbg, <span class="stringliteral">"FsRtlTruncateLargeMcb, Mcb = %08lx\n"</span>, Mcb );
00778 
00779     ExAcquireFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
00780 
00781     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a8">ASSERTMSG</a>(<span class="stringliteral">"LargeInteger not supported yet "</span>, ((((PLARGE_INTEGER)&amp;LargeVbn)-&gt;HighPart == 0) ||
00782                                                   (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> == 0) ||
00783                                                   ((((PLARGE_INTEGER)&amp;LargeVbn)-&gt;HighPart == 0x7FFFFFFF) &amp;&amp;
00784                                                    (((ULONG)LargeVbn) == 0xFFFFFFFF))));
00785 
00786     <span class="keywordflow">try</span> {
00787 
00788         <span class="comment">//</span>
00789         <span class="comment">//  Do a quick test to see if we are truncating the entire Mcb.</span>
00790         <span class="comment">//</span>
00791 
00792         <span class="keywordflow">if</span> (Vbn == 0) {
00793 
00794             Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> = 0;
00795 
00796         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> &gt; 0) {
00797 
00798             <span class="comment">//</span>
00799             <span class="comment">//  Find the index for the entry with the last Vcn we want to keep.</span>
00800             <span class="comment">//  There is nothing to do if the Mcb already ends prior to</span>
00801             <span class="comment">//  this point.</span>
00802             <span class="comment">//</span>
00803 
00804             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a25">FsRtlFindLargeIndex</a>(Mcb, Vbn - 1, &amp;Index)) {
00805 
00806                 <span class="comment">//</span>
00807                 <span class="comment">//  If this entry currently describes a hole then</span>
00808                 <span class="comment">//  truncate to the previous entry.</span>
00809                 <span class="comment">//</span>
00810 
00811                 <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a8">StartingLbn</a>(Mcb, Index) == <a class="code" href="../../d1/d1/largemcb_8c.html#a1">UNUSED_LBN</a>) {
00812 
00813                     Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> = <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00814 
00815                 <span class="comment">//</span>
00816                 <span class="comment">//  Otherwise we will truncate the Mcb to this point.  Truncate</span>
00817                 <span class="comment">//  the number of Vbns of this run if necessary.</span>
00818                 <span class="comment">//</span>
00819 
00820                 } <span class="keywordflow">else</span> {
00821 
00822                     Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> = <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> + 1;
00823 
00824                     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d1/largemcb_8c.html#a6">NextStartingVbn</a>(Mcb, Index) &gt; Vbn) {
00825 
00826                         (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>)[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].NextVbn = Vbn;
00827                     }
00828                 }
00829             }
00830         }
00831 
00832         <span class="comment">//</span>
00833         <span class="comment">//  Now see if we can shrink the allocation for the mapping pairs.</span>
00834         <span class="comment">//  We'll shrink the mapping pair buffer if the new pair count will</span>
00835         <span class="comment">//  fit within a quarter of the current maximum pair count and the</span>
00836         <span class="comment">//  current maximum is greater than the initial pair count.</span>
00837         <span class="comment">//</span>
00838 
00839         <span class="keywordflow">if</span> ((Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> &lt; (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o1">MaximumPairCount</a> / 4)) &amp;&amp;
00840             (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o1">MaximumPairCount</a> &gt; <a class="code" href="../../d1/d1/largemcb_8c.html#a17">INITIAL_MAXIMUM_PAIR_COUNT</a>)) {
00841 
00842             ULONG NewMax;
00843             <a class="code" href="../../d8/d6/struct__MAPPING.html">PMAPPING</a> Mapping;
00844 
00845             <span class="comment">//</span>
00846             <span class="comment">//  We need to allocate a new mapping so compute a new maximum pair</span>
00847             <span class="comment">//  count.  We'll allocate double the current pair count, but never</span>
00848             <span class="comment">//  less than the initial pair count.</span>
00849             <span class="comment">//</span>
00850 
00851             NewMax = Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> * 2;
00852 
00853             <span class="keywordflow">if</span> (NewMax &lt; <a class="code" href="../../d1/d1/largemcb_8c.html#a17">INITIAL_MAXIMUM_PAIR_COUNT</a>) {
00854                 NewMax = <a class="code" href="../../d1/d1/largemcb_8c.html#a17">INITIAL_MAXIMUM_PAIR_COUNT</a>;
00855             }
00856 
00857             <span class="comment">//</span>
00858             <span class="comment">//  Be careful to trap failures due to resource exhaustion.</span>
00859             <span class="comment">//</span>
00860                 
00861             <span class="keywordflow">try</span> {
00862                     
00863                 <span class="keywordflow">if</span> (NewMax == <a class="code" href="../../d1/d1/largemcb_8c.html#a17">INITIAL_MAXIMUM_PAIR_COUNT</a> &amp;&amp; Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o3">PoolType</a> == <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>) {
00864 
00865                     Mapping = <a class="code" href="../../d1/d1/largemcb_8c.html#a13">FsRtlAllocateFirstMapping</a>();
00866 
00867                 } <span class="keywordflow">else</span> {
00868             
00869                     Mapping = <a class="code" href="../../d3/d8/fsrtlp_8h.html#a2">FsRtlpAllocatePool</a>( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o3">PoolType</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d6/struct__MAPPING.html">MAPPING</a>) * NewMax );
00870                 }
00871 
00872             } except (EXCEPTION_EXECUTE_HANDLER) {
00873 
00874                   Mapping = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00875             }
00876 
00877             <span class="comment">//</span>
00878             <span class="comment">//  Now check if we really got a new buffer</span>
00879             <span class="comment">//</span>
00880 
00881             <span class="keywordflow">if</span> (Mapping != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00882 
00883                 <span class="comment">//</span>
00884                 <span class="comment">//  Now copy over the old mapping to the new buffer</span>
00885                 <span class="comment">//</span>
00886 
00887                 RtlCopyMemory( Mapping, Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d6/struct__MAPPING.html">MAPPING</a>) * Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o2">PairCount</a> );
00888 
00889                 <span class="comment">//</span>
00890                 <span class="comment">//  Deallocate the old buffer.  This should never be the size of an</span>
00891                 <span class="comment">//  initial mapping ...</span>
00892                 <span class="comment">//</span>
00893 
00894                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a> );
00895 
00896                 <span class="comment">//</span>
00897                 <span class="comment">//  And set up the new buffer in the Mcb</span>
00898                 <span class="comment">//</span>
00899 
00900                 Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a> = Mapping;
00901                 Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o1">MaximumPairCount</a> = NewMax;
00902             }
00903         }
00904 
00905     } finally {
00906 
00907         ExReleaseFastMutex( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
00908     }
00909 
00910     <span class="comment">//</span>
00911     <span class="comment">//  And return to our caller</span>
00912     <span class="comment">//</span>
00913 
00914     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, Dbg, <span class="stringliteral">"FsRtlTruncateLargeMcb -&gt; VOID\n"</span>, 0 );
00915 
00916     <span class="keywordflow">return</span>;
00917 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="largemcb.c::FsRtlTruncateMcb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlTruncateMcb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Mcb</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d8/fsrtl_8h.html#a52">VBN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Vbn</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00361">361</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00743">FsRtlTruncateLargeMcb()</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
<pre class="fragment"><div>00365 {
00366    <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00367 
00368    <a class="code" href="../../d1/d8/fsrtl_8h.html#a142">FsRtlTruncateLargeMcb</a>( (<a class="code" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>)Mcb,
00369                           (LONGLONG)(Vbn) );
00370 
00371    <span class="keywordflow">return</span>;
00372 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a39" doxytag="largemcb.c::FsRtlUninitializeLargeMcb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlUninitializeLargeMcb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>OpaqueMcb</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00670">670</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d0/d5/cdfs__rec_8c-source.html#l00032">Dbg</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l02290">DebugTrace</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00158">_NONOPAQUE_MCB::FastMutex</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00298">FsRtlFreeFastMutex</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00292">FsRtlFreeFirstMapping</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00313">INITIAL_MAXIMUM_PAIR_COUNT</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00162">_NONOPAQUE_MCB::Mapping</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00159">_NONOPAQUE_MCB::MaximumPairCount</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00164">PNONOPAQUE_MCB</a>, and <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00161">_NONOPAQUE_MCB::PoolType</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00348">FsRtlUninitializeMcb()</a>, <a class="el" href="../../d3/d5/allocsup_8c-source.html#l00309">UdfDeletePcb()</a>, and <a class="el" href="../../d0/d7/udfs_2strucsup_8c-source.html#l00207">UdfUninitializeFcbMcb()</a>.
<p>
<pre class="fragment"><div>00676                    :
00677 
00678     This routine uninitializes an Mcb structure.  After calling <span class="keyword">this</span> routine
00679     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> input Mcb structure must be re-initialized before being used again.
00680 
00681 Arguments:
00682 
00683     OpaqueMcb - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Mcb structure to uninitialize.
00684 
00685 Return Value:
00686 
00687     None.
00688 
00689 --*/
00690 
00691 {
00692     <a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a> Mcb = (<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html">PNONOPAQUE_MCB</a>)OpaqueMcb;
00693 
00694     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(+1, Dbg, <span class="stringliteral">"FsRtlUninitializeLargeMcb, Mcb = %08lx\n"</span>, Mcb );
00695 
00696     <span class="comment">//</span>
00697     <span class="comment">//  Protect against some user calling us to uninitialize an mcb twice</span>
00698     <span class="comment">//</span>
00699 
00700     <span class="keywordflow">if</span> (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00701 
00702         <span class="comment">// ASSERTMSG("Being called to uninitialize an Mcb that is already Uninitialized ", FALSE);</span>
00703 
00704         <span class="keywordflow">return</span>;
00705     }
00706 
00707     <span class="comment">//</span>
00708     <span class="comment">//  Deallocate the FastMutex and mapping buffer</span>
00709     <span class="comment">//</span>
00710 
00711     <a class="code" href="../../d1/d1/largemcb_8c.html#a16">FsRtlFreeFastMutex</a>( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> );
00712 
00713     Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o0">FastMutex</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00714 
00715     <span class="keywordflow">if</span> ((Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o3">PoolType</a> == <a class="code" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>) &amp;&amp; (Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o1">MaximumPairCount</a> == <a class="code" href="../../d1/d1/largemcb_8c.html#a17">INITIAL_MAXIMUM_PAIR_COUNT</a>)) {
00716 
00717         <a class="code" href="../../d1/d1/largemcb_8c.html#a14">FsRtlFreeFirstMapping</a>( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a> );
00718 
00719     } <span class="keywordflow">else</span> {
00720 
00721         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( Mcb-&gt;<a class="code" href="../../d5/d3/struct__NONOPAQUE__MCB.html#o4">Mapping</a> );
00722     }
00723 
00724     <span class="comment">//</span>
00725     <span class="comment">//  Now zero our all of the fields in the Mcb</span>
00726     <span class="comment">//</span>
00727 
00728     <span class="comment">//**** Mcb-&gt;MaximumPairCount = 0;</span>
00729     <span class="comment">//**** Mcb-&gt;PairCount = 0;</span>
00730     <span class="comment">//**** Mcb-&gt;Mapping = NULL;</span>
00731 
00732     <span class="comment">//</span>
00733     <span class="comment">//  And return to our caller</span>
00734     <span class="comment">//</span>
00735 
00736     <a class="code" href="../../d5/d5/cc_8h.html#a91">DebugTrace</a>(-1, Dbg, <span class="stringliteral">"FsRtlUninitializeLargeMcb -&gt; VOID\n"</span>, 0 );
00737 
00738     <span class="keywordflow">return</span>;
00739 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="largemcb.c::FsRtlUninitializeMcb" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FsRtlUninitializeMcb           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d2/d7/struct__MCB.html">PMCB</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Mcb</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00348">348</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
References <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00670">FsRtlUninitializeLargeMcb()</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00219">UdfInitializeVmcb()</a>, and <a class="el" href="../../d7/d5/vmcbsup_8c-source.html#l00325">UdfUninitializeVmcb()</a>.
<p>
<pre class="fragment"><div>00352 {
00353     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00354 
00355     <a class="code" href="../../d1/d8/fsrtl_8h.html#a140">FsRtlUninitializeLargeMcb</a>( (<a class="code" href="../../d0/d9/struct__LARGE__MCB.html">PLARGE_MCB</a>)Mcb );
00356 
00357     <span class="keywordflow">return</span>;
00358 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a23" doxytag="largemcb.c::FsRtlFastMutexLookasideList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d4/struct__NPAGED__LOOKASIDE__LIST.html">NPAGED_LOOKASIDE_LIST</a> <a class="el" href="../../d1/d1/largemcb_8c.html#a23">FsRtlFastMutexLookasideList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00322">322</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00521">FsRtlInitializeLargeMcbs()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="largemcb.c::FsRtlFirstMappingLookasideList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d8/struct__PAGED__LOOKASIDE__LIST.html">PAGED_LOOKASIDE_LIST</a> <a class="el" href="../../d1/d1/largemcb_8c.html#a22">FsRtlFirstMappingLookasideList</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00315">315</a> of file <a class="el" href="../../d2/d0/largemcb_8c-source.html">largemcb.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d0/largemcb_8c-source.html#l00521">FsRtlInitializeLargeMcbs()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:29 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
