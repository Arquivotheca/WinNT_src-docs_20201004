<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: genxx.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>genxx.h</h1><a href="../../d0/d2/genxx_8h.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1998  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    genxx.h</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This file contains macros (some of them destined for the M4 preprocessor)</span>
00012 <span class="comment">    to aid in the generation of ks &amp; hal header files.  This is used by</span>
00013 <span class="comment">    ke\xxx\genxxx.c, as well as sdktools\genxx.</span>
00014 <span class="comment"></span>
00015 <span class="comment">Author:</span>
00016 <span class="comment"></span>
00017 <span class="comment">    Forrest C. Foltz (forrestf) 23-Jan-1998</span>
00018 <span class="comment"></span>
00019 <span class="comment">Revision History:</span>
00020 <span class="comment"></span>
00021 <span class="comment">--*/</span>
00022 
00023 
00024 
00025 <span class="comment">//</span>
00026 <span class="comment">// Structure element definitions.  </span>
00027 <span class="comment">//</span>
00028 
<a name="l00029"></a><a class="code" href="../../d0/d2/genxx_8h.html#a0">00029</a> <span class="preprocessor">#define MAX_ELEMENT_NAME_LEN 127    // big enough for comments too</span>
<a name="l00030"></a><a class="code" href="../../d0/d7/struct__STRUC__ELEMENT.html">00030</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d0/d7/struct__STRUC__ELEMENT.html">_STRUC_ELEMENT</a> {
00031 
00032 <span class="comment">//</span>
00033 <span class="comment">// Flags is one or more SEF_xxx, defined below.</span>
00034 <span class="comment">//</span>
00035 
<a name="l00036"></a><a class="code" href="../../d0/d7/struct__STRUC__ELEMENT.html#o0">00036</a>     UINT64 <a class="code" href="../../d0/d7/struct__STRUC__ELEMENT.html#o0">Flags</a>;
00037 
00038 <span class="comment">//</span>
00039 <span class="comment">// Note that Equate is used to store a pointer in the case of bitfield</span>
00040 <span class="comment">// processing.</span>
00041 <span class="comment">//</span>
00042 
<a name="l00043"></a><a class="code" href="../../d0/d7/struct__STRUC__ELEMENT.html#o1">00043</a>     UINT64 <a class="code" href="../../d0/d7/struct__STRUC__ELEMENT.html#o1">Equate</a>;
00044 
00045 <span class="comment">//</span>
00046 <span class="comment">// Name should be quite long, as it is used to hold comments as well.</span>
00047 <span class="comment">//</span>
00048 
<a name="l00049"></a><a class="code" href="../../d0/d7/struct__STRUC__ELEMENT.html#o2">00049</a>     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> <a class="code" href="../../d0/d7/struct__STRUC__ELEMENT.html#o2">Name</a>[ <a class="code" href="../../d0/d2/genxx_8h.html#a0">MAX_ELEMENT_NAME_LEN</a> + 1 ];
00050 } <a class="code" href="../../d0/d7/struct__STRUC__ELEMENT.html">STRUC_ELEMENT</a>, *<a class="code" href="../../d0/d7/struct__STRUC__ELEMENT.html">PSTRUC_ELEMENT</a>;
00051 
<a name="l00052"></a><a class="code" href="../../d0/d2/genxx_8h.html#a1">00052</a> <span class="preprocessor">#define SEF_ENABLE_MASK     0x0000FF00      </span>
<a name="l00053"></a><a class="code" href="../../d0/d2/genxx_8h.html#a2">00053</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_HAL             0x00000100</span>
<a name="l00054"></a><a class="code" href="../../d0/d2/genxx_8h.html#a3">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_KERNEL          0x00000200</span>
00055 <span class="preprocessor"></span>
<a name="l00056"></a><a class="code" href="../../d0/d2/genxx_8h.html#a4">00056</a> <span class="preprocessor">#define SEF_INC_FORMAT_MASK 0x00010000</span>
<a name="l00057"></a><a class="code" href="../../d0/d2/genxx_8h.html#a5">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_H_FORMAT        0x00000000</span>
<a name="l00058"></a><a class="code" href="../../d0/d2/genxx_8h.html#a6">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_INC_FORMAT      0x00010000</span>
00059 <span class="preprocessor"></span>
00060 <span class="comment">//</span>
00061 <span class="comment">// Types.  Note that SETMASK, CLRMASK has no effect on te BITFLD types.  BITFLD</span>
00062 <span class="comment">// types have SEF_HAL | SEF_KERNEL set in the type.</span>
00063 <span class="comment">//</span>
00064 
<a name="l00065"></a><a class="code" href="../../d0/d2/genxx_8h.html#a7">00065</a> <span class="preprocessor">#define SEF_TYPE_MASK       0x000000FF</span>
<a name="l00066"></a><a class="code" href="../../d0/d2/genxx_8h.html#a8">00066</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_EQUATE          0x00000000</span>
<a name="l00067"></a><a class="code" href="../../d0/d2/genxx_8h.html#a9">00067</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_EQUATE64        0x00000001</span>
<a name="l00068"></a><a class="code" href="../../d0/d2/genxx_8h.html#a10">00068</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_COMMENT         0x00000002      </span>
<a name="l00069"></a><a class="code" href="../../d0/d2/genxx_8h.html#a11">00069</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_STRING          0x00000003      // Equate is vararg to printf</span>
<a name="l00070"></a><a class="code" href="../../d0/d2/genxx_8h.html#a12">00070</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_BITFLD          0x00000004</span>
<a name="l00071"></a><a class="code" href="../../d0/d2/genxx_8h.html#a13">00071</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_BITALIAS        0x00000005</span>
<a name="l00072"></a><a class="code" href="../../d0/d2/genxx_8h.html#a14">00072</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_STRUCTURE       0x00000006</span>
<a name="l00073"></a><a class="code" href="../../d0/d2/genxx_8h.html#a15">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_SETMASK         0x00000010      // Equate is the mask</span>
<a name="l00074"></a><a class="code" href="../../d0/d2/genxx_8h.html#a16">00074</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_CLRMASK         0x00000011      // Equate is the mask</span>
<a name="l00075"></a><a class="code" href="../../d0/d2/genxx_8h.html#a17">00075</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_END             0x00000012</span>
<a name="l00076"></a><a class="code" href="../../d0/d2/genxx_8h.html#a18">00076</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_START           0x00000013</span>
<a name="l00077"></a><a class="code" href="../../d0/d2/genxx_8h.html#a19">00077</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_PATH            0x00000014</span>
00078 <span class="preprocessor"></span>
00079 <span class="comment">//</span>
00080 <span class="comment">// Note that BITFLD entries have per-entry hal|kernel flags</span>
00081 <span class="comment">//</span>
00082 
00083 
00084 <span class="comment">//</span>
00085 <span class="comment">// Define architecture specific generation macros.</span>
00086 <span class="comment">//</span>
00087 
<a name="l00088"></a><a class="code" href="../../d0/d2/genxx_8h.html#a20">00088</a> <span class="preprocessor">#define SEF_FLAGS 0</span>
<a name="l00089"></a><a class="code" href="../../d0/d2/genxx_8h.html#a21">00089</a> <span class="preprocessor"></span><span class="preprocessor">#define HAL SEF_HAL</span>
<a name="l00090"></a><a class="code" href="../../d0/d2/genxx_8h.html#a22">00090</a> <span class="preprocessor"></span><span class="preprocessor">#define KERNEL SEF_KERNEL</span>
00091 <span class="preprocessor"></span>
00092 <span class="preprocessor">#ifndef ULONG_MAX</span>
<a name="l00093"></a><a class="code" href="../../d0/d2/genxx_8h.html#a23">00093</a> <span class="preprocessor"></span><span class="preprocessor">#define ULONG_MAX 0xFFFFFFFF</span>
00094 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00095 <span class="preprocessor"></span>
00096 <span class="preprocessor">#ifdef _WIN64_</span>
00097 <span class="preprocessor"></span><span class="preprocessor">#define SEF_UINT SEF_EQUATE64</span>
00098 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00099"></a><a class="code" href="../../d0/d2/genxx_8h.html#a24">00099</a> <span class="preprocessor"></span><span class="preprocessor">#define SEF_UINT SEF_EQUATE</span>
00100 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00101 <span class="preprocessor"></span>
00102 <span class="comment">//</span>
00103 <span class="comment">// genDef(Pc, KPCR, MinorVersion)</span>
00104 <span class="comment">//</span>
00105 <span class="comment">// -&gt; #define PcMinorVersion 0x0</span>
00106 <span class="comment">//</span>
00107 
<a name="l00108"></a><a class="code" href="../../d0/d2/genxx_8h.html#a25">00108</a> <span class="preprocessor">#define genDef(Prefix, Type, Member) \</span>
00109 <span class="preprocessor">    { SEF_EQUATE, OFFSET(Type, Member), #Prefix #Member },</span>
00110 <span class="preprocessor"></span>
00111 <span class="comment">//</span>
00112 <span class="comment">// genAlt( PbAlignmentFixupCount, KPRCB, KeAlignmentFixupCount )</span>
00113 <span class="comment">//</span>
00114 <span class="comment">// -&gt; #define PbAlignmentFixupCount 0x2f4</span>
00115 <span class="comment">// </span>
00116 
<a name="l00117"></a><a class="code" href="../../d0/d2/genxx_8h.html#a26">00117</a> <span class="preprocessor">#define genAlt(Name, Type, Member) \</span>
00118 <span class="preprocessor">    { SEF_EQUATE, OFFSET(Type, Member), #Name },</span>
00119 <span class="preprocessor"></span>
00120 <span class="comment">//</span>
00121 <span class="comment">// genCom("This is a comment")</span>
00122 <span class="comment">//</span>
00123 <span class="comment">//    //</span>
00124 <span class="comment">// -&gt; // This is a comment</span>
00125 <span class="comment">//    //</span>
00126 <span class="comment">//</span>
00127 
<a name="l00128"></a><a class="code" href="../../d0/d2/genxx_8h.html#a27">00128</a> <span class="preprocessor">#define genCom(Comment) \</span>
00129 <span class="preprocessor">    { SEF_COMMENT, 0, Comment },</span>
00130 <span class="preprocessor"></span>
00131 <span class="comment">//</span>
00132 <span class="comment">// genNam(PCR_MINOR_VERSION)</span>
00133 <span class="comment">//</span>
00134 <span class="comment">// -&gt; #define PCR_MINOR_VERSION 0x1</span>
00135 <span class="comment">//</span>
00136 
<a name="l00137"></a><a class="code" href="../../d0/d2/genxx_8h.html#a28">00137</a> <span class="preprocessor">#define genNam(Name) \</span>
00138 <span class="preprocessor">    { SEF_EQUATE, (ULONG)(Name), #Name },</span>
00139 <span class="preprocessor"></span>
00140 <span class="comment">//</span>
00141 <span class="comment">// genNamUint(KSEG0_BASE)</span>
00142 <span class="comment">//</span>
00143 <span class="comment">// -&gt; #define KSE0_BASE 0xffffffff80000000</span>
00144 <span class="comment">//</span>
00145 
<a name="l00146"></a><a class="code" href="../../d0/d2/genxx_8h.html#a29">00146</a> <span class="preprocessor">#define genNamUint(Name) \</span>
00147 <span class="preprocessor">    { SEF_UINT, (UINT64)(Name), #Name },</span>
00148 <span class="preprocessor"></span>
00149 <span class="comment">//</span>
00150 <span class="comment">// genVal(FirmwareFrameLength, FIRMWARE_FRAME_LENGTH)</span>
00151 <span class="comment">//</span>
00152 <span class="comment">// -&gt; #define FirmwareFrameLength 0x250</span>
00153 <span class="comment">//</span>
00154 <span class="comment">// Note: if the value is 64-bit when _WIN64_ is enabled, use genValUint()</span>
00155 <span class="comment">//</span>
00156 
<a name="l00157"></a><a class="code" href="../../d0/d2/genxx_8h.html#a30">00157</a> <span class="preprocessor">#define genVal(Name, Value) \</span>
00158 <span class="preprocessor">    { SEF_EQUATE, (ULONG)(Value), #Name },</span>
00159 <span class="preprocessor"></span>
00160 <span class="comment">//</span>
00161 <span class="comment">// genValUint(KiPcr, KIPCR)</span>
00162 <span class="comment">//</span>
00163 <span class="comment">// -&gt; #define KiPcr 0xe0000000ffffe000</span>
00164 <span class="comment">//</span>
00165 
<a name="l00166"></a><a class="code" href="../../d0/d2/genxx_8h.html#a31">00166</a> <span class="preprocessor">#define genValUint(Name, Value) \</span>
00167 <span class="preprocessor">    { SEF_UINT, (UINT64)(Value), #Name },</span>
00168 <span class="preprocessor"></span>
00169 <span class="comment">//</span>
00170 <span class="comment">// genSpc()</span>
00171 <span class="comment">//</span>
00172 <span class="comment">// -&gt;</span>
00173 <span class="comment">//</span>
00174 
<a name="l00175"></a><a class="code" href="../../d0/d2/genxx_8h.html#a32">00175</a> <span class="preprocessor">#define genSpc() \</span>
00176 <span class="preprocessor">    { SEF_STRING, 0, "\n" },</span>
00177 <span class="preprocessor"></span>
00178 <span class="comment">//</span>
00179 <span class="comment">// genStr("    PCR equ ds:[0%lXH]\n", KIP0PCRADDRESS)</span>
00180 <span class="comment">//</span>
00181 <span class="comment">// -&gt;     PCR equ ds:[0FFDFF000H]</span>
00182 <span class="comment">//</span>
00183 
<a name="l00184"></a><a class="code" href="../../d0/d2/genxx_8h.html#a33">00184</a> <span class="preprocessor">#define genStr(String, Value) \</span>
00185 <span class="preprocessor">    { SEF_STRING, (ULONG_PTR)(Value), String },</span>
00186 <span class="preprocessor"></span>
00187 <span class="comment">//</span>
00188 <span class="comment">// genTxt("ifdef NT_UP\n")</span>
00189 <span class="comment">//</span>
00190 <span class="comment">// -&gt; ifdef NT_UP</span>
00191 <span class="comment">//</span>
00192 
<a name="l00193"></a><a class="code" href="../../d0/d2/genxx_8h.html#a34">00193</a> <span class="preprocessor">#define genTxt(String) \</span>
00194 <span class="preprocessor">    { SEF_STRING, 0, String },</span>
00195 <span class="preprocessor"></span>
<a name="l00196"></a><a class="code" href="../../d0/d2/genxx_8h.html#a35">00196</a> <span class="preprocessor">#define DisableInc( x ) \</span>
00197 <span class="preprocessor">    { SEF_CLRMASK, x, "" },</span>
00198 <span class="preprocessor"></span>
<a name="l00199"></a><a class="code" href="../../d0/d2/genxx_8h.html#a36">00199</a> <span class="preprocessor">#define EnableInc( x ) \</span>
00200 <span class="preprocessor">    { SEF_SETMASK, x, "" },</span>
00201 <span class="preprocessor"></span>
<a name="l00202"></a><a class="code" href="../../d0/d2/genxx_8h.html#a37">00202</a> <span class="preprocessor">#define MARKER_STRING "This is the genxx marker string."</span>
00203 <span class="preprocessor"></span>
00204 <span class="comment">//</span>
00205 <span class="comment">// Source file can specify the _NTDRIVE\_NTROOT - relative output path.</span>
00206 <span class="comment">// 'f' is the set of enable-flags that should be routed to this file.</span>
00207 <span class="comment">// Use '0' if there is only a single output file.</span>
00208 <span class="comment">//</span>
00209 <span class="comment">// 'f' should also contain one of SEF_H_FORMAT or SEF_INC_FORMAT to</span>
00210 <span class="comment">// indicate whether the generated file is in 'header file' or 'include file'</span>
00211 <span class="comment">// format.</span>
00212 <span class="comment">//</span>
00213 
<a name="l00214"></a><a class="code" href="../../d0/d2/genxx_8h.html#a38">00214</a> <span class="preprocessor">#define setPath( p, f ) \</span>
00215 <span class="preprocessor">    { SEF_PATH | f, 0, p },</span>
00216 <span class="preprocessor"></span>
00217 <span class="comment">//</span>
00218 <span class="comment">// START_LIST defines the first element in ElementList.  This element contains</span>
00219 <span class="comment">// a (possibly truncated) pointer to the ElementList array.  This is used to</span>
00220 <span class="comment">// determine the fixup RA bias.</span>
00221 <span class="comment">//</span>
00222 
<a name="l00223"></a><a class="code" href="../../d0/d2/genxx_8h.html#a39">00223</a> <span class="preprocessor">#define START_LIST \</span>
00224 <span class="preprocessor">    { SEF_START, (ULONG_PTR)ElementList, MARKER_STRING },</span>
00225 <span class="preprocessor"></span>
<a name="l00226"></a><a class="code" href="../../d0/d2/genxx_8h.html#a40">00226</a> <span class="preprocessor">#define END_LIST \</span>
00227 <span class="preprocessor">    { SEF_END, 0, "" }</span>
00228 <span class="preprocessor"></span>
00229 <span class="comment">//</span>
00230 <span class="comment">// Preprocessor assertion.  Do something here to make the compiler generate</span>
00231 <span class="comment">// an error if x != y.</span>
00232 <span class="comment">//</span>
00233 
<a name="l00234"></a><a class="code" href="../../d0/d2/genxx_8h.html#a41">00234</a> <span class="preprocessor">#define ASSERT_SAME( x, y )</span>
00235 <span class="preprocessor"></span>
00236 <span class="comment">//</span>
00237 <span class="comment">// Macro to round Val up to the next Bnd boundary.  Bnd must be an integral</span>
00238 <span class="comment">// power of two.</span>
00239 <span class="comment">//</span>
00240 
<a name="l00241"></a><a class="code" href="../../d0/d2/genxx_8h.html#a42">00241</a> <span class="preprocessor">#define ROUND_UP( Val, Bnd ) \</span>
00242 <span class="preprocessor">    (((Val) + ((Bnd) - 1)) &amp; ~((Bnd) - 1))</span>
00243 <span class="preprocessor"></span>
00244 <span class="preprocessor">#ifndef OFFSET</span>
00245 <span class="preprocessor"></span>
00246 <span class="comment">//</span>
00247 <span class="comment">// Define member offset computation macro.</span>
00248 <span class="comment">//</span>
00249 
<a name="l00250"></a><a class="code" href="../../d0/d2/genxx_8h.html#a43">00250</a> <span class="preprocessor">#define OFFSET(type, field) ((ULONG_PTR)(&amp;((type *)0)-&gt;field))</span>
00251 <span class="preprocessor"></span>
00252 <span class="preprocessor">#endif</span>
00253 <span class="preprocessor"></span>
00254 <span class="comment">//</span>
00255 <span class="comment">// Following are some M4 macros to help with bitfields.  </span>
00256 <span class="comment">//</span>
00257 
00258 <span class="preprocessor">#ifndef SKIP_M4</span>
00259 <span class="preprocessor"></span>
00260 <span class="comment">//</span>
00261 <span class="comment">// First, define the makezeros(n) macro that will generate a string with</span>
00262 <span class="comment">// n pairs of ',0'.  This is a recursively defined macro.</span>
00263 <span class="comment">//</span>
00264 
00265 define(`makezeros',`ifelse(eval($1),0,,`0,makezeros(eval($1-1))<span class="charliteral">')'</span>)
00266 
00267 <span class="comment">//</span>
00268 <span class="comment">// Define a concatenation macro.</span>
00269 <span class="comment">//</span>
00270 
00271 define(`cat',`$1$2')
00272 
00273 <span class="comment">//</span>
00274 <span class="comment">// The following example bitfield declaration uses HARDWARE_PTE as an</span>
00275 <span class="comment">// example, which is declared (for alpha) as follows:</span>
00276 <span class="comment">//</span>
00277 <span class="comment">// typedef struct _HARDWARE_PTE {</span>
00278 <span class="comment">//     ULONG Valid: 1;</span>
00279 <span class="comment">//     ULONG Owner: 1;</span>
00280 <span class="comment">//     ULONG Dirty: 1;</span>
00281 <span class="comment">//     ULONG reserved: 1;</span>
00282 <span class="comment">//     ULONG Global: 1;</span>
00283 <span class="comment">//     ULONG GranularityHint: 2;</span>
00284 <span class="comment">//     ULONG Write: 1;</span>
00285 <span class="comment">//     ULONG CopyOnWrite: 1;</span>
00286 <span class="comment">//     ULONG PageFrameNumber: 23;</span>
00287 <span class="comment">// } HARDWARE_PTE, *PHARDWARE_PTE;</span>
00288 <span class="comment">//</span>
00289 <span class="comment">//</span>
00290 <span class="comment">// // First, startBitStruc() is invoked with the structure name.</span>
00291 <span class="comment">//</span>
00292 <span class="comment">// startBitStruc( HARDWARE_PTE, SEF_HAL | SEF_KERNEL )</span>
00293 <span class="comment">//</span>
00294 <span class="comment">// //</span>
00295 <span class="comment">// // Now, suppose we wanted to expose seven of the fields in an assembly</span>
00296 <span class="comment">// // include file:</span>
00297 <span class="comment">// //</span>
00298 <span class="comment">//</span>
00299 <span class="comment">// genBitField( Valid, PTE_VALID )</span>
00300 <span class="comment">// genBitField( Owner, PTE_OWNER )</span>
00301 <span class="comment">// genBitField( Dirty, PTE_DIRTY )</span>
00302 <span class="comment">// genBitField( reserved )</span>
00303 <span class="comment">// genBitField( Global, PTE_GLOBAL )</span>
00304 <span class="comment">// genBitField( GranularityHint )</span>
00305 <span class="comment">// genBitField( Write, PTE_WRITE )</span>
00306 <span class="comment">// genBitField( CopyOnWrite, PTE_COPYONWRITE )</span>
00307 <span class="comment">// genBitField( PageFrameNumber, PTE_PFN )</span>
00308 <span class="comment">//</span>
00309 <span class="comment">// Note that fields that are not used (in this case 'reserved' and</span>
00310 <span class="comment">// 'GranularityHint') must still appear in the list.</span>
00311 <span class="comment">//</span>
00312 <span class="comment">// The above will generate a bunch of static, initialized copies of HARDWARE_PTE</span>
00313 <span class="comment">// like so:</span>
00314 <span class="comment">//</span>
00315 <span class="comment">// HARDWARE_PTE HARDWARE_PTE_Valid = {</span>
00316 <span class="comment">//     0xFFFFFFFF };</span>
00317 <span class="comment">//</span>
00318 <span class="comment">// HARDWARE_PTE HARDWARE_PTE_Owner = {</span>
00319 <span class="comment">//     0,   // Valid</span>
00320 <span class="comment">//     0xFFFFFFFF };</span>
00321 <span class="comment">//</span>
00322 <span class="comment">// HARDWARE_PTE HARDWARE_PTE_Dirty = {</span>
00323 <span class="comment">//     0,   // Valid</span>
00324 <span class="comment">//     0,   // Owner</span>
00325 <span class="comment">//     0xFFFFFFFF };</span>
00326 <span class="comment">//</span>
00327 <span class="comment">// HARDWARE_PTE HARDWARE_PTE_Global = {</span>
00328 <span class="comment">//     0,   // Valid</span>
00329 <span class="comment">//     0,   // Owner</span>
00330 <span class="comment">//     0,   // Dirty</span>
00331 <span class="comment">//     0,   // reserved</span>
00332 <span class="comment">//     0xFFFFFFFF };</span>
00333 <span class="comment">//</span>
00334 <span class="comment">// HARDWARE_PTE HARDWARE_PTE_Write = {</span>
00335 <span class="comment">//     0,   // Valid</span>
00336 <span class="comment">//     0,   // Owner</span>
00337 <span class="comment">//     0,   // Dirty</span>
00338 <span class="comment">//     0,   // reserved (skipped)</span>
00339 <span class="comment">//     0,   // Global</span>
00340 <span class="comment">//     0xFFFFFFFF };</span>
00341 <span class="comment">//</span>
00342 <span class="comment">// HARDWARE_PTE HARDWARE_PTE_CopyOnWrite = {</span>
00343 <span class="comment">//     0,   // Valid</span>
00344 <span class="comment">//     0,   // Owner</span>
00345 <span class="comment">//     0,   // Dirty</span>
00346 <span class="comment">//     0,   // reserved (skipped)</span>
00347 <span class="comment">//     0,   // Global</span>
00348 <span class="comment">//     0,   // GranularityHint (skipped)</span>
00349 <span class="comment">//     0xFFFFFFFF };</span>
00350 <span class="comment">//</span>
00351 <span class="comment">// HARDWARE_PTE HARDWARE_PTE_PageFrameNumber = {</span>
00352 <span class="comment">//     0,   // Valid</span>
00353 <span class="comment">//     0,   // Owner</span>
00354 <span class="comment">//     0,   // Dirty</span>
00355 <span class="comment">//     0,   // reserved (skipped)</span>
00356 <span class="comment">//     0,   // Global</span>
00357 <span class="comment">//     0,   // GranularityHint (skipped)</span>
00358 <span class="comment">//     0,   // CopyOnWrite</span>
00359 <span class="comment">//     0xFFFFFFFF };</span>
00360 <span class="comment">//</span>
00361 <span class="comment">// Then, as part of processing the END_LIST macro, these structures are</span>
00362 <span class="comment">// generated:</span>
00363 <span class="comment">//</span>
00364 <span class="comment">// { SEF_BITFLD, &amp;HARDWARE_PTE_Valid,           "PTE_VALID" },</span>
00365 <span class="comment">// { SEF_BITFLD, &amp;HARDWARE_PTE_Owner,           "PTE_OWNER" },</span>
00366 <span class="comment">// { SEF_BITFLD, &amp;HARDWARE_PTE_Dirty,           "PTE_DIRTY" },</span>
00367 <span class="comment">// { SEF_BITFLD, &amp;HARDWARE_PTE_Global,          "PTE_GLOBAL" },</span>
00368 <span class="comment">// { SEF_BITFLD, &amp;HARDWARE_PTE_Write,           "PTE_WRITE" },</span>
00369 <span class="comment">// { SEF_BITFLD, &amp;HARDWARE_PTE_CopyOnWrite,     "PTE_COPYONWRITE" },</span>
00370 <span class="comment">// { SEF_BITFLD, &amp;HARDWARE_PTE_PageFrameNumber, "PTE_PFN" },</span>
00371 <span class="comment">// { SEF_END,    0,                             "" }</span>
00372 <span class="comment">//</span>
00373 <span class="comment">//</span>
00374 <span class="comment">// ... and that's what gets compiled by the target compiler into the .obj.</span>
00375 <span class="comment">// Now, the final stage: genxx.exe is run against this target .obj, and</span>
00376 <span class="comment">// would generate the following:</span>
00377 <span class="comment">//</span>
00378 <span class="comment">// #define PTE_VALID_MASK 0x1</span>
00379 <span class="comment">// #define PTE_VALID 0x0</span>
00380 <span class="comment">// #define PTE_OWNER_MASK 0x2</span>
00381 <span class="comment">// #define PTE_OWNER 0x1</span>
00382 <span class="comment">// #define PTE_DIRTY_MASK 0x4</span>
00383 <span class="comment">// #define PTE_DIRTY 0x2</span>
00384 <span class="comment">// #define PTE_GLOBAL_MASK 0x10</span>
00385 <span class="comment">// #define PTE_GLOBAL 0x4</span>
00386 <span class="comment">// #define PTE_WRITE_MASK 0x80</span>
00387 <span class="comment">// #define PTE_WRITE 0x7</span>
00388 <span class="comment">// #define PTE_COPYONWRITE_MASK 0x100</span>
00389 <span class="comment">// #define PTE_COPYONWRITE 0x8</span>
00390 <span class="comment">// #define PTE_PFN_MASK 0xfffffe00</span>
00391 <span class="comment">// #define PTE_PFN 0x9</span>
00392 <span class="comment">//</span>
00393 
00394 <span class="comment">//</span>
00395 <span class="comment">// BITFIELD_STRUCS accumulates array element initializations.  END_LIST will</span>
00396 <span class="comment">// dump these into the definition array.</span>
00397 <span class="comment">// </span>
00398 
00399 define(`BITFIELD_STRUCS',`')
00400 
00401 <span class="comment">//</span>
00402 <span class="comment">// startBitStruc( &lt;strucname&gt;, &lt;whichfile&gt; )</span>
00403 <span class="comment">// sets BIT_STRUC_NAME = &lt;strucname&gt; and resets the ZERO_FIELDS count to 0.</span>
00404 <span class="comment">// It also sets the WHICH_FILE macro.</span>
00405 <span class="comment">//</span>
00406 
00407 define(`startBitStruc', `define(`BIT_STRUC_NAME',`$1')
00408                          define(`BITFIELD_STRUCS',
00409                                  BITFIELD_STRUCS
00410                                  )
00411                          define(`ZERO_FIELDS',0)
00412                          define(`SEF_TYPE',$2)
00413                         ')
00414 
00415 <span class="comment">//</span>
00416 <span class="comment">// genBitField( &lt;fldname&gt;, &lt;generatedname&gt; ) declares a structure of type</span>
00417 <span class="comment">// &lt;strucname&gt; and initializes the &lt;fldname&gt; bitfield within it.</span>
00418 <span class="comment">//</span>
00419 <span class="comment">// Note that I used "cma" instead of an actual comma, this gets changed to</span>
00420 <span class="comment">// a comma by END_LIST, below.  If I were more proficient with M4 I would know</span>
00421 <span class="comment">// how to get around this.</span>
00422 <span class="comment">//</span>
00423 
00424 define(`genBitField', `define(`VAR_NAME', cat(cat(BIT_STRUC_NAME,`_'),$1))
00425                       `#'define `def_'VAR_NAME
00426                       BIT_STRUC_NAME VAR_NAME = {'
00427                       `makezeros(ZERO_FIELDS)'
00428                       `(ULONG_PTR)-1 };'
00429                       `define(`PAD_VAR_NAME', cat(cat(BIT_STRUC_NAME,`p'),$1))'
00430                       `ULONG_PTR PAD_VAR_NAME = 0;'
00431                       `define(`ZERO_FIELDS',incr(ZERO_FIELDS))'
00432                       `define(`FIELD_NAME', $1)'
00433                       `define(`FIELD_ASMNAME', $2)'
00434                       `define(`BITFIELD_STRUCS',
00435                                BITFIELD_STRUCS
00436                                `#i'fdef `def_'VAR_NAME
00437                                `#i'fndef `dec_'VAR_NAME
00438                                `#de'fine `dec_'VAR_NAME
00439                                { SEF_BITFLD | SEF_TYPE cma (ULONG_PTR)&amp;VAR_NAME cma <span class="stringliteral">"FIELD_ASMNAME"</span> } cma
00440                                `#e'ndif
00441                                `#e'ndif
00442                                )'
00443                       )
00444 
00445 define(`genBitAlias', `define(`BITFIELD_STRUCS',
00446                                BITFIELD_STRUCS
00447                                `#i'fdef `def_'VAR_NAME
00448                                `#i'fndef `deca_'VAR_NAME
00449                                `#de'fine `deca_'VAR_NAME
00450                                { SEF_BITALIAS | SEF_TYPE cma 0 cma <span class="stringliteral">"$1"</span> } cma
00451                                `#e'ndif
00452                                `#e'ndif
00453                                )'
00454                     )
00455 
00456 <span class="comment">//</span>
00457 <span class="comment">// END_LIST dumps the array initializers accumulated by BITFIELD_STRUCS, after</span>
00458 <span class="comment">// replacing each 'cma' with an actual comma.</span>
00459 <span class="comment">//</span>
00460 
00461 define(`DUMP_BITFIELDS',`define(`cma',`,') BITFIELD_STRUCS')
00462 
00463 #endif  <span class="comment">// SKIP_M4</span>
00464 
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:10 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
