<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: imehotky.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>imehotky.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d2/d9/imehotky_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a0">L_CHS</a>&nbsp;&nbsp;&nbsp;MAKELANGID(LANG_CHINESE, SUBLANG_CHINESE_SIMPLIFIED)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a1">L_JPN</a>&nbsp;&nbsp;&nbsp;MAKELANGID(LANG_JAPANESE, SUBLANG_DEFAULT)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a2">L_KOR</a>&nbsp;&nbsp;&nbsp;MAKELANGID(LANG_KOREAN, SUBLANG_DEFAULT)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a3">L_CHT</a>&nbsp;&nbsp;&nbsp;MAKELANGID(LANG_CHINESE, SUBLANG_CHINESE_TRADITIONAL)</td></tr>

<tr><td colspan=2><br><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>enum &nbsp;</td><td class="memItemRight" valign=bottom>{ <a class="el" href="../../d1/d0/imehotky_8c.html#a20a5">ILANG_NO_MATCH</a> =  0, 
<a class="el" href="../../d1/d0/imehotky_8c.html#a20a6">ILANG_MATCH_SYSTEM</a>, 
<a class="el" href="../../d1/d0/imehotky_8c.html#a20a7">ILANG_MATCH_THREAD</a>, 
<a class="el" href="../../d1/d0/imehotky_8c.html#a20a8">ILANG_MATCH_PERFECT</a>
 }</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a9">DeleteImeHotKey</a> (<a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> *ppHead, <a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> pDelete)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a10">AddImeHotKey</a> (<a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> *ppHead, <a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> pAdd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a11">FindImeHotKeyByKey</a> (<a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> pHead, UINT uModifyKeys, UINT uRL, UINT uVKey)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a12">FindImeHotKeyByID</a> (<a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> pHead, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwHotKeyID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a13">FindImeHotKeyByKeyWithLang</a> (<a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> pHead, UINT uModifyKeys, UINT uRL, UINT uVKey, LANGID langId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>LANGID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a14">GetHotKeyLangID</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwHotKeyID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a15">GetImeHotKey</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwHotKeyID, <a class="el" href="../../d9/d5/ndismain_8h.html#a266">PUINT</a> puModifiers, <a class="el" href="../../d9/d5/ndismain_8h.html#a266">PUINT</a> puVKey, HKL *phKL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a16">SetImeHotKey</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwHotKeyID, UINT uModifiers, UINT uVKey, HKL hKL, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwAction)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a17">FreeImeHotKeys</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a18">GetLangIdMatchLevel</a> (HKL hkl, LANGID langId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a19">CheckImeHotKey</a> (<a class="el" href="../../d7/d4/structtagQ.html">PQ</a> pq, UINT uVKey, LPARAM lParam)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LCID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/imehotky_8c.html#a4">glcidSystem</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="imehotky.c::L_CHS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define L_CHS&nbsp;&nbsp;&nbsp;MAKELANGID(LANG_CHINESE, SUBLANG_CHINESE_SIMPLIFIED)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00028">28</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00046">GetHotKeyLangID()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="imehotky.c::L_CHT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define L_CHT&nbsp;&nbsp;&nbsp;MAKELANGID(LANG_CHINESE, SUBLANG_CHINESE_TRADITIONAL)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00031">31</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00046">GetHotKeyLangID()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="imehotky.c::L_JPN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define L_JPN&nbsp;&nbsp;&nbsp;MAKELANGID(LANG_JAPANESE, SUBLANG_DEFAULT)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00029">29</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00046">GetHotKeyLangID()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="imehotky.c::L_KOR" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define L_KOR&nbsp;&nbsp;&nbsp;MAKELANGID(LANG_KOREAN, SUBLANG_DEFAULT)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00030">30</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00046">GetHotKeyLangID()</a>.    </td>
  </tr>
</table>
<hr><h2>Enumeration Type Documentation</h2>
<a class="anchor" name="a20" doxytag="imehotky.c::@46" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> anonymous enum          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt><b>Enumeration values: </b></dt><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em><a class="anchor" name="a20a5" doxytag="ILANG_NO_MATCH" ></a>ILANG_NO_MATCH</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a20a6" doxytag="ILANG_MATCH_SYSTEM" ></a>ILANG_MATCH_SYSTEM</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a20a7" doxytag="ILANG_MATCH_THREAD" ></a>ILANG_MATCH_THREAD</em>&nbsp;</td><td>
</td></tr>
<tr><td valign=top><em><a class="anchor" name="a20a8" doxytag="ILANG_MATCH_PERFECT" ></a>ILANG_MATCH_PERFECT</em>&nbsp;</td><td>
</td></tr>
</table>
</dl>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00033">33</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
<pre class="fragment"><div>00033      {
00034     <a class="code" href="../../d1/d0/imehotky_8c.html#a20a5">ILANG_NO_MATCH</a> = 0,         <span class="comment">// 0: does not match.</span>
00035     <a class="code" href="../../d1/d0/imehotky_8c.html#a20a6">ILANG_MATCH_SYSTEM</a>,         <span class="comment">// 1: matches the system locale</span>
00036     <a class="code" href="../../d1/d0/imehotky_8c.html#a20a7">ILANG_MATCH_THREAD</a>,         <span class="comment">// 2: matches the thread locale</span>
00037     <a class="code" href="../../d1/d0/imehotky_8c.html#a20a8">ILANG_MATCH_PERFECT</a>,        <span class="comment">// 3: matches the current HKL, or direct KL switching hotkey.</span>
00038 };
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a10" doxytag="imehotky.c::AddImeHotKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID AddImeHotKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppHead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pAdd</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00237">237</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00091">_tagIMEHOTKEYOBJ::pNext</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00106">SetImeHotKey()</a>.
<p>
<pre class="fragment"><div>00238 {
00239     <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> ph;
00240 
00241     <span class="keywordflow">if</span> ( *ppHead == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00242         *ppHead = pAdd;
00243     } <span class="keywordflow">else</span> {
00244         ph = *ppHead;
00245         <span class="keywordflow">while</span>( ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
00246             ph = ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a>;
00247         ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a> = pAdd;
00248     }
00249     <span class="keywordflow">return</span>;
00250 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="imehotky.c::CheckImeHotKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> CheckImeHotKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d7/d4/structtagQ.html">PQ</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pq</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uVKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPARAM&nbsp;</td>
          <td class="mdname" nowrap> <em>lParam</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00461">461</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00315">FindImeHotKeyByKey()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00275">gpImeHotKeyListHeader</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00092">_tagIMEHOTKEYOBJ::hk</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00075">MOD_BOTH_SIDES</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00074">MOD_MODIFY_KEYS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02955">TestKeyStateDown</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, and <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00083">_tagIMEHOTKEY::uModifiers</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l12932">NtUserCheckImeHotKey()</a>, and <a class="el" href="../../d6/d7/ntimm_8c-source.html#l01286">xxxImmProcessKey()</a>.
<p>
<pre class="fragment"><div>00466 {
00467     <span class="keyword">static</span> <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uVKeySaved = 0;
00468     <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> ph;
00469     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> uModifiers = 0;
00470     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fKeyUp;
00471 
00472     <span class="comment">//</span>
00473     <span class="comment">// early return for key up message</span>
00474     <span class="comment">//</span>
00475     fKeyUp = ( lParam &amp; 0x80000000 ) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00476     <span class="keywordflow">if</span> ( fKeyUp ) {
00477         <span class="comment">//</span>
00478         <span class="comment">// if the uVKey is not same as the vkey</span>
00479         <span class="comment">// we previously saved, there is no chance</span>
00480         <span class="comment">// that this is a hotkey.</span>
00481         <span class="comment">//</span>
00482         <span class="keywordflow">if</span> ( uVKeySaved != uVKey ) {
00483             uVKeySaved = 0;
00484             <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00485         }
00486         uVKeySaved = 0;
00487         <span class="comment">//</span>
00488         <span class="comment">// If it's same, we still need to check</span>
00489         <span class="comment">// the hotkey list because there is a</span>
00490         <span class="comment">// chance that the hotkey list is modified</span>
00491         <span class="comment">// between the key make and break.</span>
00492         <span class="comment">//</span>
00493     }
00494 
00495     <span class="comment">//</span>
00496     <span class="comment">// Current specification doesn't allow us to use a complex</span>
00497     <span class="comment">// hotkey such as LSHIFT+RMENU+SPACE</span>
00498     <span class="comment">//</span>
00499 
00500     <span class="comment">//</span>
00501     <span class="comment">// Setup the shift, control, alt key states</span>
00502     <span class="comment">//</span>
00503     uModifiers |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a837">TestKeyStateDown</a>(pq, VK_LSHIFT) ? (MOD_SHIFT | MOD_LEFT) : 0;
00504     uModifiers |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a837">TestKeyStateDown</a>(pq, VK_RSHIFT) ? (MOD_SHIFT | MOD_RIGHT) : 0;
00505 
00506     uModifiers |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a837">TestKeyStateDown</a>(pq, VK_LCONTROL) ? (MOD_CONTROL | MOD_LEFT) : 0;
00507     uModifiers |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a837">TestKeyStateDown</a>(pq, VK_RCONTROL) ? (MOD_CONTROL | MOD_RIGHT) : 0;
00508 
00509     uModifiers |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a837">TestKeyStateDown</a>(pq, VK_LMENU) ? (MOD_ALT | MOD_LEFT) : 0;
00510     uModifiers |= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a837">TestKeyStateDown</a>(pq, VK_RMENU) ? (MOD_ALT | MOD_RIGHT) : 0;
00511 
00512     ph = <a class="code" href="../../d1/d0/imehotky_8c.html#a11">FindImeHotKeyByKey</a>( gpImeHotKeyListHeader,
00513                              uModifiers &amp; MOD_MODIFY_KEYS,
00514                              uModifiers &amp; MOD_BOTH_SIDES,
00515                              uVKey );
00516 
00517     <span class="keywordflow">if</span> ( ph != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00518         <span class="keywordflow">if</span> ( fKeyUp ) {
00519             <span class="keywordflow">if</span> ( ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a> &amp; MOD_ON_KEYUP ) {
00520                 <span class="keywordflow">return</span> ph;
00521             }
00522         } <span class="keywordflow">else</span> {
00523             <span class="keywordflow">if</span> ( ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a> &amp; MOD_ON_KEYUP ) {
00524             <span class="comment">//</span>
00525             <span class="comment">// save vkey for next keyup message time</span>
00526             <span class="comment">//</span>
00527             <span class="comment">// when ALT+Z is a hotkey, we don't want</span>
00528             <span class="comment">// to handle #2 as the hotkey sequence.</span>
00529             <span class="comment">// 1) ALT make -&gt; 'Z' make -&gt; 'Z' break</span>
00530             <span class="comment">// 2) 'Z' make -&gt; ALT make -&gt; 'Z' break</span>
00531             <span class="comment">//</span>
00532                 uVKeySaved = uVKey;
00533             } <span class="keywordflow">else</span> {
00534                 <span class="keywordflow">return</span> ph;
00535             }
00536         }
00537     }
00538 
00539     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00540 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="imehotky.c::DeleteImeHotKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> DeleteImeHotKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>ppHead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pDelete</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00219">219</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00091">_tagIMEHOTKEYOBJ::pNext</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00106">SetImeHotKey()</a>.
<p>
<pre class="fragment"><div>00220 {
00221     <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> ph;
00222 
00223     <span class="keywordflow">if</span> ( pDelete == *ppHead ) {
00224         *ppHead = pDelete-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a>;
00225         <span class="keywordflow">return</span> pDelete;
00226     }
00227 
00228     <span class="keywordflow">for</span> ( ph = *ppHead; ph != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; ph = ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a> ) {
00229         <span class="keywordflow">if</span> ( ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a> == pDelete ) {
00230             ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a> = pDelete-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a>;
00231             <span class="keywordflow">return</span> pDelete;
00232         }
00233     }
00234     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00235 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="imehotky.c::FindImeHotKeyByID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> FindImeHotKeyByID           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pHead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwHotKeyID</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00404">404</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
References <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00081">_tagIMEHOTKEY::dwHotKeyID</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00092">_tagIMEHOTKEYOBJ::hk</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00091">_tagIMEHOTKEYOBJ::pNext</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00071">GetImeHotKey()</a>, and <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00106">SetImeHotKey()</a>.
<p>
<pre class="fragment"><div>00405 {
00406     <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> ph;
00407 
00408     <span class="keywordflow">for</span> ( ph = pHead; ph != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; ph = ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a> ) {
00409         <span class="keywordflow">if</span> ( ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a> == dwHotKeyID )
00410                 <span class="keywordflow">return</span> (ph);
00411     }
00412     <span class="keywordflow">return</span> (<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00413 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="imehotky.c::FindImeHotKeyByKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> FindImeHotKeyByKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pHead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uModifyKeys</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uRL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uVKey</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00315">315</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00081">_tagIMEHOTKEY::dwHotKeyID</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d7/ntinput_8c-source.html#l00439">GetActiveHKL()</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00046">GetHotKeyLangID()</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00266">GetLangIdMatchLevel()</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00092">_tagIMEHOTKEYOBJ::hk</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03381">tagTHREADINFO::hklPrev</a>, <a class="el" href="../../d1/d0/imehotky_8c.html#a20a8">ILANG_MATCH_PERFECT</a>, <a class="el" href="../../d1/d0/imehotky_8c.html#a20a5">ILANG_NO_MATCH</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00075">MOD_BOTH_SIDES</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00074">MOD_MODIFY_KEYS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00091">_tagIMEHOTKEYOBJ::pNext</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00083">_tagIMEHOTKEY::uModifiers</a>, and <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00082">_tagIMEHOTKEY::uVKey</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00461">CheckImeHotKey()</a>.
<p>
<pre class="fragment"><div>00320 {
00321     <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>();
00322     <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> phResult = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00323     <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> ph;
00324     HKL hkl = <a class="code" href="../../d6/d8/ntinput_8c.html#a43">GetActiveHKL</a>();
00325     WORD langPrimary = PRIMARYLANGID(LOWORD(HandleToUlong(hkl)));
00326     <span class="keywordtype">int</span> iLevel = <a class="code" href="../../d1/d0/imehotky_8c.html#a20a5">ILANG_NO_MATCH</a>;
00327 
00328     <span class="keywordflow">for</span> (ph = pHead; ph != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; ph = ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a>) {
00329 
00330         <span class="keywordflow">if</span> (ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o1">uVKey</a> == uVKey) {
00331             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fDoCheck = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00332 
00333             <span class="comment">// Check if the modifiers match</span>
00334             <span class="keywordflow">if</span> ((ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a> &amp; MOD_IGNORE_ALL_MODIFIER)) {
00335                 fDoCheck = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00336             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a> &amp; <a class="code" href="../../d8/d0/immstruc_8h.html#a26">MOD_MODIFY_KEYS</a>) != uModifyKeys) {
00337                 <span class="keywordflow">continue</span>;
00338             }
00339 
00340             <span class="keywordflow">if</span> ((ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a> &amp; <a class="code" href="../../d8/d0/immstruc_8h.html#a27">MOD_BOTH_SIDES</a>) == uRL ||
00341                     (ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a> &amp; <a class="code" href="../../d8/d0/immstruc_8h.html#a27">MOD_BOTH_SIDES</a>) &amp; uRL) {
00342                 fDoCheck = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00343             }
00344 
00345             <span class="keywordflow">if</span> (fDoCheck) {
00346                 LANGID langId = <a class="code" href="../../d1/d0/imehotky_8c.html#a14">GetHotKeyLangID</a>(ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a>);
00347                 <span class="keywordtype">int</span> iMatch = <a class="code" href="../../d1/d0/imehotky_8c.html#a18">GetLangIdMatchLevel</a>(hkl, langId);
00348 
00349 <span class="preprocessor">#if 0   // Test only</span>
00350 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (iMatch != <a class="code" href="../../d1/d0/imehotky_8c.html#a20a5">ILANG_NO_MATCH</a>) {
00351                     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"GetIdMatchLevel(%X, %X)=%d\n"</span>, hkl, langId);
00352                 }
00353 <span class="preprocessor">#endif</span>
00354 <span class="preprocessor"></span>
00355                 <span class="keywordflow">if</span> (iMatch == <a class="code" href="../../d1/d0/imehotky_8c.html#a20a8">ILANG_MATCH_PERFECT</a>) {
00356                     <span class="comment">// Perfect match !</span>
00357                     <span class="keywordflow">return</span> ph;
00358                 }
00359 
00360                 <span class="comment">// If the hotkey is DSWITCH, GetLangIdMatchLevel() must return 3.</span>
00361                 UserAssert(ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a> &lt; IME_HOTKEY_DSWITCH_FIRST ||
00362                            ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a> &gt; IME_HOTKEY_DSWITCH_LAST);
00363 
00364                 <span class="keywordflow">if</span> (langPrimary == LANG_KOREAN) {
00365                     <span class="comment">// Korean IME wants no hotkeys except the direct</span>
00366                     <span class="comment">// keyboard layout switching hotkeys.</span>
00367                     <span class="keywordflow">continue</span>;
00368                 }
00369 
00370                 <span class="keywordflow">if</span> (iMatch == <a class="code" href="../../d1/d0/imehotky_8c.html#a20a5">ILANG_NO_MATCH</a>) {
00371                     <span class="comment">// Special case for CHT/CHS toggle</span>
00372                     <span class="keywordflow">if</span> (ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a> == IME_CHOTKEY_IME_NONIME_TOGGLE ||
00373                             ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a> == IME_THOTKEY_IME_NONIME_TOGGLE) {
00374                         <span class="comment">//</span>
00375                         <span class="comment">// If the key is for CHT/CHS toggle and the previous</span>
00376                         <span class="comment">// hkl is either CHT/CHS, it is a IME hotkey.</span>
00377                         <span class="comment">//</span>
00378                         <span class="keywordflow">if</span> (LOWORD(HandleToUlong(ptiCurrent-&gt;<a class="code" href="../../d2/d8/structtagTHREADINFO.html#o41">hklPrev</a>)) == langId) {
00379 <span class="preprocessor">#if 0   // Test only</span>
00380 <span class="preprocessor"></span>                            <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"FindImeHotKeyByKey() found CHT/CHS hotkey.\n"</span>);
00381 <span class="preprocessor">#endif</span>
00382 <span class="preprocessor"></span>                            <span class="keywordflow">return</span> ph;
00383                         }
00384                     }
00385                 }
00386                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iMatch &gt; iLevel) {
00387                     <span class="comment">// Current ph is the strongest candidate so far.</span>
00388                     iLevel = iMatch;
00389                     phResult = ph;
00390                 }
00391             }
00392         }
00393     }
00394 
00395     <span class="keywordflow">return</span> phResult;
00396 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="imehotky.c::FindImeHotKeyByKeyWithLang" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> FindImeHotKeyByKeyWithLang           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pHead</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uModifyKeys</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uRL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uVKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LANGID&nbsp;</td>
          <td class="mdname" nowrap> <em>langId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00421">421</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
References <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00081">_tagIMEHOTKEY::dwHotKeyID</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00046">GetHotKeyLangID()</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00092">_tagIMEHOTKEYOBJ::hk</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00075">MOD_BOTH_SIDES</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00074">MOD_MODIFY_KEYS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00091">_tagIMEHOTKEYOBJ::pNext</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00083">_tagIMEHOTKEY::uModifiers</a>, and <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00082">_tagIMEHOTKEY::uVKey</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00106">SetImeHotKey()</a>.
<p>
<pre class="fragment"><div>00427 {
00428     <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> ph;
00429 
00430     <span class="keywordflow">for</span> (ph = pHead; ph != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; ph = ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a>) {
00431 
00432         <span class="keywordflow">if</span> (ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o1">uVKey</a> == uVKey) {
00433             <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> fDoCheck = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00434 
00435             <span class="comment">// Check if the modifiers match</span>
00436             <span class="keywordflow">if</span> ((ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a> &amp; MOD_IGNORE_ALL_MODIFIER)) {
00437                 fDoCheck = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00438             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a> &amp; <a class="code" href="../../d8/d0/immstruc_8h.html#a26">MOD_MODIFY_KEYS</a>) != uModifyKeys) {
00439                 <span class="keywordflow">continue</span>;
00440             }
00441 
00442             <span class="keywordflow">if</span> ((ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a> &amp; <a class="code" href="../../d8/d0/immstruc_8h.html#a27">MOD_BOTH_SIDES</a>) == uRL ||
00443                     (ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a> &amp; <a class="code" href="../../d8/d0/immstruc_8h.html#a27">MOD_BOTH_SIDES</a>) &amp; uRL) {
00444                 fDoCheck = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00445             }
00446 
00447             <span class="keywordflow">if</span> (fDoCheck) {
00448                 LANGID langId = <a class="code" href="../../d1/d0/imehotky_8c.html#a14">GetHotKeyLangID</a>(ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a>);
00449 
00450                 <span class="keywordflow">if</span> (langIdKey == langId || langId == LANG_NEUTRAL) {
00451                     <span class="keywordflow">return</span> ph;
00452                 }
00453             }
00454         }
00455     }
00456 
00457     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00458 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="imehotky.c::FreeImeHotKeys" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID FreeImeHotKeys           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00252">252</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
References <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00275">gpImeHotKeyListHeader</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00091">_tagIMEHOTKEYOBJ::pNext</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
Referenced by <a class="el" href="../../d8/d0/w32_2ntuser_2kernel_2init_8c-source.html#l00097">Win32kNtUserCleanup()</a>.
<p>
<pre class="fragment"><div>00253 {
00254     <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> phk;
00255 
00256     <span class="keywordflow">while</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a119">gpImeHotKeyListHeader</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00257         phk = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a119">gpImeHotKeyListHeader</a>-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a>;
00258         UserFreePool(gpImeHotKeyListHeader);
00259         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a119">gpImeHotKeyListHeader</a> = phk;
00260     }
00261 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="imehotky.c::GetHotKeyLangID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LANGID GetHotKeyLangID           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>dwHotKeyID</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00046">46</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
References <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00028">L_CHS</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00031">L_CHT</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00029">L_JPN</a>, and <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00030">L_KOR</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00315">FindImeHotKeyByKey()</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00421">FindImeHotKeyByKeyWithLang()</a>, and <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00106">SetImeHotKey()</a>.
<p>
<pre class="fragment"><div>00047 {
00048     LANGID langId = -1;
00049     <span class="keyword">static</span> CONST LANGID aLangId[] = {
00050         ~0,             <span class="comment">// 0x00 - 0x0f: illegal</span>
00051         <a class="code" href="../../d1/d0/imehotky_8c.html#a0">L_CHS</a>, <a class="code" href="../../d1/d0/imehotky_8c.html#a0">L_CHS</a>,   <span class="comment">// 0x10 - 0x2f</span>
00052         <a class="code" href="../../d1/d0/imehotky_8c.html#a1">L_JPN</a>, <a class="code" href="../../d1/d0/imehotky_8c.html#a1">L_JPN</a>,   <span class="comment">// 0x30 - 0x4f</span>
00053         <a class="code" href="../../d1/d0/imehotky_8c.html#a2">L_KOR</a>, <a class="code" href="../../d1/d0/imehotky_8c.html#a2">L_KOR</a>,   <span class="comment">// 0x50 - 0x6f</span>
00054         <a class="code" href="../../d1/d0/imehotky_8c.html#a3">L_CHT</a>, <a class="code" href="../../d1/d0/imehotky_8c.html#a3">L_CHT</a>,   <span class="comment">// 0x70 - 0x8f</span>
00055     };
00056 
00057     <span class="keywordflow">if</span> (dwHotKeyID &gt;= IME_CHOTKEY_FIRST &amp;&amp; dwHotKeyID &lt;= IME_THOTKEY_LAST) {
00058         langId = aLangId[dwHotKeyID &gt;&gt; 4];
00059     }
00060     <span class="keywordflow">else</span> {
00061         langId = LANG_NEUTRAL;
00062     }
00063 
00064     <span class="comment">// Because KOR IME does not want IME hot key handling</span>
00065     UserAssert(langId != L_KOR);
00066 
00067     <span class="keywordflow">return</span> langId;
00068 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="imehotky.c::GetImeHotKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL GetImeHotKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwHotKeyID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d5/ndismain_8h.html#a266">PUINT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>puModifiers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d5/ndismain_8h.html#a266">PUINT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>puVKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HKL *&nbsp;</td>
          <td class="mdname" nowrap> <em>phKL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00071">71</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00404">FindImeHotKeyByID()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00275">gpImeHotKeyListHeader</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00092">_tagIMEHOTKEYOBJ::hk</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00084">_tagIMEHOTKEY::hKL</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00083">_tagIMEHOTKEY::uModifiers</a>, and <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00082">_tagIMEHOTKEY::uVKey</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l12826">NtUserGetImeHotKey()</a>.
<p>
<pre class="fragment"><div>00076 {
00077     <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> ph;
00078 
00079     ph = <a class="code" href="../../d1/d0/imehotky_8c.html#a12">FindImeHotKeyByID</a>( gpImeHotKeyListHeader, dwHotKeyID );
00080     <span class="keywordflow">if</span> ( ph == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00081         RIPERR0(ERROR_HOTKEY_NOT_REGISTERED, RIP_VERBOSE, <span class="stringliteral">"No such IME hotkey"</span>);
00082         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00083     }
00084 
00085     <span class="comment">//</span>
00086     <span class="comment">// it is OK for NULL phKL, if the target hKL is NULL</span>
00087     <span class="comment">//</span>
00088     <span class="keywordflow">if</span> ( phKL ) {
00089        *phKL = ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o3">hKL</a>;
00090     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o3">hKL</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00091         RIPERR0(ERROR_INVALID_PARAMETER, RIP_WARNING, <span class="stringliteral">"phKL is null"</span>);
00092         <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00093     }
00094 
00095     *puModifiers = ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a>;
00096     *puVKey = ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o1">uVKey</a>;
00097 
00098     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00099 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="imehotky.c::GetLangIdMatchLevel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int GetLangIdMatchLevel           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HKL&nbsp;</td>
          <td class="mdname" nowrap> <em>hkl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LANGID&nbsp;</td>
          <td class="mdname" nowrap> <em>langId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00266">266</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00264">glcidSystem</a>, <a class="el" href="../../d1/d0/imehotky_8c.html#a20a8">ILANG_MATCH_PERFECT</a>, <a class="el" href="../../d1/d0/imehotky_8c.html#a20a6">ILANG_MATCH_SYSTEM</a>, <a class="el" href="../../d1/d0/imehotky_8c.html#a20a7">ILANG_MATCH_THREAD</a>, and <a class="el" href="../../d1/d0/imehotky_8c.html#a20a5">ILANG_NO_MATCH</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00315">FindImeHotKeyByKey()</a>.
<p>
<pre class="fragment"><div>00267 {
00268 
00269     <span class="keywordflow">if</span> (langId == LANG_NEUTRAL) {
00270         <span class="comment">//</span>
00271         <span class="comment">// If langId is LANG_NEUTRAL, the hot key does not depend on</span>
00272         <span class="comment">// the current HKL. Make it perfect match always.</span>
00273         <span class="comment">//</span>
00274         <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/imehotky_8c.html#a20a8">ILANG_MATCH_PERFECT</a>;
00275     }
00276 
00277     {
00278         LCID lcid;
00279 
00280         <span class="keywordflow">if</span> (LOWORD(HandleToUlong(hkl)) == langId) {
00281             <span class="comment">// langId matches the current KL locale</span>
00282             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/imehotky_8c.html#a20a8">ILANG_MATCH_PERFECT</a>;
00283         }
00284 
00285         lcid = NtCurrentTeb()-&gt;CurrentLocale;
00286         <span class="keywordflow">if</span> (LANGIDFROMLCID(lcid) == langId) {
00287             <span class="comment">// langId matches the current thread's locale</span>
00288             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/imehotky_8c.html#a20a7">ILANG_MATCH_THREAD</a>;
00289         }
00290 
00291         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/imehotky_8c.html#a4">glcidSystem</a> == 0) {
00292             <span class="comment">// If we've not got system default locale yet, get it here.</span>
00293             ZwQueryDefaultLocale(FALSE, &amp;glcidSystem);
00294         }
00295         <span class="keywordflow">if</span> (LANGIDFROMLCID(glcidSystem) == langId) {
00296             <span class="comment">// langId matches the system locale.</span>
00297             <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/imehotky_8c.html#a20a6">ILANG_MATCH_SYSTEM</a>;
00298         }
00299     }
00300 
00301     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/imehotky_8c.html#a20a5">ILANG_NO_MATCH</a>;
00302 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="imehotky.c::SetImeHotKey" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL SetImeHotKey           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwHotKeyID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uModifiers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>uVKey</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HKL&nbsp;</td>
          <td class="mdname" nowrap> <em>hKL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwAction</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00106">106</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
References <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00237">AddImeHotKey()</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00219">DeleteImeHotKey()</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00081">_tagIMEHOTKEY::dwHotKeyID</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00404">FindImeHotKeyByID()</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00421">FindImeHotKeyByKeyWithLang()</a>, <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00046">GetHotKeyLangID()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00275">gpImeHotKeyListHeader</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00092">_tagIMEHOTKEYOBJ::hk</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00084">_tagIMEHOTKEY::hKL</a>, <a class="el" href="../../d8/d0/immstruc_8h.html#a35">IMEHOTKEYOBJ</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00077">ISHK_ADD</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00078">ISHK_INITIALIZE</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00076">ISHK_REMOVE</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00075">MOD_BOTH_SIDES</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00074">MOD_MODIFY_KEYS</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00091">_tagIMEHOTKEYOBJ::pNext</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00083">_tagIMEHOTKEY::uModifiers</a>, and <a class="el" href="../../d9/d9/immstruc_8h-source.html#l00082">_tagIMEHOTKEY::uVKey</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l12863">NtUserSetImeHotKey()</a>.
<p>
<pre class="fragment"><div>00112 {
00113     <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> ph;
00114 
00115     <span class="keywordflow">switch</span> ( dwAction ) {
00116     <span class="keywordflow">case</span> <a class="code" href="../../d8/d0/immstruc_8h.html#a28">ISHK_REMOVE</a>:
00117         ph = <a class="code" href="../../d1/d0/imehotky_8c.html#a12">FindImeHotKeyByID</a>( gpImeHotKeyListHeader, dwHotKeyID );
00118         <span class="keywordflow">if</span> ( ph != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00119             <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d0/imehotky_8c.html#a9">DeleteImeHotKey</a>( &amp;gpImeHotKeyListHeader, ph ) == ph ) {
00120                 UserFreePool( ph );
00121                 <span class="keywordflow">return</span> ( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00122             } <span class="keywordflow">else</span> {
00123                 RIPMSG0( RIP_ERROR, <span class="stringliteral">"IME hotkey list is messed up"</span> );
00124                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00125             }
00126         } <span class="keywordflow">else</span> {
00127             RIPERR0( ERROR_INVALID_PARAMETER,
00128                      RIP_WARNING,
00129                      <span class="stringliteral">"no such IME hotkey registered"</span>);
00130             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00131         }
00132         <span class="keywordflow">break</span>;
00133 
00134     <span class="keywordflow">case</span> <a class="code" href="../../d8/d0/immstruc_8h.html#a30">ISHK_INITIALIZE</a>:
00135         ph = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a119">gpImeHotKeyListHeader</a>;
00136         <span class="keywordflow">while</span> ( ph != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00137             <a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a> phNext;
00138 
00139             phNext = ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a>;
00140             UserFreePool( ph );
00141             ph = phNext;
00142         }
00143         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a119">gpImeHotKeyListHeader</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00144         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00145 
00146     <span class="keywordflow">case</span> <a class="code" href="../../d8/d0/immstruc_8h.html#a29">ISHK_ADD</a>:
00147         <span class="keywordflow">if</span> (dwHotKeyID &gt;= IME_KHOTKEY_FIRST &amp;&amp; dwHotKeyID &lt;= IME_KHOTKEY_LAST) {
00148             <span class="comment">// Korean IME does not want any IMM hotkey handling.</span>
00149             <span class="comment">// We should not register any Korean IME hot keys.</span>
00150             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00151         }
00152 
00153         <span class="keywordflow">if</span> ((WORD)uVKey == VK_PACKET) {
00154             <span class="comment">//</span>
00155             <span class="comment">// VK_PACKET should not be a IME hot key.</span>
00156             <span class="comment">//</span>
00157             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00158         }
00159 
00160         ph = <a class="code" href="../../d1/d0/imehotky_8c.html#a13">FindImeHotKeyByKeyWithLang</a>(gpImeHotKeyListHeader,
00161                                 uModifiers &amp; MOD_MODIFY_KEYS,
00162                                 uModifiers &amp; MOD_BOTH_SIDES,
00163                                 uVKey,
00164                                 <a class="code" href="../../d1/d0/imehotky_8c.html#a14">GetHotKeyLangID</a>(dwHotKeyID));
00165         <span class="keywordflow">if</span> ( ph != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00166             <span class="keywordflow">if</span> ( ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a> != dwHotKeyID ) {
00167                 RIPERR0( ERROR_HOTKEY_ALREADY_REGISTERED,
00168                          RIP_WARNING,
00169                          <span class="stringliteral">"There is an IME hotkey that has the same vkey/modifiers/Lang Id"</span>);
00170                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00171             }
00172             <span class="comment">// So far we found a hotkey that has the</span>
00173             <span class="comment">// same vkey and same ID.</span>
00174             <span class="comment">// But because modifiers may be slightly</span>
00175             <span class="comment">// different, so go ahead and change it.</span>
00176         } <span class="keywordflow">else</span> {
00177             <span class="comment">//</span>
00178             <span class="comment">// the specified vkey/modifiers combination cound not be found</span>
00179             <span class="comment">// in the hotkey list. The caller may want to change the key</span>
00180             <span class="comment">// assignment of an existing hotkey or add a new hotkey.</span>
00181             <span class="comment">//</span>
00182             ph = <a class="code" href="../../d1/d0/imehotky_8c.html#a12">FindImeHotKeyByID</a>( gpImeHotKeyListHeader, dwHotKeyID );
00183         }
00184 
00185         <span class="keywordflow">if</span> ( ph == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00186         <span class="comment">//</span>
00187         <span class="comment">// adding a new hotkey</span>
00188         <span class="comment">//</span>
00189             ph = (<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">PIMEHOTKEYOBJ</a>)UserAllocPool( <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html">IMEHOTKEYOBJ</a>), TAG_IMEHOTKEY );
00190             <span class="keywordflow">if</span> ( ph == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00191                 RIPERR0( ERROR_OUTOFMEMORY,
00192                          RIP_WARNING,
00193                         <span class="stringliteral">"Memory allocation failed in SetImeHotKey"</span>);
00194                 <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00195             }
00196             ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o0">dwHotKeyID</a> = dwHotKeyID;
00197             ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a> = uModifiers;
00198             ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o1">uVKey</a> = uVKey;
00199             ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o3">hKL</a> = hKL;
00200             ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o0">pNext</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00201             <a class="code" href="../../d1/d0/imehotky_8c.html#a10">AddImeHotKey</a>( &amp;gpImeHotKeyListHeader, ph );
00202 
00203         } <span class="keywordflow">else</span> {
00204         <span class="comment">//</span>
00205         <span class="comment">// changing an existing hotkey</span>
00206         <span class="comment">//</span>
00207             ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o2">uModifiers</a> = uModifiers;
00208             ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o1">uVKey</a> = uVKey;
00209             ph-&gt;<a class="code" href="../../d8/d8/struct__tagIMEHOTKEYOBJ.html#o1">hk</a>.<a class="code" href="../../d7/d8/struct__tagIMEHOTKEY.html#o3">hKL</a> = hKL;
00210 
00211         }
00212         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00213     }
00214 
00215     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00216 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a4" doxytag="imehotky.c::glcidSystem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LCID <a class="el" href="../../d1/d0/imehotky_8c.html#a4">glcidSystem</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00264">264</a> of file <a class="el" href="../../d2/d9/imehotky_8c-source.html">imehotky.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d9/imehotky_8c-source.html#l00266">GetLangIdMatchLevel()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:09 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
