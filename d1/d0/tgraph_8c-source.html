<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: tgraph.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>tgraph.c</h1><a href="../../d0/d1/tgraph_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*</span>
00002 <span class="comment">* Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00003 <span class="comment">*/</span>
00004 
00005 <span class="preprocessor">#include "<a class="code" href="../../d4/d3/w32_2ntcon_2client_2precomp_8h.html">precomp.h</a>"</span>
00006 <span class="preprocessor">#pragma hdrstop</span>
00007 <span class="preprocessor"></span><span class="preprocessor">#pragma hdrstop</span>
<a name="l00008"></a><a class="code" href="../../d0/d1/tgraph_8c.html#a0">00008</a> <span class="preprocessor"></span><span class="preprocessor">#define FOREGROUND_WHITE (FOREGROUND_BLUE | FOREGROUND_GREEN | FOREGROUND_RED)</span>
00009 <span class="preprocessor"></span>
00010 
<a name="l00011"></a><a class="code" href="../../d9/d3/struct__BITMAPINFOPAT.html">00011</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="../../d9/d3/struct__BITMAPINFOPAT.html">_BITMAPINFOPAT</a>
00012 {
<a name="l00013"></a><a class="code" href="../../d9/d3/struct__BITMAPINFOPAT.html#o0">00013</a>     BITMAPINFOHEADER                 <a class="code" href="../../d9/d3/struct__BITMAPINFOPAT.html#o0">bmiHeader</a>;
<a name="l00014"></a><a class="code" href="../../d9/d3/struct__BITMAPINFOPAT.html#o1">00014</a>     RGBQUAD                          <a class="code" href="../../d9/d3/struct__BITMAPINFOPAT.html#o1">bmiColors</a>[16];
00015 } <a class="code" href="../../d9/d3/struct__BITMAPINFOPAT.html">BITMAPINFOPAT</a>;
00016 
<a name="l00017"></a><a class="code" href="../../d0/d1/tgraph_8c.html#a2">00017</a> <a class="code" href="../../d9/d3/struct__BITMAPINFOPAT.html">BITMAPINFOPAT</a> <a class="code" href="../../d0/d1/tgraph_8c.html#a2">bmiPat</a> =
00018 {
00019     {
00020         <span class="keyword">sizeof</span>(BITMAPINFOHEADER),
00021         128,
00022         32,
00023         1,
00024         1,
00025         BI_RGB,
00026         (32 * 128 / 8),
00027         0,
00028         0,
00029         2,
00030         2
00031     },
00032 
00033     {                               <span class="comment">// B    G    R</span>
00034         { 0,   0,   0x80,0 },       <span class="comment">// 1</span>
00035         { 0,   0x80,0,   0 },       <span class="comment">// 2</span>
00036         { 0,   0,   0,   0 },       <span class="comment">// 0</span>
00037         { 0,   0x80,0x80,0 },       <span class="comment">// 3</span>
00038         { 0x80,0,   0,   0 },       <span class="comment">// 4</span>
00039         { 0x80,0,   0x80,0 },       <span class="comment">// 5</span>
00040         { 0x80,0x80,0,   0 },       <span class="comment">// 6</span>
00041         { 0xC0,0xC0,0xC0,0 },       <span class="comment">// 7</span>
00042 
00043         { 0x80,0x80,0x80,0 },       <span class="comment">// 8</span>
00044         { 0,   0,   0xFF,0 },       <span class="comment">// 9</span>
00045         { 0,   0xFF,0,   0 },       <span class="comment">// 10</span>
00046         { 0,   0xFF,0xFF,0 },       <span class="comment">// 11</span>
00047         { 0xFF,0,   0,   0 },       <span class="comment">// 12</span>
00048         { 0xFF,0,   0xFF,0 },       <span class="comment">// 13</span>
00049         { 0xFF,0xFF,0,   0 },       <span class="comment">// 14</span>
00050         { 0xFF,0xFF,0xFF,0 }        <span class="comment">// 15</span>
00051     }
00052 };
00053 
<a name="l00054"></a><a class="code" href="../../d0/d1/tgraph_8c.html#a3">00054</a> <span class="keyword">static</span> <a class="code" href="../../d9/d7/halvprnt_8c.html#a0">BYTE</a> <a class="code" href="../../d0/d1/tgraph_8c.html#a3">abBigCat</a>[] = {
00055                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00056                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00057                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00058                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00059                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00060                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00061                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00062                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00063 
00064                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00065                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00066                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00067                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00068                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00069                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00070                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00071                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00072 
00073                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00074                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00075                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00076                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00077                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00078                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00079                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00080                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00081 
00082                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00083                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00084                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00085                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00086                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00087                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
00088                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
00089                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};
00090 
00091 
00092 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00093"></a><a class="code" href="../../d0/d1/tgraph_8c.html#a4">00093</a> <a class="code" href="../../d2/d5/editreg_8c.html#a87">main</a>(
00094     <span class="keywordtype">int</span> argc,
00095     <span class="keywordtype">char</span> *argv[]
00096     )
00097 {
00098     SECURITY_ATTRIBUTES SecurityAttributes;
00099     HANDLE <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00100     <span class="keywordtype">int</span> i;
00101     CONSOLE_GRAPHICS_BUFFER_INFO GraphicsInfo;
00102     SMALL_RECT <a class="code" href="../../d5/d6/structRect.html">Rect</a>;
00103     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> Success;
00104     ULONG NumWritten;
00105 
00106     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"TGRAPH: Entering graphics Test Program\n"</span> );
00107 
00108 
00109         <span class="comment">//</span>
00110         <span class="comment">// open a new console</span>
00111         <span class="comment">//</span>
00112 
00113         SecurityAttributes.bInheritHandle = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00114         SecurityAttributes.lpSecurityDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00115         SecurityAttributes.nLength = <span class="keyword">sizeof</span> (SECURITY_ATTRIBUTES);
00116         GraphicsInfo.dwBitMapInfoLength = <span class="keyword">sizeof</span>(<a class="code" href="../../d0/d1/tgraph_8c.html#a2">bmiPat</a>);
00117         GraphicsInfo.lpBitMapInfo = &amp;<a class="code" href="../../d0/d1/tgraph_8c.html#a2">bmiPat</a>;
00118         GraphicsInfo.dwUsage = DIB_RGB_COLORS;
00119         <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> = <a class="code" href="../../d3/d6/iostubs_8c.html#a30">CreateConsoleScreenBuffer</a>(GENERIC_READ | GENERIC_WRITE,
00120                                            FILE_SHARE_READ | FILE_SHARE_WRITE,
00121                                            &amp;SecurityAttributes,
00122                                            <a class="code" href="../../d7/d2/output_8h.html#a1">CONSOLE_GRAPHICS_BUFFER</a>,
00123                                            &amp;GraphicsInfo
00124                                           );
00125         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> == (HANDLE)-1) {
00126             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CreateConsoleScreenBuffer failed\n"</span>);
00127             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00128         }
00129 
00130         <span class="comment">//</span>
00131         <span class="comment">// make it current</span>
00132         <span class="comment">//</span>
00133 
00134         <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d4/ntcon_2client_2getset_8c.html#a12">SetConsoleActiveScreenBuffer</a>(<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>)) {
00135             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SetConsoleActiveScreenBuffer failed\n"</span>);
00136             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00137         }
00138         <span class="comment">/*</span>
00139 <span class="comment">        //</span>
00140 <span class="comment">        // try to write to it.  should fail.</span>
00141 <span class="comment">        //</span>
00142 <span class="comment"></span>
00143 <span class="comment">        Success = WriteFile(Handle,"foo",3,&amp;NumWritten,NULL);</span>
00144 <span class="comment">        if (!Success) {</span>
00145 <span class="comment">            DbgPrint("WriteFile failed\n");</span>
00146 <span class="comment">        }</span>
00147 <span class="comment">        else {</span>
00148 <span class="comment">            DbgPrint("WriteFile succeeded\n");</span>
00149 <span class="comment">        }</span>
00150 <span class="comment">        */</span>
00151         <span class="comment">//</span>
00152         <span class="comment">// grab mutex</span>
00153         <span class="comment">//</span>
00154 
00155         Success = WaitForSingleObject(GraphicsInfo.hMutex,-1);
00156         <span class="keywordflow">if</span> (Success) {
00157             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"WaitForSingleObject failed\n"</span>);
00158         }
00159         <span class="keywordflow">else</span> {
00160             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"WaitForSingleObject succeeded\n"</span>);
00161         }
00162 
00163         <span class="comment">//</span>
00164         <span class="comment">// write bitmap to memory</span>
00165         <span class="comment">//</span>
00166 
00167         RtlCopyMemory(GraphicsInfo.lpBitMap,<a class="code" href="../../d0/d1/tgraph_8c.html#a3">abBigCat</a>,(32*128/8));
00168 
00169         <span class="comment">//</span>
00170         <span class="comment">// release mutex</span>
00171         <span class="comment">//</span>
00172 
00173         ReleaseMutex(GraphicsInfo.hMutex);
00174 
00175         <span class="comment">//</span>
00176         <span class="comment">// write bitmap to memory</span>
00177         <span class="comment">//</span>
00178 
00179         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.Left = 0;
00180         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.Top =  0;
00181         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.Right = 31;
00182         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>.Bottom = 31;
00183         Success = <a class="code" href="../../d3/d6/iostubs_8c.html#a31">InvalidateConsoleDIBits</a>(<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>,&amp;<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a32">Rect</a>);
00184         <span class="keywordflow">if</span> (!Success) {
00185             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"InvalidateConsoleDIBits failed\n"</span>);
00186         }
00187         <span class="keywordflow">else</span> {
00188             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"InvalidateConsoleDIBits succeeded\n"</span>);
00189         }
00190 
00191         <span class="comment">/*</span>
00192 <span class="comment">        i=0;</span>
00193 <span class="comment">        while (i&lt;20) {</span>
00194 <span class="comment">            INPUT_RECORD Buffer;</span>
00195 <span class="comment">            DWORD NumRead;</span>
00196 <span class="comment"></span>
00197 <span class="comment">            ReadConsoleInput(GetStdHandle(STD_INPUT_HANDLE),</span>
00198 <span class="comment">                             &amp;Buffer,</span>
00199 <span class="comment">                             1,</span>
00200 <span class="comment">                             &amp;NumRead);</span>
00201 <span class="comment">            if (Buffer.EventType == MOUSE_EVENT) {</span>
00202 <span class="comment">                DbgPrint("Mouse position is %d %d\n",</span>
00203 <span class="comment">                          Buffer.Event.MouseEvent.dwMousePosition.X,</span>
00204 <span class="comment">                          Buffer.Event.MouseEvent.dwMousePosition.Y);</span>
00205 <span class="comment">                i++;</span>
00206 <span class="comment">            }</span>
00207 <span class="comment">        }</span>
00208 <span class="comment">        */</span>
00209 
00210         <span class="keywordflow">while</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00211             Sleep(10000);
00212         }
00213 
00214         <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d4/ntcon_2client_2getset_8c.html#a12">SetConsoleActiveScreenBuffer</a>(GetStdHandle(<a class="code" href="../../d5/d5/rdwr_8c.html#a10">STD_OUTPUT_HANDLE</a>))) {
00215             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SetConsoleActiveScreenBuffer failed\n"</span>);
00216             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00217         }
00218 
00219         <span class="keywordflow">if</span> (!CloseHandle(<a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>)) {
00220             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CloseHandle failed\n"</span>);
00221             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00222         }
00223 
00224     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>( <span class="stringliteral">"TGRAPH: Exiting Test Program\n"</span> );
00225 
00226     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00227 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:41:57 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
