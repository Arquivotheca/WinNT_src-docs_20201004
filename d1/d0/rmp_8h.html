<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: rmp.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>rmp.h File Reference</h1><code>#include &lt;nt.h&gt;</code><br>
<code>#include &lt;ntlsa.h&gt;</code><br>
<code>#include "<a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>"</code><br>

<p>
<a href="../../d2/d9/rmp_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d2/struct__SEP__RM__STATE.html">_SEP_RM_STATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">_SEP_RM_CONNECT_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">_SEP_LOGON_SESSION_REFERENCES</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">_SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a0">SEP_LOGON_TRACK_INDEX_MASK</a>&nbsp;&nbsp;&nbsp;(0x0000000FL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a1">SEP_LOGON_TRACK_ARRAY_SIZE</a>&nbsp;&nbsp;&nbsp;(0x00000010L)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a2">SepRmAcquireDbReadLock</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a3">SepRmAcquireDbWriteLock</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a4">SepRmReleaseDbReadLock</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a6">SEP_RM_LSA_SHARED_MEMORY_SIZE</a>&nbsp;&nbsp;&nbsp;((ULONG) PAGE_SIZE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a7">SEP_RM_COMMAND_MAX</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a8">SEP_TERMINATION_NOTIFY</a>&nbsp;&nbsp;&nbsp;0x1</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d2/struct__SEP__RM__STATE.html">_SEP_RM_STATE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a9">SEP_RM_STATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d1/d2/struct__SEP__RM__STATE.html">_SEP_RM_STATE</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a10">PSEP_RM_STATE</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">_SEP_RM_CONNECT_INFO</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a11">SEP_RM_CONNECT_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">SEP_RM_CONNECT_INFO</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a12">PSEP_RM_CONNECT_INFO</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef VOID(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a13">SEP_RM_COMMAND_WORKER</a> )(PRM_COMMAND_MESSAGE, PRM_REPLY_MESSAGE)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">_SEP_LOGON_SESSION_REFERENCES</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a14">SEP_LOGON_SESSION_REFERENCES</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">_SEP_LOGON_SESSION_REFERENCES</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a15">PSEP_LOGON_SESSION_REFERENCES</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">_SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a16">SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">_SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a17">PSEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a23">SepRmDbInitialization</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a24">SepRmCommandServerThread</a> (IN PVOID StartContext)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a25">SepRmCommandServerThreadInit</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a26">SepRmComponentTestCommandWrkr</a> (IN PRM_COMMAND_MESSAGE CommandMessage, OUT PRM_REPLY_MESSAGE ReplyMessage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a27">SepRmSetAuditEventWrkr</a> (IN PRM_COMMAND_MESSAGE CommandMessage, OUT PRM_REPLY_MESSAGE ReplyMessage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a28">SepRmSendCommandToLsaWrkr</a> (IN PRM_COMMAND_MESSAGE CommandMessage, OUT PRM_REPLY_MESSAGE ReplyMessage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a29">SepRmCreateLogonSessionWrkr</a> (IN PRM_COMMAND_MESSAGE CommandMessage, OUT PRM_REPLY_MESSAGE ReplyMessage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a30">SepRmDeleteLogonSessionWrkr</a> (IN PRM_COMMAND_MESSAGE CommandMessage, OUT PRM_REPLY_MESSAGE ReplyMessage)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a31">SepCreateLogonSessionTrack</a> (IN PLUID LogonId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a32">SepDeleteLogonSessionTrack</a> (IN PLUID LogonId)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a18">SeFileSystemNotifyRoutinesHead</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a19">SepRmLsaCallProcess</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d2/struct__SEP__RM__STATE.html">SEP_RM_STATE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a21">SepRmDbLock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a1" doxytag="rmp.h::SEP_LOGON_TRACK_ARRAY_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SEP_LOGON_TRACK_ARRAY_SIZE&nbsp;&nbsp;&nbsp;(0x00000010L)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00041">41</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">SepRmDbInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="rmp.h::SEP_LOGON_TRACK_INDEX_MASK" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SEP_LOGON_TRACK_INDEX_MASK&nbsp;&nbsp;&nbsp;(0x0000000FL)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00040">40</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="rmp.h::SEP_RM_COMMAND_MAX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SEP_RM_COMMAND_MAX&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00116">116</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="rmp.h::SEP_RM_LSA_SHARED_MEMORY_SIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SEP_RM_LSA_SHARED_MEMORY_SIZE&nbsp;&nbsp;&nbsp;((ULONG) PAGE_SIZE)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00076">76</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00907">SepRmCallLsa()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="rmp.h::SEP_TERMINATION_NOTIFY" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SEP_TERMINATION_NOTIFY&nbsp;&nbsp;&nbsp;0x1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00134">134</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00979">SeMarkLogonSessionForTerminationNotification()</a>, and <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00384">SepDeReferenceLogonSession()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="rmp.h::SepRmAcquireDbReadLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepRmAcquireDbReadLock          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();         \
                                  <a class="code" href="../../d5/d8/ex_8h.html#a69">ExAcquireResourceShared</a>(&amp;SepRmDbLock, TRUE)
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00057">57</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l01107">SepNotifyFileSystems()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="rmp.h::SepRmAcquireDbWriteLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepRmAcquireDbWriteLock          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><a class="code" href="../../d4/d9/ke_8h.html#a28">KeEnterCriticalRegion</a>();         \
                                  <a class="code" href="../../d5/d8/ex_8h.html#a70">ExAcquireResourceExclusive</a>(&amp;SepRmDbLock, TRUE)
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00060">60</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00979">SeMarkLogonSessionForTerminationNotification()</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00451">SepAdtSetAuditLogInformation()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00541">SepCreateLogonSessionTrack()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00655">SepDeleteLogonSessionTrack()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00384">SepDeReferenceLogonSession()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00278">SepReferenceLogonSession()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00849">SeRegisterLogonSessionTerminatedRoutine()</a>, and <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00908">SeUnregisterLogonSessionTerminatedRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="rmp.h::SepRmReleaseDbReadLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepRmReleaseDbReadLock          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(&amp;SepRmDbLock); \
                                  <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>()
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00063">63</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l01107">SepNotifyFileSystems()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="rmp.h::SepRmReleaseDbWriteLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepRmReleaseDbWriteLock          </td>
          <td class="md" valign="top">(&nbsp;</td>
&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div><a class="code" href="../../d5/d8/ex_8h.html#a66">ExReleaseResource</a>(&amp;SepRmDbLock); \
                                  <a class="code" href="../../d4/d9/ke_8h.html#a29">KeLeaveCriticalRegion</a>()
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00066">66</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00979">SeMarkLogonSessionForTerminationNotification()</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00451">SepAdtSetAuditLogInformation()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00541">SepCreateLogonSessionTrack()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00655">SepDeleteLogonSessionTrack()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00384">SepDeReferenceLogonSession()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00278">SepReferenceLogonSession()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00849">SeRegisterLogonSessionTerminatedRoutine()</a>, and <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00908">SeUnregisterLogonSessionTerminatedRoutine()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a15" doxytag="rmp.h::PSEP_LOGON_SESSION_REFERENCES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">_SEP_LOGON_SESSION_REFERENCES</a> * <a class="el" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00278">SepReferenceLogonSession()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="rmp.h::PSEP_LOGON_SESSION_TERMINATED_NOTIFICATION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">_SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a> * <a class="el" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">PSEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00849">SeRegisterLogonSessionTerminatedRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="rmp.h::PSEP_RM_CONNECT_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">SEP_RM_CONNECT_INFO</a>* <a class="el" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">PSEP_RM_CONNECT_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00109">109</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="rmp.h::PSEP_RM_STATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d2/struct__SEP__RM__STATE.html">_SEP_RM_STATE</a> * <a class="el" href="../../d1/d2/struct__SEP__RM__STATE.html">PSEP_RM_STATE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="rmp.h::SEP_LOGON_SESSION_REFERENCES" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">_SEP_LOGON_SESSION_REFERENCES</a>  <a class="el" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">SEP_LOGON_SESSION_REFERENCES</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00541">SepCreateLogonSessionTrack()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="rmp.h::SEP_LOGON_SESSION_TERMINATED_NOTIFICATION" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">_SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a>  <a class="el" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="rmp.h::SEP_RM_COMMAND_WORKER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef VOID(* <a class="el" href="../../d1/d0/rmp_8h.html#a13">SEP_RM_COMMAND_WORKER</a>)(PRM_COMMAND_MESSAGE, PRM_REPLY_MESSAGE)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00118">118</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="rmp.h::SEP_RM_CONNECT_INFO" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">_SEP_RM_CONNECT_INFO</a>  <a class="el" href="../../d0/d2/struct__SEP__RM__CONNECT__INFO.html">SEP_RM_CONNECT_INFO</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00060">SeRmInitPhase1()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="rmp.h::SEP_RM_STATE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d1/d2/struct__SEP__RM__STATE.html">_SEP_RM_STATE</a>  <a class="el" href="../../d1/d2/struct__SEP__RM__STATE.html">SEP_RM_STATE</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a31" doxytag="rmp.h::SepCreateLogonSessionTrack" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SepCreateLogonSessionTrack           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>LogonId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00541">541</a> of file <a class="el" href="../../d0/d9/rmlogon_8c-source.html">rmlogon.c</a>.
<p>
References <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00129">_SEP_LOGON_SESSION_REFERENCES::LogonId</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00128">_SEP_LOGON_SESSION_REFERENCES::Next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00130">_SEP_LOGON_SESSION_REFERENCES::ReferenceCount</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01824">RtlEqualLuid()</a>, <a class="el" href="../../d1/d0/rmp_8h.html#a14">SEP_LOGON_SESSION_REFERENCES</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00109">SepLogonSessionIndex</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00229">SepLogonSessions</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00060">SepRmAcquireDbWriteLock</a>, and <a class="el" href="../../d2/d9/rmp_8h-source.html#l00066">SepRmReleaseDbWriteLock</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00122">SepRmCreateLogonSessionWrkr()</a>, and <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">SepRmDbInitialization()</a>.
<p>
<pre class="fragment"><div>00547                    :
00548 
00549     This routine creates a <span class="keyword">new</span> logon session tracking record.
00550 
00551     This should <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be called as a dispatch routine <span class="keywordflow">for</span> a LSA-&gt;RM
00552     call (and once during system initialization).
00553 
00554     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified logon session already exists, then an error <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00555 
00556 
00557 
00558 Arguments:
00559 
00560     LogonId - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> logon session <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> <span class="keywordflow">for</span> which a <span class="keyword">new</span> logon track <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00561         to be created.
00562 
00563 Return Value:
00564 
00565     STATUS_SUCCESS - The logon session track was created successfully.
00566 
00567     STATUS_LOGON_SESSION_EXISTS - The logon session already exists.
00568         <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> <span class="keyword">new</span> one has not been created.
00569 
00570 --*/
00571 
00572 {
00573 
00574     ULONG SessionArrayIndex;
00575     <a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a> Previous, Current;
00576     <a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a> LogonSessionTrack;
00577 
00578     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00579 
00580     <span class="comment">//</span>
00581     <span class="comment">// Make sure we can allocate a new logon session track record</span>
00582     <span class="comment">//</span>
00583 
00584     LogonSessionTrack = (<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a>)
00585                         <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>(
00586                             PagedPool,
00587                             <span class="keyword">sizeof</span>(<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">SEP_LOGON_SESSION_REFERENCES</a>),
00588                             'sLeS'
00589                             );
00590 
00591     <span class="keywordflow">if</span> (LogonSessionTrack == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00592         <span class="keywordflow">return</span> STATUS_INSUFFICIENT_RESOURCES;
00593     }
00594 
00595     LogonSessionTrack-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o1">LogonId</a> = (*LogonId);
00596     LogonSessionTrack-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o2">ReferenceCount</a> = 0;
00597 
00598 
00599 
00600     SessionArrayIndex = <a class="code" href="../../d9/d9/rmlogon_8c.html#a0">SepLogonSessionIndex</a>( LogonId );
00601 
00602     <span class="comment">//</span>
00603     <span class="comment">// Protect modification of reference monitor database</span>
00604     <span class="comment">//</span>
00605 
00606     <a class="code" href="../../d1/d0/rmp_8h.html#a3">SepRmAcquireDbWriteLock</a>();
00607 
00608 
00609     <span class="comment">//</span>
00610     <span class="comment">// Now walk the list for our logon session array hash index</span>
00611     <span class="comment">// looking for a duplicate logon session ID.</span>
00612     <span class="comment">//</span>
00613 
00614     Previous = (<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a>)
00615                ((PVOID)&amp;<a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a>[ SessionArrayIndex ]);
00616     Current = Previous-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
00617 
00618     <span class="keywordflow">while</span> (Current != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00619 
00620         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a50">RtlEqualLuid</a>( LogonId, &amp;Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o1">LogonId</a>) ) {
00621 
00622             <span class="comment">//</span>
00623             <span class="comment">// One already exists. Hmmm.</span>
00624             <span class="comment">//</span>
00625 
00626             <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00627             <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(LogonSessionTrack);
00628             <span class="keywordflow">return</span> STATUS_LOGON_SESSION_EXISTS;
00629 
00630         }
00631 
00632         Previous = Current;
00633         Current = Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
00634     }
00635 
00636 
00637     <span class="comment">//</span>
00638     <span class="comment">// Reached the end of the list without finding a duplicate.</span>
00639     <span class="comment">// Add the new one.</span>
00640     <span class="comment">//</span>
00641 
00642     LogonSessionTrack-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a> = <a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a>[ SessionArrayIndex ];
00643     <a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a>[ SessionArrayIndex ] = LogonSessionTrack;
00644 
00645 
00646 
00647 
00648     <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00649     <span class="keywordflow">return</span> STATUS_SUCCESS;
00650 
00651 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="rmp.h::SepDeleteLogonSessionTrack" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SepDeleteLogonSessionTrack           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>LogonId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00655">655</a> of file <a class="el" href="../../d0/d9/rmlogon_8c-source.html">rmlogon.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00129">_SEP_LOGON_SESSION_REFERENCES::LogonId</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00128">_SEP_LOGON_SESSION_REFERENCES::Next</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00130">_SEP_LOGON_SESSION_REFERENCES::ReferenceCount</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l01824">RtlEqualLuid()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00109">SepLogonSessionIndex</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00229">SepLogonSessions</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00060">SepRmAcquireDbWriteLock</a>, and <a class="el" href="../../d2/d9/rmp_8h-source.html#l00066">SepRmReleaseDbWriteLock</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00200">SepRmDeleteLogonSessionWrkr()</a>.
<p>
<pre class="fragment"><div>00661                    :
00662 
00663     This routine creates a <span class="keyword">new</span> logon session tracking record.
00664 
00665     This should <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> be called as a dispatch routine <span class="keywordflow">for</span> a LSA-&gt;RM
00666     call (and once during system initialization).
00667 
00668     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified logon session already exists, then an error <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> returned.
00669 
00670 
00671 
00672 Arguments:
00673 
00674     LogonId - Pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> logon session <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> whose logon track <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00675         to be deleted.
00676 
00677 Return Value:
00678 
00679     STATUS_SUCCESS - The logon session track was deleted successfully.
00680 
00681     STATUS_BAD_LOGON_SESSION_STATE - The logon session has a non-zero
00682         reference count and can not be deleted.
00683 
00684     STATUS_NO_SUCH_LOGON_SESSION - The specified logon session does not
00685         exist.
00686 
00687 
00688 --*/
00689 
00690 {
00691 
00692     ULONG SessionArrayIndex;
00693     <a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a> Previous, Current;
00694 
00695     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00696 
00697     SessionArrayIndex = <a class="code" href="../../d9/d9/rmlogon_8c.html#a0">SepLogonSessionIndex</a>( LogonId );
00698 
00699     <span class="comment">//</span>
00700     <span class="comment">// Protect modification of reference monitor database</span>
00701     <span class="comment">//</span>
00702 
00703     <a class="code" href="../../d1/d0/rmp_8h.html#a3">SepRmAcquireDbWriteLock</a>();
00704 
00705 
00706     <span class="comment">//</span>
00707     <span class="comment">// Now walk the list for our logon session array hash index.</span>
00708     <span class="comment">//</span>
00709 
00710     Previous = (<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a>)
00711                ((PVOID)&amp;<a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a>[ SessionArrayIndex ]);
00712     Current = Previous-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
00713 
00714     <span class="keywordflow">while</span> (Current != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00715 
00716         <span class="comment">//</span>
00717         <span class="comment">// If we found it, make sure reference count is zero</span>
00718         <span class="comment">//</span>
00719 
00720         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a50">RtlEqualLuid</a>( LogonId, &amp;Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o1">LogonId</a>) ) {
00721 
00722             <span class="keywordflow">if</span> (Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o2">ReferenceCount</a> == 0) {
00723 
00724                 <span class="comment">//</span>
00725                 <span class="comment">// Pull it from the list</span>
00726                 <span class="comment">//</span>
00727 
00728                 Previous-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a> = Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
00729 
00730 
00731                 <span class="comment">//</span>
00732                 <span class="comment">// No longer need to protect our pointer to this</span>
00733                 <span class="comment">// record.</span>
00734                 <span class="comment">//</span>
00735 
00736                 <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00737 
00738 
00739                 <span class="comment">//</span>
00740                 <span class="comment">// Deallocate the logon session track record.</span>
00741                 <span class="comment">//</span>
00742 
00743                 <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( (PVOID)Current );
00744 
00745 
00746                 <span class="keywordflow">return</span> STATUS_SUCCESS;
00747 
00748             }
00749 
00750             <span class="comment">//</span>
00751             <span class="comment">// reference count was not zero.  This is not considered</span>
00752             <span class="comment">// a healthy situation.  Return an error and let someone</span>
00753             <span class="comment">// else declare the bug check.</span>
00754             <span class="comment">//</span>
00755 
00756             <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00757             <span class="keywordflow">return</span> STATUS_BAD_LOGON_SESSION_STATE;
00758         }
00759 
00760         Previous = Current;
00761         Current = Current-&gt;<a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html#o0">Next</a>;
00762     }
00763 
00764     <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00765 
00766     <span class="comment">//</span>
00767     <span class="comment">// Someone asked us to delete a logon session that isn't</span>
00768     <span class="comment">// in the database.</span>
00769     <span class="comment">//</span>
00770 
00771     <span class="keywordflow">return</span> STATUS_NO_SUCH_LOGON_SESSION;
00772 
00773 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="rmp.h::SepRmCommandServerThread" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepRmCommandServerThread           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PVOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>StartContext</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00309">309</a> of file <a class="el" href="../../d1/d9/rmmain_8c-source.html">rmmain.c</a>.
<p>
References <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03425">ReplyMessage()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00087">_SEP_RM_STATE::RmCommandPortHandle</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00049">SepRmCommandDispatch</a>, <a class="el" href="../../d1/d0/rmp_8h.html#a25">SepRmCommandServerThreadInit()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00227">SepRmState</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00060">SeRmInitPhase1()</a>.
<p>
<pre class="fragment"><div>00315                    :
00316 
00317     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> executed indefinitely by a dedicated permanent thread
00318     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Sysinit Process, called <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Reference Monitor <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a22">Server</a> Thread.
00319     This thread updates Reference Monitor Global State Data by dispatching
00320     commands sent from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA through <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Reference Monitor LPC Command
00321     Port.  The following steps are repeated indefinitely:
00322 
00323     o  Initialize RM Command receive and reply buffer headers
00324     o  Perform remaining Reference Monitor initialization involving LSA
00325     o  Wait <span class="keywordflow">for</span> RM command sent from LSA, send reply to previous command
00326        (<span class="keywordflow">if</span> any)
00327     o  Validate command
00328     o  Dispatch to command worker routine to execute command.
00329 
00330 Arguments:
00331 
00332     None.
00333 
00334 Return Value:
00335 
00336     None.
00337 
00338 --*/
00339 
00340 {
00341     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00342     PRM_REPLY_MESSAGE Reply;
00343     RM_COMMAND_MESSAGE CommandMessage;
00344     RM_REPLY_MESSAGE <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>;
00345 
00346     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00347 
00348     <span class="comment">//</span>
00349     <span class="comment">// Perform the rest of the Reference Monitor initialization, involving</span>
00350     <span class="comment">// synchronization with the LSA or dependency on the LSA having run.</span>
00351     <span class="comment">//</span>
00352 
00353     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d0/rmp_8h.html#a25">SepRmCommandServerThreadInit</a>()) {
00354 
00355         KdPrint((<span class="stringliteral">"Security: Terminating Rm Command Server Thread\n"</span>));
00356         <span class="keywordflow">return</span>;
00357     }
00358 
00359     <span class="comment">//</span>
00360     <span class="comment">// Initialize LPC port message header type and length fields for the</span>
00361     <span class="comment">// received command message.</span>
00362     <span class="comment">//</span>
00363 
00364     CommandMessage.MessageHeader.u2.ZeroInit = 0;
00365     CommandMessage.MessageHeader.u1.s1.TotalLength =
00366         (CSHORT) <span class="keyword">sizeof</span>(RM_COMMAND_MESSAGE);
00367     CommandMessage.MessageHeader.u1.s1.DataLength =
00368     CommandMessage.MessageHeader.u1.s1.TotalLength -
00369         (CSHORT) <span class="keyword">sizeof</span>(PORT_MESSAGE);
00370 
00371     <span class="comment">//</span>
00372     <span class="comment">// Initialize the LPC port message header type and data sizes for</span>
00373     <span class="comment">// for the reply message.</span>
00374     <span class="comment">//</span>
00375 
00376     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.MessageHeader.u2.ZeroInit = 0;
00377     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.MessageHeader.u1.s1.TotalLength =
00378         (CSHORT) <span class="keyword">sizeof</span>(RM_COMMAND_MESSAGE);
00379     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.MessageHeader.u1.s1.DataLength =
00380     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.MessageHeader.u1.s1.TotalLength -
00381         (CSHORT) <span class="keyword">sizeof</span>(PORT_MESSAGE);
00382 
00383     <span class="comment">//</span>
00384     <span class="comment">// First time through, there is no reply.</span>
00385     <span class="comment">//</span>
00386 
00387     Reply = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00388 
00389     <span class="comment">//</span>
00390     <span class="comment">// Now loop indefinitely, processing incoming Rm commands from the LSA.</span>
00391     <span class="comment">//</span>
00392 
00393     <span class="keywordflow">for</span>(;;) {
00394 
00395         <span class="comment">//</span>
00396         <span class="comment">// Wait for Command, send reply to previous command (if any)</span>
00397         <span class="comment">//</span>
00398 
00399         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwReplyWaitReceivePort(
00400                     <a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o3">RmCommandPortHandle</a>,
00401                     NULL,
00402                     (PPORT_MESSAGE) Reply,
00403                     (PPORT_MESSAGE) &amp;CommandMessage
00404                     );
00405 
00406         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00407 
00408             <span class="comment">//</span>
00409             <span class="comment">// malicious user apps can try to connect to this port.  We will</span>
00410             <span class="comment">// fail later, but if their thread vanishes, we'll get a failure</span>
00411             <span class="comment">// here.  Ignore it:</span>
00412             <span class="comment">//</span>
00413 
00414             <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_UNSUCCESSFUL )
00415             {
00416                 <span class="comment">//</span>
00417                 <span class="comment">// skip it:</span>
00418                 <span class="comment">//</span>
00419 
00420                 Reply = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ;
00421                 <span class="keywordflow">continue</span>;
00422             }
00423 
00424             KdPrint((<span class="stringliteral">"Security: RM message receive from Lsa failed %lx\n"</span>,
00425                 Status));
00426 
00427         }
00428 
00429         <span class="comment">//</span>
00430         <span class="comment">// Now dispatch to a routine to handle the command.  Allow</span>
00431         <span class="comment">// command errors to occur without bringing system down just now.</span>
00432         <span class="comment">//</span>
00433 
00434         <span class="keywordflow">if</span> ( CommandMessage.MessageHeader.u2.s2.Type == LPC_REQUEST ) {
00435             (*(<a class="code" href="../../d0/d0/rmmain_8c.html#a0">SepRmCommandDispatch</a>[CommandMessage.CommandNumber]))
00436                 (&amp;CommandMessage, &amp;<a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>);
00437 
00438             <span class="comment">//</span>
00439             <span class="comment">// Initialize the client thread info and message id for the</span>
00440             <span class="comment">// reply message.  First time through, the reply message structure</span>
00441             <span class="comment">// is not used.</span>
00442             <span class="comment">//</span>
00443 
00444             <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.MessageHeader.ClientId =
00445                 CommandMessage.MessageHeader.ClientId;
00446             <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>.MessageHeader.MessageId =
00447                 CommandMessage.MessageHeader.MessageId;
00448 
00449             Reply = &amp;<a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>;
00450 
00451         } <span class="keywordflow">else</span> {
00452 
00453             Reply = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00454         }
00455     }  <span class="comment">// end_for</span>
00456 
00457     <span class="comment">//</span>
00458     <span class="comment">// Make compiler ferme la bouche</span>
00459     <span class="comment">//</span>
00460 
00461     StartContext;
00462 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="rmp.h::SepRmCommandServerThreadInit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepRmCommandServerThreadInit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00309">SepRmCommandServerThread()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="rmp.h::SepRmComponentTestCommandWrkr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepRmComponentTestCommandWrkr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRM_COMMAND_MESSAGE&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PRM_REPLY_MESSAGE&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyMessage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00758">758</a> of file <a class="el" href="../../d1/d9/rmmain_8c-source.html">rmmain.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d4/d7/client_8c-source.html#l03425">ReplyMessage()</a>.
<p>
<pre class="fragment"><div>00765                    :
00766 
00767     BUGWARNING - Remove <span class="keyword">this</span> command when other RM commands are implemented.
00768              Until then, <span class="keyword">this</span> command <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> way a CT can verify that
00769              an RM command with parameters <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> sent correctly.
00770 
00771     This function processes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Component <a class="code" href="../../d9/d6/ttseacc_8c.html#a1">Test</a> RM command.
00772     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a temporary command that can be used to verify that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> link
00773     from RM to LSA <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> working.  This command verifies that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> link
00774     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> working by receiving a ULONG parameter and verifying that <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>
00775     has <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> expected value.
00776 
00777 Arguments:
00778 
00779     CommandMessage - Pointer to structure containing RM command message
00780         information consisting of an LPC PORT_MESSAGE structure followed
00781         by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command number (RmComponentTestCommand).  This command
00782         currently has one parameter, a fixed ulong value.
00783 
00784     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a> - Pointer to structure containing LSA reply message
00785         information consisting of an LPC PORT_MESSAGE structure followed
00786         by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command ReturnedStatus field in which a status code from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00787         command will be returned.
00788 
00789 Return Value:
00790 
00791     <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00792 
00793 --*/
00794 
00795 {
00796     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00797 
00798     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>-&gt;ReturnedStatus = STATUS_SUCCESS;
00799 
00800     <span class="comment">//</span>
00801     <span class="comment">// Strict check that command is correct.</span>
00802     <span class="comment">//</span>
00803 
00804     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( CommandMessage-&gt;CommandNumber == RmComponentTestCommand );
00805 
00806     KdPrint((<span class="stringliteral">"Security: RM Component Test Command Received\n"</span>));
00807 
00808     <span class="comment">//</span>
00809     <span class="comment">// Verify that the parameter value passed is as expected.</span>
00810     <span class="comment">//</span>
00811 
00812     <span class="keywordflow">if</span> (*((ULONG *) CommandMessage-&gt;CommandParams) !=
00813         RM_CT_COMMAND_PARAM_VALUE ) {
00814 
00815         <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>-&gt;ReturnedStatus = STATUS_INVALID_PARAMETER;
00816     }
00817 
00818     <span class="keywordflow">return</span>;
00819 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="rmp.h::SepRmCreateLogonSessionWrkr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepRmCreateLogonSessionWrkr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRM_COMMAND_MESSAGE&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PRM_REPLY_MESSAGE&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyMessage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00122">122</a> of file <a class="el" href="../../d0/d9/rmlogon_8c-source.html">rmlogon.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03425">ReplyMessage()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00541">SepCreateLogonSessionTrack()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00129                    :
00130 
00131     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dispatch routine <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA --&gt; RM
00132     <span class="stringliteral">"CreateLogonSession"</span> call.
00133 
00134     The arguments passed to <span class="keyword">this</span> routine are defined by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00135     <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <a class="code" href="../../d1/d0/rmp_8h.html#a13">SEP_RM_COMMAND_WORKER</a>.
00136 
00137 
00138 Arguments:
00139 
00140     CommandMessage - Points to structure containing RM command message
00141         information consisting of an LPC PORT_MESSAGE structure followed
00142         by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command number (RmComponentTestCommand) and a command-specific
00143         body.  The command-specific body of this parameter is a LUID of the
00144         logon session to be created.
00145 
00146     ReplyMessage - Pointer to structure containing LSA reply message
00147         information consisting of an LPC PORT_MESSAGE structure followed
00148         by the command ReturnedStatus field in which a status code from the
00149         command will be returned.
00150 
00151 Return Value:
00152 
00153     VOID
00154 
00155 --*/
00156 
00157 {
00158 
00159     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00160     LUID LogonId;
00161 
00162     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00163 
00164     <span class="comment">//</span>
00165     <span class="comment">// Check that command is expected type</span>
00166     <span class="comment">//</span>
00167 
00168     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( CommandMessage-&gt;CommandNumber == RmCreateLogonSession );
00169 
00170 
00171     <span class="comment">//</span>
00172     <span class="comment">// Typecast the command parameter to what we expect.</span>
00173     <span class="comment">//</span>
00174 
00175     LogonId = *((LUID UNALIGNED *) CommandMessage-&gt;CommandParams);
00176 
00177 
00178 
00179     <span class="comment">//</span>
00180     <span class="comment">// Try to create the logon session tracking record</span>
00181     <span class="comment">//</span>
00182 
00183     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d0/rmp_8h.html#a31">SepCreateLogonSessionTrack</a>( &amp;LogonId );
00184 
00185 
00186 
00187     <span class="comment">//</span>
00188     <span class="comment">// Set the reply status</span>
00189     <span class="comment">//</span>
00190 
00191     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>-&gt;ReturnedStatus = <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00192 
00193 
00194     <span class="keywordflow">return</span>;
00195 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="rmp.h::SepRmDbInitialization" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepRmDbInitialization           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">95</a> of file <a class="el" href="../../d3/d9/rmvars_8c-source.html">rmvars.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00088">_SEP_RM_STATE::AuditingEnabled</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l02473">ExInitializeResource</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00089">_SEP_RM_STATE::OperationalMode</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01600">SeAnonymousAuthenticationId</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00041">SEP_LOGON_TRACK_ARRAY_SIZE</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00541">SepCreateLogonSessionTrack()</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00229">SepLogonSessions</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00228">SepRmDbLock</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00227">SepRmState</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01599">SeSystemAuthenticationId</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l01275">SepRmInitPhase0()</a>.
<p>
<pre class="fragment"><div>00100                    :
00101 
00102     This function initializes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> reference monitor in-memory database.
00103 
00104 Arguments:
00105 
00106     None.
00107 
00108 Return Value:
00109 
00110     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> database successfully initialized.
00111     <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">if</span> not successfully initialized.
00112 
00113 --*/
00114 {
00115     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00116     ULONG i;
00117 
00118 
00119     <span class="comment">//</span>
00120     <span class="comment">// Create the reference monitor database lock</span>
00121     <span class="comment">//</span>
00122     <span class="comment">// Use SepRmAcquireDbReadLock()</span>
00123     <span class="comment">//     SepRmAcquireDbWriteLock()</span>
00124     <span class="comment">//     SepRmReleaseDbReadLock()</span>
00125     <span class="comment">//     SepRmReleaseDbWriteLock()</span>
00126     <span class="comment">//</span>
00127     <span class="comment">// to gain access to the reference monitor database.</span>
00128     <span class="comment">//</span>
00129 
00130     <a class="code" href="../../d5/d8/ex_8h.html#a68">ExInitializeResource</a>(&amp;SepRmDbLock);
00131 
00132     <span class="comment">//</span>
00133     <span class="comment">// Initialize the Logon Session tracking array.</span>
00134     <span class="comment">//</span>
00135 
00136     <a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a> = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool,
00137                                               <span class="keyword">sizeof</span>( <a class="code" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a> ) * SEP_LOGON_TRACK_ARRAY_SIZE,
00138                                               'SLeS'
00139                                               );
00140 
00141     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00142         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00143     }
00144 
00145     <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="../../d1/d0/rmp_8h.html#a1">SEP_LOGON_TRACK_ARRAY_SIZE</a>;i++) {
00146 
00147         <a class="code" href="../../d1/d0/rmp_8h.html#a22">SepLogonSessions</a>[ i ] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00148     }
00149 
00150     <span class="comment">//</span>
00151     <span class="comment">// Now add in a record representing the system logon session.</span>
00152     <span class="comment">//</span>
00153 
00154     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d0/rmp_8h.html#a31">SepCreateLogonSessionTrack</a>( &amp;SeSystemAuthenticationId );
00155     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00156     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00157         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00158     }
00159 
00160     <span class="comment">//</span>
00161     <span class="comment">// Add one for the null session logon session</span>
00162     <span class="comment">//</span>
00163 
00164     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d0/rmp_8h.html#a31">SepCreateLogonSessionTrack</a>( &amp;SeAnonymousAuthenticationId );
00165     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status) );
00166     <span class="keywordflow">if</span> ( !<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00167         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00168     }
00169 
00170 
00171 
00172 
00173     <span class="comment">//</span>
00174     <span class="comment">// The correct RM state will be set when the local security policy</span>
00175     <span class="comment">// information is retrieved (by the LSA) and subsequently passed to</span>
00176     <span class="comment">// the reference monitor later on in initialization.  For now, initialize</span>
00177     <span class="comment">// the state to something that will work for the remainder of</span>
00178     <span class="comment">// system initialization.</span>
00179     <span class="comment">//</span>
00180 
00181     <a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o4">AuditingEnabled</a> = 0;    <span class="comment">// auditing state disabled.</span>
00182     <a class="code" href="../../d1/d0/rmp_8h.html#a20">SepRmState</a>.<a class="code" href="../../d1/d2/struct__SEP__RM__STATE.html#o5">OperationalMode</a> = LSA_MODE_PASSWORD_PROTECTED;
00183 
00184 
00185 
00186     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00187 
00188 
00189 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="rmp.h::SepRmDeleteLogonSessionWrkr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepRmDeleteLogonSessionWrkr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRM_COMMAND_MESSAGE&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PRM_REPLY_MESSAGE&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyMessage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00200">200</a> of file <a class="el" href="../../d0/d9/rmlogon_8c-source.html">rmlogon.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03425">ReplyMessage()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00655">SepDeleteLogonSessionTrack()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00207                    :
00208 
00209     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> dispatch routine <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA --&gt; RM
00210     <span class="stringliteral">"DeleteLogonSession"</span> call.
00211 
00212     The arguments passed to <span class="keyword">this</span> routine are defined by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00213     <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <a class="code" href="../../d1/d0/rmp_8h.html#a13">SEP_RM_COMMAND_WORKER</a>.
00214 
00215 
00216 Arguments:
00217 
00218     CommandMessage - Points to structure containing RM command message
00219         information consisting of an LPC PORT_MESSAGE structure followed
00220         by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command number (RmComponentTestCommand) and a command-specific
00221         body.  The command-specific body of this parameter is a LUID of the
00222         logon session to be created.
00223 
00224     ReplyMessage - Pointer to structure containing LSA reply message
00225         information consisting of an LPC PORT_MESSAGE structure followed
00226         by the command ReturnedStatus field in which a status code from the
00227         command will be returned.
00228 
00229 Return Value:
00230 
00231     VOID
00232 
00233 --*/
00234 
00235 {
00236 
00237     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00238     LUID LogonId;
00239 
00240     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00241 
00242     <span class="comment">//</span>
00243     <span class="comment">// Check that command is expected type</span>
00244     <span class="comment">//</span>
00245 
00246     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( CommandMessage-&gt;CommandNumber == RmDeleteLogonSession );
00247 
00248 
00249     <span class="comment">//</span>
00250     <span class="comment">// Typecast the command parameter to what we expect.</span>
00251     <span class="comment">//</span>
00252 
00253     LogonId = *((LUID UNALIGNED *) CommandMessage-&gt;CommandParams);
00254 
00255 
00256 
00257     <span class="comment">//</span>
00258     <span class="comment">// Try to create the logon session tracking record</span>
00259     <span class="comment">//</span>
00260 
00261     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d0/rmp_8h.html#a32">SepDeleteLogonSessionTrack</a>( &amp;LogonId );
00262 
00263 
00264 
00265     <span class="comment">//</span>
00266     <span class="comment">// Set the reply status</span>
00267     <span class="comment">//</span>
00268 
00269     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>-&gt;ReturnedStatus = <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00270 
00271 
00272     <span class="keywordflow">return</span>;
00273 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="rmp.h::SepRmSendCommandToLsaWrkr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepRmSendCommandToLsaWrkr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRM_COMMAND_MESSAGE&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PRM_REPLY_MESSAGE&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyMessage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00824">824</a> of file <a class="el" href="../../d1/d9/rmmain_8c-source.html">rmmain.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, and <a class="el" href="../../d4/d7/client_8c-source.html#l03425">ReplyMessage()</a>.
<p>
<pre class="fragment"><div>00831                    :
00832 
00833     This function carries <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> special Rm Send Command To Lsa Command.  This
00834     command <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ctlsarm component test which checks that
00835     LSA to RM and RM to LSA communication via LPC <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> working.
00836 
00837 Arguments:
00838 
00839     CommandMessage - Pointer to structure containing RM command message
00840         information consisting of an LPC PORT_MESSAGE structure followed
00841         by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command number (RmDisableAuditCommand), followed by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00842         command parameters.  The parameters of <span class="keyword">this</span> special command consists
00843         of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Command Number of an LSA command and its parameters (<span class="keywordflow">if</span> any).
00844 
00845     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a> - Pointer to structure containing RM reply message
00846         information consisting of an LPC PORT_MESSAGE structure followed
00847         by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command ReturnedStatus field in which a status code from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00848         command will be returned.
00849 
00850 Return Value:
00851 
00852     <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a>
00853 
00854 --*/
00855 
00856 {
00857     <span class="comment">//</span>
00858     <span class="comment">// Obtain a pointer to the LSA command's params, and the size of the</span>
00859     <span class="comment">// params in bytes.  If there are no params, set the pointer to NULL.</span>
00860     <span class="comment">//</span>
00861 
00862     PVOID LsaCommandParams =
00863         ((RM_SEND_COMMAND_TO_LSA_PARAMS *)
00864         (CommandMessage-&gt;CommandParams))-&gt;LsaCommandParams;
00865     ULONG LsaCommandParamsLength =
00866         ((RM_SEND_COMMAND_TO_LSA_PARAMS *)
00867         (CommandMessage-&gt;CommandParams))-&gt;LsaCommandParamsLength;
00868 
00869     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00870 
00871     <span class="keywordflow">if</span> (LsaCommandParamsLength == 0) {
00872 
00873         LsaCommandParams = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00874 
00875     }
00876 
00877     <span class="comment">//</span>
00878     <span class="comment">// Strict check that command is correct one for this worker.</span>
00879     <span class="comment">//</span>
00880 
00881     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( CommandMessage-&gt;CommandNumber == RmSendCommandToLsaCommand );
00882 
00883     KdPrint((<span class="stringliteral">"Security: RM Send Command back to LSA Command Received\n"</span>));
00884 
00885     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>-&gt;ReturnedStatus = STATUS_SUCCESS;
00886 
00887 <span class="comment">//    Status = SepRmCallLsa(</span>
00888 <span class="comment">//                 ((RM_SEND_COMMAND_TO_LSA_PARAMS *)</span>
00889 <span class="comment">//                    (CommandMessage-&gt;CommandParams))-&gt;LsaCommandNumber,</span>
00890 <span class="comment">//                 LsaCommandParams,</span>
00891 <span class="comment">//                 LsaCommandParamsLength,</span>
00892 <span class="comment">//                 NULL,</span>
00893 <span class="comment">//                 0,</span>
00894 <span class="comment">//                 NULL,</span>
00895 <span class="comment">//                 NULL</span>
00896 <span class="comment">//                 );</span>
00897 
00898 
00899     <span class="keywordflow">return</span>;
00900 
00901 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="rmp.h::SepRmSetAuditEventWrkr" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepRmSetAuditEventWrkr           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PRM_COMMAND_MESSAGE&nbsp;</td>
          <td class="mdname" nowrap> <em>CommandMessage</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PRM_REPLY_MESSAGE&nbsp;</td>
          <td class="mdname" nowrap> <em>ReplyMessage</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d8/rmaudit_8c-source.html#l00051">51</a> of file <a class="el" href="../../d8/d8/rmaudit_8c-source.html">rmaudit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00297">_SE_AUDITING_STATE::AuditOnFailure</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00296">_SE_AUDITING_STATE::AuditOnSuccess</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d4/d7/client_8c-source.html#l03425">ReplyMessage()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01702">SeAuditingState</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01709">SeDetailedAuditing</a>, <a class="el" href="../../d8/d3/adt_8h-source.html#l00134">SepAdtAuditingEnabled</a>, <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00117">SepAdtInitializeBounds()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00058                    :
00059 
00060     This function carries <a class="code" href="../../d6/d0/wsprintf_8c.html#a0">out</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Reference Monitor Set Audit <a class="code" href="../../d8/d9/client_2ntstubs_8c.html#a5">Event</a>
00061     Command.  This command enables or disables auditing and optionally
00062     sets <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> auditing events.
00063 
00064 
00065 Arguments:
00066 
00067     CommandMessage - Pointer to structure containing RM command message
00068         information consisting of an LPC PORT_MESSAGE structure followed
00069         by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> command number (RmSetAuditStateCommand) and a single command
00070         parameter in structure form.
00071 
00072     ReplyMessage - Pointer to structure containing RM reply message
00073         information consisting of an LPC PORT_MESSAGE structure followed
00074         by the command ReturnedStatus field in which a status code from the
00075         command will be returned.
00076 
00077 Return Value:
00078 
00079     VOID
00080 
00081 --*/
00082 
00083 {
00084 
00085     PPOLICY_AUDIT_EVENT_OPTIONS EventAuditingOptions;
00086     POLICY_AUDIT_EVENT_TYPE EventType;
00087 
00088     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00089 
00090     <a class="code" href="../../d1/d5/adtp_8h.html#a30">SepAdtInitializeBounds</a>();
00091 
00092     <a class="code" href="../../d3/d8/client_8c.html#a125">ReplyMessage</a>-&gt;ReturnedStatus = STATUS_SUCCESS;
00093 
00094     <span class="comment">//</span>
00095     <span class="comment">// Strict check that command is correct one for this worker.</span>
00096     <span class="comment">//</span>
00097 
00098     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( CommandMessage-&gt;CommandNumber == RmAuditSetCommand );
00099 
00100     <span class="comment">//</span>
00101     <span class="comment">// Extract the AuditingMode flag and put it in the right place.</span>
00102     <span class="comment">//</span>
00103 
00104     <a class="code" href="../../d7/d4/adt_8h.html#a3">SepAdtAuditingEnabled</a> = (((PLSARM_POLICY_AUDIT_EVENTS_INFO) CommandMessage-&gt;CommandParams)-&gt;
00105                                 AuditingMode);
00106 
00107     <span class="comment">//</span>
00108     <span class="comment">// For each element in the passed array, process changes to audit</span>
00109     <span class="comment">// nothing, and then success or failure flags.</span>
00110     <span class="comment">//</span>
00111 
00112     EventAuditingOptions = ((PLSARM_POLICY_AUDIT_EVENTS_INFO) CommandMessage-&gt;CommandParams)-&gt;
00113                            EventAuditingOptions;
00114 
00115 
00116     <span class="keywordflow">for</span> ( EventType=AuditEventMinType;
00117           EventType &lt;= AuditEventMaxType;
00118           EventType++ ) {
00119 
00120         <a class="code" href="../../d0/d5/se_8h.html#a105">SeAuditingState</a>[EventType].<a class="code" href="../../d1/d0/struct__SE__AUDITING__STATE.html#o0">AuditOnSuccess</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00121         <a class="code" href="../../d0/d5/se_8h.html#a105">SeAuditingState</a>[EventType].<a class="code" href="../../d1/d0/struct__SE__AUDITING__STATE.html#o1">AuditOnFailure</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00122 
00123         <span class="keywordflow">if</span> ( EventAuditingOptions[EventType] &amp; POLICY_AUDIT_EVENT_SUCCESS ) {
00124 
00125             <a class="code" href="../../d0/d5/se_8h.html#a105">SeAuditingState</a>[EventType].<a class="code" href="../../d1/d0/struct__SE__AUDITING__STATE.html#o0">AuditOnSuccess</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00126         }
00127 
00128         <span class="keywordflow">if</span> ( EventAuditingOptions[EventType] &amp; POLICY_AUDIT_EVENT_FAILURE ) {
00129 
00130             <a class="code" href="../../d0/d5/se_8h.html#a105">SeAuditingState</a>[EventType].<a class="code" href="../../d1/d0/struct__SE__AUDITING__STATE.html#o1">AuditOnFailure</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00131         }
00132     }
00133 
00134     <span class="comment">//</span>
00135     <span class="comment">// Set the flag to indicate that we're auditing detailed events.</span>
00136     <span class="comment">// This is merely a timesaver so we can skip auditing setup in</span>
00137     <span class="comment">// time critical places like process creation.</span>
00138     <span class="comment">//</span>
00139 
00140     <span class="comment">//</span>
00141     <span class="comment">// Despite what the UI may imply, we never audit failures for detailed events, since</span>
00142     <span class="comment">// none of them can fail for security related reasons, and we're not interested in</span>
00143     <span class="comment">// auditing out of memory errors and stuff like that.  So just set this flag when</span>
00144     <span class="comment">// they want to see successes and ignore the failure case.</span>
00145     <span class="comment">//</span>
00146     <span class="comment">// We may have to revisit this someday.</span>
00147     <span class="comment">//</span>
00148 
00149     <span class="keywordflow">if</span> ( <a class="code" href="../../d0/d5/se_8h.html#a105">SeAuditingState</a>[AuditCategoryDetailedTracking].<a class="code" href="../../d1/d0/struct__SE__AUDITING__STATE.html#o0">AuditOnSuccess</a> &amp;&amp; <a class="code" href="../../d7/d4/adt_8h.html#a3">SepAdtAuditingEnabled</a> ) {
00150 
00151         <a class="code" href="../../d0/d5/se_8h.html#a106">SeDetailedAuditing</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00152 
00153     } <span class="keywordflow">else</span> {
00154 
00155         <a class="code" href="../../d0/d5/se_8h.html#a106">SeDetailedAuditing</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00156     }
00157 
00158     <span class="keywordflow">return</span>;
00159 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a18" doxytag="rmp.h::SeFileSystemNotifyRoutinesHead" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d7/d1/struct__SEP__LOGON__SESSION__TERMINATED__NOTIFICATION.html">SEP_LOGON_SESSION_TERMINATED_NOTIFICATION</a> <a class="el" href="../../d1/d0/rmp_8h.html#a18">SeFileSystemNotifyRoutinesHead</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00151">151</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l01107">SepNotifyFileSystems()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00849">SeRegisterLogonSessionTerminatedRoutine()</a>, and <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00908">SeUnregisterLogonSessionTerminatedRoutine()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="rmp.h::SepLogonSessions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d1/struct__SEP__LOGON__SESSION__REFERENCES.html">PSEP_LOGON_SESSION_REFERENCES</a>* <a class="el" href="../../d2/d0/rmvars_8c.html#a3">SepLogonSessions</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00229">229</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00979">SeMarkLogonSessionForTerminationNotification()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00541">SepCreateLogonSessionTrack()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00655">SepDeleteLogonSessionTrack()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00384">SepDeReferenceLogonSession()</a>, <a class="el" href="../../d0/d9/rmlogon_8c-source.html#l00278">SepReferenceLogonSession()</a>, and <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">SepRmDbInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="rmp.h::SepRmDbLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="el" href="../../d2/d0/rmvars_8c.html#a1">SepRmDbLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00228">228</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.
<p>
Referenced by <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">SepRmDbInitialization()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="rmp.h::SepRmLsaCallProcess" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> <a class="el" href="../../d2/d0/rmvars_8c.html#a0">SepRmLsaCallProcess</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00226">226</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00907">SepRmCallLsa()</a>, and <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00466">SepRmCommandServerThreadInit()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="rmp.h::SepRmState" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d2/struct__SEP__RM__STATE.html">SEP_RM_STATE</a> <a class="el" href="../../d2/d0/rmvars_8c.html#a2">SepRmState</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d9/rmp_8h-source.html#l00227">227</a> of file <a class="el" href="../../d2/d9/rmp_8h-source.html">rmp.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00907">SepRmCallLsa()</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00309">SepRmCommandServerThread()</a>, <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00466">SepRmCommandServerThreadInit()</a>, <a class="el" href="../../d3/d9/rmvars_8c-source.html#l00095">SepRmDbInitialization()</a>, and <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00060">SeRmInitPhase1()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:29 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
