<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ia64/chandler.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>chandler.c File Reference</h1><code>#include "nt.h"</code><br>

<p>
<a href="../../d2/d5/ia64_2chandler_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>LONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/ia64_2chandler_8c.html#a0">__C_ExecuteExceptionFilter</a> (ULONGLONG MemoryStack, ULONGLONG BackingStore, NTSTATUS ExceptionCode, PEXCEPTION_POINTERS ExceptionPointers, ULONGLONG ExceptionFilter, ULONGLONG GlobalPointer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/ia64_2chandler_8c.html#a1">__C_ExecuteTerminationHandler</a> (ULONGLONG MemoryStack, ULONGLONG BackingStore, BOOLEAN AbnormalTermination, ULONGLONG TerminationHandler, ULONGLONG GlobalPointer)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>EXCEPTION_DISPOSITION&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/ia64_2chandler_8c.html#a2">__C_specific_handler</a> (IN PEXCEPTION_RECORD ExceptionRecord, IN unsigned __int64 MemoryStackFp, IN unsigned __int64 BackingStoreFp, IN OUT PCONTEXT ContextRecord, IN OUT PDISPATCHER_CONTEXT DispatcherContext, IN unsigned __int64 GlobalPointer)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="ia64/chandler.c::__C_ExecuteExceptionFilter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> LONG __C_ExecuteExceptionFilter           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>MemoryStack</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BackingStore</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>NTSTATUS&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionCode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PEXCEPTION_POINTERS&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionPointers</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionFilter</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>GlobalPointer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ia64/chandler.c::__C_ExecuteTerminationHandler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID __C_ExecuteTerminationHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>MemoryStack</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>BackingStore</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AbnormalTermination</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>TerminationHandler</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONGLONG&nbsp;</td>
          <td class="mdname" nowrap> <em>GlobalPointer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ia64/chandler.c::__C_specific_handler" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> EXCEPTION_DISPOSITION __C_specific_handler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PEXCEPTION_RECORD&nbsp;</td>
          <td class="mdname" nowrap> <em>ExceptionRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN unsigned __int64&nbsp;</td>
          <td class="mdname" nowrap> <em>MemoryStackFp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN unsigned __int64&nbsp;</td>
          <td class="mdname" nowrap> <em>BackingStoreFp</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PCONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>ContextRecord</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PDISPATCHER_CONTEXT&nbsp;</td>
          <td class="mdname" nowrap> <em>DispatcherContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN unsigned __int64&nbsp;</td>
          <td class="mdname" nowrap> <em>GlobalPointer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/ia64_2chandler_8c-source.html#l00057">57</a> of file <a class="el" href="../../d2/d5/ia64_2chandler_8c-source.html">ia64/chandler.c</a>.
<p>
References <a class="el" href="../../d3/d6/ppc_2chandler_8c.html#a0">__C_ExecuteExceptionFilter()</a>, <a class="el" href="../../d3/d6/ppc_2chandler_8c.html#a1">__C_ExecuteTerminationHandler()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00057">EXCEPTION_CONTINUE_EXECUTION</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00056">EXCEPTION_CONTINUE_SEARCH</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00059">ExceptionContinueExecution</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00060">ExceptionContinueSearch</a>, <a class="el" href="../../d2/d9/cmchek_8c-source.html#l00095">Index</a>, <a class="el" href="../../d5/d8/heapdbg_8c-source.html#l00033">Offset</a>, <a class="el" href="../../d0/d9/ppc_2exdsptch_8c-source.html#l00737">RtlUnwind2()</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00068                    :
00069 
00070     This function scans <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> scope tables associated with <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified
00071     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> and calls exception and termination handlers as necessary.
00072 
00073 Arguments:
00074 
00075     ExceptionRecord - Supplies a pointer to an exception record.
00076 
00077     MemoryStackFp - Supplies a pointer to memory stack frame of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> 
00078         establisher function.
00079 
00080     BackingStoreFp - Supplies a pointer to RSE stack frame of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> 
00081         establisher function.
00082 
00083     ContextRecord - Supplies a pointer to a context record.
00084 
00085     DispatcherContext - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception dispatcher or
00086         unwind dispatcher context.
00087 
00088 Return Value:
00089 
00090     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> handled by one of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> exception filter <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a>, then
00091     there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> no <span class="keywordflow">return</span> from <span class="keyword">this</span> routine and <a class="code" href="../../d5/d9/alpha_2exdsptch_8c.html#a19">RtlUnwind</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called. Otherwise,
00092     an exception disposition value of <span class="keywordflow">continue</span> execution or <span class="keywordflow">continue</span> search <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00093     returned.
00094 
00095 --*/
00096 
00097 {
00098     ULONGLONG ImageBase;
00099     ULONGLONG ControlPc;
00100     ULONGLONG TargetPc;
00101     ULONGLONG Handler;
00102     EXCEPTION_POINTERS ExceptionPointers;
00103     PRUNTIME_FUNCTION FunctionEntry;
00104     ULONG <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>;
00105     ULONG <a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>;
00106     PSCOPE_TABLE ScopeTable;
00107     LONG Value;
00108 
00109     <span class="comment">//</span>
00110     <span class="comment">// Get address of where control left the establisher, the address of the</span>
00111     <span class="comment">// function table entry that describes the function, and the address of</span>
00112     <span class="comment">// the scope table.</span>
00113     <span class="comment">//</span>
00114 
00115     FunctionEntry = DispatcherContext-&gt;FunctionEntry;
00116     ImageBase = DispatcherContext-&gt;ImageBase;
00117     ScopeTable = (PSCOPE_TABLE) (ImageBase + *(PULONG) 
00118                      GetLanguageSpecificData(FunctionEntry, ImageBase));
00119 
00120     ControlPc = DispatcherContext-&gt;ControlPc - ImageBase;
00121 
00122     <span class="comment">//</span>
00123     <span class="comment">// If an unwind is not in progress, then scan the scope table and call</span>
00124     <span class="comment">// the appropriate exception filter routines. Otherwise, scan the scope</span>
00125     <span class="comment">// table and call the appropriate termination handlers using the target</span>
00126     <span class="comment">// PC obtained from the context record.</span>
00127     <span class="comment">// are called.</span>
00128     <span class="comment">//</span>
00129 
00130     <span class="keywordflow">if</span> (IS_DISPATCHING(ExceptionRecord-&gt;ExceptionFlags)) {
00131 
00132         <span class="comment">//</span>
00133         <span class="comment">// Scan the scope table and call the appropriate exception filter</span>
00134         <span class="comment">// routines.</span>
00135         <span class="comment">//</span>
00136 
00137         ExceptionPointers.ExceptionRecord = ExceptionRecord;
00138         ExceptionPointers.ContextRecord = ContextRecord;
00139         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; ScopeTable-&gt;Count; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00140             <span class="keywordflow">if</span> ((ControlPc &gt;= ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].BeginAddress) &amp;&amp;
00141                 (ControlPc &lt; ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].EndAddress) &amp;&amp;
00142                 (ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].JumpTarget != 0)) {
00143 
00144                 <span class="comment">//</span>
00145                 <span class="comment">// Call the exception filter routine.</span>
00146                 <span class="comment">//</span>
00147 
00148                 ULONG <a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> = ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].HandlerAddress;
00149 
00150                 <span class="keywordflow">switch</span> (<a class="code" href="../../d4/d9/heapdbg_8c.html#a3">Offset</a> &amp; 0x7) {
00151 
00152                 <span class="keywordflow">case</span> 7:
00153                     Value = <a class="code" href="../../d6/d7/halmips_8h.html#a33">EXCEPTION_EXECUTE_HANDLER</a>;
00154                     <span class="keywordflow">break</span>;
00155 
00156                 <span class="keywordflow">case</span> 5:
00157                     Value = <a class="code" href="../../d6/d7/halmips_8h.html#a34">EXCEPTION_CONTINUE_SEARCH</a>;
00158                     <span class="keywordflow">break</span>;
00159 
00160                 <span class="keywordflow">case</span> 3:
00161                     Value = <a class="code" href="../../d6/d7/halmips_8h.html#a35">EXCEPTION_CONTINUE_EXECUTION</a>;
00162                     <span class="keywordflow">break</span>;
00163 
00164                 <span class="keywordflow">default</span>:
00165                     Value = <a class="code" href="../../d3/d6/ppc_2chandler_8c.html#a0">__C_ExecuteExceptionFilter</a>(
00166                                 MemoryStackFp,
00167                                 BackingStoreFp,
00168                                 ExceptionRecord-&gt;ExceptionCode,
00169                                 &amp;ExceptionPointers,
00170                                 (ImageBase + Offset),
00171                                 GlobalPointer);
00172                     <span class="keywordflow">break</span>;
00173                 }
00174 
00175                 <span class="comment">//</span>
00176                 <span class="comment">// If the return value is less than zero, then dismiss the</span>
00177                 <span class="comment">// exception. Otherwise, if the value is greater than zero,</span>
00178                 <span class="comment">// then unwind to the target exception handler. Otherwise,</span>
00179                 <span class="comment">// continue the search for an exception filter.</span>
00180                 <span class="comment">//</span>
00181 
00182                 <span class="keywordflow">if</span> (Value &lt; 0) {
00183                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a36">ExceptionContinueExecution</a>;
00184 
00185                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Value &gt; 0) {
00186 
00187                     FRAME_POINTERS EstablisherFrame = {MemoryStackFp,
00188                                                        BackingStoreFp};
00189 
00190                     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a12">RtlUnwind2</a>(EstablisherFrame,
00191                                (PVOID)(ImageBase + ScopeTable-&gt;ScopeRecord[Index].JumpTarget),
00192                                ExceptionRecord,
00193                                (PVOID)(ULONGLONG)ExceptionRecord-&gt;ExceptionCode,
00194                                ContextRecord);
00195                 }
00196             }
00197         }
00198 
00199     } <span class="keywordflow">else</span> {
00200 
00201         <span class="comment">//</span>
00202         <span class="comment">// Scan the scope table and call the appropriate termination handler</span>
00203         <span class="comment">// routines.</span>
00204         <span class="comment">//</span>
00205 
00206         TargetPc = ContextRecord-&gt;StIIP - ImageBase;
00207         <span class="keywordflow">for</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = 0; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> &lt; ScopeTable-&gt;Count; <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> += 1) {
00208             <span class="keywordflow">if</span> ((ControlPc &gt;= ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].BeginAddress) &amp;&amp;
00209                 (ControlPc &lt; ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].EndAddress)) {
00210 
00211                 <span class="comment">//</span>
00212                 <span class="comment">// If the target PC is within the same scope the control PC</span>
00213                 <span class="comment">// is within, then this is an uplevel goto out of an inner try</span>
00214                 <span class="comment">// scope or a long jump back into a try scope. Terminate the</span>
00215                 <span class="comment">// scan termination handlers.</span>
00216                 <span class="comment">//</span>
00217                 <span class="comment">// N.B. The target PC can be just beyond the end of the scope,</span>
00218                 <span class="comment">//      in which case it is a leave from the scope.</span>
00219                 <span class="comment">//</span>
00220 
00221 
00222                 <span class="keywordflow">if</span> ((TargetPc &gt;= ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].BeginAddress) &amp;&amp;
00223                    (TargetPc &lt; ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].EndAddress)) {
00224                     <span class="keywordflow">break</span>;
00225 
00226                 } <span class="keywordflow">else</span> {
00227 
00228                     <span class="comment">//</span>
00229                     <span class="comment">// If the scope table entry describes an exception filter</span>
00230                     <span class="comment">// and the associated exception handler is the target of</span>
00231                     <span class="comment">// the unwind, then terminate the scan for termination</span>
00232                     <span class="comment">// handlers. Otherwise, if the scope table entry describes</span>
00233                     <span class="comment">// a termination handler, then record the address of the</span>
00234                     <span class="comment">// end of the scope as the new control PC address and call</span>
00235                     <span class="comment">// the termination handler.</span>
00236                     <span class="comment">//</span>
00237 
00238                     <span class="keywordflow">if</span> (ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].JumpTarget != 0) {
00239                         <span class="keywordflow">if</span> (TargetPc == ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].JumpTarget) {
00240                             <span class="keywordflow">break</span>;
00241                         }
00242 
00243                     } <span class="keywordflow">else</span> {
00244 
00245                         DispatcherContext-&gt;ControlPc = ImageBase +
00246                                 ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].EndAddress;
00247 
00248                         Handler = ImageBase + ScopeTable-&gt;ScopeRecord[<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>].HandlerAddress;
00249                         <a class="code" href="../../d3/d6/ppc_2chandler_8c.html#a1">__C_ExecuteTerminationHandler</a>(
00250                             MemoryStackFp,
00251                             BackingStoreFp,
00252                             TRUE,
00253                             Handler,
00254                             GlobalPointer);
00255                     }
00256                 }
00257             }
00258         }
00259     }
00260 
00261     <span class="comment">//</span>
00262     <span class="comment">// Continue search for exception or termination handlers.</span>
00263     <span class="comment">//</span>
00264 
00265     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a37">ExceptionContinueSearch</a>;
00266 }
}
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:03 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
