<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: tse.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>tse.c File Reference</h1><code>#include &lt;stdio.h&gt;</code><br>
<code>#include "<a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>"</code><br>
<code>#include &lt;zwapi.h&gt;</code><br>
<code>#include "ttoken.c"</code><br>

<p>
<a href="../../d2/d5/tse_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/tse_8c.html#a0">SeTest</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/tse_8c.html#a1">main</a> (int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/tse_8c.html#a2">TestMakeSystemToken</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/tse_8c.html#a3">TestTokenCopy</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/tse_8c.html#a4">TestTokenSize</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/tse_8c.html#a5">TestDefaultObjectMethod</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/tse_8c.html#a6">TestCaptureSecurityDescriptor</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/tse_8c.html#a7">TestAssignSecurity</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/tse_8c.html#a8">TestAccessCheck</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/tse_8c.html#a9">TestGenerateMessage</a> ()</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1" doxytag="tse.c::main" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int main           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em>[]</td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/tse_8c-source.html#l00039">39</a> of file <a class="el" href="../../d2/d5/tse_8c-source.html">tse.c</a>.
<p>
References <a class="el" href="../../d8/d1/init_8h.html#a22">KiSystemStartup()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00053">SeTest()</a>, <a class="el" href="../../d5/d9/tex_8c-source.html#l00033">TestFunction</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>00043 {
00044     <a class="code" href="../../d2/d7/hal_8h.html#a212">VOID</a> <a class="code" href="../../d8/d1/init_8h.html#a22">KiSystemStartup</a>();
00045 
00046     <a class="code" href="../../d4/d0/tex_8c.html#a2">TestFunction</a> = <a class="code" href="../../d1/d6/tse_8c.html#a0">SeTest</a>;
00047     <a class="code" href="../../d8/d1/init_8h.html#a22">KiSystemStartup</a>();
00048     <span class="keywordflow">return</span>( 0 );
00049 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="tse.c::SeTest" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SeTest           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/tse_8c-source.html#l00053">53</a> of file <a class="el" href="../../d2/d5/tse_8c-source.html">tse.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00503">TestAccessCheck()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00360">TestAssignSecurity()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00296">TestCaptureSecurityDescriptor()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00205">TestDefaultObjectMethod()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00575">TestGenerateMessage()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00105">TestMakeSystemToken()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00131">TestTokenCopy()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00177">TestTokenSize()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/tse_8c-source.html#l00039">main()</a>.
<p>
<pre class="fragment"><div>00054 {
00055     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a2">TestMakeSystemToken</a>();
00056     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a3">TestTokenCopy</a>();
00057     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a4">TestTokenSize</a>();
00058     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a5">TestDefaultObjectMethod</a>();
00059     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a6">TestCaptureSecurityDescriptor</a>();
00060     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a7">TestAssignSecurity</a>();
00061     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a8">TestAccessCheck</a>();
00062     BOOLEAN <a class="code" href="../../d1/d6/tse_8c.html#a9">TestGenerateMessage</a>();
00063 
00064     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Start SeTest()\n"</span>);
00065 
00066     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a2">TestMakeSystemToken</a>()) {
00067         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestMakeSystemToken() Error\n"</span>);
00068         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00069     }
00070     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a3">TestTokenCopy</a>()) {
00071         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestTokenCopy() Error\n"</span>);
00072         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00073     }
00074     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a4">TestTokenSize</a>()) {
00075         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestTokenSize() Error\n"</span>);
00076         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00077     }
00078     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a5">TestDefaultObjectMethod</a>()) {
00079         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestDefaultObjectMethod() Error\n"</span>);
00080         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00081     }
00082     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a6">TestCaptureSecurityDescriptor</a>()) {
00083         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestCaptureSecurityDescriptor() Error\n"</span>);
00084         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00085     }
00086     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a7">TestAssignSecurity</a>()) {
00087         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestAssignSecurity() Error\n"</span>);
00088         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00089     }
00090     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a8">TestAccessCheck</a>()) {
00091         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestAccessCheck() Error\n"</span>);
00092         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00093     }
00094     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d6/tse_8c.html#a9">TestGenerateMessage</a>()) {
00095         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"TestGenerateMessage() Error\n"</span>);
00096         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00097     }
00098 
00099     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"End SeTest()\n"</span>);
00100     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00101 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="tse.c::TestAccessCheck" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN TestAccessCheck           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/tse_8c-source.html#l00503">503</a> of file <a class="el" href="../../d2/d5/tse_8c-source.html">tse.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d6/tsevars_8c.html#a66a58">Fred</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d4/d5/tseum_8c-source.html#l00078">SeMain()</a>, and <a class="el" href="../../d2/d5/tse_8c-source.html#l00053">SeTest()</a>.
<p>
<pre class="fragment"><div>00504 {
00505     SECURITY_DESCRIPTOR SecurityDescriptor;
00506     PACL Acl;
00507 
00508     PACCESS_TOKEN <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00509 
00510     Acl = (PACL)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, 1024 );
00511     BuildAcl( Fred, Acl, 1024 );
00512 
00513     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (PACCESS_TOKEN)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, 512 );
00514     BuildToken( Fred, Token );
00515 
00516     DiscretionarySecurityDescriptor( &amp;SecurityDescriptor, Acl );
00517 
00518     <span class="comment">//</span>
00519     <span class="comment">//  Test should be successful based on aces</span>
00520     <span class="comment">//</span>
00521 
00522     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d4/accessck_8c.html#a18">SeAccessCheck</a>( &amp;SecurityDescriptor,
00523                         Token,
00524                         0x00000001,
00525                         NULL,
00526                         UserMode )) {
00527         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAccessCheck Error should allow access\n"</span>);
00528         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00529     }
00530 
00531     <span class="comment">//</span>
00532     <span class="comment">//  Test should be successful based on owner</span>
00533     <span class="comment">//</span>
00534 
00535     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d4/accessck_8c.html#a18">SeAccessCheck</a>( &amp;SecurityDescriptor,
00536                         Token,
00537                         READ_CONTROL,
00538                         &amp;FredGuid,
00539                         UserMode )) {
00540         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAccessCheck Error should allow owner\n"</span>);
00541         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00542     }
00543 
00544     <span class="comment">//</span>
00545     <span class="comment">//  Test should be unsuccessful based on aces</span>
00546     <span class="comment">//</span>
00547 
00548     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d4/accessck_8c.html#a18">SeAccessCheck</a>( &amp;SecurityDescriptor,
00549                        Token,
00550                        0x0000000f,
00551                        &amp;FredGuid,
00552                        UserMode )) {
00553         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAccessCheck Error shouldn't allow access\n"</span>);
00554         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00555     }
00556 
00557     <span class="comment">//</span>
00558     <span class="comment">//  Test should be unsuccessful based on non owner</span>
00559     <span class="comment">//</span>
00560 
00561     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d4/accessck_8c.html#a18">SeAccessCheck</a>( &amp;SecurityDescriptor,
00562                        Token,
00563                        READ_CONTROL,
00564                        &amp;BarneyGuid,
00565                        UserMode )) {
00566         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAccessCheck Error shouldn't allow non owner access\n"</span>);
00567         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00568     }
00569 
00570     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00571 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="tse.c::TestAssignSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN TestAssignSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/tse_8c-source.html#l00360">360</a> of file <a class="el" href="../../d2/d5/tse_8c-source.html">tse.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d6/tsevars_8c.html#a66a58">Fred</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00089">SeAssignSecurity()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/tse_8c-source.html#l00053">SeTest()</a>.
<p>
<pre class="fragment"><div>00361 {
00362     SECURITY_DESCRIPTOR SecurityDescriptor;
00363     PACL Acl;
00364 
00365     PACCESS_TOKEN <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00366 
00367     GENERIC_MAPPING GenericMapping;
00368 
00369     PSECURITY_DESCRIPTOR NewDescriptor;
00370 
00371     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00372 
00373     Acl = (PACL)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, 1024 );
00374     BuildAcl( Fred, Acl, 1024 );
00375 
00376     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (PACCESS_TOKEN)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, 512 );
00377     BuildToken( Fred, Token );
00378 
00379     DiscretionarySecurityDescriptor( &amp;SecurityDescriptor, Acl );
00380 
00381     <span class="comment">//</span>
00382     <span class="comment">//  Kernel mode, non dir, and no new</span>
00383     <span class="comment">//</span>
00384 
00385     NewDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00386     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00387                                             &amp;NewDescriptor,
00388                                             FALSE,
00389                                             Token,
00390                                             &amp;GenericMapping,
00391                                             KernelMode ))) {
00392         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error NoNew, NoDir, Kernel : %8lx\n"</span>, Status );
00393         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00394     }
00395 
00396     <span class="comment">//</span>
00397     <span class="comment">//  Kernel mode, non dir, and new</span>
00398     <span class="comment">//</span>
00399 
00400     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00401                                             &amp;NewDescriptor,
00402                                             FALSE,
00403                                             Token,
00404                                             &amp;GenericMapping,
00405                                             KernelMode ))) {
00406         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error New, NoDir, Kernel : %8lx\n"</span>, Status );
00407         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00408     }
00409 
00410     <span class="comment">//</span>
00411     <span class="comment">//  Kernel mode, dir, and no new</span>
00412     <span class="comment">//</span>
00413 
00414     NewDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00415     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00416                                             &amp;NewDescriptor,
00417                                             TRUE,
00418                                             Token,
00419                                             &amp;GenericMapping,
00420                                             KernelMode ))) {
00421         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error NoNew, Dir, Kernel : %8lx\n"</span>, Status );
00422         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00423     }
00424 
00425     <span class="comment">//</span>
00426     <span class="comment">//  Kernel mode, dir, and new</span>
00427     <span class="comment">//</span>
00428 
00429     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00430                                             &amp;NewDescriptor,
00431                                             TRUE,
00432                                             Token,
00433                                             &amp;GenericMapping,
00434                                             KernelMode ))) {
00435         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error New, Dir, Kernel : %8lx\n"</span>, Status );
00436         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00437     }
00438 
00439 
00440     <span class="comment">//</span>
00441     <span class="comment">//  User mode, non dir, and no new</span>
00442     <span class="comment">//</span>
00443 
00444     NewDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00445     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00446                                             &amp;NewDescriptor,
00447                                             FALSE,
00448                                             Token,
00449                                             &amp;GenericMapping,
00450                                             UserMode ))) {
00451         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error NoNew, NoDir, User : %8lx\n"</span>, Status );
00452         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00453     }
00454 
00455     <span class="comment">//</span>
00456     <span class="comment">//  User mode, non dir, and new</span>
00457     <span class="comment">//</span>
00458 
00459     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00460                                             &amp;NewDescriptor,
00461                                             FALSE,
00462                                             Token,
00463                                             &amp;GenericMapping,
00464                                             UserMode ))) {
00465         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error New, NoDir, User : %8lx\n"</span>, Status );
00466         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00467     }
00468 
00469     <span class="comment">//</span>
00470     <span class="comment">//  User mode, dir, and no new</span>
00471     <span class="comment">//</span>
00472 
00473     NewDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00474     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00475                                             &amp;NewDescriptor,
00476                                             TRUE,
00477                                             Token,
00478                                             &amp;GenericMapping,
00479                                             UserMode ))) {
00480         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error NoNew, Dir, User : %8lx\n"</span>, Status );
00481         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00482     }
00483 
00484     <span class="comment">//</span>
00485     <span class="comment">//  User mode, dir, and new</span>
00486     <span class="comment">//</span>
00487 
00488     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a>( &amp;SecurityDescriptor,
00489                                             &amp;NewDescriptor,
00490                                             TRUE,
00491                                             Token,
00492                                             &amp;GenericMapping,
00493                                             UserMode ))) {
00494         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeAssign Error New, Dir, User : %8lx\n"</span>, Status );
00495         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00496     }
00497 
00498     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00499 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="tse.c::TestCaptureSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN TestCaptureSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/tse_8c-source.html#l00296">296</a> of file <a class="el" href="../../d2/d5/tse_8c-source.html">tse.c</a>.
<p>
References <a class="el" href="../../d4/d6/tsevars_8c.html#a66a61">Barney</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00161">Dacl</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d4/d6/tsevars_8c.html#a66a60">Pebbles</a>, <a class="el" href="../../d3/d4/se_2capture_8c-source.html#l00053">SeCaptureSecurityDescriptor()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d0/d9/ntosdef_8h.html#a76a70">UserMode</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/tse_8c-source.html#l00053">SeTest()</a>.
<p>
<pre class="fragment"><div>00297 {
00298     SECURITY_DESCRIPTOR SecurityDescriptor;
00299     PACL Sacl;
00300     PACL <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>;
00301     PSECURITY_DESCRIPTOR NewDescriptor;
00302     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00303 
00304     Sacl = (PACL)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, 1024 );
00305     <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a> = (PACL)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, 1024 );
00306     BuildAcl( Pebbles, Sacl, 1024 );
00307     BuildAcl( Barney, Dacl, 1024 );
00308 
00309     DiscretionarySecurityDescriptor( &amp;SecurityDescriptor, Dacl );
00310     SecurityDescriptor.SecurityInformationClass = AllAclInformation;
00311     SecurityDescriptor.SystemAcl = Sacl;
00312 
00313     <span class="comment">//</span>
00314     <span class="comment">//  Capture kernel mode and don't force</span>
00315     <span class="comment">//</span>
00316 
00317     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d2/d5/se_2capture_8c.html#a1">SeCaptureSecurityDescriptor</a>( &amp;SecurityDescriptor,
00318                                                        KernelMode,
00319                                                        PagedPool,
00320                                                        FALSE,
00321                                                        &amp;NewDescriptor ))) {
00322         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeCapture Error, KernelMode, FALSE : %8lx\n"</span>, Status );
00323         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00324     }
00325 
00326     <span class="comment">//</span>
00327     <span class="comment">//  Capture kernel mode and force</span>
00328     <span class="comment">//</span>
00329 
00330     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d2/d5/se_2capture_8c.html#a1">SeCaptureSecurityDescriptor</a>( &amp;SecurityDescriptor,
00331                                                        KernelMode,
00332                                                        PagedPool,
00333                                                        TRUE,
00334                                                        &amp;NewDescriptor ))) {
00335         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeCapture Error, KernelMode, TRUE : %8lx\n"</span>, Status );
00336         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00337     } <span class="keywordflow">else</span> {
00338         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( NewDescriptor );
00339     }
00340 
00341     <span class="comment">//</span>
00342     <span class="comment">//  Capture user mode</span>
00343     <span class="comment">//</span>
00344 
00345     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d2/d5/se_2capture_8c.html#a1">SeCaptureSecurityDescriptor</a>( &amp;SecurityDescriptor,
00346                                                        UserMode,
00347                                                        PagedPool,
00348                                                        TRUE,
00349                                                        &amp;NewDescriptor ))) {
00350         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeCapture Error, UserMode, FALSE : %8lx\n"</span>, Status );
00351         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00352     } <span class="keywordflow">else</span> {
00353         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( NewDescriptor );
00354     }
00355 
00356     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00357 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="tse.c::TestDefaultObjectMethod" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN TestDefaultObjectMethod           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/tse_8c-source.html#l00205">205</a> of file <a class="el" href="../../d2/d5/tse_8c-source.html">tse.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d0/d5/se_8h.html#a200a110">DeleteSecurityDescriptor</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d6/tsevars_8c.html#a66a58">Fred</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d0/d5/se_8h.html#a200a109">QuerySecurityDescriptor</a>, <a class="el" href="../../d1/d5/semethod_8c-source.html#l00195">SeDefaultObjectMethod()</a>, <a class="el" href="../../d0/d5/se_8h.html#a200a108">SetSecurityDescriptor</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d6/tsevars_8c.html#a66a59">Wilma</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/tse_8c-source.html#l00053">SeTest()</a>.
<p>
<pre class="fragment"><div>00206 {
00207     SECURITY_DESCRIPTOR SecurityDescriptor;
00208     PSECURITY_DESCRIPTOR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00209     PACL Acl;
00210     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00211     PSECURITY_DESCRIPTOR ObjectsSecurityDescriptor;
00212     ULONG Length;
00213 
00214     Acl = (PACL)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, 1024 );
00215     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a> = (PSECURITY_DESCRIPTOR)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, 1024 );
00216 
00217     BuildAcl( Fred, Acl, 1024 );
00218     DiscretionarySecurityDescriptor( &amp;SecurityDescriptor, Acl );
00219 
00220     ObjectsSecurityDescriptor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00221 
00222     <span class="comment">//</span>
00223     <span class="comment">//  Set the descriptor</span>
00224     <span class="comment">//</span>
00225 
00226     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d0/d6/semethod_8c.html#a3">SeDefaultObjectMethod</a>( NULL,
00227                                                  SetSecurityDescriptor,
00228                                                  &amp;SecurityDescriptor,
00229                                                  0,
00230                                                  NULL,
00231                                                  &amp;ObjectsSecurityDescriptor,
00232                                                  PagedPool ))) {
00233 
00234         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeDefaultObjectMethod setting error: %8lx\n"</span>, Status );
00235         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00236     }
00237 
00238     <span class="comment">//</span>
00239     <span class="comment">//  Query the descriptor</span>
00240     <span class="comment">//</span>
00241 
00242     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d0/d6/semethod_8c.html#a3">SeDefaultObjectMethod</a>( NULL,
00243                                                  QuerySecurityDescriptor,
00244                                                  Buffer,
00245                                                  AllAclInformation,
00246                                                  &amp;Length,
00247                                                  &amp;ObjectsSecurityDescriptor,
00248                                                  PagedPool ))) {
00249 
00250         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeDefaultObjectMethod reading error: %8lx\n"</span>, Status );
00251         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00252     }
00253 
00254     <span class="comment">//</span>
00255     <span class="comment">//  Replace the descriptor</span>
00256     <span class="comment">//</span>
00257 
00258     BuildAcl( Wilma, Acl, 1024 );
00259 
00260     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d0/d6/semethod_8c.html#a3">SeDefaultObjectMethod</a>( NULL,
00261                                                  SetSecurityDescriptor,
00262                                                  &amp;SecurityDescriptor,
00263                                                  AllAclInformation,
00264                                                  &amp;Length,
00265                                                  &amp;ObjectsSecurityDescriptor,
00266                                                  PagedPool ))) {
00267 
00268         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeDefaultObjectMethod reading error: %8lx\n"</span>, Status );
00269         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00270     }
00271 
00272     <span class="comment">//</span>
00273     <span class="comment">//  Delete the descriptor</span>
00274     <span class="comment">//</span>
00275 
00276     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = <a class="code" href="../../d0/d6/semethod_8c.html#a3">SeDefaultObjectMethod</a>( NULL,
00277                                                  DeleteSecurityDescriptor,
00278                                                  NULL,
00279                                                  0,
00280                                                  NULL,
00281                                                  &amp;ObjectsSecurityDescriptor,
00282                                                  PagedPool ))) {
00283 
00284         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeDefaultObjectMethod deleting error: %8lx\n"</span>, Status );
00285         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00286     }
00287 
00288     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(Acl);
00289     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>(Buffer);
00290 
00291     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00292 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="tse.c::TestGenerateMessage" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN TestGenerateMessage           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/tse_8c-source.html#l00575">575</a> of file <a class="el" href="../../d2/d5/tse_8c-source.html">tse.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d5/tseum_8c-source.html#l00078">SeMain()</a>, and <a class="el" href="../../d2/d5/tse_8c-source.html#l00053">SeTest()</a>.
<p>
<pre class="fragment"><div>00576 {
00577     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00578 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="tse.c::TestMakeSystemToken" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN TestMakeSystemToken           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/tse_8c-source.html#l00105">105</a> of file <a class="el" href="../../d2/d5/tse_8c-source.html">tse.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d5/d2/token_8c-source.html#l00536">SeMakeSystemToken()</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/tse_8c-source.html#l00053">SeTest()</a>.
<p>
<pre class="fragment"><div>00106 {
00107     PACCESS_TOKEN <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00108 
00109     <span class="comment">//</span>
00110     <span class="comment">//  Make the system token</span>
00111     <span class="comment">//</span>
00112 
00113     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (PACCESS_TOKEN)<a class="code" href="../../d0/d5/se_8h.html#a153">SeMakeSystemToken</a>( PagedPool );
00114 
00115     <span class="comment">//</span>
00116     <span class="comment">//  and check its contents</span>
00117     <span class="comment">//</span>
00118 
00119     <span class="keywordflow">if</span> (!SepIsSystemToken( Token, ((ACCESS_TOKEN *)Token)-&gt;Size )) {
00120         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SepIsSystemToken Error\n"</span>);
00121         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00122     }
00123 
00124     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( Token );
00125 
00126     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00127 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="tse.c::TestTokenCopy" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN TestTokenCopy           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/tse_8c-source.html#l00131">131</a> of file <a class="el" href="../../d2/d5/tse_8c-source.html">tse.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d6/tsevars_8c.html#a66a58">Fred</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/tse_8c-source.html#l00053">SeTest()</a>.
<p>
<pre class="fragment"><div>00132 {
00133     PACCESS_TOKEN InToken;
00134     PACCESS_TOKEN OutToken;
00135 
00136     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00137 
00138     ULONG i;
00139 
00140     <span class="comment">//</span>
00141     <span class="comment">//  Allocate Buffers, and build a token</span>
00142     <span class="comment">//</span>
00143 
00144     InToken = (PACCESS_TOKEN)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, 512);
00145     OutToken = (PACCESS_TOKEN)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, 512);
00146 
00147     BuildToken( Fred, InToken );
00148 
00149     <span class="comment">//</span>
00150     <span class="comment">//  Make a copy of the token</span>
00151     <span class="comment">//</span>
00152 
00153     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status = SeTokenCopy( InToken, OutToken, 512))) {
00154         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeTokenCopy Error: %8lx\n"</span>, Status);
00155         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00156     }
00157 
00158     <span class="comment">//</span>
00159     <span class="comment">//  check both tokens for equality</span>
00160     <span class="comment">//</span>
00161 
00162     <span class="keywordflow">for</span> (i = 0; i &lt; ((ACCESS_TOKEN *)InToken)-&gt;Size; i += 1) {
00163         <span class="keywordflow">if</span> (*((PUCHAR)InToken + 1) != *((PUCHAR)OutToken + 1)) {
00164             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Token copy error\n"</span>);
00165             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00166         }
00167     }
00168 
00169     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( InToken );
00170     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( OutToken );
00171 
00172     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00173 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="tse.c::TestTokenSize" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN TestTokenSize           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/tse_8c-source.html#l00177">177</a> of file <a class="el" href="../../d2/d5/tse_8c-source.html">tse.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d4/d6/tsevars_8c.html#a66a59">Wilma</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/tse_8c-source.html#l00053">SeTest()</a>.
<p>
<pre class="fragment"><div>00178 {
00179     PACCESS_TOKEN <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
00180 
00181     <span class="comment">//</span>
00182     <span class="comment">//  Allocate and build a token</span>
00183     <span class="comment">//</span>
00184 
00185     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> = (PACCESS_TOKEN)<a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>(PagedPool, 512);
00186 
00187     BuildToken( Wilma, Token );
00188 
00189     <span class="comment">//</span>
00190     <span class="comment">//  Get the token size</span>
00191     <span class="comment">//</span>
00192 
00193     <span class="keywordflow">if</span> (SeTokenSize(Token) != ((ACCESS_TOKEN *)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>)-&gt;Size) {
00194         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SeTokenSize error\n"</span>);
00195         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00196     }
00197 
00198     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( Token );
00199 
00200     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00201 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:49 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
