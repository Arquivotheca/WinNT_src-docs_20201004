<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: low.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>low.c File Reference</h1><code>#include "<a class="el" href="../../d4/d2/arcinst_2precomp_8h-source.html">precomp.h</a>"</code><br>
<code>#include &lt;bootmbr.h&gt;</code><br>

<p>
<a href="../../d2/d5/low_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d8/struct__tagCHS.html">_tagCHS</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a0">MAX_TRANSFER</a>&nbsp;&nbsp;&nbsp;65536</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a1">PSTART</a>(p)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a2">PLENGTH</a>(p)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a3">ZeroPartitionTableEntry</a>(p)&nbsp;&nbsp;&nbsp;SetPartitionTableEntry(p,0,SYSID_UNUSED,0,0,NULL);</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a4">SECCNT</a>(l)&nbsp;&nbsp;&nbsp;((ULONG)(((ULONGLONG)l.QuadPart)/((ULONGLONG)bps)))</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d8/struct__tagCHS.html">_tagCHS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a7">CHS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d8/struct__tagCHS.html">_tagCHS</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a8">PCHS</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a9">LowOpenDisk</a> (IN PCHAR DevicePath, OUT PULONG DiskId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a10">LowCloseDisk</a> (IN ULONG DiskId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a11">LowGetDriveGeometry</a> (IN PCHAR DevicePath, OUT PULONG TotalSectorCount, OUT PULONG SectorSize, OUT PULONG SectorsPerTrack, OUT PULONG Heads)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a12">LowGetPartitionGeometry</a> (IN PCHAR PartitionPath, OUT PULONG TotalSectorCount, OUT PULONG SectorSize, OUT PULONG SectorsPerTrack, OUT PULONG Heads)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a13">LowReadSectors</a> (IN ULONG VolumeId, IN ULONG SectorSize, IN ULONG StartingSector, IN ULONG NumberOfSectors, OUT PVOID <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a14">LowWriteSectors</a> (IN ULONG VolumeId, IN ULONG SectorSize, IN ULONG StartingSector, IN ULONG NumberOfSectors, IN PVOID <a class="el" href="../../d8/d6/ttri_8c.html#a3">Buffer</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>PCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a15">AlGetPathnameFromComponent</a> (IN <a class="el" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a> Component)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a16">LowQueryPathFromComponent</a> (IN <a class="el" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a> Component, OUT PCHAR *Path)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a17">LowTraverseChildren</a> (IN <a class="el" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a> Parent, IN <a class="el" href="../../d1/d9/arc_8h.html#a54">CONFIGURATION_CLASS</a> *ConfigClass OPTIONAL, IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> *ConfigType OPTIONAL, IN OUT <a class="el" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a> *MatchingArray OPTIONAL, IN OUT PULONG <a class="el" href="../../d2/d1/cttoken_8c.html#a46">CurrentLength</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a18">LowQueryComponentList</a> (IN <a class="el" href="../../d1/d9/arc_8h.html#a54">CONFIGURATION_CLASS</a> *ConfigClass OPTIONAL, IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> *ConfigType OPTIONAL, OUT <a class="el" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a> **ComponentList, OUT PULONG ListLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a19">LowQueryPathList</a> (IN <a class="el" href="../../d1/d9/arc_8h.html#a54">CONFIGURATION_CLASS</a> *ConfigClass OPTIONAL, IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> *ConfigType OPTIONAL, OUT PCHAR **PathList, OUT PULONG ListLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a20">LowFreePathList</a> (IN PCHAR *PathList, IN ULONG ListLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a21">LowQueryFdiskPathList</a> (OUT PCHAR **PathList, OUT PULONG ListLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a22">LowFreeFdiskPathList</a> (IN OUT PCHAR *PathList, IN ULONG ListLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a23">LowGetDiskLayout</a> (IN PCHAR Path, OUT PDRIVE_LAYOUT_INFORMATION *DriveLayout)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a24">CalculateCHSVals</a> (IN ULONG <a class="el" href="../../d5/d2/config_2ia64_2initia64_8c.html#a14">Start</a>, IN ULONG <a class="el" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a0">Size</a>, IN ULONG spt, IN ULONG h, OUT <a class="el" href="../../d4/d8/struct__tagCHS.html">PCHS</a> chs)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a25">SetPartitionTableEntry</a> (IN OUT <a class="el" href="../../d5/d8/struct__PARTITION__DESCRIPTOR.html">PPARTITION_DESCRIPTOR</a> p, IN UCHAR Active, IN UCHAR SysID, IN ULONG RelativeSector, IN ULONG SectorCount, IN <a class="el" href="../../d4/d8/struct__tagCHS.html">PCHS</a> chs)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a26">ZeroPartitionTable</a> (<a class="el" href="../../d5/d8/struct__PARTITION__DESCRIPTOR.html">PPARTITION_DESCRIPTOR</a> PartitionTable)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a27">LowSetDiskLayout</a> (IN PCHAR Path, IN PDRIVE_LAYOUT_INFORMATION DriveLayout)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>PCHAR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a5">MnemonicTable</a> []</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d2/d1/bench_8h.html#a8">CHAR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d6/low_8c.html#a6">Pathname</a> [256]</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="low.c::MAX_TRANSFER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX_TRANSFER&nbsp;&nbsp;&nbsp;65536          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00208">208</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l00212">LowReadSectors()</a>, and <a class="el" href="../../d2/d5/low_8c-source.html#l00281">LowWriteSectors()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="low.c::PLENGTH" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PLENGTH          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">p&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                              \
        (ULONG) ((p)-&gt;PartitionLengthLsb0) +          \
        (ULONG) ((p)-&gt;PartitionLengthLsb1 &lt;&lt; 8) +     \
        (ULONG) ((p)-&gt;PartitionLengthMsb0 &lt;&lt; 16) +    \
        (ULONG) ((p)-&gt;PartitionLengthMsb1 &lt;&lt; 24) )
</div></pre>
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l00812">LowGetDiskLayout()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="low.c::PSTART" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PSTART          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">p&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(                                \
        (ULONG) ((p)-&gt;StartingSectorLsb0) +           \
        (ULONG) ((p)-&gt;StartingSectorLsb1 &lt;&lt; 8) +      \
        (ULONG) ((p)-&gt;StartingSectorMsb0 &lt;&lt; 16) +     \
        (ULONG) ((p)-&gt;StartingSectorMsb1 &lt;&lt; 24) )
</div></pre>
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l00812">LowGetDiskLayout()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="low.c::SECCNT" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SECCNT          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">l&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((ULONG)(((ULONGLONG)l.QuadPart)/((ULONGLONG)bps)))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l01076">LowSetDiskLayout()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="low.c::ZeroPartitionTableEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define ZeroPartitionTableEntry          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">p&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;SetPartitionTableEntry(p,0,SYSID_UNUSED,0,0,NULL);</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l01060">1060</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l01076">LowSetDiskLayout()</a>, and <a class="el" href="../../d2/d5/low_8c-source.html#l01063">ZeroPartitionTable()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a7" doxytag="low.c::CHS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d8/struct__tagCHS.html">_tagCHS</a>  <a class="el" href="../../d4/d8/struct__tagCHS.html">CHS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="low.c::PCHS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d8/struct__tagCHS.html">_tagCHS</a> * <a class="el" href="../../d4/d8/struct__tagCHS.html">PCHS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a15" doxytag="low.c::AlGetPathnameFromComponent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PCHAR AlGetPathnameFromComponent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Component</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00422">422</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d2/d8/arc_8h-source.html#l01470">ArcGetParent</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00373">MnemonicTable</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00418">Pathname</a>, <a class="el" href="../../d1/d9/arc_8h.html#a59">PCONFIGURATION_COMPONENT</a>, and <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l00486">LowQueryPathFromComponent()</a>.
<p>
<pre class="fragment"><div>00428                    :
00429 
00430     This function builds an ARC pathname <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified component.
00431 
00432 Arguments:
00433 
00434     Component - Supplies a pointer to a configuration component.
00435 
00436 Return Value:
00437 
00438     Returns a pointer to a string which contains <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ARC pathname <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00439     component.  NOTE: The string <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> stored in <span class="keyword">static</span> storage, and must be
00440     copied by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user before another call to <span class="keyword">this</span> routine.
00441 
00442 --*/
00443 {
00444     <a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a> ParentComponent;
00445     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> NewSegment[16];
00446     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> Tempname[256];
00447 
00448     <a class="code" href="../../d1/d6/low_8c.html#a6">Pathname</a>[0] = 0;
00449 
00450     <span class="comment">//</span>
00451     <span class="comment">// Loop while not at the root component.</span>
00452     <span class="comment">//</span>
00453 
00454     <span class="keywordflow">while</span> ((ParentComponent = <a class="code" href="../../d1/d9/arc_8h.html#a18">ArcGetParent</a>(Component)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00455 
00456         <span class="comment">//</span>
00457         <span class="comment">// Build new pathname segment from the Component type and key.</span>
00458         <span class="comment">//</span>
00459 
00460         <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(NewSegment,
00461                 <span class="stringliteral">"%s(%d)"</span>,
00462                 MnemonicTable[Component-&gt;Type],
00463                 Component-&gt;Key);
00464 
00465         <span class="comment">//</span>
00466         <span class="comment">// Add the new segment as a prefix of the current pathname.</span>
00467         <span class="comment">//</span>
00468 
00469         strcpy(Tempname, Pathname);
00470         strcpy(Pathname, NewSegment);
00471         strcat(Pathname, Tempname);
00472 
00473         <span class="comment">//</span>
00474         <span class="comment">// Move to the parent component.</span>
00475         <span class="comment">//</span>
00476 
00477         Component = ParentComponent;
00478     }
00479 
00480     <span class="keywordflow">return</span> <a class="code" href="../../d1/d6/low_8c.html#a6">Pathname</a>;
00481 }
<span class="comment">/******************* END OF DAVIDRO CODE *********************************/</span>
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="low.c::CalculateCHSVals" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID CalculateCHSVals           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Start</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Size</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>spt</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>h</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d4/d8/struct__tagCHS.html">PCHS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>chs</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00980">980</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00050">End</a>, <a class="el" href="../../d9/d6/lh__open_2pi__mem_8h-source.html#l00017">Size</a>, <a class="el" href="../../d0/d1/config_2i386_2init386_8c-source.html#l00049">Start</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l01076">LowSetDiskLayout()</a>.
<p>
<pre class="fragment"><div>00987 {
00988     ULONG spc = spt * h;        <span class="comment">// sectors per cylinder</span>
00989     ULONG r;
00990     ULONG <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a> = <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a>+<a class="code" href="../../d8/d7/lh__open_2pi__mem_8h.html#a0">Size</a>-1;
00991 
00992     chs-&gt;StartCylinder = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(<a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a>/spc);
00993     r = <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a18">Start</a> % spc;
00994     chs-&gt;StartHead = (UCHAR)(r / spt);
00995     chs-&gt;StartSector = (UCHAR)((r % spt) + 1);      <span class="comment">// sector is 1-based</span>
00996 
00997     chs-&gt;EndCylinder = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(<a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a>/spc);
00998     r = <a class="code" href="../../d9/d1/config_2i386_2init386_8c.html#a19">End</a> % spc;
00999     chs-&gt;EndHead = (UCHAR)(r / spt);
01000     chs-&gt;EndSector = (UCHAR)((r % spt) + 1);        <span class="comment">// sector is 1-based</span>
01001 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="low.c::LowCloseDisk" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowCloseDisk           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>DiskId</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00036">36</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d2/d8/arc_8h-source.html#l01514">ArcClose</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/fdengine_8c-source.html#l00302">CheckIfDiskIsOffLine()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00812">LowGetDiskLayout()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l01076">LowSetDiskLayout()</a>, and <a class="el" href="../../d9/d0/fdengine_8c-source.html#l02823">ZapSector()</a>.
<p>
<pre class="fragment"><div>00041                    :
00042 
00043     This routine closes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied device.
00044 
00045 Arguments:
00046 
00047     DiskId      - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> disk <span class="keywordtype">id</span>.
00048 
00049 Return Value:
00050 
00051     <a class="code" href="../../d1/d9/arc_8h.html#a29">ArcClose</a>
00052 
00053 --*/
00054 {
00055     <span class="keywordflow">return</span> <a class="code" href="../../d1/d9/arc_8h.html#a29">ArcClose</a>(DiskId);
00056 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="low.c::LowFreeFdiskPathList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowFreeFdiskPathList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PCHAR *&nbsp;</td>
          <td class="mdname" nowrap> <em>PathList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ListLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00786">786</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d2/d5/low_8c-source.html#l00721">LowFreePathList()</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/fdengine_8c-source.html#l00258">FdiskCleanUp()</a>.
<p>
<pre class="fragment"><div>00792                    :
00793 
00794     This routine frees up <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> space taken by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> lists.
00795 
00796 Arguments:
00797 
00798     PathList    - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> paths.
00799     ListLength  - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of paths.
00800 
00801 Return Value:
00802 
00803     <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>
00804 
00805 --*/
00806 {
00807     <span class="keywordflow">return</span> <a class="code" href="../../d1/d6/low_8c.html#a20">LowFreePathList</a>(PathList, ListLength);
00808 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="low.c::LowFreePathList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowFreePathList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCHAR *&nbsp;</td>
          <td class="mdname" nowrap> <em>PathList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ListLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00721">721</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>, and <a class="el" href="../../d5/d8/arcinst_8h-source.html#l00332">FreeMemory</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/fmtexp_8c-source.html#l00919">FmtFreeFatPartitionList()</a>, <a class="el" href="../../d2/d5/fmtexp_8c-source.html#l00724">FmtQueryFatPartitionList()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00786">LowFreeFdiskPathList()</a>, and <a class="el" href="../../d2/d5/low_8c-source.html#l00651">LowQueryPathList()</a>.
<p>
<pre class="fragment"><div>00727                    :
00728 
00729     This routine frees up <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> space taken by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> lists.
00730 
00731 Arguments:
00732 
00733     PathList    - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> paths.
00734     ListLength  - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of paths.
00735 
00736 Return Value:
00737 
00738     <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>
00739 
00740 --*/
00741 {
00742     ULONG i;
00743 
00744     <span class="keywordflow">for</span> (i = 0; i &lt; ListLength; i++) {
00745         <span class="keywordflow">if</span> (PathList[i]) {
00746             <a class="code" href="../../d4/d9/arcinst_8h.html#a22">FreeMemory</a>(PathList[i]);
00747         }
00748     }
00749     <a class="code" href="../../d4/d9/arcinst_8h.html#a22">FreeMemory</a>(PathList);
00750 
00751     <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>;
00752 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="low.c::LowGetDiskLayout" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowGetDiskLayout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Path</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PDRIVE_LAYOUT_INFORMATION *&nbsp;</td>
          <td class="mdname" nowrap> <em>DriveLayout</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00812">812</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d3/d6/hal_8h-source.html#l00122">_PARTITION_DESCRIPTOR::ActiveFlag</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l01113">AlAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l01134">AlDeallocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l01153">AlReallocateHeap()</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00040">ARC_STATUS</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l00157">BOOT_RECORD_SIGNATURE</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l00151">BOOT_SIGNATURE_OFFSET</a>, <a class="el" href="../../d1/d1/config_2test_2init386_8c-source.html#l00027">dummy()</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00036">LowCloseDisk()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00059">LowGetDriveGeometry()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00006">LowOpenDisk()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00212">LowReadSectors()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l00144">NUM_PARTITION_TABLE_ENTRIES</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l00150">PARTITION_TABLE_OFFSET</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l00126">_PARTITION_DESCRIPTOR::PartitionType</a>, <a class="el" href="../../d1/d6/low_8c.html#a2">PLENGTH</a>, <a class="el" href="../../d1/d6/low_8c.html#a1">PSTART</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, <a class="el" href="../../d4/d9/arcinst_8h.html#a176a71">SYSID_EXTENDED</a>, <a class="el" href="../../d4/d9/arcinst_8h.html#a176a70">SYSID_UNUSED</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/fdengine_8c-source.html#l01882">InitializePartitionLists()</a>.
<p>
<pre class="fragment"><div>00816 {
00817     <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>                status;
00818     ULONG                     <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
00819     ULONG                     i,ExtendedStart,BootSector,Entry;
00820     ULONG                     <a class="code" href="../../d0/d2/config_2test_2init386_8c.html#a0">dummy</a>,bps;
00821     BOOLEAN                   Link,mbr;
00822     PDRIVE_LAYOUT_INFORMATION DriveInfo;
00823     PPARTITION_INFORMATION    p;
00824     PCHAR                     SectorBuffer;
00825     <a class="code" href="../../d5/d8/struct__PARTITION__DESCRIPTOR.html">PPARTITION_DESCRIPTOR</a>     ptable;
00826 
00827 
00828 <span class="preprocessor">#define PSTART(p)  (                                \</span>
00829 <span class="preprocessor">        (ULONG) ((p)-&gt;StartingSectorLsb0) +           \</span>
00830 <span class="preprocessor">        (ULONG) ((p)-&gt;StartingSectorLsb1 &lt;&lt; 8) +      \</span>
00831 <span class="preprocessor">        (ULONG) ((p)-&gt;StartingSectorMsb0 &lt;&lt; 16) +     \</span>
00832 <span class="preprocessor">        (ULONG) ((p)-&gt;StartingSectorMsb1 &lt;&lt; 24) )</span>
00833 <span class="preprocessor"></span>
00834 <span class="preprocessor">#define PLENGTH(p)   (                              \</span>
00835 <span class="preprocessor">        (ULONG) ((p)-&gt;PartitionLengthLsb0) +          \</span>
00836 <span class="preprocessor">        (ULONG) ((p)-&gt;PartitionLengthLsb1 &lt;&lt; 8) +     \</span>
00837 <span class="preprocessor">        (ULONG) ((p)-&gt;PartitionLengthMsb0 &lt;&lt; 16) +    \</span>
00838 <span class="preprocessor">        (ULONG) ((p)-&gt;PartitionLengthMsb1 &lt;&lt; 24) )</span>
00839 <span class="preprocessor"></span>
00840 
00841 
00842     <span class="keywordflow">if</span>((DriveInfo = <a class="code" href="../../d4/d6/memory_8c.html#a22">AlAllocateHeap</a>(<span class="keyword">sizeof</span>(DRIVE_LAYOUT_INFORMATION) + (500*<span class="keyword">sizeof</span>(PARTITION_INFORMATION)))) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00843         <span class="keywordflow">return</span>(<a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>);
00844     }
00845     p = &amp;DriveInfo-&gt;PartitionEntry[0];
00846 
00847     <span class="keywordflow">if</span>((status = <a class="code" href="../../d1/d6/low_8c.html#a11">LowGetDriveGeometry</a>(Path,&amp;dummy,&amp;bps,&amp;dummy,&amp;dummy)) != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00848         <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(DriveInfo);
00849         <span class="keywordflow">return</span>(status);
00850     }
00851 
00852     <span class="keywordflow">if</span>((SectorBuffer = <a class="code" href="../../d4/d6/memory_8c.html#a22">AlAllocateHeap</a>(bps)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00853         <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(DriveInfo);
00854         <span class="keywordflow">return</span>(<a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>);
00855     }
00856 
00857     ptable = (<a class="code" href="../../d5/d8/struct__PARTITION__DESCRIPTOR.html">PPARTITION_DESCRIPTOR</a>)(SectorBuffer + (2*<a class="code" href="../../d2/d7/hal_8h.html#a10">PARTITION_TABLE_OFFSET</a>));
00858 
00859     <span class="keywordflow">if</span>((status = <a class="code" href="../../d1/d6/low_8c.html#a9">LowOpenDisk</a>(Path,&amp;Handle)) != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00860         <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(SectorBuffer);
00861         <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(DriveInfo);
00862         <span class="keywordflow">return</span>(status);
00863     }
00864 
00865     mbr = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00866     Entry = 0;
00867     BootSector = 0;
00868     ExtendedStart = 0;
00869     status = <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>;
00870 
00871     <span class="keywordflow">do</span> {
00872 
00873         <span class="keywordflow">if</span>((status = <a class="code" href="../../d1/d6/low_8c.html#a13">LowReadSectors</a>(Handle,bps,BootSector,1,SectorBuffer)) != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00874             <span class="keywordflow">break</span>;
00875         }
00876 
00877         <span class="comment">// This is to catch the case where there is no MBR yet.</span>
00878 
00879         <span class="keywordflow">if</span>(((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)SectorBuffer)[<a class="code" href="../../d2/d7/hal_8h.html#a11">BOOT_SIGNATURE_OFFSET</a>] != <a class="code" href="../../d2/d7/hal_8h.html#a12">BOOT_RECORD_SIGNATURE</a>) {
00880             <span class="keywordflow">break</span>;
00881         }
00882 
00883         Link = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00884 
00885         <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="../../d2/d7/hal_8h.html#a9">NUM_PARTITION_TABLE_ENTRIES</a>; i++) {
00886 
00887             <span class="keywordflow">if</span>(ptable[i].<a class="code" href="../../d5/d8/struct__PARTITION__DESCRIPTOR.html#o4">PartitionType</a> == <a class="code" href="../../d4/d9/arcinst_8h.html#a176a70">SYSID_UNUSED</a>) {
00888 
00889                 <span class="comment">// set as unused.</span>
00890 
00891                 p[Entry].PartitionType    = <a class="code" href="../../d4/d9/arcinst_8h.html#a176a70">SYSID_UNUSED</a>;
00892                 p[Entry].BootIndicator    = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00893                 p[Entry].RewritePartition = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00894                 p[Entry].PartitionLength.QuadPart  = 0;
00895                 p[Entry].HiddenSectors    = 0;
00896                 p[Entry].StartingOffset.QuadPart   = 0;
00897                 p[Entry].RecognizedPartition = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00898 
00899             } <span class="keywordflow">else</span> {
00900 
00901                 LARGE_INTEGER   Result1, Result2;
00902 
00903                 p[Entry].PartitionType    = ptable[i].<a class="code" href="../../d5/d8/struct__PARTITION__DESCRIPTOR.html#o4">PartitionType</a>;
00904                 p[Entry].BootIndicator    = ptable[i].<a class="code" href="../../d5/d8/struct__PARTITION__DESCRIPTOR.html#o0">ActiveFlag</a>;
00905                 p[Entry].RewritePartition = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00906                 p[Entry].PartitionLength.QuadPart  = UInt32x32To64(<a class="code" href="../../d1/d6/low_8c.html#a2">PLENGTH</a>(ptable + i),bps);
00907 
00908                 <span class="comment">// BUGBUG (tedm) the following are not correct for link</span>
00909                 <span class="comment">//               entries in the extended partition.</span>
00910                 <span class="comment">//               But fdisk does not use these values in</span>
00911                 <span class="comment">//               this case so blow it off.  As of</span>
00912                 <span class="comment">//               11/13/91, IoReadPartitionTable has the</span>
00913                 <span class="comment">//               same bug.</span>
00914 
00915                 p[Entry].HiddenSectors    = <a class="code" href="../../d1/d6/low_8c.html#a1">PSTART</a>(ptable + i);
00916                 Result1.QuadPart = UInt32x32To64(<a class="code" href="../../d1/d6/low_8c.html#a1">PSTART</a>(ptable + i),bps);
00917                 Result2.QuadPart = UInt32x32To64(BootSector,bps);
00918                 p[Entry].StartingOffset.QuadPart = Result1.QuadPart + Result2.QuadPart;
00919 
00920                 p[Entry].RecognizedPartition = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;     <span class="comment">// BUGBUG this is broken</span>
00921 
00922                 <span class="keywordflow">if</span>(p[Entry].PartitionType == <a class="code" href="../../d4/d9/arcinst_8h.html#a176a71">SYSID_EXTENDED</a>) {
00923 
00924                     Link = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00925 
00926                     <span class="keywordflow">if</span>(mbr) {
00927                         mbr = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00928                         BootSector = <a class="code" href="../../d1/d6/low_8c.html#a1">PSTART</a>(ptable + i);
00929                         ExtendedStart = BootSector;
00930                     } <span class="keywordflow">else</span> {
00931                         BootSector = ExtendedStart + <a class="code" href="../../d1/d6/low_8c.html#a1">PSTART</a>(ptable + i);
00932                     }
00933                 }
00934             }
00935             Entry++;
00936         }
00937     } <span class="keywordflow">while</span>(Link);
00938 
00939     <a class="code" href="../../d1/d6/low_8c.html#a10">LowCloseDisk</a>(Handle);
00940 
00941     <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(SectorBuffer);
00942 
00943     <span class="keywordflow">if</span>(status != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00944 
00945         <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(DriveInfo);
00946         <span class="keywordflow">return</span>(status);
00947     }
00948 
00949     <span class="comment">// reallocate DriveInfo, set PartitionCount field.</span>
00950     <span class="comment">// DriveInfo is shrinking.</span>
00951 
00952     DriveInfo = <a class="code" href="../../d4/d6/memory_8c.html#a24">AlReallocateHeap</a>(DriveInfo,
00953                                    <span class="keyword">sizeof</span>(DRIVE_LAYOUT_INFORMATION)
00954                                  + ((Entry - 1) * <span class="keyword">sizeof</span>(PARTITION_INFORMATION))
00955                                 );
00956 
00957     DriveInfo-&gt;PartitionCount = Entry;
00958 
00959     *DriveLayout = DriveInfo;
00960 
00961     <span class="keywordflow">return</span>(<a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>);
00962 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="low.c::LowGetDriveGeometry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowGetDriveGeometry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>DevicePath</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>TotalSectorCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SectorSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SectorsPerTrack</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Heads</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00059">59</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00076">LowGetPartitionGeometry()</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l00230">SectorSize</a>, and <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/fdengine_8c-source.html#l00342">GetGeometry()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00812">LowGetDiskLayout()</a>, and <a class="el" href="../../d2/d5/low_8c-source.html#l01076">LowSetDiskLayout()</a>.
<p>
<pre class="fragment"><div>00066 {
00067     <span class="keywordtype">char</span> <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[256];
00068 
00069     <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(Buffer,<span class="stringliteral">"%spartition(0)"</span>,DevicePath);
00070     <span class="keywordflow">return</span>(<a class="code" href="../../d1/d6/low_8c.html#a12">LowGetPartitionGeometry</a>(Buffer,TotalSectorCount,SectorSize,SectorsPerTrack,Heads));
00071 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="low.c::LowGetPartitionGeometry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowGetPartitionGeometry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>PartitionPath</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>TotalSectorCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SectorSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SectorsPerTrack</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Heads</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00076">76</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d2/d8/arc_8h-source.html#l00040">ARC_STATUS</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01514">ArcClose</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01486">ArcGetComponent</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01490">ArcGetConfigurationData</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01542">ArcGetFileInformation</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01526">ArcOpen</a>, <a class="el" href="../../d1/d9/arc_8h.html#a317a238">ArcOpenReadOnly</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00286">_CONFIGURATION_COMPONENT::ConfigurationDataLength</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a2">E2BIG</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a8">EINVAL</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00547">_FILE_INFORMATION::EndingAddress</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>, <a class="el" href="../../d1/d9/arc_8h.html#a79">FILE_INFORMATION</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l00230">SectorSize</a>, and <a class="el" href="../../d2/d8/arc_8h-source.html#l00546">_FILE_INFORMATION::StartingAddress</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/fmtexp_8c-source.html#l00601">FmtFatFormat()</a>, <a class="el" href="../../d2/d5/fmtexp_8c-source.html#l00093">FmtIsFat()</a>, and <a class="el" href="../../d2/d5/low_8c-source.html#l00059">LowGetDriveGeometry()</a>.
<p>
<pre class="fragment"><div>00085                    :
00086 
00087     This routine computes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> drive geometry <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> given partition or
00088     physical disk.
00089 
00090 Arguments:
00091 
00092     PartitionPath   - Supplies a <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> partition or physical disk.
00093     NumberOfSectors - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of sectors.
00094     <a class="code" href="../../d3/d8/udfprocs_8h.html#a42">SectorSize</a>      - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sector size.
00095     SectorsPerTrack - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of sectors per track.
00096     Heads           - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of heads.
00097 
00098 Return Value:
00099 
00100     <a class="code" href="../../d1/d9/arc_8h.html#a32">ArcOpen</a>, <a class="code" href="../../d1/d9/arc_8h.html#a36">ArcGetFileInformation</a>, <a class="code" href="../../d1/d9/arc_8h.html#a29">ArcClose</a>, <a class="code" href="../../d2/d9/arccodes_8h.html#a24a2">E2BIG</a>, <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>
00101 
00102 --*/
00103 {
00104     <a class="code" href="../../d6/d1/struct__FILE__INFORMATION.html">FILE_INFORMATION</a>    file_info;
00105     <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>          r;
00106     ULONG               fileid;
00107     LARGE_INTEGER       l;
00108     CM_DISK_GEOMETRY_DEVICE_DATA    *DiskGeometry;
00109     <a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">CONFIGURATION_COMPONENT</a>         *DiskComponent;
00110     CM_PARTIAL_RESOURCE_LIST        *DiskConfiguration;
00111     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a>                            DataBuffer[<span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_LIST) +
00112                                                <span class="keyword">sizeof</span>(CM_DISK_GEOMETRY_DEVICE_DATA)];
00113     CM_PARTIAL_RESOURCE_DESCRIPTOR  *DiskData;
00114 
00115     <span class="comment">// Always assume 512 bytes per sector.</span>
00116 
00117     *<a class="code" href="../../d3/d8/udfprocs_8h.html#a42">SectorSize</a>      = 512;
00118 
00119     <span class="comment">// Assume the SCSI default values for number of heads and sectors per track</span>
00120 
00121     *SectorsPerTrack = 32;
00122     *Heads           = 64;
00123 
00124     <span class="comment">// See if there is device specific data describing the geometry of</span>
00125     <span class="comment">// the drive.  If there is none, then just use the default SCSI</span>
00126     <span class="comment">// values.</span>
00127 
00128     DiskComponent = <a class="code" href="../../d1/d9/arc_8h.html#a22">ArcGetComponent</a>(PartitionPath);
00129 
00130     <span class="keywordflow">if</span> (DiskComponent == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00131         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a8">EINVAL</a>;
00132     }
00133 
00134     <span class="comment">//</span>
00135     <span class="comment">// See if the ConfigurationDataLength is correct</span>
00136     <span class="comment">// It should contain one DeviceSpecific resource descriptor</span>
00137     <span class="comment">//</span>
00138 
00139     <span class="keywordflow">if</span> (DiskComponent-&gt;<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html#o7">ConfigurationDataLength</a> == <span class="keyword">sizeof</span>(CM_PARTIAL_RESOURCE_LIST) +
00140                                                   <span class="keyword">sizeof</span>(CM_DISK_GEOMETRY_DEVICE_DATA)  ) {
00141 
00142         DiskConfiguration = (CM_PARTIAL_RESOURCE_LIST *)DataBuffer;
00143 
00144         r = <a class="code" href="../../d1/d9/arc_8h.html#a23">ArcGetConfigurationData</a>(DiskConfiguration,DiskComponent);
00145 
00146         <span class="keywordflow">if</span> (r == <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00147 
00148             <span class="comment">//</span>
00149             <span class="comment">// See if the Configuration Data has ARC version 1.3 or greater</span>
00150             <span class="comment">//</span>
00151 
00152             <span class="keywordflow">if</span>  ( (DiskConfiguration-&gt;Version == 1 &amp;&amp; DiskConfiguration-&gt;Revision &gt;=3 ) ||
00153                   (DiskConfiguration-&gt;Version &gt;  1)                                        ) {
00154 
00155                 DiskData = &amp;(DiskConfiguration-&gt;PartialDescriptors[DiskConfiguration-&gt;Count-1]);
00156 
00157                 <span class="keywordflow">if</span> (DiskData-&gt;Type == CmResourceTypeDeviceSpecific) {
00158 
00159                     <span class="keywordflow">if</span> (DiskData-&gt;u.DeviceSpecificData.DataSize == <span class="keyword">sizeof</span>(CM_DISK_GEOMETRY_DEVICE_DATA)) {
00160                         DiskGeometry     = (CM_DISK_GEOMETRY_DEVICE_DATA *)
00161                                            &amp;(DiskConfiguration-&gt;PartialDescriptors[DiskConfiguration-&gt;Count]);
00162                         *SectorsPerTrack = DiskGeometry-&gt;SectorsPerTrack;
00163                         *Heads           = DiskGeometry-&gt;NumberOfHeads;
00164                         *<a class="code" href="../../d3/d8/udfprocs_8h.html#a42">SectorSize</a>      = DiskGeometry-&gt;BytesPerSector;
00165                     }
00166                 }
00167             }
00168         }
00169     }
00170 
00171 <span class="comment">//    PrintError("SectorSize = %08x",*SectorSize);</span>
00172 <span class="comment">//    PrintError("SectorsPerTrack = %08x",*SectorsPerTrack);</span>
00173 <span class="comment">//    PrintError("Heads = %08x",*Heads);</span>
00174 
00175     r = <a class="code" href="../../d1/d9/arc_8h.html#a32">ArcOpen</a>(PartitionPath, ArcOpenReadOnly, &amp;fileid);
00176 
00177     <span class="keywordflow">if</span> (r != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00178         <span class="keywordflow">return</span> r;
00179     }
00180 
00181     r = <a class="code" href="../../d1/d9/arc_8h.html#a36">ArcGetFileInformation</a>(fileid, &amp;file_info);
00182 
00183     <span class="keywordflow">if</span> (r != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00184         <span class="keywordflow">return</span> r;
00185     }
00186 
00187     r = <a class="code" href="../../d1/d9/arc_8h.html#a29">ArcClose</a>(fileid);
00188 
00189     <span class="keywordflow">if</span> (r != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00190         <span class="keywordflow">return</span> r;
00191     }
00192 
00193     l.QuadPart = file_info.<a class="code" href="../../d6/d1/struct__FILE__INFORMATION.html#o1">EndingAddress</a>.QuadPart -
00194                  file_info.<a class="code" href="../../d6/d1/struct__FILE__INFORMATION.html#o0">StartingAddress</a>.QuadPart;
00195 
00196     l.QuadPart = ((ULONGLONG)l.QuadPart) / ((ULONGLONG)(*SectorSize));
00197 
00198     <span class="keywordflow">if</span> (l.HighPart) {
00199         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a2">E2BIG</a>;
00200     }
00201 
00202     *TotalSectorCount = l.LowPart;
00203 
00204     <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>;
00205 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="low.c::LowOpenDisk" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowOpenDisk           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>DevicePath</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DiskId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00006">6</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d2/d8/arc_8h-source.html#l01526">ArcOpen</a>, <a class="el" href="../../d1/d9/arc_8h.html#a317a240">ArcOpenReadWrite</a>, and <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/fdengine_8c-source.html#l00302">CheckIfDiskIsOffLine()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00812">LowGetDiskLayout()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l01076">LowSetDiskLayout()</a>, and <a class="el" href="../../d9/d0/fdengine_8c-source.html#l02823">ZapSector()</a>.
<p>
<pre class="fragment"><div>00012                    :
00013 
00014     This routine opens <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> supplied device <span class="keywordflow">for</span> DASD access.
00015 
00016 Arguments:
00017 
00018     DevicePath  - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> device <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> to be opened.
00019     DiskId      - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> disk <span class="keywordtype">id</span>.
00020 
00021 Return Value:
00022 
00023     <a class="code" href="../../d1/d9/arc_8h.html#a32">ArcOpen</a>
00024 
00025 --*/
00026 {
00027    <span class="keywordtype">char</span> buffer[256];
00028 
00029    <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>(buffer,<span class="stringliteral">"%spartition(0)"</span>,DevicePath);
00030 
00031    <span class="keywordflow">return</span> <a class="code" href="../../d1/d9/arc_8h.html#a32">ArcOpen</a>(buffer, ArcOpenReadWrite, DiskId);
00032 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="low.c::LowQueryComponentList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowQueryComponentList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d9/arc_8h.html#a54">CONFIGURATION_CLASS</a> *ConfigClass&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> *ConfigType&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT <a class="el" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>ComponentList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ListLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00595">595</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d5/d8/arcinst_8h-source.html#l00330">AllocateMemory</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00040">ARC_STATUS</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00528">LowTraverseChildren()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l00651">LowQueryPathList()</a>.
<p>
<pre class="fragment"><div>00603                    :
00604 
00605     This routine returns an array of components whose <span class="keyword">class </span>and
00606     <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> match <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ones given.  (Since each parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> optional,
00607     you can do <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a>-<a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> and class-<a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> searches.)
00608 
00609     The array <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allocated on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> heap and contains pointers to
00610     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> actual components (NOT copies).
00611 
00612 Arguments:
00613 
00614     ConfigClass     - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> configuation class to search for.
00615     ConfigType      - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> configuration <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to search for.
00616     ComponentList   - Returns a list of pointers to components whose
00617                         class and <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> match 'ConfigClass' and
00618                         'ConfigType'.
00619     ListLength      - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of components in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list.
00620 
00621 Return Value:
00622 
00623     <a class="code" href="../../d1/d6/low_8c.html#a17">LowTraverseChildren</a>, <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>
00624 
00625 --*/
00626 {
00627     <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>  r;
00628 
00629     *ListLength = 0;
00630 
00631     r = <a class="code" href="../../d1/d6/low_8c.html#a17">LowTraverseChildren</a>(NULL, ConfigClass, ConfigType, NULL, ListLength);
00632 
00633     <span class="keywordflow">if</span> (r != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00634         <span class="keywordflow">return</span> r;
00635     }
00636 
00637     <span class="keywordflow">if</span> (!(*ComponentList = (<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a>*) <a class="code" href="../../d4/d9/arcinst_8h.html#a20">AllocateMemory</a>(
00638             (*ListLength)*<span class="keyword">sizeof</span>(<a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a>)))) {
00639 
00640         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>;
00641     }
00642 
00643     *ListLength = 0;
00644 
00645     <span class="keywordflow">return</span> <a class="code" href="../../d1/d6/low_8c.html#a17">LowTraverseChildren</a>(NULL, ConfigClass, ConfigType,
00646                                *ComponentList, ListLength);
00647 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="low.c::LowQueryFdiskPathList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowQueryFdiskPathList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PCHAR **&nbsp;</td>
          <td class="mdname" nowrap> <em>PathList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ListLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00756">756</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a>, <a class="el" href="../../d1/d9/arc_8h.html#a315a212">DiskPeripheral</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00651">LowQueryPathList()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/fdengine_8c-source.html#l00183">FdiskInitialize()</a>.
<p>
<pre class="fragment"><div>00762                    :
00763 
00764     This routine returns a list of paths to all <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> devices of interest
00765     to FDISK.
00766 
00767 Arguments:
00768 
00769     PathList    - Returns a list of paths.
00770     ListLength  - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list.
00771 
00772 Return Value:
00773 
00774     <a class="code" href="../../d4/d9/arcinst_8h.html#a129">LowQueryComponentList</a>, <a class="code" href="../../d4/d9/arcinst_8h.html#a128">LowQueryPathFromComponent</a>, <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>
00775 
00776 --*/
00777 {
00778     <a class="code" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a>  config_type;
00779 
00780     config_type = <a class="code" href="../../d1/d9/arc_8h.html#a315a212">DiskPeripheral</a>;
00781     <span class="keywordflow">return</span> <a class="code" href="../../d1/d6/low_8c.html#a19">LowQueryPathList</a>(NULL, &amp;config_type, PathList, ListLength);
00782 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="low.c::LowQueryPathFromComponent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowQueryPathFromComponent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Component</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCHAR *&nbsp;</td>
          <td class="mdname" nowrap> <em>Path</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00486">486</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d2/d5/low_8c-source.html#l00422">AlGetPathnameFromComponent()</a>, <a class="el" href="../../d5/d8/arcinst_8h-source.html#l00330">AllocateMemory</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>, <a class="el" href="../../d4/d2/dumpuser_8c-source.html#l00045">path</a>, and <a class="el" href="../../d2/d7/regtest_8c.html#a2">strlen()</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l00651">LowQueryPathList()</a>.
<p>
<pre class="fragment"><div>00492                    :
00493 
00494     This routine computes a <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> from a component.  The resulting
00495     <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> allocated on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> heap.
00496 
00497 Arguments:
00498 
00499     Component   - Supplies a component.
00500     Path        - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> corresponding to that component.
00501 
00502 Return Value:
00503 
00504     <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>, <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>
00505 
00506 --*/
00507 {
00508     PCHAR   p;
00509     PCHAR   <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a>;
00510 
00511     p = <a class="code" href="../../d1/d6/low_8c.html#a15">AlGetPathnameFromComponent</a>(Component);
00512 
00513     <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a> = <a class="code" href="../../d4/d9/arcinst_8h.html#a20">AllocateMemory</a>(<a class="code" href="../../d2/d7/regtest_8c.html#a2">strlen</a>(p) + 1);
00514 
00515     <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a>) {
00516         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>;
00517     }
00518 
00519     strcpy(path, p);
00520 
00521     *Path = <a class="code" href="../../d3/d3/dumpuser_8c.html#a14">path</a>;
00522 
00523     <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>;
00524 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="low.c::LowQueryPathList" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowQueryPathList           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d1/d9/arc_8h.html#a54">CONFIGURATION_CLASS</a> *ConfigClass&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> *ConfigType&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PCHAR **&nbsp;</td>
          <td class="mdname" nowrap> <em>PathList</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ListLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00651">651</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d5/d8/arcinst_8h-source.html#l00330">AllocateMemory</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00040">ARC_STATUS</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>, <a class="el" href="../../d5/d8/arcinst_8h-source.html#l00332">FreeMemory</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00721">LowFreePathList()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00595">LowQueryComponentList()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00486">LowQueryPathFromComponent()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/fmtexp_8c-source.html#l00724">FmtQueryFatPartitionList()</a>, and <a class="el" href="../../d2/d5/low_8c-source.html#l00756">LowQueryFdiskPathList()</a>.
<p>
<pre class="fragment"><div>00659                    :
00660 
00661     This routine returns a list of paths to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> components that are
00662     of <span class="keyword">class </span>ConfigClass and of <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> ConfigType.
00663 
00664 Arguments:
00665 
00666     ConfigClass     - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> configuation class to search for.
00667     ConfigType      - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> configuration <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to search for.
00668     PathList        - Returns a list of paths to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> components.
00669     ListLength      - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of components in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> list.
00670 
00671 Return Value:
00672 
00673     <a class="code" href="../../d4/d9/arcinst_8h.html#a129">LowQueryComponentList</a>, <a class="code" href="../../d4/d9/arcinst_8h.html#a128">LowQueryPathFromComponent</a>
00674 
00675 --*/
00676 {
00677     <a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a>*   component_list;
00678     ULONG                       list_length;
00679     <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>                  r;
00680     ULONG                       i;
00681     PCHAR*                      path_list;
00682 
00683     r = <a class="code" href="../../d1/d6/low_8c.html#a18">LowQueryComponentList</a>(ConfigClass, ConfigType,
00684                               &amp;component_list, &amp;list_length);
00685 
00686     <span class="keywordflow">if</span> (r != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00687         <span class="keywordflow">return</span> r;
00688     }
00689 
00690     <span class="keywordflow">if</span> (!(path_list = (PCHAR*) <a class="code" href="../../d4/d9/arcinst_8h.html#a20">AllocateMemory</a>(list_length*<span class="keyword">sizeof</span>(PCHAR)))) {
00691         <a class="code" href="../../d4/d9/arcinst_8h.html#a22">FreeMemory</a>(component_list);
00692         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>;
00693     }
00694 
00695 
00696     <span class="keywordflow">for</span> (i = 0; i &lt; list_length; i++) {
00697         path_list[i] = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00698     }
00699 
00700     <span class="keywordflow">for</span> (i = 0; i &lt; list_length; i++) {
00701 
00702         r = <a class="code" href="../../d1/d6/low_8c.html#a16">LowQueryPathFromComponent</a>(component_list[i], &amp;path_list[i]);
00703 
00704         <span class="keywordflow">if</span> (r != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00705             <a class="code" href="../../d4/d9/arcinst_8h.html#a22">FreeMemory</a>(component_list);
00706             <a class="code" href="../../d1/d6/low_8c.html#a20">LowFreePathList</a>(path_list, list_length);
00707             <span class="keywordflow">return</span> r;
00708         }
00709     }
00710 
00711     <a class="code" href="../../d4/d9/arcinst_8h.html#a22">FreeMemory</a>(component_list);
00712 
00713     *PathList = path_list;
00714     *ListLength = list_length;
00715 
00716     <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>;
00717 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="low.c::LowReadSectors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowReadSectors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>VolumeId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SectorSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>StartingSector</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfSectors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00212">212</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d2/d8/arc_8h-source.html#l00040">ARC_STATUS</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01530">ArcRead</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01534">ArcSeek</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00799">c</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a9">EIO</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00208">MAX_TRANSFER</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l00230">SectorSize</a>, and <a class="el" href="../../d1/d9/arc_8h.html#a318a248">SeekAbsolute</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/fmtexp_8c-source.html#l00042">FmtIsFatPartition()</a>, <a class="el" href="../../d2/d5/fmtexp_8c-source.html#l00495">FmtVerifySectors()</a>, and <a class="el" href="../../d2/d5/low_8c-source.html#l00812">LowGetDiskLayout()</a>.
<p>
<pre class="fragment"><div>00221                    :
00222 
00223     This routine reads 'NumberOfSectors' sectors starting at sector
00224     'StartingSector' on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> volume with <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> 'VolumeId'.
00225 
00226 Arguments:
00227 
00228     VolumeId        - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> volume.
00229     <a class="code" href="../../d3/d8/udfprocs_8h.html#a42">SectorSize</a>      - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes per sector.
00230     StartingSector  - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting sector <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> read.
00231     NumberOfSectors - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of sectors to read.
00232     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>          - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> read in sectors.
00233 
00234 Return Value:
00235 
00236     <a class="code" href="../../d1/d9/arc_8h.html#a34">ArcSeek</a>, <a class="code" href="../../d1/d9/arc_8h.html#a33">ArcRead</a>, <a class="code" href="../../d2/d9/arccodes_8h.html#a24a9">EIO</a>, <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>
00237 
00238 --*/
00239 {
00240     <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>    r;
00241     ULONG         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
00242     LARGE_INTEGER l;
00243     ULONG         i;
00244     ULONG         transfer;
00245     PCHAR         buf;
00246     ULONG         total;
00247 
00248 
00249     l.QuadPart = UInt32x32To64(StartingSector,SectorSize);
00250 
00251     buf = (PCHAR) <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00252 
00253     r = <a class="code" href="../../d1/d9/arc_8h.html#a34">ArcSeek</a>(VolumeId, &amp;l, SeekAbsolute);
00254 
00255     <span class="keywordflow">if</span> (r != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00256         <span class="keywordflow">return</span> r;
00257     }
00258 
00259     total = <a class="code" href="../../d3/d8/udfprocs_8h.html#a42">SectorSize</a>*NumberOfSectors;
00260 
00261     <span class="keywordflow">for</span> (i = 0; i &lt; total; i += <a class="code" href="../../d1/d6/low_8c.html#a0">MAX_TRANSFER</a>) {
00262 
00263         transfer = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(MAX_TRANSFER, total - i);
00264 
00265         r = <a class="code" href="../../d1/d9/arc_8h.html#a33">ArcRead</a>(VolumeId, &amp;buf[i], transfer, &amp;c);
00266 
00267         <span class="keywordflow">if</span> (r != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00268             <span class="keywordflow">return</span> r;
00269         }
00270 
00271         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> != transfer) {
00272             <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a9">EIO</a>;
00273         }
00274     }
00275 
00276     <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>;
00277 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="low.c::LowSetDiskLayout" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowSetDiskLayout           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Path</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PDRIVE_LAYOUT_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>DriveLayout</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l01076">1076</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d5/d5/memory_8c-source.html#l01113">AlAllocateHeap()</a>, <a class="el" href="../../d5/d5/memory_8c-source.html#l01134">AlDeallocateHeap()</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00040">ARC_STATUS</a>, <a class="el" href="../../d5/d8/arcinst_8h-source.html#l00411">ASRT</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l00157">BOOT_RECORD_SIGNATURE</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l00151">BOOT_SIGNATURE_OFFSET</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00980">CalculateCHSVals()</a>, <a class="el" href="../../d1/d1/config_2test_2init386_8c-source.html#l00027">dummy()</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>, <a class="el" href="../../d5/d8/arcinst_8h-source.html#l00346">ENTRIES_PER_BOOTSECTOR</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00036">LowCloseDisk()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00059">LowGetDriveGeometry()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00006">LowOpenDisk()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00281">LowWriteSectors()</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l00150">PARTITION_TABLE_OFFSET</a>, <a class="el" href="../../d3/d6/hal_8h-source.html#l00126">_PARTITION_DESCRIPTOR::PartitionType</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00085">PUSHORT</a>, <a class="el" href="../../d1/d6/low_8c.html#a4">SECCNT</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l01005">SetPartitionTableEntry()</a>, <a class="el" href="../../d4/d9/arcinst_8h.html#a176a71">SYSID_EXTENDED</a>, <a class="el" href="../../d4/d9/arcinst_8h.html#a176a70">SYSID_UNUSED</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l01063">ZeroPartitionTable()</a>, and <a class="el" href="../../d2/d5/low_8c-source.html#l01060">ZeroPartitionTableEntry</a>.
<p>
Referenced by <a class="el" href="../../d9/d0/fdengine_8c-source.html#l02886">WriteDriveLayout()</a>.
<p>
<pre class="fragment"><div>01080 {
01081     <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>             status;
01082     ULONG                   <a class="code" href="../../d0/d2/config_2test_2init386_8c.html#a0">dummy</a>,bps,spt,h;
01083     PCHAR                   SectorBuffer;
01084     ULONG                   <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a>;
01085     <a class="code" href="../../d5/d8/struct__PARTITION__DESCRIPTOR.html">PPARTITION_DESCRIPTOR</a>   PartitionTable;
01086     PPARTITION_INFORMATION  p;
01087     BOOLEAN                 mbr = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,Update;
01088     ULONG                   BootSector = 0,ExtendedPartitionStart = 0,
01089                             NextBootSector;
01090     ULONG                   i,j,UsedCount;
01091     <a class="code" href="../../d4/d8/struct__tagCHS.html">CHS</a>                     chs;
01092 
01093 
01094 <span class="preprocessor">#define SECCNT(l) ((ULONG)(((ULONGLONG)l.QuadPart)/((ULONGLONG)bps)))</span>
01095 <span class="preprocessor"></span>
01096 
01097     <a class="code" href="../../d4/d9/arcinst_8h.html#a28">ASRT</a>(DriveLayout-&gt;PartitionCount);
01098 
01099     <span class="keywordflow">if</span>((status = <a class="code" href="../../d1/d6/low_8c.html#a11">LowGetDriveGeometry</a>(Path,&amp;dummy,&amp;bps,&amp;spt,&amp;h)) != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
01100         <span class="keywordflow">return</span>(status);
01101     }
01102 
01103     <span class="comment">// allocate a buffer for sector I/O</span>
01104 
01105     <span class="keywordflow">if</span>((SectorBuffer = <a class="code" href="../../d4/d6/memory_8c.html#a22">AlAllocateHeap</a>(bps)) == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
01106         <span class="keywordflow">return</span>(<a class="code" href="../../d2/d9/arccodes_8h.html#a24a17">ENOMEM</a>);
01107     }
01108 
01109     <span class="comment">//</span>
01110     <span class="comment">// Use x86 bootcode as a template so the disk will boot an x86</span>
01111     <span class="comment">// if it is moved to disk0 on an x86 machine.</span>
01112     <span class="comment">//</span>
01113     RtlMoveMemory(SectorBuffer,x86BootCode,<a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(X86BOOTCODE_SIZE,bps));
01114 
01115     ((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)SectorBuffer)[<a class="code" href="../../d2/d7/hal_8h.html#a11">BOOT_SIGNATURE_OFFSET</a>] = <a class="code" href="../../d2/d7/hal_8h.html#a12">BOOT_RECORD_SIGNATURE</a>;
01116     PartitionTable = (<a class="code" href="../../d5/d8/struct__PARTITION__DESCRIPTOR.html">PPARTITION_DESCRIPTOR</a>)(&amp;(((<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a22">PUSHORT</a>)SectorBuffer)[<a class="code" href="../../d2/d7/hal_8h.html#a10">PARTITION_TABLE_OFFSET</a>]));
01117 
01118     <span class="keywordflow">if</span>((status = <a class="code" href="../../d1/d6/low_8c.html#a9">LowOpenDisk</a>(Path,&amp;Handle)) != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
01119         <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(SectorBuffer);
01120         <span class="keywordflow">return</span>(status);
01121     }
01122 
01123     <a class="code" href="../../d4/d9/arcinst_8h.html#a28">ASRT</a>(!(DriveLayout-&gt;PartitionCount % ENTRIES_PER_BOOTSECTOR));
01124     <span class="keywordflow">for</span>(i=0; i&lt;DriveLayout-&gt;PartitionCount; i+=<a class="code" href="../../d4/d9/arcinst_8h.html#a27">ENTRIES_PER_BOOTSECTOR</a>) {
01125 
01126         Update = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01127         UsedCount = 0;
01128 
01129         <a class="code" href="../../d1/d6/low_8c.html#a26">ZeroPartitionTable</a>(PartitionTable);
01130 
01131         <span class="keywordflow">for</span>(j=0; j&lt;<a class="code" href="../../d4/d9/arcinst_8h.html#a27">ENTRIES_PER_BOOTSECTOR</a>; j++) {
01132 
01133             p = &amp;DriveLayout-&gt;PartitionEntry[i+j];
01134 
01135             <span class="keywordflow">switch</span>(p-&gt;PartitionType) {
01136             <span class="keywordflow">case</span> <a class="code" href="../../d4/d9/arcinst_8h.html#a176a70">SYSID_UNUSED</a>:
01137                 <a class="code" href="../../d1/d6/low_8c.html#a3">ZeroPartitionTableEntry</a>(PartitionTable+j);
01138                 <span class="keywordflow">break</span>;
01139 
01140             <span class="keywordflow">case</span> <a class="code" href="../../d4/d9/arcinst_8h.html#a176a71">SYSID_EXTENDED</a>:
01141                 NextBootSector = <a class="code" href="../../d1/d6/low_8c.html#a4">SECCNT</a>(p-&gt;StartingOffset);
01142                 <a class="code" href="../../d1/d6/low_8c.html#a24">CalculateCHSVals</a>(NextBootSector,<a class="code" href="../../d1/d6/low_8c.html#a4">SECCNT</a>(p-&gt;PartitionLength),spt,h,&amp;chs);
01143                 <a class="code" href="../../d1/d6/low_8c.html#a25">SetPartitionTableEntry</a>(PartitionTable+j,
01144                                        p-&gt;BootIndicator,
01145                                        SYSID_EXTENDED,
01146                                        <a class="code" href="../../d1/d6/low_8c.html#a4">SECCNT</a>(p-&gt;StartingOffset) - ExtendedPartitionStart,
01147                                        <a class="code" href="../../d1/d6/low_8c.html#a4">SECCNT</a>(p-&gt;PartitionLength),
01148                                        &amp;chs
01149                                       );
01150                 <span class="keywordflow">if</span>(mbr) {
01151                     mbr = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
01152                     ExtendedPartitionStart = NextBootSector;
01153                 }
01154                 <span class="keywordflow">break</span>;
01155 
01156             <span class="keywordflow">default</span>:
01157                 <a class="code" href="../../d1/d6/low_8c.html#a24">CalculateCHSVals</a>(<a class="code" href="../../d1/d6/low_8c.html#a4">SECCNT</a>(p-&gt;StartingOffset),<a class="code" href="../../d1/d6/low_8c.html#a4">SECCNT</a>(p-&gt;PartitionLength),spt,h,&amp;chs);
01158                 <a class="code" href="../../d1/d6/low_8c.html#a25">SetPartitionTableEntry</a>(PartitionTable+j,
01159                                        p-&gt;BootIndicator,
01160                                        p-&gt;PartitionType,
01161                                        <a class="code" href="../../d1/d6/low_8c.html#a4">SECCNT</a>(p-&gt;StartingOffset) - BootSector,
01162                                        <a class="code" href="../../d1/d6/low_8c.html#a4">SECCNT</a>(p-&gt;PartitionLength),
01163                                        &amp;chs
01164                                       );
01165                 <span class="keywordflow">break</span>;
01166             }
01167             Update = Update || p-&gt;RewritePartition;
01168 
01169             <span class="keywordflow">if</span>(p-&gt;PartitionType != <a class="code" href="../../d4/d9/arcinst_8h.html#a176a70">SYSID_UNUSED</a>) {
01170                 UsedCount++;
01171             }
01172         }
01173         <span class="keywordflow">if</span>(Update || !UsedCount) {
01174             <span class="keywordflow">if</span>((status = <a class="code" href="../../d1/d6/low_8c.html#a14">LowWriteSectors</a>(Handle,bps,BootSector,1,SectorBuffer)) != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
01175                 <a class="code" href="../../d1/d6/low_8c.html#a10">LowCloseDisk</a>(Handle);
01176                 <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(SectorBuffer);
01177                 <span class="keywordflow">return</span>(status);
01178             }
01179         }
01180         BootSector = NextBootSector;
01181     }
01182 
01183     <a class="code" href="../../d1/d6/low_8c.html#a10">LowCloseDisk</a>(Handle);
01184     <a class="code" href="../../d4/d6/memory_8c.html#a23">AlDeallocateHeap</a>(SectorBuffer);
01185     <span class="keywordflow">return</span>(<a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>);
01186 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="low.c::LowTraverseChildren" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowTraverseChildren           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>Parent</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/arc_8h.html#a54">CONFIGURATION_CLASS</a> *ConfigClass&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d1/d9/arc_8h.html#a56">CONFIGURATION_TYPE</a> *ConfigType&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT <a class="el" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a> *MatchingArray&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CurrentLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00528">528</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d2/d8/arc_8h-source.html#l00040">ARC_STATUS</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01466">ArcGetChild</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01474">ArcGetPeer</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l00279">_CONFIGURATION_COMPONENT::Class</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00148">CurrentLength</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>, and <a class="el" href="../../d2/d8/arc_8h-source.html#l00280">_CONFIGURATION_COMPONENT::Type</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l00595">LowQueryComponentList()</a>.
<p>
<pre class="fragment"><div>00537                    :
00538 
00539     This routine traverses <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> trees whose parent <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> 'Parent'.
00540     If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Matching array <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> provided then <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> will be filled
00541     with pointers to all of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> components whose <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> and <span class="keyword">class</span>
00542 <span class="keyword">    </span>match 'ConfigType' and 'ConfigClass'.  Also, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> '<a class="code" href="../../d6/d0/ctaccess_8c.html#a47">CurrentLength</a>'
00543     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> incremented by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of nodes that match.
00544 
00545 Arguments:
00546 
00547     Parent          - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> root of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> tree.
00548     ConfigClass     - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> class to search for.
00549     ConfigType      - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to search for.
00550     <a class="code" href="../../d6/d0/ctaccess_8c.html#a47">CurrentLength</a>   - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current count.
00551 
00552 Return Value:
00553 
00554     <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>
00555 
00556 --*/
00557 {
00558     <a class="code" href="../../d4/d8/struct__CONFIGURATION__COMPONENT.html">PCONFIGURATION_COMPONENT</a>    pc;
00559     <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>                  r;
00560 
00561     <span class="keywordflow">if</span> (!(pc = <a class="code" href="../../d1/d9/arc_8h.html#a17">ArcGetChild</a>(Parent))) {
00562         <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>;
00563     }
00564 
00565     <span class="keywordflow">for</span> (;;) {
00566 
00567         <span class="keywordflow">if</span> ((!ConfigClass || pc-&gt;Class == *ConfigClass) &amp;&amp;
00568             (!ConfigType  || pc-&gt;Type  == *ConfigType)) {
00569 
00570             <span class="keywordflow">if</span> (MatchingArray) {
00571 
00572                 MatchingArray[*<a class="code" href="../../d6/d0/ctaccess_8c.html#a47">CurrentLength</a>] = pc;
00573             }
00574 
00575             (*CurrentLength)++;
00576         }
00577 
00578         r = <a class="code" href="../../d1/d6/low_8c.html#a17">LowTraverseChildren</a>(pc, ConfigClass, ConfigType,
00579                                 MatchingArray, CurrentLength);
00580 
00581         <span class="keywordflow">if</span> (r != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00582             <span class="keywordflow">return</span> r;
00583         }
00584 
00585         <span class="keywordflow">if</span> (!(pc = <a class="code" href="../../d1/d9/arc_8h.html#a19">ArcGetPeer</a>(pc))) {
00586             <span class="keywordflow">break</span>;
00587         }
00588     }
00589 
00590     <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>;
00591 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="low.c::LowWriteSectors" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a> LowWriteSectors           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>VolumeId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SectorSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>StartingSector</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NumberOfSectors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Buffer</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00281">281</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d2/d8/arc_8h-source.html#l00040">ARC_STATUS</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01534">ArcSeek</a>, <a class="el" href="../../d2/d8/arc_8h-source.html#l01538">ArcWrite</a>, <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d4/d9/user32_8def-source.html#l00799">c</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a9">EIO</a>, <a class="el" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l00208">MAX_TRANSFER</a>, <a class="el" href="../../d6/d3/acpitabl_8h-source.html#l00366">min</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l00230">SectorSize</a>, and <a class="el" href="../../d1/d9/arc_8h.html#a318a248">SeekAbsolute</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/fmtexp_8c-source.html#l00601">FmtFatFormat()</a>, <a class="el" href="../../d2/d5/low_8c-source.html#l01076">LowSetDiskLayout()</a>, and <a class="el" href="../../d9/d0/fdengine_8c-source.html#l02823">ZapSector()</a>.
<p>
<pre class="fragment"><div>00290                    :
00291 
00292     This routine write 'NumberOfSectors' sectors starting at sector
00293     'StartingSector' on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> volume with <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> 'VolumeId'.
00294 
00295 Arguments:
00296 
00297     VolumeId        - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a> <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> volume.
00298     <a class="code" href="../../d3/d8/udfprocs_8h.html#a42">SectorSize</a>      - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of bytes per sector.
00299     StartingSector  - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> starting sector <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> write.
00300     NumberOfSectors - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> number of sectors to write.
00301     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>          - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sectors to write.
00302 
00303 Return Value:
00304 
00305     <a class="code" href="../../d1/d9/arc_8h.html#a34">ArcSeek</a>, <a class="code" href="../../d1/d9/arc_8h.html#a35">ArcWrite</a>, <a class="code" href="../../d2/d9/arccodes_8h.html#a24a9">EIO</a>, <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>
00306 
00307 --*/
00308 {
00309     <a class="code" href="../../d1/d9/arc_8h.html#a44">ARC_STATUS</a>    r;
00310     ULONG         <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a>;
00311     LARGE_INTEGER l;
00312     ULONG         i;
00313     ULONG         transfer;
00314     PCHAR         buf;
00315     ULONG         total;
00316 
00317     l.QuadPart = UInt32x32To64(StartingSector,SectorSize);
00318 
00319     buf = (PCHAR) <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>;
00320 
00321     r = <a class="code" href="../../d1/d9/arc_8h.html#a34">ArcSeek</a>(VolumeId, &amp;l, SeekAbsolute);
00322 
00323     <span class="keywordflow">if</span> (r != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00324         <span class="keywordflow">return</span> r;
00325     }
00326 
00327     total = <a class="code" href="../../d3/d8/udfprocs_8h.html#a42">SectorSize</a>*NumberOfSectors;
00328 
00329     <span class="keywordflow">for</span> (i = 0; i &lt; total; i += <a class="code" href="../../d1/d6/low_8c.html#a0">MAX_TRANSFER</a>) {
00330 
00331         transfer = <a class="code" href="../../d5/d4/acpitabl_8h.html#a69">min</a>(MAX_TRANSFER, total - i);
00332 
00333         r = <a class="code" href="../../d1/d9/arc_8h.html#a35">ArcWrite</a>(VolumeId, &amp;buf[i], transfer, &amp;c);
00334 
00335         <span class="keywordflow">if</span> (r != <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>) {
00336             <span class="keywordflow">return</span> r;
00337         }
00338 
00339         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a35">c</a> != transfer) {
00340             <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a9">EIO</a>;
00341         }
00342     }
00343 
00344     <span class="keywordflow">return</span> <a class="code" href="../../d2/d9/arccodes_8h.html#a24a1">ESUCCESS</a>;
00345 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a25" doxytag="low.c::SetPartitionTableEntry" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetPartitionTableEntry           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT <a class="el" href="../../d5/d8/struct__PARTITION__DESCRIPTOR.html">PPARTITION_DESCRIPTOR</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>Active</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN UCHAR&nbsp;</td>
          <td class="mdname" nowrap> <em>SysID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>RelativeSector</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SectorCount</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d4/d8/struct__tagCHS.html">PCHS</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>chs</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l01005">1005</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d7/d7/fs__rec_8h.html#a39a20">Active</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l01076">LowSetDiskLayout()</a>.
<p>
<pre class="fragment"><div>01013 {
01014     <span class="comment">// first get the easy ones out of the way.</span>
01015 
01016     p-&gt;ActiveFlag    = <a class="code" href="../../d7/d7/fs__rec_8h.html#a39a20">Active</a>;
01017     p-&gt;PartitionType = SysID;
01018 
01019     <span class="keywordflow">if</span>(chs) {
01020         p-&gt;StartingTrack = chs-&gt;StartHead;
01021         p-&gt;EndingTrack   = chs-&gt;EndHead;
01022     } <span class="keywordflow">else</span> {
01023         p-&gt;StartingTrack = 0;
01024         p-&gt;EndingTrack   = 0;
01025     }
01026 
01027     <span class="keywordflow">if</span>(chs) {
01028 
01029         <span class="comment">// pack sector/cyl values</span>
01030 
01031         p-&gt;StartingCylinderLsb = (chs-&gt;StartSector &amp; 0x3f) | ((chs-&gt;StartCylinder &gt;&gt; 2) &amp; 0xc0);
01032         p-&gt;StartingCylinderMsb = (UCHAR)chs-&gt;StartCylinder;
01033 
01034         p-&gt;EndingCylinderLsb   = (chs-&gt;EndSector   &amp; 0x3f) | ((chs-&gt;EndCylinder   &gt;&gt; 2) &amp; 0xc0);
01035         p-&gt;EndingCylinderMsb   = (UCHAR)chs-&gt;EndCylinder;
01036 
01037     } <span class="keywordflow">else</span> {
01038 
01039         p-&gt;StartingCylinderLsb = 0;
01040         p-&gt;StartingCylinderMsb = 0;
01041 
01042         p-&gt;EndingCylinderLsb   = 0;
01043         p-&gt;EndingCylinderMsb   = 0;
01044     }
01045 
01046     <span class="comment">// now handle the relative and total sector counts</span>
01047 
01048     p-&gt;StartingSectorLsb0  = (UCHAR)(RelativeSector &gt;&gt; 0 );
01049     p-&gt;StartingSectorLsb1  = (UCHAR)(RelativeSector &gt;&gt; 8 );
01050     p-&gt;StartingSectorMsb0  = (UCHAR)(RelativeSector &gt;&gt; 16);
01051     p-&gt;StartingSectorMsb1  = (UCHAR)(RelativeSector &gt;&gt; 24);
01052 
01053     p-&gt;PartitionLengthLsb0 = (UCHAR)(SectorCount    &gt;&gt; 0 );
01054     p-&gt;PartitionLengthLsb1 = (UCHAR)(SectorCount    &gt;&gt; 8 );
01055     p-&gt;PartitionLengthMsb0 = (UCHAR)(SectorCount    &gt;&gt; 16);
01056     p-&gt;PartitionLengthMsb1 = (UCHAR)(SectorCount    &gt;&gt; 24);
01057 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="low.c::ZeroPartitionTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID ZeroPartitionTable           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d8/struct__PARTITION__DESCRIPTOR.html">PPARTITION_DESCRIPTOR</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>PartitionTable</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l01063">1063</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
References <a class="el" href="../../d5/d8/arcinst_8h-source.html#l00346">ENTRIES_PER_BOOTSECTOR</a>, and <a class="el" href="../../d2/d5/low_8c-source.html#l01060">ZeroPartitionTableEntry</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l01076">LowSetDiskLayout()</a>.
<p>
<pre class="fragment"><div>01066 {
01067     ULONG i;
01068 
01069     <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="../../d4/d9/arcinst_8h.html#a27">ENTRIES_PER_BOOTSECTOR</a>; i++) {
01070         <a class="code" href="../../d1/d6/low_8c.html#a3">ZeroPartitionTableEntry</a>(PartitionTable+i);
01071     }
01072 }
</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a5" doxytag="low.c::MnemonicTable" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> PCHAR <a class="el" href="../../d1/d6/low_8c.html#a5">MnemonicTable</a>[]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00373">373</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l00422">AlGetPathnameFromComponent()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="low.c::Pathname" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d2/d1/bench_8h.html#a8">CHAR</a> <a class="el" href="../../d1/d6/low_8c.html#a6">Pathname</a>[256]          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d5/low_8c-source.html#l00418">418</a> of file <a class="el" href="../../d2/d5/low_8c-source.html">low.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d5/low_8c-source.html#l00422">AlGetPathnameFromComponent()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:44:33 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
