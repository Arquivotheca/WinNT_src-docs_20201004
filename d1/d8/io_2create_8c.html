<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: io/create.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>create.c File Reference</h1><code>#include "<a class="el" href="../../d1/d5/iop_8h-source.html">iop.h</a>"</code><br>

<p>
<a href="../../d2/d7/io_2create_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d8/io_2create_8c.html#a0">NtCreateFile</a> (OUT PHANDLE FileHandle, IN ACCESS_MASK DesiredAccess, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>, OUT PIO_STATUS_BLOCK IoStatusBlock, IN PLARGE_INTEGER AllocationSize OPTIONAL, IN ULONG <a class="el" href="../../d2/d2/rtload_8c.html#a5">FileAttributes</a>, IN ULONG ShareAccess, IN ULONG CreateDisposition, IN ULONG CreateOptions, IN PVOID EaBuffer OPTIONAL, IN ULONG EaLength)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d8/io_2create_8c.html#a1">NtCreateNamedPipeFile</a> (OUT PHANDLE FileHandle, IN ULONG DesiredAccess, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>, OUT PIO_STATUS_BLOCK IoStatusBlock, IN ULONG ShareAccess, IN ULONG CreateDisposition, IN ULONG CreateOptions, IN ULONG NamedPipeType, IN ULONG ReadMode, IN ULONG CompletionMode, IN ULONG MaximumInstances, IN ULONG InboundQuota, IN ULONG OutboundQuota, IN PLARGE_INTEGER DefaultTimeout OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d8/io_2create_8c.html#a2">NtCreateMailslotFile</a> (OUT PHANDLE FileHandle, IN ULONG DesiredAccess, IN POBJECT_ATTRIBUTES <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a1">ObjectAttributes</a>, OUT PIO_STATUS_BLOCK IoStatusBlock, ULONG CreateOptions, IN ULONG MailslotQuota, IN ULONG MaximumMessageSize, IN PLARGE_INTEGER ReadTimeout)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a0" doxytag="io/create.c::NtCreateFile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtCreateFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>FileHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectAttributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PIO_STATUS_BLOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>IoStatusBlock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLARGE_INTEGER AllocationSize&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>FileAttributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ShareAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CreateDisposition</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CreateOptions</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID EaBuffer&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>EaLength</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d7/io_2create_8c-source.html#l00037">37</a> of file <a class="el" href="../../d2/d7/io_2create_8c-source.html">io/create.c</a>.
<p>
References <a class="el" href="../../d0/d5/io_8h.html#a600a406">CreateFileTypeNone</a>, <a class="el" href="../../d3/d1/rtload_8c-source.html#l00050">FileAttributes</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l04502">IoCreateFile()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d5/d5/netboot_8c-source.html#l04247">IopCacheNetbiosNameForIpAddress()</a>, <a class="el" href="../../d5/d5/netboot_8c-source.html#l04017">IopSetDefaultGateway()</a>, <a class="el" href="../../d5/d5/netboot_8c-source.html#l00770">IopStartNetworkForRemoteBoot()</a>, <a class="el" href="../../d5/d5/netboot_8c-source.html#l01834">IopStartTcpIpForRemoteBoot()</a>, <a class="el" href="../../d2/d2/ldrrsrc_8c-source.html#l01563">LdrLoadAlternateResourceModule()</a>, <a class="el" href="../../d1/d2/rtrest2_8c-source.html#l00049">main()</a>, <a class="el" href="../../d6/d5/memprint_8c-source.html#l00598">MemPrintWriteThread()</a>, and <a class="el" href="../../d7/d8/restrfil_8c-source.html#l00418">ZwCreateFile()</a>.
<p>
<pre class="fragment"><div>00053                    :
00054 
00055     This service opens or creates a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>, or opens a device.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to
00056     establish a <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> open device/<a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> that can then be used
00057     in subsequent operations to perform I/O operations on.  For purposes of
00058     readability, files and devices are treated as <span class="stringliteral">"files"</span> throughout <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00059     majority of <span class="keyword">this</span> module and <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system service portion of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I/O system.
00060     The <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> time a distinction <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> when <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> important to determine
00061     which <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> really being accessed.  Then a distinction <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> also <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00062     comments.
00063 
00064 Arguments:
00065 
00066     FileHandle - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to a variable to receive <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> open <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00067 
00068     DesiredAccess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> types of access that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller would like to
00069         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00070 
00071     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> attributes to be used <span class="keywordflow">for</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> object (name,
00072         SECURITY_DESCRIPTOR, etc.)
00073 
00074     IoStatusBlock - Specifies the address of the caller's I/O status block.
00075 
00076     AllocationSize - Initial size that should be allocated to the <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.  This
00077         parameter only has an affect <span class="keywordflow">if</span> the file is created.  Further, <span class="keywordflow">if</span>
00078         not specified, then it is taken to mean zero.
00079 
00080     FileAttributes - Specifies the attributes that should be set on the file,
00081         <span class="keywordflow">if</span> it is created.
00082 
00083     ShareAccess - Supplies the types of share access that the caller would like
00084         to the <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00085 
00086     CreateDisposition - Supplies the method <span class="keywordflow">for</span> handling the create/open.
00087 
00088     CreateOptions - Caller options <span class="keywordflow">for</span> how to perform the create/open.
00089 
00090     EaBuffer - Optionally specifies a set of EAs to be applied to the file <span class="keywordflow">if</span>
00091         it is created.
00092 
00093     EaLength - Supplies the length of the EaBuffer.
00094 
00095 Return Value:
00096 
00097     The function value is the <span class="keyword">final</span> status of the create/open operation.
00098 
00099 --*/
00100 
00101 {
00102     <span class="comment">//</span>
00103     <span class="comment">// Simply invoke the common I/O file creation routine to do the work.</span>
00104     <span class="comment">//</span>
00105 
00106     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00107 
00108     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/iosubs_8c.html#a46">IoCreateFile</a>( FileHandle,
00109                          DesiredAccess,
00110                          ObjectAttributes,
00111                          IoStatusBlock,
00112                          AllocationSize,
00113                          FileAttributes,
00114                          ShareAccess,
00115                          CreateDisposition,
00116                          CreateOptions,
00117                          EaBuffer,
00118                          EaLength,
00119                          CreateFileTypeNone,
00120                          (PVOID)NULL,
00121                          0 );
00122 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="io/create.c::NtCreateMailslotFile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtCreateMailslotFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>FileHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectAttributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PIO_STATUS_BLOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>IoStatusBlock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CreateOptions</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>MailslotQuota</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>MaximumMessageSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLARGE_INTEGER&nbsp;</td>
          <td class="mdname" nowrap> <em>ReadTimeout</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d7/io_2create_8c-source.html#l00285">285</a> of file <a class="el" href="../../d2/d7/io_2create_8c-source.html">io/create.c</a>.
<p>
References <a class="el" href="../../d0/d5/io_8h.html#a600a408">CreateFileTypeMailslot</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l04502">IoCreateFile()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d0/d5/io_8h.html#a278">MAILSLOT_CREATE_PARAMETERS</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l00401">_MAILSLOT_CREATE_PARAMETERS::MailslotQuota</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l00402">_MAILSLOT_CREATE_PARAMETERS::MaximumMessageSize</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l00403">_MAILSLOT_CREATE_PARAMETERS::ReadTimeout</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l00404">_MAILSLOT_CREATE_PARAMETERS::TimeoutSpecified</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>00298                    :
00299 
00300     Creates and opens <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> server end handle of a mailslot <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00301 
00302 Arguments:
00303 
00304     FileHandle - Supplies a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> on which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> service <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being
00305         performed.
00306 
00307     DesiredAccess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> types of access that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller would like to
00308         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00309 
00310     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> attributes to be used <span class="keywordflow">for</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> object
00311         (name, SECURITY_DESCRIPTOR, etc.)
00312 
00313     IoStatusBlock - Address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's I/O status block.
00314 
00315     CreateOptions - Caller options <span class="keywordflow">for</span> how to perform <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> create/open.
00316 
00317     MailslotQuota - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> reserved <span class="keywordflow">for</span> writes
00318         to <span class="keyword">this</span> mailslot.
00319 
00320     MaximumMessageSize - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> largest message that
00321         can be written to <span class="keyword">this</span> mailslot.
00322 
00323     ReadTimeout - The timeout period <span class="keywordflow">for</span> a read operation.  This must
00324         be specified as a relative time.
00325 
00326 Return Value:
00327 
00328     The function value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">final</span> status of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> create operation.
00329 
00330 --*/
00331 
00332 {
00333     <a class="code" href="../../d2/d6/struct__MAILSLOT__CREATE__PARAMETERS.html">MAILSLOT_CREATE_PARAMETERS</a> mailslotCreateParameters;
00334 
00335     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00336 
00337     <span class="comment">//</span>
00338     <span class="comment">// Check whether or not the DefaultTimeout parameter was specified.  If</span>
00339     <span class="comment">// so, then capture it in the mailslot create parameter structure.</span>
00340     <span class="comment">//</span>
00341 
00342     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( ReadTimeout )) {
00343 
00344         <span class="comment">//</span>
00345         <span class="comment">// Indicate that a read timeout period was specified.</span>
00346         <span class="comment">//</span>
00347 
00348         mailslotCreateParameters.<a class="code" href="../../d2/d6/struct__MAILSLOT__CREATE__PARAMETERS.html#o3">TimeoutSpecified</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00349 
00350         <span class="comment">//</span>
00351         <span class="comment">// A read timeout parameter was specified.  Check to see whether</span>
00352         <span class="comment">// the caller's mode is kernel and if not capture the parameter inside</span>
00353         <span class="comment">// of a try...except clause.</span>
00354         <span class="comment">//</span>
00355 
00356         <span class="keywordflow">if</span> (KeGetPreviousMode() != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00357             <span class="keywordflow">try</span> {
00358                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( ReadTimeout,
00359                               <span class="keyword">sizeof</span>( LARGE_INTEGER ),
00360                               <span class="keyword">sizeof</span>( ULONG ) );
00361                 mailslotCreateParameters.<a class="code" href="../../d2/d6/struct__MAILSLOT__CREATE__PARAMETERS.html#o2">ReadTimeout</a> = *ReadTimeout;
00362             } except(EXCEPTION_EXECUTE_HANDLER) {
00363 
00364                 <span class="comment">//</span>
00365                 <span class="comment">// Something went awry attempting to access the parameter.</span>
00366                 <span class="comment">// Get the reason for the error and return it as the status</span>
00367                 <span class="comment">// value from this service.</span>
00368                 <span class="comment">//</span>
00369 
00370                 <span class="keywordflow">return</span> GetExceptionCode();
00371             }
00372         } <span class="keywordflow">else</span> {
00373 
00374             <span class="comment">//</span>
00375             <span class="comment">// The caller's mode was kernel so simply store the parameter.</span>
00376             <span class="comment">//</span>
00377 
00378             mailslotCreateParameters.<a class="code" href="../../d2/d6/struct__MAILSLOT__CREATE__PARAMETERS.html#o2">ReadTimeout</a> = *ReadTimeout;
00379         }
00380     } <span class="keywordflow">else</span> {
00381 
00382         <span class="comment">//</span>
00383         <span class="comment">// Indicate that no default timeout period was specified.</span>
00384         <span class="comment">//</span>
00385 
00386         mailslotCreateParameters.<a class="code" href="../../d2/d6/struct__MAILSLOT__CREATE__PARAMETERS.html#o3">TimeoutSpecified</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00387     }
00388 
00389     <span class="comment">//</span>
00390     <span class="comment">// Store the mailslot-specific parameters in the structure for use</span>
00391     <span class="comment">// in the call to the common create file routine.</span>
00392     <span class="comment">//</span>
00393 
00394     mailslotCreateParameters.<a class="code" href="../../d2/d6/struct__MAILSLOT__CREATE__PARAMETERS.html#o0">MailslotQuota</a> = MailslotQuota;
00395     mailslotCreateParameters.<a class="code" href="../../d2/d6/struct__MAILSLOT__CREATE__PARAMETERS.html#o1">MaximumMessageSize</a> = MaximumMessageSize;
00396 
00397     <span class="comment">//</span>
00398     <span class="comment">// Simply perform the remainder of the service by allowing the common</span>
00399     <span class="comment">// file creation code to do the work.</span>
00400     <span class="comment">//</span>
00401 
00402     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/iosubs_8c.html#a46">IoCreateFile</a>( FileHandle,
00403                          DesiredAccess,
00404                          ObjectAttributes,
00405                          IoStatusBlock,
00406                          (PLARGE_INTEGER) NULL,
00407                          0L,
00408                          FILE_SHARE_READ | FILE_SHARE_WRITE,
00409                          FILE_CREATE,
00410                          CreateOptions,
00411                          (PVOID) NULL,
00412                          0L,
00413                          CreateFileTypeMailslot,
00414                          &amp;mailslotCreateParameters,
00415                          0 );
00416 }
}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="io/create.c::NtCreateNamedPipeFile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS NtCreateNamedPipeFile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT PHANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>FileHandle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POBJECT_ATTRIBUTES&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectAttributes</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PIO_STATUS_BLOCK&nbsp;</td>
          <td class="mdname" nowrap> <em>IoStatusBlock</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ShareAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CreateDisposition</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CreateOptions</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>NamedPipeType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ReadMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>CompletionMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>MaximumInstances</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>InboundQuota</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>OutboundQuota</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLARGE_INTEGER DefaultTimeout&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d7/io_2create_8c-source.html#l00125">125</a> of file <a class="el" href="../../d2/d7/io_2create_8c-source.html">io/create.c</a>.
<p>
References <a class="el" href="../../d1/d4/io_8h-source.html#l00385">_NAMED_PIPE_CREATE_PARAMETERS::CompletionMode</a>, <a class="el" href="../../d0/d5/io_8h.html#a600a407">CreateFileTypeNamedPipe</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l00389">_NAMED_PIPE_CREATE_PARAMETERS::DefaultTimeout</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00055">EXCEPTION_EXECUTE_HANDLER</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l00387">_NAMED_PIPE_CREATE_PARAMETERS::InboundQuota</a>, <a class="el" href="../../d5/d5/iosubs_8c-source.html#l04502">IoCreateFile()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00624">KernelMode</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l00386">_NAMED_PIPE_CREATE_PARAMETERS::MaximumInstances</a>, <a class="el" href="../../d0/d5/io_8h.html#a276">NAMED_PIPE_CREATE_PARAMETERS</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l00383">_NAMED_PIPE_CREATE_PARAMETERS::NamedPipeType</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l00388">_NAMED_PIPE_CREATE_PARAMETERS::OutboundQuota</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l01209">ProbeForRead</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l00384">_NAMED_PIPE_CREATE_PARAMETERS::ReadMode</a>, <a class="el" href="../../d1/d4/io_8h-source.html#l00390">_NAMED_PIPE_CREATE_PARAMETERS::TimeoutSpecified</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l01377">SepServerCreatePipe()</a>.
<p>
<pre class="fragment"><div>00144                    :
00145 
00146     Creates and opens <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> server end handle of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> first instance of a
00147     specific named pipe or another instance of an existing named pipe.
00148 
00149 Arguments:
00150 
00151     FileHandle - Supplies a handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> on which <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> service <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being
00152         performed.
00153 
00154     DesiredAccess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> types of access that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller would like to
00155         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00156 
00157     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a> - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> attributes to be used <span class="keywordflow">for</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> object
00158         (name, SECURITY_DESCRIPTOR, etc.)
00159 
00160     IoStatusBlock - Address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's I/O status block.
00161 
00162     ShareAccess - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> types of share access that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller would
00163         like to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.
00164 
00165     CreateDisposition - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> method <span class="keywordflow">for</span> handling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> create/open.
00166 
00167     CreateOptions - Caller options <span class="keywordflow">for</span> how to perform <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> create/open.
00168 
00169     NamedPipeType - Type of named pipe to create (Bitstream or message).
00170 
00171     ReadMode - Mode in which to read <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> pipe (Bitstream or message).
00172 
00173     CompletionMode - Specifies how <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be completed.
00174 
00175     MaximumInstances - Maximum number of simultaneous instances of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> named
00176         pipe.
00177 
00178     InboundQuota - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> reserved <span class="keywordflow">for</span> writes to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00179         inbound side of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> named pipe.
00180 
00181     OutboundQuota - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> quota that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> reserved <span class="keywordflow">for</span> writes to
00182         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> inbound side of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> named pipe.
00183 
00184     DefaultTimeout - Optional pointer to a timeout value that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used <span class="keywordflow">if</span> a
00185         timeout value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not specified when waiting <span class="keywordflow">for</span> an instance of a named
00186         pipe.
00187 
00188 Return Value:
00189 
00190     The function value <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">final</span> status of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> create/open operation.
00191 
00192 --*/
00193 
00194 {
00195     <a class="code" href="../../d3/d1/struct__NAMED__PIPE__CREATE__PARAMETERS.html">NAMED_PIPE_CREATE_PARAMETERS</a> namedPipeCreateParameters;
00196 
00197     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00198 
00199     <span class="comment">//</span>
00200     <span class="comment">// Check whether or not the DefaultTimeout parameter was specified.  If</span>
00201     <span class="comment">// so, then capture it in the named pipe create parameter structure.</span>
00202     <span class="comment">//</span>
00203 
00204     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( DefaultTimeout )) {
00205 
00206         <span class="comment">//</span>
00207         <span class="comment">// Indicate that a default timeout period was specified.</span>
00208         <span class="comment">//</span>
00209 
00210         namedPipeCreateParameters.<a class="code" href="../../d3/d1/struct__NAMED__PIPE__CREATE__PARAMETERS.html#o7">TimeoutSpecified</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00211 
00212         <span class="comment">//</span>
00213         <span class="comment">// A default timeout parameter was specified.  Check to see whether</span>
00214         <span class="comment">// the caller's mode is kernel and if not capture the parameter inside</span>
00215         <span class="comment">// of a try...except clause.</span>
00216         <span class="comment">//</span>
00217 
00218         <span class="keywordflow">if</span> (KeGetPreviousMode() != <a class="code" href="../../d6/d7/halmips_8h.html#a456">KernelMode</a>) {
00219             <span class="keywordflow">try</span> {
00220                 <a class="code" href="../../d5/d8/ex_8h.html#a11">ProbeForRead</a>( DefaultTimeout,
00221                               <span class="keyword">sizeof</span>( LARGE_INTEGER ),
00222                               <span class="keyword">sizeof</span>( ULONG ) );
00223                 namedPipeCreateParameters.<a class="code" href="../../d3/d1/struct__NAMED__PIPE__CREATE__PARAMETERS.html#o6">DefaultTimeout</a> = *DefaultTimeout;
00224             } except(EXCEPTION_EXECUTE_HANDLER) {
00225 
00226                 <span class="comment">//</span>
00227                 <span class="comment">// Something went awry attempting to access the parameter.</span>
00228                 <span class="comment">// Get the reason for the error and return it as the status</span>
00229                 <span class="comment">// value from this service.</span>
00230                 <span class="comment">//</span>
00231 
00232                 <span class="keywordflow">return</span> GetExceptionCode();
00233             }
00234         } <span class="keywordflow">else</span> {
00235 
00236             <span class="comment">//</span>
00237             <span class="comment">// The caller's mode was kernel so simply store the parameter.</span>
00238             <span class="comment">//</span>
00239 
00240             namedPipeCreateParameters.<a class="code" href="../../d3/d1/struct__NAMED__PIPE__CREATE__PARAMETERS.html#o6">DefaultTimeout</a> = *DefaultTimeout;
00241         }
00242     } <span class="keywordflow">else</span> {
00243 
00244         <span class="comment">//</span>
00245         <span class="comment">// Indicate that no default timeout period was specified.</span>
00246         <span class="comment">//</span>
00247 
00248         namedPipeCreateParameters.<a class="code" href="../../d3/d1/struct__NAMED__PIPE__CREATE__PARAMETERS.html#o7">TimeoutSpecified</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00249     }
00250 
00251     <span class="comment">//</span>
00252     <span class="comment">// Store the remainder of the named pipe-specific parameters in the</span>
00253     <span class="comment">// structure for use in the call to the common create file routine.</span>
00254     <span class="comment">//</span>
00255 
00256     namedPipeCreateParameters.<a class="code" href="../../d3/d1/struct__NAMED__PIPE__CREATE__PARAMETERS.html#o0">NamedPipeType</a> = NamedPipeType;
00257     namedPipeCreateParameters.<a class="code" href="../../d3/d1/struct__NAMED__PIPE__CREATE__PARAMETERS.html#o1">ReadMode</a> = ReadMode;
00258     namedPipeCreateParameters.<a class="code" href="../../d3/d1/struct__NAMED__PIPE__CREATE__PARAMETERS.html#o2">CompletionMode</a> = CompletionMode;
00259     namedPipeCreateParameters.<a class="code" href="../../d3/d1/struct__NAMED__PIPE__CREATE__PARAMETERS.html#o3">MaximumInstances</a> = MaximumInstances;
00260     namedPipeCreateParameters.<a class="code" href="../../d3/d1/struct__NAMED__PIPE__CREATE__PARAMETERS.html#o4">InboundQuota</a> = InboundQuota;
00261     namedPipeCreateParameters.<a class="code" href="../../d3/d1/struct__NAMED__PIPE__CREATE__PARAMETERS.html#o5">OutboundQuota</a> = OutboundQuota;
00262 
00263     <span class="comment">//</span>
00264     <span class="comment">// Simply perform the remainder of the service by allowing the common</span>
00265     <span class="comment">// file creation code to do the work.</span>
00266     <span class="comment">//</span>
00267 
00268     <span class="keywordflow">return</span> <a class="code" href="../../d4/d6/iosubs_8c.html#a46">IoCreateFile</a>( FileHandle,
00269                          DesiredAccess,
00270                          ObjectAttributes,
00271                          IoStatusBlock,
00272                          (PLARGE_INTEGER) NULL,
00273                          0L,
00274                          ShareAccess,
00275                          CreateDisposition,
00276                          CreateOptions,
00277                          (PVOID) NULL,
00278                          0L,
00279                          CreateFileTypeNamedPipe,
00280                          &amp;namedPipeCreateParameters,
00281                          0 );
00282 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:18 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
