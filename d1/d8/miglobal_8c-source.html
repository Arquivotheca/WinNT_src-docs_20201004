<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: miglobal.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>miglobal.c</h1><a href="../../d0/d9/miglobal_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1989  Microsoft Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">   miglobal.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module contains the private global storage for the memory</span>
00012 <span class="comment">    management subsystem.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    Lou Perazzoli (loup) 6-Apr-1989</span>
00017 <span class="comment"></span>
00018 <span class="comment">Revision History:</span>
00019 <span class="comment"></span>
00020 <span class="comment">--*/</span>
00021 <span class="preprocessor">#include "<a class="code" href="../../d4/d8/mi_8h.html">mi.h</a>"</span>
00022 
00023 <span class="comment">//</span>
00024 <span class="comment">// Highest user address;</span>
00025 <span class="comment">//</span>
00026 
<a name="l00027"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a0">00027</a> PVOID <a class="code" href="../../d0/d9/miglobal_8c.html#a0">MmHighestUserAddress</a>;
00028 
00029 <span class="comment">//</span>
00030 <span class="comment">// Start of system address range.</span>
00031 <span class="comment">//</span>
00032 
<a name="l00033"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a1">00033</a> PVOID <a class="code" href="../../d0/d9/miglobal_8c.html#a1">MmSystemRangeStart</a>;
00034 
00035 <span class="comment">//</span>
00036 <span class="comment">// User probe address;</span>
00037 <span class="comment">//</span>
00038 
<a name="l00039"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a2">00039</a> ULONG_PTR <a class="code" href="../../d0/d9/miglobal_8c.html#a2">MmUserProbeAddress</a>;
00040 
00041 <span class="comment">//</span>
00042 <span class="comment">// Virtual bias applied during the loading of the kernel image.</span>
00043 <span class="comment">//</span>
00044 
<a name="l00045"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a3">00045</a> ULONG_PTR <a class="code" href="../../d2/d1/mm_8h.html#a126">MmVirtualBias</a>;
00046 
00047 <span class="comment">//</span>
00048 <span class="comment">// Number of secondary colors, based on level 2 d cache size.</span>
00049 <span class="comment">//</span>
00050 
<a name="l00051"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a4">00051</a> ULONG <a class="code" href="../../d8/d0/cmdat3_8c.html#a25">MmSecondaryColors</a>;
00052 
00053 <span class="comment">//</span>
00054 <span class="comment">// The starting color index seed, incremented at each process creation.</span>
00055 <span class="comment">//</span>
00056 
<a name="l00057"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a5">00057</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a695">MmProcessColorSeed</a> = 0x12345678;
00058 
00059 <span class="comment">//</span>
00060 <span class="comment">// Total number of physical pages available on the system.</span>
00061 <span class="comment">//</span>
00062 
<a name="l00063"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a6">00063</a> PFN_COUNT <a class="code" href="../../d2/d1/mm_8h.html#a136">MmNumberOfPhysicalPages</a>;
00064 
00065 <span class="comment">//</span>
00066 <span class="comment">// Lowest physical page number in the system.</span>
00067 <span class="comment">//</span>
00068 
<a name="l00069"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a7">00069</a> PFN_NUMBER <a class="code" href="../../d6/d8/sysinfo_8c.html#a6">MmLowestPhysicalPage</a> = (PFN_NUMBER)-1;
00070 
00071 <span class="comment">//</span>
00072 <span class="comment">// Highest physical page number in the system.</span>
00073 <span class="comment">//</span>
00074 
<a name="l00075"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a8">00075</a> PFN_NUMBER <a class="code" href="../../d6/d8/sysinfo_8c.html#a7">MmHighestPhysicalPage</a>;
00076 
00077 <span class="comment">//</span>
00078 <span class="comment">// Highest possible physical page number in the system.</span>
00079 <span class="comment">//</span>
00080 
<a name="l00081"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a9">00081</a> PFN_NUMBER <a class="code" href="../../d2/d3/dumpctl_8c.html#a16">MmHighestPossiblePhysicalPage</a>;
00082 
00083 <span class="comment">//</span>
00084 <span class="comment">// Total number of available pages in the system.  This</span>
00085 <span class="comment">// is the sum of the pages on the zeroed, free and standby lists.</span>
00086 <span class="comment">//</span>
00087 
<a name="l00088"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a10">00088</a> PFN_COUNT  <a class="code" href="../../d5/d5/cc_8h.html#a94">MmAvailablePages</a>;
<a name="l00089"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a11">00089</a> PFN_NUMBER <a class="code" href="../../d2/d1/mm_8h.html#a151">MmThrottleTop</a>;
<a name="l00090"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a12">00090</a> PFN_NUMBER <a class="code" href="../../d2/d1/mm_8h.html#a152">MmThrottleBottom</a>;
00091 
00092 <span class="comment">//</span>
00093 <span class="comment">// System wide memory management statistics block.</span>
00094 <span class="comment">//</span>
00095 
<a name="l00096"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a13">00096</a> <a class="code" href="../../d3/d2/struct__MMINFO__COUNTERS.html">MMINFO_COUNTERS</a> <a class="code" href="../../d2/d1/mm_8h.html#a145">MmInfoCounters</a>;
00097 
00098 <span class="comment">//</span>
00099 <span class="comment">// Total number of physical pages which would be usable if every process</span>
00100 <span class="comment">// was at its minimum working set size.  This value is initialized</span>
00101 <span class="comment">// at system initialization to MmAvailablePages - MM_FLUID_PHYSICAL_PAGES.</span>
00102 <span class="comment">// Every time a thread is created, the kernel stack is subtracted from</span>
00103 <span class="comment">// this and every time a process is created, the minimum working set</span>
00104 <span class="comment">// is subtracted from this.  If the value would become negative, the</span>
00105 <span class="comment">// operation (create process/kernel stack/ adjust working set) fails.</span>
00106 <span class="comment">// The PFN LOCK must be owned to manipulate this value.</span>
00107 <span class="comment">//</span>
00108 
<a name="l00109"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a14">00109</a> SPFN_NUMBER <a class="code" href="../../d8/d5/kddata_8c.html#a42">MmResidentAvailablePages</a>;
00110 
00111 <span class="comment">//</span>
00112 <span class="comment">// The total number of pages which would be removed from working sets</span>
00113 <span class="comment">// if every working set was at its minimum.</span>
00114 <span class="comment">//</span>
00115 
<a name="l00116"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a15">00116</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a590">MmPagesAboveWsMinimum</a>;
00117 
00118 <span class="comment">//</span>
00119 <span class="comment">// The total number of pages which would be removed from working sets</span>
00120 <span class="comment">// if every working set above its maximum was at its maximum.</span>
00121 <span class="comment">//</span>
00122 
<a name="l00123"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a16">00123</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a591">MmPagesAboveWsMaximum</a>;
00124 
00125 <span class="comment">//</span>
00126 <span class="comment">// The number of pages to add to a working set if there are ample</span>
00127 <span class="comment">// available pages and the working set is below its maximum.</span>
00128 <span class="comment">//</span>
00129 
00130 <span class="comment">//</span>
00131 <span class="comment">// If memory is becoming short and MmPagesAboveWsMinimum is</span>
00132 <span class="comment">// greater than MmPagesAboveWsThreshold, trim working sets.</span>
00133 <span class="comment">//</span>
00134 
<a name="l00135"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a17">00135</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a592">MmPagesAboveWsThreshold</a> = 37;
00136 
<a name="l00137"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a18">00137</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a593">MmWorkingSetSizeIncrement</a> = 6;
00138 
00139 <span class="comment">//</span>
00140 <span class="comment">// The number of pages to extend the maximum working set size by</span>
00141 <span class="comment">// if the working set at its maximum and there are ample available pages.</span>
00142 
<a name="l00143"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a19">00143</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a594">MmWorkingSetSizeExpansion</a> = 20;
00144 
00145 <span class="comment">//</span>
00146 <span class="comment">// The number of pages required to be freed by working set reduction</span>
00147 <span class="comment">// before working set reduction is attempted.</span>
00148 <span class="comment">//</span>
00149 
<a name="l00150"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a20">00150</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a595">MmWsAdjustThreshold</a> = 45;
00151 
00152 <span class="comment">//</span>
00153 <span class="comment">// The number of pages available to allow the working set to be</span>
00154 <span class="comment">// expanded above its maximum.</span>
00155 <span class="comment">//</span>
00156 
<a name="l00157"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a21">00157</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a596">MmWsExpandThreshold</a> = 90;
00158 
00159 <span class="comment">//</span>
00160 <span class="comment">// The total number of pages to reduce by working set trimming.</span>
00161 <span class="comment">//</span>
00162 
<a name="l00163"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a22">00163</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a597">MmWsTrimReductionGoal</a> = 29;
00164 
00165 <span class="comment">//</span>
00166 <span class="comment">// The total number of pages needed for the loader to successfully hibernate.</span>
00167 <span class="comment">//</span>
00168 
<a name="l00169"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a23">00169</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a427">MmHiberPages</a> = 512;
00170 
00171 <span class="comment">//</span>
00172 <span class="comment">// Registry-settable threshold for using large pages.  x86 only.</span>
00173 <span class="comment">//</span>
00174 
<a name="l00175"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a24">00175</a> ULONG <a class="code" href="../../d8/d0/cmdat3_8c.html#a31">MmLargePageMinimum</a>;
00176 
<a name="l00177"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a25">00177</a> <a class="code" href="../../d4/d3/struct__MMPFN.html">PMMPFN</a> <a class="code" href="../../d2/d3/dumpctl_8c.html#a15">MmPfnDatabase</a>;
00178 
<a name="l00179"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a26">00179</a> <a class="code" href="../../d0/d4/struct__MMPFNLIST.html">MMPFNLIST</a> <a class="code" href="../../d8/d5/kddata_8c.html#a36">MmZeroedPageListHead</a> = {
00180                     0, <span class="comment">// Total</span>
00181                     <a class="code" href="../../d2/d1/mm_8h.html#a345a171">ZeroedPageList</a>, <span class="comment">// ListName</span>
00182                     <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>, <span class="comment">//Flink</span>
00183                     <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>  <span class="comment">// Blink</span>
00184                     };
00185 
<a name="l00186"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a27">00186</a> <a class="code" href="../../d0/d4/struct__MMPFNLIST.html">MMPFNLIST</a> <a class="code" href="../../d8/d5/kddata_8c.html#a37">MmFreePageListHead</a> = {
00187                     0, <span class="comment">// Total</span>
00188                     <a class="code" href="../../d2/d1/mm_8h.html#a345a172">FreePageList</a>, <span class="comment">// ListName</span>
00189                     <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>, <span class="comment">//Flink</span>
00190                     <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>  <span class="comment">// Blink</span>
00191                     };
00192 
<a name="l00193"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a28">00193</a> <a class="code" href="../../d0/d4/struct__MMPFNLIST.html">MMPFNLIST</a> <a class="code" href="../../d8/d5/kddata_8c.html#a38">MmStandbyPageListHead</a> = {
00194                     0, <span class="comment">// Total</span>
00195                     <a class="code" href="../../d2/d1/mm_8h.html#a345a173">StandbyPageList</a>, <span class="comment">// ListName</span>
00196                     <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>, <span class="comment">//Flink</span>
00197                     <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>  <span class="comment">// Blink</span>
00198                     };
00199 
<a name="l00200"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a29">00200</a> <a class="code" href="../../d0/d4/struct__MMPFNLIST.html">MMPFNLIST</a> <a class="code" href="../../d2/d1/mm_8h.html#a150">MmModifiedPageListHead</a> = {
00201                     0, <span class="comment">// Total</span>
00202                     <a class="code" href="../../d2/d1/mm_8h.html#a345a174">ModifiedPageList</a>, <span class="comment">// ListName</span>
00203                     <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>, <span class="comment">//Flink</span>
00204                     <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>  <span class="comment">// Blink</span>
00205                     };
00206 
<a name="l00207"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a30">00207</a> <a class="code" href="../../d0/d4/struct__MMPFNLIST.html">MMPFNLIST</a> <a class="code" href="../../d8/d5/kddata_8c.html#a40">MmModifiedNoWritePageListHead</a> = {
00208                     0, <span class="comment">// Total</span>
00209                     <a class="code" href="../../d2/d1/mm_8h.html#a345a175">ModifiedNoWritePageList</a>, <span class="comment">// ListName</span>
00210                     <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>, <span class="comment">//Flink</span>
00211                     <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>  <span class="comment">// Blink</span>
00212                     };
00213 
<a name="l00214"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a31">00214</a> <a class="code" href="../../d0/d4/struct__MMPFNLIST.html">MMPFNLIST</a> <a class="code" href="../../d4/d8/mi_8h.html#a605">MmBadPageListHead</a> = {
00215                     0, <span class="comment">// Total</span>
00216                     <a class="code" href="../../d2/d1/mm_8h.html#a345a176">BadPageList</a>, <span class="comment">// ListName</span>
00217                     <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>, <span class="comment">//Flink</span>
00218                     <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a0">MM_EMPTY_LIST</a>  <span class="comment">// Blink</span>
00219                     };
00220 
<a name="l00221"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a32">00221</a> <a class="code" href="../../d0/d4/struct__MMPFNLIST.html">PMMPFNLIST</a> <a class="code" href="../../d4/d8/mi_8h.html#a606">MmPageLocationList</a>[<a class="code" href="../../d2/d1/mm_8h.html#a22">NUMBER_OF_PAGE_LISTS</a>] = {
00222                                       &amp;<a class="code" href="../../d8/d5/kddata_8c.html#a36">MmZeroedPageListHead</a>,
00223                                       &amp;<a class="code" href="../../d8/d5/kddata_8c.html#a37">MmFreePageListHead</a>,
00224                                       &amp;<a class="code" href="../../d8/d5/kddata_8c.html#a38">MmStandbyPageListHead</a>,
00225                                       &amp;<a class="code" href="../../d2/d1/mm_8h.html#a150">MmModifiedPageListHead</a>,
00226                                       &amp;<a class="code" href="../../d8/d5/kddata_8c.html#a40">MmModifiedNoWritePageListHead</a>,
00227                                       &amp;<a class="code" href="../../d4/d8/mi_8h.html#a605">MmBadPageListHead</a>,
00228                                       <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>,
00229                                       <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> };
00230 
00231 <span class="comment">//  PMMPFNLIST MmPageLocationList[FreePageList] =            &amp;MmFreePageListHead;</span>
00232 <span class="comment">//</span>
00233 <span class="comment">//  PMMPFNLIST MmPageLocationList[ZeroedPageList] =          &amp;MmZeroedPageListHead;</span>
00234 <span class="comment">//</span>
00235 <span class="comment">//  PMMPFNLIST MmPageLocationList[StandbyPageList] =         &amp;MmStandbyPageListHead;</span>
00236 <span class="comment">//</span>
00237 <span class="comment">//  PMMPFNLIST MmPageLocationList[ModifiedPageList] =        &amp;MmModifiedPageListHead;</span>
00238 <span class="comment">//</span>
00239 <span class="comment">//  PMMPFNLIST MmPageLocationList[ModifiedNoWritePageList] = &amp;MmModifiedNoWritePageListHead;</span>
00240 <span class="comment">//</span>
00241 <span class="comment">//  PMMPFNLIST MmPageLocationList[BadPageList] =             &amp;MmBadPageListHead;</span>
00242 <span class="comment">//</span>
00243 <span class="comment">//  PMMPFNLIST MmPageLocationList[ActiveAndValid] =          NULL;</span>
00244 <span class="comment">//</span>
00245 <span class="comment">//  PMMPFNLIST MmPageLocationList[TransitionPage] =          NULL;</span>
00246 
<a name="l00247"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a33">00247</a> <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> <a class="code" href="../../d4/d8/mi_8h.html#a755">MiHighestUserPte</a>;
<a name="l00248"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a34">00248</a> <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> <a class="code" href="../../d4/d8/mi_8h.html#a756">MiHighestUserPde</a>;
00249 
<a name="l00250"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a35">00250</a> <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> <a class="code" href="../../d4/d8/mi_8h.html#a757">MiSessionBasePte</a>;
<a name="l00251"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a36">00251</a> <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> <a class="code" href="../../d4/d8/mi_8h.html#a758">MiSessionLastPte</a>;
00252 
00253 <span class="comment">//</span>
00254 <span class="comment">// Hyper space items.</span>
00255 <span class="comment">//</span>
00256 
<a name="l00257"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a37">00257</a> <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> <a class="code" href="../../d4/d8/mi_8h.html#a615">MmFirstReservedMappingPte</a>;
00258 
<a name="l00259"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a38">00259</a> <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> <a class="code" href="../../d4/d8/mi_8h.html#a616">MmLastReservedMappingPte</a>;
00260 
00261 <a class="code" href="../../d0/d8/struct__MMWSL.html">PMMWSL</a> <a class="code" href="../../d4/d8/mi_8h.html#a672">MmWorkingSetList</a>;
00262 
00263 <a class="code" href="../../d1/d8/struct__MMWSLE.html">PMMWSLE</a> <a class="code" href="../../d4/d8/mi_8h.html#a673">MmWsle</a>;
00264 
00265 <span class="comment">//</span>
00266 <span class="comment">// Event for available pages, set means pages are available.</span>
00267 <span class="comment">//</span>
00268 
<a name="l00269"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a41">00269</a> <a class="code" href="../../d2/d6/struct__KEVENT.html">KEVENT</a> <a class="code" href="../../d4/d8/mi_8h.html#a609">MmAvailablePagesEvent</a>;
00270 
00271 <span class="comment">//</span>
00272 <span class="comment">// Event for the zeroing page thread.</span>
00273 <span class="comment">//</span>
00274 
<a name="l00275"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a42">00275</a> <a class="code" href="../../d2/d6/struct__KEVENT.html">KEVENT</a> <a class="code" href="../../d4/d8/mi_8h.html#a611">MmZeroingPageEvent</a>;
00276 
00277 <span class="comment">//</span>
00278 <span class="comment">// Boolean to indicate if the zeroing page thread is currently</span>
00279 <span class="comment">// active.  This is set to true when the zeroing page event is</span>
00280 <span class="comment">// set and set to false when the zeroing page thread is done</span>
00281 <span class="comment">// zeroing all the pages on the free list.</span>
00282 <span class="comment">//</span>
00283 
<a name="l00284"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a43">00284</a> BOOLEAN <a class="code" href="../../d4/d8/mi_8h.html#a612">MmZeroingPageThreadActive</a>;
00285 
00286 <span class="comment">//</span>
00287 <span class="comment">// Minimum number of free pages before zeroing page thread starts.</span>
00288 <span class="comment">//</span>
00289 
<a name="l00290"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a44">00290</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a613">MmMinimumFreePagesToZero</a> = 8;
00291 
00292 <span class="comment">//</span>
00293 <span class="comment">// System space sizes - MmNonPagedSystemStart to MM_NON_PAGED_SYSTEM_END</span>
00294 <span class="comment">// defines the ranges of PDEs which must be copied into a new process's</span>
00295 <span class="comment">// address space.</span>
00296 <span class="comment">//</span>
00297 
<a name="l00298"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a45">00298</a> PVOID <a class="code" href="../../d8/d5/kddata_8c.html#a22">MmNonPagedSystemStart</a>;
00299 
<a name="l00300"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a46">00300</a> LOGICAL <a class="code" href="../../d8/d0/cmdat3_8c.html#a36">MmProtectFreedNonPagedPool</a>;
00301 
<a name="l00302"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a47">00302</a> LOGICAL <a class="code" href="../../d8/d0/cmdat3_8c.html#a29">MmDynamicPfn</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00303 
00304 <span class="preprocessor">#if PFN_CONSISTENCY</span>
00305 <span class="preprocessor"></span><a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> MiPfnStartPte;
00306 PFN_NUMBER MiPfnPtes;
00307 BOOLEAN MiPfnProtectionEnabled;
00308 <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> MiPfnLockOwner;
00309 <span class="preprocessor">#endif</span>
00310 <span class="preprocessor"></span>
00311 <span class="preprocessor">#ifdef MM_BUMP_COUNTER_MAX</span>
<a name="l00312"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a48">00312</a> <span class="preprocessor"></span>SIZE_T <a class="code" href="../../d4/d8/mi_8h.html#a745">MmResTrack</a>[<a class="code" href="../../d4/d8/mi_8h.html#a321">MM_BUMP_COUNTER_MAX</a>];
00313 <span class="preprocessor">#endif</span>
00314 <span class="preprocessor"></span>
00315 <span class="preprocessor">#ifdef MM_COMMIT_COUNTER_MAX</span>
00316 <span class="preprocessor"></span>SIZE_T MmTrackCommit[MM_COMMIT_COUNTER_MAX];
00317 <span class="preprocessor">#endif</span>
00318 <span class="preprocessor"></span>
00319 <span class="comment">//</span>
00320 <span class="comment">// Set via the registry to identify which drivers are leaking locked pages.</span>
00321 <span class="comment">//</span>
00322 
<a name="l00323"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a49">00323</a> LOGICAL  <a class="code" href="../../d8/d0/cmdat3_8c.html#a33">MmTrackLockedPages</a>;
00324 
00325 <span class="comment">//</span>
00326 <span class="comment">// Set via the registry to identify drivers which unload without releasing</span>
00327 <span class="comment">// resources or still have active timers, etc.</span>
00328 <span class="comment">//</span>
00329 
<a name="l00330"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a50">00330</a> LOGICAL <a class="code" href="../../d8/d0/cmdat3_8c.html#a32">MmSnapUnloads</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00331 
00332 <span class="preprocessor">#if DBG</span>
00333 <span class="preprocessor"></span><a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> MiExpansionLockOwner;
00334 <span class="preprocessor">#endif</span>
00335 <span class="preprocessor"></span>
00336 <span class="comment">//</span>
00337 <span class="comment">// Pool sizes.</span>
00338 <span class="comment">//</span>
00339 
<a name="l00340"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a51">00340</a> SIZE_T <a class="code" href="../../d8/d0/cmdat3_8c.html#a19">MmSizeOfNonPagedPoolInBytes</a>;
00341 
<a name="l00342"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a52">00342</a> SIZE_T <a class="code" href="../../d8/d5/kddata_8c.html#a21">MmMaximumNonPagedPoolInBytes</a>;
00343 
<a name="l00344"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a53">00344</a> SIZE_T <a class="code" href="../../d4/d8/mi_8h.html#a620">MmMinimumNonPagedPoolSize</a> = 256 * 1024; <span class="comment">// 256k</span>
00345 
<a name="l00346"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a54">00346</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a622">MmMinAdditionNonPagedPoolPerMb</a> = 32 * 1024; <span class="comment">// 32k</span>
00347 
<a name="l00348"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a55">00348</a> SIZE_T <a class="code" href="../../d4/d8/mi_8h.html#a621">MmDefaultMaximumNonPagedPool</a> = 1024 * 1024;  <span class="comment">// 1mb</span>
00349 
<a name="l00350"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a56">00350</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a623">MmMaxAdditionNonPagedPoolPerMb</a> = 400 * 1024;  <span class="comment">//400k</span>
00351 
<a name="l00352"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a57">00352</a> SIZE_T <a class="code" href="../../d8/d0/cmdat3_8c.html#a18">MmSizeOfPagedPoolInBytes</a> = 32 * 1024 * 1024; <span class="comment">// 32 MB.</span>
00353 
<a name="l00354"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a58">00354</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a627">MmSizeOfNonPagedMustSucceed</a> = 4 * <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>; <span class="comment">// 4 pages</span>
00355 
<a name="l00356"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a59">00356</a> ULONG <a class="code" href="../../d8/d0/cmdat3_8c.html#a23">MmNumberOfSystemPtes</a>;
00357 
<a name="l00358"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a60">00358</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a633">MiRequestedSystemPtes</a>;
00359 
<a name="l00360"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a61">00360</a> ULONG <a class="code" href="../../d8/d0/cmdat3_8c.html#a21">MmLockPagesPercentage</a>;
00361 
<a name="l00362"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a62">00362</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a635">MmLockPagesLimit</a>;
00363 
<a name="l00364"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a63">00364</a> <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> <a class="code" href="../../d0/d9/miglobal_8c.html#a63">MmFirstPteForPagedPool</a>;
00365 
<a name="l00366"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a64">00366</a> <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> <a class="code" href="../../d0/d9/miglobal_8c.html#a64">MmLastPteForPagedPool</a>;
00367 
<a name="l00368"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a65">00368</a> <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> <a class="code" href="../../d4/d8/mi_8h.html#a638">MmPagedPoolBasePde</a>;
00369 
00370 <span class="comment">//</span>
00371 <span class="comment">// Pool bit maps and other related structures.</span>
00372 <span class="comment">//</span>
00373 
<a name="l00374"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a66">00374</a> PVOID <a class="code" href="../../d4/d8/mi_8h.html#a653">MmPageAlignedPoolBase</a>[2];
00375 
<a name="l00376"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a67">00376</a> PVOID <a class="code" href="../../d4/d8/mi_8h.html#a649">MmNonPagedMustSucceed</a>;
00377 
<a name="l00378"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a68">00378</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a629">MmExpandedPoolBitPosition</a>;
00379 
<a name="l00380"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a69">00380</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a630">MmNumberOfFreeNonPagedPool</a>;
00381 
<a name="l00382"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a70">00382</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a631">MmMustSucceedPoolBitPosition</a>;
00383 
00384 <span class="comment">//</span>
00385 <span class="comment">// MmFirstFreeSystemPte contains the offset from the</span>
00386 <span class="comment">// Nonpaged system base to the first free system PTE.</span>
00387 <span class="comment">// Note that an offset of FFFFF indicates an empty list.</span>
00388 <span class="comment">//</span>
00389 
<a name="l00390"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a71">00390</a> <a class="code" href="../../d2/d4/struct__MMPTE.html">MMPTE</a> <a class="code" href="../../d4/d8/mi_8h.html#a655">MmFirstFreeSystemPte</a>[<a class="code" href="../../d4/d8/mi_8h.html#a1003a771">MaximumPtePoolTypes</a>];
00391 
00392 <span class="comment">//</span>
00393 <span class="comment">// System cache sizes.</span>
00394 <span class="comment">//</span>
00395 
<a name="l00396"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a72">00396</a> <a class="code" href="../../d0/d8/struct__MMWSL.html">PMMWSL</a> <a class="code" href="../../d4/d8/mi_8h.html#a657">MmSystemCacheWorkingSetList</a> = (<a class="code" href="../../d0/d8/struct__MMWSL.html">PMMWSL</a>)<a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a16">MM_SYSTEM_CACHE_WORKING_SET</a>;
00397 
<a name="l00398"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a73">00398</a> <a class="code" href="../../d3/d6/struct__MMSUPPORT.html">MMSUPPORT</a> <a class="code" href="../../d6/d8/sysinfo_8c.html#a21">MmSystemCacheWs</a>;
00399 
<a name="l00400"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a74">00400</a> <a class="code" href="../../d1/d8/struct__MMWSLE.html">PMMWSLE</a> <a class="code" href="../../d4/d8/mi_8h.html#a658">MmSystemCacheWsle</a>;
00401 
<a name="l00402"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a75">00402</a> PVOID <a class="code" href="../../d8/d5/kddata_8c.html#a11">MmSystemCacheStart</a> = (PVOID)<a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a12">MM_SYSTEM_CACHE_START</a>;
00403 
<a name="l00404"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a76">00404</a> PVOID <a class="code" href="../../d8/d5/kddata_8c.html#a12">MmSystemCacheEnd</a>;
00405 
<a name="l00406"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a77">00406</a> PRTL_BITMAP <a class="code" href="../../d4/d8/mi_8h.html#a661">MmSystemCacheAllocationMap</a>;
00407 
<a name="l00408"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a78">00408</a> PRTL_BITMAP <a class="code" href="../../d4/d8/mi_8h.html#a662">MmSystemCacheEndingMap</a>;
00409 
00410 <span class="comment">//</span>
00411 <span class="comment">// This value should not be greater than 256MB in a system with 1GB of</span>
00412 <span class="comment">// system space.</span>
00413 <span class="comment">//</span>
00414 
<a name="l00415"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a79">00415</a> PFN_COUNT <a class="code" href="../../d2/d1/mm_8h.html#a137">MmSizeOfSystemCacheInPages</a> = 64 * 256; <span class="comment">//64MB.</span>
00416 
00417 <span class="comment">//</span>
00418 <span class="comment">// Default sizes for the system cache.</span>
00419 <span class="comment">//</span>
00420 
<a name="l00421"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a80">00421</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a663">MmSystemCacheWsMinimum</a> = 288;
00422 
<a name="l00423"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a81">00423</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a664">MmSystemCacheWsMaximum</a> = 350;
00424 
00425 <span class="comment">//</span>
00426 <span class="comment">// Cells to track unused thread kernel stacks to avoid TB flushes</span>
00427 <span class="comment">// every time a thread terminates.</span>
00428 <span class="comment">//</span>
00429 
<a name="l00430"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a82">00430</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a668">MmNumberDeadKernelStacks</a>;
<a name="l00431"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a83">00431</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a669">MmMaximumDeadKernelStacks</a> = 5;
<a name="l00432"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a84">00432</a> <a class="code" href="../../d4/d3/struct__MMPFN.html">PMMPFN</a> <a class="code" href="../../d4/d8/mi_8h.html#a670">MmFirstDeadKernelStack</a> = (<a class="code" href="../../d4/d3/struct__MMPFN.html">PMMPFN</a>)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00433 
00434 <span class="comment">//</span>
00435 <span class="comment">// MmSystemPteBase contains the address of 1 PTE before</span>
00436 <span class="comment">// the first free system PTE (zero indicates an empty list).</span>
00437 <span class="comment">// The value of this field does not change once set.</span>
00438 <span class="comment">//</span>
00439 
<a name="l00440"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a85">00440</a> <a class="code" href="../../d2/d4/struct__MMPTE.html">PMMPTE</a> <a class="code" href="../../d4/d8/mi_8h.html#a671">MmSystemPteBase</a>;
00441 
<a name="l00442"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a39">00442</a> <a class="code" href="../../d0/d8/struct__MMWSL.html">PMMWSL</a> <a class="code" href="../../d4/d8/mi_8h.html#a672">MmWorkingSetList</a>;
00443 
<a name="l00444"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a40">00444</a> <a class="code" href="../../d1/d8/struct__MMWSLE.html">PMMWSLE</a> <a class="code" href="../../d4/d8/mi_8h.html#a673">MmWsle</a>;
00445 
<a name="l00446"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a86">00446</a> <a class="code" href="../../d9/d0/struct__MMADDRESS__NODE.html">PMMADDRESS_NODE</a> <a class="code" href="../../d4/d8/mi_8h.html#a675">MmSectionBasedRoot</a>;
00447 
<a name="l00448"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a87">00448</a> PVOID <a class="code" href="../../d4/d8/mi_8h.html#a676">MmHighSectionBase</a>;
00449 
00450 <span class="comment">//</span>
00451 <span class="comment">// Section object type.</span>
00452 <span class="comment">//</span>
00453 
<a name="l00454"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a88">00454</a> <a class="code" href="../../d3/d6/struct__OBJECT__TYPE.html">POBJECT_TYPE</a> <a class="code" href="../../d2/d1/mm_8h.html#a133">MmSectionObjectType</a>;
00455 
00456 <span class="comment">//</span>
00457 <span class="comment">// Section commit mutex.</span>
00458 <span class="comment">//</span>
00459 
<a name="l00460"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a89">00460</a> <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="code" href="../../d4/d8/mi_8h.html#a677">MmSectionCommitMutex</a>;
00461 
00462 <span class="comment">//</span>
00463 <span class="comment">// Section base address mutex.</span>
00464 <span class="comment">//</span>
00465 
<a name="l00466"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a90">00466</a> <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="code" href="../../d4/d8/mi_8h.html#a678">MmSectionBasedMutex</a>;
00467 
00468 <span class="comment">//</span>
00469 <span class="comment">// Resource for section extension.</span>
00470 <span class="comment">//</span>
00471 
<a name="l00472"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a91">00472</a> <a class="code" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="code" href="../../d4/d8/mi_8h.html#a679">MmSectionExtendResource</a>;
<a name="l00473"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a92">00473</a> <a class="code" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="code" href="../../d4/d8/mi_8h.html#a680">MmSectionExtendSetResource</a>;
00474 
00475 <span class="comment">//</span>
00476 <span class="comment">// Pagefile creation lock.</span>
00477 <span class="comment">//</span>
00478 
<a name="l00479"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a93">00479</a> <a class="code" href="../../d6/d9/struct__FAST__MUTEX.html">FAST_MUTEX</a> <a class="code" href="../../d4/d8/mi_8h.html#a684">MmPageFileCreationLock</a>;
00480 
<a name="l00481"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a94">00481</a> <a class="code" href="../../d8/d1/struct__MMDEREFERENCE__SEGMENT__HEADER.html">MMDEREFERENCE_SEGMENT_HEADER</a> <a class="code" href="../../d4/d8/mi_8h.html#a697">MmDereferenceSegmentHeader</a>;
00482 
<a name="l00483"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a95">00483</a> LIST_ENTRY <a class="code" href="../../d4/d8/mi_8h.html#a698">MmUnusedSegmentList</a>;
00484 
<a name="l00485"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a96">00485</a> <a class="code" href="../../d2/d6/struct__KEVENT.html">KEVENT</a> <a class="code" href="../../d4/d8/mi_8h.html#a699">MmUnusedSegmentCleanup</a>;
00486 
<a name="l00487"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a97">00487</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a709">MmUnusedSegmentCount</a>;
00488 
00489 <span class="comment">//</span>
00490 <span class="comment">// Maximum amount of paged pool to keep in unused segments.</span>
00491 <span class="comment">//</span>
00492 
<a name="l00493"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a98">00493</a> SIZE_T <a class="code" href="../../d4/d8/mi_8h.html#a700">MmMaxUnusedSegmentPagedPoolUsage</a>;
00494 
00495 <span class="comment">//</span>
00496 <span class="comment">// Amount of paged pool used by unused segments.</span>
00497 <span class="comment">//</span>
00498 
<a name="l00499"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a99">00499</a> SIZE_T <a class="code" href="../../d4/d8/mi_8h.html#a701">MmUnusedSegmentPagedPoolUsage</a>;
<a name="l00500"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a100">00500</a> SIZE_T <a class="code" href="../../d4/d8/mi_8h.html#a702">MiUnusedSegmentPagedPoolUsage</a>;
00501 
00502 <span class="comment">//</span>
00503 <span class="comment">// Amount to reduce paged pool by when it starts getting low.</span>
00504 <span class="comment">//</span>
00505 
<a name="l00506"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a101">00506</a> SIZE_T <a class="code" href="../../d4/d8/mi_8h.html#a703">MmUnusedSegmentPagedPoolReduction</a>;
00507 
00508 <span class="comment">//</span>
00509 <span class="comment">// Maximum amount of nonpaged pool to keep in unused segments.</span>
00510 <span class="comment">//</span>
00511 
<a name="l00512"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a102">00512</a> SIZE_T <a class="code" href="../../d4/d8/mi_8h.html#a704">MmMaxUnusedSegmentNonPagedPoolUsage</a>;
00513 
00514 <span class="comment">//</span>
00515 <span class="comment">// Amount of nonpaged pool used by unused segments.</span>
00516 <span class="comment">//</span>
00517 
<a name="l00518"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a103">00518</a> SIZE_T <a class="code" href="../../d4/d8/mi_8h.html#a705">MmUnusedSegmentNonPagedPoolUsage</a>;
<a name="l00519"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a104">00519</a> SIZE_T <a class="code" href="../../d4/d8/mi_8h.html#a706">MiUnusedSegmentNonPagedPoolUsage</a>;
00520 
00521 <span class="comment">//</span>
00522 <span class="comment">// Amount to reduce nonpaged pool by when it starts getting low.</span>
00523 <span class="comment">//</span>
00524 
<a name="l00525"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a105">00525</a> SIZE_T <a class="code" href="../../d4/d8/mi_8h.html#a707">MmUnusedSegmentNonPagedPoolReduction</a>;
00526 
00527 <span class="comment">//</span>
00528 <span class="comment">// Unused File Cache trim level - this is the percentage of pool consumed by</span>
00529 <span class="comment">// unused file segments.  The minimum is 5%, the maximum (ie: largest caching)</span>
00530 <span class="comment">// is 40%.  Under 20% is almost always the correct value.</span>
00531 <span class="comment">//</span>
00532 
<a name="l00533"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a106">00533</a> ULONG <a class="code" href="../../d8/d0/cmdat3_8c.html#a24">MmUnusedSegmentTrimLevel</a> = 18;
00534 
<a name="l00535"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a107">00535</a> <a class="code" href="../../d7/d7/struct__MMWORKING__SET__EXPANSION__HEAD.html">MMWORKING_SET_EXPANSION_HEAD</a> <a class="code" href="../../d4/d8/mi_8h.html#a710">MmWorkingSetExpansionHead</a>;
00536 
<a name="l00537"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a108">00537</a> <a class="code" href="../../d1/d3/struct__MMPAGE__FILE__EXPANSION.html">MMPAGE_FILE_EXPANSION</a> <a class="code" href="../../d4/d8/mi_8h.html#a711">MmAttemptForCantExtend</a>;
00538 
00539 <span class="comment">//</span>
00540 <span class="comment">// Paging files</span>
00541 <span class="comment">//</span>
00542 
<a name="l00543"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a109">00543</a> <a class="code" href="../../d8/d2/struct__MMMOD__WRITER__LISTHEAD.html">MMMOD_WRITER_LISTHEAD</a> <a class="code" href="../../d4/d8/mi_8h.html#a712">MmPagingFileHeader</a>;
00544 
<a name="l00545"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a110">00545</a> <a class="code" href="../../d8/d2/struct__MMMOD__WRITER__LISTHEAD.html">MMMOD_WRITER_LISTHEAD</a> <a class="code" href="../../d4/d8/mi_8h.html#a713">MmMappedFileHeader</a>;
00546 
<a name="l00547"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a111">00547</a> <a class="code" href="../../d9/d2/struct__MMMOD__WRITER__MDL__ENTRY.html">PMMMOD_WRITER_MDL_ENTRY</a> <a class="code" href="../../d4/d8/mi_8h.html#a715">MmMappedFileMdl</a>[<a class="code" href="../../d4/d8/mi_8h.html#a331">MM_MAPPED_FILE_MDLS</a>]; ;
00548 
<a name="l00549"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a112">00549</a> LIST_ENTRY <a class="code" href="../../d4/d8/mi_8h.html#a716">MmFreePagingSpaceLow</a>;
00550 
<a name="l00551"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a113">00551</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a717">MmNumberOfActiveMdlEntries</a>;
00552 
<a name="l00553"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a114">00553</a> <a class="code" href="../../d3/d3/struct__MMPAGING__FILE.html">PMMPAGING_FILE</a> <a class="code" href="../../d4/d8/mi_8h.html#a714">MmPagingFile</a>[<a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a48">MAX_PAGE_FILES</a>];
00554 
<a name="l00555"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a115">00555</a> ULONG <a class="code" href="../../d8/d5/kddata_8c.html#a17">MmNumberOfPagingFiles</a>;
00556 
<a name="l00557"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a116">00557</a> <a class="code" href="../../d2/d6/struct__KEVENT.html">KEVENT</a> <a class="code" href="../../d4/d8/mi_8h.html#a719">MmModifiedPageWriterEvent</a>;
00558 
<a name="l00559"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a117">00559</a> <a class="code" href="../../d2/d6/struct__KEVENT.html">KEVENT</a> <a class="code" href="../../d2/d1/mm_8h.html#a139">MmWorkingSetManagerEvent</a>;
00560 
<a name="l00561"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a118">00561</a> <a class="code" href="../../d2/d6/struct__KEVENT.html">KEVENT</a> <a class="code" href="../../d4/d8/mi_8h.html#a720">MmCollidedFlushEvent</a>;
00562 
00563 <span class="comment">//</span>
00564 <span class="comment">// Total number of committed pages.</span>
00565 <span class="comment">//</span>
00566 
<a name="l00567"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a119">00567</a> SIZE_T <a class="code" href="../../d6/d8/sysinfo_8c.html#a3">MmTotalCommittedPages</a>;
00568 
00569 <span class="comment">//</span>
00570 <span class="comment">// Limit on committed pages.  When MmTotalCommittedPages would become</span>
00571 <span class="comment">// greater than or equal to this number the paging files must be expanded.</span>
00572 <span class="comment">//</span>
00573 
<a name="l00574"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a120">00574</a> SIZE_T <a class="code" href="../../d6/d8/sysinfo_8c.html#a4">MmTotalCommitLimit</a>;
00575 
<a name="l00576"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a121">00576</a> SIZE_T <a class="code" href="../../d9/d5/4_2kddata_8c.html#a54">MmTotalCommitLimitMaximum</a>;
00577 
00578 <span class="comment">//</span>
00579 <span class="comment">// Number of pages to overcommit without expanding the paging file.</span>
00580 <span class="comment">// MmTotalCommitLimit = (total paging file space) + MmOverCommit.</span>
00581 <span class="comment">//</span>
00582 
<a name="l00583"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a122">00583</a> SIZE_T <a class="code" href="../../d8/d0/cmdat3_8c.html#a20">MmOverCommit</a>;
00584 
00585 <span class="comment">//</span>
00586 <span class="comment">// Modified page writer.</span>
00587 <span class="comment">//</span>
00588 
00589 
00590 <span class="comment">//</span>
00591 <span class="comment">// Minimum number of free pages before working set trimming and</span>
00592 <span class="comment">// aggressive modified page writing is started.</span>
00593 <span class="comment">//</span>
00594 
<a name="l00595"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a123">00595</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a726">MmMinimumFreePages</a> = 26;
00596 
00597 <span class="comment">//</span>
00598 <span class="comment">// Stop writing modified pages when MmFreeGoal pages exist.</span>
00599 <span class="comment">//</span>
00600 
<a name="l00601"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a124">00601</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a727">MmFreeGoal</a> = 100;
00602 
00603 <span class="comment">//</span>
00604 <span class="comment">// Start writing pages if more than this number of pages</span>
00605 <span class="comment">// is on the modified page list.</span>
00606 <span class="comment">//</span>
00607 
<a name="l00608"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a125">00608</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a728">MmModifiedPageMaximum</a>;
00609 
00610 <span class="comment">//</span>
00611 <span class="comment">// Minimum number of modified pages required before the modified</span>
00612 <span class="comment">// page writer is started.</span>
00613 <span class="comment">//</span>
00614 
<a name="l00615"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a126">00615</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a729">MmModifiedPageMinimum</a>;
00616 
00617 <span class="comment">//</span>
00618 <span class="comment">// Amount of disk space that must be free after the paging file is</span>
00619 <span class="comment">// extended.</span>
00620 <span class="comment">//</span>
00621 
<a name="l00622"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a127">00622</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a731">MmMinimumFreeDiskSpace</a> = 1024 * 1024;
00623 
00624 <span class="comment">//</span>
00625 <span class="comment">// Size to extend the paging file by.</span>
00626 <span class="comment">//</span>
00627 
<a name="l00628"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a128">00628</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a732">MmPageFileExtension</a> = 128; <span class="comment">//128 pages</span>
00629 
00630 <span class="comment">//</span>
00631 <span class="comment">// Size to reduce the paging file by.</span>
00632 <span class="comment">//</span>
00633 
<a name="l00634"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a129">00634</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a733">MmMinimumPageFileReduction</a> = 256;  <span class="comment">//256 pages (1mb)</span>
00635 
00636 <span class="comment">//</span>
00637 <span class="comment">// Number of pages to write in a single I/O.</span>
00638 <span class="comment">//</span>
00639 
<a name="l00640"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a130">00640</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a730">MmModifiedWriteClusterSize</a> = <a class="code" href="../../d4/d8/mi_8h.html#a33">MM_MAXIMUM_WRITE_CLUSTER</a>;
00641 
00642 <span class="comment">//</span>
00643 <span class="comment">// Number of pages to read in a single I/O if possible.</span>
00644 <span class="comment">//</span>
00645 
<a name="l00646"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a131">00646</a> ULONG <a class="code" href="../../d2/d1/mm_8h.html#a134">MmReadClusterSize</a> = 7;
00647 
00648 <span class="comment">//</span>
00649 <span class="comment">//  Spin locks.</span>
00650 <span class="comment">//</span>
00651 
00652 <span class="comment">//</span>
00653 <span class="comment">// Spinlock which guards PFN database.  This spinlock is used by</span>
00654 <span class="comment">// memory management for accessing the PFN database.  The I/O</span>
00655 <span class="comment">// system makes use of it for unlocking pages during I/O completion.</span>
00656 <span class="comment">//</span>
00657 
00658 <span class="comment">// KSPIN_LOCK MmPfnLock;</span>
00659 
00660 <span class="comment">//</span>
00661 <span class="comment">// Spinlock which guards the working set list for the system shared</span>
00662 <span class="comment">// address space (paged pool, system cache, pagable drivers).</span>
00663 <span class="comment">//</span>
00664 
<a name="l00665"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a132">00665</a> <a class="code" href="../../d6/d4/struct__ERESOURCE.html">ERESOURCE</a> <a class="code" href="../../d4/d8/mi_8h.html#a688">MmSystemWsLock</a>;
00666 
<a name="l00667"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a133">00667</a> <a class="code" href="../../d5/d6/struct__ETHREAD.html">PETHREAD</a> <a class="code" href="../../d4/d8/mi_8h.html#a434">MmSystemLockOwner</a>;
00668 
00669 <span class="comment">//</span>
00670 <span class="comment">// Spin lock for allowing working set expansion.</span>
00671 <span class="comment">//</span>
00672 
<a name="l00673"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a134">00673</a> KSPIN_LOCK <a class="code" href="../../d4/d8/mi_8h.html#a691">MmExpansionLock</a>;
00674 
00675 <span class="comment">//</span>
00676 <span class="comment">// Spin lock for protecting hyper space access.</span>
00677 <span class="comment">//</span>
00678 
00679 <span class="comment">//</span>
00680 <span class="comment">// System process working set sizes.</span>
00681 <span class="comment">//</span>
00682 
<a name="l00683"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a135">00683</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a739">MmSystemProcessWorkingSetMin</a> = 50;
00684 
<a name="l00685"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a136">00685</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a740">MmSystemProcessWorkingSetMax</a> = 450;
00686 
<a name="l00687"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a137">00687</a> PFN_NUMBER <a class="code" href="../../d0/d9/miglobal_8c.html#a137">MmMaximumWorkingSetSize</a>;
00688 
<a name="l00689"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a138">00689</a> PFN_NUMBER <a class="code" href="../../d4/d8/mi_8h.html#a741">MmMinimumWorkingSetSize</a> = 20;
00690 
00691 
00692 <span class="comment">//</span>
00693 <span class="comment">// Page color for system working set.</span>
00694 <span class="comment">//</span>
00695 
<a name="l00696"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a139">00696</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a693">MmSystemPageColor</a>;
00697 
00698 <span class="comment">//</span>
00699 <span class="comment">// Time constants</span>
00700 <span class="comment">//</span>
00701 
<a name="l00702"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a140">00702</a> LARGE_INTEGER <a class="code" href="../../d4/d8/mi_8h.html#a416">MmSevenMinutes</a> = {0, -1};
00703 
00704 <span class="comment">//</span>
00705 <span class="comment">// note that the following constant is initialized to five seconds,</span>
00706 <span class="comment">// but is set to 3 on very small workstations. The constant used to</span>
00707 <span class="comment">// be called MmFiveSecondsAbsolute, but since its value changes depending on</span>
00708 <span class="comment">// the system type and size, I decided to change the name to reflect this</span>
00709 <span class="comment">//</span>
<a name="l00710"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a141">00710</a> LARGE_INTEGER <a class="code" href="../../d4/d8/mi_8h.html#a417">MmWorkingSetProtectionTime</a> = {5 * 1000 * 1000 * 10, 0};
00711 
<a name="l00712"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a142">00712</a> LARGE_INTEGER <a class="code" href="../../d4/d8/mi_8h.html#a418">MmOneSecond</a> = {(ULONG)(-1 * 1000 * 1000 * 10), -1};
<a name="l00713"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a143">00713</a> LARGE_INTEGER <a class="code" href="../../d4/d8/mi_8h.html#a419">MmTwentySeconds</a> = {(ULONG)(-20 * 1000 * 1000 * 10), -1};
<a name="l00714"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a144">00714</a> LARGE_INTEGER <a class="code" href="../../d4/d8/mi_8h.html#a420">MmShortTime</a> = {(ULONG)(-10 * 1000 * 10), -1}; <span class="comment">// 10 milliseconds</span>
<a name="l00715"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a145">00715</a> LARGE_INTEGER <a class="code" href="../../d4/d8/mi_8h.html#a421">MmHalfSecond</a> = {(ULONG)(-5 * 100 * 1000 * 10), -1};
<a name="l00716"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a146">00716</a> LARGE_INTEGER <a class="code" href="../../d4/d8/mi_8h.html#a422">Mm30Milliseconds</a> = {(ULONG)(-30 * 1000 * 10), -1};
00717 
00718 <span class="comment">//</span>
00719 <span class="comment">// Parameters for user mode passed up via PEB in MmCreatePeb</span>
00720 <span class="comment">//</span>
<a name="l00721"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a147">00721</a> ULONG <a class="code" href="../../d8/d0/cmdat3_8c.html#a45">MmCritsectTimeoutSeconds</a> = 2592000;
<a name="l00722"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a148">00722</a> LARGE_INTEGER <a class="code" href="../../d4/d8/mi_8h.html#a423">MmCriticalSectionTimeout</a>;     <span class="comment">// Filled in by mminit.c</span>
<a name="l00723"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a149">00723</a> SIZE_T <a class="code" href="../../d8/d0/cmdat3_8c.html#a46">MmHeapSegmentReserve</a> = 1024 * 1024;
<a name="l00724"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a150">00724</a> SIZE_T <a class="code" href="../../d8/d0/cmdat3_8c.html#a47">MmHeapSegmentCommit</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a> * 2;
<a name="l00725"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a151">00725</a> SIZE_T <a class="code" href="../../d8/d0/cmdat3_8c.html#a48">MmHeapDeCommitTotalFreeThreshold</a> = 64 * 1024;
<a name="l00726"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a152">00726</a> SIZE_T <a class="code" href="../../d8/d0/cmdat3_8c.html#a49">MmHeapDeCommitFreeBlockThreshold</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a446">PAGE_SIZE</a>;
00727 
00728 <span class="comment">//</span>
00729 <span class="comment">// Set from ntos\config\CMDAT3.C  Used by customers to disable paging</span>
00730 <span class="comment">// of executive on machines with lots of memory.  Worth a few TPS on a</span>
00731 <span class="comment">// database server.</span>
00732 <span class="comment">//</span>
00733 
<a name="l00734"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a153">00734</a> ULONG <a class="code" href="../../d8/d0/cmdat3_8c.html#a26">MmDisablePagingExecutive</a>;
00735 
<a name="l00736"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a154">00736</a> BOOLEAN <a class="code" href="../../d2/d1/mm_8h.html#a132">Mm64BitPhysicalAddress</a>;
00737 
00738 <span class="preprocessor">#if DBG</span>
00739 <span class="preprocessor"></span>ULONG MmDebug;
00740 <span class="preprocessor">#endif</span>
00741 <span class="preprocessor"></span>
00742 <span class="comment">//</span>
00743 <span class="comment">// Map a page protection from the Pte.Protect field into a protection mask.</span>
00744 <span class="comment">//</span>
00745 
<a name="l00746"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a155">00746</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a411">MmProtectToValue</a>[32] = {
00747                             PAGE_NOACCESS,
00748                             PAGE_READONLY,
00749                             PAGE_EXECUTE,
00750                             PAGE_EXECUTE_READ,
00751                             PAGE_READWRITE,
00752                             PAGE_WRITECOPY,
00753                             PAGE_EXECUTE_READWRITE,
00754                             PAGE_EXECUTE_WRITECOPY,
00755                             PAGE_NOACCESS,
00756                             PAGE_NOCACHE | PAGE_READONLY,
00757                             PAGE_NOCACHE | PAGE_EXECUTE,
00758                             PAGE_NOCACHE | PAGE_EXECUTE_READ,
00759                             PAGE_NOCACHE | PAGE_READWRITE,
00760                             PAGE_NOCACHE | PAGE_WRITECOPY,
00761                             PAGE_NOCACHE | PAGE_EXECUTE_READWRITE,
00762                             PAGE_NOCACHE | PAGE_EXECUTE_WRITECOPY,
00763                             PAGE_NOACCESS,
00764                             PAGE_GUARD | PAGE_READONLY,
00765                             PAGE_GUARD | PAGE_EXECUTE,
00766                             PAGE_GUARD | PAGE_EXECUTE_READ,
00767                             PAGE_GUARD | PAGE_READWRITE,
00768                             PAGE_GUARD | PAGE_WRITECOPY,
00769                             PAGE_GUARD | PAGE_EXECUTE_READWRITE,
00770                             PAGE_GUARD | PAGE_EXECUTE_WRITECOPY,
00771                             PAGE_NOACCESS,
00772                             PAGE_NOCACHE | PAGE_GUARD | PAGE_READONLY,
00773                             PAGE_NOCACHE | PAGE_GUARD | PAGE_EXECUTE,
00774                             PAGE_NOCACHE | PAGE_GUARD | PAGE_EXECUTE_READ,
00775                             PAGE_NOCACHE | PAGE_GUARD | PAGE_READWRITE,
00776                             PAGE_NOCACHE | PAGE_GUARD | PAGE_WRITECOPY,
00777                             PAGE_NOCACHE | PAGE_GUARD | PAGE_EXECUTE_READWRITE,
00778                             PAGE_NOCACHE | PAGE_GUARD | PAGE_EXECUTE_WRITECOPY
00779                           };
00780 
<a name="l00781"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a156">00781</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a412">MmProtectToPteMask</a>[32] = {
00782                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a80">MM_PTE_NOACCESS</a>,
00783                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a81">MM_PTE_READONLY</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00784                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a84">MM_PTE_EXECUTE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00785                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a85">MM_PTE_EXECUTE_READ</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00786                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a82">MM_PTE_READWRITE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00787                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a83">MM_PTE_WRITECOPY</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00788                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a86">MM_PTE_EXECUTE_READWRITE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00789                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a87">MM_PTE_EXECUTE_WRITECOPY</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00790                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a80">MM_PTE_NOACCESS</a>,
00791                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a81">MM_PTE_READONLY</a>,
00792                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a84">MM_PTE_EXECUTE</a>,
00793                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a85">MM_PTE_EXECUTE_READ</a>,
00794                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a82">MM_PTE_READWRITE</a>,
00795                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a83">MM_PTE_WRITECOPY</a>,
00796                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a86">MM_PTE_EXECUTE_READWRITE</a>,
00797                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a87">MM_PTE_EXECUTE_WRITECOPY</a>,
00798                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a80">MM_PTE_NOACCESS</a>,
00799                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a81">MM_PTE_READONLY</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00800                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a84">MM_PTE_EXECUTE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00801                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a85">MM_PTE_EXECUTE_READ</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00802                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a82">MM_PTE_READWRITE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00803                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a83">MM_PTE_WRITECOPY</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00804                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a86">MM_PTE_EXECUTE_READWRITE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00805                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a87">MM_PTE_EXECUTE_WRITECOPY</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a90">MM_PTE_CACHE</a>,
00806                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a80">MM_PTE_NOACCESS</a>,
00807                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a81">MM_PTE_READONLY</a>,
00808                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a84">MM_PTE_EXECUTE</a>,
00809                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a85">MM_PTE_EXECUTE_READ</a>,
00810                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a82">MM_PTE_READWRITE</a>,
00811                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a83">MM_PTE_WRITECOPY</a>,
00812                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a86">MM_PTE_EXECUTE_READWRITE</a>,
00813                        <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a88">MM_PTE_NOCACHE</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a89">MM_PTE_GUARD</a> | <a class="code" href="../../d8/d8/alpha_2mialpha_8h.html#a87">MM_PTE_EXECUTE_WRITECOPY</a>
00814                     };
00815 
00816 <span class="comment">//</span>
00817 <span class="comment">// Conversion which takes a Pte.Protect and builds a new Pte.Protect which</span>
00818 <span class="comment">// is not copy-on-write.</span>
00819 <span class="comment">//</span>
00820 
<a name="l00821"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a157">00821</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a413">MmMakeProtectNotWriteCopy</a>[32] = {
00822                        <a class="code" href="../../d4/d8/mi_8h.html#a46">MM_NOACCESS</a>,
00823                        <a class="code" href="../../d4/d8/mi_8h.html#a36">MM_READONLY</a>,
00824                        <a class="code" href="../../d4/d8/mi_8h.html#a37">MM_EXECUTE</a>,
00825                        <a class="code" href="../../d4/d8/mi_8h.html#a38">MM_EXECUTE_READ</a>,
00826                        <a class="code" href="../../d4/d8/mi_8h.html#a39">MM_READWRITE</a>,
00827                        <a class="code" href="../../d4/d8/mi_8h.html#a39">MM_READWRITE</a>,        <span class="comment">//not copy</span>
00828                        <a class="code" href="../../d4/d8/mi_8h.html#a41">MM_EXECUTE_READWRITE</a>,
00829                        <a class="code" href="../../d4/d8/mi_8h.html#a41">MM_EXECUTE_READWRITE</a>,
00830                        <a class="code" href="../../d4/d8/mi_8h.html#a46">MM_NOACCESS</a>,
00831                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a36">MM_READONLY</a>,
00832                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a37">MM_EXECUTE</a>,
00833                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a38">MM_EXECUTE_READ</a>,
00834                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a39">MM_READWRITE</a>,
00835                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a39">MM_READWRITE</a>,
00836                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a41">MM_EXECUTE_READWRITE</a>,
00837                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a41">MM_EXECUTE_READWRITE</a>,
00838                        <a class="code" href="../../d4/d8/mi_8h.html#a46">MM_NOACCESS</a>,
00839                        <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a36">MM_READONLY</a>,
00840                        <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a37">MM_EXECUTE</a>,
00841                        <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a38">MM_EXECUTE_READ</a>,
00842                        <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a39">MM_READWRITE</a>,
00843                        <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a39">MM_READWRITE</a>,
00844                        <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a41">MM_EXECUTE_READWRITE</a>,
00845                        <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a41">MM_EXECUTE_READWRITE</a>,
00846                        <a class="code" href="../../d4/d8/mi_8h.html#a46">MM_NOACCESS</a>,
00847                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a36">MM_READONLY</a>,
00848                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a37">MM_EXECUTE</a>,
00849                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a38">MM_EXECUTE_READ</a>,
00850                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a39">MM_READWRITE</a>,
00851                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a39">MM_READWRITE</a>,
00852                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a41">MM_EXECUTE_READWRITE</a>,
00853                        <a class="code" href="../../d4/d8/mi_8h.html#a43">MM_NOCACHE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a44">MM_GUARD_PAGE</a> | <a class="code" href="../../d4/d8/mi_8h.html#a41">MM_EXECUTE_READWRITE</a>
00854                        };
00855 
00856 <span class="comment">//</span>
00857 <span class="comment">// Converts a protection code to an access right for section access.</span>
00858 <span class="comment">// This uses only the lower 3 bits of the 5 bit protection code.</span>
00859 <span class="comment">//</span>
00860 
<a name="l00861"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a158">00861</a> ACCESS_MASK <a class="code" href="../../d4/d8/mi_8h.html#a414">MmMakeSectionAccess</a>[8] = { SECTION_MAP_READ,
00862                                        SECTION_MAP_READ,
00863                                        SECTION_MAP_EXECUTE,
00864                                        SECTION_MAP_EXECUTE | SECTION_MAP_READ,
00865                                        SECTION_MAP_WRITE,
00866                                        SECTION_MAP_READ,
00867                                        SECTION_MAP_EXECUTE | SECTION_MAP_WRITE,
00868                                        SECTION_MAP_EXECUTE | SECTION_MAP_READ };
00869 
00870 <span class="comment">//</span>
00871 <span class="comment">// Converts a protection code to an access right for file access.</span>
00872 <span class="comment">// This uses only the lower 3 bits of the 5 bit protection code.</span>
00873 <span class="comment">//</span>
00874 
<a name="l00875"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a159">00875</a> ACCESS_MASK <a class="code" href="../../d4/d8/mi_8h.html#a415">MmMakeFileAccess</a>[8] = { FILE_READ_DATA,
00876                                 FILE_READ_DATA,
00877                                 FILE_EXECUTE,
00878                                 FILE_EXECUTE | FILE_READ_DATA,
00879                                 FILE_WRITE_DATA | FILE_READ_DATA,
00880                                 FILE_READ_DATA,
00881                                 FILE_EXECUTE | FILE_WRITE_DATA | FILE_READ_DATA,
00882                                 FILE_EXECUTE | FILE_READ_DATA };
00883 
<a name="l00884"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a160">00884</a> <a class="code" href="../../d9/d9/struct__MM__PAGED__POOL__INFO.html">MM_PAGED_POOL_INFO</a> <a class="code" href="../../d8/d5/kddata_8c.html#a27">MmPagedPoolInfo</a>;
00885 
00886 <span class="comment">//</span>
00887 <span class="comment">// Some Hydra variables.</span>
00888 <span class="comment">//</span>
00889 
<a name="l00890"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a161">00890</a> BOOLEAN <a class="code" href="../../d4/d8/mi_8h.html#a581">MiHydra</a>;
00891 
<a name="l00892"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a162">00892</a> ULONG_PTR <a class="code" href="../../d4/d8/mi_8h.html#a748">MmSessionBase</a>;
<a name="l00893"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a163">00893</a> <a class="code" href="../../d0/d0/struct__MM__SESSION__SPACE.html">PMM_SESSION_SPACE</a> <a class="code" href="../../d4/d8/mi_8h.html#a753">MmSessionSpace</a>;
00894 
<a name="l00895"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a164">00895</a> LIST_ENTRY <a class="code" href="../../d4/d8/mi_8h.html#a761">MiSessionWsList</a>;
00896 
<a name="l00897"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a165">00897</a> ULONG_PTR <a class="code" href="../../d4/d8/mi_8h.html#a656">MiSystemViewStart</a>;
00898 
00899 <span class="comment">//</span>
00900 <span class="comment">// Both retry level and initial count must both be initialized to the same</span>
00901 <span class="comment">// value.  Note that the Driver Verifier can override these.</span>
00902 <span class="comment">//</span>
00903 
<a name="l00904"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a166">00904</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a428">MiIoRetryLevel</a> = 25;
<a name="l00905"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a167">00905</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a429">MiFaultRetries</a> = 25;
<a name="l00906"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a168">00906</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a430">MiUserIoRetryLevel</a> = 10;
<a name="l00907"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a169">00907</a> ULONG <a class="code" href="../../d4/d8/mi_8h.html#a431">MiUserFaultRetries</a> = 10;
00908 
00909 <span class="preprocessor">#ifdef ALLOC_DATA_PRAGMA</span>
00910 <span class="preprocessor"></span><span class="preprocessor">#pragma data_seg("INIT")</span>
00911 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00912 <span class="preprocessor"></span>
<a name="l00913"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a170">00913</a> WCHAR <a class="code" href="../../d8/d0/cmdat3_8c.html#a9">MmVerifyDriverBuffer</a>[<a class="code" href="../../d4/d8/mi_8h.html#a249">MI_SUSPECT_DRIVER_BUFFER_LENGTH</a>];
<a name="l00914"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a171">00914</a> ULONG <a class="code" href="../../d8/d0/cmdat3_8c.html#a10">MmVerifyDriverBufferLength</a> = <span class="keyword">sizeof</span>(<a class="code" href="../../d8/d0/cmdat3_8c.html#a9">MmVerifyDriverBuffer</a>);
<a name="l00915"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a172">00915</a> ULONG <a class="code" href="../../d8/d0/cmdat3_8c.html#a11">MmVerifyDriverBufferType</a> = REG_NONE;
<a name="l00916"></a><a class="code" href="../../d0/d9/miglobal_8c.html#a173">00916</a> ULONG <a class="code" href="../../d8/d0/cmdat3_8c.html#a12">MmVerifyDriverLevel</a> = (ULONG)-1;
00917 
00918 <span class="preprocessor">#ifdef ALLOC_DATA_PRAGMA</span>
00919 <span class="preprocessor"></span><span class="preprocessor">#pragma data_seg()</span>
00920 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:48 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
