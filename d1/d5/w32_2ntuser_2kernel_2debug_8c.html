<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: w32/ntuser/kernel/debug.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>debug.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>
<code>#include "ntcsrmsg.h"</code><br>
<code>#include "<a class="el" href="../../d3/d9/csrmsg_8h-source.html">csrmsg.h</a>"</code><br>

<p>
<a href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/w32_2ntuser_2kernel_2debug_8c.html#a0">xxxActivateDebugger</a> (UINT fsModifiers)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/w32_2ntuser_2kernel_2debug_8c.html#a1">GetRipComponent</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/w32_2ntuser_2kernel_2debug_8c.html#a2">GetDbgTagFlags</a> (int tag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/w32_2ntuser_2kernel_2debug_8c.html#a3">GetRipPID</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/w32_2ntuser_2kernel_2debug_8c.html#a4">GetRipFlags</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/w32_2ntuser_2kernel_2debug_8c.html#a5">SetRipFlags</a> (<a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRipFlags, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwRipPID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/w32_2ntuser_2kernel_2debug_8c.html#a6">SetDbgTag</a> (int tag, <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwBitFlags)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a2" doxytag="w32/ntuser/kernel/debug.c::GetDbgTagFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetDbgTagFlags           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>tag</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html#l00118">118</a> of file <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html">w32/ntuser/kernel/debug.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00119 {
00120 <span class="preprocessor">#if DEBUGTAGS</span>
00121 <span class="preprocessor"></span>    <span class="keywordflow">return</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ? <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;adwDBGTAGFlags[tag] : 0);
00122 <span class="preprocessor">#else</span>
00123 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
00124     UNREFERENCED_PARAMETER(tag);
00125 <span class="preprocessor">#endif // DEBUGTAGS</span>
00126 <span class="preprocessor"></span>}
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="w32/ntuser/kernel/debug.c::GetRipComponent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetRipComponent           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html#l00116">116</a> of file <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html">w32/ntuser/kernel/debug.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>.
<p>
<pre class="fragment"><div>00116 { <span class="keywordflow">return</span> RIP_USERKRNL; }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="w32/ntuser/kernel/debug.c::GetRipFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetRipFlags           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html#l00129">129</a> of file <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html">w32/ntuser/kernel/debug.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01166">RIPF_DEFAULT</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01265">tagSERVERINFO::wRIPFlags</a>.
<p>
<pre class="fragment"><div>00129 { <span class="keywordflow">return</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ? <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o0">wRIPFlags</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a393">RIPF_DEFAULT</a>); }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="w32/ntuser/kernel/debug.c::GetRipPID" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> GetRipPID           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html#l00128">128</a> of file <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html">w32/ntuser/kernel/debug.c</a>.
<p>
References <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01267">tagSERVERINFO::wRIPPID</a>.
<p>
<pre class="fragment"><div>00128 { <span class="keywordflow">return</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ? <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o2">wRIPPID</a> : 0); }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="w32/ntuser/kernel/debug.c::SetDbgTag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetDbgTag           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>tag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwBitFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html#l00136">136</a> of file <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html">w32/ntuser/kernel/debug.c</a>.
<p>
References <a class="el" href="../../d5/d4/rare_8c-source.html#l00287">_SetDbgTag()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>00137 {
00138     <a class="code" href="../../d4/d1/userk_8h.html#a1016">_SetDbgTag</a>(tag, dwBitFlags);
00139 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="w32/ntuser/kernel/debug.c::SetRipFlags" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SetRipFlags           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwRipFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dwRipPID</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html#l00131">131</a> of file <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html">w32/ntuser/kernel/debug.c</a>.
<p>
References <a class="el" href="../../d5/d4/rare_8c-source.html#l00264">_SetRipFlags()</a>, and <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>.
<p>
<pre class="fragment"><div>00132 {
00133     <a class="code" href="../../d4/d1/userk_8h.html#a1015">_SetRipFlags</a>(dwRipFlags, dwRipPID);
00134 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="w32/ntuser/kernel/debug.c::xxxActivateDebugger" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxActivateDebugger           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">UINT&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fsModifiers</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html#l00032">32</a> of file <a class="el" href="../../d2/d4/w32_2ntuser_2kernel_2debug_8c-source.html">w32/ntuser/kernel/debug.c</a>.
<p>
References <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00091">_USER_API_MSG::ApiNumber</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00090">_USER_API_MSG::CaptureBuffer</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00061">_ACTIVATEDEBUGGERMSG::ClientId</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00655">CsrApiPort</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00199">_EPROCESS::DebugPort</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00201">EnterCrit</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00794">gpepCSRSS</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00099">gpqForeground</a>, <a class="el" href="../../d3/d9/csrmsg_8h-source.html#l00089">_USER_API_MSG::h</a>, <a class="el" href="../../d8/d0/usersrv_8h-source.html#l00202">LeaveCrit</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04503">LockProcessByClientId()</a>, <a class="el" href="../../d7/d6/lpcsend_8c-source.html#l01181">LpcRequestPort()</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03107">tagQ::ptiKeyboard</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d3/d4/struct__USER__API__MSG.html#o15">_USER_API_MSG::u</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00174">_EPROCESS::UniqueProcessId</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l04486">UnlockProcess</a>, and <a class="el" href="../../d2/d0/csrmsg_8h.html#a35a28">UserpActivateDebugger</a>.
<p>
Referenced by <a class="el" href="../../d4/d1/hotkeys_8c-source.html#l00434">xxxDoHotKeyStuff()</a>.
<p>
<pre class="fragment"><div>00034 {
00035     ULONG ArgLength;
00036     <a class="code" href="../../d3/d4/struct__USER__API__MSG.html">USER_API_MSG</a> m;
00037     <a class="code" href="../../d6/d5/struct__ACTIVATEDEBUGGERMSG.html">PACTIVATEDEBUGGERMSG</a> a = &amp;m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o15">u</a>.ActivateDebugger;
00038     <a class="code" href="../../d0/d4/struct__EPROCESS.html">PEPROCESS</a> Process;
00039     HANDLE hDebugPort;
00040     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00041     <span class="keywordflow">if</span> (fsModifiers &amp; MOD_CONTROL) {
00042 <span class="preprocessor">#if DBG</span>
00043 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (RipOutput(0, RIP_WARNING, <span class="stringliteral">"User debugger"</span>, 0, <span class="stringliteral">"Debug prompt"</span>, NULL)) {
00044             DbgBreakPoint();
00045         }
00046 <span class="preprocessor">#endif</span>
00047 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00048     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fsModifiers &amp; MOD_SHIFT) {
00049 
00050         <span class="comment">/*</span>
00051 <span class="comment">         * Bail out if the process is not being debugged.</span>
00052 <span class="comment">         */</span>
00053         <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a299">gpepCSRSS</a>-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o18">DebugPort</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00054             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00055 
00056         a-&gt;<a class="code" href="../../d6/d5/struct__ACTIVATEDEBUGGERMSG.html#o0">ClientId</a>.UniqueProcess = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a299">gpepCSRSS</a>-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o7">UniqueProcessId</a>;
00057     } <span class="keywordflow">else</span> {
00058 
00059         <span class="keywordflow">if</span> ((<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>))
00060             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00061 
00062         a-&gt;<a class="code" href="../../d6/d5/struct__ACTIVATEDEBUGGERMSG.html#o0">ClientId</a> = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a29">gpqForeground</a>-&gt;<a class="code" href="../../d7/d4/structtagQ.html#o5">ptiKeyboard</a>-&gt;pEThread-&gt;Cid;
00063 
00064         <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
00065         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d4/d1/userk_8h.html#a1258">LockProcessByClientId</a>(a-&gt;<a class="code" href="../../d6/d5/struct__ACTIVATEDEBUGGERMSG.html#o0">ClientId</a>.UniqueProcess, &amp;Process);
00066         <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
00067 
00068         <span class="comment">/*</span>
00069 <span class="comment">         * Bail out if the process is not being debugged or the process id</span>
00070 <span class="comment">         * is invalid.</span>
00071 <span class="comment">         */</span>
00072         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status))
00073             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00074         
00075         hDebugPort = Process-&gt;<a class="code" href="../../d0/d4/struct__EPROCESS.html#o18">DebugPort</a>;
00076         <a class="code" href="../../d4/d1/userk_8h.html#a517">UnlockProcess</a>(Process);
00077 
00078         <span class="keywordflow">if</span> (hDebugPort == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00079             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00080     }
00081 
00082     <span class="comment">/*</span>
00083 <span class="comment">     * Send the datagram to CSR</span>
00084 <span class="comment">     */</span>
00085     <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a243">CsrApiPort</a> != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00086         ArgLength = <span class="keyword">sizeof</span>(*a);
00087         ArgLength |= (ArgLength &lt;&lt; 16);
00088         ArgLength +=     ((<span class="keyword">sizeof</span>( CSR_API_MSG ) - <span class="keyword">sizeof</span>( m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o15">u</a> )) &lt;&lt; 16) |
00089                         (FIELD_OFFSET( CSR_API_MSG, u ) - <span class="keyword">sizeof</span>( m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o0">h</a> ));
00090         m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o0">h</a>.u1.Length = ArgLength;
00091         m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o0">h</a>.u2.ZeroInit = 0;
00092         m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o1">CaptureBuffer</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00093         m.<a class="code" href="../../d3/d4/struct__USER__API__MSG.html#o2">ApiNumber</a> = CSR_MAKE_API_NUMBER( USERSRV_SERVERDLL_INDEX,
00094                                            UserpActivateDebugger);
00095         <a class="code" href="../../d7/d1/usersrv_8h.html#a37">LeaveCrit</a>();
00096         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d6/d7/lpcsend_8c.html#a2">LpcRequestPort</a>(CsrApiPort, (PPORT_MESSAGE)&amp;m);
00097         <a class="code" href="../../d7/d1/usersrv_8h.html#a36">EnterCrit</a>();
00098         UserAssert(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00099     }
00100 
00101     <span class="comment">/*</span>
00102 <span class="comment">     * Don't eat this event unless we are breaking into CSR! Since we have</span>
00103 <span class="comment">     * choosen an arbitrary hot key like F12 for the debug key, we need to</span>
00104 <span class="comment">     * pass on the key to the application, or apps that want this key would</span>
00105 <span class="comment">     * never see it. If we had an api for installing a debug hot key</span>
00106 <span class="comment">     * (export or MOD_DEBUG flag to RegisterHotKey()), then it would be ok</span>
00107 <span class="comment">     * to eat because the user selected the hot key. But it is not ok to</span>
00108 <span class="comment">     * eat it as long as we've picked an arbitrary hot key. scottlu.</span>
00109 <span class="comment">     */</span>
00110     <span class="keywordflow">if</span> (fsModifiers &amp; MOD_SHIFT)
00111         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00112     <span class="keywordflow">else</span>
00113         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00114 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:25 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
