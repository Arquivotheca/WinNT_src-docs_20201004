<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ghandler.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>ghandler.c</h1><a href="../../d0/d6/ghandler_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">/*++</span>
00002 <span class="comment"></span>
00003 <span class="comment">Copyright (c) 1993  Digital Equipment Corporation</span>
00004 <span class="comment"></span>
00005 <span class="comment">Module Name:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    ghandler.c</span>
00008 <span class="comment"></span>
00009 <span class="comment">Abstract:</span>
00010 <span class="comment"></span>
00011 <span class="comment">    This module implements the C specific exception handler that provides</span>
00012 <span class="comment">    structured exception handling for code generated by the GEM compiler.</span>
00013 <span class="comment"></span>
00014 <span class="comment">Author:</span>
00015 <span class="comment"></span>
00016 <span class="comment">    John Parks (parks) 12-Jan-1993</span>
00017 <span class="comment">    Thomas Van Baak (tvb) 28-Jan-1993</span>
00018 <span class="comment"></span>
00019 <span class="comment">Environment:</span>
00020 <span class="comment"></span>
00021 <span class="comment">    Any mode.</span>
00022 <span class="comment"></span>
00023 <span class="comment">Revision History:</span>
00024 <span class="comment"></span>
00025 <span class="comment">--*/</span>
00026 
00027 <span class="preprocessor">#include "nt.h"</span>
00028 
00029 <span class="comment">//</span>
00030 <span class="comment">// Define procedure prototypes for exception filter and termination handler</span>
00031 <span class="comment">// execution routines defined in jmpunwnd.s.</span>
00032 <span class="comment">//</span>
00033 
00034 LONG
00035 <a class="code" href="../../d3/d6/ppc_2chandler_8c.html#a0">__C_ExecuteExceptionFilter</a> (
00036     PEXCEPTION_POINTERS ExceptionPointers,
00037     EXCEPTION_FILTER ExceptionFilter,
00038     ULONG_PTR EstablisherFrame
00039     );
00040 
00041 ULONG_PTR
00042 <a class="code" href="../../d3/d6/ppc_2chandler_8c.html#a1">__C_ExecuteTerminationHandler</a> (
00043     BOOLEAN AbnormalTermination,
00044     TERMINATION_HANDLER TerminationHandler,
00045     ULONG_PTR EstablisherFrame
00046     );
00047 
00048 <span class="comment">//</span>
00049 <span class="comment">// Define local procedure prototypes.</span>
00050 <span class="comment">//</span>
00051 
00052 EXCEPTION_DISPOSITION
00053 <a class="code" href="../../d0/d6/ghandler_8c.html#a5">_OtsCSpecificHandler</a> (
00054     IN PEXCEPTION_RECORD ExceptionRecord,
00055     IN PVOID EstablisherFrame,
00056     IN OUT PCONTEXT ContextRecord,
00057     IN OUT PDISPATCHER_CONTEXT DispatcherContext
00058     );
00059 
00060 ULONG_PTR
00061 <a class="code" href="../../d0/d6/ghandler_8c.html#a6">_OtsLocalFinallyUnwind</a> (
00062     IN PSEH_CONTEXT SehContext,
00063     IN PSEH_BLOCK TargetSeb,
00064     IN PVOID RealFramePointer
00065     );
00066 
00067 <span class="comment">//</span>
00068 <span class="comment">// Define local macros.</span>
00069 <span class="comment">//</span>
00070 
<a name="l00071"></a><a class="code" href="../../d0/d6/ghandler_8c.html#a0">00071</a> <span class="preprocessor">#define IS_EXCEPT(Seb) ((Seb)-&gt;JumpTarget != 0)</span>
<a name="l00072"></a><a class="code" href="../../d0/d6/ghandler_8c.html#a1">00072</a> <span class="preprocessor"></span><span class="preprocessor">#define IS_FINALLY(Seb) ((Seb)-&gt;JumpTarget == 0)</span>
00073 <span class="preprocessor"></span>
00074 <span class="comment">//</span>
00075 <span class="comment">// Initialize an exception record for the unwind with the SEB of the target</span>
00076 <span class="comment">// included as one information parameter. This is done so that the target</span>
00077 <span class="comment">// frame of the unwind may execute all the finally handlers necessary given</span>
00078 <span class="comment">// the SEB pointer at the unwind target.</span>
00079 <span class="comment">//</span>
00080 
<a name="l00081"></a><a class="code" href="../../d0/d6/ghandler_8c.html#a2">00081</a> <span class="preprocessor">#define MODIFY_UNWIND_EXCEPTION_RECORD(ExceptionRecord, Seb) { \</span>
00082 <span class="preprocessor">    ExceptionRecord-&gt;ExceptionCode = STATUS_UNWIND; \</span>
00083 <span class="preprocessor">    ExceptionRecord-&gt;ExceptionFlags = EXCEPTION_UNWINDING; \</span>
00084 <span class="preprocessor">    ExceptionRecord-&gt;ExceptionRecord = NULL; \</span>
00085 <span class="preprocessor">    ExceptionRecord-&gt;ExceptionAddress = 0; \</span>
00086 <span class="preprocessor">    ExceptionRecord-&gt;NumberParameters = 1; \</span>
00087 <span class="preprocessor">    ExceptionRecord-&gt;ExceptionInformation[0] = (ULONG_PTR)(Seb); \</span>
00088 <span class="preprocessor">    }</span>
00089 <span class="preprocessor"></span>
00090 EXCEPTION_DISPOSITION
<a name="l00091"></a><a class="code" href="../../d0/d6/ghandler_8c.html#a5">00091</a> <a class="code" href="../../d0/d6/ghandler_8c.html#a5">_OtsCSpecificHandler</a> (
00092     IN PEXCEPTION_RECORD ExceptionRecord,
00093     IN PVOID EstablisherFrame,
00094     IN OUT PCONTEXT ContextRecord,
00095     IN OUT PDISPATCHER_CONTEXT DispatcherContext
00096     )
00097 
00098 <span class="comment">/*++</span>
00099 <span class="comment"></span>
00100 <span class="comment">Routine Description:</span>
00101 <span class="comment"></span>
00102 <span class="comment">    This function walks up the list of SEB's associated with the specified</span>
00103 <span class="comment">    procedure and calls except filters and finally handlers as necessary.</span>
00104 <span class="comment"></span>
00105 <span class="comment">    It is called in two different contexts:</span>
00106 <span class="comment">        (i)  by the exception dispatcher after an exception is raised</span>
00107 <span class="comment">        (ii) by the unwinder during an unwind operation</span>
00108 <span class="comment"></span>
00109 <span class="comment">    In the first case, is searches the SEB list for except filters to evaluate.</span>
00110 <span class="comment">    In the second case, it searches for finally handlers to execute.</span>
00111 <span class="comment"></span>
00112 <span class="comment">Arguments:</span>
00113 <span class="comment"></span>
00114 <span class="comment">    ExceptionRecord - Supplies a pointer to an exception record.</span>
00115 <span class="comment"></span>
00116 <span class="comment">    EstablisherFrame - Supplies a (virtual frame) pointer to the frame of the</span>
00117 <span class="comment">        establisher function.</span>
00118 <span class="comment"></span>
00119 <span class="comment">    ContextRecord - Supplies a pointer to a context record.</span>
00120 <span class="comment"></span>
00121 <span class="comment">    DispatcherContext - Supplies a pointer to the exception dispatcher or</span>
00122 <span class="comment">        unwind dispatcher context.</span>
00123 <span class="comment"></span>
00124 <span class="comment">Return Value:</span>
00125 <span class="comment"></span>
00126 <span class="comment">    If the exception is handled by one of the exception filter routines, then</span>
00127 <span class="comment">    there is no return from this routine and RtlUnwind is called. Otherwise,</span>
00128 <span class="comment">    an exception disposition value of continue execution or continue search is</span>
00129 <span class="comment">    returned.</span>
00130 <span class="comment"></span>
00131 <span class="comment">Notes:</span>
00132 <span class="comment">    In context (i) there are 3 possibilities:</span>
00133 <span class="comment"></span>
00134 <span class="comment">        (a) If an exception filter returns a value greater that 0 (meaning</span>
00135 <span class="comment">            that the associated handler should be invoked) there is no</span>
00136 <span class="comment">            return from this function. RtlUnwind is called to unwind the</span>
00137 <span class="comment">            stack to the exception handler corresponding to that filter.</span>
00138 <span class="comment"></span>
00139 <span class="comment">        (b) If an exception filter returns a value less than 0 (meaning</span>
00140 <span class="comment">            that the exception should be dismissed), this routine returns</span>
00141 <span class="comment">            value ExceptionContinueExecution.</span>
00142 <span class="comment"></span>
00143 <span class="comment">        (c) If every filter returns value 0 (meaning that the search for a</span>
00144 <span class="comment">            handler should continue elsewhere), this function returns</span>
00145 <span class="comment">            ExceptionContinueSearch.</span>
00146 <span class="comment"></span>
00147 <span class="comment">    In context (ii) there are 2 possibilities:</span>
00148 <span class="comment"></span>
00149 <span class="comment">        (d) If no branches are detected out of finally handlers, this</span>
00150 <span class="comment">            function returns ExceptionContinueSearch.</span>
00151 <span class="comment"></span>
00152 <span class="comment">        (e) If a branch is detected out of a finally handler, there is no</span>
00153 <span class="comment">            return from this routine. RtlUnwind is called to unwind to the</span>
00154 <span class="comment">            branch target (and cancel the current unwind).</span>
00155 <span class="comment"></span>
00156 <span class="comment">    There may be long jumps out of both except filters and finally handlers</span>
00157 <span class="comment">    in which case this routine will be peeled off the stack without returning.</span>
00158 <span class="comment"></span>
00159 <span class="comment">--*/</span>
00160 
00161 {
00162 
00163     ULONG_PTR ContinuationAddress;
00164     EXCEPTION_FILTER ExceptionFilter;
00165     PVOID ExceptionHandler;
00166     EXCEPTION_POINTERS ExceptionPointers;
00167     LONG FilterValue;
00168     ULONG_PTR RealFramePointer;
00169     PSEH_BLOCK Seb;
00170     PSEH_CONTEXT SehContext;
00171     PSEH_BLOCK TargetSeb;
00172     TERMINATION_HANDLER TerminationHandler;
00173 
00174     <span class="comment">//</span>
00175     <span class="comment">// Get the address of the SEH context which is at some negative offset</span>
00176     <span class="comment">// from the virtual frame pointer. For GEM, the handler data field of</span>
00177     <span class="comment">// the function entry contains that offset. The current SEB pointer and</span>
00178     <span class="comment">// the RFP (static link) are obtained from the SEH context.</span>
00179     <span class="comment">//</span>
00180 
00181     SehContext = (PSEH_CONTEXT)((ULONG_PTR)EstablisherFrame +
00182         (LONG_PTR)DispatcherContext-&gt;FunctionEntry-&gt;HandlerData);
00183     RealFramePointer = SehContext-&gt;RealFramePointer;
00184 
00185     <span class="comment">//</span>
00186     <span class="comment">// If this is a dispatching context, walk up the list of SEBs evaluating</span>
00187     <span class="comment">// except filters.</span>
00188     <span class="comment">//</span>
00189 
00190     <span class="keywordflow">if</span> (IS_DISPATCHING(ExceptionRecord-&gt;ExceptionFlags)) {
00191 
00192         <span class="comment">//</span>
00193         <span class="comment">// Set up the ExceptionPointers structure that is used by except</span>
00194         <span class="comment">// filters to obtain data for the GetExceptionInformation intrinsic</span>
00195         <span class="comment">// function. Copy the current SEB pointer into a local variable</span>
00196         <span class="comment">// because the real SEB pointer is only modified in unwind contexts.</span>
00197         <span class="comment">//</span>
00198 
00199         ExceptionPointers.ExceptionRecord = ExceptionRecord;
00200         ExceptionPointers.ContextRecord = ContextRecord;
00201 
00202         <span class="keywordflow">for</span> (Seb = SehContext-&gt;CurrentSeb; Seb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>; Seb = Seb-&gt;ParentSeb) {
00203             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d6/ghandler_8c.html#a0">IS_EXCEPT</a>(Seb)) {
00204 
00205                 <span class="comment">//</span>
00206                 <span class="comment">// This is an except filter. Get the addresses of the filter</span>
00207                 <span class="comment">// and exception handler from the SEB, then call the except</span>
00208                 <span class="comment">// filter.</span>
00209                 <span class="comment">//</span>
00210 
00211                 ExceptionFilter = (EXCEPTION_FILTER)Seb-&gt;HandlerAddress;
00212                 ExceptionHandler = (PVOID)Seb-&gt;JumpTarget;
00213 
00214                 FilterValue = <a class="code" href="../../d3/d6/ppc_2chandler_8c.html#a0">__C_ExecuteExceptionFilter</a>(&amp;ExceptionPointers,
00215                                                          ExceptionFilter,
00216                                                          RealFramePointer);
00217 
00218                 <span class="comment">//</span>
00219                 <span class="comment">// If the except filter &lt; 0, dismiss the exception. If &gt; 0,</span>
00220                 <span class="comment">// store the exception code on the stack for the except</span>
00221                 <span class="comment">// handler, modify the given ExceptionRecord so that finally</span>
00222                 <span class="comment">// handlers will be called properly during the unwind, then</span>
00223                 <span class="comment">// unwind down to the except handler. If = 0, resume the</span>
00224                 <span class="comment">// search for except filters.</span>
00225                 <span class="comment">//</span>
00226 
00227                 <span class="keywordflow">if</span> (FilterValue &lt; 0) {
00228                     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a36">ExceptionContinueExecution</a>;
00229 
00230                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (FilterValue &gt; 0) {
00231                     SehContext-&gt;ExceptionCode = ExceptionRecord-&gt;ExceptionCode;
00232                     <a class="code" href="../../d0/d6/ghandler_8c.html#a2">MODIFY_UNWIND_EXCEPTION_RECORD</a>(ExceptionRecord,
00233                                                    Seb-&gt;ParentSeb);
00234                     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a12">RtlUnwind2</a>(EstablisherFrame,
00235                                ExceptionHandler,
00236                                ExceptionRecord,
00237                                0,
00238                                ContextRecord);
00239                 }
00240             }
00241         }
00242 
00243     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!IS_TARGET_UNWIND(ExceptionRecord-&gt;ExceptionFlags)) {
00244 
00245         <span class="comment">//</span>
00246         <span class="comment">// This is an unwind but is not the target frame. Since the function</span>
00247         <span class="comment">// is being terminated, finally handlers for all try bodies that are</span>
00248         <span class="comment">// presently in scope must be executed. Walk up the SEB list all the</span>
00249         <span class="comment">// way to the top executing finally handlers. This corresponds to</span>
00250         <span class="comment">// exiting all try bodies that are presently in scope.</span>
00251         <span class="comment">//</span>
00252 
00253         <span class="keywordflow">while</span> (SehContext-&gt;CurrentSeb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00254 
00255             <span class="comment">//</span>
00256             <span class="comment">// Get the address of the SEB and then update the SEH context.</span>
00257             <span class="comment">//</span>
00258 
00259             Seb = SehContext-&gt;CurrentSeb;
00260             SehContext-&gt;CurrentSeb = Seb-&gt;ParentSeb;
00261 
00262             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d6/ghandler_8c.html#a1">IS_FINALLY</a>(Seb)) {
00263 
00264                 <span class="comment">//</span>
00265                 <span class="comment">// This is a finally handler. Get the address of the handler</span>
00266                 <span class="comment">// from the SEB and call the finally handler.</span>
00267                 <span class="comment">//</span>
00268 
00269                 TerminationHandler = (TERMINATION_HANDLER)Seb-&gt;HandlerAddress;
00270                 ContinuationAddress =
00271                     <a class="code" href="../../d3/d6/ppc_2chandler_8c.html#a1">__C_ExecuteTerminationHandler</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00272                                                   TerminationHandler,
00273                                                   RealFramePointer);
00274 
00275                 <span class="comment">//</span>
00276                 <span class="comment">// If the finally handler returns a non-zero result, there</span>
00277                 <span class="comment">// was a branch out of the handler (to that address) and this</span>
00278                 <span class="comment">// routine should unwind to that target.</span>
00279                 <span class="comment">//</span>
00280 
00281                 <span class="keywordflow">if</span> (ContinuationAddress != 0) {
00282                     <a class="code" href="../../d0/d6/ghandler_8c.html#a2">MODIFY_UNWIND_EXCEPTION_RECORD</a>(ExceptionRecord,
00283                                                    SehContext-&gt;CurrentSeb);
00284                     <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a11">RtlUnwind</a>(EstablisherFrame,
00285                               (PVOID)ContinuationAddress,
00286                               ExceptionRecord,
00287                               0);
00288                 }
00289             }
00290         }
00291 
00292     } <span class="keywordflow">else</span> {
00293 
00294         <span class="comment">//</span>
00295         <span class="comment">// This is the target frame of an unwind. Since the target may be</span>
00296         <span class="comment">// in a different try scope than the one defined by the current SEB</span>
00297         <span class="comment">// pointer, finally handlers between the two scopes must execute.</span>
00298         <span class="comment">// Walk up the SEB list from the current SEB to the target SEB and</span>
00299         <span class="comment">// execute all finally handlers encountered.</span>
00300         <span class="comment">//</span>
00301 
00302         TargetSeb = (PSEH_BLOCK)ExceptionRecord-&gt;ExceptionInformation[0];
00303         ContinuationAddress = <a class="code" href="../../d0/d6/ghandler_8c.html#a6">_OtsLocalFinallyUnwind</a>(SehContext,
00304                                                      TargetSeb,
00305                                                      (PVOID)RealFramePointer);
00306         <span class="keywordflow">if</span> (ContinuationAddress != 0) {
00307 
00308             <span class="comment">//</span>
00309             <span class="comment">// A non-zero result indicates there was a branch out of a</span>
00310             <span class="comment">// finally handler that was being executed during the unwind.</span>
00311             <span class="comment">// This routine should unwind to that address.</span>
00312             <span class="comment">//</span>
00313 
00314             <a class="code" href="../../d0/d6/ghandler_8c.html#a2">MODIFY_UNWIND_EXCEPTION_RECORD</a>(ExceptionRecord,
00315                                            SehContext-&gt;CurrentSeb);
00316             <a class="code" href="../../d9/d9/ppc_2exdsptch_8c.html#a11">RtlUnwind</a>(EstablisherFrame,
00317                       (PVOID)ContinuationAddress,
00318                       ExceptionRecord,
00319                       0);
00320         }
00321     }
00322 
00323     <span class="comment">//</span>
00324     <span class="comment">// Continue search for exception or termination handlers.</span>
00325     <span class="comment">//</span>
00326 
00327     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a37">ExceptionContinueSearch</a>;
00328 }
00329 
00330 ULONG_PTR
<a name="l00331"></a><a class="code" href="../../d0/d6/ghandler_8c.html#a6">00331</a> <a class="code" href="../../d0/d6/ghandler_8c.html#a6">_OtsLocalFinallyUnwind</a> (
00332     IN PSEH_CONTEXT SehContext,
00333     IN PSEH_BLOCK TargetSeb,
00334     IN PVOID RealFramePointer
00335     )
00336 
00337 <span class="comment">/*++</span>
00338 <span class="comment"></span>
00339 <span class="comment">Routine Description:</span>
00340 <span class="comment"></span>
00341 <span class="comment">    This function walks up the SEB tree of the current procedure from the</span>
00342 <span class="comment">    current SEB to the target SEB and executes all the finally handlers it</span>
00343 <span class="comment">    encounters.</span>
00344 <span class="comment"></span>
00345 <span class="comment">    Calls to this function are inserted into user code by the compiler when</span>
00346 <span class="comment">    there are branches out of guarded regions that may require finally</span>
00347 <span class="comment">    handlers to execute.</span>
00348 <span class="comment"></span>
00349 <span class="comment">    This function is also called from _OtsCSpecificHandler when the target</span>
00350 <span class="comment">    frame is reached during an unwind operation. There may be finally handlers</span>
00351 <span class="comment">    that should execute before resuming execution at the unwind target.</span>
00352 <span class="comment"></span>
00353 <span class="comment">Arguments:</span>
00354 <span class="comment"></span>
00355 <span class="comment">    SehContext - Supplies the address of the SEH context structure which is</span>
00356 <span class="comment">        located in the stack frame.</span>
00357 <span class="comment"></span>
00358 <span class="comment">    TargetSeb - Supplies the address of the SEB corresponding to the branch</span>
00359 <span class="comment">        target address.</span>
00360 <span class="comment"></span>
00361 <span class="comment">    RealFramePointer - Supplies the (real frame) pointer of the establisher</span>
00362 <span class="comment">        frame, which is the current stack frame. This is used to set up the</span>
00363 <span class="comment">        static link if a finally handler is invoked.</span>
00364 <span class="comment"></span>
00365 <span class="comment">Return Value:</span>
00366 <span class="comment"></span>
00367 <span class="comment">    If a branch out of a finally handler is detected, the function value is</span>
00368 <span class="comment">    the address of the branch target. Otherwise, the function value is zero.</span>
00369 <span class="comment"></span>
00370 <span class="comment">--*/</span>
00371 
00372 {
00373 
00374     ULONG_PTR ContinuationAddress;
00375     BOOLEAN Nested;
00376     PSEH_BLOCK Seb;
00377     TERMINATION_HANDLER TerminationHandler;
00378 
00379     <span class="comment">//</span>
00380     <span class="comment">// If the SEB pointers are the same, no finally handlers need to execute.</span>
00381     <span class="comment">// The branch is to a target location in the same guarded scope.</span>
00382     <span class="comment">//</span>
00383 
00384     <span class="keywordflow">if</span> (SehContext-&gt;CurrentSeb == TargetSeb) {
00385         <span class="keywordflow">return</span> 0;
00386     }
00387 
00388     <span class="comment">//</span>
00389     <span class="comment">// If the current SEB scope is not nested within the target SEB scope, no</span>
00390     <span class="comment">// finally handlers need to execute. Reset the current SEB pointer to the</span>
00391     <span class="comment">// target SEB pointer and return.</span>
00392     <span class="comment">//</span>
00393 
00394     Nested = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00395     Seb = SehContext-&gt;CurrentSeb;
00396 
00397     <span class="keywordflow">while</span> (Seb != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00398         Seb = Seb-&gt;ParentSeb;
00399         <span class="keywordflow">if</span> (Seb == TargetSeb) {
00400             Nested = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00401             <span class="keywordflow">break</span>;
00402         }
00403     }
00404     <span class="keywordflow">if</span> (Nested == <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) {
00405         SehContext-&gt;CurrentSeb = TargetSeb;
00406         <span class="keywordflow">return</span> 0;
00407     }
00408 
00409     <span class="comment">//</span>
00410     <span class="comment">// Walk up the list of SEB blocks executing finally handlers. If a branch</span>
00411     <span class="comment">// out of a finally is encountered along the way, return the target</span>
00412     <span class="comment">// address, otherwise return 0.</span>
00413     <span class="comment">//</span>
00414 
00415     <span class="keywordflow">while</span> (SehContext-&gt;CurrentSeb != TargetSeb) {
00416 
00417         <span class="comment">//</span>
00418         <span class="comment">// Get the address of the SEB and then update the SEH context.</span>
00419         <span class="comment">//</span>
00420 
00421         Seb = SehContext-&gt;CurrentSeb;
00422         SehContext-&gt;CurrentSeb = Seb-&gt;ParentSeb;
00423 
00424         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d6/ghandler_8c.html#a1">IS_FINALLY</a>(Seb)) {
00425             TerminationHandler = (TERMINATION_HANDLER)Seb-&gt;HandlerAddress;
00426             ContinuationAddress =
00427                 <a class="code" href="../../d3/d6/ppc_2chandler_8c.html#a1">__C_ExecuteTerminationHandler</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>,
00428                                               TerminationHandler,
00429                                               (ULONG_PTR)RealFramePointer);
00430             <span class="keywordflow">if</span> (ContinuationAddress != 0) {
00431                 <span class="keywordflow">return</span> ContinuationAddress;
00432             }
00433         }
00434     }
00435     <span class="keywordflow">return</span> 0;
00436 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:40:13 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
