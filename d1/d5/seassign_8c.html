<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: seassign.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>seassign.c File Reference</h1><code>#include "<a class="el" href="../../d7/d5/sep_8h-source.html">sep.h</a>"</code><br>
<code>#include "<a class="el" href="../../d9/d2/tokenp_8h-source.html">tokenp.h</a>"</code><br>
<code>#include "sertlp.h"</code><br>
<code>#include "zwapi.h"</code><br>
<code>#include "nturtl.h"</code><br>

<p>
<a href="../../d2/d4/seassign_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/seassign_8c.html#a0">SepInheritAcl</a> (IN PACL Acl, IN BOOLEAN IsDirectoryObject, IN PSID OwnerSid, IN PSID GroupSid, IN PSID ServerSid OPTIONAL, IN PSID ClientSid OPTIONAL, IN PGENERIC_MAPPING GenericMapping, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, OUT PACL *NewAcl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/seassign_8c.html#a1">SeAssignSecurity</a> (IN PSECURITY_DESCRIPTOR ParentDescriptor OPTIONAL, IN PSECURITY_DESCRIPTOR ExplicitDescriptor OPTIONAL, OUT PSECURITY_DESCRIPTOR *NewDescriptor, IN BOOLEAN IsDirectoryObject, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext, IN PGENERIC_MAPPING GenericMapping, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/seassign_8c.html#a2">SeAssignSecurityEx</a> (IN PSECURITY_DESCRIPTOR ParentDescriptor OPTIONAL, IN PSECURITY_DESCRIPTOR ExplicitDescriptor OPTIONAL, OUT PSECURITY_DESCRIPTOR *NewDescriptor, IN GUID *ObjectType OPTIONAL, IN BOOLEAN IsDirectoryObject, IN ULONG AutoInheritFlags, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectContext, IN PGENERIC_MAPPING GenericMapping, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/seassign_8c.html#a3">SeDeassignSecurity</a> (IN OUT PSECURITY_DESCRIPTOR *SecurityDescriptor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/seassign_8c.html#a4">SepInheritAcl</a> (IN PACL Acl, IN BOOLEAN IsDirectoryObject, IN PSID ClientOwnerSid, IN PSID ClientGroupSid, IN PSID ServerOwnerSid OPTIONAL, IN PSID ServerGroupSid OPTIONAL, IN PGENERIC_MAPPING GenericMapping, IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a> PoolType, OUT PACL *NewAcl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/seassign_8c.html#a5">SeAssignWorldSecurityDescriptor</a> (IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN OUT PULONG Length, IN PSECURITY_INFORMATION SecurityInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/seassign_8c.html#a6">SepDumpSecurityDescriptor</a> (IN PSECURITY_DESCRIPTOR SecurityDescriptor, IN PSZ TitleString)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/seassign_8c.html#a7">SepPrintAcl</a> (IN PACL Acl)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/seassign_8c.html#a8">SepPrintSid</a> (IN PSID Sid)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/seassign_8c.html#a9">SepDumpTokenInfo</a> (IN PACCESS_TOKEN <a class="el" href="../../d2/d1/cttoken_8c.html#a28">Token</a>)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/seassign_8c.html#a10">SepSidTranslation</a> (PSID Sid, PSTRING AccountName)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a1" doxytag="seassign.c::SeAssignSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeAssignSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR ParentDescriptor&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR ExplicitDescriptor&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname" nowrap> <em>NewDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>IsDirectoryObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00089">89</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00650">SepDumpSecurityDescriptor()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d1/cmparse2_8c-source.html#l00226">CmpDoCreateChild()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01574">ObAssignSecurity()</a>, <a class="el" href="../../d2/d5/tse_8c-source.html#l00360">TestAssignSecurity()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00101                    :
00102 
00103     This routine assumes privilege checking HAS NOT yet been performed
00104     and so will be performed by <span class="keyword">this</span> routine.
00105 
00106     This <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to build a security descriptor <span class="keywordflow">for</span> a <span class="keyword">new</span> object
00107     given <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of its parent directory and any originally
00108     requested security <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.  The <span class="keyword">final</span> security descriptor
00109     returned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller may contain a mix of information, some explicitly
00110     provided other from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object's parent.
00111 
00112 
00113     See <a class="code" href="../../d8/d6/sertl_8c.html#a76">RtlpNewSecurityObject</a> <span class="keywordflow">for</span> a descriptor of how <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> NewDescriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00114     built.
00115 
00116 
00117 Arguments:
00118 
00119     ParentDescriptor - Optionally supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00120         parent directory under which <span class="keyword">this</span> <span class="keyword">new</span> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being created.
00121 
00122     ExplicitDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security
00123         descriptor as specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be applied to
00124         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object.
00125 
00126     NewDescriptor - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> actual security descriptor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span>
00127         object that has been modified according to above rules.
00128 
00129     IsDirectoryObject - Specifies <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> itself a directory
00130         object.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a container of other
00131         objects.
00132 
00133     SubjectContext - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security context of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject creating <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00134         object. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to retrieve <span class="keywordflow">default</span> security information <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00135         <span class="keyword">new</span> object, such as <span class="keywordflow">default</span> owner, primary group, and discretionary
00136         access <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a>.
00137 
00138     GenericMapping - Supplies a pointer to an array of access mask values
00139         denoting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping between each generic right to non-generic rights.
00140 
00141     PoolType - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to use to when allocating a <span class="keyword">new</span>
00142         security descriptor.
00143 
00144 Return Value:
00145 
00146     STATUS_SUCCESS - indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation was successful.
00147 
00148     STATUS_INVALID_OWNER - The owner SID provided as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00149         target security descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not one <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> authorized
00150         to assign as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of an object.
00151 
00152     STATUS_PRIVILEGE_NOT_HELD - The caller does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege
00153         necessary to explicitly assign <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified system ACL.
00154         <a class="code" href="../../d0/d5/se_8h.html#a85">SeSecurityPrivilege</a> privilege <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to explicitly assign
00155         system ACLs to objects.
00156 --*/
00157 
00158 {
00159     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00160     ULONG AutoInherit = 0;
00161     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00162 
00163 <span class="preprocessor">#if DBG</span>
00164 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( ExplicitDescriptor) ) {
00165         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( ExplicitDescriptor,
00166                                    <span class="stringliteral">"\nSeAssignSecurity: Input security descriptor = \n"</span>
00167                                  );
00168     }
00169 
00170     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( ParentDescriptor )) {
00171         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( ParentDescriptor,
00172                                    <span class="stringliteral">"\nSeAssignSecurity: Parent security descriptor = \n"</span>
00173                                  );
00174     }
00175 <span class="preprocessor">#endif // DBG</span>
00176 <span class="preprocessor"></span>
00177     <span class="comment">//</span>
00178     <span class="comment">// If the Parent SD was created via AutoInheritance,</span>
00179     <span class="comment">//  and this object is being created with no explicit descriptor,</span>
00180     <span class="comment">//  then we can safely create this object as AutoInherit.</span>
00181     <span class="comment">//</span>
00182 
00183     <span class="keywordflow">if</span> ( ParentDescriptor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00184 
00185         <span class="keywordflow">if</span> ( (ExplicitDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00186               (((PISECURITY_DESCRIPTOR)ExplicitDescriptor)-&gt;Control &amp; SE_DACL_PRESENT) == 0 ) &amp;&amp;
00187              (((PISECURITY_DESCRIPTOR)ParentDescriptor)-&gt;Control &amp; SE_DACL_AUTO_INHERITED) != 0 ) {
00188             AutoInherit |= SEF_DACL_AUTO_INHERIT;
00189         }
00190 
00191         <span class="keywordflow">if</span> ( (ExplicitDescriptor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ||
00192              (((PISECURITY_DESCRIPTOR)ExplicitDescriptor)-&gt;Control &amp; SE_SACL_PRESENT) == 0 ) &amp;&amp;
00193              (((PISECURITY_DESCRIPTOR)ParentDescriptor)-&gt;Control &amp; SE_SACL_AUTO_INHERITED) != 0 ) {
00194             AutoInherit |= SEF_SACL_AUTO_INHERIT;
00195         }
00196 
00197     }
00198 
00199 
00200     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a76">RtlpNewSecurityObject</a> (
00201                     ParentDescriptor OPTIONAL,
00202                     ExplicitDescriptor OPTIONAL,
00203                     NewDescriptor,
00204                     NULL,   <span class="comment">// No object type</span>
00205                     IsDirectoryObject,
00206                     AutoInherit,
00207                     (HANDLE) SubjectContext,
00208                     GenericMapping );
00209 
00210 <span class="preprocessor">#if DBG</span>
00211 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00212         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( *NewDescriptor,
00213                                    <span class="stringliteral">"SeAssignSecurity: Final security descriptor = \n"</span>
00214                                  );
00215     }
00216 <span class="preprocessor">#endif</span>
00217 <span class="preprocessor"></span>
00218     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00219 
00220 
00221     <span class="comment">// RtlpNewSecurityObject always uses PagedPool.</span>
00222     UNREFERENCED_PARAMETER( PagedPool );
00223 
00224 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="seassign.c::SeAssignSecurityEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeAssignSecurityEx           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR ParentDescriptor&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_DESCRIPTOR ExplicitDescriptor&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname" nowrap> <em>NewDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN GUID *ObjectType&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>IsDirectoryObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>AutoInheritFlags</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00228">228</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l09057">RtlpNewSecurityObject()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00650">SepDumpSecurityDescriptor()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00242                    :
00243 
00244     This routine assumes privilege checking HAS NOT yet been performed
00245     and so will be performed by <span class="keyword">this</span> routine.
00246 
00247     This <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to build a security descriptor <span class="keywordflow">for</span> a <span class="keyword">new</span> object
00248     given <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of its parent directory and any originally
00249     requested security <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object.  The <span class="keyword">final</span> security descriptor
00250     returned to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller may contain a mix of information, some explicitly
00251     provided other from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object's parent.
00252 
00253 
00254     See <a class="code" href="../../d8/d6/sertl_8c.html#a76">RtlpNewSecurityObject</a> <span class="keywordflow">for</span> a descriptor of how <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> NewDescriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00255     built.
00256 
00257 
00258 Arguments:
00259 
00260     ParentDescriptor - Optionally supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00261         parent directory under which <span class="keyword">this</span> <span class="keyword">new</span> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> being created.
00262 
00263     ExplicitDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security
00264         descriptor as specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be applied to
00265         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object.
00266 
00267     NewDescriptor - Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> actual security descriptor <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span>
00268         object that has been modified according to above rules.
00269 
00270     ObjectType - GUID of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> being created.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being
00271         created has no GUID associated with <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a>, then <span class="keyword">this</span> argument <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a>
00272         specified as <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>.
00273 
00274     IsDirectoryObject - Specifies <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> itself a directory
00275         object.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a container of other
00276         objects.
00277 
00278     AutoInheritFlags - Controls automatic inheritance of ACES from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Parent
00279         Descriptor.  Valid values are a bits mask of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> logical OR of
00280         one or more of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following bits:
00281 
00282         SEF_DACL_AUTO_INHERIT - If set, inherit ACEs from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00283             DACL ParentDescriptor are inherited to NewDescriptor in addition
00284             to any <span class="keyword">explicit</span> ACEs specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> CreatorDescriptor.
00285 
00286         SEF_SACL_AUTO_INHERIT - If set, inherit ACEs from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00287             SACL ParentDescriptor are inherited to NewDescriptor in addition
00288             to any <span class="keyword">explicit</span> ACEs specified by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> CreatorDescriptor.
00289 
00290         SEF_DEFAULT_DESCRIPTOR_FOR_OBJECT - If set, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> CreatorDescriptor
00291             <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordflow">default</span> descriptor <span class="keywordflow">for</span> ObjectType.  As such, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00292             CreatorDescriptor will be ignored <span class="keywordflow">if</span> any ObjectType specific
00293             ACEs are inherited from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> parent.  If no such ACEs are inherited,
00294             <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> CreatorDescriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> handled as though <span class="keyword">this</span> flag were not
00295             specified.
00296 
00297         SEF_AVOID_PRIVILEGE_CHECK - If set, no privilege checking <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> done by <span class="keyword">this</span>
00298             routine.  This flag <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> useful <span class="keywordflow">while</span> implementing automatic inheritance
00299             to avoid checking privileges on each child updated.
00300 
00301     SubjectContext - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security context of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject creating <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00302         object. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to retrieve <span class="keywordflow">default</span> security information <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00303         <span class="keyword">new</span> object, such as <span class="keywordflow">default</span> owner, primary group, and discretionary
00304         access <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a>.
00305 
00306     GenericMapping - Supplies a pointer to an array of access mask values
00307         denoting <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> mapping between each generic right to non-generic rights.
00308 
00309     PoolType - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> to use to when allocating a <span class="keyword">new</span>
00310         security descriptor.
00311 
00312 Return Value:
00313 
00314     STATUS_SUCCESS - indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> operation was successful.
00315 
00316     STATUS_INVALID_OWNER - The owner SID provided as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00317         target security descriptor <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> not one <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> authorized
00318         to assign as <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner of an object.
00319 
00320     STATUS_PRIVILEGE_NOT_HELD - The caller does not have <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privilege
00321         necessary to explicitly assign <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> specified system ACL.
00322         <a class="code" href="../../d0/d5/se_8h.html#a85">SeSecurityPrivilege</a> privilege <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> needed to explicitly assign
00323         system ACLs to objects.
00324 --*/
00325 
00326 {
00327     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00328     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00329 
00330 <span class="preprocessor">#if DBG</span>
00331 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( ExplicitDescriptor) ) {
00332         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( ExplicitDescriptor,
00333                                    <span class="stringliteral">"\nSeAssignSecurityEx: Input security descriptor = \n"</span>
00334                                  );
00335     }
00336 
00337     <span class="keywordflow">if</span> (ARGUMENT_PRESENT( ParentDescriptor )) {
00338         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( ParentDescriptor,
00339                                    <span class="stringliteral">"\nSeAssignSecurityEx: Parent security descriptor = \n"</span>
00340                                  );
00341     }
00342 <span class="preprocessor">#endif // DBG</span>
00343 <span class="preprocessor"></span>
00344 
00345     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a76">RtlpNewSecurityObject</a> (
00346                     ParentDescriptor OPTIONAL,
00347                     ExplicitDescriptor OPTIONAL,
00348                     NewDescriptor,
00349                     ObjectType,
00350                     IsDirectoryObject,
00351                     AutoInheritFlags,
00352                     (HANDLE) SubjectContext,
00353                     GenericMapping );
00354 
00355 <span class="preprocessor">#if DBG</span>
00356 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ( <a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status)) {
00357         <a class="code" href="../../d6/d6/sep_8h.html#a57">SepDumpSecurityDescriptor</a>( *NewDescriptor,
00358                                    <span class="stringliteral">"SeAssignSecurityEx: Final security descriptor = \n"</span>
00359                                  );
00360     }
00361 <span class="preprocessor">#endif</span>
00362 <span class="preprocessor"></span>
00363     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00364 
00365 
00366     <span class="comment">// RtlpNewSecurityObject always uses PagedPool.</span>
00367     UNREFERENCED_PARAMETER( PagedPool );
00368 
00369 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="seassign.c::SeAssignWorldSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeAssignWorldSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OUT PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSECURITY_INFORMATION&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityInformation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00529">529</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l02004">RtlCreateSecurityDescriptorRelative()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l00540">SeLengthSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01609">SeWorldSid</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d4/d0/objsup_8c-source.html#l00975">IopGetSetSecurityObject()</a>.
<p>
<pre class="fragment"><div>00537                    :
00538 
00539     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> called by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I/O system to properly initialize a
00540     security descriptor <span class="keywordflow">for</span> a FAT <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a>.  It will take a pointer to a
00541     buffer containing an emptry security descriptor, and create in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00542     buffer a <span class="keyword">self</span>-relative security descriptor with
00543 
00544         <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a> = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a8">WorldSid</a>,
00545 
00546         <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a> = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a8">WorldSid</a>.
00547 
00548     Thus, a FAT <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a9">file</a> <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> accessable to all.
00549 
00550 Arguments:
00551 
00552     SecurityDescriptor - Supplies a pointer to a buffer in which will be
00553         created a <span class="keyword">self</span>-relative security descriptor as described above.
00554 
00555     Length - The length in bytes of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> buffer.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> too
00556         small, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> will contain <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d0/d4/mrcf_8c.html#a3">minimum</a> size required upon <a class="code" href="../../d9/d1/fedefs_8h.html#a16">exit</a>.
00557 
00558 
00559 Return Value:
00560 
00561     STATUS_BUFFER_TOO_SMALL - The buffer was not big enough to contain
00562         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested information.
00563 
00564 
00565 --*/
00566 
00567 {
00568 
00569     PCHAR Field;
00570     PCHAR Base;
00571     ULONG WorldSidLength;
00572     PISECURITY_DESCRIPTOR_RELATIVE ISecurityDescriptor;
00573     ULONG MinSize;
00574     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00575 
00576     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00577 
00578     <span class="keywordflow">if</span> ( !ARGUMENT_PRESENT( SecurityInformation )) {
00579 
00580         <span class="keywordflow">return</span>( STATUS_ACCESS_DENIED );
00581     }
00582 
00583     WorldSidLength = <a class="code" href="../../d0/d5/se_8h.html#a10">SeLengthSid</a>( SeWorldSid );
00584 
00585     MinSize = <span class="keyword">sizeof</span>( SECURITY_DESCRIPTOR_RELATIVE ) + 2 * WorldSidLength;
00586 
00587     <span class="keywordflow">if</span> ( *Length &lt; MinSize ) {
00588 
00589         *Length = MinSize;
00590         <span class="keywordflow">return</span>( STATUS_BUFFER_TOO_SMALL );
00591     }
00592 
00593     *Length = MinSize;
00594 
00595     ISecurityDescriptor = (SECURITY_DESCRIPTOR_RELATIVE *)SecurityDescriptor;
00596 
00597     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a54">RtlCreateSecurityDescriptorRelative</a>( ISecurityDescriptor,
00598                                           SECURITY_DESCRIPTOR_REVISION );
00599 
00600     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00601         <span class="keywordflow">return</span>( <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> );
00602     }
00603 
00604     Base = (PCHAR)(ISecurityDescriptor);
00605     Field =  Base + <span class="keyword">sizeof</span>(SECURITY_DESCRIPTOR_RELATIVE);
00606 
00607     <span class="keywordflow">if</span> ( *SecurityInformation &amp; OWNER_SECURITY_INFORMATION ) {
00608 
00609         RtlCopyMemory( Field, SeWorldSid, WorldSidLength );
00610         ISecurityDescriptor-&gt;Owner = RtlPointerToOffset(Base,Field);
00611         Field += WorldSidLength;
00612     }
00613 
00614     <span class="keywordflow">if</span> ( *SecurityInformation &amp; GROUP_SECURITY_INFORMATION ) {
00615 
00616         RtlCopyMemory( Field, SeWorldSid, WorldSidLength );
00617         ISecurityDescriptor-&gt;Group = RtlPointerToOffset(Base,Field);
00618     }
00619 
00620     <span class="keywordflow">if</span> ( *SecurityInformation &amp; DACL_SECURITY_INFORMATION ) {
00621         RtlpSetControlBits( ISecurityDescriptor, SE_DACL_PRESENT );
00622     }
00623 
00624     <span class="keywordflow">if</span> ( *SecurityInformation &amp; SACL_SECURITY_INFORMATION ) {
00625         RtlpSetControlBits( ISecurityDescriptor, SE_SACL_PRESENT );
00626     }
00627 
00628     RtlpSetControlBits( ISecurityDescriptor, SE_SELF_RELATIVE );
00629 
00630     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00631 
00632 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="seassign.c::SeDeassignSecurity" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SeDeassignSecurity           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OUT PSECURITY_DESCRIPTOR *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>SecurityDescriptor</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00373">373</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, and <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>.
<p>
Referenced by <a class="el" href="../../d4/d1/cmparse2_8c-source.html#l00226">CmpDoCreateChild()</a>, <a class="el" href="../../d0/d1/obse_8c-source.html#l01574">ObAssignSecurity()</a>, and <a class="el" href="../../d9/d7/winsta_8c-source.html#l00243">xxxCreateWindowStation()</a>.
<p>
<pre class="fragment"><div>00379                    :
00380 
00381     This routine deallocates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory associated with a security descriptor
00382     that was assigned <span class="keyword">using</span> <a class="code" href="../../d0/d5/se_8h.html#a132">SeAssignSecurity</a>.
00383 
00384 
00385 Arguments:
00386 
00387     SecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> address of a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security
00388         descriptor  being deleted.
00389 
00390 Return Value:
00391 
00392     STATUS_SUCCESS - The deallocation was successful.
00393 
00394 --*/
00395 
00396 {
00397     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00398 
00399     <span class="keywordflow">if</span> ((*SecurityDescriptor) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00400         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( (*SecurityDescriptor) );
00401     }
00402 
00403     <span class="comment">//</span>
00404     <span class="comment">//  And zero out the pointer to it for safety sake</span>
00405     <span class="comment">//</span>
00406 
00407     (*SecurityDescriptor) = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00408 
00409     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00410 
00411 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="seassign.c::SepDumpSecurityDescriptor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepDumpSecurityDescriptor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSECURITY_DESCRIPTOR&nbsp;</td>
          <td class="mdname" nowrap> <em>SecurityDescriptor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSZ&nbsp;</td>
          <td class="mdname" nowrap> <em>TitleString</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00650">650</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00161">Dacl</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00160">Group</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00159">Owner</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00762">SepPrintAcl()</a>, and <a class="el" href="../../d2/d4/seassign_8c-source.html#l00916">SepPrintSid()</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00089">SeAssignSecurity()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00228">SeAssignSecurityEx()</a>, and <a class="el" href="../../d1/d3/accessck_8c-source.html#l01564">SepAccessCheck()</a>.
<p>
<pre class="fragment"><div>00657                    :
00658 
00659     Private routine to dump a security descriptor to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> debug
00660     screen.
00661 
00662 Arguments:
00663 
00664     SecurityDescriptor - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor to be dumped.
00665 
00666     TitleString - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> null terminated string to <a class="code" href="../../d0/d1/rtdeltre_8c.html#a5">print</a> before dumping
00667         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor.
00668 
00669 
00670 Return Value:
00671 
00672     None.
00673 
00674 
00675 --*/
00676 {
00677 <span class="preprocessor">#if DBG</span>
00678 <span class="preprocessor"></span>    PISECURITY_DESCRIPTOR ISecurityDescriptor;
00679     UCHAR Revision;
00680     SECURITY_DESCRIPTOR_CONTROL Control;
00681     PSID <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a>;
00682     PSID <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a>;
00683     PACL Sacl;
00684     PACL <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>;
00685 
00686     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00687 
00688 
00689     <span class="keywordflow">if</span> (!SepDumpSD) {
00690         <span class="keywordflow">return</span>;
00691     }
00692 
00693     <span class="keywordflow">if</span> (!ARGUMENT_PRESENT( SecurityDescriptor )) {
00694         <span class="keywordflow">return</span>;
00695     }
00696 
00697     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(TitleString);
00698 
00699     ISecurityDescriptor = ( PISECURITY_DESCRIPTOR )SecurityDescriptor;
00700 
00701     Revision = ISecurityDescriptor-&gt;Revision;
00702     Control  = ISecurityDescriptor-&gt;Control;
00703 
00704     <a class="code" href="../../d6/d0/ctaccess_8c.html#a53">Owner</a>    = RtlpOwnerAddrSecurityDescriptor( ISecurityDescriptor );
00705     <a class="code" href="../../d6/d0/ctaccess_8c.html#a54">Group</a>    = RtlpGroupAddrSecurityDescriptor( ISecurityDescriptor );
00706     Sacl     = RtlpSaclAddrSecurityDescriptor( ISecurityDescriptor );
00707     <a class="code" href="../../d6/d0/ctaccess_8c.html#a55">Dacl</a>     = RtlpDaclAddrSecurityDescriptor( ISecurityDescriptor );
00708 
00709     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\nSECURITY DESCRIPTOR\n"</span>);
00710 
00711     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Revision = %d\n"</span>,Revision);
00712 
00713     <span class="comment">//</span>
00714     <span class="comment">// Print control info</span>
00715     <span class="comment">//</span>
00716 
00717     <span class="keywordflow">if</span> (Control &amp; SE_OWNER_DEFAULTED) {
00718         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Owner defaulted\n"</span>);
00719     }
00720     <span class="keywordflow">if</span> (Control &amp; SE_GROUP_DEFAULTED) {
00721         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Group defaulted\n"</span>);
00722     }
00723     <span class="keywordflow">if</span> (Control &amp; SE_DACL_PRESENT) {
00724         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dacl present\n"</span>);
00725     }
00726     <span class="keywordflow">if</span> (Control &amp; SE_DACL_DEFAULTED) {
00727         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dacl defaulted\n"</span>);
00728     }
00729     <span class="keywordflow">if</span> (Control &amp; SE_SACL_PRESENT) {
00730         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Sacl present\n"</span>);
00731     }
00732     <span class="keywordflow">if</span> (Control &amp; SE_SACL_DEFAULTED) {
00733         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Sacl defaulted\n"</span>);
00734     }
00735     <span class="keywordflow">if</span> (Control &amp; SE_SELF_RELATIVE) {
00736         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Self relative\n"</span>);
00737     }
00738     <span class="keywordflow">if</span> (Control &amp; SE_DACL_UNTRUSTED) {
00739         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dacl untrusted\n"</span>);
00740     }
00741     <span class="keywordflow">if</span> (Control &amp; SE_SERVER_SECURITY) {
00742         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Server security\n"</span>);
00743     }
00744 
00745     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Owner "</span>);
00746     <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>( Owner );
00747 
00748     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Group "</span>);
00749     <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>( Group );
00750 
00751     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Sacl"</span>);
00752     <a class="code" href="../../d6/d6/sep_8h.html#a55">SepPrintAcl</a>( Sacl );
00753 
00754     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Dacl"</span>);
00755     <a class="code" href="../../d6/d6/sep_8h.html#a55">SepPrintAcl</a>( Dacl );
00756 <span class="preprocessor">#endif</span>
00757 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="seassign.c::SepDumpTokenInfo" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepDumpTokenInfo           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACCESS_TOKEN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Token</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00995">995</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d6/d2/parseini_8c-source.html#l00038">PTOKEN</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00916">SepPrintSid()</a>, and <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00123">Token</a>.
<p>
Referenced by <a class="el" href="../../d1/d3/accessck_8c-source.html#l03323">SeAccessCheck()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l01564">SepAccessCheck()</a>, <a class="el" href="../../d1/d3/accessck_8c-source.html#l00733">SepSidInToken()</a>, and <a class="el" href="../../d1/d3/accessck_8c-source.html#l00856">SepSidInTokenEx()</a>.
<p>
<pre class="fragment"><div>01001                    :
01002 
01003     Prints interesting information in a token.
01004 
01005 Arguments:
01006 
01007     <a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a> - Provides <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> token to be examined.
01008 
01009 
01010 Return Value:
01011 
01012     None.
01013 
01014 --*/
01015 
01016 {
01017 <span class="preprocessor">#if DBG</span>
01018 <span class="preprocessor"></span>    ULONG UserAndGroupCount;
01019     PSID_AND_ATTRIBUTES TokenSid;
01020     ULONG i;
01021     <a class="code" href="../../d5/d3/parseini_8c.html#a4">PTOKEN</a> IToken;
01022 
01023     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01024 
01025     <span class="keywordflow">if</span> (!SepDumpToken) {
01026         <span class="keywordflow">return</span>;
01027     }
01028 
01029     IToken = (<a class="code" href="../../d8/d1/struct__TOKEN.html">TOKEN</a> *)<a class="code" href="../../d6/d0/ctaccess_8c.html#a29">Token</a>;
01030 
01031     UserAndGroupCount = IToken-&gt;UserAndGroupCount;
01032 
01033     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n\nToken Address=%lx\n"</span>,IToken);
01034     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Token User and Groups Array:\n\n"</span>);
01035 
01036     <span class="keywordflow">for</span> ( i = 0 , TokenSid = IToken-&gt;UserAndGroups;
01037           i &lt; UserAndGroupCount ;
01038           i++, TokenSid++
01039         ) {
01040 
01041         <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>( TokenSid-&gt;Sid );
01042 
01043         }
01044 
01045     <span class="keywordflow">if</span> ( IToken-&gt;RestrictedSids ) {
01046         UserAndGroupCount = IToken-&gt;RestrictedSidCount;
01047 
01048         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Restricted Sids Array:\n\n"</span>);
01049 
01050         <span class="keywordflow">for</span> ( i = 0 , TokenSid = IToken-&gt;RestrictedSids;
01051               i &lt; UserAndGroupCount ;
01052               i++, TokenSid++
01053             ) {
01054 
01055             <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>( TokenSid-&gt;Sid );
01056 
01057             }
01058     }
01059 <span class="preprocessor">#endif</span>
01060 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="seassign.c::SepInheritAcl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SepInheritAcl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACL&nbsp;</td>
          <td class="mdname" nowrap> <em>Acl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>IsDirectoryObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientOwnerSid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>ClientGroupSid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID ServerOwnerSid&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID ServerGroupSid&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACL *&nbsp;</td>
          <td class="mdname" nowrap> <em>NewAcl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00416">416</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l05153">RtlpInheritAcl()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
<pre class="fragment"><div>00430                    :
00431 
00432     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a <span class="keyword">private</span> routine that produces an inherited acl from
00433     a parent acl according to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> rules of inheritance
00434 
00435 Arguments:
00436 
00437     Acl - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> acl being inherited.
00438 
00439     IsDirectoryObject - Specifies <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> acl <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <span class="keywordflow">for</span> a directory.
00440 
00441     OwnerSid - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> owner Sid to use.
00442 
00443     GroupSid - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> group SID to use.
00444 
00445     ServerSid - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a22">Server</a> SID to use.
00446 
00447     ClientSid - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Client SID to use.
00448 
00449     GenericMapping - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> generic mapping to use.
00450 
00451     PoolType - Specifies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d4/d6/regext_8c.html#a17">pool</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> acl.
00452 
00453     NewAcl - Receives a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keyword">new</span> (inherited) acl.
00454 
00455 Return Value:
00456 
00457     STATUS_SUCCESS - An inheritable ACL was successfully generated.
00458 
00459     STATUS_NO_INHERITANCE - An inheritable ACL was not successfully generated.
00460         This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a warning completion status.
00461 
00462     STATUS_BAD_INHERITANCE_ACL - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> acl built was not a valid ACL.
00463         This can becaused by a number of things.  One of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> more probable
00464         causes <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> replacement of a CreatorId with an SID that didn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a> fit
00465         into <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ACE or ACL.
00466 
00467     STATUS_UNKNOWN_REVISION - Indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> source ACL <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a revision that
00468         <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> unknown to <span class="keyword">this</span> routine.
00469 
00470 --*/
00471 
00472 {
00474 <span class="comment">//                                                                          //</span>
00475 <span class="comment">//   The logic in the ACL inheritance code must mirror the code for         //</span>
00476 <span class="comment">//   inheritance in the user mode runtime (in sertl.c). Do not make changes //</span>
00477 <span class="comment">//   here without also making changes in that module.                       //</span>
00478 <span class="comment">//                                                                          //</span>
00480 <span class="comment"></span>
00481 
00482     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00483     ULONG NewAclLength;
00484     BOOLEAN NewAclExplicitlyAssigned;
00485     ULONG NewGenericControl;
00486 
00487     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00488     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( PoolType == PagedPool ); <span class="comment">// RtlpInheritAcl assumes paged pool</span>
00489 
00490     <span class="comment">//</span>
00491     <span class="comment">//  First check if the acl is null</span>
00492     <span class="comment">//</span>
00493 
00494     <span class="keywordflow">if</span> (Acl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00495 
00496         <span class="keywordflow">return</span> STATUS_NO_INHERITANCE;
00497     }
00498 
00499     <span class="comment">//</span>
00500     <span class="comment">// Generating an inheritable ACL.</span>
00501     <span class="comment">//</span>
00502     <span class="comment">// Pass all parameters as though there is no auto inheritance.</span>
00503     <span class="comment">//</span>
00504 
00505     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d8/d6/sertl_8c.html#a74">RtlpInheritAcl</a>(
00506                  Acl,
00507                  NULL,  <span class="comment">// No child ACL since no auto inheritance</span>
00508                  0,     <span class="comment">// No child control since no auto inheritance</span>
00509                  IsDirectoryObject,
00510                  FALSE, <span class="comment">// Not AutoInherit since no auto inheritance</span>
00511                  FALSE, <span class="comment">// Not DefaultDescriptor since no auto inheritance</span>
00512                  ClientOwnerSid,
00513                  ClientGroupSid,
00514                  ServerOwnerSid,
00515                  ServerGroupSid,
00516                  GenericMapping,
00517                  FALSE, <span class="comment">// Isn't a SACL</span>
00518                  NULL,  <span class="comment">// No object GUID</span>
00519                  NewAcl,
00520                  &amp;NewAclExplicitlyAssigned,
00521                  &amp;NewGenericControl );
00522 
00523     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00524 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="seassign.c::SepInheritAcl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SepInheritAcl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACL&nbsp;</td>
          <td class="mdname" nowrap> <em>Acl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>IsDirectoryObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>OwnerSid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>GroupSid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID ServerSid&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID ClientSid&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PGENERIC_MAPPING&nbsp;</td>
          <td class="mdname" nowrap> <em>GenericMapping</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d5/d8/ex_8h.html#a96">POOL_TYPE</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PoolType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PACL *&nbsp;</td>
          <td class="mdname" nowrap> <em>NewAcl</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="seassign.c::SepPrintAcl" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepPrintAcl           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PACL&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Acl</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00762">762</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d0/rtdmpsec_8c-source.html#l00053">FirstAce</a>, <a class="el" href="../../d5/d0/rtdmpsec_8c-source.html#l00059">NextAce</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00916">SepPrintSid()</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l00650">SepDumpSecurityDescriptor()</a>.
<p>
<pre class="fragment"><div>00768                    :
00769 
00770     This routine dumps via (DbgPrint) an Acl for debug purposes.  It is
00771     specialized to dump standard aces.
00772 
00773 Arguments:
00774 
00775     Acl - Supplies the Acl to dump
00776 
00777 Return Value:
00778 
00779     None
00780 
00781 --*/
00782 
00783 
00784 {
00785 <span class="preprocessor">#if DBG</span>
00786 <span class="preprocessor"></span>    ULONG i;
00787     <a class="code" href="../../d4/d7/struct__KNOWN__ACE.html">PKNOWN_ACE</a> Ace;
00788     BOOLEAN KnownType;
00789 
00790     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00791 
00792     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"@ %8lx\n"</span>, Acl);
00793 
00794     <span class="comment">//</span>
00795     <span class="comment">//  Check if the Acl is null</span>
00796     <span class="comment">//</span>
00797 
00798     <span class="keywordflow">if</span> (Acl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00799 
00800         <span class="keywordflow">return</span>;
00801 
00802     }
00803 
00804     <span class="comment">//</span>
00805     <span class="comment">//  Dump the Acl header</span>
00806     <span class="comment">//</span>
00807 
00808     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Revision: %02x"</span>, Acl-&gt;AclRevision);
00809     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Size: %04x"</span>, Acl-&gt;AclSize);
00810     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" AceCount: %04x\n"</span>, Acl-&gt;AceCount);
00811 
00812     <span class="comment">//</span>
00813     <span class="comment">//  Now for each Ace we want do dump it</span>
00814     <span class="comment">//</span>
00815 
00816     <span class="keywordflow">for</span> (i = 0, Ace = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a1">FirstAce</a>(Acl);
00817          i &lt; Acl-&gt;AceCount;
00818          i++, Ace = <a class="code" href="../../d4/d1/rtdmpsec_8c.html#a2">NextAce</a>(Ace) ) {
00819 
00820         <span class="comment">//</span>
00821         <span class="comment">//  print out the ace header</span>
00822         <span class="comment">//</span>
00823 
00824         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n AceHeader: %08lx "</span>, *(PULONG)Ace);
00825 
00826         <span class="comment">//</span>
00827         <span class="comment">//  special case on the standard ace types</span>
00828         <span class="comment">//</span>
00829 
00830         <span class="keywordflow">if</span> ((Ace-&gt;Header.AceType == ACCESS_ALLOWED_ACE_TYPE) ||
00831             (Ace-&gt;Header.AceType == ACCESS_DENIED_ACE_TYPE) ||
00832             (Ace-&gt;Header.AceType == SYSTEM_AUDIT_ACE_TYPE) ||
00833             (Ace-&gt;Header.AceType == SYSTEM_ALARM_ACE_TYPE) ||
00834             (Ace-&gt;Header.AceType == ACCESS_ALLOWED_COMPOUND_ACE_TYPE)) {
00835 
00836             <span class="comment">//</span>
00837             <span class="comment">//  The following array is indexed by ace types and must</span>
00838             <span class="comment">//  follow the allowed, denied, audit, alarm seqeuence</span>
00839             <span class="comment">//</span>
00840 
00841             PCHAR AceTypes[] = { <span class="stringliteral">"Access Allowed"</span>,
00842                                  <span class="stringliteral">"Access Denied "</span>,
00843                                  <span class="stringliteral">"System Audit  "</span>,
00844                                  <span class="stringliteral">"System Alarm  "</span>,
00845                                  <span class="stringliteral">"Compound Grant"</span>,
00846                                };
00847 
00848             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(AceTypes[Ace-&gt;Header.AceType]);
00849             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n Access Mask: %08lx "</span>, Ace-&gt;Mask);
00850             KnownType = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00851 
00852         } <span class="keywordflow">else</span> {
00853 
00854             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Unknown Ace Type\n"</span>);
00855             KnownType = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00856         }
00857 
00858         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
00859 
00860         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" AceSize = %d\n"</span>,Ace-&gt;Header.AceSize);
00861 
00862         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Ace Flags = "</span>);
00863         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; OBJECT_INHERIT_ACE) {
00864             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"OBJECT_INHERIT_ACE\n"</span>);
00865             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                   "</span>);
00866         }
00867 
00868         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; CONTAINER_INHERIT_ACE) {
00869             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"CONTAINER_INHERIT_ACE\n"</span>);
00870             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                   "</span>);
00871         }
00872 
00873         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; NO_PROPAGATE_INHERIT_ACE) {
00874             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"NO_PROPAGATE_INHERIT_ACE\n"</span>);
00875             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                   "</span>);
00876         }
00877 
00878         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; INHERIT_ONLY_ACE) {
00879             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"INHERIT_ONLY_ACE\n"</span>);
00880             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"                   "</span>);
00881         }
00882 
00883 
00884         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; SUCCESSFUL_ACCESS_ACE_FLAG) {
00885             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"SUCCESSFUL_ACCESS_ACE_FLAG\n"</span>);
00886             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"            "</span>);
00887         }
00888 
00889         <span class="keywordflow">if</span> (Ace-&gt;Header.AceFlags &amp; FAILED_ACCESS_ACE_FLAG) {
00890             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"FAILED_ACCESS_ACE_FLAG\n"</span>);
00891             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"            "</span>);
00892         }
00893 
00894         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
00895 
00896         <span class="keywordflow">if</span> (KnownType != <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) {
00897             <span class="keywordflow">continue</span>;
00898         }
00899 
00900         <span class="keywordflow">if</span> (Ace-&gt;Header.AceType != ACCESS_ALLOWED_COMPOUND_ACE_TYPE) {
00901             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Sid = "</span>);
00902             <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>(&amp;Ace-&gt;SidStart);
00903         } <span class="keywordflow">else</span> {
00904             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">" Server Sid = "</span>);
00905             <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>(RtlCompoundAceServerSid(Ace));
00906             <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n Client Sid = "</span>);
00907             <a class="code" href="../../d6/d6/sep_8h.html#a56">SepPrintSid</a>(RtlCompoundAceClientSid( Ace ));
00908         }
00909     }
00910 <span class="preprocessor">#endif</span>
00911 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="seassign.c::SepPrintSid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepPrintSid           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Sid</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l00916">916</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d1/rtqkey_8c-source.html#l00042">Buffer</a>, <a class="el" href="../../d7/d5/memprint_8h-source.html#l00079">DbgPrint</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">SepSidTranslation()</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l00650">SepDumpSecurityDescriptor()</a>, <a class="el" href="../../d2/d4/seassign_8c-source.html#l00995">SepDumpTokenInfo()</a>, and <a class="el" href="../../d2/d4/seassign_8c-source.html#l00762">SepPrintAcl()</a>.
<p>
<pre class="fragment"><div>00922                    :
00923 
00924     Prints a formatted Sid
00925 
00926 Arguments:
00927 
00928     Sid - Provides a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sid to be printed.
00929 
00930 
00931 Return Value:
00932 
00933     None.
00934 
00935 --*/
00936 
00937 {
00938 <span class="preprocessor">#if DBG</span>
00939 <span class="preprocessor"></span>    UCHAR i;
00940     ULONG Tmp;
00941     PISID ISid;
00942     STRING AccountName;
00943     UCHAR <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[128];
00944 
00945     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00946 
00947     <span class="keywordflow">if</span> (Sid == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00948         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"Sid is NULL\n"</span>);
00949         <span class="keywordflow">return</span>;
00950     }
00951 
00952     <a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[0] = 0;
00953 
00954     AccountName.MaximumLength = 127;
00955     AccountName.Length = 0;
00956     AccountName.Buffer = (PVOID)&amp;<a class="code" href="../../d6/d2/rtqkey_8c.html#a3">Buffer</a>[0];
00957 
00958     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6/sep_8h.html#a58">SepSidTranslation</a>( Sid, &amp;AccountName )) {
00959 
00960         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%s   "</span>, AccountName.Buffer );
00961     }
00962 
00963     ISid = (PISID)Sid;
00964 
00965     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"S-%lu-"</span>, (USHORT)ISid-&gt;Revision );
00966     <span class="keywordflow">if</span> (  (ISid-&gt;IdentifierAuthority.Value[0] != 0)  ||
00967           (ISid-&gt;IdentifierAuthority.Value[1] != 0)     ){
00968         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"0x%02hx%02hx%02hx%02hx%02hx%02hx"</span>,
00969                     (USHORT)ISid-&gt;IdentifierAuthority.Value[0],
00970                     (USHORT)ISid-&gt;IdentifierAuthority.Value[1],
00971                     (USHORT)ISid-&gt;IdentifierAuthority.Value[2],
00972                     (USHORT)ISid-&gt;IdentifierAuthority.Value[3],
00973                     (USHORT)ISid-&gt;IdentifierAuthority.Value[4],
00974                     (USHORT)ISid-&gt;IdentifierAuthority.Value[5] );
00975     } <span class="keywordflow">else</span> {
00976         Tmp = (ULONG)ISid-&gt;IdentifierAuthority.Value[5]          +
00977               (ULONG)(ISid-&gt;IdentifierAuthority.Value[4] &lt;&lt;  8)  +
00978               (ULONG)(ISid-&gt;IdentifierAuthority.Value[3] &lt;&lt; 16)  +
00979               (ULONG)(ISid-&gt;IdentifierAuthority.Value[2] &lt;&lt; 24);
00980         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"%lu"</span>, Tmp);
00981     }
00982 
00983 
00984     <span class="keywordflow">for</span> (i=0;i&lt;ISid-&gt;SubAuthorityCount ;i++ ) {
00985         <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"-%lu"</span>, ISid-&gt;SubAuthority[i]);
00986     }
00987     <a class="code" href="../../d6/d6/memprint_8h.html#a7">DbgPrint</a>(<span class="stringliteral">"\n"</span>);
00988 <span class="preprocessor">#endif</span>
00989 <span class="preprocessor"></span>}

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="seassign.c::SepSidTranslation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepSidTranslation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>Sid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PSTRING&nbsp;</td>
          <td class="mdname" nowrap> <em>AccountName</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/seassign_8c-source.html#l01065">1065</a> of file <a class="el" href="../../d2/d4/seassign_8c-source.html">seassign.c</a>.
<p>
References <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00871">RtlEqualSid()</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00056">RtlInitString()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01626">SeBatchSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01614">SeCreatorGroupServerSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01612">SeCreatorGroupSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01613">SeCreatorOwnerServerSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01611">SeCreatorOwnerSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01627">SeInteractiveSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01610">SeLocalSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01628">SeLocalSystemSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01625">SeNetworkSid</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01609">SeWorldSid</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/seassign_8c-source.html#l00916">SepPrintSid()</a>.
<p>
<pre class="fragment"><div>01072                    :
01073 
01074     This routine translates well-known SIDs into English names.
01075 
01076 Arguments:
01077 
01078     Sid - Provides <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> sid to be examined.
01079 
01080     AccountName - Provides a string buffer in which to place <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01081         translated name.
01082 
01083 Return Value:
01084 
01085     None
01086 
01087 --*/
01088 
01089 <span class="comment">// AccountName is expected to have a large maximum length</span>
01090 
01091 {
01092     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01093 
01094     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeWorldSid)) {
01095         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"WORLD         "</span>);
01096         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01097     }
01098 
01099     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeLocalSid)) {
01100         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"LOCAL         "</span>);
01101         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01102     }
01103 
01104     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeNetworkSid)) {
01105         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"NETWORK       "</span>);
01106         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01107     }
01108 
01109     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeBatchSid)) {
01110         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"BATCH         "</span>);
01111         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01112     }
01113 
01114     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeInteractiveSid)) {
01115         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"INTERACTIVE   "</span>);
01116         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01117     }
01118 
01119     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeLocalSystemSid)) {
01120         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"SYSTEM        "</span>);
01121         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01122     }
01123 
01124     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeCreatorOwnerSid)) {
01125         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"CREATOR_OWNER "</span>);
01126         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01127     }
01128 
01129     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeCreatorGroupSid)) {
01130         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"CREATOR_GROUP "</span>);
01131         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01132     }
01133 
01134     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeCreatorOwnerServerSid)) {
01135         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"CREATOR_OWNER_SERVER "</span>);
01136         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01137     }
01138 
01139     <span class="keywordflow">if</span> (<a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>(Sid, SeCreatorGroupServerSid)) {
01140         <a class="code" href="../../d2/d7/string_8c.html#a5">RtlInitString</a>( AccountName, <span class="stringliteral">"CREATOR_GROUP_SERVER "</span>);
01141         <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
01142     }
01143 
01144     <span class="keywordflow">return</span>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
01145 }

</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:45:33 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
