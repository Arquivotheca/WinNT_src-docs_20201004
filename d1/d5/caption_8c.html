<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: caption.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>caption.c File Reference</h1><code>#include "<a class="el" href="../../d1/d3/w32_2ntuser_2kernel_2precomp_8h-source.html">precomp.h</a>"</code><br>

<p>
<a href="../../d2/d4/caption_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a0">MIN</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a1">MAX</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a2">NOMIN</a>&nbsp;&nbsp;&nbsp;0x04</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a3">NOMAX</a>&nbsp;&nbsp;&nbsp;0x08</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a4">NOCLOSE</a>&nbsp;&nbsp;&nbsp;0x10</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a5">SMCAP</a>&nbsp;&nbsp;&nbsp;0x20</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a6">NOSIZE</a>&nbsp;&nbsp;&nbsp;(NOMIN | NOMAX)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a7">GetCOLOR16</a>(RGB, clr)&nbsp;&nbsp;&nbsp;((COLOR16)(Get ## RGB ## Value(clr) &lt;&lt; 8))</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a8">xxxCalcCaptionButton</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, int iButton, LPWORD pcmd, LPRECT prcBtn, LPWORD pbm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>WORD&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a9">xxxTrackCaptionButton</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, UINT hit)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a10">xxxGetWindowSmIcon</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, BOOL fDontSendMsg)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a11">BltMe4Times</a> (<a class="el" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a> pOem, int cxySlot, int cxyIcon, HDC hdcSrc, <a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcursor, UINT flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a12">DrawCaptionIcon</a> (HDC hdc, LPRECT lprc, <a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcursor, HBRUSH hbrFill, UINT flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a13">FillGradient</a> (HDC hdc, LPCRECT prc, COLORREF rgbLeft, COLORREF rgbRight)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a14">FillCaptionGradient</a> (HDC hdc, LPCRECT prc, BOOL fActive)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOL&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a15">xxxDrawCaptionTemp</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HDC hdc, LPRECT lprc, HFONT hFont, <a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcursor, PUNICODE_STRING pstrText, UINT flags)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/caption_8c.html#a16">xxxDrawCaptionBar</a> (<a class="el" href="../../d6/d9/structtagWND.html">PWND</a> pwnd, HDC hdc, UINT wFlags)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a7" doxytag="caption.c::GetCOLOR16" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define GetCOLOR16          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">RGB,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>clr&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;((COLOR16)(Get ## RGB ## Value(clr) &lt;&lt; 8))</td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00643">FillGradient()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="caption.c::MAX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MAX&nbsp;&nbsp;&nbsp;0x02          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00017">17</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="caption.c::MIN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define MIN&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00016">16</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00986">xxxDrawCaptionBar()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="caption.c::NOCLOSE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NOCLOSE&nbsp;&nbsp;&nbsp;0x10          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00020">20</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00986">xxxDrawCaptionBar()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="caption.c::NOMAX" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NOMAX&nbsp;&nbsp;&nbsp;0x08          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00019">19</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00986">xxxDrawCaptionBar()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="caption.c::NOMIN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NOMIN&nbsp;&nbsp;&nbsp;0x04          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00018">18</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00986">xxxDrawCaptionBar()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="caption.c::NOSIZE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define NOSIZE&nbsp;&nbsp;&nbsp;(NOMIN | NOMAX)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00022">22</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00986">xxxDrawCaptionBar()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="caption.c::SMCAP" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SMCAP&nbsp;&nbsp;&nbsp;0x20          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00021">21</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00986">xxxDrawCaptionBar()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a11" doxytag="caption.c::BltMe4Times" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID BltMe4Times           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pOem</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cxySlot</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>cxyIcon</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdcSrc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pcursor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00401">401</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
References <a class="el" href="../../d1/d8/wmicon_8c-source.html#l00032">BltIcon()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01020">tagOEMBITMAPINFO::cx</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01021">tagOEMBITMAPINFO::cy</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00953">DOBI_CAPOFF</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00061">FillRect()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02138">HDCBITS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01018">tagOEMBITMAPINFO::x</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01019">tagOEMBITMAPINFO::y</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00462">DrawCaptionIcon()</a>.
<p>
<pre class="fragment"><div>00408 {
00409     RECT            rc;
00410     <span class="keywordtype">int</span>             i;
00411     <span class="keywordtype">int</span>             j;
00412     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>            fMask = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00413     LONG            rop;
00414     HBRUSH          hBrush;
00415 
00416     hBrush = (flags &amp; DC_INBUTTON) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DHILIGHT) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(ACTIVECAPTION);
00417 
00418     <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
00419 
00420         rop = SRCAND;
00421 
00422         rc.left   = pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a>;
00423         rc.top    = pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a>;
00424         rc.right  = rc.left + pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a>;
00425         rc.bottom = rc.top + pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>;
00426         <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a3">FillRect</a>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(), &amp;rc, hBrush);
00427 
00428         rc.top  += (cxySlot - cxyIcon) / 2;
00429         rc.left += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER) + (cxySlot - cxyIcon) / 2;
00430 
00431         <span class="keywordflow">for</span> (j = 0; j &lt; 2; j++) {
00432                     <a class="code" href="../../d0/d9/wmicon_8c.html#a3">BltIcon</a>(
00433                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(),
00434                     rc.left,
00435                     rc.top,
00436                     cxyIcon,
00437                     cxyIcon,
00438                     hdcSrc,
00439                     pcursor,
00440                     fMask,
00441                     rop);
00442 
00443             fMask = !fMask;
00444             rop = SRCINVERT;
00445         }
00446 
00447         pOem += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a264">DOBI_CAPOFF</a>;
00448         hBrush = (flags &amp; DC_INBUTTON) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DFACE) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(INACTIVECAPTION);
00449     }
00450 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="caption.c::DrawCaptionIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID DrawCaptionIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>lprc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pcursor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HBRUSH&nbsp;</td>
          <td class="mdname" nowrap> <em>hbrFill</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00462">462</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
References <a class="el" href="../../d1/d8/wmicon_8c-source.html#l00093">_DrawIconEx()</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00401">BltMe4Times()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a839">CAPTIONCACHE</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00037">CCACHEDCAPTIONS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00953">DOBI_CAPOFF</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00061">FillRect()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00244">gcachedCaptions</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00493">ghdcMem</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02138">HDCBITS</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00367">Lock</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00988">OBI_CAPCACHE1</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02756">tagCAPTIONCACHE::pOem</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01512">PtoH</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02755">tagCAPTIONCACHE::spcursor</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01018">tagOEMBITMAPINFO::x</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01019">tagOEMBITMAPINFO::y</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00688">xxxDrawCaptionTemp()</a>.
<p>
<pre class="fragment"><div>00468 {
00469     <span class="keywordtype">int</span>            i;
00470     <span class="keywordtype">int</span>            xStart = 0;
00471     <span class="keywordtype">int</span>            cxySlot;
00472     <a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a> pOem;
00473     RECT           rc;
00474     <a class="code" href="../../d5/d9/structtagCAPTIONCACHE.html">CAPTIONCACHE</a>   ccTemp;
00475 
00476     <span class="comment">/*</span>
00477 <span class="comment">     * Check the size of the icon to see if it matches the size of the</span>
00478 <span class="comment">     * cache we created.  Most of the time this will match.  Also, if</span>
00479 <span class="comment">     * we are drawing with DC_INBUTTON in 16 colors, don't cache.</span>
00480 <span class="comment">     */</span>
00481     cxySlot = lprc-&gt;bottom - lprc-&gt;top;
00482 
00483     <span class="keywordflow">if</span> ((cxySlot != <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a296">OBI_CAPCACHE1</a>].cy) || (hbrFill == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hbrGray)) {
00484 
00485         rc.left   = lprc-&gt;left;
00486         rc.top    = lprc-&gt;top;
00487         rc.right  = lprc-&gt;left + cxySlot;
00488         rc.bottom = lprc-&gt;top + cxySlot;
00489 
00490         <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a3">FillRect</a>(hdc, &amp;rc, hbrFill);
00491 
00492         rc.left += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER) + (cxySlot - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMICON)) / 2;
00493         rc.top  += (cxySlot - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMICON)) / 2;
00494 
00495         <a class="code" href="../../d0/d9/wmicon_8c.html#a4">_DrawIconEx</a>(hdc,
00496                     rc.left,
00497                     rc.top,
00498                     pcursor,
00499                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMICON),
00500                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMICON),
00501                     0,
00502                     NULL,
00503                     DI_NORMAL);
00504 
00505         <span class="keywordflow">goto</span> Done;
00506     }
00507 
00508     <span class="keywordflow">if</span> (flags &amp; DC_INBUTTON) {
00509 
00510         <span class="comment">/*</span>
00511 <span class="comment">         * The DC_INBUTTON icons is always slot 0.</span>
00512 <span class="comment">         */</span>
00513         i = ((<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[0].<a class="code" href="../../d5/d9/structtagCAPTIONCACHE.html#o0">spcursor</a> == pcursor) ? 0 : <a class="code" href="../../d4/d1/userk_8h.html#a6">CCACHEDCAPTIONS</a>);
00514 
00515     } <span class="keywordflow">else</span> {
00516 
00517         <span class="comment">/*</span>
00518 <span class="comment">         * Search the cache to see if this cursor is currently cached.</span>
00519 <span class="comment">         */</span>
00520         <span class="keywordflow">for</span> (i = 1; i &lt; <a class="code" href="../../d4/d1/userk_8h.html#a6">CCACHEDCAPTIONS</a>; i++) {
00521             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[i].<a class="code" href="../../d5/d9/structtagCAPTIONCACHE.html#o0">spcursor</a> == pcursor)
00522                 <span class="keywordflow">break</span>;
00523         }
00524     }
00525 
00526     <span class="keywordflow">if</span> (i &gt;= <a class="code" href="../../d4/d1/userk_8h.html#a6">CCACHEDCAPTIONS</a>) {
00527 
00528         <span class="comment">/*</span>
00529 <span class="comment">         * Icon wasn't cached, so try and add it to the cache</span>
00530 <span class="comment">         */</span>
00531         <span class="keywordflow">if</span> (flags &amp; DC_INBUTTON) {
00532 
00533             <span class="comment">/*</span>
00534 <span class="comment">             * The tray's special DC_INBUTTON style always goes in slot 0.</span>
00535 <span class="comment">             */</span>
00536             i = 0;
00537 
00538         } <span class="keywordflow">else</span> {
00539 
00540             <span class="comment">/*</span>
00541 <span class="comment">             * Look for an empty slot in the cache.  If we can't find one,</span>
00542 <span class="comment">             * stuff the new icon at the end of the cache.  The result will</span>
00543 <span class="comment">             * be that the last item will be deleted.</span>
00544 <span class="comment">             */</span>
00545             <span class="keywordflow">for</span> (i = 1; i &lt; <a class="code" href="../../d4/d1/userk_8h.html#a6">CCACHEDCAPTIONS</a> - 1; i++) {
00546                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[i].<a class="code" href="../../d5/d9/structtagCAPTIONCACHE.html#o0">spcursor</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00547                     <span class="keywordflow">break</span>;
00548             }
00549         }
00550 
00551         <span class="comment">/*</span>
00552 <span class="comment">         * Add an item to the cache by blting an active and inactive copy of</span>
00553 <span class="comment">         * the icon.</span>
00554 <span class="comment">         */</span>
00555         <a class="code" href="../../d1/d5/caption_8c.html#a11">BltMe4Times</a>(gcachedCaptions[i].pOem,
00556                     cxySlot,
00557                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMICON),
00558                     ghdcMem,
00559                     pcursor,
00560                     flags);
00561 
00562         <a class="code" href="../../d6/d0/usercli_8h.html#a41">Lock</a>(&amp;(gcachedCaptions[i].spcursor), pcursor);
00563 <span class="preprocessor">#if DBG</span>
00564 <span class="preprocessor"></span>        <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[i].hico = (HICON)<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pcursor);
00565 <span class="preprocessor">#endif</span>
00566 <span class="preprocessor"></span>    }
00567 
00568     <span class="comment">/*</span>
00569 <span class="comment">     * We have a hit, so move that cached icon to the front of the cache.</span>
00570 <span class="comment">     * This means that the least recently used icon will be the last</span>
00571 <span class="comment">     * icon in the cache.  Remember, we never update index 0 because it</span>
00572 <span class="comment">     * is reserved for the DC_INBUTTON icon.</span>
00573 <span class="comment">     */</span>
00574     <span class="keywordflow">for</span> ( ; i &gt; 1; i-- ) {
00575 
00576         <span class="comment">/*</span>
00577 <span class="comment">         * Move the entry toward the front</span>
00578 <span class="comment">         */</span>
00579         ccTemp = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[i];
00580         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[i]     = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[i - 1];
00581         <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[i - 1] = ccTemp;
00582 
00583 <span class="preprocessor">#if DEBUGTAGS</span>
00584 <span class="preprocessor"></span>        <span class="comment">/*</span>
00585 <span class="comment">         * In checked builds we need to adjust the lock records for</span>
00586 <span class="comment">         * the cursor so it has the correct address.</span>
00587 <span class="comment">         */</span>
00588         <span class="keywordflow">if</span> (IsDbgTagEnabled(DBGTAG_TrackLocks)) {
00589             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[i].<a class="code" href="../../d5/d9/structtagCAPTIONCACHE.html#o0">spcursor</a>)
00590                 HMRelocateLockRecord(&amp;(gcachedCaptions[i].spcursor), (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d9/structtagCAPTIONCACHE.html">CAPTIONCACHE</a>));
00591             <span class="keywordflow">if</span> (<a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[i - 1].<a class="code" href="../../d5/d9/structtagCAPTIONCACHE.html#o0">spcursor</a>)
00592                 HMRelocateLockRecord(&amp;(gcachedCaptions[i - 1].spcursor), -(<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(<a class="code" href="../../d5/d9/structtagCAPTIONCACHE.html">CAPTIONCACHE</a>));
00593         }
00594 <span class="preprocessor">#endif</span>
00595 <span class="preprocessor"></span>    }
00596 
00597 
00598 <span class="preprocessor">#if DBG</span>
00599 <span class="preprocessor"></span>    <span class="comment">/*</span>
00600 <span class="comment">     *  Make sure the icon we want to draw is the one</span>
00601 <span class="comment">     *  that we hit in the cache.</span>
00602 <span class="comment">     */</span>
00603     UserAssert( gcachedCaptions[i].hico == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a448">PtoH</a>(pcursor) );
00604 <span class="preprocessor">#endif</span>
00605 <span class="preprocessor"></span>
00606     <span class="comment">/*</span>
00607 <span class="comment">     * Determine what cached bitmap to blt.</span>
00608 <span class="comment">     */</span>
00609     pOem = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a105">gcachedCaptions</a>[i].<a class="code" href="../../d5/d9/structtagCAPTIONCACHE.html#o1">pOem</a>;
00610     <span class="keywordflow">if</span> (!(flags &amp; DC_ACTIVE))
00611         pOem += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a264">DOBI_CAPOFF</a>;
00612 
00613     GreBitBlt(hdc,
00614               lprc-&gt;left,
00615               lprc-&gt;top,
00616               cxySlot,
00617               cxySlot,
00618               <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(),
00619               pOem-&gt;x,
00620               pOem-&gt;y,
00621               SRCCOPY,
00622               0);
00623 
00624 Done:
00625     <span class="comment">/*</span>
00626 <span class="comment">     * Adjust the given rectangle for the icon we just drew</span>
00627 <span class="comment">     */</span>
00628     lprc-&gt;left += cxySlot;
00629 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="caption.c::FillCaptionGradient" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void FillCaptionGradient           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>prc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fActive</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00665">665</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
References <a class="el" href="../../d2/d4/caption_8c-source.html#l00643">FillGradient()</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00061">FillRect()</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, and <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00688">xxxDrawCaptionTemp()</a>.
<p>
<pre class="fragment"><div>00666 {
00667     COLORREF rgbLeft, rgbRight;
00668 
00669     <span class="keywordflow">if</span> (fActive) {
00670         rgbLeft = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;argbSystem[COLOR_ACTIVECAPTION];
00671         rgbRight = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;argbSystem[COLOR_GRADIENTACTIVECAPTION];
00672     } <span class="keywordflow">else</span> {
00673         rgbLeft = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;argbSystem[COLOR_INACTIVECAPTION];
00674         rgbRight = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;argbSystem[COLOR_GRADIENTINACTIVECAPTION];
00675     }
00676     <span class="keywordflow">if</span> (rgbLeft != rgbRight) {
00677         <a class="code" href="../../d1/d5/caption_8c.html#a13">FillGradient</a>(hdc, prc, rgbLeft, rgbRight);
00678     } <span class="keywordflow">else</span> {
00679         <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a3">FillRect</a>(hdc, prc, fActive ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(ACTIVECAPTION) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(INACTIVECAPTION));
00680     }
00681 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="caption.c::FillGradient" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void FillGradient           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPCRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>prc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>COLORREF&nbsp;</td>
          <td class="mdname" nowrap> <em>rgbLeft</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>COLORREF&nbsp;</td>
          <td class="mdname" nowrap> <em>rgbRight</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00643">643</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
References <a class="el" href="../../d1/d5/caption_8c.html#a7">GetCOLOR16</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00665">FillCaptionGradient()</a>.
<p>
<pre class="fragment"><div>00644 {
00645     TRIVERTEX avert[4];
00646     <span class="keyword">static</span> GRADIENT_RECT auRect[1] = {0,1};
00647 <span class="preprocessor">    #define GetCOLOR16(RGB, clr) ((COLOR16)(Get ## RGB ## Value(clr) &lt;&lt; 8))</span>
00648 <span class="preprocessor"></span>
00649     avert[0].Red = <a class="code" href="../../d1/d5/caption_8c.html#a7">GetCOLOR16</a>(R, rgbLeft);
00650     avert[0].Green = <a class="code" href="../../d1/d5/caption_8c.html#a7">GetCOLOR16</a>(G, rgbLeft);
00651     avert[0].Blue = <a class="code" href="../../d1/d5/caption_8c.html#a7">GetCOLOR16</a>(B, rgbLeft);
00652 
00653     avert[1].Red = <a class="code" href="../../d1/d5/caption_8c.html#a7">GetCOLOR16</a>(R, rgbRight);
00654     avert[1].Green = <a class="code" href="../../d1/d5/caption_8c.html#a7">GetCOLOR16</a>(G, rgbRight);
00655     avert[1].Blue = <a class="code" href="../../d1/d5/caption_8c.html#a7">GetCOLOR16</a>(B, rgbRight);
00656 
00657     avert[0].x = prc-&gt;left;
00658     avert[0].y = prc-&gt;top;
00659     avert[1].x = prc-&gt;right;
00660     avert[1].y = prc-&gt;bottom;
00661 
00662     GreGradientFill(hdc, avert, 2,(PVOID)auRect, 1, GRADIENT_FILL_RECT_H);
00663 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="caption.c::xxxCalcCaptionButton" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> xxxCalcCaptionButton           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>iButton</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pcmd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>prcBtn</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPWORD&nbsp;</td>
          <td class="mdname" nowrap> <em>pbm</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00030">30</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
References <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00052">CopyInflateRect()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00582">GetWindowBorders()</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00165">InflateRect()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00959">OBI_CLOSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01000">OBI_CLOSE_PAL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00970">OBI_HELP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00963">OBI_REDUCE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00967">OBI_RESTORE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00973">OBI_ZOOM</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01838">tagWND::rcWindow</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02368">WEFCONTEXTHELP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02364">WEFTOOLWINDOW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02400">WFMAXBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02415">WFMAXIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02402">WFMINBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02420">WFMINIMIZED</a>, and <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html#l00078">xxxMNCanClose()</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00158">xxxTrackCaptionButton()</a>.
<p>
<pre class="fragment"><div>00031 {
00032     <span class="keywordtype">int</span> x, y, cBorders, cxS, cyS;
00033 
00034     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00035 
00036     *pcmd = 0;
00037 
00038     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED)) {
00039 
00040         x = -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFIXEDFRAME);
00041         y = -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYFIXEDFRAME);
00042 
00043     } <span class="keywordflow">else</span> {
00044 
00045         cBorders = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a7">GetWindowBorders</a>(pwnd-&gt;style, pwnd-&gt;ExStyle, TRUE, FALSE);
00046         x = -cBorders * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER);
00047         y = -cBorders * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
00048     }
00049 
00050     <a class="code" href="../../d3/d6/rect_8c.html#a2">CopyInflateRect</a>(prcBtn, &amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>, x, y);
00051 
00052     x = -pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left;
00053     y = -pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.top;
00054 
00055     <span class="comment">/*</span>
00056 <span class="comment">     * Get real caption area:  subtract final border underneath caption</span>
00057 <span class="comment">     * that separates it from everything else.</span>
00058 <span class="comment">     */</span>
00059     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFTOOLWINDOW)) {
00060         cxS = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMSIZE);
00061         cyS = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMSIZE);
00062     } <span class="keywordflow">else</span> {
00063         cxS = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE);
00064         cyS = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE);
00065     }
00066 
00067     <span class="keywordflow">if</span> (iButton == INDEX_TITLEBAR_CLOSEBUTTON) {
00068 
00069         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a1">xxxMNCanClose</a>(pwnd)) {
00070             *pbm  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFTOOLWINDOW) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a308">OBI_CLOSE_PAL</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a267">OBI_CLOSE</a>;
00071             *pcmd = SC_CLOSE;
00072         }
00073 
00074     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iButton == INDEX_TITLEBAR_MINBUTTON) {
00075 
00076         <span class="comment">/*</span>
00077 <span class="comment">         * Reduce button isn't last button, so shift left by one button</span>
00078 <span class="comment">         */</span>
00079         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINBOX)) {
00080 
00081             prcBtn-&gt;right -= cxS * 2;
00082             x += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
00083 
00084             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED)) {
00085                 *pbm  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a275">OBI_RESTORE</a>;
00086                 *pcmd = SC_RESTORE;
00087             } <span class="keywordflow">else</span> {
00088                 *pbm  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a271">OBI_REDUCE</a>;
00089                 *pcmd = SC_MINIMIZE;
00090             }
00091         }
00092 
00093     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iButton == INDEX_TITLEBAR_MAXBUTTON) {
00094 
00095         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXBOX)) {
00096 
00097             prcBtn-&gt;right -= cxS;
00098 
00099             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXIMIZED)) {
00100                 *pbm  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a275">OBI_RESTORE</a>;
00101                 *pcmd = SC_RESTORE;
00102             } <span class="keywordflow">else</span> {
00103                 *pbm  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a281">OBI_ZOOM</a>;
00104                 *pcmd = SC_MAXIMIZE;
00105             }
00106         }
00107 
00108     } <span class="keywordflow">else</span> { <span class="comment">// iButton == INDEX_TITLEBAR_HELPBUTTON</span>
00109 
00110         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFCONTEXTHELP)) {
00111             prcBtn-&gt;right -= cxS;
00112 
00113             *pbm = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a278">OBI_HELP</a>;
00114             *pcmd = SC_CONTEXTHELP;
00115         }
00116     }
00117 
00118     <span class="keywordflow">if</span> (*pcmd) {
00119 
00120         prcBtn-&gt;bottom = prcBtn-&gt;top + cyS;
00121         prcBtn-&gt;left   = prcBtn-&gt;right - cxS;
00122 
00123         <span class="comment">/*</span>
00124 <span class="comment">         * Adjust 'x' and 'y' to window coordinates</span>
00125 <span class="comment">         */</span>
00126         x += prcBtn-&gt;left;
00127         y += prcBtn-&gt;top + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
00128 
00129         <span class="comment">/*</span>
00130 <span class="comment">         * rcBtn (screen coords hit rect) has a one-border tolerance all</span>
00131 <span class="comment">         * around</span>
00132 <span class="comment">         */</span>
00133         <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(prcBtn, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER), <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
00134 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00135 <span class="preprocessor"></span>            <span class="comment">//Mirror the rect because the buttons in the left hand side of the window if it mirrored</span>
00136             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYOUTRTL)) {
00137                 cxS           = prcBtn-&gt;right - prcBtn-&gt;left;
00138                 prcBtn-&gt;right = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.right - (prcBtn-&gt;left - pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o6">rcWindow</a>.left);
00139                 prcBtn-&gt;left  = prcBtn-&gt;right - cxS;
00140             }
00141 <span class="preprocessor">#endif</span>
00142 <span class="preprocessor"></span>    }
00143 
00144     <span class="keywordflow">return</span> (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)MAKELONG(x, y);
00145 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="caption.c::xxxDrawCaptionBar" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID xxxDrawCaptionBar           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>wFlags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00986">986</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
References <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00029">BitBltSysBmp()</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d6/d1/hungapp_8c-source.html#l00057">ClearHungFlag()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01020">tagOEMBITMAPINFO::cx</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01021">tagOEMBITMAPINFO::cy</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00719">DF_3DFACE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00715">DF_ACTIVEBORDER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00716">DF_INACTIVEBORDER</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00953">DOBI_CAPOFF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00946">DOBI_INACTIVE</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00896">DrawEdge()</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l01188">DrawFrame()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00856">GetRect()</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00582">GetWindowBorders()</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03421">GRECT_WINDOW</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l03425">GRECT_WINDOWCOORDS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02138">HDCBITS</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00033">HEBREW_UI_LANGID</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00165">InflateRect()</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00537">IsVisible()</a>, <a class="el" href="../../d6/d3/tokendup_8c.html#a0">MAX</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00016">MIN</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00020">NOCLOSE</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00019">NOMAX</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00018">NOMIN</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00022">NOSIZE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00998">OBI_CAPBTNS</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00959">OBI_CLOSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01000">OBI_CLOSE_PAL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00970">OBI_HELP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00963">OBI_REDUCE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00966">OBI_REDUCE_I</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00967">OBI_RESTORE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00973">OBI_ZOOM</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00976">OBI_ZOOM_I</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00021">SMCAP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00236">SYSHBRUSH</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06672">TestALPHA</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d2/d7/hal_8h.html#a212">VOID()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02368">WEFCONTEXTHELP</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02357">WEFDLGMODALFRAME</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02367">WEFEDGEMASK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02378">WEFSTATICEDGE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02364">WEFTOOLWINDOW</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l02470">WEFTRUNCATEDCAPTION</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02365">WEFWINDOWEDGE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02411">WFBORDERMASK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02262">WFCPRESENT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02400">WFMAXBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02415">WFMAXIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02402">WFMINBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02420">WFMINIMIZED</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02308">WFOLDUI</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02299">WFREDRAWFRAMEIFHUNG</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02404">WFSIZEBOX</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02405">WFSYSMENU</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02319">WFWIN40COMPAT</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01018">tagOEMBITMAPINFO::x</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00688">xxxDrawCaptionTemp()</a>, <a class="el" href="../../d6/d6/ntuser_2rtl_2menu_8c-source.html#l00078">xxxMNCanClose()</a>, and <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01019">tagOEMBITMAPINFO::y</a>.
<p>
Referenced by <a class="el" href="../../d2/d1/drawfrm_8c-source.html#l00076">xxxDrawWindowFrame()</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l00696">xxxDWP_DoNCActivate()</a>, <a class="el" href="../../d6/d1/hungapp_8c-source.html#l00107">xxxRedrawHungWindowFrame()</a>, and <a class="el" href="../../d9/d2/dwp_8c-source.html#l00766">xxxRedrawTitle()</a>.
<p>
<pre class="fragment"><div>00990 {
00991     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   bm = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a267">OBI_CLOSE</a>;
00992     RECT   rcWindow;
00993     HBRUSH hBrush = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00994     HBRUSH hCapBrush;
00995     <span class="keywordtype">int</span>    colorBorder;
00996     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   wBtns;
00997     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   wCode;
00998 
00999     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
01000 
01001     <span class="comment">/*</span>
01002 <span class="comment">     * If we're not currently showing on the screen, return.</span>
01003 <span class="comment">     * NOTE</span>
01004 <span class="comment">     * If you remove the IsVisible() check from DrawWindowFrame(), then</span>
01005 <span class="comment">     * be careful to remove the NC_NOVISIBLE flag too.  This is a smallish</span>
01006 <span class="comment">     * speed thing, so that we don't have to call IsVisible() twice on a</span>
01007 <span class="comment">     * window.  DrawWindowFrame() already checks.</span>
01008 <span class="comment">     */</span>
01009     <span class="keywordflow">if</span> (!(wFlags &amp; DC_NOVISIBLE) &amp;&amp; !<a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a6">IsVisible</a>(pwnd))
01010         <span class="keywordflow">return</span>;
01011 
01012     <span class="comment">/*</span>
01013 <span class="comment">     * Clear this flag so we know the frame has been drawn.</span>
01014 <span class="comment">     */</span>
01015     <a class="code" href="../../d4/d1/userk_8h.html#a1126">ClearHungFlag</a>(pwnd, WFREDRAWFRAMEIFHUNG);
01016 
01017     <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a12">GetRect</a>(pwnd, &amp;rcWindow, GRECT_WINDOW | GRECT_WINDOWCOORDS);
01018     <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a666">TestALPHA</a>(GRADIENTCAPTIONS)) {
01019         hCapBrush = (wFlags &amp; DC_ACTIVE) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(GRADIENTACTIVECAPTION) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(GRADIENTINACTIVECAPTION);
01020     } <span class="keywordflow">else</span> {
01021         hCapBrush = (wFlags &amp; DC_ACTIVE) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(ACTIVECAPTION) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(INACTIVECAPTION);
01022     }
01023 
01024     wCode = 0;
01025 
01026     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7/ntuser_2rtl_2menu_8c.html#a1">xxxMNCanClose</a>(pwnd))
01027         wCode |= <a class="code" href="../../d1/d5/caption_8c.html#a4">NOCLOSE</a>;
01028 
01029     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXBOX))
01030         wCode |= <a class="code" href="../../d1/d5/caption_8c.html#a3">NOMAX</a>;
01031     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMAXIMIZED))
01032         wCode |= <a class="code" href="../../d6/d3/tokendup_8c.html#a0">MAX</a>;
01033 
01034     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINBOX))
01035           wCode |= <a class="code" href="../../d1/d5/caption_8c.html#a2">NOMIN</a>;
01036     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED))
01037           wCode |= <a class="code" href="../../d1/d5/caption_8c.html#a0">MIN</a>;
01038 
01039     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFMINIMIZED)) {
01040 
01041         <span class="keywordflow">if</span> (wFlags &amp; DC_FRAME) {
01042 
01043             <span class="comment">/*</span>
01044 <span class="comment">             * Raised outer edge + border</span>
01045 <span class="comment">             */</span>
01046             <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a15">DrawEdge</a>(hdc, &amp;rcWindow, EDGE_RAISED, (BF_RECT | BF_ADJUST));
01047             <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a17">DrawFrame</a>(hdc, &amp;rcWindow, 1, DF_3DFACE);
01048             <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcWindow, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
01049 
01050         } <span class="keywordflow">else</span> {
01051             <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcWindow, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXFIXEDFRAME), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYFIXEDFRAME));
01052         }
01053 
01054         rcWindow.bottom = rcWindow.top + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE);
01055 
01056         hBrush = GreSelectBrush(hdc, hCapBrush);
01057 
01058     } <span class="keywordflow">else</span> {
01059         <span class="comment">/*</span>
01060 <span class="comment">         * BOGUS</span>
01061 <span class="comment">         * What color should we draw borders in?  The check is NOT simple.</span>
01062 <span class="comment">         * At create time, we set the 3D bits.  NCCREATE will also</span>
01063 <span class="comment">         * set them for listboxes, edit fields,e tc.</span>
01064 <span class="comment">         */</span>
01065         colorBorder = (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFEDGEMASK) &amp;&amp; !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFOLDUI)) ? COLOR_3DFACE : COLOR_WINDOWFRAME;
01066 
01067         <span class="comment">/*</span>
01068 <span class="comment">         * Draw the window frame.</span>
01069 <span class="comment">         */</span>
01070         <span class="keywordflow">if</span> (wFlags &amp; DC_FRAME) {
01071             <span class="comment">/*</span>
01072 <span class="comment">             * Window edge</span>
01073 <span class="comment">             */</span>
01074             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFWINDOWEDGE))
01075                 <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a15">DrawEdge</a>(hdc, &amp;rcWindow, EDGE_RAISED, BF_RECT | BF_ADJUST);
01076             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFSTATICEDGE))
01077                 <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a15">DrawEdge</a>(hdc, &amp;rcWindow, BDR_SUNKENOUTER, BF_RECT | BF_ADJUST);
01078 
01079             <span class="comment">/*</span>
01080 <span class="comment">             * Size border</span>
01081 <span class="comment">             */</span>
01082             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSIZEBOX)) {
01083 
01084                 <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a17">DrawFrame</a>(hdc,
01085                           &amp;rcWindow,
01086                           <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder,
01087                           ((wFlags &amp; DC_ACTIVE) ? DF_ACTIVEBORDER : DF_INACTIVEBORDER));
01088 
01089                 <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcWindow,
01090                             -<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER),
01091                             -<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;gclBorder * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
01092             }
01093 
01094             <span class="comment">/*</span>
01095 <span class="comment">             * Normal border</span>
01096 <span class="comment">             */</span>
01097             <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFBORDERMASK) || <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFDLGMODALFRAME)) {
01098                 <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a17">DrawFrame</a>(hdc, &amp;rcWindow, 1, (colorBorder &lt;&lt; 3));
01099                 <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcWindow, -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER), -<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
01100             }
01101         } <span class="keywordflow">else</span> {
01102 
01103             <span class="keywordtype">int</span> cBorders;
01104 
01105             cBorders = <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a7">GetWindowBorders</a>(pwnd-&gt;style, pwnd-&gt;ExStyle, TRUE, FALSE);
01106 
01107             <a class="code" href="../../d3/d6/rect_8c.html#a7">InflateRect</a>(&amp;rcWindow,
01108                         -cBorders * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXBORDER),
01109                         -cBorders * <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER));
01110         }
01111 
01112         <span class="comment">/*</span>
01113 <span class="comment">         * Punt if the window doesn't have a caption currently showing on screen.</span>
01114 <span class="comment">         */</span>
01115         <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFCPRESENT))
01116             <span class="keywordflow">return</span>;
01117 
01118         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFTOOLWINDOW)) {
01119             wCode |= <a class="code" href="../../d1/d5/caption_8c.html#a5">SMCAP</a>;
01120             rcWindow.bottom = rcWindow.top + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSMSIZE);
01121             bm = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a308">OBI_CLOSE_PAL</a>;
01122         } <span class="keywordflow">else</span>
01123             rcWindow.bottom = rcWindow.top + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYSIZE);
01124 
01125 <span class="preprocessor">#if 0</span>
01126 <span class="preprocessor"></span>        <span class="comment">/* Draw the border beneath the caption.</span>
01127 <span class="comment">         *</span>
01128 <span class="comment">         *</span>
01129 <span class="comment">         * hBrush = GreSelectBrush(hdc, gpsi-&gt;ahbrSystem[colorBorder]);</span>
01130 <span class="comment">         *GrePatBlt(hdc, rcWindow.left, rcWindow.bottom,</span>
01131 <span class="comment">         *        rcWindow.right - rcWindow.left,</span>
01132 <span class="comment">         *        SYSMET(CYBORDER), PATCOPY);</span>
01133 <span class="comment">         */</span>
01134 <span class="preprocessor">#endif</span>
01135 <span class="preprocessor"></span>
01136         {
01137             POLYPATBLT PolyData;
01138 
01139             PolyData.x         = rcWindow.left;
01140             PolyData.y         = rcWindow.bottom;
01141             PolyData.cx        = rcWindow.right - rcWindow.left;
01142             PolyData.cy        = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYBORDER);
01143             PolyData.BrClr.hbr = <a class="code" href="../../d1/d0/inc_2user_8h.html#a15">SYSHBRUSH</a>(colorBorder);
01144 
01145             GrePolyPatBlt(hdc,PATCOPY,&amp;PolyData,1,PPB_BRUSH);
01146         }
01147 
01148         GreSelectBrush(hdc, hCapBrush);
01149     }
01150 
01151     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSYSMENU) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT))
01152         <span class="keywordflow">goto</span> JustDrawIt;
01153 
01154     <span class="comment">/*</span>
01155 <span class="comment">     * New Rules:</span>
01156 <span class="comment">     *  (1) The caption has a horz border beneath it separating it from the</span>
01157 <span class="comment">     *      menu or client.</span>
01158 <span class="comment">     *  (2) The caption text area has an edge of space on the left and right</span>
01159 <span class="comment">     *      before the characters.</span>
01160 <span class="comment">     *  (3) We account for the descent below the baseline of the caption char</span>
01161 <span class="comment">     */</span>
01162     wBtns = 1;
01163 
01164     <span class="keywordflow">if</span> (!(wFlags &amp; DC_BUTTONS)) {
01165 
01166         <span class="keywordflow">if</span> ((!wCode) || (!(wCode &amp; <a class="code" href="../../d1/d5/caption_8c.html#a5">SMCAP</a>) &amp;&amp; ((wCode &amp; <a class="code" href="../../d1/d5/caption_8c.html#a6">NOSIZE</a>) != <a class="code" href="../../d1/d5/caption_8c.html#a6">NOSIZE</a>))) {
01167 
01168             wBtns += 2;
01169 
01170         } <span class="keywordflow">else</span> {
01171 
01172             rcWindow.right -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
01173 
01174             <span class="keywordflow">if</span> ((wCode == <a class="code" href="../../d1/d5/caption_8c.html#a6">NOSIZE</a>) &amp;&amp; (wCode &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFCONTEXTHELP)))
01175                 wBtns++;
01176         }
01177 
01178         rcWindow.right -= wBtns * ((wCode &amp; <a class="code" href="../../d1/d5/caption_8c.html#a5">SMCAP</a>) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMSIZE) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE));
01179 
01180         <span class="keywordflow">goto</span> JustDrawIt;
01181     }
01182 
01183     <span class="keywordflow">if</span> (!wCode || (wCode == <a class="code" href="../../d1/d5/caption_8c.html#a6">NOSIZE</a>)) {
01184         <a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html">POEMBITMAPINFO</a> pOem = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a306">OBI_CAPBTNS</a>;
01185         <span class="keywordtype">int</span>            cx;
01186 
01187         cx = (wCode ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE) * 3);
01188 
01189         <span class="keywordflow">if</span> (!(wFlags &amp; DC_ACTIVE))
01190             pOem += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a264">DOBI_CAPOFF</a>;
01191 
01192         rcWindow.right -= cx;
01193 
01194         GreBitBlt(hdc,
01195                   rcWindow.right,
01196                   rcWindow.top,
01197                   cx,
01198                   pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>,
01199                   <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(),
01200                   pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a> + pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE) - cx,
01201                   pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a>,
01202                   SRCCOPY,
01203                   0);
01204 
01205         <span class="keywordflow">if</span> (wCode &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFCONTEXTHELP)) {
01206 
01207             rcWindow.right -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE) - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
01208 
01209             GreBitBlt(hdc,
01210                       rcWindow.right,
01211                       rcWindow.top,
01212                       <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE),
01213                       pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>,
01214                       <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(),
01215                       pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a> + pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE),
01216                       pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a>,
01217                       SRCCOPY,
01218                       0);
01219 <span class="preprocessor">#ifdef USE_MIRRORING</span>
01220 <span class="preprocessor"></span>            <span class="comment">/*</span>
01221 <span class="comment">             * If the UI language is Hebrew we do not want to mirror the ? mark only</span>
01222 <span class="comment">             * Then redraw ? with out the button frame.</span>
01223 <span class="comment">             */</span>
01224             <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a4">HEBREW_UI_LANGID</a>() &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFLAYOUTRTL)) {
01225                 GreBitBlt(hdc,
01226                           rcWindow.right-<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE),
01227                           rcWindow.top+2,
01228                           <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE)-<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE)*2,
01229                           pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o3">cy</a>-4,
01230                           <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a527">HDCBITS</a>(),
01231                           pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o0">x</a> + pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o2">cx</a> - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE) + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE),
01232                           pOem-&gt;<a class="code" href="../../d0/d3/structtagOEMBITMAPINFO.html#o1">y</a> + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE),
01233                           SRCCOPY|NOMIRRORBITMAP,
01234                           0);
01235             }
01236 <span class="preprocessor">#endif</span>
01237 <span class="preprocessor"></span>        }
01238         <span class="keywordflow">goto</span> JustDrawIt;
01239     }
01240 
01241     <span class="comment">/*</span>
01242 <span class="comment">     * Draw the caption buttons</span>
01243 <span class="comment">     */</span>
01244     rcWindow.top    += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
01245     rcWindow.bottom -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
01246 
01247     rcWindow.right -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
01248 
01249     GrePatBlt(hdc,
01250               rcWindow.right,
01251               rcWindow.top,
01252               <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE),
01253               rcWindow.bottom - rcWindow.top,
01254               PATCOPY);
01255 
01256     <span class="keywordflow">if</span> (wCode &amp; <a class="code" href="../../d1/d5/caption_8c.html#a4">NOCLOSE</a>) {
01257         bm += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a259">DOBI_INACTIVE</a>;
01258     }
01259 
01260     rcWindow.right -= <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[bm].cx;
01261     <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(hdc, rcWindow.right, rcWindow.top, bm);
01262 
01263     <span class="keywordflow">if</span> (!(wCode &amp; <a class="code" href="../../d1/d5/caption_8c.html#a5">SMCAP</a>) &amp;&amp; ((wCode &amp; <a class="code" href="../../d1/d5/caption_8c.html#a6">NOSIZE</a>) != <a class="code" href="../../d1/d5/caption_8c.html#a6">NOSIZE</a>)) {
01264 
01265         rcWindow.right -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
01266 
01267         GrePatBlt(hdc,
01268                   rcWindow.right,
01269                   rcWindow.top,
01270                   <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE),
01271                   rcWindow.bottom - rcWindow.top,
01272                   PATCOPY);
01273 
01274         <span class="comment">/*</span>
01275 <span class="comment">         * Max Box</span>
01276 <span class="comment">         * If window is maximized use the restore bitmap;</span>
01277 <span class="comment">         * otherwise use the regular zoom bitmap</span>
01278 <span class="comment">         */</span>
01279         bm = (wCode &amp; <a class="code" href="../../d6/d3/tokendup_8c.html#a0">MAX</a>) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a275">OBI_RESTORE</a> : ((wCode &amp; <a class="code" href="../../d1/d5/caption_8c.html#a3">NOMAX</a>) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a284">OBI_ZOOM_I</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a281">OBI_ZOOM</a>);
01280         rcWindow.right -= <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[bm].cx;
01281         <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(hdc, rcWindow.right, rcWindow.top, bm);
01282 
01283         <span class="comment">/*</span>
01284 <span class="comment">         * Min Box</span>
01285 <span class="comment">         */</span>
01286         bm = (wCode &amp; <a class="code" href="../../d1/d5/caption_8c.html#a0">MIN</a>) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a275">OBI_RESTORE</a> : ((wCode &amp; <a class="code" href="../../d1/d5/caption_8c.html#a2">NOMIN</a>) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a274">OBI_REDUCE_I</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a271">OBI_REDUCE</a>);
01287         rcWindow.right -= <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[bm].cx;
01288         <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(hdc, rcWindow.right, rcWindow.top, bm);
01289         rcWindow.right -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
01290         GrePatBlt(hdc,
01291                   rcWindow.right,
01292                   rcWindow.top,
01293                   <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE),
01294                   rcWindow.bottom - rcWindow.top,
01295                   PATCOPY);
01296 
01297         wBtns += 2;
01298     }
01299 
01300     <span class="keywordflow">if</span> ((wCode &amp; (<a class="code" href="../../d1/d5/caption_8c.html#a4">NOCLOSE</a> | <a class="code" href="../../d1/d5/caption_8c.html#a6">NOSIZE</a>)) &amp;&amp;
01301         (!(wCode &amp; <a class="code" href="../../d1/d5/caption_8c.html#a5">SMCAP</a>)) &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFCONTEXTHELP)) {
01302 
01303         rcWindow.right -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
01304 
01305         GrePatBlt(hdc,
01306                   rcWindow.right,
01307                   rcWindow.top,
01308                   <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE),
01309                   rcWindow.bottom - rcWindow.top,
01310                   PATCOPY);
01311 
01312 
01313         bm = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a278">OBI_HELP</a>;
01314         rcWindow.right -= <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;oembmi[bm].cx;
01315         <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(hdc, rcWindow.right, rcWindow.top, bm);
01316 
01317         wBtns++;
01318     }
01319 
01320     rcWindow.top    -= <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
01321     rcWindow.bottom += <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
01322 
01323     wBtns *= (wCode &amp; <a class="code" href="../../d1/d5/caption_8c.html#a5">SMCAP</a>) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSMSIZE) : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXSIZE);
01324 
01325     {
01326         POLYPATBLT PolyData[2];
01327 
01328         PolyData[0].x         = rcWindow.right;
01329         PolyData[0].y         = rcWindow.top;
01330         PolyData[0].cx        = wBtns;
01331         PolyData[0].cy        = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
01332         PolyData[0].BrClr.hbr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01333 
01334         PolyData[1].x         = rcWindow.right;
01335         PolyData[1].y         = rcWindow.bottom - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
01336         PolyData[1].cx        = wBtns;
01337         PolyData[1].cy        = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE);
01338         PolyData[1].BrClr.hbr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
01339 
01340         GrePolyPatBlt(hdc,PATCOPY,&amp;PolyData[0],2,PPB_BRUSH);
01341     }
01342 
01343 <span class="preprocessor">#if 0</span>
01344 <span class="preprocessor"></span>    GrePatBlt(hdc, rcWindow.right, rcWindow.top, wBtns, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE), PATCOPY);
01345     GrePatBlt(hdc, rcWindow.right, rcWindow.bottom - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE), wBtns, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CYEDGE), PATCOPY);
01346 <span class="preprocessor">#endif</span>
01347 <span class="preprocessor"></span>
01348     <span class="comment">/*</span>
01349 <span class="comment">     * We're going to release this DC--we don't need to bother reselecting</span>
01350 <span class="comment">     * in the old brush</span>
01351 <span class="comment">     */</span>
01352     <span class="keywordflow">if</span> (hBrush)
01353         GreSelectBrush(hdc, hBrush);
01354 
01355 JustDrawIt:
01356 
01357     <span class="comment">/*</span>
01358 <span class="comment">     * Call DrawCaption only if we need to draw the icon or the text</span>
01359 <span class="comment">     * If the text gets truncated, set the window flag for</span>
01360 <span class="comment">     * the caption tooltip</span>
01361 <span class="comment">     */</span>
01362     <span class="keywordflow">if</span> (wFlags &amp; (DC_TEXT | DC_ICON)) {
01363         <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1935">xxxDrawCaptionTemp</a>(pwnd,
01364                                hdc,
01365                                &amp;rcWindow,
01366                                NULL,
01367                                NULL,
01368                                NULL,
01369                                wFlags | ((wCode &amp; SMCAP)  ? DC_SMALLCAP : 0) |
01370                                (<a class="code" href="../../d4/d1/userk_8h.html#a666">TestALPHA</a>(GRADIENTCAPTIONS) ? DC_GRADIENT : 0))) {
01371             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, WEFTRUNCATEDCAPTION);
01372         } <span class="keywordflow">else</span> {
01373             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, WEFTRUNCATEDCAPTION);
01374         }
01375     }
01376 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="caption.c::xxxDrawCaptionTemp" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOL xxxDrawCaptionTemp           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HDC&nbsp;</td>
          <td class="mdname" nowrap> <em>hdc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>LPRECT&nbsp;</td>
          <td class="mdname" nowrap> <em>lprc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>HFONT&nbsp;</td>
          <td class="mdname" nowrap> <em>hFont</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pcursor</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>pstrText</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>flags</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00688">688</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
References <a class="el" href="../../d0/d6/kernel_2server_8c-source.html#l01187">_GetTextMetricsW()</a>, <a class="el" href="../../d3/d7/rtl_2winmgr_8c-source.html#l00763">_HasCaptionIcon()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l03529">CALL_LPK</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02735">CCHTITLEMAX</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00462">DrawCaptionIcon()</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00665">FillCaptionGradient()</a>, <a class="el" href="../../d0/d1/rtl_2draw_8c-source.html#l00061">FillRect()</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00302">gcyCaptionFontChar</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00305">gcySmCaptionFontChar</a>, <a class="el" href="../../d4/d5/ntuser_2kernel_2globals_8c-source.html#l00303">ghSmCaptionFont</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1136">GreGetTextAlign()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign()</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l00463">_LARGE_UNICODE_STRING::Length</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00059">PtiCurrentShared</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01855">tagWND::strName</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00212">SYSHBR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00202">SYSMET</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00204">SYSRGB</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d2/d4/w32_2ntuser_2rtl_2random_8c-source.html#l00108">TextCopy()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d5/ndismain_8h-source.html#l00026">UINT</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02372">WEFRIGHT</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02373">WEFRTLREADING</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02405">WFSYSMENU</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l02070">WINDOW</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1411">xxxClientExtTextOutW()</a>, <a class="el" href="../../d4/d1/userk_8h.html#a1412">xxxClientGetTextExtentPointW()</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00306">xxxGetWindowSmIcon()</a>, and <a class="el" href="../../d0/d7/kernel_2winmgr_8c-source.html#l00257">xxxGetWindowText()</a>.
<p>
Referenced by <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l04852">NtUserDrawCaption()</a>, <a class="el" href="../../d0/d9/kernel_2ntstubs_8c-source.html#l09490">NtUserDrawCaptionTemp()</a>, <a class="el" href="../../d5/d8/minmax_8c-source.html#l00558">xxxAnimateCaption()</a>, and <a class="el" href="../../d2/d4/caption_8c-source.html#l00986">xxxDrawCaptionBar()</a>.
<p>
<pre class="fragment"><div>00696 {
00697     <span class="keywordtype">int</span>    iOldMode;
00698     HBRUSH hbrFill;
00699     LONG   clrOldText;
00700     LONG   clrOldBk;
00701     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fItFit = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00702     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>   fGradient = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00703     SIZE   size;
00704     <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>   oldAlign;
00705 
00706     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00707 
00708     <span class="keywordflow">if</span> (lprc-&gt;right &lt;= lprc-&gt;left)
00709         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00710 
00711     <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00712 
00713         <span class="keywordflow">if</span> (!pcursor               &amp;&amp;
00714             <a class="code" href="../../d2/d8/rtl_2winmgr_8c.html#a10">_HasCaptionIcon</a>(pwnd)  &amp;&amp;
00715             !(flags &amp; DC_SMALLCAP) &amp;&amp;
00716             <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFSYSMENU)) {
00717 
00718             <span class="comment">/*</span>
00719 <span class="comment">             * Only get the icon if we can send messages AND the window has</span>
00720 <span class="comment">             * a system menu.</span>
00721 <span class="comment">             */</span>
00722             pcursor = <a class="code" href="../../d4/d1/userk_8h.html#a1437">xxxGetWindowSmIcon</a>(pwnd, (flags &amp; DC_NOSENDMSG));
00723         }
00724     }
00725 
00726     <span class="comment">/*</span>
00727 <span class="comment">     * Set up the colors</span>
00728 <span class="comment">     */</span>
00729     <span class="keywordflow">if</span> (flags &amp; DC_ACTIVE) {
00730 
00731         <span class="keywordflow">if</span> (flags &amp; DC_INBUTTON) {
00732             <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;BitCount &lt; 8 ||
00733                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DHILIGHT) != <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(SCROLLBAR) ||
00734                     <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DHILIGHT) == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(WINDOW)) {
00735                 clrOldText = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DFACE);
00736                 clrOldBk   = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DHILIGHT);
00737                 hbrFill    = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hbrGray;
00738                 iOldMode   = GreSetBkMode(hdc, TRANSPARENT);
00739             } <span class="keywordflow">else</span> {
00740                 clrOldText = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(BTNTEXT);
00741                 clrOldBk   = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DHILIGHT);
00742                 hbrFill    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DHILIGHT);
00743             }
00744 
00745         } <span class="keywordflow">else</span> {
00746             clrOldText = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(CAPTIONTEXT);
00747             clrOldBk   = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(ACTIVECAPTION);
00748             hbrFill    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(ACTIVECAPTION);
00749 
00750             <span class="keywordflow">if</span> (flags &amp; DC_GRADIENT) {
00751                 fGradient = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00752                 iOldMode = GreSetBkMode(hdc, TRANSPARENT);
00753             }
00754         }
00755 
00756     } <span class="keywordflow">else</span> {
00757 
00758         <span class="keywordflow">if</span> (flags &amp; DC_INBUTTON) {
00759             clrOldText = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(BTNTEXT);
00760             clrOldBk   = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(3DFACE);
00761             hbrFill    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(3DFACE);
00762         } <span class="keywordflow">else</span> {
00763             clrOldText = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(INACTIVECAPTIONTEXT);
00764             clrOldBk   = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(INACTIVECAPTION);
00765             hbrFill    = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a22">SYSHBR</a>(INACTIVECAPTION);
00766 
00767             <span class="keywordflow">if</span> (flags &amp; DC_GRADIENT) {
00768                 fGradient = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00769                 iOldMode = GreSetBkMode(hdc, TRANSPARENT);
00770             }
00771         }
00772     }
00773 
00774 
00775     <span class="comment">/*</span>
00776 <span class="comment">     * Set up drawing colors.</span>
00777 <span class="comment">     */</span>
00778     clrOldText = GreSetTextColor(hdc, clrOldText);
00779     clrOldBk   = GreSetBkColor(hdc, clrOldBk);
00780 
00781     <span class="keywordflow">if</span> (pcursor &amp;&amp; !(flags &amp; DC_SMALLCAP)) {
00782 
00783         <span class="keywordflow">if</span> (flags &amp; DC_ICON) {
00784 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00785 <span class="preprocessor"></span>            <span class="comment">/*</span>
00786 <span class="comment">             * Preserve icon shape when BitBlitting it to a</span>
00787 <span class="comment">             * mirrored DC. This way we don't violate copyright</span>
00788 <span class="comment">             * issues on icons. [samera]</span>
00789 <span class="comment">             */</span>
00790             <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwLayout=0<a class="code" href="../../d2/d0/aw_8h.html#a3">L</a>;
00791             <span class="keywordflow">if</span> ((dwLayout=GreGetLayout(hdc)) &amp; LAYOUT_RTL)
00792                 GreSetLayout(hdc, -1, dwLayout|LAYOUT_BITMAPORIENTATIONPRESERVED);
00793 <span class="preprocessor">#endif</span>
00794 <span class="preprocessor"></span>            <a class="code" href="../../d1/d5/caption_8c.html#a12">DrawCaptionIcon</a>(hdc, lprc, pcursor, hbrFill, flags);
00795 
00796 <span class="preprocessor">#ifdef USE_MIRRORING</span>
00797 <span class="preprocessor"></span>            <span class="comment">/*</span>
00798 <span class="comment">             * Restore the DC to its previous layout state.</span>
00799 <span class="comment">             */</span>
00800             <span class="keywordflow">if</span> (dwLayout &amp; LAYOUT_RTL)
00801                 GreSetLayout(hdc, -1, dwLayout);
00802 <span class="preprocessor">#endif</span>
00803 <span class="preprocessor"></span>
00804         } <span class="keywordflow">else</span> {
00805             lprc-&gt;left += lprc-&gt;bottom - lprc-&gt;top;
00806         }
00807     }
00808 
00809     <span class="keywordflow">if</span> (flags &amp; DC_TEXT) {
00810         <span class="keywordtype">int</span>            cch;
00811         HFONT          hfnOld;
00812         <span class="keywordtype">int</span>            yCentered;
00813         WCHAR          szText[<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a768">CCHTITLEMAX</a>];
00814         UNICODE_STRING strTmp;
00815         <a class="code" href="../../d2/d8/structtagTHREADINFO.html">PTHREADINFO</a> ptiCurrent = <a class="code" href="../../d4/d1/userk_8h.html#a10">PtiCurrentShared</a>();
00816 
00817         <span class="comment">/*</span>
00818 <span class="comment">         * Note -- the DC_NOSENDMSG check is not in Chicago.  It needs to be,</span>
00819 <span class="comment">         * since GetWindowText calls back to the window.  FritzS</span>
00820 <span class="comment">         */</span>
00821 
00822         <span class="comment">/*</span>
00823 <span class="comment">         *  Get the text for the caption.</span>
00824 <span class="comment">         */</span>
00825         <span class="keywordflow">if</span> (pstrText == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00826 
00827             <span class="keywordflow">if</span> ((pwnd == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) || (flags &amp; DC_NOSENDMSG)) {
00828 
00829                 <span class="keywordflow">if</span> (pwnd &amp;&amp; pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>.<a class="code" href="../../d2/d9/struct__LARGE__UNICODE__STRING.html#o0">Length</a>) {
00830                     cch = <a class="code" href="../../d1/d5/w32_2ntuser_2rtl_2random_8c.html#a2">TextCopy</a>(&amp;pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o17">strName</a>, szText, CCHTITLEMAX - 1);
00831                     strTmp.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(cch * <span class="keyword">sizeof</span>(WCHAR));
00832                 } <span class="keywordflow">else</span> {
00833                     szText[0] = TEXT(<span class="charliteral">'\0'</span>);
00834                     cch = strTmp.Length = 0;
00835                 }
00836 
00837             } <span class="keywordflow">else</span> {
00838                 cch = <a class="code" href="../../d9/d7/kernel_2winmgr_8c.html#a5">xxxGetWindowText</a>(pwnd, szText, CCHTITLEMAX - 1);
00839                 strTmp.Length = (<a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a>)(cch * <span class="keyword">sizeof</span>(WCHAR));
00840             }
00841 
00842             <span class="comment">/*</span>
00843 <span class="comment">             *  We don't use RtlInitUnicodeString() to initialize the string</span>
00844 <span class="comment">             *  because it does a wstrlen() on the string, which is a waste</span>
00845 <span class="comment">             *  since we already know its length.</span>
00846 <span class="comment">             */</span>
00847             strTmp.Buffer = szText;
00848             strTmp.MaximumLength = strTmp.Length + <span class="keyword">sizeof</span>(UNICODE_NULL);
00849             pstrText = &amp;strTmp;
00850 
00851         } <span class="keywordflow">else</span> {
00852             cch = pstrText-&gt;Length / <span class="keyword">sizeof</span>(WCHAR);
00853             UserAssert(pstrText-&gt;Length &lt; pstrText-&gt;MaximumLength);
00854             UserAssert(pstrText-&gt;Buffer[cch] == 0);
00855         }
00856 
00857         <span class="comment">/*</span>
00858 <span class="comment">         *  We need to set up font first, in case we're centering caption.</span>
00859 <span class="comment">         *  Fortunately, no text at all is uncommon...</span>
00860 <span class="comment">         */</span>
00861         <span class="keywordflow">if</span> (hFont == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00862 
00863             <span class="keywordflow">if</span> (flags &amp; DC_SMALLCAP) {
00864                 hFont = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a134">ghSmCaptionFont</a>;
00865                 yCentered = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a136">gcySmCaptionFontChar</a>;
00866             } <span class="keywordflow">else</span> {
00867                 hFont = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hCaptionFont;
00868                 yCentered = <a class="code" href="../../d3/d6/ntuser_2kernel_2globals_8c.html#a133">gcyCaptionFontChar</a>;
00869             }
00870 
00871             yCentered = (lprc-&gt;top + lprc-&gt;bottom - yCentered) / 2;
00872 
00873             hfnOld = GreSelectFont(hdc, hFont);
00874 
00875         } <span class="keywordflow">else</span> {
00876 
00877             TEXTMETRICW tm;
00878 
00879             <span class="comment">/*</span>
00880 <span class="comment">             * UNCOMMON case:  only for control panel</span>
00881 <span class="comment">             */</span>
00882             hfnOld = GreSelectFont(hdc, hFont);
00883 
00884             <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1933">_GetTextMetricsW</a>(hdc, &amp;tm)) {
00885                 RIPMSG0(RIP_WARNING, <span class="stringliteral">"xxxDrawCaptionTemp: _GetTextMetricsW Failed"</span>);
00886                 tm.tmHeight = <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;tmSysFont.tmHeight;
00887             }
00888             yCentered = (lprc-&gt;top + lprc-&gt;bottom - tm.tmHeight) / 2;
00889         }
00890 
00891         <span class="comment">/*</span>
00892 <span class="comment">         * Draw text</span>
00893 <span class="comment">         */</span>
00894         <span class="keywordflow">if</span> (fGradient) {
00895             <a class="code" href="../../d1/d5/caption_8c.html#a14">FillCaptionGradient</a>(hdc, lprc, flags &amp; DC_ACTIVE);
00896         } <span class="keywordflow">else</span> {
00897             <a class="code" href="../../d9/d1/rtl_2draw_8c.html#a3">FillRect</a>(hdc, lprc, hbrFill);
00898         }
00899 
00900         <span class="keywordflow">if</span> (hbrFill == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hbrGray) {
00901             GreSetTextColor(hdc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(BTNTEXT));
00902             GreSetBkColor(hdc, <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a20">SYSRGB</a>(GRAYTEXT));
00903         }
00904 
00905         <span class="comment">/*</span>
00906 <span class="comment">         * GDI doesn't do callbacks to the LPK.  If an LPK is installed</span>
00907 <span class="comment">         * and we're not in thread cleanup mode, call the appropriate</span>
00908 <span class="comment">         * client side GDI routines.</span>
00909 <span class="comment">         */</span>
00910         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(ptiCurrent)) {
00911             <a class="code" href="../../d4/d1/userk_8h.html#a1412">xxxClientGetTextExtentPointW</a>(hdc, pstrText-&gt;Buffer, cch, &amp;size);
00912         } <span class="keywordflow">else</span> {
00913             GreGetTextExtentW(hdc, pstrText-&gt;Buffer, cch, &amp;size, GGTE_WIN3_EXTENT);
00914         }
00915 
00916         <span class="keywordflow">if</span> (pwnd &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFRTLREADING)) {
00917             oldAlign = <a class="code" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign</a>(hdc, TA_RTLREADING | <a class="code" href="../../d4/d1/userk_8h.html#a1136">GreGetTextAlign</a>(hdc));
00918         }
00919         <span class="keywordflow">if</span> (!(flags &amp; DC_CENTER) &amp;&amp; (!cch || (size.cx &lt;= (lprc-&gt;right - lprc-&gt;left - <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE))))) {
00920             <span class="keywordflow">if</span> (pwnd &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFRIGHT)) {
00921                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(ptiCurrent)) {
00922                     <a class="code" href="../../d4/d1/userk_8h.html#a1411">xxxClientExtTextOutW</a>(hdc, lprc-&gt;right - (size.cx + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE)), yCentered,
00923                         ETO_CLIPPED, lprc, pstrText-&gt;Buffer, cch, NULL);
00924                 }
00925                 <span class="keywordflow">else</span> {
00926                     GreExtTextOutW(hdc, lprc-&gt;right - (size.cx + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE)), yCentered,
00927                        ETO_CLIPPED, lprc, pstrText-&gt;Buffer, cch, NULL);
00928                 }
00929             } <span class="keywordflow">else</span> {
00930                 <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a393">CALL_LPK</a>(ptiCurrent)) {
00931                     <a class="code" href="../../d4/d1/userk_8h.html#a1411">xxxClientExtTextOutW</a>(hdc, lprc-&gt;left + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE), yCentered,
00932                         ETO_CLIPPED, lprc, pstrText-&gt;Buffer, cch, NULL);
00933                 }
00934                 <span class="keywordflow">else</span> {
00935                     GreExtTextOutW(hdc, lprc-&gt;left + <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE), yCentered,
00936                         ETO_CLIPPED, lprc, pstrText-&gt;Buffer, cch, NULL);
00937                 }
00938             }
00939         } <span class="keywordflow">else</span> {
00940 
00941             DRAWTEXTPARAMS dtp;
00942             <a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a> wSide;
00943 
00944             dtp.cbSize       = <span class="keyword">sizeof</span>(DRAWTEXTPARAMS);
00945             dtp.iLeftMargin  = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a18">SYSMET</a>(CXEDGE);
00946             dtp.iRightMargin = 0;
00947 
00948             wSide = (flags &amp; DC_CENTER) ? DT_CENTER
00949                                         : ((pwnd &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFRIGHT)) ? DT_RIGHT : 0);
00950 
00951             DrawTextEx(hdc,
00952                        pstrText-&gt;Buffer,
00953                        cch,
00954                        lprc,
00955                        DT_NOPREFIX | DT_END_ELLIPSIS | DT_SINGLELINE | DT_VCENTER |
00956                        wSide, &amp;dtp);
00957 
00958             fItFit = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00959         }
00960 
00961         <span class="keywordflow">if</span> (pwnd &amp;&amp; <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFRTLREADING))
00962             <a class="code" href="../../d4/d1/userk_8h.html#a1135">GreSetTextAlign</a>(hdc, oldAlign);
00963 
00964         <span class="keywordflow">if</span> (hfnOld)
00965             GreSelectFont(hdc, hfnOld);
00966     }
00967 
00968     <span class="comment">/*</span>
00969 <span class="comment">     * Restore colors</span>
00970 <span class="comment">     */</span>
00971     GreSetTextColor(hdc, clrOldText);
00972     GreSetBkColor(hdc, clrOldBk);
00973 
00974     <span class="keywordflow">if</span> (hbrFill == <a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;hbrGray)
00975         GreSetBkMode(hdc, iOldMode);
00976 
00977     <span class="keywordflow">return</span> fItFit;
00978 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="caption.c::xxxGetWindowSmIcon" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> xxxGetWindowSmIcon           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>BOOL&nbsp;</td>
          <td class="mdname" nowrap> <em>fDontSendMsg</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00306">306</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
References <a class="el" href="../../d8/d7/rtl_2winprop_8c-source.html#l00106">_GetProp()</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01311">tagSERVERINFO::atomIconSmProp</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d2/d7/clglobal_8c-source.html#l00051">gpsi</a>, <a class="el" href="../../d7/d8/rtl_2wow_8c-source.html#l00242">HMValidateHandleNoSecure()</a>, <a class="el" href="../../d7/d0/userrtl_8h-source.html#l00022">MAKEINTATOM</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d2/d9/inc_2user_8h-source.html#l01843">tagWND::pcls</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01722">PROPF_INTERNAL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l02772">SYSICO</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02555">TestWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00908">TYPE_CURSOR</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02363">WEFMDICHILD</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02308">WFOLDUI</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02319">WFWIN40COMPAT</a>, <a class="el" href="../../d9/d2/dwp_8c-source.html#l01223">xxxCreateWindowSmIcon()</a>, and <a class="el" href="../../d4/d5/kernel_2sendmsg_8c-source.html#l00764">xxxSendMessageTimeout()</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/caption_8c-source.html#l00688">xxxDrawCaptionTemp()</a>, and <a class="el" href="../../d7/d1/mndraw_8c-source.html#l00954">xxxRealDrawMenuItem()</a>.
<p>
<pre class="fragment"><div>00309 {
00310     <a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a> pcursor = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00311     HICON   hico = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00312     <a class="code" href="../../d7/d0/structtagCLS.html">PCLS</a>    pcls = pwnd-&gt;<a class="code" href="../../d6/d9/structtagWND.html#o9">pcls</a>;
00313     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>   dwResult = 0;
00314 
00315     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00316 
00317     <span class="comment">/*</span>
00318 <span class="comment">     * We check per-window stuff first then per-class stuff, preferring a</span>
00319 <span class="comment">     * real small icon over a stretched big one.</span>
00320 <span class="comment">     *</span>
00321 <span class="comment">     * Per-window small icon</span>
00322 <span class="comment">     * Per-window big icon stretched small</span>
00323 <span class="comment">     * Per-class small icon</span>
00324 <span class="comment">     * Per-class big icon stretched small</span>
00325 <span class="comment">     * WM_QUERYDRAGICON big icon stretched small (for 3.x dudes)</span>
00326 <span class="comment">     *</span>
00327 <span class="comment">     * Try window small icon first</span>
00328 <span class="comment">     * NOTE:  The WM_SETICON and WM_GETICON messags are for ISVs only.</span>
00329 <span class="comment">     */</span>
00330     <span class="keywordflow">if</span> ((hico = (HICON)<a class="code" href="../../d7/d8/rtl_2winprop_8c.html#a2">_GetProp</a>(pwnd, <a class="code" href="../../d6/d1/userrtl_8h.html#a0">MAKEINTATOM</a>(<a class="code" href="../../d1/d8/clglobal_8c.html#a4">gpsi</a>-&gt;<a class="code" href="../../d2/d6/structtagSERVERINFO.html#o28">atomIconSmProp</a>), PROPF_INTERNAL)) != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00331 
00332         <span class="keywordflow">if</span> (pcursor = (<a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>)<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a7">HMValidateHandleNoSecure</a>(hico, TYPE_CURSOR)) {
00333             <span class="keywordflow">return</span> pcursor;
00334         } <span class="keywordflow">else</span> {
00335             RIPMSG1(RIP_WARNING,<span class="stringliteral">"GetWindowSmIcon: Invalid small icon handle (0x%p)"</span>, hico);
00336         }
00337     }
00338 
00339     <span class="comment">/*</span>
00340 <span class="comment">     * Try class small icon next</span>
00341 <span class="comment">     */</span>
00342     pcursor = pcls-&gt;spicnSm;
00343     <span class="keywordflow">if</span> (pcursor != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00344         <span class="keywordflow">return</span> pcursor;
00345 
00346     <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFWIN40COMPAT) &amp;&amp;
00347         (!<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WFOLDUI)      ||
00348         !<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a731">TestWF</a>(pwnd, WEFMDICHILD))  &amp;&amp;
00349         !fDontSendMsg) {
00350 
00351         ULONG_PTR dwResult;
00352 
00353         <span class="comment">/*</span>
00354 <span class="comment">         * A few old apps like Corel don't set their class icon and other</span>
00355 <span class="comment">         * data until long after we need it.  If we send them WM_QUERYDRAGICON,</span>
00356 <span class="comment">         * they will fault because they don't check the return from GWL to</span>
00357 <span class="comment">         * get their data.  WFOLDUI apps won't ever get a WM_QUERYDRAGICON,</span>
00358 <span class="comment">         * sorry.  Currently the apps with this hack (not for this reason</span>
00359 <span class="comment">         * necessarily)</span>
00360 <span class="comment">         *      Corel Photo-Paint 5.0</span>
00361 <span class="comment">         *      Myst 2.0</span>
00362 <span class="comment">         *      Visual Baler 3.0</span>
00363 <span class="comment">         *      Quicken</span>
00364 <span class="comment">         */</span>
00365         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a1580">xxxSendMessageTimeout</a>(pwnd,
00366                                   WM_QUERYDRAGICON,
00367                                   0,
00368                                   0,
00369                                   SMTO_NORMAL,
00370                                   100,
00371                                   &amp;dwResult)) {
00372 
00373             hico = (HICON)dwResult;
00374         }
00375 
00376         <span class="keywordflow">if</span> (hico) {
00377 
00378             hico = <a class="code" href="../../d4/d1/userk_8h.html#a1448">xxxCreateWindowSmIcon</a>(pwnd, hico, FALSE);
00379             pcursor = (<a class="code" href="../../d6/d1/structtagCURSOR.html">PCURSOR</a>)<a class="code" href="../../d6/d9/rtl_2wow_8c.html#a7">HMValidateHandleNoSecure</a>(hico, TYPE_CURSOR);
00380 
00381             <span class="keywordflow">if</span> (pcursor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>)
00382                 hico = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00383         }
00384     }
00385 
00386     <span class="keywordflow">if</span> (pcursor == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00387         pcursor = <a class="code" href="../../d4/d1/userk_8h.html#a320">SYSICO</a>(WINLOGO);
00388     }
00389 
00390     <span class="keywordflow">return</span> pcursor;
00391 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="caption.c::xxxTrackCaptionButton" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> WORD xxxTrackCaptionButton           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d6/d9/structtagWND.html">PWND</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>pwnd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>UINT&nbsp;</td>
          <td class="mdname" nowrap> <em>hit</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/caption_8c-source.html#l00158">158</a> of file <a class="el" href="../../d2/d4/caption_8c-source.html">caption.c</a>.
<p>
References <a class="el" href="../../d9/d2/dc_8c-source.html#l00608">_GetDCEx()</a>, <a class="el" href="../../d9/d2/dc_8c-source.html#l00183">_ReleaseDC()</a>, <a class="el" href="../../d0/d2/mngrayc_8c-source.html#l00029">BitBltSysBmp()</a>, <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00057">BOOL</a>, <a class="el" href="../../d7/d9/usercli_8h-source.html#l00361">CheckLock</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02557">ClrWF</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00943">DOBI_NORMAL</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00944">DOBI_PUSHED</a>, <a class="el" href="../../d1/d4/perfuser_8c-source.html#l00052">DWORD</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l01265">FWINABLE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00143">GET_X_LPARAM</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l00147">GET_Y_LPARAM</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l06472">IsWinEventNotifyDeferredOK</a>, <a class="el" href="../../d3/d0/userexts_8c-source.html#l01830">msg</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l00058">PtiCurrent</a>, <a class="el" href="../../d4/d5/rect_8c-source.html#l00118">PtInRect()</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02556">SetWF</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02326">WFCLOSEBUTTONDOWN</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02329">WFHELPBUTTONDOWN</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02328">WFREDUCEBUTTONDOWN</a>, <a class="el" href="../../d1/d9/client_2nt6_2user_8h-source.html#l02327">WFZOOMBUTTONDOWN</a>, <a class="el" href="../../d2/d4/caption_8c-source.html#l00030">xxxCalcCaptionButton()</a>, <a class="el" href="../../d5/d0/userk_8h-source.html#l05553">xxxPeekMessage</a>, <a class="el" href="../../d4/d4/w32_2ntuser_2kernel_2capture_8c-source.html#l00078">xxxReleaseCapture()</a>, <a class="el" href="../../d4/d4/w32_2ntuser_2kernel_2capture_8c-source.html#l00023">xxxSetCapture()</a>, <a class="el" href="../../d7/d2/queue_8c-source.html#l04382">xxxSleepThread()</a>, and <a class="el" href="../../d6/d6/kernel_2winable_8c-source.html#l00274">xxxWindowEvent()</a>.
<p>
Referenced by <a class="el" href="../../d9/d2/dwp_8c-source.html#l00601">xxxDWP_NCMouse()</a>.
<p>
<pre class="fragment"><div>00161 {
00162     WORD  cmd;
00163     MSG   <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>;
00164     HDC   hdc;
00165     WORD  bm;
00166     <span class="keywordtype">int</span>   x;
00167     <span class="keywordtype">int</span>   y;
00168     WORD  wState;
00169     WORD  wNewState;
00170     <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>  fMouseUp = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00171     RECT  rcBtn;
00172     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> dwWhere;
00173     <span class="keywordtype">int</span>   iButton;
00174     WORD  wf;
00175     UserAssert(<a class="code" href="../../d4/d1/userk_8h.html#a616">IsWinEventNotifyDeferredOK</a>());
00176 
00177     <a class="code" href="../../d6/d0/usercli_8h.html#a35">CheckLock</a>(pwnd);
00178 
00179     <span class="comment">/*</span>
00180 <span class="comment">     * Set up iButton for this and future STATECHANGE events</span>
00181 <span class="comment">     */</span>
00182     <span class="keywordflow">switch</span> (hit) {
00183     <span class="keywordflow">case</span> HTCLOSE:
00184         iButton = INDEX_TITLEBAR_CLOSEBUTTON;
00185         wf = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a597">WFCLOSEBUTTONDOWN</a>;
00186         <span class="keywordflow">break</span>;
00187 
00188     <span class="keywordflow">case</span> HTREDUCE:
00189         iButton = INDEX_TITLEBAR_MINBUTTON;
00190         wf = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a599">WFREDUCEBUTTONDOWN</a>;
00191         <span class="keywordflow">break</span>;
00192 
00193     <span class="keywordflow">case</span> HTZOOM:
00194         iButton = INDEX_TITLEBAR_MAXBUTTON;
00195         wf = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a598">WFZOOMBUTTONDOWN</a>;
00196         <span class="keywordflow">break</span>;
00197 
00198     <span class="keywordflow">case</span> HTHELP:
00199         iButton = INDEX_TITLEBAR_HELPBUTTON;
00200         wf = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a600">WFHELPBUTTONDOWN</a>;
00201         <span class="keywordflow">break</span>;
00202 
00203     <span class="keywordflow">default</span>:
00204         UserAssert(FALSE);
00205     }
00206     dwWhere = <a class="code" href="../../d1/d5/caption_8c.html#a8">xxxCalcCaptionButton</a>(pwnd, iButton, &amp;cmd, &amp;rcBtn, &amp;bm);
00207     x = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a7">GET_X_LPARAM</a>(dwWhere);
00208     y = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a8">GET_Y_LPARAM</a>(dwWhere);
00209 
00210     <span class="keywordflow">if</span> (cmd) {
00211         <span class="comment">/*</span>
00212 <span class="comment">         * Draw the image in its depressed state.</span>
00213 <span class="comment">         */</span>
00214         hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1695">_GetDCEx</a>(pwnd, NULL, DCX_WINDOW | DCX_USESTYLE);
00215         <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(hdc, x, y, bm + DOBI_PUSHED);
00216         <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdc);
00217 
00218         wState = <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a257">DOBI_PUSHED</a>;
00219 
00220         <span class="comment">/*</span>
00221 <span class="comment">         * Notification of button press.</span>
00222 <span class="comment">         */</span>
00223 
00224         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, wf);
00225 
00226         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
00227             <a class="code" href="../../d5/d7/kernel_2winable_8c.html#a8">xxxWindowEvent</a>(EVENT_OBJECT_STATECHANGE, pwnd, OBJID_TITLEBAR,
00228                     iButton, 0);
00229         }
00230     } <span class="keywordflow">else</span> {
00231         iButton = 0;
00232     }
00233 
00234     <a class="code" href="../../d4/d1/userk_8h.html#a1712">xxxSetCapture</a>(pwnd);
00235 
00236     <span class="keywordflow">while</span> (!fMouseUp) {
00237 
00238         <span class="keywordflow">if</span> (<a class="code" href="../../d4/d1/userk_8h.html#a576">xxxPeekMessage</a>(&amp;msg, NULL, WM_MOUSEFIRST, WM_MOUSELAST, PM_REMOVE)) {
00239             <span class="keywordflow">if</span> (<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.message == WM_LBUTTONUP) {
00240 
00241                 <a class="code" href="../../d4/d1/userk_8h.html#a1713">xxxReleaseCapture</a>();
00242                 fMouseUp = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00243 
00244             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.message == WM_MOUSEMOVE) &amp;&amp; cmd) {
00245 
00246                 wNewState = <a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;rcBtn, <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.pt) ? <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a257">DOBI_PUSHED</a> : <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a256">DOBI_NORMAL</a>;
00247 
00248                 <span class="keywordflow">if</span> (wState != wNewState) {
00249                     wState = wNewState;
00250 
00251                     hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1695">_GetDCEx</a>(pwnd, NULL, DCX_WINDOW | DCX_USESTYLE);
00252                     <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(hdc, x, y, bm + wState);
00253                     <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdc);
00254 
00255                     <span class="keywordflow">if</span> (wState == <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a257">DOBI_PUSHED</a>) {
00256                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a732">SetWF</a>(pwnd, wf);
00257                     } <span class="keywordflow">else</span> {
00258                         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, wf);
00259                     }
00260 
00261                     <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
00262                         <a class="code" href="../../d5/d7/kernel_2winable_8c.html#a8">xxxWindowEvent</a>(EVENT_OBJECT_STATECHANGE, pwnd, OBJID_TITLEBAR,
00263                                 iButton, 0);
00264                     }
00265                 }
00266             }
00267         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d1/userk_8h.html#a1196">xxxSleepThread</a>(QS_MOUSE, 0, TRUE)) {
00268             <span class="keywordflow">break</span>;
00269         }
00270         <span class="keywordflow">if</span> (pwnd != <a class="code" href="../../d4/d1/userk_8h.html#a9">PtiCurrent</a>()-&gt;pq-&gt;spwndCapture) {
00271             <span class="comment">/*</span>
00272 <span class="comment">             * We lost capture. This could have happened during</span>
00273 <span class="comment">             *  the WM_CAPTURECHANGED callback or later if we</span>
00274 <span class="comment">             *  are/were not in the foreground queue.</span>
00275 <span class="comment">             */</span>
00276             <span class="keywordflow">break</span>;
00277         }
00278     }
00279 
00280     <span class="keywordflow">if</span> (!cmd)
00281         <span class="keywordflow">return</span> 0;
00282 
00283     <span class="keywordflow">if</span> (wState &amp;&amp; (cmd != SC_CONTEXTHELP)) {
00284         hdc = <a class="code" href="../../d4/d1/userk_8h.html#a1695">_GetDCEx</a>(pwnd, NULL, DCX_WINDOW | DCX_USESTYLE);
00285         <a class="code" href="../../d4/d1/userk_8h.html#a1773">BitBltSysBmp</a>(hdc, x, y, bm);
00286         <a class="code" href="../../d4/d1/userk_8h.html#a1697">_ReleaseDC</a>(hdc);
00287 
00288         <a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a733">ClrWF</a>(pwnd, wf);
00289 
00290         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0/client_2nt6_2user_8h.html#a405">FWINABLE</a>()) {
00291             <a class="code" href="../../d5/d7/kernel_2winable_8c.html#a8">xxxWindowEvent</a>(EVENT_OBJECT_STATECHANGE, pwnd, OBJID_TITLEBAR,
00292                     iButton, 0);
00293         }
00294     }
00295 
00296     <span class="keywordflow">return</span> (fMouseUp &amp;&amp; <a class="code" href="../../d3/d6/rect_8c.html#a5">PtInRect</a>(&amp;rcBtn, <a class="code" href="../../d2/d1/userexts_8c.html#a129">msg</a>.pt)) ? cmd : 0;
00297 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:02 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
