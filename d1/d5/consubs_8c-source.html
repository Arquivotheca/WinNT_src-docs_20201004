<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: consubs.c Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>consubs.c</h1><a href="../../d0/d6/consubs_8c.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="comment">// Copyright (c) 1985 - 1999, Microsoft Corporation</span>
00002 <span class="comment">//</span>
00003 <span class="comment">//  MODULE:   ConSubs.c</span>
00004 <span class="comment">//</span>
00005 <span class="comment">//  PURPOSE:   Console IME control.</span>
00006 <span class="comment">//</span>
00007 <span class="comment">//  PLATFORMS: Windows NT-FE 3.51</span>
00008 <span class="comment">//</span>
00009 <span class="comment">//  FUNCTIONS:</span>
00010 <span class="comment">//</span>
00011 <span class="comment">//  History:</span>
00012 <span class="comment">//</span>
00013 <span class="comment">//  27.Jul.1995 v-HirShi (Hirotoshi Shimizu)    created</span>
00014 <span class="comment">//  10.Jul.1996 v-HirShi (Hirotoshi Shimizu)    adupt FE edition</span>
00015 <span class="comment">//</span>
00016 <span class="comment">//  COMMENTS:</span>
00017 <span class="comment">//</span>
00018 
00019 <span class="preprocessor">#include "<a class="code" href="../../d5/d3/w32_2ntcon_2conime_2precomp_8h.html">precomp.h</a>"</span>
00020 <span class="preprocessor">#pragma hdrstop</span>
00021 <span class="preprocessor"></span>
00022 <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a>
<a name="l00023"></a><a class="code" href="../../d0/d6/consubs_8c.html#a0">00023</a> <a class="code" href="../../d0/d6/consubs_8c.html#a0">Create</a>( HWND hWnd )
00024 {
00025     <a class="code" href="../../d0/d5/ntcon_2conime_2conime_8c.html#a4">ghDefaultIMC</a> = <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a5">ImmGetContext</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>) ;
00026 
00027 <span class="preprocessor">#ifdef DEBUG_MODE</span>
00028 <span class="preprocessor"></span>    {
00029         <span class="comment">//</span>
00030         <span class="comment">// Select fixed pitch system font and get its text metrics</span>
00031         <span class="comment">//</span>
00032 
00033         HDC hdc;
00034         TEXTMETRIC tm;
00035         WORD       patern = 0xA4A4;
00036         SIZE       size;
00037         HFONT hfntFixed;                      <span class="comment">// fixed-pitch font</span>
00038         HFONT hfntOld;                        <span class="comment">// default font holder</span>
00039 
00040         hdc = <a class="code" href="../../d3/d4/w32_2ntuser_2client_2nt6_2pch_8h.html#a1">GetDC</a>( <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> );
00041         hfntFixed = GetStockObject( SYSTEM_FIXED_FONT );
00042         hfntOld = SelectObject( hdc, hfntFixed );
00043         GetTextMetrics( hdc, &amp;tm );
00044 
00045         GetTextExtentPoint32( hdc, (LPWSTR)&amp;patern, <span class="keyword">sizeof</span>(WORD), (LPSIZE) &amp;size );
00046         cxMetrics = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>) size.cx / 2;
00047         cyMetrics = (<a class="code" href="../../d9/d5/ndismain_8h.html#a265">UINT</a>) size.cy;
00048         <a class="code" href="../../d3/d8/client_8c.html#a45">ReleaseDC</a>( <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, hdc );
00049 
00050         xPos = 0 ;
00051         CaretWidth = <a class="code" href="../../d3/d9/client_2wow_8c.html#a16">GetSystemMetrics</a>( SM_CXBORDER );
00052     }
00053 <span class="preprocessor">#endif</span>
00054 <span class="preprocessor"></span>
00055     <span class="keywordflow">return</span> 0;
00056 
00057 }
00058 
00059 <span class="comment">//**********************************************************************</span>
00060 <span class="comment">//</span>
00061 <span class="comment">// void ImeUIStartComposition()</span>
00062 <span class="comment">//</span>
00063 <span class="comment">// This handles WM_IME_STARTCOMPOSITION message.</span>
00064 <span class="comment">//</span>
00065 <span class="comment">//**********************************************************************</span>
00066 
<a name="l00067"></a><a class="code" href="../../d0/d6/consubs_8c.html#a1">00067</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d6/consubs_8c.html#a1">ImeUIStartComposition</a>( HWND hwnd )
00068 {
00069     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl;
00070 
00071     ConTbl = <a class="code" href="../../d4/d5/conimep_8h.html#a100">SearchConsole</a>(<a class="code" href="../../d0/d5/ntcon_2conime_2conime_8c.html#a3">LastConsole</a>);
00072     <span class="keywordflow">if</span> (ConTbl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00073         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Error! Cannot found registed Console\n"</span>));
00074         <span class="keywordflow">return</span>;
00075     }
00076 
00077     <span class="comment">//</span>
00078     <span class="comment">// Set fInComposition variables.</span>
00079     <span class="comment">//</span>
00080     ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o13">fInComposition</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00081 
00082 <span class="preprocessor">#ifdef DEBUG_MODE</span>
00083 <span class="preprocessor"></span>    {
00084         <span class="keywordtype">int</span> i ;
00085         <span class="keywordflow">for</span> (i = <a class="code" href="../../d4/d5/conimep_8h.html#a22">FIRSTCOL</a> ; i &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a20">MAXCOL</a> ; i++) {
00086             ConvertLine[i] = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a> ;
00087             ConvertLineAtr[i] = 0 ;
00088         }
00089     }
00090 <span class="preprocessor">#endif</span>
00091 <span class="preprocessor"></span><span class="preprocessor">#ifdef DEBUG_INFO</span>
00092 <span class="preprocessor"></span>    xPos = <a class="code" href="../../d4/d5/conimep_8h.html#a22">FIRSTCOL</a>;
00093     xPosLast = <a class="code" href="../../d4/d5/conimep_8h.html#a22">FIRSTCOL</a>;
00094     HideCaret( hwnd );
00095     DisplayConvInformation( hwnd ) ;
00096     ResetCaret( hwnd );
00097 <span class="preprocessor">#endif</span>
00098 <span class="preprocessor"></span>}
00099 
00100 <span class="comment">//**********************************************************************</span>
00101 <span class="comment">//</span>
00102 <span class="comment">// void ImeUIEndComposition</span>
00103 <span class="comment">//</span>
00104 <span class="comment">// This handles WM_IME_ENDCOMPOSITION message.</span>
00105 <span class="comment">//</span>
00106 <span class="comment">//**********************************************************************</span>
00107 
<a name="l00108"></a><a class="code" href="../../d0/d6/consubs_8c.html#a2">00108</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d6/consubs_8c.html#a2">ImeUIEndComposition</a>( HWND hwnd )
00109 {
00110     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl;
00111 
00112     ConTbl = <a class="code" href="../../d4/d5/conimep_8h.html#a100">SearchConsole</a>(<a class="code" href="../../d0/d5/ntcon_2conime_2conime_8c.html#a3">LastConsole</a>);
00113     <span class="keywordflow">if</span> (ConTbl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00114         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Error! Cannot found registed Console\n"</span>));
00115         <span class="keywordflow">return</span>;
00116     }
00117 
00118     <span class="comment">//</span>
00119     <span class="comment">// Reset fInComposition variables.</span>
00120     <span class="comment">//</span>
00121     ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o13">fInComposition</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00122 
00123     <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o14">lpCompStrMem</a>)
00124         LocalFree( ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o14">lpCompStrMem</a> );
00125     ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o14">lpCompStrMem</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ;
00126 
00127 <span class="preprocessor">#ifdef DEBUG_MODE</span>
00128 <span class="preprocessor"></span>    {
00129         <span class="keywordtype">int</span> i ;
00130         <span class="comment">//</span>
00131         <span class="comment">// Reset the length of composition string to zero.</span>
00132         <span class="comment">//</span>
00133         <span class="keywordflow">for</span> (i = <a class="code" href="../../d4/d5/conimep_8h.html#a22">FIRSTCOL</a> ; i &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a20">MAXCOL</a> ; i++) {
00134             ConvertLine[i] = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a> ;
00135             ConvertLineAtr[i] = 0 ;
00136         }
00137     }
00138 <span class="preprocessor">#endif</span>
00139 <span class="preprocessor"></span><span class="preprocessor">#ifdef DEBUG_INFO</span>
00140 <span class="preprocessor"></span>    xPos = <a class="code" href="../../d4/d5/conimep_8h.html#a22">FIRSTCOL</a>;
00141     xPosLast = <a class="code" href="../../d4/d5/conimep_8h.html#a22">FIRSTCOL</a>;
00142     HideCaret( hwnd );
00143     DisplayConvInformation( hwnd ) ;
00144     ResetCaret( hwnd );
00145 <span class="preprocessor">#endif</span>
00146 <span class="preprocessor"></span>}
00147 
00148 <span class="comment">//**********************************************************************</span>
00149 <span class="comment">//</span>
00150 <span class="comment">// void ImeUIComposition()</span>
00151 <span class="comment">//</span>
00152 <span class="comment">// This handles WM_IME_COMPOSITION message. It here just handles</span>
00153 <span class="comment">// composition string and result string. For normal case, it should</span>
00154 <span class="comment">// examine all posibile flags indicated by CompFlag, then do some</span>
00155 <span class="comment">// actitions to reflect what kinds of composition info. IME conversion</span>
00156 <span class="comment">// engine informs.</span>
00157 <span class="comment">//</span>
00158 <span class="comment">//**********************************************************************</span>
00159 
<a name="l00160"></a><a class="code" href="../../d0/d6/consubs_8c.html#a3">00160</a> <span class="keywordtype">void</span> <a class="code" href="../../d0/d6/consubs_8c.html#a3">ImeUIComposition</a>( HWND hwnd, WPARAM CompChar, LPARAM CompFlag )
00161 {
00162 
00163     <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: WM_IME_COMPOSITION %08x %08x\n"</span>,CompChar,CompFlag));
00164 
00165 <span class="preprocessor">#ifdef DEBUG_MODE</span>
00166 <span class="preprocessor"></span>    {
00167         <span class="keywordtype">int</span> i ;
00168         <span class="keywordflow">for</span> (i = <a class="code" href="../../d4/d5/conimep_8h.html#a22">FIRSTCOL</a> ; i &lt; <a class="code" href="../../d4/d5/conimep_8h.html#a20">MAXCOL</a> ; i++) {
00169             ConvertLine[i] = <a class="code" href="../../d9/d5/verifier_8c.html#a6">UNICODE_SPACE</a> ;
00170             ConvertLineAtr[i] = 0 ;
00171         }
00172         xPos = <a class="code" href="../../d4/d5/conimep_8h.html#a22">FIRSTCOL</a>;
00173         xPosLast = <a class="code" href="../../d4/d5/conimep_8h.html#a22">FIRSTCOL</a>;
00174     }
00175 <span class="preprocessor">#endif</span>
00176 <span class="preprocessor"></span>
00177     <span class="keywordflow">if</span> ( CompFlag == 0 ) {
00178         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"                           None\n"</span>));
00179         <a class="code" href="../../d8/d7/country3_8c.html#a0">GetCompositionStr</a>( hwnd, CompFlag, CompChar);
00180     }
00181     <span class="keywordflow">if</span> ( CompFlag &amp; GCS_RESULTSTR ) {
00182         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"                           GCS_RESULTSTR\n"</span>));
00183         <a class="code" href="../../d8/d7/country3_8c.html#a0">GetCompositionStr</a>( hwnd, ( CompFlag &amp; GCS_RESULTSTR ), CompChar );
00184     }
00185     <span class="keywordflow">if</span> ( CompFlag &amp; GCS_COMPSTR ) {
00186         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"                           GCS_COMPSTR\n"</span>));
00187         <a class="code" href="../../d8/d7/country3_8c.html#a0">GetCompositionStr</a>( hwnd, ( CompFlag &amp; (GCS_COMPSTR|GCS_COMPATTR)), CompChar);
00188     }
00189     <span class="keywordflow">if</span> ( CompFlag &amp; CS_INSERTCHAR ) {
00190         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"                           CS_INSERTCHAR\n"</span>));
00191         <a class="code" href="../../d8/d7/country3_8c.html#a0">GetCompositionStr</a>( hwnd, ( CompFlag &amp; (CS_INSERTCHAR|GCS_COMPATTR)), CompChar);
00192     }
00193     <span class="keywordflow">if</span> ( CompFlag &amp; CS_NOMOVECARET ) {
00194         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"                           CS_NOMOVECARET\n"</span>));
00195         <a class="code" href="../../d8/d7/country3_8c.html#a0">GetCompositionStr</a>( hwnd, ( CompFlag &amp; (CS_NOMOVECARET|GCS_COMPATTR)), CompChar);
00196     }
00197 }
00198 
00199 
00200 <span class="preprocessor">#ifdef DEBUG_INFO</span>
00201 <span class="preprocessor"></span><span class="comment">//*********************************************************************</span>
00202 <span class="comment">//</span>
00203 <span class="comment">// void DisplayCompString()</span>
00204 <span class="comment">//</span>
00205 <span class="comment">// This displays composition string.</span>
00206 <span class="comment">//</span>
00207 <span class="comment">// This function send string to Console.</span>
00208 <span class="comment">//</span>
00209 <span class="comment">//*********************************************************************</span>
00210 
00211 <span class="keywordtype">void</span> <a class="code" href="../../d4/d5/conimep_8h.html#a115">DisplayCompString</a>( HWND hwnd, <span class="keywordtype">int</span> Length, PWCHAR CharBuf, PUCHAR AttrBuf )
00212 {
00213     <span class="keywordtype">int</span>         i;
00214     CopyMemory(ConvertLine, CharBuf, Length * <span class="keyword">sizeof</span>(WCHAR) ) ;
00215     <span class="keywordflow">if</span> ( AttrBuf == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00216         <span class="keywordflow">for</span> ( i = 0 ; i &lt; Length ; i++ )
00217             ConvertLineAtr[i] = 0 ;
00218     }
00219     <span class="keywordflow">else</span> {
00220         CopyMemory(ConvertLineAtr, AttrBuf, Length) ;
00221     }
00222     HideCaret( hwnd );
00223     DisplayConvInformation( hwnd ) ;
00224     ResetCaret( hwnd );
00225 
00226 }
00227 
00228 <span class="comment">//*********************************************************************</span>
00229 <span class="comment">//</span>
00230 <span class="comment">// void DisplayResultString()</span>
00231 <span class="comment">//</span>
00232 <span class="comment">// This displays result string.</span>
00233 <span class="comment">//</span>
00234 <span class="comment">// This function supports only fixed pitch font.</span>
00235 <span class="comment">//</span>
00236 <span class="comment">//*********************************************************************</span>
00237 
00238 <span class="keywordtype">void</span> <a class="code" href="../../d4/d5/conimep_8h.html#a116">DisplayResultString</a>( HWND hwnd, LPWSTR lpwStr )
00239 {
00240 
00241     <span class="keywordtype">int</span>         <a class="code" href="../../d0/d2/usrbench_8h.html#a32">StrLen</a> = lstrlenW( lpwStr );
00242 
00243     CopyMemory(ConvertLine, lpwStr, StrLen*<span class="keyword">sizeof</span>(WCHAR)) ;
00244     HideCaret( hwnd );
00245     DisplayConvInformation( hwnd ) ;
00246     ResetCaret( hwnd );
00247 
00248     <span class="comment">// gImeUIData.uCompLen = 0;</span>
00249 
00250 }
00251 <span class="preprocessor">#endif</span>
00252 <span class="preprocessor"></span>
00253 <span class="comment">//**********************************************************************</span>
00254 <span class="comment">//</span>
00255 <span class="comment">// BOOL ImeUINotify()</span>
00256 <span class="comment">//</span>
00257 <span class="comment">// This handles WM_IME_NOTIFY message.</span>
00258 <span class="comment">//</span>
00259 <span class="comment">//**********************************************************************</span>
00260 
<a name="l00261"></a><a class="code" href="../../d0/d6/consubs_8c.html#a4">00261</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d0/d6/consubs_8c.html#a4">ImeUINotify</a>( HWND hwnd, WPARAM wParam, LPARAM lParam )
00262 {
00263     <span class="keywordflow">switch</span> (wParam )
00264     {
00265         <span class="keywordflow">case</span> IMN_OPENSTATUSWINDOW:
00266             <a class="code" href="../../d0/d6/consubs_8c.html#a6">ImeUIOpenStatusWindow</a>(hwnd) ;
00267             <span class="keywordflow">break</span>;
00268         <span class="keywordflow">case</span> IMN_CHANGECANDIDATE:
00269             <a class="code" href="../../d0/d6/consubs_8c.html#a7">ImeUIChangeCandidate</a>( hwnd, (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)lParam );
00270             <span class="keywordflow">break</span>;
00271         <span class="keywordflow">case</span> IMN_CLOSECANDIDATE:
00272             <a class="code" href="../../d7/d7/country2_8c.html#a10">ImeUICloseCandidate</a>( hwnd, (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)lParam );
00273             <span class="keywordflow">break</span>;
00274         <span class="keywordflow">case</span> IMN_OPENCANDIDATE:
00275             <a class="code" href="../../d7/d7/country2_8c.html#a0">ImeUIOpenCandidate</a>( hwnd, (<a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>)lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>);
00276             <span class="keywordflow">break</span>;
00277         <span class="keywordflow">case</span> IMN_SETCONVERSIONMODE:
00278             <a class="code" href="../../d0/d6/consubs_8c.html#a9">ImeUISetConversionMode</a>(hwnd) ;
00279             <span class="comment">// IMN_SETCONVERSIONMODE should be pass to DefWindowProc</span>
00280             <span class="comment">// becuase ImeNotifyHandler in User32 does notify to shell and keyboard.</span>
00281             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00282         <span class="keywordflow">case</span> IMN_SETOPENSTATUS:
00283             <a class="code" href="../../d0/d6/consubs_8c.html#a8">ImeUISetOpenStatus</a>( hwnd );
00284             <span class="comment">// IMN_SETOPENSTATUS should be pass to DefWindowProc</span>
00285             <span class="comment">// becuase ImeNotifyHandler in User32 does notify to shell and keyboard.</span>
00286             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00287         <span class="keywordflow">case</span> IMN_GUIDELINE:
00288             <a class="code" href="../../d0/d6/consubs_8c.html#a10">ImeUIGuideLine</a>(hwnd) ;
00289             <span class="keywordflow">break</span>;
00290         <span class="keywordflow">default</span>:
00291             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00292 
00293     }
00294     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00295 }
00296 
00297 <span class="comment">/***************************************************************************\</span>
00298 <span class="comment">* BOOL IsConsoleFullWidth(DWORD CodePage,WCHAR wch)</span>
00299 <span class="comment">*</span>
00300 <span class="comment">* Determine if the given Unicode char is fullwidth or not.</span>
00301 <span class="comment">*</span>
00302 <span class="comment">* History:</span>
00303 <span class="comment">* 04-08-92 ShunK       Created.</span>
00304 <span class="comment">* Jul-27-1992 KazuM    Added Screen Information and Code Page Information.</span>
00305 <span class="comment">* Jan-29-1992 V-Hirots Substruct Screen Information.</span>
00306 <span class="comment">* Oct-06-1996 KazuM    Not use RtlUnicodeToMultiByteSize and WideCharToMultiByte</span>
00307 <span class="comment">*                      Because 950 only defined 13500 chars,</span>
00308 <span class="comment">*                      and unicode defined almost 18000 chars.</span>
00309 <span class="comment">*                      So there are almost 4000 chars can not be mapped to big5 code.</span>
00310 <span class="comment">\***************************************************************************/</span>
00311 
<a name="l00312"></a><a class="code" href="../../d0/d6/consubs_8c.html#a5">00312</a> <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a> <a class="code" href="../../d0/d6/consubs_8c.html#a5">IsUnicodeFullWidth</a>(
00313     IN WCHAR wch
00314     )
00315 {
00316     <span class="keywordflow">if</span> (0x20 &lt;= wch &amp;&amp; wch &lt;= 0x7e)
00317         <span class="comment">/* ASCII */</span>
00318         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00319     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0x3041 &lt;= wch &amp;&amp; wch &lt;= 0x3094)
00320         <span class="comment">/* Hiragana */</span>
00321         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00322     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0x30a1 &lt;= wch &amp;&amp; wch &lt;= 0x30f6)
00323         <span class="comment">/* Katakana */</span>
00324         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00325     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0x3105 &lt;= wch &amp;&amp; wch &lt;= 0x312c)
00326         <span class="comment">/* Bopomofo */</span>
00327         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00328     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0x3131 &lt;= wch &amp;&amp; wch &lt;= 0x318e)
00329         <span class="comment">/* Hangul Elements */</span>
00330         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00331     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0xac00 &lt;= wch &amp;&amp; wch &lt;= 0xd7a3)
00332         <span class="comment">/* Korean Hangul Syllables */</span>
00333         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00334     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0xff01 &lt;= wch &amp;&amp; wch &lt;= 0xff5e)
00335         <span class="comment">/* Fullwidth ASCII variants */</span>
00336         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00337     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0xff61 &lt;= wch &amp;&amp; wch &lt;= 0xff9f)
00338         <span class="comment">/* Halfwidth Katakana variants */</span>
00339         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00340     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( (0xffa0 &lt;= wch &amp;&amp; wch &lt;= 0xffbe) ||
00341               (0xffc2 &lt;= wch &amp;&amp; wch &lt;= 0xffc7) ||
00342               (0xffca &lt;= wch &amp;&amp; wch &lt;= 0xffcf) ||
00343               (0xffd2 &lt;= wch &amp;&amp; wch &lt;= 0xffd7) ||
00344               (0xffda &lt;= wch &amp;&amp; wch &lt;= 0xffdc)   )
00345         <span class="comment">/* Halfwidth Hangule variants */</span>
00346         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00347     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0xffe0 &lt;= wch &amp;&amp; wch &lt;= 0xffe6)
00348         <span class="comment">/* Fullwidth symbol variants */</span>
00349         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00350     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0x4e00 &lt;= wch &amp;&amp; wch &lt;= 0x9fa5)
00351         <span class="comment">/* Han Ideographic */</span>
00352         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00353     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0xf900 &lt;= wch &amp;&amp; wch &lt;= 0xfa2d)
00354         <span class="comment">/* Han Ideographic Compatibility */</span>
00355         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00356     <span class="keywordflow">else</span>
00357     {
00358 <span class="preprocessor">#if 0</span>
00359 <span class="preprocessor"></span>        <span class="comment">/*</span>
00360 <span class="comment">         * Hack this block for I don't know FONT of Console Window.</span>
00361 <span class="comment">         *</span>
00362 <span class="comment">         * If you would like perfect result from IsUnicodeFullWidth routine,</span>
00363 <span class="comment">         * then you should enable this block and</span>
00364 <span class="comment">         * you should know FONT of Console Window.</span>
00365 <span class="comment">         */</span>
00366 
00367         <a class="code" href="../../d9/d5/ndismain_8h.html#a263">INT</a> Width;
00368         TEXTMETRIC tmi;
00369 
00370         <span class="comment">/* Unknown character */</span>
00371 
00372         GetTextMetricsW(hDC, &amp;tmi);
00373         <span class="keywordflow">if</span> (IS_ANY_DBCS_CHARSET(tmi.tmCharSet))
00374             tmi.tmMaxCharWidth /= 2;
00375 
00376         GetCharWidth32(hDC, wch, wch, &amp;Width);
00377         <span class="keywordflow">if</span> (Width == tmi.tmMaxCharWidth)
00378             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00379         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Width == tmi.tmMaxCharWidth*2)
00380             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00381 <span class="preprocessor">#else</span>
00382 <span class="preprocessor"></span>        ULONG MultiByteSize;
00383 
00384         <a class="code" href="../../d9/d6/nlsxlat_8c.html#a36">RtlUnicodeToMultiByteSize</a>(&amp;MultiByteSize, &amp;wch, <span class="keyword">sizeof</span>(WCHAR));
00385         <span class="keywordflow">if</span> (MultiByteSize == 2)
00386             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
00387         <span class="keywordflow">else</span>
00388             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
00389 <span class="preprocessor">#endif</span>
00390 <span class="preprocessor"></span>    }
00391     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00392     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00393 <span class="preprocessor">#if 0</span>
00394 <span class="preprocessor"></span>    ULONG MultiByteSize;
00395 
00396     <a class="code" href="../../d9/d6/nlsxlat_8c.html#a36">RtlUnicodeToMultiByteSize</a>(&amp;MultiByteSize, &amp;wch, <span class="keyword">sizeof</span>(WCHAR));
00397     <span class="keywordflow">if</span> (MultiByteSize == 2)
00398         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
00399     <span class="keywordflow">else</span>
00400         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
00401 <span class="preprocessor">#endif</span>
00402 <span class="preprocessor"></span>}
00403 
00404 
00405 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00406"></a><a class="code" href="../../d0/d6/consubs_8c.html#a6">00406</a> <a class="code" href="../../d0/d6/consubs_8c.html#a6">ImeUIOpenStatusWindow</a>(
00407     HWND hwnd
00408     )
00409 {
00410     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl;
00411     HIMC        hIMC;                   <span class="comment">// Input context handle.</span>
00412     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo ;
00413     COPYDATASTRUCT CopyData ;
00414 
00415     <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Get IMN_OPENSTATUSWINDOW Message\n"</span>));
00416 
00417     ConTbl = <a class="code" href="../../d4/d5/conimep_8h.html#a100">SearchConsole</a>(<a class="code" href="../../d0/d5/ntcon_2conime_2conime_8c.html#a3">LastConsole</a>);
00418     <span class="keywordflow">if</span> (ConTbl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00419         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Error! Cannot found registed Console\n"</span>));
00420         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00421     }
00422 
00423     hIMC = <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a5">ImmGetContext</a>( hwnd ) ;
00424     <span class="keywordflow">if</span> ( hIMC == 0 )
00425         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00426 
00427     lpModeInfo = (<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a>)LocalAlloc( LPTR, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">CONIME_UIMODEINFO</a>) ) ;
00428     <span class="keywordflow">if</span> ( lpModeInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00429         <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a7">ImmReleaseContext</a>( hwnd, hIMC );
00430         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00431     }
00432 
00433     <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a29">ImmGetConversionStatus</a>(hIMC,
00434                            (LPDWORD)&amp;ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a>,
00435                            (LPDWORD)&amp;ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o8">dwSentence</a>) ;
00436 
00437     CopyData.dwData = <a class="code" href="../../d3/d5/conime_8h.html#a5">CI_CONIMEMODEINFO</a> ;
00438     CopyData.cbData = <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d5/conime_8h.html#a42">CONIME_UIMODEINFO</a>) ;
00439     CopyData.lpData = lpModeInfo ;
00440     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d7/country_8c.html#a17">ImeUIMakeInfoString</a>(ConTbl,
00441                             lpModeInfo))
00442     {
00443         <a class="code" href="../../d4/d5/conimep_8h.html#a109">ConsoleImeSendMessage</a>( ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o1">hWndCon</a>,
00444                                (WPARAM)hwnd,
00445                                (LPARAM)&amp;CopyData
00446                               ) ;
00447     }
00448 
00449     LocalFree( lpModeInfo );
00450 
00451     <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a7">ImmReleaseContext</a>( hwnd, hIMC );
00452 
00453     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
00454 }
00455 
00456 
00457 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00458"></a><a class="code" href="../../d0/d6/consubs_8c.html#a7">00458</a> <a class="code" href="../../d0/d6/consubs_8c.html#a7">ImeUIChangeCandidate</a>(
00459    HWND hwnd,
00460    DWORD lParam
00461    )
00462 {
00463     <span class="keywordflow">return</span> <a class="code" href="../../d7/d7/country2_8c.html#a0">ImeUIOpenCandidate</a>( hwnd, lParam, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) ;
00464 }
00465 
00466 
00467 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00468"></a><a class="code" href="../../d0/d6/consubs_8c.html#a8">00468</a> <a class="code" href="../../d0/d6/consubs_8c.html#a8">ImeUISetOpenStatus</a>(
00469     HWND hwnd
00470     )
00471 {
00472     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl;
00473     HIMC        hIMC;                   <span class="comment">// Input context handle.</span>
00474     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo ;
00475     COPYDATASTRUCT CopyData ;
00476 
00477     <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Get IMN_SETOPENSTATUS Message\n"</span>));
00478 
00479     ConTbl = <a class="code" href="../../d4/d5/conimep_8h.html#a100">SearchConsole</a>(<a class="code" href="../../d0/d5/ntcon_2conime_2conime_8c.html#a3">LastConsole</a>);
00480     <span class="keywordflow">if</span> (ConTbl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00481         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Error! Cannot found registed Console\n"</span>));
00482         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00483     }
00484 
00485     hIMC = <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a5">ImmGetContext</a>( hwnd ) ;
00486     <span class="keywordflow">if</span> ( hIMC == 0 )
00487         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00488 
00489     ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o6">fOpen</a> = <a class="code" href="../../d6/d7/country_8c.html#a16">GetOpenStatusByCodepage</a>( hIMC, ConTbl ) ;
00490 
00491     <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a29">ImmGetConversionStatus</a>(hIMC,
00492                            (LPDWORD)&amp;ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a>,
00493                            (LPDWORD)&amp;ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o8">dwSentence</a>) ;
00494 
00495     <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o2">ScreenBufferSize</a>.X != 0) {
00496 
00497         lpModeInfo = (<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a>)LocalAlloc( LPTR, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">CONIME_UIMODEINFO</a>)) ;
00498         <span class="keywordflow">if</span> ( lpModeInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00499             <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a7">ImmReleaseContext</a>( hwnd, hIMC );
00500             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00501         }
00502 
00503         CopyData.dwData = <a class="code" href="../../d3/d5/conime_8h.html#a5">CI_CONIMEMODEINFO</a> ;
00504         CopyData.cbData = <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d5/conime_8h.html#a42">CONIME_UIMODEINFO</a>) ;
00505         CopyData.lpData = lpModeInfo ;
00506         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d7/country_8c.html#a17">ImeUIMakeInfoString</a>(ConTbl,
00507                                 lpModeInfo))
00508         {
00509             <a class="code" href="../../d4/d5/conimep_8h.html#a109">ConsoleImeSendMessage</a>( ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o1">hWndCon</a>,
00510                                    (WPARAM)hwnd,
00511                                    (LPARAM)&amp;CopyData
00512                                   ) ;
00513         }
00514         LocalFree( lpModeInfo );
00515     }
00516     <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a7">ImmReleaseContext</a>( hwnd, hIMC );
00517 
00518     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
00519 }
00520 
00521 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00522"></a><a class="code" href="../../d0/d6/consubs_8c.html#a9">00522</a> <a class="code" href="../../d0/d6/consubs_8c.html#a9">ImeUISetConversionMode</a>(
00523     HWND hwnd
00524     )
00525 {
00526     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl;
00527     HIMC        hIMC;                   <span class="comment">// Input context handle.</span>
00528     <a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a> lpModeInfo ;
00529     COPYDATASTRUCT CopyData ;
00530     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a> OldConversion ;
00531 
00532 
00533     <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Get IMN_SETCONVERSIONMODE Message\n"</span>));
00534 
00535     ConTbl = <a class="code" href="../../d4/d5/conimep_8h.html#a100">SearchConsole</a>(<a class="code" href="../../d0/d5/ntcon_2conime_2conime_8c.html#a3">LastConsole</a>);
00536     <span class="keywordflow">if</span> (ConTbl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00537         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Error! Cannot found registed Console\n"</span>));
00538         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00539     }
00540 
00541     hIMC = <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a5">ImmGetContext</a>( hwnd ) ;
00542     <span class="keywordflow">if</span> ( hIMC == 0 )
00543         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00544 
00545     lpModeInfo = (<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">LPCONIME_UIMODEINFO</a>)LocalAlloc(LPTR, <span class="keyword">sizeof</span>(<a class="code" href="../../d1/d9/struct__CONIME__UIMODEINFO.html">CONIME_UIMODEINFO</a>) ) ;
00546     <span class="keywordflow">if</span> ( lpModeInfo == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00547         <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a7">ImmReleaseContext</a>( hwnd, hIMC );
00548         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00549     }
00550 
00551     OldConversion = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a> ;
00552 
00553     <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a29">ImmGetConversionStatus</a>(hIMC,
00554                            (LPDWORD)&amp;ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a>,
00555                            (LPDWORD)&amp;ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o8">dwSentence</a>) ;
00556 
00557     CopyData.dwData = <a class="code" href="../../d3/d5/conime_8h.html#a5">CI_CONIMEMODEINFO</a> ;
00558     CopyData.cbData = <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d5/conime_8h.html#a42">CONIME_UIMODEINFO</a>) ;
00559     CopyData.lpData = lpModeInfo ;
00560     <span class="keywordflow">if</span> (<a class="code" href="../../d6/d7/country_8c.html#a17">ImeUIMakeInfoString</a>(ConTbl,
00561                             lpModeInfo))
00562     {
00563         <a class="code" href="../../d4/d5/conimep_8h.html#a109">ConsoleImeSendMessage</a>( ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o1">hWndCon</a>,
00564                                (WPARAM)hwnd,
00565                                (LPARAM)&amp;CopyData
00566                              ) ;
00567     }
00568 
00569     LocalFree( lpModeInfo );
00570     <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a7">ImmReleaseContext</a>( hwnd, hIMC );
00571     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
00572 
00573 }
00574 
00575 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00576"></a><a class="code" href="../../d0/d6/consubs_8c.html#a10">00576</a> <a class="code" href="../../d0/d6/consubs_8c.html#a10">ImeUIGuideLine</a>(
00577     HWND hwnd
00578     )
00579 {
00580     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl;
00581     HIMC        hIMC ;                   <span class="comment">// Input context handle.</span>
00582     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       Level ;
00583     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> ;
00584     <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>       Length ;
00585     <a class="code" href="../../d0/d9/struct__CONIME__UIMESSAGE.html">LPCONIME_UIMESSAGE</a> GuideLine ;
00586     COPYDATASTRUCT CopyData ;
00587 
00588     <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Get IMN_GUIDELINE Message "</span>));
00589 
00590     ConTbl = <a class="code" href="../../d4/d5/conimep_8h.html#a100">SearchConsole</a>(<a class="code" href="../../d0/d5/ntcon_2conime_2conime_8c.html#a3">LastConsole</a>);
00591     <span class="keywordflow">if</span> (ConTbl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00592         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Error! Cannot found registed Console\n"</span>));
00593         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00594     }
00595 
00596     hIMC = <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a5">ImmGetContext</a>( hwnd ) ;
00597     <span class="keywordflow">if</span> ( hIMC == 0 )
00598         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00599 
00600     Level = ImmGetGuideLine(hIMC, GGL_LEVEL, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0) ;
00601     <a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a> = ImmGetGuideLine(hIMC, GGL_INDEX, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0) ;
00602     Length = ImmGetGuideLine(hIMC, GGL_STRING, <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>, 0) ;
00603     <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"Level=%d Index=%d Length=%d"</span>,Level,<a class="code" href="../../d1/d0/cmchek_8c.html#a10">Index</a>,Length));
00604     <span class="keywordflow">if</span> (Length == 0) {
00605         CopyData.dwData = <a class="code" href="../../d3/d5/conime_8h.html#a6">CI_CONIMESYSINFO</a> ;
00606         CopyData.cbData = Length ;
00607         CopyData.lpData = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ;
00608 
00609         <a class="code" href="../../d4/d5/conimep_8h.html#a109">ConsoleImeSendMessage</a>( ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o1">hWndCon</a>,
00610                                (WPARAM)hwnd,
00611                                (LPARAM)&amp;CopyData
00612                               ) ;
00613     }
00614     <span class="keywordflow">else</span>{
00615         GuideLine = (<a class="code" href="../../d0/d9/struct__CONIME__UIMESSAGE.html">LPCONIME_UIMESSAGE</a>)LocalAlloc(LPTR, Length + <span class="keyword">sizeof</span>(WCHAR)) ;
00616         <span class="keywordflow">if</span> (GuideLine == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00617             <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a7">ImmReleaseContext</a>( hwnd, hIMC );
00618             <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00619         }
00620 
00621         CopyData.dwData = <a class="code" href="../../d3/d5/conime_8h.html#a6">CI_CONIMESYSINFO</a> ;
00622         CopyData.cbData = Length + <span class="keyword">sizeof</span>(WCHAR) ;
00623         CopyData.lpData = GuideLine ;
00624         Length = ImmGetGuideLine(hIMC, GGL_STRING, GuideLine-&gt;<a class="code" href="../../d0/d9/struct__CONIME__UIMESSAGE.html#o0">String</a>, Length) ;
00625 
00626         <a class="code" href="../../d4/d5/conimep_8h.html#a109">ConsoleImeSendMessage</a>( ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o1">hWndCon</a>,
00627                                (WPARAM)hwnd,
00628                                (LPARAM)&amp;CopyData
00629                               ) ;
00630 
00631         LocalFree( GuideLine ) ;
00632     }
00633     <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a7">ImmReleaseContext</a>( hwnd, hIMC );
00634     <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"\n"</span>));
00635 
00636     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> ;
00637 }
00638 
00639 <a class="code" href="../../d0/d5/perfuser_8c.html#a6">DWORD</a>
<a name="l00640"></a><a class="code" href="../../d0/d6/consubs_8c.html#a11">00640</a> <a class="code" href="../../d0/d6/consubs_8c.html#a11">GetNLSMode</a>(
00641     HWND hWnd,
00642     HANDLE hConsole
00643     )
00644 {
00645     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl;
00646     HIMC hIMC;
00647 
00648     ConTbl = <a class="code" href="../../d4/d5/conimep_8h.html#a100">SearchConsole</a>(hConsole);
00649     <span class="keywordflow">if</span> (ConTbl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00650         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Error! Cannot found registed Console\n"</span>));
00651         <span class="keywordflow">return</span> 0;
00652     }
00653 
00654     hIMC = <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a5">ImmGetContext</a>( <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> ) ;
00655     <span class="keywordflow">if</span> ( hIMC == (HIMC)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
00656         <span class="keywordflow">return</span> <a class="code" href="../../d3/d5/conime_8h.html#a30">IME_CMODE_DISABLE</a>;
00657 
00658     <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a29">ImmGetConversionStatus</a>(hIMC,
00659                            &amp;ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a>,
00660                            &amp;ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o8">dwSentence</a>);
00661     ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o6">fOpen</a> = <a class="code" href="../../d6/d7/country_8c.html#a16">GetOpenStatusByCodepage</a>( hIMC, ConTbl ) ;
00662 
00663     <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a7">ImmReleaseContext</a>( <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, hIMC );
00664 
00665 
00666     <span class="keywordflow">return</span> ((ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o6">fOpen</a> ? <a class="code" href="../../d3/d5/conime_8h.html#a29">IME_CMODE_OPEN</a> : 0) + ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a>);
00667 }
00668 
00669 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00670"></a><a class="code" href="../../d0/d6/consubs_8c.html#a12">00670</a> <a class="code" href="../../d0/d6/consubs_8c.html#a12">SetNLSMode</a>(
00671     HWND hWnd,
00672     HANDLE hConsole,
00673     DWORD fdwConversion
00674     )
00675 {
00676     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl;
00677     HIMC hIMC;
00678 
00679     ConTbl = <a class="code" href="../../d4/d5/conimep_8h.html#a100">SearchConsole</a>(hConsole);
00680     <span class="keywordflow">if</span> (ConTbl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00681         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Error! Cannot found registed Console\n"</span>));
00682         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00683     }
00684 
00685     <span class="keywordflow">if</span> (fdwConversion &amp; <a class="code" href="../../d3/d5/conime_8h.html#a30">IME_CMODE_DISABLE</a>)
00686     {
00687         <a class="code" href="../../d1/d5/ntuser_2imm_2conime_8c.html#a4">ImmSetActiveContextConsoleIME</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>) ;
00688         <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a3">ImmAssociateContext</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, (HIMC)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>);
00689         ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o4">hIMC_Current</a> = (HIMC)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00690     }
00691     <span class="keywordflow">else</span>
00692     {
00693         <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a3">ImmAssociateContext</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o5">hIMC_Original</a>);
00694         <a class="code" href="../../d1/d5/ntuser_2imm_2conime_8c.html#a4">ImmSetActiveContextConsoleIME</a>(<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) ;
00695         ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o4">hIMC_Current</a> = ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o5">hIMC_Original</a>;
00696     }
00697 
00698     hIMC = <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a5">ImmGetContext</a>( <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a> ) ;
00699     <span class="keywordflow">if</span> ( hIMC == (HIMC)<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> )
00700         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00701 
00702     ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o6">fOpen</a> =(fdwConversion &amp; <a class="code" href="../../d3/d5/conime_8h.html#a29">IME_CMODE_OPEN</a>) ? <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> : <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> ;
00703     <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a32">ImmSetOpenStatus</a>(hIMC, ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o6">fOpen</a>);
00704 
00705     fdwConversion &amp;= ~(<a class="code" href="../../d3/d5/conime_8h.html#a30">IME_CMODE_DISABLE</a> | <a class="code" href="../../d3/d5/conime_8h.html#a29">IME_CMODE_OPEN</a>);
00706     <span class="keywordflow">if</span> (ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a> != fdwConversion)
00707     {
00708         ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a> = fdwConversion;
00709         <a class="code" href="../../d4/d1/ctxtinfo_8c.html#a30">ImmSetConversionStatus</a>(hIMC,
00710                                ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o7">dwConversion</a>,
00711                                ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o8">dwSentence</a> );
00712     }
00713 
00714     <a class="code" href="../../d7/d6/w32_2ntuser_2imm_2context_8c.html#a7">ImmReleaseContext</a>( <a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>, hIMC );
00715 
00716     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00717 }
00718 
00719 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00720"></a><a class="code" href="../../d0/d6/consubs_8c.html#a13">00720</a> <a class="code" href="../../d0/d6/consubs_8c.html#a13">ConsoleCodepageChange</a>(
00721     HWND hWnd,
00722     HANDLE hConsole,
00723     BOOL Output,
00724     WORD CodePage
00725     )
00726 {
00727     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl;
00728 
00729     ConTbl = <a class="code" href="../../d4/d5/conimep_8h.html#a100">SearchConsole</a>(hConsole);
00730     <span class="keywordflow">if</span> (ConTbl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00731         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Error! Cannot found registed Console\n"</span>));
00732         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00733     }
00734 
00735     <span class="keywordflow">if</span> (Output)
00736     {
00737         ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o10">ConsoleOutputCP</a> = CodePage ;
00738     }
00739     <span class="keywordflow">else</span>
00740     {
00741         ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o9">ConsoleCP</a> = CodePage ;
00742     }
00743     <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) ;
00744 }
00745 
00746 <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a11">BOOL</a>
<a name="l00747"></a><a class="code" href="../../d0/d6/consubs_8c.html#a14">00747</a> <a class="code" href="../../d0/d6/consubs_8c.html#a14">ImeSysPropertyWindow</a>(
00748     HWND hWnd,
00749     WPARAM wParam,
00750     LPARAM lParam
00751     )
00752 {
00753     <a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html">PCONSOLE_TABLE</a> ConTbl;
00754     COPYDATASTRUCT CopyData;
00755 
00756     ConTbl = <a class="code" href="../../d4/d5/conimep_8h.html#a100">SearchConsole</a>(<a class="code" href="../../d0/d5/ntcon_2conime_2conime_8c.html#a3">LastConsole</a>);
00757     <span class="keywordflow">if</span> (ConTbl == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00758         <a class="code" href="../../d6/d5/ioep_8h.html#a21">DBGPRINT</a>((<span class="stringliteral">"CONIME: Error! Cannot found registed Console\n"</span>));
00759         <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00760     }
00761 
00762     CopyData.dwData = <a class="code" href="../../d3/d5/conime_8h.html#a8">CI_CONIMEPROPERTYINFO</a>;
00763     CopyData.cbData = <span class="keyword">sizeof</span>(WPARAM);
00764     CopyData.lpData = &amp;wParam;
00765 
00766     <a class="code" href="../../d4/d5/conimep_8h.html#a109">ConsoleImeSendMessage</a>( ConTbl-&gt;<a class="code" href="../../d0/d7/struct__CONSOLE__TABLE.html#o1">hWndCon</a>,
00767                            (WPARAM)<a class="code" href="../../d3/d8/aug98_2test_2main_8c.html#a29">hWnd</a>,
00768                            (LPARAM)&amp;CopyData
00769                           );
00770 
00771     <span class="keywordflow">return</span> <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00772 }
</div></pre><hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:39:33 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
