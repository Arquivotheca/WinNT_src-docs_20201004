<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: adtp.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>adtp.h File Reference</h1><code>#include "<a class="el" href="../../d9/d2/tokenp_8h-source.html">tokenp.h</a>"</code><br>

<p>
<a href="../../d2/d4/adtp_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Classes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">_SEP_AUDIT_BOUNDS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html">_SEP_AUDIT_OPTIONS</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a0">FULL_PRIVILEGE_AUDITING</a>&nbsp;&nbsp;&nbsp;L"FullPrivilegeAuditing"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>(AuditType, AccessGranted)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a2">SepAdtAuditThisEventEx</a>(AuditType, AccessGranted, AccessDenied)</td></tr>

<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">_SEP_AUDIT_BOUNDS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a7">SEP_AUDIT_BOUNDS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">_SEP_AUDIT_BOUNDS</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a8">PSEP_AUDIT_BOUNDS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>typedef <a class="el" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html">_SEP_AUDIT_OPTIONS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a13">SEP_AUDIT_OPTIONS</a></td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a15">SepAdtSetAuditEventInformation</a> (IN OPTIONAL PBOOLEAN AuditingMode, IN OPTIONAL PPOLICY_AUDIT_EVENT_OPTIONS EventAuditingOptions)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a16">SepAdtGetAuditEventInformation</a> (OUT OPTIONAL PBOOLEAN AuditingMode, OUT OPTIONAL PPOLICY_AUDIT_EVENT_OPTIONS EventAuditingOptions)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a17">SepAdtSetAuditLogInformation</a> (IN PPOLICY_AUDIT_LOG_INFO AuditLogInformation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a18">SepAdtMarshallAuditRecord</a> (IN PSE_ADT_PARAMETER_ARRAY AuditParameters, OUT PSE_ADT_PARAMETER_ARRAY *MarshalledAuditParameters, OUT PSEP_RM_LSA_MEMORY_TYPE RecordMemoryType)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a19">SepAdtPrivilegeObjectAuditAlarm</a> (IN PUNICODE_STRING CapturedSubsystemName OPTIONAL, IN PVOID HandleId, IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a> <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a11">ClientToken</a> OPTIONAL, IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a> <a class="el" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a>, IN PVOID ProcessId, IN ACCESS_MASK DesiredAccess, IN PPRIVILEGE_SET CapturedPrivileges, IN BOOLEAN AccessGranted)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a20">SepAdtTraverseAuditAlarm</a> (IN PLUID OperationID, IN PVOID DirectoryObject, IN PSID UserSid, IN LUID AuthenticationId, IN ACCESS_MASK DesiredAccess, IN PPRIVILEGE_SET Privileges OPTIONAL, IN BOOLEAN AccessGranted, IN BOOLEAN GenerateAudit, IN BOOLEAN GenerateAlarm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a21">SepAdtCreateInstanceAuditAlarm</a> (IN PLUID OperationID, IN PVOID Object, IN PSID UserSid, IN LUID AuthenticationId, IN ACCESS_MASK DesiredAccess, IN PPRIVILEGE_SET Privileges OPTIONAL, IN BOOLEAN AccessGranted, IN BOOLEAN GenerateAudit, IN BOOLEAN GenerateAlarm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a22">SepAdtCreateObjectAuditAlarm</a> (IN PLUID OperationID, IN PUNICODE_STRING <a class="el" href="../../d3/d3/tob_8c.html#a8">DirectoryName</a>, IN PUNICODE_STRING ComponentName, IN PSID UserSid, IN LUID AuthenticationId, IN ACCESS_MASK DesiredAccess, IN BOOLEAN AccessGranted, IN BOOLEAN GenerateAudit, IN BOOLEAN GenerateAlarm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a23">SepAdtHandleAuditAlarm</a> (IN PUNICODE_STRING Source, IN LUID OperationId, IN HANDLE <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a29">Handle</a>, IN PSID UserSid)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">*++  <a href="#a23"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a24">SepAdtPrivilegedServiceAuditAlarm</a> (IN PUNICODE_STRING CapturedSubsystemName, IN PUNICODE_STRING CapturedServiceName, IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a> <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a11">ClientToken</a> OPTIONAL, IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a> <a class="el" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a>, IN PPRIVILEGE_SET CapturedPrivileges, IN BOOLEAN AccessGranted)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a25">SepAdtCloseObjectAuditAlarm</a> (IN PUNICODE_STRING CapturedSubsystemName, IN PVOID HandleId, IN PVOID Object, IN PSID UserSid, IN LUID AuthenticationId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a26">SepAdtDeleteObjectAuditAlarm</a> (IN PUNICODE_STRING CapturedSubsystemName, IN PVOID HandleId, IN PVOID Object, IN PSID UserSid, IN LUID AuthenticationId)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a27">SepAdtOpenObjectAuditAlarm</a> (IN PUNICODE_STRING CapturedSubsystemName, IN PVOID *HandleId OPTIONAL, IN PUNICODE_STRING CapturedObjectTypeName, IN PVOID Object OPTIONAL, IN PUNICODE_STRING CapturedObjectName OPTIONAL, IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a> <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a11">ClientToken</a> OPTIONAL, IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a> <a class="el" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a>, IN ACCESS_MASK DesiredAccess, IN ACCESS_MASK GrantedAccess, IN PLUID OperationId, IN PPRIVILEGE_SET CapturedPrivileges OPTIONAL, IN BOOLEAN ObjectCreated, IN BOOLEAN AccessGranted, IN BOOLEAN GenerateAudit, IN BOOLEAN GenerateAlarm, IN HANDLE ProcessID, IN POLICY_AUDIT_EVENT_TYPE AuditType, IN <a class="el" href="../../d7/d9/struct__IOBJECT__TYPE__LIST.html">PIOBJECT_TYPE_LIST</a> ObjectTypeList OPTIONAL, IN ULONG ObjectTypeListLength, IN PACCESS_MASK GrantedAccessArray OPTIONAL)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a28">SepAdtOpenObjectForDeleteAuditAlarm</a> (IN PUNICODE_STRING CapturedSubsystemName, IN PVOID *HandleId, IN PUNICODE_STRING CapturedObjectTypeName, IN PVOID Object, IN PUNICODE_STRING CapturedObjectName, IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a> <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a11">ClientToken</a> OPTIONAL, IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a> <a class="el" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a>, IN ACCESS_MASK DesiredAccess, IN ACCESS_MASK GrantedAccess, IN PLUID OperationId, IN PPRIVILEGE_SET CapturedPrivileges OPTIONAL, IN BOOLEAN ObjectCreated, IN BOOLEAN AccessGranted, IN BOOLEAN GenerateAudit, IN BOOLEAN GenerateAlarm, IN HANDLE ProcessID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a29">SepAdtObjectReferenceAuditAlarm</a> (IN PLUID OperationID OPTIONAL, IN PVOID Object, IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a> SubjectSecurityContext, IN ACCESS_MASK DesiredAccess, IN PPRIVILEGE_SET Privileges OPTIONAL, IN BOOLEAN AccessGranted, IN BOOLEAN GenerateAudit, IN BOOLEAN GenerateAlarm)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a30">SepAdtInitializeBounds</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a31">SepAuditFailed</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>NTSTATUS&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a32">SepAdtInitializeCrashOnFail</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a33">SepInitializePrivilegeFilter</a> (BOOLEAN Verbose)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a34">SepAdtInitializePrivilegeAuditing</a> (VOID)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a35">SepAdtInitializeAuditingOptions</a> (VOID)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>POLICY_AUDIT_LOG_INFO&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a3">SepAdtLogInformation</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a4">SepAdtAuditingEnabled</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a5">SepAdtMaxListLength</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a6">SepAdtMinListLength</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a9">SepAdtCountEventsDiscarded</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a10">SepAdtCurrentListLength</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a11">SepAdtDiscardingAudits</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>BOOLEAN&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a12">SepCrashOnAuditFail</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html">SEP_AUDIT_OPTIONS</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/adtp_8h.html#a14">SepAuditOptions</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="adtp.h::FULL_PRIVILEGE_AUDITING" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define FULL_PRIVILEGE_AUDITING&nbsp;&nbsp;&nbsp;L"FullPrivilegeAuditing"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/adtp_8h-source.html#l00083">83</a> of file <a class="el" href="../../d2/d4/adtp_8h-source.html">adtp.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00329">SepAdtInitializePrivilegeAuditing()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="adtp.h::SepAdtAuditThisEvent" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepAdtAuditThisEvent          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">AuditType,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>AccessGranted&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(<a class="code" href="../../d7/d4/adt_8h.html#a3">SepAdtAuditingEnabled</a> &amp;&amp;                                           \
    ((<a class="code" href="../../d0/d5/se_8h.html#a105">SeAuditingState</a>[AuditType].<a class="code" href="../../d1/d0/struct__SE__AUDITING__STATE.html#o0">AuditOnSuccess</a> &amp;&amp; *AccessGranted) ||   \
    (<a class="code" href="../../d0/d5/se_8h.html#a105">SeAuditingState</a>[AuditType].<a class="code" href="../../d1/d0/struct__SE__AUDITING__STATE.html#o1">AuditOnFailure</a> &amp;&amp; !(*AccessGranted))))
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">264</a> of file <a class="el" href="../../d2/d4/adtp_8h-source.html">adtp.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04693">SeAuditingFileEvents()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04648">SeAuditingFileOrGlobalEvents()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03538">SeCreateObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03660">SeObjectReferenceAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02765">SeOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03085">SeOpenObjectForDeleteAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01312">SepAdtCloseObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01465">SepAdtDeleteObjectAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01794">SepAdtHandleAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00346">SepAdtPrivilegedServiceAuditAlarm()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00125">SepAdtPrivilegeObjectAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00989">SePrivilegedServiceAuditAlarm()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="adtp.h::SepAdtAuditThisEventEx" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define SepAdtAuditThisEventEx          </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">AuditType,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>AccessGranted,         <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>AccessDenied&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><pre class="fragment"><div>(<a class="code" href="../../d7/d4/adt_8h.html#a3">SepAdtAuditingEnabled</a> &amp;&amp;                                           \
    ((<a class="code" href="../../d0/d5/se_8h.html#a105">SeAuditingState</a>[AuditType].<a class="code" href="../../d1/d0/struct__SE__AUDITING__STATE.html#o0">AuditOnSuccess</a> &amp;&amp; AccessGranted) ||    \
     (<a class="code" href="../../d0/d5/se_8h.html#a105">SeAuditingState</a>[AuditType].<a class="code" href="../../d1/d0/struct__SE__AUDITING__STATE.html#o1">AuditOnFailure</a> &amp;&amp; AccessDenied)))
</div></pre>
<p>
Definition at line <a class="el" href="../../d2/d4/adtp_8h-source.html#l00269">269</a> of file <a class="el" href="../../d2/d4/adtp_8h-source.html">adtp.h</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>.    </td>
  </tr>
</table>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="a8" doxytag="adtp.h::PSEP_AUDIT_BOUNDS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">_SEP_AUDIT_BOUNDS</a> * <a class="el" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">PSEP_AUDIT_BOUNDS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00117">SepAdtInitializeBounds()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="adtp.h::SEP_AUDIT_BOUNDS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">_SEP_AUDIT_BOUNDS</a>  <a class="el" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">SEP_AUDIT_BOUNDS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00117">SepAdtInitializeBounds()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="adtp.h::SEP_AUDIT_OPTIONS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef struct <a class="el" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html">_SEP_AUDIT_OPTIONS</a>  <a class="el" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html">SEP_AUDIT_OPTIONS</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a25" doxytag="adtp.h::SepAdtCloseObjectAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtCloseObjectAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedSubsystemName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>UserSid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LUID&nbsp;</td>
          <td class="mdname" nowrap> <em>AuthenticationId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01312">1312</a> of file <a class="el" href="../../d8/d5/sepaudit_8c-source.html">sepaudit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00320">_SEP_AUDIT_OPTIONS::DoNotAuditCloseObjectEvents</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00814">PsProcessAuditId</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">SepAdtAuditThisEvent</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00323">SepAuditOptions</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00051">SepSetParmTypeSid</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00059">SepSetParmTypeString</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00076">SepSetParmTypeUlong</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02492">NtCloseObjectAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03826">SeCloseObjectAuditAlarm()</a>.
<p>
<pre class="fragment"><div>01322                    :
01323 
01324     This routine implements <a class="code" href="../../d3/d5/seaudit_8c.html#a21">NtCloseObjectAuditAlarm</a> after parameters have
01325     been captured.
01326 
01327     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to generate audit and alarm messages when a handle
01328     to a <span class="keyword">protected</span> subsystem object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> deleted.  This routine may result in
01329     several messages being generated and sent to Port objects.  This may
01330     result in a significant latency before returning.  Design of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a>
01331     that must call <span class="keyword">this</span> routine must take <span class="keyword">this</span> potential latency into
01332     account.  This may have an impact on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> approach taken <span class="keywordflow">for</span> data
01333     structure mutex locking, <span class="keywordflow">for</span> example.
01334 
01335     This API requires <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller have <a class="code" href="../../d0/d5/se_8h.html#a84">SeTcbPrivilege</a> privilege.  The test
01336     <span class="keywordflow">for</span> <span class="keyword">this</span> privilege <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> always against <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary token of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling
01337     process, allowing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller to be impersonating a client during <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01338     call with no ill effects.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed that <span class="keyword">this</span> privilege has been
01339     tested at a higher level.
01340 
01341     This routine will create an SE_ADT_PARAMETERS array organized as follows:
01342 
01343     Parameter[0] - User Sid
01344 
01345     Parameter[1] - Subsystem name (<span class="keywordflow">if</span> available)
01346 
01347     Parameter[2] - New handle <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>
01348 
01349     Parameter[3] - Subject's process <span class="keywordtype">id</span>
01350 
01351 Arguments:
01352 
01353     CapturedSubsystemName - Supplies a name string identifying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01354         subsystem calling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> routine.
01355 
01356     HandleId - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> unique value representing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client's handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01357         object.
01358 
01359     Object - The address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being closed
01360 
01361     UserSid - The Sid identifying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current caller.
01362 
01363 
01364 
01365 Return value:
01366 
01367     None.
01368 
01369 
01370 --*/
01371 
01372 {
01373 
01374     SE_ADT_PARAMETER_ARRAY AuditParameters;
01375     BOOLEAN AccessGranted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01376     HANDLE ProcessId;
01377 
01378     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01379 
01380     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a14">SepAuditOptions</a>.<a class="code" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html#o0">DoNotAuditCloseObjectEvents</a> ) {
01381 
01382         <span class="keywordflow">return</span>;
01383     }
01384     
01385     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryObjectAccess, &amp;AccessGranted ) ) {
01386 
01387         <span class="comment">//</span>
01388         <span class="comment">// A completely zero'd entry will be interpreted</span>
01389         <span class="comment">// as a "null string" or not supplied parameter.</span>
01390         <span class="comment">//</span>
01391         <span class="comment">// Initializing the entire array up front will allow</span>
01392         <span class="comment">// us to avoid filling in each not supplied entry.</span>
01393         <span class="comment">//</span>
01394 
01395         RtlZeroMemory (
01396            (PVOID) &amp;AuditParameters,
01397            <span class="keyword">sizeof</span>( AuditParameters )
01398            );
01399 
01400         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( SeAdtParmTypeNone == 0 );
01401 
01402         AuditParameters.CategoryId = SE_CATEGID_OBJECT_ACCESS;
01403         AuditParameters.AuditId = SE_AUDITID_CLOSE_HANDLE;
01404         AuditParameters.ParameterCount = 0;
01405         AuditParameters.Type = EVENTLOG_AUDIT_SUCCESS;
01406 
01407 
01408         <span class="comment">//</span>
01409         <span class="comment">//  Parameter[0] - User Sid</span>
01410         <span class="comment">//</span>
01411 
01412         <a class="code" href="../../d7/d6/sepaudit_8c.html#a0">SepSetParmTypeSid</a>( AuditParameters, AuditParameters.ParameterCount, UserSid );
01413 
01414         AuditParameters.ParameterCount++;
01415 
01416 
01417         <span class="comment">//</span>
01418         <span class="comment">//  Parameter[1] - Subsystem name (if available)</span>
01419         <span class="comment">//</span>
01420 
01421         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( CapturedSubsystemName )) {
01422 
01423             <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, CapturedSubsystemName );
01424         }
01425 
01426         AuditParameters.ParameterCount++;
01427 
01428         <span class="comment">//</span>
01429         <span class="comment">//  Parameter[2] - Subsystem name (if available)</span>
01430         <span class="comment">//</span>
01431 
01432         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( CapturedSubsystemName )) {
01433 
01434             <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, CapturedSubsystemName );
01435         }
01436 
01437         AuditParameters.ParameterCount++;
01438 
01439         <span class="comment">//</span>
01440         <span class="comment">//    Parameter[3] - New handle ID</span>
01441         <span class="comment">//</span>
01442 
01443         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)HandleId) );
01444 
01445         AuditParameters.ParameterCount++;
01446 
01447         <span class="comment">//</span>
01448         <span class="comment">//    Parameter[4] - Subject's process id</span>
01449         <span class="comment">//</span>
01450 
01451         ProcessId =  <a class="code" href="../../d1/d9/ps_8h.html#a25">PsProcessAuditId</a>( <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>() );
01452 
01453         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)ProcessId) );
01454 
01455         AuditParameters.ParameterCount++;
01456 
01457         <a class="code" href="../../d0/d5/adtlog_8c.html#a0">SepAdtLogAuditRecord</a>( &amp;AuditParameters );
01458 
01459     }
01460 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="adtp.h::SepAdtCreateInstanceAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtCreateInstanceAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID&nbsp;</td>
          <td class="mdname" nowrap> <em>OperationID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>UserSid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LUID&nbsp;</td>
          <td class="mdname" nowrap> <em>AuthenticationId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET Privileges&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAudit</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAlarm</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a22" doxytag="adtp.h::SepAdtCreateObjectAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtCreateObjectAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID&nbsp;</td>
          <td class="mdname" nowrap> <em>OperationID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>DirectoryName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>ComponentName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>UserSid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LUID&nbsp;</td>
          <td class="mdname" nowrap> <em>AuthenticationId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAudit</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAlarm</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03538">SeCreateObjectAuditAlarm()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a26" doxytag="adtp.h::SepAdtDeleteObjectAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtDeleteObjectAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedSubsystemName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>UserSid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LUID&nbsp;</td>
          <td class="mdname" nowrap> <em>AuthenticationId</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01465">1465</a> of file <a class="el" href="../../d8/d5/sepaudit_8c-source.html">sepaudit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00814">PsProcessAuditId</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">SepAdtAuditThisEvent</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00051">SepSetParmTypeSid</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00059">SepSetParmTypeString</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00076">SepSetParmTypeUlong</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02627">NtDeleteObjectAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03892">SeDeleteObjectAuditAlarm()</a>.
<p>
<pre class="fragment"><div>01475                    :
01476 
01477     This routine implements <a class="code" href="../../d3/d5/seaudit_8c.html#a22">NtDeleteObjectAuditAlarm</a> after parameters have
01478     been captured.
01479 
01480     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to generate audit and alarm messages when an object
01481     in a <span class="keyword">protected</span> subsystem object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> deleted.  This routine may result in
01482     several messages being generated and sent to Port objects.  This may
01483     result in a significant latency before returning.  Design of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a>
01484     that must call <span class="keyword">this</span> routine must take <span class="keyword">this</span> potential latency into
01485     account.  This may have an impact on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> approach taken <span class="keywordflow">for</span> data
01486     structure mutex locking, <span class="keywordflow">for</span> example.
01487 
01488     This API requires <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller have <a class="code" href="../../d0/d5/se_8h.html#a84">SeTcbPrivilege</a> privilege.  The test
01489     <span class="keywordflow">for</span> <span class="keyword">this</span> privilege <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> always against <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary token of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling
01490     process, allowing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller to be impersonating a client during <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01491     call with no ill effects.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed that <span class="keyword">this</span> privilege has been
01492     tested at a higher level.
01493 
01494     This routine will create an SE_ADT_PARAMETERS array organized as follows:
01495 
01496     Parameter[0] - User Sid
01497 
01498     Parameter[1] - Subsystem name (<span class="keywordflow">if</span> available)
01499 
01500     Parameter[2] - <a class="code" href="../../d7/d0/cmdat2_8c.html#a19">Handle</a> <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>
01501 
01502     Parameter[3] - Subject's process <span class="keywordtype">id</span>
01503 
01504 Arguments:
01505 
01506     CapturedSubsystemName - Supplies a name string identifying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01507         subsystem calling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> routine.
01508 
01509     HandleId - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> unique value representing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client's handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
01510         object.
01511 
01512     Object - The address of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being closed
01513 
01514     UserSid - The Sid identifying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current caller.
01515 
01516 
01517 
01518 Return value:
01519 
01520     None.
01521 
01522 
01523 --*/
01524 
01525 {
01526 
01527     SE_ADT_PARAMETER_ARRAY AuditParameters;
01528     BOOLEAN AccessGranted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01529     HANDLE ProcessId;
01530 
01531     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01532 
01533     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryObjectAccess, &amp;AccessGranted ) ) {
01534 
01535         <span class="comment">//</span>
01536         <span class="comment">// A completely zero'd entry will be interpreted</span>
01537         <span class="comment">// as a "null string" or not supplied parameter.</span>
01538         <span class="comment">//</span>
01539         <span class="comment">// Initializing the entire array up front will allow</span>
01540         <span class="comment">// us to avoid filling in each not supplied entry.</span>
01541         <span class="comment">//</span>
01542 
01543         RtlZeroMemory (
01544            (PVOID) &amp;AuditParameters,
01545            <span class="keyword">sizeof</span>( AuditParameters )
01546            );
01547 
01548         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( SeAdtParmTypeNone == 0 );
01549 
01550         AuditParameters.CategoryId = SE_CATEGID_OBJECT_ACCESS;
01551         AuditParameters.AuditId = SE_AUDITID_DELETE_OBJECT;
01552         AuditParameters.ParameterCount = 0;
01553         AuditParameters.Type = EVENTLOG_AUDIT_SUCCESS;
01554 
01555 
01556         <span class="comment">//</span>
01557         <span class="comment">//  Parameter[0] - User Sid</span>
01558         <span class="comment">//</span>
01559 
01560         <a class="code" href="../../d7/d6/sepaudit_8c.html#a0">SepSetParmTypeSid</a>( AuditParameters, AuditParameters.ParameterCount, UserSid );
01561 
01562         AuditParameters.ParameterCount++;
01563 
01564 
01565         <span class="comment">//</span>
01566         <span class="comment">//  Parameter[1] - Subsystem name (if available)</span>
01567         <span class="comment">//</span>
01568 
01569         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( CapturedSubsystemName )) {
01570 
01571             <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, CapturedSubsystemName );
01572         }
01573 
01574         AuditParameters.ParameterCount++;
01575 
01576         <span class="comment">//</span>
01577         <span class="comment">//  Parameter[2] - Subsystem name (if available)</span>
01578         <span class="comment">//</span>
01579 
01580         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( CapturedSubsystemName )) {
01581 
01582             <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, CapturedSubsystemName );
01583         }
01584 
01585         AuditParameters.ParameterCount++;
01586 
01587         <span class="comment">//</span>
01588         <span class="comment">//    Parameter[3] - New handle ID</span>
01589         <span class="comment">//</span>
01590 
01591         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)HandleId) );
01592 
01593         AuditParameters.ParameterCount++;
01594 
01595         <span class="comment">//</span>
01596         <span class="comment">//    Parameter[4] - Subject's process id</span>
01597         <span class="comment">//</span>
01598 
01599         ProcessId =  <a class="code" href="../../d1/d9/ps_8h.html#a25">PsProcessAuditId</a>( <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>() );
01600 
01601         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)ProcessId) );
01602 
01603         AuditParameters.ParameterCount++;
01604 
01605         <a class="code" href="../../d0/d5/adtlog_8c.html#a0">SepAdtLogAuditRecord</a>( &amp;AuditParameters );
01606 
01607     }
01608 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="adtp.h::SepAdtGetAuditEventInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtGetAuditEventInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">OUT OPTIONAL PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AuditingMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT OPTIONAL PPOLICY_AUDIT_EVENT_OPTIONS&nbsp;</td>
          <td class="mdname" nowrap> <em>EventAuditingOptions</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="adtp.h::SepAdtHandleAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtHandleAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>Source</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LUID&nbsp;</td>
          <td class="mdname" nowrap> <em>OperationId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>Handle</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>UserSid</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
*++ 
<p>

<p>
Definition at line <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01794">1794</a> of file <a class="el" href="../../d8/d5/sepaudit_8c-source.html">sepaudit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d9/cmdat2_8c-source.html#l00091">Handle</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00643">PsGetCurrentProcess</a>, <a class="el" href="../../d2/d8/ps_8h-source.html#l00814">PsProcessAuditId</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">SepAdtAuditThisEvent</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00051">SepSetParmTypeSid</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00059">SepSetParmTypeString</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00076">SepSetParmTypeUlong</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
<pre class="fragment"><div>01803                    :
01804 
01805     Creates an audit record <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> creation of an object handle.
01806 
01807 Arguments:
01808 
01809 
01810 Return Value:
01811 
01812     None.
01813 
01814 --*/
01815 
01816 {
01817     BOOLEAN AccessGranted = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
01818     SE_ADT_PARAMETER_ARRAY AuditParameters;
01819     HANDLE ProcessID;
01820 
01821     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
01822 
01823     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryObjectAccess, &amp;AccessGranted )) {
01824 
01825         <span class="comment">//</span>
01826         <span class="comment">// A completely zero'd entry will be interpreted</span>
01827         <span class="comment">// as a "null string" or not supplied parameter.</span>
01828         <span class="comment">//</span>
01829         <span class="comment">// Initializing the entire array up front will allow</span>
01830         <span class="comment">// us to avoid filling in each not supplied entry.</span>
01831         <span class="comment">//</span>
01832 
01833         RtlZeroMemory (
01834            (PVOID) &amp;AuditParameters,
01835            <span class="keyword">sizeof</span>( AuditParameters )
01836            );
01837 
01838         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( SeAdtParmTypeNone == 0 );
01839 
01840         AuditParameters.CategoryId = SE_CATEGID_OBJECT_ACCESS;
01841         AuditParameters.AuditId = SE_AUDITID_CREATE_HANDLE;
01842         AuditParameters.ParameterCount = 0;
01843         AuditParameters.Type = EVENTLOG_AUDIT_SUCCESS;
01844 
01845 
01846         <span class="comment">//</span>
01847         <span class="comment">//  Parameter[0] - User Sid</span>
01848         <span class="comment">//</span>
01849 
01850         <a class="code" href="../../d7/d6/sepaudit_8c.html#a0">SepSetParmTypeSid</a>( AuditParameters, AuditParameters.ParameterCount, UserSid );
01851 
01852         AuditParameters.ParameterCount++;
01853 
01854 
01855         <span class="comment">//</span>
01856         <span class="comment">//  Parameter[1] - Subsystem name (if available)</span>
01857         <span class="comment">//</span>
01858 
01859         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( Source )) {
01860 
01861             <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, Source );
01862         }
01863 
01864         AuditParameters.ParameterCount++;
01865 
01866         <span class="comment">//</span>
01867         <span class="comment">//    Parameter[2] - New handle ID</span>
01868         <span class="comment">//</span>
01869 
01870         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)Handle) );
01871 
01872         AuditParameters.ParameterCount++;
01873 
01874         <span class="comment">//</span>
01875         <span class="comment">//    Parameters 3,4 - Operation ID</span>
01876         <span class="comment">//</span>
01877 
01878 
01879         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, OperationId.HighPart );
01880 
01881         AuditParameters.ParameterCount++;
01882 
01883         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, OperationId.LowPart );
01884 
01885         AuditParameters.ParameterCount++;
01886 
01887 
01888         <span class="comment">//</span>
01889         <span class="comment">//    Parameter[5] - Subject's process id</span>
01890         <span class="comment">//</span>
01891 
01892         ProcessID =  <a class="code" href="../../d1/d9/ps_8h.html#a25">PsProcessAuditId</a>( <a class="code" href="../../d1/d9/ps_8h.html#a19">PsGetCurrentProcess</a>() );
01893 
01894         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)ProcessID) );
01895 
01896         AuditParameters.ParameterCount++;
01897 
01898         <a class="code" href="../../d0/d5/adtlog_8c.html#a0">SepAdtLogAuditRecord</a>( &amp;AuditParameters );
01899 
01900     }
01901 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a35" doxytag="adtp.h::SepAdtInitializeAuditingOptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtInitializeAuditingOptions           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00425">425</a> of file <a class="el" href="../../d0/d4/adtinit_8c-source.html">adtinit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d0/bench_8c-source.html#l00050">CHAR</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00320">_SEP_AUDIT_OPTIONS::DoNotAuditCloseObjectEvents</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00059">KeyName</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00323">SepAuditOptions</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
Referenced by <a class="el" href="../../d1/d9/rmmain_8c-source.html#l00060">SeRmInitPhase1()</a>.
<p>
<pre class="fragment"><div>00431                    :
00432 
00433     Initialize options that <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a58">control</a> auditing.
00434     (please refer to note in adtp.h near <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> def. of <a class="code" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html">SEP_AUDIT_OPTIONS</a>)
00435 
00436 Arguments:
00437 
00438     None
00439 
00440 Return Value:
00441 
00442     None
00443 
00444 --*/
00445 
00446 {
00447     HANDLE KeyHandle;
00448     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00449     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> TmpStatus;
00450     OBJECT_ATTRIBUTES Obja;
00451     ULONG ResultLength;
00452     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00453     UNICODE_STRING <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00454     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> KeyInfo[<span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + <span class="keyword">sizeof</span>(BOOLEAN)];
00455 
00456     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00457 
00458     <span class="comment">//</span>
00459     <span class="comment">// Query the registry </span>
00460     <span class="comment">//</span>
00461     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;KeyName, L<span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\Lsa\\AuditingOptions"</span>);
00462 
00463     InitializeObjectAttributes( &amp;Obja,
00464                                 &amp;KeyName,
00465                                 OBJ_CASE_INSENSITIVE,
00466                                 NULL,
00467                                 NULL
00468                                 );
00469 
00470     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(
00471                  &amp;KeyHandle,
00472                  KEY_QUERY_VALUE,
00473                  &amp;Obja
00474                  );
00475 
00476 
00477     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00478 
00479         <span class="keywordflow">goto</span> Cleanup;
00480     }
00481 
00482     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;ValueName, L<span class="stringliteral">"DoNotAuditCloseObjectEvents"</span> );
00483 
00484     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00485                  KeyHandle,
00486                  &amp;ValueName,
00487                  KeyValuePartialInformation,
00488                  KeyInfo,
00489                  <span class="keyword">sizeof</span>(KeyInfo),
00490                  &amp;ResultLength
00491                  );
00492 
00493     TmpStatus = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(KeyHandle);
00494     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus));
00495 
00496     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00497         <span class="comment">//</span>
00498         <span class="comment">// we check for the presence of this value, its value does not matter</span>
00499         <span class="comment">//</span>
00500         <a class="code" href="../../d1/d5/adtp_8h.html#a14">SepAuditOptions</a>.<a class="code" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html#o0">DoNotAuditCloseObjectEvents</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00501     }
00502 
00503 Cleanup:
00504 
00505     <span class="keywordflow">return</span>;
00506 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a30" doxytag="adtp.h::SepAdtInitializeBounds" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtInitializeBounds           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00117">117</a> of file <a class="el" href="../../d0/d4/adtinit_8c-source.html">adtinit.c</a>.
<p>
References <a class="el" href="../../d6/d4/cc_8h-source.html#l00126">ExAllocatePool</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00059">KeyName</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00047">_SEP_AUDIT_BOUNDS::LowerBound</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d6/d9/obclose_8c-source.html#l00037">NtClose()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l01870">NtOpenKey()</a>, <a class="el" href="../../d8/d6/ntapi_8c-source.html#l02187">NtQueryValueKey()</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00027">ObjectAttributes</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d1/d5/adtp_8h.html#a8">PSEP_AUDIT_BOUNDS</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d1/d5/adtp_8h.html#a7">SEP_AUDIT_BOUNDS</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00037">SepAdtMaxListLength</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00038">SepAdtMinListLength</a>, <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00039">SepAdtValidateAuditBounds()</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00046">_SEP_AUDIT_BOUNDS::UpperBound</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/rmaudit_8c-source.html#l00051">SepRmSetAuditEventWrkr()</a>.
<p>
<pre class="fragment"><div>00123                    :
00124 
00125     Queries <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d2/d3/fetypes_8h.html#a457a417">high</a> and <a class="code" href="../../d2/d3/fetypes_8h.html#a457a418">low</a> water mark values <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00126     audit log.  If they are not found or are unacceptable, returns without
00127     modifying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current values, which are statically initialized.
00128 
00129 Arguments:
00130 
00131     None.
00132 
00133 Return Value:
00134 
00135     None.
00136 
00137 --*/
00138 
00139 {
00140 
00141     HANDLE KeyHandle;
00142     OBJECT_ATTRIBUTES <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a4">ObjectAttributes</a>;
00143     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00144     UNICODE_STRING <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00145     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00146     <a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">PSEP_AUDIT_BOUNDS</a> AuditBounds;
00147     PKEY_VALUE_PARTIAL_INFORMATION KeyValueInformation;
00148     ULONG Length;
00149 
00150     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00151 
00152     <span class="comment">//</span>
00153     <span class="comment">// Get the high and low water marks out of the registry.</span>
00154     <span class="comment">//</span>
00155 
00156     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;KeyName, L<span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\Lsa"</span>);
00157 
00158     InitializeObjectAttributes(
00159         &amp;ObjectAttributes,
00160         &amp;KeyName,
00161         OBJ_CASE_INSENSITIVE,
00162         NULL,
00163         NULL
00164         );
00165 
00166     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(
00167                  &amp;KeyHandle,
00168                  KEY_QUERY_VALUE,
00169                  &amp;ObjectAttributes
00170                  );
00171 
00172     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00173 
00174         <span class="comment">//</span>
00175         <span class="comment">// Didn't work, take the defaults</span>
00176         <span class="comment">//</span>
00177 
00178         <span class="keywordflow">return</span>;
00179     }
00180 
00181     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;ValueName, L<span class="stringliteral">"Bounds"</span>);
00182 
00183     Length = <span class="keyword">sizeof</span>( KEY_VALUE_PARTIAL_INFORMATION ) - <span class="keyword">sizeof</span>( UCHAR ) + <span class="keyword">sizeof</span>( <a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">SEP_AUDIT_BOUNDS</a> );
00184 
00185     KeyValueInformation = <a class="code" href="../../d5/d5/cc_8h.html#a10">ExAllocatePool</a>( PagedPool, Length );
00186 
00187     <span class="keywordflow">if</span> ( KeyValueInformation == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00188 
00189         <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( KeyHandle );
00190         <span class="keywordflow">return</span>;
00191     }
00192 
00193     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00194                  KeyHandle,
00195                  &amp;ValueName,
00196                  KeyValuePartialInformation,
00197                  (PVOID)KeyValueInformation,
00198                  Length,
00199                  &amp;Length
00200                  );
00201 
00202     <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>( KeyHandle );
00203 
00204     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00205 
00206         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( KeyValueInformation );
00207         <span class="keywordflow">return</span>;
00208     }
00209 
00210 
00211     AuditBounds = (<a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html">PSEP_AUDIT_BOUNDS</a>) &amp;KeyValueInformation-&gt;Data;
00212 
00213     <span class="comment">//</span>
00214     <span class="comment">// Sanity check what we got back</span>
00215     <span class="comment">//</span>
00216 
00217     <span class="keywordflow">if</span>(!<a class="code" href="../../d6/d6/sep_8h.html#a70">SepAdtValidateAuditBounds</a>( AuditBounds-&gt;<a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html#o0">UpperBound</a>, AuditBounds-&gt;<a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html#o1">LowerBound</a> )) {
00218 
00219         <span class="comment">//</span>
00220         <span class="comment">// The values we got back are not to our liking.  Use the defaults.</span>
00221         <span class="comment">//</span>
00222 
00223         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( KeyValueInformation );
00224         <span class="keywordflow">return</span>;
00225     }
00226 
00227     <span class="comment">//</span>
00228     <span class="comment">// Take what we got from the registry.</span>
00229     <span class="comment">//</span>
00230 
00231     <a class="code" href="../../d1/d5/adtp_8h.html#a5">SepAdtMaxListLength</a> = AuditBounds-&gt;<a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html#o0">UpperBound</a>;
00232     <a class="code" href="../../d1/d5/adtp_8h.html#a6">SepAdtMinListLength</a> = AuditBounds-&gt;<a class="code" href="../../d3/d1/struct__SEP__AUDIT__BOUNDS.html#o1">LowerBound</a>;
00233 
00234     <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( KeyValueInformation );
00235 
00236     <span class="keywordflow">return</span>;
00237 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a32" doxytag="adtp.h::SepAdtInitializeCrashOnFail" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SepAdtInitializeCrashOnFail           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00242">242</a> of file <a class="el" href="../../d0/d4/adtinit_8c-source.html">adtinit.c</a>.
<p>
<pre class="fragment"><div>00248                    :
00249 
00250     Reads <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry to see <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> user has told us to crash <span class="keywordflow">if</span> an audit fails.
00251 
00252 Arguments:
00253 
00254     None.
00255 
00256 Return Value:
00257 
00258     STATUS_SUCCESS
00259 
00260 --*/
00261 
00262 {
00263     HANDLE KeyHandle;
00264     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00265     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> TmpStatus;
00266     OBJECT_ATTRIBUTES Obja;
00267     ULONG ResultLength;
00268     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00269     UNICODE_STRING <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00270     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> KeyInfo[<span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + <span class="keyword">sizeof</span>(BOOLEAN)];
00271     PKEY_VALUE_PARTIAL_INFORMATION pKeyInfo;
00272 
00273     <a class="code" href="../../d1/d5/adtp_8h.html#a12">SepCrashOnAuditFail</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00274 
00275     <span class="comment">//</span>
00276     <span class="comment">// Check the value of the CrashOnAudit flag in the registry.</span>
00277     <span class="comment">//</span>
00278 
00279     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;KeyName, L<span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\Lsa"</span>);
00280 
00281     InitializeObjectAttributes( &amp;Obja,
00282                                 &amp;KeyName,
00283                                 OBJ_CASE_INSENSITIVE,
00284                                 NULL,
00285                                 NULL
00286                                 );
00287 
00288     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(
00289                  &amp;KeyHandle,
00290                  KEY_QUERY_VALUE | KEY_SET_VALUE,
00291                  &amp;Obja
00292                  );
00293 
00294     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_OBJECT_NAME_NOT_FOUND) {
00295         <span class="keywordflow">return</span>( STATUS_SUCCESS );
00296     }
00297 
00298     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;ValueName, CRASH_ON_AUDIT_FAIL_VALUE );
00299 
00300     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00301                  KeyHandle,
00302                  &amp;ValueName,
00303                  KeyValuePartialInformation,
00304                  KeyInfo,
00305                  <span class="keyword">sizeof</span>(KeyInfo),
00306                  &amp;ResultLength
00307                  );
00308 
00309     TmpStatus = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(KeyHandle);
00310     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus));
00311 
00312     <span class="comment">//</span>
00313     <span class="comment">// If the key isn't there, don't turn on CrashOnFail.</span>
00314     <span class="comment">//</span>
00315 
00316     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00317 
00318         pKeyInfo = (PKEY_VALUE_PARTIAL_INFORMATION)KeyInfo;
00319         <span class="keywordflow">if</span> ((UCHAR) *(pKeyInfo-&gt;Data) == LSAP_CRASH_ON_AUDIT_FAIL) {
00320             <a class="code" href="../../d1/d5/adtp_8h.html#a12">SepCrashOnAuditFail</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00321         }
00322     }
00323 
00324     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00325 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a34" doxytag="adtp.h::SepAdtInitializePrivilegeAuditing" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepAdtInitializePrivilegeAuditing           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00329">329</a> of file <a class="el" href="../../d0/d4/adtinit_8c-source.html">adtinit.c</a>.
<p>
<pre class="fragment"><div>00335                    :
00336 
00337     Checks to see <span class="keywordflow">if</span> there <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> an entry in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> registry telling us to <span class="keywordflow">do</span> full privilege auditing
00338     (which currently means audit everything we normall audit, plus backup and restore privileges).
00339 
00340 Arguments:
00341 
00342     None
00343 
00344 Return Value:
00345 
00346     BOOLEAN - <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">if</span> Auditing has been initialized correctly, <span class="keywordflow">else</span> <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>.
00347 
00348 --*/
00349 
00350 {
00351     HANDLE KeyHandle;
00352     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00353     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> TmpStatus;
00354     OBJECT_ATTRIBUTES Obja;
00355     ULONG ResultLength;
00356     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00357     UNICODE_STRING <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00358     <a class="code" href="../../d1/d1/bench_8c.html#a16">CHAR</a> KeyInfo[<span class="keyword">sizeof</span>(KEY_VALUE_PARTIAL_INFORMATION) + <span class="keyword">sizeof</span>(BOOLEAN)];
00359     PKEY_VALUE_PARTIAL_INFORMATION pKeyInfo;
00360     BOOLEAN Verbose;
00361 
00362     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00363 
00364     <span class="comment">//</span>
00365     <span class="comment">// Query the registry to set up the privilege auditing filter.</span>
00366     <span class="comment">//</span>
00367 
00368     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;KeyName, L<span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\Lsa"</span>);
00369 
00370     InitializeObjectAttributes( &amp;Obja,
00371                                 &amp;KeyName,
00372                                 OBJ_CASE_INSENSITIVE,
00373                                 NULL,
00374                                 NULL
00375                                 );
00376 
00377     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a23">NtOpenKey</a>(
00378                  &amp;KeyHandle,
00379                  KEY_QUERY_VALUE | KEY_SET_VALUE,
00380                  &amp;Obja
00381                  );
00382 
00383 
00384     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00385 
00386         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_OBJECT_NAME_NOT_FOUND) {
00387 
00388             <span class="keywordflow">return</span> ( <a class="code" href="../../d3/d5/seaudit_8c.html#a33">SepInitializePrivilegeFilter</a>( FALSE ));
00389 
00390         } <span class="keywordflow">else</span> {
00391 
00392             <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00393         }
00394     }
00395 
00396     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;ValueName, FULL_PRIVILEGE_AUDITING );
00397 
00398     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d7/d7/ntapi_8c.html#a25">NtQueryValueKey</a>(
00399                  KeyHandle,
00400                  &amp;ValueName,
00401                  KeyValuePartialInformation,
00402                  KeyInfo,
00403                  <span class="keyword">sizeof</span>(KeyInfo),
00404                  &amp;ResultLength
00405                  );
00406 
00407     TmpStatus = <a class="code" href="../../d5/d0/obclose_8c.html#a1">NtClose</a>(KeyHandle);
00408     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(TmpStatus));
00409 
00410     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00411 
00412         Verbose = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00413 
00414     } <span class="keywordflow">else</span> {
00415 
00416         pKeyInfo = (PKEY_VALUE_PARTIAL_INFORMATION)KeyInfo;
00417         Verbose = (BOOLEAN) *(pKeyInfo-&gt;Data);
00418     }
00419 
00420     <span class="keywordflow">return</span> ( <a class="code" href="../../d3/d5/seaudit_8c.html#a33">SepInitializePrivilegeFilter</a>( Verbose ));
00421 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="adtp.h::SepAdtMarshallAuditRecord" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> NTSTATUS SepAdtMarshallAuditRecord           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PSE_ADT_PARAMETER_ARRAY&nbsp;</td>
          <td class="mdname" nowrap> <em>AuditParameters</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSE_ADT_PARAMETER_ARRAY *&nbsp;</td>
          <td class="mdname" nowrap> <em>MarshalledAuditParameters</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>OUT PSEP_RM_LSA_MEMORY_TYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>RecordMemoryType</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00264">264</a> of file <a class="el" href="../../d1/d4/adtlog_8c-source.html">adtlog.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, and <a class="el" href="../../d1/d1/usrbench_8h-source.html#l00230">SourceString</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>.
<p>
<pre class="fragment"><div>00272                    :
00273 
00274     This routine will take an AuditParamters structure and create
00275     a <span class="keyword">new</span> AuditParameters structure that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> suitable <span class="keywordflow">for</span> sending
00276     to LSA.  It will be in <span class="keyword">self</span>-relative form and allocated as
00277     a single chunk of memory.
00278 
00279 Arguments:
00280 
00281 
00282     AuditParameters - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> filled in set of AuditParameters to be marshalled.
00283 
00284     MarshalledAuditParameters - Returns a pointer to a block of heap memory
00285         containing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> passed AuditParameters in <span class="keyword">self</span>-relative form suitable
00286         <span class="keywordflow">for</span> passing to LSA.
00287 
00288 
00289 Return Value:
00290 
00291     None.
00292 
00293 --*/
00294 
00295 {
00296     ULONG i;
00297     ULONG TotalSize = <span class="keyword">sizeof</span>( SE_ADT_PARAMETER_ARRAY );
00298     PUNICODE_STRING TargetString;
00299     PCHAR Base;
00300     ULONG BaseIncr;
00301 
00302     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00303 
00304     <span class="comment">//</span>
00305     <span class="comment">// Calculate the total size required for the passed AuditParameters</span>
00306     <span class="comment">// block.  This calculation will probably be an overestimate of the</span>
00307     <span class="comment">// amount of space needed, because data smaller that 2 dwords will</span>
00308     <span class="comment">// be stored directly in the parameters structure, but their length</span>
00309     <span class="comment">// will be counted here anyway.  The overestimate can't be more than</span>
00310     <span class="comment">// 24 dwords, and will never even approach that amount, so it isn't</span>
00311     <span class="comment">// worth the time it would take to avoid it.</span>
00312     <span class="comment">//</span>
00313 
00314     <span class="keywordflow">for</span> (i=0; i&lt;AuditParameters-&gt;ParameterCount; i++) {
00315         TotalSize += (ULONG)LongAlignSize(AuditParameters-&gt;Parameters[i].Length);
00316     }
00317 
00318     <span class="comment">//</span>
00319     <span class="comment">// Allocate a big enough block of memory to hold everything.</span>
00320     <span class="comment">// If it fails, quietly abort, since there isn't much else we</span>
00321     <span class="comment">// can do.</span>
00322     <span class="comment">//</span>
00323 
00324     *MarshalledAuditParameters = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, TotalSize, 'pAeS' );
00325 
00326     <span class="keywordflow">if</span> (*MarshalledAuditParameters == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) {
00327 
00328         *RecordMemoryType = SepRmNoMemory;
00329         <span class="keywordflow">return</span>(STATUS_INSUFFICIENT_RESOURCES);
00330     }
00331 
00332     *RecordMemoryType = SepRmPagedPoolMemory;
00333 
00334     RtlCopyMemory (
00335        *MarshalledAuditParameters,
00336        AuditParameters,
00337        <span class="keyword">sizeof</span>( SE_ADT_PARAMETER_ARRAY )
00338        );
00339 
00340    (*MarshalledAuditParameters)-&gt;Length = TotalSize;
00341    (*MarshalledAuditParameters)-&gt;Flags  = SE_ADT_PARAMETERS_SELF_RELATIVE;
00342 
00343     <span class="comment">//</span>
00344     <span class="comment">// Start walking down the list of parameters and marshall them</span>
00345     <span class="comment">// into the target buffer.</span>
00346     <span class="comment">//</span>
00347 
00348     Base = (PCHAR) ((PCHAR)(*MarshalledAuditParameters) + <span class="keyword">sizeof</span>( SE_ADT_PARAMETER_ARRAY ));
00349 
00350     <span class="keywordflow">for</span> (i=0; i&lt;AuditParameters-&gt;ParameterCount; i++) {
00351 
00352 
00353         <span class="keywordflow">switch</span> (AuditParameters-&gt;Parameters[i].Type) {
00354             <span class="keywordflow">case</span> SeAdtParmTypeNone:
00355             <span class="keywordflow">case</span> SeAdtParmTypeUlong:
00356             <span class="keywordflow">case</span> SeAdtParmTypeLogonId:
00357             <span class="keywordflow">case</span> SeAdtParmTypeNoLogonId:
00358             <span class="keywordflow">case</span> SeAdtParmTypeAccessMask:
00359                 {
00360                     <span class="comment">//</span>
00361                     <span class="comment">// Nothing to do for this</span>
00362                     <span class="comment">//</span>
00363 
00364                     <span class="keywordflow">break</span>;
00365 
00366                 }
00367             <span class="keywordflow">case</span> SeAdtParmTypeString:
00368             <span class="keywordflow">case</span> SeAdtParmTypeFileSpec:
00369                 {
00370                     PUNICODE_STRING <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>;
00371                     <span class="comment">//</span>
00372                     <span class="comment">// We must copy the body of the unicode string</span>
00373                     <span class="comment">// and then copy the body of the string.  Pointers</span>
00374                     <span class="comment">// must be turned into offsets.</span>
00375 
00376                     TargetString = (PUNICODE_STRING)Base;
00377 
00378                     <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a> = AuditParameters-&gt;Parameters[i].Address;
00379 
00380                     *TargetString = *<a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>;
00381 
00382                     <span class="comment">//</span>
00383                     <span class="comment">// Reset the data pointer in the output parameters to</span>
00384                     <span class="comment">// 'point' to the new string structure.</span>
00385                     <span class="comment">//</span>
00386 
00387                     (*MarshalledAuditParameters)-&gt;Parameters[i].Address = Base - (ULONG_PTR)(*MarshalledAuditParameters);
00388 
00389                     Base += <span class="keyword">sizeof</span>( UNICODE_STRING );
00390 
00391                     RtlCopyMemory( Base, <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>-&gt;Buffer, <a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>-&gt;Length );
00392 
00393                     <span class="comment">//</span>
00394                     <span class="comment">// Make the string buffer in the target string point to where we</span>
00395                     <span class="comment">// just copied the data.</span>
00396                     <span class="comment">//</span>
00397 
00398                     TargetString-&gt;Buffer = (PWSTR)(Base - (ULONG_PTR)(*MarshalledAuditParameters));
00399 
00400                     BaseIncr = (ULONG)LongAlignSize(<a class="code" href="../../d0/d2/usrbench_8h.html#a33">SourceString</a>-&gt;Length);
00401 
00402                     Base += BaseIncr;
00403 
00404                     <span class="keywordflow">break</span>;
00405                 }
00406 
00407             <span class="comment">//</span>
00408             <span class="comment">// Handle types where we simply copy the buffer.</span>
00409             <span class="comment">//</span>
00410             <span class="keywordflow">case</span> SeAdtParmTypeSid:
00411             <span class="keywordflow">case</span> SeAdtParmTypePrivs:
00412             <span class="keywordflow">case</span> SeAdtParmTypeObjectTypes:
00413                 {
00414                     <span class="comment">//</span>
00415                     <span class="comment">// Copy the data into the output buffer</span>
00416                     <span class="comment">//</span>
00417 
00418                     RtlCopyMemory( Base,
00419                                    AuditParameters-&gt;Parameters[i].Address,
00420                                    AuditParameters-&gt;Parameters[i].Length );
00421 
00422                     <span class="comment">//</span>
00423                     <span class="comment">// Reset the 'address' of the data to be its offset in the</span>
00424                     <span class="comment">// buffer.</span>
00425                     <span class="comment">//</span>
00426 
00427                     (*MarshalledAuditParameters)-&gt;Parameters[i].Address = Base - (ULONG_PTR)(*MarshalledAuditParameters);
00428 
00429                     Base +=  (ULONG)LongAlignSize( AuditParameters-&gt;Parameters[i].Length );
00430 
00431 
00432                     <span class="keywordflow">break</span>;
00433                 }
00434             <span class="keywordflow">default</span>:
00435                 {
00436                     <span class="comment">//</span>
00437                     <span class="comment">// We got passed junk, complain.</span>
00438                     <span class="comment">//</span>
00439 
00440                     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( FALSE );
00441                     <span class="keywordflow">break</span>;
00442                 }
00443         }
00444     }
00445 
00446     <span class="keywordflow">return</span>( STATUS_SUCCESS );
00447 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a29" doxytag="adtp.h::SepAdtObjectReferenceAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtObjectReferenceAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID OperationID&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d0/d1/struct__SECURITY__SUBJECT__CONTEXT.html">PSECURITY_SUBJECT_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SubjectSecurityContext</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET Privileges&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAudit</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAlarm</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a27" doxytag="adtp.h::SepAdtOpenObjectAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepAdtOpenObjectAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedSubsystemName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *HandleId&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedObjectTypeName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID Object&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING CapturedObjectName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a> <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a11">ClientToken</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PrimaryToken</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>GrantedAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLUID&nbsp;</td>
          <td class="mdname" nowrap> <em>OperationId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET CapturedPrivileges&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectCreated</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAudit</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAlarm</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN POLICY_AUDIT_EVENT_TYPE&nbsp;</td>
          <td class="mdname" nowrap> <em>AuditType</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d7/d9/struct__IOBJECT__TYPE__LIST.html">PIOBJECT_TYPE_LIST</a> ObjectTypeList&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectTypeListLength</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PACCESS_MASK GrantedAccessArray&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00571">571</a> of file <a class="el" href="../../d8/d5/sepaudit_8c-source.html">sepaudit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00039">ClientToken</a>, <a class="el" href="../../d6/d7/ex_8h-source.html#l00253">ExAllocatePoolWithTag</a>, <a class="el" href="../../d7/d2/cmwraper_8c-source.html#l00304">ExFreePool()</a>, <a class="el" href="../../d4/d7/udfprocs_8h-source.html#l00068">FlagMask</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00377">OBJECT_FAILURE_AUDIT</a>, <a class="el" href="../../d9/d2/tokenp_8h-source.html#l00376">OBJECT_SUCCESS_AUDIT</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d5/d8/ex_8h.html#a329a174">PagedPool</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00126">PrimaryToken</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00098">SepSetParmTypeAccessMask</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00068">SepSetParmTypeFileSpec</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00088">SepSetParmTypeLogonId</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00083">SepSetParmTypeNoLogon</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00113">SepSetParmTypeObjectTypes</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00106">SepSetParmTypePrivileges</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00051">SepSetParmTypeSid</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00059">SepSetParmTypeString</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00076">SepSetParmTypeUlong</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00183">SepTokenAuthenticationId</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00176">SepTokenUserSid</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, and <a class="el" href="../../d5/d4/aug98_2dll32_2icc__i386_8h-source.html#l00064">USHORT</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03736">SeAuditHandleCreation()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02765">SeOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03085">SeOpenObjectForDeleteAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>.
<p>
<pre class="fragment"><div>00596                        :
00597 
00598     Implements <a class="code" href="../../d3/d5/seaudit_8c.html#a20">NtOpenObjectAuditAlarm</a> after parameters have been captured.
00599 
00600     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to generate audit and alarm messages when an
00601     attempt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to access an existing <span class="keyword">protected</span> subsystem object or
00602     create a <span class="keyword">new</span> one.  This routine may result in several messages being
00603     generated and sent to Port objects.  This may result in a significant
00604     latency before returning.  Design of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a> that must call <span class="keyword">this</span>
00605     routine must take <span class="keyword">this</span> potential latency into account.  This may have
00606     an impact on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> approach taken <span class="keywordflow">for</span> data structure mutex locking, <span class="keywordflow">for</span>
00607     example.  This API requires <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller have <a class="code" href="../../d0/d5/se_8h.html#a84">SeTcbPrivilege</a> privilege.
00608     The test <span class="keywordflow">for</span> <span class="keyword">this</span> privilege <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> always against <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary token of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00609     calling process, not <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> impersonation token of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> thread.
00610 
00611 
00612     This routine will create an SE_ADT_PARAMETERS array organized as follows:
00613 
00614     Parameter[0] - User Sid
00615 
00616     Parameter[1] - Subsystem name (<span class="keywordflow">if</span> available)
00617 
00618     Parameter[2] - <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a22">Server</a> name (<span class="keywordflow">if</span> available)
00619 
00620     Parameter[3] - Object Type <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>
00621 
00622     Parameter[4] - Object <a class="code" href="../../d8/d0/geninst_8c.html#a20">Name</a>
00623 
00624     Parameter[5] - New handle <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>
00625 
00626     Parameter[6] - Subject's process <span class="keywordtype">id</span>
00627 
00628     Parameter[7] - Subject's primary authentication <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>
00629 
00630     Parameter[8] - Subject's client authentication <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>
00631 
00632     Parameter[9] - DesiredAccess mask
00633 
00634     Parameter[10] - Privileges used <span class="keywordflow">for</span> open
00635 
00636     Parameter[11] - Guid/Level/AccessMask of objects/property sets/properties accesses.
00637 
00638 Arguments:
00639 
00640     CapturedSubsystemName - Supplies a name string identifying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00641         subsystem calling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> routine.
00642 
00643     HandleId - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> unique value representing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client's handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00644         object.  If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access attempt was not successful (AccessGranted is
00645         FALSE), then <span class="keyword">this</span> parameter <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> ignored.
00646 
00647     CapturedObjectTypeName - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of object being
00648         accessed.
00649 
00650     CapturedObjectName - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client
00651         accessed or attempted to access.
00652 
00653     CapturedSecurityDescriptor - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> security descriptor of
00654         <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object being accessed.
00655 
00656     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a16">ClientToken</a> - Optionally provides a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client token
00657         (<a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently impersonating)
00658 
00659     <a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a> - Provides a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's primary token.
00660 
00661     DesiredAccess - The desired access mask.  This mask must have been
00662         previously mapped to contain no generic accesses.
00663 
00664     GrantedAccess - The mask of accesses that were actually granted.
00665 
00666     CapturedPrivileges - Optionally points to a set of privileges that were
00667         required <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access attempt.  Those privileges that were held
00668         by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject are marked <span class="keyword">using</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> UsedForAccess flag of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00669         attributes associated with each privilege.
00670 
00671     ObjectCreation - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> <span class="keywordtype">boolean</span> flag indicating whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access will
00672         result in a <span class="keyword">new</span> object being created <span class="keywordflow">if</span> granted.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>
00673         indicates an object will be created, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> indicates an existing
00674         object will be opened.
00675 
00676     AccessGranted - Indicates whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested access was granted or
00677         not.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was granted.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of
00678         <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was not granted.
00679 
00680     GenerateOnClose - Points to a <span class="keywordtype">boolean</span> that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> set by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> audit
00681         generation routine and must be passed to <a class="code" href="../../d3/d5/seaudit_8c.html#a21">NtCloseObjectAuditAlarm</a>()
00682         when the object handle is closed.
00683 
00684     GenerateAudit - Indicates if we should generate an audit for this operation.
00685 
00686     GenerateAlarm - Indicates if we should generate an alarm for this operation.
00687 
00688     AuditType - Specifies the type of audit to be generated.  Valid values
00689         are: AuditCategoryObjectAccess and AuditCategoryDirectoryServiceAccess.
00690 
00691     ObjectTypeList - Supplies a list of GUIDs representing the object (and
00692         sub-objects) being accessed.
00693 
00694     ObjectTypeListLength - Specifies the number of elements in the ObjectTypeList.
00695 
00696     GrantedAccessArray - If non NULL, specifies an array of access mask granted
00697         to each object in ObjectTypeList.
00698 
00699 Return Value:
00700 
00701     Returns TRUE if audit is generated, FALSE otherwise.
00702 
00703 --*/
00704 
00705 {
00706     SE_ADT_PARAMETER_ARRAY AuditParameters;
00707     ULONG ObjectTypeIndex;
00708     PSID CapturedUserSid;
00709     LUID PrimaryAuthenticationId;
00710     LUID ClientAuthenticationId;
00711     PSE_ADT_OBJECT_TYPE AdtObjectTypeBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>;
00712 
00713     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00714 
00715     <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( ClientToken )) {
00716 
00717         CapturedUserSid = <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>( ClientToken );
00718         ClientAuthenticationId =  <a class="code" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>( ClientToken );
00719 
00720     } <span class="keywordflow">else</span> {
00721 
00722         CapturedUserSid = <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>( PrimaryToken );
00723     }
00724 
00725     PrimaryAuthenticationId = <a class="code" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>( PrimaryToken );
00726 
00727     <span class="comment">//</span>
00728     <span class="comment">// A completely zero'd entry will be interpreted</span>
00729     <span class="comment">// as a "null string" or not supplied parameter.</span>
00730     <span class="comment">//</span>
00731     <span class="comment">// Initializing the entire array up front will allow</span>
00732     <span class="comment">// us to avoid filling in each not supplied entry.</span>
00733     <span class="comment">//</span>
00734 
00735     RtlZeroMemory (
00736        (PVOID) &amp;AuditParameters,
00737        <span class="keyword">sizeof</span>( AuditParameters )
00738        );
00739 
00740     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( SeAdtParmTypeNone == 0 );
00741 
00742     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( ( AuditType == AuditCategoryObjectAccess ) ||
00743             ( AuditType == AuditCategoryDirectoryServiceAccess ) );
00744     
00745     <span class="keywordflow">if</span> (AuditType == AuditCategoryObjectAccess) {
00746         
00747         AuditParameters.CategoryId = SE_CATEGID_OBJECT_ACCESS;
00748     } <span class="keywordflow">else</span> {
00749 
00750         AuditParameters.CategoryId = SE_CATEGID_DS_ACCESS;
00751     }
00752 
00753     AuditParameters.AuditId = SE_AUDITID_OPEN_HANDLE;
00754     AuditParameters.ParameterCount = 0;
00755 
00756     <span class="keywordflow">if</span> ( AccessGranted ) {
00757 
00758         AuditParameters.Type = EVENTLOG_AUDIT_SUCCESS;
00759 
00760     } <span class="keywordflow">else</span> {
00761 
00762         AuditParameters.Type = EVENTLOG_AUDIT_FAILURE;
00763     }
00764 
00765     <span class="comment">//</span>
00766     <span class="comment">//  Parameter[0] - User Sid</span>
00767     <span class="comment">//</span>
00768 
00769     <a class="code" href="../../d7/d6/sepaudit_8c.html#a0">SepSetParmTypeSid</a>( AuditParameters, AuditParameters.ParameterCount, CapturedUserSid );
00770 
00771     AuditParameters.ParameterCount++;
00772 
00773     <span class="comment">//</span>
00774     <span class="comment">//  Parameter[1] - Subsystem name (if available)</span>
00775     <span class="comment">//</span>
00776 
00777     <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, CapturedSubsystemName );
00778 
00779     AuditParameters.ParameterCount++;
00780 
00781     <span class="comment">//</span>
00782     <span class="comment">//  Parameter[2] - Object Server (if available)</span>
00783     <span class="comment">//</span>
00784 
00785     <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( CapturedSubsystemName )) {
00786 
00787         <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, CapturedSubsystemName );
00788     }
00789 
00790     AuditParameters.ParameterCount++;
00791 
00792     <span class="comment">//</span>
00793     <span class="comment">//  Parameter[3] - Object Type Name</span>
00794     <span class="comment">//</span>
00795 
00796     <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( CapturedObjectTypeName )) {
00797 
00798         <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, CapturedObjectTypeName );
00799         ObjectTypeIndex = AuditParameters.ParameterCount;
00800     }
00801 
00802     AuditParameters.ParameterCount++;
00803 
00804     <span class="comment">//</span>
00805     <span class="comment">//  Parameter[4] - Object Name</span>
00806     <span class="comment">//</span>
00807 
00808     <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( CapturedObjectName )) {
00809 
00810         <a class="code" href="../../d7/d6/sepaudit_8c.html#a2">SepSetParmTypeFileSpec</a>( AuditParameters, AuditParameters.ParameterCount, CapturedObjectName );
00811     }
00812 
00813     AuditParameters.ParameterCount++;
00814 
00815     <span class="comment">//</span>
00816     <span class="comment">//  Parameter[5] - New handle ID</span>
00817     <span class="comment">//</span>
00818 
00819     <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( HandleId )) {
00820 
00821         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)*HandleId) );
00822     }
00823 
00824     AuditParameters.ParameterCount++;
00825 
00826     <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( OperationId )) {
00827 
00828         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (*OperationId).HighPart );
00829 
00830         AuditParameters.ParameterCount++;
00831 
00832         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (*OperationId).LowPart );
00833 
00834         AuditParameters.ParameterCount++;
00835 
00836     } <span class="keywordflow">else</span> {
00837 
00838         AuditParameters.ParameterCount += 2;
00839     }
00840 
00841     <span class="comment">//</span>
00842     <span class="comment">//  Parameter[6] - Subject's process id</span>
00843     <span class="comment">//</span>
00844 
00845     <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)ProcessID) );
00846 
00847     AuditParameters.ParameterCount++;
00848 
00849     <span class="comment">//</span>
00850     <span class="comment">//  Parameter[7] - Subject's primary authentication ID</span>
00851     <span class="comment">//</span>
00852 
00853     <a class="code" href="../../d7/d6/sepaudit_8c.html#a5">SepSetParmTypeLogonId</a>( AuditParameters, AuditParameters.ParameterCount, PrimaryAuthenticationId );
00854 
00855     AuditParameters.ParameterCount++;
00856 
00857     <span class="comment">//</span>
00858     <span class="comment">//  Parameter[8] - Subject's client authentication ID</span>
00859     <span class="comment">//</span>
00860 
00861     <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( ClientToken )) {
00862 
00863         <a class="code" href="../../d7/d6/sepaudit_8c.html#a5">SepSetParmTypeLogonId</a>( AuditParameters, AuditParameters.ParameterCount, ClientAuthenticationId );
00864 
00865     } <span class="keywordflow">else</span> {
00866 
00867         <a class="code" href="../../d7/d6/sepaudit_8c.html#a4">SepSetParmTypeNoLogon</a>( AuditParameters, AuditParameters.ParameterCount  );
00868     }
00869 
00870     AuditParameters.ParameterCount++;
00871 
00872     <span class="comment">//</span>
00873     <span class="comment">//  Parameter[9] - DesiredAccess mask</span>
00874     <span class="comment">//</span>
00875 
00876     <span class="keywordflow">if</span> ( AccessGranted ) {
00877 
00878         <a class="code" href="../../d7/d6/sepaudit_8c.html#a6">SepSetParmTypeAccessMask</a>( AuditParameters, AuditParameters.ParameterCount, GrantedAccess, ObjectTypeIndex );
00879 
00880     } <span class="keywordflow">else</span> {
00881 
00882         <a class="code" href="../../d7/d6/sepaudit_8c.html#a6">SepSetParmTypeAccessMask</a>( AuditParameters, AuditParameters.ParameterCount, DesiredAccess, ObjectTypeIndex );
00883     }
00884 
00885     AuditParameters.ParameterCount++;
00886 
00887     <span class="comment">//</span>
00888     <span class="comment">//    Parameter[10] - Privileges used for open</span>
00889     <span class="comment">//</span>
00890 
00891     <span class="keywordflow">if</span> ( (CapturedPrivileges != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (CapturedPrivileges-&gt;PrivilegeCount &gt; 0) ) {
00892 
00893         <a class="code" href="../../d7/d6/sepaudit_8c.html#a7">SepSetParmTypePrivileges</a>( AuditParameters, AuditParameters.ParameterCount, CapturedPrivileges );
00894     }
00895 
00896     AuditParameters.ParameterCount++;
00897 
00898     <span class="comment">//</span>
00899     <span class="comment">//    Parameter[11] - ObjectTypes of Audited objects/parameter sets/parameters</span>
00900     <span class="comment">//</span>
00901 
00902     <span class="keywordflow">if</span> ( ObjectTypeListLength != 0 ) {
00903         ULONG GuidCount;
00904         ULONG i;
00905         <a class="code" href="../../d4/d5/aug98_2dll32_2icc__i386_8h.html#a14">USHORT</a> <a class="code" href="../../d3/d8/udfprocs_8h.html#a5">FlagMask</a> = AccessGranted ? <a class="code" href="../../d8/d3/tokenp_8h.html#a4">OBJECT_SUCCESS_AUDIT</a> : <a class="code" href="../../d8/d3/tokenp_8h.html#a5">OBJECT_FAILURE_AUDIT</a>;
00906 
00907         <span class="comment">//</span>
00908         <span class="comment">// Count the number of GUIDs to audit.</span>
00909         <span class="comment">//</span>
00910 
00911         GuidCount = 0;
00912         <span class="keywordflow">for</span> ( i=0; i&lt;ObjectTypeListLength; i++ ) {
00913 
00914             <span class="keywordflow">if</span> ( i == 0 ) {
00915                 GuidCount++;
00916             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ObjectTypeList[i].Flags &amp; <a class="code" href="../../d3/d8/udfprocs_8h.html#a5">FlagMask</a> ) {
00917                 GuidCount ++;
00918             } 
00919         }
00920 
00921         <span class="comment">//</span>
00922         <span class="comment">// If there are any Guids to audit,</span>
00923         <span class="comment">//  copy them into a locally allocated buffer.</span>
00924         <span class="comment">//</span>
00925 
00926         <span class="keywordflow">if</span> ( GuidCount &gt; 0 ) {
00927 
00928             AdtObjectTypeBuffer = <a class="code" href="../../d5/d8/ex_8h.html#a4">ExAllocatePoolWithTag</a>( PagedPool, GuidCount * <span class="keyword">sizeof</span>(SE_ADT_OBJECT_TYPE), 'pAeS' );
00929 
00930             <span class="comment">//</span>
00931             <span class="comment">// If the buffer can be allocated,</span>
00932             <span class="comment">//  fill it in.</span>
00933             <span class="comment">// If not,</span>
00934             <span class="comment">//  generate a truncated audit.</span>
00935             <span class="comment">//</span>
00936 
00937             <span class="keywordflow">if</span> ( AdtObjectTypeBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00938 
00939                 <span class="comment">//</span>
00940                 <span class="comment">// Copy the GUIDs and optional access masks to the buffer.</span>
00941                 <span class="comment">//</span>
00942 
00943                 GuidCount = 0;
00944                 <span class="keywordflow">for</span> ( i=0; i&lt;ObjectTypeListLength; i++ ) {
00945 
00946                     <span class="keywordflow">if</span> ( ( i &gt; 0 ) &amp;&amp; !( ObjectTypeList[i].Flags &amp; <a class="code" href="../../d3/d8/udfprocs_8h.html#a5">FlagMask</a> ) ) {
00947 
00948                         <span class="keywordflow">continue</span>;
00949                         
00950                     } <span class="keywordflow">else</span> {
00951                     
00952                         AdtObjectTypeBuffer[GuidCount].ObjectType = ObjectTypeList[i].ObjectType;
00953                         AdtObjectTypeBuffer[GuidCount].Level      = ObjectTypeList[i].Level;
00954 
00955                         <span class="keywordflow">if</span> ( i == 0 ) {
00956                             <span class="comment">//</span>
00957                             <span class="comment">// Always copy the GUID representing the object itself.</span>
00958                             <span class="comment">//  Mark it as a such to avoid including it in the audit.</span>
00959                             <span class="comment">//</span>
00960                             AdtObjectTypeBuffer[GuidCount].Flags      = SE_ADT_OBJECT_ONLY;
00961                             AdtObjectTypeBuffer[GuidCount].AccessMask = 0;
00962 
00963                         } <span class="keywordflow">else</span>  {
00964 
00965                             AdtObjectTypeBuffer[GuidCount].Flags = 0;
00966                             <span class="keywordflow">if</span> ( ARGUMENT_PRESENT(GrantedAccessArray) &amp;&amp; AccessGranted ) {
00967 
00968                                 AdtObjectTypeBuffer[GuidCount].AccessMask = GrantedAccessArray[i];
00969                             }
00970                         }
00971                         GuidCount ++;
00972                     }
00973                 }
00974 
00975                 <span class="comment">//</span>
00976                 <span class="comment">// Store the Object Types.</span>
00977                 <span class="comment">//</span>
00978 
00979                 <a class="code" href="../../d7/d6/sepaudit_8c.html#a8">SepSetParmTypeObjectTypes</a>( AuditParameters, AuditParameters.ParameterCount, AdtObjectTypeBuffer, GuidCount, ObjectTypeIndex );
00980                 AuditParameters.ParameterCount ++;
00981                 AuditParameters.AuditId = SE_AUDITID_OPEN_HANDLE_OBJECT_TYPE;
00982             }
00983         }
00984 
00985     }
00986 
00987 
00988 
00989     <span class="comment">//</span>
00990     <span class="comment">// Audit it.</span>
00991     <span class="comment">//</span>
00992     <a class="code" href="../../d0/d5/adtlog_8c.html#a0">SepAdtLogAuditRecord</a>( &amp;AuditParameters );
00993 
00994     <span class="keywordflow">if</span> ( AdtObjectTypeBuffer != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a> ) {
00995         <a class="code" href="../../d5/d8/ex_8h.html#a224">ExFreePool</a>( AdtObjectTypeBuffer );
00996     }
00997 
00998     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00999 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a28" doxytag="adtp.h::SepAdtOpenObjectForDeleteAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepAdtOpenObjectForDeleteAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedSubsystemName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID *&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedObjectTypeName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Object</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedObjectName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a> <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a11">ClientToken</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PrimaryToken</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>GrantedAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PLUID&nbsp;</td>
          <td class="mdname" nowrap> <em>OperationId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET CapturedPrivileges&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>ObjectCreated</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAudit</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAlarm</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN HANDLE&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessID</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="adtp.h::SepAdtPrivilegedServiceAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtPrivilegedServiceAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedSubsystemName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PUNICODE_STRING&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedServiceName</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a> <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a11">ClientToken</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PrimaryToken</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedPrivileges</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00346">346</a> of file <a class="el" href="../../d8/d5/sepaudit_8c-source.html">sepaudit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00039">ClientToken</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00126">PrimaryToken</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">SepAdtAuditThisEvent</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00088">SepSetParmTypeLogonId</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00083">SepSetParmTypeNoLogon</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00106">SepSetParmTypePrivileges</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00051">SepSetParmTypeSid</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00059">SepSetParmTypeString</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00183">SepTokenAuthenticationId</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00176">SepTokenUserSid</a>, and <a class="el" href="../../d1/d4/se_8h-source.html#l01711">SeSubsystemName</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00731">NtPrivilegedServiceAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00989">SePrivilegedServiceAuditAlarm()</a>.
<p>
<pre class="fragment"><div>00357                    :
00358 
00359     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> active part of <a class="code" href="../../d3/d5/seaudit_8c.html#a14">NtPrivilegedServiceAuditAlarm</a>.
00360 
00361     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to generate audit and alarm messages when an
00362     attempt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to perform privileged system service operations.  This
00363     routine may result in several messages being generated and sent to Port
00364     objects.  This may result in a significant latency before returning.
00365     Design of <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a> that must call <span class="keyword">this</span> routine must take <span class="keyword">this</span> potential
00366     latency into account.  This may have an impact on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> approach taken
00367     <span class="keywordflow">for</span> data structure mutex locking, <span class="keywordflow">for</span> example.
00368 
00369     This API requires <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller have <a class="code" href="../../d0/d5/se_8h.html#a84">SeTcbPrivilege</a> privilege.  The test
00370     <span class="keywordflow">for</span> <span class="keyword">this</span> privilege <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> always against <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary token of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling
00371     process, allowing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller to be impersonating a client during <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00372     call with no ill effects.  The test <span class="keywordflow">for</span> <span class="keyword">this</span> privilege <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> assumed to
00373     have occurred at a higher level.
00374 
00375     This routine will create an SE_ADT_PARAMETERS array organized as follows:
00376 
00377     Parameter[0] - User Sid
00378 
00379     Parameter[1] - Subsystem name (<span class="keywordflow">if</span> available)
00380 
00381     Parameter[2] - Subject's primary authentication <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>
00382 
00383     Parameter[3] - Subject's client authentication <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>
00384 
00385     Parameter[4] - Privileges used <span class="keywordflow">for</span> open
00386 
00387 Arguments:
00388 
00389     SubsystemName - Supplies a name string identifying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subsystem
00390         calling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> routine.
00391 
00392     ServiceName - Supplies a name of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> privileged subsystem service.  For
00393         example, <span class="stringliteral">"RESET RUNTIME LOCAL SECURITY POLICY"</span> might be specified
00394         by a Local Security Authority service used to update <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> local
00395         security policy database.
00396 
00397     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a16">ClientToken</a> - Optionally provides a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client token
00398         (<a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently impersonating)
00399 
00400     <a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a> - Provides a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's primary token.
00401 
00402     Privileges - Points to a set of privileges required to perform <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00403         privileged operation.  Those privileges that were held by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00404         subject are marked <span class="keyword">using</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> UsedForAccess flag of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00405         attributes associated with each privilege.
00406 
00407     AccessGranted - Indicates whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested access was granted or
00408         not.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was granted.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of
00409         <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was not granted.
00410 
00411 
00412 Return value:
00413 
00414 
00415 --*/
00416 
00417 {
00418 
00419     SE_ADT_PARAMETER_ARRAY AuditParameters;
00420     PSID CapturedUserSid;
00421     LUID ClientAuthenticationId;
00422     LUID PrimaryAuthenticationId;
00423     PUNICODE_STRING SubsystemName;
00424 
00425     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00426 
00427     <span class="comment">//</span>
00428     <span class="comment">// Determine if we are auditing privileged services</span>
00429     <span class="comment">//</span>
00430 
00431     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryPrivilegeUse, &amp;AccessGranted )) {
00432 
00433         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( ClientToken )) {
00434 
00435             CapturedUserSid = <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>( ClientToken );
00436             ClientAuthenticationId =  <a class="code" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>( ClientToken );
00437 
00438         } <span class="keywordflow">else</span> {
00439 
00440             CapturedUserSid = <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>( PrimaryToken );
00441         }
00442 
00443         PrimaryAuthenticationId = <a class="code" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>( PrimaryToken );
00444 
00445         <span class="keywordflow">if</span> ( !ARGUMENT_PRESENT( CapturedSubsystemName )) {
00446 
00447             SubsystemName = &amp;<a class="code" href="../../d0/d5/se_8h.html#a107">SeSubsystemName</a>;
00448 
00449         } <span class="keywordflow">else</span> {
00450 
00451             SubsystemName = CapturedSubsystemName;
00452         }
00453 
00454         <span class="comment">//</span>
00455         <span class="comment">// A completely zero'd entry will be interpreted</span>
00456         <span class="comment">// as a "null string" or not supplied parameter.</span>
00457         <span class="comment">//</span>
00458         <span class="comment">// Initializing the entire array up front will allow</span>
00459         <span class="comment">// us to avoid filling in each not supplied entry.</span>
00460         <span class="comment">//</span>
00461 
00462         RtlZeroMemory (
00463            (PVOID) &amp;AuditParameters,
00464            <span class="keyword">sizeof</span>( AuditParameters )
00465            );
00466 
00467         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( SeAdtParmTypeNone == 0 );
00468 
00469         AuditParameters.CategoryId = SE_CATEGID_PRIVILEGE_USE;
00470         AuditParameters.AuditId = SE_AUDITID_PRIVILEGED_SERVICE;
00471         AuditParameters.ParameterCount = 0;
00472 
00473         <span class="keywordflow">if</span> ( AccessGranted ) {
00474 
00475             AuditParameters.Type = EVENTLOG_AUDIT_SUCCESS;
00476 
00477         } <span class="keywordflow">else</span> {
00478 
00479             AuditParameters.Type = EVENTLOG_AUDIT_FAILURE;
00480         }
00481 
00482 
00483     <span class="comment">//</span>
00484     <span class="comment">//    Parameter[0] - User Sid</span>
00485     <span class="comment">//</span>
00486 
00487         <a class="code" href="../../d7/d6/sepaudit_8c.html#a0">SepSetParmTypeSid</a>( AuditParameters, AuditParameters.ParameterCount, CapturedUserSid );
00488 
00489         AuditParameters.ParameterCount++;
00490 
00491     <span class="comment">//</span>
00492     <span class="comment">//    Parameter[1] - Subsystem name (if available)</span>
00493     <span class="comment">//</span>
00494 
00495     <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, SubsystemName );
00496 
00497     AuditParameters.ParameterCount++;
00498 
00499 
00500     <span class="comment">//</span>
00501     <span class="comment">//    Parameter[2] - Server</span>
00502     <span class="comment">//</span>
00503 
00504     <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, SubsystemName );
00505 
00506     AuditParameters.ParameterCount++;
00507 
00508 
00509     <span class="comment">//</span>
00510     <span class="comment">//    Parameter[3] - Service name (if available)</span>
00511     <span class="comment">//</span>
00512 
00513     <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( CapturedServiceName )) {
00514 
00515         <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, CapturedServiceName );
00516     }
00517 
00518     AuditParameters.ParameterCount++;
00519 
00520     <span class="comment">//</span>
00521     <span class="comment">//    Parameter[3] - Subject's primary authentication ID</span>
00522     <span class="comment">//</span>
00523 
00524 
00525     <a class="code" href="../../d7/d6/sepaudit_8c.html#a5">SepSetParmTypeLogonId</a>( AuditParameters, AuditParameters.ParameterCount, PrimaryAuthenticationId );
00526 
00527     AuditParameters.ParameterCount++;
00528 
00529 
00530     <span class="comment">//</span>
00531     <span class="comment">//    Parameter[4] - Subject's client authentication ID</span>
00532     <span class="comment">//</span>
00533 
00534     <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( ClientToken )) {
00535 
00536         <a class="code" href="../../d7/d6/sepaudit_8c.html#a5">SepSetParmTypeLogonId</a>( AuditParameters, AuditParameters.ParameterCount, ClientAuthenticationId );
00537 
00538     } <span class="keywordflow">else</span> {
00539 
00540         <a class="code" href="../../d7/d6/sepaudit_8c.html#a4">SepSetParmTypeNoLogon</a>( AuditParameters, AuditParameters.ParameterCount );
00541     }
00542 
00543     AuditParameters.ParameterCount++;
00544 
00545 
00546     <span class="comment">//</span>
00547     <span class="comment">//    Parameter[5] - Privileges used for open</span>
00548     <span class="comment">//</span>
00549 
00550 
00551     <span class="keywordflow">if</span> ( (CapturedPrivileges != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (CapturedPrivileges-&gt;PrivilegeCount &gt; 0) ) {
00552 
00553         <a class="code" href="../../d7/d6/sepaudit_8c.html#a7">SepSetParmTypePrivileges</a>( AuditParameters, AuditParameters.ParameterCount, CapturedPrivileges );
00554     }
00555 
00556     AuditParameters.ParameterCount++;
00557 
00558 
00559     <a class="code" href="../../d0/d5/adtlog_8c.html#a0">SepAdtLogAuditRecord</a>( &amp;AuditParameters );
00560 
00561     }
00562 
00563 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="adtp.h::SepAdtPrivilegeObjectAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepAdtPrivilegeObjectAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PUNICODE_STRING CapturedSubsystemName&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>HandleId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a> <a class="el" href="../../d8/d0/ctlpcqos_8c.html#a11">ClientToken</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN <a class="el" href="../../d8/d3/tokenp_8h.html#a15">PTOKEN</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>PrimaryToken</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ProcessId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET&nbsp;</td>
          <td class="mdname" nowrap> <em>CapturedPrivileges</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00125">125</a> of file <a class="el" href="../../d8/d5/sepaudit_8c-source.html">sepaudit.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d8/d9/ctlnpqos_8c-source.html#l00039">ClientToken</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d7/d9/ctaccess_8c-source.html#l00126">PrimaryToken</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00871">RtlEqualSid()</a>, <a class="el" href="../../d1/d4/se_8h-source.html#l01628">SeLocalSystemSid</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00264">SepAdtAuditThisEvent</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04587">SepFilterPrivilegeAudits()</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00088">SepSetParmTypeLogonId</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00083">SepSetParmTypeNoLogon</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00106">SepSetParmTypePrivileges</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00051">SepSetParmTypeSid</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00059">SepSetParmTypeString</a>, <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l00076">SepSetParmTypeUlong</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00183">SepTokenAuthenticationId</a>, <a class="el" href="../../d7/d5/sep_8h-source.html#l00176">SepTokenUserSid</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l02072">NtOpenObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00406">NtPrivilegeObjectAuditAlarm()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03736">SeAuditHandleCreation()</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l01050">SepAccessCheckAndAuditAlarm()</a>, and <a class="el" href="../../d4/d4/seaudit_8c-source.html#l00650">SePrivilegeObjectAuditAlarm()</a>.
<p>
<pre class="fragment"><div>00138                    :
00139 
00140     Implements <a class="code" href="../../d3/d5/seaudit_8c.html#a12">NtPrivilegeObjectAuditAlarm</a> after parameters have been
00141     captured.
00142 
00143     This routine <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to generate audit and alarm messages when an
00144     attempt <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/user32_8def.html#a107">made</a> to perform privileged operations on a <span class="keyword">protected</span>
00145     subsystem object after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> object <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> already opened.  This routine may
00146     result in several messages being generated and sent to Port objects.
00147     This may result in a significant latency before returning.  Design of
00148     <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a24">routines</a> that must call <span class="keyword">this</span> routine must take <span class="keyword">this</span> potential latency
00149     into account.  This may have an impact on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> approach taken <span class="keywordflow">for</span> data
00150     structure mutex locking, <span class="keywordflow">for</span> example.
00151 
00152     This API requires <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller have <a class="code" href="../../d0/d5/se_8h.html#a84">SeTcbPrivilege</a> privilege.  The test
00153     <span class="keywordflow">for</span> <span class="keyword">this</span> privilege <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> always against <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> primary token of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> calling
00154     process, allowing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller to be impersonating a client during <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00155     call with no ill effects.
00156 
00157     This routine will create an SE_ADT_PARAMETERS array organized as follows:
00158 
00159     Parameter[0] - User Sid
00160 
00161     Parameter[1] - Subsystem name (<span class="keywordflow">if</span> available)
00162 
00163     Parameter[2] - New handle <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>
00164 
00165     Parameter[3] - Subject's process <span class="keywordtype">id</span>
00166 
00167     Parameter[4] - Subject's primary authentication <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>
00168 
00169     Parameter[5] - Subject's client authentication <a class="code" href="../../d4/d9/smbtrsup_8c.html#a7">ID</a>
00170 
00171     Parameter[6] - Privileges used <span class="keywordflow">for</span> open
00172 
00173 Arguments:
00174 
00175     CapturedSubsystemName - Supplies a name string identifying <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00176         subsystem calling <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> routine.
00177 
00178     HandleId - <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> unique value representing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client's handle to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00179         object.
00180 
00181     <a class="code" href="../../d7/d0/ctlnpqos_8c.html#a16">ClientToken</a> - Optionally provides a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> client token
00182         (<a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> currently impersonating)
00183 
00184     <a class="code" href="../../d6/d0/ctaccess_8c.html#a31">PrimaryToken</a> - Provides a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's primary token.
00185 
00186     DesiredAccess - The desired access mask.  This mask must have been
00187         previously mapped to contain no generic accesses.
00188 
00189     CapturedPrivileges - The set of privileges required <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested
00190         operation.  Those privileges that were held by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> subject are
00191         marked <span class="keyword">using</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> UsedForAccess flag of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> attributes
00192         associated with each privilege.
00193 
00194     AccessGranted - Indicates whether <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> requested access was granted or
00195         not.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was granted.  <a class="code" href="../../d2/d1/bench_8h.html#a5">A</a> value of
00196         <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> indicates <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> access was not granted.
00197 
00198 Return value:
00199 
00200 --*/
00201 {
00202     SE_ADT_PARAMETER_ARRAY AuditParameters;
00203     PSID CapturedUserSid;
00204     LUID ClientAuthenticationId;
00205     LUID PrimaryAuthenticationId;
00206 
00207     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00208 
00209     <span class="comment">//</span>
00210     <span class="comment">// Determine if we are auditing the use of privileges</span>
00211     <span class="comment">//</span>
00212 
00213     <span class="keywordflow">if</span> ( <a class="code" href="../../d1/d5/adtp_8h.html#a1">SepAdtAuditThisEvent</a>( AuditCategoryPrivilegeUse, &amp;AccessGranted ) &amp;&amp;
00214          <a class="code" href="../../d6/d6/sep_8h.html#a67">SepFilterPrivilegeAudits</a>( CapturedPrivileges )) {
00215 
00216         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( ClientToken )) {
00217 
00218             CapturedUserSid = <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>( ClientToken );
00219             ClientAuthenticationId =  <a class="code" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>( ClientToken );
00220 
00221         } <span class="keywordflow">else</span> {
00222 
00223             CapturedUserSid = <a class="code" href="../../d6/d6/sep_8h.html#a8">SepTokenUserSid</a>( PrimaryToken );
00224         }
00225 
00226         <span class="keywordflow">if</span> ( <a class="code" href="../../d8/d6/sertl_8c.html#a36">RtlEqualSid</a>( SeLocalSystemSid, CapturedUserSid )) {
00227 
00228             <span class="keywordflow">return</span> (<a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>);
00229         }
00230 
00231         PrimaryAuthenticationId = <a class="code" href="../../d6/d6/sep_8h.html#a9">SepTokenAuthenticationId</a>( PrimaryToken );
00232 
00233         <span class="comment">//</span>
00234         <span class="comment">// A completely zero'd entry will be interpreted</span>
00235         <span class="comment">// as a "null string" or not supplied parameter.</span>
00236         <span class="comment">//</span>
00237         <span class="comment">// Initializing the entire array up front will allow</span>
00238         <span class="comment">// us to avoid filling in each not supplied entry.</span>
00239         <span class="comment">//</span>
00240 
00241         RtlZeroMemory (
00242            (PVOID) &amp;AuditParameters,
00243            <span class="keyword">sizeof</span>( AuditParameters )
00244            );
00245 
00246         <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>( SeAdtParmTypeNone == 0 );
00247 
00248         AuditParameters.CategoryId = SE_CATEGID_PRIVILEGE_USE;
00249         AuditParameters.AuditId = SE_AUDITID_PRIVILEGED_OBJECT;
00250         AuditParameters.ParameterCount = 0;
00251 
00252         <span class="keywordflow">if</span> ( AccessGranted ) {
00253 
00254             AuditParameters.Type = EVENTLOG_AUDIT_SUCCESS;
00255 
00256         } <span class="keywordflow">else</span> {
00257 
00258             AuditParameters.Type = EVENTLOG_AUDIT_FAILURE;
00259         }
00260 
00261         <span class="comment">//</span>
00262         <span class="comment">//    Parameter[0] - User Sid</span>
00263         <span class="comment">//</span>
00264 
00265         <a class="code" href="../../d7/d6/sepaudit_8c.html#a0">SepSetParmTypeSid</a>( AuditParameters, AuditParameters.ParameterCount, CapturedUserSid );
00266 
00267         AuditParameters.ParameterCount++;
00268 
00269         <span class="comment">//</span>
00270         <span class="comment">//    Parameter[1] - Subsystem name (if available)</span>
00271         <span class="comment">//</span>
00272 
00273         <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, CapturedSubsystemName );
00274 
00275         AuditParameters.ParameterCount++;
00276 
00277         <span class="comment">//</span>
00278         <span class="comment">//    Parameter[1] - Subsystem name (if available)</span>
00279         <span class="comment">//</span>
00280 
00281         <a class="code" href="../../d7/d6/sepaudit_8c.html#a1">SepSetParmTypeString</a>( AuditParameters, AuditParameters.ParameterCount, CapturedSubsystemName );
00282 
00283         AuditParameters.ParameterCount++;
00284 
00285         <span class="comment">//</span>
00286         <span class="comment">//    Parameter[2] - New handle ID</span>
00287         <span class="comment">//</span>
00288 
00289         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)HandleId) );
00290 
00291         AuditParameters.ParameterCount++;
00292 
00293         <span class="comment">//</span>
00294         <span class="comment">//    Parameter[3] - Subject's process id</span>
00295         <span class="comment">//</span>
00296 
00297         <a class="code" href="../../d7/d6/sepaudit_8c.html#a3">SepSetParmTypeUlong</a>( AuditParameters, AuditParameters.ParameterCount, (ULONG)((ULONG_PTR)ProcessId) );
00298 
00299         AuditParameters.ParameterCount++;
00300 
00301         <span class="comment">//</span>
00302         <span class="comment">//    Parameter[4] - Subject's primary authentication ID</span>
00303         <span class="comment">//</span>
00304 
00305         <a class="code" href="../../d7/d6/sepaudit_8c.html#a5">SepSetParmTypeLogonId</a>( AuditParameters, AuditParameters.ParameterCount, PrimaryAuthenticationId );
00306 
00307         AuditParameters.ParameterCount++;
00308 
00309         <span class="comment">//</span>
00310         <span class="comment">//    Parameter[5] - Subject's client authentication ID</span>
00311         <span class="comment">//</span>
00312 
00313         <span class="keywordflow">if</span> ( ARGUMENT_PRESENT( ClientToken )) {
00314 
00315             <a class="code" href="../../d7/d6/sepaudit_8c.html#a5">SepSetParmTypeLogonId</a>( AuditParameters, AuditParameters.ParameterCount, ClientAuthenticationId );
00316 
00317         } <span class="keywordflow">else</span> {
00318 
00319             <a class="code" href="../../d7/d6/sepaudit_8c.html#a4">SepSetParmTypeNoLogon</a>( AuditParameters, AuditParameters.ParameterCount );
00320         }
00321 
00322         AuditParameters.ParameterCount++;
00323 
00324         <span class="comment">//</span>
00325         <span class="comment">//    Parameter[6] - Privileges used for open</span>
00326         <span class="comment">//</span>
00327 
00328         <span class="keywordflow">if</span> ( (CapturedPrivileges != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a3">NULL</a>) &amp;&amp; (CapturedPrivileges-&gt;PrivilegeCount &gt; 0) ) {
00329 
00330             <a class="code" href="../../d7/d6/sepaudit_8c.html#a7">SepSetParmTypePrivileges</a>( AuditParameters, AuditParameters.ParameterCount, CapturedPrivileges );
00331         }
00332 
00333         AuditParameters.ParameterCount++;
00334 
00335         <a class="code" href="../../d0/d5/adtlog_8c.html#a0">SepAdtLogAuditRecord</a>( &amp;AuditParameters );
00336 
00337         <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
00338 
00339     }
00340 
00341     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> );
00342 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="adtp.h::SepAdtSetAuditEventInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtSetAuditEventInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN OPTIONAL PBOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AuditingMode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN OPTIONAL PPOLICY_AUDIT_EVENT_OPTIONS&nbsp;</td>
          <td class="mdname" nowrap> <em>EventAuditingOptions</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="adtp.h::SepAdtSetAuditLogInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtSetAuditLogInformation           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PPOLICY_AUDIT_LOG_INFO&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>AuditLogInformation</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00451">451</a> of file <a class="el" href="../../d1/d4/adtlog_8c-source.html">adtlog.c</a>.
<p>
References <a class="el" href="../../d1/d8/ntosdef_8h-source.html#l00462">PAGED_CODE</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00029">SepAdtLogInformation</a>, <a class="el" href="../../d2/d9/rmp_8h-source.html#l00060">SepRmAcquireDbWriteLock</a>, and <a class="el" href="../../d2/d9/rmp_8h-source.html#l00066">SepRmReleaseDbWriteLock</a>.
<p>
Referenced by <a class="el" href="../../d8/d8/rmaudit_8c-source.html#l00164">SepRmSetAuditLogWrkr()</a>.
<p>
<pre class="fragment"><div>00457                    :
00458 
00459     This function stores Audit Log Information in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Reference Monitor's
00460     in-memory database.  This information contains parameters such as Audit
00461     Log size etc.  It <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller's responsibility to ensure that <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00462     supplied information <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> valid.
00463 
00464     NOTE:  After initialization, <span class="keyword">this</span> function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> called by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA
00465     via a Reference Monitor command.  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> a necessary restriction
00466     because <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> Audit Log Information stored in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> LSA Database must
00467     remain in sync
00468 
00469 Arguments:
00470 
00471     AuditLogInformation - Pointer to Audit Log Information structure.
00472 
00473 Return Value:
00474 
00475     None.
00476 
00477 --*/
00478 
00479 {
00480     <a class="code" href="../../d0/d9/ntosdef_8h.html#a28">PAGED_CODE</a>();
00481 
00482     <span class="comment">//</span>
00483     <span class="comment">// Acquire Reference Monitor Database write lock.</span>
00484     <span class="comment">//</span>
00485 
00486     <a class="code" href="../../d1/d0/rmp_8h.html#a3">SepRmAcquireDbWriteLock</a>();
00487 
00488     <span class="comment">//</span>
00489     <span class="comment">// Write the information</span>
00490     <span class="comment">//</span>
00491 
00492     <a class="code" href="../../d1/d5/adtp_8h.html#a3">SepAdtLogInformation</a> = *AuditLogInformation;
00493 
00494     <span class="comment">//</span>
00495     <span class="comment">// Release Reference Monitor Database write lock</span>
00496     <span class="comment">//</span>
00497 
00498     <a class="code" href="../../d1/d0/rmp_8h.html#a5">SepRmReleaseDbWriteLock</a>();
00499 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="adtp.h::SepAdtTraverseAuditAlarm" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAdtTraverseAuditAlarm           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PLUID&nbsp;</td>
          <td class="mdname" nowrap> <em>OperationID</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>DirectoryObject</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PSID&nbsp;</td>
          <td class="mdname" nowrap> <em>UserSid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN LUID&nbsp;</td>
          <td class="mdname" nowrap> <em>AuthenticationId</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ACCESS_MASK&nbsp;</td>
          <td class="mdname" nowrap> <em>DesiredAccess</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PPRIVILEGE_SET Privileges&nbsp;</td>
          <td class="mdname" nowrap> <em>OPTIONAL</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AccessGranted</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAudit</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>GenerateAlarm</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d4/d4/seaudit_8c-source.html#l03429">SeTraverseAuditAlarm()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a31" doxytag="adtp.h::SepAuditFailed" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID SepAuditFailed           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">VOID&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00153">153</a> of file <a class="el" href="../../d1/d4/adtlog_8c-source.html">adtlog.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d1/bugcheck_8c-source.html#l00070">KeBugCheck()</a>, <a class="el" href="../../d9/d9/rtbatcr_8c-source.html#l00059">KeyName</a>, <a class="el" href="../../d3/d9/aw_8h-source.html#l00031">L</a>, <a class="el" href="../../d6/d5/stierr_8h-source.html#l00030">NT_SUCCESS</a>, <a class="el" href="../../d0/d6/iop_8h.html#a144">NTSTATUS()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d3/d6/string_8c-source.html#l00148">RtlInitUnicodeString()</a>, <a class="el" href="../../d2/d4/adtp_8h-source.html#l00077">SepCrashOnAuditFail</a>, <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>, and <a class="el" href="../../d2/d0/rtdelval_8c-source.html#l00047">ValueName</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>.
<p>
<pre class="fragment"><div>00159                    :
00160 
00161     Bugchecks <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system due to a missed audit (optional requirement
00162     <span class="keywordflow">for</span> C2 compliance).
00163 
00164 Arguments:
00165 
00166     None.
00167 
00168 Return Value:
00169 
00170     None.
00171 
00172 --*/
00173 
00174 {
00175     <a class="code" href="../../d0/d6/iop_8h.html#a144">NTSTATUS</a> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00176     OBJECT_ATTRIBUTES Obja;
00177     HANDLE KeyHandle;
00178     UNICODE_STRING <a class="code" href="../../d8/d0/rtbatcr_8c.html#a3">KeyName</a>;
00179     UNICODE_STRING <a class="code" href="../../d1/d1/rtdelval_8c.html#a3">ValueName</a>;
00180     UCHAR NewValue;
00181 
00182     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<span class="keyword">sizeof</span>(UCHAR) == <span class="keyword">sizeof</span>(BOOLEAN));
00183 
00184     <span class="keywordflow">if</span> (!<a class="code" href="../../d1/d5/adtp_8h.html#a12">SepCrashOnAuditFail</a>) {
00185         <span class="keywordflow">return</span>;
00186     }
00187 
00188     <span class="comment">//</span>
00189     <span class="comment">// Turn off flag in the registry that controls crashing on audit failure</span>
00190     <span class="comment">//</span>
00191 
00192     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;KeyName, L<span class="stringliteral">"\\Registry\\Machine\\System\\CurrentControlSet\\Control\\Lsa"</span>);
00193 
00194     InitializeObjectAttributes( &amp;Obja,
00195                                 &amp;KeyName,
00196                                 OBJ_CASE_INSENSITIVE | 
00197                                     OBJ_KERNEL_HANDLE,
00198                                 NULL,
00199                                 NULL
00200                                 );
00201     <span class="keywordflow">do</span> {
00202 
00203         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwOpenKey(
00204                      &amp;KeyHandle,
00205                      KEY_SET_VALUE,
00206                      &amp;Obja
00207                      );
00208 
00209     } <span class="keywordflow">while</span> ((<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_INSUFFICIENT_RESOURCES) || (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_NO_MEMORY));
00210 
00211     <span class="comment">//</span>
00212     <span class="comment">// If the LSA key isn't there, he's got big problems.  But don't crash.</span>
00213     <span class="comment">//</span>
00214 
00215     <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_OBJECT_NAME_NOT_FOUND) {
00216         <a class="code" href="../../d1/d5/adtp_8h.html#a12">SepCrashOnAuditFail</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00217         <span class="keywordflow">return</span>;
00218     }
00219 
00220     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00221         <span class="keywordflow">goto</span> bugcheck;
00222     }
00223 
00224     <a class="code" href="../../d2/d7/string_8c.html#a7">RtlInitUnicodeString</a>( &amp;ValueName, CRASH_ON_AUDIT_FAIL_VALUE );
00225 
00226     NewValue = LSAP_ALLOW_ADIMIN_LOGONS_ONLY;
00227 
00228     <span class="keywordflow">do</span> {
00229 
00230         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwSetValueKey( KeyHandle,
00231                                 &amp;ValueName,
00232                                 0,
00233                                 REG_NONE,
00234                                 &amp;NewValue,
00235                                 <span class="keyword">sizeof</span>(UCHAR)
00236                                 );
00237 
00238     } <span class="keywordflow">while</span> ((<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_INSUFFICIENT_RESOURCES) || (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_NO_MEMORY));
00239     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00240 
00241     <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>( Status )) {
00242         <span class="keywordflow">goto</span> bugcheck;
00243     }
00244 
00245     <span class="keywordflow">do</span> {
00246 
00247         <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = ZwFlushKey( KeyHandle );
00248 
00249     } <span class="keywordflow">while</span> ((<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_INSUFFICIENT_RESOURCES) || (<a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> == STATUS_NO_MEMORY));
00250     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(<a class="code" href="../../d5/d6/stierr_8h.html#a0">NT_SUCCESS</a>(Status));
00251 
00252     <span class="comment">//</span>
00253     <span class="comment">// go boom.</span>
00254     <span class="comment">//</span>
00255 
00256 bugcheck:
00257 
00258     <a class="code" href="../../d9/d1/bugcheck_8c.html#a13">KeBugCheck</a>(AUDIT_FAILURE);
00259 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a33" doxytag="adtp.h::SepInitializePrivilegeFilter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN SepInitializePrivilegeFilter           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>Verbose</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04556">4556</a> of file <a class="el" href="../../d4/d4/seaudit_8c-source.html">seaudit.c</a>.
<p>
References <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04520">SepFilterPrivileges</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04522">SepFilterPrivilegesLong</a>, <a class="el" href="../../d4/d4/seaudit_8c-source.html#l04545">SepFilterPrivilegesShort</a>, and <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00329">SepAdtInitializePrivilegeAuditing()</a>.
<p>
<pre class="fragment"><div>04561                    :
04562 
04563     Initializes <a class="code" href="../../d3/d5/seaudit_8c.html#a2">SepFilterPrivileges</a> <span class="keywordflow">for</span> either normal or <a class="code" href="../../d2/d1/userexts_8c.html#a135">verbose</a> auditing.
04564 
04565 Arguments:
04566 
04567     Verbose - Whether we want to filter by <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordtype">short</span> or <span class="keywordtype">long</span> privileges
04568     list.  Verbose == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> means use <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <span class="keywordtype">short</span> list.
04569 
04570 Return Value:
04571 
04572     <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> <span class="keywordflow">for</span> success, <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a> <span class="keywordflow">for</span> <a class="code" href="../../d8/d0/rtbatcr_8c.html#a1">failure</a>
04573 
04574 --*/
04575 {
04576     <span class="keywordflow">if</span> (Verbose) {
04577         <a class="code" href="../../d3/d5/seaudit_8c.html#a2">SepFilterPrivileges</a> = <a class="code" href="../../d3/d5/seaudit_8c.html#a4">SepFilterPrivilegesShort</a>;
04578     } <span class="keywordflow">else</span> {
04579         <a class="code" href="../../d3/d5/seaudit_8c.html#a2">SepFilterPrivileges</a> = <a class="code" href="../../d3/d5/seaudit_8c.html#a3">SepFilterPrivilegesLong</a>;
04580     }
04581 
04582     <span class="keywordflow">return</span>( <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a> );
04583 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a4" doxytag="adtp.h::SepAdtAuditingEnabled" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d8/d5/seglobal_8c.html#a89">SepAdtAuditingEnabled</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/adtp_8h-source.html#l00031">31</a> of file <a class="el" href="../../d2/d4/adtp_8h-source.html">adtp.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="adtp.h::SepAdtCountEventsDiscarded" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d3/d5/adtvars_8c.html#a5">SepAdtCountEventsDiscarded</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/adtp_8h-source.html#l00056">56</a> of file <a class="el" href="../../d2/d4/adtp_8h-source.html">adtp.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l02717">SepAdtGenerateDiscardAudit()</a>, and <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">SepQueueWorkItem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="adtp.h::SepAdtCurrentListLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d3/d5/adtvars_8c.html#a4">SepAdtCurrentListLength</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/adtp_8h-source.html#l00063">63</a> of file <a class="el" href="../../d2/d4/adtp_8h-source.html">adtp.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00738">SepDequeueWorkItem()</a>, and <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">SepQueueWorkItem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="adtp.h::SepAdtDiscardingAudits" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d3/d5/adtvars_8c.html#a6">SepAdtDiscardingAudits</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/adtp_8h-source.html#l00070">70</a> of file <a class="el" href="../../d2/d4/adtp_8h-source.html">adtp.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">SepQueueWorkItem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="adtp.h::SepAdtLogInformation" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> POLICY_AUDIT_LOG_INFO <a class="el" href="../../d3/d5/adtvars_8c.html#a1">SepAdtLogInformation</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/adtp_8h-source.html#l00029">29</a> of file <a class="el" href="../../d2/d4/adtp_8h-source.html">adtp.h</a>.
<p>
Referenced by <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00451">SepAdtSetAuditLogInformation()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="adtp.h::SepAdtMaxListLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d3/d5/adtvars_8c.html#a2">SepAdtMaxListLength</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/adtp_8h-source.html#l00037">37</a> of file <a class="el" href="../../d2/d4/adtp_8h-source.html">adtp.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00117">SepAdtInitializeBounds()</a>, and <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">SepQueueWorkItem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="adtp.h::SepAdtMinListLength" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d3/d5/adtvars_8c.html#a3">SepAdtMinListLength</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/adtp_8h-source.html#l00038">38</a> of file <a class="el" href="../../d2/d4/adtp_8h-source.html">adtp.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00117">SepAdtInitializeBounds()</a>, and <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00600">SepQueueWorkItem()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="adtp.h::SepAuditOptions" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d4/d1/struct__SEP__AUDIT__OPTIONS.html">SEP_AUDIT_OPTIONS</a> <a class="el" href="../../d3/d5/adtvars_8c.html#a7">SepAuditOptions</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/adtp_8h-source.html#l00323">323</a> of file <a class="el" href="../../d2/d4/adtp_8h-source.html">adtp.h</a>.
<p>
Referenced by <a class="el" href="../../d8/d5/sepaudit_8c-source.html#l01312">SepAdtCloseObjectAuditAlarm()</a>, and <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00425">SepAdtInitializeAuditingOptions()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="adtp.h::SepCrashOnAuditFail" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> BOOLEAN <a class="el" href="../../d8/d5/seglobal_8c.html#a90">SepCrashOnAuditFail</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/adtp_8h-source.html#l00077">77</a> of file <a class="el" href="../../d2/d4/adtp_8h-source.html">adtp.h</a>.
<p>
Referenced by <a class="el" href="../../d0/d4/adtinit_8c-source.html#l00242">SepAdtInitializeCrashOnFail()</a>, <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00052">SepAdtLogAuditRecord()</a>, and <a class="el" href="../../d1/d4/adtlog_8c-source.html#l00153">SepAuditFailed()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:42:50 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
