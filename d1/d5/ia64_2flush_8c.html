<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: ia64/flush.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>flush.c File Reference</h1><code>#include "<a class="el" href="../../d1/d9/ki_8h-source.html">ki.h</a>"</code><br>
<code>#include "kxia64.h"</code><br>

<p>
<a href="../../d2/d4/ia64_2flush_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a3">KiSweepDcacheTarget</a> (IN PULONG SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a4">KiSweepIcacheTarget</a> (IN PULONG SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a5">KiFlushIoBuffersTarget</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Mdl, IN PVOID ReadOperation, IN PVOID DmaOperation)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a6">KiSyncCacheTarget</a> (IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a> SignalDone, IN PVOID Parameter1, IN PVOID Parameter2, IN PVOID Parameter3)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a7">KiSyncMC_DrainTarget</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a8">KiSyncMC_Drain</a> (IN BOOLEAN AllProcessors, IN PVOID BaseAddress, IN ULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a9">KiSyncPrefetchVisibleTarget</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG_PTR&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a10">KiSyncPrefetchVisible</a> (IN BOOLEAN AllProcessors, IN PVOID BaseAddress, IN ULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a11">KeSweepIcache</a> (IN BOOLEAN AllProcessors)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a12">KeSweepDcache</a> (IN BOOLEAN AllProcessors)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a13">KeSweepCacheRange</a> (IN BOOLEAN AllProcessors, IN PVOID BaseAddress, IN ULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a14">KeSweepIcacheRange</a> (IN BOOLEAN AllProcessors, IN PVOID BaseAddress, IN ULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a15">KeSweepDcacheRange</a> (IN BOOLEAN AllProcessors, IN PVOID BaseAddress, IN ULONG Length)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>VOID&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a16">KeSweepCacheRangeWithDrain</a> (IN BOOLEAN AllProcessors, IN PVOID BaseAddress, IN ULONG Length)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a0">ProbePalVisibilitySupport</a> = 1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>ULONG&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a1">NeedPalVisibilitySupport</a> = 1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>KSPIN_LOCK&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d1/d5/ia64_2flush_8c.html#a2">KiCacheFlushLock</a></td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a13" doxytag="ia64/flush.c::KeSweepCacheRange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSweepCacheRange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00453">453</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00103">KiSyncCacheTarget()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00979">KeSweepCacheRangeWithDrain()</a>.
<p>
<pre class="fragment"><div>00461                    :
00462 
00463     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to flush a range of <span class="keyword">virtual</span> addresses from both <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00464     instruction and data cache on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system.
00465 
00466     Irrespective of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range, <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> should not call SweepIcache
00467     or SweepDcache. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> because SweepDcache will <a class="code" href="../../d3/d0/imm32_8def.html#a1">only</a> sweep <a class="code" href="../../d2/d0/imemenu_8c.html#a0">D</a> cache and
00468     not <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I cache and Vice versa. Since <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caller of <a class="code" href="../../d1/d5/ia64_2flush_8c.html#a13">KeSweepCacheRange</a> assumes
00469     both <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> caches are being swept, one cannot call SweepIcache or SweepDcache
00470     in trying to optimize.
00471 
00472 
00473     Arguments:
00474 
00475     AllProcessors - Not used
00476 
00477     BaseAddress - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed.
00478 
00479     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base
00480         address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified.
00481 
00482     Return Value:
00483 
00484         None.
00485 
00486 
00487 --*/
00488 
00489 {
00490      KIRQL OldIrql;
00491      KAFFINITY TargetProcessors;
00492 
00493     <span class="comment">//</span>
00494     <span class="comment">// We will not raise IRQL to synchronization level so that we can allow</span>
00495     <span class="comment">// a context switch in between Flush Cache. FC need not run in the same processor</span>
00496     <span class="comment">// throughout. It can be context switched. So no binding is done to any processor.</span>
00497     <span class="comment">//</span>
00498     <span class="comment">//</span>
00499 
00500     HalSweepCacheRange(BaseAddress,Length);
00501 
00502     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= KiSynchIrql);
00503 
00504     <span class="comment">//</span>
00505     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00506     <span class="comment">//</span>
00507 
00508 <span class="preprocessor">#if !defined(NT_UP)</span>
00509 <span class="preprocessor"></span>
00510     OldIrql = KeRaiseIrqlToSynchLevel();
00511 
00512     <span class="comment">//</span>
00513     <span class="comment">// Compute the set of target processors and send the sync parameters</span>
00514     <span class="comment">// to the target processors, if any, for execution.</span>
00515     <span class="comment">//</span>
00516 
00517     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00518     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00519     <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00520                     KiSyncCacheTarget,
00521                     NULL,
00522                     NULL,
00523                     NULL);
00524     }
00525 
00526 <span class="preprocessor">#endif</span>
00527 <span class="preprocessor"></span>
00528     <span class="comment">//</span>
00529     <span class="comment">// Synchronize the Instruction Prefetch pipe in the local processor.</span>
00530     <span class="comment">//</span>
00531 
00532     __synci();
00533     __isrlz();
00534 
00535     <span class="comment">//</span>
00536     <span class="comment">// Wait until all target processors have finished sweeping the their</span>
00537     <span class="comment">// data cache.</span>
00538     <span class="comment">//</span>
00539 
00540 <span class="preprocessor">#if !defined(NT_UP)</span>
00541 <span class="preprocessor"></span>
00542     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00543         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00544     }
00545 
00546     <span class="comment">//</span>
00547     <span class="comment">// Lower IRQL to its previous level and return.</span>
00548     <span class="comment">//</span>
00549 
00550     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00551 
00552 <span class="preprocessor">#endif</span>
00553 <span class="preprocessor"></span>
00554     <span class="keywordflow">return</span>;
00555 
00556 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="ia64/flush.c::KeSweepCacheRangeWithDrain" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSweepCacheRangeWithDrain           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00979">979</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00453">KeSweepCacheRange()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00787">KiSyncMC_Drain()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00885">KiSyncPrefetchVisible()</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d7/d1/mm_2ia64_2initia64_8c-source.html#l02042">MiSweepCacheMachineDependent()</a>.
<p>
<pre class="fragment"><div>00987                    :
00988 
00989     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to drain prefetches,demand references followed by flushing
00990     <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cache followed by draining pending fc cache line evictions to a specified range
00991     address in all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system.
00992 
00993 
00994 Arguments:
00995 
00996     AllProcessors -  All processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system.
00997 
00998     BaseAddress - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed and drained.
00999 
01000     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed and drained <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base
01001         address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified.
01002 
01003 Return Value:
01004 
01005     None.
01006 
01007     Note:  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used when changing attributes of WB pages to UC pages.
01008 
01009 --*/
01010 
01011 {
01012     ULONG_PTR <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
01013 
01014     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d5/ia64_2flush_8c.html#a10">KiSyncPrefetchVisible</a>(
01015                  AllProcessors,
01016                  BaseAddress,
01017                  Length
01018                  );
01019 
01020     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Status != PAL_STATUS_ERROR);
01021     
01022 
01023     <a class="code" href="../../d1/d5/ia64_2flush_8c.html#a13">KeSweepCacheRange</a> (
01024         AllProcessors,
01025         BaseAddress,
01026         Length
01027         );
01028 
01029     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = <a class="code" href="../../d1/d5/ia64_2flush_8c.html#a8">KiSyncMC_Drain</a> (
01030                  AllProcessors,
01031                  BaseAddress,
01032                  Length
01033                  );
01034 
01035     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Status == PAL_STATUS_SUCCESS);
01036 
01037     <span class="keywordflow">return</span>;
01038 
01039 
01040 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="ia64/flush.c::KeSweepDcache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSweepDcache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>AllProcessors</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00276">276</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02007">KeAcquireSpinLock</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00039">KiCacheFlushLock</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00156">KiSweepDcacheTarget()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00282                    :
00283 
00284     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data cache on all processors that are currently
00285     running threads which are children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00286     data cache on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00287 
00288     N.B. PowerPC maintains cache coherency across processors however
00289     in <span class="keyword">this</span> routine, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range of addresses being flushed <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> unknown
00290     so we must still broadcast <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> request to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> other processors.
00291 
00292 Arguments:
00293 
00294     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which data
00295         caches are flushed.
00296 
00297 Return Value:
00298 
00299     None.
00300 
00301 --*/
00302 
00303 {
00304 
00305     KIRQL OldIrql;
00306     KAFFINITY TargetProcessors;
00307 
00308     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00309 
00310 <span class="preprocessor">#if !defined(NT_UP)</span>
00311 <span class="preprocessor"></span>    <span class="comment">// </span>
00312     <span class="comment">// Acquire cache flush spinlock</span>
00313     <span class="comment">// Cache flush is not MP safe yet</span>
00314     <span class="comment">//</span>
00315     <a class="code" href="../../d4/d9/ke_8h.html#a37">KeAcquireSpinLock</a>(&amp;KiCacheFlushLock, &amp;OldIrql);
00316 
00317 <span class="preprocessor">#endif</span>
00318 <span class="preprocessor"></span>
00319     HalSweepDcache();
00320 
00321 <span class="preprocessor">#if !defined(NT_UP)</span>
00322 <span class="preprocessor"></span>
00323     <span class="comment">//</span>
00324     <span class="comment">// Compute the set of target processors and send the sweep parameters</span>
00325     <span class="comment">// to the target processors, if any, for execution.</span>
00326     <span class="comment">//</span>
00327 
00328     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00329     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00330         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00331                         KiSweepDcacheTarget,
00332                         NULL,
00333                         NULL,
00334                         NULL);
00335     }
00336 
00337 
00338     <span class="comment">//</span>
00339     <span class="comment">// Wait until all target processors have finished sweeping their</span>
00340     <span class="comment">// data caches.</span>
00341     <span class="comment">//</span>
00342 
00343 
00344     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00345         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00346     }
00347 
00348     <span class="comment">//</span>
00349     <span class="comment">// Lower IRQL to its previous level and return.</span>
00350     <span class="comment">//</span>
00351 
00352     <a class="code" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock</a>(&amp;KiCacheFlushLock, OldIrql);
00353 
00354 <span class="preprocessor">#endif</span>
00355 <span class="preprocessor"></span>
00356     <span class="keywordflow">return</span>;
00357 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="ia64/flush.c::KeSweepDcacheRange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSweepDcacheRange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00674">674</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00103">KiSyncCacheTarget()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00682                    :
00683 
00684     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to flush a range of <span class="keyword">virtual</span> addresses from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00685     primary data cache on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00686 
00687      If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> greater than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00688     data cache, then one can call HalSweepDcache which calls
00689     SAL to flush <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire cache. Since SAL does not take care of MP
00690     flushing, HalSweepDcache has to use IPI mechanism to execute SAL
00691     flush from each processor. We need to weight <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> overhead of all these
00692     versus <span class="keyword">using</span> HalSweepDcacheRange and avoiding IPI mechanism since
00693     HalSweepDcacheRange uses fc instruction and fc instruction takes care of MP.
00694 
00695 Arguments:
00696 
00697     AllProcessors -  Not used
00698 
00699     BaseAddress - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed.
00700 
00701     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base
00702         address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified.
00703 
00704 Return Value:
00705 
00706     None.
00707 
00708     Note:  For performance <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a>, we may update <a class="code" href="../../d1/d5/ia64_2flush_8c.html#a15">KeSweepDcacheRange</a> to <span class="keywordflow">do</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following:
00709            <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range asked to sweep <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> very large, we may call <a class="code" href="../../d9/d4/alpha_2flush_8c.html#a5">KeSweepDcache</a> to flush
00710            <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> full cache.
00711 
00712 
00713 
00714 --*/
00715 
00716 {
00717     KIRQL OldIrql;
00718     KAFFINITY TargetProcessors;
00719 
00720     <span class="comment">//</span>
00721     <span class="comment">// We will not raise IRQL to synchronization level so that we can allow</span>
00722     <span class="comment">// a context switch in between Flush Cache. FC need not run in the same processor</span>
00723     <span class="comment">// throughout. It can be context switched. So no binding is done to any processor.</span>
00724     <span class="comment">//</span>
00725     <span class="comment">//</span>
00726 
00727     HalSweepDcacheRange(BaseAddress,Length);
00728 
00729     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= KiSynchIrql);
00730 
00731     <span class="comment">//</span>
00732     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00733     <span class="comment">//</span>
00734 
00735 <span class="preprocessor">#if !defined(NT_UP)</span>
00736 <span class="preprocessor"></span>
00737     OldIrql = KeRaiseIrqlToSynchLevel();
00738 
00739     <span class="comment">//</span>
00740     <span class="comment">// Compute the set of target processors and send the sync parameters</span>
00741     <span class="comment">// to the target processors, if any, for execution.</span>
00742     <span class="comment">//</span>
00743 
00744     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00745     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00746         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00747             KiSyncCacheTarget,
00748             NULL,
00749             NULL,
00750             NULL);
00751     }
00752 
00753 <span class="preprocessor">#endif</span>
00754 <span class="preprocessor"></span>
00755     <span class="comment">//</span>
00756     <span class="comment">// Synchronize the Instruction Prefetch pipe in the local processor.</span>
00757     <span class="comment">//</span>
00758 
00759     __synci();
00760     __isrlz();
00761 
00762     <span class="comment">//</span>
00763     <span class="comment">// Wait until all target processors have finished sweeping the their</span>
00764     <span class="comment">// data cache.</span>
00765     <span class="comment">//</span>
00766 
00767 <span class="preprocessor">#if !defined(NT_UP)</span>
00768 <span class="preprocessor"></span>
00769     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00770         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00771     }
00772 
00773     <span class="comment">//</span>
00774     <span class="comment">// Lower IRQL to its previous level and return.</span>
00775     <span class="comment">//</span>
00776 
00777     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00778 
00779 <span class="preprocessor">#endif</span>
00780 <span class="preprocessor"></span>
00781     <span class="keywordflow">return</span>;
00782 
00783 
00784 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="ia64/flush.c::KeSweepIcache" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSweepIcache           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>AllProcessors</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00143">143</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00087">DISPATCH_LEVEL</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02007">KeAcquireSpinLock</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00039">KiCacheFlushLock</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d0/d4/alpha_2flush_8c-source.html#l00287">KiSweepIcacheTarget()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00149                    :
00150 
00151     This function flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> instruction cache on all processors that are
00152     currently running threads which are children of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> current process or
00153     flushes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> instruction cache on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00154 
00155     N.B. Although PowerPC maintains cache coherency across processors, we
00156     use <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> flash invalidate function (h/w) <span class="keywordflow">for</span> I-Cache sweeps which doesn'<a class="code" href="../../d4/d1/genmips_8c.html#a17">t</a>
00157     maintain coherency so we still <span class="keywordflow">do</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> MP I-Cache flush in s/w.   plj.
00158 
00159 Arguments:
00160 
00161     AllProcessors - Supplies a <span class="keywordtype">boolean</span> value that determines which instruction
00162         caches are flushed.
00163 
00164 Return Value:
00165 
00166     None.
00167 
00168 --*/
00169 
00170 {
00171 
00172     KIRQL OldIrql;
00173     KAFFINITY TargetProcessors;
00174 
00175     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= DISPATCH_LEVEL);
00176 
00177 <span class="preprocessor">#if !defined(NT_UP)</span>
00178 <span class="preprocessor"></span>    <span class="comment">// </span>
00179     <span class="comment">// Acquire cache flush spinlock</span>
00180     <span class="comment">// Cache flush is not MP safe yet</span>
00181     <span class="comment">//</span>
00182     <a class="code" href="../../d4/d9/ke_8h.html#a37">KeAcquireSpinLock</a>(&amp;KiCacheFlushLock, &amp;OldIrql);
00183 
00184 <span class="preprocessor">#endif</span>
00185 <span class="preprocessor"></span>
00186     HalSweepDcache();
00187     HalSweepIcache();
00188 
00189 <span class="preprocessor">#if !defined(NT_UP)</span>
00190 <span class="preprocessor"></span>
00191     <span class="comment">//</span>
00192     <span class="comment">// Compute the set of target processors and send the sweep parameters</span>
00193     <span class="comment">// to the target processors, if any, for execution.</span>
00194     <span class="comment">//</span>
00195 
00196     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00197     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00198         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00199                         KiSweepIcacheTarget,
00200                         NULL,
00201                         NULL,
00202                         NULL);
00203     }
00204 
00205 
00206     <span class="comment">//</span>
00207     <span class="comment">// Wait until all target processors have finished sweeping their</span>
00208     <span class="comment">// instruction caches.</span>
00209     <span class="comment">//</span>
00210 
00211 
00212     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00213         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00214     }
00215 
00216     <span class="comment">//</span>
00217     <span class="comment">// Lower IRQL to its previous level and return.</span>
00218     <span class="comment">//</span>
00219 
00220     <a class="code" href="../../d9/d5/verifier_8c.html#a119">KeReleaseSpinLock</a>(&amp;KiCacheFlushLock, OldIrql);
00221 
00222 <span class="preprocessor">#endif</span>
00223 <span class="preprocessor"></span>
00224     <span class="keywordflow">return</span>;
00225 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="ia64/flush.c::KeSweepIcacheRange" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KeSweepIcacheRange           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00559">559</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d5/d8/ke_8h-source.html#l02766">KeActiveProcessors</a>, <a class="el" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql()</a>, <a class="el" href="../../d0/d3/mpipi_8c-source.html#l00319">KiIpiSendPacket()</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00182">KiIpiStallOnPacketTargets()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00103">KiSyncCacheTarget()</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>.
<p>
<pre class="fragment"><div>00567                    :
00568 
00569     This function <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used to flush a range of <span class="keyword">virtual</span> addresses from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00570     primary instruction cache on all processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> host configuration.
00571 
00572      If <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> greater than <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> size of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00573     instruction cache, then one can call HalSweepIcache which calls
00574     SAL to flush <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> entire cache. Since SAL does not take care of MP
00575     flushing, HalSweepIcache has to use IPI mechanism to execute SAL
00576     flush from each processor. We need to weight <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> overhead of all these
00577     versus <span class="keyword">using</span> HalSweepIcacheRange and avoiding IPI mechanism since
00578     HalSweepIcacheRange uses fc instruction and fc instruction takes care of MP.
00579 
00580 Arguments:
00581 
00582     AllProcessors -  Not used
00583 
00584     BaseAddress - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed.
00585 
00586     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base
00587         address <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> specified.
00588 
00589 Return Value:
00590 
00591     None.
00592 
00593     Note:  For performance <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a10">reason</a>, we may update <a class="code" href="../../d9/d4/alpha_2flush_8c.html#a7">KeSweepIcacheRange</a> to <span class="keywordflow">do</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following:
00594            <span class="keywordflow">if</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range asked to sweep <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> very large, we may call <a class="code" href="../../d9/d4/alpha_2flush_8c.html#a6">KeSweepIcache</a> to flush
00595            <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> full cache.
00596 
00597 
00598 
00599 --*/
00600 
00601 {
00602     KIRQL OldIrql;
00603     KAFFINITY TargetProcessors;
00604 
00605     <span class="comment">//</span>
00606     <span class="comment">// We will not raise IRQL to synchronization level so that we can allow</span>
00607     <span class="comment">// a context switch in between Flush Cache. FC need not run in the same processor</span>
00608     <span class="comment">// throughout. It can be context switched. So no binding is done to any processor.</span>
00609     <span class="comment">//</span>
00610     <span class="comment">//</span>
00611 
00612     HalSweepIcacheRange(BaseAddress,Length);
00613 
00614     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(KeGetCurrentIrql() &lt;= KiSynchIrql);
00615 
00616     <span class="comment">//</span>
00617     <span class="comment">// Raise IRQL to synchronization level to prevent a context switch.</span>
00618     <span class="comment">//</span>
00619 
00620 <span class="preprocessor">#if !defined(NT_UP)</span>
00621 <span class="preprocessor"></span>
00622     OldIrql = KeRaiseIrqlToSynchLevel();
00623 
00624     <span class="comment">//</span>
00625     <span class="comment">// Compute the set of target processors and send the sync parameters</span>
00626     <span class="comment">// to the target processors, if any, for execution.</span>
00627     <span class="comment">//</span>
00628 
00629     TargetProcessors = <a class="code" href="../../d4/d9/ke_8h.html#a123">KeActiveProcessors</a> &amp; PCR-&gt;NotMember;
00630     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00631         <a class="code" href="../../d0/d0/ki_8h.html#a91">KiIpiSendPacket</a>(TargetProcessors,
00632             KiSyncCacheTarget,
00633             NULL,
00634             NULL,
00635             NULL);
00636     }
00637 
00638 <span class="preprocessor">#endif</span>
00639 <span class="preprocessor"></span>
00640     <span class="comment">//</span>
00641     <span class="comment">// Synchronize the Instruction Prefetch pipe in the local processor.</span>
00642     <span class="comment">//</span>
00643 
00644     __synci();
00645     __isrlz();
00646 
00647     <span class="comment">//</span>
00648     <span class="comment">// Wait until all target processors have finished sweeping the their</span>
00649     <span class="comment">// data cache.</span>
00650     <span class="comment">//</span>
00651 
00652 <span class="preprocessor">#if !defined(NT_UP)</span>
00653 <span class="preprocessor"></span>
00654     <span class="keywordflow">if</span> (TargetProcessors != 0) {
00655         <a class="code" href="../../d2/d1/xipi_8c.html#a2">KiIpiStallOnPacketTargets</a>(TargetProcessors);
00656     }
00657 
00658     <span class="comment">//</span>
00659     <span class="comment">// Lower IRQL to its previous level and return.</span>
00660     <span class="comment">//</span>
00661 
00662     <a class="code" href="../../d9/d5/verifier_8c.html#a117">KeLowerIrql</a>(OldIrql);
00663 
00664 <span class="preprocessor">#endif</span>
00665 <span class="preprocessor"></span>
00666     <span class="keywordflow">return</span>;
00667 
00668 
00669 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ia64/flush.c::KiFlushIoBuffersTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiFlushIoBuffersTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Mdl</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>ReadOperation</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>DmaOperation</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ia64/flush.c::KiSweepDcacheTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSweepDcacheTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00360">360</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>.
<p>
<pre class="fragment"><div>00369                    :
00370 
00371     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> sweeping <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> data cache on target
00372     processors.
00373 
00374 Arguments:
00375 
00376     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00377         requested operation has been performed.
00378 
00379     Parameter1 - Parameter3 - Not used.
00380 
00381 Return Value:
00382 
00383     None.
00384 
00385 --*/
00386 
00387 {
00388 
00389     <span class="comment">//</span>
00390     <span class="comment">// Sweep the data cache on the current processor and clear the sweep</span>
00391     <span class="comment">// data cache packet address to signal the source to continue.</span>
00392     <span class="comment">//</span>
00393 
00394 <span class="preprocessor">#if !defined(NT_UP)</span>
00395 <span class="preprocessor"></span>
00396     HalSweepDcache();
00397     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00398 
00399 <span class="preprocessor">#endif</span>
00400 <span class="preprocessor"></span>
00401     <span class="keywordflow">return</span>;
00402 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ia64/flush.c::KiSweepIcacheTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSweepIcacheTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN PULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00228">228</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>.
<p>
<pre class="fragment"><div>00237                    :
00238 
00239     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> sweeping <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> instruction cache on
00240     target processors.
00241 
00242 Arguments:
00243 
00244     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00245         requested operation has been performed.
00246 
00247     Parameter1 - Parameter3 - Not used.
00248 
00249 Return Value:
00250 
00251     None.
00252 
00253 --*/
00254 
00255 {
00256 
00257     <span class="comment">//</span>
00258     <span class="comment">// Sweep the instruction cache on the current processor and clear</span>
00259     <span class="comment">// the sweep instruction cache packet address to signal the source</span>
00260     <span class="comment">// to continue.</span>
00261     <span class="comment">//</span>
00262 
00263 <span class="preprocessor">#if !defined(NT_UP)</span>
00264 <span class="preprocessor"></span>
00265     HalSweepDcache();
00266     HalSweepIcache();
00267 
00268     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00269 
00270 <span class="preprocessor">#endif</span>
00271 <span class="preprocessor"></span>
00272     <span class="keywordflow">return</span>;
00273 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ia64/flush.c::KiSyncCacheTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> VOID KiSyncCacheTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN <a class="el" href="../../d0/d9/ntosdef_8h.html#a54">PKIPI_CONTEXT</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>SignalDone</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter1</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter2</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>Parameter3</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00103">103</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone()</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00453">KeSweepCacheRange()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00674">KeSweepDcacheRange()</a>, and <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00559">KeSweepIcacheRange()</a>.
<p>
<pre class="fragment"><div>00111                    :
00112 
00113     This function synchronizes <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> I-fetch pipeline. Typically <span class="keyword">this</span> routine will be
00114     executed by every processor in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system in response to an IPI after <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> cache
00115     <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> flushed. Each processor executing RFI <span class="keywordflow">while</span> leaving <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> IPI produces <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00116     serialization effect that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> required after isync to make sure that further
00117     instruction prefetches wait till <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> ISYNC completes.
00118 
00119 Arguements:
00120 
00121     SignalDone Supplies a pointer to a variable that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> cleared when <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00122     requested operation has been performed.
00123 
00124     Parameter1 - Parameter3 - Not used.
00125 
00126 Return Value:
00127 
00128     Nothing.
00129 --*/
00130 {
00131 
00132 <span class="preprocessor">#if !defined(NT_UP)</span>
00133 <span class="preprocessor"></span>
00134     __synci();
00135     <a class="code" href="../../d0/d0/ki_8h.html#a93">KiIpiSignalPacketDone</a>(SignalDone);
00136 
00137 <span class="preprocessor">#endif</span>
00138 <span class="preprocessor"></span>    <span class="keywordflow">return</span>;
00139 
00140 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="ia64/flush.c::KiSyncMC_Drain" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG_PTR KiSyncMC_Drain           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00787">787</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00040">KiIpiGenericCall()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00407">KiSyncMC_DrainTarget()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00293">PKIPI_BROADCAST_WORKER</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00979">KeSweepCacheRangeWithDrain()</a>.
<p>
<pre class="fragment"><div>00795                    :
00796 
00797     <a class="code" href="../../d1/d5/ia64_2flush_8c.html#a8">KiSyncMC_Drain</a> issues  PAL_MC_DRAIN to drain either prefetches, demand references
00798     or pending fc cache line evictions to all <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system.
00799     DrainTypePointer points to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> variable, DrainType, which determines <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> <a class="code" href="../../d3/d5/i386_2trapc_8c.html#a9">type</a> of
00800     drain to be performed. This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> typically used when changing <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> memory attribute
00801     from WB to UC.
00802 
00803 Arguments:
00804 
00805     AllProcessors - All processors in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> system.
00806 
00807     BaseAddress - Supplies a pointer to <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> to be drained.
00808 
00809     Length - Supplies <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> length of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> range that <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> drained <span class="keywordflow">for</span> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> base
00810         address specified.
00811 
00812 Return Value:
00813 
00814     Note:  This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> used when changing attributes of WB pages to UC pages.
00815 
00816 
00817 --*/
00818 
00819 {
00820     ULONG_PTR <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00821     <span class="comment">//</span>
00822     <span class="comment">// KiIpiGenericCall returns ULONG_PTR as the function value of the specified function</span>
00823     <span class="comment">//</span>
00824 
00825     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = (<a class="code" href="../../d2/d1/xipi_8c.html#a1">KiIpiGenericCall</a> (
00826                 (<a class="code" href="../../d0/d0/ki_8h.html#a33">PKIPI_BROADCAST_WORKER</a>)KiSyncMC_DrainTarget,
00827                 (ULONG_PTR)NULL)
00828                 );
00829 
00830     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Status == PAL_STATUS_SUCCESS);
00831 
00832     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00833 
00834 
00835 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="ia64/flush.c::KiSyncMC_DrainTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG_PTR KiSyncMC_DrainTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00407">407</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00787">KiSyncMC_Drain()</a>.
<p>
<pre class="fragment"><div>00412                    :
00413 
00414     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> issuing PAL_MC_DRAIN to drain
00415     prefetches, demand references and pending fc cache line evictions on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a>
00416     target CPU <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> executes.
00417 
00418 Argument:
00419 
00420     None
00421 
00422 
00423 Return Value:
00424 
00425    Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> status from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function HalCallPal
00426 
00427 --*/
00428 
00429 {
00430     ULONG_PTR <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00431 
00432     <span class="comment">//</span>
00433     <span class="comment">// Call HalCallPal to drain.</span>
00434     <span class="comment">//</span>
00435 
00436     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = HalCallPal(PAL_MC_DRAIN,
00437         0,
00438         0,
00439         0,
00440         0,
00441         0,
00442         0,
00443         0);
00444 
00445     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Status == PAL_STATUS_SUCCESS);
00446 
00447     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00448 
00449 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="ia64/flush.c::KiSyncPrefetchVisible" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG_PTR KiSyncPrefetchVisible           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">IN BOOLEAN&nbsp;</td>
          <td class="mdname" nowrap> <em>AllProcessors</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN PVOID&nbsp;</td>
          <td class="mdname" nowrap> <em>BaseAddress</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>IN ULONG&nbsp;</td>
          <td class="mdname" nowrap> <em>Length</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00885">885</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, <a class="el" href="../../d3/d0/xipi_8c-source.html#l00040">KiIpiGenericCall()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00838">KiSyncPrefetchVisibleTarget()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00038">NeedPalVisibilitySupport</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00023">NULL</a>, <a class="el" href="../../d1/d9/ki_8h-source.html#l00293">PKIPI_BROADCAST_WORKER</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00037">ProbePalVisibilitySupport</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00979">KeSweepCacheRangeWithDrain()</a>.
<p>
<pre class="fragment"><div>00893                    :
00894 
00895     <a class="code" href="../../d1/d5/ia64_2flush_8c.html#a10">KiSyncPrefetchVisible</a> issues  PAL_PREFETCH_VISIBILITY to cause <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> processor to make
00896     all pending prefetches visible to subsequent fc instructions; or does nothing, on 
00897     processor implementations which does not require PAL support <span class="keywordflow">for</span> disabling prefetch 
00898     in <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> architectural sequence. On processors that require PAL support <span class="keywordflow">for</span> <span class="keyword">this</span>
00899     sequence, <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> actions performed by <span class="keyword">this</span> <a class="code" href="../../d2/d0/nt6_2user32_8def.html#a69">procedure</a> may include any or all
00900     of <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> following (or none, as <span class="keywordtype">long</span> as the processor guarantees that 
00901     prefetches that were issued prior to <span class="keyword">this</span> call are not resident in the 
00902     processor's caches after the architected sequence is complete.
00903     This is typically used when changing the memory attribute from WB to UC.
00904 
00905 Arguments:
00906 
00907     AllProcessors - All processors in the system.
00908 
00909     BaseAddress - Supplies a pointer to the base of the range that is to be drained.
00910 
00911     Length - Supplies the length of the range that is drained <span class="keywordflow">for</span> the base
00912         address specified.
00913 
00914 Return Value:
00915 
00916     Status of the PAL CALL
00917       0  Success
00918       1  Call not needed
00919       -3 Error returned
00920     
00921     Note:  This is used when changing attributes of WB pages to UC pages.
00922 
00923 
00924 --*/
00925 
00926 {
00927     ULONG_PTR Status;
00928     
00929     switch (ProbePalVisibilitySupport) {
00930         <span class="keywordflow">case</span> 0: 
00931             <span class="keywordflow">if</span> (NeedPalVisibilitySupport == 0)
00932                <span class="keywordflow">return</span> PAL_STATUS_SUPPORT_NOT_NEEDED;
00933             <span class="keywordflow">else</span> {
00934                Status = (KiIpiGenericCall (
00935                             (PKIPI_BROADCAST_WORKER)KiSyncPrefetchVisibleTarget,
00936                             (ULONG_PTR)NULL)
00937                             );
00938             
00939                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Status != PAL_STATUS_ERROR);
00940                 <span class="keywordflow">return</span> Status;
00941                 
00942             }
00943             <span class="keywordflow">break</span>;
00944 
00945         <span class="keywordflow">case</span> 1:
00946             Status = <a class="code" href="../../d1/d5/ia64_2flush_8c.html#a9">KiSyncPrefetchVisibleTarget</a>();
00947    
00948             <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Status != PAL_STATUS_ERROR);
00949    
00950             ProbePalVisibilitySupport = 0;
00951 
00952             <span class="keywordflow">if</span> (Status == PAL_STATUS_SUPPORT_NOT_NEEDED) {
00953                 NeedPalVisibilitySupport = 0;
00954                 <span class="keywordflow">return</span> PAL_STATUS_SUPPORT_NOT_NEEDED;
00955             } <span class="keywordflow">else</span> {
00956 
00957                                                 
00958                 Status = (KiIpiGenericCall (
00959                             (PKIPI_BROADCAST_WORKER)KiSyncPrefetchVisibleTarget,
00960                             (ULONG_PTR)NULL)
00961                             );
00962             
00963                 <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Status != PAL_STATUS_ERROR);
00964             
00965                 <span class="keywordflow">return</span> Status;
00966                 
00967             }
00968 
00969             <span class="keywordflow">break</span>;
00970         
00971     }
00972     
00973 
00974 }

</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="ia64/flush.c::KiSyncPrefetchVisibleTarget" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG_PTR KiSyncPrefetchVisibleTarget           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00838">838</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
References <a class="el" href="../../d7/d4/ntgdi_2icm_2inc_2debug_8h-source.html#l00146">ASSERT</a>, and <a class="el" href="../../d3/d0/cttoken_8c-source.html#l00135">Status</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00885">KiSyncPrefetchVisible()</a>.
<p>
<pre class="fragment"><div>00843                    :
00844 
00845     This <a class="code" href="../../d3/d0/user32_8def.html#a108">is</a> <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target function <span class="keywordflow">for</span> issuing PAL_PREFETCH VISIBILITY 
00846     on <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> target CPU <a class="code" href="../../d1/d9/icmui_8def.html#a4">it</a> executes.
00847 
00848 Argument:
00849 
00850     Not used.
00851 
00852 
00853 Return Value:
00854 
00855    Returns <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> status from <a class="code" href="../../d7/d1/genuedef_8c.html#a2">the</a> function HalCallPal
00856 
00857 --*/
00858 
00859 {
00860     ULONG_PTR <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00861 
00862     <span class="comment">//</span>
00863     <span class="comment">// Call HalCallPal to drain.</span>
00864     <span class="comment">//</span>
00865 
00866     <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a> = HalCallPal(PAL_PREFETCH_VISIBILITY,
00867         0,
00868         0,
00869         0,
00870         0,
00871         0,
00872         0,
00873         0);
00874 
00875 
00876     <a class="code" href="../../d6/d5/ntgdi_2icm_2inc_2debug_8h.html#a7">ASSERT</a>(Status != PAL_STATUS_ERROR);
00877 
00878     <span class="keywordflow">return</span> <a class="code" href="../../d1/d0/cmchek_8c.html#a4">Status</a>;
00879 
00880 }

</div></pre>    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a2" doxytag="ia64/flush.c::KiCacheFlushLock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> KSPIN_LOCK <a class="el" href="../../d8/d2/ia64_2initkr_8c.html#a2">KiCacheFlushLock</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00039">39</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00276">KeSweepDcache()</a>, <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00143">KeSweepIcache()</a>, and <a class="el" href="../../d9/d1/ia64_2initkr_8c-source.html#l00078">KiInitializeKernel()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ia64/flush.c::NeedPalVisibilitySupport" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d1/d5/ia64_2flush_8c.html#a1">NeedPalVisibilitySupport</a> = 1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00038">38</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00885">KiSyncPrefetchVisible()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="ia64/flush.c::ProbePalVisibilitySupport" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> ULONG <a class="el" href="../../d1/d5/ia64_2flush_8c.html#a0">ProbePalVisibilitySupport</a> = 1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00037">37</a> of file <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html">ia64/flush.c</a>.
<p>
Referenced by <a class="el" href="../../d2/d4/ia64_2flush_8c-source.html#l00885">KiSyncPrefetchVisible()</a>.    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:43 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
